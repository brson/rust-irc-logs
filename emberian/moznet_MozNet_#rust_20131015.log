[00:00:11] <acrichto> Luqman: hm, maybe, I figured it'd refer to the first one, eddyb was here earlier saying indices would refer to arguments as well
[00:00:20] <aatch> acrichto, it's possible that the backend knows that upper part of the register is already 0
[00:00:58] <acrichto> aatch: this is just an arbitrary function call though?
[00:01:00] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[00:01:03] *** Quits: dbaupp (Thunderbir@BEECE994.D5A1DCF.37681C44.IP) (Ping timeout)
[00:01:16] *** Joins: jmptable (jmptable@3FA10BA4.F2113B77.3A99D594.IP)
[00:01:17] *** Joins: thewonderidiot (mike@moz-5506A033.hsd1.ca.comcast.net)
[00:01:27] *** Quits: mib_uxk5e7 (Mibbit@moz-D21B16F.dc.dc.cox.net) (Quit: http://www.mibbit.com ajax IRC Client)
[00:02:58] <acrichto> time for a "git clean -fdx" to see if that fixes anything
[00:03:13] *** Joins: alisdair (textual@FAD454DC.CDDF2711.C4CBE0CB.IP)
[00:03:37] <aatch> acrichto, I have a feeling that most instructions on a 32-bit register clears the top bits in the 64-bit "version" (since they are the same register). I'm not sure about that though.
[00:04:57] *** Quits: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[00:05:57] <acrichto> aatch: whoa I coudl have sworn that was not the case, maybe I'm just going crazy here
[00:06:12] <acrichto> aatch: https://gist.github.com/alexcrichton/6984494
[00:06:25] <kmc> aatch: that's the case, yes
[00:06:42] <aatch> kmc, clearing the top 32bits?
[00:06:45] <kmc> yeah
[00:06:51] <acrichto> weird
[00:06:56] <kmc> even "mov %eax, %eax" is no longer a no-op on x86_64
[00:06:58] *** Joins: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net)
[00:07:03] *** Quits: jst (quassel@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[00:07:14] <aatch> I remember reading it *somewhere*, but I can't for the life of me find a source.
[00:07:44] <aatch> kmc, so that would actually be "clear the top half of %rax"?
[00:07:48] <kmc> yeah
[00:08:04] <kmc> (I think the rationale is that it makes it easier to use 32-bit pointers in memory and expand them when you want to dereference them)
[00:08:36] <kmc> top answer here is also plausible: http://stackoverflow.com/questions/11177137/why-do-most-x64-instructions-zero-the-upper-part-of-a-32-bit-register
[00:10:11] <acrichto> kmc: this is blowing my mind
[00:10:24] <acrichto> mov    $0x5000,%eax
[00:10:26] <acrichto> mov    %rax,%fs:0x70
[00:10:30] <acrichto> turns out that does what I'd expect
[00:11:08] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[00:13:58] <aatch> Ok, well at least I have a source for the behaviour.
[00:14:05] <aatch> And I wasn't just making stuff up.
[00:17:57] <acrichto> does ~fn have the same layout as &fn ?
[00:18:15] <acrichto> except for that one is a heap pointer and the other is a stack pointer?
[00:21:55] <jld|mv> Extra fun thing about that: `mov r/m64, imm32` is not `mov r/m32, imm32`.  The first sign-extends, the second zero-extends.
[00:22:34] *** Quits: eholk (eholk@moz-F70D5031.hsd1.in.comcast.net) (Quit: eholk)
[00:23:34] *** Joins: jst (quassel@moz-BBE3ABD.mv.mozilla.com)
[00:25:49] *** Quits: jst (quassel@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[00:25:55] *** Joins: jst (quassel@moz-BBE3ABD.mv.mozilla.com)
[00:27:48] *** Quits: jst (quassel@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[00:29:06] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Client exited)
[00:29:27] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[00:29:32] *** Quits: jmptable (jmptable@3FA10BA4.F2113B77.3A99D594.IP) (Quit: Leaving)
[00:29:48] *** Joins: jst (quassel@moz-BBE3ABD.mv.mozilla.com)
[00:30:17] *** Quits: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[00:30:48] *** Joins: ksf__ (ksf@moz-7753D06C.adsl.hansenet.de)
[00:31:20] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Ping timeout)
[00:31:34] *** Quits: jst (quassel@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[00:31:45] *** Quits: ksf_ (ksf@moz-E8A93694.adsl.alicedsl.de) (Ping timeout)
[00:32:31] <bblum> jld|mv: nobody needs negative numbers anyway
[00:32:41] *** pnkfelix|taqueria is now known as pnkfelix
[00:34:51] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[00:38:13] *** Joins: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net)
[00:38:27] *** Joins: aegeaner (Aegeaner@C8372C16.21B75AD6.FA28A497.IP)
[00:41:23] *** Joins: jst (quassel@moz-BBE3ABD.mv.mozilla.com)
[00:42:17] <maikeru> traits and types and structs OH MY
[00:43:42] *** Quits: jst (quassel@moz-BBE3ABD.mv.mozilla.com) (Input/output error)
[00:44:01] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[00:44:10] *** Joins: jst (quassel@moz-BBE3ABD.mv.mozilla.com)
[00:45:20] *** Quits: bent (chatzilla@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: ChatZilla 0.9.90.1-rdmsoft [XULRunner 22.0/20130619132145])
[00:45:31] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[00:45:57] *** Quits: fran_ (fran@moz-1A9852E3.telecom.net.ar) (Ping timeout)
[00:46:57] *** Quits: jst (quassel@moz-BBE3ABD.mv.mozilla.com) (Input/output error)
[00:47:01] *** Joins: fran_ (fran@moz-3BCF261.telecom.net.ar)
[00:48:13] *** Joins: gore06 (Mibbit@moz-D130B4E9.catv.broadband.hu)
[00:48:27] *** Parts: gore06 (Mibbit@moz-D130B4E9.catv.broadband.hu) ()
[00:53:09] *** Quits: themgt (themgt@moz-9C18EE8D.baf.movistar.cl) (Ping timeout)
[00:53:34] *** Joins: themgt (themgt@moz-84498CCE.baf.movistar.cl)
[00:53:52] *** Quits: Ralith (ralith@A8995AA9.62B6AF6A.922221DB.IP) (Ping timeout)
[00:54:05] *** Joins: jst (quassel@moz-BBE3ABD.mv.mozilla.com)
[00:54:47] *** Joins: toshok` (toshok@moz-43741342.cat)
[00:55:24] *** Quits: DAddYE (DAddYE@moz-61EB081B.hfc.comcastbusiness.net) (Client exited)
[00:55:50] *** Quits: toshok (toshok@moz-67C55A1F.com) (Quit: Coyote finally caught me)
[00:56:08] *** Joins: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net)
[00:56:43] *** Joins: samx (sami@moz-D9DA5773.dyn.optonline.net)
[00:58:43] *** Joins: pcwalton (pcwalton@moz-B51927E9.hsd1.ca.comcast.net)
[00:58:43] *** ChanServ sets mode: +ao pcwalton pcwalton
[01:00:03] *** Quits: samx (sami@moz-D9DA5773.dyn.optonline.net) (Quit: This computer has gone to sleep)
[01:00:12] *** Quits: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[01:04:10] *** Joins: samx (sami@moz-D9DA5773.dyn.optonline.net)
[01:04:24] <McPherrin> jeaye says caltrains are running late for anyone coming to the meetup tonight.
[01:04:24] *** Quits: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[01:04:26] <McPherrin> Luqman: ^
[01:05:01] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[01:06:16] *** Joins: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net)
[01:06:59] *** Joins: nuts_ (tii@822A8E7E.6AD15BF5.75D3BBDB.IP)
[01:07:30] *** Quits: joone_ (joone@moz-C50DC051.jf.intel.com) (Ping timeout)
[01:07:39] *** Quits: nuts (tii@822A8E7E.6AD15BF5.75D3BBDB.IP) (Ping timeout)
[01:07:49] *** Joins: joone_ (joone@3CCE8CB5.2160464A.A34EC3BB.IP)
[01:08:56] <SiegeLord> I wonder why this exists:
[01:09:00] <SiegeLord> rusti: '\"'
[01:09:01] -rusti- '"'
[01:09:10] <SiegeLord> What exactly is that escape meant to accomplish?
[01:09:44] <McPherrin> consistent escaping, I presume
[01:09:48] <McPherrin> rusti: "\""
[01:09:49] -rusti- "\""
[01:10:03] <SiegeLord> rusti: "\'"
[01:10:04] -rusti- "'"
[01:10:10] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[01:10:14] *** Quits: pcwalton (pcwalton@moz-B51927E9.hsd1.ca.comcast.net) (Quit: pcwalton)
[01:11:11] <SiegeLord> I guess...
[01:11:24] *** ercxx is now known as ercxx__away
[01:11:54] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[01:12:45] *** Quits: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net) (Client exited)
[01:14:10] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[01:14:20] *** Quits: azakai (alon@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[01:14:50] *** Quits: jeffreybaird (jeffreybai@moz-ED3EF543.static.twtelecom.net) (Quit: jeffreybaird)
[01:15:45] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:16:09] *** Quits: geoffhill (geoffhill@moz-244CF33A.amazon.com) (Quit: geoffhill)
[01:17:02] <aatch> SiegeLord, yes, it's because escaping is just escaping. Simpler implementation and all that.
[01:17:08] <aatch> rusti: '"'
[01:17:09] -rusti- error: internal compiler error: unexpected failure
[01:17:09] -rusti- note: the compiler hit an unexpected failure path. this is a bug
[01:17:09] -rusti- note: try running with RUST_LOG=rustc=1 to get further details and report the results to github.com/mozilla/rust/issues
[01:17:09] -rusti- '"'
[01:17:20] <brson> lol
[01:17:20] <SiegeLord> ...lol
[01:17:22] <aatch> rusti: '\"'
[01:17:23] -rusti- '"'
[01:17:26] <aatch> lolwut
[01:17:39] <strcat> rustc -v still ICEs sometimes
[01:17:45] <aatch> rusti: '"'
[01:17:47] -rusti- '"'
[01:17:57] <aatch> Ok. That's ok then.
[01:18:48] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[01:18:54] <maikeru> I just want to generically handle streams :(
[01:19:22] <kmc> "they changed the Caltrain schedule just for us? how considerate"
[01:19:51] <tjc> Caltrain, motto: "At Least We're Not VTA"
[01:19:54] <maikeru> copy editor notice: "Types that implement both Reader and Writer and called 'streams', and automatically implement trait Stream" should be "are called 'streams'"
[01:20:33] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[01:21:23] <ChrisMorgan> maikeru: you know the procedure ;-)
[01:21:57] *** Joins: Ralith (ralith@moz-132F2FD4.sea.wa.customer.broadstripe.net)
[01:22:34] *** Quits: Earnestly (earnest@moz-BE290A2B.dyn.plus.net) (Ping timeout)
[01:24:36] <strcat> rusti: let xs = &[1, 2, 3]; xs[9223372036854775809u]
[01:24:37] -rusti- 2
[01:24:44] <strcat> rusti: let xs = &[1, 2, 3]; xs[9223372036854775810u]
[01:24:45] -rusti- 3
[01:24:52] *** Joins: sruggier (sruggier@moz-B9FB4CF4.cpe.pppoe.ca)
[01:25:11] <strcat> so... I'm going to change slices to using element length instead of this silly byte length thing
[01:25:19] <maikeru> :)
[01:25:44] *** Joins: mark_edward (quassel@moz-DCB0B750.lightspeed.cicril.sbcglobal.net)
[01:25:47] <strcat> probably going to be a temporary performance hit until ~[T] is switched to element length but I can't see another way to fix this and the indexing performance issues
[01:26:46] <mark_edward> strcat: sorry to be annoyinh, but what would be a performance hit?
[01:26:49] <strcat> (a sane way, at least - adding a branch on overflow checked multiplication would really slow things down)
[01:27:01] <strcat> it's going to have to do a division when converting from ~[T] to a slice
[01:27:23] <strcat> but you already do that whenever you check the length and it's division by a constant so it's not actual implemented as division
[01:27:28] *** Quits: jordyd (jordyd@moz-C3FF1ED7.seg46.ucf.edu) (Ping timeout)
[01:27:30] <strcat> maybe not that bad
[01:27:42] <strcat> actually implemented*
[01:28:00] <Jesse> is division by all constants fast? or only powers of 2?
[01:28:13] <strcat> well LLVM knows tricks for more than powers of 2
[01:30:17] <lkuper> Are other people seeing occasional Varnish 503 errors from rust-lang.org?
[01:30:17] <strcat> playing with matching std::vector and then leveraging jemalloc to beat it
[01:30:55] *** ercxx__away is now known as ercxx
[01:31:40] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[01:34:14] <sruggier> I'm trying to run two different blocks of code concurrently, in other words, I want to run code on two OS-level threads. From the mailing list message about the new runtime, I'm guessing I want spawn_sched with the mode set to SingleThreaded, but the docs for SchedMode are a little vague, so I want to double check this is the right interpretation
[01:34:22] *** jorendorff_away is now known as jorendorff
[01:34:42] <ercxx> ChrisMorgan: ping
[01:35:31] <ChrisMorgan> ercxx: pong
[01:35:45] <sruggier> can someone confirm my understanding of spawn_sched? My current guess is that passing in DefaultScheduler is equivalent to calling spawn, whereas passing SingleThreaded will create a new scheduler and a new OS-level thread, and run the task on those?
[01:37:10] <brson> sruggier: that's right. DefaultScheduler is just the same as 'spawn', SingleThreaded means it will put that task in its own thread
[01:37:25] * ercxx ChrisMorgan It took forever to wrap my head around what's going on.
[01:37:52] <brson> sruggier: by default though two tasks will run in parallel. SingleThreaded is mostly for special cases where you are going to be calling blocking C code that would otherise interfere with scheduling
[01:38:02] <strcat> wtf. libcall optimizations aren't working at all for me anymore
[01:38:25] <strcat> hrm
[01:38:38] <maikeru> Alright.. how can I make this match work with the implemented traits? https://gist.github.com/mletterle/b1415f45f07e8f87ecd8
[01:39:38] <strcat> need a way to mark a function as noreturn/nounwind I guess :s
[01:40:18] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[01:40:50] <strcat> ah I can add an intrinsic :)
[01:40:57] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[01:40:57] <sruggier> brson: that's what I would have expected, but the documentation says "by default, every task is created in the same scheduler as its parent, where it is scheduled cooperatively with all other tasks in that scheduler."
[01:41:26] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[01:42:27] *** ercxx is now known as ercxx__away
[01:42:29] <strcat> is there a way to actually call LLVM intrinsics directly now? I forget
[01:43:00] <ChrisMorgan> ercxx: concerning the "close \r\n , keep-ALIVE" value, consume_optional_lws() will need modification to fit in with the new rules of what gets passed through the HeaderValueByteIterator
[01:45:09] <strcat> funny how when implementation a new vector, the lowest hanging fruit becomes LLVM not knowing abort() is nounwind/noreturn
[01:45:13] * strcat sighs
[01:45:18] <strcat> when implementing*
[01:48:16] *** Joins: ktt3ja (Mibbit@moz-6B6EE8C0.hsd1.va.comcast.net)
[01:48:25] *** Quits: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: My lid went down)
[01:48:33] <ChrisMorgan> ercxx__away: most notably, with collapsing exactly one SP would be passed through, where now at least one of either SP or HT. Thus, consume_optional_lws() needs to operate on a loop, consuming until it gets something other than SP or HT.
[01:49:07] *** Quits: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[01:50:14] <ktt3ja> how come I get this error? "type `std::rt::io::file::FileStream` does not implement any method in scope named `seek`"
[01:50:21] <ktt3ja> I just checked and it does
[01:51:04] <ChrisMorgan> That comes from a trait, which must be in scope.
[01:51:28] <ChrisMorgan> `use std::rt::io::Seek;`
[01:51:39] <ktt3ja> oh
[01:51:42] <ktt3ja> thank you
[01:52:17] <strcat> can you have a run-fail test without an error pattern?
[01:52:28] <strcat> hm
[01:52:39] <aatch> strcat, I think so
[01:53:07] <aatch> Since I have a feeling the error pattern is to ensure that the "correct" error occurs
[01:53:58] <maikeru> Slowly coming to the realization I may have to write more code than I thought...
[01:54:12] *** Joins: Sonarpulse (user@moz-424CB7EB.cs.brown.edu)
[01:54:23] <Sonarpulse> I am getting a no type for local variable error
[01:54:31] *** Joins: infynyxx (infynyxx@82680D2B.9F7BDBDF.8B824544.IP)
[01:54:46] <aatch> Sonarpulse, it helps if we have some code to look at.
[01:54:50] <Sonarpulse> sure
[01:55:25] <strcat> of all things, why did they have to leave abort out of the libcall tables >.<
[01:55:25] *** Quits: glennsl (textual@moz-5D7B804F.getinternet.no) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[01:55:35] <Sonarpulse> the basic situation is static <iden>: u8 = { ... }
[01:55:43] <strcat> we should really have #[readnone], #[readonly], #[nounwind] for extern functions though
[01:55:49] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[01:56:05] <Sonarpulse> type error is on local variable in block, with explicit type signiture
[01:56:17] *** Joins: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net)
[01:56:36] <aatch> Sonarpulse, can you pastebin (or similar) an actual code example?
[01:56:37] <strcat> Sonarpulse: need a real code sample demonstrating the problem to be able to help
[01:56:42] <Sonarpulse> sure
[01:58:33] <Sonarpulse> http://pastebin.com/MKyiRWYV
[01:59:54] <Sonarpulse> with uses: http://pastebin.com/jXeY5Kb8
[01:59:55] *** Quits: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net) (Ping timeout)
[02:00:00] <aatch> Sonarpulse, you can't have a block expr to initialize a static like that.
[02:00:08] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[02:01:34] <Sonarpulse> ok. Is there a reason uint has no Exponential implementation?
[02:02:09] <aatch> Sonarpulse, no idea. But you wouldn't be able to call log2 to initialize a static anyway.
[02:02:31] <aatch> it's only for expressions that can be const-folded
[02:03:00] *** Joins: masondesu (masondesu@moz-CD3BFAD1.gsp.bellsouth.net)
[02:03:26] <aatch> Also, you are looping until ret == uint::bits, why not just use uint::bits?
[02:03:40] <Sonarpulse> that is a mistake
[02:03:47] <Sonarpulse> I wan
[02:04:05] <Sonarpulse> * I want log2(uint::bits)
[02:04:28] *** Joins: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net)
[02:04:49] <aatch> Sonarpulse, anyway, you should be able to use conditional compilation to just specify it for each architecture size.
[02:06:08] <aatch> I can't remember the exact cfg but it's something like `#[cfg(target_arch_size = 32)]`
[02:06:19] <strcat> #[cfg(target_word_size = "32")]
[02:06:38] <Sonarpulse> what exactly can be const folded?
[02:06:56] <aatch> Sonarpulse, arithmetic
[02:07:14] <Sonarpulse> ok
[02:07:18] <ChrisMorgan> Sonarpulse: your code suggests you end up with `LOG_SIZE_UNIT = uint::bits - 1`, is that not what's intended?
[02:07:19] <aatch> and a couple other simple operations. No loops or functions
[02:07:56] <strcat> stupid test didn't fail like it was supposed to :s
[02:07:59] *** Quits: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[02:08:13] <Sonarpulse> well what I REALLY want is (x % uint::bits)
[02:08:21] <Sonarpulse> I was writing a bit mask to do it faster
[02:08:24] <Sonarpulse> but it is 2013
[02:08:38] <Sonarpulse> and I could probably just rely on LLVM to do that
[02:08:46] <strcat> if it's something in a `static` it has to be evaluated by rustc anyway
[02:09:43] <ChrisMorgan> Yes, % [constant] should be fast.
[02:10:09] *** Quits: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com) (Quit: Scriptor)
[02:10:33] <aatch> Especially since LLVM should be able to tell that uint::bits is 2^n
[02:10:40] <Sonarpulse> yeah
[02:10:53] <strcat> aatch: https://github.com/mozilla/rust/pull/9860 r?
[02:11:47] <aatch> strcat, and done
[02:12:30] *** Joins: pcwalton (pcwalton@moz-B51927E9.hsd1.ca.comcast.net)
[02:12:30] *** ChanServ sets mode: +ao pcwalton pcwalton
[02:12:39] * strcat isn't entirely sure if it should really be *preferred*, but whatever
[02:12:40] <aatch> We've needed that for a while. I had issues when doing stuff like implementing an exit syscall
[02:13:01] <mark_edward> are there any timer modules in std/extra?
[02:13:02] <strcat> aatch: well it's not actually a great way to exit ;p
[02:13:09] <strcat> % ./abort
[02:13:11] <strcat> zsh: illegal hardware instruction  ./abort
[02:13:25] <aatch> strcat, yeah, but I meant to keep the type-system happy
[02:13:34] <strcat> ah
[02:13:41] *** Quits: echristo (echristo@4EEA9249.D6CCE4AE.77834EAA.IP) (Quit: echristo)
[02:14:11] <aatch> so you do something like `asm!(<syscall for exit>); abort()`, without introducing a dependency on fail!
[02:16:16] <strcat> aatch: well a real unreachable intrinsic might be better
[02:16:26] <aatch> strcat, good point
[02:16:34] <strcat> aatch: although an exit syscall can return :)
[02:16:43] <strcat> glibc runs it in a loop
[02:17:08] <aatch> strcat, well something else then. I know there is at least 1 noreturn syscall
[02:17:12] <strcat> (at least I think it can return, would have to try)
[02:17:24] <strcat> aatch: but you can be forbidden from calling any syscall
[02:17:32] <aatch> strcat, good point
[02:17:35] *** Quits: masondesu (masondesu@moz-CD3BFAD1.gsp.bellsouth.net) (Quit: Textual IRC Client: www.textualapp.com)
[02:17:52] <strcat> so abort is actually an okay thing to do there
[02:17:58] <strcat> or loop ;p
[02:18:20] <Sonarpulse> does rust support mutable references to immutable objects?
[02:18:45] <strcat> if you mean semantic immutability, sure
[02:18:45] <pcwalton> Sonarpulse: no, otherwise they'd be mutable objects :)
[02:18:51] *** Parts: sruggier (sruggier@moz-B9FB4CF4.cpe.pppoe.ca) ()
[02:20:05] <Sonarpulse> well. I am trying to recur down an immutable tree in a loop (because no TCO), so what should I do?
[02:20:26] <pcwalton> oh, you mean the reference *itself* is mutable
[02:20:29] <pcwalton> but the object it points to isn't
[02:20:32] <pcwalton> that's fine, you can do that.
[02:20:34] <strcat> Sonarpulse: LLVM does do tail call elimination
[02:20:55] <strcat> as long as it calls itself and it's truly tail recursive it will work
[02:21:43] <Sonarpulse> Really? I read a bunch of github issues that said no TCO. 
[02:21:49] <pcwalton> in the general case no
[02:21:54] <aatch> Sonarpulse, no *guarenteed* TCO
[02:21:54] <pcwalton> but it does sibling call optimization
[02:21:58] <aatch> we aren't Scheme
[02:22:09] <pcwalton> if it's a sibling call and you have no destructors to run then we will do TCO
[02:22:21] <strcat> there are other fun restrictions too
[02:22:32] <strcat> truly tail recursive also means it doesn't return a huge object, atm
[02:22:39] <pcwalton> oh, that's annoying
[02:23:14] *** Joins: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net)
[02:23:33] <Sonarpulse> long term, might rust support multiple calling convensions?
[02:23:40] <pcwalton> well, it sorta does
[02:23:47] <strcat> pcwalton: for whatever reason there's a bail out case if there's an sret but I might have misunderstood the code
[02:23:55] <pcwalton> probably just not implemented yet.
[02:24:03] <pcwalton> or maybe there's some fundamental reason
[02:24:07] <strcat> and I want to replace sret with our own pass
[02:24:55] <strcat> sret is very useful since it tells LLVM the pointer points to valid memory so it can memcpy/write directly into it without possibly trapping (changing semantics)
[02:25:08] <strcat> but it also has some silly ABI implications we don't need
[02:25:11] <strcat> just need a replacement
[02:25:26] <strcat> and.... we should be able to mark unique/borrowed ptr parameters that way too
[02:26:26] *** Quits: zz_kimundi (kimundi@moz-2FF9FB9A.dip0.t-ipconnect.de) (Ping timeout)
[02:26:35] <strcat> it will happily auto-lower things to sret though
[02:27:18] *** Quits: alisdair (textual@FAD454DC.CDDF2711.C4CBE0CB.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[02:27:46] <Sonarpulse> Well I'll just write this function recursively for now. but for the future, what is the syntax for mutable references to immutable objects?
[02:28:26] <aatch> Sonarpulse, something like `let mut r : &T`
[02:28:55] <aatch> Says that `r` is mutable, so you can re-assign it.
[02:29:00] <Sonarpulse> ok, as opposed to `let mut r : &mut T` ?
[02:29:10] <Sonarpulse> for mutable to mutable?
[02:29:17] <aatch> Sonarpulse, correct
[02:30:15] *** Joins: zz_kimundi (kimundi@moz-E2582413.dip0.t-ipconnect.de)
[02:30:35] * strcat looks into the bounds checking code...
[02:30:37] *** zz_kimundi is now known as kimundi
[02:31:32] *** Quits: fyolnish (fyolnish@moz-866D3860.uqwimax.jp) (Client exited)
[02:31:35] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Client exited)
[02:31:55] *** Joins: fyolnish (fyolnish@moz-866D3860.uqwimax.jp)
[02:31:55] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[02:33:43] *** Quits: fyolnish (fyolnish@moz-866D3860.uqwimax.jp) (Ping timeout)
[02:33:43] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Ping timeout)
[02:35:25] *** Quits: kurisumasu (queen@9D963F5D.DF5D8AE7.54BCAB54.IP) (Quit: G'night everynyan~!)
[02:35:28] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[02:36:19] *** Quits: samx (sami@moz-D9DA5773.dyn.optonline.net) (Quit: This computer has gone to sleep)
[02:38:35] *** Joins: shrughes (shrughes@moz-C34BE8E5.hsd1.ca.comcast.net)
[02:38:53] <strcat> rusti: let xs = &[1, 2, 3]; xs[9223372036854775810u]
[02:38:54] -rusti- 3
[02:38:57] <strcat> rusti: let xs = &[1, 2, 3]; xs[9223372036854775811u]
[02:38:58] -rusti- task <unnamed> failed at 'index out of bounds: the len is 3 but the index is -9223372036854775805', <anon>:9
[02:38:58] -rusti- application terminated with error code 101
[02:39:04] *** jorendorff is now known as jorendorff_away
[02:39:15] <strcat> silly rust
[02:39:54] *** Quits: infynyxx (infynyxx@82680D2B.9F7BDBDF.8B824544.IP) (Client exited)
[02:40:17] *** Joins: infynyxx (infynyxx@82680D2B.9F7BDBDF.8B824544.IP)
[02:40:18] <strcat> weird, that function casts as int
[02:40:40] *** Quits: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net) (Client exited)
[02:41:17] *** Quits: infynyxx (infynyxx@82680D2B.9F7BDBDF.8B824544.IP) (No route to host)
[02:44:46] *** Joins: echristo (echristo@moz-1892C634.hsd1.ca.comcast.net)
[02:45:21] <strcat> aatch: meh it doesn't work as a run-fail test
[02:45:24] <strcat> just won't add a test ;\
[02:46:04] <aatch> strcat, not the end of the world.
[02:47:36] <Sonarpulse> if you cast heap allocated object (~ or @), what destructor will get called?
[02:48:20] <strcat> what do you mean cast?
[02:48:53] <Sonarpulse> I want my enum to contain an unboxed array of variable size
[02:49:21] <Sonarpulse> my plan was to allocate (with GC) an array of the proper size 
[02:49:26] *** Joins: z0w0 (zack@moz-C877F2F7.lnse2.cha.bigpond.net.au)
[02:49:27] <strcat> it will call the destructor of the inner object
[02:49:34] <strcat> before freeing the allocation
[02:50:04] <strcat> the ~T destructor is basically a check for null, then calling the inner destructor, then free on the ptr
[02:50:21] *** Quits: themgt (themgt@moz-84498CCE.baf.movistar.cl) (Ping timeout)
[02:50:47] <strcat> Sonarpulse: as long as it's always stored somewhere with the proper type, it will be fine
[02:50:50] *** Joins: fyolnish (fyolnish@moz-BE2BAE5B.miinet.jp)
[02:51:15] *** Joins: fyolnish_ (fyolnish@moz-BE2BAE5B.miinet.jp)
[02:51:15] *** Quits: fyolnish (fyolnish@moz-BE2BAE5B.miinet.jp) (Connection reset by peer)
[02:51:19] <strcat> (i.e. as long as the pointer is always a valid pointer to an object of the specified type)
[02:51:37] <Sonarpulse> hmm I am not sure that condition will be met
[02:52:04] <ChrisMorgan> strcat: why would the ~T destructor need to check for null?
[02:52:18] <strcat> ChrisMorgan: because that's how moves are implemented atm
[02:52:24] <ChrisMorgan> Ah, I get it.
[02:52:28] <aatch> ChrisMorgan, it's kinda stupid and is going to be changed
[02:52:31] <Sonarpulse> I am implementing a hash-array mapped trie, like the hash map for the unordered containers package in hackage
[02:53:27] * ChrisMorgan could only think of declaration without allocation, but that would be a silly case and should already be optimised out or get a compile failure
[02:53:59] <Sonarpulse> so I allocate the @array, cast it to a node, and then drop the only referecne to the array and return the reference to the node
[02:54:53] *** Quits: ktt3ja (Mibbit@moz-6B6EE8C0.hsd1.va.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[02:54:57] <strcat> Sonarpulse: if you use raw pointers you're free to do whatever
[02:55:16] <strcat> but the strongly typed pointers are required to never point at invalid memory for the type they hold
[02:55:23] *** Joins: ktt3ja (Mibbit@moz-6B6EE8C0.hsd1.va.comcast.net)
[02:55:28] *** Quits: echristo (echristo@moz-1892C634.hsd1.ca.comcast.net) (Quit: echristo)
[02:56:14] <Sonarpulse> and that's not even something you you can get around with unsafe?
[02:56:34] *** Joins: vodik (simon@moz-FD4ADBC6.cable.teksavvy.com)
[02:56:59] <bytbox> Is there an up-to-date document that might help give me some idea of how to safely call fork() and execvp() via FFI?
[02:57:18] <bytbox> I'm getting strange bugs doing it the naïve way, so I assume it's either not possible, or I need to be more clever
[02:57:22] *** Quits: vodik (simon@moz-FD4ADBC6.cable.teksavvy.com) (Quit: WeeChat 0.4.3-dev)
[02:57:31] *** Joins: vodik (simon@moz-FD4ADBC6.cable.teksavvy.com)
[02:57:34] <bytbox> (and yes I have to do it manually rather than use the lib - I'm using ptrace)
[02:57:52] *** Quits: vodik (simon@moz-FD4ADBC6.cable.teksavvy.com) (Quit: WeeChat 0.4.3-dev)
[02:58:11] *** Joins: vodik (simon@moz-FD4ADBC6.cable.teksavvy.com)
[02:58:21] <strcat> bytbox: use posix_spawn
[02:58:44] <strcat> you won't be able to safely do pretty much anything between fork/execvp
[02:59:15] <strcat> it will break the runtime
[02:59:22] <bytbox> strcat: posix_spawn doesn't seem compatible with ptrace AFAICT
[02:59:26] <bytbox> is that wrong?
[02:59:53] <strcat> bytbox: well, we don't support fork -> any function call -> exec
[03:00:12] <bytbox> strcat: ok, thanks
[03:00:21] *** Quits: nejucomo (Adium@moz-434492BB.dsl.static.sonic.net) (Connection reset by peer)
[03:00:21] *** Joins: nejucomo1 (Adium@moz-434492BB.dsl.static.sonic.net)
[03:00:29] *** Quits: nejucomo1 (Adium@moz-434492BB.dsl.static.sonic.net) (Quit: nejucomo1)
[03:00:32] <strcat> fork -> exec would work if you put #[rust_stack] on exec
[03:00:50] <strcat> std::run isn't really sound
[03:01:00] <bytbox> strcat: what if the fork -> exec is entirely in FFI? So I make my own function that calls fork;ptrace;exec.
[03:01:28] <strcat> well you could also put #[rust_stack] on ptrace/exec but who knows how much stack space they're going to use
[03:01:37] <strcat> bytbox: if you just do that, it will probably work
[03:01:45] * strcat can't see an edge case lurking there
[03:01:54] <bytbox> strcat: I'll try it! Thanks.
[03:01:56] *** ercxx__away is now known as ercxx
[03:05:18] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[03:07:02] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[03:07:27] *** Quits: shrughes (shrughes@moz-C34BE8E5.hsd1.ca.comcast.net) (Ping timeout)
[03:07:59] *** Quits: fran_ (fran@moz-3BCF261.telecom.net.ar) (Ping timeout)
[03:10:49] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[03:11:04] *** Joins: fran_ (fran@moz-776B0468.telecom.net.ar)
[03:11:39] *** Quits: BitPuffin (isak@moz-98F8BF74.cust.tele2.se) (Ping timeout)
[03:12:18] *** Quits: alonlevy (alon@moz-697DD27F.bb.netvision.net.il) (Ping timeout)
[03:13:54] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[03:14:14] <strcat> well I fixed this stupid bounds check thing and made all indexing slow ;p
[03:14:22] <strcat> now perhaps... making it not slow?
[03:14:50] *** Quits: riley (riley@8BA43816.9AA11D69.65DDFA89.IP) (Ping timeout)
[03:15:27] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[03:15:39] *** Joins: tautologico (lymph@7A53DAF8.92451A23.6EB699AE.IP)
[03:17:40] *** Joins: shrughes (shrughes@moz-23F7C89.dsl.static.sonic.net)
[03:17:45] <mark_edward> strcat: ping
[03:17:58] <strcat> mark_edward: pong
[03:18:35] <mark_edward> hey when you put function calls in a tuple, is the ordering guaranteed at all? (example) http://pastebin.com/DX9D31TJ
[03:19:59] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[03:20:59] <aatch> Ooo, libc++abi has an implementation of libunwind now: http://blog.llvm.org/2013/10/new-libunwind-implementation-in-libcabi.html
[03:22:01] <strcat> oh so we can completely drop libgcc
[03:22:16] <strcat> aatch: darwin only for now though ;p
[03:22:46] <aatch> strcat, yeah, but I doubt it'll stay that way for long.
[03:24:38] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[03:25:17] <strcat> task '<unnamed>' failed at 'index out of bounds: the len is 3 but the index is 9223372036854775810', foo.rs:2
[03:25:19] <strcat> \o/
[03:25:51] <ChrisMorgan> cmr: I did some link checking on docs.octayn.net and found https://github.com/mozilla/rust/issues/9861 :-)
[03:26:10] <ktt3ja> what does the keyword "ref" do?
[03:26:21] <strcat> ktt3ja: makes a pattern bind by-ref
[03:26:26] <strcat> rusti: let x = 5; x
[03:26:26] -rusti- 5
[03:26:26] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[03:26:31] <strcat> rusti: let ref x = 5; *x
[03:26:32] -rusti- 5
[03:26:43] <strcat> rusti: let (a, b) = (5, 2); (a, b)
[03:26:44] -rusti- (5, 2)
[03:26:48] <strcat> rusti: let (a, ref b) = (5, 2); (a, *b)
[03:26:49] -rusti- (5, 2)
[03:26:56] <ktt3ja> oh
[03:27:14] <ktt3ja> thanks
[03:27:58] <ChrisMorgan> cmr: also the links from the root for sax, color, cgmath, gl and glfw are broken (no docs built for them?)
[03:30:38] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[03:31:23] *** Quits: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca) (Quit: canhtak)
[03:31:23] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Connection reset by peer)
[03:33:57] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[03:34:43] <ercxx> ChrisMorgan: I thinkg if CR/LF doesn't matter within quotes that makes quote related states pretty much irrelevant. Sounds too good though. Can you tell me where I'm wrong?
[03:35:19] <ercxx> I usually am :)
[03:35:21] *** Joins: jxv (jxv@moz-4CC5F5E9.dsl.irvnca.pacbell.net)
[03:35:31] *** Joins: ross (ross@moz-5EA04060.br.br.cox.net)
[03:36:22] *** Joins: ecr (Mibbit@E940BDD3.FBC7597F.11F8506F.IP)
[03:36:42] <ChrisMorgan> Good point. I think you may be right.
[03:36:48] <ercxx> That never happens.
[03:37:24] <ercxx> I mean it passes all the lws tests when I got rid of them.
[03:37:58] <ChrisMorgan> *TEXT can include text in other encodings through the rules of RFC 2047 (RFC 2616, page 16), but that'll happen in read_quoted_string or such, I suppose.
[03:38:14] <ChrisMorgan> Please go ahead and remove the quoted string states. :-)
[03:38:34] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[03:40:05] <ercxx> Ok
[03:40:48] * ChrisMorgan is looking forward to seeing the end product here
[03:41:40] *** Quits: z0w0 (zack@moz-C877F2F7.lnse2.cha.bigpond.net.au) (Quit: z0w0)
[03:42:48] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[03:43:07] *** Quits: tiffany (kawaii@moz-28A8742A.dhcp.embarqhsd.net) (Ping timeout)
[03:43:57] <ercxx> ChrisMorgan: take a look: https://github.com/eerden/rust-http/tree/removeLWS
[03:44:00] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[03:47:52] <ChrisMorgan> ercxx: I'm wondering whether, rather than yielding SP for SP or HT, we should yield the actual byte that was read. I think HT inside a quoted-string could be significant, for example.
[03:49:08] <ChrisMorgan> consume_optional_lws also still needs to be adjusted to match these new rules (it needs to loop until it gets a non-SP/HT rather than consuming a maximum of one as it does at present)
[03:49:28] <ercxx> I see.
[03:50:52] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[03:51:54] <Sonarpulse> is there any function like filter, except only the first element that matches the predicate is returned, or none?
[03:52:36] <strcat> find
[03:52:47] *** Joins: dbaupp (Thunderbir@BEECE994.D5A1DCF.37681C44.IP)
[03:52:48] <strcat> which is basically just filter(...).next()
[03:52:54] <Sonarpulse> thanks
[03:53:27] <strcat> or skip_while(...).next() ;p
[03:53:39] *** ercxx is now known as ercxx__away
[03:53:42] <ChrisMorgan> ercxx: I don't think your addition of consume_optional_lws() to read_token() makes sense; read_token should only be reading to the end of the token, it should leave what follows to its caller
[03:55:15] <ChrisMorgan> Is there a vector version of the Rust logo available somewhere? I'd like to tweak it precisely for 16x16 display as what I see as the favicon is ugly.
[03:56:01] <dbaupp> rust-www might have one
[03:56:20] <dbaupp> ChrisMorgan: https://github.com/graydon/rust-www/tree/gh-pages/logos
[03:56:29] <dbaupp> https://github.com/graydon/rust-www/blob/gh-pages/logos/rust-logo-blk.svg
[03:56:43] <ChrisMorgan> Good, thanks.
[03:57:15] * ChrisMorgan pulls Inkscape out and begins to tinker
[03:59:33] *** Joins: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net)
[04:00:42] <ercxx__away> ChrisMorgan: that blows up connection_8 because of the extra space after crlf.
[04:01:29] <ChrisMorgan> ercxx__away: that means the comma read method, whatever it is, needs fixing; not read_token.
[04:02:04] <ercxx__away> I'll take a look.
[04:03:14] *** Quits: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net) (Ping timeout)
[04:06:44] *** Quits: dbaupp (Thunderbir@BEECE994.D5A1DCF.37681C44.IP) (Ping timeout)
[04:06:53] *** Quits: vodik (simon@moz-FD4ADBC6.cable.teksavvy.com) (Ping timeout)
[04:07:44] *** Joins: eddyb (eddy@3C6E2DBB.FFB4E060.A5830293.IP)
[04:08:09] *** Joins: vodik (simon@moz-FD4ADBC6.cable.teksavvy.com)
[04:08:36] *** Joins: nejucomo (Adium@moz-434492BB.dsl.static.sonic.net)
[04:09:50] *** Joins: squiddy (squiddy@moz-3A4BC03C.adsl.alicedsl.de)
[04:13:08] *** Joins: z0w0 (zack@moz-C877F2F7.lnse2.cha.bigpond.net.au)
[04:14:16] * pcwalton is envious of how clean the asm for C and Go are
[04:14:29] <pcwalton> of course Go is clean because it punts to slow function calls for everything...
[04:15:05] <pcwalton> I guess the reason Rust asm is "ugly" is bounds checks and failures inserted by the compiler
[04:15:26] <strcat> pcwalton: I'm busy making bounds checks not do a multiplication ;p
[04:15:38] <pcwalton> strcat: changing vecs to be measured in lengths, not bytes?
[04:15:40] <strcat> for slices.... not going to fix actual vectors
[04:15:44] <pcwalton> ah, ok
[04:15:54] <pcwalton> yeah, they really shouldn't be doing a multiply
[04:15:58] <strcat> I would rather just throw out the current implementation of vectors completely
[04:16:21] <pcwalton> for a native rust implementation?
[04:16:38] <pcwalton> I would +1 on that, self-host all the things
[04:16:41] <strcat> pcwalton: well, it does need compiler support due to the issue of not having a way to pass lack of kinds through raw pointers
[04:16:49] <pcwalton> well, you can use lang items
[04:17:04] <strcat> pcwalton: did you see https://github.com/mozilla/rust/issues/8981 ?
[04:17:12] <pcwalton> no I didn't
[04:17:39] <pcwalton> hey at least we didn't screw up as badly as Go did for vector representations
[04:17:52] <pcwalton> (ptr, len, cap) is really silly
[04:17:58] *** Joins: alonlevy (alon@moz-F53E4C49.redhat.com)
[04:18:04] <pcwalton> for slices
[04:18:44] <strcat> I want slices to be either (ptr, len) or (ptr, end_ptr) and vectors to be (ptr, len, cap)
[04:19:02] <pcwalton> that seems ok to me
[04:19:16] <doomlord_> is the difference anything to do with GC in go
[04:19:36] <pcwalton> it's trying to conflate arrays with slices and use slices for everything
[04:19:38] <strcat> (ptr, end_ptr) is tempting because slices/iterators could be the same thing, but I'm not sure if it will optimize well
[04:19:59] <pcwalton> at this point I'm wary of anything other than the bog standard (ptr, len)
[04:20:05] <pcwalton> for bounds checking reasons
[04:20:09] <strcat> yeah I just want to keep it simple for now
[04:20:30] <strcat> pcwalton: it does have to calculate a pointer offset anyway, but I have no real feel for whether that cost would be merged with the check
[04:20:47] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[04:21:14] <strcat> basically the check would calculate the ptr from the length, then compare with the end
[04:21:20] <pcwalton> why can't we use a library type again?
[04:21:20] <strcat> instead of comparing with the len and then calculating the ptr
[04:21:23] <pcwalton> for vectors
[04:21:37] <strcat> pcwalton: https://github.com/thestinger/rust-core/blob/master/core/vec.rs#L19 this is always Send+Freeze
[04:21:44] <strcat> because */*mut are always Send+Freeze
[04:22:20] <strcat> it's an issue for library smart ptrs too
[04:22:30] <pcwalton> ok, yeah, let's just have a #[inherits_kinds]
[04:22:32] <pcwalton> or something
[04:22:52] <pcwalton> I feel like the language would be cleaner if we just nuked ~[T]
[04:23:09] <strcat> I want to at least make it simply sugar for a library type
[04:23:13] <pcwalton> yeah, agreed
[04:23:22] <pcwalton> if &[T] were the only type of vector we could drop the & though
[04:23:30] <pcwalton> so it's just 'region [T], or [T]
[04:23:37] <strcat> slices feel like a primitive data type to me, but not vectors
[04:23:41] <strcat> because there are many ways to do vectors
[04:23:53] <mark_edward> strcat: hey when you put function calls in a tuple, is the ordering guaranteed at all? (example) http://pastebin.com/DX9D31TJ
[04:24:03] *** Quits: squiddy (squiddy@moz-3A4BC03C.adsl.alicedsl.de) (Ping timeout)
[04:24:08] <strcat> mark_edward: left to right
[04:24:20] <mark_edward> okay, thanks!
[04:24:23] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[04:24:23] <strcat> I don't know if we officially guarantee it, but it's what we do
[04:24:36] <pcwalton> we guarantee it
[04:24:50] <pcwalton> basically all layout is defined except for first-class traits and enums
[04:24:52] <SiegeLord> You can implement slices in a few ways too... at some point you just bless one particular implementation and give sugar to it
[04:25:04] <strcat> SiegeLord: true, but slices are a block of memory
[04:25:10] <pcwalton> slices are fairly primitive
[04:25:15] <pcwalton> and the region checker's gotta know about them
[04:25:36] <pcwalton> all "safe-C"'s that I know of (Cyclone most notably) had slices
[04:25:46] <strcat> vectors have an allocation strategy, may or may not do the small vector optimization, etc.
[04:25:49] <pcwalton> Cyclone called them "fat pointers" and I think you write "int *fat" or something
[04:26:01] <strcat> things in a library are just much less pain to replace and refactor
[04:27:02] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[04:27:26] *** Joins: jesse99 (jesse99@moz-8B1E0C5D.hsd1.wa.comcast.net)
[04:28:11] <pcwalton> I feel like everything in the language should map to preferably one or two CPU instructions, and should have very simple semantics
[04:28:22] <pcwalton> this is part of what makes Rust a systems language...
[04:28:35] <pcwalton> we're almost there
[04:28:44] <pcwalton> D and Go definitely don't (D's associative arrays come to mind)
[04:28:51] <pcwalton> and to be fair we don't yet, but I would like to
[04:29:30] <strcat> the remaining issues get more frustrating as the language improves as a whole ;p
[04:29:49] <pcwalton> well, @/@mut are going to go away
[04:30:06] <pcwalton> bounds checks have to stay
[04:30:12] <pcwalton> but that's just how it is
[04:30:22] <strcat> bounds checks are fine, you get to define the lang item for handling it anyway
[04:30:28] <strcat> and you can avoid it
[04:30:54] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[04:31:03] <pcwalton> then ~ for allocation... we've discussed making it "new"
[04:31:46] <pcwalton> either way it's hardwired to a lang item, just because you need a placement new syntax and if you don't default to some default allocator people will get annoyed
[04:31:56] <pcwalton> but new(GC), new(MyArena), etc
[04:32:00] <pcwalton> anything else?
[04:32:57] <pnkfelix> pcwalton: we probably should work out the placement new story at some point soon; I'm a little worried that people are making guesses as to what it will look like and then get upset when their guesses don't seem feasible.
[04:33:04] <pcwalton> sure
[04:33:20] <pnkfelix> pcwalton: (or rather, they're making guesses as to what "GC<T>::new" is going to look like)
[04:33:32] <strcat> afaik the only current huge issues for custom smart pointers are the kind inheritance one and the lack of a way to overload dereferencing
[04:34:11] <strcat> and the latter is just syntax ;p
[04:34:17] <pcwalton> I have some sort of proposal in my head, which is reserve "new", make it "new(GC)" and have the GC function have signature fn GC<T>() -> GC<T>
[04:34:34] * strcat forgot to stage0-gate this stuff
[04:34:39] <pcwalton> err, hmm
[04:34:41] <strcat> segfaulting stage1 compiler \o/
[04:34:51] <pcwalton> fn GC<T>() -> (GC<T>, *T) maybe
[04:35:08] <pcwalton> the first element of the tuple being the return value and the second element being where the compiler writes the thingy into
[04:35:49] <pcwalton> I was thinking about the consequences of using "new" given that we use it for constructors and I realized that we actually have a second idiom for constructors we use from time to time
[04:35:52] <pcwalton> which is "from_foo"
[04:36:04] <pcwalton> let my_int = MyInt::from_int(3);
[04:36:14] <pnkfelix> str::from_char, etc.  sure
[04:36:18] <pcwalton> we could just bless that as the naming convention for constructors
[04:37:09] <sfuerst> let my_int = MyInt::from_new(); ?
[04:37:27] <pcwalton> for "defaults" just call it "default" or something, I dunno
[04:37:29] <pcwalton> or "make"
[04:37:33] <pcwalton> "blank"
[04:37:38] <pcwalton> there's gotta be something decent
[04:37:47] <pnkfelix> there was a conversation earlier in the channel where people were asking how the current pattern of doing @Foo::new() would be translated.  I guess the question is: Is it still going to be easy to write a single value constructor and be able to use it for all the different kinds of allocation.
[04:37:55] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Client exited)
[04:37:55] <pcwalton> oh yes, definitely.
[04:38:00] <pcwalton> it'll work exactly the same way
[04:38:01] <pnkfelix> Obviously if you're willing to suck up an intermediate copy, then its trivial
[04:38:01] <Sonarpulse> (idens...) = expr mutates idens right?
[04:38:16] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[04:38:16] <pcwalton> new(GC) Foo::create()
[04:38:38] <pcwalton> if GC has the signature above then the compiler will know which retptr to pass in to Foo::create
[04:38:43] *** Quits: ktt3ja (Mibbit@moz-6B6EE8C0.hsd1.va.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[04:38:47] <pcwalton> and it'll Just Work
[04:38:49] <pcwalton> as today
[04:39:35] *** Joins: jeffreybaird (jeffreybai@moz-ED3EF543.static.twtelecom.net)
[04:39:56] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Ping timeout)
[04:40:43] <pnkfelix> hmm, I'm going to have to look more closely at how it works today.  I would have thought that you need to play games with the calling convention to make this work with arbitrary fn's, of which Foo::create() is one...
[04:40:58] <pcwalton> that's what the placement new syntax is for
[04:41:04] <pcwalton> it causes the compiler to emit the magic needed to make that work
[04:41:07] *** Joins: xAndy (xandy@moz-1C332306.unity-media.net)
[04:41:33] <strcat> pnkfelix: today, if you do ~foo() it will do the allocation first and then treat that as the return location
[04:41:35] *** Quits: jeffreybaird (jeffreybai@moz-ED3EF543.static.twtelecom.net) (Quit: jeffreybaird)
[04:41:42] <pnkfelix> without having to compile a specialized version of Foo::create?  Or does it get it via return-value-optimization ?
[04:41:47] <strcat> so with a large value being returned, LLVM ends up passing the ~ as the out ptr
[04:41:55] <pcwalton> it uses return value optimization
[04:42:04] <pcwalton> we emit a retptr and LLVM uses that
[04:42:05] <strcat> pnkfelix: large things are returned by out pointer
[04:42:15] <pcwalton> LLVM has a special attribute you tag retptrs with
[04:42:31] <pnkfelix> does that work when you compose functions, e.g. ~foo(bar()) ?
[04:42:45] <pnkfelix> (this was what I was concerned about earlier today)
[04:42:56] <strcat> pnkfelix: I think it will still evaluate the ~ first
[04:43:02] <strcat> it treats the RHS as an expression
[04:43:06] <strcat> it doesn't care how much stuff you do there
[04:43:12] <pnkfelix> k
[04:43:22] <pnkfelix> okay then its just placement new, okay.
[04:43:52] *** Quits: a__ (a__@moz-4CC03B10.nycmny.fios.verizon.net) (Ping timeout)
[04:45:08] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[04:45:48] *** Joins: a__ (a__@moz-4CC03B10.nycmny.fios.verizon.net)
[04:48:35] <Sonarpulse> I ask about (...) = ... because I am getting an error that a in (a, b) = ... is not initialized, which wouldn't make sense if a only the lvalue of a is used.
[04:49:41] <pnkfelix> i'm sort of torn about what to do with the placement new interface.  At times it seemed elegant that C++ had a strict separation between the allocation code for the class and the constructor code itself.  But it also made it painful to implement some protocols where I wanted to pass information, *other* than the address of the allocated memory, from the placement new invocation over through into the ctor.
[04:50:14] *** Quits: Jesin (Jessin_@moz-5654D37.washdc.fios.verizon.net) (Quit: Leaving)
[04:50:16] <sfackler> Sonarpulse: could you put a snippet of code that shows the problem on gist or pastebin or something like that?
[04:50:52] <Sonarpulse> sure
[04:52:44] <Sonarpulse> http://pastebin.com/ddXwm97A
[04:52:56] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[04:53:17] <Sonarpulse> (index, partial) = split_hash(partial);
[04:53:42] <Sonarpulse> <Sonarpulse> (index, partial) = split_hash(partial);  [00:53]
[04:53:42] <Sonarpulse> ERC> error: use of possibly uninitialized variable: `index`
[04:53:57] <Sonarpulse> sorry about double paste
[04:56:37] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[04:58:07] <sfackler> that actually seems like it may be a bug
[04:58:32] <sfackler> initializing index to 0 or whatever fixes it
[04:59:13] <sfackler> what happened to rusti?
[04:59:31] <strcat> rusti: 2
[04:59:31] -rusti- 2
[04:59:50] <strcat> or do you mean the broken cli util?
[04:59:54] <sfackler> huh, I couldn't message it
[05:00:00] <Sonarpulse> wierd
[05:00:02] <sfackler> anyway, this seems like a bug:
[05:00:04] <olsonjeffery> rip rusti ;_;
[05:00:08] <olsonjeffery> rip rust tool ;_;
[05:00:15] <sfackler> rusti: let a; let b; (a, b) = (1, 2);
[05:00:19] <ChrisMorgan> RFC: 16x16 http://chrismorgan.info/temp/rust-favicon.svg (known to render decently in Firefox, Chromium not so well), compare with http://www.rust-lang.org/favicon.ico
[05:00:19] -rusti- pastebinned 8 lines of output: http://ix.io/8u1
[05:00:21] *** Quits: jxv (jxv@moz-4CC5F5E9.dsl.irvnca.pacbell.net) (Quit: Leaving)
[05:00:22] <strcat>                         (index, partial) = split_hash(partial);
[05:00:25] <strcat> that's not supposed to compile
[05:00:32] <strcat> I don't know what it's being interpreted as
[05:00:42] <strcat> (doing that with lvalues isn't implemented)
[05:01:04] <sfackler> oh, you can only destructure into a let?
[05:01:23] <mark_edward> how can i capture a mutable barrier in an owned closure?
[05:01:29] * ChrisMorgan tried rotating the gear clockwise so that the teeth would fall on pixels rather than being symmetrical, but it made the whole thing look like a saw blade with curved teeth instead
[05:01:31] <strcat> sfackler: well, into any place where patterns as used
[05:01:36] <strcat> function parameters, let, match patterns
[05:02:22] *** Quits: pnkfelix (pnkfelix@moz-813314A4.hsd1.ma.comcast.net) (Quit: Leaving.)
[05:02:37] <Sonarpulse> thanks sfackler and strcat.
[05:03:01] *** Joins: mib_tvou8i (Mibbit@moz-C3696E0E.hsd1.nm.comcast.net)
[05:03:11] <strcat>   %14 = mul i64 %13, 8
[05:03:13] <strcat>   %15 = udiv i64 %14, 8
[05:03:16] <strcat> hehe
[05:03:29] * strcat needs to do it in a way that's not so bad
[05:04:12] *** Joins: alisdair (textual@28441AAB.AC6E1995.F0AE27BD.IP)
[05:04:32] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[05:04:39] <sfackler> that doesn't optimize down to << >>?
[05:04:58] <strcat> it optimizes down to a no-op
[05:05:01] <strcat> but it's not good codegen
[05:05:22] *** Joins: jeffb (jeff@moz-D13B6004.hsd1.ca.comcast.net)
[05:05:23] <mark_edward> `error: mutable variables cannot be implicitly captured` is there a way to explicitly capture them? what happened to the move keyword?
[05:05:28] <strcat> I'm just working within the existing weird expectations atm
[05:05:37] <strcat> I'll change those expectations when this self-hosts ;p
[05:06:10] <strcat> mark_edward: moving is the default
[05:06:32] <mark_edward> but, why can't i capture something that's mutable?
[05:06:34] <sfackler> wow, that's a bad error message: error: found value name used as a type: DefVariant(syntax::ast::DefId{crate: 0, node: 8291}, syntax::ast::DefId{crate: 0, node: 8361}, true)
[05:06:44] <strcat> mark_edward: dunno if there's a good justification
[05:06:50] <strcat> to avoid confusion?
[05:07:47] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Quit: Leaving)
[05:07:56] <Amaranth> Can you capture it in a fn or not at all? I could understand ~fn not working
[05:08:16] *** Quits: jeffdb (jeff@moz-D13B6004.hsd1.ca.comcast.net) (Quit: Lost terminal)
[05:08:28] *** jeffb is now known as jeffdb
[05:08:56] *** Quits: mib_tvou8i (Mibbit@moz-C3696E0E.hsd1.nm.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[05:08:57] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[05:09:37] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[05:13:05] *** Joins: dew (Instantbir@moz-8EDFD40B.static.stls.mo.charter.com)
[05:13:17] <mark_edward> Amaranth: not sure, i'll check
[05:14:24] *** Quits: dew1 (Instantbir@moz-8EDFD40B.static.stls.mo.charter.com) (Ping timeout)
[05:17:47] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[05:18:39] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Quit: Konversation terminated!)
[05:19:28] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[05:21:10] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[05:21:56] * strcat broke auto-slicing
[05:22:00] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[05:22:08] *** Joins: [squiddy] (squiddy@moz-EE55A6A1.dip.tu-dresden.de)
[05:22:43] *** Quits: pcwalton (pcwalton@moz-B51927E9.hsd1.ca.comcast.net) (Quit: .)
[05:26:23] *** Quits: alonlevy (alon@moz-F53E4C49.redhat.com) (Ping timeout)
[05:27:18] *** Quits: fran_ (fran@moz-776B0468.telecom.net.ar) (Ping timeout)
[05:27:54] *** Quits: ecr (Mibbit@E940BDD3.FBC7597F.11F8506F.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[05:32:25] *** Joins: fran_ (fran@moz-80DE085E.telecom.net.ar)
[05:32:29] *** Quits: aatch_ (aatch@moz-2BB0AC01.cable.telstraclear.net) (Quit: Leaving)
[05:37:31] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[05:37:55] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[05:40:08] *** kimundi is now known as zz_kimundi
[05:41:02] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[05:41:37] *** Quits: ross (ross@moz-5EA04060.br.br.cox.net) (Quit: )
[05:44:32] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[05:52:39] *** Quits: thewonderidiot (mike@moz-5506A033.hsd1.ca.comcast.net) (Connection reset by peer)
[05:58:35] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[06:00:28] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[06:02:32] *** Joins: alonlevy (alon@AB84380C.C7935774.F9582E85.IP)
[06:03:11] *** Joins: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net)
[06:06:53] *** Quits: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net) (Ping timeout)
[06:07:19] <ChrisMorgan> RFC: http://chrismorgan.info/temp/rust-favicon.png (Rust logo tweaked for 16x16 display)
[06:10:38] <FreeFull> Looks pretty good to me
[06:15:08] <SiegeLord> The R is a bit too tall... but I guess that's not something anybody would notice
[06:16:43] *** Joins: Ferreus (ferreus@moz-2B3D1F31.dip0.t-ipconnect.de)
[06:18:15] <ChrisMorgan> SiegeLord: I had it a pixel shorter in an earlier revision, http://chrismorgan.info/temp/rust-favicon.svg
[06:18:26] <ChrisMorgan> Still not sure about which of the two is better
[06:18:54] <ercxx__away>             Some(b) if b == SP || b == HT=> {
[06:18:55] <ercxx__away>                 self.consume_optional_lws();
[06:18:57] <ercxx__away>             },
[06:18:59] <ercxx__away>             Some(b) if b == SP || b == HT=> {
[06:19:01] <ercxx__away>                 self.consume_optional_lws();
[06:19:03] <ercxx__away>             },
[06:19:21] *** Quits: fran_ (fran@moz-80DE085E.telecom.net.ar) (Ping timeout)
[06:20:27] <ercxx__away> I didn't just do that
[06:20:33] <ercxx__away> disregard.
[06:20:39] <ChrisMorgan> Whew :P
[06:20:39] *** ercxx__away is now known as ercxx
[06:20:43] *** Joins: bheylin (brianheyli@moz-8255E94E.adsl.online.nl)
[06:21:06] <jeffdb> rusti: [0, ..1000000]
[06:21:07] -rusti- application terminated abnormally with signal 11 (Segmentation fault)
[06:21:09] <jeffdb> is this a bug? it looks like a bug:
[06:21:12] <ercxx> I love and hate the middle button copy/paste
[06:21:20] * ChrisMorgan too
[06:21:43] <jeffdb> ^
[06:21:44] <jason_> ChrisMorgan: probably not what you want to here, but it looks too cramped, like you just scaled down the full sized logo instead of making one for 16x16
[06:22:07] <ChrisMorgan> SiegeLord: I've shortened the R again in the PNG link
[06:22:28] <ChrisMorgan> jason_: what direction would you head in?
[06:22:34] <ercxx> 16x16 gear is tough.
[06:22:54] *** Quits: nejucomo (Adium@moz-434492BB.dsl.static.sonic.net) (Quit: Leaving.)
[06:23:22] <alonlevy> hi, this example http://ur1.ca/fw5ko using extra::fileinput fails to compile - the first part with the named function works, but the colsure appears to have a ->() type, can I override it to say it is ->bool? 
[06:23:24] <ChrisMorgan> jason_: I reduced the number of teeth from 32 to 16, tried and gave up on including the five bolt spots, altered the dimensions quite significantly all up. The letter R is the only part that is directly taken from the full size  logo.
[06:23:29] <ercxx> I would say just make it a ring, that's what it looks like that small anyway.
[06:23:30] *** Quits: Sonarpulse (user@moz-424CB7EB.cs.brown.edu) (Quit: ERC Version 5.3 (IRC client for Emacs))
[06:23:53] <jason_> ChrisMorgan: i'd try to make it sharper. less detail
[06:24:10] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Client exited)
[06:24:20] <jason_> i'm looking at the svg, is there something more updated?
[06:24:30] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[06:24:37] <ChrisMorgan> The PNG is the latest.
[06:24:50] <ChrisMorgan> SVG is also now up to date.
[06:25:08] *** Joins: fran_ (fran@moz-C059A907.telecom.net.ar)
[06:25:42] *** Quits: Kxepal (Miranda@moz-ABE04B8C.pppoe.mtu-net.ru) (Ping timeout)
[06:26:15] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Ping timeout)
[06:26:25] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[06:26:40] <ChrisMorgan> jason_: I tried sharper with rotation of the gear (so as not to be symmetrical on the horizontal axis which is not a good thing for an even number of pixels), but it didn't produce a better result; it produced something that looked like a saw blade with sharp curved teeth.
[06:27:12] *** Quits: bheylin (brianheyli@moz-8255E94E.adsl.online.nl) (Quit: bheylin)
[06:27:25] <ChrisMorgan> ercxx: I think having it as a gear rather than just a ring is valuable
[06:28:25] *** Joins: Kxepal (Miranda@moz-10B83CD2.pppoe.mtu-net.ru)
[06:28:31] <ChrisMorgan> jason_: fewer teeth would be easier to get a good effect on, but then they start necessarily taking up more space, leaving less for the R. Still, possibly reducing it would be a good plan.
[06:29:06] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[06:29:23] *** Quits: FreeFull (freefull@31BCA4E6.5B0E29BE.159B5998.IP) (Quit: )
[06:29:54] <ChrisMorgan> jeffdb: [0, ..1000000] would require an allocation of 8GB
[06:30:07] *** Joins: eddyb9 (eddy@8CC02A39.8E4D8E22.4A6B528C.IP)
[06:30:18] <ChrisMorgan> Hang on, I can't count. 8MB :-/
[06:30:32] <ercxx> ChrisMorgan: I like the gear too but not that many pixels in 16x16
[06:30:45] <jeffdb> ChrisMorgan: yeah…I was recounting in my head for a sec…
[06:31:19] <jeffdb> well on OSX it's giving me a bus error and rusti gives me a seg fault
[06:31:29] <sfackler> you're falling of the end of the stack
[06:31:35] *** Quits: ab (alex@BC9D99CC.37C1012D.FE617B51.IP) (Ping timeout)
[06:31:43] <ChrisMorgan> Oh yeah, fixed 2MB stack size at present.
[06:31:55] <jeffdb> can I change the stack size?
[06:32:04] <jeffdb> or should i just allocate it to heap?
[06:32:17] <sfackler> heap allocate it
[06:32:30] <jeffdb> thanks
[06:33:57] <ChrisMorgan> ercxx: I reckon the teeth come up fairly clearly still. I could also try a different tooth count (e.g. 12).
[06:35:05] <ercxx> Less teeth probably better. The gears Inkscape makes have round teeth that's kinda annoying.
[06:36:27] <ChrisMorgan> ercxx: yes, I took the lazy path to making the teeth this time. I've made tiny gear icons without it, too.
[06:36:35] *** Quits: AlisonW (AlisonW@moz-7CEB14F7.hari.cable.virginmedia.com) (Ping timeout)
[06:36:35] *** Quits: alonlevy (alon@AB84380C.C7935774.F9582E85.IP) (Ping timeout)
[06:37:09] *** Joins: AlisonW (AlisonW@moz-7CEB14F7.hari.cable.virginmedia.com)
[06:40:13] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[06:40:19] <jason_> ChrisMorgan: maybe try 8 teeth
[06:40:39] <ChrisMorgan> Sounds likely to be too few to me, but I'll try it a bit later.
[06:45:36] *** Joins: bholley (anonymous@moz-D5EB36E2.rev.numericable.fr)
[06:48:18] *** Joins: oberstet (quassel@moz-8165CA9A.dynamic.mnet-online.de)
[06:49:03] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[06:53:23] *** Quits: KindOne (KindOne@moz-B764F4D3.dynamic.ip.windstream.net) (Ping timeout)
[06:54:13] *** Joins: dbaupp (Thunderbir@moz-54ADD9F4.lns20.syd6.internode.on.net)
[06:55:16] *** Quits: dbaupp (Thunderbir@moz-54ADD9F4.lns20.syd6.internode.on.net) (Quit: dbaupp)
[06:55:23] *** Joins: fabiand (fabiand@moz-DDB9B420.adsl.alicedsl.de)
[06:55:48] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[06:56:26] *** Quits: Amaranth (travis@moz-F81BB56A.cpe.cableone.net) (Connection reset by peer)
[06:57:01] *** Quits: eddyb9 (eddy@8CC02A39.8E4D8E22.4A6B528C.IP) (Ping timeout)
[06:57:08] *** Quits: fabiand (fabiand@moz-DDB9B420.adsl.alicedsl.de) (Ping timeout)
[06:57:26] *** Quits: [squiddy] (squiddy@moz-EE55A6A1.dip.tu-dresden.de) (Ping timeout)
[06:58:12] *** Joins: dbaupp (Thunderbir@moz-54ADD9F4.lns20.syd6.internode.on.net)
[06:58:29] *** Joins: Amaranth (travis@moz-F81BB56A.cpe.cableone.net)
[06:59:51] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[07:00:46] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[07:00:57] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Ping timeout)
[07:05:06] *** Joins: [squiddy] (squiddy@moz-EE55A6A1.dip.tu-dresden.de)
[07:05:44] *** Joins: KindOne (KindOne@moz-82EEF0C7.dynamic.ip.windstream.net)
[07:06:04] *** Joins: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net)
[07:07:55] *** Quits: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net) (Ping timeout)
[07:07:56] *** Joins: martndemus (martndemus@moz-E30F5776.adsl.xs4all.nl)
[07:08:48] *** Joins: alonlevy (alon@moz-697DD27F.bb.netvision.net.il)
[07:09:40] *** Quits: tautologico (lymph@7A53DAF8.92451A23.6EB699AE.IP) (Quit: tautologico)
[07:14:54] *** Quits: tikue_ (tikue_star@18C1ABA5.D038900B.689607DE.IP) (Ping timeout)
[07:15:30] *** Joins: fabiand (fabiand@moz-DDB9B420.adsl.alicedsl.de)
[07:21:06] <ercxx> ChrisMorgan: ping
[07:22:06] *** pmoore|away is now known as pmoore
[07:22:45] *** Quits: voxpopuli (fanservice@moz-FE161659.wv.cc.cmu.edu) (Ping timeout)
[07:23:44] *** Quits: jeaye (Jeaye@moz-34FEF2BB.hsd1.ca.comcast.net) (Quit: zzz)
[07:24:35] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Input/output error)
[07:25:53] *** Quits: fran_ (fran@moz-C059A907.telecom.net.ar) (Ping timeout)
[07:26:19] *** Quits: jeffdb (jeff@moz-D13B6004.hsd1.ca.comcast.net) (Quit: jeffdb)
[07:26:47] *** Joins: DeTeam (DeTeam@92C799C.31715274.F5F3AF2.IP)
[07:29:37] *** Joins: fran_ (fran@moz-4891D8EA.telecom.net.ar)
[07:32:17] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[07:40:47] <ChrisMorgan> ercxx: pong
[07:42:32] <ercxx> I have a question about the failing test, it's also kinda about rust. Do you have a sec?
[07:42:37] *** Joins: barosl (barosl@3DE683B6.E551553C.7544CABF.IP)
[07:43:02] <ChrisMorgan> I think so.
[07:43:31] <ercxx> Ok, so test_connection_8
[07:43:47] <ChrisMorgan> Yep
[07:44:05] <ercxx> I'm trying to understand the path it takes.
[07:44:29] <ercxx> Couldn't make sense how it gets a split token.
[07:44:56] <ercxx> read_token() is called only once
[07:45:24] *** flaper87|afk is now known as flaper87
[07:45:37] <ChrisMorgan> The output type is ~[Connection] rather than Connection, so it's actually using CommaListHeaderConvertible.
[07:45:56] <ChrisMorgan> See the `impl<T: CommaListHeaderConvertible> HeaderConvertible for ~[T]`
[07:46:19] *** Quits: Voomer (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net) (Ping timeout)
[07:47:18] <ercxx> So it's me not grasping the traits very well.
[07:47:44] *** Quits: fyolnish_ (fyolnish@moz-BE2BAE5B.miinet.jp) (Client exited)
[07:47:51] *** Joins: fyolnish (fyolnish@moz-BE2BAE5B.miinet.jp)
[07:48:26] <ChrisMorgan> It's not the most obvious bit of code, really; that's one of the unfortunate side-effects of the traits system: it can make such bits of code difficult to think about until you know what's happening.
[07:49:03] <ercxx> Yeah it hurt my brain. Also how does HeaderConvertible::from_stream(&mut iter) know which implementation to call?
[07:49:21] <ercxx> There's no function_name<type>::() kinda syntax there?
[07:49:25] <ChrisMorgan> It's consume_optional_lws that needs fixing to make test 8 work, as the " \r\n " makes for *two* spaces.
[07:51:04] <ChrisMorgan> The type is inferred: from_stream() returns Option<T1>, and if it's Some(h: T1), it does result.push(h); result is inferred on account of its being the return value, which is of type ~[T2]. Thus, T1 == T2.
[07:51:58] <ChrisMorgan> Thus, in the implementation of HeaderConvertible::from_stream for ~[T], HeaderConvertible::from_stream is being called for the type T.
[07:53:30] <ercxx> Thank you.
[07:54:08] *** zz_kimundi is now known as kimundi
[07:54:11] <ercxx> I'll read this after some rest.
[07:55:03] <ChrisMorgan> So you see that the way a comma-separated header is handled is with the output type ~[T], and parsing is more-or-less 'let T parse a header, then loop { look for *LWS "," *LWS, if it's there, let T parse a header }'.
[07:56:32] * dbaupp loves how proper type inference makes type information seem to flow back in time
[07:56:34] <ChrisMorgan> This removes the burden of handling the commas and so forth for each and every header type that supports it.
[07:56:57] <ChrisMorgan> dbaupp: yep, it's good, but as you can see in cases like this it can make thinking conceptually about a piece of code hard.
[07:57:41] <ChrisMorgan> Incidentally, how would one now explicitly specify the type? I vaguely recall discussion of syntax like `HeaderConvertible::<for T>::from_stream`?
[07:57:44] <dbaupp> yeah
[07:57:59] <dbaupp> right now it's impossible
[07:58:34] <dbaupp> but that's the current leading proposal for the final syntax, as far as I know.
[07:58:46] <ercxx> rusti std::sys::size_of::<int>()
[07:58:53] <dbaupp> rusti: std::sys::size_of::<int>()
[07:58:54] <ercxx> rusti: std::sys::size_of::<int>()
[07:58:55] -rusti- 8u
[07:58:55] -rusti- 8u
[07:58:59] <ChrisMorgan> I thought so. It would have been covered in TWiR if it had been implemented.
[07:59:29] <ChrisMorgan> ercxx: that's for function generics, whereas the other is for calling trait methods for a certain implementing type.
[07:59:32] <dbaupp> (that's just a function, not a trait, so the syntax will never be the ::<for X>:: style one)
[07:59:52] <ercxx> My brain hurts now :)
[08:01:08] <dbaupp> haha :) (the ::<for X>:: syntax is *just* for specifying the `Self` type of the trait, that is the X in `impl Trait for X { ... }`)
[08:02:15] *** Joins: voxpopuli (fanservice@moz-CEF3689A.hsd1.pa.comcast.net)
[08:02:57] <dbaupp> https://github.com/mozilla/rust/issues/9864 comments?
[08:03:04] <ercxx> The amount of coffee I used to understand that is scary.
[08:03:42] <ChrisMorgan> ercxx: anyway, try rewriting consume_optional_lws around a loop; that should fix this case.
[08:04:19] <ercxx> ChrisMorgan: Ok. I went through the comments on the pull request. Most are done.
[08:04:29] *** jld|mv is now known as jld
[08:04:47] <ChrisMorgan> dbaupp: this sort of thing is why I don't like Markdown.
[08:05:08] <ChrisMorgan> dbaupp: any idea what the prevailing extension techniques are in discussions of Sundown, etc.?
[08:05:20] <ChrisMorgan> Stack Overflow uses things like [tag:foo].
[08:05:53] <dbaupp> ChrisMorgan: no idea
[08:05:54] *** Joins: nkoep (nik@moz-F875B28B.pool.mediaways.net)
[08:06:34] *** Joins: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net)
[08:06:34] <dbaupp> I'm not attached to anything in particular wrt to the surrounding documentation; I'm only interested in us having the ability to link like this at all.
[08:06:54] <dbaupp> and preferably a nice/short syntax so that it's not a burden
[08:07:22] <ChrisMorgan> Notable also is that Sphinx is not *just* :py:mod:`foo`. You'd be setting the default domain to py (or in our case, Rust), so it'd end up just :mod:`foo`, :trait:`foo::Bar`, etc. Plus it has the ability to control what is displayed; following the normal Sphinx conventions, :trait:`foo::Bar` would have the link text "foo::Bar", while :trait:`!foo::Bar` would be just "Bar".
[08:07:57] <dbaupp> can you comment to that effect? :)
[08:07:59] *** Quits: fran_ (fran@moz-4891D8EA.telecom.net.ar) (Ping timeout)
[08:08:03] *** Quits: KindOne (KindOne@moz-82EEF0C7.dynamic.ip.windstream.net) (Ping timeout)
[08:08:18] *** Quits: shrughes (shrughes@moz-23F7C89.dsl.static.sonic.net) (Ping timeout)
[08:08:24] * ChrisMorgan would far prefer to see Rust use reStructuredText and Sphinx conventions. Auto-generated docs are only a small part of the way; Sphinx allows *so* much more.
[08:09:06] <ChrisMorgan> Unfortunately, I really don't have time for a few weeks to finish off the Sphinx domain that I (for a very loose definition of "started") started.
[08:09:34] <dbaupp> Fork the compiler into "RurST", convert rustdoc and the stdlib documentation to handle rST... easy.
[08:10:16] *** Joins: fran_ (fran@moz-EF96F987.telecom.net.ar)
[08:10:44] <ChrisMorgan> dbaupp: how did you get code-formatted :py:mod:`foo`?
[08:10:58] *** Quits: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net) (Ping timeout)
[08:11:25] <ChrisMorgan> The cleanest I can find is: <code>:py:mod:\`foo\`</code>
[08:11:46] *** Joins: KindOne (KindOne@moz-82EEF0C7.dynamic.ip.windstream.net)
[08:11:53] <dbaupp> ``...``
[08:12:14] <dbaupp> well, ``:py:mod:`foo` ``
[08:12:54] * ChrisMorgan was allergic to the extra space.
[08:13:49] * dbaupp doesn't like it either
[08:13:50] * ChrisMorgan really hates the way Markdown simply allows arbitrary HTML, acknowledging the language to be insufficient [and incidentally horribly insecure by default]
[08:14:46] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[08:15:58] <ChrisMorgan> Actually in Sphinx it's :trait:`~foo::Bar` that would have the link text Bar. :trait:`!foo::Bar` would make it styled like a trait link but not be a link.
[08:19:51] <ChrisMorgan> That, of course, leaves open the possibility of confusion if it becomes possible to have hyperlinks to a trait object..!
[08:20:13] *** Joins: james_c (Mibbit@1F25E55D.3B531343.696FDC79.IP)
[08:21:14] *** Quits: voxpopuli (fanservice@moz-CEF3689A.hsd1.pa.comcast.net) (Ping timeout)
[08:21:31] <dbaupp> ChrisMorgan: https://github.com/mozilla/servo/wiki/Meeting-2013-10-14#interns-for-next-year "I've been thinking about how we can get support the offices better. Can we do southern hemisphere interns to balance it out? I don't know any LatAm. We do have Australians (bjz, rust-http author, etc.). " just incidentally :)
[08:22:54] *** Joins: MrOrdinaire (Mibbit@1A659656.A607747.FD383126.IP)
[08:22:55] <ChrisMorgan> dbaupp: brson was discussing it with me; the fact that I'm finishing off Uni this year is almost certainly a disqualifying factor.
[08:23:02] <dbaupp> oh ok :)
[08:23:10] <MrOrdinaire> hi, could anyone tell me where `print!` is defined?
[08:23:22] <dbaupp> I imagine linking to a trait object directly is not relevant, fwiw.
[08:23:36] <dbaupp> MrOrdinaire: syntax/ext/expand.rs, grep for macro_rules! print
[08:24:35] <MrOrdinaire> dbaupp: thanks
[08:30:49] <ChrisMorgan> dbaupp: https://github.com/mozilla/rust/issues/9864#issuecomment-26317257
[08:32:12] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[08:32:15] *** Joins: CarpNet (ac@moz-FD24B77.sohonet.co.uk)
[08:33:57] *** Joins: charmander (Mibbit@F7ADBA9.6274B58B.50E99975.IP)
[08:34:03] <charmander> hi
[08:34:55] <ChrisMorgan> hi, charmander!
[08:34:59] <charmander> Rust will be primarily aot?
[08:35:29] <ChrisMorgan> "aot"?
[08:35:39] <charmander> Ahead of Time Compiled?
[08:36:20] <ChrisMorgan> Rust is an entirely compiled language.
[08:36:47] <charmander> Looking at its systems programming and High erformance Applications future... It should be primarily AOT. RIght?
[08:37:04] <ChrisMorgan> Correct.
[08:37:10] <charmander> Thanks.
[08:37:36] <charmander> Im reading the source of kiss3d. It's nice learning experiance.
[08:38:38] *** Quits: charmander (Mibbit@F7ADBA9.6274B58B.50E99975.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[08:40:21] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[08:45:14] <ercxx> ChrisMorgan: I just pushed a commit with changes to consume_optional_lws. All tests are ok.
[08:45:44] <james_c> Does someone have time to answer a dumb question?
[08:45:59] *** Joins: arodier74 (Thunderbir@moz-25EB015.in-addr.btopenworld.com)
[08:46:09] <ercxx> I'll try but I'm really dumb :) 
[08:46:22] <james_c> Can't be dumber than me.  :-)
[08:46:40] <ercxx> Never underestimate your opponent.
[08:46:52] *** Quits: [squiddy] (squiddy@moz-EE55A6A1.dip.tu-dresden.de) (Ping timeout)
[08:47:13] <ercxx> joking aside I'm pretty new but ask away, someone will answer.
[08:47:34] <james_c> Okay...  I'm trying to compile Rust on a computer that doesn't have very much memory...
[08:48:03] <james_c> And it says:  task <unnamed> failed at 'failure in fork: Cannot allocate memory', /home/rustbuild/src/rust-buildbot/slave/snap3-linux/build/src/libstd/run.rs:672
[08:48:16] <james_c> And after that it says:
[08:48:24] <james_c> error: internal compiler error: unexpected failure
[08:48:31] <james_c> note: the compiler hit an unexpected failure path. this is a bug
[08:48:36] <james_c> note: try running with RUST_LOG=rustc=1 to get further details and report the results to github.com/mozilla/rust/issues
[08:48:55] <james_c> But it's not really a bug, is it?  Just not enough memory, right?
[08:49:24] <ercxx> my uneducated guess: yes.
[08:49:37] <ercxx> how much ram do you have?
[08:50:18] <ercxx> and can't you find a package for your system?
[08:50:57] *** Quits: ercxx (ercan@moz-7CFF3469.dyn.optonline.net) (Quit: WeeChat 0.4.2)
[08:51:05] <james_c> Just 256Mb, I think.  Are there prebuilt packages for Linux?
[08:53:15] *** Joins: maik (maik@moz-30A5AB81.dip0.t-ipconnect.de)
[08:53:30] *** Joins: skade (skade@30BBD5E6.505237C9.CAE22B62.IP)
[08:56:07] *** Quits: fran_ (fran@moz-EF96F987.telecom.net.ar) (Ping timeout)
[08:58:48] *** Quits: devbug (quassel@23AC5F12.9D950176.3655BBF5.IP) (Connection reset by peer)
[08:59:41] *** Joins: fran_ (fran@moz-14A4D318.telecom.net.ar)
[09:05:56] *** Joins: nsf (nsf@moz-EEF3238A.convex.ru)
[09:06:35] *** Joins: ofeldt- (ofeldt@moz-E7A7B54A.dip0.t-ipconnect.de)
[09:07:34] *** Quits: ofeldt (ofeldt@moz-5823D589.dip0.t-ipconnect.de) (Ping timeout)
[09:07:38] <CarpNet> if you're using Ubuntu, you can obtain nightly builds here https://launchpad.net/~hansjorg/+archive/rust
[09:09:35] *** Joins: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net)
[09:11:30] *** Quits: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net) (Ping timeout)
[09:11:43] *** Quits: maik (maik@moz-30A5AB81.dip0.t-ipconnect.de) (Ping timeout)
[09:14:28] <james_c> Hello, sorry, left the computer for a bit.  I'm using Debian, so I guess it might be worth a shot?
[09:14:35] *** Joins: shrughes (shrughes@moz-C34BE8E5.hsd1.ca.comcast.net)
[09:15:28] *** Joins: eddyb9 (eddy@9C423EDB.600764B.4A6B528C.IP)
[09:16:26] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[09:18:13] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[09:19:57] *** Quits: alonlevy (alon@moz-697DD27F.bb.netvision.net.il) (Ping timeout)
[09:21:39] <nielsle> AFAICS you need aroun 1400Mib to compile rust. http://huonw.github.io/isrustfastyet/mem/
[09:22:13] <james_c> Cool, thanks.
[09:28:58] *** Quits: papalazarou (papalazaro@moz-BE1C9F3F.lightspeed.frokca.sbcglobal.net) (Ping timeout)
[09:29:45] *** Joins: qrpth (andreas@moz-9C921D25.ut.ee)
[09:31:22] *** ksf__ is now known as ksf
[09:31:25] *** Quits: acrichto (acrichto@moz-69F2E428.ugrad.cs.cmu.edu) (Ping timeout)
[09:31:34] *** Quits: rntz (rntz@moz-C76A8D96.sp.cs.cmu.edu) (Ping timeout)
[09:31:53] <ksf> is there a particular reason Result has no ToStr trait? ...I just want some debug output.
[09:31:57] *** Quits: rpearl (rpearl@moz-2B41ACB5.andrew.cmu.edu) (Ping timeout)
[09:31:57] *** Quits: bblum (bblum@moz-2B41ACB5.andrew.cmu.edu) (Ping timeout)
[09:31:57] *** Quits: mjrosenb (mjrosenb@moz-B3592BDA.club.cc.cmu.edu) (Ping timeout)
[09:32:12] <ksf> also, is there haskell-like standalone deriving?
[09:38:29] <skade> ksf: for a while, even str hat no ToStr trait. It could be an oversight.
[09:39:41] <kimundi> Yeah, definitly a oversight
[09:41:25] <ksf> TreeMap doesn't, either.
[09:42:09] *** Quits: fran_ (fran@moz-14A4D318.telecom.net.ar) (Ping timeout)
[09:42:16] *** Joins: rntz (rntz@moz-C76A8D96.sp.cs.cmu.edu)
[09:42:34] *** Joins: Blub\w (wry@moz-30F84779.wireless.dyn.drei.com)
[09:42:37] *** Joins: bblum (bblum@moz-2B41ACB5.andrew.cmu.edu)
[09:42:38] *** Joins: rpearl (rpearl@moz-2B41ACB5.andrew.cmu.edu)
[09:42:49] *** Joins: acrichto (acrichto@moz-69F2E428.ugrad.cs.cmu.edu)
[09:42:54] *** Joins: mjrosenb (mjrosenb@moz-B3592BDA.club.cc.cmu.edu)
[09:42:56] <bjz_> ksf: can't you do {:?} ?
[09:43:17] <dbaupp> ksf: no standalone deriving (and with the current implementation of deriving, it's literally impossible)
[09:43:52] <bjz_> rusti: format!("{:?}", Err::<int, ~str>(~"hihi"))
[09:43:53] -rusti- ~"Err(~\"hihi\")"
[09:44:20] *** Joins: miloshadzic (miloshadzi@1D0E4386.525D6FB8.CC0F3526.IP)
[09:44:59] *** Joins: Ms2ger (Ms2ger@moz-50AC4A8B.ugent.be)
[09:45:55] <ksf> oh, nice, that works.
[09:46:58] *** Joins: papalazarou (papalazaro@moz-BE1C9F3F.lightspeed.frokca.sbcglobal.net)
[09:48:22] *** Joins: [squiddy] (squiddy@moz-B55B77C.dip.tu-dresden.de)
[09:48:46] *** Quits: alisdair (textual@28441AAB.AC6E1995.F0AE27BD.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[09:49:15] *** Joins: fran_ (fran@moz-90B9E2CF.telecom.net.ar)
[09:49:50] *** Joins: Florob (Florob@moz-39532932.de)
[09:52:39] *** Quits: nkoep (nik@moz-F875B28B.pool.mediaways.net) (Ping timeout)
[09:58:06] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[09:59:14] *** Joins: jdm (jdm@moz-300427AD.cable.virginmedia.com)
[09:59:14] *** ChanServ sets mode: +o jdm
[10:01:38] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[10:02:58] *** Joins: alonlevy (alon@moz-61A0AD83.red.bezeqint.net)
[10:03:48] *** Joins: donri (donri@moz-9BB61102.tbcn.telia.com)
[10:04:52] <ChrisMorgan> nielsle: experiential knowledge suggests you need considerably more than 1400MB *available* (including swap) to compile Rust, even though it won't actually allocate it all; probably close to 2GB.
[10:06:13] *** Quits: Ms2ger (Ms2ger@moz-50AC4A8B.ugent.be) (Ping timeout)
[10:06:39] *** Quits: MrByte (Dartakio@moz-147070D0.chy-wy.client.bresnan.net) (Ping timeout)
[10:06:57] <kimundi> ksf: Fwiw, I'm implemnting ToSTr right now
[10:07:06] <ksf> \o/
[10:07:08] *** Joins: nkoep (nik@moz-BB78D201.vpn.rwth-aachen.de)
[10:07:32] *** Joins: MrByte (Dartakio@moz-147070D0.chy-wy.client.bresnan.net)
[10:07:36] *** Joins: sankha93 (Instantbir@FF11DE2F.AE981A05.BB883D3E.IP)
[10:08:20] <dbaupp> fwiw, ToStr isn't very popular at the moment (it's being replaced by the std::fmt::Default trait, mainly)
[10:08:38] <dbaupp> (ToStr's design forces too many allocations.)
[10:09:08] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[10:09:14] *** Quits: aegeaner (Aegeaner@C8372C16.21B75AD6.FA28A497.IP) (Connection reset by peer)
[10:10:10] *** Joins: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net)
[10:10:11] <kimundi> dbaupp: Sure, but whatever merging between fmt::Default and to_str::ToStr is going to happen will have to convert all implementations anyway.
[10:10:25] <dbaupp> kimundi: no need to add more ToStr ones :P
[10:10:46] <dbaupp> just add a fmt::Default one so it can be used like `println!("{}", Ok(x))` etc
[10:10:48] *** flaper87 is now known as flaper87|afk
[10:10:52] <kimundi> dbaupp: Is there already a specific alternative to implemnt?
[10:11:15] <dbaupp> kimundi: std::fmt::Default?
[10:11:22] * dbaupp doesn't understand the question
[10:11:54] <kimundi> Imo we should keep the name ToStr anyway, or rename Default to "FormatStr" or so
[10:12:08] <kimundi> having fmt::Default and default::Default is confusing
[10:12:13] *** Quits: StarLight (StarLight@moz-F2756DD7.pppoe.avangarddsl.ru) (Ping timeout)
[10:12:16] <dbaupp> I agree, but the names are orthogonal to the implementations.
[10:12:33] *** Quits: james_c (Mibbit@1F25E55D.3B531343.696FDC79.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[10:12:54] <ksf> they show up in error messages
[10:13:13] <ksf> and yes, that was confusing :)
[10:13:42] *** Quits: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net) (Ping timeout)
[10:14:24] * dbaupp wasn't saying that shouldn't rename fmt::Default, just that it's not relevant to the "should I implement ToStr or fmt::Default?" question
[10:15:22] <kimundi> dbaupp: This is a completely baseless argument, but I wouldn't find it strange if whoever removes ToStr would have more trouble with adjusting my adhock fmt::Default implementation than with the "batch" job of converting all existing ToStr implemntations. :P Would adding both for the transition phase be bad?
[10:16:31] <dbaupp> won't the "adhoc" implementation be `impl<A: fmt::Default, B: fmt::Default> fmt::Default for Result<A, B> { ... }`?
[10:16:34] *** Joins: StarLight (StarLight@moz-983417BD.dynamic.avangarddsl.ru)
[10:17:01] <kimundi> Probably, no idea :P
[10:17:11] <kimundi> Anyway, I'm off for the next few hours
[10:18:18] <ChrisMorgan> Implementing ToStr is easy and obvious; it just returns a string, so you can put things together as you like. std::fmt::Default is much harder conceptually to implement: you'll be working with Formatter.buf in (normally) UTF-8 and in bytes, rather than chars.
[10:19:17] *** Joins: HollyRain (HollyRain@moz-50A83091.dyn.user.ono.com)
[10:19:22] *** Quits: HollyRain (HollyRain@moz-50A83091.dyn.user.ono.com) (Quit: HollyRain)
[10:19:22] <dbaupp> Normally the implementation would be something like write!(fmt.buf, "{} {}", self.x, self.y), right?
[10:19:41] *** Quits: alonlevy (alon@moz-61A0AD83.red.bezeqint.net) (Ping timeout)
[10:19:42] <ChrisMorgan> That's what I expect. Documentation of this fact is needed.
[10:20:35] <ChrisMorgan> Otherwise people may go doing things like `fmt.buf.write(format!("{} {}", ...).as_bytes())`, or throwing their hands up in disgust.
[10:20:37] <dbaupp> A "how to implement the traits" example section of std::fmt's docs might be nice.
[10:20:45] <ChrisMorgan> Yes, it would be.
[10:20:47] <ChrisMorgan> Very nice.
[10:21:02] * dbaupp recommends that this gets recorded in the bug tracker
[10:21:37] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[10:22:09] <ChrisMorgan> dbaupp: are you doing it?
[10:22:20] <dbaupp> I can if you like
[10:22:26] <ChrisMorgan> Ditto.
[10:22:29] <ChrisMorgan> So which will it be?
[10:22:32] <dbaupp> you
[10:22:36] <ChrisMorgan> OK.
[10:22:48] <eddyb9> all the traits should have examples of usage and implementation
[10:22:48] *** Joins: Ms2ger (Ms2ger@moz-B410A5D1.ugent.be)
[10:22:53] * dbaupp reeaaallly shouldn't be on IRC with the amount of work he has
[10:22:59] * ChrisMorgan too
[10:23:13] *** Quits: sankha93 (Instantbir@FF11DE2F.AE981A05.BB883D3E.IP) (Ping timeout)
[10:23:16] <dbaupp> eddyb9: "all" the traits... what scope is all? every trait in the stdlib? or just in std::fmt?
[10:24:18] *** Joins: sankha93 (Instantbir@FF11DE2F.AE981A05.BB883D3E.IP)
[10:24:37] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[10:25:02] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[10:25:38] *** Quits: pepijndevos (pepijndevo@9EACEF43.E50A3180.BCE47D84.IP) (Ping timeout)
[10:25:39] * ChrisMorgan is still mildly anxious about the way the new formatting mingles strings with byte arrays
[10:26:23] *** Quits: zheng_li (zheng_li@moz-D6711E9E.xenplanet.org) (Ping timeout)
[10:27:07] <eddyb9> dbaupp: all the traits in std that can be used
[10:27:14] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Ping timeout)
[10:28:27] *** Joins: fyolnish_ (fyolnish@moz-BE2BAE5B.miinet.jp)
[10:28:44] <eddyb9> or, in the case of operators and such, examples where they would end up being called
[10:28:57] *** Quits: fyolnish_ (fyolnish@moz-BE2BAE5B.miinet.jp) (Connection reset by peer)
[10:29:08] *** Quits: fyolnish (fyolnish@moz-BE2BAE5B.miinet.jp) (Ping timeout)
[10:29:12] *** Joins: fyolnish (fyolnish@moz-BE2BAE5B.miinet.jp)
[10:29:57] <Ms2ger> ChrisMorgan, sounds like py2 :)
[10:30:43] <ChrisMorgan> Ms2ger: it's somewhat different to py2k in that it's all checked properly, but it leaves me with vaguely similar feelings.
[10:31:01] *** Quits: fyolnish (fyolnish@moz-BE2BAE5B.miinet.jp) (Ping timeout)
[10:32:40] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[10:33:12] *** Quits: sankha93 (Instantbir@FF11DE2F.AE981A05.BB883D3E.IP) (Ping timeout)
[10:34:33] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[10:34:42] *** Quits: martndemus (martndemus@moz-E30F5776.adsl.xs4all.nl) (Ping timeout)
[10:36:06] *** Quits: [squiddy] (squiddy@moz-B55B77C.dip.tu-dresden.de) (Ping timeout)
[10:37:52] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Ping timeout)
[10:38:02] *** Joins: martndemus (martndemus@moz-E30F5776.adsl.xs4all.nl)
[10:38:06] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[10:38:43] * ChrisMorgan wishes he could apply labels to Rust issues (especially those he files himself) in GitHub.
[10:39:54] *** Quits: martndemus (martndemus@moz-E30F5776.adsl.xs4all.nl) (Ping timeout)
[10:40:19] <dbaupp> ChrisMorgan: which labels would you like?
[10:40:42] * dbaupp added A-docs and I-papercut
[10:41:25] *** Joins: pepijndevos (pepijndevo@9EACEF43.E50A3180.BCE47D84.IP)
[10:41:54] <ChrisMorgan> Well, for #9861 I filed earlier today, A-rustdoc and probably I-wrong
[10:42:57] *** Joins: maik (maik@F39E5183.C3960D65.B166373C.IP)
[10:43:02] * ChrisMorgan wishes Rust ran more on Mozilla's infrastructure of Bugzilla, Mercurial and the likes
[10:43:09] *** Joins: martndemus (martndemus@moz-E30F5776.adsl.xs4all.nl)
[10:43:51] *** Quits: jdm (jdm@moz-300427AD.cable.virginmedia.com) (Quit: Lost terminal)
[10:44:19] *** Quits: fran_ (fran@moz-90B9E2CF.telecom.net.ar) (Ping timeout)
[10:44:56] *** Quits: qrpth (andreas@moz-9C921D25.ut.ee) (Ping timeout)
[10:45:01] *** Quits: Ms2ger (Ms2ger@moz-B410A5D1.ugent.be) (Quit: bbl)
[10:45:15] *** Quits: martndemus (martndemus@moz-E30F5776.adsl.xs4all.nl) (Ping timeout)
[10:47:35] *** Joins: zheng_li (zheng_li@moz-D6711E9E.xenplanet.org)
[10:48:39] *** Joins: Earnestly (earnest@moz-BE290A2B.dyn.plus.net)
[10:49:26] *** Joins: fran_ (fran@moz-6EC649AF.telecom.net.ar)
[10:50:11] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[10:51:56] *** Joins: alonlevy (alon@moz-B0E66DB7.static.bezeqint.net)
[10:52:05] *** Quits: Blub\w (wry@moz-30F84779.wireless.dyn.drei.com) (Quit: bbiab)
[10:55:01] *** Quits: maik (maik@F39E5183.C3960D65.B166373C.IP) (Ping timeout)
[10:55:39] *** Joins: maik (maik@F39E5183.C3960D65.B166373C.IP)
[10:57:02] *** Quits: heftig (heftig@moz-F554B92E.dip0.t-ipconnect.de) (Ping timeout)
[10:57:16] *** Joins: heftig (heftig@moz-2B5B0F54.dip0.t-ipconnect.de)
[10:58:11] *** Joins: qrpth (andreas@moz-9C921D25.ut.ee)
[10:58:16] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[10:59:11] *** Joins: jaen (jaen@8FED7CD7.6A94545C.43DC2829.IP)
[11:02:36] *** Quits: maik (maik@F39E5183.C3960D65.B166373C.IP) (Ping timeout)
[11:03:30] *** Joins: maik (maik@F39E5183.C3960D65.B166373C.IP)
[11:04:26] *** Joins: glennsl (textual@moz-5D7B804F.getinternet.no)
[11:05:17] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[11:05:38] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Input/output error)
[11:07:58] *** Joins: pnkfelix (pnkfelix@moz-813314A4.hsd1.ma.comcast.net)
[11:07:58] *** ChanServ sets mode: +o pnkfelix
[11:08:47] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[11:13:09] *** Joins: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net)
[11:14:52] *** Quits: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net) (Ping timeout)
[11:15:38] *** Quits: maik (maik@F39E5183.C3960D65.B166373C.IP) (Ping timeout)
[11:16:04] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[11:17:54] *** Joins: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net)
[11:17:55] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[11:17:58] *** Quits: bholley (anonymous@moz-D5EB36E2.rev.numericable.fr) (Quit: bholley)
[11:17:59] *** kimundi is now known as zz_kimundi
[11:18:23] <ChrisMorgan> jason_: I couldn't get 8 teeth to look good flat, so I went up to 12 teeth and am having slightly better results this time.
[11:20:08] *** Quits: jaen (jaen@8FED7CD7.6A94545C.43DC2829.IP) (Ping timeout)
[11:20:44] *** Joins: Jackneill (Jackneill@moz-456ABFAA.pool.digikabel.hu)
[11:22:15] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Quit: Leaving)
[11:27:32] <ChrisMorgan> Still, I come back to the 16-tooth one and think I like it the best, when I compare them together.
[11:27:34] *** Joins: martndemus (martndemus@moz-E30F5776.adsl.xs4all.nl)
[11:29:06] <ChrisMorgan> RFC: http://chrismorgan.info/temp/rust-favicon-12.png (12 teeth) vs. http://chrismorgan.info/temp/rust-favicon.png (16 teeth)
[11:29:28] *** Quits: martndemus (martndemus@moz-E30F5776.adsl.xs4all.nl) (Ping timeout)
[11:29:32] *** zz_kimundi is now known as kimundi
[11:29:37] *** Joins: BitPuffin (isak@moz-98F8BF74.cust.tele2.se)
[11:29:59] <Yoric> Do the teeth measure how much Baby Rust is growing?
[11:30:31] <ChrisMorgan> Yoric: the full sized logo has 32 teeth.
[11:30:44] <Yoric> He's all grown up.
[11:31:30] *** Quits: m_kato (m_kato@moz-C286AD9A.bitcat.net) (Quit: Leaving...)
[11:32:18] <dbaupp> ChrisMorgan: I kinda think the 16 tooth one is nicest, the non-compass ones in the 12 teeth one look weird.
[11:32:25] *** Joins: mohawk (Mibbit@15CB9B55.D1B443B5.FA4E5DC4.IP)
[11:32:51] *** Joins: martndemus (martndemus@moz-E30F5776.adsl.xs4all.nl)
[11:32:59] *** Quits: mohawk (Mibbit@15CB9B55.D1B443B5.FA4E5DC4.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[11:33:08] <Yoric> ChrisMorgan: I prefer the 12 teeth, because the 16 teeth looks more like an Iron Cross.
[11:33:19] *** Joins: mib_ffhd7l (Mibbit@15CB9B55.D1B443B5.FA4E5DC4.IP)
[11:33:30] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[11:33:48] *** Joins: Blub\w (wry@moz-30F84779.wireless.dyn.drei.com)
[11:34:11] *** Quits: mib_ffhd7l (Mibbit@15CB9B55.D1B443B5.FA4E5DC4.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[11:34:21] *** Joins: jaen (jaen@moz-94396299.play-internet.pl)
[11:34:50] *** Quits: fran_ (fran@moz-6EC649AF.telecom.net.ar) (Ping timeout)
[11:35:47] *** Quits: martndemus (martndemus@moz-E30F5776.adsl.xs4all.nl) (Ping timeout)
[11:36:48] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[11:39:02] *** Joins: martndemus (martndemus@moz-E30F5776.adsl.xs4all.nl)
[11:40:01] * ChrisMorgan doesn't see any Iron Cross similarity
[11:40:18] *** Joins: fran_ (fran@moz-C97DE5A9.telecom.net.ar)
[11:43:45] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[11:44:52] *** Joins: fyolnish (fyolnish@moz-5CEAE5D8.uqwimax.jp)
[11:45:04] *** Joins: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net)
[11:45:56] *** Joins: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca)
[11:47:00] *** Joins: squiddy (squiddy@moz-3A4BC03C.adsl.alicedsl.de)
[11:48:00] *** pmoore is now known as pmoore|away
[11:48:06] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[11:49:45] *** flaper87|afk is now known as flaper87
[11:52:20] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[11:54:14] <maikeru> ChrisMorgan: the difference is subtle but 12 lets the teeth stand out more.
[11:54:26] *** pmoore|away is now known as pmoore
[11:55:34] <ChrisMorgan> maikeru: comparing the two closely (and another quick 16-tooth one on the same principles as the 12-tooth one, http://chrismorgan.info/temp/rust-favicon-16-2.png), that's what I realised was the main difference between them—and I'm not sure it actually improves it, having them more visible.
[11:56:41] <ChrisMorgan> At present, the "original" rust-favicon.png is my favourite.
[11:56:50] <etrepum> is there a better way to lowercase a str in rust 0.8? Here's what I've got: https://github.com/etrepum/exercism.io/blob/rust-exercises/assignments/rust/word-count/example.rs#L5-L12 (note that I have no idea what I'm doing)
[11:58:33] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[11:58:36] *** Joins: nano (nano@moz-74CAD1CA.superkabel.de)
[11:58:58] <dbaupp> etrepum: http://static.rust-lang.org/doc/master/std/ascii/trait.StrAsciiExt.html#tymethod.to_ascii_lower is currently the best you can do
[11:59:06] *** Joins: aegeaner (Aegeaner@7F208F22.BD9EA362.4446104D.IP)
[11:59:26] <dbaupp> rusti: use std::ascii::StrAsciiExt; "FOO bar ÖÄÅ".to_ascii_lower()
[11:59:27] -rusti- ~"foo bar \xd6\xc4\xc5"
[11:59:35] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[11:59:35] <dbaupp> rusti: use std::ascii::StrAsciiExt; print("FOO bar ÖÄÅ".to_ascii_lower())
[11:59:36] -rusti- foo bar ÖÄÅ()
[11:59:54] <ChrisMorgan> rusti: use std::ascii::OwnedStrAsciiExt; print("FOO bar ÖÄÅ".into_ascii_lower())
[11:59:55] -rusti- <anon>:9:49: 9:79 error: type `&'static str` does not implement any method in scope named `into_ascii_lower`
[11:59:55] -rusti- <anon>:9          use std::ascii::OwnedStrAsciiExt; print("FOO bar ÖÄÅ".into_ascii_lower())
[11:59:55] -rusti-                                                           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[11:59:55] -rusti- error: aborting due to previous error
[11:59:56] -rusti- application terminated with error code 101
[11:59:59] <ChrisMorgan> rusti: use std::ascii::OwnedStrAsciiExt; print(~"FOO bar ÖÄÅ".into_ascii_lower())
[11:59:59] -rusti- <anon>:9:50: 9:80 error: type `&'static str` does not implement any method in scope named `into_ascii_lower`
[12:00:00] -rusti- <anon>:9          use std::ascii::OwnedStrAsciiExt; print(~"FOO bar ÖÄÅ".into_ascii_lower())
[12:00:03] -rusti-                                                            ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[12:00:04] <dbaupp> we don't have the full unicode tables required to support general upper/lower casing yet.
[12:00:06] -rusti- error: aborting due to previous error
[12:00:08] -rusti- application terminated with error code 101
[12:00:08] <ChrisMorgan> rusti: use std::ascii::OwnedStrAsciiExt; print((~"FOO bar ÖÄÅ").into_ascii_lower())
[12:00:09] -rusti- foo bar ÖÄÅ()
[12:00:16] <ChrisMorgan> *Sigh*, I'll get it one of these days...
[12:00:36] <etrepum> dbaupp: but, unicode. The code I wrote appears to work, I just don't think it's nice that I have to do that. There appears to be some wrapper code in unicode to wrap icu but it doesn't seem to be accessible
[12:01:42] <ChrisMorgan> etrepum: do you *need* to support more than ASCII?
[12:01:58] <dbaupp> etrepum: yeah, if you want unicode you will need to use the FFI to call an external library (although I think the icu wrapper can be enabled by compiling rust itself with the --enable-unicode or --enable-icu option to ./configure)
[12:03:14] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[12:03:19] <ChrisMorgan> dbaupp: I don't see any --enable-(unicode|icu)
[12:03:31] *** Quits: fabiand (fabiand@moz-DDB9B420.adsl.alicedsl.de) (Quit: Verlassend)
[12:03:34] <etrepum> ChrisMorgan: well, I don't *need* to write Rust code at all… I'm just trying it out ;)
[12:03:59] <etrepum> icu seems to be used by the unicode module, and the code I wrote appears to work on Mac OS X
[12:04:02] <ChrisMorgan> etrepum: I simply mean that if ASCII will do for the moment, well, it's easier.
[12:04:12] <dbaupp> etrepum: btw, there's .word_iter() on strings (although, again it doesn't handle the correct unicode word boundaries, and just does whitespace)
[12:04:14] <dbaupp> ChrisMorgan: hm
[12:04:26] <etrepum> dbaupp: word_iter doesn't work for this case, take a look at the predicate
[12:04:41] <etrepum> dbaupp: it splits on any non-alphanumeric char
[12:05:16] <ChrisMorgan> etrepum: incidental note on style, your fn to_lower could have `return u_tolower(c)` changed to `u_tolower(c)`
[12:05:32] *** Joins: fabiand (fabiand@moz-DDB9B420.adsl.alicedsl.de)
[12:05:49] <dbaupp> etrepum: yup, just wasn't sure if you'd seen the function or chosen to that on purpose :)
[12:06:32] <dbaupp> ChrisMorgan: oh, it must've been removed: we had extra::icu conditionally enabled based on some such configuration variable, but now we just have libextra/icu.rs with no associated `mod icu` statement.
[12:06:41] <Florob> Hmm... would .to_lower() case fold or case map?
[12:06:41] <dbaupp> hm, wait
[12:06:47] <dbaupp> I misread that
[12:06:53] <etrepum> ChrisMorgan: that was what I tried first, but it doesn't work like that. word_count.rs:7:8: 9:9 error: mismatched types: expected `char` but found `()` (expected char but found ())
[12:07:05] *** Joins: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP)
[12:07:08] <ChrisMorgan> rusti: pub mod icu{externfn!(fn u_tolower(c:char)->char)pub fn to_lower(c:char)->char{unsafe{u_tolower(c)}}}let s:~str="FOO bar ÖÄÅ".iter().map(icu::to_lower).collect();s
[12:07:10] -rusti- pastebinned 8 lines of output: http://ix.io/8u4
[12:07:12] *** kimundi is now known as zz_kimundi
[12:07:15] <etrepum> ChrisMorgan: perhaps due to the unsafe an explicit return is required?
[12:07:22] <ChrisMorgan> etrepum: works for me
[12:07:26] *** Quits: eddyb9 (eddy@9C423EDB.600764B.4A6B528C.IP) (Quit: Leaving)
[12:07:30] <etrepum> ChrisMorgan: with rust 0.8?
[12:07:34] <ChrisMorgan> Sure.
[12:07:54] <ChrisMorgan> There, the machine rusti is on can't link to u_tolower.
[12:08:43] <dbaupp> ChrisMorgan: oh, we do have `extra::unicode` which is enabled if extra is built with `--cfg unicode`, but it appears that it's required to specify that with RUSTC_FLAGS='--cfg unicode' manually, no configure option for it
[12:08:49] <etrepum> ChrisMorgan: well, not here. https://gist.github.com/etrepum/6990568
[12:08:53] *** Quits: GeneralMaximus (ankur@15904EB6.A825C662.4C155415.IP) (Ping timeout)
[12:09:08] <dbaupp> etrepum: remove the semicolon
[12:09:26] <etrepum> dbaupp: thanks, that did it
[12:10:18] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[12:10:40] *** Joins: Ms2ger (Ms2ger@moz-A31ECF3A.ugent.be)
[12:11:33] *** flaper87 is now known as flaper87|afk
[12:12:38] *** Quits: z0w0 (zack@moz-C877F2F7.lnse2.cha.bigpond.net.au) (Quit: z0w0)
[12:13:12] <MrOrdinaire> hi, could someone please tell me what name `fn main()` will be marshalled into?
[12:13:27] <MrOrdinaire> when it's compiled, i mean
[12:13:33] *** Joins: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net)
[12:13:39] <dbaupp> "mangled" you mean?
[12:14:56] <MrOrdinaire> dbaupp: yes
[12:15:09] <MrOrdinaire> sorry for using the wrong term
[12:15:14] <dbaupp> MrOrdinaire: I get "@_ZN4main19hc8e77e8c5cee7e40ah4v0.0E" with my version of rust (dicovered by `echo 'fn main() {}' | rustc -o /dev/stdout - --emit-llvm -S | grep main`)
[12:15:25] *** Quits: jaen (jaen@moz-94396299.play-internet.pl) (Ping timeout)
[12:15:41] <benh> I believe there is an attribute #[no_mangle]
[12:15:48] <MrOrdinaire> dbaupp: is there anyway to programmatically get that name?
[12:15:57] <MrOrdinaire> benh: wow! I should try that instead!
[12:16:00] <MrOrdinaire> benh: thanks a bunch
[12:16:08] <benh> looking at http://brson.github.io/2013/03/10/embedding-rust-in-ruby/ but it's a bit old
[12:16:10] <dbaupp> within rustc there is, but yeah, #[no_mangle] or #[export_name="foo"] is what you want
[12:16:20] <benh> ah, cool
[12:16:40] *** Joins: maik (maik@moz-A619546A.uni-koblenz.de)
[12:16:55] <myname> what is the prefered way of waiting till "all subtasks" are done?
[12:17:08] *** Quits: aegeaner (Aegeaner@7F208F22.BD9EA362.4446104D.IP) (Quit: Leaving.)
[12:17:08] *** Quits: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net) (Ping timeout)
[12:18:45] <MrOrdinaire> dbaupp: if this fails, could you tell me how to get that mangled name using rustc?
[12:19:01] *** Joins: aegeaner (Aegeaner@7F208F22.BD9EA362.4446104D.IP)
[12:19:10] <MrOrdinaire> dbaupp: if -> in case
[12:19:57] <eddyb> rabin2 -s ../rust/test | c++filt | grep main::
[12:20:01] *** Quits: maik (maik@moz-A619546A.uni-koblenz.de) (Ping timeout)
[12:20:02] <eddyb> addr=0x00400eb0 off=0x00000eb0 ord=055 fwd=NONE sz=113 bind=LOCAL type=FUNC name=main::hd7d397690bb6180aw::v0.0
[12:20:24] <eddyb> MrOrdinaire: do you want to know the name that would be generated? or the generated name from a binary?
[12:20:55] <MrOrdinaire> eddyb: sorry I don't quite follow. What's the difference between those two scenarios?
[12:21:29] <eddyb> MrOrdinaire: in the first one, you don't need an output binary, but the generation scheme
[12:21:31] <MrOrdinaire> eddyb: they are the same, right?
[12:21:42] <MrOrdinaire> eddyb: oh
[12:21:54] <eddyb> the the second one, you find the generated mangled name in a binary's symbols
[12:21:56] <MrOrdinaire> eddyb: got it. Yeah, my use case is the first one.
[12:22:03] <dbaupp> MrOrdinaire: it probably won't fail :) (assuming you just want to expose a symbol of a fixed name outside your binary)
[12:22:55] <eddyb> MrOrdinaire: if you want to call the function from C, use extern "C" which will disable mangling and use a compatible calling convention
[12:22:59] *** flaper87|afk is now known as flaper87
[12:23:05] <nielsle> If I filter an ~[int] then it becomes an ~[&int].  Is there a trick to avoid this?   http://pastebin.com/qK4irRiV
[12:23:23] <MrOrdinaire> eddyb: no, I'm not. I'm using rustc's facility to compile code on the fly.
[12:23:43] <Ms2ger> nielsle, .map(|&x| *x) or something like that
[12:24:13] *** Joins: jdm (jdm@514D186.F3BBB17D.144F44FA.IP)
[12:24:13] *** ChanServ sets mode: +o jdm
[12:24:20] <MrOrdinaire> dbaupp: but that means that fixed name is blessed and users cannot define a function with that name, or bad things happen...
[12:24:22] <dbaupp> nielsle: it's not the filter that's making a &int, it's the .iter(): it yields references to the elements in their positions in the vector.
[12:24:53] <dbaupp> MrOrdinaire: well, they cannot use #[no_mangle] or #[export_name] on a symbol with the same name (or somehow make a function that mangles to that fixed name)
[12:24:55] <nielsle> OK thanks
[12:25:09] <eddyb> MrOrdinaire: oh, you're "eval"-ing code. can't you wrap it in a function and compile it in a way to get a function pointer back?
[12:26:10] <ChrisMorgan> nielsle: instead of num.iter(), use num.move_iter()
[12:26:31] <nielsle> Ah. thanks
[12:27:11] <MrOrdinaire> eddyb: how do you get back the inner function inside the wrapper?
[12:27:33] <MrOrdinaire> dbaupp: yeah...
[12:28:25] <dbaupp> fwiw, .move_iter() does n/2 memcpys internally, and then the memcpy to extract the element (of course the memcpy may just be a single word move in the case of int). .iter() is much faster, LLVM even vectorises it under the right circumstances.
[12:28:28] <engla> nielsle: you should really use .iter().map(|&x| x)  to get an iterator with `int` elements
[12:28:32] *** Quits: qrpth (andreas@moz-9C921D25.ut.ee) (Ping timeout)
[12:28:33] <eddyb> MrOrdinaire: the wrapper would be a function, and you call that
[12:28:36] <engla> yeah, see dbaupp's comment
[12:28:38] *** Joins: qrpth (andreas@moz-9C921D25.ut.ee)
[12:28:52] <eddyb> MrOrdinaire: hmm, maybe it creates a namespace
[12:29:09] <dbaupp> (to be clear: it does n/2 + n memcpys to iterate through the whole vector, *not* n/2+1 for each element.)
[12:29:29] <engla> well it's not going to be memcpy if the vector has `int` elements
[12:30:26] <engla> but the fact remains that .move_iter() does unnecessary work for simple types, like for example shrinking the length of the vector during iteration
[12:30:26] <eddyb> echo 'fn main() {fn foo() {fn bar() {} bar()} foo()}' | rustc -o foobar -; nm foobar | c++filt | grep bar
[12:30:28] <eddyb> 0000000000400a30 t main::foo::bar::hed84efa47395954cal::v0.0
[12:31:27] <eddyb> MrOrdinaire: if it's of any use to you, you can wrap in #[no_mangle] fn __eval_N() { ... } where N is increased every time
[12:31:50] <MrOrdinaire> eddyb: hmm
[12:32:05] <MrOrdinaire> eddyb: it seems more like a hack than a proper solution
[12:32:38] <MrOrdinaire> eddyb: I want to keep reference to the inner function (`bar` in your code) so that the user can call that function again later
[12:32:47] *** Joins: bholley (anonymous@moz-D5EB36E2.rev.numericable.fr)
[12:32:50] <eddyb> MrOrdinaire: but I was initially thinking something like eval('(function() {...})); in JS, which gives you the function, instead of dumping it somewhere. doesn't rustc have a compile_one_function_expression?
[12:33:00] <eddyb> oh so the wrapper idea is bad anyway
[12:33:08] <eddyb> MrOrdinaire: are you writing a REPL?
[12:33:14] <MrOrdinaire> eddyb: yes
[12:33:48] <MrOrdinaire> eddyb: I don't think rustc currently has the capability to do that
[12:34:07] <MrOrdinaire> eddyb: by that I mean something like your compile_one_function_expression
[12:34:13] <eddyb> maybe you need to hook into middle/trans
[12:34:44] <eddyb> but it's already past my limited knowledge
[12:35:16] <MrOrdinaire> eddyb: thanks anyway :D
[12:36:11] <MrOrdinaire> eddyb: but coming back to the question of name mangling, do you know how to programmatically get that mangled name?
[12:36:49] <eddyb> how will you generate unique fn names anyway?
[12:37:09] *** Joins: jaen (jaen@DD49A1EB.6A94545C.43DC2829.IP)
[12:38:02] <dbaupp> MrOrdinaire: there's a function somewhere in librustc/back/
[12:38:20] <dbaupp> probably matching `.*_mangle_.*`
[12:38:38] *** Joins: exobit_ (textual@moz-E06F46F0.corp.bitshelter.com)
[12:39:41] <eddyb> MrOrdinaire: hmm. I would parse the input as the contents of a function and move all the functions into the global scope
[12:39:50] <eddyb> or your own local namespace
[12:40:08] <eddyb> and you can probably hack in function redefinition
[12:40:57] <eddyb> MrOrdinaire: ../rust/src/librustc/back/link.rs:pub fn mangle(sess: Session, ss: path,
[12:41:33] <MrOrdinaire> eddyb: cool!
[12:41:37] <MrOrdinaire> eddyb: thanks a bunch :D
[12:43:39] *** Joins: tgummerer (tgummerer@moz-9FE3F44D.kthopen.kth.se)
[12:43:54] *** Joins: rumpler (Mibbit@BADBFDA3.4E4A5350.3BD9FE04.IP)
[12:45:24] *** Quits: fran_ (fran@moz-C97DE5A9.telecom.net.ar) (Ping timeout)
[12:45:57] <rumpler> Is rust suitable for writing web?
[12:46:30] <eddyb> writing client-side code or server-side code?
[12:46:36] *** Quits: bholley (anonymous@moz-D5EB36E2.rev.numericable.fr) (Quit: bholley)
[12:46:43] <rumpler> server
[12:47:17] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[12:47:19] <rumpler> side
[12:47:35] <eddyb> should be, but not sure if there are any frameworks yet
[12:47:48] <eddyb> something akin to sinatra or express.js would be great :D
[12:47:52] *** Quits: tgummerer (tgummerer@moz-9FE3F44D.kthopen.kth.se) (Ping timeout)
[12:48:45] <eddyb> hmm, client-side... is it possible to work with emscripten in "streaming" mode?
[12:49:13] <rumpler> what is the advantage compared to ruby or python, as server-side language?
[12:49:46] <rumpler> client-side impossible
[12:49:49] *** Joins: fran_ (fran@moz-F0E884F2.telecom.net.ar)
[12:49:54] <eddyb> rumpler: not really
[12:50:05] <eddyb> you can REPL C code client-side if you wanted to
[12:50:19] *** Joins: tgummerer (tgummerer@moz-9FE3F44D.kthopen.kth.se)
[12:50:21] <ChrisMorgan> rumpler: safety, speed and correctness are the three main things I'm targeting with Rust.
[12:50:21] <rumpler> but mainstream will not
[12:50:27] *** zz_kimundi is now known as kimundi
[12:50:52] <rumpler> yes, i agree
[12:50:57] <ChrisMorgan> eddyb: I'm betting on someone fixing up Rust with Emscripten by the time rust-http is ready for mainstream usage.
[12:51:04] *** Joins: samx (sami@moz-D9DA5773.dyn.optonline.net)
[12:51:37] <eddyb> rumpler: depends. a not-so-low-level (as emscripten is) translation to JS would give you the type checks and piggyback on the versatility of JS code
[12:51:39] <ChrisMorgan> rumpler: I'm the author of rust-http, an HTTP library for Rust. I've got a grand vision for a Rust web framework, but the HTTP support wasn't there yet, so that's what I'm doing first!
[12:52:07] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[12:52:10] <etrepum> is there any way to have the FFI somehow use a C header file? it seems that icu does some versioning with a C macro that renames the symbols (at least on linux, mac's icucore doesn't do this)
[12:52:32] *** Quits: samx (sami@moz-D9DA5773.dyn.optonline.net) (Quit: This computer has gone to sleep)
[12:52:39] <eddyb> ChrisMorgan: I saw llvm-as+llvm-dis+emscripten in the client already, so it doable right now, but would probably be too slow
[12:53:01] <ChrisMorgan> eddyb: too slow where?
[12:53:02] <rumpler> ChrisMorgan: good job
[12:53:04] <benh> rust-bindgen is supposed to consume a C header file and spit out a bunch of ffi declarations, but I don't expect it to be very good at handling macro-heavy headers
[12:53:18] <kimundi> etrepum: It's kinda planned in the longterm to support something like that, but at the moment you have to write/generate bindings manually
[12:53:19] <eddyb> it's simple, run preprocessor first
[12:53:42] *** Quits: qrpth (andreas@moz-9C921D25.ut.ee) (Ping timeout)
[12:53:42] *** Quits: tgummerer (tgummerer@moz-9FE3F44D.kthopen.kth.se) (Ping timeout)
[12:54:01] <eddyb> I have a C parser in JS that works with a 40k preprocessed windows.h file
[12:54:44] <etrepum> I suppose I should just use the ASCII stuff and forget using the FFI, since this is just for learning/teaching Rust and this is the third exercise :)
[12:54:48] <rumpler> I am not sure of the speed of coding in rust. It had better not slower than ruby
[12:55:42] <ChrisMorgan> rumpler: I would expect development time to be a little longer in Rust than in Ruby, but debugging/testing time later on to be significantly shorter, which for all but the simplest of things will be a big win.
[12:56:54] <rumpler> ChrisMorgan: the total time(debug+develop), you mean shorter?
[12:57:13] <ChrisMorgan> I would expect amortised total time to be shorter.
[12:57:25] <benh> This sounds somewhat conjecturey
[12:57:26] <ChrisMorgan> You'll end up with a more solid product.
[12:57:45] <benh> Rust is still in development, so you're slowed down by navigating around the under-construction areas, etc
[12:58:07] <etrepum> I would be hesitant to make that kind of claim until Rust has a more complete standard library and isn't a moving target
[12:58:09] <ChrisMorgan> benh: I'm not speaking about now, I'm speaking about when Rust and the framework of my vision are ready for prime time.
[12:58:40] <benh> ok, your framework better be fairly comprehensive :)
[12:58:43] <ChrisMorgan> rumpler: I would certainly not recommend Rust for a web server at present. In six months' time, maybe; in a year's time, probably, but not yet.
[12:58:47] *** Quits: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca) (Quit: canhtak)
[12:59:51] <ChrisMorgan> Run time performance will also be enormously higher, which means if you ever get to scaling Rust will be the way to go rather than Ruby; you'll still only need one application server by the time you have ten or twenty Ruby servers.
[12:59:59] * ChrisMorgan likes making big promises :P
[13:00:01] <dbaupp> etrepum: https://github.com/crabtw/rust-bindgen will make the low-level bindings easier to write
[13:00:04] <etrepum> rumpler: if you're looking for something that has a lot of the benefits of Rust, and is mature today, there's Haskell. Doesn't give you the same control over memory, but it has many other upsides.
[13:00:06] <dbaupp> (i.e. it does it for you)
[13:00:27] <etrepum> dbaupp: cool, I don't think it makes a lot of sense to use it for this project, but I'll keep it in mind
[13:00:51] <dbaupp> etrepum: yeah, it is a bit fiddly to use (the one time I used it, at least.)
[13:01:15] <etrepum> dbaupp: for this project I only want to depend on what ships with rust
[13:01:47] <kimundi> Not much to use then :P
[13:01:59] <rumpler> etrepum: but not many people use Haskell to write web
[13:02:21] <dbaupp> rumpler: it's getting more popular with Yesod etc (last time I checked, at least)
[13:03:04] <etrepum> rumpler: adjusting for community size, I would say that's definitely false.
[13:04:08] <etrepum> rumpler: Haskell has a number of web frameworks and web servers. Due to Haskell's other properties, these are some of the fastest dynamic web servers around (especially with the latest GHC). Check out this paper for benchmarks: http://haskell.cs.yale.edu/wp-content/uploads/2013/08/hask035-voellmy.pdf
[13:06:26] <rumpler> ChrisMorgan: should people use ruby first and then transfer to rust if scaling needed, or use rust at the beginning?
[13:06:53] <ChrisMorgan> My intent is to have Rust be the thing you work in all the time.
[13:07:04] * ChrisMorgan loves Rust
[13:07:12] *** Joins: qrpth (andreas@moz-9C921D25.ut.ee)
[13:07:15] <skade> etrepum funny that you mention it, my old flatmate got a PHD on improving threadscope because these frameworks were perfoming below expectations in real world uses
[13:07:31] *** Quits: Houm (Houm@moz-25669AA8.fbx.proxad.net) (Ping timeout)
[13:07:41] <skade> ("below expectations": still quite fast ;) )
[13:08:28] *** jorendorff_away is now known as jorendorff
[13:08:36] <ChrisMorgan> Haskell web frameworks are a good thing to look at; some of the concepts that I want to have in my framework that I hadn't come across anywhere else I found to exist in Haskell. And no wonder; its type system is good and forms significant basis for some of these things.
[13:09:46] *** Quits: qrpth (andreas@moz-9C921D25.ut.ee) (Quit: leaving)
[13:11:31] *** Quits: rumpler (Mibbit@BADBFDA3.4E4A5350.3BD9FE04.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[13:11:32] <etrepum> rumpler: It's often faster and easier to write and maintain correct software in languages like Rust that don't have NULL and can prove things about your program at compile time. Dynamic languages are often pragmatic, but code rot is definitely a problem.
[13:13:17] <skade> I am not sure whether I can sign that. I was following the Darcs project for a while and they had huge problems with code rot.
[13:14:11] <skade> and I do maintain a rather large ruby framework where code rot is one of our smallest problems
[13:14:46] <etrepum> well, it's possible to write good or bad software in any language :)
[13:15:05] <skade> darcs isn't necessarily bad software :)
[13:15:31] *** Joins: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca)
[13:15:49] <etrepum> well, if it has code rot problems, there is certainly something that they could've done differently to avoid that
[13:16:24] <skade> well, most of them are due to inexperience
[13:16:24] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[13:16:39] *** Joins: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net)
[13:16:42] <skade> but then the assumption doesn't hold that the language does somehow save you from that
[13:17:29] <etrepum> I'm just saying it's easier to prevent code rot with a statically typed language. Refactoring is cheaper because the compiler is going to help you do it.
[13:17:44] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Client exited)
[13:17:46] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[13:18:24] *** Quits: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net) (Ping timeout)
[13:18:27] <skade> I want numbers on that
[13:20:18] <skade> e.g. generic glue code is very hard in static languages. knob (github.com/skade/knob) for example resorts to using strings internally everywhere
[13:20:41] <skade> basically: if anything is wrong you get a runtime crash
[13:20:56] *** Quits: Ms2ger (Ms2ger@moz-A31ECF3A.ugent.be) (Ping timeout)
[13:21:10] <skade> when speaking about microservices, this problem is your main problem
[13:21:17] <skade> so my language doesn't help me a lot
[13:21:26] *** Joins: Ms2ger (Ms2ger@moz-FFE05062.ugent.be)
[13:23:06] <skade> in general, I very much agree with this paper: http://www.ics.uci.edu/~lopes/teaching/inf212W12/readings/rdl04meijer.pdf
[13:25:06] *** Joins: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com)
[13:29:01] *** Joins: ChrisMorgan1 (chris@moz-6AC741CA.static.tpgi.com.au)
[13:29:02] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Connection reset by peer)
[13:29:23] *** ChrisMorgan1 is now known as ChrisMorgan
[13:31:15] <ChrisMorgan> skade: in your Knob README, why do you have the link at the end of the usage code formatted rather than letting it be a link?
[13:31:54] <MrOrdinaire> skade: that's an interesting paper. Thanks for sharing.
[13:32:03] <skade> ChrisMorgan the most probable theory is the lateness of the night :)
[13:33:33] <skade> MrOrdinaire it's one of my favourite ones, especially as it is very down to earth in regards to practical programming
[13:34:36] *** Quits: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[13:35:26] <eddyb> back from lunch
[13:35:40] <eddyb> ChrisMorgan: so you want to build a web framework? what are you basing its design on?
[13:36:02] *** Joins: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP)
[13:36:08] <ChrisMorgan> skade: your knob crate docs have quite a lot of bad code in them that won't compile.
[13:36:39] <eddyb> express.js-like (which can be compared to some python and maybe ruby frameworks) with inline raw string (or macros) for templates would be awesome
[13:37:23] <eddyb> I miss the concise arrow functions from ES6 in rust :/
[13:37:40] <eddyb> e.g .map(x => x * x)
[13:37:47] <ChrisMorgan> .map(|x| x * x)
[13:37:59] <skade> ChrisMorgan: I know, I probably should rewrite them, but I sadly have no time until at least after the weekend
[13:38:09] <eddyb> ChrisMorgan: hmm, block is required only for do?
[13:38:28] <benh> the syntax is |args| expr, so if you need mroe than one expr you have to use a  {} block
[13:38:33] <skade> I would really enjoy a doc framework that would allow to link to test files for examples ;).
[13:38:43] <ChrisMorgan> Correct, `do` does require a block.
[13:38:57] <benh> I had a "bug" earlier where I wrote let f = |x| blah;, then extended it to let f |x| blah; blah; and was surprised that the second blah was running early ;)
[13:39:07] <benh> sorry, "f = "
[13:39:46] <ChrisMorgan> A classical error, and one that Rust does a fairly good job of avoiding—I think that's just about the only situation in which you can hit it.
[13:40:08] <eddyb> well, it's shorter (by one character), but not as expressive as the arrow functions
[13:40:18] <Ms2ger> Oh?
[13:40:35] <ChrisMorgan> eddyb: concerning the basis of my framework, at present, most of my inspiration is from Django and Pyramid, though I have very significantly different ideas, more in line with the Haskell world; however, I'm intending to learn Ruby on Rails fairly thoroughly as well before working on it and probably Yesod also.
[13:40:44] * ChrisMorgan doesn't see how it's less expressive
[13:40:59] <eddyb> ChrisMorgan: sorry, explicit
[13:41:10] <eddyb> in the mapping case, the arrow is perfect :P
[13:41:22] * ChrisMorgan doesn't see how it's less explicit
[13:41:36] <eddyb> compare |x| x to x => x
[13:42:14] <ChrisMorgan> Compare |x, y| x + y with ___ (please fill in, I'm not certain)
[13:43:29] <ChrisMorgan> Looks like the answer is (x, y) => x + y
[13:44:23] <kimundi> I guess it depends on how you view the syntax. If seen as a lambda form of "fn foo(a, b, c) { ... }", "|a,b,c| ... " makes perfectly sense. a,b,c => ... might be more mathematical, but really, what happens at a low level is still a function call, So I think |a,b,c| ... suggests the right thing
[13:44:35] *** Joins: sw17ch (sw17ch@moz-62998E95.hfc.comcastbusiness.net)
[13:45:21] <eddyb> anyways, if I could convince the ES people, I would use Dart closures, (x, y) {...} for the block form
[13:46:17] <eddyb> wait, is that reasonable for rust? I remember something about cover grammar
[13:47:20] <eddyb> I guess (a, b, c) would be confusing considering Rust has tuples
[13:48:27] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[13:48:41] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[13:48:46] *** Joins: saml (sam@moz-14C16814.cst.lightpath.net)
[13:49:15] <eddyb> kimundi: is |x||y||z|(x+y+z) valid?
[13:49:30] <ChrisMorgan> rusti: |x||y||z|(x+y+z)
[13:49:30] -rusti- <anon>:9:11: 9:13 error: expected `,` but found `||`
[13:49:31] -rusti- <anon>:9          |x||y||z|(x+y+z)
[13:49:31] -rusti-                     ^~
[13:49:31] -rusti- application terminated with error code 101
[13:49:40] <ChrisMorgan> rusti: |x| |y| |z|(x+y+z)
[13:49:40] -rusti- <anon>:9:21: 9:22 error: the type of this value must be known in this context
[13:49:41] -rusti- <anon>:9          |x| |y| |z|(x+y+z)
[13:49:41] -rusti-                               ^
[13:49:41] -rusti- error: aborting due to previous error
[13:49:41] -rusti- application terminated with error code 101
[13:49:55] <ChrisMorgan> i.e. yes, so long as you put the spaces in
[13:50:01] *** Quits: Blub\w (wry@moz-30F84779.wireless.dyn.drei.com) (Ping timeout)
[13:50:06] <Ms2ger> rusti: (|x| |y| |z|(x+y+z))(1)(2)(3)
[13:50:06] -rusti- <anon>:9:22: 9:23 error: the type of this value must be known in this context
[13:50:07] -rusti- <anon>:9          (|x| |y| |z|(x+y+z))(1)(2)(3)
[13:50:07] -rusti-                                ^
[13:50:07] -rusti- error: aborting due to previous error
[13:50:07] -rusti- application terminated with error code 101
[13:50:27] *** Joins: Blub\w (wry@moz-30F84779.wireless.dyn.drei.com)
[13:50:31] <eddyb> x => y => z => (x + y + z) in ES6 (I agree, too verbose) and f x y z = x + y + z in haskell
[13:50:57] *** Joins: sankha93 (Instantbir@7483E3E5.AA42D49B.2FB84AC6.IP)
[13:51:11] * ChrisMorgan doesn't think it really matters
[13:51:44] *** Joins: Boreeas (SirWelling@moz-5EA18EE.triple-a.uni-kl.de)
[13:51:54] *** Quits: sankha93 (Instantbir@7483E3E5.AA42D49B.2FB84AC6.IP) (Connection reset by peer)
[13:52:04] <eddyb> Rust works functionally where I need it to (processing containers/iterators), so I shouldn't nitpick
[13:52:11] <Florob> rusti: (|x| |y| |z|(x+y+z))(1u)(2u)(3u)
[13:52:11] -rusti- <anon>:9:22: 9:23 error: the type of this value must be known in this context
[13:52:11] -rusti- <anon>:9          (|x| |y| |z|(x+y+z))(1u)(2u)(3u)
[13:52:11] -rusti-                                ^
[13:52:11] -rusti- error: aborting due to previous error
[13:52:11] -rusti- application terminated with error code 101
[13:52:43] <Boreeas> Is there a way to insert elements in the middle of a vector, i.e. add 1 to [0, 2, 3, 4] so that the resulting vector is [0, 1, 2, 3, 4]?
[13:52:44] <eddyb> rusti: let f = |x| |y| |z|(x+y+z); f(1)(2)(3
[13:52:44] -rusti- <anon>:10:4: 10:5 error: incorrect close delimiter: `}`
[13:52:44] -rusti- <anon>:10     };
[13:52:44] -rusti-               ^
[13:52:44] -rusti- application terminated with error code 101
[13:52:49] <eddyb> rusti: let f = |x| |y| |z|(x+y+z); f(1)(2)(3)
[13:52:50] -rusti- <anon>:9:29: 9:30 error: the type of this value must be known in this context
[13:52:50] -rusti- <anon>:9          let f = |x| |y| |z|(x+y+z); f(1)(2)(3)
[13:52:50] -rusti-                                       ^
[13:52:50] -rusti- error: aborting due to previous error
[13:52:51] -rusti- application terminated with error code 101
[13:53:01] <Ms2ger> Yeah, not going to work
[13:53:27] <eddyb> rusti: let f : |int| -> |int| -> |int| -> int = |x| |y| |z|(x+y+z); f(1)(2)(3)
[13:53:28] -rusti- <anon>:9:17: 9:18 error: expected type, found token BINOP(OR)
[13:53:28] -rusti- <anon>:9          let f : |int| -> |int| -> |int| -> int = |x| |y| |z|(x+y+z); f(1)(2)(3)
[13:53:28] -rusti-                           ^
[13:53:28] -rusti- application terminated with error code 101
[13:53:36] <eddyb> hmpf
[13:53:44] <eddyb> I give up with the spam
[13:53:56] <Boreeas> I dont think rust has currying
[13:54:36] <eddyb> neither does ES6, but you can use the arrows to get close
[13:54:55] <ChrisMorgan> You just need to use ~fn(int) instead of |int| in the type declaration.
[13:55:03] <ChrisMorgan> rusti: let f: ~fn(int) -> ~fn(int) -> ~fn(int) -> int = |x| |y| |z|(x+y+z); f(1)(2)(3)
[13:55:03] <Boreeas> To repeat my question, since it probably got burried by rusti, how can I insert elements into a vector?
[13:55:04] -rusti- 6
[13:55:16] <eddyb> Boreeas: probably .push
[13:55:29] <Boreeas> push only adds at the end I think
[13:55:48] *** kimundi is now known as zz_kimundi
[13:56:03] <eddyb> oh, insert at a position? hmm, that can be tricky, but there might be a function for it
[13:56:35] <Ms2ger> insert()?
[13:56:37] <ChrisMorgan> http://static.rust-lang.org/doc/master/std/vec/trait.OwnedVector.html#tymethod.insert
[13:56:44] <Boreeas> Ah, there's insert in OwnedVector, I thought it was in MutableVector
[13:57:07] <eddyb> ChrisMorgan: I need to bookmark the docs :P
[13:57:35] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[13:57:42] <ChrisMorgan> No, most of those things are in OwnedVector rather than MutableVector. I think this is because &mut [T] can't do anything which could change the length of the allocation.
[13:57:50] <eddyb> any plans for variadic functions using variadic generics (similar to what C++11 did for type-safe - as safe as possible in C++, that is - variadic functions)?
[13:58:22] <eddyb> ChrisMorgan: a borrowed vector is a slice, isn't it?
[13:58:29] <ChrisMorgan> Yes
[13:58:38] <eddyb> you can't own the storage of a slice without copying it
[13:58:52] <ChrisMorgan> That is, &[T] and &mut [T] are a slice.
[13:59:08] <eddyb> (if you don't have the original owned vector, that is)
[14:02:17] *** Quits: Boreeas (SirWelling@moz-5EA18EE.triple-a.uni-kl.de) (Quit: ChatZilla 0.9.88.2-rdmsoft [XULRunner 2.0.1/20110424235619])
[14:03:21] * ChrisMorgan does not know what plans there are for variadic functions, but it's fair to say they won't be in Rust 1.0
[14:04:05] <eddyb> also, is there no overloading?
[14:04:57] <eddyb> overloading the return type would be cool and C++ can't do that, without using a fancy template
[14:06:15] *** Joins: earlz2 (earlz@3BA8656D.F04AFED0.49B48A1E.IP)
[14:08:17] *** Joins: samx (sami@moz-D9DA5773.dyn.optonline.net)
[14:08:44] *** Joins: lfox (lfox@moz-343B6F0C.nyc.biz.rr.com)
[14:09:50] *** Joins: q66 (q66@7663D023.68E92A3E.A371049.IP)
[14:10:09] *** Quits: lkuper_ (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Ping timeout)
[14:10:13] <benh> eddyb: overloading with traits is a thing
[14:10:18] <ChrisMorgan> eddyb: Rust's overloading comes through generics and traits
[14:10:31] *** Joins: lmandel (lmandel@13F2CEC5.7672369.D8E68FF6.IP)
[14:10:34] <ChrisMorgan> And through the same technique, you can overload the return type.
[14:11:50] <benh> rusti: let i: Option<int> = from_str("42"); let f: Option<f64> = from_str("3.14159"); (i.unwrap(), f.unwrap())
[14:11:51] -rusti- (42, 3.14159f64)
[14:13:07] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[14:13:46] <eddyb> but in the same trait, I see a lot of really_long_names_that_are_required_because_no_overloading_used
[14:13:53] *** Joins: sk (sk@moz-82E9BD64.dynamic.vega-ua.net)
[14:13:58] *** Joins: autra (augustin@moz-2EA7A1DF.fullsix.com)
[14:15:04] <ChrisMorgan> As a matter of fact, the degree of return type overloading you can do is limited to being based on Self, as you can't currently impl both A<T1> and A<T2> for the one type; they're recognised as conflicting implementations even though they may not be (this is a known bug).
[14:15:13] <ChrisMorgan> eddyb: explicit is better than implicit.
[14:15:29] <ChrisMorgan> Normally such things are as they are by design.
[14:15:39] <eddyb> oh I know, but sometimes it's too explicit
[14:15:47] <ChrisMorgan> Example?
[14:16:22] <eddyb> I have to find it now, I've switched my mindset from the standard rust. that reminds me, I have to fix up my PR for better inline asm outputs
[14:16:30] <ChrisMorgan> :-)
[14:16:42] * ChrisMorgan should go to bed, it being 1:16am
[14:17:02] *** Joins: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net)
[14:17:32] <eddyb> ChrisMorgan: it also breaks generic composition
[14:17:56] *** Quits: lmandel (lmandel@13F2CEC5.7672369.D8E68FF6.IP) (Quit: lmandel)
[14:18:00] * ChrisMorgan is not certain what is meant by that name
[14:20:07] *** Joins: lmandel (lmandel@13F2CEC5.7672369.D8E68FF6.IP)
[14:20:16] *** Joins: sankha93 (Instantbir@A2199AC6.AA42D49B.2FB84AC6.IP)
[14:20:32] <eddyb> ChrisMorgan: if you have .method_with_foo and .method_with_bar just to distinguish between the argument types, then a generic function can't do .method(something_generic)
[14:21:00] *** Joins: dadan (Mibbit@moz-6E46D743.fei.tuke.sk)
[14:21:14] <ChrisMorgan> Ah, I perceive.
[14:21:19] *** Quits: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net) (Ping timeout)
[14:21:24] <eddyb> although it's possible overloading would not work at all in that scenario, with the static checks performed
[14:21:28] *** Quits: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca) (Quit: canhtak)
[14:24:01] *** Quits: q66 (q66@7663D023.68E92A3E.A371049.IP) (Quit: Leaving)
[14:26:57] *** Joins: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca)
[14:29:43] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[14:31:19] *** Quits: Florob (Florob@moz-39532932.de) (Client exited)
[14:31:58] *** Quits: sankha93 (Instantbir@A2199AC6.AA42D49B.2FB84AC6.IP) (Connection reset by peer)
[14:32:00] *** Joins: Skif (emschwar@moz-CA025D57.ip.mcleodusa.net)
[14:35:23] *** Parts: dadan (Mibbit@moz-6E46D743.fei.tuke.sk) ()
[14:36:53] *** Joins: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com)
[14:37:11] *** Joins: sankha93 (Instantbir@68CDE1B6.AA42D49B.2FB84AC6.IP)
[14:37:52] *** Quits: jaen (jaen@DD49A1EB.6A94545C.43DC2829.IP) (Ping timeout)
[14:41:02] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[14:42:46] *** Quits: MrOrdinaire (Mibbit@1A659656.A607747.FD383126.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[14:51:09] *** Joins: jaen (jaen@DD49A1EB.6A94545C.43DC2829.IP)
[14:51:24] * jdm wants labelled for loops
[14:52:40] <Ms2ger> Oh dear, what are you doing?
[14:53:00] <jdm> trying to break out of multiple inner loops
[14:53:04] <jdm> it's nicer without having a flag
[14:53:50] *** Quits: JanC__ (janc@moz-FAAB1DB5.dsl.scarlet.be) (Ping timeout)
[14:54:26] *** Joins: anshin (anshin@CD85F10D.F21429E2.354459FA.IP)
[14:54:35] *** Joins: gore06 (Mibbit@moz-D130B4E9.catv.broadband.hu)
[14:54:50] <gore06> good game look http://www.erepublik.com/en/referrer/gore06
[14:54:52] *** Parts: gore06 (Mibbit@moz-D130B4E9.catv.broadband.hu) ()
[14:55:24] <strcat> jdm: there are labelled breaks
[14:55:31] <strcat> they work in for loops now
[14:55:47] <jdm> maybe my syntax is wrong
[14:55:57] <jdm> 'loopname: for foo in bar { ... break 'loopname; } ?
[14:56:06] <strcat> loops right as far as I remember it
[14:56:10] <strcat> er
[14:56:12] <strcat> looks*
[14:56:16] <jdm> in that case it's probably just servo's old rust version
[14:56:39] <strcat> jdm: it didn't work right away with the new for loop because rustc had to be taught that it was now okay
[14:58:44] *** Quits: nkoep (nik@moz-BB78D201.vpn.rwth-aachen.de) (Ping timeout)
[14:59:06] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[15:01:25] *** Joins: FreeFull (freefull@31BCA4E6.5B0E29BE.159B5998.IP)
[15:05:11] *** Joins: tgummerer (tgummerer@moz-9FE3F44D.kthopen.kth.se)
[15:06:19] *** Quits: tgummerer (tgummerer@moz-9FE3F44D.kthopen.kth.se) (Client exited)
[15:08:51] *** Quits: xitology (xi@85437D54.5AFA3E4.CEDFC552.IP) (Quit: Ex-Chat)
[15:10:11] *** Joins: JanC__ (janc@moz-21724FF1.dsl.scarlet.be)
[15:13:36] *** Quits: Ferreus (ferreus@moz-2B3D1F31.dip0.t-ipconnect.de) (Ping timeout)
[15:14:13] *** Quits: Ms2ger (Ms2ger@moz-FFE05062.ugent.be) (Quit: bbl)
[15:15:42] *** Quits: samx (sami@moz-D9DA5773.dyn.optonline.net) (Quit: This computer has gone to sleep)
[15:17:07] *** Joins: nkoep (nik@moz-F875B28B.pool.mediaways.net)
[15:20:06] *** Joins: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net)
[15:21:57] *** Quits: DAddYE (DAddYE@moz-98D3933F.hsd1.ca.comcast.net) (Ping timeout)
[15:22:09] *** Quits: BitPuffin (isak@moz-98F8BF74.cust.tele2.se) (Ping timeout)
[15:22:15] *** Joins: simon (simon@moz-3AFED2F2.dsl.bell.ca)
[15:22:46] *** Joins: jeaye (Jeaye@moz-34FEF2BB.hsd1.ca.comcast.net)
[15:24:23] *** Quits: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca) (Connection reset by peer)
[15:24:27] *** Joins: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca)
[15:25:20] *** Quits: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[15:27:14] <ksf> what's in place in terms of gui?
[15:27:38] <ksf> and are there maybe plans to exploit servo for a native toolkit a bit like XUL?
[15:29:40] *** Joins: Voomer (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net)
[15:30:06] *** Joins: samx (sami@moz-D9DA5773.dyn.optonline.net)
[15:32:43] <eddyb> is C++ std::swap doable in Rust?
[15:32:53] <strcat> it exists as std::util::swap
[15:33:20] <eddyb> sweet, that means I can do atomic_compare_and_swap
[15:34:03] <jdm> ksf: "exploit servo"?
[15:34:11] <jdm> also don't mention XUL about us servo folk
[15:34:14] <jdm> our hackles raise
[15:34:18] <bstrie> haha
[15:34:19] <jdm> s/about/around/
[15:34:23] <strcat> eddyb: not with that swap
[15:34:27] <McPherrin> THERE IS ONLY XUL
[15:34:34] <strcat> there is an atomic_compare_and_swap defined in std::unstable::atomics
[15:34:51] <eddyb> strcat: I know, but I wasn't sure I can have the same pass-by-reference mechanic
[15:34:56] <strcat> oh
[15:35:01] <strcat> it just takes two &mut
[15:35:31] <eddyb> yeah, I was just afraid it required to pass a pointer
[15:36:37] <ksf> well, speaking from haskell experience not having a native toolkit is a major pain, and any layout engine that can deal with html5 will have no problems pushing a couple of widgets around the screen.
[15:37:26] <jdm> we're punting on the whole gui thing right now
[15:37:39] <jdm> we don't even have form widget
[15:37:40] <jdm> +s
[15:37:48] <eddyb> something like node-webkit is cool, if you can fully control the servo DOM from Rust, that would definitely be interesting
[15:39:02] *** Quits: busylizzy (lisa@85228838.12D0DC84.211374C4.IP) (Ping timeout)
[15:39:03] <jdm> yeah, we're big on the idea of headless, embeddable stuff
[15:40:03] <earlz2> Has anyone got rust (including compiler) running on the raspberry pi? 
[15:40:32] *** Quits: DeTeam (DeTeam@92C799C.31715274.F5F3AF2.IP) (Quit: DeTeam)
[15:40:42] *** Joins: jfbk (jfbk@moz-EEA9CFB3.nyc.res.rr.com)
[15:41:29] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[15:41:52] <jdm> earlz2: https://github.com/mozilla/rust/pull/6249
[15:42:04] *** Quits: shrughes (shrughes@moz-C34BE8E5.hsd1.ca.comcast.net) (Ping timeout)
[15:44:04] <earlz2> heh interesting that the early preliminary port required so little code. I guess that's the magic of LLVM
[15:44:34] *** Joins: busylizzy (lisa@85228838.12D0DC84.211374C4.IP)
[15:45:38] *** Quits: fran_ (fran@moz-F0E884F2.telecom.net.ar) (Ping timeout)
[15:46:25] <eddyb> strcat: it takes me a while every time to understand the exact semantics of compare&swap. it's basically a replace
[15:46:37] *** Joins: fran_ (fran@moz-1D786CE4.telecom.net.ar)
[15:51:15] *** Quits: jaen (jaen@DD49A1EB.6A94545C.43DC2829.IP) (Ping timeout)
[15:53:07] *** Joins: tiffany (kawaii@moz-28A8742A.dhcp.embarqhsd.net)
[15:53:33] *** Quits: sk (sk@moz-82E9BD64.dynamic.vega-ua.net) (Quit: Leaving)
[15:53:57] *** Quits: pnkfelix (pnkfelix@moz-813314A4.hsd1.ma.comcast.net) (Quit: Leaving.)
[15:55:43] *** zz_kimundi is now known as kimundi
[15:56:02] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[15:56:34] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[15:57:47] *** Joins: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net)
[15:58:19] *** Joins: tgummerer (tgummerer@moz-9FE3F44D.kthopen.kth.se)
[15:58:39] *** Joins: alan (alan@moz-FE02DD30.sat6.rackspace.com)
[15:58:44] *** Quits: jfbk (jfbk@moz-EEA9CFB3.nyc.res.rr.com) (Quit: )
[15:58:53] <eddyb> strcat: oooh, intrinsics::atomic_cxchg is a thing?
[15:59:05] <strcat> std::unstable::atomics
[15:59:26] <strcat> the intrinsics stuff is just how that is implemented
[16:00:16] <eddyb> I can't use std, and rust-core doesn't have them yet AFAIK
[16:00:18] *** Quits: martndemus (martndemus@moz-E30F5776.adsl.xs4all.nl) (Ping timeout)
[16:00:40] *** Joins: dherman (dherman@D8B9C081.E820043D.D4C04133.IP)
[16:00:40] *** ChanServ sets mode: +ao dherman dherman
[16:05:15] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Client exited)
[16:05:47] *** pmoore is now known as pmoore|away
[16:10:41] <Leo`> mhh... why does this (http://paste.placeholder.fr/show/469/) code compiles... but not this one ? http://paste.placeholder.fr/show/471/
[16:10:49] <Leo`> aren't casts allowed in constant expressions ?
[16:11:15] *** Joins: maik (maik@moz-974EF716.dip0.t-ipconnect.de)
[16:11:30] <strcat> Leo`: casts from extern fn to uint probably just aren't implemented in const exprs
[16:11:30] *** Joins: devbug (quassel@2D4E172D.4C8B6099.9B57EA59.IP)
[16:11:45] *** Quits: maik (maik@moz-974EF716.dip0.t-ipconnect.de) (Client exited)
[16:12:28] <Leo`> strcat: why ?
[16:12:48] <strcat> I guess no one has ever needed it so it wasn't ever implemented
[16:12:52] *** Quits: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net) (Ping timeout)
[16:12:53] <strcat> eddyb: I'll probably greatly expand the scope rust-core soon
[16:13:10] <Leo`> strcat: mh.
[16:13:40] <Leo`> strcat: should I file a bug ? unless there is a specific reason to disallow such exprs...
[16:13:46] <strcat> Leo`: yeah, should file an issue
[16:13:47] <bstrie> strcat: aha, bringing back libcore eh :)
[16:13:51] *** Joins: jxv (jxv@moz-8FB92450.lightspeed.irvnca.sbcglobal.net)
[16:13:59] <strcat> bstrie: https://github.com/thestinger/rust-core
[16:14:26] <strcat> more like a fork of the stdlib so I can work on language/codegen issues rather than struggling with libstd
[16:14:26] * bstrie read "stub standard" as "sub standard"
[16:14:28] *** Joins: Ms2ger (Ms2ger@D2CDF20A.29977EA1.187A1082.IP)
[16:14:56] <strcat> https://github.com/thestinger/rust-core/blob/master/core/vec.rs vectors with 6-7x faster push than ~[T], yay! ;p
[16:15:05] <bstrie> strcat: any plans on putting this in rust itself, as the foundation for libstd itself?
[16:15:09] <strcat> anyway they can be done better via jemalloc's experimental API
[16:15:34] <bstrie> strcat: is that with the new change the representation?
[16:15:37] <bstrie> *to
[16:15:46] <strcat> bstrie: well it's a pure library vector type for now
[16:15:48] <eddyb> strcat: so are you going to do a pullreq at some point, with the new vectors?
[16:16:00] <strcat> it's much harder to change ~[T]
[16:16:10] <strcat> eddyb: I'm working on changing the slice representation in the compiler/library atm
[16:16:14] <eddyb> embedded all over the place?
[16:16:16] <strcat> I just want to throw out ~[T] completely
[16:16:18] <strcat> eddyb: yeah
[16:16:30] <strcat> pcwalton liked the idea of throwing out ~[T]
[16:16:42] <eddyb> why not make the semantics of ~[T] a language item?
[16:16:49] <strcat> bstrie: it's just really hard to work in libstd, so I'm doing my own thing and will be pushing for moving the stdlib towards it
[16:16:55] <bstrie> I see
[16:16:56] <bstrie> makes sense
[16:17:08] <bstrie> would definitely be hard to experiment with all that baggage
[16:17:12] <strcat> bstrie: for example I have a bug open about changing the vector representation, but it has been a month already
[16:17:17] <eddyb> strcat: so what are we left with?
[16:17:27] <strcat> and even once there's consensus on it, it's going to be a huge pain to do
[16:17:32] <eddyb> strcat: static arrays and vectors?
[16:17:35] *** Quits: alonlevy (alon@moz-B0E66DB7.static.bezeqint.net) (Ping timeout)
[16:17:45] <strcat> slices, fixed-size arrays, Vec<T>
[16:17:47] *** Quits: lfox (lfox@moz-343B6F0C.nyc.biz.rr.com) (Quit: ZZZzzz…)
[16:17:51] <strcat> maybe
[16:18:11] <strcat> could keep around the ~[T] syntax but it's harder to fix the existing one than dropping in a new one
[16:18:50] *** Joins: jeffdb (jeff@moz-D13B6004.hsd1.ca.comcast.net)
[16:18:52] <eddyb> I feel like volunteering just to make that possible
[16:19:08] <strcat> https://github.com/thestinger/rust/commit/f139e5dcf9786bd710671ffee753e12aa8eceffb this is really hard. I have to keep compiling, tracking down segfaults or test failures by making little examples and looking at the IR and then tracing it to the source in trans
[16:19:36] <strcat> ~[T] has more compiler code than slices
[16:19:43] <strcat> although it's less spread out
[16:19:49] *** kimundi is now known as zz_kimundi
[16:20:18] <strcat> I can't figure out how to auto-slice a vector in constants
[16:20:26] <strcat> I see it implemented *right here* 
[16:20:32] *** Quits: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca) (Quit: canhtak)
[16:20:42] <strcat> rusti: static xs: [int, ..3] = [1, 2, 3]; static ys: &[int] = xs;
[16:20:43] -rusti- <anon>:9:55: 9:61 error: Illegal anonymous lifetime: only 'static is allowed here
[16:20:44] -rusti- <anon>:9          static xs: [int, ..3] = [1, 2, 3]; static ys: &[int] = xs;
[16:20:44] -rusti-                                                                 ^~~~~~
[16:20:44] -rusti- error: aborting due to previous error
[16:20:44] -rusti- application terminated with error code 101
[16:20:47] <eddyb> what's with stage0/not stage0?
[16:20:48] <strcat> rusti: static xs: [int, ..3] = [1, 2, 3]; static ys: &'static [int] = xs;
[16:20:49] -rusti- <anon>:9:72: 9:74 error: mismatched types: expected `&'static [int]` but found `[int, .. 3]` ([] storage differs: expected &'static  but found 3)
[16:20:49] -rusti- <anon>:9          static xs: [int, ..3] = [1, 2, 3]; static ys: &'static [int] = xs;
[16:20:51] -rusti-                                                                                  ^~
[16:20:54] -rusti- error: aborting due to previous error
[16:20:56] -rusti- application terminated with error code 101
[16:21:10] <strcat> eddyb: libstd has to continue working with the old compiler
[16:21:11] <eddyb> making sure self-hosting works across a runtime incompatibility?
[16:21:14] <strcat> yeah
[16:21:28] <strcat> after a snapshot the old ones get removed and the new ones become the only way
[16:22:53] *** Joins: jxs (textual@B255C435.91C73520.E55E926B.IP)
[16:23:40] <eddyb> strcat: can types be language items?
[16:23:54] <strcat> eddyb: yes but there are no cases of it at this point
[16:24:07] <eddyb> what if you do this with ~[T]?
[16:24:40] <strcat> could do that
[16:24:48] <eddyb> aaaaand maybe @T, but that might be harder
[16:24:53] <strcat> @T will be removed
[16:25:00] *** Joins: nejucomo (Adium@moz-434492BB.dsl.static.sonic.net)
[16:25:22] <strcat> the managed pointer types are currently close to useless because there's not actually a GC implementation or the compiler support needed to build one
[16:25:45] <eddyb> I want @T to be Rc<T>
[16:25:53] <strcat> it won't be
[16:26:07] <eddyb> (but only if I say so somewhere)
[16:26:09] <strcat> @T as it works now doesn't fit the reference counting use case well
[16:26:21] <strcat> because it does implicit copies, not move semantics
[16:26:28] <jxs> hey there, i am trying to install the rust compiler on osx 10.8.5 and it crashes after extracting rust-stage0/lib/librustllvm.dylib
[16:26:29] <eddyb> oh, I think I heard that mentioned before
[16:26:42] <strcat> eddyb: there will be a trait for overloading *x and &*x
[16:26:48] <strcat> and Rc will implement it
[16:27:00] <jxs> i am already compiling with VERBOSE=1 to get the error detail
[16:27:07] *** Quits: tgummerer (tgummerer@moz-9FE3F44D.kthopen.kth.se) (Ping timeout)
[16:27:14] <eddyb> strcat: shared_ptr in C++ at least has -> for member access
[16:27:38] <strcat> x.foo will work if *x is implemented
[16:27:42] <strcat> it's automatic
[16:27:51] *** Joins: pepper_chico (pepper_chi@5B1C9931.F07E9C90.2E5C92D8.IP)
[16:28:03] <eddyb> strcat: but how do you access the methods on Rc?
[16:28:15] *** Quits: simon (simon@moz-3AFED2F2.dsl.bell.ca) (Quit: class)
[16:28:17] <strcat> the same way as you always do
[16:28:31] <strcat> this is just how auto-deref works for any type
[16:28:34] <strcat> it's not specific to Rc
[16:29:13] <strcat> there are problems with how auto-deref works but I am not taking that on
[16:29:15] <eddyb> strcat: so x : Rc<T>; x.rc_method() won't work if T has rc_method implemented?
[16:29:35] <strcat> right, same as with ~T or other types
[16:29:50] *** Quits: Kauhsa (kauhsa@moz-A78B2D1A.fi) (Ping timeout)
[16:29:59] <strcat> anyway I'm not sure if auto-deref works on ~T
[16:30:03] <strcat> it might not for methods
[16:30:08] <eddyb> it does
[16:30:18] <strcat> ok so Rc is not in a different situation from ~T
[16:30:30] <strcat> if you have a method on ~T, it will mask a method on the underlying type
[16:30:31] <eddyb> but there ~ doesn't have methods
[16:30:32] <nejucomo> rusti: let s = ~[1,2,3]; x.len()
[16:30:32] *** Quits: ksf (ksf@moz-7753D06C.adsl.hansenet.de) (Ping timeout)
[16:30:32] -rusti- <anon>:9:27: 9:28 error: unresolved name `x`. Did you mean `s`?
[16:30:33] -rusti- <anon>:9          let s = ~[1,2,3]; x.len()
[16:30:33] -rusti-                                     ^
[16:30:34] -rusti- error: aborting due to previous error
[16:30:34] -rusti- application terminated with error code 101
[16:30:37] <strcat> eddyb: it does have methods
[16:30:40] <strcat> they're defined in std::owned
[16:30:50] <eddyb> strcat: aaaah, I see, owned-form-specific implementations
[16:31:17] <strcat> there aren't any interesting methods on it though and they all just delegate to an underlying method atm
[16:31:23] *** Joins: ksf (ksf@moz-91D7829C.adsl.hansenet.de)
[16:31:38] <strcat> but when there's a Pointer trait, there will be at least one interesting method on it
[16:31:51] <eddyb> okay, this feels better already :D
[16:31:52] <strcat> it's not really a problem related to Rc
[16:31:54] <strcat> it's a language issue
[16:32:02] <eddyb> yeah, I know
[16:32:06] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[16:32:59] *** Joins: jeffreybaird (jeffreybai@moz-ED3EF543.static.twtelecom.net)
[16:33:26] <strcat> rusti: static xs: [int, ..3] = [1, 2, 3]; let ys: &[int] = xs; ys
[16:33:29] -rusti- &[1, 2, 3]
[16:33:29] *** Joins: alonlevy (alon@moz-B0E66DB7.static.bezeqint.net)
[16:33:36] <strcat> rusti: static xs: [int, ..3] = [1, 2, 3]; static ys: &'static [int] = xs; ys
[16:33:37] -rusti- <anon>:9:72: 9:74 error: mismatched types: expected `&'static [int]` but found `[int, .. 3]` ([] storage differs: expected &'static  but found 3)
[16:33:37] -rusti- <anon>:9          static xs: [int, ..3] = [1, 2, 3]; static ys: &'static [int] = xs; ys
[16:33:37] -rusti-                                                                                  ^~
[16:33:37] -rusti- error: aborting due to previous error
[16:33:39] * strcat shrugs
[16:33:39] -rusti- application terminated with error code 101
[16:33:57] *** Quits: heftig (heftig@moz-2B5B0F54.dip0.t-ipconnect.de) (Ping timeout)
[16:33:58] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[16:34:27] *** Quits: ksf (ksf@moz-91D7829C.adsl.hansenet.de) (Ping timeout)
[16:34:31] <eddyb> strcat: one thing I thought of: SafeIfDesiredSharedPtr, either a raw pointer or Rc (if possible, with the refcount stored outside of the allocated structure itself), depending on a cfg option
[16:35:00] <mitchty> so if i wanted to staticly compile an executable in rust, which I built from source, how do I get the lib/rust version of libstd++ static .a built? seems to only build shared library versions of things
[16:35:22] <eddyb> strcat: even like that it would be kinda hard to implement, with Rc almost not being an option at all
[16:35:23] *** Joins: lfox (lfox@moz-343B6F0C.nyc.biz.rr.com)
[16:35:33] <eddyb> strcat: basically, I have a double-linked list in the heap allocator :P
[16:35:43] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[16:35:59] <strcat> eddyb: well you could just do it like extra::dlist
[16:36:11] <strcat> ~ ptr for the forward links, * ptr for the backwards ones
[16:36:17] <strcat> you would need a StrongRc/WeakRc pair
[16:36:22] <strcat> to do it with safe code
[16:36:39] <eddyb> is dlist safe?
[16:36:53] <strcat> externally safe
[16:36:56] <strcat> yes
[16:37:51] <eddyb> hmm, interesting. I probably shouldn't try to implement anything heap-allocated, maybe only in-place refcount, because it's in the heap allocator itself
[16:38:18] <eddyb> I had the brilliant idea of translating this to Rust http://pedigree-project.org/projects/pedigree/repository/revisions/master/entry/src/system/kernel/core/lib/SlamAllocator.cc
[16:38:38] *** Quits: jeffdb (jeff@moz-D13B6004.hsd1.ca.comcast.net) (Quit: jeffdb)
[16:39:03] <mitchty> aka libstd and librustrt both are links in the resultant executable I build with rustc --bin, want to statically link them both into the binary, is --disable-sharedstd enough in configure? not entirely sure here
[16:39:23] *** Joins: DAddYE (DAddYE@moz-61EB081B.hfc.comcastbusiness.net)
[16:39:53] <strcat> mitchty: you can't currently use the standard library and do static linking
[16:40:11] *** Joins: heftig (heftig@moz-A0106691.dip0.t-ipconnect.de)
[16:40:18] *** Quits: heftig (heftig@moz-A0106691.dip0.t-ipconnect.de) (Quit: Quitting)
[16:40:25] *** Joins: heftig (heftig@moz-A0106691.dip0.t-ipconnect.de)
[16:40:48] <mitchty> strcat: ah, boo, is there an issue for that perchance?
[16:41:04] <strcat> there is an issue about static linking, yes
[16:42:34] <strcat> hehe all the vector tests pass
[16:43:03] <mitchty> is it 3361 statically link the runtime to the core?
[16:43:24] <strcat> no
[16:45:15] <mitchty> http://github.com/mozilla/rust/issues/552 support static linking crates?
[16:45:48] <strcat> yes
[16:47:04] *** Quits: Ralith (ralith@moz-132F2FD4.sea.wa.customer.broadstripe.net) (Ping timeout)
[16:48:39] *** Quits: autra (augustin@moz-2EA7A1DF.fullsix.com) (Ping timeout)
[16:48:55] *** Joins: Ferreus (ferreus@moz-48071414.pools.arcor-ip.net)
[16:49:25] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[16:49:32] <eddyb> oh, this is bad, the old C++ code could do a nullptr refer if the atomic compare&swap failed because something put 0 there
[16:51:31] *** Joins: ksf (ksf@moz-760D4A5F.adsl.hansenet.de)
[16:52:07] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[16:52:28] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[16:52:39] *** Quits: jxs (textual@B255C435.91C73520.E55E926B.IP) (Quit: Textual IRC Client: www.textualapp.com)
[16:53:11] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[16:53:11] *** ChanServ sets mode: +ao brson brson
[16:53:47] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Connection reset by peer)
[16:53:58] *** Joins: bholley (anonymous@moz-D5EB36E2.rev.numericable.fr)
[16:54:01] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[16:54:04] <strcat> dbaupp: why does std::rand do this weird transmute thing?
[16:55:14] <eddyb> that issue is interesting, LTO is definitely something I'd love to see used in some places
[16:55:45] *** Quits: sankha93 (Instantbir@68CDE1B6.AA42D49B.2FB84AC6.IP) (Connection reset by peer)
[16:55:59] <strcat> if you're using rust-core in a single binary, you're using LTO
[16:56:06] <eddyb> imagine compiling and linking windows software with LTO against wine's libs which were linked with LTO against libc
[16:56:15] <eddyb> strcat: that's more like compile-time optimization :P
[16:56:23] <eddyb> (I think)
[16:56:47] <strcat> eddyb: LTO works like that anyway
[16:56:51] <ksf> well, there's two kinds of linking.
[16:56:59] <strcat> LTO isn't really 'linking'
[16:57:08] <strcat> if you use LTO, clang will output LLVM bytecode instead of traditional object files
[16:57:14] <strcat> and then it reloads them all and optimizes again
[16:57:29] <devbug> ^ iirc llvm.org has a relevant blog post on it
[16:57:32] <strcat> intel found that the step of compiling separate object files is slower than just building it all as a single blob
[16:57:32] <ksf> LTO while static linking as you'd do .o and .a files is trivial with llvm, lto with .so  is AFAIK an unsolved problem.
[16:57:43] *** Joins: thewonderidiot (mstewart@moz-E41129BA.ipnetworksinc.net)
[16:57:45] <ksf> after all, ld.so would need to be a compiler, then.
[16:57:52] <eddyb> strcat: oh, so it's linking before assembling?
[16:58:09] <ksf> yep.
[16:58:26] <bholley> acrichto: ping
[16:58:30] *** Joins: mikezaby (mikezaby@moz-908EA8DE.home.otenet.gr)
[16:58:34] <strcat> eddyb: 'linking' as in reading in a bunch of bytecode and basically concatenating it
[16:58:43] <strcat> like the llvm-link utility does
[16:58:52] <eddyb> well, yeah, if it's outputting bytecode, that's what I knew anyway
[16:58:55] <strcat> takes two IR/bytecode files and makes one
[16:59:02] <acrichto> bholley: pong
[16:59:12] <strcat> eddyb: the only reason for LTO existing is that you can build the object files in parallel, and it works with traditional build systems
[16:59:26] <strcat> but intel's parallel function pass stuff would obsolete traditional LTO for rust
[16:59:42] <bholley> acrichto: hey - I want to talk about supporting memory layout inheritance in rust, because I think it's a near-showstopper for Servo - is the meeting the right place to talk about that?
[16:59:46] *** Joins: Guest_ (textual@B255C435.91C73520.E55E926B.IP)
[16:59:48] <bholley> acrichto: or should I talk offline to pcwalton?
[16:59:49] <eddyb> "traditional" - isn't LTO somewhat new?
[17:00:02] <strcat> eddyb: not really new
[17:00:12] <strcat> afaik clang has nearly always supported it
[17:00:19] <bholley> acrichto: also - how do I call into the meeting?
[17:00:29] <strcat> eddyb: and you could always use llvm-link yourself
[17:00:29] <eddyb> as userbase, then
[17:00:33] *** Quits: ion (ion@heh.fi) (Ping timeout)
[17:00:37] <strcat> dunno
[17:00:42] <acrichto> bholley: hm, maybe should be brought up with pcwalton first (I don't work much on servo), but the meeting is in gigo
[17:01:08] <strcat> it's just not a useful thing for rust because we already have modules, so there's no benefit from backwards compatibility with object files
[17:01:12] *** Joins: sankha93 (Instantbir@68CDE1B6.AA42D49B.2FB84AC6.IP)
[17:01:12] <bholley> acrichto: would it be productive to talk about now? Or should I just wait and talk to patrick?
[17:01:18] <Guest_> hello
[17:01:19] * bholley doesn't see pcwalton on irc
[17:01:19] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[17:01:19] *** ChanServ sets mode: +o tjc
[17:01:20] *** Joins: themgt (themgt@moz-84498CCE.baf.movistar.cl)
[17:01:22] *** Guest_ is now known as jxs
[17:01:30] *** Joins: ion (ion@heh.fi)
[17:01:31] <strcat> parallelization of the build process is useful, but it can be at function level instead of the module level
[17:01:45] <acrichto> bholley: probably more productive to start offline I would guess
[17:01:50] <bholley> acrichto: ok
[17:01:51] <eddyb> there's a lot of uninlined calls to trivial stuff, and I saw some path transforms in wine that would be free if they were inlined with some constant strings
[17:01:51] <strcat> many functions optimized by a function pass thread pool vs. several modules built in parallel
[17:01:53] *** jxs is now known as joaoxsouls
[17:02:06] *** Joins: pnkfelix (pnkfelix@moz-B65AF445.hfc.comcastbusiness.net)
[17:02:07] *** ChanServ sets mode: +o pnkfelix
[17:02:11] <strcat> eddyb: rust doesn't have object files
[17:02:28] <joaoxsouls> hey there, i tried to install the rust compiler on osx 10.8.5 with home brew but it crashes while exctracting files
[17:02:52] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[17:03:12] <joaoxsouls> i have already tried gcc, raised the max open files on the kernel, and nothing
[17:03:17] <joaoxsouls> has anyone had this?
[17:03:17] <joaoxsouls> thanks
[17:03:33] <eddyb> strcat: yeah, I was just thinking of other uses of LTO
[17:07:24] *** Joins: bent|away (chatzilla@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:07:39] *** zz_kimundi is now known as kimundi
[17:08:47] *** Joins: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca)
[17:09:45] *** flaper87 is now known as flaper87|afk
[17:09:47] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[17:10:07] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[17:11:56] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[17:12:20] *** Joins: jfbk (jfbk@moz-EEA9CFB3.nyc.res.rr.com)
[17:12:58] *** Joins: victorporof (victorporo@F0C4852C.2484615.4A6B528C.IP)
[17:15:24] *** Joins: alisdair (textual@28441AAB.AC6E1995.F0AE27BD.IP)
[17:16:34] *** Quits: joaoxsouls (textual@B255C435.91C73520.E55E926B.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[17:16:36] *** Joins: riley (riley@8BA43816.9AA11D69.65DDFA89.IP)
[17:18:34] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[17:20:03] *** bent|away is now known as betn
[17:20:08] *** Quits: ofeldt- (ofeldt@moz-E7A7B54A.dip0.t-ipconnect.de) (Ping timeout)
[17:20:11] *** betn is now known as bent
[17:23:42] *** Joins: eholk (eholk@moz-BA312F07.crest.iu.edu)
[17:26:50] *** Joins: Ralith (ralith@A8995AA9.62B6AF6A.922221DB.IP)
[17:27:08] *** Quits: ion (ion@heh.fi) (Ping timeout)
[17:28:28] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[17:29:56] *** Quits: CarpNet (ac@moz-FD24B77.sohonet.co.uk) (Quit: Leaving)
[17:31:17] *** Joins: ofeldt (ofeldt@moz-38848B1A.dip0.t-ipconnect.de)
[17:31:54] *** Quits: jeffreybaird (jeffreybai@moz-ED3EF543.static.twtelecom.net) (Quit: jeffreybaird)
[17:32:56] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[17:36:20] <eddyb> rusti: unsafe {(0 as *int) + 5 as uint}
[17:36:21] -rusti- <anon>:9:17: 9:40 error: binary operation + cannot be applied to type `*int`
[17:36:21] -rusti- <anon>:9          unsafe {(0 as *int) + 5 as uint}
[17:36:21] -rusti-                           ^~~~~~~~~~~~~~~~~~~~~~~
[17:36:21] -rusti- error: aborting due to previous error
[17:36:21] -rusti- application terminated with error code 101
[17:36:32] <eddyb> rusti: unsafe {&(0 as *int)[5] as uint}
[17:36:33] -rusti- <anon>:9:18: 9:31 error: cannot index a value of type `*int`
[17:36:33] -rusti- <anon>:9          unsafe {&(0 as *int)[5] as uint}
[17:36:33] -rusti-                            ^~~~~~~~~~~~~
[17:36:33] -rusti- error: aborting due to previous error
[17:36:34] -rusti- application terminated with error code 101
[17:36:42] *** Joins: ion (ion@heh.fi)
[17:36:55] <eddyb> rusti: unsafe {(0 as *int)+(5 as *int) as uint}
[17:36:56] -rusti- <anon>:9:17: 9:48 error: binary operation + cannot be applied to type `*int`
[17:36:56] -rusti- <anon>:9          unsafe {(0 as *int)+(5 as *int) as uint}
[17:36:56] -rusti-                           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[17:36:56] -rusti- error: aborting due to previous error
[17:36:57] -rusti- application terminated with error code 101
[17:37:01] <eddyb> pffft
[17:38:01] <benh> rip, #! inner_attr syntax, we barely knew ye 
[17:38:21] *** Joins: Kauhsa (kauhsa@moz-A78B2D1A.fi)
[17:38:31] <Eridius> benh: hmm? Did something change?
[17:38:39] *** Quits: jdm (jdm@514D186.F3BBB17D.144F44FA.IP) (Ping timeout)
[17:39:01] <benh> #! and no brackets was being considered for inner attribute syntax but it doesn't look like it is getting consensus ;)
[17:39:09] <benh> problems involve ambiguity with shebangs
[17:39:14] <Eridius> yeah I know it was considered. I thought enough people disliked trailing ; that it had a good chance
[17:39:18] <Eridius> (personally, I'm happpy with #[foo];)
[17:39:35] *** Joins: jdm (jdm@88F51059.F3BBB17D.144F44FA.IP)
[17:39:35] *** ChanServ sets mode: +o jdm
[17:40:29] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[17:41:46] *** Joins: jeffreybaird (jeffreybai@moz-ED3EF543.static.twtelecom.net)
[17:42:31] *** Quits: Blub\w (wry@moz-30F84779.wireless.dyn.drei.com) (Quit: bb2m)
[17:44:14] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[17:45:28] <strcat> ugh another hard to track down issue
[17:45:33] <strcat> fatal runtime error: assertion failed: exit_status
[17:45:37] * strcat wonders how he broke this
[17:45:48] *** Joins: jordyd (jordyd@moz-421662E5.seg38.ucf.edu)
[17:46:16] <eddyb> rusti: unsafe {0+1 as *u8}
[17:46:17] -rusti- <anon>:9:19: 9:27 error: mismatched types: expected `<VI0>` but found `*u8` (expected integral variable but found *-ptr)
[17:46:17] -rusti- <anon>:9          unsafe {0+1 as *u8}
[17:46:17] -rusti-                             ^~~~~~~~
[17:46:17] -rusti- error: aborting due to previous error
[17:46:17] -rusti- application terminated with error code 101
[17:47:10] <kimundi> haha, attribute syntax is, like, a bikeshed singularity at this point
[17:47:30] *** Joins: tikue_ (tikue_star@2772A85E.EB08480C.689607DE.IP)
[17:47:38] <strcat> rusti: std::uint::max_value / 8
[17:47:39] -rusti- 2305843009213693951u
[17:47:48] <benh> kimundi: In retrospect maybe we shouldn't have picked a rust logo that's so reminiscent of a bicycle sprocket!
[17:47:53] <strcat> rusti: let xs = [1, 2, 3]; xs[2305843009213693951u]
[17:47:53] -rusti- task <unnamed> failed at 'index out of bounds: the len is 3 but the index is 2305843009213693951', <anon>:9
[17:47:53] -rusti- application terminated with error code 101
[17:47:59] <strcat> rusti: let xs = [1, 2, 3]; xs[2305843009213693952u]
[17:47:59] <kimundi> benh: :P
[17:47:59] -rusti- 1
[17:48:44] *** Quits: mikezaby (mikezaby@moz-908EA8DE.home.otenet.gr) (Input/output error)
[17:48:48] *** Joins: voxpopuli (fanservice@moz-FE161659.wv.cc.cmu.edu)
[17:49:19] * jensnockert hugs tjc, thanks for "Rust: A friendlier introduction" and the help yesterday. <3
[17:49:40] <tjc> jensnockert: you're welcome!
[17:50:38] *** Joins: q66 (q66@470AAFA1.9B6ACF79.CE12DF22.IP)
[17:50:45] <eddyb> rusti: 2305843009213693952u
[17:50:46] -rusti- 2305843009213693952u
[17:50:50] <eddyb> wait, what?
[17:50:55] <eddyb> rusti: 2305843009213693952u as u64
[17:50:55] -rusti- 2305843009213693952u64
[17:50:58] <eddyb> rusti: 2305843009213693952u as u32
[17:50:59] -rusti- 0u32
[17:51:12] <eddyb> strcat: why is it casting to u32?
[17:51:45] <kimundi> Maybe the sandbox is 32bit?
[17:51:48] <eddyb> nope
[17:52:00] <eddyb> kimundi: the u suffix means uint, which is uintptr_t
[17:52:19] <kimundi> right, that'S what I mean
[17:52:37] <eddyb> see above, it doesn't truncate the 64bit value
[17:52:40] <kimundi> rusti: std::sys::size_of::<uint>()
[17:52:41] -rusti- 8u
[17:53:02] <eddyb> even if the len is u32, it should cast the len to uint before comparing to the uint index
[17:53:09] *** Joins: Guest_ (textual@B255C435.91C73520.E55E926B.IP)
[17:53:10] <kimundi> Okay it's 64bit. Then it's indeed strange
[17:53:29] *** Guest_ is now known as joaoxsouls
[17:53:34] <eddyb> kimundi: it's probably doing u32(idx) >= len instead of idx >= uint(len)
[17:53:39] *** Joins: spider-mario (spidermari@moz-2F72F6FF.dsl.quantic-telecom.net)
[17:53:42] *** Joins: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP)
[17:53:44] <eddyb> rusti: 2305843009213693952u as i64
[17:53:45] -rusti- 2305843009213693952i64
[17:54:47] <strcat> eddyb: it's done wrong, I fixed it in my branch
[17:54:54] <eddyb> strcat: was I right?
[17:54:58] <strcat> no
[17:55:02] <strcat> it multiplies it by the size
[17:55:14] <strcat> and that can overflow
[17:55:17] <strcat> and *then* it compares
[17:55:18] <eddyb> ah, that explains why the large number
[17:55:29] <eddyb> rusti: unsafe {(5 as *SlamCacheNode) == 0}
[17:55:30] -rusti- <anon>:9:24: 9:37 error: use of undeclared type name `SlamCacheNode`
[17:55:30] -rusti- <anon>:9          unsafe {(5 as *SlamCacheNode) == 0}
[17:55:30] -rusti-                                  ^~~~~~~~~~~~~
[17:55:30] -rusti- error: aborting due to previous error
[17:55:30] -rusti- application terminated with error code 101
[17:55:35] <eddyb> err silly me
[17:55:38] <eddyb> rusti: unsafe {(5 as *int) == 0}
[17:55:39] -rusti- <anon>:9:32: 9:33 error: mismatched types: expected `*int` but found `<VI1>` (expected *-ptr but found integral variable)
[17:55:39] -rusti- <anon>:9          unsafe {(5 as *int) == 0}
[17:55:39] -rusti-                                          ^
[17:55:39] -rusti- error: aborting due to previous error
[17:55:39] -rusti- application terminated with error code 101
[17:56:28] <eddyb> that makes it tedious in unsafe code. maybe I should have a fn nullptr<T>() -> T* {0}
[17:56:36] *** Quits: voxpopuli (fanservice@moz-FE161659.wv.cc.cmu.edu) (Ping timeout)
[17:56:37] *** Joins: azakai (alon@moz-BBE3ABD.mv.mozilla.com)
[17:57:01] <Luqman> eddyb: there's std::ptr::null which is that
[17:57:30] <eddyb> strcat: I might end up overflowing my needs into rust-core, once rustic is setup to use it
[17:58:39] *** Quits: q66 (q66@470AAFA1.9B6ACF79.CE12DF22.IP) (Quit: Leaving)
[18:00:38] *** Quits: victorporof (victorporo@F0C4852C.2484615.4A6B528C.IP) (Connection reset by peer)
[18:01:02] *** Quits: dherman (dherman@D8B9C081.E820043D.D4C04133.IP) (Ping timeout)
[18:01:56] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Client exited)
[18:01:59] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[18:02:32] *** Quits: ksf (ksf@moz-760D4A5F.adsl.hansenet.de) (Ping timeout)
[18:02:40] *** Quits: jfbk (jfbk@moz-EEA9CFB3.nyc.res.rr.com) (Quit: )
[18:03:35] *** Joins: ksf (ksf@moz-20AC5A23.adsl.alicedsl.de)
[18:06:32] *** Quits: ksf (ksf@moz-20AC5A23.adsl.alicedsl.de) (Ping timeout)
[18:07:15] *** Joins: ksf (ksf@moz-B11331C1.adsl.alicedsl.de)
[18:07:22] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[18:07:51] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[18:19:13] *** Joins: q66 (q66@moz-2ED87582.got.public.icomera.com)
[18:19:29] <erickt> brson: ping
[18:19:59] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Client exited)
[18:20:19] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[18:22:00] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Ping timeout)
[18:23:07] *** Joins: ceninan (ceninan@moz-6BD43586.a370.priv.bahnhof.se)
[18:23:42] *** Quits: ceninan (ceninan@moz-6BD43586.a370.priv.bahnhof.se) (Quit: ceninan)
[18:25:02] *** Joins: ksf_ (ksf@moz-9DA86FE9.adsl.hansenet.de)
[18:25:35] *** Quits: ksf (ksf@moz-B11331C1.adsl.alicedsl.de) (Ping timeout)
[18:27:01] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[18:27:26] *** Quits: ksf_ (ksf@moz-9DA86FE9.adsl.hansenet.de) (Quit: Leaving)
[18:27:49] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[18:28:28] <Leo`> does Rustc optimizes away functions that are never called ? 
[18:28:44] <Leo`> i've got a function, but i don't see code for it in the resulting binary
[18:29:29] <benh> Is that a problem? (Tried making it pub and compiling to a library?)
[18:29:50] <Leo`> already the case. I compile my crate using the --lib flag, and the function is public
[18:30:04] <Leo`> it is a problem since i want to call it from extern code ...
[18:30:27] <tjc> Leo`: how are you seeing what names are in the resulting library? (are you just typing `nm` at the command line?)
[18:30:36] *** Quits: sankha93 (Instantbir@68CDE1B6.AA42D49B.2FB84AC6.IP) (Connection reset by peer)
[18:30:43] <doomlord_> llvm might handle that?
[18:30:43] <strcat> Leo`: you're likely just using the wrong symbol name, rust functions have their names mangled
[18:30:45] <Leo`> tjc: objdump
[18:30:54] <strcat> you need #[no_mangle] to avoid that
[18:31:02] <tjc> Leo`: Yeah, what strcat said, in that case
[18:31:04] <tjc> it's sort of a gotcha
[18:31:08] <strcat> #[no_mangle] extern "C" fn foo() { ... }
[18:31:24] <strcat> tjc: meh, it's not really, you have to know those low-level details to do unsafe low-level things ;p
[18:31:27] <Leo`> oh
[18:31:31] <Leo`> I forgot the extern C
[18:31:37] <tjc> strcat: well, a mild gotcha :-)
[18:31:40] *** Quits: themgt (themgt@moz-84498CCE.baf.movistar.cl) (Ping timeout)
[18:31:55] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[18:32:19] <Leo`> I had already tried the no_mangle, but I couldn't find my function, even with the mangled name
[18:32:32] <Leo`> (there are quite few functions in my crate, it's easy to browse them all)
[18:32:58] <strcat> it needs to be in the top-level module or a public module too
[18:33:04] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[18:33:07] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[18:33:17] <Leo`> mh
[18:33:24] *** Quits: q66 (q66@moz-2ED87582.got.public.icomera.com) (Quit: Leaving)
[18:33:35] <Leo`> a public module
[18:33:40] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[18:34:01] <Leo`> the module was not public currently, but re-exported in some ways using "use"
[18:34:11] <Leo`> so that is was accessible to the crate root
[18:34:14] <Leo`> isn't it sufficient ?
[18:34:32] <strcat> it should be sufficient but it might not be in practice
[18:35:06] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[18:35:08] <Leo`> ok, I passed the whole module hierarchy public, but I still don't see my function ._.
[18:35:41] *** Joins: sankha93 (Instantbir@68CDE1B6.AA42D49B.2FB84AC6.IP)
[18:38:17] *** Quits: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP) (Client exited)
[18:38:24] *** Joins: topspin (allenc@moz-3A4A8509.frii.com)
[18:39:06] <Leo`> strcat: fun thing, if I call this function from another, and then look at the binary, the function is still missing
[18:39:19] <strcat> Leo`: is it marked #[inline]
[18:39:24] <Leo`> but, if I look at the binary code generated for the callee, it looks like my function has bee inline
[18:39:26] <Leo`> no it's not...
[18:39:34] <Leo`> is there a #[no_inline] ... ?
[18:39:39] *** Joins: geoffhill (geoffhill@moz-244CF33A.amazon.com)
[18:39:46] <strcat> yes but that's not necessary
[18:40:01] <strcat> if it's external, LLVM won't remove it
[18:40:14] <Leo`> mhh... even with optimization flags enabled ?
[18:40:20] *** Quits: joaoxsouls (textual@B255C435.91C73520.E55E926B.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[18:40:32] <strcat> Leo`: it won't remove an external function, no matter what
[18:40:48] <Leo`> that's wierd.
[18:41:04] <Leo`> weird*
[18:41:23] <strcat> it can't remove an external function because the fact that it's external means it's part of an externally exposed API
[18:41:50] <Leo`> yes...
[18:41:52] *** Quits: olsonjeffery (pf@B8927AE1.CFEFA148.239A1A9E.IP) (Ping timeout)
[18:41:55] *** Quits: nuts_ (tii@822A8E7E.6AD15BF5.75D3BBDB.IP) (Connection reset by peer)
[18:42:02] <strcat> if you can narrow it down to a small reproducible test case it shouldn't be too hard to fix whatever rustc is screwing up
[18:42:16] <Leo`> mhhh
[18:42:39] <Leo`> even with no_inline the behaviour is the same
[18:42:42] <Leo`> this is really strange
[18:43:13] <strcat> #[inline(never)]
[18:43:32] <strcat> anyway it is only being removed by LLVM if it is marked as internal
[18:44:24] <Leo`> okay the #[inline(never)] works
[18:44:39] <strcat> works in what way?
[18:44:56] <strcat> it's callable externally? or you mean it appears as a symbol
[18:45:16] <Leo`> it appears as a symbol
[18:45:36] <Leo`> and, if I remove the -O flag, it also appears as a symbol, with or without the #[inline(never)]
[18:45:49] <strcat> yeah that's expected
[18:45:57] <strcat> rustc is tagging it as an internal function incorrectly
[18:46:01] <Leo`> so, the case that produces the bug is : no inlining indications, and -O flag providen
[18:46:12] <Leo`> I will see if I can reproduce it for a smaller example
[18:46:16] <strcat> but isn't it still an internal symbol either way?
[18:46:38] <Leo`> I don't know. what do you call internal symbol ?
[18:46:52] <Leo`> if it is seen by objdump it could be seen by the linker
[18:46:59] *** Quits: skade (skade@30BBD5E6.505237C9.CAE22B62.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[18:47:00] <Leo`> and thus called from extern code
[18:48:40] <Leo`> s/could/should/
[18:48:40] <brson> erickt: bbl
[18:53:32] *** Quits: barosl (barosl@3DE683B6.E551553C.7544CABF.IP) (Quit: 랜덤은 쇠퇴했습니다.)
[18:56:12] *** Quits: oberstet (quassel@moz-8165CA9A.dynamic.mnet-online.de) (Client exited)
[18:56:56] *** Quits: nano (nano@moz-74CAD1CA.superkabel.de) (Connection reset by peer)
[18:57:57] *** Quits: fran_ (fran@moz-1D786CE4.telecom.net.ar) (Ping timeout)
[18:59:24] <eddyb> oh wow lifetimes are awesome
[19:00:43] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[19:01:19] *** Quits: samx (sami@moz-D9DA5773.dyn.optonline.net) (Quit: This computer has gone to sleep)
[19:01:58] <earlz2> Is there any documentation on lifetimes yet and what they are best used for? 
[19:02:10] <earlz2> I think I found a reference to the syntax, but not much else
[19:02:35] *** Joins: vmx (vmx@8155E38.294C4FB6.EBB03D7A.IP)
[19:02:54] <strcat> earlz2: there is a borrowed pointer tutorial
[19:02:59] *** Joins: fran_ (fran@moz-BE1D1BA4.telecom.net.ar)
[19:03:07] <earlz2> yes, it didn't mention lifetimes though
[19:03:25] <earlz2> (lifetimes are the weird <'r> thing right?)
[19:03:44] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[19:04:13] <kimundi> The borrowed pointer tutorial should mention lifetimes though? 
[19:04:24] <kimundi> 'a is just an explicit named lifetime
[19:04:34] *** Quits: zenware (zenware@moz-D9635376.hsd1.il.comcast.net) (Ping timeout)
[19:04:34] <strcat> it does mention lifetimes
[19:04:41] <strcat> and it mentions named lifetimes
[19:04:54] <strcat> it doesn't go into depth about them, but it's there
[19:05:24] <eddyb> rusti: let x = [&int, ..3];
[19:05:26] -rusti- <anon>:9:19: 9:22 error: unresolved name `int`.
[19:05:26] -rusti- <anon>:9          let x = [&int, ..3];
[19:05:26] -rusti-                             ^~~
[19:05:26] -rusti- error: aborting due to previous error
[19:05:26] -rusti- application terminated with error code 101
[19:05:38] <eddyb> huh?
[19:05:41] <earlz2> ah you are correct
[19:05:42] <eddyb> err
[19:06:03] <eddyb> rusti: let x : [&int, ..3] = [/*I have no idea what I wanted to achieve*/];
[19:06:04] -rusti- <anon>:9:31: 9:76 error: mismatched types: expected `[&int, .. 3]` but found `[<V7>, .. 0]` ([] storage differs: expected 3 but found 0)
[19:06:04] -rusti- <anon>:9          let x : [&int, ..3] = [/*I have no idea what I wanted to achieve*/];
[19:06:04] -rusti-                                         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[19:06:04] -rusti- error: aborting due to previous error
[19:06:06] -rusti- application terminated with error code 101
[19:06:15] <earlz2> it is mentioned with a bit of explanation... somewhere in the main tutorial it should say "ok, this doesn't give you nearly enough, no go read these other tutorial sections to actually get started" heh
[19:06:40] <kimundi> rusti: let x : [&int, ..3] = [&5, ..3]; println!("{:?}", x);
[19:06:41] <strcat> they're linked at the bottom
[19:06:41] -rusti- [&5, &5, &5]
[19:06:42] -rusti- ()
[19:07:32] <kimundi> earlz2: The Tutorial definitely needs a restructuring/partial rewrite
[19:07:33] *** Quits: nkoep (nik@moz-F875B28B.pool.mediaways.net) (Ping timeout)
[19:07:39] <eddyb> how do I initialize a [T, ..N] using T::new(i) for i in range(0, N)?
[19:08:16] <eddyb> N is constant, but I don't want to write 32 lines for it
[19:08:45] <jeaye> vec::from_elem(T::new(), N)
[19:08:48] <kimundi> [T, ..N] is kinda a problem right now
[19:09:02] <kimundi> jeaye: That'S a ~[T] though
[19:09:02] *** Quits: fhahn (fhahn@moz-7924DB5C.vie.surfer.at) (Ping timeout)
[19:09:13] <jeaye> Might suffice. ^_^
[19:09:17] <eddyb> jeaye: nope
[19:09:21] <jeaye> mmk
[19:09:32] <eddyb> it's an fixed length array in a struct
[19:09:42] <kimundi> eddyb: The Problem is that we can't currently express the N in [T, ..N] generically, so it's impossible to write generic code that's using fixed sized vectors
[19:10:19] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[19:10:36] <kimundi> eddyb: You can write functions that work with specific values of N... fn foo<T>() -> [T, ..3], but that's it
[19:11:02] <kimundi> There really needs to be a solution for that, but I'm afraid that won't happen before 1.0 :P
[19:11:50] *** Joins: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net)
[19:11:59] *** Quits: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net) (Input/output error)
[19:12:09] <jack> so multiple featuresin #[feature(...)]; doesn't work yet?
[19:12:27] <jack> the compiler seems to use it, but glfw-rs uses two feature attributes.
[19:12:40] *** Joins: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net)
[19:12:47] <strcat> I think it works
[19:13:18] <eddyb> kimundi: hmm... any unsafe way I can do it?
[19:13:23] <sfackler> it works for me
[19:13:39] <sfackler> #[feature(macro_rules, struct_variant)];
[19:13:48] <jack> i get a build error if i do macro_rules, globs
[19:14:01] *** Joins: martndemus (martndemus@moz-876695FC.sshunet.nl)
[19:14:02] *** Quits: six600110 (six600110@moz-C663577C.hsd1.il.comcast.net) (Quit: Ex-Chat)
[19:14:07] <strcat> jack: maybe the compiler is too old?
[19:14:17] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[19:14:30] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[19:14:39] <kimundi> eddyb: You could unsafely create the array uninitialized, and then write to it in a loop/through a &mut[T] ? Not an expert with that though, it might be bad to do it like that. strcat?
[19:14:58] <jack> strcat: it's today's master i thought
[19:15:16] * strcat shrugs
[19:15:29] <zokier`> https://gist.github.com/zokier/6997067 why rustc can't find the method here?
[19:15:41] <strcat> eddyb: zero it and then loop through the mut_iter
[19:16:23] <strcat> rusti: let mut xs = [0, ..10]; for (i, x) in range(0, 10).zip(xs.mut_iter()) { *x = i; } xs
[19:16:24] -rusti- [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
[19:16:24] *** Quits: jeffreybaird (jeffreybai@moz-ED3EF543.static.twtelecom.net) (Quit: jeffreybaird)
[19:16:32] <strcat> it will optimize out the zeroing
[19:16:38] <strcat> fixed-size arrays just kind of suck
[19:16:40] <strcat> ;p
[19:17:10] *** Joins: fhahn (fhahn@moz-7924DB5C.vie.surfer.at)
[19:17:57] *** Quits: topspin (allenc@moz-3A4A8509.frii.com) (Ping timeout)
[19:17:59] *** Joins: topspin (allenc@moz-3A4A8509.frii.com)
[19:18:09] *** Quits: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[19:18:10] <eddyb> strcat: what about structures?
[19:18:18] <strcat> hm?
[19:18:24] <strcat> you have to initialize the whole structure
[19:18:26] <strcat> including the array
[19:18:35] <strcat> and then you can loop over the array to mutate it
[19:18:37] <eddyb> ok, that's what I'm rewriting it to
[19:18:53] <eddyb> only some integer parameters depend on i
[19:18:55] *** Joins: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net)
[19:19:01] <strcat> we would need range syntax in the compiler to deal with that
[19:19:12] <strcat> and it would just cover common cases
[19:19:34] <strcat> just a general problem with fixed-size arrays in a memory-safe language, you need to zero them first
[19:19:42] *** Quits: Skif (emschwar@moz-CA025D57.ip.mcleodusa.net) (Client exited)
[19:19:52] <strcat> unless it was some super complex dependently typed mess ;p
[19:20:48] *** Joins: Asa (asa@4508CAE6.38324963.204CA821.IP)
[19:21:20] *** Quits: aegeaner (Aegeaner@7F208F22.BD9EA362.4446104D.IP) (Quit: Leaving.)
[19:22:03] *** Joins: nkoep (nik@moz-C0F14C4.vpn.rwth-aachen.de)
[19:23:09] *** Quits: johns (johns@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[19:23:14] *** Joins: johns (johns@moz-BBE3ABD.mv.mozilla.com)
[19:23:40] *** Quits: nejucomo (Adium@moz-434492BB.dsl.static.sonic.net) (Quit: Leaving.)
[19:24:30] *** Joins: Skif (emschwar@moz-CA025D57.ip.mcleodusa.net)
[19:25:04] *** Joins: Houm (Houm@moz-25669AA8.fbx.proxad.net)
[19:27:52] *** Quits: Asa (asa@4508CAE6.38324963.204CA821.IP) (Ping timeout)
[19:28:33] *** Joins: Asa (asa@4508CAE6.38324963.204CA821.IP)
[19:33:21] *** Quits: Jackneill (Jackneill@moz-456ABFAA.pool.digikabel.hu) (Input/output error)
[19:33:32] *** Joins: jeffreybaird (jeffreybai@moz-ED3EF543.static.twtelecom.net)
[19:33:52] *** Quits: sankha93 (Instantbir@68CDE1B6.AA42D49B.2FB84AC6.IP) (Quit: Gone to save the world!)
[19:34:47] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[19:35:01] *** Joins: DeTeam (DeTeam@moz-76DDA368.dyn.broadband.iskratelecom.ru)
[19:35:08] *** Joins: nejucomo (Adium@moz-A94CACD5.dsl.pltn13.sbcglobal.net)
[19:35:08] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[19:36:09] <kmc> strcat: rustc already lets you declare variables uninitialized and then assign to them before use; presumably that analysis could be extended to the individual elements of a fixed size array, but it might be intractable to make it understand loops and such
[19:36:50] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[19:37:41] <tjc> kmc: we've talked about that before, it's kind of a non-starter
[19:37:44] <tjc> too much complexity
[19:37:47] <kmc> i feel like this could be done with symbolic execution a la KLEE, but that's a pretty big hammer
[19:37:50] <tjc> right
[19:37:59] <tjc> it *could* be done, we just don't want to make the analyses any more delicate
[19:41:46] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[19:42:01] <bblum> is there anything you could do with such an analysis that you can't do with vec::from_fn ?
[19:42:24] <strcat> bblum: well we are talking about fixed-size vectors
[19:42:27] <strcat> from_fn makes ~[T]
[19:42:34] <bblum> oh fixed-size
[19:44:11] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Client exited)
[19:44:32] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[19:45:52] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[19:46:20] *** Quits: spott (spott@moz-9B11536C.hsd1.co.comcast.net) (Ping timeout)
[19:46:45] *** Quits: eddyb (eddy@3C6E2DBB.FFB4E060.A5830293.IP) (Quit: Konversation terminated!)
[19:46:53] *** Joins: eddyb (eddy@3C6E2DBB.FFB4E060.A5830293.IP)
[19:48:54] *** Quits: eddyb (eddy@3C6E2DBB.FFB4E060.A5830293.IP) (Ping timeout)
[19:49:08] *** Joins: skade (skade@moz-4865967C.pools.arcor-ip.net)
[19:51:44] *** Joins: spott (spott@moz-9B11536C.hsd1.co.comcast.net)
[19:51:52] *** Joins: jvns (bork@87D98E32.4046EB22.428F94DD.IP)
[19:51:55] *** Quits: alonlevy (alon@moz-B0E66DB7.static.bezeqint.net) (Ping timeout)
[19:52:02] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[19:54:16] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[19:57:29] *** Quits: jeffreybaird (jeffreybai@moz-ED3EF543.static.twtelecom.net) (Quit: jeffreybaird)
[19:57:34] *** Joins: rust_noob (Mibbit@moz-3112320B.graz.surfer.at)
[19:58:12] <FreeFull> Worst case, you end up assigning dummy values to your mut variables
[19:59:48] <rust_noob> hi! I want to use all the types of the std::libc module, so I imported them globally with 'use std::libc::*;' on the top of my lib.rs file. but it gives me an error: 'error: glob import statements are experimental and possibly buggy' 1st question: are they really BUGGY anymore? because that seems to be strange...
[20:00:18] <FreeFull> rust_noob: I wonder if you could just do use std::libc;
[20:00:34] <strcat> 'use std::libc;' will just bring libc into the current scope
[20:00:48] <FreeFull> Ah, so no
[20:00:52] <strcat> rust_noob: you can enable glob imports if you want, or import them manually
[20:01:05] <rust_noob> how do I do that? ;)
[20:01:16] <strcat> FreeFull: it would just mean you'd be using 'libc::x' instead of 'std::libc::x'
[20:01:44] <strcat> rust_noob: it says in the error message as a note
[20:01:47] <strcat> #[feature(globs)]
[20:01:51] <rust_noob> I don't know where to put the '#[feature(globs)]'
[20:02:09] <strcat> at the top of the crate
[20:02:36] *** Quits: Ms2ger (Ms2ger@D2CDF20A.29977EA1.187A1082.IP) (Ping timeout)
[20:02:39] <rust_noob> ok thanks!
[20:02:50] *** Quits: jordyd (jordyd@moz-421662E5.seg38.ucf.edu) (Ping timeout)
[20:03:16] <brson> erickt: pong
[20:03:41] <benh> It has to be "#[feature(globs)];", not "#[feature(globs)]", right?
[20:03:52] <strcat> right
[20:03:59] <rust_noob> yep ;)
[20:05:29] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[20:05:40] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[20:05:47] *** Joins: dherman (dherman@D8B9C081.E820043D.D4C04133.IP)
[20:05:47] *** ChanServ sets mode: +ao dherman dherman
[20:06:03] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[20:06:42] <rust_noob> ok, another question: how do I disable a warning (eg. unused import) ?
[20:07:43] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Ping timeout)
[20:08:10] <rust_noob> is it #[warn(no_unused_imports)]; ?
[20:08:43] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[20:09:01] *** Joins: eddyb9 (eddy@3C6E2DBB.FFB4E060.A5830293.IP)
[20:09:21] *** Joins: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP)
[20:09:38] <brson> https://github.com/mozilla/rust/wiki/Meeting-weekly-2013-10-15
[20:09:42] *** Joins: bheylin (brianheyli@moz-8255E94E.adsl.online.nl)
[20:10:01] *** Joins: echristo (echristo@4EEA9249.D6CCE4AE.77834EAA.IP)
[20:11:44] <Amaranth> Ooh
[20:12:13] *** Quits: DeTeam (DeTeam@moz-76DDA368.dyn.broadband.iskratelecom.ru) (Quit: DeTeam)
[20:12:20] *** Quits: Voomer (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net) (Ping timeout)
[20:12:36] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[20:13:22] *** Joins: Voomer (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net)
[20:14:10] *** Joins: Voomer_ (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net)
[20:15:14] *** Quits: Voomer (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net) (Ping timeout)
[20:16:07] *** Quits: jvns (bork@87D98E32.4046EB22.428F94DD.IP) (Ping timeout)
[20:16:44] *** Joins: samx (sami@moz-D9DA5773.dyn.optonline.net)
[20:17:33] *** Quits: rust_noob (Mibbit@moz-3112320B.graz.surfer.at) (Quit: http://www.mibbit.com ajax IRC Client)
[20:19:36] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[20:19:38] <eholk> FromPrimitive doesn't automagically coerce literals into the type you want, does it?
[20:20:16] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[20:20:22] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[20:20:34] <kimundi> Not sure what you mean, but the answer is probably no
[20:21:04] <eholk> like `let x : my_num = 42`
[20:21:10] <eholk> i think the answer should be no
[20:21:13] <sfackler> not currently
[20:21:20] <eholk> even though it'd be nice at times...
[20:21:32] *** Quits: squiddy (squiddy@moz-3A4BC03C.adsl.alicedsl.de) (Ping timeout)
[20:21:44] <eddyb9> has anyone seen a lockfree multi-processor safe allocator?
[20:21:48] *** Joins: jfbk (jfbk@moz-EEA9CFB3.nyc.res.rr.com)
[20:22:19] <pnkfelix> eddyb9: such as: http://www.research.ibm.com/people/m/michael/pldi-2004.pdf ?
[20:22:27] <McPherrin> eddyb9: I think I've seen some papers, dunno if anybody has a production-grade one
[20:22:43] *** Joins: onix (Mibbit@moz-B234C23B.rev.numericable.fr)
[20:23:24] <pnkfelix> eddyb9: note that Norman Ramsey says there are bugs in the paper as published, see e.g. http://stackoverflow.com/questions/1995871/how-to-write-a-thread-safe-and-efficient-lock-free-memory-allocator-in-c
[20:24:34] <eddyb9> if sbrk() is locked, does it still count?
[20:24:47] <strcat> modern allocators don't use sbrk
[20:24:59] <strcat> they use thread-local pools on top of mmap/munmap
[20:25:24] <strcat> small allocation (with jemalloc, anything less than 4MiB) don't hit mmap directly
[20:25:39] <strcat> but at least on linux mmap has fine-grained locking
[20:26:07] *** Joins: Voomer__ (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net)
[20:27:21] <strcat> (it's still really slow compared to hitting the pool)
[20:27:44] *** Quits: Voomer_ (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net) (Ping timeout)
[20:29:12] *** Joins: adridu59 (Mibbit@moz-6C393FDD.rev.numericable.fr)
[20:30:14] <eddyb9> s/sbrk/mmap then
[20:30:41] <eddyb9> strcat: I wasn't sure if SlamAllocator was anything close to novel
[20:31:26] <strcat> eddyb9: https://en.wikipedia.org/wiki/Read-copy-update this is what mmap in the linux kernel does
[20:32:34] <strcat> eddyb9: http://www.facebook.com/notes/facebook-engineering/scalable-memory-allocation-using-jemalloc/480222803919 and http://www.canonware.com/download/jemalloc/jemalloc-latest/doc/jemalloc.html cover jemalloc well (and tcmalloc is basically the same stuff)
[20:32:40] <adridu59> acrichto: done :)
[20:33:09] <adridu59> strcat: do you know some about pandoc?
[20:33:12] <SiegeLord> So are inner doc comments going to be /*^ now?
[20:33:26] <pnkfelix> SiegeLord: We didn't make a final decision
[20:33:31] <eddyb9> in the process of converting from C++ to Rust, I've stripped it down of all the debugging features and overzealous checks (we had a Heisenbug related to 0xb00b1e55)
[20:33:34] *** Joins: zenware (zenware@569FDF56.892ADE04.D92E75BF.IP)
[20:33:40] <pnkfelix> SiegeLord: but I think we're working our way towards consensus
[20:33:52] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[20:33:59] *** Quits: pepper_chico (pepper_chi@5B1C9931.F07E9C90.2E5C92D8.IP) (Quit: Ex-Chat)
[20:34:41] <eddyb9> strcat: and I'm actually understanding this SlamAllocator (a slab variant, but I think it's not the same as the SLAM I found on google)
[20:34:44] *** Quits: nejucomo (Adium@moz-A94CACD5.dsl.pltn13.sbcglobal.net) (Quit: Leaving.)
[20:35:02] <eddyb9> it's simple, but I'm not sure if it's worth anything to anyone
[20:35:46] *** Quits: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[20:36:35] <strcat> eddyb9: you're not linking against libc, right?
[20:36:52] <eddyb9> nope, in a kernel
[20:37:29] <eddyb9> I'll show you when it's done, but I want a dumb linear always increment allocator using a static heap, and SlamAllocator on top of it
[20:37:41] <strcat> eddyb9: can you check if 'extern "rust-intrinsic" { fn abort() -> !; }' works for you?
[20:37:59] <strcat> (as in actually using it)
[20:38:16] <eddyb9> the dumb allocator can be switched out at runtime with a VMM allocator
[20:38:21] *** Quits: DanC (connolly@moz-CAC8C247.dyn.everestkc.net) (Ping timeout)
[20:38:29] <eddyb9> strcat: sorry, on the phone atm :(
[20:39:11] <eddyb9> so what does jemalloc need? just mmap/munmap? (which would translate to VMM in the kernel)
[20:39:21] *** Quits: martndemus (martndemus@moz-876695FC.sshunet.nl) (Ping timeout)
[20:40:11] <strcat> eddyb9: maybe mremap
[20:40:33] <eddyb9> I think this describes slam http://pedigree-project.org/projects/pedigree/wiki/SlabDraft
[20:40:46] <strcat> jemalloc is defenitely not simple though
[20:40:54] <strcat> it's like 20k lines of code
[20:41:11] <adridu59> bstrie: ping
[20:41:37] <bstrie> adridu59: pong
[20:41:46] *** Joins: BitPuffin (isak@moz-98F8BF74.cust.tele2.se)
[20:42:02] *** Joins: olsonjeffery (pf@B8927AE1.CFEFA148.239A1A9E.IP)
[20:42:08] <SiegeLord> Another thing from the meeting... I'm not quite getting what was decided about multi-crate repositories
[20:42:24] <SiegeLord> To what extent will they be allowed?
[20:42:37] <eddyb9> strcat: nvm that link, it's large allocation sizes, not lockfree
[20:42:41] <adridu59> bstrie: do you have some knowledge over codemirror js?
[20:42:54] *** Joins: voxpopuli (fanservice@moz-FE161659.wv.cc.cmu.edu)
[20:43:28] <eddyb9> codemirror :(? you make me sad I didn't finish my small but powerful kate-like editor
[20:44:04] <adridu59> there's a small bug that needs fixing but I don't have enough js knowledge for this (not like I spent time on that problem, but..à
[20:44:10] <adridu59> https://github.com/adridu59/rust/commit/ded910f46a0414b26da0694b3a4311230e75af8c#diff-0
[20:44:36] *** Joins: jvns (bork@87D98E32.4046EB22.428F94DD.IP)
[20:44:41] *** Joins: six600110 (six600110@moz-C663577C.hsd1.il.comcast.net)
[20:44:54] <eddyb9> (which used my KateSyntax.js project which generated js code for highlighting based on kate syntax files)
[20:44:59] <adridu59> the actual problem is that codemirror trys to parse 'static or 'self as string, but fails (thus adding a red "error" highlight)
[20:45:02] <bstrie> adridu59: haha, actually what I do when I want to change the rust snippet is paste the code into the web editor at the codemirror web site, then copy out the page's html :P takes some editing, though
[20:45:05] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[20:45:27] <bstrie> ah I see
[20:45:51] <adridu59> bstrie: haha no I'm not willing to change the website snippet :)
[20:46:08] <SiegeLord> The lifetime syntax is tricky to highlight
[20:46:13] <adridu59> a cheap way to fix it would be to remove the error on ' parsing
[20:46:34] *** Quits: zenware (zenware@569FDF56.892ADE04.D92E75BF.IP) (Ping timeout)
[20:46:36] *** Quits: sw17ch (sw17ch@moz-62998E95.hfc.comcastbusiness.net) (Quit: sw17ch)
[20:46:51] <adridu59> think I'll just open up a new issue for it
[20:46:54] <bstrie> adridu59: no I'm not familiar with the codemirror code, sorry. the author of codemirror himself wrote that code, he was actually a paid rust developer for a while :P
[20:47:02] <SiegeLord> That and the >> token have been probably the trickiest in making work for Geany highlighter/code parser
[20:47:04] <adridu59> bstrie: wow!
[20:47:05] <eddyb9> strcat: I give you the great James Molloy (beware, he could've been drunk) http://forum.osdev.org/viewtopic.php?f=15&t=20878
[20:47:27] *** Joins: nejucomo (Adium@moz-434492BB.dsl.static.sonic.net)
[20:47:30] *** Quits: nejucomo (Adium@moz-434492BB.dsl.static.sonic.net) (Quit: nejucomo)
[20:47:52] <eddyb9> strcat: no, that's the same thing. wtf, I thought SlamAllocator was nifty because lockfree
[20:47:58] <adridu59> it's admittedly hard to dig through the history because a lot of files have been moved at some point
[20:48:10] *** Joins: nejucomo (Adium@moz-434492BB.dsl.static.sonic.net)
[20:49:24] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[20:50:14] <eddyb9> I want numeric arguments in generics (like C++ templates) now :/
[20:50:58] <bstrie> eddyb9: lots of people do :)
[20:51:01] <bstrie> rust 2.0
[20:51:08] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[20:51:22] <SiegeLord> Well, more like rust 1.0+
[20:51:37] <SiegeLord> I'm sure they'll be done before 2.0 is released :P
[20:51:55] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[20:51:58] <benh> parsing expressions in type parameter lists <o>
[20:52:05] <tikue_> what are numeric arguments in generics?
[20:52:45] <strcat> they're a step on the road to a turing tarpit type system
[20:52:46] <kmc> template <size_t N> class Vec { ... }
[20:52:47] <strcat> ;p
[20:52:54] *** Quits: bholley (anonymous@moz-D5EB36E2.rev.numericable.fr) (Quit: bholley)
[20:53:13] <tikue_> what is it used for?
[20:53:16] <eddyb9> strcat: I'd be fine with pulling statics from cfg for now
[20:53:18] <SiegeLord> Oh yeah... what does this mean: "we have ~9 months to change our mind before we set it in stone"
[20:53:18] <kmc> fixed size vectors ;P
[20:53:24] <aatch> strcat, eh, not that big a deal...
[20:53:24] <kmc> nothing wrong with being a turing tarpit, most interesting systems are
[20:53:26] <bstrie> SiegeLord: from where?
[20:53:26] <SiegeLord> Is Rust 1.0 scheduled for next summer?
[20:53:26] <strcat> and small vectors
[20:53:35] <SiegeLord> bstrie: Meeting notes
[20:53:45] <eddyb9> strcat: I read the forum post, and he named it SLAM after it was multiprocessor and lockfree
[20:53:46] <kmc> unlike C++ we have not-terrible metaprogramming features so people won't (?) be tempted to use the tarpit as one
[20:53:49] <bstrie> SiegeLord: next summer sounds like a reasonable timeframe, given our newfound commitment to actually having a stable release
[20:53:58] <benh> kmc: we do?
[20:54:02] <SiegeLord> Sweet
[20:54:02] <strcat> we don't really
[20:54:06] <benh> rusti: macro_rules! blah { }
[20:54:09] -rusti- pastebinned 6 lines of output: http://ix.io/8us
[20:54:10] <strcat> C++ has better metaprogramming support than rust
[20:54:18] <benh> aw
[20:54:27] <kmc> well Rust macros do need some work, but they're already pretty nice
[20:54:27] <benh> was hoping for the #[feature] spiel
[20:54:43] <aatch> I actually like C++ template metaprogramming.
[20:54:44] <strcat> enable_if, decltype (typeof), integers in templates, constexpr (which is fairly unrestricted with C++14)
[20:54:46] <kmc> and in general I would rather use a real macro system than fake one using templates
[20:54:55] <strcat> templates are often nicer than macros
[20:55:01] <strcat> they're aware of the types
[20:55:39] <aatch> I guess I fall in the UNIX philosophy of "We don't stop our users from doing something stupid because that might stop them from doing something clever"
[20:55:46] *** Quits: spider-mario (spidermari@moz-2F72F6FF.dsl.quantic-telecom.net) (Ping timeout)
[20:56:07] *** Joins: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net)
[20:56:09] <eddyb9> aatch: as long as it can be proven safe, I wants it in Rust :P
[20:56:34] <strcat> kmc: for example, it's easy to write a type-safe variadic zip iterator in C++11
[20:56:36] <benh> strcat: oh, you've been unbanned by ix.io? :)
[20:56:40] <strcat> benh: yes
[20:56:44] <strcat> it expired I guess
[20:56:54] <strcat> I think we broke sprunge.us for a while
[20:57:00] <benh> :(
[20:57:20] <kmc> aatch: and I basically agree, which is why I started by saying I don't think it's bad if the generics system becomes turing complete
[20:57:20] * strcat is open to suggestions about a different paste site ;p
[20:57:24] <aatch> eddyb9, fair enough. It should be fine for simple constants, it's more the issue of 1) parsing and 2) fitting it into the type system.
[20:58:00] *** Joins: alonlevy (alon@moz-697DD27F.bb.netvision.net.il)
[20:58:06] <eddyb9> aatch: again, tempted to try and implement it
[20:58:23] <eddyb9> I should resist taking on something large
[20:58:28] *** Quits: jxv (jxv@moz-8FB92450.lightspeed.irvnca.sbcglobal.net) (Ping timeout)
[20:58:57] <benh> Can't we just have associated items and pass numeric constants via associated constants in some types ;)
[20:59:23] <kmc> although often "we don't stop users from doing something stupid" is code for "we don't bother providing tools to help users avoid doing stupid things"
[20:59:51] <benh> I kinda figure that having a powerful generics system lets people avoid falling back to the surely-even-more-powerful macro system
[21:00:00] <thewonderidiot> tjc: ping
[21:00:01] <kmc> but anyone interested in Rust probably understands how that's bad :)
[21:00:19] <eddyb9> C++11 lets you have something as "foobar"_md5_u64 as a constexpr value, I think
[21:00:19] <tjc> thewonderidiot: pong
[21:00:34] <thewonderidiot> tjc: what distro(s) of linux are you testing rustpkg on?
[21:00:44] *** Joins: zenware (zenware@470ADAFA.537A73B5.DF43B824.IP)
[21:00:50] <tjc> thewonderidiot: Right now, whatever is running on our test automation bots --
[21:00:56] *** Quits: adridu59 (Mibbit@moz-6C393FDD.rev.numericable.fr) (Quit: http://www.mibbit.com ajax IRC Client)
[21:00:56] <strcat> eddyb9: yeah, it does
[21:01:01] <eddyb9> although only haskell people would enjoy turning a hash function like that into a recursive form
[21:01:23] <strcat> although they didn't allow using a variadic template with user defined literals
[21:01:27] <eddyb9> constexpr tuples would help
[21:01:29] <tjc> thewonderidiot: I believe most of them run CentOS, but the one that fails all the time might have a different distro
[21:01:32] <tjc> (I still can't log in to it)
[21:01:33] <strcat> if they did, you could write a compile-time checked format string
[21:01:47] <thewonderidiot> tjc: hm, alright. For what it's worth, I'm on Arch, which defaults to using tmpfs for /tmp
[21:02:04] <benh> I'm still sad that the macro system didn't easily let me accept an expression as a macro argument and then pattern-match against the ast of that expression :>
[21:02:06] <tjc> thewonderidiot: that's useful to know, thanks; it should at least be possible for me to find out what CentOS does, and if it's different, that's a hint
[21:02:08] <thewonderidiot> tjc: I think centos and ubuntu both default to just putting /tmp on the root fs
[21:02:45] <eddyb9> strcat: you can get the characters as variadic template params
[21:02:58] *** Joins: josh (josh@moz-E500C116.mpls.qwest.net)
[21:03:09] <eddyb9> strcat: and then you can do constexpr / template recursion
[21:03:20] <aatch> benh, because it's not exactly an AST that you get, it's a token tree.
[21:03:26] <thewonderidiot> tjc: if you do a "df" in the terminal it should tell you what filesystems are present -- look for /tmp being a tmpfs
[21:03:47] <eddyb9> strcat: if nobody tried it, I could maybe implement format strings with some template magic
[21:03:52] *** Quits: zenware (zenware@470ADAFA.537A73B5.DF43B824.IP) (Ping timeout)
[21:03:53] <benh> aatch: yeah... I was looking at how I'd do it in a syntax extension and apparently there's a helper that would parse the token tree into an expr
[21:04:02] <tjc> thewonderidiot: Hmm, it seems to be tmpfs on linux1 (which runs CentOS) too
[21:04:11] <benh> but then I ran into trouble with hygiene among other things and gave up
[21:04:14] <thewonderidiot> oh weird
[21:04:27] <pauls> benh: What you have is kind of an interesting idea, though I'm not sure if there's any reasonable way to do it...
[21:04:50] <eddyb9> strcat: if I had time I would do so much magic...
[21:04:54] <pauls> ...my worry is that it'd have to boil down to "the user explicitly chooses which behavior to do"
[21:05:13] <eddyb9> strcat: right now I'm happy I understand SLAM and it's simple and quite powerful
[21:05:15] *** Parts: AlisonW (AlisonW@moz-7CEB14F7.hari.cable.virginmedia.com) ()
[21:05:38] <thewonderidiot> tjc: are you sure that's /tmp and not /dev/shm?
[21:05:50] <benh> pauls: I've gushed about it before, but my "introduction to macros that weren't just the C preprocessor" was the Nemerle language, and now I can't help but compare all metaprogramming to it :(
[21:05:51] <pauls> ...but if you have an idea for how to deal with the two competing interpretations, you should file about it.
[21:05:57] <strcat> thewonderidiot: /tmp is a tmpfs on a modern linux distro
[21:06:05] <eddyb9> strcat: hmm, if I have my malloc in Rust, can it get inlined all the way from a call?
[21:06:13] <strcat> you're supposed to use $XDG_RUNTIME_DIR as a user level temporary directory though
[21:06:20] <tjc> thewonderidiot: Ah, you're right
[21:06:38] <tjc> strcat: I guess CentOS 6.0 isn't modern (I have no idea, I didn't set up that machine :-)
[21:06:38] <thewonderidiot> strcat: I know, but CentOS tends to lag behind "modern"
[21:06:44] <aatch> eddyb9, in theory yes.
[21:06:56] <strcat> thewonderidiot: ah
[21:07:01] <eddyb9> so the log2 becomes free
[21:07:03] <tjc> thewonderidiot: okay, getting warmer and warmer :-) I can confirm it once I'm able to get in touch with Graydon to get the login info for linux2
[21:07:10] <strcat> eddyb9: sure, it can
[21:07:14] <thewonderidiot> tjc: great! :)
[21:07:16] *** Joins: themgt (themgt@moz-84498CCE.baf.movistar.cl)
[21:07:18] <tjc> thanks for the help!
[21:07:22] <thewonderidiot> sure thing!
[21:07:32] <strcat> eddyb9: as long as you don't use crates, it's a single giant LLVM bytecode module
[21:07:39] *** Quits: a__ (a__@moz-4CC03B10.nycmny.fios.verizon.net) (Ping timeout)
[21:08:15] <strcat> i.e. whole program optimization
[21:08:24] * benh wonders how much improvised CS education catchup he'd have to do to understand all the complexities of the macros system
[21:08:48] <eddyb9> strcat: the cost for an allocation is a compare&swap + a few reads & writes, when there's enough space in the cache
[21:08:57] *** Joins: q66 (q66@moz-463E955C.range86-148.btcentralplus.com)
[21:08:58] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[21:09:15] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[21:09:17] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[21:10:44] *** Quits: q66 (q66@moz-463E955C.range86-148.btcentralplus.com) (Ping timeout)
[21:10:47] *** Quits: jvns (bork@87D98E32.4046EB22.428F94DD.IP) (Connection reset by peer)
[21:10:49] *** Joins: jvns_ (bork@87D98E32.4046EB22.428F94DD.IP)
[21:11:14] <McPherrin> benh: The solution to any learning problem is a good textbook and a big box of amphetamines.
[21:11:26] *** Joins: ksletten (Mibbit@moz-D5513CBA.static.snlo.ca.charter.com)
[21:11:39] <McPherrin> Dunno what book to recommend for the macros system though :P
[21:12:10] <zokier`> "error: failed to find an implementation of trait A for ~A:Send" wait what, this sounds just weird
[21:12:39] <aatch> zokier`, trait objects don't implement themselves
[21:12:54] <eddyb9> strcat: so yeah, I asked about allocators in the first place because I have a simple&(maybe) fast lockfree multiprocessor allocator and it only needs a way to get free pages (like from a static heap). would it be useful to anyone?
[21:12:57] <aatch> Since it's not always possible to do so.
[21:13:31] <aatch> eddyb9, so a basic slab allocator?
[21:13:36] <strcat> eddyb9: dunno :)
[21:13:56] *** Joins: q66 (q66@moz-463E955C.range86-148.btcentralplus.com)
[21:14:07] <aatch> It might fit into extra, I know there's an arena thing in there, but like most of extra it needs significant work
[21:14:13] *** Joins: jxv (jxv@moz-8FB92450.lightspeed.irvnca.sbcglobal.net)
[21:14:26] <strcat> I don't think we should add anything else to libextra
[21:14:50] <strcat> should either kick it out to other repos or stabilize + move to libstd
[21:15:01] <eddyb9> aatch: it's not basic, there's two changes (not sure about the lockfree thing, but it does better for larger objects)
[21:15:08] <strcat> it's weird having two levels of standard libraries
[21:15:19] <strcat> (in the same repo)
[21:15:29] <eddyb9> aatch: I'm asking strcat because his rust-core might benefit from this
[21:15:53] <eddyb9> no need for it in rust itself
[21:17:11] <eddyb9> strcat: I'll bug you more when I finish the flexible Allocator interface
[21:18:03] <eddyb9> oh, btw, is there any constexpr sizeof equivalent that I can use?
[21:18:12] <strcat> no
[21:18:43] *** Joins: zenware (zenware@470ADAFA.537A73B5.DF43B824.IP)
[21:18:47] <ksletten> Trait question: At one time, I thought that I read that you can only implement a trait on a type in either one's declaring crate. Is that the case?
[21:18:56] <eddyb9> no instrinsics? or they don't work in constexprs either?
[21:19:48] <strcat> eddyb9: intrinsics don't work in constexpr
[21:19:53] <strcat> size_of/align_of are intrinsics
[21:20:10] <eddyb9> rusti: static sz : uint = sys::size_of<int>(); sz
[21:20:13] -rusti- pastebinned 16 lines of output: http://ix.io/8ut
[21:20:32] <strcat> they are regular functions externally
[21:20:40] <strcat> the magic of intrinsics is that trans generates the body
[21:21:32] <eddyb9> I wish I could at least alias the sizeof expression, like a C #define
[21:21:51] <zokier`> rusti: trait A { fn a(); } struct B; impl A for B { fn a() {} } (~B as ~A).a();
[21:21:53] -rusti- pastebinned 7 lines of output: http://ix.io/8uu
[21:21:59] <strcat> eddyb9: a macro?
[21:22:09] <eddyb9> rusti: enum foo {bar = sys::size_of<int>()} bar
[21:22:11] -rusti- pastebinned 16 lines of output: http://ix.io/8uv
[21:22:25] <eddyb9> strcat: wouldn't a macro be overkill?
[21:22:41] <strcat> a function then
[21:23:11] <eddyb9> maybe I can write an accessor-style method or a static function
[21:24:06] <eddyb9> good think I don't need it for a fixed vector length (the only numerically parametric type I know of)
[21:24:39] <zokier`> oh damnit, maybe I should read the tutorial more carefully before banging my head against the wall
[21:25:02] <strcat> ughhhh this code is so messy
[21:25:18] <strcat> messy as in what it had to deal with before was a mess ;p
[21:25:26] *** Quits: pnkfelix (pnkfelix@moz-B65AF445.hfc.comcastbusiness.net) (Quit: Leaving.)
[21:25:35] *** Joins: pnkfelix (pnkfelix@moz-B65AF445.hfc.comcastbusiness.net)
[21:25:35] *** ChanServ sets mode: +o pnkfelix
[21:25:59] *** Quits: jxv (jxv@moz-8FB92450.lightspeed.irvnca.sbcglobal.net) (Ping timeout)
[21:28:22] *** Quits: ksletten (Mibbit@moz-D5513CBA.static.snlo.ca.charter.com) (Quit: http://www.mibbit.com ajax IRC Client)
[21:29:24] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[21:31:27] <pauls> benh: ("file a bug about it", I mean, not "file about it".)
[21:31:57] <benh> I figured; I don't think I have a good enough grasp on the macro system to propose a concrete change here :)
[21:32:42] <pauls> I'll be happy to hash it over sometime, but now, as I am busy.
[21:33:44] *** Quits: alonlevy (alon@moz-697DD27F.bb.netvision.net.il) (Ping timeout)
[21:34:07] <eddyb9> strcat: hmm, the actual reclaiming algorithm isn't implemented in Pedigree's SlamAllocator, and from the looks of things, it's also missing a free list (I knew some info was missing)
[21:34:34] *** Quits: jdm (jdm@88F51059.F3BBB17D.144F44FA.IP) (Quit: Lost terminal)
[21:34:39] *** Quits: lmandel (lmandel@13F2CEC5.7672369.D8E68FF6.IP) (Quit: lmandel)
[21:34:59] *** Joins: joebobjoe (Dale@moz-A6AF8067.ga.at.cox.net)
[21:35:02] <joebobjoe> I don't understand how C compatibility is restricting the usage of TCO in Rust? Isn't the point of Rust to get away from C?
[21:35:37] <kmc> where did you see that?
[21:36:12] <Amaranth> I would imagine if anything it would just mean you can't do TCO for extern fns
[21:36:16] *** Quits: fran_ (fran@moz-BE1D1BA4.telecom.net.ar) (Ping timeout)
[21:36:31] *** Quits: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP) (Input/output error)
[21:36:42] <joebobjoe> kmc: https://mail.mozilla.org/pipermail/rust-dev/2013-April/003557.html
[21:37:09] <strcat> joebobjoe: LLVM does tail call elimination, rust doesn't provide a *guarantee* of tail calls being eliminated though
[21:37:13] *** Quits: tiffany (kawaii@moz-28A8742A.dhcp.embarqhsd.net) (Ping timeout)
[21:37:16] <strcat> and that's basically all there is to the issue
[21:37:29] *** Joins: tiffany (kawaii@moz-28A8742A.dhcp.embarqhsd.net)
[21:37:33] <erickt> brson: reping :)
[21:37:37] <strcat> at --opt-level=0 (the default), there is no tail call elimination
[21:37:47] *** Quits: q66 (q66@moz-463E955C.range86-148.btcentralplus.com) (Connection reset by peer)
[21:37:51] *** Joins: q66 (q66@moz-463E955C.range86-148.btcentralplus.com)
[21:37:53] <strcat> and there are a bunch of restrictions on it what counts as a tail call LLVM can eliminate
[21:38:22] <strcat> if the function is calling itself and doesn't return a large object, it can be trivially eliminated
[21:38:22] *** Joins: fran_ (fran@moz-6473E69E.telecom.net.ar)
[21:38:36] <benh> Aren't all fns extern fns, just some are extern "Rust"?
[21:38:47] <brson> erickt: pong
[21:39:47] <dbaupp> strcat: std::rand does the transmute thing because it wants to be able to write u64s, rather than having to do 8 u8s.
[21:39:53] <dbaupp> strcat: i.e. speed.
[21:40:08] <strcat> dbaupp: but it could write the u64 out in parts without transmute
[21:40:16] <strcat> it will compile down the same thing
[21:40:27] <strcat> anyway I already got it all working ;p
[21:40:29] <dbaupp> strcat: even with the necessary shifts, etc?
[21:40:57] <strcat> dbaupp: afaik they will be optimized out, you have to write weird code like that to deal with endianness anyway when it's not just a random number
[21:40:57] <joebobjoe> strcat: Is there anyway to annotate a function to guarantte LLVM will TCO?
[21:41:02] <kmc> joebobjoe: https://mail.mozilla.org/pipermail/rust-dev/2012-January/001281.html looks pretty relevant
[21:41:19] <strcat> joebobjoe: no, we don't run optimization passes at --opt-level=0
[21:41:29] <erickt> hey there. hope you had fun last night. I remembered a question I meant to ask you over dinner, but I forgot at the time. I was just watching Brendan talk about how javascript is adding a function* to signify a generator. We've reserved the keyword "yield" in case we add them as well, but would we also need to potentially reserve something like "gen" to declare one?
[21:41:35] <erickt> brson: ^
[21:41:37] <dbaupp> strcat: yeah, I know, but it's random numbers here so it doesn't matter :P (and the transmute seems cleaner than having extra loops)
[21:41:49] <strcat> LLVm passes are deterministic, so you essentially have a guarantee that if it is tail recursive according to LLVM's rules, it will be eliminated
[21:41:53] *** Joins: mitsuhiko (mitsuhiko-@moz-BC29B73E.srv.pocoo.org)
[21:42:00] <kmc> erickt: 'yield fn' or 'fn blah() -> yield T' were discussed
[21:42:09] <mitsuhiko> hey guys
[21:42:13] <kmc> hi mitsuhiko
[21:42:27] <brson> erickt: you don't like `fn*`?!
[21:42:34] <joebobjoe> kmc: Thanks
[21:42:54] <erickt> kmc: those are both good options
[21:42:57] <erickt> brson: heh
[21:42:59] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[21:43:20] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[21:43:54] <joebobjoe> strcat: So, in other words, do not rely on TCO in Rust, because the guarantees are restrictive?
[21:44:18] <strcat> joebobjoe: well you can rely on it, if you enable optimizations
[21:44:22] <brson> C# doesn't have any special method declaration for generators
[21:44:37] <mitsuhiko> brson: i think that's python's biggest fault :)
[21:44:39] <brson> though I think the return type has to be IEnumerable or something
[21:44:57] <mitsuhiko> as you cannot have "the empty generator" without doing ugly stuff like: if False: yield
[21:45:01] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[21:45:02] <strcat> brson: C# transforms generators to a state machine object though
[21:45:06] <strcat> so it really is just returning a normal object
[21:45:15] <eddyb9> strcat: hmm, it is trivial for me to implement an in-place realloc in SlamAllocator, does that sound interesting?
[21:45:20] <erickt> yeah, I think it's IEnumerable. having the return type "yield T" kind of makes sense
[21:45:20] <kmc> erickt: yeah, I would be happy with "-> yield T"
[21:45:24] <aatch> strcat, similar to PHP generators
[21:45:37] <strcat> eddyb9: well that's how realloc works in jemalloc/tcmalloc
[21:45:52] <strcat> it's in-place if possible, and uses mremap at large sizes afaik (which works the same way)
[21:46:01] <erickt> strcat: I would expect our generator impl would create a state machine that drives a Iterator<T> instance
[21:46:02] <eddyb9> yeah, I mean I can replicate that
[21:46:08] *** Quits: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP) (Client exited)
[21:46:47] <eddyb9> erickt: no fancy low-level state keeping tricks?
[21:47:05] <eddyb9> s/tricks/actual generator implementations/
[21:47:19] <strcat> eddyb9: the actual implementation can be done as a transformation to a state machine
[21:47:22] <mitsuhiko> fsm >>> generator
[21:47:25] <strcat> no context switches necessary
[21:47:26] <erickt> I personally find it weird that C# returns an IEnumerable. I'd prefer they have some keyword or something
[21:47:46] <aatch> In PHP at least (my only low-level experience with generators) calling a function that has a 'yield' statement returns an object.
[21:48:06] <eddyb9> strcat: I know, traceur-compiler does that, but isn't it costly?
[21:48:16] <aatch> eddyb9, done at compile time
[21:48:27] <strcat> eddyb9: the fastest way to write them is as state machines
[21:48:35] <strcat> std::iter is just a bunch of state machines written manually
[21:48:42] <strcat> and they compile down to code equivalent to C/C++ in every case now
[21:48:49] <eddyb9> hmpf
[21:48:54] <strcat> I verified that every kind of loop vectorization works
[21:49:26] *** Joins: Yeri (jasonjasmi@41C91A8A.CE609BA5.E39FBF79.IP)
[21:49:32] <eddyb9> but what's wrong with freezing state? harder to assert safety?
[21:49:41] <strcat> what do you mean freezing state?
[21:49:51] <strcat> a context switch is really slow
[21:50:31] *** Quits: Ferreus (ferreus@moz-48071414.pools.arcor-ip.net) (Quit: WeeChat 0.4.2)
[21:51:03] <mitsuhiko> strcat: what do you mean by context switch?
[21:51:11] <mitsuhiko> a python generator does not do a kernel level context switch
[21:51:13] <eddyb9> hmm... maybe traceur-compiler's state machine generators would never be much worse than the native non-state-machine versions
[21:51:16] <strcat> mitsuhiko: userland context switch
[21:51:19] *** Parts: joebobjoe (Dale@moz-A6AF8067.ga.at.cox.net) ()
[21:51:27] <strcat> like what rust tasks do when they're scheduled on the same thread
[21:51:28] <mitsuhiko> strcat: afaik python's generators don't even do that
[21:51:34] <mitsuhiko> they just keep the python frame object around
[21:51:46] <eddyb9> same in v8 I think
[21:51:46] <strcat> mitsuhiko: well that's python's version of a context switch then
[21:51:51] *** Joins: a__ (a__@moz-4CC03B10.nycmny.fios.verizon.net)
[21:52:03] <erickt> mitsuhiko: I believe changing the stack and instruction pointer causes some stalls
[21:52:06] <strcat> for rust it would mean flushing a bunch of registers and switching to another block of memory for the stack
[21:52:24] <mitsuhiko> strcat: do you guarnatee that the registers come back?
[21:52:50] <strcat> mitsuhiko: yes, it saves them somewhere
[21:53:01] <strcat> not all the registers, just the ones the calling convention you use requires to save
[21:53:04] <eddyb9> strcat: I think v8 kills the registers on yield
[21:53:10] <mitsuhiko> strcat: but you have the same problem with an stm
[21:53:16] <mitsuhiko> fsm
[21:53:34] <strcat> mitsuhiko: a state machine is optimized down to good code at compile-time, and runs on the same stack
[21:53:49] <strcat> mitsuhiko: the stuff defined in std::iter is optimized down to equivalent loops written in low-level C
[21:53:52] <mitsuhiko> strcat: because it inlines the calls?
[21:54:04] <strcat> mitsuhiko: not just that, after it inlines them it transforms them a lot
[21:54:16] <strcat> it will remove all the redundant state checks
[21:54:25] <strcat> used to find the right place in the state machine
[21:54:30] <eddyb9> no way you can get that to work in LLVM with multiple returns
[21:54:37] *** Quits: Yeri (jasonjasmi@41C91A8A.CE609BA5.E39FBF79.IP) (Ping timeout)
[21:54:46] <strcat> it works fine
[21:55:00] <strcat> it's not really a hard optimization for LLVM
[21:55:02] <strcat> it's on the easy end
[21:55:11] <erickt> mitsuhiko: even without inlining, generators via fsm is just a fn call and a jump. Doing a coroutine-style generator requires a lot more setup when you go in and out of the generator
[21:55:11] <mitsuhiko> hmm. for a state machine generated by generic code?
[21:55:18] <eddyb9> multiple returns = context switch
[21:55:30] *** Quits: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca) (Quit: canhtak)
[21:55:31] <strcat> eddyb9: I thought you meant aggregate returns
[21:55:34] <strcat> I see what you mean now
[21:55:42] <strcat> a context switch would be a black box to LLVM optimization passes
[21:55:45] <strcat> it would never optimize out
[21:56:08] <strcat> 100-1000x times slower if the std::iter ones were done that way
[21:56:16] <eddyb9> strcat: what if you moved all locals to the generator object?
[21:56:20] *** Joins: mikezaby (mikezaby@moz-908EA8DE.home.otenet.gr)
[21:56:26] <eddyb9> something like a closure
[21:56:29] <strcat> the 'generator object' is the state machine
[21:56:33] <strcat> it's a struct with the state
[21:56:36] *** Parts: mikezaby (mikezaby@moz-908EA8DE.home.otenet.gr) ()
[21:56:59] <strcat> just look in std::iter at how those adaptors are implemented
[21:57:09] <strcat> it would just generate that code for you from yield
[21:57:27] <eddyb9> strcat: nvm, same thing I said before, multiple entries/returns into a function wouldn't work in LLVM
[21:57:29] <mitsuhiko> all the transformations i saw for generators to state machines was a switch with a state index
[21:57:42] <mitsuhiko> i would be impressed if llvm optimizes that nicely
[21:57:44] <strcat> mitsuhiko: yeah, that optimizes out
[21:57:47] <strcat> it's easy for it
[21:57:52] <aatch> mitsuhiko, that's easy for LLVM to do
[21:58:04] *** Joins: Yeri (jasonjasmi@41C91A8A.CE609BA5.E39FBF79.IP)
[21:58:09] *** Quits: bheylin (brianheyli@moz-8255E94E.adsl.online.nl) (Quit: bheylin)
[21:58:09] <erickt> strcat: do you think there'd be any advantage to try to do a coroutine-style generators now just so they're in the codebase and convert to a state machine later? we might be able to reuse some of the task code for it
[21:58:14] *** Quits: devbug (quassel@2D4E172D.4C8B6099.9B57EA59.IP) (Ping timeout)
[21:58:22] *** Quits: nkoep (nik@moz-C0F14C4.vpn.rwth-aachen.de) (Ping timeout)
[21:58:24] <strcat> loops with scalars, branches and switches are very easy for it to optimize
[21:58:38] <strcat> it only gets hard when you have loads/stores to pointers
[21:58:56] <strcat> and calls to black boxes (external functions, etc.) stop any optimizations in their tracks
[21:59:03] <erickt> strcat: writing a state machine version requires touching a lot of scary trans code :(
[21:59:11] <eddyb9> aliasing analysis should be easier in Rust
[21:59:12] *** Joins: sw17ch (sw17ch@moz-675AFBCF.hsd1.mi.comcast.net)
[21:59:20] <eddyb9> erickt: why?
[21:59:36] <erickt> eddyb9: why is it scary?
[21:59:36] <eddyb9> can't you do it in libsyntax?
[21:59:38] <strcat> even with great alias analysis, optimizing code with pointers is still going to be very weak compared with what you can do without them
[22:00:09] *** Quits: exobit_ (textual@moz-E06F46F0.corp.bitshelter.com) (Quit: )
[22:00:10] <eddyb9> state machines can be produced with source transformation
[22:00:29] <erickt> eddyb9: I thought so, but you need to do the generator transformation in librustc after type checking. There are some ugly edge cases with borrow checking that make a libsyntax version impossible
[22:00:33] <eddyb9> or in this case, ast transformation
[22:01:06] <eddyb9> erickt: what edge cases? is there an issue tracking this?
[22:02:36] <erickt> eddyb9: it *might* be this manual trnasformation: https://gist.github.com/erickt/6314670
[22:03:49] <erickt> eddyb9: or maybe https://gist.github.com/erickt/6343539
[22:04:31] <eddyb9> wait, this is already implemented?
[22:04:39] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[22:05:00] <erickt> eddyb9: no, I just got really excited about a libsyntax transformation a month or so ago
[22:05:29] <erickt> eddyb9: and I was trying to figure out where it fell over
[22:06:02] *** Quits: pnkfelix (pnkfelix@moz-B65AF445.hfc.comcastbusiness.net) (Quit: Leaving.)
[22:06:10] *** Joins: tgummerer (tgummerer@moz-5DC8FA44.tbcn.telia.com)
[22:06:10] <eddyb9> last gist isn't highlighted, can you edit?
[22:06:26] <erickt> eddyb9: here's the bug tracking it: https://github.com/mozilla/rust/issues/7746
[22:06:28] <eddyb9> I'd fork but it feels silly
[22:06:47] <erickt> eddyb9: done
[22:07:49] <eddyb9> thanks :)
[22:07:59] <erickt> eddyb9: unfortunately I forgot to write down exactly why it won't work in libsyntax
[22:09:01] *** Joins: XMunkki (xm@moz-84E87CA5.kapsi.fi)
[22:09:30] *** Joins: skeet70 (skeet70@moz-DB50BE3F.bzm-mt.client.bresnan.net)
[22:09:34] *** Joins: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca)
[22:09:51] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[22:10:37] <eddyb9> erickt: type inference is a big one
[22:10:39] *** Quits: onix (Mibbit@moz-B234C23B.rev.numericable.fr) (Quit: http://www.mibbit.com ajax IRC Client)
[22:10:55] *** Quits: samx (sami@moz-D9DA5773.dyn.optonline.net) (Quit: This computer has gone to sleep)
[22:12:50] *** Quits: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com) (Quit: Scriptor)
[22:13:03] *** Joins: mudpit (Mibbit@moz-C15C4576.bb.online.no)
[22:13:12] <XMunkki> hey all.. planning on starting to dabble with rust, though from what I've read, it seems that 0.9-pre might be a better starting point than 0.8.. are there any prebuilt binaries for that (or like a nightly build)? (I'm on windows)
[22:13:31] <strcat> there aren't pre-built binaries for windows yet
[22:14:03] <erickt> eddyb9: in the grand scheme of things, it shouldn't be *that* hard to do, but there are dragons hidden inside trans that'll make it tricky to handle all the edge cases
[22:14:15] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[22:14:18] <XMunkki> oh? aren't the ones for 0.8 in http://www.rust-lang.org/ for windows? at least it installed fine :)
[22:14:36] <dbaupp> bstrie: could you adjust the sidebar or /r/rust to make it clearer that master should be preferred to the point releases?
[22:14:36] <strcat> XMunkki: you asked about 0.9-pre, my response was to that
[22:14:39] <FreeFull> Huh
[22:14:49] <FreeFull> Arch Linux wiki doesn't have an entry on Rust
[22:15:16] <XMunkki> strcat: ah right, thanks.. :) just figured as I found the buildbot logs that they are kinda being built somewhere anyhow.. but yeah, I guess I'll start my exploration with 0.8 then.. :)
[22:15:19] <Earnestly> FreeFull: Good
[22:16:20] <eddyb9> erickt: I've had to find where in borrowck my inline asm change was failing. it was because of a missing case for ExprInlineAsm, which got handled by the default case
[22:16:33] *** Quits: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[22:16:53] *** Joins: nkoep (nik@moz-2A4589C.pool.mediaways.net)
[22:17:14] <FreeFull> I think I'll grab the package from http://pkgbuild.com/~thestinger/repo/x86_64/ to see the differences from 0.8
[22:17:19] <eddyb9> ooooooh I might have a killer IDE feature idea: show uses for an enum variant should display all the default cases handling that variant as well
[22:17:44] <eddyb9> nomore grep failure
[22:18:02] <FreeFull> Goodbye rust tool
[22:19:05] <erickt> eddyb9: or an rustgrep tool that can parse and grep across all the explicit and implicit symbols
[22:19:10] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[22:19:10] <Luqman> eddyb9: yea, i'd imagine there'd be various places where asm wasn't handled properly
[22:20:02] <FreeFull> Ok, my code still compiles with the git
[22:20:40] <eddyb9> Luqman: outputs weren't treated as lvalues written to, but as taking the address and passing it to a function
[22:21:07] <Luqman> yea, it was kind of a hack
[22:21:08] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[22:21:21] <eddyb9> I fixed that in my PR, need to update it tomorrow based on review comments
[22:21:33] <eddyb9> and maybe sleep tonight
[22:23:37] *** Quits: Asa (asa@4508CAE6.38324963.204CA821.IP) (Ping timeout)
[22:24:11] <eddyb9> erickt: you don't need per-loop states
[22:24:29] *** Joins: Asa (asa@4508CAE6.38324963.204CA821.IP)
[22:25:20] <erickt> eddyb9: no, you flatten out all the loops into jumping between states
[22:27:31] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[22:28:13] *** Joins: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net)
[22:33:57] *** Quits: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[22:34:29] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[22:36:32] *** Quits: q66 (q66@moz-463E955C.range86-148.btcentralplus.com) (Ping timeout)
[22:36:44] *** Joins: q66 (q66@moz-463E955C.range86-148.btcentralplus.com)
[22:37:58] *** Quits: tikue_ (tikue_star@2772A85E.EB08480C.689607DE.IP) (Ping timeout)
[22:38:31] *** Quits: q66 (q66@moz-463E955C.range86-148.btcentralplus.com) (Ping timeout)
[22:38:43] *** Joins: q66 (q66@moz-463E955C.range86-148.btcentralplus.com)
[22:39:57] *** Joins: tikue_ (tikue_star@2772A85E.EB08480C.689607DE.IP)
[22:41:12] *** Quits: donri (donri@moz-9BB61102.tbcn.telia.com) (Client exited)
[22:42:52] *** Quits: efyx (efyx@moz-4206285E.adsl-dyn.isp.belgacom.be) (Ping timeout)
[22:43:24] *** Quits: mudpit (Mibbit@moz-C15C4576.bb.online.no) (Quit: http://www.mibbit.com ajax IRC Client)
[22:44:48] <bstrie> dbaupp: can do
[22:45:39] *** Quits: josh (josh@moz-E500C116.mpls.qwest.net) (Quit: josh)
[22:46:31] *** Quits: earlz (earlz@moz-9E279EAD.neo.res.rr.com) (Ping timeout)
[22:48:04] *** Joins: earlz (earlz@moz-9E279EAD.neo.res.rr.com)
[22:52:38] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[22:52:42] *** Quits: earlz (earlz@moz-9E279EAD.neo.res.rr.com) (Ping timeout)
[22:53:10] *** Joins: Jesin (Jessin_@moz-2FC45CE5.cc.lehigh.edu)
[22:53:21] <bstrie> dbaupp: I just plain removed those links
[22:53:38] *** Quits: vmx (vmx@8155E38.294C4FB6.EBB03D7A.IP) (Ping timeout)
[22:54:51] <dbaupp> bstrie: awesome!
[22:55:15] *** Quits: nsf (nsf@moz-EEF3238A.convex.ru) (Quit: WeeChat 0.4.2)
[22:56:27] *** Quits: tgummerer (tgummerer@moz-5DC8FA44.tbcn.telia.com) (Ping timeout)
[22:56:40] *** Joins: tgummerer (tgummerer@moz-5DC8FA44.tbcn.telia.com)
[22:57:17] *** Joins: vmx (vmx@8155E38.294C4FB6.EBB03D7A.IP)
[22:57:50] *** Joins: efyx (efyx@moz-27C66711.adsl-dyn.isp.belgacom.be)
[22:59:49] *** Joins: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca)
[22:59:59] *** Quits: tgummerer (tgummerer@moz-5DC8FA44.tbcn.telia.com) (Ping timeout)
[23:00:33] *** Quits: Skif (emschwar@moz-CA025D57.ip.mcleodusa.net) (Client exited)
[23:02:20] *** Joins: pepper_chico (pepper_chi@5B1C9931.F07E9C90.2E5C92D8.IP)
[23:04:16] *** Quits: fran_ (fran@moz-6473E69E.telecom.net.ar) (Ping timeout)
[23:04:41] *** Joins: samx (sami@moz-D9DA5773.dyn.optonline.net)
[23:04:51] *** Quits: dherman (dherman@D8B9C081.E820043D.D4C04133.IP) (Quit: dherman)
[23:05:01] *** kimundi is now known as zz_kimundi
[23:05:23] *** Quits: alan (alan@moz-FE02DD30.sat6.rackspace.com) (Ping timeout)
[23:06:45] <mark_edward> eddyb9: ping
[23:07:29] *** Joins: fran_ (fran@203ECF45.9D5079D8.87338559.IP)
[23:09:08] *** Quits: pepper_chico (pepper_chi@5B1C9931.F07E9C90.2E5C92D8.IP) (Quit: Ex-Chat)
[23:09:45] *** Joins: earlz (earlz@moz-9E279EAD.neo.res.rr.com)
[23:10:56] *** Quits: Jesin (Jessin_@moz-2FC45CE5.cc.lehigh.edu) (Ping timeout)
[23:10:57] *** Quits: skeet70 (skeet70@moz-DB50BE3F.bzm-mt.client.bresnan.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[23:12:04] *** Quits: q66 (q66@moz-463E955C.range86-148.btcentralplus.com) (Ping timeout)
[23:12:20] *** Quits: BitPuffin (isak@moz-98F8BF74.cust.tele2.se) (Ping timeout)
[23:12:32] *** Quits: miloshadzic (miloshadzi@1D0E4386.525D6FB8.CC0F3526.IP) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[23:12:59] *** Quits: samx (sami@moz-D9DA5773.dyn.optonline.net) (Quit: This computer has gone to sleep)
[23:13:41] *** Quits: Liam` (quassel@6265EFB3.B1CCF5AA.217C7FCC.IP) (Ping timeout)
[23:14:22] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[23:15:18] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[23:17:41] *** Quits: lfox (lfox@moz-343B6F0C.nyc.biz.rr.com) (Quit: ZZZzzz…)
[23:19:33] *** Joins: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net)
[23:20:36] *** Quits: nkoep (nik@moz-2A4589C.pool.mediaways.net) (Client exited)
[23:23:00] *** Joins: devbug (quassel@23AC5F12.9D950176.3655BBF5.IP)
[23:25:57] *** Quits: polyfractal (polyfracta@moz-4C5426D6.hsd1.sc.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzz…)
[23:27:19] *** Joins: Liam` (quassel@6265EFB3.B1CCF5AA.217C7FCC.IP)
[23:28:53] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[23:30:11] *** Quits: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca) (Quit: canhtak)
[23:30:56] *** Joins: rveach (rveach@410D297A.C7FE7DD2.1302FB2C.IP)
[23:30:59] *** Quits: Liam` (quassel@6265EFB3.B1CCF5AA.217C7FCC.IP) (Ping timeout)
[23:34:07] *** Joins: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca)
[23:37:09] *** Joins: Liam` (quassel@6265EFB3.B1CCF5AA.217C7FCC.IP)
[23:37:34] *** Quits: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca) (Quit: canhtak)
[23:38:31] *** Quits: dcrewi (david@moz-AB8667CE.gyrae.net) (Ping timeout)
[23:38:32] *** Joins: vfetwnuncszu (david@moz-AB8667CE.gyrae.net)
[23:38:38] *** vfetwnuncszu is now known as dcrewi
[23:39:10] *** jorendorff is now known as jorendorff_away
[23:39:48] *** Quits: eholk (eholk@moz-BA312F07.crest.iu.edu) (Quit: eholk)
[23:42:02] *** Joins: BitPuffin (isak@moz-98F8BF74.cust.tele2.se)
[23:42:18] *** Quits: skade (skade@moz-4865967C.pools.arcor-ip.net) (Quit: Textual IRC Client: www.textualapp.com)
[23:42:24] *** Joins: canhtak (jeremy@moz-EF57C296.wl.t.ulaval.ca)
[23:44:16] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[23:45:01] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[23:45:09] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[23:46:23] *** Joins: Guest_ (textual@3406FB1C.AE8426E7.16E13E53.IP)
[23:50:22] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[23:55:49] *** Joins: samx (sami@moz-D9DA5773.dyn.optonline.net)
[23:56:33] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[23:56:36] *** Joins: jxv (jxv@moz-8FB92450.lightspeed.irvnca.sbcglobal.net)
[23:59:52] <brson> strcat: where's your playpen instance?
