[00:16:26] *** Joins: aatch (james@moz-8r6eer.orns.ubhm.e000.2406.IP)
[00:20:00] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[00:22:32] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[00:24:16] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[01:06:35] *** Joins: unwound (bkoropoff@moz-kthi5c.wa.comcast.net)
[01:14:09] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[01:18:25] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[01:36:45] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[01:43:48] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[02:04:53] *** Quits: zz_kimundi (kimundi@moz-n3m1h7.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:08:06] *** Joins: zz_kimundi (kimundi@moz-e86r7p.dip0.t-ipconnect.de)
[02:08:07] *** zz_kimundi is now known as kimundi
[02:08:20] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[02:12:32] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[02:59:02] *** Joins: p1start (p1start@moz-nftjhe.org)
[03:02:20] *** Joins: blank_name (blank_name@moz-5t8mvg.mi.frontiernet.net)
[03:02:27] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[03:06:45] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[03:21:42] *** Quits: c74d (c74d3a4ebb6@moz-0ersgu.oc.cox.net) (Ping timeout: 121 seconds)
[03:22:14] *** Joins: c74d3 (c74d3a4ebb6@moz-mii588.mggc.hibn.4404.2002.IP)
[03:24:02] *** c74d3 is now known as c74d
[03:45:36] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[03:46:40] *** Joins: p1start (p1start@moz-nftjhe.org)
[03:50:42] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[03:53:35] *** Joins: WindowsBunny1 (Peter@moz-vlal7g.east.verizon.net)
[03:55:31] *** Quits: c74d (c74d3a4ebb6@moz-mii588.mggc.hibn.4404.2002.IP) (Connection closed)
[03:55:50] *** Quits: WindowsBunny (Peter@moz-prmara.east.verizon.net) (Ping timeout: 121 seconds)
[03:56:36] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[03:57:01] *** Joins: c74d (c74d3a4ebb6@moz-mii588.mggc.hibn.4404.2002.IP)
[04:00:52] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[04:02:46] *** WindowsBunny1 is now known as WindowsBunny
[04:50:45] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[04:52:58] *** Joins: c74d3 (c74d3a4ebb6@moz-0ersgu.oc.cox.net)
[04:53:43] *** Quits: c74d (c74d3a4ebb6@moz-mii588.mggc.hibn.4404.2002.IP) (Ping timeout: 121 seconds)
[04:54:52] *** c74d3 is now known as c74d
[04:55:01] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[04:57:39] *** Quits: unwound (bkoropoff@moz-kthi5c.wa.comcast.net) (Quit: Ex-Chat)
[05:17:12] *** Joins: p1start (p1start@moz-nftjhe.org)
[05:44:53] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[05:49:09] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[06:05:39] *** Quits: aatch (james@moz-8r6eer.orns.ubhm.e000.2406.IP) (Connection closed)
[06:36:17] *** Joins: eddyb (eddyb@moz-0p8.9jn.166.109.IP)
[06:39:02] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[06:43:20] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[07:33:14] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[07:37:11] <eddyb> nrc: sorry for not peeking at BlockS before, seems we can get rid of it, see https://github.com/rust-lang/rust/pull/25332#issuecomment-103794650
[07:37:28] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[07:37:52] <nrc> eddyb: that is good news
[07:38:04] <eddyb> someone has to write some C++ code though :P
[07:38:27] <nrc> I had a feeling that we could do something simpler here, but I spent so long reviewing that enormous PR that I didn't really want to think about it in depth :-s
[07:39:19] <eddyb> I was almost sure I would find some sort of data structure with important information, but nope
[07:40:38] <eddyb> even opt_node_id, I was ready to search for a way to hide it in metadata, but it's not used for what I thought it would be, reading the comment
[07:44:45] <doener> eddyb: good point on the possibility to omit copies of incoming args! I had experimented with that but totally missed that it's applicable here. Doing a test build of that now
[07:49:44] <eddyb> doener: that was the point I added the hack in the first place. but I was looking at unoptimized IR and trying to minimize it, without knowing much about LLVM elision capabilities
[07:50:27] <doener> eddyb: thought so (because that's exactly what I did when I started all this ;-))
[07:50:44] <doener> (minimizing IR without really knowing the implications)
[07:52:15] <eddyb> anyone willing to rubber-stamp this? https://github.com/rust-lang/rust/pull/25390
[07:54:17] <nrc> done
[08:00:07] <eddyb> nrc: thanks!
[08:03:48] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[08:05:34] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[08:13:11] *** Joins: laumann (thomas@moz-3v9.hq0.225.130.IP)
[08:16:38] *** Quits: eddyb (eddyb@moz-0p8.9jn.166.109.IP) (Ping timeout: 121 seconds)
[08:27:23] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[08:31:41] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[08:32:33] *** nrc is now known as nrc|afk
[08:41:31] *** Joins: Tuba (Tobba@moz-6oh.7ki.21.217.IP)
[09:03:44] *** Quits: Tuba (Tobba@moz-6oh.7ki.21.217.IP) (Ping timeout: 121 seconds)
[09:16:48] *** kimundi is now known as zz_kimundi
[09:21:37] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[09:22:19] *** Joins: Tuba (Tobba@moz-6oh.7ki.21.217.IP)
[09:22:44] *** Quits: laumann (thomas@moz-3v9.hq0.225.130.IP) (Ping timeout: 121 seconds)
[09:25:49] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[09:34:46] *** Joins: laumann (thomas@moz-gqpfnm.science.ku.dk)
[09:59:53] *** zz_kimundi is now known as kimundi
[10:01:43] *** Quits: Tuba (Tobba@moz-6oh.7ki.21.217.IP) (Ping timeout: 121 seconds)
[10:15:43] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[10:20:01] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[10:35:07] *** Quits: nrc|afk (nrc@moz-14pjgj.xtra.co.nz) (Ping timeout: 121 seconds)
[10:52:30] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[11:09:55] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[11:14:08] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[11:26:40] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[11:35:04] *** Joins: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP)
[11:35:04] *** ChanServ sets mode: +ao pnkfelix pnkfelix
[11:37:12] *** Quits: laumann (thomas@moz-gqpfnm.science.ku.dk) (Ping timeout: 121 seconds)
[11:39:31] *** Quits: vadimcn (uid46608@moz-o7asbu.uxbridge.irccloud.com) (Quit: Connection closed for inactivity)
[11:44:19] *** Joins: laumann (thomas@moz-3v9.hq0.225.130.IP)
[11:45:48] *** Quits: laumann (thomas@moz-3v9.hq0.225.130.IP) (Quit: leaving)
[11:45:53] *** Joins: laumann (thomas@moz-3v9.hq0.225.130.IP)
[11:53:19] *** kimundi is now known as zz_kimundi
[12:00:41] *** zz_kimundi is now known as kimundi
[12:04:01] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[12:08:19] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[12:09:42] *** Quits: laumann (thomas@moz-3v9.hq0.225.130.IP) (Ping timeout: 121 seconds)
[12:21:43] *** Joins: laumann (thomas@moz-gqpfnm.science.ku.dk)
[12:23:31] *** Joins: eddyb (eddyb@moz-ure.pug.25.188.IP)
[12:43:27] <doener> eddyb: hm, do we have rules for addresses being significant? i.e. any guarantees about "&a as *const _ == &b as *const _"
[12:45:27] <eddyb> doener: I would say not, unless the backing storage is `let` or dynamic allocations
[12:46:00] <cmr> don't we have rules about statics?
[12:47:22] <doener> eddyb: let's go with something more specific: let a = 5; let b = a; let comp = &a as *const _ == &b as *const _;
[12:47:32] <doener> eddyb: do we guarantee that comp is false there?
[12:48:35] <eddyb> I don't know of any place where we do that
[12:49:08] <cmr> doener: I don't think we have any rules in place, but we probably should.
[12:49:11] <eddyb> either in writing or by implying it as a precondition
[12:49:30] <eddyb> doener: the comparison "makes sense" as false only if the data can be mutated
[12:49:41] <eddyb> so either mut bindings or interior mutability
[12:50:03] <cmr> eddyb: that's my feeling as well.
[12:50:10] <doener> eddyb: the reason I'm asking is this: fn foo(arg: (i64, i64)) { let tmp = arg; bar(&tmp.0); }
[12:50:42] <eddyb> those are the same criteria I would use for avoiding allocas on primitives and whatnot
[12:50:56] <doener> eddyb: the "tmp" var can't be optimized away. Although unless the address of a borrow is significant, it should be legal to just pass in the address of arg.0
[12:51:38] <eddyb> putting an integer or a pointer in an alloca is so wasteful, but there isn't enough logic to handle such cases better in trans
[12:52:29] <eddyb> doener: right. you want to make sure that reusing the lvalue couldn't allow any kind of mutable aliasing
[12:52:46] <eddyb> can you even detect "immutable lvalues" on the RHS of let?
[12:55:16] <doener> eddyb: I'm rather thinking along the lines of checking if llvm could learn to use unnamed_addr on function arguments.
[12:55:42] <doener> eddyb: i.e. telling it that yes, we pass in a pointer, but as long as the data behind the pointer is the same, we don't care what pointer we get
[12:56:06] <doener> eddyb: that should maybe allow llvm to do the optimization in many cases
[12:56:46] <eddyb> oh
[12:57:06] <cmr> doener: I don't think we should make that guarantee, and instead say that any reference to a Copy value can share the address of "another" value that is bitwise identical.
[12:58:13] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[12:58:53] <doener> cmr: which would allow said optimization, so yeah, I'd like to not make that guarantee, but wondered if we already have it
[12:59:20] <cmr> I don't think we do.
[13:00:29] <eddyb> besides...
[13:00:30] <cmr> But it seems reasonable to me. The only thing that could break with that change would be using the addresses of two locals as cookies of some sort.
[13:00:57] <eddyb> &0 as *const _ == &0 as *const _
[13:01:02] <eddyb> and it's even in .rodata
[13:01:30] <eddyb> promoting "variables" that happen to be constant is a logical next step
[13:01:56] <eddyb> (constant at compile-time or equal between themselves with no potential for mutation)
[13:02:26] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[13:17:07] *** kimundi is now known as zz_kimundi
[13:18:13] *** zz_kimundi is now known as kimundi
[13:25:13] *** Quits: laumann (thomas@moz-gqpfnm.science.ku.dk) (Ping timeout: 121 seconds)
[13:32:35] *** Joins: laumann (thomas@moz-3v9.hq0.225.130.IP)
[13:52:20] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[13:56:37] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[14:21:51] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[14:28:27] *** Quits: eddyb (eddyb@moz-ure.pug.25.188.IP) (Ping timeout: 121 seconds)
[14:46:30] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[14:50:46] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[15:08:41] *** kimundi is now known as zz_kimundi
[15:40:27] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[15:44:37] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[15:45:46] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[15:46:58] *** Joins: arielb1 (Ariel@moz-dqnh1v.red.bezeqint.net)
[15:47:00] <arielb1> c
[15:54:02] *** Quits: doener (doener@moz-929cn9.unity-media.net) (Quit: leaving)
[15:59:56] *** Joins: SilverKey (SilverKey@moz-b7q751.biz.rr.com)
[16:02:05] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[16:21:30] *** zz_kimundi is now known as kimundi
[16:23:32] *** Joins: doener (doener@moz-929cn9.unity-media.net)
[16:24:34] *** Quits: laumann (thomas@moz-3v9.hq0.225.130.IP) (Quit: leaving)
[16:50:28] <doener> acrichto: how's the llvmup going?
[17:03:11] *** Quits: SilverKey (SilverKey@moz-b7q751.biz.rr.com) (Quit: ZZZzzzâ€¦)
[17:06:56] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[17:06:56] *** ChanServ sets mode: +qo brson brson
[17:10:32] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[17:12:20] *** Joins: eddyb (eddyb@moz-ure.pug.25.188.IP)
[17:13:16] *** Joins: vadimcn (uid46608@moz-o7asbu.uxbridge.irccloud.com)
[17:14:58] *** Quits: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP) (Quit: rcirc on GNU Emacs 24.5.1)
[17:33:53] *** Joins: achanda (achanda@moz-ol5.978.205.94.IP)
[17:35:59] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[17:37:52] *** Quits: achanda (achanda@moz-ol5.978.205.94.IP) (Connection closed)
[17:39:24] *** Joins: achanda (achanda@moz-ol5.978.205.94.IP)
[17:48:40] *** Joins: SilverKey (SilverKey@moz-b7q751.biz.rr.com)
[17:54:04] <aturon> doener: fwiw acrichto is going to be away on vacation for a week, and may have already left
[17:54:20] <doener> ah, ok
[17:54:23] <aturon> (not sure what the status of this work is, though)
[18:37:30] *** Quits: achanda (achanda@moz-ol5.978.205.94.IP) (Ping timeout: 121 seconds)
[19:06:39] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[19:24:07] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[19:28:23] *** Quits: Rym_ (y@moz-c2u.sd4.38.217.IP) (Ping timeout: 121 seconds)
[19:38:08] *** Joins: Rym_ (y@moz-c2u.sd4.38.217.IP)
[20:49:33] *** Joins: nrc|afk (nrc|afk@moz-14pjgj.xtra.co.nz)
[20:50:58] *** Joins: Barca (Mibbit@moz-j9a.ns7.133.129.IP)
[20:51:10] *** Parts: Barca (Mibbit@moz-j9a.ns7.133.129.IP) ()
[21:22:13] *** Quits: arielb1 (Ariel@moz-dqnh1v.red.bezeqint.net) (Ping timeout: 121 seconds)
[21:35:51] *** Joins: arielb1 (Ariel@moz-dqnh1v.red.bezeqint.net)
[21:49:58] *** nrc|afk is now known as nrc
[21:57:48] *** Quits: arielb1 (Ariel@moz-dqnh1v.red.bezeqint.net) (Ping timeout: 121 seconds)
[22:00:40] *** Joins: arielb1 (Ariel@moz-dqnh1v.red.bezeqint.net)
[22:18:40] *** Quits: arielb1 (Ariel@moz-dqnh1v.red.bezeqint.net) (Quit: Ex-Chat)
[22:38:56] *** Quits: SilverKey (SilverKey@moz-b7q751.biz.rr.com) (Ping timeout: 121 seconds)
[22:42:41] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[23:04:00] *** kimundi is now known as zz_kimundi
[23:12:57] *** Joins: aatch (james@moz-8r6eer.orns.ubhm.e000.2406.IP)
[23:22:31] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
