[00:00:39] <Luqman> yea, adt::trans_start_init and friends i'd imagine
[00:04:56] <cmr> Aha
[00:05:01] <cmr> This looks promising
[00:11:47] *** Joins: twb (textual@moz-5DE8950B.hsd1.ga.comcast.net)
[00:17:46] *** Joins: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net)
[00:19:39] <Luqman> cmr: something like this maybe: let repr = adt::represent_type(bcx, output_type); adt::trans_const(ccx, repr, 0, [C_u64(hash)])
[00:26:51] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[00:26:51] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/nXuLhg
[00:26:51] <ghrust> 13rust/06auto 14fb5b990 15Alex Crichton: Remove unused upcalls...
[00:26:51] <ghrust> 13rust/06auto 14db8faf8 15bors: auto merge of #10708 : alexcrichton/rust/remove-reset-stack-limit, r=pcwalton...
[00:26:51] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[00:38:20] <cmr> Luqman: hm, that's causing the same problem I was having before: https://gist.github.com/cmr/9138393ff40c0cba56b1
[00:38:24] <cmr> Luqman: Should I omit the Ret?
[00:40:33] <Luqman> cmr: it might be using a retptr?
[00:40:55] <Luqman> try doing what init does
[00:42:06] <Luqman> match bcx.fcx.llretptr { Some(ptr) => { Store(bcx, trans_const(...), ptr); RetVoid(bcx); } None => Ret(bcx, trans_const(...) }
[00:45:32] *** Quits: twb (textual@moz-5DE8950B.hsd1.ga.comcast.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[00:49:24] <cmr> Luqman: exact same thing, so it seems like the None arm is being taken..
[00:52:17] <Luqman> cmr: what does the ir look like?
[00:54:11] <cmr> Luqman: -S --emit-llvm triggers the assert to, how can I get IR from it?
[00:57:03] <Luqman> hmm can you run the same passes except without the Module verifier?
[01:00:10] <cmr> That'd be -Z no-prepopulate-passes, yeah?
[01:00:46] <cmr> nope..
[01:00:51] <jack> so in switchign to pkgid, should we still use the link metadata in the crate metadata, or should i switch everything to pkgids?
[01:03:03] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[01:05:12] <kimundi> jack: Afaik the idea with packageids is that you don't need link metadata at all
[01:05:30] <Luqman> cmr: do you have your branch up somewhere?
[01:05:52] <cmr> Luqman: one sec
[01:06:16] <cmr> Luqman: https://github.com/cmr/rust/compare/type_id_opaque
[01:07:34] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[01:07:46] *** Quits: notmatt (notmatt@CC62CF7E.1E7FDFDB.A82DBDDB.IP) (Client exited)
[01:07:52] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:12:27] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[01:12:27] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14db8faf8 to 1490d06ec: 02http://git.io/N3iJvQ
[01:12:27] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[01:12:28] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[01:12:28] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/rNMtzw
[01:12:28] <ghrust> 13rust/06auto 1457f4a05 15Alex Crichton: Implement a lock-free work-stealing deque...
[01:12:28] <ghrust> 13rust/06auto 14a74d968 15bors: auto merge of #10678 : alexcrichton/rust/issue-4877, r=pcwalton...
[01:12:29] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[01:13:56] <jack> kimundi: yes, you'd never use #[link(foo = bar)]; anymore, but the compiler uses that link metadata everywhere.
[01:14:18] <jack> trying to decide whether to set it from pkgid or to replace all that infrastructure with pkgid and such things.
[01:24:23] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:27:04] *** Joins: Sharp (Sharp@moz-780FECDA.washdc.fios.verizon.net)
[01:37:59] *** kimundi is now known as zz_kimundi
[01:50:01] *** Joins: twb (textual@moz-5DE8950B.hsd1.ga.comcast.net)
[01:56:26] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[01:56:54] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[01:56:54] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14a74d968 to 1490d06ec: 02http://git.io/N3iJvQ
[01:56:54] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[01:57:01] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[01:57:01] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/DP0BVA
[01:57:01] <ghrust> 13rust/06auto 14075f016 15Patrick Walton: libstd: Change `Path::new` to `Path::init`.
[01:57:01] <ghrust> 13rust/06auto 14b99fccf 15bors: auto merge of #10697 : pcwalton/rust/path-new, r=pcwalton...
[01:57:01] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[02:10:55] *** Quits: bytewise (bytewise@moz-AD6B53F3.adsl.alicedsl.de) (Quit: Leaving)
[02:11:20] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[02:16:21] *** Quits: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net) (Ping timeout)
[02:16:28] *** Quits: Sharp (Sharp@moz-780FECDA.washdc.fios.verizon.net) (Quit: Sharp)
[02:21:43] <Eridius> so why was `do` notation made incompatible with closures?
[02:22:32] <klutzy> because it made allocation obscure
[02:22:52] <Eridius> how does `do` notation obscure allocation?
[02:23:10] <klutzy> ~fn() (now proc()) causes heap allocation, but we can't distinguish it from stack closure from code
[02:23:39] <klutzy> now when we see `do`, you'll know there's allocation
[02:23:57] <klutzy> that's my understanding though :p
[02:24:01] <Eridius> in the code I've seen, the vast majority of `do` blocks were with stack closures. Limiting it to just procs seems quite a shame
[02:24:22] <Eridius> I feel like `do` is basically only expected to be used with `spawn` now, but it was really useful for lots of stuff
[02:25:35] <strcat> Eridius: `do` is being removed afaik
[02:25:37] <strcat> if it's not already gone
[02:25:42] <Eridius> strcat: it's limited to procs, no?
[02:26:11] <strcat> procs are done like 'spawn(proc() { })'
[02:26:32] <Eridius> rusti: do spawn proc() { println!("test"); }
[02:26:34] -rusti- <anon>:9:18: 9:22 error: expected `{` but found `proc`
[02:26:34] -rusti- <anon>:9          do spawn proc() { println!("test"); }
[02:26:34] -rusti-                            ^~~~
[02:26:35] -rusti- application terminated with error code 101
[02:26:41] <Eridius> rusti: do spawn { println!("test") }
[02:26:43] -rusti- ()test
[02:26:44] <klutzy> rusti: version
[02:26:45] <Eridius> :P
[02:26:46] -rusti- "rustc 0.8"
[02:26:53] <Eridius> o_O
[02:27:12] <Eridius> ok well I just tested on latest master locally with that same code and it works
[02:27:19] <Eridius> so yeah, `do` seems to force a proc
[02:27:39] <Eridius> o_O error: type `&'static str` does not implement any method in scope named `iter`
[02:27:48] <klutzy> Eridius: .chars()
[02:27:53] <Eridius> meh
[02:28:11] <klutzy> Eridius: .line_iter() -> .lines() as well
[02:28:25] <Eridius> yeah I saw the .word_iter() -> .words(), I didn't realize .iter() became .chars()
[02:30:39] <klutzy> hmm, how are static.rust-lang docs generated?
[02:30:58] <Eridius> with rustdoc_ng
[02:31:06] <klutzy> I though I've fixed new closure syntax of rustdoc, but it's not reflected
[02:31:21] <Eridius> I don't know how often the docs are regenerated
[02:31:25] <klutzy> maybe the binary is old
[02:31:33] <dbaupp> klutzy: which PR?
[02:31:47] <klutzy> dbaupp: https://github.com/mozilla/rust/pull/10694
[02:32:20] <dbaupp> the doc builder is faiing http://buildbot.rust-lang.org/builders/doc/builds/1489
[02:32:25] <dbaupp> *failing
[02:32:32] <klutzy> oh
[02:33:50] <dbaupp> https://github.com/mozilla/rust/issues/10710
[02:33:54] <dbaupp> acrichto^
[02:41:33] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[02:41:34] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14b99fccf to 1490d06ec: 02http://git.io/N3iJvQ
[02:41:34] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[02:41:41] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[02:41:41] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/qzW7XQ
[02:41:41] <ghrust> 13rust/06auto 14815090c 15Alex Crichton: Add generation of static libraries to rustc...
[02:41:41] <ghrust> 13rust/06auto 14ca55854 15Alex Crichton: Statically link librustrt to libstd...
[02:41:42] <ghrust> 13rust/06auto 140f22ec8 15Alex Crichton: Add a new run-make test directory...
[02:41:44] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[02:45:52] *** Joins: SiegeLord (sl@moz-C606190.bstnma.fios.verizon.net)
[02:47:00] <Eridius> hrm, something is rather wrong
[02:47:28] <Eridius> rusti: format!("{:02}:", 4).to_c_str().with_ref(|_| println!("test"))
[02:47:28] -rusti- <anon>:9:29: 9:30 error: unexpected token: `.`
[02:47:28] -rusti- <anon>:9          format!("{:02}:", 4).to_c_str().with_ref(|_| println!("test"))
[02:47:29] -rusti-                                       ^
[02:47:29] -rusti- application terminated with error code 101
[02:47:48] <Eridius> oh hrm, I bet this is caused by the macro context changing because the do block is gone
[02:47:51] <Eridius> that's ugly
[02:48:03] <Eridius> format!() must be being treated as a statement instead of an expression
[02:48:04] <Eridius> I hate that
[02:48:25] <Eridius> yeah that's it
[02:50:40] *** Joins: osa1_ (omer@moz-8FDAB45C.hsd1.il.comcast.net)
[02:52:24] *** Joins: shachaf (shachaf@moz-F37E0395.members.linode.com)
[02:53:12] <osa1_> hello everone. I'm working on this feature request https://github.com/mozilla/rust/issues/10485 . apparently I can't directly use librustdoc::lib::json_output, right? because that only prints to a file, I guess what we need is to print to stdout, is that right?
[02:54:23] <cmr> well you can't use that directly no, and it does rustdoc-specific things, but it's an example of how to encode to json
[02:54:35] <dbaupp> osa1_: both stdout and file, preferably
[02:54:58] <dbaupp> osa1_: i.e. to foo.json if `-o foo.json` is passed, but stdout otherwise.
[02:55:10] <osa1_> yeah right that makes sense
[02:56:32] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[02:56:32] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 146a35352 to 1490d06ec: 02http://git.io/N3iJvQ
[02:56:32] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[02:56:40] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[02:56:40] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Y3oIvA
[02:56:40] <ghrust> 13rust/06auto 1457f4a05 15Alex Crichton: Implement a lock-free work-stealing deque...
[02:56:40] <ghrust> 13rust/06auto 1438348c2 15bors: auto merge of #10678 : alexcrichton/rust/issue-4877, r=pcwalton...
[02:56:40] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[03:00:23] <osa1_> so where is -o parameter saved in session type? I can't see it
[03:03:16] <dbaupp> osa1_: possibly the binary field of the options type
[03:11:26] <osa1_> "type `syntax::ast::Crate` does not implement any method in scope named `encode`" any ideas on this?
[03:12:19] <dbaupp> import extra::serialize::Encodable
[03:15:20] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[03:17:10] <osa1_> I think one last think and I should have an AST printer: which module exports inner_ref method?
[03:17:49] <osa1_> s/think/thing
[03:20:41] *** Quits: zz_kimundi (kimundi@moz-8CF1B152.dip0.t-ipconnect.de) (Ping timeout)
[03:21:47] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[03:22:51] <osa1_> std::io::Decorator, I guess
[03:24:18] *** Joins: zz_kimundi (kimundi@moz-E2132B33.dip0.t-ipconnect.de)
[03:24:20] *** zz_kimundi is now known as kimundi
[03:24:21] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[03:27:58] <osa1_> yaay \o/ it prints ast as json :)
[03:28:34] <osa1_> but for now it doesn't care about -o parameter because I couldn't find where it's saved in session
[03:29:33] *** Quits: aatch (James@moz-B437F499.pocketrent.com) (Quit: Leaving)
[03:32:05] *** Joins: Sharp (Sharp@moz-780FECDA.washdc.fios.verizon.net)
[03:32:35] <osa1_> aha, found it
[03:33:11] <cmr> osa1_: what was it?
[03:33:19] <cmr> if it was poorly named / undocumented, could you rename/document it? :)
[03:33:35] *** Quits: Sharp (Sharp@moz-780FECDA.washdc.fios.verizon.net) (Quit: Sharp)
[03:33:42] <osa1_> let ofile = matches.opt_str("o").map(|o| Path::new(o)); it's not saved in session type
[03:34:09] <osa1_> so what kind of behavior do we want? print to stdout if -o is not specified, print to file otherwise?
[03:34:40] <dbaupp> it's checked in build_output_filenames, which is called by compile_input, fwiw.
[03:34:51] <dbaupp> and, yes, that behaviour
[03:38:31] <osa1_> hmm, can I also use build_output_filenames ?
[03:38:58] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[03:39:12] <osa1_> out_filename looks useful
[03:41:32] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[03:41:33] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1438348c2 to 1490d06ec: 02http://git.io/N3iJvQ
[03:41:33] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[03:41:40] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[03:41:40] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/RlBadQ
[03:41:40] <ghrust> 13rust/06auto 14e737020 15Alex Crichton: Register new snapshots
[03:41:40] <ghrust> 13rust/06auto 1469a411b 15bors: auto merge of #10709 : alexcrichton/rust/snapshot, r=pcwalton
[03:41:40] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[04:04:37] *** Quits: hansjorg (hansjorg@moz-41C5CE61.redpill-linpro.com) (Ping timeout)
[04:07:59] *** Joins: hansjorg (hansjorg@moz-41C5CE61.redpill-linpro.com)
[04:11:53] *** Joins: Sharp (Sharp@moz-780FECDA.washdc.fios.verizon.net)
[04:12:25] <acrichto> cmr: pong
[04:13:16] *** Quits: Sharp (Sharp@moz-780FECDA.washdc.fios.verizon.net) (Quit: Sharp)
[04:14:33] <cmr> acrichto: working on https://github.com/mozilla/rust/issues/10594. https://github.com/cmr/rust/commit/1b69dc5e51b97945fed876af6c4b265b3c420b48 gives me https://gist.github.com/cmr/9138393ff40c0cba56b1
[04:15:00] *** Joins: Sharp (Sharp@moz-780FECDA.washdc.fios.verizon.net)
[04:15:16] <acrichto> cmr: it may be done through a retptr instead of returning by value
[04:15:30] <acrichto> I really wish we could dump modules mid-translation
[04:15:34] <cmr> acrichto: do you know how to properly create and populate a struct there? Alternatively, how to disable module checking so I can see the intermediate IR?
[04:15:48] <acrichto> cmr: try running with -Z no-prepopulate passes
[04:15:58] <cmr> That didn't help, unfortunately
[04:16:00] <strcat> cmr: you can print an LLVM type
[04:16:03] <cmr> (see above log with luqman)
[04:16:15] <cmr> acrichto: shouldn't the match on llretptr handle that case?
[04:16:16] <acrichto> try running with -Z print-llvm-passes to see what it's doing
[04:17:30] <cmr> acrichto: https://gist.github.com/cmr/3ea1c3c7db68edc2a186
[04:17:49] <cmr> With no-prepopulate-passes, the function passes are still there
[04:19:14] <acrichto> hm, perhaps we shouldn't run funciton passes on no-prepopulate passes
[04:20:25] <cmr> (https://gist.github.com/cmr/b05727be990caff362a6 is with no-prepopulate-passes, fwiw)
[04:21:06] <acrichto> I think it's definitely a mismatch of return pointer or returning by vaule
[04:21:09] <acrichto> value*
[04:22:02] <acrichto> cmr: also, I'd move the TypeId struct into intrinsics instead of leaving it in any
[04:22:11] <cmr> sure
[04:23:53] <acrichto> cmr: also in the mk_struct, are you specifying any fields to go inside it?
[04:23:58] * acrichto knows very little about middle::ty
[04:24:09] <osa1_> how does it look https://github.com/osa1/rust/commit/29828b0ffa6bf8526d4489c322109a7134533d4a ?
[04:25:21] <cmr> acrichto: I have no idea, but according to the type LLVM spits out, yes...
[04:25:55] <cmr> Yeah, it uses the DefId from the lang item, uses those fields.
[04:26:32] <acrichto> oh that makes sense
[04:26:45] <cmr> it was late when I was working on this :P
[04:27:12] <acrichto> omg I literally cannot land anythin
[04:29:32] <acrichto> _ => .. in match patterns was a huge change
[04:29:41] <acrichto> not quite on the level of &fn => || though
[04:29:59] <cmr> whoa, so now it's "match { .. => { foo } }"?
[04:30:58] <acrichto> StructPattern { foo, bar: baz, .. }
[04:31:03] <acrichto> and EnumPattern(..)
[04:31:05] <cmr> oh, ok
[04:31:13] <acrichto> _ == ignore one and only one field
[04:31:18] <cmr> Good!
[04:31:21] <acrichto> [foo, bar, baz, ..]
[04:31:28] <acrichto> hurray consistency!
[04:31:42] <acrichto> now we just need .. to ignore multiple trailing fields in an enum discriminant
[04:31:44] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[04:31:44] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1469a411b to 1490d06ec: 02http://git.io/N3iJvQ
[04:31:44] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[04:31:47] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[04:31:47] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/aRgxjA
[04:31:47] <ghrust> 13rust/06auto 14ab387a6 15Alex Crichton: Register new snapshots
[04:31:47] <ghrust> 13rust/06auto 14bf6964e 15bors: auto merge of #10709 : alexcrichton/rust/snapshot, r=pcwalton
[04:31:48] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[04:32:22] <acrichto> cmr: pass -Z no-verify
[04:32:29] <acrichto> we add the verify pass manually
[04:32:39] <cmr> oh!
[04:32:41] <cmr> sweet
[04:32:53] <cmr> How do you check that?
[04:33:10] <acrichto> back/link.rs
[04:33:24] <acrichto> https://github.com/mozilla/rust/blob/master/src/librustc/back/link.rs#L293
[04:33:53] <osa1_> do you want me to send a pull request so that we can continue discussing there?
[04:34:05] <cmr> osa1_: yes please
[04:34:08] <osa1_> okay
[04:35:35] <cmr> acrichto: So the llretptr is None, but according to the comments on FunctionContext it should never be none after construction..
[04:36:14] <acrichto> hm, well strcat did some optimizations where we don't always have a retptr, and I'd actually imagine that the function would expect an immediate return b/c it's <= sizeof(word)
[04:36:20] *** Quits: osa1_ (omer@moz-8FDAB45C.hsd1.il.comcast.net) (Quit: Konversation terminated!)
[04:38:18] * cmr uses no-verify
[04:44:02] <acrichto> hm, may have found a bug in llvm, to bugpoint!
[04:44:05] <cmr> alright, so the function it's dying on is http://ix.io/9c0
[04:44:28] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[04:44:30] <acrichto> can you find the definition of "struct.any::TypeId" ?
[04:44:46] <acrichto> b/c that looks like it should wokr
[04:44:59] <cmr> "struct.any::TypeId" = type { i64 }
[04:45:09] <cmr> I agree it looks like it should work, I'm quite confused :P
[04:45:12] <acrichto> what
[04:45:22] <cmr> There should be a % in front of that line
[04:46:18] <cmr> Should it be saying %"struct.any::TypeId" instead of { i64 } ?
[04:46:44] <acrichto> not according to http://llvm.org/docs/LangRef.html#constant-expressions apparently
[04:47:06] <acrichto> what's the error message again?
[04:47:31] <cmr> https://gist.github.com/cmr/9138393ff40c0cba56b1
[04:47:58] <acrichto> operand type of return inst...
[04:48:48] <acrichto> I disagree with llvm lol
[04:49:07] <cmr> Oh, llc gives a more useful error
[04:49:14] <cmr> llc: /tmp/f.ll:4:7: error: value doesn't match function result type '%"struct.any::TypeId" = type opaque'
[04:49:30] <acrichto> does the type definition not have a % in front of it?
[04:49:33] <cmr> actually wait this ir isn't incomplete
[04:49:36] <cmr> *is incomplete
[04:49:39] * cmr fixes some things
[04:50:03] <cmr> alright s/opaque/{ i64 }/ and that's the error
[04:50:31] <cmr> Changing it to ret %"struct.any::TypeId" fixes that error.
[04:51:02] <acrichto> interesting
[04:51:04] <cmr> So... how do I use that as the return type with Ret? I imagine it's the represent_type call that's bad, and it should be using an LLVM type name.
[04:51:06] <acrichto> I wouldn't think that'd be necessary
[04:51:20] <acrichto> you'll probably not need to create the struct type manually
[04:51:22] <cmr> (rather than the representation of the type, which is what it seems to be doing)
[04:51:24] <acrichto> but acquire some ref to it
[04:51:36] <acrichto> there's probably some trans thing saying "give me the type of this def id"
[04:52:20] <cmr> just gotta find it..
[04:52:29] <cmr> My first PR touching trans isn't /too/ bad so far
[04:53:10] <cmr> Ohh hm
[04:53:19] <cmr> hm
[04:58:36] <cmr> nope, no idea
[05:03:18] <cmr> Oh, found it! I think... C_struct is a thing
[05:03:39] *** Quits: SiegeLord (sl@moz-C606190.bstnma.fios.verizon.net) (Quit: Leaving)
[05:26:36] <strcat> acrichto: if you have time can you look at https://github.com/mozilla/rust/pull/10690 ?
[05:30:19] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[05:35:58] <cmr> acrichto: so I was looking for C_named_struct
[05:36:00] <cmr> It builds!
[05:37:21] <acrichto> cmr: nice!
[05:37:42] <acrichto> strcat: I'll take a look at it tomorrow, although I want brson to weigh in on it b/c he's got the most ideas for where our documentation should be going
[05:39:55] <cmr> Is LLVM's C++ interface more strongly typed? Ours seems.. fragile.
[05:40:25] <strcat> yes
[05:40:39] <cmr> that's encouraging
[05:40:46] <strcat> LLVM's C++ interface is high-level, has much stronger typing and is really clean
[05:40:46] * cmr is suspicious of ValueRef and Type
[05:41:07] <strcat> the C interface removes all the typing
[05:41:15] <strcat> and it's very crufty because it's drozen
[05:41:17] <strcat> frozen*
[05:41:32] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[05:41:32] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/aRgxjA
[05:41:32] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[05:42:57] <acrichto> yay new snapshots
[05:43:11] *** Quits: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk) (Ping timeout)
[05:43:29] <cmr> yay acrichto landing something :P
[05:43:42] <acrichto> round 2 for static linking, fight!
[05:43:50] <acrichto> although I have a feeling that's going to take at least 10 tries
[05:45:14] *** Joins: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk)
[05:46:31] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[05:46:31] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Q_B7TQ
[05:46:31] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[05:51:10] *** Quits: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk) (Ping timeout)
[05:51:32] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[05:51:33] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Q_B7TQ
[05:51:33] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[05:51:36] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[05:51:36] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/VArr5g
[05:51:36] <ghrust> 13rust/06auto 1457f4a05 15Alex Crichton: Implement a lock-free work-stealing deque...
[05:51:36] <ghrust> 13rust/06auto 1438cf4ed 15bors: auto merge of #10678 : alexcrichton/rust/issue-4877, r=pcwalton...
[05:51:36] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[05:51:47] *** Quits: dbaupp (Thunderbir@A192CB9D.D5A1DCF.37681C44.IP) (Ping timeout)
[05:52:41] *** Joins: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk)
[05:57:40] *** Quits: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk) (Ping timeout)
[05:59:37] *** Joins: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk)
[06:01:46] *** Quits: Jesse (jruderman@moz-5973C6FA.oc.oc.cox.net) (Quit: Jesse)
[06:18:31] *** Joins: Jesse (jruderman@moz-5973C6FA.oc.oc.cox.net)
[06:23:18] *** Quits: Jesse (jruderman@moz-5973C6FA.oc.oc.cox.net) (Quit: Jesse)
[06:24:40] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[06:26:33] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[06:26:33] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1438cf4ed to 14bf6964e: 02http://git.io/N3iJvQ
[06:26:33] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[06:26:40] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[06:26:40] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/dns6Jg
[06:26:40] <ghrust> 13rust/06auto 14e154f65 15Alex Crichton: Implement a lock-free work-stealing deque...
[06:26:40] <ghrust> 13rust/06auto 141a667aa 15bors: auto merge of #10678 : alexcrichton/rust/issue-4877, r=pcwalton...
[06:26:40] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[06:30:01] *** Joins: Jesse (jruderman@moz-5973C6FA.oc.oc.cox.net)
[06:31:08] <strcat> https://github.com/thestinger/rust-core/blob/master/test/thread_local.rs ugly but it works for now ;p
[06:32:17] <strcat> I guess I should teach it the dynamic borrow dance... ;[
[06:32:49] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[06:38:10] *** Joins: mizar99 (onur@F1E050D9.972F1E56.8D47ACD1.IP)
[06:38:14] *** Quits: twb (textual@moz-5DE8950B.hsd1.ga.comcast.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[07:01:42] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[07:01:42] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 141a667aa to 14bf6964e: 02http://git.io/N3iJvQ
[07:01:42] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[07:01:44] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[07:01:44] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/UmGs5A
[07:01:44] <ghrust> 13rust/06auto 141f524f6 15Alex Crichton: Add generation of static libraries to rustc...
[07:01:44] <ghrust> 13rust/06auto 148bbf05f 15Alex Crichton: Statically link librustrt to libstd...
[07:01:44] <ghrust> 13rust/06auto 14c2f71f1 15Alex Crichton: Add a new run-make test directory...
[07:01:46] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[07:21:32] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[07:21:32] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d1e00bc to 14bf6964e: 02http://git.io/N3iJvQ
[07:21:32] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[07:21:38] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[07:21:38] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/XiFhCw
[07:21:38] <ghrust> 13rust/06auto 14e154f65 15Alex Crichton: Implement a lock-free work-stealing deque...
[07:21:38] <ghrust> 13rust/06auto 1416e279b 15bors: auto merge of #10678 : alexcrichton/rust/issue-4877, r=pcwalton...
[07:21:38] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[07:27:34] *** Joins: eddyb (eddy@EBE709F3.F7C96DA2.FCAAE698.IP)
[07:35:05] <eddyb> morning
[07:35:10] <eddyb> cmr: I am hungry for data
[07:35:22] <cmr> eddyb: commented on the PR
[07:35:34] <eddyb> hehe, should've checked that first. found nothing in the IRC logs
[07:37:21] <eddyb> btw, I have a layout idea for a ShortString type. 7 (32-bit) / 15 (64-bit) immediate max length, and potentially up to 0xefffffff / 0xefffffffffffffff indirect max length
[07:38:10] <cmr> so a standard smallstr?
[07:38:13] <eddyb> >_>
[07:38:14] <cmr> :P
[07:38:26] *** Joins: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net)
[07:38:35] <eddyb> yeah, my first question about it is "is this the wheel which I invented?"
[07:39:07] <eddyb> cmr: thanks, that's the 130MB I saw myself
[07:40:51] <eddyb> well, no, the second peak is ~150MB, but the first one is 200MB lower
[07:49:41] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[07:50:07] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[07:58:13] <eddyb> cmr: I've removed the previous naive arena impl, but in a separate commit so I can come back and look at it later :P https://github.com/mozilla/rust/pull/10676/commits
[08:05:07] *** Joins: dbaupp (Thunderbir@moz-3BE4086E.lns20.syd6.internode.on.net)
[08:06:07] <eddyb> can I get a r+ on https://github.com/mozilla/rust/pull/10676? it only shows improvement for now. and it makes it easier to change to Rc later (after it can be used as a pointer)
[08:13:53] <eddyb> then it should show another improvement, because every P<T> will use 3 words less
[08:17:36] *** flaper87|afk is now known as flaper87
[08:24:55] *** Quits: tedh (tedh@moz-A5D1CAB7.public.wayport.net) (Ping timeout)
[08:26:41] <eddyb> https://github.com/mozilla/rust/blob/master/src/libstd/rc.rs#L219 maybe we can have Rc::new_mut(T: Freeze) -> Rc<RefCell<Freeze>>?
[08:27:09] <eddyb> eh, wrong channel. I'm going to do something productive for today, I guess
[08:45:50] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[08:47:55] *** Quits: quvarxa (chatzilla@moz-978E4C31.static.tpgi.com.au) (Ping timeout)
[08:48:05] *** Joins: quvarxa (chatzilla@moz-978E4C31.static.tpgi.com.au)
[08:59:54] *** Quits: bjz (bjz@moz-DD4A2A91.lnse2.cha.bigpond.net.au) (Ping timeout)
[09:11:39] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[09:11:39] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1416e279b to 14bf6964e: 02http://git.io/N3iJvQ
[09:11:39] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[09:11:42] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[09:11:42] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/zYbAzQ
[09:11:42] <ghrust> 13rust/06auto 141f524f6 15Alex Crichton: Add generation of static libraries to rustc...
[09:11:42] <ghrust> 13rust/06auto 148bbf05f 15Alex Crichton: Statically link librustrt to libstd...
[09:11:42] <ghrust> 13rust/06auto 14c2f71f1 15Alex Crichton: Add a new run-make test directory...
[09:11:44] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[09:21:37] *** Joins: tedh (tedh@moz-A5D1CAB7.public.wayport.net)
[09:31:48] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[09:31:48] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14c4ab64d to 14bf6964e: 02http://git.io/N3iJvQ
[09:31:48] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[09:31:49] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[09:31:49] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/6LVExw
[09:31:49] <ghrust> 13rust/06auto 14bfba120 15Alex Crichton: Fix initial debug statements printing twice...
[09:31:49] <ghrust> 13rust/06auto 146c672ee 15bors: auto merge of #10715 : alexcrichton/rust/fix-log-twice, r=huonw...
[09:31:50] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[09:32:14] *** Quits: Kxepal (Miranda@moz-4306BDB7.pppoe.mtu-net.ru) (Ping timeout)
[09:35:17] *** Joins: Kxepal (Miranda@moz-62D3C795.pppoe.mtu-net.ru)
[09:46:38] *** Quits: dbussink (dbussink@moz-E0A5568C.bussink.me) (Quit: bye)
[09:46:57] *** Joins: dbussink (dbussink@moz-E0A5568C.bussink.me)
[09:47:24] *** Quits: mizar99 (onur@F1E050D9.972F1E56.8D47ACD1.IP) (Client exited)
[09:57:17] *** Joins: bjz (bjz@moz-DD4A2A91.lnse2.cha.bigpond.net.au)
[09:58:41] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Ping timeout)
[10:04:39] *** Quits: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net) (Ping timeout)
[10:31:30] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[10:41:35] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[10:41:36] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/6LVExw
[10:41:36] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[11:42:57] <kimundi> r? https://github.com/mozilla/rust/pull/10719
[12:04:19] <dbaupp> kimundi: does https://github.com/mozilla/rust/pull/10719/files#r8000287 mean that you did go and remove them?
[12:07:58] <kimundi> dbaupp: I removed the two reexports in the two integer macros, and was greeted with unresolved import error for uint::min and u32::min in libstd. I expect to see similar errors in syntax, rustc and the testsuite, and in the test module of those libraries
[12:08:40] <kimundi> I could work on that right now, sure, it wouldn't take too long to find them all - But I already made the issue, and this seems like a nice easy mechanical change for a beginner to do
[12:09:48] <dbaupp> kimundi: the next two are in librustc
[12:10:22] <dbaupp> wait, only one in librustc
[12:11:51] <kimundi> dbaupp: Another reason why I didn't do it is that I haven't much time right now to work through a full fix-error-at-every-stage-of-the-makefile dance :P - I need to leave the house in 10 minutes
[12:12:41] <dbaupp> kimundi: that's a good reason :)
[12:17:35] <kimundi> dbaupp: I'll remove the parts of the PR that remove the dummy lifetime parameters later because of the #10703 issue
[12:18:37] <eddyb> who do I have to ask for a r+ on my PR?
[12:22:36] <dbaupp> eddyb: the AST one?
[12:22:44] <eddyb> yupp
[12:22:55] <eddyb> the graph says you want it
[12:24:07] <dbaupp> eddyb: and github says you want it [to be rebased] :P
[12:24:23] <eddyb> hehe. gimme a sec
[12:24:41] <dbaupp> eddyb: "and (optionally) use-after-move handler"?
[12:25:10] <dbaupp> what's that for?
[12:25:20] <eddyb> dbaupp: there's places where you need to insert .clone() on an Rc
[12:25:23] <dbaupp> just bumping the ref count like @ does?
[12:25:43] <eddyb> yupp
[12:25:46] <dbaupp> eurgh, no :(
[12:25:52] <dbaupp> that's part of the problem with @
[12:26:06] <eddyb> thing is, and strcat explained this, @ does it wrong for historical reasons
[12:26:07] <dbaupp> every stack frame in which you use a @ retains a reference
[12:26:18] <dbaupp> how do you get around that?
[12:26:46] <eddyb> @ might get fixed, Rc could do it right from the start
[12:26:56] <dbaupp> it does do it right, right now
[12:27:16] <dbaupp> do you mean `foo(a); bar(a);` => first one gets the handler called, second doesn't?
[12:27:23] <dbaupp> (if a: Rc<T>)
[12:27:28] <eddyb> yupp
[12:27:53] <eddyb> basically, wherever an error would show up right now and you would manually insert a .clone()
[12:28:00] <dbaupp> @ will be fixed if it has a "proper" GC
[12:28:33] <dbaupp> hm, fwiw, I don't think you need to be passing around a Rc so much that the extra .clone()'s are that bad, do you?
[12:29:03] <eddyb> they're just annoying when you want to be generic over a smart pointer
[12:29:12] <eddyb> and by generic I mean my P<T>
[12:29:23] <dbaupp> you'll always need Clone for that?
[12:29:31] <dbaupp> because P might be ~
[12:29:44] <eddyb> nah, AST needs sharing
[12:30:02] <eddyb> unless you want a total redesign
[12:30:16] <eddyb> dbaupp: but I did say optionally, see the P::split_ownership thing
[12:31:36] <dbaupp> eddyb: so it's not just generic over any smart pointer, but it would be generic over SmartPointerUseAfterFree smart pointers (i.e. implementing that trait)
[12:31:45] <dbaupp> yay complexity?
[12:31:54] <eddyb> :P
[12:32:07] <eddyb> aaah, * => .. landed, that's what I have to fix
[12:32:14] <pnkfelix> dbaupp: its not clear that a "proper" GC implies that @ will be fixed
[12:32:21] <pnkfelix> dbaupp: I plan to try to discuss this at next week's meeting
[12:33:00] <dbaupp> pnkfelix: it won't stop stack frames from retaining references to @? (Because I assume it will stop refcounts being bumped for every by-val pass of an @.)
[12:33:31] <dbaupp> hm, I guess it can't without zeroing things.
[12:33:36] <pnkfelix> dbaupp: exactlyu.
[12:33:45] <pnkfelix> dbaupp: We used to have a last-use analysis
[12:34:21] <pnkfelix> dbaupp: which I guess turned the last-use into a move, and the earlier uses into copies?  I don't actually know.
[12:34:36] <pnkfelix> dbaupp: but anyway, that would be one approach to handling this problem in a proper GC
[12:34:57] <pnkfelix> dbaupp: another approach would be to make @T (or Gc<T>, whatever), use move semantics instead of copy, just like Rc does.
[12:35:07] <dbaupp> I guess https://github.com/mozilla/rust/issues/5016 is related (but not totally, since it's removing zeros...)
[12:35:09] *** Quits: quvarxa (chatzilla@moz-978E4C31.static.tpgi.com.au) (Quit: ChatZilla 0.9.90.1 [Firefox 26.0/20131125215016])
[12:35:15] <pnkfelix> dbaupp: and force people to use .clone() everywhere.  :(
[12:35:23] <dbaupp> yeah :(
[12:35:54] <pnkfelix> dbaupp: thus, my plan to ask about it at the next mtg.
[12:36:19] <dbaupp> sounds good.
[12:36:42] <pnkfelix> dbaupp: (I want to find out what was bad about last-use analysis when we had that before.  If we can get away with putting it in, even if only just for Gc<T>, that might be nice.)
[12:36:51] <eddyb> dbaupp: is it fine now?
[12:37:12] <dbaupp> eddyb: well, github says it's mergable, if that's what you're asking.
[12:37:45] *** kimundi is now known as zz_kimundi
[12:38:42] <eddyb> dbaupp: okay, so that's solved. r+?
[12:40:03] <dbaupp> eddyb: not from me :)
[12:40:29] * eddyb needs an IRC plugin tracking the timezones of everyone in the channel
[12:40:36] <dbaupp> pnkfelix: do you happen to have time to review https://github.com/mozilla/rust/pull/10676 for eddyb?
[12:41:17] <pnkfelix> dbaupp: maybe?
[12:42:22] <pnkfelix> eddyb: I'll skim over it now; cannot promise a review yet though
[12:42:40] <eddyb> pnkfelix: thanks, anything is welcome :)
[12:46:20] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[12:48:54] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[13:19:35] <eddyb> rusti: fn in(){}
[13:19:36] -rusti- <anon>:9:9: 9:11 error: found `in` in ident position
[13:19:36] -rusti- <anon>:9          fn in(){}
[13:19:36] -rusti-                   ^~
[13:19:36] -rusti- error: aborting due to previous error
[13:19:36] -rusti- application terminated with error code 101
[13:22:00] <dbaupp> rusti: fn be() {}
[13:22:00] -rusti- <anon>:9:12: 9:14 error: `be` is a reserved keyword
[13:22:00] -rusti- <anon>:9          fn be() {}
[13:22:01] -rusti-                      ^~
[13:22:01] -rusti- application terminated with error code 101
[13:44:10] <eddyb> dbaupp: lol
[13:45:45] <eddyb> rusti: let x be 0;
[13:45:45] -rusti- <anon>:9:15: 9:17 error: expected `;` but found `be`
[13:45:45] -rusti- <anon>:9          let x be 0;
[13:45:46] -rusti-                         ^~
[13:45:46] -rusti- application terminated with error code 101
[13:46:15] <eddyb> rusti: let self be free;
[13:46:16] -rusti- pastebinned 7 lines of output: http://sprunge.us/UMiA
[13:48:50] <pnkfelix> eddyb: Did you run your PR though a full build of all stages, a la the default make rule?
[13:51:03] <pnkfelix> eddyb: I get rustc errors when it attempts to build librustdoc 
[13:57:05] <klutzy> eddyb: I think ast::P<ast::Block> part is confusing if it just uses @ really
[13:57:41] <klutzy> since visitor methods already use @
[13:58:20] <klutzy> it would be good if @-ptrs are removed in ast, but P<T>-ing doesn't help it now, and it just changes only one part of them
[14:17:17] *** Joins: nuts (tii@822A8E7E.6AD15BF5.75D3BBDB.IP)
[14:30:01] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[14:31:06] <eddyb> pnkfelix: aaaaaah, I forgot cmr told me about that >_<
[14:32:47] <eddyb> klutzy: the plan is to replace all @T in the AST with P<T>, and then change P<T>
[14:35:11] <klutzy> your plan?
[14:35:30] <klutzy> there's an issue on de-@ ast: https://github.com/mozilla/rust/issues/7929
[14:36:59] <eddyb> do I have to feel stupid *again*?
[14:39:39] <eddyb> and I have to leave :/. I'll try to get rustdoc working tomorrow
[14:41:34] *** Quits: eddyb (eddy@EBE709F3.F7C96DA2.FCAAE698.IP) (Ping timeout)
[14:47:43] *** zz_kimundi is now known as kimundi
[14:54:23] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[15:05:33] *** kimundi is now known as zz_kimundi
[15:26:45] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[15:29:44] <ktt3ja> is ast::item_foreign_mod an extern block?
[15:32:55] <strcat> yes
[16:00:08] *** zz_kimundi is now known as kimundi
[16:08:36] *** Quits: Sharp (Sharp@moz-780FECDA.washdc.fios.verizon.net) (Quit: Sharp)
[16:51:39] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[16:51:39] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/ZMCDAw
[16:51:39] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[16:51:43] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[16:51:43] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/upvr6g
[16:51:43] <ghrust> 13rust/06auto 1466fbe7a 15Patrick Walton: libstd: Change `Path::new` to `Path::init`.
[16:51:43] <ghrust> 13rust/06auto 14d3a3fe0 15bors: auto merge of #10697 : pcwalton/rust/path-new, r=pcwalton...
[16:51:43] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[17:10:08] *** Joins: twb (textual@moz-5DE8950B.hsd1.ga.comcast.net)
[17:24:05] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[17:26:02] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[17:36:46] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[17:36:46] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d3a3fe0 to 146c672ee: 02http://git.io/N3iJvQ
[17:36:46] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[17:36:48] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[17:36:48] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/bRRYzA
[17:36:48] <ghrust> 13rust/06auto 14fffa10c 15Felix S. Klock II: Removed some dead code....
[17:36:48] <ghrust> 13rust/06auto 14631cbd2 15bors: auto merge of #10726 : pnkfelix/rust/fsk-remove-at-fn-artifact, r=thestinger...
[17:36:49] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[18:27:14] *** Joins: eddyb (eddy@EBE709F3.F7C96DA2.FCAAE698.IP)
[18:28:52] <strcat> acrichto: haha, I realized #[link_name = "llvm.foo"] works
[18:28:54] <strcat> *sigh*
[18:29:08] <strcat> do you realize how much work could have been saved by not writing intrinsics?
[18:29:11] <strcat> ;p
[18:37:02] *** Joins: jmbto (jmbto@moz-FE174E29.fbx.proxad.net)
[18:46:41] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[18:46:41] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/bRRYzA
[18:46:41] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[18:49:35] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[18:49:39] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[18:49:47] <erickt1> r? https://github.com/mozilla/rust/pull/10727
[18:56:20] <eddyb> strcat: oooh, can we use that + inline(always) to create a RTTI wrapper for VLAs, in Rust?
[18:57:25] <eddyb> it would be prone to exploding, though
[18:58:17] <strcat> eddyb: well I'm going to start by removing half the intrinsics
[18:58:21] <eddyb> hehe
[18:58:31] <eddyb> extern "llvm" pls
[18:58:36] <strcat> eddyb: don't need it
[18:58:51] <strcat> you don't need to specify an ABI for it
[19:00:11] *** Quits: eddyb (eddy@EBE709F3.F7C96DA2.FCAAE698.IP) (Ping timeout)
[19:01:51] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[19:01:51] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Y1DV7g
[19:01:51] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[19:01:58] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[19:01:58] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/6zFpYg
[19:01:58] <ghrust> 13rust/06auto 14c54427d 15Patrick Walton: libstd: Change `Path::new` to `Path::init`.
[19:01:58] <ghrust> 13rust/06auto 1408f4d1f 15bors: auto merge of #10697 : pcwalton/rust/path-new, r=pcwalton...
[19:01:59] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[19:17:51] *** Joins: eddyb (eddy@EBE709F3.F7C96DA2.FCAAE698.IP)
[19:22:13] <eddyb> strcat: did you get to mark core::thread and core::concurrent as cfg(pthread)?
[19:28:00] *** Quits: twb (textual@moz-5DE8950B.hsd1.ga.comcast.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[19:32:15] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[19:33:10] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[19:33:53] <acrichto> ugh windows
[19:34:17] <eddyb> Visual Rust
[19:38:10] *** Joins: twb (textual@moz-5DE8950B.hsd1.ga.comcast.net)
[19:41:22] *** Quits: Jesse (jruderman@moz-5973C6FA.oc.oc.cox.net) (Quit: Jesse)
[19:41:35] <kimundi> dbaupp, acrichto: I fixed the things you talked about in my macro module reexport workaround PR
[19:47:09] *** Joins: jdm (jdm@FCCEA34F.7672369.D8E68FF6.IP)
[19:52:02] *** Joins: SiegeLord (sl@moz-C606190.bstnma.fios.verizon.net)
[19:52:11] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[19:53:11] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[19:55:50] *** Joins: Jesse (jruderman@moz-5973C6FA.oc.oc.cox.net)
[19:57:15] *** Joins: tikue (tkuehn@moz-C55F9DFF.hsd1.pa.comcast.net)
[19:57:59] *** Quits: tikue (tkuehn@moz-C55F9DFF.hsd1.pa.comcast.net) (Quit: tikue)
[20:08:23] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[20:11:41] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[20:11:41] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/6zFpYg
[20:11:42] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[20:16:42] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[20:16:42] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/uxpnHw
[20:16:42] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[20:16:44] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[20:16:44] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/z0HwQg
[20:16:44] <ghrust> 13rust/06auto 14a0fb2f5 15Alex Crichton: Add generation of static libraries to rustc...
[20:16:44] <ghrust> 13rust/06auto 14e051915 15Alex Crichton: Statically link librustrt to libstd...
[20:16:44] <ghrust> 13rust/06auto 14529afc3 15Alex Crichton: Add a new run-make test directory...
[20:16:46] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[20:31:51] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[20:31:51] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 149f181ca to 1408f4d1f: 02http://git.io/N3iJvQ
[20:31:51] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[20:31:58] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[20:31:58] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/qCt1Iw
[20:31:58] <ghrust> 13rust/06auto 14a70f9d7 15Alex Crichton: Implement a lock-free work-stealing deque...
[20:31:58] <ghrust> 13rust/06auto 14dd1184e 15bors: auto merge of #10678 : alexcrichton/rust/issue-4877, r=pcwalton...
[20:31:59] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[20:37:51] <strcat> eddyb: lets just make reachable work so it counts as dead code.
[20:41:46] *** Quits: jmbto (jmbto@moz-FE174E29.fbx.proxad.net) (Quit: Leaving)
[20:52:06] *** Joins: tikue (tkuehn@moz-C55F9DFF.hsd1.pa.comcast.net)
[21:01:58] <eddyb> strcat: that sounds harder
[21:02:36] *** Quits: tikue (tkuehn@moz-C55F9DFF.hsd1.pa.comcast.net) (Quit: tikue)
[21:02:56] <eddyb> but... it would allow dropping cfg(libc), and it would be pay-for-what-you-use in a similar way to lang items
[21:05:05] <strcat> well it should still compile without optimizations
[21:05:17] <strcat> but where do you actually have all-of-libc-but-pthread?
[21:05:39] <strcat> what about libm? or more esoteric standard C/POSIX functions
[21:12:06] <eddyb> well, a custom default heap implementation in Rust and no libc-based stuff would work best here
[21:12:44] <eddyb> #[cfg(libc)] cfg_set!(has_default_heap)
[21:14:22] <strcat> that's not going to work
[21:15:24] <eddyb> just because cfg_set! doesn't exist?
[21:15:40] <strcat> how is it going to get the non-default heap
[21:17:36] <strcat> atm due to all of the language limitations I am not prioritizing exposing containers to non-libc-based rust-core
[21:17:46] <strcat> I'm not going to do anything that wouldn't work in a crate situation
[21:18:10] <eddyb> couldn't a crate have link-time dependencies?
[21:18:19] <strcat> that's what malloc/free are
[21:18:21] <strcat> weak symbols
[21:18:30] <strcat> you can override the libc implementations
[21:18:59] <eddyb> but I want to implement a trait :(
[21:19:09] * eddyb likes fancy abstractions
[21:19:17] <strcat> you can implement the trait for alternate allocators
[21:19:23] <strcat> the default allocator has to be implemented in the lib
[21:20:17] <eddyb> does static linking work yet?
[21:20:28] <strcat> hasn't landed yet
[21:20:36] <strcat> and if it does, it's still not LTO
[21:21:12] <strcat> #[macro_escape] needs to work at a crate level along with a bunch of work on making inlining/generics not have to redo work with LTO I guess
[21:22:12] <eddyb> I'm not sure something like rustic would want rust-core as a crate. so you won't take patches that expose cfg-gated behavior only for non-crate scenarios?
[21:22:20] <eddyb> s/patches/pullreqs/
[21:23:13] <strcat> I think the current plan for the allocator is the only way to do it
[21:23:21] <strcat> I wouldn't mind making the libc cfg more fine-grained
[21:23:25] <strcat> but it has to be planned out
[21:24:03] <strcat> it's likely that I'll have decided to make libcurl, libarchive, sqlite3, etc. bindings as part of rust-core before generic dtors work ;p
[21:24:16] <eddyb> I might just have to use a fork in rustic, just like rust uses forks of LLVM and libuv
[21:24:36] <strcat> what is wrong with calling malloc/free/realloc in the default allocator?
[21:24:40] <strcat> you can provide those functions
[21:25:06] <eddyb> strcat: Slam/Blam Allocator can provide things like size-hints that get inlined to two instructions
[21:25:28] <strcat> the size hints don't really seem to help vectors much though
[21:25:43] <strcat> the cost is already amortized and the allocator already does in-place realloc
[21:25:55] <strcat> so the size hint just avoids a realloc call that would have been a no-op
[21:26:03] <strcat> so it avoids a search for the allocation by the allocator
[21:26:15] <strcat> and it's an amortized cost.... nearly pointless, can't measure a difference
[21:26:19] <eddyb> other than that, it's inlining
[21:26:55] <eddyb> which I guess would work anyway
[21:27:53] <eddyb> oh, and... can't use rust-core as a crate right now, and having it as part of the module tree means I can't define an external malloc function because of the malloc import in rust-core
[21:28:51] <strcat> eddyb: you can define malloc in another crate
[21:28:53] <strcat> and statically link it
[21:29:05] <strcat> like that support.rs crate
[21:29:27] <strcat> anyway I realize there are a lot of language limitations
[21:29:31] <strcat> but I want them fixed, not worked around
[21:29:47] <strcat> and I think the current situation is fine until they're fixed
[21:30:10] <eddyb> we might have had this exact discussion before :(
[21:31:57] <eddyb> strcat: eh, can't wait for DST and the Fn trait (which I should be working on :P)
[21:32:30] <eddyb> right now I'm looking at IRQ handling in rustic and I wish I had Rc<Trait> working
[21:34:21] <eddyb> or ~||
[21:39:57] *** Joins: tikue (tkuehn@moz-C55F9DFF.hsd1.pa.comcast.net)
[21:41:09] *** Quits: tikue (tkuehn@moz-C55F9DFF.hsd1.pa.comcast.net) (Quit: tikue)
[21:41:39] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[21:41:39] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/qCt1Iw
[21:41:39] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[21:44:42] <eddyb> hmm, what's with this? https://github.com/mozilla/rust/pull/10697
[21:45:26] <dbaupp> eddyb: placement new
[21:45:47] <eddyb> is that decided?
[21:45:49] <strcat> acrichto: rust makes all dtors external fns now :(
[21:46:39] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[21:46:39] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/7l3Z0Q
[21:46:39] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[21:47:02] <eddyb> dbaupp: is there an issue tracking it?
[21:53:10] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[21:56:41] <eddyb> dbaupp: didn't find anything on github search
[22:01:50] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[22:01:50] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 141c6e228 to 14dd1184e: 02http://git.io/N3iJvQ
[22:01:50] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[22:01:57] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[22:01:57] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/ISEL2g
[22:01:57] <ghrust> 13rust/06auto 1490f9eb3 15Marvin LÃ¶bel: Removed a few macro-expanding-to-module workarounds...
[22:01:57] <ghrust> 13rust/06auto 140d8ace8 15Marvin LÃ¶bel: Removed useless cmp::{min, max} reexports from the integer modules
[22:01:57] <ghrust> 13rust/06auto 144840064 15Marvin LÃ¶bel: Removed module macro workaround for signed and unsigned integers
[22:01:59] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[22:02:55] <dbaupp> eddyb: um not that I know of; talk to pcwalton.
[22:05:10] <strcat> eddyb: at least there is static thread-local data now ;p
[22:05:23] <strcat> anyway reorganized rust-core a bit...
[22:05:36] <strcat> macros are a PITA to deal with
[22:05:54] * strcat wishes there was an easy was to make them scoped in namespaces
[22:06:51] <dbaupp> strcat: call them concurrent_..., container_... whatever? /s
[22:07:00] <strcat> dbaupp: https://github.com/thestinger/rust-core/blob/master/core/macros.rs
[22:07:17] <strcat> core_likely, core_unlikely? meh.
[22:07:25] <strcat> I'll just pollute the scope
[22:07:32] <strcat> without 'use' statements it's too painful otherwise
[22:08:21] <strcat> LLVM really needs to learn to hoist out code so I don't have to do it myself
[22:09:08] <dbaupp> Oh, I see
[22:09:30] <SiegeLord> I didn't think there was consensus on what placement new syntax was going to be... ._.
[22:10:20] <strcat> the compiler injecting a bunch of macros is a pain
[22:11:55] * dbaupp wants metadata to be sane so that macro import/export works.
[22:12:17] <dbaupp> SiegeLord: I think there was consensus on it existing and hence `new` being reserved
[22:12:36] <dbaupp> (so we need to move all the functions called new away from that.)
[22:18:30] <eddyb> so new Path would call Path::init() or something like that?
[22:18:56] <eddyb> it better be at least as flexible as calling Type::new today
[22:19:46] <dbaupp> I don't know
[22:20:12] <dbaupp> I though it would be `new(SmartPointer) Path::init()` to create a SmartPointer<Path>
[22:20:28] *** Joins: Sharp (Sharp@moz-39EFDA61.hfc.comcastbusiness.net)
[22:20:41] *** Joins: jmbto (jmbto@moz-FE174E29.fbx.proxad.net)
[22:20:55] <eddyb> dbaupp: eughasdfghjkl;
[22:20:57] <dbaupp> I'm not sure of the details (I think/would hope that the bracketed stuff is an expression rather than a type, if it wasn't clear from my example)
[22:21:38] <dbaupp> eddyb: that doesn't look like English or Romanian. :P
[22:22:41] <eddyb> SmartPointer::new(Path::new()) has the exact same length
[22:23:37] <dbaupp> but it doesn't work quite right
[22:23:56] <dbaupp> it'd need some magic to get that Path written directly to the SmartPointer's internal memory
[22:24:12] <dbaupp> (which I guess new() expr would have too, but it's more obvious there's magic that way)
[22:24:31] <eddyb> dbaupp: the magic is in inlining
[22:25:11] <eddyb> with Rc, it becomes ~Path::new(), which ends up allocating then writing to the allocated area
[22:26:47] <dbaupp> eddyb: what if you don't want it inlined?
[22:26:55] <dbaupp> (and what about non -O builds?)
[22:27:20] <eddyb> erm, I think returning a large object is done by passing a hidden pointer as an argument
[22:27:53] <eddyb> so ~Path::new() is (maybe) Path::new(malloc(size_of::<Path>()))
[22:28:07] <dbaupp> yeah, but Rc::new(HugeStruct::new()) would be `let tmp = HugeStruct::new(); Rc::new(tmp)` where `tmp` is written to directly, but it's memcpyed into Rc::new
[22:28:20] <dbaupp> (without inlining and/or optimisations)
[22:28:54] <eddyb> if placement new is just an optimization, I'm going to be a sad eddy bear
[22:29:29] <dbaupp> of course it just an optimisation? since the Ptr::new((Val::new()) will always work?
[22:29:34] <dbaupp> )
[22:29:56] <dbaupp> (in any case, I don't know if that's the definite syntax, nor even if it's the current top proposal.)
[22:31:04] *** Quits: jmbto (jmbto@moz-FE174E29.fbx.proxad.net) (Quit: Leaving)
[22:36:44] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[22:38:03] *** Quits: Sharp (Sharp@moz-39EFDA61.hfc.comcastbusiness.net) (Quit: Sharp)
[22:51:15] *** Joins: quvarxa (chatzilla@moz-978E4C31.static.tpgi.com.au)
[23:15:55] *** Quits: eddyb (eddy@EBE709F3.F7C96DA2.FCAAE698.IP) (Ping timeout)
[23:18:27] *** Joins: Sharp (Sharp@moz-39EFDA61.hfc.comcastbusiness.net)
[23:21:54] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[23:31:43] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[23:31:43] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/ISEL2g
[23:31:43] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[23:36:37] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[23:36:37] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/qLzP4w
[23:36:37] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[23:36:41] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[23:36:41] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/jSjSSw
[23:36:41] <ghrust> 13rust/06auto 14a0fb2f5 15Alex Crichton: Add generation of static libraries to rustc...
[23:36:41] <ghrust> 13rust/06auto 14e051915 15Alex Crichton: Statically link librustrt to libstd...
[23:36:41] <ghrust> 13rust/06auto 14529afc3 15Alex Crichton: Add a new run-make test directory...
[23:36:43] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[23:53:14] *** Quits: twb (textual@moz-5DE8950B.hsd1.ga.comcast.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[23:54:44] *** Quits: Sharp (Sharp@moz-39EFDA61.hfc.comcastbusiness.net) (Quit: Sharp)
