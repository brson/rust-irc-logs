[01:03:53] <seanmonstar> aturon or acrichto: i've learned that calling tcp.shutdown(Write) more than once has different behavior on Linux vs Mac
[01:05:05] <seanmonstar> unsure which behavior is correct, but it may be nice to normalize them
[01:13:18] *** Quits: Rym_ (y@moz-a44.2as.55.31.IP) (Ping timeout: 121 seconds)
[01:27:52] <acrichto> seanmonstar: can you open a bug? In general the calls are intended to clearly translate to the underlying system primitive, but if there's a way we can unify the two easily it may be good to do so
[01:28:24] <seanmonstar> acrichto: sure
[01:28:57] <seanmonstar> acrichto: in this case, on Linux calling it twice is no big deal, on Mac the second call returns ErrorKind::NotConnected
[01:31:28] <acrichto> seanmonstar: hm that may be something that's not worth abstracting over, but you never know!
[01:33:01] <seanmonstar> acrichto: if not, it'd be nice if the docs could be updated at least?
[01:33:22] <acrichto> seanmonstar: surely!
[01:33:24] <seanmonstar> i was caught unawares, since i develop on linux and have no mac
[02:20:53] *** Quits: zz_kimundi (kimundi@moz-136e94.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:22:16] *** Joins: zz_kimundi (kimundi@moz-l2r.uqm.188.87.IP)
[02:22:22] *** zz_kimundi is now known as kimundi
[02:28:02] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[02:32:56] *** Joins: annodomini (lambda@moz-qgii5v.ma.comcast.net)
[02:37:58] *** Quits: c74d (c74d3a4ebb6@moz-0ersgu.oc.cox.net) (Ping timeout: 121 seconds)
[02:38:39] *** Joins: c74d3 (c74d3a4ebb6@moz-0ersgu.oc.cox.net)
[02:39:03] *** c74d3 is now known as c74d
[02:42:23] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[02:52:18] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[03:02:47] *** Joins: c74d3 (c74d3a4ebb6@moz-tqsci9.mggc.hibn.4404.2002.IP)
[03:02:58] *** Quits: c74d (c74d3a4ebb6@moz-0ersgu.oc.cox.net) (Ping timeout: 121 seconds)
[03:03:27] *** c74d3 is now known as c74d
[03:14:57] *** Quits: archshift (archshift@moz-qhvdod.com) (Ping timeout: 121 seconds)
[03:20:33] *** Joins: archshift (archshift@moz-qhvdod.com)
[03:43:34] *** Joins: p1start (p1start@moz-nftjhe.org)
[04:24:59] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Connection closed)
[04:28:24] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[04:29:22] *** Quits: c74d (c74d3a4ebb6@moz-tqsci9.mggc.hibn.4404.2002.IP) (Ping timeout: 121 seconds)
[04:31:08] *** Joins: c74d (c74d3a4ebb6@moz-0ersgu.oc.cox.net)
[04:43:13] *** Quits: annodomini (lambda@moz-qgii5v.ma.comcast.net) (Client exited)
[05:37:19] *** Quits: aatch (james@moz-ciignl.bmm3.j08e.e000.2406.IP) (Connection closed)
[05:54:11] *** kimundi is now known as zz_kimundi
[06:48:24] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[07:12:39] *** Joins: p1start (p1start@moz-nftjhe.org)
[07:14:32] *** Quits: scott (uid25790@moz-e5ok1n.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[07:25:46] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Connection closed)
[07:44:27] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[08:26:24] *** zz_kimundi is now known as kimundi
[08:47:38] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[08:50:15] *** Joins: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net)
[08:50:15] *** ChanServ sets mode: +o pnkfelix
[09:15:09] <o11c> if you want to get *really* weird, try doing a half shutdown on an SCTP connection, which for some reason doesn't support half shutdowns in the spec
[09:15:22] <o11c> which I find really annoying
[09:16:02] <aatch> SCTP?
[09:16:17] <aatch> something something Transfer Protocol?
[09:17:51] <o11c> https://en.wikipedia.org/wiki/Stream_Control_Transmission_Protocol
[09:17:59] <o11c> it's like TCP but not dumb
[09:18:55] <o11c> unfortunately way too many routers only support TCP and UDP
[09:19:31] <aatch> o11c, seems relatively new (compared to TCP at least).
[09:19:33] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[09:19:58] <o11c> well, of course in order to fix the mistakes you have to come later
[09:21:59] <huon> something can be better and come first but not get more adoption
[09:23:59] <aatch> I just think the SCTP hasn't been around long enough. The definition itself was only in 2000, which in IETF-time is hardly any time at all.
[09:25:51] <aatch> Linux has supported it since 2.4, and a few BSDs support it. Only a third-party driver for Windows though, and no mention of Darwin.
[09:27:08] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[09:36:00] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[09:37:48] <o11c> there is a userland implementation (tunneled over UDP) called libusrsctp, but it's crap
[09:38:01] <o11c> IIRC it creates 4 threads per socket or something
[09:38:51] <o11c> I was going to write some netfilter magic so that my application could use the kernel's sctp but the network would see it wrapped in udp, but then I discovered the server I was working on had udp blocked
[09:50:29] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[10:49:30] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[11:00:44] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[11:01:04] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Connection closed)
[11:35:11] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[12:07:57] *** kimundi is now known as zz_kimundi
[12:22:05] *** Joins: annodomini (lambda@moz-qgii5v.ma.comcast.net)
[12:34:38] *** Quits: annodomini (lambda@moz-qgii5v.ma.comcast.net) (Client exited)
[12:55:34] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Quit: rcirc on GNU Emacs 24.5.1)
[13:11:48] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[13:20:29] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[13:24:58] *** Joins: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP)
[13:24:59] *** ChanServ sets mode: +o pnkfelix
[13:31:49] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[13:57:51] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[13:58:32] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[14:02:44] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[14:07:46] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[14:09:20] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[15:05:23] *** zz_kimundi is now known as kimundi
[15:24:44] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[15:41:24] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[15:50:29] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Ping timeout: 121 seconds)
[15:54:12] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[15:55:15] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[16:17:29] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[16:22:02] *** Quits: eternaleye (eternaleye@moz-7ps.ehi.245.50.IP) (Ping timeout: 121 seconds)
[16:23:44] *** Joins: eternaleye (eternaleye@moz-7ps.ehi.245.50.IP)
[16:27:54] *** Quits: eternaleye (eternaleye@moz-7ps.ehi.245.50.IP) (Connection closed)
[16:30:59] *** Quits: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP) (Ping timeout: 121 seconds)
[16:30:59] *** Joins: eternaleye (eternaleye@moz-7ps.ehi.245.50.IP)
[16:41:42] <Yurume> erickt, hmm, do you have any particular reason to have a separate `escape` variable here? https://github.com/serde-rs/serde/blob/master/src/json/de.rs#L310
[16:43:09] <erickt> Yurume: have a better way to write escaping characters?
[16:43:48] <Yurume> my premature optimization (hah!) to separate non-escaping cases and escaping cases had some visible effects on benches
[16:44:06] <Yurume> i.e. match ch { b'\\' => { let ch = ...; match ch { b'"' => ... } } ... }
[16:44:08] <erickt> I love premature optimizations!
[16:44:38] <Yurume> at the very least, the current form is not very good for branch predictor I guess
[16:45:02] <erickt> I wouldn't be surprised. Got a PR that rewrites it?
[16:46:05] <Yurume> bench_deserializer in the bench_log gives 9180 +/- 110 ns/iter for the old code and 8606 +/- 37 ns/iter for the new code in my local machine
[16:46:29] <erickt> souhds delightful
[16:46:37] <erickt> err, *sounds*
[16:46:41] <Yurume> I'll retest the old code to see if a lower stdev has an effect on the estimated average
[16:47:18] <erickt> I'd be fine landing that change too without it impacting the benchmarks. it seems cleaner anyway
[16:51:02] *** Joins: annodomini (lambda@moz-hceqmj.hfc.comcastbusiness.net)
[16:51:11] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[16:51:35] <Yurume> 8920 +/- 118 ns/iter in the retest. still slightly better I guess.
[16:51:43] <Yurume> I'll put a PR soon :)
[16:51:55] <Yurume> (I meant, 8920 is a figure for the old code)
[16:53:35] <erickt> yeah sounds like it's either noise or it's slightly faster
[16:53:54] <erickt> I've run into that lots of times :)
[16:55:25] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[16:57:12] <Yurume> erickt, https://github.com/serde-rs/serde/pull/71 done .
[16:58:38] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[16:59:01] *** Joins: annodomini_ (lambda@moz-hceqmj.hfc.comcastbusiness.net)
[16:59:33] *** Quits: annodomini (lambda@moz-hceqmj.hfc.comcastbusiness.net) (Ping timeout: 121 seconds)
[16:59:33] *** annodomini_ is now known as annodomini
[17:02:45] <erickt> Yurume: awesome! Once the travis build builds, I'll merge it in
[17:02:52] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[17:03:13] *** Joins: brson (brson@moz-4cm.c9m.56.172.IP)
[17:03:13] *** ChanServ sets mode: +qo brson brson
[17:07:28] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[17:12:55] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[17:24:07] *** Joins: brson_ (brson@moz-cfhap5.mtv2.mozilla.com)
[17:27:33] *** Quits: brson (brson@moz-4cm.c9m.56.172.IP) (Ping timeout: 121 seconds)
[17:33:47] *** Quits: brson_ (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[17:33:56] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[17:33:56] *** ChanServ sets mode: +qo brson brson
[17:52:01] <erickt> Yurume: merged!
[17:58:00] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Connection closed)
[17:59:22] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[18:02:33] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Connection closed)
[18:05:00] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[18:07:02] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[18:53:57] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[19:18:10] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[19:21:41] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[19:23:29] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[19:29:09] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[19:30:09] *** Joins: p1start (p1start@moz-nftjhe.org)
[19:35:03] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[19:35:56] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[19:53:30] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[20:51:27] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[21:13:29] <eternaleye> o11c: SCTP has some niceness, but it also has some very real drawbacks IMO
[21:16:36] <eternaleye> o11c: One is that it fixes the number of streams at connect() time - there's an extension to renegotiate that, but three guesses on how supported that is
[21:16:50] <eternaleye> o11c: Another is that supporting TLS with SCTP is a horrorshow
[21:17:07] <eternaleye> o11c: One method runs TLS over each stream individually and only supports SOCK_STREAM semantics
[21:17:40] <eternaleye> o11c: The other method runs DTLS over the thing, but loses a number of the security guarantees of full TLS, which _could_ have been made regarding SOCK_STREAM *and* SOCK_SEQPACKET
[21:18:15] <eternaleye> o11c: Another is that SCTP is Yet Another Port Namespace, and thus sysadmins are very reluctant to deal with it re: firewalls
[21:18:30] <eternaleye> o11c: Another is that the four-way handshake is more RTT on connection
[21:18:40] <eternaleye> o11c: And so forth.
[21:21:02] <eternaleye> o11c: The reason for a lot of this is that it was designed as part of the whole SS7 telephony thing, as a way to replace their custom optical signaling with IP-based stuff
[21:21:37] <eternaleye> o11c: So SCTP was designed to have a very 1-to-1 relationship with the old optical stuff, which had fixed stream counts, and was very long-lived
[21:22:01] <eternaleye> o11c: So fixed stream count, expensive handshake no big deal, security stuff not relevant since it'll be long-lived over ipsec...
[21:27:53] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[21:29:32] <o11c> eternaleye: as far as fixed streams go, my understanding is that you man many application-level streams onto a single SCTP stream
[21:31:10] <eternaleye> o11c: Sure, but then you get the same issue of head-of-line blocking you get on TCP
[21:31:12] <o11c> eternaleye: and the four-way handshake is *important* to avoid the syn-cookies hack, which is mere mitigation
[21:31:15] <eternaleye> o11c: Just slightly offset
[21:31:18] <eternaleye> o11c: Agreed
[21:31:36] <eternaleye> o11c: But the "right" way to do that is to integrate security handling more deeply
[21:31:57] <eternaleye> o11c: Because otherwise you then have a load more roundtrips on the top, for shoddy security guarantees
[21:32:26] <o11c> is there really any way to prevent a server from allocation bogus resources upfront without 4-way?
[21:32:54] <eternaleye> o11c: No, but there _are_ ways to not then require another 2-4 round trips _after_ that for security
[21:33:22] <o11c> ah, I see what you mean
[21:34:22] <o11c> adding the session layer logic at the transport level
[21:34:28] <eternaleye> And as I said above, TLS/DTLS map _really badly_ to SCTP
[21:34:55] <eternaleye> DTLS gives up a good bit of TLS' anti-interference guarantees, and TLS is deeply designed for single-stream
[21:35:10] <o11c> I would look into, say, what mosh uses
[21:35:21] <eternaleye> o11c: I'd highly recommend looking at the Yale DeDiS group's "Tng" project
[21:35:30] <o11c> which is at least UDP, even if it's mostly single-stream
[21:35:34] <eternaleye> o11c: Which is about splitting the "Transport" layer into four smaller sublayers
[21:35:41] <o11c> anyway I'm not a crypto nerd
[21:35:46] <eternaleye> http://dedis.cs.yale.edu/2009/tng/
[21:36:06] <eternaleye> o11c: The above doesn't require being a crypto nerd, or even (much of) a protocols nerd
[21:38:21] <o11c> I just wish there was some easy-to-use, hard-to-mess-up library for crypto
[21:39:02] <cmr> libsodium?
[21:39:08] <o11c> probably should proxy everything through a separate process
[21:40:43] <eternaleye> cmr: libsodium/nacl is such for crypto in a sense, but not so much for crypto _protocols_ sadly.
[21:41:01] <eternaleye> cmr: Crypto protocols are a whole 'nother can of worms from just crypto.
[21:41:14] <cmr> That is true, yes.
[22:11:01] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Connection closed)
[22:11:37] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Connection closed)
[22:12:40] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[22:37:21] <eternaleye> o11c: One thing that might be good re: channelized protocols would be to use Rogaway's CHAIN construction, and fork the state when you split a stream from its parent (followed by mixing in new AD about the new channel ID)
[22:38:12] <eternaleye> o11c: best-case online AEAD guarantees, arbitrary stream count support, and SOCK_STREAM and/or SOCK_SEQPACKET semantics within each stream enforced by the crypto
[22:56:15] <o11c> eternaleye: link? I'm not very good at googling that sort of thing apparently ...
[23:00:43] <eternaleye> o11c: https://eprint.iacr.org/2015/189
[23:34:15] *** kimundi is now known as zz_kimundi
