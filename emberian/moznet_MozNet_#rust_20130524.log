[00:00:06] <MaikKlein> got it
[00:00:27] *** Joins: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP)
[00:00:27] <ghrust> 01[13rust01] 15bors merged 06auto into 06incoming: 02http://git.io/Aa-iJg
[00:00:27] *** Parts: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP) ()
[00:01:41] <a_m0d> I am using #[link(name="timer",vers="0.1")] at the top of my crate, but get warnings that both name and vers are not defined
[00:03:24] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[00:03:25] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/_1N1Zw
[00:03:25] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[00:03:57] <brson> a_m0d: is your attribute semicolon-terminated?
[00:04:12] <a_m0d> brson: no
[00:04:32] <a_m0d> I missed that
[00:05:20] <a_m0d> Thanks, that did the trick.  Why is the semicolon needed for those attributes but not other ones?
[00:07:05] <aatch> a_m0d, it changes where it applies
[00:07:17] <nmatsakis> brson: I keep being surprised that such attributes are not #![...]
[00:07:31] <aatch> #[link(name="timer")] applies to the next item.
[00:07:58] <brson> nmatsakis: I think i would prefer that syntax too
[00:08:04] <brson> there's an issue open on it
[00:08:09] <aatch> #[link(name="timer")]; applies to the enclosing item (in this case the crate)
[00:08:11] <brson> maybe we should just pull the trigger
[00:08:22] <aatch> I agree though that it isn't particularly clear
[00:08:25] <brson> I think the only reason not to is #! (shebang)
[00:08:33] <brson> but it's not a strong reason
[00:08:34] *** Quits: deLta30 (quassel@11AC52F3.2170BEB9.110F01C1.IP) (Ping timeout)
[00:08:37] <aatch> and also inconsistent with doc comments
[00:08:39] *** Quits: mschifer (Adium@2557E599.66715431.D25A875A.IP) (Quit: Leaving.)
[00:08:44] <a_m0d> aatch: thanks, that makes a bit more sense
[00:08:47] <MaikKlein> found a bug in the docs or language dunno static.rust-lang.org/doc/core/rand.html let rng = rand::rng(); needs to be let mut rng = rand::rng();
[00:09:04] <a_m0d> would #[link(...)] ever apply to anything other then the whole crate?
[00:09:19] <aatch> a_m0d, unlikely, but attributes are fairly general
[00:09:36] <aatch> so it would mean special-casing it.
[00:09:49] <a_m0d> ah, so a warning for that wouldn't make sense then
[00:09:50] <aatch> And the words "special-case" make me nervous.
[00:09:57] <jclements> aatch: +1. ick, blecch.
[00:10:22] <jclements> you could add a warningâ€¦.
[00:10:33] <aatch> In fact, that's why I like Rust, very few special cases.
[00:10:42] <aatch> jclements, yeah, I was thinking that.
[00:12:46] <aatch> And some of the existing special cases are actively being worked on to make them part of the general semantics (I.E, Sized vs Unsized types, which should unify all of the cases around `~`, `@` and `&` constructs)
[00:13:35] *** Joins: samnardoni (samnardoni@moz-ECB14881.cable.virginmedia.com)
[00:14:50] *** Quits: Thad (chatzilla@moz-C35F90AE.tx.res.rr.com) (Quit: ChatZilla 0.9.90 [Firefox 22.0/20130514181517])
[00:15:18] <aatch> brson, any reason not to approve #6706 ?
[00:15:18] *** Quits: samnardoni (samnardoni@moz-ECB14881.cable.virginmedia.com) (Ping timeout)
[00:16:34] *** Joins: Ralith (ralith@moz-50F3C77.vc.shawcable.net)
[00:19:25] *** Quits: MaikKlein (maik@moz-8B7A1D66.dip0.t-ipconnect.de) (Ping timeout)
[00:19:57] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Quit: eatkinson)
[00:23:03] *** Quits: vosen (vosen@moz-266BA656.icpnet.pl) (Quit: Leaving)
[00:23:28] <cmr> bors is on! is incoming no longer on fire or did pcwalton pull out?
[00:23:37] <pcwalton> I fixed it
[00:23:53] <cmr> awesome :)
[00:24:58] <cmr> So if I do RUST_LOG=mycrate=4, I also get logs from hashmap which is used in the crate. Is there a way to avoid that?
[00:28:03] <strcat> well, hashmap shouldn't really be logging
[00:28:06] <brson> aatch: it is probably a perf regression
[00:28:18] <aatch> brson, really?
[00:28:19] <brson> aatch: but obviously I'm still in favor
[00:28:25] <cmr> it's stuuff like:
[00:28:26] <cmr> rust: ~"insert fresh (~\"cmdch\"->~\">\") at idx 12, hash 8087272161769994412"
[00:28:28] <cmr> rust: ~"next_bucket(7, 32) = 8"
[00:28:37] <strcat> cmr: I know, I mean it shouldn't do that
[00:28:42] <cmr> ah
[00:28:45] <tjc> Isn't there a bug where inlined functions get their logs printed if they're inlined into the crate being logged?
[00:28:58] <brson> aatch: it adds a lot of string building
[00:29:10] *** Quits: azita (Azita@2557E599.66715431.D25A875A.IP) (Quit: azita)
[00:29:45] <graydon> task failed at 'heapmap self-check failed: (0x3,0x0)'
[00:29:47] <graydon> hello bug!
[00:30:24] <graydon> oh, or not.
[00:30:38] *** Joins: cowboyd (cowboyd@moz-1BD02A1E.sw.biz.rr.com)
[00:30:55] *** jdm is now known as jdm|away
[00:32:09] <strcat> the logging makes inserts 10-15% slower because there are 2 extra branches compiled in
[00:32:40] <strcat> there are bigger issues though so it's not that big of a deal
[00:35:07] <nmatsakis> strcat: can you point me to a sample of the code that it slow due to moves?
[00:36:24] <strcat> nmatsakis: the skew and split functions in treemap.rs
[00:37:05] <strcat> but that's partly because they do a lot more work than they should to work around borrow/move checking
[00:37:17] <acrichto> brson: would now be a good time to try and land the threadsafe llvm patch?
[00:38:38] <strcat> nmatsakis: they're good examples of functions with glue_drop emitted where it should be easily provable that nothing is dropped though
[00:39:01] *** Quits: jaguilar (Mibbit@moz-5182E345.hfc.comcastbusiness.net) (Quit: http://www.mibbit.com ajax IRC Client)
[00:39:20] * strcat thinks LLVM might do it with noalias on &mut params
[00:39:42] <strcat> especially swap
[00:40:17] <nmatsakis> strcat: interesting, thanks. they're not so straightforward, due to the &mut, but clearly no drop glue is needed for the temps
[00:40:32] <nmatsakis> strcat: I ask partially because I am reworking how we check moves
[00:42:22] <nmatsakis> strcat: for owned content, it wouldn't be too hard to extend the work I was doing to allow "holes"---that is, permitting something like "move(a.b.c); /* a not usable now */; a.b.c = ...; /* now a is usable again *", but not for &mut, just for owned content. &mut is harder because there may be aliases (just not mutable or immutable ones)
[00:42:22] <strcat> I'm going to reimplement the util.rs swap with memcpy instead of memmove, it should help more than I realized before
[00:42:38] <strcat> nmatsakis: yeah I need that pattern a lot :)
[00:42:56] <nmatsakis> strcat: yeah problem is I guess you always need it for &mut
[00:44:47] <strcat> I can't help but think the branch at the top of swap_ptr is a huge mistake
[00:45:07] * strcat will remove that too
[00:45:13] <nmatsakis> seems unnecessary
[00:45:18] <strcat> don't see why it would optimize for the case where x and y are the same
[00:45:44] <strcat> and it should use memcpy
[00:45:47] <acrichto> strcat: there was a test somewhere in the test suite that passed in the same object to the swap operator
[00:46:02] <acrichto> strcat: and the codegen for <-> generated the comparison, so I kept it around
[00:46:21] <strcat> acrichto: it won't fail for swap(&mut x, &mut x) if it doesn't check though
[00:46:35] <strcat> anyway &mut can't alias
[00:46:38] <strcat> but I mean for *mut
[00:46:53] <acrichto> strcat: oh yeah definitely, I agree that &mut things shouldn't have the check. Although if LLVM has noalias on &mut it may optimize away the check?
[00:47:05] <strcat> acrichto: I don't think it's clever enough
[00:47:22] <strcat> it's a lot less clever than we assume it is
[00:47:26] <acrichto> I guess llvm isn't exactly all-knowing
[00:47:33] <aatch> strcat, would proper alias analysis give it enough smarts?
[00:47:40] <strcat> aatch: yes
[00:47:45] <strcat> but I don't think noalias would
[00:47:50] <strcat> it's really, really stupid when it comes to pointers
[00:47:55] <strcat> it will get confused by the tmp var
[00:48:04] <aatch> strcat, I'd prefer stupid to wrong
[00:48:19] <strcat> aatch: right but it's optimized for clang which does TBAA and emits good IR
[00:48:34] <aatch> strcat, true.
[00:48:48] <brson> acrichto: yeah, let's try
[00:49:01] <strcat> also one reason our LLVM passes take so long, clang drops dead code in the frontend
[00:49:12] <strcat> lots of it, doesn't make an attempt to drop it all
[00:49:18] <strcat> just when it's easy and requires little to no analysis
[00:49:43] <strcat> because LLVM drops dead code after optimizing it
[00:49:46] <aatch> We could probably do that for all the intrinsics.
[00:49:55] <strcat> huge waste of time to optimize a dead branch and then drop it, but that's what it does ;p
[00:50:07] <cmr> strcat: why does it do that?
[00:50:20] <strcat> because otherwise it would need to run a dead code elimination pass before and then after
[00:50:20] *** Quits: bnicholson (bnicholson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[00:50:20] *** Quits: bnicholson_ (bnicholson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[00:50:24] <aatch> because optimization might kill paths
[00:50:26] <strcat> it would be slower *for clang*
[00:50:41] <cmr> ah
[00:51:19] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[00:51:47] <strcat> rust does at least some constant folding in the frontend for static stuff
[00:51:53] <strcat> essentially as much as clang can do
[00:52:04] <strcat> but clang then goes on to drop the dead branches made obvious by that
[00:52:53] <acrichto> brson: could it get an r+, and then the auto-builds get redone with the correct flags set to clean things out?
[00:54:05] <acrichto> I'm not sure if bors would be able to keep up with that
[00:56:04] <Luqman> brson: giving glue symbols actual names is awesome! makes debugging easier
[00:56:13] <strcat> they have names now?
[00:56:25] <strcat> no more glue_drop_182132? ;p
[00:56:53] <aatch> strcat, it will, it will just also have more stuff before it.
[00:57:19] <aatch> so <Type>::182132::glue_drop_182132
[00:57:24] <strcat> ah, awesome
[00:57:28] <Luqman> strcat: well, there's a pull request. i just cherrypicked it for my branch :P
[00:58:16] *** Joins: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr)
[01:00:03] *** Quits: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr) (Ping timeout)
[01:00:28] *** Joins: SimonSapin (simon@5AAE35B2.5EFFC0B8.24454B25.IP)
[01:00:57] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[01:00:57] *** ChanServ sets mode: +o dherman
[01:02:26] <strcat> we don't actually have a way to use the memcpy/memmove intrinsics
[01:02:37] <strcat> our memmove one is missing the pretty essential align parameter
[01:02:46] <brson> graydon: we have a pull requests that requires an llvm rebuild. is there a way to make bors clean-llvm?
[01:03:20] <graydon> no. it'd be buildbot that does it. hm..
[01:03:22] <erickt> brson: got time to look at https://github.com/mozilla/rust/pull/6690? It's my warning cleanup that's rebased onto HEAD
[01:03:32] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Quit: eatkinson)
[01:03:39] *** Quits: bbrittain (mozilla@2557E599.66715431.D25A875A.IP) (Quit: bbrittain)
[01:03:40] *** Quits: catpig (catpig@moz-C8A9C85E.dip0.t-ipconnect.de) (Quit: Verlassend)
[01:03:41] <graydon> I think at this point the easiest thing we can do is shut down bors while we're doing it, turn it back on once it's landed
[01:04:02] <acrichto> graydon: brson: i ran it past win/linux try yesterday and it passed
[01:04:21] <brson> erickt: r+
[01:04:33] <brson> graydon: ok, let's do it
[01:04:36] <erickt> thanks!
[01:04:37] <graydon> ideally the configure script / make should figure out when to clean llvm
[01:04:38] <strcat> is there a way to generate an arbitrary LLVM IR instruction?
[01:04:56] <strcat> or do I have to add another intrinsic
[01:04:56] <erickt> brson: does that llvm update include my patch?
[01:04:58] <graydon> but we've never, seemingly, got that working right. maybe a stamp file based on the LLVM submodule?
[01:05:02] <brson> erickt: no ...
[01:05:15] <brson> erickt: it doesn't change the llvm submodule
[01:05:29] <brson> do we want to do all the llvm stuff at once
[01:05:32] <brson> *?
[01:05:47] <acrichto> if they don't cause failing tests, it seems like a good idea
[01:06:12] <erickt> brson: oh ok. which pull requests will trigger a llvm rebuild?
[01:06:15] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[01:06:43] <brson> erickt: this is the one in question https://github.com/mozilla/rust/pull/6570
[01:07:21] <Jeaye> error: unresolved import. maybe a missing `extern mod core`?
[01:07:36] <Jeaye> Shouldn't this come in automagically? Prelude, I recall?
[01:07:56] <Luqman> strcat: i forget who but someone wanted to add a way to insert arbitrary llvm ir (so kind of like asm!)
[01:08:05] <tjc> graydon: So about that speed regression...
[01:08:12] <erickt> brson: How does that cause a llvm rebuild?
[01:08:23] <strcat> well I just want a way to use memcpy/memmove ;p
[01:08:26] *** Joins: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net)
[01:08:30] *** Joins: bnicholson_ (bnicholson@moz-E98974C1.hsd1.ca.comcast.net)
[01:08:33] <graydon> tjc: yes?
[01:08:44] <tjc> I bisected, and found that parsing went from about 7 seconds to about 14 seconds after brson registered the snapshots on Sunday
[01:08:47] <erickt> Jeaye: core was renamed to std
[01:08:56] <Jeaye> Oh, snap.
[01:08:58] <tjc> I only looked at parsing but am assuming it's correlated with slowdowns I saw in other phases
[01:09:01] *** Quits: SimonSapin (simon@5AAE35B2.5EFFC0B8.24454B25.IP) (Quit: Leaving.)
[01:09:13] <Jeaye> erickt: So it merged with the existing std?
[01:09:23] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[01:09:23] <ghrust> 01[13rust01] 15bors merged 06auto into 06incoming: 02http://git.io/NxUg-g
[01:09:23] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[01:09:23] <cmr> Jeaye: no, libstd was renamed to libextra
[01:09:33] <Jeaye> extra:: then?
[01:09:39] <erickt> Jeaye: yep
[01:09:56] <Jeaye> http://static.rust-lang.org/doc/core/index.html
[01:10:01] <Jeaye> And that's out of date now?
[01:10:11] <cmr> yup
[01:10:19] <strcat> the docs are generated for master
[01:10:45] * strcat would be happy if incoming was gone ;p
[01:10:50] <Jeaye> To clarify, std::time (for example) becomes extra::time
[01:11:00] <graydon> working on it. it should turn green first, no?
[01:11:01] <Jeaye> strcat: So long as the work isn't lost! :D
[01:11:07] <cmr> yes, and core::vec becomes std::vec
[01:11:15] <Jeaye> Got it. Thanks for the update.
[01:11:17] <graydon> tjc: which stage was slow?
[01:11:23] <strcat> graydon: I don't think it matters if it's green, we're still telling people to use incoming when they ask
[01:11:33] <tjc> graydon: building libcore (and everything else, but I didn't wait) with the stage1 compiler
[01:11:50] <tjc> so, compile_and_link: x86_64-apple-darwin/stage1/lib/rustc/x86_64-apple-darwin/lib/libcore.dylib
[01:12:13] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[01:12:25] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[01:12:25] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/CrTuIQ
[01:12:25] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[01:12:29] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[01:12:29] <ghrust> 01[13rust01] 15bors pushed 11 new commits to 06auto: 02http://git.io/BLDuUA
[01:12:29] <ghrust> 13rust/06auto 141965d72 15Erick Tryzelaar: core: remove iter_bytes helper functions
[01:12:29] <ghrust> 13rust/06auto 14dc970c1 15Erick Tryzelaar: cleanup warnings from libstd
[01:12:29] <ghrust> 13rust/06auto 14609a9e6 15Erick Tryzelaar: cleanup warnings from libextra
[01:12:30] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[01:12:51] <strcat> hm
[01:14:02] <graydon> tjc: ok. so .. when you find a regression based on a snapshot-registration, it suggests that the actual regression occurred sometime before, but was only visible in stage2
[01:14:09] <tjc> graydon: Right
[01:14:14] <graydon> tjc: so if you go one commit before the snapshot registration, and build stage1 and stage1
[01:14:15] <graydon> stage2
[01:14:18] <tjc> I don't always run all the way to stage2 so I was less likely to notice
[01:14:22] <graydon> you should see fast stage1, slow stage2
[01:14:24] <tjc> I can try building it all the way one commit before now, though
[01:14:45] <graydon> if you see that, then rewind to earlier where you don't see that (lower bound: the _previous_ snapshot registration)
[01:14:48] <graydon> and bisect inwards from there
[01:14:53] <tjc> Yeah, that makes sense
[01:14:59] <graydon> if you need a faster machine to do this on, let me know
[01:15:03] *** Quits: cowboyd (cowboyd@moz-1BD02A1E.sw.biz.rr.com) (Client exited)
[01:15:33] <graydon> the snap ranges are usually ~500 or so revs lately, so like 9 bisect steps
[01:15:38] <tjc> YEAH
[01:15:39] <tjc> ert
[01:15:40] <tjc> yeah
[01:16:17] *** Joins: SimonSapin (simon@5AAE35B2.5EFFC0B8.24454B25.IP)
[01:16:20] <graydon> which is .. about 3h continuous bisecting?
[01:16:24] <graydon> sadly
[01:16:39] <tjc> hmm, in order to see the stage2 problem, yeah
[01:16:54] <graydon> "bisect run" with a script can be of some help, if you can mechanically detect the fault
[01:17:24] <tjc> well, I have about 3 hours more of work left in the day anyway and I can do other stuff in the meantime, soâ€¦ I'm not sure if I'm lazy enough to write the script, or lazy enough to not write it =P
[01:17:24] <cmr> /usr/bin/time -v includes memory usage and detailed timing information in a very easy to parse format
[01:17:29] <graydon> http://lwn.net/Articles/317154/ https://www.kernel.org/pub/software/scm/git/docs/git-bisect.html etc.
[01:17:35] <tjc> well, rustc -Z time-passes is even easier to use :-D
[01:17:36] <graydon> time -v is usually a lie
[01:17:37] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[01:17:51] <cmr> graydon: what does it lie about?
[01:17:55] <graydon> if you write the script once, you'll reuse it :)
[01:18:04] <graydon> cmr: memory use, usually
[01:18:15] <strcat> you can get reliable memory usage statistics with a cgroup
[01:18:16] <cmr> RES usage is accurate afaict
[01:18:19] <strcat> there is no other way
[01:18:22] <strcat> cmr: it's not
[01:18:32] <strcat> it predates a way to get an accurate number ;p
[01:18:38] <graydon> it's nowhere close
[01:18:47] <graydon> strcat: DO TELL
[01:18:52] <graydon> strcat: (cgroup method)
[01:18:54] <strcat> so
[01:18:59] <graydon> I've been using the most ridiculous ad-hoc nonsense to measure
[01:19:02] <strcat> assuming you have /sys/fs/cgroup/ mounted
[01:19:03] <graydon> I want something better, anything
[01:19:11] <strcat> mkdir /sys/fs/cgroup/memory/some_group_name_you_want
[01:19:12] *** Quits: RMF (RMF@moz-58DFF2D4.dsl.telepac.pt) (Ping timeout)
[01:19:13] <Jeaye> rust-stb-image and rust-opengles have PRs for the renaming now
[01:19:36] <strcat> then echo process_id > /sys/fs/cgroup/memory/some_group_name_you_want/tasks (you can echo 0 for the current pid)
[01:19:48] *** Quits: SimonSapin (simon@5AAE35B2.5EFFC0B8.24454B25.IP) (Ping timeout)
[01:19:59] <strcat> and then watch memory.usage_in_bytes
[01:20:02] <graydon> strcat: huh. ok. I take it there are higher level tools?
[01:20:05] <strcat> or max_usage_in_bytes
[01:20:08] <strcat> graydon: probably ;p
[01:20:13] <strcat> that's the accurate way to do it though
[01:20:22] <strcat> it also gets you memory usage of any subprocesses it spawns added in
[01:20:26] <strcat> and any subprocesses they spawn
[01:20:28] <graydon> yeah
[01:20:54] <graydon> I have known for some time I need to learn how to use cgroups / lxc. now I have a Strong Motive.
[01:22:31] <strcat> systemd puts each service in a cgroup and uses it to implement a top command for services with aggregated cpu/memory usage
[01:22:43] <strcat> kind of neat
[01:22:50] *** Joins: RMF (RMF@moz-DC96E1C8.dsl.telepac.pt)
[01:22:52] <strcat> I've never really needed it though ;p
[01:23:50] <acrichto> brson: actually if changes to the llvm submodule trigger a rebuild, I could just lump the other patches into the threadsafe pull req and a normal bors cycle should take care of it
[01:24:50] <strcat> graydon: also the cgroup stays around after the process ends by default, so it's easy to just run the command then check the max_usage file afaik
[01:25:11] <strcat> all you need to do is teach the process to write 0 to the tasks file
[01:25:14] <strcat> when it starts
[01:25:26] *** Quits: jclements (jclements@2557E599.66715431.D25A875A.IP) (Quit: jclements)
[01:25:47] <strcat> I started reimplementing lxc for rusti ;p, not actually using my reinvented wheel yet
[01:26:14] <Jeaye> bjz_: CURSOR_CAPTURED is gone?
[01:26:20] <Jeaye> Is there a new way of doing things now?
[01:26:30] <bjz_> Jeaye: rename of the constant
[01:26:40] <bjz_> Jeaye: to CURSOR_HIDDEN
[01:26:40] <Jeaye> ahh
[01:26:43] <Jeaye> ohh
[01:26:51] <bjz_> if I can recall
[01:27:13] <bjz_> updated to reflect the last few changes to glfw
[01:28:03] <bjz_> Jeaye: there are also modifier keys added to the mouse button and key callbacks
[01:28:19] <Jeaye> Yeah, I'm seeing that, too.
[01:31:08] *** Joins: seth (seth@moz-99690620.hinet-ip.hinet.net)
[01:31:19] *** Quits: snearch (snearch@moz-3F4E20CB.pool.mediaways.net) (Quit: Verlassend)
[01:33:56] *** Quits: RMF (RMF@moz-DC96E1C8.dsl.telepac.pt) (Quit: Textual IRC Client: www.textualapp.com)
[01:35:43] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[01:36:04] *** Quits: anshin (nbs@441B8B9E.2055B963.D2A6B5.IP) (Quit: leaving)
[01:36:06] *** Joins: anshin (nbs@441B8B9E.2055B963.D2A6B5.IP)
[01:36:58] *** Joins: RMF (RMF@moz-DC96E1C8.dsl.telepac.pt)
[01:40:06] <Jeaye> It seems Rust isn't very easy to build concurrently.
[01:40:46] <Jeaye> I s'pose I can break some modules into shared libs and build those together, then link it all in a crate.
[01:41:46] *** Quits: graydon (graydon@3853DDD.39EEDBB3.D758B1AA.IP) (Quit: Leaving.)
[01:43:01] <brson> acrichto: ok, let's do that. graydon left anyway so we can't turn bors off tonight
[01:43:08] <brson> acrichto: thanks for being so patient
[01:43:10] <aatch> Jeaye, yeah, its an open, hard, problem
[01:43:10] <nmatsakis> is try usable again?
[01:43:27] <nmatsakis> at some point it was breaking bors?
[01:43:35] <brson> acrichto: do you want to apply those llvm patches or should I?
[01:43:40] *** Joins: nooy (user@moz-2458675D.a146.priv.bahnhof.se)
[01:43:51] <strcat> brson: you could just edit the current r+ comments to have something in front of r+ for now
[01:44:01] <acrichto> brson: I'm not sure how to, but I can cherry-pick the change to the submodule into the pull request for you to r+
[01:44:12] <strcat> oh wait the r+ comments are on random repos, nvm
[01:44:18] <strcat> github is so strange.
[01:44:31] <brson> acrichto: ok, I'll apply the llvm patches to a branch
[01:44:50] <cmr> strcat: well if the comments were on the PR, not the commit, they wouldn't be in random repos. whatis strange about it?
[01:45:13] *** Quits: EXetoC (ex@moz-2DBEB1E4.customer.t3.se) (Quit: WeeChat 0.4.1)
[01:45:19] <strcat> cmr: that people sending a PR can turn any comment on their repo into an r+...
[01:45:45] <strcat> I just find the whole idea of editing other people's comments strange
[01:45:48] <strcat> ;p
[01:46:08] <brson> it's going to be fun (not fun) upstreaming our llvm patches
[01:46:32] <aatch> so what are these patches?
[01:48:33] <brson> aatch: split stacks for android, arm, mips, the patches for which I think are probably not clean and don't have tests, the fixed_stack_segment attribute that we invented without consulting llvm, and a fix for parsing llasm
[01:48:50] <brson> all related to segmented stacks
[01:49:12] <aatch> Ahh.
[01:49:15] <brson> we may be the only users of llvm segment stacks though, so maybe nobody cares whate we do
[01:49:26] <aatch> I like how we invented an attribute
[01:53:55] *** Joins: MaikKlein (maik@moz-8B7A1D66.dip0.t-ipconnect.de)
[01:54:29] <MaikKlein> what does this error code mean?    task failed at 'port_set: endpoints closed'
[01:54:43] *** Quits: mhamrick (mhamrick@2557E599.66715431.D25A875A.IP) (Quit: mhamrick)
[01:55:25] <cmr> https://github.com/mozilla/rust/blob/incoming/src/libstd/comm.rs#L202
[01:55:28] <cmr> recv failed
[01:55:39] *** Quits: thomaslee_ (thomaslee@moz-6C3931E3.static.twtelecom.net) (Client exited)
[01:56:27] <MaikKlein> hm
[01:58:14] <MaikKlein> a Chan can send to a PortSet right?
[01:58:25] *** Joins: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr)
[01:59:00] <MaikKlein> uhhhhh
[01:59:07] <MaikKlein> I think I get how a portset works
[01:59:29] *** Joins: SimonSapin (simon@moz-99690620.hinet-ip.hinet.net)
[02:00:00] <aatch> nmatsakis, what would the best way of telling borrowck to treat a captured var as a borrow? (context: https://github.com/mozilla/rust/issues/6653)
[02:00:01] *** Joins: Guest__ (textual@moz-E64A54F3.nyc.res.rr.com)
[02:00:49] <MaikKlein> ahh nice
[02:01:35] *** Joins: bytbox (s@moz-D83E9B31.wireless.umd.edu)
[02:05:17] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Client exited)
[02:06:03] *** Quits: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr) (Ping timeout)
[02:06:12] *** Quits: MaikKlein (maik@moz-8B7A1D66.dip0.t-ipconnect.de) (Ping timeout)
[02:07:54] *** Joins: cowboyd (cowboyd@moz-1BD02A1E.sw.biz.rr.com)
[02:13:05] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Quit: eatkinson)
[02:15:23] *** Quits: SimonSapin (simon@moz-99690620.hinet-ip.hinet.net) (Ping timeout)
[02:15:29] *** Quits: bytbox (s@moz-D83E9B31.wireless.umd.edu) (Ping timeout)
[02:17:13] *** Joins: jgilbert (jgilbert@moz-1190BCC3.dynamic.hinet.net)
[02:17:27] *** Joins: z0w0 (zack@moz-780F7535.lns9.cha.bigpond.net.au)
[02:21:10] <steven_is_false> So the option -c is for compiling to object files but there does not seem to be an option for compiling object files. 
[02:21:24] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[02:21:24] <ghrust> 01[13rust01] 15bors merged 06auto into 06incoming: 02http://git.io/BLDuUA
[02:21:24] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[02:21:32] <cmr> steven_is_false: what do you mean compiling object files? linking them together, you mean?
[02:21:39] <steven_is_false> cmr: Yes.
[02:21:50] <cmr> steven_is_false: rustc doesn't do linking itself, use ld or gcc
[02:21:57] <cmr> (or clang)
[02:22:04] <steven_is_false> cmr: NVM then
[02:22:36] <cmr> there's an option somewhere that lets you see what rustc would use...
[02:22:46] <cmr> -Z print-link-args
[02:23:18] <steven_is_false> cmr: Yes but finding a way to use print link args is annoying
[02:23:58] <aatch> steven_is_false, you can also supply link args, including object files.
[02:24:11] <aatch> --link-args="obj1.o" etc
[02:24:21] <steven_is_false> aatch: That's an interesting idea.
[02:24:24] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[02:24:24] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/y1BXrw
[02:24:24] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[02:24:27] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[02:24:27] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/k8k2Tw
[02:24:27] <ghrust> 13rust/06auto 1415685f8 15Niko Matsakis: Issue #3678: Remove wrappers and call foreign functions directly
[02:24:27] <ghrust> 13rust/06auto 148109420 15bors: auto merge of #6661 : nikomatsakis/rust/issue-3678-wrappers-be-gone-2, r=brson...
[02:24:28] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[02:24:52] <aatch> Woo!
[02:24:55] <aatch> :D
[02:25:15] <steven_is_false> So I'm output the link args with >, and then `cat link_args` them to clang but I'm getting weird multiple definition errors.
[02:25:42] <aatch> steven_is_false, example?
[02:26:09] <cmr> it works fine for me :\
[02:26:10] <steven_is_false> rustc -o src/main.o -c ../../projects/rust_dlfcn/src/main.rs -Z print-link-args > link_args
[02:26:10] <steven_is_false> clang  `cat link_args` -o rust_dlfcn src/main.o  
[02:26:23] *** Joins: Nisstyre (wes@moz-FD86289.netflash.net)
[02:26:27] <aatch> rustc actually uses gcc/clang to link atm.
[02:26:47] <cmr> steven_is_false: the link args already include src/main.o
[02:26:55] <cmr> and the -o
[02:27:04] <cmr> it literally has everything you need :)
[02:27:17] <steven_is_false> Is there a Unix command ignore which ignores passed in flags?
[02:27:20] <aatch> It's not very clever, it just outputs the entire lot
[02:27:53] <cmr> steven_is_false: what use would that be?
[02:27:56] <strcat> steven_is_false: true
[02:28:00] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[02:28:10] <steven_is_false> I'm going to hack around autotools method of doing $(LINK) $(OBJECT_FILES) by making $(LINK) be link commands && ignore
[02:28:46] <steven_is_false> Hoorah! It works.
[02:29:41] <steven_is_false> Now I just have to deal with the link_args file
[02:30:13] <cmr> clang $(rustc ...)
[02:30:34] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[02:30:39] <steven_is_false> cmr: That doesn't work if I want to split the build up into multiple steps.
[02:30:52] <steven_is_false> cmr: I guess I could make the build happen twice though.
[02:30:57] <cmr> foo=$(rustc ...); clang $foo
[02:31:32] <steven_is_false> cmr: I'm not doing a shell script. I'm trying to integrate it with autotools.
[02:31:36] <cmr> oh
[02:31:44] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[02:31:46] <cmr> yeah I've never used autotools, good luck :)
[02:32:30] <brson> acrichto: I have to go to dinner now, but I've pushed an updated llvm to my llvm branch if you want to start trying to push it through bors
[02:32:49] <acrichto> brson: awesome, will do
[02:32:56] *** Quits: mcomella (mcomella@moz-B10FF54F.ri.ri.cox.net) (Connection reset by peer)
[02:33:00] <brson> acrichto: haven't finished building it yet, but I'll start running a build when I get home
[02:33:12] <brson> but you can try in parallel
[02:33:35] <acrichto> what's the branch name?
[02:33:41] <brson> acrichto: 'llvm'
[02:34:02] <acrichto> ah ok
[02:34:12] *** Joins: mcomella (mcomella@moz-B10FF54F.ri.ri.cox.net)
[02:34:28] *** Quits: brson (brson@2557E599.66715431.D25A875A.IP) (Quit: leaving)
[02:36:23] *** Joins: SimonSapin (simon@moz-99690620.hinet-ip.hinet.net)
[02:36:25] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[02:36:25] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 148109420 to 14a776d65: 02http://git.io/N3iJvQ
[02:36:25] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[02:36:28] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[02:36:28] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/oI1-iA
[02:36:28] <ghrust> 13rust/06auto 14486307c 15Tim Chevalier: testsuite: Add test cases that pass
[02:36:28] <ghrust> 13rust/06auto 1484de6fa 15bors: auto merge of #6692 : catamorphism/rust/testcases, r=catamorphism
[02:36:29] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[02:36:58] *** Quits: wuwei`lab (wuwei@1A513F49.818D7924.FAA9ED67.IP) (Ping timeout)
[02:43:56] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[02:44:55] *** Quits: kimundi (kimundi@moz-D470C7AA.dip0.t-ipconnect.de) (Ping timeout)
[02:46:34] <cmr> erickt: Ohh I see what you were saying by unused import with glob imports. If you didn't use *anything* from the glob, not warning for the things from the glob you didn't use
[02:46:44] *** Quits: Guest__ (textual@moz-E64A54F3.nyc.res.rr.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[02:47:18] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[02:48:13] <strcat> rusti: use x = core::util::id; x(5)
[02:48:17] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/QBgj
[02:48:41] *** Joins: kimundi (kimundi@moz-2DA92F1A.dip0.t-ipconnect.de)
[02:48:53] <strcat> rusti: use x = std::util::id; x(5)
[02:48:55] -rusti- 5
[02:48:58] <erickt> tjc: ping
[02:49:04] <tjc> erickt: pong
[02:49:05] <cmr> rusti: use x___ = core::util::id;
[02:49:07] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/BXKF
[02:49:13] <cmr> huh
[02:49:24] <cmr> span for "use x = ..." is wrong
[02:49:25] <erickt> tjc: why is this not going to be supported? https://github.com/mozilla/rust/issues/4228#issuecomment-15469422
[02:49:57] <tjc> erickt: It just seemed like lack of interest to me. feel free to reopen if you feel strongly about it :-)
[02:50:10] <erickt> oh ok :)
[02:50:26] <strcat> tjc: well I'm interested in it :)
[02:50:35] *** Quits: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Ping timeout)
[02:50:53] *** kimundi is now known as zz_kimundi
[02:50:54] <tjc> strcat: ok, well, maybe it's more important than I assumed :-) I'm also not sure how it interacts with the new syntax for static methods (maybe not at all)
[02:51:17] <erickt> tjc: reopened
[02:51:22] <tjc> kk
[02:51:29] <strcat> tjc: posted a comment with my use case btw
[02:51:35] <tjc> strcat: cool
[02:51:39] <erickt> strcat: thanks!
[02:52:56] *** Quits: pcwalton (pcwalton@2557E599.66715431.D25A875A.IP) (Quit: pcwalton)
[02:53:22] <strcat> nested cfg() doesn't seem to work when one is not()
[02:53:24] <strcat> hm
[02:58:18] <strcat> oh well my terrible hack around this issue works
[02:58:28] <strcat> afaict...
[02:58:38] <strcat>     #[cfg(stage0)]
[02:58:40] <strcat>     use memcpy32 = unstable::intrinsics::memmove32;
[02:58:42] <strcat>     #[cfg(not(stage0))]
[02:58:44] <strcat>     use unstable::intrinsics::memcpy32;
[02:58:46] <strcat> ;p
[02:59:06] *** Joins: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr)
[02:59:07] <aatch> strcat, lol, I've done a few things like that.
[02:59:09] <strcat> lint seems to ignore the stage marker
[02:59:37] <strcat> /home/strcat/projects/rust/src/libstd/ptr.rs:19:0: 19:47 warning: unused import [-W unused-imports (default)]
[02:59:39] <strcat> /home/strcat/projects/rust/src/libstd/ptr.rs:19 use memcpy32 = unstable::intrinsics::memmove32;
[02:59:41] <strcat> strange.
[03:00:57] *** Quits: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr) (Ping timeout)
[03:03:20] *** zz_kimundi is now known as kimundi
[03:05:34] <cmr> rusti: let a = [1, ..512]; a
[03:05:40] -rusti- line longer than 150 columns, pastebinned: http://sprunge.us/KCKX
[03:06:27] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[03:06:27] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1484de6fa to 14a776d65: 02http://git.io/N3iJvQ
[03:06:27] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[03:06:28] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[03:06:28] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/jHDQzA
[03:06:28] <ghrust> 13rust/06auto 1454f5697 15Tim Chevalier: testsuite: Add passing test for #4735
[03:06:28] <ghrust> 13rust/06auto 148ab966c 15Tim Chevalier: testsuite: Add working test for #5550
[03:06:29] <ghrust> 13rust/06auto 14f55158c 15Tim Chevalier: testsuite: Test cases, one xfailed, one not
[03:06:30] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[03:08:26] *** Joins: wuwei`lab (wuwei@1A513F49.818D7924.FAA9ED67.IP)
[03:09:56] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[03:09:56] <ghrust> 01[13rust01] 15thestinger created 06swap (+4 new commits): 02http://git.io/vcgQUQ
[03:09:56] <ghrust> 13rust/06swap 145ba5865 15Daniel Micay: swap_ptr: rm equality check...
[03:09:56] <ghrust> 13rust/06swap 147d2f836 15Daniel Micay: add memcpy intrinsic to mirror memmove
[03:09:56] <ghrust> 13rust/06swap 14a7f450a 15Daniel Micay: indentation fix
[03:09:57] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[03:10:16] <strcat> ugh >.<
[03:10:31] * strcat mixes up upstream aliases yet again
[03:10:48] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[03:10:48] <ghrust> 01[13rust01] 15thestinger 04deleted 06swap at 147bff028: 02http://git.io/K29lgQ
[03:10:48] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[03:10:51] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Quit: eatkinson)
[03:11:33] <strcat> tjc: https://github.com/mozilla/rust/pull/6710 r?
[03:13:47] <aatch> stupid whitespace
[03:14:02] * aatch is sure that git has an option to ignore white-space only changes...
[03:14:03] <tjc> strcat: looking
[03:14:11] <strcat> aatch: -w
[03:14:12] *** Quits: SimonSapin (simon@moz-99690620.hinet-ip.hinet.net) (Ping timeout)
[03:14:19] <strcat> also --color-words is your friend
[03:14:21] <strcat> :)
[03:14:23] <aatch> Apparently gihub don't use it...
[03:14:31] <strcat> aatch: it sometimes does
[03:14:34] *** Quits: nooy (user@moz-2458675D.a146.priv.bahnhof.se) (Client exited)
[03:14:39] <cmr> ?w
[03:14:56] <cmr> ?w=1, that is
[03:14:57] <cmr> https://github.com/blog/967-github-secrets
[03:15:17] <aatch> WHY IS THAT NOT DEFAULT!
[03:15:29] <strcat> aatch: git has terrible defaults, so github does too
[03:15:40] <aatch> ugh.
[03:15:47] <strcat> git has the ability to check for whitespace errors and leftover merge markers pre-commit
[03:15:54] <strcat> it doesn't enable that hook by default though...
[03:16:01] <aatch> at least your PR is readable now
[03:16:11] <strcat> aatch: I separated that commit for that reason ;p
[03:16:44] <aatch> strcat, fair enough
[03:20:33] <strcat> aatch: well, I guess people usually want to stop others from sneaking in whitespace changes
[03:20:41] <strcat> but.... *sometimes* github hides whitespace changes
[03:21:33] * strcat needs more ram
[03:21:44] <aatch> strcat, I guess the best option would be a repository setting.
[03:21:49] <strcat> this computer only has 8GiB and I always hit it :(
[03:21:55] <aatch> "only"
[03:22:00] *** Joins: Thad (chatzilla@moz-C35F90AE.tx.res.rr.com)
[03:22:05] <aatch> I do fine with 4GB most of the time.
[03:22:48] <Thad> ALL - the Windows Quick Steps now just Sing and Hum with bliss... https://github.com/mozilla/rust/wiki/Note-getting-started-developing-Rust
[03:23:06] <Thad> Your Welcome !
[03:23:17] <strcat> a rust build is 2.5GiB, and then I have an idle game eating 2GiB, browser eating a gig and a half for all my tabs, and I started building something else ;p
[03:23:28] <tjc> Thad: Great, thank you for doing that!
[03:23:57] <Thad> tjc: No Problem !
[03:26:13] *** Quits: cowboyd (cowboyd@moz-1BD02A1E.sw.biz.rr.com) (Client exited)
[03:26:30] *** Quits: Thad (chatzilla@moz-C35F90AE.tx.res.rr.com) (Quit: ChatZilla 0.9.90 [Firefox 22.0/20130521223249])
[03:28:35] *** Quits: bent (chatzilla@moz-932324BF.hsd1.ca.comcast.net) (Quit: ChatZilla 0.9.90-rdmsoft [XULRunner 18.0.2/20130201065344])
[03:30:02] *** Joins: SimonSapin (simon@moz-99690620.hinet-ip.hinet.net)
[03:30:12] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[03:30:29] <strcat> http://lists.x.org/archives/xorg-devel/2013-May/036276.html and that's why rust is awesome ;p
[03:30:47] <tjc> heh
[03:31:02] <tjc> we shouldn't get too cocky; in Rust, compiler and runtime bugs with similar effects are possible too
[03:31:16] <strcat> and in 99% of distributions xorg is still setuid
[03:31:24] <strcat> tjc: yeah, but they're fixable in the compiler :)
[03:31:32] <tjc> sure!
[03:31:49] <strcat> C is only getting harder to write as compilers optimize better
[03:31:59] <strcat> there was recently an awesome bug in gzip
[03:32:09] <strcat> introduced from *correct* optimizations in gcc 4.8
[03:32:17] <strcat> started making corrupt compressed files ;p
[03:33:32] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[03:33:33] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 149f9de31 to 14a776d65: 02http://git.io/N3iJvQ
[03:33:33] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[03:33:33] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[03:33:33] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/L5rVvg
[03:33:33] <ghrust> 13rust/06auto 14486307c 15Tim Chevalier: testsuite: Add test cases that pass
[03:33:33] <ghrust> 13rust/06auto 14d9ee1f5 15Tim Chevalier: testsuite: xfail issue-5530, updating issue
[03:33:34] <ghrust> 13rust/06auto 142590c8a 15bors: auto merge of #6692 : catamorphism/rust/testcases, r=catamorphism
[03:33:36] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[03:33:42] <cmr> 3 bounces in a row, harsh
[03:33:58] *** Joins: cowboyd (cowboyd@moz-E7DE8E4A.sw.biz.rr.com)
[03:35:53] *** Quits: fread2281 (zcarterc@moz-CB181B42.dia.static.qwest.net) (Ping timeout)
[03:36:24] <tedh> hey tjc, you still around?
[03:36:31] <tjc> tedh: yep
[03:36:35] <BitPuffin> a clang_complete like vim plugin for rust is essential :)
[03:36:47] <strcat> BitPuffin: youcompleteme > clang_complete btw ;p
[03:36:56] <cmr> not just one >, but like, 30 of them
[03:37:07] <tedh> if you are still looking for a speed regression, i noticed one with the new for loop protocol
[03:37:14] <BitPuffin> strcat: how come?
[03:37:29] <strcat> BitPuffin: faster, less buggy, handles overloading well
[03:37:43] <strcat> and it can do fuzzy matching
[03:37:45] <cmr> Plus handles more things than just C/C++ with clang
[03:37:56] <tjc> tedh: hmm, seems plausible
[03:38:39] <BitPuffin> strcat: that actually does look very nice, someone should add rust support for it
[03:39:22] <tedh> my test case was a degenerate version of the mandelbrot benchmark, with a bunch of loops of 0 iterations
[03:39:25] <aatch> BitPuffin, I accept your volunteering
[03:39:37] <BitPuffin> don't have time
[03:39:38] <tedh> went from 3 secs to 5 secs
[03:39:51] <BitPuffin> already volunteering making a 3d editor for polycode lol
[03:40:00] <aatch> Bah!
[03:40:05] *** Quits: cowboyd (cowboyd@moz-E7DE8E4A.sw.biz.rr.com) (Ping timeout)
[03:40:28] <cmr> A completion daemon would be a really awesome thing to have
[03:40:37] <BitPuffin> extremely awesome
[03:41:00] <strcat> it needs to be part of librustc
[03:41:03] <strcat> or based on it
[03:41:11] <strcat> so that would be a lot of work
[03:41:14] <BitPuffin> yeah
[03:41:22] <BitPuffin> does librustc has the capability needed?
[03:41:38] <strcat> I doubt it can handle errors well enough to keep going when needed
[03:41:44] <aatch> strcat, not neccessarily
[03:41:57] <aatch> You can hook into libsyntax to parse at least
[03:42:04] <strcat> aatch: parsing isn't enough to complete
[03:42:08] <aatch> and librustc for resolve.
[03:42:08] <strcat> need to know types
[03:42:18] <strcat> and the parser needs to be able to handle partial parses
[03:42:25] <strcat> (along with typechecking)
[03:42:31] <aatch> true, I didn't think of that.
[03:42:57] <BitPuffin> well rust devs, get on it :)
[03:43:04] <strcat> let x = foo(); x.<tab> /* needs to infer the type of x, despite the fact that x. is incomplete */
[03:43:11] <strcat> that would be hard
[03:43:30] <aatch> strcat, yeah, I always forget about partial parsing
[03:44:03] *** Quits: tikue (tkuehn@2557E599.66715431.D25A875A.IP) (Quit: tikue)
[03:44:07] <cmr> We just need to get some of those google autocompleters on the job
[03:44:22] <BitPuffin> seems like syntastic has rust support though
[03:44:24] <BitPuffin> that's cool
[03:44:27] *** Quits: Sorella (queen@B12A78F5.BA14766C.95C8B7C6.IP) (Quit: (quit))
[03:48:34] *** Joins: bytbox (s@moz-D83E9B31.wireless.umd.edu)
[03:48:48] *** Joins: brson (brson@E9CDE21E.991753BB.CA4D1600.IP)
[03:48:48] *** ChanServ sets mode: +o brson
[03:53:31] *** Quits: brson (brson@E9CDE21E.991753BB.CA4D1600.IP) (Ping timeout)
[03:53:48] *** Joins: brson (brson@E9CDE21E.991753BB.CA4D1600.IP)
[03:53:48] *** ChanServ sets mode: +o brson
[03:53:59] *** Joins: nooy (user@moz-2458675D.a146.priv.bahnhof.se)
[03:54:06] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[03:57:39] <tjc> goodnight all!
[03:57:41] *** Quits: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP) (Quit: Places to go, people to annoy)
[03:57:51] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke. It's all a joke.)
[03:59:36] *** Joins: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr)
[04:00:03] *** Quits: jgilbert (jgilbert@moz-1190BCC3.dynamic.hinet.net) (Ping timeout)
[04:01:25] *** Quits: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr) (Ping timeout)
[04:01:28] <Eridius> what's the best branch to use to play around with rust? master, incoming, or something else?
[04:02:21] <aatch> Eridius, probably incoming
[04:02:27] <cmr> Eridius: master is more stable, but incoming is where all the automatic (tests-pass) pullreq merges go
[04:02:31] <Eridius> ah
[04:02:38] <cmr> master also gets out of date, though
[04:03:45] <strcat> incoming won't exist for much longer, it will just be master
[04:04:06] <cmr> fusion power is only a few years away
[04:04:25] <thomaslee> hrm. I'm messing with rustrt (the C++ code in src/rt) -- aside from updating my rust code to handle the changes to the type signatures, do I need to worry about anything in the build system wrt backwards compatibility with e.g. stage0 or anything silly like that?
[04:04:43] <thomaslee> messing with the type signatures of spawn_fn+glue_fn specifically
[04:05:01] <aatch> thomaslee, as long as the stage0 compiler can compile the code, you should be fine.
[04:05:59] <aatch> staging is mostly because you implemented a change that can only be compiled because of that change (e.g. adding intrinsics)
[04:06:23] <aatch> There might be a few issues, but nothing I know off the top of my head.
[04:06:26] <thomaslee> aatch, was afraid you'd say that :) my stage1 is segfaulting immediately when it tries to build my stage1 libstd (at least I *think* it's my stage1 that's doing the segfaulting, because it's the one that's going to have these horrible changes :))
[04:06:31] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[04:06:31] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 142590c8a to 14a776d65: 02http://git.io/N3iJvQ
[04:06:31] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[04:06:32] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[04:06:32] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/DwlRtg
[04:06:32] <ghrust> 13rust/06auto 14abb2823 15Jyun-Yan You: make arm register definition consistent with rt
[04:06:32] <ghrust> 13rust/06auto 147c0cc9c 15bors: auto merge of #6684 : crabtw/rust/arm, r=ILyoan...
[04:06:33] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[04:06:44] <thomaslee> right. hrm.
[04:06:50] <thomaslee> back to wracking my brain, then
[04:07:11] <aatch> nmatsakis, ping
[04:09:28] <strcat> acrichto: the drop/move generation is really what hurts treemap and I hoped making swap a bit better would help LLVM - it didn't ;p
[04:09:50] <acrichto> strcat: ah oh well, I was mainly just curious
[04:09:53] <strcat> so it's just a tiny sub-1% improvement for insert/remove (it's more measurable with a microbenchmark)
[04:10:19] <strcat> I should try figuring out how to make &mut parameters get marked as noalias
[04:10:25] <strcat> I have a good feeling about that helping...
[04:10:45] <strcat> the trans_fn stuff is weird though
[04:11:01] <strcat> trans_closure* (or whatever it's called ;p)
[04:11:25] <aatch> strcat, yeah, it's not too easy.
[04:11:33] <aatch> I looked into a little while ago
[04:11:45] <strcat> it seems to lose track of the real types too early
[04:11:45] <aatch> "Shouldn't be too hard" Hah!
[04:11:58] <strcat> I found that code confusing though...
[04:14:10] *** Quits: jdm|away (jdm@F2D29657.F60B0462.67AC9B1.IP) (Ping timeout)
[04:15:14] <brson> thomaslee: if you are changing the structure of closures then the stage0 compiler will be generating code in stage0 that uses the wrong format. stage0 builds rustrt then builds rust source against it
[04:15:19] *** Quits: seth (seth@moz-99690620.hinet-ip.hinet.net) (Input/output error)
[04:15:56] *** Joins: Jesin (Jessin_@moz-A03A364F.cc.lehigh.edu)
[04:16:31] *** Joins: jgilbert (jgilbert@moz-99690620.hinet-ip.hinet.net)
[04:19:06] *** Joins: seth (seth@moz-99690620.hinet-ip.hinet.net)
[04:21:46] <strcat> aatch: another cool thing would be getting LLVM's devirtualization working for us by marking vtables as invariant
[04:21:59] <strcat> but... I don't care very much about trait objects :)
[04:22:00] <aatch> strcat, that would be nice
[04:22:05] <aatch> strcat, neither
[04:23:31] <strcat> maybe we could do it for closures too
[04:23:43] *** Quits: a_m0d (a_m0d@moz-9F925EFA.hm.shawcable.net) (Quit: Leaving.)
[04:23:59] <strcat> not sure if LLVM actually uses invariant for anything else.... it should, but clang only uses it on vtables
[04:24:34] *** Quits: Jesin (Jessin_@moz-A03A364F.cc.lehigh.edu) (Ping timeout)
[04:24:58] *** Joins: hjr3 (hradtke@moz-AE3056B9.static.stls.mo.charter.com)
[04:27:04] <cmr> So is there a way to have non-utf8 strings at all? The last problem with my terminfo parser is it uses strings to store string capabilities but those aren't utf8, they're whatever the terminal wants. Should I use ~[u8] instead?
[04:27:42] <aatch> cmr, yes
[04:28:00] <steven_is_false> strcat: Can't closures be implemented using vtables? Eg) template <typename A, typename B..> struct closure { virtual B operator () (A..) const = 0; virtual ~closure () { } }; ?
[04:28:45] <strcat> cmr: str is essentially [u8] that's guaranteed to be valid utf-8 (ignoring some bugs in the str module)
[04:28:48] <steven_is_false> Not sure if devirtualization is important enough versuses the problems with that approach.
[04:29:06] <strcat> steven_is_false: well afaik LLVM doesn't really know that it's a vtable
[04:29:18] <strcat> it just knows that they are function pointers in a location that's marked with llvm.invariant
[04:29:35] <cmr> aatch: strcat: thanks!
[04:29:48] <steven_is_false> strcat: So it should work than.
[04:30:50] <steven_is_false> strcat: Does that apply to regular function pointers? Eg) struct my_oop_implementation { void (* const virtual_function_a)(); }; (Not sure that's the right syntax though)
[04:31:08] <strcat> steven_is_false: yes that's essentially a vtable from LLVM's POV
[04:31:50] <thomaslee> brson, ah that might explain it -- what can I do to work around that?
[04:31:55] <strcat> clang has devirtualization tricks in the frontend that only work with C++ virtual functions
[04:32:02] *** Joins: dbaupp (Thunderbir@moz-C83F6225.lns20.syd6.internode.on.net)
[04:32:10] <strcat> but I think LLVM's don't care
[04:33:51] <steven_is_false> strcat: Cool.
[04:35:41] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[04:36:01] *** Quits: brson (brson@E9CDE21E.991753BB.CA4D1600.IP) (Ping timeout)
[04:38:39] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[04:38:43] *** Joins: spider-mario (spidermari@moz-2F72F6FF.dsl.quantic-telecom.net)
[04:40:29] *** Joins: brson (brson@58B3E13.EF2694B5.DFAC6AA7.IP)
[04:40:29] *** ChanServ sets mode: +o brson
[04:40:50] <brson> 21:37 <@brson> thomaslee: hm, I guess nobody's had to modify any of these data structures in a long time  because I don't think we have anything in the build system for it.
[04:40:53] <brson> 21:37 <@brson> thomaslee: I would edit rt.mk to pass a -D flag in stage0
[04:40:56] <brson> 21:38 <@brson> thomaslee: all the rust code that cares about it will need #[cfg(stage0)] too
[04:41:11] <brson> thomaslee: did you get what I just said about the runtime?
[04:41:19] <brson> oh, heh
[04:41:25] <thomaslee> ack. This is going to hurt. :)
[04:41:31] <thomaslee> I did, but just then
[04:42:19] <thomaslee> thanks for the suggestion, I'll see how I go
[04:43:11] <acrichto> brson: I forgot to say, but the llvm submodule changing didn't trigger a rebuild of llvm (even though it probably should), but the rusti tests have rotted and I'm trying to track those down right now
[04:43:34] *** Quits: lmandel (lmandel@FE1F74.86ED00A7.971E19F6.IP) (Quit: lmandel)
[04:45:39] <steven_is_false> I have a question. How might one create an out of tree build for the rust source?
[04:46:59] <steven_is_false> NVM: configuring in another directory seems to work
[04:47:06] <cmr> yup
[04:50:00] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[04:52:06] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[04:53:16] <cmr> Would someone mind looking through https://github.com/cmr/terminfo-rs for things that could be more rustic / stuff that's stupid? (The parsing is correct, afaict)
[04:53:31] <thomaslee> so just to make sure I understand what's happening here: 1. we build rustrt with the new closure type signatures; 2. stage0 rustc emits code for stage1 rustc using the *old* type signature; 3. when we go to build using our stage1 rustc, the old type info in the rustc binary (& everything else from stage0) doesn't match the new type info in rustrt
[04:53:35] <thomaslee> brson ^^
[04:53:40] *** Quits: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net) (Connection reset by peer)
[04:53:58] *** Joins: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net)
[04:54:04] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Client exited)
[04:54:05] <thomaslee> (and as a result, all sorts of madness will occur)
[04:54:40] <Eridius> does rust define the order that subexpressions are evaluated in a given expression?
[04:54:48] <Eridius> e.g. if I say c.foo() + c.bar(), does it define whether foo or bar gets called first?
[04:56:19] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[04:56:36] *** Quits: Earnestly (earnest@6A917A59.5E1FD793.39C00A7A.IP) (Ping timeout)
[04:57:04] <cmr> Eridius: I don't think so, but see http://static.rust-lang.org/doc/rust.html#statements-and-expressions
[04:57:32] <cmr> it mentions it, but I don't see anywhere where it actually defines the order
[04:57:49] <cmr> Eridius: but there's no real spec yet, so...
[04:58:05] <Eridius> cmr: yeah the manual is missing a lot
[04:58:39] <cmr> Eridius: a lot is still in flux
[05:00:24] *** Joins: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr)
[05:00:26] *** Quits: tcsc (tcsc@moz-A838B260.dhcp.nwtn.ct.charter.com) (Quit: bye!)
[05:00:30] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[05:00:31] <ghrust> 01[13rust01] 15bors merged 06auto into 06incoming: 02http://git.io/DwlRtg
[05:00:31] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[05:02:13] *** Quits: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr) (Ping timeout)
[05:03:28] <dbaupp> cmr: there's nothing that stands out to me :)
[05:03:35] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[05:03:35] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/9dJ1zw
[05:03:35] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[05:03:51] <Eridius> huh, what hapened to extern mod foo {} ?
[05:04:02] <dbaupp> Eridius: removed
[05:04:23] <dbaupp> I think(?) the replacement is mod foo { extern { .. } }
[05:04:33] <strcat> yes
[05:04:40] <Eridius> dbaupp: yeah that's what the warning tells me, but that looks cumbersome
[05:05:03] <Eridius> extern mods are for FFI. Why would I embed an extern block within a non-extern module? That just seems odd
[05:05:11] <cmr> Eridius: extern mod is also linkage
[05:05:14] <Eridius> and are the link attributes on the mod or on the extern block now?
[05:05:39] *** Quits: spider-mario (spidermari@moz-2F72F6FF.dsl.quantic-telecom.net) (Input/output error)
[05:06:15] <dbaupp> extern block
[05:06:30] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[05:06:30] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/9dJ1zw
[05:06:30] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[05:06:31] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[05:06:31] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/YEHe6g
[05:06:31] <ghrust> 13rust/06auto 145ba5865 15Daniel Micay: swap_ptr: rm equality check...
[05:06:31] <ghrust> 13rust/06auto 147d2f836 15Daniel Micay: add memcpy intrinsic to mirror memmove
[05:06:33] <ghrust> 13rust/06auto 14a7f450a 15Daniel Micay: indentation fix
[05:06:33] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[05:08:16] <cmr> dbaupp: thanks :)
[05:08:41] *** Quits: seth (seth@moz-99690620.hinet-ip.hinet.net) (Input/output error)
[05:09:00] <Eridius> ack, why did libstd change its identifier?
[05:09:05] <Eridius> now I have two installed ones and I don't know which one is correct
[05:09:15] <Eridius> it seems it changed uuids
[05:09:22] <cmr> Eridius: it didn't. libcore was renamed to libstd, and libstd to libextra
[05:09:46] <Eridius> oh ack
[05:10:04] <dbaupp> you can just remove the old ones
[05:10:13] <Eridius> dbaupp: I deleted my /usr/local/lib/rustc folder and re-installed
[05:10:16] <Eridius> but now all my core uses are broken
[05:10:22] <dbaupp> yup, that works
[05:10:38] <dbaupp> and yeah... keeping up with language changes is hard work :(
[05:10:56] * aatch should go update his projects...
[05:11:24] *** Quits: SimonSapin (simon@moz-99690620.hinet-ip.hinet.net) (Ping timeout)
[05:11:45] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[05:12:15] <Eridius> ok now this is a weird one. rust claims I have an undeclared type name, but there's a `pub type` for that name just a few lines higher
[05:12:55] <aatch> different mod?
[05:13:07] <Eridius> the bad line is in a child mod
[05:13:21] <Eridius> which was an extern mod but now is a mod with an extern block
[05:13:26] <aatch> you need to `use` stuff from parent modules
[05:13:30] <cmr> visibilty isn't inhereted in children mods
[05:13:36] <Eridius> then why did this work before?
[05:13:51] <aatch> you can grab all of it by just going `use super::*`
[05:14:00] <Eridius> I see
[05:14:03] <aatch> Eridius, because extern mods weren't the same as other mods
[05:14:07] <Eridius> :/
[05:14:12] <aatch> part of the reason for the change in the first place
[05:14:19] *** Joins: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net)
[05:14:21] <Eridius> but extern mods to introduce FFI calls made sense
[05:14:56] <cmr> extern blocks didn't go away, no functionality was lost...
[05:15:01] <aatch> Eridius, now extern is more like extern "C" {} in C++.
[05:15:13] *** Joins: seth (seth@moz-99690620.hinet-ip.hinet.net)
[05:15:19] <Eridius> I see
[05:18:56] <hjr3> i just noticed that "rust run foo.rs" will have a return code of 0 even if tests fail. is this intentional?
[05:19:07] <hjr3> sorry, i meant "rust test foo.rs"
[05:19:19] <strcat> hjr3: I doubt it's intentional
[05:19:23] <strcat> just wasn't thought about
[05:19:28] <cmr> hjr3: yes, but it probably shouldn't be that way. it's the same with task failure.
[05:19:42] <hjr3> great, let me see if i can make a PR
[05:19:44] <cmr> yeah what strcat said
[05:20:15] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[05:21:50] <dbaupp> jensnockert: hi! (I realised today I totally butchered my swedish yesterday :( ... sorry if I made you cry ;P )
[05:22:05] * jensnockert hugs dbaupp.
[05:23:01] <dbaupp> strcat: deriving(DeepClone) is in stage0?
[05:23:08] <strcat> dbaupp: apparently
[05:23:13] <dbaupp> cool
[05:27:59] <thomaslee> brson, ping?
[05:28:25] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[05:29:15] *** Quits: aatch (aatch@moz-B437F499.pocketrent.com) (Client exited)
[05:30:21] *** Quits: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net) (Quit: Don't tell them I was here...)
[05:31:48] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[05:32:07] *** Joins: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net)
[05:32:50] *** Quits: rntz_ (daedalus@moz-7E35218B.cmdnnj.fios.verizon.net) (Ping timeout)
[05:32:59] <brson> thomaslee: pong
[05:33:29] <thomaslee>  so just to make sure I understand what's happening here: 1. we build rustrt with the new closure type signatures; 2. stage0 rustc emits code for stage1 rustc using the *old* type signature; 3. when we go to build using our stage1 rustc, the old type info in the rustc binary (& everything else from stage0) doesn't match the new type info in rustrt
[05:33:39] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[05:33:55] *** Quits: blitter (blitter@moz-E761A52F.dyn.centurytel.net) (Ping timeout)
[05:33:56] <steven_is_false> This is wierd. I can't seem to be able to do an out of tree build for rust-sdl.
[05:34:42] *** Joins: giaour (foocraft@5623AB0C.AC2A87D1.583B598F.IP)
[05:36:03] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Connection reset by peer)
[05:36:25] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[05:37:09] *** Joins: rntz_ (daedalus@moz-7E35218B.cmdnnj.fios.verizon.net)
[05:38:32] <dbaupp> sweet! dlopen works on rust libraries
[05:38:56] *** Joins: devbug (quassel@moz-E1DE087C.bchsia.telus.net)
[05:40:06] <brson> thomaslee: yes. so to work around it you use conditional compilation to continue using the old definitions in stage0 while building a compiler that will output code in stage1 that uses the new definitions
[05:40:57] <brson> acrichto: it looks like the new llvm submodule works here
[05:41:20] <steven_is_false> Was std changed to extra or ext?
[05:41:23] <acrichto> brson: did you pull in more than just those few commits from llvm?
[05:41:45] <strcat> dbaupp: pluggable syntax extensions! gogo ;p
[05:42:04] <acrichto> brson: nothing runs in the jit, and I'm trying to debug this. None of the previous changes to rust look suspicious, but it is suspicious that the first thing the generated code does is "mov $0, %rax; callq *%rax"
[05:42:14] <dbaupp> strcat: exactly my next step
[05:42:20] <dbaupp> :D
[05:42:30] <thomaslee> brson, cool. The change to rt.mk seems like it could be hairy -- may be worth a pull request of its own. Can I rope you in for a review when I land it?
[05:42:31] <bjz_> dbaupp: !
[05:42:41] <Eridius> arggg, the extern mod change means I can no longer pull in non-public types into the extern mod
[05:43:18] <acrichto> brson: I think that a good idea would be to land these llvm changes (and the change to the configuration), and then worry about rusti/jit later
[05:43:31] <dbaupp> is incoming green again?
[05:43:40] <brson> acrichto: yes, i had a pull request that rebased llvm onto something newer
[05:43:44] <dbaupp> (wait, bors is working, so yes)
[05:43:44] <Eridius> which is actually kinda crap. I guess with an extern block I could ditch the mod and just declare the functions in the local one? But using a mod to encapsulate the FFI functions was really nice
[05:43:57] <brson> thomaslee: sure
[05:44:16] <strcat> Eridius: you don't need to put the extern block in a mod
[05:44:36] <Eridius> strcat: this is pre-existing code. And it was really nice to have a namespace that meant "these are FFI functions"
[05:45:34] *** Quits: seth (seth@moz-99690620.hinet-ip.hinet.net) (Input/output error)
[05:46:30] <brson> acrichto: ugh. the goal of this was to make the jit tests work. maybe we don't need to pick up all the extra llvm commits
[05:46:47] <acrichto> brson: it's ok, I don't mind debugging that, I think it's more important to upgrade LLVM
[05:47:09] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Quit: Computer has gone to sleep.)
[05:47:39] <acrichto> brson: https://github.com/mozilla/rust/pull/6713
[05:47:46] <brson> acrichto: it seems likely to be a bug in llvm though, right?
[05:48:04] <acrichto> brson: maybe? I haven't been able to track it down yet. I was hoping to sift through the commits, but there's 1k+
[05:48:28] *** Joins: seth (seth@moz-99690620.hinet-ip.hinet.net)
[05:48:36] <acrichto> I haven't done a huge amount of debugging, just whittled it down to probably an LLVM issue now (although that could be wrong)
[05:50:04] <acrichto> brson: I also doubt that LLVM would break everything about the JIT, so it's probably not something wrong with them
[05:50:17] <brson> acrichto: rusti works here
[05:50:24] <Eridius> wow, nice type signature: @fn(**std::libc::types::common::c95::c_void, &*mut u8) -> i32
[05:50:53] <dbaupp> Eridius: libc::c_void should work?
[05:50:58] *** Joins: sankha93 (Instantbir@EA2D262B.E0248F56.616A18A6.IP)
[05:51:02] <Eridius> dbaupp: that's how it's declared in code
[05:51:17] <dbaupp> or right, that's rustc's output?
[05:51:22] <Eridius> anyway, the overall error here is that function there was expected, but it found an extern "C" unsafe fn(...same sig...)
[05:51:27] <Eridius> this code _used_ to work
[05:51:53] <Eridius> the only change is instead of an extern mod, the function's now just in an extern block
[05:52:32] *** Joins: haard (fredrik@moz-6A86987C.dynamic.se.alltele.net)
[05:52:35] <dbaupp> does '@extern "C" fn(** ... ) -> i32' work?
[05:52:41] <bjz_> Eridius: libc's types are rexported at the top level
[05:52:51] <Eridius> bjz_: not really the point
[05:52:57] <acrichto> brson: ok, well tjc r+'d the pr, so if it passes I'll debug my changes then
[05:53:31] <bjz_> Eridius: they are in submodules because they are conditionally included depending on the architecture
[05:53:35] <Eridius> dbaupp: no, now calling the function fails
[05:53:41] <Eridius> bjz_: you're missing the point
[05:53:47] <dbaupp> well, it's progress at least
[05:53:57] <bjz_> Eridius: what's the point?
[05:53:58] <Eridius> bjz_: my initial comment was just saying that the type signature was unexpectedly complex, but that's not actually my problem
[05:54:04] <bjz_> ohh
[05:54:16] <bjz_> sorry :)
[05:54:21] <Eridius> dbaupp: expected function but found `@extern "C" fn(**std::libc::types::common::c95::c_void, &*mut u8) -> i32`
[05:54:54] <dbaupp> (*f)(args...)
[05:55:15] <dbaupp> rust doesn't auto deref for calling a function pointer
[05:55:28] <Eridius> dbaupp: apparently it used to, because as I said before, this code worked with previous versions of rust
[05:55:30] <acrichto> brson: could I get a r+ for https://github.com/mozilla/rust/pull/6685 while we're at it?
[05:55:43] <dbaupp> Eridius: yep, the language changes
[05:56:00] <Eridius> also apparently havint it declared as @ is a problem when calling this function too (the one that accepts the fn param)
[05:56:12] <Eridius> dbaupp: yeah, but it seems like it's becoming more problematic :/
[05:56:33] <dbaupp> it should be getting more stable soon
[05:56:33] *** Quits: haard (fredrik@moz-6A86987C.dynamic.se.alltele.net) (Ping timeout)
[05:57:05] <Eridius> dbaupp: looks like what I really wanted to do was just ditch the @ and declare the param as extern "C" unsafe fn(...)
[05:57:20] <dbaupp> it compiles?
[05:57:22] <Eridius> dbaupp: it used to be possible to pass an FFI function as a parameter here. That no longer works. This seems rather unfortunate
[05:57:28] <Eridius> dbaupp: well, I have other errors, but the error here disappeared
[05:57:38] *** Quits: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net) (Client exited)
[05:57:55] *** Joins: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr)
[05:58:22] <dbaupp> Eridius: I'm not sure what you mean by passing a FFI fn as a parameter?
[05:58:47] <Eridius> dbaupp: extern mod libfoo { fn Foo(); } ... dosomething(libfoo::Foo)
[05:58:49] <Eridius> that used to work
[05:58:57] <Eridius> where dosomething took @fn(..)
[05:59:18] <Eridius> but extern { fn Foo(); } ... dosomething(Foo); fails
[05:59:26] <Eridius> unless I change dosomething to take extern "C" unsafe fn(..)
[05:59:52] <dbaupp> ah, I see... does `dosomething(|args...| Foo(args...))` work?
[06:00:10] <strcat> just 'extern fn' or wrap it into one with native calling conventions
[06:00:53] *** Quits: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr) (Ping timeout)
[06:01:49] *** Joins: SimonSapin (simon@moz-99690620.hinet-ip.hinet.net)
[06:02:07] <Eridius> dbaupp: well the function is now apparently unsafe, which it.. wasn't before?
[06:02:25] <dbaupp> yes, all extern functions are unsafe by default (and always)
[06:02:37] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[06:02:42] <dbaupp> if you want a safe variant, you need to wrap it in a Rust function
[06:03:54] <strcat> we can eventually have #[safe] but very few foreign functions are valid for all inputs (if they take a pointer and dereference it, they aren't safe)
[06:04:04] *** Quits: giaour (foocraft@5623AB0C.AC2A87D1.583B598F.IP) (Ping timeout)
[06:04:18] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[06:04:37] <strcat> there were a lot of FFI functions wrongly marked as safe so it was an easy way to turn that into an error and force an explicit unsafe block
[06:04:46] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Client exited)
[06:05:05] *** Quits: burntsushi (burntsushi@moz-27A1B1D8.dhcp.oxfr.ma.charter.com) (Client exited)
[06:05:44] *** Joins: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net)
[06:06:16] *** Quits: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net) (Client exited)
[06:07:18] <Eridius> strcat: the code I'm modifying already wraps these FFI calls. I really shouldn't have to wrap the calls once with a rust function, and then wrap those with the code I'm working with
[06:07:21] <Eridius> that's just ridiculous
[06:07:35] <strcat> you don't have to wrap them twice
[06:07:35] *** Joins: burntsushi (burntsushi@moz-27A1B1D8.dhcp.oxfr.ma.charter.com)
[06:07:55] <strcat> you wrap them once into a safe rust function, nothing more
[06:07:55] <Eridius> actually, I think there's a bona-fide bug here. The line that's complaining about needing to wrap the function in an unasfe block... is ALREADY wrapped in an unsafe block
[06:08:07] <Eridius> strcat: no, I have to wrap them twice, because these functions are too low-level to be made public
[06:08:12] <Eridius> so a higher-level API is constructed around them
[06:08:25] <strcat> Eridius: okay, and is the low-level function safe?
[06:08:26] <dbaupp> Eridius: code snippet? :)
[06:08:26] <Eridius> but the higher-level API knows how to safely call the FFI directly, it shouldn't have to use a low-level thin wrapper around it
[06:08:34] <Eridius>         unsafe {
[06:08:35] <Eridius>             self._tostr(|a: *EVP_PKEY, b: &*mut u8| i2d_PublicKey(a,b))
[06:08:35] <Eridius>         }
[06:08:46] <Eridius> it's complaining about the call to i2d_PublicKey, which is the extern "C" unsafe fn
[06:09:28] <strcat> if a function takes &fn() as an argument, it won't let you implicitly convert an unsafe function to that
[06:09:30] <strcat> it's intended
[06:09:33] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[06:09:33] <ghrust> 01[13rust01] 15bors merged 06auto into 06incoming: 02http://git.io/YEHe6g
[06:09:33] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[06:09:56] <strcat> unsafe blocks let you dereference null pointers and call unsafe functions, not much else
[06:10:02] <Eridius> strcat: I'm not implicitly converting anything. This is a lambda wrapper around the unsafe function, to try out dbaupp's theory that this will work with an @fn() param
[06:10:15] <Eridius> but the unsafe block apparently doesn't cover the contents of the lambda
[06:10:30] <dbaupp> Eridius: try |a, b| unsafe { i2d_PK(a,b) }
[06:10:35] <Eridius> dbaupp: I did, and that works
[06:10:46] <strcat> Eridius: if it uses &*mut u8 it's also unlikely to be safe
[06:11:00] <dbaupp> ah, right, and that's what strcat is saying about implicitly converting unsafe functions
[06:11:12] <strcat> if it derefs any of those * pointers, it's not a safe function
[06:11:16] <Eridius> strcat: the &*mut u8 is the FFI function's signature
[06:11:26] <strcat> Eridius: okay, and if it deferences the *mut it's not safe
[06:11:31] <Eridius> strcat: what's your point?
[06:11:38] <dbaupp> the lambda function can't be made safe by being inside an unsafe block, it has to be safe "on the inside"
[06:11:48] <Eridius> what do you mean, "made safe"? The unsafe block denotes unsafe code
[06:11:53] <strcat> Eridius: no
[06:11:57] <Eridius> so shouldn't all code inside it be considered unsafe?
[06:12:14] <dbaupp> Eridius: and unsafe block tells the compiler "trust me, this is safe"
[06:12:19] <dbaupp> (basically)
[06:12:22] <strcat> an unsafe block denotes an unsafe block which *does not leak* unsafety
[06:12:25] <strcat> it has to be valid for all inputs
[06:12:27] <dbaupp> so from the outside, it looks safe
[06:12:29] <strcat> or it's not correct
[06:12:33] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[06:12:33] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/0j7uJw
[06:12:33] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[06:12:48] <Eridius> strcat: ok, so why does the unsafe block not cover the contents of the lambda?
[06:13:04] <dbaupp> Eridius: because lambdas are non-local
[06:13:11] *** Quits: anshin (nbs@441B8B9E.2055B963.D2A6B5.IP) (Quit: Lost terminal)
[06:13:18] *** Joins: tikue (tkuehn@moz-CF8BEBEF.dia.static.qwest.net)
[06:13:23] <strcat> Eridius: what does _to_str do?
[06:13:33] <Eridius> strcat: no idea. not my code originally
[06:13:37] <strcat> what's the signature of the closure argument?
[06:13:52] <strcat> Eridius: well it looks like it's incorrect
[06:14:02] <Eridius> strcat: why is it incorrect?
[06:14:12] <strcat> Eridius: because it takes a function with the signature &*mut
[06:14:16] <strcat> and I assume it calls that function...
[06:14:19] <strcat> which is unsafe
[06:15:06] <strcat> deref of an * pointer is unsafe
[06:15:20] <strcat> any function that dereferences an * pointer has to be marked as unsafe
[06:15:32] <Eridius> the function it takes is an FFI function
[06:15:36] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[06:15:36] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/0j7uJw
[06:15:36] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[06:15:39] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[06:15:39] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/GTPCXA
[06:15:39] <ghrust> 13rust/06auto 147f642f3 15Brian Anderson: rustc: Give glue symbols meaningful names...
[06:15:39] <ghrust> 13rust/06auto 14ed9a793 15bors: auto merge of #6706 : brson/rust/glue, r=catamorphism...
[06:15:40] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[06:15:44] <strcat> Eridius: so it should use unsafe fn if it's not a safe function
[06:15:45] <Eridius> this function is designed to work with 1 of 2 FFI functions
[06:15:50] <strcat> the parameter should be 'unsafe fn'
[06:16:15] <Eridius> ok
[06:17:23] <strcat> rusti: unsafe fn unsafe_func(x: *int) -> int { *x }; let x = 5; unsafe { unsafe_func(&x) }
[06:17:28] -rusti- 5
[06:17:30] *** Joins: xazax (Mibbit@6655692F.3B222813.3F580572.IP)
[06:17:53] <brson> acrichto: looking now
[06:18:08] *** Quits: devbug (quassel@moz-E1DE087C.bchsia.telus.net) (Connection reset by peer)
[06:18:36] <strcat> rusti: unsafe fn unsafe_func(x: *int) -> int { *x }; fn buggy_func(x: *int) { unsafe { unsafe_func(&x) } }; buggy_func(0 as *int)
[06:18:38] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/IieR
[06:18:48] <strcat> rusti: unsafe fn unsafe_func(x: *int) -> int { *x }; fn buggy_func(x: *int) { unsafe { unsafe_func(x) } }; buggy_func(0 as *int)
[06:18:50] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/RFRg
[06:18:55] *** Joins: solancile (solancile@moz-A1CFFAE5.hsd1.wa.comcast.net)
[06:19:06] <strcat> rusti: unsafe fn unsafe_func(x: *int) -> int { *x }; fn buggy_func(x: *int) -> int { unsafe { unsafe_func(x) } }; buggy_func(0 as *int)
[06:19:08] -rusti- /usr/local/bin/rust.sh: line 21:    13 Segmentation fault      (core dumped) ./foo
[06:21:26] <strcat> rusti: unsafe fn unsafe_func(x: *int) -> int { *x }; fn buggy_func(x: *int) -> int { unsafe { unsafe_func(x) } }; buggy_func(12 as *int)
[06:21:27] -rusti- /usr/local/bin/rust.sh: line 21:    13 Segmentation fault      (core dumped) ./foo
[06:21:34] <strcat> rusti: unsafe fn unsafe_func(x: *int) -> int { *x }; fn buggy_func(x: *int) -> int { unsafe { unsafe_func(x) } }; buggy_func(132535325325325312 as *int)
[06:21:35] -rusti- /usr/local/bin/rust.sh: line 21:    13 Segmentation fault      (core dumped) ./foo
[06:21:37] <acrichto> brson: thanks!
[06:24:03] <Eridius> error: cannot borrow const vec content as immutable
[06:24:18] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[06:25:05] *** Quits: hjr3 (hradtke@moz-AE3056B9.static.stls.mo.charter.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[06:25:17] <strcat> &const is less strong than &
[06:25:31] <strcat> it only means read-only through that reference, not read-only
[06:25:42] <strcat> you can coerce &mut to &const
[06:25:53] <Eridius> strcat: not quite sure what you mean
[06:26:00] <strcat> Eridius: & points to an immutable object
[06:26:14] <strcat> the object can never be modified as long as there's as & pointer
[06:26:18] <Eridius> oh right, const means it can be mutable, but this particular code only treats it as read-only
[06:26:25] <strcat> should be & then
[06:26:39] <Eridius> anyway this is code that used to work. and the issue in question is a call to vec::const_slice()
[06:26:49] <Eridius> with the first arg being a mut ~[]
[06:26:53] <strcat> vec::slice then
[06:27:04] <Eridius> what changed here?
[06:27:20] <strcat> fewer memory unsafety bugs
[06:27:25] <Eridius> can't use vec::slice because it's already been borrowed as mutable
[06:27:37] <strcat> Eridius: can't have & references to it then
[06:27:43] <Eridius> this is inside an as_mut_buf function
[06:27:48] <strcat> if it's actually *borrowed* as &mut, you can't have other references to it
[06:27:50] *** Quits: SimonSapin (simon@moz-99690620.hinet-ip.hinet.net) (Quit: Leaving.)
[06:28:19] <strcat> &mut references are always unique
[06:28:51] <Eridius> I don't really undrestand why &mut prevents me from taking a & reference if I don't touch the &mut while the & lives
[06:29:10] <strcat> as_mut_buf is touching the &mut reference
[06:29:24] <strcat> borrow checking is local, not cross-program or cross-crate
[06:29:41] <Eridius> it's not actively touching the &mut while the & is alive though
[06:30:04] <strcat> if you're calling as_mut_buf, you're touching the &mut
[06:30:20] <strcat> it's a function call, borrow checking doesn't analyze outside the local function
[06:30:27] <strcat> it relies on the signatures of other functions
[06:31:04] <Eridius> anyway why does vec::const_slice() fail here?
[06:31:23] <strcat> because you're then apparently trying to convert the const slice to an immutable slice
[06:31:31] <Eridius> I'm calling .to_owned() on it
[06:31:59] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[06:32:01] <strcat> and I guess to_owned is implemented on &[T]
[06:32:13] <Eridius> presumably
[06:32:16] <strcat> &const is probably going to be removed
[06:32:19] <strcat> it's not very useful
[06:32:28] <strcat> I don't know a use case for it
[06:32:39] *** Joins: fabiand (fabiand@moz-859205E.adsl.alicedsl.de)
[06:32:51] <Eridius> well in this case I need an owned copy of a slice of this vector, which has already been borrowed as &mut
[06:32:58] <Eridius> what exactly am I supposed to do?
[06:33:04] <strcat> take it from the &mut reference
[06:33:23] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[06:33:24] <Eridius> I don't have a &mut reference accessible. That was created by passing the ~[] into as_mut_buf()
[06:33:44] <strcat> so you can't, an &mut reference is non-aliasing
[06:34:30] <strcat> I don't know exactly what you're trying to do
[06:34:41] *** Joins: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP)
[06:34:41] *** Quits: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP) (Z:lined (Open Proxy found on your host. Please visit www.blitzed.org/proxy?ip=115.68.131.49 for more information.))
[06:34:51] <Eridius> I'm trying to update working code to the latest version of rust
[06:34:58] <Eridius> formerly-working
[06:35:06] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[06:35:26] *** Joins: victorporof (victorporo@7362939B.70F4578F.79933D60.IP)
[06:35:33] <strcat> I don't know what the code you're currently working on is supposed to do so I can't give you a *how* because I don't know the why/what
[06:36:28] <Eridius> it's a wrapper around OpenSSL
[06:36:52] <Eridius> I don't know what any given bit of this code does though, sicne I didn't write it, and all I've done with it is port it to rust 0.6, which was a lot easier than porting to current incoming
[06:37:26] *** Quits: sankha93 (Instantbir@EA2D262B.E0248F56.616A18A6.IP) (Quit: Instantbird 1.4 -- http://www.instantbird.com)
[06:38:27] <Eridius> hmm, I think I can shrink the as_mut_buf() function to not cover this call to slice
[06:38:30] <Eridius> which means the &mut is gone
[06:40:33] <Eridius> wooo, compilation worked! but... linking failed :/
[06:40:52] <Eridius> all of the FFI functions aren't being found
[06:41:02] <strcat> need to pass the link argument
[06:41:07] <Eridius> to what?
[06:41:10] <strcat> #[link_args = "-lcrypto"] on the extern block
[06:41:13] <Eridius> all of the extern blocks have #[link_name = "crypto"]
[06:41:28] <strcat> not sure if link_name does anything
[06:41:30] <Eridius> why is link_args now necessary?
[06:41:43] <strcat> I don't think link_name ever did anything for extern blocks
[06:41:49] <Eridius> it must have, because this used to compile
[06:41:51] <strcat> it just changed the name for extern mod blocks
[06:41:58] <strcat> Eridius: they weren't extern blocks before
[06:42:00] <Eridius> well it worked with extern mod
[06:42:26] <Eridius> I liked extern mod. Removing it seems to just make it more complicated to get FFI working
[06:43:05] <strcat> Eridius: the code was *incorrect* before if it was treating functions taking pointers as safe
[06:43:11] <strcat> so the change led to finding valid bugs
[06:43:20] <strcat> which is exactly why it was changed
[06:43:29] *** Joins: vodik (root@B8C7456C.5553E784.DC1243F8.IP)
[06:43:46] <Eridius> strcat: unrelated to the loss of extern mod
[06:44:08] <Eridius> that seems to have been caused by rust no longer wrapping my extern unsafe fn in a @fn
[06:44:30] <strcat> Eridius: coercing 'unsafe fn' to fn was unsafe
[06:44:34] <strcat> it's correct to not allow it
[06:45:03] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[06:45:26] <strcat> rusti: unsafe fn unsafe_func(x: *int) -> int { *x }; fn buggy_func(x: *int) -> int { unsafe { unsafe_func(x) } }; buggy_func(12 as *int)
[06:45:26] -rusti- /usr/local/bin/rust.sh: line 21:    13 Segmentation fault      (core dumped) ./foo
[06:45:28] <strcat> that was an example
[06:45:40] <strcat> if you could coerce unsafe_func to '@fn', it would be a hole
[06:45:45] <Diablo-D3> http://jeditoolkit.com/try-wisp/
[06:45:45] <Diablo-D3> what
[06:47:05] <Eridius> strcat: yes I agree. But again, that's not related to the loss of extern mod
[06:48:16] <Eridius> woo, linking works now
[06:48:25] *** Joins: haard (fredrik@18E6EC45.6A26450D.BE04C429.IP)
[06:49:01] <dbaupp> Diablo-D3: what about it?
[06:49:13] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[06:49:16] <Diablo-D3> dbaupp: besides the WWHHHHHHHHHHHHYYYYYYYYYYYY? not much.
[06:50:52] *** Quits: geomyidae (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Quit: Tschuss!)
[06:51:42] *** Joins: berak (chatzilla@D0CA9694.4742BCFA.1A5CC7E5.IP)
[06:51:57] *** Quits: z0w0 (zack@moz-780F7535.lns9.cha.bigpond.net.au) (Ping timeout)
[06:54:00] *** Quits: seth (seth@moz-99690620.hinet-ip.hinet.net) (Input/output error)
[06:54:39] *** Joins: geomyidae (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[06:58:07] *** Joins: z0w0 (zack@moz-42FD6E2C.lns6.woo.bigpond.net.au)
[06:59:10] *** Joins: jdm|away (jdm@DB05BBF2.BB1F48F2.971E19F6.IP)
[07:00:18] *** Quits: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net) (Ping timeout)
[07:03:51] <Eridius> ok this is weird. I have two copies of the dylib for this library installed, but all the meta parameters (including uuid) are the same
[07:03:55] <Eridius> so why is the dylib name different?
[07:04:09] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[07:04:36] <Eridius> it's easy enough to delete both copies and rebuild, I'm just confused because I thought the dylib name was generated based on the meta parameters
[07:05:49] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[07:06:00] *** Parts: berak (chatzilla@D0CA9694.4742BCFA.1A5CC7E5.IP) ()
[07:06:19] *** Joins: pyrac (pyrac@85714936.81445FE4.1B3E68DA.IP)
[07:06:36] <strcat> Eridius: they are also based on dependencies
[07:06:58] <strcat> sorted list of dep hashes and dep versions
[07:08:08] <Eridius> only dependency is std, but I guess that used to be core
[07:09:35] <strcat> yeah the name matters
[07:12:44] <dbaupp> how come stuff still uses core::... ?
[07:12:52] <dbaupp> (e.g. extra::arc)
[07:15:28] <strcat> dbaupp: I guess it's re-exported somewhere
[07:15:59] <dbaupp> strcat: yup, good point
[07:16:05] <dbaupp> that's confusing
[07:16:40] <dbaupp> (prelude injection seems to be broken too)
[07:17:57] *** Joins: seth_ (seth@moz-99690620.hinet-ip.hinet.net)
[07:19:20] *** jdm|away is now known as jdm
[07:20:31] <Eridius> oh come on. the borrow checker has seriously gotten worse
[07:20:45] <strcat> Eridius: how so?
[07:21:02] <Eridius> strcat: I can't use HashMap's because it's complaining about borrowing as mutable more than once
[07:21:10] <dbaupp> Eridius: it's got harder to get around... but that's because it's safer
[07:21:15] <Eridius> this code used to work as long as I used a @ box (it failed with ~). Now it's failing with @ too
[07:21:22] <Eridius> dbaupp: but I'm not trying to get around it
[07:21:28] <Eridius> I'm calling map.find_mut() and then map.insert()
[07:21:40] <Eridius> and it complains at the map.insert(). But the &mut from map.find_mut() _should_ have been returned already
[07:21:42] <strcat> Eridius: well that's be unsound if you kept around the find_mut ref
[07:21:48] <acrichto> brson: ok so the LLVM upgrade definitely does contain a bug in LLVM
[07:21:55] <strcat> Eridius: it bases pointer lifetime on blocks, and did before
[07:22:11] <strcat> I guess there was unsoundness before, but it wasn't compiling for the right reason
[07:22:24] <acrichto> brson: currently rusti uses the MCJIT (not sure what that is), and the code I'm testing LLVM with works with the regular JIT, so I'll try to figure out how to get rusti working with the regular JIT
[07:22:27] <Eridius> https://gist.github.com/kballard/5641833
[07:22:37] <Eridius> strcat, dbaupp: how am I supposed to do the above "correctly"?
[07:23:16] <strcat> Eridius: I mean the compiler was incorrect before
[07:23:33] <strcat> Eridius: are you on incoming?
[07:23:36] <Eridius> strcat: yes
[07:23:51] <strcat> that shouldn't happen anymore on incoming afaik
[07:24:16] <Eridius> strcat: well apparently I'm 7 commits behind, but I just built a few hours ago
[07:24:20] *** Joins: deLta30 (quassel@4C7DE5B8.24F6DDAF.F7B44A7.IP)
[07:24:32] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[07:24:33] <ghrust> 01[13rust01] 15bors merged 06auto into 06incoming: 02http://git.io/GTPCXA
[07:24:33] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[07:24:38] <strcat> rusti: let mut xs = std::hashmap::HashMap::new(); xs.insert(5, 5); match xs.find_mut(&5) { Some(_) => _, None => xs.insert(2, 2) }
[07:24:38] -rusti- foo.rs:5:104: 5:105 error: unexpected token: `_`
[07:24:39] -rusti- foo.rs:5          let mut xs = std::hashmap::HashMap::new(); xs.insert(5, 5); match xs.find_mut(&5) { Some(_) => _, None => xs.insert(2, 2) }
[07:24:39] -rusti-                                                                                                                  ^
[07:24:50] <strcat> rusti: let mut xs = std::hashmap::HashMap::new(); xs.insert(5, 5); match xs.find_mut(&5) { Some(_) => (), None => xs.insert(2, 2) }
[07:24:52] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/eTaS
[07:24:54] <strcat> rusti: let mut xs = std::hashmap::HashMap::new(); xs.insert(5, 5); match xs.find_mut(&5) { Some(_) => (), None => xs.insert(2, 2); }
[07:24:54] -rusti- foo.rs:5:131: 5:132 error: expected `,` but found `;`
[07:24:54] -rusti- foo.rs:5          let mut xs = std::hashmap::HashMap::new(); xs.insert(5, 5); match xs.find_mut(&5) { Some(_) => (), None => xs.insert(2, 2); }
[07:24:54] -rusti-                                                                                                                                             ^
[07:24:59] * strcat sighs
[07:25:06] <strcat> rusti: let mut xs = std::hashmap::HashMap::new(); xs.insert(5, 5); match xs.find_mut(&5) { Some(_) => (), None => { xs.insert(2, 2); } }
[07:25:19] <strcat> well that compiled
[07:25:27] <strcat> Eridius: dunno why that's happening, what's the full error?
[07:25:38] <Eridius> error: cannot borrow `map` as mutable more than once at at a time
[07:25:43] <Eridius> pointing at the map in map.insert
[07:25:50] <strcat> Eridius: the full thing with the spans
[07:25:53] <Eridius> with a note saying the second borrow occurs in the map.find_mut
[07:26:05] <Eridius> https://gist.github.com/kballard/5641850
[07:26:43] <Eridius> rusti: let mut xs = std::hashmap::HashMap::new(); xs.insert(5, 5); match xs.find_mut(&5) { Some(x) => x++, None => { xs.insert(2, 2); } }
[07:26:43] -rusti- foo.rs:5:106: 5:107 error: unexpected token: `+`
[07:26:43] -rusti- foo.rs:5          let mut xs = std::hashmap::HashMap::new(); xs.insert(5, 5); match xs.find_mut(&5) { Some(x) => x++, None => { xs.insert(2, 2); } }
[07:26:43] -rusti-                                                                                                                    ^
[07:26:53] <Eridius> rusti: let mut xs = std::hashmap::HashMap::new(); xs.insert(5, 5); match xs.find_mut(&5) { Some(x) => *x += 1, None => { xs.insert(2, 2); } }
[07:26:54] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/TLNW
[07:27:04] <Eridius> that triggered the error
[07:27:32] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[07:27:32] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/TqJcaA
[07:27:32] <ghrust> 13rust/06auto 14497f325 15Alex Crichton: Change how the input from rusti is formatted to allow duplicate definitions
[07:27:32] <ghrust> 13rust/06auto 141cde91f 15Alex Crichton: Change the generic 'print' function to 'pp' for rusti
[07:27:32] <ghrust> 13rust/06auto 141b6a376 15bors: auto merge of #6685 : alexcrichton/rust/issue-5675, r=brson...
[07:27:35] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[07:28:45] <strcat> meh I thought find_mut was usable now
[07:29:15] <strcat> it didn't exist in 0.6 though, wasn't possible to write yet
[07:29:46] <Eridius> find_mut? of course it did. I wrote this code with rust 0.6
[07:30:32] *** kimundi is now known as zz_kimundi
[07:30:45] <strcat> oh it did. I forgot I used an unsafe workaround
[07:32:11] *** Quits: deLta30 (quassel@4C7DE5B8.24F6DDAF.F7B44A7.IP) (Ping timeout)
[07:32:14] *** Joins: deLta30_ (quassel@207ED182.7B97C627.110F01C1.IP)
[07:33:44] <strcat> Eridius: http://ix.io/5M7 so I guess you have to do that
[07:33:51] <strcat> @mut wasn't really borrow checked before
[07:33:58] <strcat> it let you take more than one &mut reference
[07:34:09] <Eridius> strcat: heh, I was considering writing it like that. Nasty though
[07:34:33] <strcat> Eridius: yeah it shouldn't be like that, I don't think this was a regression though - it has always sucked like this
[07:34:53] <strcat> there was just a separate bug covering up this bug
[07:34:54] *** Joins: SimonSapin (simon@moz-99690620.hinet-ip.hinet.net)
[07:34:55] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[07:35:26] *** Joins: doener (bs@moz-AA189A5A.unitymedia.biz)
[07:35:59] *** Quits: deLta30_ (quassel@207ED182.7B97C627.110F01C1.IP) (Ping timeout)
[07:36:41] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[07:37:56] *** Joins: deLta30 (quassel@81A5B294.5922AE75.A05B35DF.IP)
[07:38:56] *** Quits: brson (brson@58B3E13.EF2694B5.DFAC6AA7.IP) (Quit: leaving)
[07:44:51] *** Quits: deLta30 (quassel@81A5B294.5922AE75.A05B35DF.IP) (Client exited)
[07:48:19] *** Quits: pyrac (pyrac@85714936.81445FE4.1B3E68DA.IP) (Ping timeout)
[07:50:20] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[07:50:21] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[07:51:03] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[07:54:10] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[07:55:18] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[07:56:01] <steven_is_false> How would one install a rust application (in a makefile script) once it's built.
[07:57:10] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[07:58:12] *** Quits: tikue (tkuehn@moz-CF8BEBEF.dia.static.qwest.net) (Quit: tikue)
[07:58:30] <strcat> steven_is_false: install/cp the binary to $(PREFIX)/bin and the libs to $(PREFIX)/lib
[07:58:44] <strcat> where $(PREFIX) is $(DESTDIR)/usr/local by default
[07:58:56] <steven_is_false> strcat: It's just that simple?
[07:58:59] <strcat> steven_is_false: yep
[07:59:26] <strcat> a package manager will do 'make install DESTDIR="$pkgdir"' (makepkg/pacman) or similar
[07:59:54] <strcat> and with just 'make install' you want it to cp/install to /usr/local/{bin,lib}
[07:59:58] <steven_is_false> It doesn't make sense to do export PREFIX ?= $(DESTDIR)/usr/local right?
[08:00:26] <strcat> steven_is_false: that makes sense
[08:00:31] <strcat> but make you want to separate PREFIX
[08:00:33] <strcat> I forget what stuff does.
[08:00:46] <strcat> maybe it's better to install to $(DESTDIR)$(PREFIX)
[08:00:48] <strcat> sec
[08:01:12] <strcat> steven_is_false: yeah you want it separate, just to make it easier for the person using it
[08:01:20] <strcat> PREFIX = /usr/local
[08:01:22] <strcat> and then just
[08:01:44] <strcat> install -Dm755 foo $(DESTDIR)$(PREFIX)/foo
[08:01:47] <strcat> or whatever you need to do
[08:02:06] *** Quits: jdm (jdm@DB05BBF2.BB1F48F2.971E19F6.IP) (Ping timeout)
[08:03:01] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[08:03:10] <steven_is_false> Okay the thing I'm really confused about is that I don't know how to install the shared libraries.
[08:03:58] <strcat> steven_is_false: just cp them to $(DESTDIR)$(PREFIX)/lib/foo.so if they're your own libraries
[08:04:14] <strcat> that's in the default lib path so they'll be found by the linker
[08:04:57] <steven_is_false> strcat: Wouldn't I want to put them under a subdirectory?
[08:05:11] <strcat> steven_is_false: if they are third party libs your makefile should know how to use system libs
[08:05:41] <steven_is_false> strcat: I was thinking about the bindings to existing libs like rust-sdl.
[08:05:44] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[08:05:54] <steven_is_false> strcat: It'd probable want my private copies for those right?
[08:05:57] <strcat> steven_is_false: so you probably want to provide 2 ways to install
[08:06:10] <strcat> 1) use system rust-sdl, 2) copy it to your own lib dir
[08:06:26] <strcat> default is up to you, but using your own makes sense as a Just Works default
[08:06:30] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[08:06:30] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 141b6a376 to 14ed9a793: 02http://git.io/N3iJvQ
[08:06:30] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[08:06:33] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[08:06:33] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/78n4CA
[08:06:33] <ghrust> 13rust/06auto 14248a669 15Tim Chevalier: docs: Don't mention obsolete move operator, as per #5700
[08:06:33] <ghrust> 13rust/06auto 145787bf3 15bors: auto merge of #6711 : catamorphism/rust/issue-5700, r=thestinger...
[08:06:35] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[08:07:31] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[08:07:41] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[08:07:46] <strcat> steven_is_false: I forget if subdirs are found by the linker automatically but it's fine if they aren't (there's /etc/ld.so.conf.d/ - I just don't think you need it for /usr/lib/foo)
[08:07:52] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[08:07:55] <strcat> or for /usr/local/lib/foo
[08:08:33] <steven_is_false> Okay one last thing. I was thinking I'd want to set up a ~/usr/local directory instead of just testing everything with root willy nilly. How'd I do that?
[08:09:07] <steven_is_false> All I'd have to do is change the PATH, and LD_PRELOAD right?
[08:09:15] <strcat> steven_is_false: well ~/.local/ already mirrors /usr so I'd use that
[08:09:21] <strcat> and yeah, just append to PATH and LD_LIBRARY_PATH
[08:09:46] <steven_is_false> strcat: Cool.
[08:10:05] <strcat> and you should make the Makefile work with 'make install DESTDIR=~ PREFIX=/.local'
[08:10:17] <strcat> good test of that working
[08:11:24] <steven_is_false> Auugh, this is tricky. I need to get the name that rustc gave the library in the makefile.
[08:11:27] *** Joins: s_moon (Mibbit@1085B022.2F60492E.66BB421.IP)
[08:11:52] <steven_is_false> NVM: I just realized I could use basename
[08:12:31] *** Quits: seth_ (seth@moz-99690620.hinet-ip.hinet.net) (Input/output error)
[08:12:42] <steven_is_false> strcat: Thank you for your help.
[08:14:47] <strcat> np
[08:14:53] *** zz_kimundi is now known as kimundi
[08:16:12] *** Quits: mitsuhiko (mitsuhiko-@moz-BC29B73E.srv.pocoo.org) (Ping timeout)
[08:16:31] *** Joins: mitsuhiko (mitsuhiko-@moz-BC29B73E.srv.pocoo.org)
[08:16:34] <strcat> steven_is_false: hopefully rustpkg quickly improves to the point where it install deps to a dir from a url
[08:16:58] <steven_is_false> strcat: hopefully
[08:17:19] <strcat> I guess it can almost do that but it doesn't really work yet.
[08:17:37] *** Joins: seth_ (seth@moz-99690620.hinet-ip.hinet.net)
[08:19:43] *** Joins: CarpNet (ac@moz-FD24B77.sohonet.co.uk)
[08:21:30] <steven_is_false> And of couse uninstall is just rm -rf $(DESTDIR)$(PREFIX)/etc...
[08:22:39] <strcat> steven_is_false: ideally just rm -f and rmdir --ignore-fail-on-non-empty so fewer things can go wrong
[08:22:46] <strcat> doesn't really matter
[08:23:17] <strcat> once upon a time bumblebee (support for nvidia optimus on linux) removed all of /usr in make uninstall
[08:23:49] <steven_is_false> I remember that news
[08:24:00] <strcat> luckily I use a package manager for everything and know how to recover from a missing /usr easily anyway... but a lot of people got screwed ;p
[08:26:43] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[08:27:00] <steven_is_false> Okay so the actions part of a makefile rule is just shell right? but it doesn't seem to be letting me set a variable
[08:27:17] <strcat> steven_is_false: it's not really shell
[08:27:22] <strcat> it just spawns a million shells
[08:27:25] <strcat> you can do $(shell foo)
[08:27:41] <strcat> https://www.gnu.org/software/make/manual/html_node/Functions.html
[08:27:57] *** Quits: seth_ (seth@moz-99690620.hinet-ip.hinet.net) (Input/output error)
[08:28:50] <steven_is_false> Isn't that function run at a different stage?
[08:30:33] <strcat> steven_is_false: no, it's run during the rule
[08:30:41] <strcat> FOO = $(shell bar)
[08:30:47] <strcat> each time you do $(FOO), it runs bar
[08:30:58] <strcat> FOO := $(shell bar) # runs it when it's defined
[08:31:51] <s_moon> this might be a better question for the mailing list, but I haven't been confirmed yet. is there any reason there's a FreeBSD 64bit bootstrap build but no 32bit? I'm working on cross compiling it / updating the makefiles...
[08:31:55] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[08:33:23] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[08:34:24] *** Quits: donri (dag@moz-9BB61102.tbcn.telia.com) (Client exited)
[08:34:48] *** Quits: flowsnake (flowsnake@moz-1918C33E.aztw.cable.virginmedia.com) (Ping timeout)
[08:35:14] <strcat> s_moon: probably just lack of time
[08:35:25] <strcat> s_moon: kind of the same reason there's only a 32-bit windows snapshot
[08:35:25] *** Quits: z0w0 (zack@moz-42FD6E2C.lns6.woo.bigpond.net.au) (Quit: Leaving.)
[08:35:36] <s_moon> developer time or machine build time?
[08:35:41] <strcat> s_moon: developer time
[08:35:50] <strcat> s_moon: support for it would be welcome, I'm sure, and graydon could probably set up a bot
[08:36:03] <strcat> the freebsd buildbot is just a VM
[08:36:10] <s_moon> okay. i'll see what i can do to get it all up and running and make a pull request then. if there was already a clear answer that 'no, we dont want anymore archs' then i wouldn't bother. thanks for the info
[08:36:13] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[08:36:31] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[08:38:18] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[08:38:48] *** Joins: flowsnake (flowsnake@moz-1918C33E.aztw.cable.virginmedia.com)
[08:39:29] *** Joins: seth_ (seth@moz-99690620.hinet-ip.hinet.net)
[08:47:07] <thomaslee> woohoo, in bed before 2am. Take that, rustc.
[08:47:21] <thomaslee> night all
[08:48:17] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[08:48:27] <steven_is_false> Good night
[08:49:46] *** Joins: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP)
[08:50:54] *** Joins: mye (mye@moz-5E55807E.dip0.t-ipconnect.de)
[08:52:12] <steven_is_false> So how do I run things from my ~/.local just add them to LD_LIBRARY_LOAD, and the PATH right?
[08:52:23] *** Joins: sk (sk@61A494B3.BA40E8A.AAC02D62.IP)
[08:53:22] <strcat> steven_is_false: yeah
[08:53:39] <strcat> add ~/.local/lib to LD_LIBRARY_PATH and ~/.local/bin to PATH
[08:53:45] *** Joins: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk)
[08:54:27] <steven_is_false> Hoorah! It works!
[08:54:50] <strcat> :)
[08:55:20] *** Joins: strcat1 (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:55:28] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[08:55:36] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[08:56:06] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:56:13] <steven_is_false> Now to configure git's submodules
[08:56:36] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:57:24] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[08:59:54] *** strcat1 is now known as strcat
[09:00:12] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[09:00:35] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[09:00:35] <ghrust> 01[13rust01] 15bors merged 06auto into 06incoming: 02http://git.io/78n4CA
[09:00:35] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[09:01:47] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[09:03:34] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[09:03:36] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[09:03:36] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Hemgnw
[09:03:36] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[09:06:39] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[09:06:39] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Hemgnw
[09:06:39] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[09:07:21] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[09:09:05] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[09:14:21] *** Quits: s_moon (Mibbit@1085B022.2F60492E.66BB421.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[09:22:41] *** Joins: reyre (reyre@moz-99690620.hinet-ip.hinet.net)
[09:26:06] *** Quits: sk (sk@61A494B3.BA40E8A.AAC02D62.IP) (Quit: Leaving)
[09:38:12] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[09:38:33] *** Quits: victorporof (victorporo@7362939B.70F4578F.79933D60.IP) (Quit: victorporof)
[09:40:01] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[09:40:17] *** Joins: jviereck (Adium@moz-DC3D0EEB.ethz.ch)
[09:41:17] *** Joins: pnkfelix (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net)
[09:41:29] *** Quits: jviereck (Adium@moz-DC3D0EEB.ethz.ch) (Quit: Leaving.)
[09:49:11] *** Joins: EXetoC (ex@moz-2DBEB1E4.customer.t3.se)
[09:52:31] *** kimundi is now known as zz_kimundi
[09:54:32] *** Quits: pnkfelix (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net) (Ping timeout)
[09:54:59] *** Quits: Diablo-D3 (diablo@moz-6317EE8A.port.east.myfairpoint.net) (Quit: This computer has gone to sleep)
[09:55:24] *** Joins: Diablo-D3 (diablo@moz-6317EE8A.port.east.myfairpoint.net)
[09:56:03] *** zz_kimundi is now known as kimundi
[10:00:57] *** Joins: pnkfelix (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net)
[10:03:50] <nmatsakis> aat
[10:08:32] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[10:10:12] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[10:10:57] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[10:11:06] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[10:12:34] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[10:12:34] <ghrust> 01[13rust01] 15bors merged 06auto into 06incoming: 02http://git.io/fiHsKA
[10:12:34] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[10:15:32] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[10:15:32] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/MyWELg
[10:15:32] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[10:15:33] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[10:15:33] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/ADu9GQ
[10:15:33] <ghrust> 13rust/06auto 141f19db1 15Brian Anderson: Try to fix a periodic windows build failure due to broken rwildcard macro
[10:15:33] <ghrust> 13rust/06auto 149baf235 15Brian Anderson: Upgrade LLVM
[10:15:33] <ghrust> 13rust/06auto 14f999b17 15Alex Crichton: Start building a multithreaded rust
[10:15:35] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[10:17:58] *** Joins: trapni (trapni@moz-6A0EA166.dawanda.com)
[10:18:16] *** Joins: pnkfelix|rcirc (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net)
[10:19:06] *** Quits: DasIch (dasich@moz-756B08B1.clients.your-server.de) (Ping timeout)
[10:21:17] *** Joins: Earnestly (earnest@6A917A59.5E1FD793.39C00A7A.IP)
[10:24:14] *** Joins: samnardoni (samnardoni@moz-ECB14881.cable.virginmedia.com)
[10:24:52] *** Joins: FrozenCow (FrozenCow@moz-9DF5D010.dynamic.upc.nl)
[10:25:51] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[10:29:04] *** Quits: reyre (reyre@moz-99690620.hinet-ip.hinet.net) (Client exited)
[10:32:23] *** Quits: samnardoni (samnardoni@moz-ECB14881.cable.virginmedia.com) (Client exited)
[10:33:08] *** Joins: DasIch (dasich@moz-756B08B1.clients.your-server.de)
[10:33:12] *** Joins: Blub\w (wry@moz-A7BC612F.wireless.dyn.drei.com)
[10:33:30] *** Quits: SimonSapin (simon@moz-99690620.hinet-ip.hinet.net) (Quit: Leaving.)
[10:36:15] *** Quits: seth_ (seth@moz-99690620.hinet-ip.hinet.net) (Input/output error)
[10:39:21] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[10:41:12] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[10:48:22] *** Joins: victorporof (victorporo@moz-23D6B301.info.uaic.ro)
[10:55:40] *** Joins: Palmik (palmik@moz-EFC3356B.vpn.muni.cz)
[11:01:29] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[11:03:02] *** Quits: naq (naq@D5C2D2DF.E4265FCD.E481B5B.IP) (Ping timeout)
[11:03:15] *** Joins: naq (naq@D5C2D2DF.E4265FCD.E481B5B.IP)
[11:03:34] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[11:03:44] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[11:05:20] *** Quits: solancile (solancile@moz-A1CFFAE5.hsd1.wa.comcast.net) (Quit: Leaving)
[11:07:19] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[11:10:13] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[11:11:57] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[11:12:51] *** kimundi is now known as zz_kimundi
[11:14:15] *** Joins: sk (sk@5F3B8500.CB2CB346.78DD174B.IP)
[11:14:19] <benh> Is there a list of "module owners" now by the way, or was it decided that it wasn't necessary?
[11:18:23] *** Quits: victorporof (victorporo@moz-23D6B301.info.uaic.ro) (Quit: victorporof)
[11:22:27] *** Joins: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de)
[11:22:28] *** zz_kimundi is now known as kimundi
[11:23:18] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[11:26:49] *** Joins: judder (maradukewa@CF01B517.FDE2B133.950D3BB5.IP)
[11:27:34] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[11:27:34] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1459e9ead to 142f69bb9: 02http://git.io/N3iJvQ
[11:27:34] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[11:27:37] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[11:27:37] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/kbMRxg
[11:27:37] <ghrust> 13rust/06auto 14513b69d 15Niko Matsakis: Issue #3678: Remove wrappers and call foreign functions directly
[11:27:37] <ghrust> 13rust/06auto 1497b07f6 15bors: auto merge of #6661 : nikomatsakis/rust/issue-3678-wrappers-be-gone-2, r=brson...
[11:27:37] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[11:30:52] <pnkfelix> hmm, I thought we had arm support, but on my raspberry pi the configure invocation says: configure: error: unknown CPU type: armv6l
[11:31:40] <pnkfelix> ah, Issue 1858 has discussion
[11:35:35] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[11:36:47] *** Joins: noam_ (noam@F6B530A7.720527A7.416762B.IP)
[11:37:27] *** Quits: noam (noam@F6B530A7.720527A7.416762B.IP) (Ping timeout)
[11:40:12] *** Quits: KindOne (KindOne@moz-7973B695.dynamic.ip.windstream.net) (Ping timeout)
[11:41:01] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[11:42:43] *** Joins: samnardoni (samnardoni@moz-ECB14881.cable.virginmedia.com)
[11:42:44] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[11:44:20] *** Joins: KindOne (KindOne@moz-C06FCA05.dynamic.ip.windstream.net)
[11:44:27] *** Quits: samnardoni (samnardoni@moz-ECB14881.cable.virginmedia.com) (Ping timeout)
[11:51:35] *** Quits: Blub\w (wry@moz-A7BC612F.wireless.dyn.drei.com) (Quit: bbl)
[11:51:37] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[11:59:14] *** Joins: fabiand_ (fabiand@moz-859205E.adsl.alicedsl.de)
[11:59:37] *** Quits: fabiand_ (fabiand@moz-859205E.adsl.alicedsl.de) (Quit: Verlassend)
[11:59:40] *** Quits: fabiand (fabiand@moz-859205E.adsl.alicedsl.de) (Ping timeout)
[12:01:03] *** kimundi is now known as zz_kimundi
[12:01:35] *** Joins: fabiand (fabiand@moz-859205E.adsl.alicedsl.de)
[12:01:59] *** zz_kimundi is now known as kimundi
[12:05:16] <MaikKlein> how would I design a task where I can send one message to all tasks. I tried to use a portset but I run into some problems https://gist.github.com/MaikKlein/5643027
[12:07:43] <bstrie> MaikKlein: you'll have to ask brson, I'm not familiar with the current capabilities of tasks
[12:09:16] <cmr> I'm not sure it's possible directly using ports, which are 1:1. However, you can build a broadcast-like system using a hub-and-spoke model. All tasks have a port open with a central broker that retransmits messages it receives to other tasks
[12:10:03] <cmr> That's how I'd work around it, at least :)
[12:10:11] <cmr> (seriously ask brson though)
[12:11:06] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[12:11:51] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[12:13:39] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[12:13:57] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[12:14:16] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[12:14:47] *** Quits: judder (maradukewa@CF01B517.FDE2B133.950D3BB5.IP) (Ping timeout)
[12:16:37] <MaikKlein> okay thanks
[12:18:03] <MaikKlein> btw what linux distro (if you use linux) are you using?
[12:19:21] <cmr> me? arch
[12:20:49] <EXetoC> same
[12:21:23] <EXetoC> quite a few people use it nowadays
[12:23:39] <MaikKlein> I used it too but my system broke like every 1-2 months and I had to fix something. I am now on fedora which runs completely stable but some packages are 3 years old. arch's community package system is just really good and always up to date. 
[12:26:04] <strcat> and there are nightly builds of rust ;p
[12:27:39] <EXetoC> ftw
[12:30:33] *** Joins: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[12:30:42] *** Joins: victorporof (victorporo@moz-23D6B301.info.uaic.ro)
[12:31:15] *** Joins: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com)
[12:32:32] <benh> hi strcat
[12:33:00] <benh> bors tested my pull request while incoming was on fire and I think it's not anymore, is bors going to come back to it or do I need to do something?
[12:34:15] <strcat> benh: which PR?
[12:34:19] <strcat> I need to tell bors to retry
[12:34:28] <benh> https://github.com/mozilla/rust/pull/6680
[12:34:55] <benh> It was such a small change too :)
[12:34:55] <strcat> benh: there :)
[12:35:25] <strcat> incoming is still on-fire-ish so...
[12:35:28] <strcat> we'll see
[12:35:32] <strcat> well a few things landed so nvm
[12:35:53] <benh> I merged incoming into my branch locally and the tests passed, so clearly there's nothing that could possibly go wrong now
[12:36:35] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[12:36:35] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1497b07f6 to 142f69bb9: 02http://git.io/N3iJvQ
[12:36:35] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[12:36:36] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[12:36:36] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/_Wlf6Q
[12:36:36] <ghrust> 13rust/06auto 145a42481 15Benjamin Herr: declare that "///" is still a doc comment, just not "////+" (fixes #5838)
[12:36:36] <ghrust> 13rust/06auto 14b5ab101 15bors: auto merge of #6680 : ben0x539/rust/slashslashslash, r=graydon...
[12:36:38] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[12:37:35] *** Joins: wilsonk|2 (kvirc@moz-39EFBFC2.cg.shawcable.net)
[12:38:26] *** Quits: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[12:42:18] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[12:42:36] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[12:44:07] *** Joins: z0w0 (zack@moz-42FD6E2C.lns6.woo.bigpond.net.au)
[12:44:19] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[12:44:47] *** Joins: Axord (xord@moz-C3CCF156.lsanca.dsl-w.verizon.net)
[12:50:46] *** Joins: SimonSapin (simon@moz-99690620.hinet-ip.hinet.net)
[12:53:45] *** Quits: victorporof (victorporo@moz-23D6B301.info.uaic.ro) (Quit: victorporof)
[12:54:25] *** Joins: solancile (solancile@moz-A1CFFAE5.hsd1.wa.comcast.net)
[12:56:24] *** Quits: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de) (Ping timeout)
[12:56:34] <strcat> acrichto: btw the real problem with swap is that it uses align 1 for the copies
[12:56:37] <strcat> going to fix that later
[12:56:40] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[12:59:43] *** Joins: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP)
[13:01:44] *** Quits: SimonSapin (simon@moz-99690620.hinet-ip.hinet.net) (Quit: Leaving.)
[13:02:50] *** Joins: reyre (reyre@5AAE35B2.5EFFC0B8.24454B25.IP)
[13:04:32] *** Joins: Sodel_the_V (user@moz-853663E1.va.shawcable.net)
[13:07:22] *** Joins: victorporof (victorporo@moz-23D6B301.info.uaic.ro)
[13:07:43] *** Joins: samnardoni (samnardoni@moz-ECB14881.cable.virginmedia.com)
[13:09:18] *** Joins: hjr3 (hradtke@moz-AE3056B9.static.stls.mo.charter.com)
[13:13:05] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[13:13:26] *** Joins: seth__ (seth@moz-99690620.hinet-ip.hinet.net)
[13:13:27] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[13:13:31] *** Joins: judder (maradukewa@CF01B517.FDE2B133.950D3BB5.IP)
[13:15:12] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[13:16:05] *** Joins: dylukes (dylukes@moz-B5418F79.hsd1.pa.comcast.net)
[13:18:31] *** Joins: cowboyd (cowboyd@moz-1BD02A1E.sw.biz.rr.com)
[13:19:30] *** Joins: saml (sam@moz-14C16814.cst.lightpath.net)
[13:20:10] *** kimundi is now known as zz_kimundi
[13:20:57] *** zz_kimundi is now known as kimundi
[13:23:47] <strcat> LLVM's optimizations are a joke sometimes ;p
[13:23:57] <strcat> http://ix.io/5Mg it didn't used to infer nocapture
[13:24:05] <strcat> http://ix.io/5Mi now, with simpler code it does
[13:24:13] <strcat> but afaict it's pretty obvious that both are nocapture...
[13:24:17] *** Joins: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de)
[13:25:35] <bstrie> "-deadarghaX0r" is an llvm optimization pass
[13:25:59] <bstrie> so maybe some of them are jokes :)
[13:26:38] <strcat> my endless mission to make treemap fast ;p
[13:26:59] *** Joins: jviereck (Adium@moz-340574DC.dclient.hispeed.ch)
[13:27:09] <dbaupp> strcat: pointer swap?
[13:27:16] <bstrie> optimizing containers is god's work
[13:27:25] <strcat> dbaupp: no just a swap
[13:27:32] <dbaupp> oh, right
[13:27:40] <strcat> dbaupp: http://ix.io/5Mj that's the code
[13:27:41] <dbaupp> dynamic syntax extensions are so close :D
[13:27:44] <strcat> and those pastes are before/after
[13:27:48] <strcat> going to try fixing alignment now
[13:27:51] <strcat> it should be align 8.
[13:28:02] <strcat> would go faster since it can move bigger chunks at a time, the assembly is *CRAP*
[13:28:04] <strcat> ;p
[13:29:54] <bstrie> well as long as clang's assembly is also crap, that's ok :P
[13:29:59] <strcat> bstrie: it's not :)
[13:30:13] <strcat> also our IR pre-optimization is ridiculously bad
[13:30:18] <bstrie> haha
[13:30:20] <strcat>  but that's just compile-time
[13:30:26] <strcat> swap is like 120 lines
[13:30:28] <strcat> pre-opt
[13:30:30] <strcat> ;p
[13:30:38] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Connection reset by peer)
[13:30:43] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[13:30:43] <ghrust> 01[13rust01] 15bors merged 06auto into 06incoming: 02http://git.io/_Wlf6Q
[13:30:43] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[13:31:08] <benh> :)
[13:31:08] <dbaupp> there's a whole pile of information that rustc knows but isn't passing to LLVM, right?
[13:31:12] <strcat> dbaupp: yes
[13:31:15] <strcat> dbaupp: aliasing info is the big one.
[13:31:18] <dbaupp> (like noalias, etc)
[13:31:18] <strcat> dbaupp: *huge*
[13:31:18] <dbaupp> yeah
[13:31:23] <strcat> dbaupp: noalias is only for params though
[13:31:26] <strcat> we need a whole  TBAA pass
[13:31:40] <dbaupp> sounds... non-trivial
[13:31:48] <strcat> dbaupp: no it's pretty trivial afaict
[13:31:52] <strcat> &mut *never* aliases in LLVM terms
[13:32:06] <strcat> LLVM's aliasing pass considers a ptr to immutable memory NoAlias even if it aliases too
[13:32:16] <dbaupp> and neither do ~'s
[13:32:19] <strcat> so & to Const objects are in theory all markable as NoAlias
[13:32:28] <dbaupp> oh... wow, that's really flexible noaliasing
[13:32:33] <bstrie> passing aliasing information would be really neat
[13:32:38] <strcat> dbaupp: it would be... awesome
[13:32:48] <strcat> essentially everything but @ and non-Const things can be NoAlias
[13:32:52] <dbaupp> strcat: have you looked at implementing it?
[13:32:55] <strcat> rust is really good at this. we just aren't using it
[13:32:57] <strcat> dbaupp: nope
[13:33:04] <strcat> dbaupp: the easy start is &mut params
[13:33:11] <strcat> trans_closure or whatever
[13:33:18] <strcat> it looked hard so I didn't try ;p
[13:33:19] <dbaupp> (i wasn't volunteering ;) )
[13:33:26] <strcat> dbaupp: well someone might be! :)
[13:33:35] <dbaupp> hopefully!
[13:33:43] <benh> you people, good code is a lot harder than it looks when just watching rustc get better :(
[13:33:56] <dbaupp> benh: ?
[13:33:57] <strcat> sometimes I get things fixed by repeating the problem until someone interested in fixing it sees ;p
[13:34:06] <benh> I want to do this trivial change to (yet again) doc generation and I really don't know how to do it properly :)
[13:34:59] <bstrie> so what replaced the <-> operator?
[13:35:09] <benh> std::util::swap iirc
[13:35:12] <dbaupp> benh: well, your /// patch landed! :D
[13:35:27] <benh> yeah, hooray :D
[13:35:47] <benh> right now I'm concerned that if you have multiple doc comments/doc attr blocks, they just get concatenated with a single newline inbetween
[13:35:53] *** Quits: jviereck (Adium@moz-340574DC.dclient.hispeed.ch) (Ping timeout)
[13:35:56] <dbaupp> ah
[13:35:57] <benh> which means markdown puts them into the same paragraph
[13:36:00] <dbaupp> two would be better
[13:36:04] <benh> yeah you'd think so
[13:36:04] <dbaupp> yeah
[13:36:22] <benh> but then multiple line comments in a row get treated as separate paragraphs
[13:36:42] <benh> and you couldn't have any of the fancy multiline block-level constructs really, unless you used block comments again
[13:36:50] <bstrie> rusti: let z = ~0; let o = ~1; let (z, o) = (o, z); (z, o)
[13:36:53] *** Quits: cowboyd (cowboyd@moz-1BD02A1E.sw.biz.rr.com) (Client exited)
[13:36:55] -rusti- (~1, ~0)
[13:37:08] *** Quits: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de) (Ping timeout)
[13:37:09] <bstrie> does anyone know why util::swap is necessary if that ^ works?
[13:37:14] *** Quits: FrozenCow (FrozenCow@moz-9DF5D010.dynamic.upc.nl) (Ping timeout)
[13:37:19] <dbaupp> benh: oh... that is nontrivial
[13:37:39] <dbaupp> bstrie: that's not swapping in memory
[13:37:49] <dbaupp> it's only swapping the names that we call them by
[13:37:49] <strcat> bstrie: util::swap uses &mut
[13:38:07] <benh> sooo clearly the right thing to do is for rustdoc to reach into the attrs and look at the style of the doc comment, and only insert double newlines between any two adjacent comments if they aren't both the same of /// or //!
[13:38:11] <benh> is what i thught
[13:38:43] <strcat> you can ofc do 'let tmp = *x.clone(); *x = *y; *y = *x;' but that's *incredibly* slow.
[13:38:46] <bstrie> but rustdoc doesn't look at the source, it looks at the binary file's metadata (right?)
[13:38:56] <benh> no, i don't think so
[13:39:14] <strcat> deep copy, move (zeroes source), move (zeroes source) and then 2 attempted drops
[13:39:26] <benh> all the tests operate on string literals anyway and there's libsyntax references everywhere
[13:40:08] <benh> but anyway right now the relevant code in rustdoc looks so elegant, and it immediately loses that property if i start crawling inside the ast objects, relying on knowing syntax details that far away from libsyntax, and doing string smushing
[13:40:08] *** Joins: sankha93 (Instantbir@EA2D262B.E0248F56.616A18A6.IP)
[13:40:12] <dbaupp> benh: it might be "easier" to start from scratch... maybe
[13:40:28] <dbaupp> (I always feel wrong saying that)
[13:40:34] *** Joins: jviereck (Adium@moz-BA1D85DC.dclient.hispeed.ch)
[13:40:42] <benh> It doesn't seem all that _hard_, I'm just not sure what the right way is
[13:40:54] <benh> should libsyntax tell me what the style of the comment is?
[13:40:58] *** Parts: judder (maradukewa@CF01B517.FDE2B133.950D3BB5.IP) ()
[13:41:03] <benh> Should that be a semantic thing that goes into the ast?
[13:41:13] <dbaupp> benh: I don't think it gives any info other than "is_sugared_doc"
[13:41:16] <benh> yeah
[13:41:17] <dbaupp> : bool
[13:41:19] <benh> but it could!
[13:41:24] <dbaupp> yup
[13:41:26] <dbaupp> change it!
[13:41:42] <benh> but of course making every attribute have like a paragraph about doc-comment-specific stuff, brr
[13:41:52] <benh> The other thing that would fix it is to always insert two newlines between comments
[13:41:55] <dbaupp> sugared_doc: enum { NotSD, LineSD, BlockSD }
[13:42:00] <benh> and hack the lexer so multiple line comments are a single token
[13:42:08] *** Quits: EXetoC (ex@moz-2DBEB1E4.customer.t3.se) (Ping timeout)
[13:42:10] <benh> i'm not sure if that's... gross
[13:42:23] <bstrie> no, that's gross :)
[13:42:27] <strcat> dbaupp: http://ix.io/5Ml clang's IR
[13:42:31] <bstrie> fewer forms of doc comments, please
[13:42:33] <strcat> foo being the relevant function
[13:42:43] <strcat> dbaupp: so basically, clang gets alignment right.
[13:42:47] <benh> Personally I think /** */ doc comments are gross anyway
[13:42:52] <strcat> the TBAA info isn't going to end up doing anything in their TBAA pass
[13:42:58] <strcat> since they're the same type
[13:43:04] <benh> everybody inserts * at the beginning of each line for style, so you might as well use ///-comments ;)
[13:43:10] <bstrie> benh: I agree, but it might be easier to use block-comments as line comments than vice-versa
[13:43:27] <benh> yeah
[13:43:31] <bstrie> whatever it takes to get us down to less than six forms of doc comments
[13:43:37] <bstrie> ideally there would be two at most
[13:44:00] <dbaupp> bstrie: 6!?
[13:44:09] <benh> I can see the appeal for block comments if you want to disable a long block of code and your editor doesn't support inserting // at multiple lines
[13:44:12] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[13:44:16] <benh> but for doc comments, ehh
[13:44:20] <dbaupp> (oh, inner/outer forms of ///, /** and #[doc] ?)
[13:44:20] <bstrie> dbaupp: inner block, inner line, outer block, outer line, inner attribute, outer attribute
[13:44:49] <strcat> imo we should only allow inner at module-level
[13:44:52] <strcat> for the module docstring
[13:45:04] *** Quits: samnardoni (samnardoni@moz-ECB14881.cable.virginmedia.com) (Client exited)
[13:45:46] <strcat> outer works everywhere else (fields, variants, globals) and you have more horizontal space
[13:45:52] *** Joins: samnardoni (samnardoni@moz-ECB14881.cable.virginmedia.com)
[13:45:58] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[13:46:00] *** Quits: samnardoni (samnardoni@moz-ECB14881.cable.virginmedia.com) (Client exited)
[13:46:31] <benh> a more draconic solution would be to ban inner doc comments entirely and make people document each module inside the .rc file, above the mod foo; line ;)
[13:47:02] <strcat> benh: and how do you document the main module?
[13:47:12] <strcat> rc is just a legacy extension used by rust's own Makefile
[13:47:35] <strcat> I guess you can add a special way of doing that
[13:47:39] <dbaupp> benh: #[doc=" ... "]
[13:47:46] <dbaupp> would work as an inner one
[13:48:43] <kimundi> eww
[13:49:06] <dbaupp> kimundi: no complaints! we're simplifying the language ;P
[13:49:38] <benh> /** blah blah blah */ mod self;
[13:49:54] <benh> I think I'm going to stick to fixing this one issue for now instead of getting creative :)
[13:52:20] <dbaupp> \o/
[13:52:23] <dbaupp> https://gist.github.com/huonw/5643650
[13:52:49] *** Quits: seth__ (seth@moz-99690620.hinet-ip.hinet.net) (Input/output error)
[13:52:53] <dbaupp> loading syntax extensions from external files
[13:53:22] <benh> cool!
[13:53:25] <xazax> what the hell O.o
[13:53:27] <strcat> dbaupp: awesome.
[13:53:46] *** Quits: trapni (trapni@moz-6A0EA166.dawanda.com) (Ping timeout)
[13:53:57] <bstrie> dbaupp: !!!
[13:54:08] <xazax> this syntax stuff is part of the standard libraries, or one needs the rust source to use it?
[13:54:16] <bstrie> does this lead into importing macros?
[13:54:23] <dbaupp> bstrie: no idea
[13:54:52] <dbaupp> hm, maybe
[13:55:08] <dbaupp> i.e. it could be used to get that to work
[13:55:30] <benh> Would it be less gross if the parser looked ahead seeing a line doc comment and merged them there?
[13:55:40] <dbaupp> xazax: at the moment, it is part of libsyntax, which is in the compiler
[13:56:12] <xazax> oh I see
[13:56:29] <dbaupp> and the core syntax extensions will always be there
[13:56:38] <dbaupp> (always be in the compiler)
[13:56:40] <benh> What does the parser do if you look_ahead past eof?
[13:56:54] <benh> return eof?
[13:57:33] *** Joins: trapni (trapni@moz-6A0EA166.dawanda.com)
[13:57:43] *** Quits: Sodel_the_V (user@moz-853663E1.va.shawcable.net) (Quit: Eaten by a grue)
[13:58:12] <bstrie> benh: ideally doc comments would not be such a hack that they require magical behavior in the parser
[13:58:20] <dbaupp> benh: yes, it returns eof
[13:58:50] <dbaupp> (eurgh, linking against libsyntax takes ages!)
[13:59:02] <benh> bstrie: Where should the magic of "subsequent line-style doc comments form a single paragraph" go?
[13:59:12] <strcat> swap_unwrap still makes horrific code
[13:59:15] <strcat> will deal with that later
[13:59:32] <strcat> and moves are horrific.
[13:59:34] <strcat> ;\
[13:59:52] <xazax> anyways the memory usage of rustc can sometimes be very massive O.o
[13:59:57] <xazax> what is the reason?
[13:59:59] *** Joins: seth__ (seth@moz-99690620.hinet-ip.hinet.net)
[14:00:06] <dbaupp> Does anyone happen to know the equivalent of dlerror on windows?
[14:00:11] *** Quits: hjr3 (hradtke@moz-AE3056B9.static.stls.mo.charter.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[14:00:22] <strcat> xazax: poorly optimized, written with lots of anti-patterns due to it being written in an old dialect of the language and ported bit by bit
[14:00:45] <xazax> oh I see
[14:00:46] <strcat> the standard library is pretty good
[14:00:50] <dbaupp> xazax: garbage collector that doesn't actually do it's job properly
[14:00:58] <strcat> dbaupp: well that's not really an issue
[14:01:02] <strcat> I doubt there are many cycles
[14:01:07] <strcat> when the gc lands, rustc memory usage will go up
[14:01:15] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[14:01:20] <dbaupp> oh... that's not good
[14:01:22] <strcat> refcounting keeps it near minimum, except for leaking cycles
[14:01:33] <strcat> gc landing will just remove a lot of code bloat
[14:01:43] <strcat> can always switch to std::Rc for long-lived, large values
[14:01:47] <strcat> std::rc::Rc*
[14:01:53] <dbaupp> has the 1.8 -> 2.5GB problem been investigated/solved?
[14:01:59] <xazax> are there some docs about those anti patterns and other leftovers that should be purged? 
[14:02:00] <strcat> dbaupp: no but graydon bisected it
[14:02:11] <strcat> xazax: massively overuses memory allocation, especially @
[14:02:12] <dbaupp> strcat: yeah, I saw it was the lint commits
[14:02:14] <strcat> doesn't use much borrowing
[14:03:12] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Ping timeout)
[14:03:26] <dbaupp> strcat: any opinion on which of core or std dynamic library loading should go in?
[14:03:32] <dbaupp> (err, std or extra)
[14:03:36] <strcat> std
[14:03:47] *** Joins: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP)
[14:03:51] <strcat> seems pretty low-level/essential, especially if syntax exts use it
[14:03:53] <dbaupp> is that old core, or new extra?
[14:03:57] <strcat> dbaupp: the old core
[14:03:57] *** Quits: reyre (reyre@5AAE35B2.5EFFC0B8.24454B25.IP) (Client exited)
[14:04:01] <dbaupp> ok, good
[14:04:03] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[14:04:08] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[14:04:16] *** Joins: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP)
[14:04:27] *** Joins: EXetoC (ex@moz-C741B177.customer.t3.se)
[14:04:42] <dbaupp> also, do you have any suggestions for how to get lifetimes on the symbols loaded?
[14:05:08] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[14:05:15] <EXetoC> thanks weechat for notifying me of socket errors
[14:05:19] <strcat> dbaupp: well could you just make it an object with a destructor?
[14:05:25] <dbaupp> i.e. twice I had the loaded library destroyed with dangling references
[14:05:27] <strcat> EXetoC: ssl ones?
[14:05:40] <dbaupp> and trying to call those dangling references causes exciting segfaults
[14:05:50] <strcat> dbaupp: &'self fn
[14:05:53] <strcat> well
[14:05:55] <strcat> no
[14:05:59] <dbaupp> extern fn
[14:06:00] <strcat> dbaupp: it returns functions somehow?
[14:06:05] <strcat> what's the signature like
[14:06:12] <strcat> you want something like
[14:06:29] <strcat> new<'r>() -> DynamicLib<'r>
[14:06:33] <strcat> wait no
[14:06:35] <strcat> ;p
[14:06:39] <strcat> new() -> DynamicLib
[14:06:42] <strcat> with a Drop impl
[14:07:03] <dbaupp> strcat: https://gist.github.com/huonw/d724fb04df0dffa71fdd
[14:07:06] <dbaupp> yeah, got all that
[14:07:19] <dbaupp> but the DynamicLib getting dropped to early is a problem
[14:07:20] <dbaupp> *too
[14:07:30] <EXetoC> strcat: no, but it often notifies me of disconnects only after I try to send something
[14:07:39] <strcat> EXetoC: well that's just irc ;p
[14:07:52] <dbaupp> EXetoC: isn't that a limitation of the protocol?
[14:07:59] <strcat> and then get_fn<'r>(&'r self) -> &'r fn() {}
[14:08:03] <strcat> dunno about extern fn.
[14:08:35] <dbaupp> strcat: if I remember correctly &extern fn doesn't work, but I'll try it again
[14:08:44] <strcat> dbaupp: could it wrap it into &fn?
[14:09:01] <strcat> or just use &fn? (or does that not work?)
[14:09:05] <dbaupp> strcat: how? I can't return stack fns, can I?
[14:09:15] <EXetoC> aren't pings frequently sent?
[14:09:18] <dbaupp> (and yeah, can't transmute to &fn)
[14:09:29] <strcat> dbaupp: why can't it load &fn from dlopen?
[14:09:47] <strcat> EXetoC: no, not afaik
[14:10:05] <dbaupp> strcat: it complains that it needs extern fn
[14:10:22] <strcat> dbaupp: because it doesn't know it's rust :(
[14:10:26] <strcat> dbaupp: extern "Rust" fn
[14:12:04] <EXetoC> strcat: I can't remember it happening on other clients. anyway, what an annoying limitation
[14:12:16] <strcat> EXetoC: there's probably a plugin to do it
[14:12:36] *** Joins: reyre (reyre@5AAE35B2.5EFFC0B8.24454B25.IP)
[14:13:15] <dbaupp> strcat: ok, yeah, transmuting to &extern ["Rust"] fn segfaults
[14:13:30] <dbaupp> and &fn needs an environment pointer
[14:13:39] *** Quits: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP) (Ping timeout)
[14:13:41] <dbaupp> (i.e. it's 16 bytes, rather than 8)
[14:13:58] <strcat> dbaupp: ah
[14:14:21] <dbaupp> it'd be nice to be able to attach lifetimes to arbitrary types
[14:14:45] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[14:15:09] <strcat> dbaupp: I reported that already btw
[14:15:20] <dbaupp> I assumed you had :)
[14:15:32] <dbaupp> (something about the iterators, iirc?)
[14:15:37] <strcat> dbaupp: workaround: add a dummy Option<&'self ()> ptr
[14:15:57] <strcat> that's what I did for std::rc for @ and @mut before I added those attributes for non_owned and mutable
[14:16:25] <strcat> it's only 1 word now so it's not too bad
[14:16:45] *** Quits: doener (bs@moz-AA189A5A.unitymedia.biz) (Quit: leaving)
[14:18:51] <dbaupp> Hm, I could have get_symbol return a `TaggedSymbol<'r, T>`, and just put big warnings about unwrapping the symbol & segfaults
[14:19:36] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[14:19:37] <strcat> dbaupp: or just have them call (foo.bar)()
[14:19:48] <strcat> can they borrow it as &fn?
[14:20:35] <dbaupp> strcat: yeah, but they could still go `let steal = foo.bar; <destroy library>; steal()`, right?
[14:20:52] <dbaupp> (since the lifetime isn't on the actual symbol pointer)
[14:21:02] <strcat> dbaupp: is the extern fn copyable?
[14:21:07] <strcat> if it's just moveable they can't
[14:21:25] *** Quits: seth__ (seth@moz-99690620.hinet-ip.hinet.net) (Input/output error)
[14:21:55] <dbaupp> strcat: yes it is
[14:22:02] <dbaupp> (copyable)
[14:22:10] <strcat> oh and we're not using the memset intrinsic :(
[14:22:13] <strcat> will deal with that later
[14:22:15] <strcat> dbaupp: aw that sucks
[14:22:21] <strcat> dbaupp: can you return an & reference to it?
[14:22:23] <strcat> in a getter
[14:22:44] <dbaupp> a getter on TaggedSymbol?
[14:22:47] <dbaupp> that would work
[14:23:02] <dbaupp> maybe...
[14:23:24] <dbaupp> except I can `copy` out of lifetimes, can't I? (Or is that disallowed?)
[14:23:26] *** Joins: hjr3 (hradtke@moz-AE3056B9.static.stls.mo.charter.com)
[14:23:58] <strcat> dbaupp: yes :(
[14:24:03] * strcat shrugs
[14:24:16] <dbaupp> eurgh... documentation warnings it is
[14:24:28] <strcat> dbaupp: just make an unsafe getter
[14:24:29] *** Quits: hjr3 (hradtke@moz-AE3056B9.static.stls.mo.charter.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[14:24:44] <kimundi> would using a closure helz?
[14:25:09] <kimundi> do with_dload(...) |...| {...}
[14:25:57] <dbaupp> kimundi: not really... I need the library to exist for the entire syntax expansion phase
[14:26:18] <dbaupp> since it can be called into at any point
[14:26:50] <dbaupp> so the general solution is making sure the things pulled out of the library don't outlive it
[14:26:59] <bjz> nmatsakis: how might I get this to work? https://gist.github.com/bjz/7d8432f8b658363a0192
[14:27:10] <dbaupp> but that seems to be actually impossible :(
[14:27:22] <bjz> nmatsakis: I'd like to do it without copyin, hopefully
[14:27:24] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[14:27:30] <bjz> nmatsakis: *copying
[14:27:38] <kimundi> dbaupp: What exactly 
[14:27:43] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[14:27:47] <kimundi> can get 'pulled' out of it?
[14:27:58] <dbaupp> kimundi: arbitrary symbols
[14:28:04] <dbaupp> e.g. functions
[14:28:20] <dbaupp> (global variables and constants too, I think)
[14:28:27] <kimundi> Do they have to be pulled out of it?
[14:28:31] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[14:29:00] <dbaupp> yes
[14:29:03] <dbaupp> well, no
[14:29:30] <dbaupp> but that would require moving the whole syntax expansion phase into callbacks on the library loading phase
[14:29:57] <strcat> dbaupp: they can copy it out anyway
[14:30:00] <strcat> if you ever pass it to them
[14:30:10] <dbaupp> kimundi: i.e. `dlload(|..| dlload(|..| syntax expand))`
[14:30:19] <strcat> dbaupp: talk to nmatsakis or pcwalton later (or I will if you aren't around)
[14:30:23] <strcat> extern fn should be &
[14:30:26] <strcat> usually 'static
[14:30:35] <dbaupp> strcat: yeah, that would be very nice
[14:30:54] <strcat> all existing uses can be &'static extern fn
[14:30:59] *** Joins: lmandel (lmandel@F2D29657.F60B0462.67AC9B1.IP)
[14:31:16] <dbaupp> kimundi: (this lifetime problem really should be solved in general, since it seems very feasible, and would make things more flexible)
[14:31:25] *** Joins: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de)
[14:31:28] <strcat> anyway align time ;p
[14:31:43] *** Joins: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP)
[14:31:46] * strcat wants inlined SSE/AVX copies! ;p
[14:31:48] *** Quits: victorporof (victorporo@moz-23D6B301.info.uaic.ro) (Ping timeout)
[14:32:04] <bjz> strcat: any ideas? https://gist.github.com/bjz/7d8432f8b658363a0192
[14:32:25] <dbaupp> bjz: put a lifetime on the actual &self pointer
[14:32:38] <strcat> bjz: you don't want 'self
[14:32:46] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[14:32:47] <strcat> 'self only means lifetime of contained borrowed ptrs
[14:33:00] <dbaupp> bjz: i.e. fn index<'r>(&'r self, ..) -> &'r Vec4<T> { ... &'r ... }
[14:33:54] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[14:35:42] <bjz> dbaupp: do I need to declare the lifetime at the top of the impl?
[14:35:43] <bjz> https://gist.github.com/bjz/7d8432f8b658363a0192
[14:35:56] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[14:36:30] *** Quits: sankha93 (Instantbir@EA2D262B.E0248F56.616A18A6.IP) (Ping timeout)
[14:36:35] <dbaupp> bjz: yes, the self one you had there before was correct
[14:36:36] <dbaupp> :)
[14:36:39] <dbaupp> (I think)
[14:36:57] *** Quits: hansjorg (hansjorg@moz-EECB5F79.static.cust.telenor.com) (Quit: Leaving.)
[14:37:00] *** Quits: xazax (Mibbit@6655692F.3B222813.3F580572.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[14:38:23] <benh> rusti :(
[14:38:29] *** Quits: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de) (Ping timeout)
[14:38:34] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[14:38:38] <bjz> updated: https://gist.github.com/bjz/7d8432f8b658363a0192
[14:38:42] <bjz> dbaupp ^
[14:39:12] <EXetoC> I must've done something wrong then. I though Index didn't accept references
[14:39:17] <dbaupp> strcat: that seems to save me from my errors before, so I'll go with that for now
[14:39:42] * strcat is excited about a potentially fast swap now
[14:39:42] <dbaupp> *errors from before
[14:39:45] <strcat> lets see if it works
[14:39:52] <dbaupp> bjz: no idea :S
[14:39:53] <benh> Do you think Option<SomeFlatEnum> could be optimized to merge the tag fields...?
[14:39:55] *** Quits: z0w0 (zack@moz-42FD6E2C.lns6.woo.bigpond.net.au) (Quit: Leaving.)
[14:40:18] *** Joins: samnardoni (samnardoni@moz-ECB14881.cable.virginmedia.com)
[14:40:19] *** Joins: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com)
[14:40:47] <dbaupp> benh: Option<value with less than 2^31/2^63 bits> could be optimised to do that
[14:40:52] <dbaupp> that'd be pretty neat
[14:44:27] <bjz> nmatsakis: if you get this later, I revised the gist a few times. This is what I had originally: https://gist.github.com/bjz/7d8432f8b658363a0192/1309178a14f3c532bc3a8473128b333fc2c5eb7d
[14:44:28] * strcat still hasn't gotten over how awesome Option<[&|~|@]T> is now ;p
[14:44:35] <kimundi> There are a lot of oportunities there
[14:44:46] <strcat> hm
[14:44:55] <strcat> I wonder if intrinsics are cdecl
[14:45:00] <strcat> that would mean I could just pass extra params
[14:45:01] *** Joins: mib_v7gyg0 (Mibbit@moz-9EC0DE5.fibertel.com.ar)
[14:45:04] <strcat> would save a lot of stage work
[14:45:12] * strcat guesses no ;p
[14:45:18] <dbaupp> strcat: rust intrinsics?
[14:45:20] <strcat> yes
[14:45:26] <kimundi> Option<char>, Option<u32> on x64, Option<u16> etc...
[14:45:34] <strcat> call it x86_64 ;p
[14:45:37] <strcat> x32 is a different arch than x86
[14:45:39] <dbaupp> most of them map straight to LLVM intrinsics, don't they?
[14:45:49] <strcat> dbaupp: yeah
[14:45:51] *** Quits: mib_v7gyg0 (Mibbit@moz-9EC0DE5.fibertel.com.ar) (Quit: http://www.mibbit.com ajax IRC Client)
[14:46:03] <dbaupp> strcat: '86_' is just so hard to type though :P
[14:46:12] <strcat> AMD64 ;p
[14:46:15] <strcat> the original name
[14:46:31] <kimundi> meh, I just go with 1000000
[14:46:33] <dbaupp> but what we actually want here is 64-bit
[14:46:36] <bjz> rusti: enum Maybe<T> { Just(T), Nothing } (sys::size_of::<Maybe<int>>(), sys::size_of::<Maybe<~int>>())
[14:46:44] <dbaupp> since, arm64 could still do that optimisation
[14:47:00] <dbaupp> bjz: rusti's dead :'(
[14:47:03] <bjz> :(
[14:47:38] <strcat> wat
[14:47:39] <strcat> sec
[14:47:47] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[14:47:52] <strcat> rusti: 5
[14:47:53] -rusti- 5
[14:47:54] <dbaupp> rusti: lives
[14:47:56] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/EbDK
[14:48:01] <strcat> rusti: 5
[14:48:02] -rusti- 5
[14:48:03] <strcat> rusti: 5
[14:48:04] -rusti- 5
[14:48:05] <strcat> rusti: 5
[14:48:06] -rusti- 5
[14:48:36] <strcat> rusti: unsafe { *(0 as *int) }
[14:48:37] -rusti- /usr/local/bin/rust.sh: line 21:    13 Segmentation fault      (core dumped) ./foo
[14:48:54] * strcat is going to replace lxc soon :)
[14:49:02] <strcat> I almost reinvented it with a quick hack in C
[14:49:10] <bjz> rusti: enum Maybe<T> { Just(T), Nothing } (sys::size_of::<Maybe<int>>(), sys::size_of::<Maybe<~int>>())
[14:49:12] -rusti- (16, 8)
[14:49:20] <bjz> neat
[14:49:35] <dbaupp> rusti: sys::size_of::<Either<(), ~int>>()
[14:49:37] -rusti- 8
[14:49:49] <bjz> rusti: enum Maybe<T> { Just(T), Nothing, Nothing2 } (sys::size_of::<Maybe<int>>(), sys::size_of::<Maybe<~int>>())
[14:49:51] -rusti- (16, 16)
[14:49:52] <dbaupp> strcat: replace with?
[14:50:14] <EXetoC> rusti: sys::size_of::<()>()
[14:50:16] -rusti- 0
[14:50:24] <strcat> dbaupp: http://ix.io/5LW playpen.c
[14:50:36] <strcat> it needs a COW or read-only mounted / and some tmpfs mounts though
[14:50:57] *** Quits: Palmik (palmik@moz-EFC3356B.vpn.muni.cz) (Ping timeout)
[14:51:00] <bjz> rusti: enum Maybe<T> { Just(T), Nothing } sys::size_of::<Maybe<()>>()
[14:51:01] -rusti- 8
[14:51:07] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[14:51:28] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[14:51:31] <strcat> and I need to do a proper timeout with signalfd/timerfd
[14:51:34] <strcat> instead of a signal.
[14:51:36] <strcat> so it can be a lib
[14:51:54] <strcat> well it will be a signal but not horrid SIGALRM ;p
[14:52:08] <strcat> can just signalfd the SIGCHLD
[14:52:10] <strcat> I think
[14:52:16] * strcat hates signals
[14:52:19] <strcat> makes my brain hurt
[14:52:48] <dbaupp> write it in Rust? ;)
[14:52:58] <strcat> dbaupp: well can't really
[14:53:00] <bjz> rusti: enum Maybe<T> { Just(T), Nothing, Nothing2 } sys::size_of::<Maybe<()>>()
[14:53:01] -rusti- 8
[14:53:05] <dbaupp> yeah, I've never really got the hang of safe-signalling
[14:53:08] <strcat> dbaupp: I don't want to teach rust to do syscalls
[14:53:09] <zxcdw> if I want to have a generic impl for some struct foo<T>, how come something like "impl foo<T> { fn bar<T>() ->() {}.. }" doesn't work? How should I go about something like this?
[14:53:12] <strcat>     int pid = syscall(__NR_clone,
[14:53:13] *** Joins: spider-mario (spidermari@moz-2F72F6FF.dsl.quantic-telecom.net)
[14:53:13] <strcat>                       SIGCHLD|CLONE_NEWIPC|CLONE_NEWNS|CLONE_NEWPID|CLONE_NEWUTS|CLONE_NEWNET,
[14:53:15] <strcat>                       NULL);
[14:53:19] <dbaupp> strcat: ah
[14:53:24] <strcat> you can't do that via fork or pthread
[14:53:33] <dbaupp> there's asm!(...) ?
[14:53:36] <strcat> dbaupp: bit of trivia: processes and threads are the same on linux
[14:53:43] <bjz> zxcdw: impl<T> foo<T> { fn bar<T>() ->() {}.. }
[14:53:44] *** Joins: Palmik (palmik@moz-80A68683.vpn.muni.cz)
[14:53:47] *** Joins: jdm (jdm@DB05BBF2.BB1F48F2.971E19F6.IP)
[14:53:51] <bjz> oh wait
[14:53:53] <strcat> the only difference is CLONE_VM (whether it shares address space or copies-on-write)
[14:53:58] <bjz> zxcdw: impl<T> foo<T> { fn bar() ->() {}.. }
[14:54:03] <strcat> the parent can pass in a stack though.
[14:54:24] <strcat> CLONE_NEW{IPC,NS,PID,UTS,NET} are namespaces
[14:54:31] <strcat> makes it have a private /proc, etc.
[14:54:51] <strcat> then it chroots and limits syscalls to a whitelist and setuids
[14:55:00] <strcat> + it limits memory usage with the cgroup ;)
[14:55:06] <strcat> I could limit cpu shares too.
[14:56:44] <dbaupp> oh, that is neat! (threads = processes)
[14:57:13] <dbaupp> it's still running in the VM, though?
[14:57:20] <strcat> dbaupp: it won't be.
[14:57:31] <dbaupp> it'll be safe?
[14:57:45] <strcat> modulo local root exploits in a list of a 2 dozen whitelisted syscalls
[14:57:50] <strcat> and I can whitelist allowed parameters
[14:57:57] <strcat> but anyway
[14:58:00] <zxcdw> bjz: Thanks, let's see :)
[14:58:07] <strcat> I can use CLONE_NEWUID once they make it solid ;p
[14:59:45] <zxcdw> Yep, seems to work. Why does it require <T> twice in the impl though?
[15:00:12] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[15:00:13] <zxcdw> impl<T> denotes generic impl or so and foo<T> is the type?
[15:01:14] <strcat> zxcdw: Foo<T> is the type
[15:01:14] *** Quits: haard (fredrik@18E6EC45.6A26450D.BE04C429.IP) (Ping timeout)
[15:01:27] <strcat> impl<T, U: Bar + Baz> is for declaring the types and their bounds
[15:04:15] <dbaupp> zxcdw: you need to declare the generics otherwise Rust thinks the `T` is a concrete type, e.g. impl foo<uint> is declaring functions that act on foo<uint>, not ones where the type parameter is a generic with name 'uint'
[15:08:37] *** Joins: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr)
[15:12:16] *** Joins: lkuper (lkuper@A4850EC3.D3FA0837.51B6877.IP)
[15:13:14] *** Joins: doener (doener@moz-121949B3.unitymediagroup.de)
[15:15:23] <strcat> dbaupp: well it's compiling now
[15:15:24] <strcat> ;]
[15:15:50] *** Quits: dbaupp (Thunderbir@moz-C83F6225.lns20.syd6.internode.on.net) (Ping timeout)
[15:17:18] <strcat> /home/strcat/projects/rust/src/libstd/ptr.rs:115:4: 115:35 error: use of undeclared module `unstable::intrinsics`
[15:17:20] <strcat> /home/strcat/projects/rust/src/libstd/ptr.rs:115     unstable::intrinsics::memmove32(dst as *mut u8, src as *u8, size as u32);
[15:17:23] <strcat> ;\
[15:17:27] <strcat> oh whoops
[15:18:17] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Ping timeout)
[15:18:35] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[15:18:49] <nmatsakis> bjz: pong
[15:19:15] *** Joins: dbaupp (Thunderbir@moz-55402325.lns20.syd6.internode.on.net)
[15:19:19] <bjz> nmatsakis: hoyhoy
[15:21:09] <dbaupp> strcat: nice :)
[15:21:16] <dbaupp> this is the alignment stuff, right?
[15:21:18] <strcat> bit of a PITA
[15:21:19] <strcat> dbaupp: yes
[15:21:25] <strcat> I want my perfect swap IR
[15:21:31] <strcat> and SSE/AVX copies inlined 
[15:21:56] *** Joins: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de)
[15:22:12] <bjz> nmatsakis: https://gist.github.com/bjz/7d8432f8b658363a0192/1309178a14f3c532bc3a8473128b333fc2c5eb7d
[15:22:18] <bjz> nmatsakis: :S
[15:22:33] <dbaupp> strcat: heh
[15:22:51] <nmatsakis> bjz: gonna need a bit more context :)
[15:23:04] <nmatsakis> bjz: oh, the code is below
[15:23:11] <bjz> bjz: hehe, yep
[15:23:34] *** kimundi is now known as zz_kimundi
[15:23:37] * bjz talks to himself by accident and hopes nobody noticed
[15:23:50] * erickt saw nothing
[15:23:54] <dbaupp> dbaupp: don't worry, we didn't
[15:24:09] <strcat> dbaupp: it's going to be awesome :)
[15:24:42] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[15:24:49] <strcat> https://github.com/thestinger/rust/commit/374293a339ad6114a7ca32e594c48f663ff1d3bc anyway round two of making swap fast
[15:24:50] <nmatsakis> bjz: so I think that the Index trait is probably just not setup correctly.
[15:24:56] <nmatsakis> bjz: however, I think we can force it into working for you
[15:25:07] <strcat> ugh something failed.
[15:25:08] <nmatsakis> bjz: let me try and make a minimal example
[15:25:16] <nmatsakis> bjz: I will also make an example of how I think it should work
[15:25:25] <nmatsakis> bjz: then we can float the issue at a meeting and get peoples' opinions
[15:25:29] <bjz> nmatsakis: oh neat
[15:25:38] <bjz> nmatsakis: only if you have time though
[15:25:41] <nmatsakis> bjz: because what I think you are trying to do is basically what everyone will try to do
[15:25:44] <nmatsakis> bjz: shouldn't take long, gimme a sec
[15:26:46] <strcat> rustc: /home/rustbuild/src/rust-buildbot/slave/snap3-linux/build/src/rt/rust_exchange_alloc.cpp:33: void* rust_exchange_alloc::realloc(void*, size_t): Assertion `new_ptr' failed.
[15:26:48] <strcat> /bin/sh: line 1: 10519 Aborted                 (core dumped) x86_64-unknown-linux-gnu/stage0/bin/rustc --cfg stage0 -O --target=x86_64-unknown-linux-gnu -o x86_64-unknown-linux-gnu/stage0/lib/rustc/x86_64-unknown-linux-gnu/lib/libextra.so /home/strcat/projects/rust/src/libextra/std.rc
[15:26:49] <strcat> :|
[15:26:50] <dbaupp> strcat: looks pretty good! what's the IR look like?
[15:26:55] <strcat> dbaupp: failed ;\
[15:26:59] <strcat> somewhere early
[15:27:03] <strcat> maybe unrelated? :\
[15:27:04] <dbaupp> oh, didn't get far enough?
[15:27:07] <strcat> dbaupp: yeah...
[15:27:28] <strcat> damn that error is weird
[15:27:40] <strcat> I guess it's just going oom
[15:27:42] <strcat> lemme see
[15:28:01] <MaikKlein> what blog software/framework/ do you use for your blog?
[15:28:36] <strcat> ah yeah it was just going OOM, I am doing too much :)
[15:28:50] <dbaupp> MaikKlein: is that directed at someone in particular, or just in general?
[15:29:08] <MaikKlein> should be a general question :)
[15:29:36] <strcat> dbaupp: I wonder why I made it use more memory ;\
[15:30:41] *** Joins: Jesin (Jessin_@moz-A03A364F.cc.lehigh.edu)
[15:30:42] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[15:31:01] <dbaupp> strcat: :(
[15:31:12] <bstrie> hm, so I need some FFI advice here
[15:31:24] <samnardoni> how can I use libsyntax? `use syntax;` fails for me
[15:31:37] <dbaupp> samnardoni: 'extern mod syntax;'
[15:31:39] <strcat> samnardoni: 'use' is just to import names into a scope
[15:31:42] <bstrie> just updated bindgen and now it's turning arguments like `*c_int` into `*mut c_int`
[15:31:49] <strcat> bstrie: I reported that ;p
[15:31:54] <strcat> *foo is like &foo
[15:32:01] <samnardoni> ah, okay, thanks
[15:32:03] <bstrie> strcat: oh, so that's not intentional?
[15:32:08] *** Joins: seth__ (seth@5AAE35B2.5EFFC0B8.24454B25.IP)
[15:32:08] <strcat> bstrie: no I mean it is
[15:32:20] <strcat> I reported how it was incorrectly using * everywhere
[15:32:27] <strcat> dunno if it knows how to use const now
[15:32:41] <bstrie> strcat: okay, previously I was using ptr::null() to satisfy that argument, but I'm getting mutability errors. how should I handle that?
[15:32:48] <strcat> bstrie: ptr::mut_null()
[15:32:49] <strcat> I think
[15:32:55] <bstrie> will try
[15:33:06] <dbaupp> rusti: ptr::mut_null(
[15:33:09] -rusti- foo.rs:6:4: 6:5 error: incorrect close delimiter: `}`
[15:33:09] -rusti- foo.rs:6     });
[15:33:09] -rusti-              ^
[15:33:18] <dbaupp> rusti: ptr::mut_null()
[15:33:20] -rusti- error: internal compiler error: unexpected failure
[15:33:20] -rusti- note: the compiler hit an unexpected failure path. this is a bug
[15:33:20] -rusti- note: try running with RUST_LOG=rustc=1,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues
[15:33:23] <bstrie> strcat: that did it, thanks
[15:33:26] <strcat> dbaupp: :D
[15:33:43] <dbaupp> strcat: I keep meeting that bug :/
[15:33:47] <strcat> ugh why is rustc eating all my rams
[15:33:54] <dbaupp> follows me around
[15:34:39] *** Quits: KindOne (KindOne@moz-C06FCA05.dynamic.ip.windstream.net) (Ping timeout)
[15:34:45] <bstrie> strcat: perhaps rustc has been replaced with a yeti while nobody was looking
[15:34:50] *** Quits: seth__ (seth@5AAE35B2.5EFFC0B8.24454B25.IP) (Ping timeout)
[15:36:27] *** Quits: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk) (Client exited)
[15:36:47] <strcat> rustc --cfg stage0 works ;\
[15:36:49] <strcat> wat
[15:37:06] *** Quits: bytbox (s@moz-D83E9B31.wireless.umd.edu) (Ping timeout)
[15:38:49] *** Joins: KindOne (KindOne@moz-DEC9B4F1.dynamic.ip.windstream.net)
[15:39:49] <benh> mhm
[15:39:57] <benh> I just ended up with Option<Option<MyEnum>>
[15:40:03] <benh> sounds like it's time to go back to the drawing board
[15:40:20] *** Joins: bytbox (s@moz-2E27684C.student.umd.edu)
[15:41:09] <strcat> please work rustc
[15:41:11] <strcat> pleaase ;p
[15:41:44] <strcat> seems to fail linking...
[15:42:03] <bstrie> benh: please tell me that MyEnum is defined like `enum MyEnum<T> { Some(T), None }`
[15:42:28] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[15:42:58] <benh> not quite ;)
[15:43:39] *** zz_kimundi is now known as kimundi
[15:43:46] *** Joins: jeff (jeff@4231C034.745B261B.F12515B4.IP)
[15:44:22] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[15:44:36] *** Quits: pnkfelix (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net) (Quit: Leaving.)
[15:44:48] *** Quits: pnkfelix|rcirc (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net) (Quit: rcirc on GNU Emacs 24.2.1)
[15:45:12] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[15:46:56] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Ping timeout)
[15:47:52] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[15:47:54] *** Quits: jviereck (Adium@moz-BA1D85DC.dclient.hispeed.ch) (Quit: Leaving.)
[15:48:24] <nmatsakis> bjz: here is a way to do index trait today. https://gist.github.com/nikomatsakis/5644444
[15:48:33] <nmatsakis> bjz: you will see that it is somewhat inconvenient, but such is life.
[15:48:35] <strcat> ugh I don't understand this link error *at all* :(
[15:48:42] <nmatsakis> bjz: I'm writing up my proposal for a better way to do it
[15:50:09] * strcat makes a 32GiB swap file
[15:50:16] *** Quits: jgilbert (jgilbert@moz-99690620.hinet-ip.hinet.net) (Ping timeout)
[15:52:37] *** Quits: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP) (Client exited)
[15:52:45] *** Quits: jdm (jdm@DB05BBF2.BB1F48F2.971E19F6.IP) (Ping timeout)
[15:53:19] <doener> strcat: hm, why didn't you have to change the type check here? https://github.com/thestinger/rust/blob/374293a339ad6114a7ca32e594c48f663ff1d3bc/src/librustc/middle/typeck/check/mod.rs#L3553
[15:53:47] *** Joins: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP)
[15:54:19] <dbaupp> strcat: do you happen to have the issue about lifetimes on arbitrary types to hand?
[15:54:20] *** Quits: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP) (Client exited)
[15:54:21] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[15:54:22] *** Quits: igl1 (igl@moz-C416C1D2.adsl.alicedsl.de) (Ping timeout)
[15:56:57] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[15:56:58] <bjz> nmatsakis: hey, this works: https://gist.github.com/bjz/7d8432f8b658363a0192
[15:57:12] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[15:57:19] <strcat> dbaupp: hm?
[15:57:36] *** Joins: TempleD (TempleD@moz-EB752F3E.as43234.net)
[15:58:40] <dbaupp> strcat: you said you open an issue about putting lifetimes on types that don't contain any borrowed pointers
[15:58:59] *** Joins: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP)
[15:59:04] <strcat> dbaupp: oh whoops I forgot about that.
[15:59:52] *** Joins: tcsc (tcsc@moz-A838B260.dhcp.nwtn.ct.charter.com)
[15:59:53] *** Joins: jclements (jclements@2557E599.66715431.D25A875A.IP)
[16:00:44] <strcat> dbaupp: thanks :)
[16:01:19] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Quit: Computer has gone to sleep.)
[16:02:42] <benh> What does it mean to put a lifetime on a type without a borrowed pointer?
[16:02:51] <strcat> benh: doesn't work yet
[16:03:06] <strcat> dbaupp: https://github.com/mozilla/rust/issues/5922
[16:03:34] <dbaupp> strcat: thanks :)
[16:05:21] <nmatsakis> bjz: I have to read that carefully, but I think the transmute may be masking some "badness"
[16:07:28] *** Quits: reyre (reyre@5AAE35B2.5EFFC0B8.24454B25.IP) (Client exited)
[16:07:48] <strcat> copy_lifetime! ;p
[16:09:57] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[16:12:24] *** Joins: seth__ (seth@5AAE35B2.5EFFC0B8.24454B25.IP)
[16:13:39] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[16:15:29] *** Quits: lkuper (lkuper@A4850EC3.D3FA0837.51B6877.IP) (Ping timeout)
[16:15:47] *** Joins: lkuper (lkuper@A4850EC3.D3FA0837.51B6877.IP)
[16:16:13] *** Joins: mschifer (Adium@2557E599.66715431.D25A875A.IP)
[16:18:19] *** Quits: lkuper (lkuper@A4850EC3.D3FA0837.51B6877.IP) (Ping timeout)
[16:19:02] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[16:19:23] *** Quits: Diablo-D3 (diablo@moz-6317EE8A.port.east.myfairpoint.net) (Quit: This computer has gone to sleep)
[16:20:22] *** Quits: dbaupp (Thunderbir@moz-55402325.lns20.syd6.internode.on.net) (Ping timeout)
[16:20:37] *** Joins: Diablo-D3 (diablo@moz-6317EE8A.port.east.myfairpoint.net)
[16:21:57] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[16:22:04] *** Quits: KindOne (KindOne@moz-DEC9B4F1.dynamic.ip.windstream.net) (Ping timeout)
[16:22:15] <bjz> nmatsakis: ahh, yikes
[16:22:15] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[16:22:27] <strcat> 0. Running pass 'Function Pass Manager' on module 'std.rc'.
[16:22:29] <strcat> 1. Running pass 'Module Verifier' on function '@_ZN8unstable10intrinsics15memmove64_1402317_d1d491c6aa51fb796_07preE'
[16:22:31] <strcat> /bin/sh: line 1:  1214 Aborted                 (core dumped) x86_64-unknown-linux-gnu/stage1/bin/rustc --cfg stage1 -O -Z no-debug-borrows --target=x86_64-unknown-linux-gnu -o x86_64-unknown-linux-gnu/stage1/lib/rustc/x86_64-unknown-linux-gnu/lib/libstd.so /home/strcat/projects/rust/src/libstd/core.rc
[16:22:33] <strcat> ;p
[16:23:36] *** Joins: jviereck (Adium@moz-BA1D85DC.dclient.hispeed.ch)
[16:24:26] *** Joins: infynyxx_ (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[16:24:36] *** Quits: jeff (jeff@4231C034.745B261B.F12515B4.IP) (Quit: jeff)
[16:24:46] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[16:25:17] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Quit: Computer has gone to sleep.)
[16:25:21] <strcat> alignment argument of memory intrinsics must be a constant int
[16:25:23] <strcat>   call void @llvm.memmove.p0i8.p0i8.i64(i8* %2, i8* %3, i64 %4, i32 %5, i1 false)
[16:25:25] <strcat> ah.
[16:25:37] <strcat> well that sucks.
[16:26:03] <strcat> nmatsakis: any idea if I can workaround that without terrible hacks? ^
[16:26:20] *** Joins: KindOne (KindOne@moz-63BB1D38.dynamic.ip.windstream.net)
[16:26:28] <strcat> I'm using sys::min_align_of atm but I guess that's not an option
[16:29:00] *** Quits: tav_ (tav@moz-C8D2AC96.range86-145.btcentralplus.com) (Quit: tav_)
[16:29:04] <MaikKlein> is this code block also bugged in your browser? http://maik-elobeast.rhcloud.com/?p=1
[16:29:33] <strcat> yes
[16:29:44] <MaikKlein> hm
[16:30:55] *** Quits: trapni (trapni@moz-6A0EA166.dawanda.com) (Quit: Leaving)
[16:31:34] <friggle> strcat: I'm really confused as to why you're having to store the alignment in a register?
[16:31:48] <strcat> friggle: I don't have to
[16:31:56] <strcat> I have to pass alignment to memmove/memcpy
[16:32:04] <strcat> and rust currently doesn't have a way to get it as a constant
[16:32:08] <strcat> so I guess I have to add one
[16:32:39] *** Joins: BuferUnderpants (Mibbit@AE752D25.7442E47D.6A02C753.IP)
[16:33:02] <BuferUnderpants> Hi
[16:33:23] <friggle> strcat: yes, a way for the rust codegen to get hold of the alignment so it can put it as a constant in memmove rather than a register like your are in the code above
[16:33:25] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[16:33:25] <BuferUnderpants> I'm having an odd issue with rust-mode on Emacs
[16:33:38] <BuferUnderpants> (kinda trivial, I guess)
[16:34:48] <BuferUnderpants> Thing is, when I load the file, the buffer displays the text with the syntax highlighted, for an instant
[16:34:56] <BuferUnderpants> Then it goes away for all but strings
[16:35:45] *** Joins: judder (maradukewa@CF01B517.FDE2B133.950D3BB5.IP)
[16:36:27] <BuferUnderpants> Wait, it happens when whitespace-mode is activated
[16:36:28] <strcat> friggle: either way it's kind of a pain
[16:36:40] <strcat> I don't know how I'll expose memcpy/memmove now ;\
[16:37:50] *** Joins: reyre (reyre@5AAE35B2.5EFFC0B8.24454B25.IP)
[16:37:53] *** Joins: jdm (jdm@F2D29657.F60B0462.67AC9B1.IP)
[16:38:09] *** Joins: azita (Azita@2557E599.66715431.D25A875A.IP)
[16:38:16] *** Joins: FrozenCow (FrozenCow@moz-9DF5D010.dynamic.upc.nl)
[16:38:18] *** Quits: azita (Azita@2557E599.66715431.D25A875A.IP) (Quit: azita)
[16:38:29] <friggle> strcat: so the problem is you can't query the alignment of a type at compile time currently, only at runtime using min_align_of?
[16:38:33] *** Joins: azita (Azita@2557E599.66715431.D25A875A.IP)
[16:38:48] <strcat> friggle: regardless, I can't expose memcpy/memmove in the usual way if they require a constant argument, afaik
[16:39:42] <samnardoni> does libsyntax give any way of listing all functions that are valid to call from a crate? or know a way to do this?
[16:40:03] *** Joins: thomaslee_ (thomaslee@moz-6C3931E3.static.twtelecom.net)
[16:41:01] <samnardoni> s/crate/file
[16:42:02] *** Joins: sankha93 (Instantbir@5AEBC581.93C78442.8B6C1D65.IP)
[16:42:06] *** Quits: reyre (reyre@5AAE35B2.5EFFC0B8.24454B25.IP) (Connection reset by peer)
[16:42:13] *** Joins: reyre (reyre@5AAE35B2.5EFFC0B8.24454B25.IP)
[16:43:55] *** Quits: reyre (reyre@5AAE35B2.5EFFC0B8.24454B25.IP) (Ping timeout)
[16:44:01] *** Joins: bent (chatzilla@moz-932324BF.hsd1.ca.comcast.net)
[16:44:04] *** Quits: thomaslee_ (thomaslee@moz-6C3931E3.static.twtelecom.net) (Client exited)
[16:45:15] *** Joins: victorporof (victorporo@DE2B5DEF.67CDC207.79933D60.IP)
[16:46:33] *** Quits: mschifer (Adium@2557E599.66715431.D25A875A.IP) (Connection reset by peer)
[16:46:40] *** Joins: mschifer (Adium@2557E599.66715431.D25A875A.IP)
[16:49:23] <BuferUnderpants> How do I report a bug for the Emacs mode?
[16:49:24] *** Quits: mye (mye@moz-5E55807E.dip0.t-ipconnect.de) (Quit: mye)
[16:50:55] <BuferUnderpants> (or how should I? the guidelines in CONTRIBUTING don't seem to apply)
[16:50:56] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[16:51:06] *** Quits: chadz (uid979@moz-D8B63698.irccloud.com) (Ping timeout)
[16:51:23] *** Quits: geomyidae__ (uid214@moz-D8B63698.irccloud.com) (Ping timeout)
[16:51:23] *** Quits: jihyun (uid7128@moz-D8B63698.irccloud.com) (Ping timeout)
[16:51:23] <strcat> BuferUnderpants: yes you can report a bug for it
[16:53:41] *** Quits: wycats_ (uid79@moz-D8B63698.irccloud.com) (Ping timeout)
[16:55:19] *** Quits: bytbox (s@moz-2E27684C.student.umd.edu) (Ping timeout)
[16:56:05] <BuferUnderpants> Alright, done
[16:58:11] *** kimundi is now known as zz_kimundi
[16:58:43] *** zz_kimundi is now known as kimundi
[16:59:45] *** Joins: bytbox (s@moz-D83E9B31.wireless.umd.edu)
[17:00:10] *** Joins: jeff (jeff@4231C034.745B261B.F12515B4.IP)
[17:00:18] *** Quits: KindOne (KindOne@moz-63BB1D38.dynamic.ip.windstream.net) (Ping timeout)
[17:00:40] *** Quits: Jesin (Jessin_@moz-A03A364F.cc.lehigh.edu) (Quit: Leaving)
[17:01:52] *** Joins: pragma (Mibbit@moz-C6636C88.adsl.alicedsl.de)
[17:04:06] *** Quits: Diablo-D3 (diablo@moz-6317EE8A.port.east.myfairpoint.net) (Quit: do coders dream of sheep()?)
[17:04:11] *** Quits: infynyxx_ (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[17:04:17] *** Joins: KindOne (KindOne@moz-D226F56E.dynamic.ip.windstream.net)
[17:04:19] *** Joins: Diablo-D3 (diablo@moz-6317EE8A.port.east.myfairpoint.net)
[17:04:31] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[17:04:36] <pragma> hey I'm just going through the rust tutorial. and i'm  not sure what this info! macro does. it does not produce any output and its not explained in the tutorial.
[17:06:03] <doener> pragma: logging is enable at runtime by setting the RUST_LOG env var. See http://static.rust-lang.org/doc/rust.html#logging-system
[17:06:11] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[17:06:51] <pragma> ah ok thx :)
[17:07:27] *** Quits: zxcdw (r-a@moz-C7C5467B.cust.bredband2.com) (Client exited)
[17:07:35] *** Joins: graydon (Adium@A5087023.2354C43D.D8E68FF6.IP)
[17:07:35] *** ChanServ sets mode: +qo graydon graydon
[17:09:06] *** Quits: KindOne (KindOne@moz-D226F56E.dynamic.ip.windstream.net) (Ping timeout)
[17:09:07] *** Quits: jviereck (Adium@moz-BA1D85DC.dclient.hispeed.ch) (Quit: Leaving.)
[17:10:42] <strcat> graydon: would it be okay to make a compile-time alignof? I need it to be able to call the memcpy/memmove intrinsic with a non-zero alignment :s
[17:10:49] <strcat> LLVM expects a constant
[17:11:03] <strcat> seems that ghc uses some horrific early const eval pass
[17:11:04] <graydon> how would you do it?
[17:11:20] <strcat> graydon: not sure. can syntax extensions know types? fmt! seems to
[17:11:23] <graydon> sizeof, alignof and offsetof all seem valuable; I just don't know how to do them, exactly
[17:11:33] <graydon> fmt! does not know types
[17:11:41] <strcat> ah it just expands and then that type checks
[17:11:43] <graydon> it turns a format string into a set of obligations-on-types
[17:11:46] <graydon> yeah
[17:12:05] * strcat has being micro-optimizing swap ;p
[17:12:08] <graydon> I think it requires new nodes in the type grammar or something
[17:12:21] *** Quits: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP) (Client exited)
[17:12:29] <graydon> sizeof(T), alignof(T), offsetof(field,T), or such
[17:12:29] <strcat> if only swap was still built-in ;p
[17:12:33] <graydon> which seems weird, but ..
[17:12:46] <strcat> I could just add a swap intrinsic too, I guess
[17:12:52] <graydon> or, oh, that's what we were going to do, I remember now
[17:13:12] <strcat> oh maybe I can just call the size_of intrinsic
[17:13:13] *** Joins: KindOne (KindOne@moz-F43DF4E.dynamic.ip.windstream.net)
[17:13:20] <strcat> align of*
[17:13:36] <graydon> we were going to add 3 new lang items (sizeof, alignof, offsetof) and say that calls to them are defined-as part of the constant-expression grammar
[17:13:51] <graydon> or, I guess, intrinsics, not lang items
[17:13:53] <graydon> yeah
[17:14:06] <graydon> but that they can occur in constant-expr context, unlike any other function call
[17:14:21] <strcat> graydon: http://hackage.haskell.org/trac/ghc/ticket/6158 ;p
[17:14:27] <strcat> '-optlo-constprop -optlo-O3
[17:14:30] <strcat> such a horrible hack
[17:14:36] <graydon> most other things you'd want to write in constexpr form require nontrivial evaluation
[17:14:38] <strcat> I wonder how that manages to work
[17:14:57] <strcat> seems like that means it can't compile without optimization... wat
[17:15:38] <graydon> I mean, in C they're called "macros" but obviously not implemented by the preprocessor..
[17:15:47] <strcat> graydon: I think they're actually 'operators' in C
[17:16:00] <graydon> oh, offsetof is a "macro", sorry
[17:16:05] <graydon> maybe it actually is a macro
[17:16:16] *** Quits: sankha93 (Instantbir@5AEBC581.93C78442.8B6C1D65.IP) (Ping timeout)
[17:16:26] *** Quits: BuferUnderpants (Mibbit@AE752D25.7442E47D.6A02C753.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[17:16:49] <graydon> #define offsetof(st, m) ((size_t)(&((st *)0)->m))
[17:16:50] <graydon> huh!
[17:17:03] <graydon> clever, clever
[17:19:43] *** Quits: paulproteus (quassel@rose.makesad.us) (Ping timeout)
[17:20:17] <graydon> http://golang.org/ref/spec#Constants they just go with "there are 3 build in functions that are legal in constant expressions"
[17:21:03] *** Joins: paulproteus (quassel@moz-E86A3B42.makesad.us)
[17:21:18] *** Joins: sankha93 (Instantbir@5AEBC581.93C78442.8B6C1D65.IP)
[17:21:40] *** Joins: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net)
[17:22:18] <nmatsakis> graydon: offsetof cannot just be a function.
[17:22:37] <graydon> syntactically, it can
[17:22:37] <nmatsakis> graydon: in particular, it needs to be able to refer to field names "in abstract" and so forth
[17:22:40] <nmatsakis> no, it can't
[17:22:43] <graydon> offsetof(x.y)
[17:22:48] <nmatsakis> what is x and y?
[17:23:01] <nmatsakis> typically it is used like:
[17:23:03] <nmatsakis> offsetof(Type, fieldName)
[17:23:04] <graydon> offsetof<T>(T)
[17:23:20] <nmatsakis> imagine: struct Foo { a: uint, b: uint }
[17:23:20] <graydon> compiler complains if you pass anything other than a record.field expression
[17:23:38] <nmatsakis> so you have to gin up an instance of a struct?
[17:23:50] <nmatsakis> basically that is not a function
[17:23:53] <nmatsakis> that is a special form
[17:24:01] <graydon> guess so? another option is offsetof<T>("field")
[17:24:02] <nmatsakis> no other function in the world cares about the literal syntax of its arguments
[17:24:24] <strcat> right now all I want is alignof ;p
[17:24:27] <nmatsakis> (including our intrinsics, which are translated to actual LLVM functions)
[17:24:34] <nmatsakis> but yes sizeof and alignof is fine...
[17:24:43] <strcat> all our memset/memmove calls from ptr use align 1
[17:25:13] *** Quits: CarpNet (ac@moz-FD24B77.sohonet.co.uk) (Quit: Leaving)
[17:25:21] <strcat> I guess I could just make the intrinsics use a generic type
[17:25:23] <graydon> nmatsakis: I was just going off http://golang.org/ref/spec#Package_unsafe , but any representation that makes sense is fine by me
[17:25:32] <graydon> it's true we don't have a "selector" type
[17:25:49] <strcat> maybe that's a sane workaround for now...
[17:25:59] *** Quits: sk (sk@5F3B8500.CB2CB346.78DD174B.IP) (Input/output error)
[17:26:02] <nmatsakis> graydon: I mean we could always define a macro, just as C does :)
[17:26:04] *** Joins: jviereck (Adium@moz-BA1D85DC.dclient.hispeed.ch)
[17:26:29] <graydon> nmatsakis: I guess, sure
[17:26:34] <nmatsakis> graydon: it could even work in constant expressions, I think.
[17:27:25] <strcat> alignof/sizeof seem like they could be associated consts for all types
[17:27:27] <SiegeLord> Couldn't you make all these things "associated constants"?
[17:27:29] <strcat> T::align
[17:27:30] <graydon> unsafe { (((&(*((0 as *T).field)) as *c_void) as uint) } ?
[17:27:38] <strcat> SiegeLord: heh :)
[17:28:01] <graydon> SiegeLord: fair point. also reasonable. I think that's how Ada does them
[17:28:02] <nmatsakis> graydon: basically yeah
[17:28:29] <graydon> https://en.wikibooks.org/wiki/Ada_Programming/Attributes
[17:28:38] <benh> T::offsetof!(fieldname) ;)
[17:29:37] <graydon> I would be ok reserving some built-in associated constants. especially if we can namespace them.
[17:29:44] <strcat> yeah that hack is going to work
[17:29:50] *** Joins: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP)
[17:29:50] *** ChanServ sets mode: +o pcwalton
[17:33:52] *** Quits: solancile (solancile@moz-A1CFFAE5.hsd1.wa.comcast.net) (Quit: Leaving)
[17:34:05] *** Quits: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de) (Ping timeout)
[17:34:35] *** Joins: dcamp_ (dcamp@moz-930D5B64.hsd1.wa.comcast.net)
[17:38:51] <pcwalton> ahaha
[17:38:57] <pcwalton> /// Archimedes' staticant
[17:39:05] <pcwalton> "const" -> "static" renaming went awry
[17:39:10] <strcat> :)
[17:39:13] <sp3d> clbuttic
[17:39:28] <jdm> *whoosh*
[17:41:10] <strcat> pcwalton: do you think it would be sane to make the memcpy/memmove intrinsics higher-level-ish? I want to pass the proper alignment along, but it needs to be a constant so... I think for now it would mean something like 'memcpy32<T>(dst: *mut T, src: *T, count: u32)'
[17:41:38] <pcwalton> that seems OK to me
[17:42:44] <strcat> swaps no longer have a branch on equality at least :)
[17:42:59] <strcat> just needs to get the alignment set right instead of 1 and it will output the same IR as clang
[17:43:34] <pcwalton> oh, what effect does the alignment have on the generated code?
[17:43:48] <strcat> pcwalton: lets it use SSE, etc.
[17:43:52] <strcat> inline
[17:43:54] <pcwalton> ah, I see
[17:44:10] <pcwalton> do we always pass 1 right now for all memcpys in trans?
[17:44:35] <strcat> pcwalton: well for all the ones done via the intrinsic (which actually didn't exist before yesterday, we only had memmove)
[17:44:39] <pcwalton> ah
[17:45:02] <pcwalton> yeah, I thought we were generating SSE in many cases already
[17:45:04] <pcwalton> but not for the intrinsic
[17:46:00] <strcat> pcwalton: http://ix.io/5Mi here's what we make now for swapping two ints
[17:46:15] <strcat> http://ix.io/5Mo clang manages that though
[17:46:17] <pcwalton> yeah, that's not good
[17:46:27] <strcat> pcwalton: it was worse before my PR landed yesterday
[17:46:29] <strcat> we had a branch on equality
[17:46:42] <strcat> because it a) explicitly compared equality and b) used memmove
[17:46:54] <strcat> oh well ;p
[17:47:43] <strcat> pcwalton: comparing without optimization shows why clang is so fast in comparison...
[17:47:54] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[17:48:05] <strcat> so much IR gets generated for this ;\
[17:48:22] <strcat> http://ix.io/5Ms -> http://ix.io/5Mt at -O0
[17:48:38] <pcwalton> whoa
[17:48:56] <pcwalton> that looks like some things I've seen in rustc ;)
[17:48:59] *** Quits: jeff (jeff@4231C034.745B261B.F12515B4.IP) (Quit: jeff)
[17:49:06] <strcat> pcwalton: that's clang
[17:49:10] <pcwalton> yeah
[17:49:14] *** Quits: seth__ (seth@5AAE35B2.5EFFC0B8.24454B25.IP) (Input/output error)
[17:49:41] <strcat> pcwalton: http://ix.io/5Mv us at -O0 (pre-PR rustc, so it has that branch)
[17:49:43] *** Quits: pragma (Mibbit@moz-C6636C88.adsl.alicedsl.de) (Quit: http://www.mibbit.com ajax IRC Client)
[17:49:57] <strcat> it's almost identical to clang post-optimization... except the aligns
[17:50:10] <strcat> but yeah that's why LLVM passes take so long ;p
[17:50:15] *** Quits: sankha93 (Instantbir@5AEBC581.93C78442.8B6C1D65.IP) (Ping timeout)
[17:50:40] *** Joins: sankha93 (Instantbir@5AEBC581.93C78442.8B6C1D65.IP)
[17:50:41] *** Joins: jeff (jeff@4231C034.745B261B.F12515B4.IP)
[17:52:48] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[17:52:57] *** Joins: brson (brson@2557E599.66715431.D25A875A.IP)
[17:52:57] *** ChanServ sets mode: +o brson
[17:53:42] *** Quits: jviereck (Adium@moz-BA1D85DC.dclient.hispeed.ch) (Quit: Leaving.)
[17:54:09] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[17:56:20] *** Joins: dherman (dherman@2557E599.66715431.D25A875A.IP)
[17:56:20] *** ChanServ sets mode: +o dherman
[17:57:18] *** Quits: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP) (Ping timeout)
[17:57:42] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[17:57:42] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/vSKY1w
[17:57:42] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[17:57:46] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[17:57:46] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/kb3jdw
[17:57:46] <ghrust> 13rust/06auto 14d2ee43d 15Patrick Walton: librustc: Redo the unsafe checker and make unsafe methods not callable from safe code
[17:57:46] <ghrust> 13rust/06auto 14fb7c1b3 15bors: auto merge of #6708 : pcwalton/rust/unsafe-checking, r=nikomatsakis...
[17:57:47] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[18:01:34] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Quit: eatkinson)
[18:01:38] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[18:02:25] *** Quits: KindOne (KindOne@moz-F43DF4E.dynamic.ip.windstream.net) (Ping timeout)
[18:02:57] *** Quits: saml (sam@moz-14C16814.cst.lightpath.net) (Quit: Leaving)
[18:03:29] *** Quits: jeff (jeff@4231C034.745B261B.F12515B4.IP) (Quit: jeff)
[18:05:36] *** Joins: catpig (catpig@moz-F50E4A6A.dip0.t-ipconnect.de)
[18:06:33] <benh> for [(1, 2)].each do |&(a, b)| {} style irrefutable pattern matching is still broken, right?
[18:07:30] <doener> rusti: for [(1, 2)].each |&(a, b)| { println(fmt!("%u %u", a, b)) }
[18:07:37] -rusti- 1 2
[18:07:39] <bjz> pcwalton: oh yes, I think we found that stray rename a while back, never got around to fixing it though
[18:07:48] <graydon> so um
[18:07:55] <graydon> when you run RUST_LOG=? rustc ... 
[18:07:58] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[18:08:00] <benh> gosh, I'll have to dig out the weird types it gave me an error on again
[18:08:05] <graydon> it displays a log map that does not include anything from core
[18:08:14] <bjz> pcwalton: part of thinks we should keep it for the amusement :)
[18:08:14] <graydon> (this is before the core->std rename, I'm on a branch)
[18:08:23] <graydon> does anyone know how to make core logging work?
[18:08:24] <pcwalton> I fixed it in the patch I'm working on
[18:08:33] <bjz> coolie
[18:10:09] *** Joins: tumdum (tumdum@moz-6A664A5A.neoplus.adsl.tpnet.pl)
[18:10:39] *** Joins: tikue (tkuehn@2557E599.66715431.D25A875A.IP)
[18:11:23] *** Quits: sankha93 (Instantbir@5AEBC581.93C78442.8B6C1D65.IP) (Ping timeout)
[18:11:27] <strcat> pcwalton: http://ix.io/5Mw/diff I'll see if this works :)
[18:12:54] *** Joins: sankha93 (Instantbir@5AEBC581.93C78442.8B6C1D65.IP)
[18:13:35] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[18:13:41] <Jeaye> erickt: I'd be up for meeting some time. I'm in Burlingame, but work in the city.
[18:13:42] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[18:13:53] *** kimundi is now known as zz_kimundi
[18:14:02] *** Quits: dherman (dherman@2557E599.66715431.D25A875A.IP) (Ping timeout)
[18:14:33] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[18:14:55] <graydon> I'm not imagining this, right? nobody else can set logging for anything in core?
[18:15:31] <bstrie> well that's curious, when I install luajit I get lines like "/sbin/ldconfig.real: File /usr/local/lib/librustdoc.so is empty, not checked."
[18:15:34] <bstrie> wonder why that is
[18:15:43] <graydon> it's a dummy file
[18:15:48] <bstrie> but, luajit
[18:15:52] <graydon> it runs ldconfig
[18:16:00] <strcat> I fixed that bug
[18:16:09] <bstrie> I guess I need to clean out my artifacts
[18:16:10] <strcat> it shouldn't install those anymore
[18:18:46] *** Joins: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de)
[18:19:11] <MaikKlein> how can I send one message to 10 tasks?
[18:19:34] <MaikKlein> I tried it with PortSet but I am not sure if this is the right way.
[18:19:59] *** Quits: bnicholson_ (bnicholson@moz-E98974C1.hsd1.ca.comcast.net) (Ping timeout)
[18:20:30] *** Quits: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net) (Ping timeout)
[18:21:03] <benh> error: mismatched types: expected `std::option::Option<[type error]>` but [...]
[18:21:05] <benh> well then
[18:21:34] <bstrie> benh: apparently the compiler expected you to fail
[18:21:44] <benh> I appreciate the vote of confidence :D
[18:21:48] <bstrie> the fact that you did not itself constitutes a failure
[18:22:20] <bstrie> MaikKlein: what is portset supposed to do?
[18:22:31] <strcat> rusti: 5
[18:22:35] -rusti- 5
[18:23:21] <strcat> benh: is that with incoming?
[18:23:25] <brson> graydon: I think there's a limit to the number of paths the logging code will initialize. maybe it never gets to core
[18:23:36] <benh> strcat: uh, give or take today's activity
[18:23:45] <graydon> guh
[18:23:54] <benh> strcat: commit 2f69bb9
[18:23:55] <graydon> logging allocates @ boxes
[18:24:02] <strcat> graydon: :(
[18:24:22] <strcat> everything allocates @ boxes apparently ;p
[18:24:23] <brson> graydon: max_log_directives = 255
[18:24:31] <bstrie> MaikKlein: does your code look resemble the example in https://github.com/mozilla/rust/blob/master/src/test/run-pass/task-comm-14.rs ?
[18:24:34] <brson> that's not a lot of log directives
[18:25:35] <graydon> why is there a max?
[18:25:57] <graydon> oh, that's directives though
[18:26:03] <brson> yeah, may not be applicable here
[18:26:05] <graydon> not map entries
[18:26:13] <bstrie> what does xfail-fast mean? just that the test doesn't run on windows?
[18:27:31] <benh> rusti: struct S; let mut x = None; match x { Some(S) => (), _ => () }; x = Some(S);
[18:27:33] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/dbfa
[18:27:34] <benh> strcat: ^
[18:27:40] *** Quits: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP) (Quit: Leaving)
[18:28:49] *** zz_kimundi is now known as kimundi
[18:29:32] <MaikKlein> @bstrie my code looks quite similar, unfortunately.  afaik the code creates 10 threads , earch thread sends out 1 message. then the messages are captured in the while loop right?
[18:30:22] <MaikKlein> but I want to broadcast one message to all threads
[18:30:35] <MaikKlein> is there something in the API that I can use?
[18:30:36] <graydon> I'm curious why we wind up in log_type though
[18:30:48] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[18:30:48] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[18:30:53] <graydon> woah. _all_ logging hits log_type, even if it's a str?
[18:31:10] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[18:31:11] <graydon> I guess the visitor is getting a good workout
[18:31:11] <brson> graydon: yep
[18:31:21] <graydon> does anyone log values that aren't str?
[18:31:25] <bstrie> MaikKlein: I'm not sure
[18:31:46] <graydon> (can't we tell users to write debug!("%?", obj) in that case?)
[18:31:47] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Connection reset by peer)
[18:31:50] <brson> graydon: I think all logging goes through fmt! *then* the polymorphic logging
[18:31:57] <novabyte> is anyone aware if there's activity on creating a Rust protocol buffers compiler implementation?
[18:31:57] <graydon> brson: yes, it does
[18:31:59] <graydon> that's amazing
[18:32:00] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[18:32:07] <graydon> fmt! should be plenty!
[18:32:21] <strcat> yes fmt! is already slow enough for anyone ;p
[18:32:36] <MaikKlein> well doesn't really matter, I only saw the code where I can send 10 messages to one port and I tried to revert the example for learning purpose.
[18:32:38] <bstrie> not quite, I demand dynamic string interpolation!
[18:32:57] <strcat> bstrie: interp!("foo $bar $baz") ? afaik you could make that
[18:33:06] <strcat> or just... extend fmt
[18:33:08] <bstrie> MaikKlein: I'm trying to edit that example to what you want
[18:33:16] <strcat> let foo = 5; fmt!("%{foo}")
[18:33:30] <bstrie> strcat: I mean, able to supply the string itself at runtime
[18:33:33] <bstrie> which you can't do now
[18:33:33] <strcat> oh
[18:33:42] *** Joins: thomaslee_ (thomaslee@moz-6C3931E3.static.twtelecom.net)
[18:33:43] <strcat> well you can call printf ;D
[18:33:53] <bstrie> I suppose :P
[18:33:54] <strcat> format string vulnerabilities \o/
[18:34:27] <strcat> the recent-ish sudo CVE was one of those (they didn't use -Wformat=2...)
[18:34:31] *** Quits: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr) (Quit: pyrac)
[18:34:50] *** Quits: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com) (Quit: bye bye)
[18:34:53] <MaikKlein> @bstrie ok thanks that would be nice
[18:35:01] <thomaslee_> brson, https://github.com/mozilla/rust/pull/6714 -- does this need more work? if more needs to be done here, I'm happy to pick it up. It's in my way right now. :)
[18:35:13] *** Joins: mhamrick (mhamrick@moz-BE33DA21.fw1.sfo1.mozilla.net)
[18:35:25] *** Joins: bnicholson_ (bnicholson@2557E599.66715431.D25A875A.IP)
[18:35:59] *** Joins: bnicholson (bnicholson@2557E599.66715431.D25A875A.IP)
[18:36:08] <strcat> pcwalton: is transmute_copy going to stay around?
[18:36:15] <pcwalton> I think so yes
[18:36:47] <pcwalton> removing the module reexports from libstd
[18:36:51] <pcwalton> down to 535 errors in librustc
[18:36:52] *** Joins: tumdum_ (tumdum@moz-38D0FA6D.neoplus.adsl.tpnet.pl)
[18:36:56] <strcat> pcwalton: would it make sense for it to assume something about alignment based on one/both of the types?
[18:36:59] <pcwalton> it started out as 2000+
[18:37:05] *** Quits: bnicholson_ (bnicholson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[18:37:08] <pcwalton> I see no reason why not
[18:37:11] *** Joins: Guest777 (ArM@6BFA545D.9C8C4894.AB64B967.IP)
[18:37:55] *** Quits: tumdum (tumdum@moz-6A664A5A.neoplus.adsl.tpnet.pl) (Ping timeout)
[18:39:19] <bstrie> <@graydon> does anyone log values that aren't str?
[18:39:36] <bstrie> graydon: I do stuff like `error!(foo)` all the time, where foo is any type at all
[18:39:49] <Eridius> just yesterday I was doing info!(foo) where foo was a ~[u8]
[18:40:35] <acrichto> brson: ping
[18:41:56] *** Quits: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de) (Ping timeout)
[18:42:42] *** Quits: azita (Azita@2557E599.66715431.D25A875A.IP) (Quit: azita)
[18:42:49] *** Joins: gareth0 (gareth0@moz-24E16DE4.dynamic.dsl.as9105.com)
[18:43:06] <samnardoni> what implements the serialize::Encoder trait?
[18:43:57] *** Quits: jc-denton (nils@moz-C5E8B5EA.ethz.ch) (Ping timeout)
[18:45:44] *** Guest777 is now known as AlihaN
[18:45:51] *** Joins: hjr3 (hradtke@moz-AE3056B9.static.stls.mo.charter.com)
[18:46:02] <brson> thomaslee_: oops, I was in the middle of writing more on that pull and got distracted
[18:46:31] <brson> acrichto: thomaslee_: have to go now. bbl
[18:46:38] <thomaslee_> brson, haha all good -- just let me know & I'll pick it up over the weekend.
[18:47:42] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[18:49:18] *** Joins: jc-denton (nils@moz-C5E8B5EA.ethz.ch)
[18:49:30] <gareth0> https://github.com/mozilla/rust/pull/6433 ... r? please
[18:49:37] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[18:50:35] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[18:50:46] *** Joins: jihyun (uid7128@moz-D8B63698.irccloud.com)
[18:50:57] *** Quits: AlihaN (ArM@6BFA545D.9C8C4894.AB64B967.IP) (NickServ (GHOST command used by Guest79986))
[18:51:10] <steven_is_false>  I could write Mul, Add, Zero, and One instances for functions but Rust only lets the library, or the type declare them.
[18:51:29] *** Joins: seth__ (seth@5AAE35B2.5EFFC0B8.24454B25.IP)
[18:51:57] *** Quits: sankha93 (Instantbir@5AEBC581.93C78442.8B6C1D65.IP) (Ping timeout)
[18:53:00] <EXetoC> rusti: do ~[1, 2, 3].eachi |i, j| { true }
[18:53:04] -rusti- foo.rs:5:23: 5:28 error: `do` must be followed by a block call
[18:53:04] -rusti- foo.rs:5          do ~[1, 2, 3].eachi |i, j| { true }
[18:53:04] -rusti-                                 ^~~~~
[18:53:31] <benh> I think you have to wrap the ~[] literal in parens.
[18:53:33] *** Quits: Diablo-D3 (diablo@moz-6317EE8A.port.east.myfairpoint.net) (Quit: This computer has gone to sleep)
[18:53:50] <EXetoC> rusti: do (~[1, 2, 3]).eachi |i, j| { true }
[18:53:53] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/BDfA
[18:54:40] <strcat> steven_is_false: what would Mul on functions do?
[18:55:16] *** Joins: cpeterson (cpeterson@moz-11915559.hsd1.ca.comcast.net)
[18:55:43] <cmr> Compose them, I imagine
[18:55:58] *** Joins: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr)
[18:55:59] <EXetoC> rusti: do (&[&"hello"]).eachi |i,j| {true}
[18:56:01] *** Joins: geomyidae__ (uid214@moz-D8B63698.irccloud.com)
[18:56:01] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/BIdW
[18:56:06] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[18:56:10] *** Joins: igl (igl@moz-C416C1D2.adsl.alicedsl.de)
[18:56:12] <steven_is_false> strcat: Function composition.
[18:56:27] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[18:56:47] *** Quits: seth__ (seth@5AAE35B2.5EFFC0B8.24454B25.IP) (Ping timeout)
[18:57:00] *** Quits: dylukes (dylukes@moz-B5418F79.hsd1.pa.comcast.net) (Quit: Computer has gone to sleep.)
[18:58:16] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[18:59:20] *** Parts: cpeterson (cpeterson@moz-11915559.hsd1.ca.comcast.net) ()
[19:00:19] *** Joins: Diablo-D3 (diablo@moz-6317EE8A.port.east.myfairpoint.net)
[19:00:39] <graydon> gah!
[19:00:43] <graydon> io::println does local alloc
[19:00:59] *** Joins: dylukes (dylukes@moz-B5418F79.hsd1.pa.comcast.net)
[19:01:06] <graydon> (I already know this, I just keep re-discovering it)
[19:01:17] *** Joins: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP)
[19:02:47] <EXetoC> rusti: do (&[&"hello"]).eachi |i,j| {return true;}
[19:02:52] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/biII
[19:02:54] *** Quits: FrozenCow (FrozenCow@moz-9DF5D010.dynamic.upc.nl) (Client exited)
[19:03:23] <bjz_> really good talk: http://2013.flatmap.no/spiewak.html
[19:03:28] <EXetoC> is that intended? works with the alternative return syntax
[19:04:00] <bjz_> EXetoC: return short-circuits?
[19:04:15] <benh> Yeah, can't return out of lambdas, except in for-expressions
[19:04:30] <bjz_> oh I see
[19:07:07] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[19:07:17] <strcat> pcwalton: how do I cast the type of a ValueRef that's a pointer from foo to i8?
[19:07:23] <EXetoC> benh: convenient
[19:08:03] <bstrie> EXetoC: the idea is to try to deconflate the concepts of local and nonlocal returns
[19:09:17] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[19:09:23] <benh> I hope when we have break 'label;, we'll also get break 'label value; ;)
[19:09:28] <EXetoC> yeah that seems like a good feature. it saved me from introducing a var or two
[19:11:53] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Quit: eatkinson)
[19:11:54] *** Quits: tikue (tkuehn@2557E599.66715431.D25A875A.IP) (Quit: tikue)
[19:12:37] *** Joins: mye (mye@moz-859809CE.dip0.t-ipconnect.de)
[19:17:36] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[19:18:03] <cmr> rusti: str::from_bytes(~[27, 91, 51, 56, 59, 53, 59, 37, 112, 49, 37, 100, 109])
[19:18:05] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/BahP
[19:18:55] *** Quits: Earnestly (earnest@6A917A59.5E1FD793.39C00A7A.IP) (Quit: WeeChat 0.4.2-dev)
[19:19:30] <strcat> pcwalton: it seems like the compiler is using an align of 1 too, it's just that LLVM is clever enough to figure it out if inlined somewhere it can see the align
[19:20:00] * strcat hopes it worked this time...
[19:20:09] *** Joins: Earnestly (earnest@6A917A59.5E1FD793.39C00A7A.IP)
[19:22:17] *** Joins: jeff (jeff@4231C034.745B261B.F12515B4.IP)
[19:23:30] *** Joins: anshin (nbs@441B8B9E.2055B963.D2A6B5.IP)
[19:23:30] <Eridius> gah, borrow-checking is being a real PITA
[19:23:35] <Eridius> this is illegal: r.gen_bytes(r.gen_uint_range(5,11))
[19:23:44] <Eridius> because `r` is borrowed as mutable more than once
[19:23:57] <Eridius> even though r.gen_uint_range() must be evaluated before r.gen_bytes() can be, so in theory the &mut could have been returned already
[19:24:01] <strcat> have to use a tmp var for now
[19:24:21] <strcat> it doesn't understand temp values like that yet
[19:24:29] <Eridius> but it will eventually?
[19:24:33] <strcat> yes
[19:25:05] <Eridius> good
[19:25:12] *** Joins: tikue (tkuehn@2557E599.66715431.D25A875A.IP)
[19:25:34] <strcat> we just need to photocopy nmatsakis a few times
[19:25:40] <cmr> heh
[19:26:30] <bstrie> nmatsakis.clone()
[19:26:38] <bstrie> gah, that isn't implemented yet
[19:26:53] <bstrie> get it together, biologists
[19:26:59] *** Quits: DasIch (dasich@moz-756B08B1.clients.your-server.de) (Ping timeout)
[19:27:05] *** Joins: DasIch (dasich@moz-756B08B1.clients.your-server.de)
[19:28:21] <Eridius> hrm, == doesn't work on enums? Is there any way to derive that?
[19:28:22] <cmr> strcat: I take back what I said about terminfo, it's not ready yet. I need to implement parameterized string... deparameterizing? evaluation?
[19:28:29] <cmr> Eridius: #[deriving(Eq)]
[19:28:33] <Eridius> neat
[19:28:45] <Eridius> cmr: works, thanks
[19:28:52] <strcat> we really need to document all the attributes
[19:29:25] <cmr> a documentation sprint before 0.7 would be useful
[19:29:33] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[19:30:59] *** Parts: judder (maradukewa@CF01B517.FDE2B133.950D3BB5.IP) ()
[19:31:02] <gareth0> strcat, cmr,  any chance of a r? https://github.com/mozilla/rust/pull/6433
[19:31:24] <gareth0> brson originally r+'d it, but then it got rebased
[19:31:30] <Eridius> what else can be derived from enums?
[19:31:49] <bstrie> Eridius: Ord, Encodable, a few other things
[19:31:50] <gareth0> Eridius, Ord at least
[19:31:50] *** Quits: stephank (stephank@FE6D378F.A6EC7F74.1E99A072.IP) (Quit: *Poof!*)
[19:32:00] <strcat> Eridius: same as structs, IterBytes, Clone, DeepClone, Eq, TotalEq, Ord, TotalOrd
[19:32:11] <Eridius> is there any derivable trait that can give me a string containing the name?
[19:32:18] <Eridius> so if I have an enum value Foo I can get "Foo"?
[19:32:37] <benh> Doesn't fmt!("%?", Foo) do that?
[19:32:42] <Eridius> does it? hmm
[19:32:49] <bstrie> it does for variants
[19:32:54] <benh> There's probably a better way :/
[19:33:07] <Eridius> rusti: enum Foo { One, Two }; fmt!("%?", One)
[19:33:10] <bstrie> rusti: error!(None)
[19:33:13] -rusti- ~"One"
[19:33:13] -rusti- error: internal compiler error: unexpected failure
[19:33:13] -rusti- note: the compiler hit an unexpected failure path. this is a bug
[19:33:13] -rusti- note: try running with RUST_LOG=rustc=1,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues
[19:33:28] *** Joins: blitter (blitter@moz-E761A52F.dyn.centurytel.net)
[19:33:51] <bstrie> rusti: fmt!("%?", None)
[19:33:52] -rusti- error: internal compiler error: unexpected failure
[19:33:52] -rusti- note: the compiler hit an unexpected failure path. this is a bug
[19:33:52] -rusti- note: try running with RUST_LOG=rustc=1,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues
[19:33:55] <bstrie> hilarious
[19:35:53] <Eridius> where is fmt! defined?
[19:36:02] <steven_is_false> rusti: fn foo : 'static () { } "Works?"
[19:36:03] -rusti- foo.rs:5:16: 5:17 error: expected `(` but found `:`
[19:36:03] -rusti- foo.rs:5          fn foo : 'static () { } "Works?"
[19:36:03] -rusti-                          ^
[19:36:12] <bstrie> Eridius: syntax::ext
[19:36:13] <bstrie> or something
[19:36:25] <steven_is_false> rusti: let x : fn : 'static () = || { } "Works?"
[19:36:26] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/CBjW
[19:36:30] <steven_is_false> rusti: let x : fn : 'static () = || { }; "Works?"
[19:36:31] -rusti- foo.rs:5:31: 5:32 error: obsolete syntax: bare function type
[19:36:31] -rusti- foo.rs:5          let x : fn : 'static () = || { }; "Works?"
[19:36:31] -rusti-                                         ^
[19:36:31] -rusti- note: use `&fn` or `extern fn` instead
[19:36:31] -rusti- error: aborting due to previous error
[19:36:39] <steven_is_false> rusti: let x : &fn : 'static () = || { }; "Works?"
[19:36:41] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/TLiP
[19:36:42] <Eridius> bstrie: ah. I looked for `macro_rules! fmt` but that didn't find it
[19:36:58] *** Quits: jeff (jeff@4231C034.745B261B.F12515B4.IP) (Quit: jeff)
[19:37:06] <TempleD> Is it necessary to run the tests after doing the make install for rust?
[19:37:22] <bstrie> TempleD: no, only if you make a change
[19:37:36] <steven_is_false> ~fn 'r () is unimplemented so far but it refers to values that close over an environment 'r right?
[19:37:43] <TempleD> bstrie: Alright, cheers.
[19:38:29] <engla> steven_is_false: what do you want to do with rusti?
[19:38:44] <steven_is_false> So an object with a vtable would be struct Object <'self> { foo : ~fn 'self (), bar : ~fn 'self } right?
[19:38:50] <tumdum_> is there somewhere precompiled distribution of rust for linux-x64?
[19:39:03] <strcat> tumdum_: there are some packages
[19:39:20] <strcat> tumdum_: https://github.com/mozilla/rust/wiki/Doc-packages,-editors,-and-other-tools list there
[19:39:25] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[19:39:30] <tumdum_> strcat, thanks!
[19:41:01] <steven_is_false> It wouldn't actually use a vtable, and such but the concepts are similar right? Or am I making a mistake?
[19:41:58] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[19:42:18] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[19:43:16] <steven_is_false> struct Object <'self> { method : ~fn : 'self () } "Works?"
[19:43:25] *** Quits: DasIch (dasich@moz-756B08B1.clients.your-server.de) (Ping timeout)
[19:43:43] <bstrie> steven_is_false: I thought 'self was no longer a valid lifetime name
[19:43:47] <steven_is_false> rusti: struct Object <'self> { method : ~fn : 'self () } "Works?"
[19:43:48] -rusti- foo.rs:5:48: 5:53 error: `'static` is the only permissible region bound here
[19:43:48] -rusti- foo.rs:5          struct Object <'self> { method : ~fn : 'self () } "Works?"
[19:43:48] -rusti-                                                          ^~~~~
[19:43:48] -rusti- error: aborting due to previous error
[19:44:13] <steven_is_false> bstrie: I thought you still had to use 'self but it just had to be declared
[19:44:14] *** Joins: jeff (jeff@4231C034.745B261B.F12515B4.IP)
[19:44:47] <TempleD> rusti: fn main(){println("Hello");}
[19:45:04] <TempleD> Oh, erm, don't mind me.
[19:45:11] <strcat> rusti: println("Hello")
[19:45:12] -rusti- Hello
[19:45:16] <TempleD> Ah.
[19:45:22] <strcat> it's already in a main() fn
[19:45:23] <bstrie> steven_is_false: in any case, I'm not sure what the best way of storing functions in a struct is :)
[19:45:30] <TempleD> strcat: Alright, cheers.
[19:45:35] <strcat> rusti: core::run::run_program("cat", [~"foo.rs"]);
[19:45:36] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/cDfa
[19:45:43] <strcat> rusti: std::run::run_program("cat", [~"foo.rs"]);
[19:45:45] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/PDDG
[19:45:51] <TempleD> Was just wondering. rustc is producing an executable file, but it's not running at all.
[19:46:16] <bstrie> TempleD: that code you wrote above is the correct hello world program
[19:46:22] <bstrie> not sure why it wouldn't be running
[19:46:32] <TempleD> Nor am I...
[19:46:44] <steven_is_false> rusti: std::run::run_program ("echo", ["Hello World!"])
[19:46:45] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/IAUG
[19:46:57] <bstrie> TempleD: what platform and what compiler version?
[19:46:59] <steven_is_false> rusti: std::run::run_program ("echo", [~"Hello World!"])
[19:47:00] -rusti- Hello World!
[19:47:00] -rusti- 0
[19:47:35] <TempleD> bstrie: Linux, 0.6 (I think)
[19:47:45] <bstrie> TempleD: rustc -v will tell you
[19:48:00] <TempleD> Yep, 0.6
[19:48:04] <Eridius> is there a simpler way to explicitly convert a ~[T] into a &[T] other than using foo.slice(0, foo.len())?
[19:48:15] <strcat> Eridius: it will coerce
[19:48:21] <Eridius> strcat: not in my case
[19:48:26] <strcat> rusti: let xs = ~[1, 2, 3]; let ys: &[int] = xs; ys
[19:48:28] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/DFMj
[19:48:35] <Eridius> I need to concatenate a ~[u8] and a &[u8], and foo + bar doesn't work, so I'm trying vec::concat([foo, bar])
[19:48:37] <strcat> rusti: let xs = ~[1, 2, 3]; let ys: &[int] = xs; fmt!("%?", ys)
[19:48:38] -rusti- ~"&[1, 2, 3]"
[19:48:43] <Eridius> and it's not coercing bar into a &[u8]
[19:48:49] <strcat> Eridius: it should work with the &[T] first
[19:48:55] <strcat> or if you explicitly coerce
[19:49:11] <strcat> it only checks the LHS type and then gives up if it can't coerce the RHS
[19:49:13] <strcat> atm
[19:49:31] <Eridius> strcat: I can't put the &[T] first because ordering matters. And what do you mean by explicitly coerce
[19:49:35] <Eridius> an `as` expression doesn't work
[19:49:49] <strcat> what do you mean ordering matters?
[19:49:56] <strcat> Eridius: 'as' is only for scalars (integers)
[19:49:58] <Eridius> I'm concatenating the vectors. I can't swap the inputs
[19:50:02] <benh> he wants "foobar" not "barfoo" ;)
[19:50:19] <Eridius> benh: exactly
[19:50:21] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke. It's all a joke.)
[19:50:27] <strcat> Eridius: let xs: &[T] = x; or id::<&[T]>(x)
[19:50:53] *** Parts: TempleD (TempleD@moz-EB752F3E.as43234.net) ()
[19:51:02] <Eridius> where's id?
[19:51:28] <Eridius> ah util
[19:52:12] <Eridius> ack, id worked but concat doesn't because it needs ~[] not &[]. Bah.
[19:53:34] *** Joins: DasIch (dasich@moz-756B08B1.clients.your-server.de)
[19:53:42] <strcat> Eridius: there's connect but it will need a "" sep arg
[19:53:46] <benh> concat_slices maybe?
[19:53:54] <benh> or connect_slices D:
[19:53:59] <Eridius> strcat: connect needs ~[]'s as well
[19:54:06] <Eridius> benh: a concat_slices sure would be handy
[19:54:21] <Eridius> or, heck, just a way to append two &[u8] with, say, +
[19:54:40] *** Quits: heftig (heftig@moz-F654C133.dip0.t-ipconnect.de) (Ping timeout)
[19:55:53] <benh> a.to_owned() + b maybe?
[19:55:55] <benh> brr
[19:56:04] <Eridius> benh: yay for unnecessary allocation!
[19:56:12] <Eridius> no wait, not yay. Boo. That's what I meant. Boo.
[19:56:19] *** Joins: seth__ (seth@5AAE35B2.5EFFC0B8.24454B25.IP)
[19:56:29] *** Quits: jeff (jeff@4231C034.745B261B.F12515B4.IP) (Quit: jeff)
[19:56:34] <bstrie> Eridius: clearly you just need to improve the stdlib to make this easier :)
[19:56:38] <Eridius> hah
[19:57:47] *** Joins: cowboyd (cowboyd@moz-1BD02A1E.sw.biz.rr.com)
[19:58:00] <engla> Eridius: if ~[] + &[] doesn't work it's a regression
[19:58:04] *** Quits: seth__ (seth@5AAE35B2.5EFFC0B8.24454B25.IP) (Ping timeout)
[19:58:19] <Eridius> engla: I'm actually trying &[] + ~[]
[19:58:21] <benh> I don't really understand why concat takes &[~[T]] instead of &[&[T]] though
[19:58:36] *** Joins: jeff (jeff@4231C034.745B261B.F12515B4.IP)
[19:58:46] <strcat> it shouldn't take either
[19:58:51] <engla> aha Eridius ok
[19:58:51] <strcat> it should be defined on iterators
[19:59:31] <strcat> unless it does a pass to reserve space...
[19:59:42] <nmatsakis> benh: it should probably take something like &[I] for some iterable type I
[19:59:51] *** Joins: threecreepio (jdp@moz-DB2D70E9.cust.bredbandsbolaget.se)
[20:00:18] <benh> strcat: vec::concat doesn't seem to but I think str::concat does
[20:00:57] <engla> what about mconcat  <M:Monoid> &[M]
[20:01:00] <strcat> nmatsakis: so, in the trans_intrinsic function in trans/foreign.rs - how do I get the integer value passed as a param not as a ValueRef?
[20:01:11] <strcat> or go ValueRef -> some rust int
[20:01:12] <nmatsakis> strcat: you can't do that.
[20:01:12] *** Joins: sankha93 (Instantbir@5AEBC581.93C78442.8B6C1D65.IP)
[20:01:20] <nmatsakis> :)
[20:01:27] <strcat> nmatsakis: well that makes sense.
[20:01:33] <strcat> I guess I need to generate a multiplication then
[20:01:35] <nmatsakis> strcat: trans-intrinsic generates a real LLVM function afaik
[20:01:35] *** Joins: heftig (heftig@moz-F4B82211.dip0.t-ipconnect.de)
[20:01:40] *** Quits: DasIch (dasich@moz-756B08B1.clients.your-server.de) (Ping timeout)
[20:01:42] <strcat> I need to multiply size * count
[20:01:48] <strcat> dunno how I'd generate that
[20:01:53] <benh> It still feels like the whole ~[]/@[] story is one abstraction level away from being completely intuitive :/
[20:02:13] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[20:02:24] <Luqman> strcat: trans::build::Mul
[20:02:44] <strcat> Luqman: ah, perfect :)
[20:02:49] <engla> benh: nmatsakis here has a plan to maybe fix it
[20:03:38] *** Joins: solancile (solancile@moz-A1CFFAE5.hsd1.wa.comcast.net)
[20:03:59] <nmatsakis> at least to make it no less intuitive than ~/@/& on other types.
[20:04:09] <nmatsakis> Luqman: whatever happened with your "always pass by ref" patch?
[20:04:12] <strcat> alright I think this will work now :)
[20:04:31] <strcat> really need this duplicate code factored out
[20:04:32] *** Joins: DasIch (dasich@moz-756B08B1.clients.your-server.de)
[20:04:52] <benh> Should we have an operator + taking two &[] ...? Could that ever make sense?
[20:04:57] <Luqman> nmatsakis: got busy with school. building/testing it now :)
[20:05:01] <Eridius> benh: makes just as much sense as taking two ~[]
[20:05:05] <Eridius> both of them would produce a ~[]
[20:05:13] <benh> Eridius: But what if you want a @[]?
[20:05:28] <Eridius> bah
[20:05:29] <nmatsakis> benh: tough.
[20:05:36] <benh> :)
[20:05:36] <nmatsakis> only got one operator.
[20:05:39] <nmatsakis> ;)
[20:05:42] <Eridius> use a function to produce @[]
[20:05:49] <nmatsakis> there is some chance we will eventually allow ~[] to be converted to @[]
[20:05:55] <nmatsakis> (though not vice versa)
[20:05:59] <benh> Gonna add ~+ and @+ tokens >:)
[20:06:01] <engla> don't use + then benh.. (I favor a separate concat operator)
[20:06:01] <nmatsakis> logically it makes some sense, but there are technical hurdes.
[20:06:10] *** Quits: bnicholson (bnicholson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[20:06:18] <Eridius> parameterize +'s return value and let the context decide!
[20:06:28] <benh> That sounds dreamy
[20:06:36] <nmatsakis> Eridius: problem with that is that you wind up with nasty type inference errors
[20:06:38] <nmatsakis> for example,
[20:06:42] <nmatsakis> let x = a + b + c doesn't work
[20:06:43] <benh> @(vec1 + vec2), ~(vec1 + vec2)
[20:06:50] <nmatsakis> since the return type a + b is unknown
[20:07:00] <Eridius> nmatsakis: it wasn't a serious suggestion ;)
[20:07:11] <nmatsakis> ok :) because it would *Almost* work :)
[20:07:45] <Eridius> let's introduce a @{} scope syntax that causes all functions that would return a ~ type to return a @ type!
[20:07:49] <Eridius> @{ a + b }
[20:08:27] <nmatsakis> truth is, you really don't want to be adding vectors and strings with `+`
[20:08:34] <nmatsakis> it's really very inefficient. :)
[20:08:36] <benh> Let + return a wrapper type that just holds the constituent slices and only performs concatenation when implicitly coerced into @ and ~...
[20:08:43] <Eridius> nmatsakis: why so inefficient?
[20:08:53] <Eridius> I mean, it should only have to allocate one new buffer and copy all the elements
[20:08:57] <nmatsakis> well, it's not *necessarily* inefficient, but it can easily become inefficient.
[20:09:05] <nmatsakis> let x = a + b is ok, if you can't re-use a or b
[20:09:06] <Eridius> a + b + c + d? yeah that's nasty
[20:09:36] <benh> Also I wonder whether there's a way to define all the std::vec utilities so that they can be used with a custom allocator
[20:09:47] <Eridius> honestly, I'd rather see + removed from vectors, but left on strings (because adding strings together with + is an incredibly common operation in a lot of languages, people will want it)
[20:09:49] <benh> Like those on slices, sure, but...
[20:09:57] <Eridius> but if + is removed from vectors then there needs to be a good alternative
[20:10:05] <engla> you could redefine + to be by-move and just return the first vec (appending the other)
[20:10:12] <strcat> the vec/str modules/implementations suck
[20:10:12] <Eridius> vec::add(a, b)
[20:10:15] <strcat> needs a lot of work
[20:10:37] <strcat> but right now I just want perfect swaps ;p
[20:10:45] <strcat> then some really crappy TBAA
[20:10:54] *** Quits: sankha93 (Instantbir@5AEBC581.93C78442.8B6C1D65.IP) (Ping timeout)
[20:12:28] <Eridius> hrm, I need to have a value that's computed once and reused on subsequent calls to the same function. I can't use a static because the initializer is not compatible (seeing as how it's computed). What's the right approach?
[20:12:53] <Eridius> (notably, the "computation" uses random numbers, which is why I need to preserve and re-use it)
[20:13:41] *** Joins: bnicholson (bnicholson@2557E599.66715431.D25A875A.IP)
[20:13:47] <kimundi> Eridius: Convert the function to a method on some state type?
[20:14:03] <Eridius> kimundi: eh, I suppose that would work, but is that the only reasonable approach?
[20:15:00] *** Quits: jeff (jeff@4231C034.745B261B.F12515B4.IP) (Quit: jeff)
[20:15:13] *** Joins: sankha93 (Instantbir@5AEBC581.93C78442.8B6C1D65.IP)
[20:15:14] *** Joins: stephank (stephank@FE6D378F.A6EC7F74.1E99A072.IP)
[20:16:06] <Eridius> is there any way to have a mutable static?
[20:16:15] <kimundi> Other options are stuffing it in task local storae
[20:16:19] <Eridius> because I could do this with an Option-typed static if I could mutate it
[20:16:26] *** Joins: jeff (jeff@4231C034.745B261B.F12515B4.IP)
[20:16:35] <kimundi> or wait for mutable statics tobe implemented
[20:16:40] <Eridius> heh
[20:16:50] <strcat> you would need to do locking anyway
[20:17:03] <Eridius> ok, guess I'll use a state object. Not really how I wanted to structure this, but I guess it'll work. thanks.
[20:17:10] *** Quits: LimeBurst (me@247D1419.D73964AC.27A8748.IP) (Quit: Lost terminal)
[20:17:11] <nmatsakis> engla: you don't want + to be by-move in many, many cases
[20:17:50] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[20:17:50] *** Joins: LimeBurst (me@247D1419.D73964AC.27A8748.IP)
[20:17:51] <nmatsakis> engla: (that is, types that are not vecs, strs)
[20:17:52] *** Quits: Luqman (laden@moz-DCEF6040.csclub.uwaterloo.ca) (Quit: Lost terminal)
[20:18:04] <nmatsakis> Eridius: I think what we want is to add the new += method
[20:18:04] *** Joins: Luqman (laden@moz-DCEF6040.csclub.uwaterloo.ca)
[20:18:17] <nmatsakis> Eridius: then something like 'a += b; a += c; a += d;" is an efficient alternative
[20:18:41] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[20:18:44] <Eridius> nmatsakis: sure that would be efficient, but in my case I can't modify the two inputs
[20:18:52] <engla> hm, you could do &v + &w if you want to force it to add by-ref
[20:19:18] <nmatsakis> Eridius: "let t = a.clone(); t += b; ..."
[20:19:49] <nmatsakis> I don't know, don't ask me. I'm happy with .push() and .push_all().
[20:19:51] <Eridius> nmatsakis: that still reallocates unnecessarily, because it doesn't know the final length
[20:19:53] <nmatsakis> :)
[20:19:57] <benh> maybe + on slices could return an opaque type that you can iterate over... :)
[20:20:00] <nmatsakis> Eridius: well, that's what concat is for...
[20:20:04] <Eridius> I ended up going with a 3-line solution using vec::with_capacity() followed by 2 push_all's
[20:20:11] <Eridius> nmatsakis: if only concat worked with &[]
[20:20:21] <nmatsakis> Eridius: yes, well, the signature of concat is messed up, that's true. but that's easily fixed. :)
[20:20:34] <nmatsakis> or relatively easily.
[20:20:55] *** Joins: bnicholson_ (bnicholson@2557E599.66715431.D25A875A.IP)
[20:21:50] *** Joins: Jesse (jruderman@2557E599.66715431.D25A875A.IP)
[20:22:20] <Eridius> what happens if you have a structure expression that doesn't define values for all the struct fields? Or is that illegal?
[20:23:21] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[20:23:23] <Eridius> rusti: struct Foo { priv a : uint; priv b : uint }; Foo{a: 1}
[20:23:28] <nmatsakis> Does anyone else do 32 bit builds in linux?
[20:23:35] <nmatsakis> Eridius: illegal.
[20:23:36] <steven_is_false> Hi does anyone know any sh-fu? In a for loop such as for II in clckwrks clckwrks-plugin-page clckwrks-cli clckwrks-theme-bootstrap; do (cd $II; cabal install); done How would I chain the commands together with && so the command quits as soon as there is an error?
[20:23:45] <strcat> pcwalton: finally got it working right ;p
[20:23:53] <Eridius> steven_is_false: `set -e`
[20:24:01] <Eridius> that sets the sh flag that makes it bail the first time a command fails
[20:24:06] <strcat> pcwalton: http://ix.io/5MD
[20:24:18] <strcat> I'll look at the ones generated in the compiler once this passes too
[20:24:21] <Eridius> you'll need to set it in your sub-shell as well though I think
[20:24:29] <steven_is_false> Eridius: I never thought of that.
[20:24:59] *** Quits: lerc (quassel@121.75.155.67) (Ping timeout)
[20:25:16] <Eridius> actually, I'm not sure this is going to kill the parent
[20:25:33] <Eridius> yeah it looks like a failing subshell doesn't kill the parent, which is mildly surprising
[20:26:17] <Eridius> I suppose you could instead say do ( cd $II && cabal install) || exit 1; done
[20:26:20] <Eridius> steven_is_false: ^
[20:26:46] <strcat> steven_is_false: set -o errexit
[20:26:46] *** Quits: Palmik (palmik@moz-80A68683.vpn.muni.cz) (Quit: Lost terminal)
[20:27:00] <steven_is_false> Eridius: I'd have to wrap everything in it's own shell though. $(set -e; for etc.. right
[20:27:00] <strcat> exits when anything returns non-zero
[20:27:01] <Eridius> strcat: that's the same as set -e
[20:27:11] <strcat> Eridius: oh I missed your reply
[20:27:24] <Eridius> steven_is_false: since a failing subshell doesn't kill the parent, `set -e` isn't gonna work. Use the || solution
[20:28:15] <Eridius> or if you want to preserve the return code from cabal install, instead of `exit 1` you can use `exit $?`
[20:28:31] <Eridius> so: for II in arg-list; do (cd $II && cabal install) || exit $?; done
[20:28:50] <steven_is_false> Eridius: I'm just typeing this stuff at the commandline, it's not a script. I don't want a failure to kill the shell I'm typing in.
[20:29:11] <Eridius> steven_is_false: ah. use break then
[20:29:19] <Eridius> for II in arg-list; do (cd $II && cabal install) || break; done
[20:29:27] <steven_is_false> Eridius: Thanks.
[20:31:24] *** Joins: snearch (snearch@moz-6DF04212.pool.mediaways.net)
[20:32:13] *** Quits: bnicholson_ (bnicholson@2557E599.66715431.D25A875A.IP) (Input/output error)
[20:32:13] *** Quits: bnicholson (bnicholson@2557E599.66715431.D25A875A.IP) (Input/output error)
[20:32:20] *** Joins: bnicholson (bnicholson@2557E599.66715431.D25A875A.IP)
[20:32:24] *** Quits: fabiand (fabiand@moz-859205E.adsl.alicedsl.de) (Quit: Verlassend)
[20:33:02] <benh> What's the etiquette on pinging people to review my pull request, and/or to ask someone to look at my code that I'm not sure is ready for merging yet?
[20:33:34] <benh> I have https://github.com/mozilla/rust/pull/6700 which looks fairly ok to me, and https://github.com/ben0x539/rust/compare/mozilla:incoming...docattrsep which I'm less happy with, but...
[20:33:54] <benh> Do I just git-blame the surrounding code and then choose a victim?
[20:36:02] *** Quits: dcamp_ (dcamp@moz-930D5B64.hsd1.wa.comcast.net) (Ping timeout)
[20:36:08] *** Joins: lerc (quassel@6174E42B.BEFA2430.788638A4.IP)
[20:36:46] <benh> I'm not very good at this "contributing" thing :)
[20:36:55] *** Joins: dcamp (dcamp@moz-930D5B64.hsd1.wa.comcast.net)
[20:37:27] *** Parts: tumdum_ (tumdum@moz-38D0FA6D.neoplus.adsl.tpnet.pl) (Leaving)
[20:38:14] <pcwalton> strcat: great!
[20:39:08] <strcat> pcwalton: causing some failure though :(, debugging that now
[20:39:27] <Luqman> nmatsakis: r? https://github.com/mozilla/rust/pull/6720
[20:40:24] <strcat> afaict it generates correct code in every case...
[20:40:59] *** Quits: rroels (rroels@moz-F4424B80.vub.ac.be) (Ping timeout)
[20:41:23] <jdm> benh: the victim technique sounds reasonable to me
[20:41:27] *** Quits: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP) (Quit: pcwalton)
[20:42:42] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[20:42:42] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14fb7c1b3 to 14b5ab101: 02http://git.io/N3iJvQ
[20:42:42] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[20:42:42] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[20:42:42] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/XBA3Tw
[20:42:42] <ghrust> 13rust/06auto 14e69e809 15Tom Lee: Define _RUST_STAGEN when building rustrt....
[20:42:42] <ghrust> 13rust/06auto 149a40c5c 15bors: auto merge of #6714 : thomaslee/rust/rustrt-stage, r=brson...
[20:42:44] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[20:43:31] <Eridius> ack, borrowed values can be killed before the full-expression (to use C terminology) is done?
[20:43:52] <strcat> hm?
[20:44:22] <Eridius> foo(vec::from_elem(16, 0).slice(0,4))
[20:44:32] <Eridius> the ~[] is dead before the call to foo()
[20:44:43] <Eridius> which produces a "borrowed value does not live long enough" error
[20:45:47] *** Joins: pcwalton (pcwalton@2557E599.66715431.D25A875A.IP)
[20:45:47] *** ChanServ sets mode: +o pcwalton
[20:46:37] <Eridius> pcwalton: has there been any thought given to making borrowed pointers extend the lifetime of the borrowed value?
[20:47:00] <pcwalton> in some cases they do, @ boxes for example, but I worry about making the system more complicated
[20:47:04] <Eridius> either that, or making borrowed values survive at least to the end of the full-expression (to use C terminology) where they were borrowed
[20:47:14] <pcwalton> we can certainly tweak that
[20:47:15] <Eridius> pcwalton: in my case I have something like foo(vec::from_elem(16, 0).slice(0, 4))
[20:47:28] <Eridius> I was surprised to find the ~[] from the call to from_elem was killed before the call to foo
[20:47:32] *** Quits: dylukes (dylukes@moz-B5418F79.hsd1.pa.comcast.net) (Quit: Computer has gone to sleep.)
[20:48:57] <steven_is_false> Does anyone know how to pipe input into emacsclient? emacsclient - doesn't work.
[20:49:27] <pcwalton> Eridius: yes, feel free to file bugs and cc @nikomatsakis if you think the lifetimes of something should be tweaked
[20:51:19] *** Quits: gareth0 (gareth0@moz-24E16DE4.dynamic.dsl.as9105.com) (Ping timeout)
[20:52:23] *** Parts: jeff (jeff@4231C034.745B261B.F12515B4.IP) ()
[20:52:24] *** Joins: wycats_ (uid79@moz-D8B63698.irccloud.com)
[20:55:19] <strcat> pcwalton: definitely a bug somewhere :(
[20:55:42] <strcat> hm
[20:56:01] <Eridius> pcwalton: ok, filed #6721
[20:56:08] <pcwalton> thanks
[21:05:06] *** Joins: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP)
[21:05:06] *** ChanServ sets mode: +o tjc
[21:09:31] *** Quits: lmandel (lmandel@F2D29657.F60B0462.67AC9B1.IP) (Quit: lmandel)
[21:14:47] *** Joins: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de)
[21:14:49] <strcat> pcwalton: what's type_use exactly?
[21:15:04] <strcat> use_repr vs use_tydesc vs 0
[21:15:16] <strcat> I didn't update it from 0 after I added a type param, could that be the issue?
[21:15:53] <strcat> hm yeah
[21:17:23] <strcat> pub static use_repr: uint = 1;   /* Dependency on size/alignment/mode and
[21:17:25] <strcat>                                      take/drop glue */
[21:17:27] <strcat> yep
[21:17:29] <strcat> makes sense
[21:20:41] *** Joins: catpigger (catpig@moz-A3A1500A.dip0.t-ipconnect.de)
[21:21:17] *** Quits: catpig (catpig@moz-F50E4A6A.dip0.t-ipconnect.de) (Ping timeout)
[21:21:23] *** Quits: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP) (Quit: zzzzzzzzzz)
[21:21:29] <MaikKlein> btw what is mozilla doing for rust? are they paying the core developers?
[21:21:50] <jdm> yep, there's a team of Rust engineers
[21:23:31] <thomaslee_> kaeso: ping?
[21:26:06] *** Quits: bytbox (s@moz-D83E9B31.wireless.umd.edu) (Ping timeout)
[21:26:27] <strcat> Luqman: nice! working self/~self? :)
[21:31:29] *** Joins: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP)
[21:31:29] *** ChanServ sets mode: +o tjc
[21:32:12] *** Quits: pyrac (pyrac@moz-D851FA22.w92-149.abo.wanadoo.fr) (Quit: pyrac)
[21:34:41] *** Quits: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP) (Quit: Leaving.)
[21:36:01] *** Quits: sankha93 (Instantbir@5AEBC581.93C78442.8B6C1D65.IP) (Quit: Instantbird 1.4 -- http://www.instantbird.com)
[21:36:40] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[21:36:40] <ghrust> 01[13rust01] 15bors merged 06auto into 06incoming: 02http://git.io/XBA3Tw
[21:36:40] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[21:38:40] <Luqman> strcat: well, self. ~self still has some issues
[21:39:41] <Luqman> tjc: I did remove the binaries in that commit :P
[21:42:18] *** Quits: victorporof (victorporo@DE2B5DEF.67CDC207.79933D60.IP) (Quit: victorporof)
[21:43:04] *** Joins: dylukes (dylukes@moz-E4DF3FED.pitbpa.fios.verizon.net)
[21:44:07] *** Quits: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP) (Quit: zzzzzzzzzz)
[21:45:13] <strcat> pcwalton: I guess we don't use the tbaa.struct metadata right now?
[21:45:28] <strcat> can tell LLVM which parts of a struct are padding
[21:45:37] * strcat can probably get that working later
[21:46:07] *** Quits: Ralith (ralith@moz-50F3C77.vc.shawcable.net) (Ping timeout)
[21:47:17] <MaikKlein> how would I clone an object that doesn't have a clone method?
[21:47:47] <strcat> add #[deriving(Clone)] above the definition for most types
[21:48:00] <strcat> pretty much anything that's not a binding around some FFI type using a raw pointer
[21:49:33] <MaikKlein> ok thanks
[21:52:56] *** Quits: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de) (Ping timeout)
[21:55:27] *** Quits: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP) (Quit: night)
[21:56:30] *** Quits: spider-mario (spidermari@moz-2F72F6FF.dsl.quantic-telecom.net) (Input/output error)
[21:59:41] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[22:02:50] *** Quits: donri (dag@moz-9BB61102.tbcn.telia.com) (Client exited)
[22:07:14] *** Quits: cowboyd (cowboyd@moz-1BD02A1E.sw.biz.rr.com) (Client exited)
[22:08:01] *** Joins: josh (josh@moz-36D46A47.hsd1.dc.comcast.net)
[22:08:06] *** Joins: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP)
[22:09:59] *** Quits: pcwalton (pcwalton@2557E599.66715431.D25A875A.IP) (Quit: pcwalton)
[22:14:25] *** Quits: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP) (Ping timeout)
[22:14:28] *** Joins: pcwalton (pcwalton@2557E599.66715431.D25A875A.IP)
[22:14:28] *** ChanServ sets mode: +o pcwalton
[22:15:11] *** Quits: josh (josh@moz-36D46A47.hsd1.dc.comcast.net) (Quit: josh)
[22:15:17] *** Joins: josh (josh@moz-36D46A47.hsd1.dc.comcast.net)
[22:15:27] *** Quits: josh (josh@moz-36D46A47.hsd1.dc.comcast.net) (Quit: josh)
[22:16:26] *** Quits: mye (mye@moz-859809CE.dip0.t-ipconnect.de) (Quit: mye)
[22:19:16] *** Quits: hjr3 (hradtke@moz-AE3056B9.static.stls.mo.charter.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[22:20:30] *** Quits: pcwalton (pcwalton@2557E599.66715431.D25A875A.IP) (Quit: pcwalton)
[22:24:34] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:24:42] <strcat> rusti: 5
[22:24:47] -rusti- 5
[22:27:44] *** Joins: chadz (uid979@moz-D8B63698.irccloud.com)
[22:29:11] *** Joins: pcwalton (pcwalton@2557E599.66715431.D25A875A.IP)
[22:29:11] *** ChanServ sets mode: +o pcwalton
[22:29:43] <erickt> woo, got 10 folks interested in a bay area meetup! Anyone else interested in participating?
[22:33:34] <indutny> yikes guys!
[22:33:39] <indutny> my linearscan allocator is working :)
[22:33:41] <indutny> http://blog.indutny.com/f/linearscan.svg
[22:33:53] <indutny> and its written in rust: https://github.com/indutny/linearscan.rs ! :)
[22:34:04] <indutny> its not like I've totally finished it
[22:34:07] <pcwalton> awesome :)
[22:34:13] <indutny> but its the first time tests are passing
[22:34:14] <erickt> indutny:  I have no idea what that is, but it looks awesome
[22:34:23] <indutny> its a register allocator
[22:34:23] <pcwalton> register allocator?
[22:34:25] <indutny> yes
[22:34:36] <indutny> presumably fast
[22:34:52] <indutny> thanks for all your help and advices
[22:36:46] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[22:39:37] <erickt> Luqman: +1
[22:40:34] *** Quits: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com) (Quit: Scriptor)
[22:40:43] <pcwalton> indutny: that's beautiful rust code
[22:40:56] <erickt> much simpler than what I've been trying to do :)
[22:41:13] <erickt> Luqman: ^
[22:41:43] <Luqman> erickt: the by-value self fix?
[22:42:15] <erickt> Luqman: yep! I r+'ed it
[22:42:47] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[22:42:47] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/SwQNig
[22:42:47] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[22:42:51] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[22:42:51] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/tuz3IA
[22:42:51] <ghrust> 13rust/06auto 14f0f251e 15Luqman Aden: librustc: Always pass self ByRef.
[22:42:51] <ghrust> 13rust/06auto 147ac831e 15Luqman Aden: Add test for #5321.
[22:42:51] <ghrust> 13rust/06auto 14947a854 15Luqman Aden: librustc: Classify newtype structs Foo(T) as immediates if T is an immediate.
[22:42:52] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[22:42:58] *** Quits: igl (igl@moz-C416C1D2.adsl.alicedsl.de) (Ping timeout)
[22:43:19] *** Joins: igl (igl@moz-3A7B7CAB.adsl.alicedsl.de)
[22:44:34] <Luqman> erickt: thanks!
[22:44:54] *** Joins: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP)
[22:44:54] *** ChanServ sets mode: +o tjc
[22:44:57] <graydon> gc successful on heapmap, whee
[22:47:02] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Quit: Computer has gone to sleep.)
[22:49:46] <bstrie> graydon: heapmap?
[22:52:26] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Client exited)
[22:53:31] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[22:53:37] <graydon> dense bitmap for tracking allocations
[22:54:51] *** Joins: mflamer (Mibbit@moz-FE8B7976.dsl.pltn13.sbcglobal.net)
[22:58:06] *** Joins: seth (seth@5AAE35B2.5EFFC0B8.24454B25.IP)
[22:59:04] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[22:59:45] *** Joins: FrozenCow (FrozenCow@moz-9DF5D010.dynamic.upc.nl)
[22:59:53] *** Quits: seth (seth@5AAE35B2.5EFFC0B8.24454B25.IP) (Ping timeout)
[23:02:07] *** Quits: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP) (Quit: zzzzzzzzzz)
[23:02:56] <erickt> graydon: ping
[23:04:37] *** Joins: devbug (quassel@moz-E1DE087C.bchsia.telus.net)
[23:07:30] *** Joins: KindOne (KindOne@moz-97FBD8C0.dynamic.ip.windstream.net)
[23:07:47] <graydon> erickt: pong, a little busy; what's up?
[23:09:03] <erickt> oh i ran across this fixme of yours in some code I was trying to clean up: https://github.com/mozilla/rust/issues/2537. The fixme is in https://github.com/mozilla/rust/blob/master/src/librustc/middle/trans/type_use.rs#L324
[23:09:50] <erickt> I can come back later though. I'm trying to remove the use of expr.callee_id that's used in expr_fields.
[23:10:25] <graydon> yeah, can we do this on monday? chatting with tjc presently
[23:10:28] <erickt> that code in type_use.rs is the only bit of code that uses the expr_field's callee_id, and I wasn't sure if removing it was safe
[23:10:29] <erickt> sure
[23:11:45] *** Quits: samnardoni (samnardoni@moz-ECB14881.cable.virginmedia.com) (Client exited)
[23:13:30] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[23:13:39] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[23:14:16] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Quit: Textual IRC Client: www.textualapp.com)
[23:14:54] *** Quits: bent (chatzilla@moz-932324BF.hsd1.ca.comcast.net) (Quit: ChatZilla 0.9.90-rdmsoft [XULRunner 18.0.2/20130201065344])
[23:18:04] <bstrie> bjz_: watching that video now, and I'm baffled that apparently Scala is pronounced very weirdly
[23:19:54] <bstrie> I can't be the first person who's been intuitively pronouncing it "Scay-luh"
[23:21:05] *** Joins: carllerche (carllerche@moz-BF6CB667.hsd1.ca.comcast.net)
[23:21:10] *** Joins: SimonSapin (simon@3B698CEA.45500B72.24454B25.IP)
[23:22:35] *** Quits: dylukes (dylukes@moz-E4DF3FED.pitbpa.fios.verizon.net) (Quit: Computer has gone to sleep.)
[23:23:01] <steven_is_false> bstrie: I think it's supposed to be like Java, but I had the same mistake too.
[23:23:23] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[23:23:30] <bstrie> ugh, every time that he says "Scah-lah" my heart misses a single beat. somehow it offends me on a visceral level
[23:23:41] <bstrie> but otherwise it's a neat video, SML looks cool :)
[23:24:19] <erickt> bstrie: scay-luh? thats crazy talk! what's this video you're referring to?
[23:24:43] <bstrie> erickt: http://2013.flatmap.no/spiewak.html
[23:25:15] <erickt> thanks
[23:26:45] <graydon> I find the speaker really grating; but he's got some ok points concerning first class modularity
[23:27:34] <graydon> as with much I see in scala, it feels much more concerned with expressiveness than how you'd implement it at runtime
[23:29:17] *** Quits: lerc (quassel@121.75.155.67) (Client exited)
[23:29:45] *** Joins: MaikKlein (maik@moz-B7C8DB21.dip0.t-ipconnect.de)
[23:31:18] <MaikKlein> if I use #[deriving(Eq)] does this mean I can already use .eq on my object or do I have to implement it first?
[23:32:11] *** Joins: caitp (caitp@5AAE35B2.5EFFC0B8.24454B25.IP)
[23:32:33] <bstrie> MaikKlein: you're back! I whipped up a highly inefficient solution to that question you had earlier: https://gist.github.com/bstrie/5645725
[23:32:48] <bstrie> MaikKlein: once you derive Eq, then you get the implementation of .eq() for free
[23:32:59] <bstrie> that's the point of deriving :)
[23:33:23] <MaikKlein> ah nice that is awesome
[23:33:54] <MaikKlein> wait so is #[deriving(Eq)] basicly inheritance?
[23:35:18] <bstrie> MaikKlein: no, it's a macro that takes a template for implementing Eq and fills in all the blanks for you
[23:35:52] *** Quits: jclements (jclements@2557E599.66715431.D25A875A.IP) (Quit: jclements)
[23:35:57] <MaikKlein> ah ok , and thanks for the example 
[23:36:02] <MaikKlein> gonna read it now
[23:37:05] *** Joins: dylukes (dylukes@moz-E4DF3FED.pitbpa.fios.verizon.net)
[23:40:39] <MaikKlein> Owned means that I can put it on the exchange heap via  ~ ?
[23:40:53] <pcwalton> Owned just means you can send it
[23:41:13] <MaikKlein> ahh 
[23:41:14] <MaikKlein> okay
[23:43:31] *** Quits: Jesse (jruderman@2557E599.66715431.D25A875A.IP) (Ping timeout)
[23:44:47] *** Joins: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP)
[23:44:47] *** ChanServ sets mode: +o tjc
[23:45:01] *** Quits: graydon (Adium@A5087023.2354C43D.D8E68FF6.IP) (Quit: Leaving.)
[23:45:57] <MaikKlein> thanks bstrie I learned quite a lot.
[23:46:35] <steven_is_false> Hmm, C++ has the pointer to structure member functionality is there something similar to that for Rust?
[23:46:48] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[23:47:32] *** Quits: echristo (echristo@D423593A.D6CCE4AE.77834EAA.IP) (Quit: echristo)
[23:48:15] <erickt> steven_is_false: yeah, we can take pointers to members
[23:48:24] <erickt> rusti: struct A { x: int }; let a = A { x: 1 }; let x = &a.x
[23:48:27] -rusti- foo.rs:6:4: 6:5 error: expected `;` but found `}`
[23:48:27] -rusti- foo.rs:6     });
[23:48:27] -rusti-              ^
[23:48:33] <erickt> curses!
[23:48:40] <steven_is_false> erickt: No not a specific member but as an offset to the struct.
[23:49:27] <engla> it sounds like that would always be an unsafe pointer steven_is_false 
[23:49:49] *** Joins: RageOfThou (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[23:50:05] <erickt> steven_is_false:  ah. I'm not sure. I suppose technically you could take an unsafe pointer to the member and subtract it from the base pointer of the struct
[23:50:14] <erickt> steven_is_false: why would you want to do this though?
[23:50:28] <erickt> maybe there's a more rust ideomatic way of doing what you want
[23:50:30] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[23:50:30] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[23:50:43] <steven_is_false> erickt: Suppose one has a structure of keys that are either pressed, or not pressed.
[23:50:56] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[23:51:01] <steven_is_false> One would want to send from one task to another the specific key that was pressed.
[23:51:22] <steven_is_false> So one should simply send the pointer to the member of the struct representing the key.
[23:51:26] <MaikKlein> @bstrie okay something is weird,  let mut cs = ChanSet::new(); whats the type of cs? The signature is fn new() -> ChanSet<T> so cs it of type T?
[23:51:43] <erickt> steven_is_false: well first off, you can't send a pointer to a member between tasks
[23:51:54] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[23:52:02] *** Quits: RageOfThou (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[23:52:06] <steven_is_false> erickt: It'd be a static pointer.
[23:52:36] <steven_is_false> erickt: And it's not a pointer to an instance of a member it's the offset from the base of the struct to the member.
[23:53:19] <erickt> steven_is_false: wouldn't an vec be easier to do this sort of thing?
[23:53:36] *** Joins: Jesse (jruderman@2557E599.66715431.D25A875A.IP)
[23:53:39] <engla> why not represent the key pressed by an enum?
[23:53:52] <erickt> or that. Or use a bit vector
[23:53:54] <steven_is_false> engla: I'm actually doing that right now but it's a bit inelegant.
[23:54:30] <steven_is_false> key_pressed[AimCarefully as uint] is really just reimplementing the functionality myself.
[23:55:28] <MaikKlein> does anyone know what happens if I instantiate an object of type T without specifying T?
[23:55:47] *** Quits: Earnestly (earnest@6A917A59.5E1FD793.39C00A7A.IP) (Ping timeout)
[23:55:48] <erickt> steven_is_false: as opposed to (key_pressed + AimCarefully) to get to the right member?
[23:56:08] *** Quits: Jesse (jruderman@2557E599.66715431.D25A875A.IP) (Connection reset by peer)
[23:56:09] *** Joins: Jesse (jruderman@2557E599.66715431.D25A875A.IP)
[23:56:11] *** Quits: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP) (Quit: zzzzzzzzzz)
[23:56:42] <steven_is_false> erickt: I don't understand what you mean.
[23:57:31] <engla> MaikKlein: you can define variables, but they will not have values unless you assign to them
[23:57:56] <erickt> steven_is_false: Maybe I don't understand what you mean :)
[23:58:31] *** Joins: dbaupp (Thunderbir@moz-55402325.lns20.syd6.internode.on.net)
[23:58:41] <MaikKlein> oh ok
[23:58:43] <MaikKlein> crazy
[23:58:57] <bstrie> MaikKlein: cs there is of type `ChanSet<int>`
[23:59:15] <erickt> steven_is_false: do you have code online I could check out?
[23:59:45] <engla> MaikKlein: nothing crazy about just  let x: T;  which I thought you meant.
[23:59:47] <MaikKlein> but only at and after the line cs.send(5); right?
[23:59:49] <steven_is_false> erickt: I'm so close to releasing all the source publically.
[23:59:56] <erickt> :)
