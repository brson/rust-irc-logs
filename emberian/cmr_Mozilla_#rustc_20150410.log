[00:00:14] *** Joins: rprichard (rprichard@moz-imu4l1.en8f.d045.0009.2601.IP)
[00:44:23] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Quit: rcirc on GNU Emacs 24.3.92.1)
[00:48:40] *** Quits: arielb1 (Ariel@moz-0cbkg9.red.bezeqint.net) (Connection closed)
[00:52:42] *** Quits: brson (brson@moz-u3dg2t.sfo1.mozilla.com) (Ping timeout: 121 seconds)
[00:54:31] *** kimundi is now known as zz_kimundi
[02:41:54] *** Quits: zz_kimundi (kimundi@moz-vg3168.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:44:34] *** Joins: zz_kimundi (kimundi@moz-tts.3lo.188.87.IP)
[02:44:40] *** zz_kimundi is now known as kimundi
[02:57:23] *** Quits: aatch (james@moz-4tpcve.pd7t.fvcm.e000.2406.IP) (Quit: Leaving)
[03:35:35] *** Quits: Rym (y@moz-j0i.34a.55.31.IP) (Ping timeout: 121 seconds)
[03:50:18] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[04:02:10] *** Joins: Rym (y@moz-j0i.34a.55.31.IP)
[04:06:24] *** Quits: Rym (y@moz-j0i.34a.55.31.IP) (Ping timeout: 121 seconds)
[04:30:22] *** Joins: cengizIO (textual@moz-jju.ckp.250.151.IP)
[04:36:28] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[04:39:05] *** Quits: cengizIO (textual@moz-jju.ckp.250.151.IP) (Quit: Textual IRC Client: www.textualapp.com)
[04:39:19] *** Joins: cengizIO (textual@moz-jju.ckp.250.151.IP)
[04:56:18] *** Joins: Rym (y@moz-j0i.34a.55.31.IP)
[05:00:34] *** Quits: Rym (y@moz-j0i.34a.55.31.IP) (Ping timeout: 121 seconds)
[05:25:06] *** Quits: cengizIO (textual@moz-jju.ckp.250.151.IP) (Quit: Textual IRC Client: www.textualapp.com)
[05:32:35] *** Joins: cengizIO (textual@moz-jju.ckp.250.151.IP)
[05:32:41] *** Quits: cengizIO (textual@moz-jju.ckp.250.151.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[05:50:28] *** Joins: Rym (y@moz-j0i.34a.55.31.IP)
[05:54:44] *** Quits: Rym (y@moz-j0i.34a.55.31.IP) (Ping timeout: 121 seconds)
[05:56:56] *** Joins: brson (brson@moz-3mi.nja.110.38.IP)
[05:56:56] *** ChanServ sets mode: +qo brson brson
[06:41:18] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[06:44:34] *** Joins: Rym (y@moz-j0i.34a.55.31.IP)
[06:48:53] *** Quits: Rym (y@moz-j0i.34a.55.31.IP) (Ping timeout: 121 seconds)
[07:30:33] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[07:36:21] *** Quits: brson (brson@moz-3mi.nja.110.38.IP) (Ping timeout: 121 seconds)
[07:37:15] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[07:38:04] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Connection closed)
[07:39:21] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[07:48:59] <kmc> built libsyntax with afl instrumentation
[07:49:06] <kmc> now fuzzing the rust parser at 10,000 execs / second
[08:15:13] <Yurume> oh, great
[08:20:02] *** Joins: laumann (thomas@moz-33d.hq0.225.130.IP)
[09:09:54] <nrc> nmatsakis: I just put up PR gh24261
[09:10:16] <nrc> botbot: why you no botbot?
[09:10:25] <nmatsakis> nrc: I see, thanks
[09:10:46] <nrc> nmatsakis: it gets an r+ from me, but I thought you'd like a look
[09:11:03] <nmatsakis> k
[09:11:05] <nrc> especially as I had to redo the parts which interact with your recent EUV changes
[09:11:16] <nmatsakis> I'll read it right now
[09:12:08] <nrc> I'm not super-super happy with AutoDerefRef - I would like to capture more of the constraints in the datatype, but its hard to do without nested enums, etc. and I think it is better to leave it than to have complex match expressions all over the place
[09:12:17] <nmatsakis> nrc: ps in the comments I used ~T and ~Trait intentionally,
[09:12:23] <nmatsakis> to distinguish the "builtin Box" from Box
[09:12:29] <nmatsakis> but no big thing :)
[09:12:36] <nrc> I thought you were just being a hipster :-p
[09:13:01] <nmatsakis> I'm also not very happy with AutoDerefRef
[09:13:04] <nmatsakis> or AutoAdjustmet in particular
[09:13:10] <nmatsakis> I'd be happy to brainstorm with you sometime about it 
[09:13:11] <nrc> (actually assumed copy/paste from somewhere)
[09:13:39] <nrc> I hadn't thought about AutoAdjustment much
[09:13:50] <nrc> I want this all to disappear into the MIR!
[09:13:55] <nmatsakis> yes, me too
[09:14:00] <nmatsakis> that's partly why I've not put a lot of thought into how to do it better :)
[09:14:15] <nmatsakis> maybe it's better to just brainstorm about baby steps towards MIR
[09:14:42] <nrc> yeah
[09:15:07] <nrc> The MIR seems to be the one refactoring I'm having trouble envisaging an incremental approach to :-(
[09:15:07] <nmatsakis> nrc: so autoref/unsize are...interestingly entangled, but I guess this makes sense
[09:15:11] <nmatsakis> yeah I know :)
[09:15:15] <nmatsakis> I've actually done this before
[09:15:21] <nmatsakis> but int he opposite direction
[09:15:26] <nmatsakis> in a preivous life we had a compiler with only MIR
[09:15:34] <nmatsakis> and we introduced an AST-based optimization phase
[09:15:40] <nmatsakis> it was a pretty intense effort
[09:15:53] <nrc> I bet
[09:16:44] <nmatsakis> so in AutoDerefRef
[09:16:47] <nmatsakis> the idea is:
[09:16:49] <nmatsakis> you first do the derefs,
[09:16:52] <nmatsakis> then (optionally) an autoref,
[09:16:57] <nmatsakis> then you (optionally) unsize the result
[09:16:58] <nmatsakis> ?
[09:17:52] <nrc> No
[09:18:06] <nrc> You're doing either a ref/deref or an unsize
[09:18:17] <nrc> the unsize will include ref/deref
[09:18:29] <nrc> but unsize => derefs == 0
[09:18:43] <nrc> they are implicit in the type inside the unsize
[09:18:49] <nrc> there will be an autoref
[09:18:53] <nrc> (for unsize)
[09:19:08] <nrc> * will always
[09:19:16] <nrc> but I'm not sure if it is actually used
[09:19:34] <nrc> the refderef and unsize are basically just crammed together like this to share lots of code
[09:19:49] <nrc> I was toying with teasing them apart
[09:20:14] <nrc> but then I still want to share some stuff and we don't have nested enums with fields
[09:20:38] <nrc> So I settled on leaving a FIXME
[09:20:50] <nrc> and dreaming about MIRs
[09:22:46] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Quit: Leaving.)
[09:27:43] *** Joins: Rym (y@moz-l75t2m.range86-187.btcentralplus.com)
[09:30:26] <nmatsakis> hmm
[09:30:28] <nmatsakis> ok, let me re-read
[09:30:31] <nmatsakis> I thought it made sense before
[09:30:39] <nmatsakis> I hadn't read too deeply yet tho
[09:31:40] <nmatsakis> ah, Isee the fixme now
[09:31:48] *** Quits: Rym (y@moz-l75t2m.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[09:33:24] <nmatsakis> nrc: how does unsize => autoref work for something like ~T => ~Trait
[09:33:38] <nmatsakis> (that's still sort of hard-coded in this patch, right?)
[09:33:44] <nrc> the unsize type is ty_uniq<Trait>
[09:33:57] <nrc> autoref = 0
[09:34:07] <nrc> autoderef = 0
[09:34:32] <nrc> actually deref is 1
[09:35:05] <nrc> from above unsize => refs = 0
[09:35:11] <nrc> not derefs
[09:35:17] <nmatsakis> by 0, you mean None
[09:35:18] <nmatsakis> ?
[09:35:48] <nrc> yes
[09:35:54] <nrc> I need to fix the comment too
[09:37:49] <nrc> actually I think I am just wrong :-s
[09:41:05] <nmatsakis> nrc: certainly the comments in probe.rs suggest my interpretation
[09:41:19] <nrc> I was 'right' the first time
[09:41:38] <nrc> unsize => derefs == 0, autoref == Some(_)
[09:41:42] <nmatsakis> https://github.com/rust-lang/rust/pull/24261/files#diff-dd3531c645441fc4588d997838e391f5R74
[09:42:01] <nmatsakis> I'm going to build locally and experiment, that doesn't seem right
[09:42:04] <nmatsakis> e.g. if you have
[09:42:11] <nmatsakis> Box<Box<[i32;N]>>
[09:42:17] <nmatsakis> and you call a method on &[i32]
[09:42:30] <nmatsakis> I'd expect you need two autoderefs
[09:42:47] <nmatsakis> makes sense to do the unsize on the fat pointer, after the autoref, though
[09:42:54] <nmatsakis> I always thought of it coming before
[09:44:35] <nrc> I think Box<> works like DST structs, i.e., by walking the types in parallel rather than using derefs
[09:45:05] <nrc> or maybe not
[09:47:03] <nrc> looking at coerce_unsized(), the Box<> case will have derefs = 0
[09:49:42] <nrc> sorry, my comment in ty is very confused
[09:50:06] <nrc> I think the Box case is special cased somewhat
[09:50:14] *** Joins: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP)
[09:50:15] *** ChanServ sets mode: +o pnkfelix
[10:03:07] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[10:04:14] *** Quits: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP) (Ping timeout: 121 seconds)
[10:12:38] <nrc> nmatsakis: I wrote an essay on AutoDerefRef, I hope it is now accurate
[10:12:49] <nrc> I am less happy than I was before
[10:13:01] <nmatsakis> ok, I'm still building locally, was planning to read a bit more deeply
[10:13:06] <nmatsakis> ah, build is done
[10:13:11] <nrc> But I hope we will treat Box the same way as Rc etc., and then I will be more happy
[10:13:16] <nmatsakis> (but I'm going to have to go in a bit)
[10:13:23] <nmatsakis> right, presumably we will when this is all done
[10:13:27] <nrc> I should go to bed....
[10:13:34] <nmatsakis> ok, I'll try to r? this today
[10:13:41] <nrc> thanks
[10:13:54] <nmatsakis> (I'd like to take the time to actually understand it though)
[10:14:02] <nmatsakis> there's always been tons of bugs around this stuff (shocking, I know)
[10:18:55] *** Joins: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP)
[10:18:55] *** ChanServ sets mode: +o pnkfelix
[10:21:42] *** Joins: Rym (y@moz-l75t2m.range86-187.btcentralplus.com)
[10:25:58] *** Quits: Rym (y@moz-l75t2m.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[10:28:27] *** Quits: nrc (nrc@moz-4bhi2i.xtra.co.nz) (Ping timeout: 121 seconds)
[11:04:58] *** Joins: nrc (nrc@moz-4bhi2i.xtra.co.nz)
[11:04:58] *** ChanServ sets mode: +qo nrc nrc
[11:15:51] *** Joins: Rym (y@moz-l75t2m.range86-187.btcentralplus.com)
[11:20:07] *** Quits: Rym (y@moz-l75t2m.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[11:36:08] *** Joins: Rym (y@moz-l75t2m.range86-187.btcentralplus.com)
[11:40:24] *** Quits: Rym (y@moz-l75t2m.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[11:54:58] *** Quits: laumann (thomas@moz-33d.hq0.225.130.IP) (Ping timeout: 121 seconds)
[12:02:00] *** Joins: laumann (thomas@moz-33d.hq0.225.130.IP)
[12:22:11] *** Quits: laumann (thomas@moz-33d.hq0.225.130.IP) (Quit: leaving)
[12:30:17] *** Joins: Rym (y@moz-l75t2m.range86-187.btcentralplus.com)
[12:34:33] *** Quits: Rym (y@moz-l75t2m.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[12:59:41] *** Joins: arielb1 (Ariel@moz-0cbkg9.red.bezeqint.net)
[13:17:32] *** Joins: Rym (y@moz-l75t2m.range86-187.btcentralplus.com)
[14:26:15] *** Quits: nrc (nrc@moz-4bhi2i.xtra.co.nz) (Ping timeout: 121 seconds)
[15:18:14] <kmc> https://github.com/rust-lang/rust/issues/24276
[15:18:26] <kmc> heap corruption in libsyntax parser, found with afl
[15:19:32] <nmatsakis> kmc: nice
[15:21:26] <steveklabnik> :confetti_ball:
[15:27:41] <kmc> steveklabnik: :rabbit: :hocho: :beetle:
[16:30:16] *** Joins: brson (brson@moz-3mi.nja.110.38.IP)
[16:30:16] *** ChanServ sets mode: +qo brson brson
[16:30:24] *** Quits: Rym (y@moz-l75t2m.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[16:51:25] *** Joins: Rym (y@moz-l75t2m.range86-187.btcentralplus.com)
[17:04:16] *** Joins: Rym_ (y@moz-l75t2m.range86-187.btcentralplus.com)
[17:05:07] *** Quits: Rym (y@moz-l75t2m.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[17:18:59] <sfackler> nice
[17:55:55] <kmc> oh man... I'm messing with the instrumentation, and I saved the .bc output for all rustc crates... so I can apply instrumentation and do codegen completely in parallel
[17:55:58] <kmc> this is amazing
[17:56:41] <kmc> we really should find a solution for "pipelining" rustc, so you can start building while your dependencies are doing codegen
[17:57:22] <kmc> I think that should be a feature of cargo, and rustc should provide a minimal protocol to support it
[17:57:53] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Connection closed)
[17:59:06] <kmc> e.g. rustc would write out foo.bytecode.deflate as a standalone file before entering trans
[17:59:12] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[17:59:32] <kmc> and when locating crates, would fall back to that file if a full crate can't be found
[17:59:52] <kmc> then cargo just has to notice the file's been created and kick off the next build
[18:00:48] <kmc> if a post-trans step requires the full crate then rustc itself will sleep until that's available
[18:16:33] *** Quits: brson (brson@moz-3mi.nja.110.38.IP) (Quit: leaving)
[18:17:43] <nmatsakis> kmc: interesting thought
[18:30:50] *** Joins: brson (brson@moz-u3dg2t.sfo1.mozilla.com)
[18:30:50] *** ChanServ sets mode: +qo brson brson
[18:49:38] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[19:07:44] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[19:14:59] *** Quits: Rym_ (y@moz-l75t2m.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[19:40:36] <kmc> just did llvm opt + codegen for libsyntax + librustc*, with afl bloat, in 1 minute 3 seconds at 319% CPU on a 4-core system
[19:41:46] <brson> kmc: is that good?
[19:41:59] <brson> are you using parallel codegen?
[19:42:03] *** Joins: Rym_ (y@moz-l75t2m.range86-187.btcentralplus.com)
[19:42:07] <kmc> no, I am using llc :)
[19:47:44] *** Quits: Rym_ (y@moz-l75t2m.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[20:06:08] *** Quits: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP) (Ping timeout: 121 seconds)
[20:11:59] *** Quits: acharles (acharles@moz-ulbdcn.ca.comcast.net) (Ping timeout: 121 seconds)
[20:36:27] *** Joins: Rym_ (y@moz-l75t2m.range86-187.btcentralplus.com)
[20:36:55] *** Joins: nrc (nrc@moz-4bhi2i.xtra.co.nz)
[20:36:55] *** ChanServ sets mode: +qo nrc nrc
[20:40:39] *** Quits: Rym_ (y@moz-l75t2m.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[20:52:08] *** Quits: blank_na1e (blank_name@moz-sct.ivp.36.50.IP) (Quit: leaving)
[20:56:26] *** Joins: blank_name (blank_name@moz-sct.ivp.36.50.IP)
[20:57:49] *** Quits: blank_name (blank_name@moz-sct.ivp.36.50.IP) (Quit: leaving)
[20:58:55] *** Joins: blank_name (blank_name@moz-sct.ivp.36.50.IP)
[21:30:35] *** Joins: Rym_ (y@moz-l75t2m.range86-187.btcentralplus.com)
[21:34:51] *** Quits: Rym_ (y@moz-l75t2m.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[21:55:18] *** Quits: brson (brson@moz-u3dg2t.sfo1.mozilla.com) (Quit: leaving)
[22:24:44] *** Joins: Rym_ (y@moz-l75t2m.range86-187.btcentralplus.com)
[22:29:00] *** Quits: Rym_ (y@moz-l75t2m.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[22:52:21] *** Joins: Rym_ (y@moz-l75t2m.range86-187.btcentralplus.com)
[22:54:56] *** Joins: brson (brson@moz-pla.c9m.56.172.IP)
[22:54:56] *** ChanServ sets mode: +qo brson brson
[23:06:06] *** Quits: arielb1 (Ariel@moz-0cbkg9.red.bezeqint.net) (Quit: Ex-Chat)
[23:29:51] *** Joins: p1start (p1start@moz-nftjhe.org)
[23:36:18] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[23:45:40] *** Quits: brson (brson@moz-pla.c9m.56.172.IP) (Ping timeout: 121 seconds)
[23:54:44] *** kimundi is now known as zz_kimundi
