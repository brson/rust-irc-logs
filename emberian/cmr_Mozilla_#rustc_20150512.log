[00:03:01] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[00:28:27] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[00:30:18] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[00:34:27] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[01:34:02] *** Joins: Rym (y@moz-o80acm.range86-189.btcentralplus.com)
[02:14:24] *** Quits: zz_kimundi (kimundi@moz-krnn6s.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:15:29] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[02:15:43] *** Quits: Rym (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[02:16:04] *** Joins: zz_kimundi (kimundi@moz-ocelec.dip0.t-ipconnect.de)
[02:16:05] *** zz_kimundi is now known as kimundi
[02:38:28] *** Joins: frewsxcv_ (uid86219@moz-dneii9.brockwell.irccloud.com)
[02:41:05] *** Quits: frewsxcv (frewsxcv@moz-lr4.h2r.241.192.IP) (Quit: ZNC - http://znc.in)
[02:41:06] *** frewsxcv_ is now known as frewsxcv
[02:41:15] *** Quits: frewsxcv (uid86219@moz-dneii9.brockwell.irccloud.com) (Quit: )
[02:41:21] *** Joins: frewsxcv (uid86219@moz-dneii9.brockwell.irccloud.com)
[03:09:27] *** Joins: p1start (p1start@moz-nftjhe.org)
[03:25:10] *** Joins: quantheory (quantheory@moz-dsb104.crel.jtvf.0001.2601.IP)
[04:05:37] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Connection closed)
[04:06:08] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[04:34:49] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[04:57:54] *** Quits: quantheory (quantheory@moz-dsb104.crel.jtvf.0001.2601.IP) (Quit: Leaving)
[05:02:06] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[05:06:22] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[05:56:15] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[06:00:31] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[06:10:40] *** Quits: eddyb_ (eddyb@moz-egg.q07.26.188.IP) (Ping timeout: 121 seconds)
[06:50:26] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[06:54:42] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[07:44:34] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[07:48:50] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[08:07:53] *** Joins: doener (doener@moz-929cn9.unity-media.net)
[08:21:24] *** Joins: eddyb (Mibbit@moz-gua2rr.lbi.ro)
[08:38:43] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[08:43:01] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[08:55:58] *** Joins: laumann (thomas@moz-1i4.hq0.225.130.IP)
[09:32:54] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[09:37:09] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[10:14:20] *** Quits: eddyb (Mibbit@moz-gua2rr.lbi.ro) (Quit: http://www.mibbit.com ajax IRC Client)
[10:27:02] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[10:27:57] *** Quits: nrc (nrc@moz-9luh02.xtra.co.nz) (Ping timeout: 121 seconds)
[10:31:20] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[10:37:28] *** Quits: stl (stl@moz-fg4.kee.15.176.IP) (Ping timeout: 121 seconds)
[10:46:57] *** Joins: stl (stl@moz-b99.508.15.176.IP)
[10:51:00] *** Quits: stl (stl@moz-b99.508.15.176.IP) (Ping timeout: 121 seconds)
[10:57:26] *** Joins: stl (stl@moz-h0r.qae.15.176.IP)
[11:08:06] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[11:20:39] *** Joins: eddyb_ (eddyb@moz-egg.q07.26.188.IP)
[11:21:11] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[11:23:24] *** Joins: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP)
[11:23:24] *** ChanServ sets mode: +o pnkfelix
[11:25:29] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[11:28:48] *** eddyb_ is now known as eddyb
[12:15:21] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[12:19:39] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[13:09:32] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[13:13:48] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[13:20:55] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[14:48:17] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[14:58:11] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[15:14:26] *** Quits: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP) (Ping timeout: 121 seconds)
[15:24:31] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[15:28:25] *** Quits: laumann (thomas@moz-1i4.hq0.225.130.IP) (Quit: leaving)
[15:49:19] *** Joins: eddyb_ (eddyb@moz-egg.q07.26.188.IP)
[15:49:51] *** Quits: eddyb (eddyb@moz-egg.q07.26.188.IP) (Connection closed)
[16:32:42] *** eddyb_ is now known as eddyb
[17:08:49] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[17:32:17] *** Joins: arielb1 (Mibbit@moz-qqq0k1.tau.ac.il)
[18:36:38] *** Joins: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net)
[18:36:38] *** ChanServ sets mode: +o pnkfelix
[18:45:04] *** Joins: simukis1 (nagisa@moz-8t068g.static.zebra.lt)
[18:45:09] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Connection closed)
[19:24:28] *** Quits: arielb1 (Mibbit@moz-qqq0k1.tau.ac.il) (Quit: http://www.mibbit.com ajax IRC Client)
[19:38:10] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Quit: rcirc on GNU Emacs 24.5.1)
[19:53:03] *** Joins: arielb1 (Ariel@moz-2trv48.red.bezeqint.net)
[20:03:51] *** Joins: p1start (p1start@moz-nftjhe.org)
[20:05:46] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[20:06:29] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[20:19:55] *** Joins: nrc (nrc@moz-9luh02.xtra.co.nz)
[20:19:55] *** ChanServ sets mode: +qo nrc nrc
[20:28:10] *** Quits: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com) (Ping timeout: 121 seconds)
[20:36:10] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[20:37:57] *** Joins: blank_na1e (blank_name@moz-9koqv8.mi.frontiernet.net)
[20:39:09] *** Joins: Rym_ (y@moz-o80acm.range86-189.btcentralplus.com)
[20:40:16] *** Quits: blank_name (blank_name@moz-th6.t75.79.172.IP) (Ping timeout: 121 seconds)
[21:06:37] *** Joins: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net)
[21:06:37] *** ChanServ sets mode: +o pnkfelix
[21:38:41] <doener> eddyb: aatch: nmatsakis: any opinion on what an intrinsic that does an non-inbounds GEP should be called? The inbounds one is called offset(). I'm currently using wrapping_offset (because non-inbounds GEP wrap using two's complement arithmetic), but somehow that feels weird.
[21:41:29] *** Quits: eddyb (eddyb@moz-egg.q07.26.188.IP) (Ping timeout: 121 seconds)
[21:42:36] <nrc> I agree wrapping_ is weird
[21:42:48] <nrc> do we still allow inline LLVM ir?
[21:43:56] <huon> nrc: no
[21:44:11] <huon> there's been at least one patch written for it in the past
[21:44:15] <huon> (fwiw)
[21:44:23] <nmatsakis> doener: hmm I don't know but wrapping doesn't ... quite convey it to me
[21:44:33] <nrc> oh, we never had it, there were just proposed patches?
[21:44:38] *** Joins: eddyb (eddyb@moz-egg.q07.26.188.IP)
[21:45:03] <huon> nrc: I'm not sure they were even submitted as PRs, but I definitely saw some code on someone's branch
[21:45:35] <nmatsakis> doener: I'm curious what is the "use case" exactly
[21:45:53] <nmatsakis> maybe it suggests a better name
[21:46:24] <doener> nmatsakis: we're special casing e.g. iterators for zero sized types, because (inbounds) GEPs do not work for those (every offset results in the same pointer)
[21:46:41] <nrc> So, I fear a little bit going down a slippery slope where we have intrinsics for every LLVM opcode, wondering if we should have a more general solution?
[21:46:59] <doener> nmatsakis: so we're using ptrtoint, arith, inttoptr (i.e. x as usize, x += 1, x as *const _)
[21:47:07] <doener> nmatsakis: and that doesn't optimize very well
[21:47:18] <nmatsakis> doener: "pointer_arithmetic" ;)
[21:47:22] <nmatsakis> yeah, makes sense
[21:47:53] <nmatsakis> nrc: I know what you mean, though I also fear bringing a sledgehammer like inline asm to bear, Ig uess it depends on how many LLVM intrinsics we wind up re-exporting
[21:47:54] <doener> nmatsakis: I tried using a non-inbounds gep (casting the pointer to i8*) and that optimizes well, and chandlerc on #llvm agreed that this is the way to go
[21:48:16] <nmatsakis> doener: perhaps "raw_offset"? I guess that' snot especially suggestive either
[21:48:17] <nmatsakis> clearly offset2
[21:48:36] <doener> offset2! How could I not think of that :-D
[21:49:44] <doener> unchecked_offset?
[21:49:56] <nmatsakis> yeah, it's not like the other one is "checked"
[21:50:04] <doener> right
[21:50:11] <doener> it just results in UB
[21:50:27] <nrc> Yeah, I'm not really in favour of allowing inline LLVM ir, but the opposition to that is locking us too closely to LLVM, but having a bunch of such intrinsics will do the same thing, just with a larger API
[21:51:21] <nmatsakis> doener: safe_offset :)
[21:51:54] <doener> nmatsakis: for the non-inbounds one?
[21:52:18] <nmatsakis> that's what I meant, but I was joking.
[21:52:28] <nmatsakis> it is safer, though, right?
[21:52:37] <nmatsakis> that is, the one we have now must be used in specific ways or fear UB
[21:53:09] <nmatsakis> nrc: I guess the quesiton is how "portable" these sort of concepts are -- cerainly one could trivially reimplement offset/wrapped_offset in other systems, though in the end both might wrap to the "raw pointer arith" version, since I guess the requirements for the "inbounds" variant might not line up
[21:53:47] <doener> nmatsakis: only a wee bit. The current one can lead to UB by just offsetting in a bad way, the new one can still lead to UB by dereferencing
[21:54:04] <nmatsakis> doener: well ok but I thought that went without saying (the derefencing part)
[21:54:20] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Quit: rcirc on GNU Emacs 24.5.1)
[21:54:24] <nmatsakis> anyway it seems clear we have no perfect name at hand...
[21:54:38] <nmatsakis> I sort of like a name that ties to "pointer arithmetic" or just "pointer_add"
[21:54:38] <doener> nmatsakis: yeah, but from a user's POV, "safe" might imply that deref is ok as well
[21:54:40] <nmatsakis> something like that
[21:54:44] <nmatsakis> yes, I know, safe is too much
[21:54:45] <nmatsakis> safer_offset
[21:54:51] <doener> nmatsakis: I think arith_offset sounds good
[21:55:04] <doener> it's an offset based purely on arithmetic
[21:55:08] <nmatsakis> right
[21:55:13] <doener> the pointer itself may be complete garbage
[21:55:48] <doener> so your initial pointer_arithmetic suggestion was really good infact
[21:56:06] <nmatsakis> wfm
[21:56:58] <doener> ok, I'll go with arith_offset for the PR. Might take a day or two for me to submit it, need to audit for uses of "as usize" etc.
[21:57:02] <doener> thanks a lot!
[22:31:40] *** Joins: acharles (acharles@moz-dvfnah.static.qwest.net)
[22:33:40] *** Quits: acharles (acharles@moz-dvfnah.static.qwest.net) (Client exited)
[22:33:45] *** Joins: acharles (acharles@moz-dvfnah.static.qwest.net)
[22:37:38] <nrc> I wonder if we can make rebuilds faster by being smarter about which crates we recompile. AIUI, we have fine grained dep info but don't use it
[22:55:04] *** Quits: doener (doener@moz-929cn9.unity-media.net) (Ping timeout: 121 seconds)
[22:56:04] *** Joins: doener (doener@moz-929cn9.unity-media.net)
[22:58:45] <brson> huh, i didn't realize that
[23:24:19] <nmatsakis> nrc: fine-grained between crates?
[23:24:27] <nmatsakis> at least for me, the killer is typically: rebuild rustc, have to rebuild everything else
[23:24:42] <nrc> right
[23:25:22] <aatch> nrc, intrinsics don't really lock us into LLVM, even if they're just "re-exports" of the LLVM intrinsics. I mean, many LLVM intrinsics are simply there for clang intrinsics. Or they're maths functions that may be implemented in hardware.
[23:25:33] *** Quits: arielb1 (Ariel@moz-2trv48.red.bezeqint.net) (Quit: Ex-Chat)
[23:26:08] <aatch> I mean, I don't think the existence of a `sin` intrinsic that produces a `llvm.sin.*` call locks us into LLVM in any way.
[23:26:22] <nrc> we have better dep info for doing the incremental  codegen stuff, I wonder if we could save that in metadata and use that to skip some rebuilding
[23:27:07] <nrc> aatch I'm more worried about intrinsics for llvm opcodes rather than for llvm intrinsics
[23:27:21] <nrc> which don't lock us in too much
[23:27:33] <nrc> but the end game is ugly enough that I worry about it
[23:29:34] <nrc> a little bit
[23:29:44] <nrc> it doesn't keep me up at night :-)
[23:31:49] <aatch> I don't think it's anything to worry about. A good example is that I've got some code that has "intrinsics" implemented in inline asm, but have pure-rust implementations of them as well. Just because the function is wrapping a single x86 instruction, it doesn't tie the functionality to x86
[23:50:04] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[23:55:02] *** kimundi is now known as zz_kimundi
