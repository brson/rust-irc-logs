[00:03:40] *** Quits: arielb1 (Ariel@moz-1sjtp8.red.bezeqint.net) (Quit: Ex-Chat)
[00:48:11] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[00:51:19] <nrc> jroesch: sure, just ping me on the PR
[00:52:15] <jroesch> sounds good, this patch is around 500+/500- so I think I'm gonna spin it out into a PR soon, and continue the rest of the work separate 
[01:09:16] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[01:30:39] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[02:34:12] *** Quits: kimundi (kimundi@moz-9b6hhf.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:34:47] *** Joins: kimundi (kimundi@moz-2dkqph.dip0.t-ipconnect.de)
[02:55:31] *** Joins: c74d3 (c74d3a4ebb6@moz-o33jt5.mggc.hibn.4404.2002.IP)
[02:56:44] *** Quits: c74d (c74d3a4ebb6@moz-0ersgu.oc.cox.net) (Ping timeout: 121 seconds)
[02:56:53] *** c74d3 is now known as c74d
[03:13:45] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[03:29:30] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[04:17:11] *** Quits: aatch (james@moz-i1k1ks.tlms.2o1v.e006.2406.IP) (Connection closed)
[04:20:23] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[05:06:53] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[05:36:08] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[06:27:07] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[06:36:10] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[07:04:21] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[07:38:35] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[08:07:03] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[08:55:00] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[10:18:14] <eddyb> jroesch: I'm bored enough to turn tidy's complaints into comments manually
[10:18:27] <eddyb> which makes me wonder, couldn't we have a tidy bot which does this automatically?
[10:45:23] *** Joins: laumann (thomas@moz-poa.3kq.109.2.IP)
[13:25:17] *** Quits: c74d (c74d3a4ebb6@moz-o33jt5.mggc.hibn.4404.2002.IP) (Connection closed)
[13:26:50] *** Joins: c74d (c74d3a4ebb6@moz-kn41j4.mggc.hibn.4404.2002.IP)
[14:56:08] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[15:37:28] *** Quits: laumann (thomas@moz-poa.3kq.109.2.IP) (Ping timeout: 121 seconds)
[16:25:45] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[17:23:46] *** Joins: sigma (sigma@moz-l8bauc.range217-44.btcentralplus.com)
[17:27:04] *** Quits: sigma (sigma@moz-l8bauc.range217-44.btcentralplus.com) (Connection closed)
[17:28:25] *** Joins: sigma (sigma@moz-l8bauc.range217-44.btcentralplus.com)
[17:34:20] *** Quits: sigma (sigma@moz-l8bauc.range217-44.btcentralplus.com) (Connection closed)
[17:34:26] *** Joins: sigma (sigma@moz-l8bauc.range217-44.btcentralplus.com)
[17:35:06] *** Quits: sigma (sigma@moz-l8bauc.range217-44.btcentralplus.com) (Connection closed)
[17:35:15] *** Joins: sigma (sigma@moz-l8bauc.range217-44.btcentralplus.com)
[18:08:31] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Quit: leaving)
[18:32:37] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[18:35:13] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[19:05:05] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Quit: leaving)
[19:25:34] <nrc> eddyb: it's called rustfmt
[20:15:43] <eddyb> interesting
[20:39:40] *** Joins: arielb1 (Ariel@moz-2jg.ri7.19.46.IP)
[20:45:35] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[20:49:22] <jroesch> eddyb: no worries, I usually fix make tidy after all the other nits but the eddyb linting service is nice too ;) 
[20:49:45] <jroesch> nrc: I really want to have it automatically run on rustc some day soon :)
[20:50:21] <nrc> I intend to some time on that this month some time
[20:50:27] <nrc> *spend some
[20:52:01] <jroesch> cool, let me know if you want any help along the way
[20:52:31] <jroesch> eddyb: your suggestion about using the ty::move_by_default method causes a crash due to an assert
[20:52:41] <eddyb> that's interesting
[20:53:06] <eddyb> maybe it only works in some situations, and you might have thrown away distinguishing information
[20:53:40] <jroesch> I assume its because we are using it in contexts where inference is still happening and it asserts: `assert!(!self.needs_infer());`
[20:53:50] <eddyb> jroesch: ah!
[20:53:57] <eddyb> turn that into a conditional then :P
[20:54:02] <jroesch> that is in fact the line that crashes 
[20:54:05] <jroesch> ;)
[20:54:13] <eddyb> though in such cases, the result could be ambiguous
[20:54:39] <eddyb> jroesch: what calls it?
[20:58:01] <jroesch> in infer/mod.rs type_moves_by_default dispatches to the type 
[20:58:43] <eddyb> jroesch: I mean, what calls type_moves_by_default with an uninferred type?
[20:59:13] <eddyb> making a decision during intra-function typeck based on type_moves_by_default seems fragile at best
[20:59:26] <jroesch> https://github.com/rust-lang/rust/pull/26677/files#diff-2c724b1e1b5d4e23dff533c485f86c99R1320
[20:59:33] <jroesch> I purged the body
[20:59:38] <jroesch> but I still need to do resolution before hand
[20:59:39] <jroesch> its my bug
[20:59:46] <jroesch> typed 'dd' twice
[21:00:10] <eddyb> oh
[21:22:07] <jroesch> eddyb: so it appears to still crash I guess I was wrong
[21:22:25] <eddyb> jroesch: so what queries it?
[21:23:39] *** Quits: sigma (sigma@moz-l8bauc.range217-44.btcentralplus.com) (Ping timeout: 121 seconds)
[21:23:39] <jroesch> eddyb: rebuilding for a backtrace
[21:24:00] <eddyb> why would you need to rebuild to get a backtrace?
[21:24:48] <jroesch> I was messing around in another file, and I don't have RUST_BACKTRACE permanently set to 1
[21:26:08] <eddyb> touch -d 'last year' src/foo/bar/baz.rs is what I use to avoid triggering rebuilds
[21:26:38] <jroesch> yeah good point
[21:26:44] <jroesch> will keep that noted in the future
[21:27:10] <eddyb> took me ages to find out that `touch` had natural-ish language time/date support
[21:27:33] <jroesch> do you any opinions about EnumSet? Gankro wanted to delete it
[21:27:40] <jroesch> we only have that one use of it
[21:28:41] <eddyb> my opinion is that TyTrait should use a vector
[21:28:52] <eddyb> instead of special-casing 4 traits
[21:29:56] <eddyb> could limit to at most one non-empty-vtable trait for now
[21:29:57] <jroesch> eddyb: yeah Niko made a comment about regretting the uniformity of builtin traits but I would rather solve it via caching etc vs. having different passes or interfaces seems like it makes the compiler more complex then it needs to be
[21:30:52] <arielb1> jroesch: type_moves_by_default: if you remove type_needs_infer
[21:30:56] <arielb1> be sure to be careful with closures
[21:31:01] <eddyb> jroesch: we want to support TraitA + TraitB in the future so doing it right at the type level might as well be started now
[21:32:07] <eddyb> jroesch: oh, euv::copy_or_move is a likely suspect for type_moves_by_default
[21:32:34] <jroesch> arielb1: the current implementation works and passes all tests. I would like to use the eddyb's suggestion but I'm not super familiar in this area and don't want to accidentally introduce bugs
[21:32:54] <jroesch> eddyb: yeah it is middle::expr_use_visitor::copy_or_move
[21:33:05] <eddyb> so what's using EUV during typeck?
[21:33:06] <jroesch> just got a btrace
[21:33:17] <jroesch> upvar
[21:33:37] <jroesch> the upvar code calls into euv
[21:33:39] <eddyb> AdjustBorrowKind::analyze_closure
[21:33:49] <jroesch> yes
[21:33:49] <eddyb> that was easier than I thought, only one callsite
[21:33:59] <eddyb> (sorry for not grepping first)
[21:34:23] <jroesch> here is the gist https://gist.github.com/jroesch/b6a4d216744daa19ca39
[21:34:31] <jroesch> with the trace fyi
[21:35:09] <eddyb> it looks like only region inference variables should exist at that point
[21:35:29] <eddyb> so maybe the assert is too strict?
[21:36:50] <eddyb> (as in, assert!(!self.has_infer_types()) should work in that case, if I'm reading typeck::check::check_bare_fn right)
[21:40:14] <jroesch> I agree looking at check_bare_fn
[21:40:46] <huon> eddyb: what do you think about http://is.gd/B2D2iz ?
[21:42:25] <eddyb> huon: associated constants didn't get into 1.0 in time to allow replacing modules with the same name as primitive types, containing only constants
[21:42:39] <huon> eddyb: I know that
[21:42:46] <huon> I just want to know what you think about the resolution order
[21:43:00] <eddyb> there's nothing we can do about it AFAIK
[21:43:06] <huon> why not?
[21:43:21] <eddyb> because anything else would be stable breakage
[21:43:25] <huon> why?
[21:43:42] <huon> associated constants aren't stable
[21:43:51] <arielb1> jroesch: I just wanted to warn you that every place that is watching for type_needs_infer
[21:44:01] <arielb1> also needs to watch out for closures with uninferred upvars
[21:44:16] <jroesch> ah I get what your saying
[21:44:52] <jroesch> arielb1: there a plenty of places where I am a noob so any help is appreciated :)
[21:45:16] <arielb1> that leads to subtle and annoying bugs
[21:45:28] <eddyb> huon: yeah, but you can't change how u8::BITS is resolved. you can't make it use an associated constant, and you can't check for associated items in resolve
[21:46:17] <eddyb> there's a few different conditions conspiring to leave us stuck in this suboptimal state
[21:46:56] <eddyb> you could theoretically make `use std::u8; ... u8::BITS` work with associated constants
[21:47:09] <eddyb> but then `use std::u8::BITS;` would stop working
[21:47:25] <huon> why would that stop working?
[21:47:37] <eddyb> because associated items cannot be `use`d
[21:47:56] <eddyb> (that pattern more common with `use std::f32::PI;`, I guess)
[21:47:57] <huon> but... that path wouldn't be an associated item?
[21:48:05] <huon> it'd just be a deprecated module constant?
[21:48:14] <eddyb> then you haven't solved anything
[21:48:22] <huon> why not?
[21:48:22] <eddyb> because it would have to take precedence
[21:48:27] <eddyb> like it does right now
[21:48:37] <huon> I don't understand why it has to
[21:48:56] <eddyb> because it's a hack intended to make it work until it was fixed
[21:49:03] <huon> `use std::u8::BITS;` would resolve to the deprecated module constant
[21:49:16] <eddyb> it was never fixed and there isn't a way to fix it without replacing it with an associated constant
[21:49:18] <huon> `use std::u8; ... u8::BITS;` would resolve to th eassociated constant and the import would become unused
[21:49:26] <eddyb> huon: unless you suggest something more devious :P
[21:49:45] <huon> (introducing more lint warnings isn't something we consider a problem)
[21:50:27] <eddyb> the solution for deprecation that I had in mind was exporting type u8 = u8; from libstd
[21:52:35] <eddyb> huon: it might just work, if all paths that could refer to a constant support partial resolution
[21:53:16] <eddyb> it would be a good time to redo path resolution to keep advancing, module by module, until it hits a type
[21:53:35] <eddyb> (in the case of enums, you still have to give preferential treatment to variants)
[21:56:16] <eddyb> there's also the option of allowing explicit imports of associated items, but not importing them through globs
[21:58:11] <eddyb> I actually like that more than keeping around a module (but it's trickier to pull off correctly)
[21:59:40] <eddyb> huon: we also have that attribute (#[prelude_import] IIRC) which allows order-dependent glob import behavior. ChrisMorgan found it and it looks accidentally stable to me
[22:00:11] <eddyb> huon: if that remains stable, it's going to also make it hard to improve our resolve situation
[22:06:06] <nrc> filed an issue for that - fixing this kind of bug should be high priority
[22:06:30] <eddyb> did ChrisMorgan forget to?
[22:07:03] <nrc> I couldn't find anything - perhaps GH search is failing me - wouldn't be the first time
[22:08:16] <eddyb> nrc: he didn't report it - sorry, I should've checked when we discussed it (a couple days ago, I think)
[22:10:50] <eddyb> huon: there's also the problem of having multiple conflicting associated items in scope, though not specifically for constants, http://doc.rust-lang.org/std/str/ has two functions that could be methods
[22:11:00] <eddyb> ahh scratch it, that module is filled with types
[22:11:05] *** Quits: arielb1 (Ariel@moz-2jg.ri7.19.46.IP) (Quit: bye)
[22:12:10] <eddyb> huon: also, BITS and BYTES are unstable, but MIN and MAX aren't
[22:12:57] <eddyb> and std::f32::consts::PI is a thing. guess that makes the associated item import idea non-viable
[22:24:15] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Connection closed)
