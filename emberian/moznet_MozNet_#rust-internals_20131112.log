[00:11:24] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[00:11:24] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14bfe6f7b to 1488e383e: 02http://git.io/N3iJvQ
[00:11:24] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[00:11:25] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[00:11:25] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/nJdyuA
[00:11:25] <ghrust> 13rust/06auto 142eb92b7 15Alex Crichton: Add a flag to force generating toplevel crate map...
[00:11:25] <ghrust> 13rust/06auto 14c0b7972 15bors: auto merge of #10422 : alexcrichton/rust/explicit-crate-map, r=pcwalton...
[00:11:26] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[00:15:25] <acrichto> nmatsakis: ping
[00:34:00] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: zzzzzzzzzz)
[00:40:17] <nmatsakis> acrichto: pong
[00:42:12] *** Joins: brson (brson@5AB4884B.FCC4549.14D5B978.IP)
[00:42:13] *** ChanServ sets mode: +qo brson brson
[00:42:21] *** Quits: brson (brson@5AB4884B.FCC4549.14D5B978.IP) (Quit: leaving)
[00:42:25] *** Joins: brson (brson@5AB4884B.FCC4549.14D5B978.IP)
[00:42:25] *** ChanServ sets mode: +qo brson brson
[00:43:18] <acrichto> nmatsakis: you had mentioned a macro like do!() which does things with results, right?
[00:44:11] <nmatsakis> acrichto: I have mentioned such a macro from time to time...
[00:44:29] <nmatsakis> acrichto: ...in the compiler there is if_ok!, I have also made one that is more like do
[00:44:40] <acrichto> the idea was that you'd do something like do!(let a = foo(); let b = bar(); baz(a, b)), right?
[00:45:16] <acrichto> I was wondering what do!($expr) does
[00:45:26] <acrichto> does that retrun Result<T> or T ?
[00:45:39] <acrichto> assuming $expr has type Result<T>
[00:46:11] <nmatsakis> acrichto: it returns Result<T>
[00:46:15] <nmatsakis> acrichto: I can send you an exmaple one sec
[00:46:37] <nmatsakis> acrichto: https://github.com/nikomatsakis/typing-haskell-in-rust/blob/master/src/macro.rs
[00:46:45] <nmatsakis> acrichto: the seq! macro
[00:46:53] <acrichto> hm that's a much better name
[00:47:13] <acrichto> interesting! thanks
[00:47:14] <nmatsakis> acrichto: here is an example using it https://github.com/nikomatsakis/typing-haskell-in-rust/blob/master/src/unification.rs#L29
[00:47:37] <acrichto> I'm removing conditions from I/O and I found myself wanting macros like this
[00:47:50] <nmatsakis> I've been thinking a lot about HKT types lately,
[00:48:05] <nmatsakis> er, HK types I guess
[00:48:20] <acrichto> would that help this?
[00:48:22] <tikue> i like that sound of that :O)
[00:48:22] <nmatsakis> planning out how just what it means to add them
[00:48:30] <nmatsakis> well it would let us have a true `do` syntax a la haskell
[00:48:39] <acrichto> oh interesting!
[00:48:44] * acrichto knows very little about haskell
[00:48:56] <nmatsakis> you may know more than you think,
[00:48:59] <nmatsakis> just with rustic names :)
[00:49:10] <acrichto> hehe, I've found that happens a fair amount
[00:49:37] <nmatsakis> anyway, I think we will definitely want them to properly handle custom smart pointer types
[00:49:53] <nmatsakis> though we can skate by without them for a bit
[00:50:05] <acrichto> you had a blog post about HKT at some point, right?
[00:50:05] <nmatsakis> but of course now that they're on my mind, I see uses for them everywhere
[00:50:12] <acrichto> I need to get a concrete idea of what they are in my mind
[00:50:22] <nmatsakis> I think I mentioned them in one post,
[00:50:25] <nmatsakis> but not a post directly on them
[00:50:27] <nmatsakis> hopefully soon
[00:50:36] <nmatsakis> I'll try to throw in some background too
[00:50:37] * acrichto is excite
[00:50:48] <nmatsakis> but easiest way to think about is:
[00:50:54] <nmatsakis> imagine a generic like `struct Vec<T>`
[00:51:04] <nmatsakis> so, `Vec<int>` is a *type* -- but what is `Vec` without the <T>?
[00:51:11] <nmatsakis> answer: it's a higher-kinded type
[00:51:30] <nmatsakis> sort of like |x| x * 3 is an expression waiting for an argument
[00:51:41] <acrichto> oh interesting, what's an example of using it?
[00:53:00] <nmatsakis> so you're used to map being: fn map<T,U>(x: ~[T], f: |T| -> U) -> ~[U]
[00:53:06] <nmatsakis> but you could maybe define it more generically as
[00:53:15] <nmatsakis> fn map<C,T,U>(x: C<T>, f: |T| -> U) -> C<U>
[00:53:30] <nmatsakis> where C is a higher-kinded type: like a collection where the type of element is not yet specified
[00:53:39] <nmatsakis> this is not necessarily the right way to do map for various reasons, but it gets the idea
[00:53:40] <acrichto> interesting
[00:54:01] <acrichto> it seems like that kinda syntac could be done today though?
[00:54:02] <tikue> there are some threads in r/rust where they talk about doing things like that
[00:54:04] <acrichto> syntax*
[00:54:18] <nmatsakis> we can't give type parameters to a type parameter today
[00:54:21] <tikue> i remember specifically that current rust doesn't allow you do constrain it as much
[00:54:24] <nmatsakis> parsing though is not the challenge :)
[00:54:39] <acrichto> oh I see
[00:54:43] <acrichto> I think...
[00:54:49] <nmatsakis> it's actulaly not *especially* challenging in any case, just ... takes work. 
[00:54:52] <acrichto> I have a feeling if I tried to write that I would see why
[00:55:10] <nmatsakis> and I think there are higher priority things atm but hopefully we'll get through those
[00:55:13] <nmatsakis> :)
[00:55:38] <sfackler> nmatsakis: would this fall under HKT as well? fn foo<'a, T>(&'a self) -> T<'a>
[00:55:52] <tikue> http://www.reddit.com/r/rust/comments/1a57pw/haskeller_playing_with_rust_a_question_about/
[00:55:55] <nmatsakis> sfackler: yes
[00:55:57] <tikue> i found that thread interesting about this
[00:56:15] <nmatsakis> sfackler: T there has kind `LT => *` where LT is lifetime...
[00:58:32] *** Quits: Jesse_ (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse_)
[01:00:54] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[01:00:54] *** ChanServ sets mode: +o tjc
[01:09:00] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[01:09:00] *** ChanServ sets mode: +ao pcwalton pcwalton
[01:10:11] <pcmattman> acrichto: r https://github.com/mozilla/rust/pull/10109 ? or better to wait for #10423 to land and rebase?
[01:10:55] <acrichto> pcmattman: you're done rebasing and waiting :P
[01:11:47] <acrichto> hm it says it still can't get merged
[01:12:01] <acrichto> pcmattman: r+, but it looks like it needs anothe rrebase
[01:12:15] <pcmattman> no worries
[01:12:40] <acrichto> if you do it in the next ~5 mins you'll get in before 10423!
[01:12:48] <acrichto> quick, rebase like the wind!
[01:13:14] <pcmattman> rebase like never before!
[01:13:56] *** Quits: jeffdb (jeff@moz-9D2E3B02.hsd1.wa.comcast.net) (Quit: jeffdb)
[01:16:16] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[01:16:16] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/nJdyuA
[01:16:16] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[01:17:34] *** Quits: tikue_ (quassel@moz-FEADCD38.hsd1.pa.comcast.net) (Quit: No Ping reply in 180 seconds.)
[01:17:39] <cmr> acrichto: are you working on static linking?
[01:17:47] <acrichto> cmr: sadly no :(
[01:17:53] <acrichto> I have thought much about it in the past though
[01:17:59] <pcmattman> acrichto: pushed!
[01:18:24] <acrichto> pcmattman: now let's see if bors is currently running or will pick it up
[01:18:33] <cmr> acrichto: is there trickiness associated with it?
[01:19:07] <acrichto> cmr: I think that some of my largest concerns may have been addressed by stopping propagation of link arguments
[01:19:35] *** Joins: tikue_ (quassel@moz-FEADCD38.hsd1.pa.comcast.net)
[01:19:38] <acrichto> cmr: it's not going to be a small change though
[01:20:02] <cmr> I haven't thought about it at all, I can't imagine what the problems would be though.
[01:20:08] <acrichto> I was thinking last night that we should have a src/test/fancy directory which is just directories of makefiles to run tests out of
[01:20:12] <acrichto> that may be useful for static linking...
[01:20:35] <acrichto> I mostly just thought of problems by starting with a use case and seeing what it woul dneed
[01:20:52] <acrichto> so let's say distribution-wise for lib{std,extra}
[01:21:03] <acrichto> we want to distribute lib{std,extra}.{a,dylib}
[01:21:05] <acrichto> and that's it
[01:21:18] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[01:21:18] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/LFBv_Q
[01:21:18] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[01:21:21] <acrichto> but whenever you link to libextra.a, you must also link to libstd.a
[01:21:23] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[01:21:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/bm9TTA
[01:21:23] <ghrust> 13rust/06auto 146527f1a 15Matthew Iselin: Implemented a ProcessExit enum and helper methods to std::rt::io::process for getting process termination status, or the signal that terminated a process....
[01:21:23] <ghrust> 13rust/06auto 1456003ab 15bors: auto merge of #10109 : pcmattman/rust/pass-nonzero-exit-status-on-termination-by-signal, r=alexcrichton...
[01:21:24] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[01:21:24] <pcmattman> acrichto: you might need to re-r that (just noticed I accidentally removed a FIXME comment in a merge conflict, don't like that)
[01:21:29] <pcmattman> aw
[01:21:30] <acrichto> so that's something that'll have to get thrown in the metadata
[01:22:02] <acrichto> pcmattman: I'll cancel all the current builds
[01:22:36] <pcmattman> sorry! I should've checked the diffs more closely :)
[01:22:42] <acrichto> oh not a problem at all
[01:23:42] <cmr> rusti: let x = ~[1f64, 2, 3];
[01:23:44] -rusti- pastebinned 8 lines of output: http://sprunge.us/jMZg
[01:23:48] <cmr> Why is that a problem :(
[01:23:55] <cmr> (it's the same on master)
[01:24:12] <strcat> 2 is a generic int literal
[01:24:17] <strcat> will never be inferred to be a float
[01:24:18] <acrichto> I think that 1 is an integral literal which can only get inferred to a integer type
[01:24:24] <cmr> that's super obnoxious
[01:24:35] <acrichto> strcat: did you run into issues upgrading rusti?
[01:24:37] <strcat> in haskell 1 is Num, so it will happily become either
[01:24:39] <strcat> acrichto: yes
[01:24:47] <strcat> acrichto: same issue as before afaict
[01:24:54] <acrichto> infinite looping?
[01:25:08] <strcat> well it doesn't infinite loop, it calls futex and never wakes up
[01:25:21] <acrichto> did you check the cpu usage?
[01:25:46] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[01:25:49] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:25:50] <acrichto> I straced it once and it halted in futex something or other but when I just ran it it ate a cpu core
[01:25:51] <strcat> rusti: 2
[01:25:51] -rusti- 2
[01:25:55] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[01:26:06] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:26:06] <strcat> rusti: 2
[01:26:15] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[01:26:15] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1456003ab to 14c0b7972: 02http://git.io/N3iJvQ
[01:26:15] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[01:26:21] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[01:26:21] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/ykvnBw
[01:26:21] <ghrust> 13rust/06auto 1438a4502 15Matthew Iselin: Implemented a ProcessExit enum and helper methods to std::rt::io::process for getting process termination status, or the signal that terminated a process....
[01:26:21] <ghrust> 13rust/06auto 14f655a3e 15bors: auto merge of #10109 : pcmattman/rust/pass-nonzero-exit-status-on-termination-by-signal, r=alexcrichton...
[01:26:22] <strcat> acrichto: no it doesn't use CPU
[01:26:23] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[01:26:24] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[01:26:29] <acrichto> hm interesting
[01:26:39] <strcat> acrichto: it just calls futex and nothing ever releases the lock
[01:26:51] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Broken pipe)
[01:26:57] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[01:27:01] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:28:02] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Connection reset by peer)
[01:28:13] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[01:30:56] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[01:35:19] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[01:36:15] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[01:36:16] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14f655a3e to 14c0b7972: 02http://git.io/N3iJvQ
[01:36:16] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[01:36:20] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[01:36:20] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/dHumnQ
[01:36:20] <ghrust> 13rust/06auto 142a63685 15Alex Crichton: Move std::rt::io to std::io
[01:36:20] <ghrust> 13rust/06auto 14d103c7b 15bors: auto merge of #10423 : alexcrichton/rust/move-io, r=pcwalton...
[01:36:20] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[01:37:22] <cmr> woo!
[01:37:38] <tikue> \o/
[01:45:32] <kmc> nice
[01:53:42] <pcmattman> acrichto: if that doesn't land, I fixed up the issues that caused the failure in #10109 (not sure how I messed up the merge, but it's unbroken again)
[01:54:07] * pcmattman is also very curious to see what it does on Windows
[02:08:15] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Quit: pcwalton)
[02:09:53] <acrichto> hm, I should actually run stdtest on moving std::rt::io
[02:10:03] * acrichto begins the long process of 20 failed merge commits
[02:11:18] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[02:11:18] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d103c7b to 14c0b7972: 02http://git.io/N3iJvQ
[02:11:18] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[02:11:22] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[02:11:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/mLEMlg
[02:11:23] <ghrust> 13rust/06auto 14f698dec 15Matthew Iselin: Implemented a ProcessExit enum and helper methods to std::rt::io::process for getting process termination status, or the signal that terminated a process....
[02:11:23] <ghrust> 13rust/06auto 1486787f8 15bors: auto merge of #10109 : pcmattman/rust/pass-nonzero-exit-status-on-termination-by-signal, r=alexcrichton...
[02:11:24] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[02:16:32] *** kimundi is now known as zz_kimundi
[02:19:02] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[02:19:25] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[02:19:25] *** ChanServ sets mode: +ao pcwalton pcwalton
[02:20:59] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[02:23:21] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[02:35:51] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[02:36:06] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[02:37:29] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[02:37:44] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[02:39:08] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[02:51:28] *** Quits: tikue (tikue_star@275DC78D.2ACBBF24.689607DE.IP) (Ping timeout)
[02:59:41] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Quit: pcwalton)
[03:00:41] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[03:00:41] *** ChanServ sets mode: +ao pcwalton pcwalton
[03:01:03] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Quit: pcwalton)
[03:01:19] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[03:01:19] *** ChanServ sets mode: +ao pcwalton pcwalton
[03:02:52] *** Joins: jeffdb (jeff@moz-9D2E3B02.hsd1.wa.comcast.net)
[03:04:53] *** Joins: tikue (tikue_star@275DC78D.2ACBBF24.689607DE.IP)
[03:06:14] *** Quits: jeffdb (jeff@moz-9D2E3B02.hsd1.wa.comcast.net) (Quit: jeffdb)
[03:13:00] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[03:15:42] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[03:16:30] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[03:17:37] *** Quits: geoffhill (geoffhill@moz-738DC0DB.org) (Quit: )
[03:21:07] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Quit: pcwalton)
[03:21:15] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[03:21:15] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/mLEMlg
[03:21:15] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[03:22:18] <dbaupp> pcmattman: \o/
[03:22:48] <pcmattman> yay :)
[03:26:14] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[03:26:15] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/u1V6-w
[03:26:15] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[03:26:18] *** Quits: brson (brson@5AB4884B.FCC4549.14D5B978.IP) (Ping timeout)
[03:31:18] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[03:31:18] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/u1V6-w
[03:31:18] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[03:31:23] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[03:31:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/pz4rJg
[03:31:23] <ghrust> 13rust/06auto 14cdf7d63 15Alex Crichton: Optimize creation of buffered readers/writers...
[03:31:23] <ghrust> 13rust/06auto 148b4683d 15bors: auto merge of #10424 : alexcrichton/rust/optimize-buffered, r=brson...
[03:31:23] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[03:32:31] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[03:36:22] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[03:37:00] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[03:38:15] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[03:42:23] *** Quits: zz_kimundi (kimundi@moz-7464178B.dip0.t-ipconnect.de) (Ping timeout)
[03:46:15] *** Joins: zz_kimundi (kimundi@moz-93826068.dip0.t-ipconnect.de)
[03:46:16] *** zz_kimundi is now known as kimundi
[03:55:11] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[03:58:02] *** Joins: eddyb (eddy@336E3A7F.D51DAF03.FB866788.IP)
[04:09:28] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[04:25:06] *** Joins: ktt3ja (Mibbit@moz-6B6EE8C0.hsd1.va.comcast.net)
[04:31:44] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[04:34:35] *** Joins: brson (brson@5AB4884B.FCC4549.14D5B978.IP)
[04:34:36] *** ChanServ sets mode: +qo brson brson
[04:36:13] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[04:36:13] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/pz4rJg
[04:36:13] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[04:36:19] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[04:36:19] *** ChanServ sets mode: +ao pcwalton pcwalton
[04:39:51] *** Quits: brson (brson@5AB4884B.FCC4549.14D5B978.IP) (Ping timeout)
[04:41:14] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[04:41:14] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/yDuDEA
[04:41:14] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[04:45:39] <klutzy> in rustc phase 3, are checkers order-sensitive? I'm curious if some checkers should be passed before others
[04:46:15] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[04:46:15] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/yDuDEA
[04:46:15] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[04:46:21] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[04:46:21] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/6L2lfw
[04:46:21] <ghrust> 13rust/06auto 142d6ef29 15Leah Hanson: Removed test issue-912.rs...
[04:46:21] <ghrust> 13rust/06auto 14ba4bf7e 15Leah Hanson: Remove run-pass/issue-3907-2.rs...
[04:46:21] <ghrust> 13rust/06auto 14a5b6d8d 15Leah Hanson: Remove test issue-3461...
[04:46:23] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[04:46:26] <dbaupp> klutzy: "checkers"?
[04:46:57] <klutzy> dbaupp: check_const, check_match, lint, etc
[04:47:12] *** Joins: brson (brson@5AB4884B.FCC4549.14D5B978.IP)
[04:47:12] *** ChanServ sets mode: +qo brson brson
[04:48:28] <dbaupp> klutzy: I know lint uses information from some previous passes, so that definitely has to go towards the end.
[04:48:43] <klutzy> dbaupp: on #10304, check_match beeps if unreachable pattern exists. then rustc stops any further progress so lint is not called
[04:49:34] <klutzy> so to fix the issue we have to change something but I'm not sure how
[04:49:50] <dbaupp> klutzy: yeah, I've thought about this wrt #7526, and I haven't come up with a good solution other than just putting the logic into the place that generates that error.
[04:50:20] <dbaupp> i.e. not doing it as a normal lint (which means that part can't be #[allow]'d, etc, unfortunately.)
[04:58:04] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[04:58:04] <ghrust> 01[13rust01] 15catamorphism 04force-pushed 06try from 1487df504 to 143910dfc: 02http://git.io/k471pw
[04:58:04] <ghrust> 13rust/06try 143910dfc 15Tim Chevalier: rustpkg: Eliminate the spurious `os::path_exists(&pkg_src.start_dir.join(p))` assertion failure...
[04:58:04] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[05:00:47] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[05:00:47] <ghrust> 01[13rust01] 15catamorphism 04force-pushed 06try from 143910dfc to 143af2c9a: 02http://git.io/k471pw
[05:00:47] <ghrust> 13rust/06try 143af2c9a 15Tim Chevalier: rustpkg: Un-ignore test_install_invalid_external and test_install_invalid...
[05:00:47] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[05:05:49] <tjc> klutzy: yes, in general they are order-sensitive. It would be better to document what phases depend on what parts of the type context...
[05:05:53] <tjc> but it's not documented yet as far as I know
[05:13:01] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Quit: pcwalton)
[05:23:23] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[05:23:24] *** ChanServ sets mode: +ao pcwalton pcwalton
[05:23:32] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[05:25:00] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[05:27:52] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[05:37:31] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[05:37:31] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[05:38:19] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[05:39:25] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[05:53:41] *** Quits: dbaupp (Thunderbir@moz-4CA0D523.lns20.syd6.internode.on.net) (Quit: dbaupp)
[05:54:40] *** Joins: jdm (jdm@5AB4884B.FCC4549.14D5B978.IP)
[05:55:55] *** Joins: dbaupp (Thunderbir@moz-4CA0D523.lns20.syd6.internode.on.net)
[05:56:08] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[05:56:08] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/6L2lfw
[05:56:08] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[06:01:11] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[06:01:11] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/EZ341g
[06:01:11] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[06:01:20] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[06:01:20] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/EJ-0gw
[06:01:20] <ghrust> 13rust/06auto 1449ee492 15Alex Crichton: Move std::rt::io to std::io
[06:01:20] <ghrust> 13rust/06auto 145a56a16 15bors: auto merge of #10423 : alexcrichton/rust/move-io, r=pcwalton...
[06:01:20] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[06:17:41] *** Joins: whitglint (uid15486@moz-31ABA2C0.irccloud.com)
[06:22:15] *** Quits: whitglint (uid15486@moz-31ABA2C0.irccloud.com) (Quit: )
[06:22:25] *** Joins: whitglint (uid15486@moz-31ABA2C0.irccloud.com)
[06:27:53] *** Quits: tikue (tikue_star@275DC78D.2ACBBF24.689607DE.IP) (Ping timeout)
[06:31:36] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[06:54:17] *** Joins: tikue (tikue_star@275DC78D.2ACBBF24.689607DE.IP)
[06:56:10] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[06:56:11] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 145a56a16 to 144320a0c: 02http://git.io/N3iJvQ
[06:56:11] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[06:56:15] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[06:56:15] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/DtMpfw
[06:56:15] <ghrust> 13rust/06auto 1464afa4e 15Alex Crichton: Only run dsymutil on OSX in debug builds...
[06:56:15] <ghrust> 13rust/06auto 143403503 15bors: auto merge of #10198 : alexcrichton/rust/darwin-quiet, r=jdm...
[06:56:15] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[06:58:56] *** Quits: ktt3ja (Mibbit@moz-6B6EE8C0.hsd1.va.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[07:11:13] *** Joins: lbergstrom1 (Adium@5AB4884B.FCC4549.14D5B978.IP)
[07:11:13] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Connection reset by peer)
[07:12:06] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[07:12:06] *** ChanServ sets mode: +o pnkfelix
[07:12:57] *** Quits: lbergstrom1 (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[07:14:09] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[07:16:43] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[07:17:02] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[07:18:01] *** Joins: jensnockert (jensnocker@moz-612361F7.wireless.lu.se)
[07:18:59] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[07:20:47] *** Joins: notmatt (notmatt@moz-3C7AF18C.lightspeed.sntcca.sbcglobal.net)
[07:30:21] *** Quits: notmatt (notmatt@moz-3C7AF18C.lightspeed.sntcca.sbcglobal.net) (Client exited)
[07:30:39] *** Quits: brson (brson@5AB4884B.FCC4549.14D5B978.IP) (Connection reset by peer)
[07:30:57] *** Joins: lbergstrom1 (Adium@5AB4884B.FCC4549.14D5B978.IP)
[07:30:58] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Connection reset by peer)
[07:31:03] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Connection reset by peer)
[07:31:08] *** Quits: jdm (jdm@5AB4884B.FCC4549.14D5B978.IP) (Ping timeout)
[07:31:17] *** Joins: brson (brson@5AB4884B.FCC4549.14D5B978.IP)
[07:31:17] *** ChanServ sets mode: +qo brson brson
[07:32:00] *** Joins: jdm (jdm@5AB4884B.FCC4549.14D5B978.IP)
[07:36:46] *** Quits: lbergstrom1 (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[07:42:34] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[07:49:26] *** Quits: jensnockert (jensnocker@moz-612361F7.wireless.lu.se) (Input/output error)
[07:55:20] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[07:58:36] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[07:58:36] *** ChanServ sets mode: +ao pcwalton pcwalton
[08:01:11] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[08:01:11] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/DtMpfw
[08:01:11] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[08:03:29] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[08:06:06] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[08:06:06] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/FsY3BQ
[08:06:06] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[08:06:14] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[08:06:15] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/MQiI7Q
[08:06:15] <ghrust> 13rust/06auto 1449ee492 15Alex Crichton: Move std::rt::io to std::io
[08:06:15] <ghrust> 13rust/06auto 143880607 15bors: auto merge of #10423 : alexcrichton/rust/move-io, r=pcwalton...
[08:06:15] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[08:15:17] *** Quits: tikue (tikue_star@275DC78D.2ACBBF24.689607DE.IP) (Ping timeout)
[08:17:41] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[08:18:38] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[08:20:44] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[08:22:15] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[08:26:53] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[08:40:28] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[08:42:58] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[08:54:48] *** Quits: brson (brson@5AB4884B.FCC4549.14D5B978.IP) (Ping timeout)
[08:57:32] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Quit: pcwalton)
[09:01:12] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[09:01:12] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 143880607 to 143403503: 02http://git.io/N3iJvQ
[09:01:12] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[09:01:20] *** Quits: jdm (jdm@5AB4884B.FCC4549.14D5B978.IP) (Ping timeout)
[09:01:20] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[09:01:20] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/UFb-EA
[09:01:20] <ghrust> 13rust/06auto 1449ee492 15Alex Crichton: Move std::rt::io to std::io
[09:01:20] <ghrust> 13rust/06auto 145c29168 15bors: auto merge of #10423 : alexcrichton/rust/move-io, r=pcwalton...
[09:01:21] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[09:01:58] <dbaupp> acrichto: having fun? :P
[09:04:49] <acrichto> I'm praying this time test is just going wrong
[09:06:14] <dbaupp> rather than something fundamental?
[09:09:24] <acrichto> hopefully...
[09:30:41] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[09:56:09] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[09:56:09] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 145c29168 to 143403503: 02http://git.io/N3iJvQ
[09:56:09] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[09:56:16] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[09:56:17] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/aVI42g
[09:56:17] <ghrust> 13rust/06auto 140cc5e6c 15Alex Crichton: Remove resolve's xray infrastructure...
[09:56:17] <ghrust> 13rust/06auto 149ef4e29 15Alex Crichton: Improve error message for breaks in blocks...
[09:56:17] <ghrust> 13rust/06auto 14271c988 15bors: auto merge of #10427 : alexcrichton/rust/no-xray, r=brson...
[09:56:19] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[09:56:30] *** Joins: notmatt (notmatt@moz-3C7AF18C.lightspeed.sntcca.sbcglobal.net)
[09:58:15] *** Quits: notmatt (notmatt@moz-3C7AF18C.lightspeed.sntcca.sbcglobal.net) (Ping timeout)
[10:26:00] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[10:31:19] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[10:31:19] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14271c988 to 143403503: 02http://git.io/N3iJvQ
[10:31:19] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[10:31:20] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[10:31:20] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/h9Xpcw
[10:31:20] <ghrust> 13rust/06auto 14f4bedde 15Jay Anderson: Update docs for Fractional, Algebraic, Round, and Trigonometric traits.
[10:31:20] <ghrust> 13rust/06auto 146c02e81 15Jay Anderson: Add docs for traits Exponential, Hyperbolic, BitCount.
[10:31:20] <ghrust> 13rust/06auto 14deefb1f 15Jay Anderson: Got directions backwards in to_degrees and to_radians docs.
[10:31:22] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[10:46:40] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[10:59:31] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[11:14:59] *** Quits: doomlord_ (servitor@moz-4625DF14.range86-184.btcentralplus.com) (Ping timeout)
[11:25:14] *** Joins: doomlord_ (servitor@moz-4625DF14.range86-184.btcentralplus.com)
[11:25:32] *** Quits: doomlord_ (servitor@moz-4625DF14.range86-184.btcentralplus.com) (Client exited)
[11:25:33] *** Joins: doomlord_ (servitor@moz-4625DF14.range86-184.btcentralplus.com)
[11:28:00] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[11:30:58] *** Joins: notmatt (notmatt@moz-3C7AF18C.lightspeed.sntcca.sbcglobal.net)
[11:32:41] *** Quits: notmatt (notmatt@moz-3C7AF18C.lightspeed.sntcca.sbcglobal.net) (Ping timeout)
[11:34:45] *** Joins: sanxiyn (tinuviel@B4104EBB.3CC170B1.1E14B209.IP)
[11:36:18] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[11:36:18] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/h9Xpcw
[11:36:18] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[12:28:33] *** Joins: brson (brson@9C2E78E6.8C982E60.292610BC.IP)
[12:28:33] *** ChanServ sets mode: +qo brson brson
[12:37:49] *** Joins: pcwalton (pcwalton@9C2E78E6.8C982E60.292610BC.IP)
[12:37:49] *** ChanServ sets mode: +ao pcwalton pcwalton
[12:40:05] *** Quits: pcwalton (pcwalton@9C2E78E6.8C982E60.292610BC.IP) (Quit: pcwalton)
[12:42:16] *** Joins: jdm (jdm@9C2E78E6.8C982E60.292610BC.IP)
[13:23:01] *** flaper87|afk is now known as flaper87
[13:32:53] <pnkfelix> nmatsakis: ping
[13:36:25] <pnkfelix> nmatsakis: (its not important, I just wanted to know if the code you had used for reaps at Data Power was open-source, and what you thought of the experience of using it.)
[14:05:42] <nmatsakis> pnkfelix: pong
[14:06:09] <nmatsakis> I'm not sure now if what we used was reaps precisely, but it was originally open source and originated from rice, I just remembered that
[14:06:17] <pnkfelix> nmatsakis: okay
[14:06:37] <nmatsakis> basically it was an arena with some free list allocation 
[14:06:44] <pnkfelix> nmatsakis: that sounds like a reap
[14:06:53] <nmatsakis> really quite straightforward
[14:07:06] <nmatsakis> tbh we rarely used the free list part
[14:07:16] <nmatsakis> but sometimes
[14:07:17] <pnkfelix> nmatsakis: That's good!  :)
[14:07:26] <pnkfelix> nmatsakis: (unless its bad, of course)
[14:07:36] <nmatsakis> :)
[14:07:40] <nmatsakis> pnkfelix: indeed.
[14:07:59] <nmatsakis> pnkfelix: on a related note, I think we need to refactor the arena API slightly...
[14:08:01] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[14:08:03] <pnkfelix> nmatsakis: some of the discussion on the rust-dev list, as well as papers I've been reading, has made me wonder what a reap would be like in Rust
[14:08:22] <pnkfelix> nmatsakis: (with an unsafe `free` method, I guess.  Or some other way to free intermediate objects)
[14:08:26] <nmatsakis> pnkfelix: I can imagine making a safe way
[14:08:41] <nmatsakis> pnkfelix: I was thinking about doing some experimenting with the arena API in this direction actually,
[14:08:49] <nmatsakis> pnkfelix: so that it returns not a &'a T but rather something like ArenaUnique<'a, T>
[14:08:57] <nmatsakis> pnkfelix: which acts like an owned pointer but is limited by the lifetime 'a
[14:09:33] <nmatsakis> pnkfelix: point being you could then have a `free(u: ArenaUnique<'a, T>)`
[14:09:46] <pnkfelix> nmatsakis: â€¦ where 'a is not the lifetime of the Arena, but rather is a sublifetime of the arena's lifetime?
[14:09:48] <nmatsakis> pnkfelix: (obviously ArenaUnique would be affine, which today means an empty dtor (dorky))
[14:10:07] <nmatsakis> pnkfelix: no, it's the lifetime of the arena
[14:10:12] <pnkfelix> nmatsakis: oh okay
[14:10:13] <nmatsakis> pnkfelix: I suppose the type could be contravariant
[14:10:27] <nmatsakis> pnkfelix: but you'd be able to borrow it to a &'a T as normal,
[14:10:34] <nmatsakis> so you could certainly lend it out
[14:10:50] <pnkfelix> nmatsakis: I think I follow
[14:11:13] <nmatsakis> anyway, I was toying around with the arena API for other reasons (mainly to make it fit in with a `new(arena) expr` syntax)
[14:11:24] <nmatsakis> pnkfelix: but it would have the side-effect of enabling reaps
[14:11:32] <nmatsakis> well the other reason to improve it,
[14:11:41] <nmatsakis> is to allow arenas to return mutable data more naturally
[14:13:36] *** flaper87 is now known as flaper87|afk
[14:16:53] <eddyb> new is verbose :( - but that's my most useful comment on that
[14:19:25] *** Quits: sanxiyn (tinuviel@B4104EBB.3CC170B1.1E14B209.IP) (Quit: Leaving)
[14:59:40] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[15:15:42] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[15:24:50] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[15:26:18] *** kimundi is now known as zz_kimundi
[15:32:08] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[15:36:52] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[15:38:21] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[15:38:32] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Connection reset by peer)
[15:38:37] *** Joins: pnkfelix1 (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[15:39:10] *** pnkfelix1 is now known as pnkfelix
[15:41:02] *** Quits: Kxepal (Miranda@moz-428D43AB.pppoe.mtu-net.ru) (Ping timeout)
[15:44:11] *** Joins: Kxepal (Miranda@moz-64407EE.pppoe.mtu-net.ru)
[15:49:22] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[15:50:56] *** Joins: notmatt (notmatt@moz-3C7AF18C.lightspeed.sntcca.sbcglobal.net)
[15:51:22] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[15:51:22] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/fGF5nQ
[15:51:22] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[15:51:30] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[15:51:30] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/XxM8zw
[15:51:30] <ghrust> 13rust/06auto 141f1011a 15Brian Anderson: rt: Namespace all C functions under rust_
[15:51:30] <ghrust> 13rust/06auto 140b2eb78 15bors: auto merge of #10440 : brson/rust/cnamespace, r=bstrie
[15:51:30] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[15:53:06] *** Quits: notmatt (notmatt@moz-3C7AF18C.lightspeed.sntcca.sbcglobal.net) (Client exited)
[16:01:21] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[16:01:21] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 140b2eb78 to 1411b0784: 02http://git.io/N3iJvQ
[16:01:21] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[16:01:22] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[16:01:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/VP7EdQ
[16:01:23] <ghrust> 13rust/06auto 146b6f89b 15Brian Anderson: rt: Delete more C++
[16:01:23] <ghrust> 13rust/06auto 142ee72ba 15bors: auto merge of #10439 : brson/rust/rmcxx, r=bstrie
[16:01:23] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[16:03:23] *** Quits: brson (brson@9C2E78E6.8C982E60.292610BC.IP) (Ping timeout)
[16:41:54] *** Joins: jensnockert (jensnocker@moz-A02864B8.wireless.lu.se)
[16:43:09] *** Joins: beifeng (Mibbit@408AEF45.145C8DEA.64FAF8EC.IP)
[16:46:18] *** Quits: jensnockert (jensnocker@moz-A02864B8.wireless.lu.se) (Connection reset by peer)
[16:46:49] *** Joins: jensnockert (jensnocker@moz-A02864B8.wireless.lu.se)
[17:00:45] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[17:04:29] *** Quits: jensnockert (jensnocker@moz-A02864B8.wireless.lu.se) (Connection reset by peer)
[17:06:17] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[17:06:17] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/VP7EdQ
[17:06:17] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[17:08:07] *** Joins: pnkfelix1 (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[17:08:36] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Connection reset by peer)
[17:08:42] *** pnkfelix1 is now known as pnkfelix
[17:08:53] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[17:11:16] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[17:11:16] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/sY3g9A
[17:11:16] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[17:11:25] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[17:11:25] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/aDVS9w
[17:11:25] <ghrust> 13rust/06auto 148d7e9b9 15Florian Hahn: Remove type overflow checks from check_const.rs, refs #4220...
[17:11:25] <ghrust> 13rust/06auto 14cf5bff2 15Florian Hahn: Check inferred integer literals for overflows, closes #4220
[17:11:26] <ghrust> 13rust/06auto 1408cde9e 15bors: auto merge of #10018 : fhahn/rust/check-inferred-ints, r=cmr...
[17:11:28] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[17:17:33] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[17:41:42] *** Joins: notmatt (notmatt@118CCA77.D1B89392.602E4FC1.IP)
[17:49:29] <cmr> acrichto: r? https://github.com/mozilla/rust/pull/10441
[17:51:13] <acrichto> cmr: we've already got std::rt::test, you can probably just throw it in there
[17:51:22] <cmr> oh, didn't see it
[17:51:22] <acrichto> although I kinda want something like that in io::util
[17:51:31] <acrichto> io::util is for later though
[17:51:35] *** zz_kimundi is now known as kimundi
[17:51:49] <acrichto> need to move out of rt:: first ...
[17:52:07] <acrichto> we really need to start graphing benchmarks
[17:53:28] <cmr> What's the make target for building stage2 test binaries?
[17:54:25] <acrichto> make check-stage2-xxx
[17:54:40] <cmr> I only want to build them though, not run them
[17:54:46] <cmr> (unless that's what that does?)
[17:54:56] <acrichto> um
[17:54:57] <cmr> running the tests would kill my builder
[17:55:00] <acrichto> I'd either recomment ctrl+c
[17:55:09] <acrichto> or make $target/stage2/test/XXXtest-$target
[17:58:42] <cmr> acrichto: Are you sure it should live in rt/test.rs, given that rt::io is moving out of rt?
[17:59:27] <acrichto> cmr: not really, although I don't really think that it warrants its own module, you could just move it into the tests for now (I don't think it matters that much)
[17:59:51] <cmr> sure
[18:02:58] <cmr> acrichto: updated
[18:03:19] <cmr> oops
[18:03:23] <cmr> forgot to removethe mod
[18:04:01] <acrichto> cmr: have read() return None and r=me
[18:06:14] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[18:06:14] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1408cde9e to 142ee72ba: 02http://git.io/N3iJvQ
[18:06:14] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[18:06:22] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[18:06:22] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/v9mGYQ
[18:06:22] <ghrust> 13rust/06auto 140cc5e6c 15Alex Crichton: Remove resolve's xray infrastructure...
[18:06:22] <ghrust> 13rust/06auto 145fdbcc4 15Alex Crichton: Improve error message for breaks in blocks...
[18:06:23] <ghrust> 13rust/06auto 149a83156 15bors: auto merge of #10427 : alexcrichton/rust/no-xray, r=brson...
[18:06:25] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[18:16:59] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[18:22:40] <cmr> oops, forgot the r=you
[18:22:51] <cmr> thanks for picking that up, that PR would have been left to rot :P
[18:23:39] <acrichto> hehe
[18:28:23] <pnkfelix> acrichto: FYI things seem okay post-rebase, thanks for being a sounding board.  :)
[18:28:29] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[18:28:41] <acrichto> haha, np :)
[18:29:19] *** Quits: jdm (jdm@9C2E78E6.8C982E60.292610BC.IP) (Quit: Lost terminal)
[18:32:00] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[18:38:54] <sfackler> Is blake2-ppc still around? the Mut<T> proposal bitrotted, but I'd be willing to take it over
[18:39:21] <cmr> sfackler: that would be engla
[18:39:59] * sfackler shakes fist at people with different IRC and Github names
[18:41:14] <cmr> they are in #rust
[18:52:36] *** Quits: beifeng (Mibbit@408AEF45.145C8DEA.64FAF8EC.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[19:01:25] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[19:01:25] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 149a83156 to 142ee72ba: 02http://git.io/N3iJvQ
[19:01:25] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[19:01:35] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[19:01:36] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/1U_X6Q
[19:01:36] <ghrust> 13rust/06auto 1449ee492 15Alex Crichton: Move std::rt::io to std::io
[19:01:36] <ghrust> 13rust/06auto 14f1a67bd 15bors: auto merge of #10423 : alexcrichton/rust/move-io, r=pcwalton...
[19:01:36] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[19:05:43] <cmr> acrichto: once I get the builder sorted out, I'll try writing something up with rust-gnuplot
[19:05:48] <cmr> SiegeLord: :)
[19:05:58] <acrichto> rust-gnuplot?
[19:06:00] <SiegeLord> Wooo
[19:06:15] <cmr> acrichto: https://github.com/SiegeLord/RustGnuplot
[19:06:22] <cmr> bindings to gnuplot (a plotting tool)
[19:06:37] <acrichto> ooh fancy
[19:24:09] <cmr> Dear list mods: don't send my most recent accidentally-sent email through :P
[19:30:35] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[19:31:01] *** Joins: Jesse_ (jruderman@moz-BBE3ABD.mv.mozilla.com)
[19:43:10] *** Quits: doomlord_ (servitor@moz-4625DF14.range86-184.btcentralplus.com) (Connection reset by peer)
[19:44:00] *** Joins: doomlord_ (servitor@moz-4625DF14.range86-184.btcentralplus.com)
[19:49:51] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[19:50:13] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[19:52:43] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[19:53:41] <cmr> acrichto: is there a meeting today?
[19:53:58] <acrichto> cmr: nah brson/pcwalton and in korea with servo
[19:54:14] <cmr> that's what I thought, just making sure
[19:54:32] <strcat> acrichto: how big is the red zone used by the "segmented stack" support right now?
[19:54:43] <acrichto> strcat: 20K I think?
[19:55:00] <acrichto> yeah 20k
[19:55:01] <strcat> so, not enough for any semblance safety - can we just drop it in favour of guard pages?
[19:55:06] <strcat> that's not enough for `free`
[19:55:13] <acrichto> well, we need guard pages first
[19:56:30] * strcat shrugs
[19:56:42] <acrichto> we definitely need guard pages
[19:56:45] <strcat> rust-core already has guard pages, the OS is responsible for them
[19:56:49] <strcat> glibc puts a guard page on the end of a thread
[19:57:11] <strcat> windows has a whole stack allocation strategy that's fully safe
[19:57:17] <strcat> and LLVM seems to support it now
[19:57:35] <strcat> acrichto: well, what we're doing isn't safe ;p
[19:57:50] <acrichto> what support does LLVM have?
[19:57:57] <cmr> Where is the main task's stack allocated, anyway?
[19:58:00] <strcat> fn foo() { let _x = ~5; foo() /* lets hope free doesn't use more than 20k? sometimes it will */ }
[19:58:01] <acrichto> this is a tricky topic and I don't think it'll be as easy as "just adding guard pages"
[19:58:15] <strcat> acrichto: we can't be more safe than C because rust uses FFI calls everywhere
[19:58:19] <acrichto> cmr: by main task you mean the stack of 'fn main() {}' in rust?
[19:58:19] <strcat> in regards to this
[19:58:35] <cmr> acrichto: yeah. I'm looking at rt::start, specifically
[19:58:36] <strcat> it's not tricky - you have to abort on out-of-stack unless you want to port rust away from depending on C so much
[19:58:39] <strcat> imo at least
[19:58:40] <acrichto> strcat: yes, it's currently the intention to add guard pages, we just don't have them right now
[19:59:01] <acrichto> cmr: rt::start runs on the initial OS thread's stack, 'fn main() {}' runs on a rust thread stack
[19:59:05] <acrichto> rust task*
[19:59:14] <cmr> oh!
[19:59:17] <cmr> it calls run(main)
[19:59:21] <cmr> that's not main()
[19:59:23] <cmr> duh
[20:01:11] <cmr> It should be simple to add guard pages, just map a page at the end of every stack we allocate?
[20:01:45] <acrichto> by guard pages I think we mean a few things though
[20:02:09] <acrichto> it's kinda the name we've been using for "our stack management scheme" in general
[20:02:13] <acrichto> so right now we malloc the entire stack
[20:02:25] <acrichto> we want to change that to reserving address space and then lazily mapping in pages
[20:02:32] <acrichto> the "guard page" is then pretty easy
[20:02:39] <acrichto> although it's not just as easy as having a guard page
[20:02:51] <acrichto> we still want something printed saying something like "C stack overflow"
[20:03:25] <strcat> acrichto: malloc is lazy
[20:03:35] <strcat> there is no way to 'reserve' address space without doing what malloc does
[20:03:43] <acrichto> yes, but we don't want to rely on that
[20:03:48] <strcat> then we can't allocate big stacks
[20:03:51] <acrichto> we want to be in control of our stack allocations
[20:04:02] <strcat> we aren't though, the OS is
[20:04:08] <strcat> you can't tell mmap what to do specifically
[20:04:21] <strcat> it's really no difference than malloc, except it always deals in pages
[20:04:33] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[20:04:39] <strcat> different from*
[20:05:00] <acrichto> for me at least, the reason we haven't done this yet is that we're not entirely sure how exactly to implement it
[20:05:05] <strcat> MAP_PRIVATE is basically mmap
[20:05:08] <strcat> er
[20:05:10] <cmr> mmap(NULL, stack_size, PROT_READ | PROT_WRITE, MAP_PRICATE, 
[20:05:12] <strcat> MAP_PRIVATE is basically malloc*
[20:05:18] <cmr> acrichto: is what you're saying different htan that?
[20:05:30] <acrichto> cmr: how do you guarantee a guard page is at the end of that?
[20:05:36] <strcat> acrichto: you mprotect it
[20:05:37] <cmr> acrichto: mprotact
[20:05:58] <strcat> anyway when linux picks up support for cooperative pthread threading (google is pushing for it) we can stop using our own threads
[20:06:05] <strcat> and pthreads already have a guard page
[20:06:06] <acrichto> that's probably what we'd adopt
[20:06:12] <cmr> it gives you a pointer, mprotect(pointer + size - page_size(), page_size(), PROT_NONE)
[20:06:21] <strcat> there is pthread_attr_setguardsize
[20:06:24] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[20:06:24] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/1U_X6Q
[20:06:24] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[20:06:48] <acrichto> I'd like to benchmark that though
[20:06:58] <strcat> benchmark mmap?
[20:07:00] <acrichto> last time I did that mmap'ing 4MB stacks got real slow real fast
[20:07:01] <strcat> or pthreads
[20:07:19] <strcat> acrichto: it's already what we do now
[20:07:35] <acrichto> what we do right now isn't really that scalable and it's pretty slow
[20:07:38] <cmr> acrichto: what specifically do you want to see benchmarked? I want to work on this
[20:07:46] <strcat> acrichto: but what else can you do?
[20:07:48] <acrichto> cmr: one sec
[20:08:13] <acrichto> cmr: so in theory we should be able to spawn millions of tasks 
[20:08:20] <strcat> pthread_create calls mmap
[20:08:22] <acrichto> https://gist.github.com/alexcrichton/7243535
[20:08:31] <acrichto> OSX takes ~5 mins to get to 1million stacks
[20:08:37] <acrichto> or maybe ~2
[20:08:48] <strcat> no one needs 1 million tasks on OS X, it's not a server OS
[20:08:50] <acrichto> it basically gets incredibly slow (and I think that it's the same on linux)
[20:08:51] <strcat> and it's already slow.
[20:08:56] <strcat> acrichto: it's not the same on linux
[20:08:59] <cmr> acrichto: testing now
[20:09:37] <acrichto> strcat: at least in my ubuntu vm it's just as slow if not slower than OSX
[20:09:40] <acrichto> that specific program
[20:09:52] <acrichto> it's at 500k stacks right now and it's incredibly slow
[20:09:56] <strcat> acrichto: a VM isn't a real test
[20:10:03] <acrichto> you have a linux computer, right?
[20:10:05] <strcat> yes
[20:10:16] <acrichto> can you run that and just see how long roughly it takes to get to 1M?
[20:10:28] <cmr> it starts to drag at â”‚1792000
[20:10:31] <strcat> it won't make it that far, I don't have enough memory
[20:10:37] <strcat> cmr: you're probably just going OOM
[20:10:39] <cmr> butit got therein less than 2 seconds
[20:10:52] <acrichto> cmr: how much memory does your system have?
[20:10:54] <cmr> 1.8s
[20:10:56] <cmr> 16GB
[20:11:07] <cmr> with 24G of swap
[20:11:19] <strcat> ah that's enough then, I think it will use ~8k per block of 8MiB
[20:11:22] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[20:11:22] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/i02TWw
[20:11:22] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[20:11:36] <cmr> I thought I tweaked that down... that's a riduclous amount of swap
[20:11:36] <strcat> hrm
[20:11:54] <acrichto> strcat: as a comparison, https://gist.github.com/alexcrichton/7243401 gets the real fast
[20:11:57] <acrichto> to 1M on osx
[20:12:12] <acrichto> it's not blazingly fast, but it's faster (timing now)
[20:12:16] <strcat> acrichto: sure, OS X doesn't have a fast VM subsystem
[20:12:22] <strcat> allocating large stacks will never be cheap on OS X
[20:12:24] <strcat> doesn't matter what you do
[20:12:27] <strcat> it's not a fast OS
[20:12:46] <strcat> we are *never* going to scale to 1 million tasks on windows or OS X
[20:12:53] <strcat> unless we use segmented stacks
[20:13:14] <strcat> cmr: yeah I have 4GiB of memory only because a stick died :(
[20:13:26] <cmr> acrichto: it takes 1.98s to create 1M maps with that program, counting the time it takes to unmap them at exit
[20:13:32] <strcat> well it didn't really die but it started going bad and I had to remove it (failed memtest pretty horribly)
[20:13:43] <acrichto> cmr: hm, it takes 20s for go, and 70s for rust on osx
[20:13:48] <acrichto> well, rust == that c program
[20:13:48] <strcat> and 1 million tasks probably need ~8GiB
[20:13:58] <strcat> if you touch the first page of each
[20:14:03] <andrew-d_w> Just an interested listener, but: does anyone have a windows box to test creating this on?
[20:14:09] <strcat> if you don't touch any pages you'll make it to the max userspace VM size
[20:14:12] <strcat> andrew-d_w: yes
[20:14:27] <acrichto> strcat: I'd like to at least investigate other routes before throwing windows/osx under the bus
[20:14:30] <strcat> the windows form of overcommit is to reserve space on the disk
[20:14:35] <strcat> acrichto: they are already under the bus with large stacks
[20:14:37] <acrichto> although what cmr said is more promising than what I thought earlier
[20:14:45] <strcat> there is no alternative... we are hardly the first people to want this
[20:14:48] <acrichto> cmr: do you have go installed?
[20:14:54] <cmr> acrichto: running it now
[20:14:54] <strcat> we could use fibers on windows
[20:14:59] <benh> I got stuck somewhere at 450k, guess i shouldn't be running videogames in parallel in the background :(
[20:15:22] <cmr> acrichto: go takes 2.3s
[20:15:33] <benh> ha ha we win
[20:15:34] <acrichto> ok cool, just want to make sure that it's roughly on-par
[20:15:45] <cmr> strcat: which is a good idea, if we want to be competitive on windows.
[20:16:03] <strcat> cmr: well, microsoft discourages using fibers
[20:16:12] <strcat> they don't perform well
[20:16:22] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[20:16:22] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/i02TWw
[20:16:22] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[20:16:26] <acrichto> strcat cmr: I think that mmap/mprotect on osx/linux is about as good as we're gonna get, and then whatever's roughtly equivalent on windows
[20:16:27] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[20:16:27] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/PPK8tg
[20:16:27] <ghrust> 13rust/06auto 140cc5e6c 15Alex Crichton: Remove resolve's xray infrastructure...
[20:16:27] <ghrust> 13rust/06auto 145fdbcc4 15Alex Crichton: Improve error message for breaks in blocks...
[20:16:27] <ghrust> 13rust/06auto 143b0d486 15bors: auto merge of #10427 : alexcrichton/rust/no-xray, r=brson...
[20:16:29] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[20:16:29] <strcat> and our M:N threading is basically an inferior version of fibers
[20:16:58] <strcat> acrichto: windows doesn't really have an equivalent other than the mode where VirtualAlloc reserves disk space
[20:17:01] <cmr> Oh hey, the io movement landed
[20:17:12] <acrichto> ugh, flaky time tests
[20:17:24] <cmr> acrichto: want me to work on this then?
[20:17:26] <acrichto> cmr: if you want to work on this, certainly feel free!
[20:17:30] <strcat> allocate 50000 tasks with 8MiB stacks -> 400GiB of disk space reserved
[20:17:54] <acrichto> cmr: I believe that not using malloc is the dierction that we want to go, and I think that mmap/mprotect is the best solution we have right now
[20:18:15] <cmr> acrichto: well it ties directly into my interest in stack safety
[20:18:15] <andrew-d_w> strcat: I think Windows lets you split reserving memory
[20:18:20] <andrew-d_w> If you VirtualAlloc with MEM_RESERVE
[20:18:33] <cmr> all that's needed after this is getting LLVM to tell use max stack frame and us to use htat
[20:18:38] <acrichto> cmr: I think one of the larger challenges is going to be attempting to print something when you hit the guard page from C
[20:18:43] <strcat> andrew-d_w: don't you choose either MEM_RESERVE or MEM_COMMIT?
[20:18:47] <andrew-d_w> Yeah
[20:18:56] <andrew-d_w> But you can MEM_COMMIT something after you've reserved it
[20:19:03] <strcat> andrew-d_w: yes, but reserving will use disk space
[20:19:10] <cmr> acrichto: when you hit the guard page you're going to segfault, there's nothing we can do about that.
[20:19:12] <strcat> 'use' as in make it unusable elsewhere
[20:19:20] <acrichto> cmr: you can catch the SEGV
[20:19:31] <strcat> 500GiB drive, 100GiB consumed -> disk is 'empty' if you spawn 50k threads (or rust tasks)
[20:19:37] <andrew-d_w> strcat: Not according to MSDN (http://msdn.microsoft.com/en-us/library/windows/desktop/aa366890(v=vs.85).aspx)
[20:19:45] <andrew-d_w> MEM_RESERVE: Reserves a range of the process's virtual address space without allocating any actual physical storage in memory or in the paging file on disk.
[20:19:56] <strcat> andrew-d_w: yes, it reserves it
[20:19:58] <cmr> acrichto: Hm, and check if the segfault happened on the guard page?
[20:20:05] <cmr> Well..
[20:20:06] <strcat> andrew-d_w: 'reserve' means makes unusable for anything else
[20:20:07] <cmr> *a* guard page
[20:20:10] <strcat> andrew-d_w: the disk will be out of space
[20:20:16] <strcat> it will *instantly* be freed when the process exits
[20:20:21] <cmr> that's going to be messy..
[20:20:31] <cmr> well, not really.
[20:20:32] <strcat> but if you spawn 50k tasks with 8MiB stacks, 400GiB disk space will be 'consumed' until the process exits
[20:21:01] <strcat> it doesn't really matter anyway because windows has a slow VM subsystem and it will be painfully slow before then
[20:21:07] * strcat shrugs
[20:21:39] <cmr> It shouldn't matter except in microbenchmarks, though.
[20:22:03] <cmr> It's not reasonable to spawn a million tasks. You only have 64K ports to work with, per address.
[20:22:23] <strcat> cmr: doesn't matter how many ports there are
[20:22:24] <acrichto> cmr: yeah it's not easy detecting the hit to the guard page
[20:22:27] <andrew-d_w> strcat: Feel like testing it for me?  Don't have a windows box right now... (https://gist.github.com/andrew-d/7437982)
[20:22:35] <andrew-d_w> I'm curious what happens
[20:22:40] <cmr> strcat: what use are that many tasks besides serving network connections?
[20:22:41] <strcat> andrew-d_w: I've tested it already
[20:22:56] <strcat> it reserves disk space and considers it OOM when there's no more disk space (but you disrupt the whole system by doing that)
[20:23:17] <andrew-d_w> Blah, that sucks
[20:23:27] <cmr> acrichto: shouldn't be all that hard. store guard page addresses in global list, consult list in signal handler. store size next to it. to update, append address, atomically update list size. (that way the signal handler can't see the new address before it's done being added0
[20:23:38] <strcat> cmr: I don't think the number of ports is relevant
[20:23:57] <strcat> for a server
[20:24:03] <strcat> a server uses 1 port
[20:24:10] <cmr> Each connection uses 1 port
[20:24:12] <strcat> it distinguishes between connections by source_ip:source_port
[20:24:14] <strcat> cmr: no.
[20:24:20] <strcat> it uses 1 port *on the client*
[20:24:32] <strcat> if a single client makes 1000 connections, it uses 1000 ports on their computer
[20:24:33] <acrichto> cmr: you don't really need that kind of machinery, you've got TLS access to the rust scheduler/task with the stack limits
[20:24:34] <strcat> 1 port on the server
[20:24:53] <strcat> ports aren't a bottleneck afaik unless you're doing something like bittorrent
[20:25:23] <cmr> strcat: every connection establishes a new port pair, unless I've massively misunderstood TCP all these years
[20:25:32] <strcat> cmr: you've massively misunderstood TCP then
[20:25:35] <cmr> yay!
[20:25:48] <strcat> cmr: a connection is identified by a unique tuple
[20:25:51] <strcat> of
[20:25:54] <strcat> (src, dest)
[20:26:01] <strcat> where src is (ip, port) and dest is (ip, port)
[20:26:59] <strcat> (1.1.1.0, 3153), (eth0, 80)
[20:27:01] <strcat> (1.1.1.0, 3154), (eth0, 80)
[20:27:08] <strcat> (1.1.1.1, 5331), (eth0, 80)
[20:27:11] <strcat> (1.1.1.1, 5332), (eth0, 80)
[20:27:13] <strcat> (1.1.1.1, 5333), (eth0, 80)
[20:27:16] <strcat> is what a server looks like
[20:28:07] <strcat> cmr: with SO_REUSEADDR, you can even bind multiple processes to 1 port
[20:28:10] <cmr> right
[20:29:04] <strcat> so you could have 1 million connections to 10 processes (lets say 16 threads each) on 1 port
[20:29:28] <strcat> cmr: I'm sure there are servers that establish addition connections, not really sure
[20:30:41] <strcat> bittorrent is a good example because it's both a server/client and *will* use a ton of ports
[20:33:44] <cmr> acrichto: what does __morestack do right now?
[20:34:02] <acrichto> cmr: it re-aligns the stack and calls rust_stack_exhausted
[20:34:28] <strcat> google needs to hurry up and add cooperative pthreads... ;p
[20:34:52] * strcat goes to find the slides
[20:35:16] <strcat> http://www.youtube.com/watch?v=KXuZi9aeGTw
[20:35:28] <cmr> acrichto: with guard pages, would you be opposed to the -Z no-segmented-stacks I hadpreviouslyimplemented?
[20:35:32] <cmr> guh this netbook
[20:35:34] <strcat> acrichto: ^ watch that
[20:35:59] <strcat> it makes event loops obsolete, if you're just mapping them to threads with large stacks
[20:36:25] <acrichto> cmr: hm, perhaps, I'd want to think about it more though
[20:36:33] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Ping timeout)
[20:36:55] <cmr> It still guarantees safety, it will just abort instead of unwind
[20:37:04] <cmr> (...on platforms using libstd)
[20:37:18] <cmr> (which that option isn't intended for)
[20:37:20] <acrichto> so in the #1 ideal world, we have unwinding on stack overflow, printing on C stack overflow via guard pages
[20:37:39] <strcat> we can't do that
[20:38:07] <strcat> it's undefined to unwind through foreign libraries, and it's undefined to unwind from an arbitrary point in LLVM bytecode
[20:38:09] <acrichto> ideal world being the operative word, we don't want to bind ourselves in a situation where we can't reach that position
[20:38:30] <acrichto> oh I mean abort on C stack overflow, not unwinding
[20:38:37] <strcat> well, it does abort
[20:38:42] <strcat> it's a segmentation fault
[20:38:48] <strcat> which is what abort often does do
[20:38:55] <strcat> LLVM's abort seems to do SIGILL on x86
[20:39:02] <strcat> it could cause a SIGSEGV though
[20:39:03] <acrichto> yes, but we want to print something about a C stack overflow
[20:39:38] <strcat> well you can do that with a signal handler I guess
[20:39:51] <strcat> via write() (can't use stdio in a signal handler)
[20:40:02] <acrichto> that's what I was thinking
[20:40:10] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[20:40:21] <acrichto> it's also fine to use stdio though b/c it's a synchronous signal handler
[20:40:31] <cmr> It's not synchronous
[20:40:41] <acrichto> segv?
[20:40:42] <cmr> Two threads could trip an overflow at the same time.
[20:40:54] <acrichto> ugh that's one thing I never figured out
[20:41:05] <acrichto> I want each thread to have its own handler
[20:41:11] <strcat> acrichto: you can't do that
[20:41:14] <acrichto> I don't want one thread to receive segfaults of the other
[20:41:18] <strcat> doesn't work
[20:41:26] <acrichto> operative word being "I want"
[20:41:29] <strcat> unless you handle them in the event loop with signalfd
[20:41:32] <eddyb> registered per-process?
[20:41:33] <cmr> Although
[20:41:45] <eddyb> you could call a function from TLS
[20:41:53] <cmr> eddyb: TLS and processes?
[20:42:16] <strcat> eddyb: no, because you can't use our TLS in a signal handler
[20:42:23] <eddyb> hmpf
[20:42:25] <strcat> undefined (and in practice, broken) behaviour
[20:44:23] <strcat> there are very, very few things a signal handler can do
[20:45:48] <strcat> exit, exit/abort, I/O via POSIX functions (no stdio), some of the exec family
[20:45:50] <strcat> no pthread_ calls
[20:46:58] <sfackler> can't you only do _exit instead of exit? or is that in an old version of the standard?
[20:47:34] <strcat> right
[20:50:27] <acrichto> cmr: hm perhaps the main thread can actually be useful for something
[20:50:48] <acrichto> cmr: so the "main rust thread", the one calling rt::start, could be the one with the signal handler registered
[20:50:55] <benh> Isn't there a pile of syscalls you're allowed to use on linux?
[20:52:29] <acrichto> cmr: hm interesting, apparently on windows only the main thread can catch segfaults https://ghc.haskell.org/trac/ghc/ticket/1820
[20:54:03] <acrichto> cmr: although upon reading more, this may not even be possible on windows...
[20:57:07] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[20:57:07] *** ChanServ sets mode: +o pnkfelix
[20:57:26] <strcat> acrichto: on windows you use either threads or fibers
[20:57:52] <strcat> I know we don't
[20:58:13] <strcat> but they don't support what we do and it's broken in practice without using the undocumented windows ABI
[20:58:22] <acrichto> what's different about fibers?
[20:58:31] <acrichto> we're basically implementing userspace fibers
[20:59:47] <strcat> fibers set up the thread/stack stuff windows expects
[21:00:05] <acrichto> hm, b/c we do that as well (although not as robust of a fashion I believe)
[21:00:11] <strcat> running windows runtime functions on our stacks is broken in many cases
[21:00:36] <strcat> Go had the same problem and they started using undocumented voodoo stuff
[21:01:06] <acrichto> that should be fixed now
[21:01:28] <strcat> what would have fixed it?
[21:01:54] <acrichto> https://github.com/mozilla/rust/blob/master/src/libstd/rt/context.rs#L300
[21:02:04] <acrichto> https://github.com/mozilla/rust/issues/3445#issuecomment-26114839
[21:02:32] <strcat> I don't think that's all we need to do
[21:03:06] <strcat> anyway our stacks are broken on linux too fwiw
[21:03:38] <strcat> they don't save SSE/AVX registers on x86 or AVX registers on x86_64
[21:03:39] <acrichto> how so?
[21:03:43] <strcat> (the subset they are supposed to save)
[21:04:33] <strcat> they assume that the target is always the baseline, including for C libraries
[21:05:08] <strcat> and that's not true because C libraries often support using CPU-specific features selected at runtime
[21:05:28] <strcat> and rustc has --target-cpu (which doesn't really work because of this, at least with libstd)
[21:05:52] <strcat> doing context switches in userland includes the responsibility of supporting every variation of the CPU architecture, selected at runtime
[21:05:55] <strcat> and we don't
[21:06:26] <strcat> acrichto: the part we don't do is related to exceptions the windows runtime occasionally uses internally
[21:07:07] <acrichto> hm, I don't really know that much about sse/avx
[21:09:21] <strcat> SSE adds eight 128-bit registers, AVX *replaces* them with 256-bit registers and AVX-512 increases them to 512-bit registers and adds 16 more
[21:09:58] <strcat> and I'm sure there are other registers we don't deal with - the floating point stack has at least 1 more, and there's the AES one
[21:10:10] <strcat> I don't know enough about x86 to know what more we do wrong
[21:10:40] <strcat> every time intel releases a CPU arch, rust needs an update
[21:10:53] <strcat> just to remain correct
[21:11:56] *** Quits: eddyb (eddy@336E3A7F.D51DAF03.FB866788.IP) (Ping timeout)
[21:14:30] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Ping timeout)
[21:15:40] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[21:17:32] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[21:18:02] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[21:18:02] *** ChanServ sets mode: +o tjc
[21:21:26] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[21:21:26] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/PPK8tg
[21:21:26] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[21:26:17] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[21:26:17] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/78OwNw
[21:26:17] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[21:26:21] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[21:26:21] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/U_kOLw
[21:26:21] <ghrust> 13rust/06auto 14123e0ce 15Adrien TÃ©tar: doc: CSS: fix code fonts...
[21:26:21] <ghrust> 13rust/06auto 14a5f4f98 15Adrien TÃ©tar: doc: disable parser error highlighting + a few fixes...
[21:26:22] <ghrust> 13rust/06auto 14c7eae28 15Adrien TÃ©tar: doc: add favicon to tutorial/manual...
[21:26:24] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[21:31:15] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Ping timeout)
[21:31:21] <strcat> acrichto: http://ix.io/90J here's what pthread_create does on linux/glibc with the defaults btw
[21:31:53] <acrichto> looks familiar
[21:32:20] <strcat> 8MiB stack (it uses the rlimit by default, if you don't override), adds 1 guard page (unless you ask for more, or none) and then "forks"
[21:32:57] *** Joins: icarot (yaaic@moz-C92E6072.wavecable.com)
[21:33:04] <strcat> if the rlimit is unlimited it uses some glibc default, don't know what it is and too lazy to check
[21:34:53] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[21:34:55] <acrichto> I guess for us avoiding that call to clone() is a big one
[21:35:50] <strcat> acrichto: spawning threads on linux is pretty cheap
[21:36:45] <strcat> the only thing faster about rust tasks compared to linux pthreads is lack of preemption (so you don't put as much pressure on the cache)
[21:56:19] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[21:56:19] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14fa76ac9 to 143b0d486: 02http://git.io/N3iJvQ
[21:56:19] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[21:56:23] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[21:56:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/IBRKWQ
[21:56:23] <ghrust> 13rust/06auto 14e7f42d6 15Jason Toffaletti: add rust_trylock_little_lock
[21:56:23] <ghrust> 13rust/06auto 146783a99 15bors: auto merge of #10428 : toffaletti/rust/try_lock, r=alexcrichton...
[21:56:23] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[22:02:03] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[22:06:18] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[22:06:18] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 146783a99 to 143b0d486: 02http://git.io/N3iJvQ
[22:06:18] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[22:06:25] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[22:06:25] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/f2YZBg
[22:06:25] <ghrust> 13rust/06auto 14cfbf924 15Niko Matsakis: Add test for #3053. Fixes #3053.
[22:06:25] <ghrust> 13rust/06auto 14d5cfb41 15bors: auto merge of #10446 : nikomatsakis/rust/issue-3053-test-rooted-in-moved-value, r=nikomatsakis
[22:06:26] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[22:06:36] *** Quits: Jesse_ (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse_)
[22:08:39] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Ping timeout)
[22:12:13] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[22:12:18] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[22:19:17] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[22:20:59] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[22:21:20] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[22:23:11] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[22:23:50] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[22:27:58] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Connection reset by peer)
[22:28:21] <strcat> acrichto: is brson not around today?
[22:28:44] <acrichto> I suppose not, off in korea I imagine
[22:30:36] <Luqman> sadly when conditions are gone i won't be able to use it for my sketchy restart
[22:31:01] <strcat> Luqman: pass in a closure?
[22:31:33] <strcat> same thing without TLS sugar (sulphur for the error handling case ;p)
[22:31:57] <Luqman> https://github.com/luqmana/mcchat/blob/master/mcchat.rs#L51
[22:32:20] <Luqman> i was just trapping any conditions i hadn't already handled and basically retrying
[22:32:29] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Ping timeout)
[22:33:11] <strcat> ah
[22:33:55] *** Joins: geoffhill (geoffhill@moz-738DC0DB.org)
[22:34:08] <tjc> acrichto: ping
[22:34:10] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[22:34:45] <acrichto> tjc: pong
[22:35:05] <tjc> acrichto: is there anything obvious you can think of that would cause building libstd with stage1 to segfault after pulling changes?
[22:35:13] <tjc> This is just the past day's (or less) worth of changes
[22:35:25] <tjc> I'm rebuilding with just master now to see if it still happens, but wanted to check if you knew of any potential gotchas
[22:35:48] <acrichto> I'm unware of anything that would cause a segfault
[22:35:50] <acrichto> that's not good
[22:35:58] <acrichto> perhaps a reconfigure is needed
[22:36:02] <acrichto> libuv may not have gotten rebuilt
[22:36:07] <tjc> yeah, I did reconfigure
[22:36:19] <tjc> I was wondering if my libuv got out of sync somehow, but configuring should sync all the submodules...
[22:36:22] <tjc> or so I thought, anyway
[22:37:55] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[22:38:11] <acrichto> weird, if you've got a backtrace of the segfault I could look over that as well
[22:44:06] <tjc> acrichto: never mind, building master with no changes workedâ€¦ so either it's my changes' fault or something didn't get rebuilt till just now :-)
[22:44:09] <tjc> sorry for the false alarm
[22:44:18] <acrichto> huh, weird
[22:51:30] <pnkfelix> argh, I got that darn tests::test_c_dependency_no_rebuilding again on master just now
[22:54:17] <acrichto> that's been happening a lot...
[22:54:27] <pnkfelix> tjc: Can you help me understand this test ?
[22:54:31] <acrichto> from what I saw awhile ago it's b/c the runtime completely aborted
[22:54:41] <tjc> pnkfelix: Sure, I haven't seen that one failing recently, though...
[22:54:59] <pnkfelix> tjc: At this point I just want to understand the test itself
[22:55:42] <tjc> pnkfelix: Sureâ€¦ it tests that when you introduce a C file as a dependency, the package won't be rebuilt if no dependencies have changed
[22:55:46] <pnkfelix> tjc: Namely, I am confused by the comment "Now, make it read-only so rebuilding will fail"
[22:56:02] <pnkfelix> tjc: but we are checking for success in the command invocation, not a Fail
[22:56:12] <tjc> pnkfelix: Yeah, that's a hack to get around a few shortcomings...
[22:56:18] <tjc> In this case, rebuilding shouldn't happen because nothing changed
[22:56:28] <tjc> so the test passes if the command succeeded
[22:56:41] <tjc> a Fail would probably indicate that rustpkg *did* try to rebuild the library when it shouldn't
[22:56:49] <tjc> and a Fail for a different reason would also make the test fail
[22:56:50] <tjc> does that make sense?
[22:57:06] <pnkfelix> tjc: Okay, so the goal is to detect a rebuild attempt, which should not occur.  Yes I understand now.
[22:57:17] <tjc> pnkfelix: yes
[22:57:33] <tjc> That said, the test could be rewritten now to avoid this trick...
[22:57:42] <tjc> now that we can capture the task failure message
[22:57:46] <tjc> but, that would require some effort
[23:05:20] *** kimundi is now known as zz_kimundi
[23:05:37] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[23:06:07] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[23:11:20] <pnkfelix> tjc: so, in the meantime, how to you recommend I debug this rustpkg test failure?  RUST_LOG=rustpkg::tests ?
[23:12:18] <pnkfelix> (which produces confusing output since I guess the env var is being passed along to the recursive invocations of rustpkg via rustpkgtest ?)
[23:12:38] <pnkfelix> not sure how to avoid that.  Hmm.
[23:13:17] <pnkfelix> ah, I guess RUST_LOG=rustpkg will have to do.
[23:13:57] <tjc> pnkfelix: well, RUST_LOG=rustpkg, but...
[23:14:10] <tjc> pnkfelix: is the test failure just happening on your machine, or the bots, or both?
[23:14:42] <pnkfelix> tjc: Well, for now lets say my machine
[23:15:08] <pnkfelix> tjc: I don't know about the bots, acrichto said something about seeing it somewhere, but i don't know if he meant on the bots
[23:15:23] <acrichto> I was seeing that on both the bots and locally
[23:15:29] <pnkfelix> tjc: In case it is useful, here is the gist of the RUST_LOG'ified output
[23:15:29] <acrichto> I only saw it locally occasionally though
[23:15:38] <tjc> pnkfelix: Ok, yeah. I was about to ask you to gist the output :-)
[23:15:38] <pnkfelix> I can repro on each run
[23:16:25] <pnkfelix> tjc: https://gist.github.com/pnkfelix/7440586
[23:17:05] <pnkfelix> that is some funny debug output
[23:17:31] <tjc> pnkfelix: on line 952 it says "error: unable to open output file" and then a filename -- can you check if the file exists? First, you'll have to change the test --
[23:17:41] <tjc> wherever it calls the path() method on a TempDir, change that to unwrap()
[23:17:46] <tjc> so the directory won't get automatically deleted at exit
[23:21:42] <pnkfelix> tjc: or &unwrap(), I guess
[23:21:49] <pnkfelix> tjc: (the return types differ slightly)
[23:22:15] <tjc> pnkfelix: Yeah, usually I change it to unwrap and then write the equivalent of let p = &p;
[23:22:20] <tjc> because I am a terrible person :-)
[23:22:37] <pnkfelix> I just did the same thing
[23:22:45] <pnkfelix> So, while this builds
[23:23:05] *** Joins: pcwalton (pcwalton@9C2E78E6.8C982E60.292610BC.IP)
[23:23:05] *** ChanServ sets mode: +ao pcwalton pcwalton
[23:23:11] <pnkfelix> tjc: How hard would it be to make the handling of the temp-dirs a flag we control dynamically at runtime for rustpkg ?
[23:23:35] <pnkfelix> tjc: So that someone who encounters issues like this would either pass a switch or set an environment variable to get this effect for TempDir usage ?
[23:24:21] <tjc> pnkfelix: I think if that does change, it should change for any use of the tempdir module...
[23:24:30] <tjc> since presumably any other clients of it might also want to debug temporary directories
[23:24:50] <pnkfelix> so you'd like a more invasive revision to the shared API; yeah that's probably best
[23:24:57] <tjc> I'm fine if there's an environment variable, but I wasn't the one who did the tempdir rewriteâ€¦ I think it was benh?
[23:30:54] *** Joins: brson (brson@9C2E78E6.8C982E60.292610BC.IP)
[23:30:54] *** ChanServ sets mode: +qo brson brson
[23:31:22] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[23:31:22] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d5cfb41 to 143b0d486: 02http://git.io/N3iJvQ
[23:31:22] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[23:31:26] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[23:31:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/SJxxNg
[23:31:26] <ghrust> 13rust/06auto 1433ee433 15Carol W: Fixed xfail for nbody shootout benchmark by correcting command line parse....
[23:31:26] <ghrust> 13rust/06auto 142d6952e 15bors: auto merge of #10410 : willingc/rust/shoot-done, r=huonw...
[23:31:26] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[23:31:45] <pnkfelix> tjc: Okay, so, now that I've rebuilt.  (twice, since the first time I hacked on the wrong test)
[23:32:05] <pnkfelix> tjc: The gist is probably analogous, but I will repost so that we have a common ground to discuss
[23:32:11] <tjc> pnkfelix: ok, cool
[23:36:11] <pnkfelix> tjc: attempted to guess what you might need to see: https://gist.github.com/pnkfelix/7440745
[23:38:08] *** Quits: pcwalton (pcwalton@9C2E78E6.8C982E60.292610BC.IP) (Quit: pcwalton)
[23:39:31] <tjc> pnkfelix: Oh, ok. It looks like the test is actually detecting what it's supposed to, well, sort of...
[23:39:48] <tjc> It looks as if the code in the package script is actually trying to rebuild the C library even though foo.c didn't change
[23:39:51] <tjc> but I don't know why
[23:40:10] <tjc> if you look at the pkg.rs the test uses, it's using workcache to do that, and the inputs didn't change, so...
[23:40:13] <tjc> it shouldn't be rebuilding
[23:41:07] <pnkfelix> which pkg.rs should I be looking at?  The one in c-dependencies/ ?  Or in cdep-0.1?  Or â€¦ ?
[23:41:56] <tjc> pnkfelix: they're the same, it copies the one in c-dependencies to a temp dir
[23:42:06] <pnkfelix> tjc: Oh I see
[23:42:39] <tjc> the fact that the whole thing is in a closure passed to workcache_context.with_prep() *should* mean the result will never be recomputed if the inputs are fresh
[23:46:15] *** Quits: brson (brson@9C2E78E6.8C982E60.292610BC.IP) (Ping timeout)
[23:46:39] <pnkfelix> tjc: So, what about this:
[23:47:09] <pnkfelix> tjc: https://gist.github.com/pnkfelix/7440895
[23:47:23] <pnkfelix> tjc: As in, I am trying to emulate your test on the command line
[23:47:44] <pnkfelix> tjc: rustpkg build cdep; chmod -w path/to/lib ; rustpkg build cdep
[23:48:08] <tjc> pnkfelix: yeah, that's exhibiting the same bug...
[23:48:26] <tjc> pnkfelix: Try running that same command with RUST_LOG set to rustpkg,extra::workcache
[23:50:44] <pnkfelix> https://gist.github.com/pnkfelix/7440925
[23:52:02] <tjc> pnkfelix: Huh, that's weird, it looks like workcache thinks the output file (libfoo.dylib here) is older than the input file (foo.c)...
[23:52:15] <tjc> At least, that trace is saying foo.c is fresh (hasn't changed since last time) but libfoo.dylib isn't
[23:55:17] <pnkfelix> the foo.c is the one in src/cdep-0.1/foo.c ?
[23:56:10] <pnkfelix> tjc: https://gist.github.com/pnkfelix/7440972
[23:56:27] <tjc> yes
[23:56:32] <pnkfelix> tjc: (I added an `ls -l` invocation, I'd appreciate it if you'd check if those are the two files you think rustpkg is inspecting the timestamps of)
[23:57:00] <tjc> pnkfelix: yes, those are the two files...
[23:57:14] <tjc> I wonder if what's happening is that when the test code sets the .dylib to be read-only, it changes the modification time of the file
[23:57:33] <tjc> If that behavior is platform-dependent, it would explain the problem
[23:58:52] <pnkfelix> tjc: but that's the output file, not the input one ...
[23:59:22] <tjc> pnkfelix: Right, but that's how the freshness functions work (right now) -- if the date of the output file has changed at all since last time, it's considered non-fresh
[23:59:34] <tjc> I guess I could change it to consider it fresh if the output file is newer than the previous one
[23:59:36] <pnkfelix> tjc: oh.  Then yes, that would be a problem.
[23:59:49] <tjc> I was hesitant to do that because that seems like it would mean that somebody did a manual build in between...
[23:59:55] <tjc> and that therefore stuff should get rebuilt just to be sure
[23:59:56] <tjc> does that make sense?
