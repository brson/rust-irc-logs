[00:03:16] *** Quits: gavin (gavin@irc.mozilla.org) (A TLS packet with unexpected length was received.)
[00:04:05] <WindowsBunny> yeah, I have no idea if this backtrace is at all true
[00:04:17] <WindowsBunny> Because of the broken debug info we emit Q_Q
[00:05:44] <WindowsBunny> and gdb is confused as well
[00:06:55] <WindowsBunny> acrichto: Yeah, we really need to get this debug info situation fixed
[00:07:03] <WindowsBunny> It makes getting a backtrace impossible
[00:19:41] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[00:19:58] *** Joins: eddyb_ (eddyb@moz-4q5.hlc.26.188.IP)
[00:20:14] *** Joins: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net)
[00:20:17] <WindowsBunny> The C/C++ bits do emit their own PDBs, but we lose all that debug info once we shove those libraries through llvm-ar
[00:20:56] *** Quits: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net) (Client exited)
[00:22:32] *** Quits: eddyb (eddyb@moz-1t4sgi.residential.rdsnet.ro) (Ping timeout: 121 seconds)
[00:26:24] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[00:27:56] *** Joins: erickt (erickt@moz-pbfo6r.hfc.comcastbusiness.net)
[00:27:56] *** ChanServ sets mode: +ao erickt erickt
[00:29:32] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[00:29:58] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[00:30:28] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[00:34:32] *** eddyb_ is now known as eddyb
[00:35:10] *** eddyb is now known as eddyb__
[00:35:13] *** eddyb__ is now known as eddyb
[00:36:05] *** Quits: Johannes (Johannes@moz-4et8d7.ocn.ne.jp) (Connection closed)
[00:36:11] *** Joins: Johannes_ (Johannes@moz-4et8d7.ocn.ne.jp)
[00:37:07] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[00:37:13] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[00:40:46] *** Joins: vky (vky@moz-fqci96.ca.comcast.net)
[00:41:50] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[00:44:20] <reem> This is definitely incorrect behavior, right?
[00:44:21] <reem> http://is.gd/y5Wa67
[00:44:24] <reem> This should print Type::Byte
[00:44:28] <reem> not Type::Struct
[00:45:01] <sfackler> that's a weird case
[00:45:17] <reem> naturally I disagree :P
[00:45:49] <WindowsBunny> hey acrichto
[00:45:54] <WindowsBunny> You still didn't fix that error :|
[00:45:55] <reem> If I change forwards! to take a $x:tt it works
[00:45:57] <WindowsBunny> in your llvm thing
[00:46:13] <sfackler> I mean, you're right that it's a bug, but it's still a weird case :P
[00:47:02] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[00:47:28] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[00:49:16] *** Joins: aatch (james@moz-c6etfk.fosn.r6an.e000.2406.IP)
[00:49:37] <reem> macros are really buggy in a lot of edge cases
[00:49:48] <reem> I’ve found three bugs in the last 2 days
[00:50:01] <reem> well, I guess 2, one is more a limitation than a bug
[00:51:40] <eddyb> sfackler: it's not a bug
[00:52:56] <eddyb> reem: in ty_to_type!($ty), $ty is already parsed as a type. you can only use it as a type
[00:53:10] <reem> I’m matching on types
[00:53:13] <eddyb> u8 is an identifier, nothing more, nothing less
[00:53:15] <reem> bool, u8, etc. are all types
[00:53:19] <eddyb> reem: that's not something macros can do
[00:53:29] <reem> that seems like a rather arbitrary limitation
[00:53:36] <eddyb> how is it arbitrary?
[00:53:43] <eddyb> the type system doesn't exist for macros
[00:53:45] <reem> I can match on idents but not types?
[00:53:52] <reem> I’m not asking for type equality
[00:53:56] <eddyb> reem: the type you parsed is opaque
[00:54:07] <eddyb> you asked for a type, you got a type, you can only use it as an opaque type
[00:54:14] <eddyb> that's why tt is there, for forwarding
[00:54:33] <reem> I can’t use a tt in type position
[00:54:37] <reem> for instance as field types
[00:54:47] <eddyb> reem: that's an actual bug
[00:54:58] <eddyb> for which exists an universal (AFAIK) workaround
[00:55:18] <reem> macro_rules! tt_as_type { ($input:tt) => $input } yes?
[00:55:34] <reem> I think I uncovered yet another bug trying that workaround
[00:55:45] <reem> oh, actually it’s an existing limtation
[00:55:46] <bluss> you can't use tts anywhere but in passing to other macros
[00:55:47] <eddyb> if you mean $input:ty, maybe
[00:55:49] <reem> no macros in type position
[00:55:53] <eddyb> right
[00:56:01] <eddyb> wrap the item (struct definition, I presume) in an item-taking macro
[00:56:36] <reem> macro_rules! as_item { ($strukt:item) => $strukt }?
[00:57:15] <eddyb> well, it's not necessarily a struct, could be any item, but yes
[00:57:24] <eddyb> bluss: that one, I think is a bug
[00:57:43] <bluss> eddyb: don't fix it, I'm fond of it now
[00:57:59] <bluss> :P
[00:58:06] <reem> hmm, that seems to work
[00:58:15] <reem> it really kind of sucks it’s this hard to use macros
[00:58:18] <eddyb> bluss: it's not a trivial expansion because the various points that pass through unexpanded tt's work with indiivdual tokens
[00:58:18] <reem> and you need this many hacks
[00:58:23] <reem> if you want to do anything non-trivial
[00:59:00] <eddyb> reem: don't look at me, I didn't choose to release 1.0 at this point :P
[00:59:19] <eddyb> at least they're turing complete and you can run hodorlang with them
[00:59:46] <reem> so is there another bug to be filed somewhere here?
[00:59:57] <bluss> I've cooked up a macro to do the icompr syntax again.  icompr!(x * x for x in 0..10). *with* for let support too :)
[00:59:58] <eddyb> nope
[01:00:11] <reem> not “tt can’t be used outside of a macro invocation”?
[01:00:21] <reem> probably already filed somewhere
[01:00:29] <eddyb> I hope so, it's as old as macros
[01:01:20] <bluss> this is basically welcome to macros, reem :P
[01:01:32] <reem> -.-
[01:01:42] <reem> first rust feature it hasn’t really been a pleasure to write something complex in…
[01:01:55] <eddyb> it's a craft
[01:02:01] <reem> still way better than the C++ code generator it’s replacing
[01:02:04] <acrichto> WindowsBunny: hm interesting, I wonder if there's a bug in libgit2
[01:02:15] <reem> 1/4 the code
[01:02:22] <WindowsBunny> acrichto: The thing is, I don't even know if its libgit2
[01:02:31] <WindowsBunny> acrichto: It could just be the closest symbol
[01:02:52] <eddyb> reem: I need to get back to the thing I had in ES6
[01:03:00] <WindowsBunny> Because that function in libgit2 definitely doesn't call _read
[01:03:07] <eddyb> where I used template strings... I now know how to do some of that stuff with macros
[01:03:12] <acrichto> WindowsBunny: hm
[01:03:19] <eddyb> but I still really really want $!(concat_idents!(a, b))
[01:03:30] <eddyb> and I don't even know who was proposing that lovely feature
[01:04:32] <acrichto> WindowsBunny: git_config_add_backend() looks legit as a real thing in the backtrace, above that though could be anyone's guess
[01:04:47] <WindowsBunny> the offset for git_config_add_backend() is small
[01:04:50] <WindowsBunny> so that does seem legit
[01:05:20] <eddyb> acrichto: crazy question: what if you run the .exe under wine?
[01:05:27] *** Quits: erickt (erickt@moz-pbfo6r.hfc.comcastbusiness.net) (Ping timeout: 121 seconds)
[01:05:28] <WindowsBunny> but an offset of 10510 for set_backend is completely bogus
[01:05:46] <acrichto> eddyb: I don't have wine unfortunately
[01:05:48] <eddyb> winedbg is terrible but it could shed a light on some things
[01:05:51] <eddyb> acrichto: mac?
[01:05:58] <WindowsBunny> eddyb: Do you have wine?
[01:06:01] <eddyb> yupp
[01:06:13] <WindowsBunny> eddyb: want a copy of the exe?
[01:06:24] <eddyb> shoot. it's 4am and I'm bored
[01:07:35] <eddyb> acrichto: mind taking a quick look at this and telling me if you think it's sane? https://github.com/eddyb/rust/commit/0d960d6f8217bf09389453a4bde2dc699d5a0274
[01:07:55] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[01:08:12] <reem> And another one.. can’t call macros in the invocation of a macro
[01:08:20] <eddyb> first time I'm using scoped TLS, which I only understood because someone in here was trying to make it work with &'a Foo<'a>
[01:08:25] <reem> (in the arguments)
[01:08:39] <eddyb> reem: macros are expanded lazily
[01:08:57] <reem> is there a way to hack around this?
[01:09:00] <eddyb> that's the likely explanation, anyways
[01:09:08] <eddyb> reem: maybe, what does it look like?
[01:09:09] <acrichto> eddyb: I think? would have to think some more though
[01:09:19] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[01:09:32] <eddyb> acrichto: my worry is that the struct thing is completely crazy. it does compile and work and everything, fwiw
[01:09:40] *** Quits: Eridius (kevin@moz-6opvqs.us) (Quit: BBIAB, upgrading my Linode to KVM)
[01:09:44] <reem> eddyb: macro forwards to helper macro after calling macros on arguments
[01:09:46] <eddyb> just don't want UB in the middle of rustc
[01:09:50] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[01:10:02] <WindowsBunny> eddyb: one sec, creating a 7z and uploading it
[01:10:04] <eddyb> reem: and you want to match on the result of the inner macro?
[01:10:05] <reem> I guess I am trying to call a macro in ident position
[01:10:05] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[01:10:12] <reem> no
[01:10:23] <eddyb> or use it as an ident or anything like that
[01:10:47] <eddyb> this is where you'd use $!, e.g. outer!(foo $!(inner!(a, b, c)) bar)
[01:10:52] <eddyb> if that feature were to be implemented
[01:11:39] <eddyb> reem: let me look in my logs, maybe you'll have someone to bug about/help with an RFC
[01:11:55] *** Joins: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP)
[01:12:06] <reem> thanks
[01:12:34] <WindowsBunny> acrichto: yep, cargo.exe!git_config_add_backend() is legit
[01:12:56] <WindowsBunny> Which then goes on to call some functions with no symbol information whatsoever
[01:13:12] <eddyb> reem: https://internals.rust-lang.org/t/pre-rfc-macro-improvements/2088
[01:13:17] <eddyb> no activity in a month
[01:13:24] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[01:13:52] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[01:15:07] <WindowsBunny> eddyb: https://mega.co.nz/#!7YBh3RAC!N5Bqhtz6sJW4cIAf9D4IzYNmSx_K5-qnzO0xgFmZCeo
[01:15:27] <WindowsBunny> eddyb: Good luck debugging cargo.exe :D
[01:16:14] <WindowsBunny> eddyb: You'll need VS 2013 C++ redistributable, or wine's equivalent
[01:16:16] <WindowsBunny> good luck :D
[01:16:24] <eddyb> oh now you tell me :P
[01:16:51] <WindowsBunny> eddyb: Actually, you'll need the debug version of the redistributable
[01:17:02] *** Joins: erickt (erickt@moz-pbfo6r.hfc.comcastbusiness.net)
[01:17:02] *** ChanServ sets mode: +ao erickt erickt
[01:17:40] <WindowsBunny> hmmm, maybe IDA could help
[01:17:46] <eddyb> err:process:create_process L"Z:\\home\\eddy\\Projects\\cargo-msvc\\cargo.exe" not supported on this installation (x86_64 binary)
[01:17:50] <eddyb> well, that is dandy
[01:18:04] <WindowsBunny> welp
[01:18:14] <WindowsBunny> so much for that
[01:18:15] <eddyb> WindowsBunny: do you have addresses?
[01:18:47] <WindowsBunny> eddyb: 00007FF65969C738 is where it calls the offending _read
[01:18:50] <WindowsBunny> beyond that I have no idea
[01:19:41] <reem> eddyb: :(
[01:19:54] <reem> agh hit another one - HashMap<K, V> parses as a ty but not a tt
[01:19:56] <WindowsBunny> hmmmm
[01:20:03] <reem> so accepting a tt is not general enough
[01:20:06] *** Joins: Eridius (kevin@moz-6opvqs.us)
[01:20:25] <eddyb> reem: that's like 5 tokens
[01:20:31] <eddyb> 6, even
[01:20:33] <WindowsBunny> eddyb: ah ha, .text:000000014069C738
[01:21:10] <eddyb> [0x14069c738 395 cargo.exe]> pd $r @ sym.cargo.exe_git_refdb_set_backend+10504 # 0x14069c738                                                                      
[01:21:17] <WindowsBunny> Yeah, that's incorrect
[01:21:31] <reem> eddyb: Right, but now the “take a tt to be able to forward it” hack doesn’t work at all
[01:21:40] <WindowsBunny> The actual function itself is at .text:000000014069C6A0
[01:21:44] <eddyb> reem: $($x:tt)*
[01:22:12] <eddyb> I can tell you what this code is calling
[01:22:38] <eddyb> WindowsBunny: that function calls git_refdb_set_backend
[01:22:41] <WindowsBunny> acrichto: Oh yeah, and you're linking to both the debug and release CRT runtimes :|
[01:23:16] <eddyb> oh, it's actually git_refdb_set_backend + read + errno
[01:23:24] <eddyb> WindowsBunny: can you find the function from that description?
[01:23:29] <reem> eddyb: what can I put after that to ‘stop’ it?
[01:23:40] <reem> that seems like it will just consume the rest of the invocation
[01:23:41] <eddyb> reem: that's a severe limitation in macros
[01:23:44] <reem> and I need it not to
[01:23:56] <eddyb> reem: you could wrap it in delimiters, i.e. () [] or {}
[01:24:01] <WindowsBunny> hmmm
[01:24:03] <acrichto> WindowsBunny: oh hm, yeah I guess that'd do it
[01:24:08] <WindowsBunny> it _does_ call SetLastError
[01:24:10] <acrichto> WindowsBunny: I remember seeing linker warnings about that now that I think about it
[01:24:16] <WindowsBunny> acrichto: ouch
[01:24:19] <acrichto> never did resolve thougse
[01:24:26] <acrichto> now I gotta track down what has the debug crt :\
[01:24:30] <WindowsBunny> acrichto: So if a CRT object is being passed from one CRT to another....
[01:24:35] <acrichto> WindowsBunny: thanks though!
[01:24:50] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[01:25:18] <eddyb> this doesn't look like code LLVM would emit
[01:25:30] * eddyb grabs libgit2
[01:26:14] <WindowsBunny> eddyb: Well no, the C/C++ was compiled by cl
[01:26:24] <reem> eddyb: wrapped it in delimiters - getting an error that the first < in HashMap<K, V> is unexpected
[01:26:36] <reem> (it’s matching against $($fty:tt)
[01:26:38] <reem> *
[01:26:40] <eddyb> reem: ($($x:tt)*)
[01:26:53] <reem> I used []
[01:26:59] <reem> as delimeter
[01:27:01] <eddyb> or [$($x:tt)*]
[01:27:10] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[01:27:13] <reem> yup, [HashMap<K, V>] doesn’t match that
[01:27:19] <eddyb> what?
[01:27:34] <reem> no rules expected the token < on the first <
[01:27:36] <eddyb> how are you using $x in the RHS?
[01:28:24] <eddyb> WindowsBunny: wait, nothing calls git_refdb_set_backend?!
[01:28:35] <reem> passing along to another macro as [$($x)*], which then passes it along as $($x)*
[01:28:38] <reem> hmmm
[01:28:43] <eddyb> maybe the Rust binding has wrapper code in C
[01:28:50] <reem> the error doesn’t look like it’s coming form a nested macro expansion
[01:29:05] <eddyb> reem: can you reduce?
[01:29:10] <eddyb> or just show me the relevant macros
[01:29:11] <reem> I will try
[01:29:18] <reem> It’s a lot of macros
[01:29:55] <eddyb> WindowsBunny: I don't get it
[01:30:25] <eddyb> where is that code coming from?!
[01:30:31] <WindowsBunny> eddyb: I have no idea
[01:30:39] <reem> there’s no way for me to get at K and V in HashMap<K, V> with a macro pattern
[01:30:40] <eddyb> now you've got me intruiged
[01:30:46] <reem> since K and V could be many tokens
[01:30:53] <eddyb> reem: they're types
[01:31:03] <WindowsBunny> eddyb: This is what happens when debug info is utterly broken
[01:31:12] <eddyb> $generic:path<$($t:ty),*>
[01:31:15] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[01:31:23] <eddyb> well, maybe + instead of *
[01:31:24] <reem> eddyb: Yes, but once they are $ty’s I can’t match on them
[01:31:41] <eddyb> WindowsBunny: the problem is that there is a compiled function that does git_refdb_set_backend, read and errno checking
[01:31:54] <eddyb> WindowsBunny: and I can't find any call to git_refdb_set_backend in the C code
[01:32:07] <eddyb> reem: I think I know what you're doing :P
[01:32:32] <reem> (yes I am trying to implement a derive-like macro)
[01:32:44] <WindowsBunny> eddyb: lol
[01:32:59] <eddyb> well, I can only guess. I considered a polymorphic TypeId scheme at some point. well, I still think it would work, but it's much easier to generate it from the compiler
[01:33:09] <eddyb> reem: oh, that. I had that in a playpen tab and I lost it
[01:33:17] <reem> it’s not really derive
[01:33:19] <eddyb> not sure if I had generics working at that point
[01:33:20] <reem> it’s very specific
[01:33:22] <WindowsBunny> eddyb: Between _read and git_config_add_backend are exactly 4 function frames
[01:33:25] <eddyb> reem: are you matching on field types?
[01:33:32] <reem> basically
[01:33:40] <eddyb> derive doesn't do that
[01:33:57] <eddyb> derive calls the trait on each field('s type)
[01:34:01] <reem> The standard just-call-the-method-on-each-field approach doesn’t work ehre
[01:34:03] <WindowsBunny> eddyb: Want me to get you the addresses of each frame?
[01:34:08] <eddyb> reem: why exactly?
[01:34:16] <reem> can’t write the right set of starting impls due to coherence
[01:34:17] <eddyb> WindowsBunny: maybe the one before?
[01:34:26] <reem> sorry, not coherence
[01:34:28] <reem> lack of specialization
[01:34:35] <eddyb> reem: what's the trait's name?
[01:34:39] <eddyb> sheer curiosity
[01:34:43] <reem> Encode/Decode
[01:34:50] <eddyb> that's fun
[01:34:59] <reem> Vec<T> for some specific T need to be encoded differently than other T
[01:35:04] <reem> for instance
[01:35:10] <WindowsBunny> eddyb: so the frame directly before _read, callsite is at .text:000000014069C738, function itself is at .text:000000014069C6A0
[01:35:26] <reem> that’s what the type matching in the macro is for, to catch all the specific cases
[01:35:34] <reem> including HashMap<$key:ty, $value:ty>
[01:35:44] <eddyb> now, the tricky question. well, two. are you using gated features? and is the trait generic over something?
[01:35:52] <reem> ideally no, and no
[01:36:00] <eddyb> problematic and perfect
[01:36:07] <eddyb> reem: there is specialization in the language, via OIBIT
[01:36:13] <eddyb> but it's broken with generic traits
[01:36:23] <WindowsBunny> eddyb: Next frame up callsite is .text:00000001406A05E2 and function itself is .text:00000001406A0510
[01:36:36] <reem> eddyb: I see where you’re going
[01:36:42] <eddyb> reem: you can opt out of an impl by making the impl depend on a trait which you opt out of
[01:37:02] <WindowsBunny> eddyb: Next frame up callsite is .text:00000001406A0492 and function itself is .text:00000001406A0280
[01:37:10] <eddyb> reem: actually, I think I got it working by packing all the type params in a tuple and implementing the opt-out on that
[01:37:54] <eddyb> reem: but then a bug caused rustc to assume there's only one impl for each of the types the original trait was impl'd on
[01:37:58] <WindowsBunny> eddyb: Next frame up callsite is .text:00000001406C18F8 and function itself is .text:00000001406C1700
[01:38:03] <eddyb> (even though there were multiple impls with different type params)
[01:38:18] <eddyb> reem: that bug might be solved now so specialization may work in all cases
[01:38:43] <eddyb> WindowsBunny: thanks, I'll try to take a look. wait, those values are weird
[01:38:51] <eddyb> WindowsBunny: what is 000000014069C6A0 for?
[01:38:55] <reem> hmm, that *might* work but I think I see an easier way to just get the existing strategy to work
[01:39:05] <reem> I will probably try to move to something like that in the future though
[01:39:12] <reem> since it’s certainly cleaner
[01:39:14] *** Joins: summerlight (summerlight@moz-99k.2mj.130.121.IP)
[01:39:20] <eddyb> WindowsBunny: you mean, the base function that your debugger is showing?
[01:39:24] <reem> and probably makes LLVM’s life a little easier (I generate *a lot* of code now)
[01:39:49] <eddyb> reem: I'd suggest you do it sooner than later :P
[01:40:08] <eddyb> where later might involve macro-induced madness
[01:40:54] <reem> Since I’m not actually parsing struct items, but rather a custom syntax, I’ll just change the generics syntax to work for me
[01:41:07] <eddyb> heh
[01:41:21] *** Quits: erickt (erickt@moz-pbfo6r.hfc.comcastbusiness.net) (Ping timeout: 121 seconds)
[01:41:25] <reem> so it’s generic::path::<$([$(x:tt)*]),+>
[01:41:35] <reem> these macros are approaching write-only though
[01:42:00] <eddyb> reem: feel free to use spaces
[01:42:33] <reem> at least I am learning a lot about the macro system
[01:42:40] <reem> I never really touched any of the more complex bits before
[01:42:57] <reem> (it’s a lot more complicated than I anticipated :P)
[01:43:09] *** Joins: erickt (erickt@moz-pbfo6r.hfc.comcastbusiness.net)
[01:43:09] *** ChanServ sets mode: +ao erickt erickt
[01:43:15] <eddyb> WindowsBunny: oh! that call doesn't exist, radare has the same "base function" problem
[01:43:52] <WindowsBunny> acrichto: You forgot to update the submodule in your llvm pr
[01:44:04] <WindowsBunny> eddyb: wat
[01:44:33] <eddyb> WindowsBunny: well, the call exists, but it's not to the function it says. not sure why it doesn't show an offset (which would be pretty large, fwiw)
[01:44:41] <acrichto> one of these days...
[01:44:59] <eddyb> WindowsBunny: however, there are calls to symbols
[01:45:24] <WindowsBunny> acrichto: I have faith in your ability to update llvm!
[01:48:17] <bluss> niko permitted $t:tt $($rest:tt)* in macros after Rust 1.0 and with that you can parse a lot manually
[01:51:13] *** Quits: erickt (erickt@moz-pbfo6r.hfc.comcastbusiness.net) (Ping timeout: 121 seconds)
[01:52:34] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[01:52:39] <eddyb> WindowsBunny: I *think* it's in src/fileops.c
[01:53:53] <eddyb> I mena, it looks like git_futils_readbuffer_fd
[01:55:50] <eddyb> WindowsBunny: yeah, that calls p_read which calls read, I think that's it
[01:57:31] <WindowsBunny> eddyb: Oh, I think it is p_read
[01:57:46] <WindowsBunny> eddyb: Because of the SetLastError!
[01:58:08] <eddyb> git_futils_readbuffer_updated -> git_futils_readbuffer_fd -> p_read -> read
[01:58:09] <WindowsBunny> eddyb: It also references errno twice
[01:58:12] <WindowsBunny> :D
[01:58:16] <eddyb> radare2 was good for something
[01:58:28] <WindowsBunny> eddyb: Man, this is fun reversing backtraces
[02:00:24] <eddyb> too many possible values for the next one up
[02:00:36] <WindowsBunny> eddyb: Yeah, I have no idea
[02:00:42] <eddyb> WindowsBunny: what's the calsite after the last one you've listed?
[02:01:43] <WindowsBunny> hmmm
[02:01:50] <WindowsBunny> the offset between VS and IDA addresses is 7FF5 1900 0000
[02:01:59] <WindowsBunny> so....
[02:02:18] *** Joins: erickt (erickt@moz-pbfo6r.hfc.comcastbusiness.net)
[02:02:18] *** ChanServ sets mode: +ao erickt erickt
[02:02:24] <WindowsBunny> 1 4063 4780 ?
[02:02:57] <WindowsBunny> .text:0000000140634780 
[02:03:40] <WindowsBunny> which is... git_config_add_backend?
[02:04:43] <eddyb>             ;-- sym.cargo.exe_git_config_add_backend:                                                                                                             
[02:04:48] <eddyb> yupp
[02:04:57] <WindowsBunny> eddyb: But it's not defined in libgit2
[02:05:23] <WindowsBunny> libgit2 just externs it
[02:05:26] <eddyb> fun
[02:06:22] <eddyb> git_config_add_backend -> git_config__add_internal.... which doesn't call any of the above
[02:06:38] <eddyb> 	if ((result = file->open(file, level)) < 0)
[02:06:46] <eddyb> such OOP
[02:08:23] <WindowsBunny> eddyb: Figure out where in rust we define git_config_add_backend
[02:08:26] <WindowsBunny> It has to be somewhere
[02:08:48] <eddyb> git_config_add_backend -> (via file->open) config_open -> git_futils_readbuffer_updated -> git_futils_readbuffer_fd -> p_read -> read
[02:09:01] <WindowsBunny> eddyb: It looks like a shitty version of COM
[02:09:07] <WindowsBunny> manual vtables
[02:09:45] <eddyb> WindowsBunny: everyone does it
[02:09:50] <eddyb> linux kernel is full of it
[02:10:03] <WindowsBunny> eddyb: Find where we define git_config in our rust code
[02:10:13] <eddyb> WindowsBunny: what's the caller before that one?
[02:10:24] <eddyb> there's like 3 possible callers in libgit2 code
[02:11:40] <WindowsBunny> eddyb: git_config_add_file_ondisk calls it
[02:11:56] <eddyb> and before that?
[02:12:23] *** Quits: erickt (erickt@moz-pbfo6r.hfc.comcastbusiness.net) (Ping timeout: 121 seconds)
[02:12:25] <WindowsBunny> eddyb: git_config_open_default
[02:12:42] <eddyb> so where is this in Rust?
[02:12:52] <eddyb> do I have to ask for the backtrace one at a time :D?
[02:13:01] <WindowsBunny> called by....
[02:13:02] <WindowsBunny> .text:0000000140384980
[02:13:09] <WindowsBunny> config::Config::open_default::h64167ed234eb45c4a6c
[02:13:10] <WindowsBunny> Rust!
[02:13:22] <eddyb> sym.cargo.exe__ZN6config6Config12open_default20h64167ed234eb45c4a6cE:
[02:13:45] <eddyb> well, there you have it, and it's probably useless :P
[02:13:47] <WindowsBunny> eddyb: Now find that rust code
[02:13:56] <eddyb> WindowsBunny: libgit2-rs
[02:14:16] <eddyb> WindowsBunny: https://github.com/alexcrichton/git2-rs/blob/master/src/config.rs#L64
[02:14:34] <WindowsBunny> eddyb: oh boy!
[02:15:50] *** Joins: erickt (erickt@moz-pbfo6r.hfc.comcastbusiness.net)
[02:15:50] *** ChanServ sets mode: +ao erickt erickt
[02:16:06] <eddyb> WindowsBunny: what, is this useful in any way?
[02:16:13] <WindowsBunny> eddyb: not quite
[02:16:38] <WindowsBunny> eddyb: so now what we have to do is figure out where it is getting the file handle from
[02:16:40] <WindowsBunny> that it attempts to read
[02:16:53] <eddyb> right
[02:17:39] <eddyb> that would be git_futils_open_ro
[02:17:57] <WindowsBunny> eddyb: https://github.com/libgit2/libgit2/blob/c7f94123569e8fe00ffb3a35e6a12b6ebe9320ec/src/config.c#L1113-L1145
[02:18:03] <eddyb> -> p_open -> open
[02:18:43] <eddyb> WindowsBunny: it just calls the CRT's open function
[02:18:56] <WindowsBunny> eddyb: But does it call it from the debug or the release version of the CRT D:
[02:19:08] <eddyb> it calls from whichever one it was linked to
[02:19:13] <WindowsBunny> eddyb: BOTH ARE LINKED
[02:19:21] <eddyb> to libgit2 specifically
[02:19:29] <eddyb> although I have no idea how that works on windows
[02:19:52] *** Quits: erickt (erickt@moz-pbfo6r.hfc.comcastbusiness.net) (Ping timeout: 121 seconds)
[02:20:05] <eddyb> if it's a static library, it must be resolved when it's finally linked together into an executable
[02:20:12] <eddyb> WindowsBunny: you could breakpoint open :D
[02:20:21] <WindowsBunny> eddyb: I try to set a breakpoint with VS
[02:20:24] <WindowsBunny> but it never fires!
[02:20:27] <eddyb> fun
[02:20:31] <eddyb> let me look at relocs
[02:20:52] <reem> is there an expand_macros macro?
[02:21:22] <WindowsBunny> eddyb: http://i.imgur.com/sTl2M82.png
[02:21:25] <reem> (or a way to get the same effect)?
[02:21:26] <WindowsBunny> both are linked!
[02:21:48] <eddyb> reem: no, that would be the $! I mentioned
[02:22:05] <eddyb> WindowsBunny: so 0x00000001406A0492 is where git_futils_readbuffer_fd is called
[02:22:25] <eddyb> git_futils_open_ro has to happen in the same function, just before it
[02:22:51] <eddyb> and if the result of git_futils_open_ro is < 0, it returns
[02:23:14] <WindowsBunny> For all I know, libgit2 could be broken
[02:23:32] <WindowsBunny> This calls for.... investigation!
[02:24:05] <eddyb> 0x1406a17c0 is git_futils_open_ro
[02:24:06] <WindowsBunny> hmmm
[02:24:28] <WindowsBunny> eddyb: I'm gonna make a quick shitty C++ program that links to the libgit2.lib
[02:24:30] <WindowsBunny> and debug it!
[02:24:43] <eddyb> so 0x14069c9b0 is p_open
[02:25:10] <eddyb> haha I know why you didn't find it
[02:25:31] <eddyb>       |    0x14069ca93    ff15474e0e00 call qword [rip+0xe4e47] ;[5]                                                                                                    |       0x1407818e0() ; reloc.MSVCR120.dll__wopen
[02:25:35] <eddyb> well that copied wrong
[02:25:44] <eddyb> WindowsBunny: it's _wopen
[02:27:05] <eddyb> WindowsBunny: libgit2 doesn't use the debug CRT
[02:27:16] <WindowsBunny> eddyb: _wopen is from the release CRT
[02:27:23] <WindowsBunny> but _read is from the debug CRT
[02:27:26] <eddyb> actually
[02:27:33] <eddyb> let me just see what imports come from where
[02:27:41] <eddyb> (with, you know, grep)
[02:27:53] <WindowsBunny> eddyb: _wopen comes from msvcr120 and _read comes from msvcr120d
[02:27:56] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[02:28:08] <eddyb> WindowsBunny: actually, you have all the MSVCR120D imports *right there*
[02:28:08] <WindowsBunny> so if it is passing _wopen's handle to _read, that's just shitty CRT mixing
[02:28:15] <eddyb> oh
[02:28:30] <eddyb> haha I didn't even realize that
[02:28:32] <WindowsBunny> eddyb: Each CRT has its own tables of CRT objects
[02:28:47] <eddyb> yeah, it doesn't import _read and _wopen from the same CRT
[02:29:01] <eddyb> now hang on, posix.c calls open not _wopen
[02:29:04] <WindowsBunny> acrichto: You need to fix whatever is causing the debug CRT to be linked :D
[02:29:40] <WindowsBunny> eddyb: there's no open
[02:29:44] <eddyb> WindowsBunny: _wopen is called from win32/posix_w32.c while _read is called from posix.c
[02:29:58] <WindowsBunny> ugh
[02:30:05] <eddyb> something tells me the compile commands for those aren't even similar
[02:30:11] <eddyb> well, maybe similar, but not identical
[02:30:12] <WindowsBunny> Anyway, once that debug CRT issue is fixed
[02:30:29] <WindowsBunny> acrichto: I think maybe its because you're telling cmake to build libgit2 in Debug mode
[02:30:32] <WindowsBunny> which implies debug CRT
[02:31:45] <eddyb> WindowsBunny: win32/* is in SRC_OS
[02:31:51] <WindowsBunny> one sec
[02:31:55] <WindowsBunny> lemme hack up libgit2
[02:31:55] <WindowsBunny> >:D
[02:31:59] <WindowsBunny> erm
[02:31:59] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[02:32:02] <eddyb> ADD_LIBRARY(git2 ${SRC_H} ${SRC_GIT2} ${SRC_OS} ${SRC_ZLIB} ${SRC_HTTP} ${SRC_REGEX} ${SRC_SHA1} ${WIN_RC})
[02:32:06] <WindowsBunny> the -sys crate rather
[02:32:11] <eddyb> doesn't look like it gets special treatment though
[02:32:16] <WindowsBunny> eddyb: https://github.com/alexcrichton/git2-rs/blob/master/libgit2-sys/build.rs#L84
[02:32:55] <WindowsBunny> I'm gonna patch that, if it works, yay!
[02:32:57] <eddyb> yeah, but, why isn't everything built with that?
[02:33:19] <eddyb> WindowsBunny: or is the linking step just screwing everything up?
[02:33:56] <eddyb> WindowsBunny: derp
[02:34:12] <eddyb> https://github.com/alexcrichton/git2-rs/blob/master/libgit2-sys/build.rs#L80
[02:34:30] <eddyb> in debug mode, libgit2 tries to statically link to the debug CRT
[02:34:54] <eddyb> which might work
[02:34:56] <WindowsBunny> eddyb: Well, the static issue was fixed by another command
[02:35:11] <eddyb> but then this build script fudges it
[02:35:29] <WindowsBunny> cmd.arg("-DSTATIC_CRT=OFF");
[02:35:42] <WindowsBunny> it tells cmake to not use the static crt
[02:35:53] <eddyb> WindowsBunny: wait, no, I'm wrong
[02:36:00] <eddyb> WindowsBunny: that's the line I linked to
[02:36:20] <WindowsBunny> it says STATIC_CRT=OFF
[02:36:21] <eddyb> for some reason I didn't see the logic in CMakeLists
[02:36:23] <WindowsBunny> which means dynamic CRT
[02:41:05] <WindowsBunny> eddyb: I hate msys2's git
[02:41:12] <WindowsBunny> I checkout the submodules
[02:41:16] <WindowsBunny> I get these lovely warnings
[02:41:17] <WindowsBunny> ': not a valid identifierline 88: export: `sha1
[02:41:17] <WindowsBunny> ': not a valid identifierline 88: export: `displaypath
[02:42:40] <WindowsBunny> augh, same debug assert
[02:43:10] <WindowsBunny> fuuuu
[02:43:14] <WindowsBunny> it is still linking to the debug CRT
[02:43:29] <WindowsBunny> eddyb: Okay, so _some_ C/C++ somewhere is being linked against the debug CRT
[02:43:45] *** Joins: Feyn (aram@moz-88k.k93.115.42.IP)
[02:43:49] <eddyb> WindowsBunny: turn everything to verbose?
[02:44:08] <WindowsBunny> its not advapi32-sys or kernel32-sys
[02:44:13] <eddyb> WindowsBunny: or inspect the things that go into the final link step
[02:44:24] <eddyb> like, static libs and whatnot
[02:44:46] <eddyb> you can start with libgit2, maybe it's not uniform
[02:45:38] <WindowsBunny> eddyb: I just need to look at anything with a build script
[02:46:38] <eddyb> (well, that was my first guess when I saw that _wopen comes from a file and _read from a different one)
[02:46:50] <WindowsBunny> so it could be curl-sys or libgit2-sys or libssh2-sys or libz-sys or miniz-sys or time
[02:47:18] *** Quits: zz_kimundi (kimundi@moz-0a7524.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:47:23] <WindowsBunny> eddyb: Maybe its picks the first import from the libraries that are linked in?
[02:47:34] <WindowsBunny> So it decides to grab _wopen from one and _read from the other?
[02:48:32] <WindowsBunny> hmmmm
[02:48:46] <WindowsBunny> https://github.com/carllerche/curl-rust/blob/master/curl-sys/build.rs#L157
[02:48:51] <WindowsBunny> It shouldn't be curl-sys
[02:49:01] <WindowsBunny> libgit2-sys I just possibly fixed
[02:49:41] <eddyb> WindowsBunny: just look at the static library
[02:50:01] <WindowsBunny> fffff
[02:50:07] <WindowsBunny> libgit2 is still being built in Debug
[02:50:14] *** Joins: zz_kimundi (kimundi@moz-357luu.dip0.t-ipconnect.de)
[02:50:15] *** zz_kimundi is now known as kimundi
[02:52:08] <bstrie> argh, discourse is down
[02:52:36] *** chmanchester is now known as chmanchester|afk
[02:53:22] <cmr> only users.rlo it seems?
[02:54:50] <eddyb> WindowsBunny: told ya
[02:58:05] *** Joins: p1start (p1start@moz-nftjhe.org)
[02:58:13] *** Quits: dustinm (dustinm@moz-9ms.n6q.68.208.IP) (Quit: ERC Version 5.3 (IRC client for Emacs))
[02:59:39] *** Quits: blaenk (blaenkdenum@moz-ggnkpd.res.rr.com) (Quit: Leaving)
[03:00:17] <WindowsBunny> okay, what the fuck
[03:00:39] <WindowsBunny> How do I force it to do Release mode Q_Q
[03:00:57] *** Quits: frewsxcv (sid86219@moz-dneii9.brockwell.irccloud.com) (Quit: )
[03:01:04] <eddyb> that might be part of the problem :P
[03:01:16] *** Quits: playbot-mini (playbot-min@moz-1vk5qd.compute.amazonaws.com) (RecvQ exceeded)
[03:01:17] *** Quits: playbot (playbot@moz-1vk5qd.compute.amazonaws.com) (RecvQ exceeded)
[03:01:27] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[03:01:27] *** Joins: playbot-mini (playbot-min@moz-1vk5qd.compute.amazonaws.com)
[03:01:28] *** Joins: playbot (playbot@moz-1vk5qd.compute.amazonaws.com)
[03:01:34] * eddyb wonders if it's a good idea to use fmt::Write in pprust. probably so :D
[03:02:49] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Quit: Leaving)
[03:02:56] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[03:02:58] *** Parts: genbattle (genbattle@moz-4v0.gkd.16.182.IP) ("Leaving")
[03:02:58] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[03:03:08] *** Joins: genbattle (genbattle@moz-4v0.gkd.16.182.IP)
[03:03:43] <WindowsBunny> eddyb: fuck it, I'm eating some food
[03:03:45] *** Quits: summerlight (summerlight@moz-99k.2mj.130.121.IP) (Quit: Leaving)
[03:03:52] <WindowsBunny> eddyb: I'll be back soon to rant some more about cmake
[03:04:15] *** Joins: summerlight (summerlight@moz-99k.2mj.130.121.IP)
[03:04:44] <aatch> WindowsBunny, oh, cmake. I normally find I have to delete all the `CMakeFiles.txt` files before it takes any notice of new settings.
[03:07:43] * eddyb squints at aatch
[03:08:01] *** Joins: yjv (yjv@moz-ll38tk.pa.comcast.net)
[03:08:05] <aatch> eddyb, yes?
[03:08:06] <eddyb> aatch: isn't CMakeFiles.txt the cmake "script"?
[03:08:09] <cmr> no
[03:08:12] <cmr> that's CMakeLists.txt
[03:08:15] <cmr> CMakeFiles.txt
[03:08:16] <eddyb> oh, right
[03:08:17] <cmr> is a cache
[03:09:19] <aatch> Also, I think it's CMakeCache.txt I end up deleting.
[03:09:44] <aatch> CMakeFiles is more-or-less the build directory.
[03:11:01] *** Quits: graydon (graydon@moz-dose3e.dyn.novuscom.net) (Connection closed)
[03:13:13] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[03:15:11] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[03:15:17] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[03:17:15] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Ping timeout: 121 seconds)
[03:17:35] <WindowsBunny> aatch: I did a cargo clean to ensure the cache is gone
[03:17:55] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[03:18:26] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[03:19:32] *** Joins: erickt (erickt@moz-f8cbii.dynamic.sonic.net)
[03:19:32] *** ChanServ sets mode: +ao erickt erickt
[03:22:20] *** Quits: Eridius (kevin@moz-6opvqs.us) (Quit: leaving)
[03:22:23] *** Joins: Eridius (kevin@moz-6opvqs.us)
[03:22:32] *** Quits: skeuomorf (skeuomorf@moz-ne6.2md.32.197.IP) (Ping timeout: 121 seconds)
[03:23:06] *** Quits: bvssvni (sven@moz-fc63b3.bb.online.no) (Ping timeout: 121 seconds)
[03:27:14] <WindowsBunny> so what the heck
[03:27:24] <WindowsBunny> why is it building libgit2 in debug mode? D:
[03:27:41] *** Joins: yjv_ (yjv@moz-j0cdis.fios.verizon.net)
[03:28:20] *** Quits: Jesin (Jesin@moz-4jre1i.eecs.lehigh.edu) (Quit: Leaving)
[03:28:42] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[03:29:37] *** Quits: erickt (erickt@moz-f8cbii.dynamic.sonic.net) (Ping timeout: 121 seconds)
[03:30:02] *** Quits: yjv (yjv@moz-ll38tk.pa.comcast.net) (Ping timeout: 121 seconds)
[03:30:28] *** Joins: bvssvni (sven@moz-it1l50.bb.online.no)
[03:32:44] <WindowsBunny> >To change the build type, on Windows, it must be done at build time:
[03:32:45] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[03:33:07] <WindowsBunny> srsly?
[03:33:27] <WindowsBunny> of course
[03:33:28] <WindowsBunny> that was it
[03:33:50] <eddyb> WindowsBunny: what was?
[03:34:10] <WindowsBunny> eddyb: In the second invocation to cmake
[03:34:14] <WindowsBunny> You have to pass 
[03:34:15] <WindowsBunny>                 .arg("--config").arg("Release")
[03:34:26] <WindowsBunny> But that only applies to VS it seems
[03:34:39] <WindowsBunny> friggin
[03:34:47] <eddyb> lol
[03:35:10] <WindowsBunny> eddyb: This answer was so helpful http://stackoverflow.com/a/20423820/1357321
[03:35:49] <WindowsBunny> eddyb: and the answer below it
[03:36:49] <WindowsBunny> acrichto: Right here https://github.com/alexcrichton/git2-rs/blob/master/libgit2-sys/build.rs#L104-L107
[03:37:01] <WindowsBunny> acrichto: When building for msvc, add .arg("--config").arg("Release")
[03:37:44] <WindowsBunny> acrichto: Proof that it fixes it http://i.imgur.com/LGOlQPM.png
[03:39:30] <eddyb> is 1.2 going to be the MSVC release?
[03:40:05] <WindowsBunny> eddyb: Depends on whether the llvm upgrade lands and SEH unwinding can be added
[03:40:41] <WindowsBunny> eddyb: But if we can get that in for 1.2, then yes 1.2 will be the msvc release :P
[03:47:48] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[03:50:07] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[03:52:41] <reem> If I want to capture a number for using as a tuple index in a macro, what fragment specifier should I use?
[03:53:02] <huon> tt
[03:53:46] <bluss> need to use the as_expr!() workaround
[04:07:02] *** Quits: njn (chatzilla@moz-0ah9lm.iinet.net.au) (Quit: ChatZilla 0.9.91.1 [Firefox 41.0a1/20150531163607])
[04:07:19] *** Joins: njn (chatzilla@moz-0ah9lm.iinet.net.au)
[04:11:57] *** Joins: aepsil0n (eduard@moz-gtoi2p.hsi8.kabel-badenwuerttemberg.de)
[04:16:19] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[04:20:41] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[04:22:39] *** aatch is now known as help
[04:22:44] *** help is now known as aatch
[04:25:21] *** Quits: jyyou (jyyou@moz-nhbjfr.bo6r.4bjo.8900.2400.IP) (Quit: WeeChat 1.2)
[04:25:26] *** Joins: jyyou (jyyou@moz-nhbjfr.bo6r.4bjo.8900.2400.IP)
[04:29:29] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[04:32:41] *** Quits: aepsil0n (eduard@moz-gtoi2p.hsi8.kabel-badenwuerttemberg.de) (Quit: Leaving.)
[04:33:31] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[04:35:33] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[04:35:33] *** ChanServ sets mode: +ao erickt erickt
[04:47:56] *** Joins: SuppliedRelic__ (SuppliedRel@moz-7vh0cn.instavps.net)
[04:48:30] *** Quits: Kxepal (Miranda@moz-oc8g1c.pppoe.mtu-net.ru) (Ping timeout: 121 seconds)
[04:49:44] *** Joins: semarie (semarie@moz-9n2v7s.bpv6.bg1u.41d0.2001.IP)
[04:49:57] *** SuppliedRelic__ is now known as 203AAPA9L
[04:50:23] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[04:51:31] *** Joins: mbrubeck (sid61@moz-2pjnuf.0j4i.jtu0.0101.2620.IP)
[04:51:31] *** ChanServ sets mode: +ao mbrubeck mbrubeck
[04:53:47] <acrichto> WindowsBunny: whoa nice find! here I was thinking that CMAKE_BUILD_TYPE was sufficient :\
[04:53:53] <acrichto> naive me
[04:54:03] *** Quits: 203AAPA9L (SuppliedRel@moz-7vh0cn.instavps.net) (Ping timeout: 121 seconds)
[04:54:52] *** Joins: pfporgkqwr[gpkqwe[gpk (SuppliedRel@moz-qc5.c72.42.45.IP)
[04:55:07] *** Joins: Havvy (Havvy@moz-epv20b.wa.comcast.net)
[04:55:21] *** pfporgkqwr[gpkqwe[gpk is now known as SoopliedRelich
[04:55:56] *** SoopliedRelich is now known as 557AAKDTL
[04:56:39] *** Quits: Skyler (Skyler@moz-7ds39s.sd.cox.net) (Client exited)
[04:56:45] *** Joins: Skyler (Skyler@moz-7ds39s.sd.cox.net)
[04:56:58] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[04:57:15] *** Parts: mbrubeck (sid61@moz-2pjnuf.0j4i.jtu0.0101.2620.IP) ("")
[04:57:18] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[04:57:31] *** Quits: 557AAKDTL (SuppliedRel@moz-qc5.c72.42.45.IP) (G-Lined: spam)
[04:59:15] *** Quits: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com) (Quit: leaving)
[04:59:20] *** Joins: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com)
[04:59:21] *** ChanServ sets mode: +o acrichto
[05:01:18] <sfackler> cmake is weird
[05:01:32] <cmr> it is.
[05:02:12] <sfackler> acrichto: is there an equivalent to Into<T> for this kind of thing? https://github.com/sfackler/rust-postgres/blob/breaks/src/lib.rs#L145-L148
[05:02:28] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[05:03:06] <acrichto> sfackler: not currently
[05:06:30] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Ping timeout: 121 seconds)
[05:11:10] *** Quits: genbattle (genbattle@moz-4v0.gkd.16.182.IP) (Ping timeout: 121 seconds)
[05:12:39] *** Quits: Rym (uid91135@moz-n2i7qm.charlton.irccloud.com) (Quit: Connection closed for inactivity)
[05:14:28] *** Joins: p1start (p1start@moz-nftjhe.org)
[05:16:48] <WindowsBunny> acrichto: By the way, you should set the profile for libgit2-sys to Release unconditionally if building for msvc
[05:17:18] <acrichto> WindowsBunny: guh
[05:17:34] <WindowsBunny> acrichto: Because if it builds for Debug, it'll try to link the debug CRT
[05:17:39] <acrichto> yup
[05:18:07] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[05:19:43] <WindowsBunny> acrichto: Or you could just force it to use the release crt even in Debug
[05:20:05] <WindowsBunny> erm
[05:20:17] <WindowsBunny> that would involve modifying the cmakelists of libgit2 though
[05:20:28] <acrichto> yeah not sure I wanna do that ...
[05:20:49] <WindowsBunny> since they set those flags unconditionally
[05:20:51] <WindowsBunny> SET(CMAKE_C_FLAGS_DEBUG "/Zi /Od /D_DEBUG /RTC1 ${CRT_FLAG_DEBUG}")
[05:21:33] <acrichto> nope nope nope
[05:21:51] <WindowsBunny> So you'll just have to resort to Release or RelWithDebInfo
[05:22:34] <WindowsBunny> I think RelWithDebInfo is a bit better suited for debug mode
[05:22:35] <acrichto> WindowsBunny: success \o/
[05:22:48] <acrichto> no way this will pass tests, but it builds!
[05:22:55] <WindowsBunny> acrichto: Great! I look forward to cargo msvc nightlies soon :D
[05:23:00] <acrichto> now can it bootstrap...
[05:23:07] <WindowsBunny> oooo, the real test
[05:23:19] *** Quits: O01eg (o01eg@moz-32r1fi.ie0e.4n8f.2698.2a02.IP) (Client exited)
[05:23:51] <acrichto> downloading lots of stuff
[05:23:55] <acrichto> so curl/ssl work
[05:24:00] <acrichto> compiling lots of stuff...
[05:24:31] *** Quits: zmike (discomfitor@moz-94l.v53.167.208.IP) (Ping timeout: 121 seconds)
[05:24:36] *** Quits: bdero (bran@moz-0e2lk5.sns9.e6pb.0197.2601.IP) (Ping timeout: 121 seconds)
[05:25:33] <acrichto> cargo depends on a huge number of dlls
[05:26:06] <WindowsBunny> acrichto: system dlls?
[05:26:11] <acrichto> yeah
[05:26:14] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[05:26:21] <WindowsBunny> yeah, libgit2 links a few of them
[05:26:25] <acrichto> almost done with a self bootstrap..
[05:26:28] <acrichto> libcurl pulled in a bunch as well
[05:26:31] <acrichto> ssh was pretty good I think
[05:27:01] <acrichto> bootstrap success!
[05:27:44] <WindowsBunny> acrichto: Nice!
[05:28:16] <acrichto> WindowsBunny: nice debugging work :)
[05:30:15] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[05:32:25] <eddyb> Manishearth: so I have a function calling to_string() on a String
[05:32:31] <eddyb> Manishearth: which it owns
[05:32:40] <eddyb> Manishearth: and rustc's none the wiser
[05:33:08] <WindowsBunny> acrichto: Good luck on your llvm upgrade. You need all the luck you can get it seems.
[05:33:13] <acrichto> :\
[05:33:32] <acrichto> WindowsBunny: building a 32-bit rustc to see the failure now...
[05:33:38] <acrichto> and praying it fails on linux as well as osx
[05:33:42] <acrichto> and it doesn't
[05:33:43] <acrichto> great
[05:34:04] <Manishearth> eddyb: ?
[05:34:17] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[05:34:21] <WindowsBunny> acrichto: I'm so glad this is IRC where you can't see how much I'm laughing at your plight right now
[05:34:24] <eddyb> Manishearth: is this one of the things lint armies poke at?
[05:34:28] <Manishearth> eddyb: yes
[05:34:31] <Manishearth> file a bug
[05:34:37] <acrichto> WindowsBunny: you're so kind
[05:35:12] <acrichto> WindowsBunny: btw the reason I didn't see that build failure from earlier is: https://llvm.org/bugs/show_bug.cgi?id=22619
[05:35:21] <acrichto> (only old clang)
[05:35:53] <Havvy> Why is to_string even callable on a String?
[05:36:06] <Mutabah> Havvy: Because it's for T: Display
[05:36:12] <Mutabah> to_string uses format!
[05:36:50] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[05:37:12] <Havvy> Oh.
[05:37:39] <WindowsBunny> acrichto: Maybe one day someone will update the software on the buildbots
[05:38:20] <eddyb> WindowsBunny: and maybe someone will invent something to replace buildbot
[05:38:40] <WindowsBunny> eddyb: I can only invent things that work on windows only :(
[05:45:33] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[05:47:52] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[05:47:54] <acrichto> WindowsBunny: https://github.com/rust-lang/cargo/pull/1724
[05:48:38] <WindowsBunny> https://github.com/rust-lang/term/commit/7190174765fc2e81a822208d319f6013918df8e3
[05:48:44] <WindowsBunny> acrichto: winapi should compile on unix though?
[05:48:53] <acrichto> dunno :(
[05:48:59] <acrichto> hit some weird error really quickly
[05:49:02] <acrichto> didn't investigate much though
[05:49:06] <acrichto> may have been my mistake
[05:49:06] <WindowsBunny> I have tests on travis-ci just to make sure it works!
[05:49:22] <acrichto> is it basically a big noop on unix?
[05:49:26] <acrichto> or does it compile in all the structs/constants?
[05:49:50] <WindowsBunny> acrichto: https://github.com/retep998/winapi-rs/blob/master/src/lib.rs#L7
[05:49:57] <WindowsBunny> #![cfg(windows)]
[05:50:01] <acrichto> that's.. what I thought
[05:50:26] <sfackler> I don't think you can cfg the entire crat
[05:50:28] <sfackler> e
[05:50:42] <sfackler> maybe you can though?
[05:50:42] *** Joins: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net)
[05:50:53] <WindowsBunny> sfackler: I dunno, travis-ci seems to be pretty okay with it
[05:50:55] <cmr> sfackler: you can.
[05:51:08] <acrichto> I remember adding support for that at some point
[05:51:08] <WindowsBunny> https://travis-ci.org/retep998/winapi-rs
[05:51:14] <acrichto> guess it did make it into 1.0
[05:51:21] <WindowsBunny> Notice how it runs 0 tests
[05:52:29] <acrichto> WindowsBunny: I wonder if I had an override in play by accident
[05:52:35] <acrichto> b/c that was around the time I was playing around with dbhelp
[05:52:37] <acrichto> dbghelp*
[05:53:48] <WindowsBunny> possibly
[05:55:00] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[05:56:21] *** Joins: James_ (quassel@moz-g7un1m.range86-163.btcentralplus.com)
[05:57:51] *** Quits: yjv_ (yjv@moz-j0cdis.fios.verizon.net) (Connection closed)
[05:59:13] <acrichto> WindowsBunny: this is the error I saw: https://gist.github.com/alexcrichton/7249e0f9a60a5823d425
[05:59:23] <acrichto> that's if I depend on winapi unconditionally on unix
[05:59:26] <acrichto> and I build on linux
[05:59:44] <WindowsBunny> huh
[06:00:13] <acrichto> WindowsBunny: ah, looks like you added the #[cfg] btwn 0.1.17 and 0.1.22
[06:00:17] <acrichto> after an update it's fixed
[06:00:34] <WindowsBunny> acrichto: yeah, you were just using an outdated winapi
[06:03:24] *** Quits: aatch (james@moz-c6etfk.fosn.r6an.e000.2406.IP) (Connection closed)
[06:03:56] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[06:07:04] *** Quits: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net) (Ping timeout: 121 seconds)
[06:20:12] *** Joins: Kingsquee (kingsley@moz-3fm07c.bchsia.telus.net)
[06:20:41] *** Quits: semarie (semarie@moz-9n2v7s.bpv6.bg1u.41d0.2001.IP) (A record packet with illegal version was received.)
[06:23:43] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[06:24:55] *** Joins: semarie (semarie@moz-g3imo8.dsl.ovh.fr)
[06:26:08] *** Joins: techzapper (techiewicki@moz-er3.jjd.88.202.IP)
[06:26:48] *** Quits: semarie (semarie@moz-g3imo8.dsl.ovh.fr) (Quit: leaving)
[06:26:54] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[06:31:13] *** Joins: erz (erz@moz-ab429s.broadband.corbina.ru)
[06:33:38] *** Quits: ebfull (ebfull@moz-2hf06a.co.comcast.net) (Quit: Konversation terminated!)
[06:36:25] *** Quits: summerlight (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[06:37:54] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[06:41:34] *** Joins: oli_obk__ (Mibbit@moz-7bq.0sb.52.141.IP)
[06:48:00] *** Joins: semarie (semarie@moz-9n2v7s.bpv6.bg1u.41d0.2001.IP)
[06:51:26] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[06:52:52] *** Quits: James_ (quassel@moz-g7un1m.range86-163.btcentralplus.com) (Ping timeout: 121 seconds)
[06:55:30] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[07:04:18] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[07:05:12] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Quit: Leaving)
[07:05:19] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[07:09:12] *** Joins: laumann (thomas@moz-3m6.3kq.109.2.IP)
[07:09:38] *** Quits: huseby (huseby@moz-m7l0au.d2vr.5em6.6400.2605.IP) (Ping timeout: 121 seconds)
[07:09:55] *** Quits: semarie (semarie@moz-9n2v7s.bpv6.bg1u.41d0.2001.IP) (Quit: leaving)
[07:13:52] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[07:14:36] *** Joins: doener (doener@moz-eku96m.hsi08.unitymediagroup.de)
[07:15:34] *** Quits: erz (erz@moz-ab429s.broadband.corbina.ru) (Quit: My Mac has gone to sleep. ZZZzzz…)
[07:15:41] *** Parts: bvssvni (sven@moz-it1l50.bb.online.no) ()
[07:15:53] *** Joins: huseby (huseby@moz-m7l0au.d2vr.5em6.6400.2605.IP)
[07:17:27] *** Quits: vadimcn (uid46608@moz-0d43u8.highgate.irccloud.com) (Quit: Connection closed for inactivity)
[07:21:10] *** Joins: mukilan (mukilan@moz-0he.e0v.164.122.IP)
[07:22:22] *** Joins: semarie (semarie@moz-9n2v7s.bpv6.bg1u.41d0.2001.IP)
[07:24:11] *** Joins: ptalbot (ptalbot@moz-1gn7gb.eu0n.jcdj.0660.2001.IP)
[07:28:30] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[07:30:17] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[07:30:17] *** ChanServ sets mode: +ao erickt erickt
[07:36:26] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[07:39:03] *** Joins: yjv (yjv@moz-ll38tk.pa.comcast.net)
[07:41:22] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[07:41:33] *** Quits: ptalbot (ptalbot@moz-1gn7gb.eu0n.jcdj.0660.2001.IP) (Connection closed)
[07:41:38] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[07:42:41] *** Joins: ptalbot (ptalbot@moz-1gn7gb.eu0n.jcdj.0660.2001.IP)
[07:44:01] *** Quits: yjv (yjv@moz-ll38tk.pa.comcast.net) (Ping timeout: 121 seconds)
[07:44:11] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[07:53:17] *** Quits: clatour (clatour@moz-7m73an.hlrn.qwest.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[07:53:22] *** Joins: clatour (clatour@moz-7m73an.hlrn.qwest.net)
[08:00:20] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[08:08:47] *** Joins: vmx (vmx@moz-mpc5rn.pools.vodafone-ip.de)
[08:14:27] *** Quits: koobs (koobs@moz-lu0tvm.internode.on.net) (Ping timeout: 121 seconds)
[08:16:09] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[08:24:31] *** Joins: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP)
[08:25:11] <Mutabah> Is it possible to disable all forms of TLS in rustc/llvm?
[08:25:17] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[08:25:44] <aatch> Mutabah, probably not.
[08:25:59] <Mutabah> :(
[08:26:05] <aatch> Mutabah, especially given eddyb's latest patch. (Not that it's merged)
[08:26:07] <aatch> Mutabah, why?
[08:26:17] <Mutabah> TLS on x86_64 uses fs as a base
[08:26:26] <Mutabah> Changing FS's base address is non-trivial
[08:26:35] <Manishearth> Mutabah: TLS has fallbacks for systems that don't support it iirc
[08:27:18] <Mutabah> Basically want a flag I can give to prevent/error on any form of TLS. Even stack checks etc
[08:27:40] <aatch> Mutabah, unless you're talking about disabling TLS in built code.
[08:28:01] <Mutabah> Yeah
[08:28:27] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[08:28:30] <Mutabah> I'm mostly trying to be defensive. If fs-based accesses sneak in, they'll cause crashes
[08:32:23] *** Quits: nham (nham@moz-lglsfe.il.comcast.net) (Quit: leaving)
[08:33:54] *** Joins: goyox86 (textual@moz-qfs.570.70.83.IP)
[08:33:57] <WindowsBunny> Mutabah: well turn off morestack for one
[08:43:26] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[08:43:56] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[08:51:36] *** Joins: vadimcn (uid46608@moz-0d43u8.highgate.irccloud.com)
[08:51:46] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Quit: ChatZilla 0.9.91.1 [Firefox 38.0.5/20150525141253])
[09:02:18] *** Joins: goyox86_ (textual@moz-qfs.570.70.83.IP)
[09:04:23] *** Joins: lorenzb (lorenzb@moz-j9mkes.cust.swisscom.ch)
[09:04:28] *** Quits: lorenzb (lorenzb@moz-j9mkes.cust.swisscom.ch) (Quit: Computer went to sleep)
[09:05:12] *** Quits: goyox86 (textual@moz-qfs.570.70.83.IP) (Ping timeout: 121 seconds)
[09:07:13] *** Quits: cdidd (cdidd@moz-5p9bfm.broadband.corbina.ru) (Quit: Leaving)
[09:11:57] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[09:13:58] *** Quits: capella-s3 (capella-s3@moz-vcqob4.res.rr.com) (Quit: Talk atcha later)
[09:14:04] *** Joins: capella-s3 (capella-s3@moz-vcqob4.res.rr.com)
[09:20:33] *** Quits: vky (vky@moz-fqci96.ca.comcast.net) (Ping timeout: 121 seconds)
[09:22:33] *** Quits: tekacs (tekacs@moz-q64vt8.com) (Quit: Disappearing... *poof*)
[09:22:35] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[09:27:06] *** Joins: ebfull (ebfull@moz-2hf06a.co.comcast.net)
[09:28:28] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[09:28:28] *** ChanServ sets mode: +ao erickt erickt
[09:28:31] *** Quits: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au) (Ping timeout: 121 seconds)
[09:28:42] *** Joins: tekacs (tekacs@moz-q64vt8.com)
[09:31:10] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[09:33:08] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[09:37:59] *** Joins: lorenzb (lorenzb@moz-j9mkes.cust.swisscom.ch)
[09:42:17] *** Joins: mjboa (mike@moz-gfdglf.hsi06.unitymediagroup.de)
[09:46:27] *** Joins: erz (erz@moz-ab429s.broadband.corbina.ru)
[09:48:08] *** Joins: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP)
[09:49:42] *** Quits: njn (chatzilla@moz-0ah9lm.iinet.net.au) (Quit: ChatZilla 0.9.91.1 [Firefox 41.0a1/20150531163607])
[09:54:25] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[09:54:36] *** Quits: mjboa (mike@moz-gfdglf.hsi06.unitymediagroup.de) (Ping timeout: 121 seconds)
[10:03:41] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Connection closed)
[10:07:41] *** Quits: lorenzb (lorenzb@moz-j9mkes.cust.swisscom.ch) (Quit: Computer went to sleep)
[10:15:12] <SimonSapin> Is this safe? https://github.com/SimonSapin/rust-movecell/blob/4539879d94/lib.rs#L19-L23
[10:16:01] <SimonSapin> Is `fn method(Rc<self>)` a thing?
[10:16:20] *** Joins: skeuomorf (skeuomorf@moz-ne6.2md.32.197.IP)
[10:17:04] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[10:19:22] *** Joins: summerlight (summerlight@moz-99k.2mj.130.121.IP)
[10:20:55] <Mutabah> SimonSapin: I think so...
[10:21:33] <Mutabah> SimonSapin: I remember something about "&self" being sugar for "self: &Self", so there might be rules for smart pointers too
[10:21:42] <SimonSapin> Mutabah: I assume you mean MoveCell safety. I tried Rc<self> and got a syntax error
[10:21:58] <Mutabah> Ah
[10:22:19] <SimonSapin> I’ll try `self: Rc<Self>` now, thanks
[10:22:31] <Mutabah> Dunno if that'd work though...
[10:22:39] <SimonSapin> let’s find out :)
[10:22:46] <aatch> Box<Self> works, but that might be special-cased
[10:23:52] <SimonSapin> error: mismatched self type: expected `Foo`: expected struct `Foo`, found struct `alloc::rc::Rc`
[10:34:26] <aatch> SimonSapin, oh, I think it only works for traits.
[10:35:36] *** Quits: vmx (vmx@moz-mpc5rn.pools.vodafone-ip.de) (Ping timeout: 121 seconds)
[10:36:33] *** Quits: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP) (Connection closed)
[10:39:26] *** Joins: vmx (vmx@moz-mpc5rn.pools.vodafone-ip.de)
[10:42:02] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[10:50:55] *** Joins: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP)
[10:50:55] *** Quits: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP) (Connection closed)
[10:50:56] *** Joins: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP)
[10:53:20] *** Quits: skeuomorf (skeuomorf@moz-ne6.2md.32.197.IP) (Ping timeout: 121 seconds)
[10:55:37] *** Joins: arielb1 (Mibbit@moz-cmi.jfj.114.192.IP)
[10:58:32] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[10:58:53] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[10:58:58] *** Joins: skeuomorf (skeuomorf@moz-ne6.2md.32.197.IP)
[11:10:52] *** Quits: sp3d (sp3d@moz-ik970v.enn1.s22b.000d.2601.IP) (Ping timeout: 121 seconds)
[11:11:15] *** Quits: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP) (Connection closed)
[11:14:44] *** Joins: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP)
[11:14:47] *** Quits: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP) (Connection closed)
[11:14:49] *** Joins: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP)
[11:17:11] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[11:17:11] *** ChanServ sets mode: +ao erickt erickt
[11:17:42] *** Joins: sp3d (sp3d@moz-re8m3s.mf75.3igv.0240.2601.IP)
[11:21:54] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[11:26:00] *** Quits: goyox86_ (textual@moz-qfs.570.70.83.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[11:31:54] *** Quits: samnmax (samnmax@moz-1vk.aq9.27.72.IP) (Quit: Ex-Chat)
[11:32:07] *** Joins: samnmax (samnmax@moz-1vk.aq9.27.72.IP)
[11:33:39] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[11:51:49] *** Joins: mjboa (mike@moz-gfdglf.hsi06.unitymediagroup.de)
[11:55:26] *** Joins: Quxxy_ (chatzilla@moz-0nv.jkp.167.59.IP)
[11:55:32] *** Quits: arielb1 (Mibbit@moz-cmi.jfj.114.192.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[11:56:26] *** Quits: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP) (Ping timeout: 121 seconds)
[11:56:31] *** Quxxy_ is now known as Quxxy
[11:57:26] *** Joins: ytain (ytain@moz-mgfsur.dsl.teksavvy.com)
[12:01:47] *** Joins: goyox86 (textual@moz-qfs.570.70.83.IP)
[12:01:50] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Quit: Lost terminal)
[12:03:04] *** Joins: mgottschlag (quassel@moz-ksbkca.qiv1.bbcb.1398.2a00.IP)
[12:08:24] <eddyb> Mutabah: is this about a kernel?
[12:08:33] <Mutabah> eddyb: Yeah
[12:08:36] *** chmanchester|afk is now known as chmanchester
[12:08:43] <eddyb> setting FS's base address *is* trivial
[12:08:57] <Mutabah> eddyb: It's a MSR change
[12:09:14] <Mutabah> which are kinda ... messy
[12:09:19] <eddyb> what?
[12:09:48] <eddyb> https://github.com/miselin/rustic/blob/master/src/start.s#L67-L72
[12:09:57] <eddyb> it's a GDT entry
[12:10:06] <Mutabah> x86_64
[12:10:10] <Mutabah> that's x86
[12:10:20] * eddyb slowly walks away
[12:10:36] <Mutabah> CPU-wise, things were made easier with x86-64/amd64
[12:10:44] <Mutabah> GDT entries were replaced with MSRs
[12:10:52] <eddyb> my only excuse is that I *just* woke up :D
[12:11:01] <Mutabah> and the lovely "swapgs" instruction was introduced
[12:11:25] <eddyb> #[thread_local] is only supported on some architectures
[12:11:39] <eddyb> and OSes
[12:11:57] <Mutabah> Until now, I had just implemented the ELF TLS ABI in the kernel
[12:12:02] *** Joins: arielb1 (Mibbit@moz-cmi.jfj.114.192.IP)
[12:12:10] <eddyb> though I'm not sure how to disable it for a certain triple, in LLVM
[12:12:35] <Mutabah> Eh.. I should calm down. I've been snapping at people this arvo
[12:12:53] <eddyb> Mutabah: you and me both :P
[12:17:09] *** Joins: Sho (sho@moz-aig7ns.cust.telecolumbus.net)
[12:18:02] *** Joins: zmike (discomfitor@moz-oek0ra.ct.comcast.net)
[12:20:00] <arielb1> did dst coercions make it to 1.1?
[12:20:51] <arielb1> [they did]
[12:22:06] *** Quits: zmike (discomfitor@moz-oek0ra.ct.comcast.net) (Ping timeout: 121 seconds)
[12:22:36] *** chmanchester is now known as chmanchester|afk
[12:23:42] <eddyb> arielb1: did the fix for Rc<RefCell<T>> and friends get in?
[12:25:24] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Quit: Leaving.)
[12:26:10] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[12:26:42] <arielb1> eddyb: not sure
[12:26:49] <arielb1> rfc401 didn't
[12:26:56] <arielb1> which makes using casts annoying
[12:27:06] <arielb1> I mean, impossible
[12:28:32] <arielb1> nobody uses beta so nobody noticed it was broken
[12:30:29] <arielb1> eddyb: which PR was that?
[12:30:50] <eddyb> arielb1: https://github.com/rust-lang/rust/pull/26038
[12:31:06] <arielb1> it didn't
[12:31:14] <eddyb> https://github.com/rust-lang/rust/commit/01dee1b77e3f594256fc380c348f7ba8fcff41db
[12:31:21] <eddyb> you can tell by the branches, right?
[12:31:39] <eddyb> maybe it should be backported?
[12:31:40] <arielb1> eddyb: too new
[12:32:09] <eddyb> it's a tiny patch and the feature is less interesting^W usable without it
[12:33:10] <arielb1> dst coercions landed just before 1.1 split
[12:34:11] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[12:34:24] *** Joins: zmike (discomfitor@moz-ohv.n2c.222.209.IP)
[12:39:19] *** Joins: mib_2b2aqv (Mibbit@moz-hu6.nja.252.72.IP)
[12:39:50] *** Quits: Feyn (aram@moz-88k.k93.115.42.IP) (Quit: Leaving)
[12:41:03] *** Quits: Florob (Florob@moz-je09t8.de) (Quit: leaving)
[12:41:13] *** Joins: Florob (Florob@moz-je09t8.de)
[12:41:38] *** Quits: mib_2b2aqv (Mibbit@moz-hu6.nja.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[12:42:31] <pnkfelix> Manishearth: you there?  Want to give me guidance how to write jquery one liner you were talking about for automated typing of `/wd` in the input form for irccloud ?
[12:42:50] <pnkfelix> (I guess I can move this to #rust-offtopic )
[12:43:20] <Manishearth> pnkfelix: ?
[12:43:22] *** Joins: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au)
[12:43:33] <pnkfelix> Manishearth: (i moved to #rust-offtopic )
[12:44:21] *** Quits: Florob (Florob@moz-je09t8.de) (Quit: leaving)
[12:44:32] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[12:46:29] *** Joins: Florob (Florob@moz-je09t8.de)
[12:47:45] *** Quits: Kingsquee (kingsley@moz-3fm07c.bchsia.telus.net) (Quit: Konversation terminated!)
[12:48:03] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[12:48:03] *** ChanServ sets mode: +ao erickt erickt
[12:50:00] *** Joins: larhat1 (Adium@moz-ef7.nt5.89.195.IP)
[12:52:41] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[13:07:52] <bluss> acrichto: can I update the metabug gh17307? Its checklist needs updating
[13:07:52] <[o__o]> Implement associated items: https://github.com/rust-lang/rust/issues/17307
[13:08:26] <arielb1> bluss: what's the matter on gh26352?
[13:08:26] <[o__o]> ICE: translating unsupported cast: `alloc::rc::Rc<[i32]>` in beta: https://github.com/rust-lang/rust/issues/26352
[13:09:29] <bluss> arielb1: it only ice's on beta, so I thought Rc-dst almost but not quite made it into 1.1
[13:09:36] <bluss> arielb1: isn't it supposed to work in 1.1?
[13:09:44] <arielb1> bluss: it made it into 1.1 without bugfixes
[13:10:40] <arielb1> that specific ICE was fixed by my cast reform (which is a relatively big patch)
[13:10:53] <bluss> this is a good reason why Rc-DST should have been feature gated
[13:11:09] <arielb1> bluss: it should have been delayed
[13:11:33] <bluss> it's a QA kind of bug for beta I guess
[13:11:47] <eddyb> bluss: there's no easy way to gate it
[13:11:50] <arielb1> bluss: we don't do QA on beta
[13:11:55] <arielb1> only on nightly
[13:12:09] <bluss> do we have QA for releases though? :)
[13:12:17] <eddyb> bluss: unless you can trigger stability checks in the CoerceUnsized impl of Rc when Rc<T> is coerced to Rc<Trait>
[13:12:18] <bluss> I mean that's what matters most in the end
[13:12:33] <arielb1> we don't really have QA
[13:13:07] <arielb1> that ICE was probably missed because it was fixed basically a week later
[13:13:42] <arielb1> so when people started playing with DST coercions it was already gone
[13:14:27] *** Joins: bdero (bran@moz-91hi89.mit.edu)
[13:14:29] *** Quits: bdero (bran@moz-91hi89.mit.edu) (Connection closed)
[13:15:15] <arielb1> and I don't think anybody really uses beta
[13:15:20] <arielb1> not 1.1, at least
[13:15:48] <arielb1> bluss: nrc basically came back from vacation and dropped DST coercions
[13:16:01] <arielb1> and then 1.1 happened
[13:16:02] <bluss> yeah. We should encourage everyone to have their travis builds test beta as well
[13:16:28] <bluss> arielb1: it's nothing personal, we just need to handle landing features better
[13:16:57] <arielb1> I really want to land my WF fixes for 1.2
[13:16:58] <bluss> I mean I saw nrc asking on the 1.1. relnotes: is rc-dst in this release or not? That shows how good feature tracking we do
[13:17:03] <bluss> :)
[13:17:25] <arielb1> bluss: we get so many bug reports on broken WF
[13:17:34] <arielb1> and its a breaking-change for broken code
[13:17:58] <bluss> arielb1: wf is well-formed? What does that mean?
[13:18:05] <bluss> I'm not really good at the compiler stuff
[13:18:14] <arielb1> bluss: currently you can use [[u8]] as a type in some situations
[13:18:19] <arielb1> and get ICE-s
[13:18:21] *** chmanchester|afk is now known as chmanchester
[13:18:25] <arielb1> or [Trait]
[13:18:36] <bluss> ah. That's slightly different
[13:18:42] <arielb1> bluss: same issue
[13:18:56] <bluss> same issue as the Rc cast ICE?
[13:19:02] <arielb1> no different one
[13:19:10] <arielb1> the Rc cast was caused by the terribleness of our cast code
[13:19:36] <bluss> and that Rc-DST is ungated. So instead of compilation error, 1.1 will regress to ICE
[13:19:44] <arielb1> bluss: no
[13:19:46] <arielb1> not really
[13:19:52] <arielb1> rusti: (1u32,2u32) as (u32,u32)
[13:19:53] -playbot- error: internal compiler error: translating unsupported cast: (u32, u32) (cast_other) -> (u32, u32) (cast_other)
[13:19:54] -playbot- note: the compiler unexpectedly panicked. this is a bug.
[13:19:54] -playbot- output truncated; full output at: http://bit.ly/1LfnEla
[13:20:17] <arielb1> that's 1.0
[13:20:32] <bluss> playbot: use std::rc::Rc; Rc::new([1,2]) as Rc<[i32]>
[13:20:33] -playbot- <anon>:9:44: 9:53 error: the trait `core::marker::Sized` is not implemented for the type `[i32]` [E0277]
[13:20:33] -playbot- <anon>:9         use std::rc::Rc; Rc::new([1,2]) as Rc<[i32]>
[13:20:33] -playbot- output truncated; full output at: http://bit.ly/1CdxBY1
[13:20:36] <bluss> ok
[13:20:42] <bluss> so it's a special case for rc
[13:20:49] <arielb1> its not a special case
[13:20:52] <bluss> compilation error in 1.0
[13:20:55] <arielb1> just your code doesn't typeck
[13:21:07] <arielb1> bluss: you can do that for every new feature + trans ICE
[13:21:09] <bluss> well there you see, it's a compilation error in 1.0 and ICE in beta
[13:21:11] <arielb1> or borrowck ICE
[13:21:28] <arielb1> you can have code that reaches the post-type-checking ICE but uses the new feature
[13:21:39] <arielb1> it won't type-check - so no ICE - on the old version
[13:21:47] <bluss> yes I understand
[13:22:37] <bluss> arielb1: did you see my petgraph code that you broke? :)
[13:22:42] *** Quits: larhat1 (Adium@moz-ef7.nt5.89.195.IP) (Quit: Leaving.)
[13:22:43] <arielb1> petgraph?
[13:22:45] <bluss> how broken did you think my code was
[13:22:53] <arielb1> code?
[13:23:04] <bluss> I commented on one of your PRs. I'll link you
[13:23:24] <arielb1> I don't recall making a real breaking change
[13:23:50] <bluss> arielb1: well I know now that my code was relying on broken things
[13:23:53] <bluss> arielb1: https://github.com/rust-lang/rust/pull/26275#issuecomment-112604564
[13:24:09] <arielb1> ah that one
[13:24:34] <arielb1> just-a-bug
[13:24:54] <bluss> I was hoping you were going to say my code was ridiculously broken
[13:24:59] <arielb1> bluss: no
[13:25:06] <arielb1> you just need to add G as a type parameter
[13:25:18] <arielb1> or trait parameter or whatever
[13:25:29] <bluss> ah I fixed it in a different way, it's not going to be locked to G
[13:25:46] <bluss> arielb1: since you fixed that, I think that this bug is now invalid https://github.com/rust-lang/rust/issues/22841
[13:25:59] *** Joins: bdero (bran@moz-91hi89.mit.edu)
[13:26:27] <arielb1> bluss: I guess
[13:26:42] <arielb1> that's why it's supposed to be illegal
[13:27:24] <bluss> yes there were add-on bugs
[13:27:41] <arielb1> add-on bugs?
[13:28:30] <bluss> Dfs::<X>::new() was supposed to be ok (it used impl<G>, so just one type param), but it wasn't
[13:29:00] <arielb1> bluss: no
[13:29:13] <bluss> i.e the impl block was defined for one type parameter but in code it expected two. So the inconsistency was visible
[13:29:24] <bluss> I'm not saying the code was correct
[13:30:07] <arielb1> bluss: I don't think Dfs::<X> does anything
[13:31:16] <bluss> not sure what you mean.  Foo::<X, Y, Z>::m() is used to fill in the type parameters of the impl block where method m is defined
[13:31:38] <arielb1> bluss: you are not supposed to be able to fill impl substs directly
[13:31:52] <bluss> ask eddyb, this is how it works
[13:32:43] <bluss> arielb1: compare how many type parametere HashMap::<K, V, S>::foo() requires depending on which method you call. Depending on impl block it will require either two or three
[13:32:58] <eddyb> bluss: that hasn't been the case for ages
[13:33:18] <eddyb> associated item syntax ripped it out
[13:33:20] <bluss> eddyb: so how does it work now
[13:33:37] <eddyb> Foo::<X, Y>::foo is sugar for <Foo<X, Y>>::foo
[13:35:09] *** Quits: mgottschlag (quassel@moz-ksbkca.qiv1.bbcb.1398.2a00.IP) (Ping timeout: 121 seconds)
[13:35:57] <bluss> cool, so it has changed
[13:35:59] <bluss> sounds saner now
[13:36:27] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[13:36:52] <arielb1> bluss: your code should have eventually given you a "coherence failed to report ambiguity"
[13:37:11] <arielb1> or maybe not
[13:37:22] <arielb1> it's just an inherent impl - they shouldn't cause that
[13:37:39] <bluss> the Dfs code that broke -- that has been working fine
[13:37:55] <bluss> but it's fixed to not use broken things now, works the same
[13:38:11] <arielb1> excellent
[13:38:33] <bluss> I think I did a lot of insane things with associated types apparently
[13:38:45] <bluss> not sure how common this is in other projects
[13:38:55] <bluss> hasn't been a regression report since your bugfix
[13:38:58] <arielb1> bluss: you will probably have to annotate some things when fix-wf lands
[13:40:14] *** Quits: arielb1 (Mibbit@moz-cmi.jfj.114.192.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[13:43:53] *** Joins: goyox86_ (textual@moz-9ct.il3.161.192.IP)
[13:45:05] *** Quits: goyox86 (textual@moz-qfs.570.70.83.IP) (Ping timeout: 121 seconds)
[13:47:50] * aatch facepalms
[13:48:05] <bluss> is the fix-wf thing posted as a PR yet?
[13:48:55] <aatch> The expect intrinsic isn't used properly for the overflow checks...
[13:51:27] *** Quits: _Vi (vi@moz-bbs.vhj.131.104.IP) (Ping timeout: 121 seconds)
[13:54:16] <aatch> Also, for some reason we were doing redundant comparisons against the flag in the overflow check
[13:54:39] <aatch> We were literally generating the LLVM-IR equivalent of `if foo == true { ... }`
[14:01:01] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[14:09:34] *** Quits: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP) (Connection closed)
[14:09:35] <kimundi> heh
[14:09:56] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[14:12:44] *** Quits: oli_obk__ (Mibbit@moz-7bq.0sb.52.141.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[14:13:07] *** chmanchester is now known as chmanchester|afk
[14:14:12] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[14:15:22] *** Joins: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP)
[14:15:24] *** Quits: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP) (Connection closed)
[14:15:25] *** Joins: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP)
[14:18:42] *** Joins: jgallagher (john@moz-d5e8oc.hfc.comcastbusiness.net)
[14:18:50] *** Quits: jgallagher (john@moz-d5e8oc.hfc.comcastbusiness.net) (Client exited)
[14:29:18] *** Joins: _Vi (vi@moz-bbs.vhj.131.104.IP)
[14:36:48] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[14:36:48] *** ChanServ sets mode: +ao erickt erickt
[14:41:28] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[14:44:31] <kimundi> Hm, how do I create a &'tcx Region that corresponds to 'static?
[14:46:06] *** Quits: det (chris@moz-6q2one.lv.cox.net) (Quit: Leaving)
[14:46:09] *** Joins: det (chris@moz-6q2one.lv.cox.net)
[14:47:33] *** Parts: Nashenas88 (Nashenas88@moz-of81j9.miamfl.sbcglobal.net) ()
[14:49:10] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[14:54:37] *** Quits: vmx (vmx@moz-mpc5rn.pools.vodafone-ip.de) (Quit: Leaving)
[14:54:56] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[14:54:56] *** ChanServ sets mode: +ao erickt erickt
[15:00:15] *** Quits: jmesmon (ydoc@moz-naocu2.einic.org) (Quit: WeeChat 1.1.1)
[15:02:19] *** Quits: ptalbot (ptalbot@moz-1gn7gb.eu0n.jcdj.0660.2001.IP) (Ping timeout: 121 seconds)
[15:02:58] *** Joins: Nashenas88 (Nashenas88@moz-of81j9.miamfl.sbcglobal.net)
[15:04:39] *** Joins: jmesmon (ydoc@moz-naocu2.einic.org)
[15:04:53] *** Quits: ytain (ytain@moz-mgfsur.dsl.teksavvy.com) (Quit: Textual IRC Client: www.textualapp.com)
[15:06:02] *** Quits: jmesmon (ydoc@moz-naocu2.einic.org) (Quit: WeeChat 1.1.1)
[15:06:06] *** Joins: jmesmon (ydoc@moz-naocu2.einic.org)
[15:08:48] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[15:10:06] *** Quits: mjboa (mike@moz-gfdglf.hsi06.unitymediagroup.de) (Ping timeout: 121 seconds)
[15:16:00] <nmatsakis> kimundi: tcx.mk_region(ty::ReStatic)
[15:16:11] <kimundi> nmatsakis: Thanks :)
[15:18:18] <kimundi> nmatsakis: While you're here - Me and eddyb where talking about dynamic code loading yesterday, and one prerequisite for it would be the ability to have fn()+'a bounds on function pointers. Seeing how you also consider this as a potential solution for parts of the soundness fixes, I was wondering if you think it would get accepted on its own if someone implemented it.
[15:19:44] <nmatsakis> kimundi: I've got a partially written RFC in this direction, as well as an implementation
[15:20:15] <kimundi> Oh! Could you give me an link, I'm curious :)
[15:20:17] <nmatsakis> kimundi: I am in the process now of cleaning up and rebasing, and I hope to have things ready soonish
[15:20:22] <kimundi> nice
[15:20:41] <nmatsakis> well, the RFC I can point you at is kind of old and I'll prob rewrite from scratch, but let me fish up the link
[15:20:46] <nmatsakis> or are you more interested in the impl?
[15:21:34] *** Joins: yjv (yjv@moz-j0cdis.fios.verizon.net)
[15:22:02] <kimundi> nmatsakis: Both really. :)
[15:23:00] *** Joins: goyox86 (textual@moz-qfs.570.70.83.IP)
[15:23:46] <kimundi> nmatsakis: I guess I'm more interested in the impl though, unless it has a majorly different semantic than I expected.
[15:24:08] *** Quits: goyox86_ (textual@moz-9ct.il3.161.192.IP) (Ping timeout: 121 seconds)
[15:25:40] <nmatsakis> kimundi: ok well gimme a bit, I'm not sure what's on what branch, I was hoping to sort that out today, but I think the semantics will be roughly what you expect, yes
[15:26:39] <kimundi> nmatsakis: Ah, I can wait, no need to bother if it distracts you right now :)
[15:26:43] *** Quits: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP) (Quit: ChatZilla 0.9.91.1 [Firefox 38.0.5/20150525141253])
[15:27:03] *** Joins: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP)
[15:27:13] <nmatsakis> kimundi: ok, well, i'll ping you soonish :) I really do want to get this sorted out so I can start opening up the RFCs etc
[15:27:23] <kimundi> okay, thanks :)
[15:28:45] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Connection closed)
[15:37:29] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[15:41:30] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[15:43:27] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[15:45:31] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Connection closed)
[15:45:49] *** Joins: dcb (dcb@moz-j72nfe.ca.comcast.net)
[15:46:24] *** chmanchester|afk is now known as chmanchester
[15:48:13] *** Joins: globin (globin@moz-isrgf8.de)
[15:50:05] *** Quits: laumann (thomas@moz-3m6.3kq.109.2.IP) (Ping timeout: 121 seconds)
[15:50:55] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[15:51:01] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[15:51:43] <nmatsakis> argh. I really have to start devoting some time to fixing P-high bugs >:(
[15:54:20] *** Quits: dcb (dcb@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[15:57:42] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[15:58:17] *** Joins: summerlight_ (summerlight@moz-99k.2mj.130.121.IP)
[15:58:45] *** Joins: dcb (dcb@moz-j72nfe.ca.comcast.net)
[15:59:01] *** Quits: dcb (dcb@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[16:00:29] *** Quits: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP) (Connection closed)
[16:00:42] *** Joins: pauls (pauls@moz-e5p333.ccs.neu.edu)
[16:01:11] *** Quits: summerlight (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[16:02:04] <bstrie> holy crap, 9 days to 1.1
[16:02:12] *** Joins: mjboa (mike@moz-gfdglf.hsi06.unitymediagroup.de)
[16:02:13] *** bstrie changes topic to '9 days to 1.1.0 | https://botbot.me/mozilla/rust-internals | https://buildbot.rust-lang.org/homu/queue/rust'
[16:06:45] *** Joins: O01eg (o01eg@moz-fe1qqi.m45p.3egh.2698.2a02.IP)
[16:06:47] *** Joins: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net)
[16:07:19] *** Quits: mjboa (mike@moz-gfdglf.hsi06.unitymediagroup.de) (Ping timeout: 121 seconds)
[16:07:26] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[16:07:36] *** Joins: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP)
[16:07:39] *** Quits: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP) (Connection closed)
[16:07:40] *** Joins: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP)
[16:09:21] *** Joins: mjboa (mike@moz-3kngu7.vpn.rwth-aachen.de)
[16:10:03] *** Joins: bdero1 (bran@moz-nd2f6b.dyn.mit.edu)
[16:11:00] *** Quits: bdero1 (bran@moz-nd2f6b.dyn.mit.edu) (Quit: Leaving.)
[16:11:01] *** Joins: bdero1 (bran@moz-91hi89.mit.edu)
[16:11:19] *** Quits: goyox86 (textual@moz-qfs.570.70.83.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[16:11:54] *** Quits: bdero (bran@moz-91hi89.mit.edu) (Connection closed)
[16:14:09] *** Joins: arielb1 (Ariel@moz-1uf694.red.bezeqint.net)
[16:21:43] <eddyb> nmatsakis: that's really really cool :D
[16:22:05] *** Quits: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP) (Connection closed)
[16:22:54] <eddyb> nmatsakis: as for https://github.com/rust-lang/rust/issues/25776#issuecomment-112856773 - well, I've solved it since, but I forget how
[16:22:56] <eddyb> ah, right
[16:23:29] <eddyb> nmatsakis: what I wanted that for can be replaced with https://github.com/rust-lang/rfcs/issues/1138
[16:25:01] <eddyb> so I'll be waiting until the box protocol and/or allocators show up
[16:25:55] *** Quits: Nashenas88 (Nashenas88@moz-of81j9.miamfl.sbcglobal.net) (Client exited)
[16:32:02] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[16:38:24] *** Joins: Nashenas88 (Nashenas88@moz-of81j9.miamfl.sbcglobal.net)
[16:38:28] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[16:38:45] *** Joins: goyox86 (textual@moz-qfs.570.70.83.IP)
[16:39:55] *** Joins: dinfuehr (dinfuehr@moz-75ts8r.highway.telekom.at)
[16:39:55] *** Quits: dinfuehr (dinfuehr@moz-75ts8r.highway.telekom.at) (Connection closed)
[16:39:56] *** Joins: dinfuehr (dinfuehr@moz-75ts8r.highway.telekom.at)
[16:47:03] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[16:51:50] *** Quits: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP) (Ping timeout: 121 seconds)
[16:53:08] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[16:53:09] *** ChanServ sets mode: +o brson
[16:53:52] <simukis> acrichto: I’m feeling like https://github.com/rust-lang/rust/pull/26347 might need nomination?
[16:54:08] <simukis> (though it should land first)
[16:55:07] <acrichto> simukis: sure
[16:55:16] <simukis> also https://github.com/rust-lang/rust/pull/26315 into rollup?
[16:57:11] *** Quits: mjboa (mike@moz-3kngu7.vpn.rwth-aachen.de) (Ping timeout: 121 seconds)
[16:57:32] <acrichto> eh it'll probably get rolled up anyway
[16:59:13] *** Joins: mjboa (mike@moz-gfdglf.hsi06.unitymediagroup.de)
[17:03:52] <eddyb> acrichto: https://github.com/rust-lang/rust/issues/26352#issuecomment-112794083 should #26038 be nominated?
[17:04:15] <eddyb> acrichto: and, well, the fix to casts, though arielb1 is saying that one is pretty large
[17:04:31] <acrichto> eddyb: I personally think no, but I can nominate if you like
[17:04:32] *** Quits: dinfuehr (dinfuehr@moz-75ts8r.highway.telekom.at) (Connection closed)
[17:05:25] <eddyb> it might be more work to disable Rc<Unsized> and friends in 1.1 than to make it work better, but I'm not sure
[17:07:30] <SimonSapin> eddyb: what’s wrong with it?
[17:07:40] <eddyb> SimonSapin: it's broken
[17:07:49] <simukis> SimonSapin: gh26352 contains all the details :)
[17:07:49] <[o__o]> ICE: translating unsupported cast: `alloc::rc::Rc<[i32]>` in beta: https://github.com/rust-lang/rust/issues/26352
[17:09:10] <eddyb> SimonSapin: the PR making Rc<Unsized> possible got into 1.1 but a PR fixing cast checking (AFAIK, that's arielb1's) didn't make it
[17:09:57] <eddyb> SimonSapin: and then there was gh26038, a tiny fix to make RefCell/Mutex/RwLock work with unsized types, too
[17:09:57] <[o__o]> Allow nested generics for the last field of structs in unsizing.: https://github.com/rust-lang/rust/pull/26038
[17:10:14] <SimonSapin> I see, thanks
[17:12:58] *** Joins: apoelstra (username@moz-pvbasl.net)
[17:14:31] *** Joins: ytain (ytain@moz-p96068.dsl.teksavvy.com)
[17:21:46] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[17:22:52] <eddyb> SimonSapin: MoveCell is cool :D
[17:22:55] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[17:23:38] <eddyb> also, it's apparently my cakeday
[17:24:20] <eddyb> SimonSapin: our old Cell used to be a bit like MoveCell<Option<T>>
[17:24:30] <eddyb> though it was broken in a way or another
[17:24:33] <simukis> Happy cakeday. What kind of cake is your cake?
[17:25:01] <eddyb> simukis: I have no idea how to reddit :P https://www.reddit.com/user/eddyb
[17:25:15] <SimonSapin> eddyb: the cool part is your idea :)
[17:25:21] <eddyb> presumably 4 years since I joined reddit?
[17:25:32] *** Quits: goyox86 (textual@moz-qfs.570.70.83.IP) (Ping timeout: 121 seconds)
[17:27:32] <kimundi> eddyb: yeah
[17:31:15] *** Joins: Jesin (Jesin@moz-4jre1i.eecs.lehigh.edu)
[17:33:15] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[17:38:38] <carllerche> is anybody else frequently getting spammed on the IRC server?
[17:39:12] <eddyb> carllerche: /umode +Rc
[17:39:23] <eddyb> haven't had any PMs since I did that
[17:39:32] <carllerche> such IRC skills
[17:39:37] <carllerche> what does that do
[17:40:05] <eddyb> I don't remember exactly, but each of them prevents PMs from certain users
[17:40:08] <carllerche> eddyb: i'm getting "unknown command umode" :(
[17:40:15] <eddyb> I think R prevents PMs from unregistered users
[17:40:21] <cmr> /mode carllerche +Rc
[17:40:22] <eddyb> and c from those that you don't share a channel with
[17:40:24] <cmr> try that
[17:40:32] <kimundi> R for only registered, c for only from users in same channel as you
[17:40:34] <eddyb> oh, /umode might be an alias in my client
[17:40:46] <eddyb> s/might be/has to be/
[17:40:48] <carllerche> cmr: thx, that did something :)
[17:41:44] <cmr> The caffeine, it is good.
[17:42:40] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[17:43:45] <cmr> bstrie: I really like the characterization of Rust as a "community of human beings", rather than Rustaceans.
[17:43:50] <cmr> It just... feels better.
[17:43:56] *** Joins: mukilan_ (mukilan@moz-jds.3t8.164.122.IP)
[17:44:20] <cmr> Affirming each other's humanity constantly seems like it can only bring benefits.
[17:44:42] *** Quits: mukilan (mukilan@moz-0he.e0v.164.122.IP) (Ping timeout: 121 seconds)
[17:45:43] <edunham> it's a good reminder to treat one another humanely rather than being crabby, i agree.
[17:45:50] <cmr> heh
[17:46:34] <cmr> It seems like some on the internet find it easy to forget that they're talking to other complex humans with their own emotions and aspiratoins.
[17:46:50] *** Quits: nrc (sid365@moz-3taf2s.0j4i.jtu0.0101.2620.IP) (A TLS packet with unexpected length was received.)
[17:46:51] *** Quits: ato (sid11@moz-c1oek8.0j4i.jtu0.0101.2620.IP) (Connection closed)
[17:46:51] *** Quits: chmanchester (sid313@moz-6igabj.0j4i.jtu0.0101.2620.IP) (Connection closed)
[17:46:51] *** Quits: pnkfelix (sid344@moz-nnnecs.0j4i.jtu0.0101.2620.IP) (Connection closed)
[17:46:51] *** Quits: larsberg (sid89@moz-1a60qu.0j4i.jtu0.0101.2620.IP) (Connection closed)
[17:46:51] *** Quits: aturon (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP) (Connection closed)
[17:46:51] *** Quits: nmatsakis (sid381@moz-32a8b5.0j4i.jtu0.0101.2620.IP) (Connection closed)
[17:49:51] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[17:50:06] *** Joins: ato (sid11@moz-c1oek8.0j4i.jtu0.0101.2620.IP)
[17:50:19] *** Joins: cdidd (cdidd@moz-5p9bfm.broadband.corbina.ru)
[17:52:52] *** Quits: geofft (geofft@moz-vfphq1.mit.edu) (Ping timeout: 121 seconds)
[17:52:57] *** Joins: larsberg (sid89@moz-1a60qu.0j4i.jtu0.0101.2620.IP)
[17:55:56] *** Joins: vky (vky@moz-fqci96.ca.comcast.net)
[17:57:00] <carllerche> are there any plans / RFCs for trait aliasing? (pub type Foo = MyTrait<Bar> or something)
[17:57:46] <kimundi> carllerche: Neither, though I'd like that too
[17:57:50] <cmr> carllerche: not to my knowledge, however I believe that sort of uniformity would be granted by HKT if/when they are implemented.
[17:58:03] <huon> carllerche: in a way that works as a trait? (i.e. such that `fn foo<T: Foo>` is valid?)
[17:58:05] <carllerche> always seems to come back to HKT :p
[17:58:09] <kimundi> cmr: DOn't see the relation to HKT tbh
[17:58:14] <huon> because it should work as types due to DST?
[17:58:24] <carllerche> I am a little tired of typing : Sync + Send + 'static :P
[17:59:01] <cmr> kimundi: You can't say `pub type Foo = MyTrait`, for example.
[17:59:11] <cmr> kimundi: if MyTrait has kind other than *
[17:59:17] <cmr> (using haskell notation)
[17:59:18] <kimundi> cmr: Sure, but that was not the question :P
[17:59:33] <kimundi> cmr: YOu can have HKT without making that work, and otherway round
[18:00:10] *** Joins: chc4 (chc4@moz-pdo0at.ma.comcast.net)
[18:00:14] <cmr> I dunno, seems like it'd just be a hack without it.
[18:00:32] <kimundi> cmr: Not more so than type aliases are
[18:00:52] *** Joins: chmanchester (sid313@moz-6igabj.0j4i.jtu0.0101.2620.IP)
[18:01:04] <WindowsBunny> carllerche: You can have a trait inherit from Sync + Send + 'static and impl it for all T where that is true
[18:01:21] <carllerche> WindowsBunny: that doesn't work well (last I checked) w/ Fn* types
[18:01:23] *** Joins: aturon (Adium@moz-aes83o.rgd2.9kg1.0101.2620.IP)
[18:01:23] *** ChanServ sets mode: +o aturon
[18:01:41] <kimundi> type IntoX = Into<X>; can work without HKT, and so can type X<Y> = Trait<Y>;
[18:01:58] *** Joins: pnkfelix (sid344@moz-nnnecs.0j4i.jtu0.0101.2620.IP)
[18:01:58] *** ChanServ sets mode: +ao pnkfelix pnkfelix
[18:02:08] <WindowsBunny> carllerche: Oh well :D
[18:02:10] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[18:02:10] <cmr> You're right
[18:02:10] *** ChanServ sets mode: +o pcwalton
[18:02:29] *** Joins: nrc (sid365@moz-3taf2s.0j4i.jtu0.0101.2620.IP)
[18:02:29] *** ChanServ sets mode: +o nrc
[18:02:56] *** Quits: chc4 (chc4@moz-pdo0at.ma.comcast.net) (Connection closed)
[18:03:01] *** Joins: nmatsakis (sid381@moz-32a8b5.0j4i.jtu0.0101.2620.IP)
[18:03:06] *** Quits: aturon (Adium@moz-aes83o.rgd2.9kg1.0101.2620.IP) (Quit: Leaving.)
[18:03:17] *** Joins: aturon_ (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP)
[18:03:17] *** Quits: aturon_ (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP) (Quit: )
[18:03:31] <kimundi> Also, to be fully pedantic you can have very limited psydo HKT with "use NewName = Trait" today ;)
[18:03:36] *** Joins: aturon_ (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP)
[18:03:38] *** aturon_ is now known as aturon
[18:03:47] *** Joins: chc4 (chc4@moz-pdo0at.ma.comcast.net)
[18:03:49] *** ChanServ sets mode: +o aturon
[18:04:48] <cmr> Type aliases aren't allowed in trait position.
[18:04:59] <cmr> So I guess very limited indeed :P
[18:05:41] <cmr> And that's not allowed either, if Trait takes type arguments.
[18:05:46] <aturon> cmr: i missed the prior conversation, but i really want trait aliases
[18:05:52] * aturon should write an RFC...
[18:05:57] <cmr> aturon: me too! carllerche was just requesting it.
[18:06:09] <aturon> I'll put it on the TODO
[18:06:32] <kimundi> playbot: use X = Into;
[18:06:33] -playbot- <anon>:9:15: 9:16 error: expected one of `;` or `as`, found `=`
[18:06:33] -playbot- <anon>:9         use X = Into;
[18:06:33] -playbot- output truncated; full output at: http://bit.ly/1GZlQMc
[18:06:46] <kimundi> playbot: use Into as X;
[18:06:47] -playbot- <anon>:9:13: 9:22 error: unresolved import `Into`. There is no `Into` in `???`
[18:06:47] -playbot- <anon>:9         use Into as X;
[18:06:47] -playbot- output truncated; full output at: http://bit.ly/1MLN3QV
[18:07:07] <aturon> eddyb: that reminds me, i've been meaning to mention a couple things --
[18:07:09] <carllerche> aturon: splitting up Send & 'static made not having trait aliases extra painful (for me at least) :P
[18:07:25] <cmr> kimundi: Oh I read that wrong initially, sorry.
[18:07:31] <aturon> eddyb: first, that i'd love to work with you on writing up a revised RFC for "impl Trait" (or whatever syntax)
[18:07:46] <kimundi> cmr: I also forgot the current use syntax, so I don't blame you :)
[18:07:54] <aturon> eddyb: second, that i've put together a proposal for "efficient inheritance" that, I think, gets at what you and kimundi were angling for :)
[18:08:02] <kimundi> oh my!
[18:08:06] <cmr> kimundi: np. I keep writing "int" when I write Rust code without thinking about it too much...
[18:08:18] <kimundi> cmr: heh, me to ;)
[18:08:20] <cmr> I'm so rusty on my actually-writing-rust :(
[18:08:27] <aturon> eddyb: it's in the form of two RFCs -- one for specialization, and another building on it for use cases like the DOM
[18:08:37] <aturon> (but almost entirely just using the trait mechanism)
[18:08:59] <aturon> eddyb: anyway, have to go to lunch with folks here right now, but i'd like to discuss soon (cc kimundi)
[18:09:02] <eddyb> aturon: it doesn't touch the different vtable placement and thin pointers and whatnot, does it?
[18:09:30] <aturon> eddyb: i have a story for that which is somewhat different from your proposal, but i think you'll like it
[18:09:38] <aturon> anyway, more later :)
[18:09:46] <kimundi> tease ;D
[18:09:47] <eddyb> because that part by itself is pretty crazy and the developments in the last few months produced enough variation for me to not have any current preferences
[18:10:07] <eddyb> aturon: I believe the Fat proposal (which I didn't initially like) is easier to implement now with Unsize
[18:10:34] <eddyb> but I'll wait to hear more :D
[18:14:58] *** Joins: dinfuehr (dinfuehr@moz-75ts8r.highway.telekom.at)
[18:15:25] <SimonSapin> We have higher kinded lifetimes something something for <'a>, right? How does it work?
[18:16:12] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[18:16:15] <eddyb> SimonSapin: in a few places, you can write for<'a> Trait
[18:16:38] <eddyb> SimonSapin: e.g. Box<Fn(&T)> is sugar for Box<for<'a> Fn(&'a T)>
[18:16:58] <eddyb> SimonSapin: also, `where for<'a> Foo<'a, T>: Trait<'a, T>` is valid
[18:17:23] <eddyb> not equivalent, but similar, `where Bar<T>: for<'a> Trait<'a, T>`
[18:18:00] <eddyb> SimonSapin: with the exception of some normalization we don't perform atm, you can write associated types generics on a lifetime by moving the lifetime to the trait
[18:18:07] <eddyb> and using for<'a> Trait<'a> instead of Trait
[18:18:16] <eddyb> s/generics/generic
[18:19:00] *** Quits: dinfuehr (dinfuehr@moz-75ts8r.highway.telekom.at) (Ping timeout: 121 seconds)
[18:21:27] *** Quits: _Vi (vi@moz-bbs.vhj.131.104.IP) (Ping timeout: 121 seconds)
[18:21:31] <SimonSapin> eddyb: simplified, I have this: https://gist.github.com/anonymous/7337986a8647bdcf1fe0
[18:21:52] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[18:22:03] <eddyb> SimonSapin: make Node generic over 'a
[18:22:51] <SimonSapin> eddyb: then all nodes have the same 'a, which doesn’t borrow-check
[18:22:59] <eddyb> SimonSapin: that's not true
[18:23:03] <eddyb> well...
[18:23:11] <SimonSapin> well, my example is incomplete
[18:23:43] <eddyb> SimonSapin: http://is.gd/DL6hhp
[18:24:38] *** Quits: vky (vky@moz-fqci96.ca.comcast.net) (Ping timeout: 121 seconds)
[18:24:58] <SimonSapin> Full code is https://github.com/servo/rust-selectors/blob/cbc25f1b210cb4569d425262dab814636c1f5c84/src/tree.rs and https://github.com/SimonSapin/kuchiki/blob/master/src/select.rs
[18:25:40] <eddyb> oh boy
[18:25:56] <eddyb> SimonSapin: where's the container where you get the lifetime mismatch issue?
[18:25:58] <SimonSapin> In kuchiki, nodes are reference counted. When walking the tree with, says, repeated parent_node(), I want each &ElementData to be tied to the lifetime of the corresponding node, not its parent
[18:25:59] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[18:26:27] <eddyb> "then all nodes have the same 'a, which doesn’t borrow-check"
[18:26:34] <eddyb> that part, where does that happen?
[18:26:45] <SimonSapin> hang on, https://github.com/SimonSapin/kuchiki/blob/2c0a1c481c2a59dde6ea52a6e18afa58229ed444/src/select.rs is the WIP branch
[18:27:18] <bstrie> cmr: hm, interesting. I do kind of like it
[18:27:24] *** Joins: goyox86 (textual@moz-rvv.00r.255.109.IP)
[18:27:38] <SimonSapin> eddyb: In https://github.com/servo/rust-selectors/blob/1ea31d2b4ffc9ff1aa7cddfc538fe841770d2b5d/src/matching.rs , 'a is the same for all TNode<'a>
[18:27:51] <eddyb> can you link to a file?
[18:27:54] <eddyb> err, a line
[18:27:55] <bstrie> what else is there, along with println! and divide-by-zero, in the class of things that will panic implicitly?
[18:28:03] <cmr> bstrie: overflow
[18:28:11] <SimonSapin> https://github.com/servo/rust-selectors/blob/1ea31d2b4ffc9ff1aa7cddfc538fe841770d2b5d/src/matching.rs#L307
[18:28:12] *** Joins: nham (nham@moz-lglsfe.il.comcast.net)
[18:28:15] <bstrie> ah yes
[18:28:28] <cmr> also stack overflow doesn't panic but it will abort your program
[18:28:29] <eddyb> SimonSapin: N: for<'a> TNode<'a>
[18:28:33] <SimonSapin> that’s fine in Servo because Nodes and Elements are JSRefs that effectively have all the same lifetime
[18:28:40] <eddyb> that's your issue
[18:29:59] <cmr> brson: I think I want to assemble a script that will collate subteam reports each week and post it to TWiR
[18:30:57] <cmr> Alternatively write some sort of web thing that can act as subteam dashboards and export to the format they are using.
[18:31:36] <cmr> nmatsakis aturon acrichto: does that sound useful? It seems like you are doing most of the subteam report heavy lifting
[18:31:54] <SimonSapin> eddyb: Looks like this works! Thanks
[18:31:58] <eddyb> SimonSapin: :D
[18:32:39] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[18:33:56] *** Joins: frewsxcv (sid86219@moz-dneii9.brockwell.irccloud.com)
[18:37:36] <SimonSapin> Alright! Now I need something like std::cell::Ref::map but for Rc
[18:37:54] <eddyb> ref-counted inner reference?
[18:38:01] <eddyb> that's... that's...
[18:38:05] <eddyb> SimonSapin: that's cool :D
[18:38:31] <SimonSapin> a reference to some component inside of a Rc
[18:38:50] <SimonSapin> that reference needs to keep the value alive, so it holds a strong reference
[18:39:11] *** Quits: clatour (clatour@moz-7m73an.hlrn.qwest.net) (Quit: Textual IRC Client: www.textualapp.com)
[18:39:43] <SimonSapin> but it refers to a value inside an enum variant
[18:39:57] <SimonSapin> after we’ve checked that the enum has indeed that variant
[18:41:47] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[18:42:22] <SimonSapin> so… I want (Rc<T>, &'a U) where 'a is the lifetime of the Rc
[18:43:00] <eddyb> you'll have to use a raw pointer, but everything else should be straight-forward
[18:43:06] <SimonSapin> I can get that &'a U through Rc::deref, but then I want to move them together
[18:44:49] <eddyb> here's a thought... trait AnyType {} impl<T> AnyType for T {} struct InnerRc(Rc<AnyType>, *const U);
[18:45:36] <SimonSapin> so, making a Rc trait object?
[18:46:00] <eddyb> that is going to be bigger though
[18:46:10] <brson> cmr: sounds good! aturon already has such a script you can probably adapt
[18:46:24] <cmr> aturon: please share!
[18:46:57] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[18:49:07] <SimonSapin> eddyb: How do I get &U form *const U, transmute?
[18:49:19] <eddyb> SimonSapin: never transmute when dealing with thin pointers/references
[18:49:24] <kimundi> SimonSapin: unsafe { &*foo }
[18:49:38] <SimonSapin> ok
[18:49:41] <eddyb> I wonder if the book has any advice like that. Gankro will have to provide it :P
[18:54:13] <SimonSapin> eddyb: http://is.gd/MJalRx
[18:54:23] <bluss> it seems to still be the case that firefox never fetches rustdoc parts from the cache
[18:54:28] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[18:55:02] <eddyb> SimonSapin: LGTM
[18:55:13] <SimonSapin> cool
[18:57:13] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[18:57:13] *** ChanServ sets mode: +o pcwalton
[18:58:22] <Gankro> eddyb: it... Never occured to me to explain something that basic... Can go in conversions
[18:58:51] <Gankro> I basically have a blanket rule of don't transmute any kind of pointer
[18:59:34] <eddyb> Gankro: well, fat pointers are harder to work with
[19:00:25] <Gankro> eddyb: ?
[19:00:56] <eddyb> you can't extract the extra information of a fat pointer with- wait
[19:01:02] <eddyb> no, transmute doesn't even work there
[19:01:06] <eddyb> Gankro: nevermind :P
[19:01:51] *** Quits: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net) (Client exited)
[19:03:15] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[19:04:52] <Gankro> eddyb: That's what Repr or whatever is for, right?
[19:05:02] <eddyb> Repr is kind of useless
[19:05:09] <eddyb> maybe it's okay for [T] where T: Sized
[19:05:14] <eddyb> but nothing more
[19:05:49] <Gankro> Good thing [T] where T: Sized is the only kind of [T]! :P
[19:08:36] *** Quits: mukilan_ (mukilan@moz-jds.3t8.164.122.IP) (A TLS packet with unexpected length was received.)
[19:08:41] <eddyb> Gankro: now that's just the tunnel vision speaking
[19:09:16] <eddyb> Gankro: expand your horizons from [_] to [[_]]
[19:09:27] <eddyb> now *this* is a tunnel: [[[[_]]]]
[19:09:45] <eddyb> (also a 4D matrix)
[19:09:46] *** Joins: jshs (jshs@moz-3erj31.dip0.t-ipconnect.de)
[19:12:11] *** Joins: dcb (dcb@moz-j72nfe.ca.comcast.net)
[19:13:14] *** Quits: summerlight_ (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[19:13:44] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[19:15:40] * Gankro is too sleepy
[19:18:40] *** Joins: dcb_ (textual@moz-j72nfe.ca.comcast.net)
[19:18:49] *** Quits: dcb_ (textual@moz-j72nfe.ca.comcast.net) (Connection closed)
[19:22:07] *** Joins: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP)
[19:23:28] *** Quits: globin (globin@moz-isrgf8.de) (Connection closed)
[19:26:00] *** Joins: _Vi (vi@moz-bbs.vhj.131.104.IP)
[19:29:00] *** Joins: eibwen (eibwen@moz-a7fpsd.dip0.t-ipconnect.de)
[19:31:57] *** Quits: dcb (dcb@moz-j72nfe.ca.comcast.net) (Quit: Textual IRC Client: www.textualapp.com)
[19:32:09] *** Quits: untitaker (untitaker@moz-gfukss.highway.telekom.at) (Ping timeout: 121 seconds)
[19:33:43] *** Joins: dcb (dcb@moz-j72nfe.ca.comcast.net)
[19:34:10] *** Joins: untitaker (untitaker@moz-mc32k8.highway.telekom.at)
[19:41:25] <SimonSapin> FilterMap<Descendants, fn(NodeRef)-> Option<RcRef<Node, RefCell<String>>>>
[19:41:30] <SimonSapin> I wonder if I’m doing it wrong
[19:41:46] <eddyb> SimonSapin: what's the error?
[19:41:51] <SimonSapin> no error
[19:41:54] <SimonSapin> it’s just ugly
[19:42:16] <eddyb> SimonSapin: you need impl Iterator<RcRef<Node, RefCell<String>>> in your life :P
[19:42:19] <SimonSapin> eddyb: oh, and btw, yay, it all works!
[19:42:32] <eddyb> Iterator<Item= even
[19:42:48] <SimonSapin> yeah
[19:43:06] <SimonSapin> I can probably have a newtype for RcRef<Node, _>
[19:43:22] <eddyb> NodeSubRef?
[19:43:34] <SimonSapin> or I could hard-code it in kuchiki rather than use https://crates.io/crates/rcref
[19:43:49] <eddyb> did you just publish that?
[19:43:52] <eddyb> lol
[19:43:53] <SimonSapin> yes
[19:44:04] <SimonSapin> second new crate publish today
[19:44:19] <eddyb> one crate per type seems to be a trend
[19:44:24] <eddyb> and... I don't think I hate it
[19:44:44] <SimonSapin> if it becomes painful, improve Cargo so that it’s not
[19:44:44] <eddyb> there's probably some ergonomic optimization to be done for single-module crates
[19:45:03] <SimonSapin> for the crate author or user?
[19:45:25] <eddyb> SimonSapin: http://cdn.meme.am/instances/400x/55082047.jpg
[19:45:44] <SimonSapin> I mean, are you thinking of something specific?
[19:46:20] <eddyb> all the files in a regular Cargo project give me enterprise nostalgia, such crates only need a mod.rs
[19:46:42] <eddyb> oh, I think Quxxy had a thing where you specified Cargo directives at the beginning of a file
[19:47:16] <eddyb> presumably extern crate "crates.io/crates/foo" as foo; or something similar could also work
[19:47:48] <SimonSapin> interesting
[19:47:52] <eddyb> SimonSapin: on the user side, maybe specifying multiple crates on the same line
[19:48:15] <eddyb> see the feature attribute, where you can just stick 10 of them on one line and avoid the noise
[19:48:38] <eddyb> would be nice to have, both in Rust code and in Cargo.toml
[19:49:21] <SimonSapin> is !Sync something we tell LLVM?
[19:49:36] <eddyb> SimonSapin: and then you'd keep a misc-crates repo with 20 Rust files, each a module
[19:49:43] <cmr> SimonSapin: not to my knowledge.
[19:49:46] <eddyb> almost 0 friction
[19:49:57] <SimonSapin> eddyb: +1
[19:50:08] <SimonSapin> also auto docs: https://github.com/rust-lang/crates.io/issues/91
[19:50:19] <eddyb> yes please
[19:50:41] <eddyb> SimonSapin: LLVM has no type-level notion of thread safety
[19:50:51] <eddyb> and soon, LLVM will have almost no types at all
[19:51:01] <kimundi> well, it just looses ptr types
[19:51:11] <eddyb> yeah, but that disconnects a lot of the hierarchy
[19:51:15] <kimundi> sure
[19:51:45] <eddyb> and we could start using unnamed types if nobody's looking at the IR
[19:52:02] <eddyb> unnamed structs I mean
[19:52:07] <SimonSapin> context: https://www.reddit.com/r/rust/comments/3a6bv7/movecell_take_two/cs9wv55
[19:52:37] <eddyb> SimonSapin: &UnsafeCell is not treated as immutable btw, and we might tell LLVM that
[19:52:53] <eddyb> immutable in the read-only memory sense
[19:53:48] <SimonSapin> so is there any chance that the two swaps in MoveCell::peek are optimized away?
[19:54:00] <eddyb> you'll just have to look at the IR
[19:54:12] <eddyb> if you put movecell in a playpen I could try and get that for you
[19:54:47] <SimonSapin> https://play.rust-lang.org/?gist=ee3cf3c5a4fe51f828bf&version=stable
[19:55:06] <eddyb> SimonSapin: http://is.gd/ryLHVc proof that &UnsafeCell is treated differently
[19:55:37] <eddyb> &T (where T doesn't contain UnsafeCell) gets readonly. &mut T gets noalias. &Cell there gets neither
[19:56:15] <SimonSapin> #[lang = "unsafe_cell"]
[19:56:20] <SimonSapin> is that the magic?
[19:56:23] <eddyb> yupp
[19:56:55] <eddyb> also causes statics to be put in .data instead of .rodata (or the binary format's equivalents)
[19:57:01] <SimonSapin> cool
[19:58:57] <eddyb> SimonSapin: https://play.rust-lang.org/?gist=63b7fbad9f5d0a1f1cf1&version=stable
[19:59:31] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[19:59:48] <eddyb> SimonSapin: I'm seeing a few dead stores, maybe?
[20:00:10] <SimonSapin> eddyb: are the things in bold instructions?
[20:00:24] <SimonSapin> uhm, not just instructions
[20:00:37] <eddyb> more like keywords. the first thing on the line (after %x =, if that's present) is the instruction
[20:00:51] <eddyb> !foo is metadata
[20:01:00] <SimonSapin> things like alloca, store, load, call
[20:01:18] <eddyb> yupp
[20:01:18] *** Quits: bdero1 (bran@moz-91hi89.mit.edu) (Ping timeout: 121 seconds)
[20:01:25] <eddyb> the stores are definitely dead
[20:01:36] <SimonSapin> looks like peek() is not inlined
[20:01:37] <eddyb> well, redundant, sorry
[20:01:40] <SimonSapin> let’s try release mode
[20:01:54] <eddyb> SimonSapin: it is in release mode. oh, wait, the link doesn't capture that
[20:01:58] <eddyb> %2 = load i8** %1, align 8, !alias.scope !0, !noalias !5
[20:02:02] <SimonSapin> oh, that looks different
[20:02:03] <eddyb> store i8* %2, i8** %1, align 8, !noalias !14
[20:02:12] <eddyb> that's storing the same thing it loaded to the same location
[20:02:21] <eddyb>   %1 = getelementptr inbounds %"MoveCell<core::option::Option<collections::string::String>>"* %0, i64 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0
[20:02:23] <eddyb> holy shit
[20:02:36] <SimonSapin> I… know some of these words!
[20:02:39] <eddyb> doener: so I mentioned newtype optimizations to aatch. this is what that was for
[20:03:16] <eddyb> SimonSapin: that's taking a reference to x[0].0.0.0.0.0.0.0
[20:03:28] <eddyb> where the indexing is C pointer arithmethic and you can ignore it
[20:03:33] <eddyb> but the rest are structural fields
[20:03:42] *** Quits: semarie (semarie@moz-9n2v7s.bpv6.bg1u.41d0.2001.IP) (Ping timeout: 121 seconds)
[20:04:24] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[20:04:29] <eddyb> SimonSapin: oh and I forgot to mention in that reddit thread that Option<Vec<T>> and Option<String> don't have the overhead of a tag
[20:05:07] <eddyb> SimonSapin: but this example still looks like local alias analysis failure on LLVM's part
[20:05:39] <eddyb> %0, %1 and %5 point to the same location in memory
[20:06:11] <SimonSapin> eddyb: is it because LLVM doesn’t know that MoveCell: !Sync  ?
[20:06:13] <eddyb> store i64 0, i64* %5, align 8; is actually dead because store i8* %2, i8** %1, align 8, !noalias !14; writes over it
[20:06:22] <eddyb> and the latter is redundant because it writes the same thing it loaded
[20:06:28] <eddyb> SimonSapin: entirely unrelated
[20:06:35] <SimonSapin> uh, ok
[20:06:42] <eddyb> SimonSapin: I was going to mention, it's UB to be Sync without using synchronization
[20:06:51] <eddyb> LLVM wouldn't optimize out loads and stores if you were using atomics
[20:06:58] <arielb1> eddyb: its not UB to be Sync
[20:07:00] <eddyb> but you're not
[20:07:02] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[20:07:02] <arielb1> only to do data races
[20:07:11] <arielb1> being Sync improperly is unsafe, not UB
[20:07:20] <eddyb> arielb1: right, I was thinking of a specific case, sorry
[20:07:44] <arielb1> Rust's manual calls UB "unsafety" for some reason tho
[20:07:59] <eddyb> SimonSapin: I think that LLVM not having typed pointers would help, as the %2 load and the first two stores would use the same pointer
[20:08:06] <WindowsBunny> arielb1: UB is not unsafety
[20:08:12] <WindowsBunny> arielb1: UB is laundry eating
[20:08:18] <arielb1> WindowsBunny: UB implies unsafety
[20:08:39] <eddyb> and unsafety implies the possibility of UB in safe code
[20:08:46] <WindowsBunny> Ub can only be caused by unsafe code that fails to uphold certain guarantees
[20:08:57] <eddyb> or triggering UB from safe code, I mean
[20:08:59] <arielb1> WindowsBunny: or by bugs in rustc
[20:09:02] <bstrie> Gankro: ping
[20:09:03] <arielb1> or by C code
[20:09:12] <Gankro> bstrie: pong
[20:09:14] <eddyb> LLVM codegen screwups etc
[20:09:17] <WindowsBunny> arielb1: Well, C code is unsafe code, and rustc relies on lots of unsafe code
[20:09:26] <eddyb> WindowsBunny: it does what?
[20:09:39] <eddyb> WindowsBunny: I think arielb1 meant in analysis or codegen, not unsafe code in librustc
[20:10:09] <eddyb> the source of unsafety in librustc_trans is the unclean LLVM bindings
[20:10:13] <bstrie> Gankro: all this webassembly stuff has reminded me that the pnacl people have been trying to figure out all the UB in llvm for years, maybe they have better llvm docs than llvm does
[20:10:16] * WindowsBunny shifts the blame to eddyb and vanishes
[20:10:21] <eddyb> the other libs are pretty clean
[20:10:54] <eddyb> bstrie: UB in PNaCl should be harmless
[20:10:55] <Gankro> bstrie: ...maybe?
[20:11:03] <eddyb> because it's being ran in a sandbox
[20:11:20] <bstrie> my point is just that if llvm docs are awful, maybe we can look to them for better docs
[20:11:42] <eddyb> the only (P)NaCl docs I've found were explaining the limitations in the LLVM dialect they use
[20:11:55] <cmr> One problem is that LLVM isn't a formal language, there's only "what the LLVM codebase currently does (and we can change it at any time)"
[20:12:04] <cmr> pnacl is much more pinned down, and they need to be stricter
[20:12:30] <sunfish> what parts of LLVM are in question here?
[20:12:38] <eddyb> I think PNaCl and mainline LLVM will be closer once typed pointers are out. at least I remember somtehing about i8* being the only pointer type used for certain operations, in PNaCl
[20:12:55] * eddyb gives bstrie to sunfish
[20:12:57] *** Joins: Viewtiful (Viewtiful@moz-54q.gak.250.78.IP)
[20:13:19] *** Joins: genbattle (genbattle@moz-4v0.gkd.16.182.IP)
[20:13:21] *** Joins: rovar (rovar@moz-6iq.47m.88.38.IP)
[20:13:55] * bstrie gives Gankro to sunfish
[20:13:57] <cmr> sunfish: I don't think anyone is questioning anything concrete, just general griping about how hard it can be to understand precise behavior sometimes.
[20:14:03] <eddyb> SimonSapin: fwiw, something smaller optimizes fine https://play.rust-lang.org/?gist=89e1fcd80cea99b48db1&version=stable
[20:14:15] <arielb1> nmatsakis: ping
[20:14:40] <eddyb> SimonSapin: nightly is more interesting :D
[20:14:41] <sunfish> cmr: i do agree that it does help to maintain a mental mapping to C, and have an understanding of where C's UB is
[20:14:56] <eddyb> SimonSapin: but the main difference is the increase in verbosity
[20:15:19] <eddyb> SimonSapin: the Option<String> case is not optimized well, not even in nightly
[20:15:36] <Gankro> My gripes are recursively "Rust punts 50% of its behaviour to 'what llvm does today'"
[20:15:39] <arielb1> sunfish: C and LLVM should have the same UB pretty much
[20:16:00] <sunfish> arielb1: they often do, though there are several places where LLVM is intentionally more permissive
[20:16:06] <eddyb> SimonSapin: this optimizes well though https://play.rust-lang.org/?gist=cd93c87624c1342971ab&version=stable
[20:16:31] <eddyb> SimonSapin: and it seems to me like that's a more plausible usecase
[20:17:00] *** Quits: mmun (mmun@moz-iar.moo.170.107.IP) (Ping timeout: 121 seconds)
[20:17:40] <sunfish> stronger UB makes code easier to analyze, but harder to transform
[20:17:55] <sunfish> LLVM's optimizer does both, so it needs to make compromises with itself :)
[20:18:36] <arielb1> we do need to have an aliasing rules story through
[20:25:32] *** Joins: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net)
[20:28:28] *** Joins: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net)
[20:33:27] <genbattle> wat. suddenly I need to be a registeres user to speak in #rust, but I can speak in here and #rust-gamedev with impunity? madness!
[20:33:44] <cmr> genbattle: due to spam.
[20:34:53] <genbattle> I still don't get why that spammer was/is spamming the #rust channel specifically...
[20:36:18] <Gankro> hm... what's more horribly terribad... transmute or transmute_copy...
[20:36:32] <cmr> transmute_copy for sure.
[20:37:51] *** Quits: phynx (chatzilla@moz-ioi514.dsl.scarlet.be) (Ping timeout: 121 seconds)
[20:41:44] <Gankro> Oh wow yeah. Way more references to "unchecked" and "undefined"
[20:41:48] *** Joins: rkruppe_ (chatzilla@moz-3nj.rnu.131.95.IP)
[20:43:02] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (NickServ (RECOVER command used by rkruppe_))
[20:43:02] *** rkruppe_ is now known as rkruppe
[20:46:02] *** Quits: Viewtiful (Viewtiful@moz-54q.gak.250.78.IP) (Ping timeout: 121 seconds)
[20:47:54] *** Quits: chc4 (chc4@moz-pdo0at.ma.comcast.net) (Ping timeout: 121 seconds)
[20:55:22] *** Joins: erickt (erickt@moz-a8o0f1.ca.megapath.net)
[20:55:22] *** ChanServ sets mode: +ao erickt erickt
[20:56:41] <brson> a crater comparison of stable to beta revealed no regressions
[20:57:00] <brson> pretty suspicious
[20:57:09] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[20:57:39] <eternaleye> genbattle: Probably used /list, and went for the channels with the most people
[20:58:01] <eternaleye> genbattle: After all, trollspam and adspam both care most about *how many people see*
[20:59:09] <bluss> brson: when did you run it?
[21:00:01] *** Quits: erickt (erickt@moz-a8o0f1.ca.megapath.net) (Ping timeout: 121 seconds)
[21:03:42] <genbattle> eternaleye, I guess I overestimated the sophistication of the spammer
[21:05:00] <SimonSapin> eddyb: my use case is more like https://play.rust-lang.org/?gist=7def1621d0f31b4b639a&version=stable
[21:06:45] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[21:06:45] *** ChanServ sets mode: +ao erickt erickt
[21:07:32] *** Joins: bdero (bran@moz-lbs.91h.47.73.IP)
[21:09:43] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[21:13:49] <eddyb> SimonSapin: that's horrible
[21:13:53] <eddyb> SimonSapin: the resulting IR, I mean
[21:15:42] <eddyb> SimonSapin: I doubt it will look any better until pnkfelix's stack drop flags PR is merged
[21:16:08] <SimonSapin> I’m fine staying blissfully ignorant about all this :)
[21:16:10] <eddyb> pnkfelix: actually, is there any chance you have a build of that laying around, that you could use to get the IR for SimonSapin's example above?
[21:16:29] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[21:16:43] <eddyb> I'm curious if LLVM optimizes the rest better if the drop check goes away
[21:17:09] *** Joins: chc4 (chc4@moz-pdo0at.ma.comcast.net)
[21:18:14] <SimonSapin> I’ve decided that Kuchiki is not as performance-critical as Servo, and that the ergonomic win of Rc over an arena is worth some perf hit because of reference count traffic
[21:18:36] <eddyb> hmm
[21:18:58] <eddyb> playbot: let _: extern fn(...) = ();
[21:18:58] -playbot- <anon>:9:25: 9:26 error: variadic function must be declared with at least one named argument
[21:18:59] -playbot- <anon>:9         let _: extern fn(...) = ();
[21:18:59] -playbot- output truncated; full output at: http://bit.ly/1GPJTvj
[21:19:28] <nmatsakis> arielb1: sorry, was in a mtg, about to step out the door
[21:19:30] <eddyb> well, that explains why the printing code cannot create fn(...), only fn(, ...)
[21:20:32] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[21:20:42] <arielb1> what should be done with consider_unification_despite_ambiguity in my gh26147?
[21:20:43] <[o__o]> A few fixes for associated types: https://github.com/rust-lang/rust/pull/26147
[21:20:57] <arielb1> comment and be done with it?
[21:23:45] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[21:27:20] <jroesch> arielb1: Niko is probably gone now, we were just setting a meeting and he was running to catch a dinner
[21:28:45] <arielb1> jroesch: what were you afraid of when dropping normalization obligations?
[21:29:48] <jroesch> I just had a flashback of it causing problems in a place I dropped them, but the follow-up point you made sounds correct
[21:29:59] <jroesch> there are places where we should be fine to drop additional obligations 
[21:31:30] *** Joins: dinfuehr (dinfuehr@moz-tupkbg.highway.telekom.at)
[21:31:31] <jroesch> I'm currently trying to refactor the code around inference ctxt and parameter environments so we can clean up normalization 
[21:31:51] <jroesch> Hopefully we can make this all less ad-hoc soon
[21:31:51] <arielb1> nice to hear there are more people working on the typesystem
[21:32:17] <jroesch> the normalization that is
[21:32:32] <arielb1> jroesch: I think that would require a research paper
[21:33:10] <eddyb> rebasing my PR is going to be fun with typesystem restructuring going on :P
[21:33:32] <arielb1> PR?
[21:33:40] <jroesch> eddyb: I think who ever submits a PR last is going to be in for the most pain (which maybe me ;))
[21:33:47] <eddyb> https://github.com/rust-lang/rust/pull/26351
[21:34:06] <arielb1> eddyb: its not *that* immediate
[21:34:14] <arielb1> just get your PR for 1.2
[21:34:44] *** Quits: jshs (jshs@moz-3erj31.dip0.t-ipconnect.de) (Client exited)
[21:35:33] <jroesch> arielb1: I just submitted a paper with a lab mate of mine on fuzzing Rust and in the process we found lots of inconsistencies (no soundness related) in the type system that I would like to rectify, also having the constraint solver for clauses act more like a constraint solver would be good
[21:35:47] <arielb1> clauses?
[21:35:53] <jroesch> where clauses/predicates
[21:35:58] <arielb1> fuzzing Rust?
[21:36:04] <arielb1> semantically, you mean?
[21:36:38] <jroesch> yeah, we have techniques for generating well-typed programs based on some constraints, you can view it as program synthesis is you are so inclined but we don't phrase it that way
[21:36:54] <arielb1> found anything interesting?
[21:37:43] <jroesch> we ended up fixing a version of the compiler so many of the things we found had been fixed in the time frame we were doing the work but there are probably ~20 oddities 
[21:37:59] <arielb1> 20?
[21:38:05] <jroesch> I mostly helped with the tooling, I would have to double check the final results with my co-author 
[21:38:24] <arielb1> had been fixed?
[21:38:31] <jroesch> a lot around error reporting and type checking inconsistencies
[21:38:40] *** Joins: brain_ (brain@moz-ake53i.rcsntx.sbcglobal.net)
[21:38:47] <jroesch> we talked to Niko about most of them
[21:38:59] *** brain_ is now known as bvinc
[21:39:03] <jroesch> some are known, others are not necessarily problems, and some will probably end up fixed
[21:39:18] <arielb1> no issues?
[21:39:25] <jroesch> I would have to go pull them up
[21:39:34] <jroesch> been a couple of months
[21:39:52] <arielb1> jroesch: that would be when associated types were still very broken
[21:42:36] <jroesch> Here is one I remember that we ran into during the process: https://github.com/rust-lang/rust/issues/24011
[21:43:03] <arielb1> I am working on that bug
[21:43:51] <jroesch> we also found a some strange behavior when dealing with nested references + implied bounds that appears related to one of the soundness issues opened by Aaron
[21:44:32] <jroesch> ah this one: https://github.com/rust-lang/rust/issues/25860
[21:45:30] <arielb1> nice
[21:45:59] <jroesch> arielb1: yeah and we did most of the work in the spring, we eventually had to pick a version of the compiler and evaluate it for publishing reasons. I'm switching schools as well so I was in a rush to wrap up all my work
[21:46:01] <pcwalton> aturon: acrichto: what should I import to get RustcDecoder and friends? (I'm on nightly)
[21:46:59] <arielb1> "the spring"
[21:47:40] <arielb1> (for me spring ends Jun 20)
[21:47:41] <eddyb> 3 months is a couple releases, no?
[21:48:06] <eddyb> at least with the 6 week plan
[21:48:10] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[21:48:11] <jroesch> the University of California schools are on quarters so the Spring in my head is (April - June)
[21:48:22] <jroesch> We submitted mid-may
[21:48:56] <eddyb> that would be pretty much the 1.0 release
[21:51:27] <jroesch> yeah we fixed on one of the alpha releases since we needed some predictability and it takes weeks to actually do all the work, esp. when you are teaching, and working on multiple research projects
[21:51:55] <arielb1> you would be amazed how many bugs were fixed even in the 1.1/1.2 timeframe
[21:52:04] <jroesch> I've been following
[21:52:16] <jroesch> its insane how quickly things change
[21:52:35] <arielb1> 1.1/1.2 seem to be more quality releases
[21:54:09] <jroesch> arielb1: Niko and I are attempting to unify InferCtxt + ParamEnv + FulfillmentCtxt (eventually) do you have any feelings on how to refactor methods that take an inference ctxt and a &ClosureTyper (for ex.) in many places the &ClosureType is a parameter environment which is now inside the InferCtxt
[21:54:29] *** Quits: dinfuehr (dinfuehr@moz-tupkbg.highway.telekom.at) (Connection closed)
[21:54:34] <jroesch> we've talked about a couple different approaches but neither of us are sure what the best course of action is
[21:55:02] <arielb1> isn't the closure typer the FnCtxt often?
[21:55:58] *** Joins: dinfuehr (dinfuehr@moz-tupkbg.highway.telekom.at)
[21:56:36] <jroesch> yeah, there would be cascading changes
[21:57:10] <arielb1> I don't want to make all of librustc generic
[21:57:11] <jroesch> one of the things Niko was suggesting was peforming another refactor we have been talking about and splitting the fn tables up, but he wasn't sure if that would be suffcient 
[21:57:41] <arielb1> so I would probably make Typer a reference to a trait object
[21:59:43] <jroesch> there was some talk of the typer interface being unecessary but I have to talk to Niko longer we didn't have enough time to hash it out in detail 
[22:00:00] *** Quits: dinfuehr (dinfuehr@moz-tupkbg.highway.telekom.at) (Ping timeout: 121 seconds)
[22:00:40] <eddyb> jroesch: what part of it, looking up a NodeMap<Ty>?
[22:01:10] <eddyb> I think that can be done without a trait if we split tcx, but that's a lot of work
[22:01:56] <eddyb> (global w/o inference types + local w/ inference types, and they're cascaded)
[22:02:23] <jroesch> yeah I think that was Niko's idea was to split global tables and push more the state into a local type environment, we are gonna meet to talk about it tomorrow. Just trying to make some useful progress this afternoon
[22:04:53] <eddyb> jroesch: I wanted to do that last autumn and it went sideways. I would've had to make Repr independent of the type context, and that's just crazy
[22:05:25] <eddyb> but it is possible and there's a PR open for it :P
[22:05:53] <jroesch> jroesch: yeah I have a memory of that ... the idea of going down that path isn't super appealing at least during the first path
[22:05:55] <jroesch> pass*
[22:06:18] <jroesch> eddyb: ^ tagging myself like an idiot again ;)
[22:07:35] <eddyb> jroesch: before it gets lost again: struct TyCx<'a, 'tcx> { global: &'a GlobalTyCx<'tcx>, local: &'a LocalTyCx<'tcx> }
[22:08:01] <eddyb> that is going to make a lot of code messy *unless* all the functions that take tcx directly are turned into methods
[22:08:12] *** Joins: petereo (petereo@moz-al0s2v.ip93.fastwebnet.it)
[22:08:24] <eddyb> so the second step after removing Repr and UserString, would be to methodize middle::ty
[22:08:44] *** Quits: eibwen (eibwen@moz-a7fpsd.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[22:08:52] <eddyb> and maybe a couple other modules
[22:09:20] <eddyb> context types can take extra lifetimes easily. actually, everything has &'a ty::ctxt<'tcx> so the replacement would be straightforward
[22:10:59] <eddyb> jroesch: GlobalTyCx would embed a LocalTyCx and the global TyCx would have its local field alias the LocalTyCx in the GlobalTyCx referenced by its global field
[22:11:25] <eddyb> it took me ages to come up with this and then it was too hard to do anything with it
[22:11:52] *** Joins: rkruppe_ (chatzilla@moz-3nj.rnu.131.95.IP)
[22:12:24] <jroesch> Thanks noted, I just stashed this conversation so I can come back to it if I need to go down this path
[22:12:28] <eddyb> at the time it wasn't possible to have inherent impls outside the type's module of definition. since then, UFCS solved the issue
[22:13:00] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[22:13:06] *** rkruppe_ is now known as rkruppe
[22:13:15] <eddyb> jroesch: np. if you have any interesting results from your discussions with nmatsakis, feel free to share
[22:14:18] *** Quits: mjboa (mike@moz-gfdglf.hsi06.unitymediagroup.de) (Quit: leaving)
[22:14:26] <jroesch> yeah I think this is going to be my first chunk of work for the summer. I believe the eventual goal is to do lazy normalization and incremental constraint solving (for clarity + performance)
[22:14:28] <eddyb> as in, I'd be thankful if I'm kept in the loop, even if I don't know how much I can contribute for the next month. I dread my exams enough, though
[22:14:40] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Quit: ChatZilla 0.9.91.1 [Firefox 38.0.5/20150525141253])
[22:14:42] <jroesch> yeah I was just ther
[22:15:04] <jroesch> I got sick last year and it screwed up my last 6 months royally, the past couple weeks have been a nightmare
[22:15:15] <eddyb> and I'm hyped about removing (almost) all allocations from type printing
[22:15:39] <jroesch> yeah I'll keep you in the loop, we usually generate some notes in a etherpad session 
[22:15:46] <jroesch> I'll send anything useful your way
[22:16:03] <eddyb> which makes me wonder if rustc debug! output is going to be faster. used to be terrible
[22:16:09] <eddyb> jroesch: appreciate it :D
[22:16:10] *** Joins: larhat1 (Adium@moz-vlo5br.cable.virginm.net)
[22:16:41] <jroesch> I'm sure we will make some progress during the work week as well 
[22:18:58] <reem> struct X { } not working is a real pain for macros
[22:19:05] <cmr> yeah.
[22:19:56] <eddyb> that RFC wasn't accepted?
[22:19:59] <reem> I have no idea how to work around this
[22:20:16] <eddyb> I do special-casing, but it doesn't always work
[22:20:29] <reem> this is extremely frustrating…
[22:20:31] <eddyb> especially if you have a lot of logic that would be duplicated
[22:20:35] <cmr> reem: _ihatethis: () field :P
[22:20:35] <reem> precisely
[22:20:42] <cmr> (if you can)
[22:20:59] <reem> maybe.. it makes the user interface uglier but I guess it works
[22:21:07] <reem> since all the other fields are pub
[22:21:39] *** Quits: tdfischer (tdfischer@hackerbots.net) (Ping timeout: 121 seconds)
[22:22:46] *** Joins: tdfischer (tdfischer@moz-kik.s6i.21.23.IP)
[22:22:46] *** Quits: tdfischer (tdfischer@moz-kik.s6i.21.23.IP) (Changing host)
[22:22:46] *** Joins: tdfischer (tdfischer@23.21.241.21)
[22:23:41] *** Quits: genbattle (genbattle@moz-4v0.gkd.16.182.IP) (Quit: Leaving)
[22:24:09] <bluss> eddyb: it appears accepted https://github.com/rust-lang/rust/issues/24266
[22:24:52] *** Joins: genbattle (genbattle@moz-4v0.gkd.16.182.IP)
[22:24:59] <bluss> 23 rfc-approved issues open https://github.com/rust-lang/rust/labels/B-RFC-approved
[22:26:50] *** Quits: genbattle (genbattle@moz-4v0.gkd.16.182.IP) (Quit: Leaving)
[22:28:48] *** Quits: jevin (jevin@moz-sra.ovp.12.72.IP) (Connection closed)
[22:29:02] *** Joins: jevin (jevin@moz-sra.ovp.12.72.IP)
[22:35:10] *** Joins: phynx (chatzilla@moz-f5pcee.dsl.scarlet.be)
[22:38:23] *** Quits: petereo (petereo@moz-al0s2v.ip93.fastwebnet.it) (Quit: )
[22:41:02] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[22:45:43] *** Quits: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net) (Connection closed)
[22:45:50] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[22:45:50] *** ChanServ sets mode: +o pcwalton
[22:50:00] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[22:52:41] *** Joins: njn (chatzilla@moz-0ah9lm.iinet.net.au)
[22:53:23] <brson> acrichto nmatsakis nrc: besides the fix to the file! etc macros and the relnotes do you expect any other beta cherry-picks for 1.1?
[22:53:35] * brson starts rebasing relnotes
[22:53:59] <SimonSapin> eddyb: new error message! https://gist.github.com/anonymous/f457d428cfbdacab05ca
[22:54:00] *** Quits: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net) (Client exited)
[22:54:11] <SimonSapin> trying today’s rust-selectors changes in Servo
[22:54:22] <SimonSapin> "cannot extract an associated type from a higher-ranked trait bound in this context"
[22:55:26] <acrichto> brson: none that I know of
[22:55:29] <eddyb> SimonSapin: this is where for<'a> comes in
[22:55:51] <eddyb> SimonSapin: for<'a> <N as TNode<'a>>::Element: TElementAttributes
[22:55:52] <nrc> brson: there is https://github.com/rust-lang/rust/issues/26352 I'm not sure whether to try and backport or not
[22:56:00] <eddyb> for<'a> where clause, I mean
[22:56:08] <acrichto> nrc: that doesn't work on stable, right?
[22:56:25] *** Joins: dinfuehr (dinfuehr@moz-tupkbg.highway.telekom.at)
[22:56:38] *** Quits: Sho (sho@moz-aig7ns.cust.telecolumbus.net) (Quit: Konversation terminated!)
[22:56:45] <acrichto> nrc: as in, I feel like too much machinery needs to be backported to get it to work, but I could be wrong!
[22:56:51] <SimonSapin> wheee, more syntax I haven’t seen before
[22:56:54] <SimonSapin> thanks again eddyb
[22:57:03] <SimonSapin> Is all this documented?
[22:57:04] <nrc> acrichto: that is my feeling too, but I'm also not 100%
[22:57:31] <eddyb> acrichto: arielb1 should know more
[22:57:40] <arielb1> acrichto: it should merge cleanly
[22:57:48] <acrichto> arielb1: is it a pretty small amount of stuff?
[22:57:52] <nrc> acrichto: I believe it is a problem with purely stable code
[22:57:55] <arielb1> its a big patch
[22:58:06] <acrichto> nrc: right but does it work on 1.0?
[22:58:10] <arielb1> but there shouldn't have been rebase conflicts
[22:58:15] <acrichto> I thought this stuff had just always ice'd until recently
[22:58:18] <arielb1> it got in a week after 1.0
[22:58:28] <nrc> acrichto:  oh right, there is no bug on 1.0, aiui
[22:58:30] <arielb1> it just contains a bunch of unrelated bugfixes
[22:58:32] <eddyb> acrichto: ah, you're asking if this is a regression
[22:58:40] <acrichto> ah yeah sorry
[22:58:51] <eddyb> it's not, just a half-baked feature
[22:58:57] *** Quits: goyox86 (textual@moz-rvv.00r.255.109.IP) (Quit: Textual IRC Client: www.textualapp.com)
[22:59:13] <nrc> well, it was a type error in 1.0, an ICE in 1.1, and compiles on 1.2
[22:59:26] <nrc> I'd call that a regression, but perhaps that understanding is not correct
[22:59:27] <acrichto> that seems like not necessarily the end of the world
[22:59:38] <acrichto> we have a lot of ices in 1.0 :P
[22:59:44] <acrichto> as in, it'll happen
[22:59:52] <nrc> yeah, if it was small and self-contained, I would backport, as is, I'm weakly against
[22:59:57] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[23:00:04] <arielb1> it is large and self-contained
[23:00:07] <eddyb> heh
[23:00:27] *** Quits: dinfuehr (dinfuehr@moz-tupkbg.highway.telekom.at) (Ping timeout: 121 seconds)
[23:00:31] *** kimundi is now known as zz_kimundi
[23:00:34] <arielb1> I added a way-too-aggressive test
[23:00:35] *** zz_kimundi is now known as kimundi
[23:00:47] <eddyb> acrichto: hang on, it's possible my RefCell/Mutex/RwLock patch is orthogonal
[23:01:01] <arielb1> and had to fix a bunch of bugs to make it run
[23:01:12] <eddyb> can you coerce Rc<T> to Rc<Trait> in 1.1?
[23:01:21] <arielb1> eddyb: yes
[23:01:22] <arielb1> with a coercion
[23:01:24] <arielb1> not a cast
[23:01:29] <arielb1> a cast ICE-s
[23:01:54] <eddyb> then I suggest backporting https://github.com/rust-lang/rust/pull/26038 at least. it fixes a mistake in the original logic
[23:02:14] <eddyb> and it's technically a regression IIRC, though I'm not sure RefCell<Unsized> ever got into stable
[23:02:54] <eddyb> playbot: let _: &std::cell::RefCell<Send> = &std::cell::RefCell::new(0);
[23:02:55] -playbot- <anon>:9:16: 9:41 error: the trait `core::marker::Sized` is not implemented for the type `core::marker::Send` [E0277]
[23:02:55] -playbot- <anon>:9         let _: &std::cell::RefCell<Send> = &std::cell::RefCell::new(0);
[23:02:55] -playbot- output truncated; full output at: http://bit.ly/1BjRNN8
[23:03:59] <eddyb> acrichto: oh, actually, it is a stable regression because user-defined structures are affected! oops
[23:04:44] <eddyb> acrichto: so backporting https://github.com/rust-lang/rust/pull/26038 is more or less necessary
[23:04:57] *** Joins: Quxxy (chatzilla@moz-efh10q.internode.on.net)
[23:04:57] <acrichto> eddyb: arielb1: it's a little late to start throwing in bugfixes into beta-nominated (beta's coming out in almost less than a week), so these sorts of changes should only be backported if *really* necessary
[23:05:13] <eddyb> let me come up with a testcase
[23:05:35] <arielb1> then I guess don't land my patch
[23:05:46] <arielb1> cast-rfc401 (both of them) are really fickle
[23:05:55] <arielb1> the tests, I mean
[23:07:12] <eddyb> acrichto: stable compiles http://is.gd/BAToXc beta doesn't http://is.gd/pnxDTf nightly does http://is.gd/g3dEUF
[23:07:14] <bstrie> okay so who's working on getting rust working on web assembly
[23:07:27] <eddyb> bstrie: is that the new name for asm.js?
[23:07:43] <cmr> eddyb: no
[23:07:43] <reem> it’s going to be a cross-browser standard
[23:07:45] <eddyb> acrichto: so it's not just a bugfix but a regression fix
[23:07:47] <cmr> it's a new form
[23:07:51] <bstrie> eddyb: https://brendaneich.com/2015/06/from-asm-js-to-webassembly/
[23:07:53] <eddyb> oh really?
[23:08:01] <reem> ya it’s actually quite exciting
[23:08:04] <eddyb> we're getting something serious now, after 20 years of JS?
[23:08:17] <acrichto> eddyb: could you beta-nominate the PR in question? I suspect the compiler team would have more to say about this than I personally, but fixing a regression is pretty confvincing
[23:08:18] <bstrie> eddyb: we need to seize this opportunity to make rust the hippest language on browsers
[23:08:19] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[23:08:30] <eddyb> acrichto: is there a bot command I can use?
[23:08:32] <bstrie> eddyb: it won't support any sort of integrated GC for a while, so this is our opportunity
[23:08:37] <eddyb> cause I'd just do that but I don't know the syntax
[23:08:39] <acrichto> eddyb: "triage: beta-nominated"
[23:08:42] <eddyb> thanks!
[23:08:50] <reem> bstrie: I’m in
[23:09:36] <bstrie> reem: I've yet to figure out how they intend to let C interact with the DOM, figure out how that'll work in rust
[23:10:15] <eddyb> acrichto: has to be the only text in the comment?
[23:10:34] <acrichto> eddyb: I think if it's the first line it's fine, but you can have other stuff int he comment as well
[23:10:35] <acrichto> kinda like bors
[23:10:47] <eddyb> bors is fine with it anywhere in the comment
[23:11:13] *** Quits: arielb1 (Ariel@moz-1uf694.red.bezeqint.net) (Quit: Ex-Chat)
[23:14:28] <eddyb> acrichto: it's not working, I'll just add the label myself (it might be that @rust-highfive is not recognizing me. maybe it uses the same list of active reviewers and I'm temporarily "disabled")
[23:15:00] <acrichto> oh maybe it doesn't parse the whole comment after all...
[23:15:02] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[23:15:10] <acrichto> I swear though this morning I commented `triage: beta-nominated` on something and it worked
[23:15:17] <eddyb> it did, I checked
[23:15:25] <eddyb> the macro thing
[23:16:06] <eddyb> acrichto: oh but those are open
[23:16:11] * eddyb is confused
[23:16:13] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[23:16:24] <acrichto> oh! nrc: ^ (does rust-highfive only listen to open PRs/issues?)
[23:16:35] <brson> rustc's driver checks feature gates 3 times these days
[23:17:03] <acrichto> gotta go fast
[23:19:34] <nrc> acrichto, eddyb: there is a list of authorised triagers, it is separate from the reviewers list. It is the set of people who came to the triage meeting. It could/should probably be expanded to all sub-team members
[23:19:41] <acrichto> ah
[23:20:07] <nrc> aturon (or anyone else): is there a handy list of all memebers of all sub-teams? Ideally with their GH usernames?
[23:20:19] <nrc> I guess I could scrape it from the teams webpage
[23:20:38] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[23:20:47] <eddyb> nrc: there's github teams
[23:20:55] <eddyb> with the right access, you could get it from the API, no?
[23:21:37] *** Joins: aatch (james@moz-i1k1ks.tlms.2o1v.e006.2406.IP)
[23:22:11] <aturon> nrc: hm, i don't think there's a consolidated list anywhere, no
[23:22:23] <aturon> but yes re: eddyb's point
[23:24:55] <nrc> good idea
[23:28:22] *** Joins: dinfuehr (dinfuehr@moz-tupkbg.highway.telekom.at)
[23:29:53] *** Quits: larhat1 (Adium@moz-vlo5br.cable.virginm.net) (Quit: Leaving.)
[23:30:36] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Connection closed)
[23:32:07] <reem> bstrie: I will read about it when I get home later
[23:32:31] <eddyb> bstrie: so is there more of a plan than just "something vaguly based on LLVM IR"?
[23:32:57] <eddyb> unification with SPIR-V would be a bit crazy but probably worth it
[23:33:25] <eddyb> though SPIR itself may be too limited for this, I haven't looked at it in detail
[23:33:49] * aatch goes reads logs
[23:34:04] <eddyb> aatch: oh I have some fun IR for you
[23:34:23] <aatch> eddyb, k
[23:34:35] <eddyb> aatch: look at @test on Release mode https://play.rust-lang.org/?gist=63b7fbad9f5d0a1f1cf1&version=stable
[23:34:44] <eddyb> aatch: that first GEPi :D
[23:35:52] <aatch> eddyb, yeah? It's getting at the pointer in String.
[23:36:00] <eddyb> it's ridiculously long
[23:36:18] <eddyb> also, note the x = load p0; store p1, 0; store p2, x; sequence which is not removed by LLVM even though p0 == p1 == p2
[23:36:21] *** Quits: yjv (yjv@moz-j0cdis.fios.verizon.net) (Connection closed)
[23:39:59] <brson> nrc: do you know what % bootstrap times changed between stable and the current beta?
[23:41:21] <bstrie> eddyb: a plan for web assembly? yes, read https://github.com/WebAssembly/design/
[23:41:29] <eddyb> oh boy
[23:42:07] <acrichto> brson: oh an interesting stat could be the difference in cargo's build time between stable/beta
[23:42:10] <eddyb> "a module is ELF-like" - as long as they don't bring in sections, segments and dynamic linking commands :P
[23:42:46] <eddyb> wait wait wait
[23:42:50] <eddyb> bstrie: this is Java
[23:43:05] <brson> acrichto: do you have that? :-D
[23:43:10] <eddyb> what they're describing is an idealized Java
[23:43:16] <bstrie> eddyb: ding ding ding
[23:43:42] <acrichto> brson: I'll need a new beta to get the beta timing, but I can get a "stable-ish" timing by just going back in cargo's history to the last point it was using a compiler close to 1.0
[23:43:48] <acrichto> e.g. 5/11
[23:44:14] *** Joins: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net)
[23:44:15] <bstrie> hilarious, the proposal to add restricted tailcalls to asm.js references rust's TCE proposal
[23:44:18] <bstrie> http://discourse.specifiction.org/t/request-for-comments-add-a-restricted-subset-of-proper-tail-calls-to-asm-js/787
[23:44:49] <brson> nrc, anybody: does the dst coercion support in 1.1 work completely according to the rfc https://github.com/rust-lang/rfcs/blob/master/text/0982-dst-coercion.md
[23:45:03] <brson> i saw there was some regression in 1.1 regarding putting an unsized type into *something*
[23:45:16] <eddyb> brson: RefCell/Mutex/RwLock
[23:45:24] <eddyb> brson: the problem is that it can happen with an user-defined type
[23:45:25] *** Quits: dinfuehr (dinfuehr@moz-tupkbg.highway.telekom.at) (Connection closed)
[23:45:44] <brson> eddyb: does that mean dst coercions are broken in 1.1 for user-defined types?
[23:45:47] *** Quits: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net) (Connection closed)
[23:45:54] <brson> iow dst coercion works with [T] and trait objects?
[23:45:56] <eddyb> brson: only if the last field has a wrapper
[23:46:09] <eddyb> like content: UnsafeCell<T>
[23:46:11] <eddyb> brson: https://github.com/rust-lang/rust/pull/26038
[23:46:31] <brson> thanks
[23:47:48] <eddyb> bstrie: interesting, it's not SSA-based. it looks more like a CFG. thing is, I bet it's easy to convert between it and SSA
[23:48:05] <eddyb> so the "AST" form might as well be a SSA compression technique
[23:50:37] *** Joins: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net)
[23:51:01] <bstrie> eddyb: https://news.ycombinator.com/item?id=9733762
[23:52:02] *** kimundi is now known as zz_kimundi
[23:52:23] <eddyb> if we had a MIR you could lower it pretty easily to webasm AFAICT
[23:53:56] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[23:54:39] *** Quits: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net) (Ping timeout: 121 seconds)
[23:55:18] <bstrie> eddyb: get cracking, we need to make wasm a first-class platform or we'll miss our window to supplant C++ on the web :P
[23:56:33] *** zz_kimundi is now known as kimundi
[23:56:35] <eddyb> bstrie: are you going to pay me, or should I speak to someone at Microsoft?
[23:58:12] <eddyb> nmatsakis: 0 mentions of push or connect in ppaux.rs
[23:58:43] <eddyb> it will probably double librustc's compile time with the gazillion try!(write!(...))
[23:59:30] *** Joins: yjv (yjv@moz-ll38tk.pa.comcast.net)
