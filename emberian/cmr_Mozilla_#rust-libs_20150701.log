[00:10:19] <Gankro> bluss: btw I'm totally stealing your BinaryHeap code for turpl as a prime "exception safety" example
[00:11:02] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[00:11:58] <bluss> Gankro: sounds good
[00:12:27] <Gankro> bluss: Did you ever try out the two-pass solution? Wondering about the perf consequences
[00:12:27] <bluss> a common thing I've seen among user questions here on irc is the use of mem::uninitialized values on the stack
[00:12:56] <bluss> Gankro: I didn't try it
[00:13:00] <Gankro> Ah well
[00:13:03] <Gankro> no worries
[00:13:11] <Gankro> It's just so much... shorter
[00:25:32] <bluss> Gankro: what's shorter?
[00:25:41] <Gankro> bluss: two-pass
[00:26:00] <Gankro> The Hole design would be shorter if we had proper "finally" blocks
[00:26:27] <Gankro> Having to make a whole API is a bit nasty
[00:27:45] <bluss> I don't dislike it
[00:28:03] *** Quits: Asandari (Asandari@moz-emp96u.cable.teksavvy.com) (Ping timeout: 121 seconds)
[00:29:02] <eternaleye> Gankro: Perl 6 calls that kind of thing "Phasers" :P
[00:29:23] <eternaleye> Gankro: BUILD { }, LEAVE { }, etc.
[00:30:06] <eternaleye> (BUILD runs at compile-time, LEAVE on exiting a scope, etc)
[00:31:08] <Gankro> eternaleye: THey also seem to have ENTER which seems... baffling
[00:31:28] <Gankro> Can you, like, jump into the middle of a method?
[00:31:40] <eternaleye> Gankro: Anonymous blocks
[00:31:51] <Gankro> ?
[00:31:53] <eternaleye> Gankro: Just plain ol' { }
[00:32:08] <Gankro> eternaleye: You can goto the middle of those?
[00:32:58] <eternaleye> Gankro: It has goto LABEL;
[00:33:11] <Gankro> friggin' PERL man...
[00:33:38] <eternaleye> Gankro: Perl is not an acronym
[00:33:45] <Gankro> shhh...
[00:34:03] <Gankro> If their syntax gets to scream, I get to scream them
[00:34:36] <eternaleye> Gankro: So the hyperoperators would be a bad thing to bring up, then?
[00:34:53] <Gankro> wat
[00:34:56] <Elaine> Perl 6 is from an alternate timeline or something
[00:35:10] * Gankro has never used perl
[00:35:14] <Elaine> it's like if APL had been dominant and then structured programming became a thing
[00:36:09] <eternaleye> Gankro: (1, 2, 3) X+ (4, 5, 6) # Construct the cartesian product and sum the pairs
[00:36:26] <Gankro> seems legit
[00:36:29] <eternaleye> Gankro: (1, 2, 3) >>+<< (4, 5, 6) # zip and sum
[00:36:56] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[00:37:05] <Gankro> That's... one way to develop composition
[00:37:13] <Gankro> is >>_<< seriously "zip"?
[00:37:37] <eternaleye> Gankro: Sort of
[00:37:54] <eternaleye> >> and << can be seen as directional functors
[00:38:11] <eternaleye> @foo>>.++ postincrements every member of the list
[00:38:49] <eternaleye> Or rather,  functor applicators
[00:39:31] <eternaleye> >>op<< being "zip and op" makes perfect sense from there
[00:39:45] <eternaleye> Of course, this is Perl
[00:39:53] <eternaleye> So There's More Than One Way To Do It
[00:40:00] <eternaleye> Thus, there is also the Z hyperoperator
[00:40:04] <eternaleye> ...which zips.
[00:40:12] <eternaleye> @foo Z+ @bar
[00:40:37] <eternaleye> Personally, though, my favorite is the reduction hyperoperator
[00:40:42] <eternaleye> [+] @foo
[00:40:51] <eternaleye> Want the triangle reduction?
[00:40:55] <eternaleye> [\+] @foo
[00:40:58] <Gankro> stahp
[00:41:04] <eternaleye> :P
[00:42:32] <eternaleye> Want the largest item in a list? Reduce with the binary 'max' operator!
[00:42:35] <eternaleye> [max] @foo
[01:03:40] *** Joins: Asandari (Asandari@moz-emp96u.cable.teksavvy.com)
[01:08:00] <Gankro> Eridius: ping on https://github.com/rust-lang/rfcs/pull/1058
[01:08:12] *** Quits: Asandari (Asandari@moz-emp96u.cable.teksavvy.com) (Ping timeout: 121 seconds)
[01:09:11] *** Joins: Asandari (Asandari@moz-emp96u.cable.teksavvy.com)
[01:22:19] <Gankro> huon: have you seen https://github.com/rust-lang/rfcs/pull/1180 yet?
[01:25:09] <huon> I have, but I hvaen't read it
[01:35:34] *** Joins: aatch (james@moz-i1k1ks.tlms.2o1v.e006.2406.IP)
[01:43:27] <Eridius> Gankro: pong
[01:43:48] <Gankro> Eridius: what's the status of the RFC?
[01:43:52] <Eridius> huh, you commented 19 days ago. Did I not get an email about that?
[01:43:54] * Eridius checks his email folders
[01:44:13] <Eridius> oh there it is. I swear I checked that folder just the other day
[01:44:58] <Gankro> *shrug*
[01:55:15] <Eridius> Gankro: I just updated the RFC based on your comments
[01:55:24] <Gankro> Eridius: thanks!
[01:55:52] <Gankro> Eridius: Do you think it's ready for FCP, or are there any open problems you'd like to hash out first?
[01:57:18] <Eridius> I suppose it's ready
[01:59:02] <Gankro> (might have to wait for next week depending on how long it takes us to declare the next batch of FCP rfcs)
[02:02:56] <Gankro> aturon: acrichto: I think https://github.com/rust-lang/rfcs/pull/1058 can enter FCP now.
[02:03:41] <acrichto> Gankro: ok, cool!
[02:05:49] <Gankro> huon: go home you're drunk
[02:15:26] <huon> Gankro: no u
[02:32:44] *** Quits: kimundi (kimundi@moz-2dkqph.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:34:04] *** Joins: kimundi (kimundi@moz-didlps.13u2.kfms.57bc.2002.IP)
[03:01:03] *** Joins: rustbot (havvy@moz-tb54ql.airspeedinternet.net)
[03:02:00] *** Joins: brson (brson@moz-lrp27o.hsia.telus.net)
[03:02:01] *** ChanServ sets mode: +qo brson brson
[04:54:55] *** Quits: brson (brson@moz-lrp27o.hsia.telus.net) (Quit: leaving)
[05:45:49] *** Quits: aatch (james@moz-i1k1ks.tlms.2o1v.e006.2406.IP) (Quit: Leaving)
[05:51:04] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[05:51:44] *** Quits: SimonSapin (simon@moz-lb0n4e.rev.poneytelecom.eu) (Quit: WeeChat 1.0.1)
[05:52:02] *** Joins: SimonSapin (simon@moz-lb0n4e.rev.poneytelecom.eu)
[05:57:24] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Ping timeout: 121 seconds)
[06:52:30] <sfackler> acrichto: hmm, why does the AsRaw{Fd,Handle,Socket} family exist? It could just be As<RawFd> etc, right?
[06:55:01] <Gankro> sfackler: Are those generically useful?
[06:55:13] <SimonSapin> sfackler: what As? std::convert has AsRef and Into
[06:57:22] <sfackler> oh weird
[06:57:38] <sfackler> Gankro: <T: AsRawFd> is a not-uncommon bound
[06:57:43] <sfackler> same with socket and handle
[06:58:18] <sfackler> e.g. https://github.com/sfackler/rust-openssl/blob/master/openssl/src/ssl/mod.rs#L1094
[08:04:08] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[08:36:57] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[09:30:41] *** Quits: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au) (Ping timeout: 121 seconds)
[09:40:53] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[10:01:17] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[11:25:25] *** Quits: c74d (c74d3a4ebb6@moz-kn41j4.mggc.hibn.4404.2002.IP) (Connection closed)
[11:25:49] *** Joins: c74d (c74d3a4ebb6@moz-kn41j4.mggc.hibn.4404.2002.IP)
[12:34:06] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[12:43:17] *** Joins: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au)
[12:43:17] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[12:44:37] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Connection closed)
[12:46:12] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[12:47:53] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[13:01:36] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[13:09:11] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[13:34:21] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Connection closed)
[13:35:20] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[14:58:43] *** Quits: erikj (erikj@moz-1bq7nj.com) (Quit: kfonx)
[14:59:08] *** Joins: erikj (erikj@moz-1bq7nj.com)
[15:08:08] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[15:18:42] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[15:31:28] <aturon> sfackler: the problem with doing it through AsRef/Into is that the impls are then in scope without any explicit imports -- 
[15:31:45] <aturon> while we *want* them to be marked via an "platform specific" import using os::platform
[16:04:57] <sfackler> ah
[16:06:39] <acrichto> sfackler: yeah what aturon said
[16:20:57] <SimonSapin> acrichto: I don’t know anything about IR or how to generate it. What should I do about https://github.com/rust-lang/rust/pull/26241 ?
[16:21:32] <acrichto> SimonSapin: does ./$target/stage1/bin/rustc --emit=llvm-ir src/libstd/lib.rs work ?
[16:23:23] *** Joins: scott (uid25790@moz-e5ok1n.brockwell.irccloud.com)
[16:24:05] <SimonSapin> trying
[16:24:12] <SimonSapin> with --test, as that’s when I get the error
[16:27:46] <SimonSapin> acrichto: ok, got a 74 MB std.ll file. Is bugpoint built with rustc’s LLVM?
[16:28:32] <acrichto> SimonSapin: it is, but you may want to confirm the crash first, if you change the output to an object does the compiler crash?
[16:28:43] <aturon> acrichto: catching up on Arc PR -- would you like to try to talk through some of the memory orderings, or should I just go conservative for now?
[16:29:16] <acrichto> aturon: my understanding of atomic orderings leads me to believe that what you had there was all correct, just wanted some comments for future adventurers
[16:30:11] <aturon> ok. i think there's room for improvement in a few cases, but i'll focus on spelling out my thinking
[16:33:47] <acrichto> aturon: yeah nothing too serious
[16:34:16] <aturon> (e.g. i don't think SeqCst is needed anywhere)
[16:34:39] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Ping timeout: 121 seconds)
[16:35:21] <aturon> Gankro: p.s., i think a convention of treating orderings other than SeqCst as requiring a comment, in the same way that uses of unsafe generally want a comment, is a good idea
[16:36:23] <aturon> acrichto: hm, i think i do want to talk through these orderings once i'm done :)
[16:36:29] <bluss> all of channel oneshot is using SeqCst I think
[16:37:13] <bluss> aturon: do you think it's possible to use valgrind to check this?
[16:37:22] <SimonSapin> hmm, I don’t get an error with --emit=obj …
[16:37:24] <aturon> bluss: sorry, to check what?
[16:37:29] <acrichto> aturon: haha feel free
[16:37:42] <acrichto> SimonSapin: perhaps -O is needed?
[16:37:53] <bluss> aturon: against any apparent synchronization errors
[16:38:35] <aturon> bluss: i'm not sure about valgrind specifically, but there are definitely tools out there for such testing
[16:38:44] <SimonSapin> running `make check-stage1-std VERBOSE=1` to get the exact command
[16:38:53] <aturon> bluss: not sure how easily they could be adapted to Rust
[16:39:46] <aturon> bluss: btw, to be clear my comment about SeqCst was about Arc specifically, not in general
[16:39:59] <aturon> bluss: although it *is* pretty unusual to actually need SeqCst
[16:40:20] <bluss> of course, but the skill needed to know to use anything else is also unusal
[17:20:24] <acrichto> SimonSapin: oh sorry, so you've got some IR now, right?
[17:20:32] <SimonSapin> yes
[17:20:36] <acrichto> SimonSapin: LLVM binaries are in ./$target/llvm/Release/bin
[17:20:45] <acrichto> if you try running `llc` on the IR, it crashes?
[17:20:47] <acrichto> (just confirming)
[17:20:59] <acrichto> e.g. bugpoint only works if the crash is in LLVM itself
[17:21:41] <SimonSapin> llc gives a different error
[17:21:43] <SimonSapin> ./x86_64-unknown-linux-gnu/llvm/Release/bin/llc: std.ll:2478:134: error: expected value token
[17:21:45] <SimonSapin> @panic_loc61497 = internal unnamed_addr constant { %str_slice, %str_slice, i32 } { %str_slice { i8* getelementptr inbounds ([31 x i8], [31 x i8]* @str61494, i32 0, i32 0), i64 31 }, %str_slice { i8* getelementptr inbounds ([45 x i8], [45 x i8]* @str61496, i32 0, i32 0), i64 45 }, i32 1282 }
[17:22:04] <acrichto> hm, perhaps you have a Release+Asserts build?
[17:22:13] <acrichto> e.g. does the dir Release+Asserts exist?
[17:22:27] <acrichto> that looks like a mismatched llvm version
[17:22:30] <acrichto> b/c the IR syntax changed recently
[17:23:05] <SimonSapin> ok, with llc in Release+Asserts in can reproduce the assertion error
[17:23:19] <acrichto> cool
[17:23:26] <acrichto> so in that dir there should be a bugpoint executable
[17:23:29] <acrichto> and you can run:
[17:23:32] <acrichto> er
[17:23:33] <acrichto> well
[17:23:55] <acrichto> PATH=$PATH:`pwd`/x86_64-unknown-linux-gnu/llvm/Release+Asserts/bin bugpoint -llc-safe std.ll
[17:24:00] <acrichto> (gotta make sure llc is in PATH)
[17:24:15] <acrichto> and I'm not quite sure what the -llc-safe flag does
[17:27:38] <SimonSapin> ok, I have a bunch of output ending with Emitted bitcode to 'bugpoint-reduced-simplified.bc'
[17:27:57] <acrichto> cool
[17:28:04] <acrichto> you can use llvm-dis to translate that into foo.ll
[17:28:11] <SimonSapin> I also have bugpoint-reduced-function.bc and bugpoint-reduced-blocks.bc
[17:28:12] <acrichto> and then poke around a bit to see if you can reduce it further
[17:28:18] <acrichto> yeah not sure what those are
[17:28:23] <acrichto> I've only ever used -simplified.bc
[17:28:32] <Gankro> r? https://github.com/rust-lang/rust/pull/26034
[17:28:57] <SimonSapin> bugpoint-reduced-simplified.ll is 18 MB
[17:29:07] <acrichto> Gankro: the `since` tag I think is 1.3.0 now
[17:29:12] <acrichto> SimonSapin: wow
[17:29:22] <acrichto> it doesn't always work :(
[17:29:22] <Gankro> acrichto: booooooooooooooooooooooooooooo
[17:29:38] <acrichto> Gankro: otherwise r=me
[17:31:08] * Gankro deletes stability.rs
[17:36:55] *** Joins: mw (mw@moz-f1s7jp.vie.surfer.at)
[17:37:06] *** Parts: mw (mw@moz-f1s7jp.vie.surfer.at) ("")
[18:13:15] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Quit: Leaving.)
[18:13:18] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[18:51:56] *** Joins: sigma (sigma@moz-l8bauc.range217-44.btcentralplus.com)
[19:33:54] *** Quits: sigma (sigma@moz-l8bauc.range217-44.btcentralplus.com) (Connection closed)
[20:04:24] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[20:21:00] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[20:27:00] *** Quits: scott (uid25790@moz-e5ok1n.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[20:42:20] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[20:50:53] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[21:04:21] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (A TLS packet with unexpected length was received.)
[21:16:43] <bluss> Gankro: the hosted link to turpl 404s (from the internals forum)
[21:17:39] <Gankro> wtf
[21:17:49] <Gankro> discuss is caching the link
[21:17:52] <Gankro> from before I edited
[21:18:30] <Gankro> fixed...?
[21:18:48] <bluss> fixed
[22:26:11] *** Quits: c74d (c74d3a4ebb6@moz-kn41j4.mggc.hibn.4404.2002.IP) (Connection closed)
[22:26:33] *** Joins: c74d (c74d3a4ebb6@moz-iclfcj.mggc.hibn.4404.2002.IP)
[23:35:01] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Quit: Leaving.)
