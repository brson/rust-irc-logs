[00:01:45] *** Joins: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP)
[00:01:45] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/oSzJBg
[00:01:45] *** Parts: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP) ()
[00:10:09] *** Quits: dherman (dherman@F16146EB.9D3722BB.58DC3EE6.IP) (Quit: dherman)
[00:14:27] *** Quits: geoffhill (geoffhill@moz-95FF7399.members.linode.com) (Ping timeout)
[00:20:46] *** Joins: lpy (lpy@7360AA58.F09091A8.1348A864.IP)
[00:28:52] *** Quits: canhtak (canhtak@moz-46C3B4C8.wl.t.ulaval.ca) (Quit: canhtak)
[00:40:46] <eddyb> huon: TBQH.... the only thing right in here is the comments. and only the // ones http://adrientetar.legtux.org/cached/rust-doc/to_str.rs.html
[00:41:19] <eddyb> strings are green (what?), macros are blue (okay), directives and self are red (what?)...
[00:41:40] <eddyb> reminds me of the kate syntax highlighting file before I switched it to the default color scheme
[00:41:49] <eddyb> kimundi: I know, I know, I should've made a PR with those changes
[00:41:57] <huon> eddyb: I think strings and idents are the worst part
[00:42:20] <huon> the rest isn't *so* bad
[00:42:34] <eddyb> red strings, black idents and bold black keywords is pretty standard...
[00:42:52] <huon> sounds like github's highlighting :P
[00:43:15] <eddyb> and katepart default scheme (thought a bit more colored)
[00:43:37] <eddyb> huon: it feels... realistic. I don't know...
[00:43:55] <eddyb> like it's not dreaming or floating or being high (brightness) in general
[00:46:15] *** Joins: canhtak (canhtak@moz-46C3B4C8.wl.t.ulaval.ca)
[00:47:18] *** Quits: [o__o] (~o__o@604A2740.DB688352.F4ADE383.IP) (Input/output error)
[00:47:26] <sfackler> cloning github's highlighting for rust code would work decently well, imo
[00:47:37] *** Joins: [o__o] (~o__o@604A2740.DB688352.F4ADE383.IP)
[00:47:44] <eddyb> I don't mind extra nuances
[00:47:50] <strcat> sfackler: github uses pygments, which is really out of date for rust ;)
[00:47:54] <strcat> or do you mean theme
[00:47:55] <eddyb> but totally inverting it *and not using bold* is meh
[00:47:58] <sfackler> it should be updated!
[00:48:02] <sfackler> but yeah, I meant the theme
[00:49:49] <huon> cmr updated pygments' Rust handling (but I assume github hasn't updated to that version yet)
[00:50:29] <cmr> I don't even think pygments has a release with my fixes in it...
[00:51:11] <cmr> but it should handle lifetimes etc now.
[00:51:17] <cmr> instead of making them as a lexing error...
[00:51:44] <eddyb> cmr: I wish it wouldn't do that for LLVM IR
[00:52:16] <eddyb> rustfilt output gets quite some red. and all the new attributes. shouldn't have a hardcoded list of them >_>
[00:57:02] *** Quits: canhtak (canhtak@moz-46C3B4C8.wl.t.ulaval.ca) (Quit: canhtak)
[00:58:26] *** Joins: canhtak (canhtak@moz-46C3B4C8.wl.t.ulaval.ca)
[01:07:37] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[01:16:29] *** Quits: eibwen (kvirc@moz-D4DF209C.dip0.t-ipconnect.de) (Ping timeout)
[01:16:31] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[01:18:25] <huon> r? https://github.com/mozilla/rust/pull/12675
[01:18:52] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[01:19:01] <eddyb> huon: #3amreadingmaterial
[01:19:31] <eddyb> I think either cmr or strcat wanted to do that weeks ago
[01:19:49] <huon> maybe they did... but I did it 15 minutes ago :P
[01:20:07] <eddyb> just saying it's overdue
[01:21:41] <eddyb> huon: LGTM :D
[01:22:02] <eddyb> now if we could hear words from core devs... that would be great
[01:22:43] <eddyb> cmr, huon: going to sleep so late might not be that bad after all... maybe I can adjust my sleep schedule to US timezones
[01:23:13] <eddyb> then again, I tried that once and it didn't work. something to do with biological clocks, sunlight detection etc. :(
[01:24:17] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[01:24:21] <strcat> OptVec was 1 word vs Vec at 3 so I was worried it was going to be too big
[01:24:49] <huon> strcat: that change is a strict improvement over what we have right now
[01:24:49] *** Quits: canhtak (canhtak@moz-46C3B4C8.wl.t.ulaval.ca) (Quit: canhtak)
[01:25:04] <huon> (since it's effectively Option<Vec> i.e. 4 words)
[01:25:32] <eddyb> unless you nest it in an enum
[01:25:50] <eddyb> in which case you add two words to a bunch of AST nodes
[01:26:08] <eddyb> a nice compromise is the DST ~[T]
[01:26:29] <eddyb> it's the AST, doesn't need growable
[01:27:09] <eddyb> and you can fit SmallVec<*T> in that same space, where * is any pointer
[01:27:42] <eddyb> well, SmallUniqArray, but... eww
[01:29:20] *** Joins: canhtak (canhtak@moz-46C3B4C8.wl.t.ulaval.ca)
[01:30:48] *** Quits: lpy (lpy@7360AA58.F09091A8.1348A864.IP) (Ping timeout)
[01:34:34] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[01:36:40] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[01:36:40] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/pn8mYw
[01:36:40] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[01:36:42] *** Joins: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP)
[01:36:42] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/PMNxIA
[01:36:42] <ghrust> 13rust/06auto 148f2a731 15Huon Wilson: syntax: replace OptVec with plain Vec....
[01:36:42] <ghrust> 13rust/06auto 14add1b25 15bors: auto merge of #12675 : huonw/rust/rm-opt-vec, r=Aatch...
[01:36:42] *** Parts: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP) ()
[01:37:03] <huon> gah, dammit
[01:37:47] <aatch> what? was there something I missed?
[01:38:18] <huon> aatch: writing a comment now
[01:38:26] <eddyb> huon: did you ask for r? before testing everything? I tend to do that :P
[01:38:38] <huon> basically what strcat pointed out
[01:38:44] <huon> (nah, it passes tests)
[01:38:45] <eddyb> does it show up?
[01:38:56] <eddyb> + 200MB of RAM?
[01:40:47] <huon> I can't measure
[01:40:49] <huon> cmr: ping
[01:41:40] *** Joins: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP)
[01:41:40] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14add1b25 to 14c951696: 02http://git.io/N3iJvQ
[01:41:40] *** Parts: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP) ()
[01:42:49] <huon> https://github.com/mozilla/rust/pull/12675#issuecomment-36583236
[01:43:59] <huon> aatch: (i.e. not a problem with your review)
[01:45:53] *** Quits: sunfish (chatzilla@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[01:45:54] *** Joins: lpy (lpy@7360AA58.F09091A8.1348A864.IP)
[01:51:40] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[01:51:40] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14ad74827 to 14c951696: 02http://git.io/N3iJvQ
[01:51:40] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[01:51:41] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[01:51:41] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/6TabVQ
[01:51:41] <ghrust> 13rust/06auto 1487061c3 15Alex Crichton: Register new snapshots...
[01:51:41] <ghrust> 13rust/06auto 1480e4c39 15bors: auto merge of #12674 : alexcrichton/rust/snapshots, r=Aatch...
[01:51:42] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[01:52:14] <eddyb> aatch: are you doing the review shift :D?
[01:52:16] <aatch> Hmm, maybe we should have an Array<T> somewhere for cases like these.
[01:52:22] <aatch> eddyb, slow day at work.
[01:52:51] <aatch> Also, snapshot PR, not exactly much to review.
[01:52:59] <eddyb> you mean UniqArray<T>, as in DST ~[T]?
[01:53:41] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[01:53:46] <aatch> eddyb, well yeah. But something to have until we get DST.
[01:54:03] <aatch> (unless of course we already have UniqArray<T>)
[01:54:45] <eddyb> no we don't. and it's a bit sad to see such a long thing :/
[01:55:22] <aatch> Well I'd probably just make it Array<T> and have it live somewhere in the compiler.
[01:56:44] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[02:01:10] <huon> eddyb: what was the method_map replaced with?
[02:01:32] <eddyb> the method_map is still there
[02:01:42] <eddyb> callee_id was removed
[02:03:58] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[02:04:38] <huon> bin.rs:10:5: 10:38 error: unresolved import: there is no `method_map` in `rustc::middle::typeck`
[02:04:39] <huon> bin.rs:10 use rustc::middle::typeck::method_map;
[02:04:40] <huon> eddyb: ^
[02:04:59] <eddyb> aaah. MethodMap
[02:05:05] <huon> oh
[02:05:07] <eddyb> I forgot about the renaming. where is that from?
[02:05:12] <huon> my own tool
[02:05:13] <eddyb> rustpkg?
[02:05:41] <eddyb> (I thought you could be maintaining that rustpkg code save, nvm)
[02:05:59] <huon> nope
[02:06:01] <huon> "unsafe_ls"
[02:06:05] <huon> putting on github soon
[02:06:15] <eddyb> huon: but it's literally in the same place :P
[02:06:16] <huon> also... what do I do without callee_id?
[02:06:26] <eddyb> I guess I'm too familiar with the codebase
[02:06:43] <eddyb> huon: the method map was never queried by callee_id, I think
[02:06:43] *** Joins: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP)
[02:06:43] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/ZjUNNA
[02:06:43] <ghrust> 13rust/06auto 14b0e0cb5 15Alex Crichton: Register new snapshots...
[02:06:43] <ghrust> 13rust/06auto 143c0d098 15bors: auto merge of #12674 : alexcrichton/rust/snapshots, r=Aatch...
[02:06:44] *** Parts: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP) ()
[02:06:45] *** Joins: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP)
[02:06:45] <ghrust> [13rust] 15bors 04force-pushed 06auto from 1480e4c39 to 14c951696: 02http://git.io/N3iJvQ
[02:06:45] *** Parts: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP) ()
[02:06:53] <eddyb> huon: where exactly are you using callee_id in?
[02:07:03] <huon>                 ast::ExprMethodCall(callee_id, _, _, _) => {
[02:07:04] <huon>                     let base_type = ty::node_id_to_type(self.tcx, callee_id);
[02:07:04] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[02:07:08] <huon> wait
[02:07:20] <huon> I stole this code from somewhere
[02:07:27] <huon> I'll just steal the update too
[02:07:32] <eddyb> you have to do something like method_map.get(expr.id).ty
[02:09:12] <huon> yup
[02:09:14] <huon> thanks
[02:09:53] <eddyb> and that will change to .get(&MethodCall::expr(expr.id)) after the Deref PRs =))
[02:09:57] <eddyb> huon: sorry :P
[02:10:30] <eddyb> at least you shouldn't have to care about auto-deref calls, as they shouldn't be unsafe methods
[02:10:37] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[02:10:58] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[02:12:40] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[02:13:24] *** Quits: Sharp (Sharp@moz-3301C7AB.static-ip.telepacific.net) (Quit: Sharp)
[02:20:39] *** Quits: pcwalton (pcwalton@F16146EB.9D3722BB.58DC3EE6.IP) (Quit: pcwalton)
[02:21:47] *** Quits: brson (brson@4A08E125.708C0A12.C7EEF3A2.IP) (Ping timeout)
[02:23:26] *** Quits: eddyb (eddy@F8B50789.F33C1089.FB866788.IP) (Ping timeout)
[02:24:45] <aatch> Heh, got assigned a 3 year old ticket for triage.
[02:29:59] *** Quits: nrc (nrc@F16146EB.9D3722BB.58DC3EE6.IP) (Ping timeout)
[02:37:57] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[02:38:18] *** Joins: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net)
[02:41:57] *** Quits: mrmonday (mrmonday@moz-C7DC1A73.lin.openzula.org) (Ping timeout)
[02:43:36] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Quit: Computer has gone to sleep.)
[02:44:00] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[02:45:39] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[02:51:19] *** Joins: riddochc (riddochc@moz-E514D445.hlrn.qwest.net)
[02:54:06] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[02:56:25] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[02:59:20] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[03:02:51] *** Quits: bytbox (s@moz-E1E7FAC3.washdc.fios.verizon.net) (Ping timeout)
[03:05:49] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[03:14:45] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[03:17:16] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[03:33:28] *** Quits: blank_name (blank_name@463DB555.53526368.6D228269.IP) (Quit: leaving)
[03:35:48] *** Quits: riddochc (riddochc@moz-E514D445.hlrn.qwest.net) (Quit: Leaving.)
[03:36:57] *** Joins: blank_name (blank_name@463DB555.53526368.6D228269.IP)
[03:46:21] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[03:46:47] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[03:46:48] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/ZjUNNA
[03:46:48] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[03:48:00] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[03:54:42] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[03:56:14] <huon> cmr: ping
[03:56:29] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[03:57:10] <cmr> huon: pong
[03:57:20] <huon> cmr: bencher --status
[03:57:32] <cmr> waiting on hard drive.
[03:57:36] <cmr> it shipped last night.
[03:57:39] *** Quits: kimundi (kimundi@moz-C46B8065.dip0.t-ipconnect.de) (Ping timeout)
[03:57:44] <huon> (i'm interested for https://github.com/mozilla/rust/pull/12675#issuecomment-36583236 )
[03:57:46] <cmr> 3TB to be filled with rust goodness.
[03:57:46] <huon> oh?
[03:57:52] <cmr> yeah I ran out of space for builds.
[03:58:01] <huon> heh
[03:58:03] <cmr> even after symlinking.
[03:58:13] <cmr> the extra-splosion made stage2 huge :|
[04:00:28] <huon> oh, duplicated generic instantiations?
[04:01:02] <cmr> whatever it is, stage2 is many times larger.
[04:01:15] <cmr> I expected another 2.5k builds to fit in the remaining disk space.
[04:01:22] <cmr> Instead I got < 500
[04:01:25] <huon> o_O
[04:01:30] *** Joins: kimundi (kimundi@moz-82D1D1B3.dip0.t-ipconnect.de)
[04:01:53] <huon> maybe that's why I hit disk limits really quickly too :/
[04:02:04] <cmr> lemme reboot and get some solid numbers....
[04:04:40] *** Quits: canhtak (canhtak@moz-46C3B4C8.wl.t.ulaval.ca) (Quit: canhtak)
[04:05:28] *** kimundi is now known as zz_kimundi
[04:08:00] *** Joins: canhtak (canhtak@moz-46C3B4C8.wl.t.ulaval.ca)
[04:08:24] *** Joins: bytbox (s@moz-E1E7FAC3.washdc.fios.verizon.net)
[04:12:33] *** zz_kimundi is now known as kimundi
[04:19:32] <aatch> goddamit, using RUST_LOG=rustc::middle::ty causes typeck to be pulled in.
[04:21:11] <huon> aatch: rustc::middle::ty:: might work?
[04:21:25] <aatch> tried that, it doesn't, unfortunately
[04:21:32] <huon> oh :(
[04:21:36] <aatch> I managed to wade through the stuff I wasn't interested in though.
[04:22:09] <huon> `RUST_LOG=debug`, so you don't miss anything
[04:22:48] <aatch> Theres a (not-quite) infinite loop I'm investigating
[04:25:16] <aatch> basically looks like it's #12511
[04:27:43] <cmr> are you ready for this.
[04:27:57] <cmr> this is insane.
[04:27:59] <cmr> but are you ready?
[04:28:02] <cmr> http://i.imgur.com/AjKgxVe.png
[04:28:18] <huon> woah
[04:28:24] <cmr> yeah :|
[04:28:44] <huon> what're the two big jumps?
[04:28:51] <cmr> dunno.
[04:28:53] <cmr> let me check.
[04:28:53] <aatch> I thought it was good... then I looked at the scale...
[04:29:09] <huon> yeah, who puts time going right to left :P
[04:29:14] <cmr> sorry :(
[04:29:19] <cmr> accidentally git log'd in the wrong direction.
[04:29:29] <cmr> it would have been so easy to fix had I cared.
[04:29:33] <cmr> data = data[::-1]
[04:29:35] <cmr> :P
[04:30:39] <cmr> ... one of the spikes is e65a8b88cac97bdc01ee01a099915d861406edd6
[04:30:49] <cmr> the other is 5512fb49a038ca3827e33d8ddf41f6901f11c2f5
[04:30:51] <cmr> weird.
[04:31:01] <cmr> I wonder if those didn't get hit by my symlink script...
[04:31:03] * cmr re-runs.
[04:31:07] <huon> cmr: `convert image.png -flop  image2.png` :P
[04:31:17] <cmr> gm convert, thank you
[04:31:20] <cmr> heathen :P
[04:32:11] <sfackler> cmr: neither of those seem like likely offenders
[04:32:33] <cmr> this is why I suspect my symlinking script.
[04:32:37] <huon> is https://github.com/mozilla/rust/pull/12081 the issue/pr with the most comments?
[04:32:46] <cmr> 291 O_O
[04:34:29] <cmr> huon: want to start keeping track of binary size on irsy?
[04:34:50] <cmr> can do aggregate stage2 size as well as size for every lib.
[04:34:53] <cmr> static and dynamic.
[04:35:08] <cmr> I might even be able to implement this!
[04:35:13] <cmr> I just remembered: I know how to program.
[04:36:10] <huon> if you put it in the zip file I can put that up somewhere, I guess
[04:36:24] <cmr> is the irsy repo up to date?
[04:36:32] <huon> in what sense?
[04:36:57] <cmr> in that the stuff on github is the stuff that gets used to generate the website.
[04:37:09] <huon> yes, all done via GH pages
[04:37:24] <cmr> aye
[04:37:28] <huon> so it has to be (and my bot pull --rebase's any code changes from there before regenning)
[04:38:46] <huon> if you are going to implement it yourself, then I'd like the info to just be added to Summary (in mem/process)
[04:39:34] <cmr> I don't have you, you can do it if you want :P
[04:39:44] * huon doesn't want
[04:39:58] <huon> the JS part is the hard part :P
[04:40:38] <huon> (but don't do the JS stuff unless you *really* want to)
[04:40:57] <cmr> it is a little known fact that I was once a webdev
[04:41:18] <cmr> thankfully I've drunk most of that knowledge out of my brain.
[04:41:19] <huon> yeah, but the current JS structure makes grown browsers cry
[04:41:31] <cmr> heh
[04:41:51] <aatch> huon, that makes me sad.
[04:41:51] <cmr> are you still doing unholy things with d3?
[04:41:56] <aatch> As a current web-dev
[04:42:19] <huon> cmr: hasn't changed, so yes
[04:42:21] <cmr> mm
[04:43:47] <huon> http://huonw.github.io/isrustfastyet/buildbot/bench/test.html is using a newer version of the graphing stuff that's in (rather slow) progress
[04:44:17] <huon> oh, that needs to be updated for cratesplosion
[04:46:28] <cmr> huon: I'll do this tomorrow during one of my more boring classes.
[04:46:42] <huon> cmr: ok
[04:46:53] <cmr> until then, I'm hitting the sack. 'night.
[04:47:05] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[04:49:35] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[04:54:32] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[04:56:28] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[05:12:25] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Ping timeout)
[05:27:21] *** Quits: lpy (lpy@7360AA58.F09091A8.1348A864.IP) (Ping timeout)
[05:38:56] *** Quits: canhtak (canhtak@moz-46C3B4C8.wl.t.ulaval.ca) (Quit: canhtak)
[05:48:36] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[05:50:10] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[05:51:05] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[05:51:50] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:54:34] *** Joins: brson (brson@981AA104.E81F12CD.76F66111.IP)
[05:54:34] *** ChanServ sets mode: +qo brson brson
[05:54:48] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[05:56:30] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[06:01:43] *** Joins: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP)
[06:01:43] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/Yt85Lg
[06:01:43] <ghrust> 13rust/06auto 1447cff94 15TorstenWeber: Implemented checked arithmetic for Big(U)Ints
[06:01:43] <ghrust> 13rust/06auto 14062e950 15bors: auto merge of #12672 : korenchkin/rust/checked-bigint, r=alexcrichton
[06:01:43] *** Parts: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP) ()
[06:01:45] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[06:01:45] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/5m_UnA
[06:01:45] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[06:07:07] *** Joins: edwardw (edwardw@655F78EA.BF27AFA4.B9C6B12A.IP)
[06:13:12] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[06:15:14] *** Quits: brson (brson@981AA104.E81F12CD.76F66111.IP) (Ping timeout)
[06:15:28] *** Joins: brson (brson@981AA104.E81F12CD.76F66111.IP)
[06:15:28] *** ChanServ sets mode: +qo brson brson
[06:16:43] *** Joins: canhtak (canhtak@moz-46C3B4C8.wl.t.ulaval.ca)
[06:26:22] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[06:28:28] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[06:30:32] *** Joins: anvesh (chatzilla@BF01F93D.DB4BF525.F7A61E88.IP)
[06:30:45] *** Parts: anvesh (chatzilla@BF01F93D.DB4BF525.F7A61E88.IP) ()
[06:34:43] *** Quits: brson (brson@981AA104.E81F12CD.76F66111.IP) (Ping timeout)
[06:39:09] *** Joins: brson (brson@F16146EB.9D3722BB.58DC3EE6.IP)
[06:39:09] *** ChanServ sets mode: +qo brson brson
[06:48:31] *** Quits: brson (brson@F16146EB.9D3722BB.58DC3EE6.IP) (Ping timeout)
[06:48:55] *** Joins: brson (brson@F16146EB.9D3722BB.58DC3EE6.IP)
[06:48:55] *** ChanServ sets mode: +qo brson brson
[06:50:05] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[06:52:35] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[06:54:21] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[06:56:31] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[06:59:09] *** Quits: blank_name (blank_name@463DB555.53526368.6D228269.IP) (Quit: leaving)
[07:00:32] *** Joins: blank_name (blank_name@463DB555.53526368.6D228269.IP)
[07:03:50] *** Quits: blank_name (blank_name@463DB555.53526368.6D228269.IP) (Quit: leaving)
[07:05:47] *** Joins: blank_name (blank_name@463DB555.53526368.6D228269.IP)
[07:11:46] *** Joins: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP)
[07:11:46] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/Yt85Lg
[07:11:46] *** Parts: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP) ()
[07:14:51] *** Quits: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net) (Ping timeout)
[07:16:41] *** Joins: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP)
[07:16:41] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/n7FU5Q
[07:16:41] <ghrust> 13rust/06auto 14c3b9047 15Huon Wilson: syntax: make match arms store the expr directly....
[07:16:41] <ghrust> 13rust/06auto 14dc18659 15bors: auto merge of #12669 : huonw/rust/de-block-arms, r=alexcrichton...
[07:16:42] *** Parts: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP) ()
[07:23:54] *** Quits: canhtak (canhtak@moz-46C3B4C8.wl.t.ulaval.ca) (Quit: canhtak)
[07:51:39] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[07:53:19] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[07:53:47] *** Quits: brson (brson@F16146EB.9D3722BB.58DC3EE6.IP) (Quit: leaving)
[07:54:42] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[07:56:29] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[07:58:34] *** flaper87|afk is now known as flaper87
[08:00:55] *** Quits: edwardw (edwardw@655F78EA.BF27AFA4.B9C6B12A.IP) (Quit: Leaving...)
[08:11:15] <Yurume> acrichto: re-r? #12678
[08:11:26] <Yurume> (is that a correct syntax? :p)
[08:25:30] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:26:39] *** Joins: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP)
[08:26:39] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/n7FU5Q
[08:26:39] *** Parts: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP) ()
[08:27:53] *** Quits: bytbox (s@moz-E1E7FAC3.washdc.fios.verizon.net) (Ping timeout)
[08:30:34] *** Joins: eddyb (eddy@F8B50789.F33C1089.FB866788.IP)
[08:31:42] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[08:31:42] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/kc_E_w
[08:31:42] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[08:37:05] *** flaper87 is now known as flaper87|afk
[08:38:20] *** flaper87|afk is now known as flaper87
[08:39:50] *** flaper87 is now known as flaper87|afk
[08:40:13] *** flaper87|afk is now known as flaper87
[08:42:20] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:42:49] *** flaper87 is now known as flaper87|afk
[08:43:57] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[08:45:17] *** flaper87|afk is now known as flaper87
[08:48:12] *** flaper87 is now known as flaper87|afk
[08:52:24] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[08:54:34] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[08:54:56] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[08:56:28] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[08:56:44] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[08:58:25] *** flaper87|afk is now known as flaper87
[09:00:59] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[09:01:03] *** Joins: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net)
[09:02:24] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[09:05:50] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[09:06:42] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[09:11:04] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[09:18:15] *** Quits: meTaAU (admin@moz-52BDAB21.lns20.per1.internode.on.net) (Quit: Lost terminal)
[09:24:16] *** Joins: eibwen (kvirc@moz-283702DC.dip0.t-ipconnect.de)
[09:26:01] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[09:26:21] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[09:45:33] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[09:46:37] *** Joins: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP)
[09:46:37] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/DWmhqw
[09:46:37] *** Parts: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP) ()
[09:53:59] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[09:54:28] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[09:56:30] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[09:56:30] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[10:00:16] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[10:08:16] <eddyb> I think we have to agree to disagree https://github.com/mozilla/rust/issues/9912#issuecomment-36608456
[10:12:28] *** Joins: lpy (lpy@7360AA58.F09091A8.1348A864.IP)
[10:27:54] <kimundi> eddyb: Interestingly, you can somewhat emulate anonymous fields with a Deref impl
[10:31:05] <eddyb> oh, yeah, I should mention that
[10:33:16] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[10:35:31] *** Joins: ninechars (glaebhoerl@moz-B5B88D72.catv.broadband.hu)
[10:36:21] <eddyb> kimundi: thanks :D
[10:38:41] <kimundi> eddyb: Hm, I guess you could even chain theses Deref impls to get something approximating multiple inheritance
[10:39:30] <kimundi> delegate to a super field if one parent, delegate to a linked lists of newtypes if multiple parents
[10:39:47] <kimundi> which struct will actually get selected is going to be a bit random though
[10:40:08] <eddyb> kimundi: can't really
[10:40:14] <kimundi> but could always use the full or a partial field path to select the right track for autoderef to go down
[10:40:18] <eddyb> auto-deref is linear
[10:40:33] <eddyb> you need to have a structure with that field for it to stop at all
[10:41:02] <eddyb> I thought (SuperA, SuperB), but you can only go to one of them from there
[10:41:03] <kimundi> hm...
[10:41:15] <kimundi> yeah
[10:41:57] <eddyb> see my second other though :P
[10:42:33] <eddyb> that rust to JS transpiler can use prototypes to implement deref, I think
[10:42:40] <eddyb> s/other/edit/
[10:42:57] <eddyb> actually, no, it's incorrect *poof*
[10:50:08] <eddyb> so Coercible is a special Deref case?
[10:50:20] <eddyb> in which the deref is a noop
[10:50:35] <eddyb> kimundi: you may be a genius
[10:50:56] <huon> `kimundi: Option<Genius>`
[10:51:19] <eddyb> add a pointer in there to optimize for space
[10:54:32] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[10:55:34] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[10:56:30] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[10:58:04] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[11:18:13] <kimundi> eddyb: Thanks! Now tell what the ingenuity is that I apparently gave you ;)
[11:18:51] <kimundi> That deref could be generalized to Coercion?
[11:19:15] <eddyb> the other way around
[11:21:10] <kimundi> Right, I meant "deref yielding a pointer" can be generalized to "coercion to another type" which can be invoked with the same machinery as the Deref trait youwork on
[11:21:22] <kimundi> Does that sound right?
[11:22:19] <eddyb> well, no. Deref already works, and you can build Coercible on top of it
[11:22:31] <eddyb> at least the HasPrefix part
[11:23:47] <kimundi> Now I'm confused :)
[11:25:08] <eddyb> you can implement most of that proposal with Deref and DST
[11:25:47] <eddyb> no compiler code required for simple usecases
[11:54:20] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[11:55:01] *** Quits: ninechars (glaebhoerl@moz-B5B88D72.catv.broadband.hu) (Connection reset by peer)
[11:55:07] *** Joins: ninechars (glaebhoerl@moz-B5B88D72.catv.broadband.hu)
[11:56:28] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[11:56:59] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[11:58:39] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[12:18:58] *** Joins: glaebhoerl (glaebhoerl@moz-B5B88D72.catv.broadband.hu)
[12:19:12] *** Quits: ninechars (glaebhoerl@moz-B5B88D72.catv.broadband.hu) (Quit: )
[12:54:40] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[12:56:29] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[12:57:22] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[12:59:53] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[13:04:02] <cmr> please do so, I"d love to see i
[13:04:04] <cmr> t
[13:05:12] <eddyb> cmr: me?
[13:05:39] <eddyb> can't impl traits on trait objects without DST :(
[13:05:49] <cmr> ah
[13:05:51] <cmr> well
[13:05:55] <cmr> do it hypothetically :P
[13:06:05] <huon> implement DST \o/
[13:06:05] <cmr> don't need a compiler to program
[13:06:42] <huon> (and manage to get the design that niko et al. would like most first go, without consulting them; so it needs no adjustment at all.)
[13:06:57] * huon has eddyb's development schedule all planned out
[13:07:12] <cmr> manipulation level: bstrie
[13:07:49] <eddyb> cmr: impl<T> Deref<T> for HasPrefix<T> {fn deref<'a>(&'a self) -> &'a T {transmute_ref(self)}}
[13:07:57] <eddyb> same for DerefMut
[13:08:41] <eddyb> actually, you'd have to extract the data pointer from the trait object, but you get the idea
[13:09:31] <eddyb> I guess Coercible is a bit more general, but Deref+DerefMut should cover most cases
[13:10:45] <eddyb> glaebhoerl's original post expresses the safety problems with HasPrefix implementations not guarded by the compiler
[13:11:32] <eddyb> but it's more like a footgun than anything else, and shouldn't prevent servo from exposing free "virtual" field access through trait objects, once we have DST
[13:11:56] <eddyb> larsberg: ^^ may interest you (pcwalton is not around, I'd also ping him)
[13:13:15] <nmatsakis> eddyb: ps, I'm hoping to get to your PR (at least the 1st one!) in next few hours
[13:13:25] <eddyb> <3
[13:13:41] <eddyb> I guess I'm relaxing :P
[13:14:00] <nmatsakis> sorry, I hate having to wait on reviews when I've got a big patch ;)
[13:14:05] <nmatsakis> unfortunately big patches are when reviews take the longest...
[13:14:24] <eddyb> nmatsakis: did you see this nonsense about using Deref/DerefMut to fake single structural inheritance?
[13:14:34] <nmatsakis> just a few comments back?
[13:14:39] <nmatsakis> I didn't read it in detail yet
[13:14:58] <nmatsakis> still brewing coffee :) (only 5:15 here)
[13:14:59] <eddyb> even has overridable methods!
[13:15:15] <eddyb> (because of how autoderef works. try on current, then advance to super)
[13:16:01] <eddyb> nmatsakis: if you feel like reading my rant, here it goes https://github.com/mozilla/rust/issues/9912#issuecomment-36609873
[13:22:33] <nmatsakis> eddyb: cool, I'll take a look (I guess it'll show up in my e-mail)
[13:23:00] <eddyb> that email is your scheduler
[13:23:17] <eddyb> nmatsakis: and my pings are context switches /o/
[13:35:21] <nmatsakis> :)
[13:35:30] <nmatsakis> eddyb: it's true, the e-mail...is overwhelming sometimes
[13:36:02] <eddyb> so what happened yesterday? it confused me because I barely heard from anyone in the core team
[13:36:25] <nmatsakis> we basically discussed DST all day, as well as statics and static muts,
[13:36:31] <nmatsakis> we didn't have any time to write up a detailed result,
[13:36:36] <eddyb> ohh :(
[13:36:37] <nmatsakis> another thing I was hoping to do this morning.
[13:36:47] <nmatsakis> not sure if I'll get to that one or not, but I can at least get started
[13:37:04] <nmatsakis> it was helpful tho, good to be in the same place for a while
[13:37:16] <eddyb> well, at least getting the DST all detailed should speed things up a bit
[13:41:34] <eddyb> ·ïï( ·êõ )·ïó
[13:50:01] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[13:50:22] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[13:54:36] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[13:56:27] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[13:58:13] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[14:00:43] *** Quits: esummers_ (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[14:00:58] *** Quits: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net) (Quit: huon)
[14:01:20] *** Joins: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net)
[14:01:20] *** ChanServ sets mode: +o huon
[14:10:20] <cmr> huon: suggestion: keep mem/out/*.json in a separate git repo...
[14:10:50] *** Quits: eibwen (kvirc@moz-283702DC.dip0.t-ipconnect.de) (Ping timeout)
[14:14:58] <eddyb> baaah
[14:15:15] <eddyb> I can't move out of things now :(
[14:15:42] <eddyb> an array to be more specific. since ~[] patterns were killed
[14:15:48] <eddyb> I guess I can always let and clone, because it's a macro anyways
[14:20:47] *** Joins: canhtak (canhtak@moz-46C3B4C8.wl.t.ulaval.ca)
[14:24:05] <nmatsakis> eddyb: so, reading the deref PR, I had always assumed we'd insert an adjustment on *x when it's overloaded,
[14:24:14] <nmatsakis> to reflect the conversion from &T to T,
[14:24:20] <nmatsakis> but you're not doing that I guess,
[14:24:26] <eddyb> that would complicate things a bit
[14:24:30] <nmatsakis> yeah, I know,
[14:24:34] <nmatsakis> your way might be better.
[14:24:42] <eddyb> since something else can insert an adjustment on the *x expression
[14:24:47] <nmatsakis> yes, I know ;)
[14:25:07] <nmatsakis> that's why I'm saying, maybe this way is better,
[14:25:13] <nmatsakis> just having the adjustment be baked into mem_cat and trans
[14:25:24] <nmatsakis> as part of how overloaded deref is implemented
[14:25:29] <eddyb> well, I'm actually considering the expression itself to be the adjustment
[14:26:02] <eddyb> so *x is *x.deref() when overloaded, that is, I apply the deref after the optional method call
[14:26:04] <nmatsakis> iiuc, you mean that basically when you have an overloaded *, the adjustment is...just part of what happens, which is what I meant by "baked in"
[14:26:07] <nmatsakis> right
[14:26:27] <nmatsakis> I think it does work out better that way, though it goes against my usual principles
[14:26:34] <eddyb> hehe
[14:26:37] <nmatsakis> but if we ever did do more desugaring, we can of course insert the * there
[14:27:05] <eddyb> and for auto-overloaded-deref I consider an implicit autoref, I think I've mentioned this before
[14:27:25] <nmatsakis> you probably have, I'll get to that when I get there,
[14:27:30] <nmatsakis> but I was wondering what you were going to do in that case
[14:27:49] <nmatsakis> I thought we removed newtype deref
[14:27:56] <nmatsakis> oh, I see,
[14:28:01] <nmatsakis> we just check so we can report an error :)
[14:28:06] <eddyb> I removed the error message then put it back
[14:28:29] <eddyb> just because it became easier to have it when I refactored the deref logic into try_overloaded_deref
[14:28:38] <nmatsakis> ps thanks for changing from bool to the NoPreference thing, reads much nicre
[14:29:02] <eddyb> I think we should combine that stuff into "expected" and improve our type hinting
[14:29:11] <larsberg> eddyb: thanks for the ping; I'll run it by pcwalton today :-)
[14:29:30] <nmatsakis> eddyb: yeah, arguably 
[14:29:41] <nmatsakis> eddyb: it's another bit of the "push down" context basically
[14:30:05] <eddyb> mhmm. helps out with simple things, but it's not full inference
[14:30:46] <eddyb> we ought to hook coercions up to it, and a few other things. but that's completely orthogonal
[14:35:08] <nmatsakis> eddyb: yeah, I've wanted to refactor how coercions work for a while. I guess that might be worth doing pre-1.0 as I imagine it will have some affect on existing code. In particular, I wanted to base the coercions on the *declared type* of the parameter and so on
[14:35:13] <nmatsakis> I should open an issue on that
[14:35:23] <nmatsakis> basically I want to make them entirely independent of the type inferencing process
[14:35:35] <nmatsakis> so that they are more predictable and to give us more leeway in the future to make changes
[14:36:34] <eddyb> I guess DST would include all kinds of deep erasure in that process
[14:36:49] <eddyb> which might be hard to hack into the current infer::coerce
[14:37:19] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[14:37:23] <nmatsakis> eddyb: https://github.com/eddyb/rust/commit/d25fbb2159acb89aeee7f30be91262418f51e567#commitcomment-5558117
[14:37:26] <nmatsakis> :)
[14:37:34] <nmatsakis> tiny bikeshed, otherwise i'm ready to r+
[14:38:08] <eddyb> bah, I've had it like that before =))
[14:38:14] <nmatsakis> well, let me read over the tests  a bit more actually, that's usually the most imp't part and I only skimmed them
[14:38:26] <eddyb> I think *exactly* like that
[14:38:39] <eddyb> but it won't compile, because node_method_ty takes &mut self
[14:38:49] <nmatsakis> oh
[14:38:58] <nmatsakis> eddyb: in that case, can you just remove the map()
[14:39:15] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[14:39:17] <nmatsakis> i.e., map makes sense if you can avoid a match, but otherwise, it's just a bit surprising,
[14:39:20] <nmatsakis> I overlooked it for a while
[14:39:25] <eddyb> I guess that's just me being too smart with option magic
[14:39:39] <nmatsakis> (in general, I used to favor high-order functions on options quite a bit,
[14:39:42] <eddyb> I'll also rebase and see if I hit anything
[14:39:45] <nmatsakis> but when I go back to read the code I wrote then,
[14:39:57] <nmatsakis> I usuaully wish I'd just written it with matches)
[14:40:11] <nmatsakis> it's concise but I have to think hrad about what the heck it means
[14:40:20] <eddyb> that's my problem with Haskell
[14:40:42] <nmatsakis> eddyb: I'm surprising tho
[14:40:45] <nmatsakis> the &mut self thing
[14:40:50] <nmatsakis> er, I'm surprised
[14:40:55] <nmatsakis> that borrow should be limited to the call
[14:41:01] <nmatsakis> oh, I think in your earlier drafts,
[14:41:06] <nmatsakis> you returned a Method pointer or something
[14:41:11] <nmatsakis> that would have extended the borrow
[14:41:16] <eddyb> oooh, okay
[14:41:36] *** Quits: lpy (lpy@7360AA58.F09091A8.1348A864.IP) (Ping timeout)
[14:41:42] <nmatsakis> eddyb: I'm just building locally, I might suggest a few more tests
[14:41:58] <eddyb> conflicts all over the place *sigh*
[14:42:08] <nmatsakis> oh, then I have some time ;)
[14:42:19] <nmatsakis> is there a build target for just LLVM?
[14:42:32] <eddyb> make llvm? no idea
[14:43:34] <eddyb> I was confused by this... *vec is now vec.as_slice(). and will change back after DST, I guess
[14:43:48] <eddyb> &*vec because Perl
[14:43:59] *** Joins: esummers_ (esummers@moz-3B015C90.wi.res.rr.com)
[14:50:32] *** Quits: mawuli (mawuli@moz-A89BBCE.com.gh) (Ping timeout)
[14:54:22] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[14:56:28] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[15:00:02] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[15:01:26] *** Joins: edwardw (edwardw@655F78EA.BF27AFA4.B9C6B12A.IP)
[15:07:42] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[15:07:45] *** Joins: bytbox (s@moz-E1E7FAC3.washdc.fios.verizon.net)
[15:08:03] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[15:09:35] <eddyb> nmatsakis: ohh I've gotten distracted and I forgot to compile rust >_>
[15:09:45] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[15:09:55] <nmatsakis> eddyb: fyi the suggested codeI wrote compiles fine for me, modulo a tpyo
[15:19:48] <eddyb> nmatsakis: I'll see in a few minutes
[15:20:52] <eddyb> was that the only nit?
[15:22:12] <nmatsakis> eddyb: https://github.com/mozilla/rust/pull/12491#issuecomment-36635089
[15:22:53] <nmatsakis> eddyb: actually, there is something else
[15:22:58] <nmatsakis> I'd prefer to see some more targeted run-pass tests
[15:23:04] <nmatsakis> let me go write it in the PR
[15:25:09] <nmatsakis> eddyb: https://github.com/mozilla/rust/pull/12491#issuecomment-36635457
[15:25:11] <nmatsakis> make sense?
[15:26:01] <eddyb> 1 & 2, not 1 | 2, right?
[15:26:52] <nmatsakis> yes
[15:27:25] <nmatsakis> i.e., the existing test is fine, and is a good end-to-end test,
[15:27:29] <nmatsakis> but I want some more targetd unit tests
[15:27:34] <eddyb> right, gotcha
[15:27:53] <nmatsakis> (and there is no run-pass test whree DerefMut is implemented at all)
[15:30:08] <eddyb> (how did those \ get there? did I press something wrong? or did git rebase do something funky? they will show up in travis, if you don't know what I'm talking about)
[15:35:37] <nmatsakis> eddyb: not sure what you're talking about ;)
[15:35:52] <nmatsakis> eddyb: I will read the next PR tomorrow, ping me when rebased + has new tests etc
[15:36:04] <nmatsakis> eddyb: and after this let's talk about overloaded index operator ;)
[15:38:30] <eddyb> wasn't someone else working on that? though by now I should know what to do
[15:39:06] <eddyb> (i.e. it should go fast if I want to do it)
[15:40:12] <nmatsakis> eddyb: yes but the patch was incomplete, and I think your deref work clearly points the way
[15:40:19] <nmatsakis> that is, it's basically the same dang thing
[15:40:42] <nmatsakis> I'm sure wycats won't mind :)
[15:44:47] *** Joins: lpy (lpy@12172131.F09091A8.1348A864.IP)
[15:48:25] <eddyb> I think we'll have to special case all the Assign and OpAssign expressions with an ExprIndex LHS, but that's probably the hardest thing there
[15:48:37] <eddyb> nmatsakis: overloaded ExprAssign o_O
[15:48:46] <eddyb> strcat: do you mind?
[15:49:42] <nmatsakis> (does strcat mind what?)
[15:49:45] <eddyb> a[b] = c would become overloaded as a.index_assign(b, c)
[15:49:51] <nmatsakis> yes
[15:50:03] <nmatsakis> note: OpAssign is different
[15:50:21] <eddyb> nmatsakis: he's quite against overloading = *in general* and this technically has to be handled as an overloaded ExprAssign
[15:50:50] <nmatsakis> oh, I see. Well, if we support overloading index, that's what it is.
[15:50:57] <nmatsakis> we're not going to remove operator overloading.
[15:51:03] <nmatsakis> and we want Vec<T> to be usable.
[15:51:05] <kimundi> heh, now I'm imagining the hack "a[()] = c" to get overloaded assignment ;)
[15:51:20] * nmatsakis sighs
[15:51:27] <nmatsakis> people will do what people will do :)
[15:51:35] <nmatsakis> eddyb: oh, I forgot to test this case: *foo = 3
[15:51:43] <nmatsakis> eddyb: can you add a run-pass test for that too ;)
[15:51:48] <nmatsakis> hmm
[15:51:54] <nmatsakis> that needs a borrow checker tests too
[15:52:09] <edwardw> nmatsakis: I'm a little confused about rewriting `Arc` using `Atomic`. Doesn't std::sync:UnsafeArc already use AtomicUint?
[15:52:12] <eddyb> isn't it as part of the more complicated test?
[15:53:35] <nmatsakis> eddyb: probably, but it should be part of the unit tests too, i.e., they should cover every form, and also the compile-fail (I'll update my gist for the compile-fail part, already did it jsut to see what would happen)
[15:53:55] <nmatsakis> edwardw: maybe? I have to check 
[15:54:22] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[15:55:02] <edwardw> https://github.com/mozilla/rust/blob/master/src/libstd/sync/arc.rs#L40
[15:55:23] <nmatsakis> eddyb: (updated gist)
[15:55:28] <edwardw> ans sync::Arc, RwArc, etc. all use std::sync::UnsafeArc
[15:55:51] <nmatsakis> edwardw: ok, that's great, maybe nothing to be done there
[15:55:51] <edwardw> and*
[15:56:04] <edwardw> nmatsakis: gotcha
[15:56:28] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[15:57:10] <nmatsakis> eddyb: so I think that a[b] += 3 can be separately implemented, probably, but it would be transltaed to somtehing like `let tmp = &mut a[b]; *tmp += 3`
[15:57:23] <nmatsakis> at present we do not support overloading on the += forms
[15:57:27] <nmatsakis> but not for any good reason
[15:57:38] *** Joins: mrmonday (mrmonday@moz-C7DC1A73.lin.openzula.org)
[15:59:01] <edwardw> nmatsakis: unless you want `*mut ArcData<T>` gone and use `*RefCell<ArcData<T>>` instead
[15:59:05] *** Quits: mrmonday (mrmonday@moz-C7DC1A73.lin.openzula.org) (Quit: Reconnecting)
[15:59:09] *** Joins: mrmonday (mrmonday@moz-C7DC1A73.lin.openzula.org)
[16:01:47] <eddyb> nmatsakis: btw, impl<T> IndexAssign<T, ()> for Vec<T> {fn index_assign(&mut self, val: T) {self.push(val)}} ... v[] = x;
[16:02:11] <eddyb> I came up with that yesterday or two days ago - it's basically a PHP push :P
[16:02:32] <eddyb> kimundi: ^
[16:03:23] <kimundi> eddyb: You know I said that as a joke, right? ;)
[16:03:36] <eddyb> it has its uses
[16:03:37] <nmatsakis> edwardw: that doesn't quite sound right, no
[16:03:47] <edwardw> k
[16:04:11] <nmatsakis> edwardw: for one thing, RefCell isn't threadsafe :)
[16:04:19] <edwardw> I see
[16:04:37] <eddyb> remember when I said atomic RefCell isn't RWLock?
[16:04:37] <nmatsakis> eddyb: one nice benefit of coherence is that if we don't implement such a monstrosity, nobody else can :)
[16:04:50] <nmatsakis> eddyb: just, but I still don't agree
[16:04:57] <nmatsakis> er, *yes
[16:05:18] <nmatsakis> but were you going to add something else? :)
[16:05:55] <eddyb> right now the distinction seems relevant. though I doubt anyone wants to add anything RefCell-like to arcs
[16:06:52] <edwardw> RefCell isn't just about mutability ?
[16:06:54] <nmatsakis> I'm not sure I follow. edwardw and I were tlaking about internal impl details of arc, in any case.
[16:07:34] <nmatsakis> edwardw: RefCell is about enabling mutability, but it uses flags to track how you borrow it,
[16:07:40] <nmatsakis> and those flags are not maintained in a threadsafe way
[16:07:48] <nmatsakis> therefore, it cannot be shared across tsaks (the type system prevents you)
[16:08:44] <nmatsakis> the cross-thread equivalent (imo) is an RwLock
[16:08:44] <jdm> wow, I really wasn't kidding about the addition of glob imports fixing build errors
[16:08:44] <edwardw> but what if RefCell manages something that is threadsafe? RefCell just adds mutability to that thing
[16:08:44] <jdm> I just tried removing a glob import in a file
[16:08:44] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Connection reset by peer)
[16:08:46] <jdm> and I get build errors in another file
[16:08:50] <edwardw> `ArcData` in this case has a AtomicUint in it
[16:08:52] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[16:08:52] <jdm> resolve errors, that is
[16:09:00] <jdm> pointing at a totally different file
[16:09:09] <jdm> this is totally obtuse
[16:09:27] <nmatsakis> edwardw: RefCell doesn't just "add mutability"
[16:09:30] <nmatsakis> it also adds tracking
[16:09:34] <nmatsakis> and that tracking is not threadsafe
[16:09:49] <nmatsakis> so if you want to share it across threads, you need RwLock
[16:09:55] <nmatsakis> which does threadsafe tracking, at greater cost
[16:10:07] <edwardw> ah, I see
[16:10:15] <nmatsakis> (the tracking is to ensure that, e.g., you are not borrowing something as mutable and imm at the same time)
[16:10:24] <eddyb> Cell adds zero-cost mutability for Pods
[16:10:40] <eddyb> the Ref in RefCell indicates that it counts the number of borrows
[16:10:41] <nmatsakis> edwardw: in an analogous way, there is `Cell`, which doesn't do any tracking, but also isn't threadsafe, because it doesn't guarantee atomicity
[16:10:44] <fredy> Hello, I was wondering if there is any news/idea about keeping or not the structural enum variants (those that are enabled by attribute #[feature(struct_variant)]. Thanks
[16:10:46] <nmatsakis> and Atomic<>, the thread-safe version of cell
[16:10:49] <nmatsakis> edwardw: ^
[16:11:03] <edwardw> makes perfect sense
[16:11:08] <eddyb> fredy: if we fix all the bugs, we'll remove the feature gate, I think
[16:11:25] <nmatsakis> fredy: it's not a high priority, essentially. I think we probably plan to keep them 
[16:11:31] * nmatsakis shrugs
[16:11:32] <edwardw> so there seems nothing to be done about Arc family, they already use AtomicUint
[16:11:39] <nmatsakis> edwardw: ok great
[16:11:52] <edwardw> (through std::sync::UnsafeArc)
[16:11:53] <fredy> thanks eddyb and nmatsakis
[16:12:20] <eddyb> fredy: I know someone just fixed one or two bugs. if you want you can hunt for more, write tests, etc.
[16:13:05] <wycats> I don't mind if someone takes it over although I'll be sad I couldn't level up
[16:13:18] <eddyb> aww
[16:13:35] <fredy> eddyb: tbh I want to use them for a library :)
[16:13:45] <nmatsakis> wycats: I think we'll be keeping you plenty busy
[16:13:49] <fredy> s/for/in
[16:13:58] <eddyb> fredy: turn the feature on for that library report every small problem you find ;)
[16:14:28] <fredy> ;)
[16:14:46] <wycats> Yep
[16:17:53] <eddyb> fredy: I think there's a similar situation with a few of the other features that are gates
[16:18:24] <eddyb> I know glob imports don't work correctly in some cases, but those might not come back for other reasons
[16:20:52] <fredy> I see
[16:24:31] <eddyb> nmatsakis: thanks for the review and the tests, btw, this is better than I could've done myself :)
[16:25:07] <eddyb> nmatsakis: aaand I think you found a bug
[16:25:48] <nmatsakis> eddyb: oh?
[16:25:54] <eddyb> &mut **x
[16:26:05] <nmatsakis> I thought it worked like I expected? 
[16:26:06] <eddyb> I don't propagate the preference through derefs, fixing that now
[16:26:39] <nmatsakis> (or did it fail to execute like expected?)
[16:26:59] <eddyb> my implementation lacked a small detail
[16:30:52] *** Joins: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP)
[16:31:00] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[16:33:10] <strcat> can we merge https://github.com/mozilla/rust/pull/12520 ? everyone seems to agree that it's an improvement (whether or not it's the eventual solution)
[16:33:28] <strcat> meh I might have broken the tests
[16:33:30] <strcat> yeah
[16:33:34] * strcat sighs
[16:34:10] <strcat> it was working before I had to rebase several times...
[16:34:45] <eddyb> hehe did pcwalton's ~[T] -> Vec<T> interfere?
[16:35:01] <strcat> only a bit
[16:35:08] <eddyb> also, this is ridiculous. firefox, go home, you're drunk
[16:36:46] <eddyb> nmatsakis: I can't give you a direct link right now, look for "UnDeref" in typeck/check/mod.rs
[16:36:55] <eddyb> time: 475.719 s translation
[16:37:21] <flaper87> strcat: do you have any feedback for http://github.com/mozilla/rust/issues/7762 ?
[16:37:22] <eddyb> actually, I should've just restarted the thing, since now I have enough RAM =))
[16:37:26] <flaper87> tbh, I've no idea how to check that
[16:37:28] <flaper87> :)
[16:38:22] <eddyb> nmatsakis: this https://github.com/mozilla/rust/pull/12491/files#diff-31c6a728eb925b9f6b0124e93948d270L2681
[16:38:51] <nmatsakis> eddyb: right, I just realized what you meant 
[16:38:55] <nmatsakis> +1 for tests
[16:39:05] <nmatsakis> I actually didn't read that propagation carefully 
[16:39:07] <eddyb> I still have to add the counting one
[16:39:18] <eddyb> nmatsakis: bah, am I that confusing?
[16:39:32] <nmatsakis> you're not confusing, I just didn't think to check it :)
[16:39:50] <eddyb> utterly indecipherable eddyb. make a meme out of me
[16:40:54] *** Joins: sunfish (chatzilla@moz-42DA0C69.dsl.dynamic.sonic.net)
[16:41:04] *** Quits: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[16:43:40] *** Quits: lpy (lpy@12172131.F09091A8.1348A864.IP) (Ping timeout)
[16:46:07] <eddyb> this might be very good (I know I read some interesting things from that blog, like GCC disproving Fermat IIRC) http://blog.regehr.org/archives/1109
[16:47:31] <eddyb> strcat: ^ maybe related to our checked_*?
[16:48:07] *** Quits: Kxepal (Miranda@moz-363D0201.pppoe.mtu-net.ru) (Ping timeout)
[16:51:28] <eddyb> "First, it works on a DAG of instructions instead of a linear sequence" hehe that's what I did in wiREd
[16:52:31] *** Joins: Kxepal (Miranda@moz-510CB007.pppoe.mtu-net.ru)
[16:54:39] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[16:56:30] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[16:56:47] <eddyb> nmatsakis: and I'm an idiot. of course
[16:57:17] <nmatsakis> eddyb: ?
[16:57:29] <eddyb> nmatsakis: I guess it's hard to spot
[16:57:36] <eddyb> instead of doing propagation, I made everything mutable
[17:00:21] *** Joins: brson (brson@F16146EB.9D3722BB.58DC3EE6.IP)
[17:00:21] *** ChanServ sets mode: +qo brson brson
[17:02:13] <eddyb> I wonder if we do this right in our RWLock http://blog.regehr.org/archives/1097
[17:04:05] <eddyb> strcat: oh I know you'd like this http://blog.regehr.org/archives/1088
[17:04:31] *** Joins: dherman (dherman@F16146EB.9D3722BB.58DC3EE6.IP)
[17:04:31] *** ChanServ sets mode: +ao dherman dherman
[17:06:10] *** Joins: pcwalton (pcwalton@F16146EB.9D3722BB.58DC3EE6.IP)
[17:06:10] *** ChanServ sets mode: +ao pcwalton pcwalton
[17:08:08] *** Joins: nrc (nrc@F16146EB.9D3722BB.58DC3EE6.IP)
[17:09:53] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[17:10:14] <eddyb> nmatsakis: we're down to one mismatched error... *x = 3; causes "error: cannot borrow immutable argument `x` as mutable"
[17:11:05] <eddyb> because the deref_mut call is a borrow itself
[17:15:02] *** Joins: pnkfelix (pnkfelix@F16146EB.9D3722BB.58DC3EE6.IP)
[17:16:53] <eddyb> nmatsakis: should I change the expected error message?
[17:19:30] <nmatsakis> eddyb: probably; I was wondering if we want to put in some effort detecting and reporting better errors for overloaded deref, but I think it's a seperate PR
[17:19:49] <eddyb> probably need to overhaul mc
[17:20:44] <eddyb> "cannot borrow immutable local for overloaded mutable dereference" or something like that
[17:21:00] <nmatsakis> well, I'm not sure I'd say overhaul, but we'd need to carry a bit more info
[17:21:21] <nmatsakis> eddyb: on a call, so i'll not be resopnding for a bit 
[17:21:24] <eddyb> np
[17:22:43] * strcat is happy about Vec<T>
[17:23:02] <strcat> rust crushes the C++ stdlib in a comparison against std::vector<T> now ;)
[17:23:11] *** Quits: edwardw (edwardw@655F78EA.BF27AFA4.B9C6B12A.IP) (Ping timeout)
[17:23:21] <eddyb> strcat: \o/
[17:23:38] *** Joins: edwardw (edwardw@B5386878.16F55560.50B134B9.IP)
[17:24:03] <eddyb> can't wait until we have [[[T]]] - finally a T[][][] that actually works :P
[17:24:27] <eddyb> I guess std::array<T> is our DST [T]?
[17:24:44] <eddyb> or is that dynarray? can it be nested?
[17:27:53] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[17:28:22] <kimundi> eddyb: Hm, would that allow N-dimensional slices?
[17:29:07] <eddyb> yupp, there's no reason not to allow it, AFAIK
[17:29:24] <kimundi> just need to compiler magic to calculate the offsets I assume
[17:29:51] <eddyb> that will be based on dynamic sizes
[17:30:18] <kimundi> You mean something like (*T, size1, size2, size3...), irght?
[17:30:33] <kimundi> as representation of it?
[17:30:41] <eddyb> yupp, and the compiler will know the size of the inner arrays as an expression of those dynamic values
[17:30:52] <kimundi> yeah
[17:30:55] <eddyb> [(u8, [u8])] emulates PNG image data + filters
[17:31:31] <eddyb> so the dynamic size of the inner type will be width + 1, and that will be used when indexing the outer type
[17:31:37] <kimundi> You'd have the problem that slices of that no longer cover a continuous memory area though
[17:31:48] <eddyb> huh?
[17:32:05] <eddyb> it's a C style T[W][H][D]
[17:32:20] <eddyb> there's no indirection, it's all contiguous
[17:32:42] <kimundi> I mean taking a subslice of that
[17:32:58] <eddyb> [z][y][x]
[17:33:11] <kimundi> thats indexing, not slicing
[17:33:27] <eddyb> &array[z] would be slicing
[17:33:45] <eddyb> just pointing out it's the same order as in those C matrices and there's no spacing between elements
[17:34:05] <kimundi> Maybe we'Re talking about different things
[17:34:23] <eddyb> oh, like .slice(a, b)?
[17:34:25] <kimundi> yes
[17:34:28] <kimundi> that
[17:34:32] <eddyb> you can't do on the inner types
[17:34:42] <eddyb> you need fortran-like views in the library for those
[17:34:49] <kimundi> That was what I meant with N-dimensional slices
[17:35:02] <eddyb> riiight. only the outer one would be a slice, sorry
[17:35:36] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[17:35:43] <kimundi> (fortran-like being?)
[17:36:13] <eddyb> kimundi: their built-in multidimensional arrays include sizes, offsets and strides for all dimensions. I think those are the right terms, anyways
[17:36:20] <eddyb> maybe s/stride/step
[17:37:21] <eddyb> so you can take like an interlacing subset of a 2D pixel matrix, and use that as if it were a contiguous matrix
[17:38:07] <kimundi> nice
[17:43:47] *** Joins: jensnock_ (jensnocker@moz-C4B24C3.customers.ownit.se)
[17:45:58] *** Joins: jensnoc__ (jensnocker@moz-33279404.customers.ownit.se)
[17:46:22] *** Quits: jensnock_ (jensnocker@moz-C4B24C3.customers.ownit.se) (Ping timeout)
[17:47:00] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[17:47:34] *** Quits: jensnoc__ (jensnocker@moz-33279404.customers.ownit.se) (Input/output error)
[17:52:47] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[17:53:12] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[17:54:27] <eddyb> nmatsakis: finally finished writing that test :P. r? https://github.com/mozilla/rust/pull/12491
[17:56:20] <nmatsakis> eddyb: ok will check soon
[17:56:20] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[17:57:05] <eddyb> I'll rebase & add that one extra testcase for autoderef when we're done with this PR
[17:57:24] <eddyb> I guess I have to copy the counting test for autoderef as well. but the cases are more limited there, I think
[17:57:32] *** Joins: geoffhill (geoffhill@moz-95FF7399.members.linode.com)
[18:01:03] *** Quits: sunfish (chatzilla@moz-42DA0C69.dsl.dynamic.sonic.net) (Ping timeout)
[18:03:37] *** Joins: ecr (chatzilla@moz-B9C0B7F6.dhcp4.washington.edu)
[18:14:08] <nmatsakis> eddyb: regarding (*x).foo() -- in the follow up patch this will not always prefer mut? or is that unchanged because `*` is explicit?
[18:14:34] <eddyb> unchanged
[18:14:52] <eddyb> and without a lookup rewrite, can't make x.foo() use immutable either
[18:24:23] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[18:24:55] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[18:27:04] <nmatsakis> eddyb: ok. In the explicit case, I'm not sure what's right. we can play with this. I've been implementing a prototype of revised trait / method lookup algorithm. anyway, gotta go for a bit, I'll review and (almost certainly...) r+ soon
[18:30:47] *** Quits: ecr (chatzilla@moz-B9C0B7F6.dhcp4.washington.edu) (Ping timeout)
[18:31:36] *** Joins: ecr (chatzilla@moz-B9C0B7F6.dhcp4.washington.edu)
[18:36:44] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[18:38:57] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[18:41:55] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[18:42:52] *** Joins: sunfish (chatzilla@moz-BBE3ABD.mv.mozilla.com)
[19:14:14] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[19:16:04] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[19:18:21] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Connection reset by peer)
[19:18:41] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[19:18:48] <eddyb> I've been staring at this for a while...
[19:19:14] *** Quits: pnkfelix (pnkfelix@F16146EB.9D3722BB.58DC3EE6.IP) (Ping timeout)
[19:19:24] <eddyb> aaah, this is what was changed `*args.get(0)`. I have to publicly complain to see the clue
[19:19:45] <cmr> eddyb: you should consider acquiring a rubber-duck proxy.
[19:19:56] <eddyb> cmr: is that a thing?
[19:20:04] <cmr> well if you don't have a rubber duck :P
[19:20:26] <eddyb> pcmattman: turns out I didn't have to acquire my monologue reputation o_O
[19:20:30] <cmr> I just babble to myself like a psycho.
[19:20:49] <eddyb> people around me think I'm crazy enough. if I lived alone, sure
[19:21:04] <eddyb> Teflon pain on all the walls
[19:21:15] <eddyb> box o' markers
[19:21:29] <eddyb> black light for secret formulas :P
[19:22:15] <eddyb> cmr: hang on... this is actually the first time I considered using teflon-based paint as a whiteboard "coating" for an entire apartment
[19:22:37] <eddyb> I... I might have to try that. once I get my own place. if I make it that far, that is
[19:22:40] <cmr> the hallways in the dorms of my college are all dry-erase.
[19:23:11] <eddyb> hmm. is it oil-based? I guess those could also work
[19:24:20] <eddyb> "Thinking inside the box is underrated, you just need a box larger on the inside"
[19:24:39] <cmr> I do not know.
[19:24:58] <cmr> I think it's some sort of coating, though, not just the paint.
[19:25:06] <cmr> all I know is that it's hella convenient.
[19:25:09] <eddyb> :D
[19:26:43] <Eridius> eddyb: just think inside the tardis
[19:27:48] <edwardw> what does "llvm module passes" do?
[19:27:57] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[19:28:32] <strcat> edwardw: optimizations
[19:28:40] <edwardw> k
[19:29:42] <eddyb> edwardw: those optimizations that need a graph of function interdependencies and whatnot
[19:30:19] <edwardw> eddyb: oh, not just micro-optimizations inside function? that's cool
[19:30:44] <eddyb> SROA, meet edwardw
[19:30:54] <edwardw> and no wonder it takes a long time
[19:31:33] <eddyb> edwardw.i.sroa.0.0.copyload, meet SROA
[19:31:36] <eddyb> OOPS
[19:31:55] <edwardw> \o/ what's that?
[19:32:17] <edwardw> Scalar Replacement of Aggregates, hmm...
[19:33:31] <eddyb> de-structuralization, basically
[19:33:58] <edwardw> k
[19:36:55] <strcat> edwardw: it takes a long time because of the way the library code is written
[19:37:18] <strcat> same reason including a little usage of some boost libraries adds a huge amount of time to C++ builds
[19:37:39] <pcwalton> it takes a lot of time because Rust uses structs a lot
[19:37:59] <cmr> module passes?
[19:38:10] <strcat> pcwalton: brson found there was a noticeable improvement just from removing wrappers around the intrinsics
[19:38:18] <strcat> but we wrap things in little functions *all over*
[19:38:26] <cmr> strcat: did you see the graph of stage2 size?
[19:38:26] * strcat shrugs
[19:38:55] *** Quits: japaric (japaric@8D66AA8D.A8462175.F29ED47E.IP) (Ping timeout)
[19:39:05] <eddyb> pcwalton: I hope I can make a lot of things use first-class aggregates
[19:39:16] <pcwalton> does clang?
[19:39:29] <pcwalton> also beware that first class aggregates cause LLVM to fall off fastisel
[19:39:31] <pcwalton> unless things have changed
[19:39:33] <strcat> pcwalton: they pass anything under 2 words directly on x86_64
[19:39:42] <eddyb> clang moves struct constants outside of functions even
[19:39:53] <strcat> pcwalton: they do all their code differently though
[19:39:57] *** Quits: ecr (chatzilla@moz-B9C0B7F6.dhcp4.washington.edu) (Ping timeout)
[19:39:58] <cmr> http://i.imgur.com/AjKgxVe.png
[19:39:59] <strcat> they don't initialize structs the same way, etc.
[19:40:02] <eddyb> but not our kind of immutable let constants
[19:40:18] <pcwalton> clang doesn't do everything differently from rustc, come on
[19:40:22] <eddyb> strcat: trans::adt could perfectly output LLVM aggregates values, no?
[19:40:32] <strcat> pcwalton: not everything
[19:40:34] <eddyb> *aggregate
[19:40:37] <strcat> but they do structs much differently
[19:40:45] <strcat> they output SSA form stuff at -O0
[19:41:03] <eddyb> pcwalton: SROA does FCA which is *{...} to {...}. so I guess it should work
[19:41:24] <strcat> pcwalton: for example, clang will initialize a large struct by making a constant and doing memcpy
[19:41:34] <eddyb> I mean, we'd be giving semi-pre-optimized code to LLVM, that can't be bad
[19:41:35] <pcwalton> yes, we should do that
[19:41:39] <strcat> small structs are done with SSA
[19:41:44] <pcwalton> eddyb: just make sure we don't break debuginfo
[19:41:48] <strcat> we do both with alloca + store
[19:41:57] <strcat> (well, and GEP)
[19:42:01] <eddyb> pcwalton: those kind of optimizations are disabled with debuginfo just for that reason
[19:42:13] <strcat> pcwalton: you can put debuginfo on registers since ~2011
[19:42:26] <pcwalton> I'm just saying what sabre told me
[19:42:30] *** Joins: dmsky (dmsky@moz-63A2E3E4.pppoe.spdop.ru)
[19:42:31] <eddyb> strcat: but I don't want to be the one overhauling debuginfo
[19:42:44] <eddyb> so I just put if debuginfo around my code
[19:43:06] *** Quits: pauls (pauls@moz-BFEF1F22.ccs.neu.edu) (Quit: Ignore me!!)
[19:43:44] <eddyb> !debuginfo even
[19:43:49] *** Joins: japaric (japaric@87E5C324.64CFB2BA.F29ED47E.IP)
[19:44:05] <pcwalton> also make sure you don't fall off fastisel
[19:44:13] <pcwalton> first class aggregates can be bad for that reason
[19:44:23] <edwardw> strcat: c++ template (adding to the compile time), I suppose?
[19:44:37] <eddyb> pcwalton: aaah, fast instruction selection. I couldn't read that the first time
[19:44:39] <strcat> edwardw: generics aren't really a problem
[19:44:42] <strcat> the problem is layers of functions
[19:44:59] <strcat> they can't be eliminated early due to debugging
[19:45:18] <edwardw> k
[19:45:18] <strcat> otherwise LLVM could just collapse pass-through calls in the IR builder
[19:45:21] <eddyb> and some identity-like functions produce 20 lines of IR
[19:45:33] <eddyb> with landing pads and whatnot
[19:45:42] <pcwalton> which ones? transmute?
[19:45:47] <pcwalton> I have a proposal to change rust intrinsics
[19:45:59] <eddyb> transmute only does that because it is identity
[19:46:01] <strcat> pcwalton: transmute itself is a problem but I don't think the other wrappers are widely used
[19:46:15] <eddyb> fn foo(x: ~str) -> ~str {x} will generate IR bloat
[19:46:20] <strcat> pcwalton: imo intrinsics should show up as normal functions in the docs and should have the same type as rust fns
[19:46:23] <strcat> then we don't need wrappers
[19:46:38] <pcwalton> my proposal was to make intrinsics not real first class functions
[19:46:50] <eddyb> so calls to them are inlined?
[19:46:54] <strcat> pcwalton: I fixed that issue for most already
[19:47:04] <strcat> pcwalton: the ones that used to wrap LLVM intrinsics now pass-through
[19:47:04] <pcwalton> and then just generate their code inline
[19:47:04] <pcwalton> yes
[19:47:04] <pcwalton> this also means that typeck can perform extra checks on them
[19:47:19] <eddyb> I already that for take glue
[19:47:27] <pcwalton> for example, typeck should be able to report "transmute called on types of different size"
[19:47:29] <strcat> pcwalton: for example the floating point intrinsics don't generate functions anymore
[19:47:30] <eddyb> and it increased memory usage a tiny bit on the irsy graph
[19:47:47] <strcat> pcwalton: 'unsafe as'
[19:47:51] <eddyb> pcwalton: that means setting up the LLVM context early, though
[19:47:55] <pcwalton> let's just do it for transmute
[19:48:04] <pcwalton> err
[19:48:06] <pcwalton> for all intrinsics
[19:48:11] <pcwalton> I see no reason why they should be first class functions
[19:48:18] <strcat> pcwalton: well the ones wrapping LLVM wrappers don't need it
[19:48:22] <strcat> er
[19:48:25] <strcat> s/wrappers/intrinsics/
[19:48:35] <strcat> pcwalton: from an API perspective, we're going to expose most as functions
[19:48:35] <eddyb> I don't think you can get the size of the type without a LLVM context
[19:48:47] <cmr> eddyb: We already know the size of all types though don't we?
[19:48:54] <eddyb> from where?
[19:48:55] <cmr> Because we're emitting it all.
[19:48:56] <pcwalton> creating an LLVM context in typeck shouldn't be a problem?
[19:49:13] <pcwalton> we'll need it if we want sizeof in constants anyway due to const eval
[19:49:28] <eddyb> myeah
[19:49:37] <eddyb> early const eval is even a better use of LLVM
[19:50:22] <eddyb> pcwalton: my solution for the transmute problem is trait SameSizeAs<T> {}
[19:50:39] <pcwalton> yes, but I think it's possibly overkill
[19:50:42] <eddyb> that can't be directly implemented, and bounds are statisfied by querying for the type
[19:50:52] <pcwalton> I don't think transmute gets called in generic contexts
[19:50:54] <eddyb> pcwalton: could need it for some transmute wrappers. do we have any?
[19:50:58] <pcwalton> if it is, then that program is arguably broken
[19:51:27] <eddyb> you can transmute &T => &U when sizeof T != sizeof U so it should be fine
[19:52:38] *** Quits: pcwalton (pcwalton@F16146EB.9D3722BB.58DC3EE6.IP) (Ping timeout)
[19:53:00] <eddyb> I was just going to complain that pcwalton added .borrow() calls
[19:56:26] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Quit: Ï†Ñ Ïù¥Îßå Í∞ëÎãàÎã§.)
[19:57:38] <eddyb> nmatsakis: I've rebased https://github.com/mozilla/rust/pull/12610
[19:57:59] <eddyb> the first patch builds in travis, feel free to r+
[19:58:06] <eddyb> s/patch/PR
[20:00:34] *** Quits: geoffhill (geoffhill@moz-95FF7399.members.linode.com) (Input/output error)
[20:01:46] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[20:01:46] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/MSd4oQ
[20:01:46] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[20:01:49] *** Joins: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP)
[20:01:49] <ghrust> [13rust] 15bors pushed 3 new commits to 06auto: 02http://git.io/0mvC9Q
[20:01:49] <ghrust> 13rust/06auto 14fd09e91 15Adrien T√©tar: rustdoc: tweak highlighting
[20:01:49] <ghrust> 13rust/06auto 140106a04 15Adrien T√©tar: doc: use the newer favicon
[20:01:49] <ghrust> 13rust/06auto 14a15448c 15bors: auto merge of #12649 : adrientetar/rust/highlight, r=alexcrichton...
[20:01:51] *** Parts: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP) ()
[20:07:18] <kimundi> r? https://github.com/mozilla/rust/pull/12667
[20:10:23] <cmr> kimundi: typo, raw.rs line 32, build-in => built-in
[20:10:29] <cmr> abi => ABI
[20:10:53] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[20:10:54] <cmr> otherwise, r=me
[20:10:57] *** Quits: nrc (nrc@F16146EB.9D3722BB.58DC3EE6.IP) (Ping timeout)
[20:11:07] <kimundi> Eh. better typos than bugs I guess
[20:11:48] <kimundi> cmr: wher eis the abi => ABI line?
[20:11:52] <kimundi> where is*
[20:11:53] <cmr> same docblock.
[20:11:57] <cmr> few lines down
[20:12:01] <cmr> (sorry for lack of gh comments ;()
[20:12:12] <kimundi> Ah, silly me
[20:12:40] <kimundi> cmr: Updated
[20:13:25] *** Joins: ecr (chatzilla@moz-5A94AC46.dhcp4.washington.edu)
[20:14:41] <eddyb> nmatsakis: ohh, so Freeze would refer to immediate storage?
[20:15:20] <eddyb> (reading your comments on some issue, I think the Share one)
[20:15:45] <eddyb> nmatsakis: that makes it useful for determining whether the storage can be immutable, like rodata or SSA values
[20:16:03] *** Quits: edwardw (edwardw@B5386878.16F55560.50B134B9.IP) (Quit: Leaving...)
[20:17:26] <kimundi> cmr: (I don'T actually have review power, so you'll have to do that r=cmr yourself ;))
[20:18:05] <cmr> oh I thougth you did, my bad
[20:19:23] <kimundi> I really should sign a commiter agreement already - (which I guess is prerequiste to be considered for that?)
[20:19:39] <cmr> yes
[20:19:40] * kimundi just needs to figure out where/how to do that
[20:19:46] <bstrie> has anyone floated the idea of moving all the libsploded libs into an extra/ subdirectory? it's getting really busy in src/
[20:20:03] <eddyb> I've already had to do it for google, but their require the CLA for the smallest of patches, so it's different
[20:20:05] <cmr> https://www.mozilla.org/hacking/notification/
[20:20:12] <kimundi> bstrie: Eh, end result would just be a busy extra dir
[20:20:19] <eddyb> bstrie: or lib/foo instead of src/libfoo
[20:21:06] <kimundi> cmr: Thanks! Always was to lazy to look for that myself ;)
[20:21:32] * eddyb reads https://www.mozilla.org/hacking/committer/
[20:21:49] <bstrie> kimundi: I'm trying to show someone around the rust compiler but it's hard to navigate with all this junk in the way :P
[20:22:53] <eddyb> kimundi: it looks like you have to open an issue or something first... which is weird :/
[20:23:04] <eddyb> cmr, kimundi: wait, that's SVN/Hg, not github
[20:23:11] <cmr> unrelated.
[20:23:21] <cmr> you open a bug on their bugzilla.
[20:23:21] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[20:23:36] <eddyb> okay, so that still applies
[20:23:43] <bstrie> kimundi: like, I have no idea if libsync is extra or part of the runtime. or what the heck libsemver is used for. or what the heck libflate and libfourcc even are
[20:23:59] <eddyb> "Armitage" now I can't remember where I've seen that name before
[20:24:23] <eddyb> bstrie: flate is a tiny binding to a zlib clone I think
[20:24:37] <eddyb> bstrie: semver is semantic versioning, fourcc is a simple syntax extension
[20:24:45] <eddyb> bstrie: really, the compiler is libsyntax + librustc
[20:24:57] <bstrie> eddyb: ...and libnative/libgreen?
[20:25:20] <bstrie> and if so, then surely librustuv by extension
[20:25:32] <cmr> no, those aren't part of the compiler.
[20:25:40] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[20:25:54] <eddyb> bstrie: that's just runtime stuff
[20:26:44] <eddyb> cmr: I know half these words "Sign it using S/MIME with a certificate for your email address which chains to a root trusted by Thunderbird;"
[20:27:51] <eddyb> for now I can do more harm that good with commit access, so I won't rush into requests
[20:30:02] <eddyb> nmatsakis: second PR is green in travis :D
[20:30:07] <eddyb> snapshot tomorrow pls
[20:30:38] <cmr> eddyb: need me to r=nikomatsakis something? they're at lunch.
[20:31:09] <eddyb> oh, right, west coast. it's almost 11pm here :/
[20:31:20] <eddyb> cmr: not yet, I don't think he finished reviewing
[20:38:54] <aatch> eddyb, so this is overloadable deref?!
[20:39:42] <eddyb> aatch: Rc::new(Rc::new(Rc::new(Rc::new(Rc::new(RefCell::new(~"foo")))))).borrow_mut().push_str("bar")
[20:40:01] <eddyb> we don't have enough pointers to showcase the magic in another way
[20:40:30] <aatch> eddyb, and the borrow_mut is a call on the RefCell, right?
[20:40:36] <eddyb> yupp
[20:40:42] <aatch> Noice.
[20:40:42] <eddyb> which returns a structure, not a pointer
[20:40:45] <cmr> eddyb: this doesn't do anything through *T, right?
[20:40:53] <cmr> (where T impls Deref/DerefMut)
[20:41:11] <eddyb> nope, only explicit derefs can go through *T
[20:41:24] <eddyb> it's the same situation as today, just overloaded
[20:42:37] <aatch> eddyb, could this theoretically be used to intercept calls?
[20:42:37] <cmr> tests for that plz
[20:43:07] <eddyb> aatch: not really
[20:43:15] <eddyb> if you mean operator()
[20:44:16] <aatch> I mean method calls, so if I call `.foo()` on something implements Deref, I assume that if that something has a foo method, it would get called instead of the result of the deref?
[20:44:21] <eddyb> cmr: not sure why nmatsakis didn't think of that. I'll guess I'll do it anyways. thanks for saying it before I rebuilt rustc on the other branch :P
[20:45:58] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[20:47:04] <bstrie> that's a good question. if A<B> implements Deref and Foo and B also implements Foo, does a.foo() call the method on A or B?
[20:47:42] <eddyb> it calls the first one it reaches during autoderef
[20:47:47] <eddyb> so A
[20:47:58] <bstrie> ok
[20:48:00] <eddyb> (*a).foo() to call the one on B
[20:48:03] <bstrie> makes sense to me
[20:48:15] <eddyb> same for fields
[20:51:43] <eddyb> cmr: I'm stupid
[20:51:54] <eddyb> cmr: I was going to add a test to the explicit overloaded deref PR
[20:51:58] <cmr> eddyb: also you don't update the manual.
[20:52:00] <cmr> you need to do that.
[20:52:30] <eddyb> but the test applies only to autoderef
[20:52:57] <eddyb> cmr: I have no idea how to do that. isn't it ridiculously outdated or something?
[20:53:04] <cmr> it's really not that bad...
[20:53:05] <eddyb> I guess I'm on the right branch, might as well try
[20:53:08] *** Quits: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP) (Connection reset by peer)
[20:53:38] *** Joins: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP)
[21:00:09] *** Joins: nrc (nrc@F16146EB.9D3722BB.58DC3EE6.IP)
[21:01:07] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[21:01:54] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[21:02:23] *** Joins: ecr_ (chatzilla@moz-10C88DA7.dyn.cs.washington.edu)
[21:02:31] *** Quits: ecr (chatzilla@moz-5A94AC46.dhcp4.washington.edu) (Ping timeout)
[21:02:32] *** ecr_ is now known as ecr
[21:11:20] <eddyb> cmr: ohh, it's not bad :D
[21:11:31] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[21:11:47] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[21:11:47] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/0mvC9Q
[21:11:47] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[21:12:17] <eddyb> "### Unary operator expressions" I think I can copy something from other overloadable operators
[21:16:41] *** Joins: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP)
[21:16:41] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/EpkMaw
[21:16:41] *** Parts: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP) ()
[21:16:42] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[21:16:42] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/LAgZXg
[21:16:42] <ghrust> 13rust/06auto 143158047 15Marvin L√∂bel: Cleaned up `std::any`...
[21:16:42] <ghrust> 13rust/06auto 140a5138c 15bors: auto merge of #12667 : Kimundi/rust/any_improv, r=cmr...
[21:16:43] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[21:19:24] <eddyb> cmr, nmatsakis: https://github.com/mozilla/rust/pull/show/12491/files/5b95312#diff-5b9531258e65a8733242b78f81019edd
[21:19:34] <eddyb> the markdown diff is horrendous
[21:20:01] <eddyb> (we must be using something different than github's dialect)
[21:20:01] *** flaper87 is now known as flaper87|afk
[21:30:53] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[21:33:03] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[21:33:41] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[21:53:17] <eddyb> cmr: are you busy? I was curious how bad my initial attempt is
[21:54:28] *** Joins: pcwalton (pcwalton@F16146EB.9D3722BB.58DC3EE6.IP)
[21:54:28] *** ChanServ sets mode: +ao pcwalton pcwalton
[21:58:12] *** Quits: brson (brson@F16146EB.9D3722BB.58DC3EE6.IP) (Quit: leaving)
[21:58:30] *** Joins: brson (brson@4A08E125.708C0A12.C7EEF3A2.IP)
[21:58:30] *** ChanServ sets mode: +qo brson brson
[22:01:16] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[22:09:00] *** Quits: Yurumechan (23f9939a@B2F514.E4420F21.EEF52F3A.IP) (Ping timeout)
[22:09:04] *** Joins: notmatt_ (notmatt@D6017980.16225D44.47C41102.IP)
[22:09:13] *** Joins: gwty (gwtypc@AA4A5C9C.9ABB23D7.137C914F.IP)
[22:09:55] <cmr> eddyb: can both Deref and DerefMut be applicable? How does it decide?
[22:10:01] <cmr> other than that niggling issue, looks good.
[22:10:15] <eddyb> it tries DerefMut first
[22:10:31] <eddyb> if it's preferred
[22:10:32] <cmr> don't tell me, tell rust.md :P
[22:10:44] <eddyb> riight. time to expand that to fifty paragraphs
[22:11:01] <cmr> I have an exam and need to eat, so I won't be back for ~3 hours.
[22:11:17] <eddyb> I hope nmatsakis gets back before I go to sleep
[22:11:23] <huon> cmr: good luck
[22:11:48] <cmr> it's simple numeric proofs using direct proof, induction, and strong induction.
[22:11:52] * cmr not worried
[22:12:08] <eddyb> induction? that was 3 years ago
[22:12:16] <eddyb> I wonder what strong induction and direct proof are
[22:12:24] *** Quits: notmatt_ (notmatt@D6017980.16225D44.47C41102.IP) (Ping timeout)
[22:12:37] <cmr> strong induction is induction, but instead of assuming it for one case, assuming it for many.
[22:12:41] <cmr> (they're equivalent)
[22:12:47] <cmr> direct proof is just using definitions etc.
[22:12:57] <eddyb> so strong induction is induction<T> :P?
[22:13:02] <cmr> I don't like this class because it assumes the standard laws of algebra etc etc, when doing proofs.
[22:13:03] <huon> induction is just using definitions
[22:13:19] <eddyb> forall is more mathematical, I guess
[22:13:23] *** Quits: gwty (gwtypc@AA4A5C9C.9ABB23D7.137C914F.IP) (Ping timeout)
[22:13:30] <huon> surely those standard laws (i.e. the axioms) are just part of your definitions?
[22:13:40] <cmr> no :(
[22:13:49] <cmr> at least not in the class.
[22:14:04] <cmr> The mathematical logic book I've had for years builds up logic starting from sets + languages, which IMO is superior.
[22:14:27] <cmr> but it's a math course for all CS students, shouldn't be surprised that it's not very rigorous.
[22:15:05] <eddyb> this reminds me of how I didn't like the early geometry with no concept of absolute coordinates and trigonometry. I don't know the actual (english) terms for any of these, so I can't expand in detail
[22:15:31] <eddyb> but I sometimes take a middle school geometry problem from my younger brother, and solve it using systems of equations
[22:15:37] <eddyb> and it's just *so simple*
[22:16:03] <eddyb> compared to constructs that have no head no tail, recursive definitions, loads of axioms etc.
[22:16:13] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[22:16:29] <cmr> #rust-offtopic :P
[22:16:37] * cmr apologizes for starting it
[22:17:49] *** Joins: gwty (gwtypc@A78A9C.66B0FE5F.2E2F6049.IP)
[22:20:04] <eddyb> if implemented by the type and required for an outer expression that will or could mutate the dereference
[22:20:20] <eddyb> cmr, huon, nmatsakis: ^^ is that wording meaningful?
[22:20:33] <eddyb> (the reason why DerefMut would be picked)
[22:20:54] <eddyb> maybe I should add "e.g. an assignment"
[22:21:39] *** Joins: Yurumechan (23f9939a@B2F514.E4420F21.EEF52F3A.IP)
[22:22:26] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[22:26:41] *** Joins: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP)
[22:26:41] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/LAgZXg
[22:26:41] *** Parts: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP) ()
[22:29:45] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[22:38:53] *** Joins: eibwen (kvirc@moz-7F98B089.dip0.t-ipconnect.de)
[22:39:02] <ecr> eddyb: geometry + coordinates would be 'algebraic geometry' in english
[22:39:35] <eddyb> ecr: thanks, that's reasonable. so what are the non-algebraic geometries?
[22:39:54] <eddyb> just so I know what I hate :P
[22:40:27] <ecr> hm, i'm not sure if there's a name for that. let me check.
[22:41:02] <erickt> hey #rust-internals, is there anyone on here that's planning on going to the doc sprint next weekend and hasn't signed up yet? http://www.meetup.com/Rust-Bay-Area/events/168366122/
[22:41:15] <erickt> we only have 6 signed up so far
[22:42:07] <jensnockert> I would like to join remotely.
[22:42:15] <cmr> As would I.
[22:42:35] <erickt> awesome
[22:42:45] * cmr didn't realize remote was a possibility.
[22:42:52] <cmr> Should have announced that at the last meetup!
[22:42:53] <erickt> you will miss out on the free pizza though
[22:42:54] * sfackler joined
[22:43:11] <erickt> cmr: I thought I mentioned that
[22:43:11] <ecr> eddyb: I think what you hate is 'axiomatic geometry'. Euclidean geometry is an example of an axiomatic geometry.
[22:43:15] <cmr> some things transcend free food.
[22:43:27] <jensnockert> Yeah, pizza is overrated.
[22:44:07] <eddyb> ecr: right, I did mention axioms. thanks again :)
[22:44:33] <eddyb> cmr: mmm transcendence
[22:44:34] <erickt> jensnockert: I'm horribly offended by that statement
[22:44:36] <huon> erickt: I'm interested in remote too (but can't guarantee my attendance)
[22:44:47] * jensnockert hugs erickt, I still love you.
[22:44:49] <ecr> eddyb: no problem :) now back to reading about copatterns (co- all the things...)
[22:44:54] <erickt> geeze, it's like you all are spread around the world or somethign
[22:45:28] <erickt> can't you all hop in your private jets and come to SF?
[22:45:33] <eddyb> pfffft
[22:45:41] * eddyb looks at his empty wallet
[22:45:51] * huon nominates erickt for arranging & paying for flights, accommodation and visa for all of us to SF
[22:45:52] <eddyb> now who's offended?
[22:45:57] <eddyb> huon: I know, right?
[22:45:58] *** Quits: glaebhoerl (glaebhoerl@moz-B5B88D72.catv.broadband.hu) (Quit: )
[22:46:05] <ecr> on a grad student stipend? hahahahaha
[22:46:27] <eddyb> ecr, cmr: I still haven't figured out why "transcedental computing" isn't at thing anywhere. I mean, come on wikipedia...
[22:46:37] <cmr> What even is transcendental computing?
[22:46:43] <ecr> eddyb: what would that mean?
[22:46:51] <eddyb> hacking the matrix?
[22:46:58] *** Quits: dherman (dherman@F16146EB.9D3722BB.58DC3EE6.IP) (Quit: dherman)
[22:47:03] <eddyb> in very serious, symulation hypothesis scenario
[22:47:13] <erickt> hrm. we need to figure out how to turn rust into a multi-billion dollar enterprise so we can afford to do some in-person documentation sprints
[22:47:15] <ecr> oh
[22:47:29] <cmr> erickt: let's invest in teleportation.
[22:47:31] <ecr> sounds like something the Singularity folks might be into
[22:47:58] <eddyb> scripting in games can be considered to transcend the simulated world
[22:48:10] <eddyb> ecr: as in, Sing#?
[22:48:14] <erickt> `cmr.teleport(&Location::SF::Mozilla_HQ);`
[22:48:22] <eddyb> erickt: that makes me so sad
[22:48:28] <jdm> how can I convert an extern fn to a *u8 without using cast::transmute?
[22:48:31] <ecr> eddyb: the "humans and machines will become one" people
[22:48:36] <cmr> jdm: you don't.
[22:48:40] <huon> jdm: cast::transmute
[22:48:42] <jdm> that answer does not please me.
[22:48:46] <jdm> I'm using static values.
[22:48:50] <jdm> ie. can't call methods
[22:48:56] <huon> :(
[22:49:15] <eddyb> erickt: reminds me of the times when I was away from my gf and I used to say that followed by "it doesn't work"
[22:49:37] <ecr> why can't we call methods on static values?
[22:49:50] <cmr> because we don't have ctfe.
[22:49:57] <cmr> transmute is a function though.
[22:50:17] <cmr> but it's an intrinsic and it definitely should be considered valid in constant expressions.
[22:50:18] <ecr> wait, is this global-static of &'static ?
[22:50:18] <huon> i think jdm meant "can't call functions/methods to initialise CTFE", rather than calling things on the values themselves at runtime
[22:50:28] <eddyb> ecr: derp, taking matrix literally. symulation hypothesis isn't quite that
[22:50:35] <ecr> huon, oh that makes much more sense
[22:50:39] <jdm> correct
[22:50:50] <eddyb> ecr: more like we live in a block game of another universe :P
[22:50:58] <jdm> I was hoping that &fn_name as *fn_type as *u8 would work
[22:51:05] <jdm> but it screws me when trying to call it
[22:51:08] <eddyb> our redstone must suck compared to *their* computing power
[22:51:14] <cmr> jdm: you still have a pointer toa  function pointer.
[22:51:19] <cmr> extern fn() is already pointer-sized
[22:51:19] <huon> s/to initialise CTFE/to initialise statics/
[22:51:21] <cmr> because it's a pointer.
[22:51:24] <erickt> eddyb: we'll just have to get nmatsakis to implement teleportation after he does DST
[22:51:25] *** Joins: geoffhill (geoffhill@moz-95FF7399.members.linode.com)
[22:51:27] <jdm> friggity frig
[22:51:29] <eddyb> ecr: quantum computing could be transcedental, we don't know
[22:51:34] <jdm> spidermonkey fills me with rage sometimes
[22:51:50] <ecr> eddyb: you might like this then: http://www.randomhouse.com/kvpa/lloyd/
[22:51:55] <cmr> eddyb: given that it can be simulated on classical computers, surely not.
[22:52:16] <eddyb> cmr: but not with the same efficiency
[22:52:37] <eddyb> ecr: like, we still don't understand quantum entanglement and that in and of itself could be... I don't know, an identity dupe bug in the simulator
[22:53:07] <eddyb> imagine what would happen if you made two entities in minecraft share the same UUID
[22:53:31] <eddyb> but somehow be at different locations
[22:53:41] <eddyb> or more lower level, pointer aliasing
[22:54:20] <eddyb> ecr: DELICIOUS is what I can say. thanks for the link :D
[22:54:37] <ecr> eddyb: also this - https://en.wikipedia.org/wiki/Simulation_hypothesis#Testing_the_hypothesis
[22:54:57] <eddyb> was that added since the last time I read the page?
[22:55:12] <ecr> I wouldn't know
[22:55:32] <eddyb> you know, 3 am wikipedia surfing things I can't understand
[22:55:41] <ecr> but I need to stop IRCing and read this paper
[22:55:59] <eddyb> 2012... yeah, might be newer than my last read
[22:56:57] <eddyb> does that say "if our universe is blocky enough, it might be a simulation"?
[22:57:13] <cmr> they published a paper
[22:57:16] <cmr> it was on slashdot
[22:57:33] <eddyb> cmr: but if I subscribe to that, I'll never get anything done
[22:57:47] <eddyb> http://arxiv.org/pdf/1210.1847v2.pdf the name sounds familiar
[22:57:58] <eddyb> s/name/title
[22:59:53] <eddyb> cmr: wait, this? http://beta.slashdot.org/submission/3342819/is-our-universe-a-simulation
[23:00:15] <cmr> nah
[23:00:16] <cmr> older
[23:00:20] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[23:00:26] <kimundi> eddyb: Hm, I just had an idea about how Deref could enable interesting patterns with RAII stuff
[23:01:12] <cmr> that one is more neal stephenson anathem stuff
[23:01:17] <eddyb> cmr: so the recent posts start from http://www.nytimes.com/2014/02/16/opinion/sunday/is-the-universe-a-simulation.html
[23:02:19] *** Quits: geoffhill (geoffhill@moz-95FF7399.members.linode.com) (Ping timeout)
[23:02:30] <cmr> http://science.slashdot.org/story/12/10/13/1434223/physicists-devise-test-for-whether-the-universe-is-a-simulation
[23:02:40] <eddyb> cmr: I give up trying to find it. right now I wish I had some feedback on the doc stuff
[23:02:42] <eddyb> ah nvm thanks :D
[23:03:08] <cmr> what you pasted berfore sounded fine.
[23:03:35] <eddyb> >:D<
[23:03:52] <eddyb> cmr: I'm curious how did you know what nmatsakis was doing
[23:04:10] <eddyb> impl Deref<nmatsakis> for cmr
[23:04:16] <eddyb> spy proxy!
[23:04:30] <eddyb> kimundi: do tell
[23:06:35] <eddyb> http://science.slashdot.org/comments.pl?sid=3183323&cid=41644711 teehee - this thread is full of these
[23:07:38] <kimundi> assuming you have a value "foo" that allows you to get a lock with something like "foo.lock()", said lock unlocks on destruction and allows you to get references to a value like "let l = foo.lock(); ... l.borrow()". Then if you make both the lock and the foo impl both variants of Deref, you could fluidly decide between "let l = foo.lock(); let r = l.borrow(); r.bar()", "let l = foo.lock(); let r = l.bar()" and "let l = foo.bar()"
[23:08:44] <kimundi> "let l = foo.lock(); let r = l.borrow(); r.bar();", "let l = foo.lock(); l.bar();" and "let l = foo.bar();", that is
[23:08:44] <eddyb> the last one requires the fancy Deref traits
[23:08:50] <eddyb> that we don't have
[23:09:03] <kimundi> eddyb: what do you mean?
[23:09:07] <kimundi> arg, still an error
[23:09:17] <kimundi> "let l = foo.lock(); let r = l.borrow(); r.bar();", "let l = foo.lock(); l.bar();" and "foo.bar();"
[23:09:21] <eddyb> you need to return a non-reference from the first deref
[23:09:25] <kimundi> just calling bar() at the last one
[23:09:28] <eddyb> i.e. the lock
[23:09:49] <eddyb> and then you deref the temporary lock
[23:09:57] <eddyb> my implementation doesn't allow that
[23:10:10] <kimundi> Ah, right Deref is only for references
[23:10:22] <kimundi> I somehow keep forgetting that :P
[23:10:25] <eddyb> and the first version is too verbose, there most likely won't be a borrow method
[23:10:31] <eddyb> just like I removed Rc's borrow method
[23:10:51] <eddyb> kimundi: nmatsakis agreed that we might want something fancy like that, but not for RefCell and not immediately
[23:11:02] <kimundi> eddyb: Well, you'll be able to call the method of the Deref trait manually, right?
[23:11:11] <kimundi> (Ignoring wether you'D actually want that)
[23:11:12] <eddyb> sure, but why would you
[23:11:31] <eddyb> - but yes, it plays nicely with RAII, RefCell is the first example of that
[23:12:01] <eddyb> what you can do now is let x = foo.lock().bar();
[23:12:14] <kimundi> yup
[23:12:15] <eddyb> it locks, calls bar and unlocks
[23:12:23] <eddyb> which is pretty nice IMO
[23:12:36] <cmr> at the end of the scope...
[23:12:41] <eddyb> cmr: nope
[23:12:56] <cmr> why wouldn't it?
[23:13:04] <eddyb> let me demonstrate
[23:13:09] <kimundi> eddyb: Basically, I was thinking how one could extend my lazy init stuff (https://gist.github.com/Kimundi/8782487) for mutable statics
[23:13:45] <kimundi> that automatically lock/unlock the variable on access through a Deref trait
[23:13:51] <kimundi> -impl
[23:14:16] <eddyb> that sounds hard. maybe needs the extra functionality with non-borrowed-ref-return-types?
[23:14:21] <kimundi> Actually... I think I don'T even need the fance deref for that
[23:14:49] <eddyb> rusti: use std::cell::RefCell; let cell = RefCell::new(5); *cell.borrow_mut().get() = 4; let x = *cell.borrow().get(); *cell.borrow_mut().get() = 2; let y = *cell.borrow().get(); (x, y)
[23:14:50] -rusti- (4, 2)
[23:15:08] <eddyb> cmr: if it would be kept alive till the end of the scope, the above code example would fail at runtime ^^
[23:15:35] <cmr> hm, is this because of the rvalue lifetime changes?
[23:15:44] <eddyb> it was shorter before
[23:15:50] <kimundi> My code basically generates a custom unit-like type with custom Deref and DerefMut impls. If I make it lock on call to borrow(), and unlock in the destructor it could work as is
[23:15:52] <cmr> right.
[23:16:01] <cmr> that wouldn't have been allowed before, is my point.
[23:16:07] <eddyb> kimundi: why not lock in constructor?
[23:16:14] <eddyb> kimundi: derp, unit, I get it
[23:16:20] <eddyb> interesting design
[23:16:47] <eddyb> cmr: oh yeah
[23:17:07] *** Quits: carter (carter@moz-58F59B3A.members.linode.com) (Quit: ZNC - http://znc.in)
[23:17:37] *** Joins: carter (carter@moz-58F59B3A.members.linode.com)
[23:19:04] *** Quits: dmsky (dmsky@moz-63A2E3E4.pppoe.spdop.ru) (Input/output error)
[23:34:34] *** Quits: gwty (gwtypc@A78A9C.66B0FE5F.2E2F6049.IP) (Ping timeout)
[23:35:36] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[23:37:18] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[23:52:29] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[23:52:50] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[23:54:32] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[23:56:39] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[23:56:39] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/a8f6iA
[23:56:39] <ghrust> 13rust/06auto 144d8295d 15Daniel Micay: make `MutItems` iterator sound again...
[23:56:39] <ghrust> 13rust/06auto 14fe50c75 15bors: auto merge of #12694 : thestinger/rust/mut_iter, r=huonw...
[23:56:40] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[23:57:11] *** Quits: blank_name (blank_name@463DB555.53526368.6D228269.IP) (Quit: leaving)
