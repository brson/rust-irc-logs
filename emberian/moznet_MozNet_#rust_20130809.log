[00:00:03] <aatch> tiffany, but copying the elements over should optimize down to a memcpy, or something similar.
[00:00:05] <strcat> or one ~[T] and a &[T]
[00:00:12] <graydon> tjc: I believe the servo developers were very insistent on this property
[00:00:15] <tjc> graydon: Sure, all I'm saying is that it's under control of the user
[00:00:55] <strcat> aatch: in theory it does
[00:01:05] <strcat> but I don't think loop-idiom matches that loop
[00:01:21] <strcat> it doesn't like the order
[00:01:41] *** Quits: huseby (huseby@19BD73A1.5D8BCA3A.A0C1B52F.IP) (Quit: Leaving)
[00:01:42] <aatch> strcat, well yes, but still, I think we only really loose out on SSE-variants for memcpy
[00:01:44] <graydon> tjc: indeed. I think the flexibility is important, but so is picking a default that has "used too much disk space" as a failure mode, rather than "mysterious interference between projects"
[00:02:03] <strcat> aatch: memcpy is always more efficient than manual movs
[00:02:20] <cmr> graydon: Where would there be mysterious interference? Package name + version should always be the same yeah?
[00:02:30] <strcat> it will either use rep movsb or SSE/AVX
[00:02:31] <aatch> I think that having rustpkg search for a meta directory the same way git does would work.
[00:02:36] <strcat> the kernel memcpy uses movsb
[00:02:38] <tjc> graydon: yeah
[00:02:53] <aatch> strcat, 'movsb'?
[00:03:17] <cmr> aatch: x86's repeated "move a byte"
[00:03:27] <cmr> well
[00:03:30] <cmr> eh
[00:03:39] <cmr> it's basically a memcpy instruction :p
[00:03:47] <strcat> yes
[00:04:05] <tiffany> what does "cannot move out of dereference of & pointer" mean?
[00:04:06] <strcat> movsb is usually best, but people like to think they can outsmart it
[00:04:19] <strcat> the linux kernel uses movsb and glibc uses sse2/sse3
[00:04:22] <graydon> cmr: it would be if someone hacked up a local copy of a lib and "installed" it, and didn't change the version number. which happens all the time.
[00:04:32] <strcat> the kernel one is faster in almost every case.
[00:04:35] <cmr> tiffany: it means you tried to take ownership of a value that is behind a borrowed reference.
[00:04:52] <strcat> especially if the memory is 64-byte aligned
[00:05:05] <strcat> (and btw, if you want to do large reads/writes, etc. - 64-byte align it)
[00:05:08] <cmr> graydon: yeah, I suppose
[00:05:20] <aatch> Ahh, so movs[bwd] does a move from one memory location to another.
[00:06:03] <aatch> Meaning, I assume, that the CPU can take advantage of not needing to load into a register first.
[00:06:06] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Ping timeout)
[00:06:36] <strcat> aatch: well, rep movsb is super-optimized in microcode
[00:06:39] <graydon> cmr: I mean, I'm not trying to make stuff up; I'm just relating the exact scenario the servo devs who insisted on this behavior were relating. they hack up a local copy in workspace A, they build it, while building they switch to workspace B to pursue another bug, they do not want interference in workspace B
[00:06:42] <strcat> it has a bunch of special cases + good fallback
[00:06:56] <strcat> if you 64-byte align the memory, it can copy in 64-byte chunks
[00:07:14] <aatch> strcat, that works too.
[00:07:59] <strcat> there's an lkml post with linus yelling at someone for wanting to use SSE/AVX instead like glibc does
[00:08:06] * strcat can't find it though :(
[00:08:20] <cmr> the kernel also has the obligation of saving and restoring registers all over the place
[00:08:32] <strcat> yes it would have to save/restore state if it used SSE/AVX
[00:08:33] <cmr> having to keep track of sse/avx state too would be bad
[00:08:41] <aatch> I guess the only extra advantage is for the code generator, since it has more registers to play with.
[00:08:43] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Client exited)
[00:09:04] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[00:09:19] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[00:09:22] <cmr> graydon: I would *assume* that developers know how to use rustpkg and that they would have a local rustpkg root for each workspace
[00:09:52] <cmr> graydon: I'm envisioning the case of "I want to use this thing written in rust, my package manager doesn't handle it natively, how can I install its dependencies"
[00:09:55] <strcat> oh well, working intrinsics for overflow checked sub/mul/add compiling down to the x86 overflow jumps
[00:10:03] <cmr> In which case a more wider-scoped default is desirable
[00:10:19] <strcat> I forgot to do i8
[00:10:21] <strcat> and u8
[00:10:32] *** Joins: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP)
[00:10:34] <graydon> cmr: in that case a --user and --global option can easily override the default. this is a "do least harm" argument.
[00:10:44] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Ping timeout)
[00:10:44] <cmr> graydon: yeah
[00:11:40] <graydon> cmr: the argument made here is that node's approach, while disk-space-consumptive, does the least harm when version-info is not properly captured.
[00:11:45] <graydon> er, npm's
[00:11:47] <cmr> graydon: Yes, I agree.
[00:11:54] <cmr> npm's behavior is the best for j random user
[00:12:10] <ecr> brson, graydon: implemented homing for the rest of UDP. passes all existing (non-homing) tests. only necessary change outside of uvio.rs was a temporary renaming in rtio.rs to use HomedUvUdpWatcher (which will disappear later of course). In other words, we've done a pretty good job separating high level IO (rt::io) from low level implementation (rt::uv).
[00:12:25] *** Joins: Jesin (Jessin_@moz-157A63DD.cc.lehigh.edu)
[00:12:31] <graydon> \o/
[00:12:36] *** Quits: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP) (Ping timeout)
[00:13:04] <graydon> cmr: particularly casual use. everyone knows how to delete a scratch directory they're just playing in.
[00:13:04] <aatch> That reminds me, having rustpkg play nice with package managers would be cool. Obviously I'm not suggesting that rustpkg support every package manager, but having a way to specify things like "I do have that installed, just not in via rustpkg", would be nice.
[00:13:21] <cmr> 0grayup
[00:13:23] <cmr> erm
[00:13:24] <graydon> "uninstall" from a shared thing has much less reliable track record
[00:13:25] <cmr> graydon: yup
[00:13:39] <graydon> aatch: yeah, that's on the list. it should be able to at least check.
[00:13:43] <cmr> aatch: also pkg-config support
[00:13:52] <strcat> well I think ideally it would generate a package
[00:13:55] * cmr hates it when something doesn't play well with pkg-config
[00:14:00] <strcat> since it won't force the system pkg manager to keep the dep otherwise
[00:14:01] <cmr> Then again
[00:14:06] <cmr> pkg-config doesn't make sense at all for rust
[00:14:08] <bblum> why am i getting an unused unsafe block error on stage 1 but not stage 0?
[00:14:08] <cmr> so nevermind
[00:14:09] <bblum> anybody?
[00:14:14] <bblum> i am using a static mut
[00:14:18] <bblum> and inside a macro definition
[00:14:20] <bblum> but i can't reproduce it
[00:14:32] <graydon> ecr: am I to read this as you getting UDP "threadsafe"?
[00:14:38] <sp3d> cmr: it makes sense for rust libs usable from C, though, so it maybe shouldn't be completely disregarded
[00:14:57] <ecr> graydon: yes, but I still need to test it to make sure.
[00:15:00] *** Quits: peterdn (chatzilla@moz-97742234.new.ox.ac.uk) (Ping timeout)
[00:15:07] <graydon> nice
[00:15:53] <tiffany> how do you make a function which does operations on a ~ vec?
[00:15:53] <ecr> graydon: the general idea is that each libuv handle has a 'home' scheduler and whenever you try to IO on that handle it will go back to it's home scheduler first. (this is all blocking IO so you're only doing one IO action at a time)
[00:16:09] *** Quits: tcr_ (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[00:16:13] <cmr> tiffany: &mut ~[T]
[00:16:16] <graydon> ecr: yeah, I remember discussing all this back when we were sketching out the design in the spring, just checkin'
[00:16:27] <cmr> tiffany: to avoid transfering ownership and having to return it again
[00:17:48] <ecr> graydon: hopefully we can transfer handles between event loops someday and get actual work stealing for IO.
[00:18:04] <graydon> someday maybe. for now this is fine.
[00:20:11] *** Quits: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[00:20:46] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Quit: WeeChat 0.4.2-dev)
[00:22:27] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Ping timeout)
[00:24:32] <brson> toddaaro: i compared your message passing bench to oldsched and the results were bad! presumably it's because of these low-hanging fruits (string functions were at the top of the profile), but yikes
[00:25:12] *** Quits: graydon (graydon@moz-F14EE0DB.cable.teksavvy.com) (Quit: Leaving.)
[00:25:37] <cmr> brson: oldsched is bad or newsched is bad?
[00:26:53] *** Quits: rustyPipe (Mibbit@moz-5949C51B.dllstx.fios.verizon.net) (Quit: http://www.mibbit.com ajax IRC Client)
[00:26:53] *** Quits: tchoma (tchoma@moz-E58E29CC.dsl.static.sonic.net) (Quit: tchoma)
[00:27:03] <tjc> Is anyone here an expert on std::run?
[00:27:24] <strcat> tjc: nope, but I know of a few problems with it ;p
[00:27:30] <toddaaro> brson: what does oldsched get for message passing?
[00:27:32] <strcat> (like if exec fails, it loops forever)
[00:27:33] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[00:27:34] <tjc> strcat: heh, well, I think I just found one more
[00:27:37] <bblum> is anyone here on unused unsafe blocks inside macro definitions
[00:27:38] <strcat> s/loops/waits/
[00:27:39] <bblum> sighhhhh
[00:27:40] <tjc> strcat: ooh I know about the looping forever
[00:27:42] <tjc> I mean, I've seen it
[00:27:43] <toddaaro> brson: I was about to find an oldrt checkout to do that
[00:27:47] <tjc> but I found another problem, I think
[00:27:51] <tjc> wanted to make sure it really was
[00:27:53] <strcat> tjc: it's because it doesn't make a pipe to the child (that issue)
[00:28:07] <strcat> so if the child fails exec, it doesn't have a way to let the parent know
[00:28:12] <tjc> strcat: what I just found is that when you pass in an environment, on Mac it doesn't actually seem to overwrite the existing environment
[00:28:14] <tjc> rather, it extends it
[00:28:21] <strcat> tjc: ah
[00:28:21] <tjc> on Linux, it overwrites, which seems to be correct as per the comment
[00:28:35] *** Quits: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com) (Quit: pcwalton)
[00:28:38] <tjc> the actual C++ code that does this is rather cryptic
[00:28:40] <strcat> I don't think that one is reported
[00:28:45] <ecr> brson: your email about switching to newrt is #4 on HN and #6 on r/programming (which has another rust article at #8)
[00:28:46] <tjc> so I'm not sure if I'm write
[00:28:48] <tjc> right
[00:28:54] <brson> toddaaro: RUST_OLDRT will turn it back on
[00:28:57] <brson> RUST_OLDRT=1
[00:29:14] <toddaaro> brson: oh really? what is that nuke the c++ PR then?
[00:29:18] <sully> tjc: hm, so, I'm looking at https://github.com/mozilla/rust/issues/3121
[00:29:23] <brson> toddaaro: hasn't landed yet
[00:29:25] <sully> tjc: do you remember what about your fix did not work?
[00:29:28] <toddaaro> brson: ah
[00:29:54] <tjc> sully: if I recall correctly, it was pretty obvious...
[00:29:56] <strcat> tjc: I think it should be using posix_spawn
[00:29:56] <tjc> other tests failed
[00:30:03] <strcat> tjc: rather than fork/exec
[00:30:05] <strcat> much simpler
[00:30:08] <strcat> don't know if OS X has it yet...
[00:30:23] <brson> cmr: newsched is bad
[00:30:27] <brson> but don't be alarmed
[00:30:30] <strcat> OS X is actually missing some POSIX things from the earlier standards and yet has certification >.<
[00:30:33] <tjc> sully: if all tests pass with my patch, by all means, check it in :P
[00:31:37] <brson> ecr: oh nice I didn't see the r/programming thread
[00:31:44] <brson> it's my 15 min
[00:31:52] <strcat> tjc: http://pubs.opengroup.org/onlinepubs/9699919799/functions/posix_spawn.html
[00:31:59] <brson> aw, no commentary on r/prog
[00:32:05] <tjc> strcat: I'll note that in the bug I'm about to file :-)
[00:32:05] <strcat> I really wouldn't be surprised if OS X was missing it.
[00:32:26] <tjc> brson: not getting Reddit comments is like not getting parking tickets :P
[00:32:35] <cmr> seriously..
[00:33:11] <brson> lol
[00:33:36] <toddaaro> so true
[00:34:09] <strcat> tjc: I like how a listed design goal in the spec is "
[00:34:11] <strcat> They should be able to replace at least 50% of typical executions of fork().
[00:34:17] <strcat> better not try too hard and aim for 60%
[00:34:34] *** Quits: bent (chatzilla@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: ChatZilla 0.9.90.1-rdmsoft [XULRunner 22.0/20130619132145])
[00:34:38] <tjc> strcat: I assume there was a lengthy committee meeting that resulted in the 50% number :-)
[00:34:49] <cmr> maybe even two of them!
[00:34:53] <tjc> probably involving fisticuffs
[00:34:56] <cmr> that's the kind of thing you can bikeshed for ages about
[00:35:04] <brson> toddaaro: oh interesting the gap between oldrt and newrt is very different based on the value of 'm'
[00:35:20] <toddaaro> ahh whew
[00:35:23] <strcat> all specifications should be developed through trial by combat
[00:35:46] <tjc> yes
[00:35:48] <brson> https://gist.github.com/brson/6190189
[00:35:57] <tjc> actually, monkey knife fights would be preferable
[00:36:24] <strcat> I think the monkeys writing these specs might object
[00:37:13] <cmr> The only spec I've read that didn't make me want to gouge my eyes out was the ES spec
[00:37:31] <strcat> POSIX is actually documented well ;p
[00:37:38] <cmr> although most of the RFCs aren't bad
[00:37:46] <strcat> but that's probably because they standardize the lowest common denominator and leave a lot undefined
[00:38:00] <brson> profile basically looks like expected https://gist.github.com/brson/6190210
[00:38:03] <strcat> need to close an fd cross-platform? you're out of luck, EINTR behaviour is unspecified.
[00:38:06] *** Joins: erickt (etryzelaar@49C4075F.3AC15C18.2321E71E.IP)
[00:38:08] <toddaaro> brson: what are you trying? the m is "pairs of ping-pongers", goal being "enough so all the cores work but that is about it"
[00:38:15] *** Quits: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com) (Quit: ecr)
[00:38:16] <brson> too many allocations and strings concats
[00:38:40] <strcat> brson: if it makes you feel better, those are going to get a lot faster ;p
[00:38:45] <strcat> vec/str has a ton of low-hanging fruit
[00:38:46] <brson> toddaaro: I tried "100000 10" (which was awful) and "100000 5" (which was reasonable)
[00:39:01] <toddaaro> brson: how many cores/real cores do you have?
[00:39:09] <brson> toddaaro: 4/8
[00:39:17] <cmr> I think you mean 8/4 :p
[00:39:38] <bblum> ??????????????????????????????
[00:39:45] <brson> strcat: most of the stuff at the top of this profile is just extra work that shouldn't be happening
[00:39:50] <bblum> i put #[allow(unused_unsafe)] and it STILL gave me the unused unsafe error
[00:39:53] <bblum> can anybody help me :( :(
[00:39:59] <cmr> bblum: ignore it?
[00:40:00] <strcat> brson: is it just debug printing or something?
[00:40:05] <bblum> cmr: it's an error. fat chance.
[00:40:12] *** Joins: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com)
[00:40:12] <cmr> oh
[00:40:23] *** Quits: brianm (brianm@moz-9B7D279E.dsl.static.sonic.net) (Quit: Leaving...)
[00:40:30] <sp3d> bblum: do you have a ; after the #[]? idk if that matters or not
[00:40:33] <brson> strcat: str stuff is bogus debug work, yeah
[00:40:36] <bblum> sp3d: yes
[00:40:58] <cmr> why are you doing benchmarks with debug on ;\
[00:41:20] <toddaaro> strcat: yea, the rtdebug! macro has to cope with inputs so they are "used" in some way, and the original design did "let _ = blah" for each, but one day suddenly that didn't work inexplicably with no way to identify which of the 200 rtdebug uses was at fault
[00:41:26] <toddaaro> so now it actually builds and formats the string
[00:41:35] *** Joins: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net)
[00:41:37] <toddaaro> it is terrible and I think I'll focus on that tomorrow
[00:43:16] <brson> toddaaro: so you think it's not a big deal when i'm overcommitting tasks? i'd expect the performance to scale just fine (as long as the scheduler isn't doing silly things)
[00:43:29] <toddaaro> brson: are you running these on the ws pr code? I'm getting newrt as pretty fast compared to oldrt
[00:43:41] <brson> toddaaro: yeah, this is on your branch
[00:43:45] <toddaaro> weird
[00:43:48] <brson> what input are you using?
[00:44:01] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Connection reset by peer)
[00:44:11] <toddaaro> brson: I've found that n=1000000 m=8 gives the fanciest numbers, which on newrt is around 11s
[00:44:21] <jack> how does include! work? i keep getting error: opening src/foo
[00:44:24] <jack> but src/foo is there.
[00:44:26] *** Joins: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca)
[00:44:37] <toddaaro> brson: and on oldrt I get ~12s
[00:44:46] *** Quits: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net) (Quit: ozten)
[00:44:46] <strcat> jack: I think it uses the current working directory :(
[00:44:53] *** Quits: echristo (echristo@DCF57675.D6CCE4AE.77834EAA.IP) (Quit: echristo)
[00:44:59] <strcat> you probably don't want to use them
[00:45:01] *** Quits: gavinb (gavinb@moz-CA19A0CF.vic.adsl.internode.on.net) (Ping timeout)
[00:45:12] <jack> strcat: so it's next to the source file that includes it
[00:45:16] <jack> i'm running rustc one dir up
[00:45:23] <toddaaro> brson: there should be some slowdown as m gets bigger, as the "clean pingpong" gets interrupted generating more reschedule operations and more cross-core stealing
[00:45:24] <jack> but it didn't work when the file to include was one dir up either.
[00:45:25] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[00:45:29] <strcat> hm
[00:45:31] * strcat has no idea then
[00:45:50] <toddaaro> brson: (messages is m*n*2, so there is that linear component)
[00:45:54] *** Joins: gavinb (gavinb@moz-CA19A0CF.vic.adsl.internode.on.net)
[00:46:05] <toddaaro> brson: a solid goal is linear speedup with m
[00:46:07] <brson> toddaaro: with your numbers I get 9 s for oldsched and 21 for newsched!
[00:46:16] <toddaaro> whoa
[00:46:24] *** Quits: jdm (jdm@9FB21CB6.76DE1AD5.AE2B2F80.IP) (Quit: Lost terminal)
[00:46:26] <toddaaro> can you check your kernel clocksource?
[00:46:44] <toddaaro> I'll have to remember what that command is
[00:46:50] <cmr> cat /sys/devices/system/clocksource/clocksource0/current_clocksource
[00:46:57] <toddaaro> cmr: thanks
[00:47:06] <cmr> trusty ctrl-r
[00:47:49] <toddaaro> brson: well, you profiled the code, so you would have noticed if this was a problem. On my notebook VM I had the clocksource doing ~45% of execution time on newrt
[00:48:10] <brson> my clocksource is tsc
[00:48:16] <toddaaro> ok, that should be good
[00:48:26] <toddaaro> you are native linux on that thinkpad x1 right?
[00:49:17] <brson> yeah
[00:49:40] <toddaaro> I wonder, seems like a stretch, is memory bandwidth bad on that thing?
[00:49:42] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[00:50:05] <toddaaro> my machine is the triple-channel ddr3 that is overclocked somewhat
[00:50:16] <toddaaro> and those notebooks are sometimes single-channel
[00:50:29] <cmr> When I'm doing cleaning in a few minutes I'll also run the benchmark; which is it, how are you compiling it, and how do I pass the arguments to it?
[00:50:40] <toddaaro> I'm very skeptical that would do it, but it is one of the few major differences I can think of between our machines
[00:50:47] <toddaaro> cmr: "make check-stage1-bench"
[00:50:50] <brson> toddaaro: the ws implementation is faster than the shared queue on master at least
[00:51:17] <toddaaro> cmr: and then the bench is in x8.../test/bench/rt-mes*.stage1*
[00:51:30] <strcat> can macros generate an item with #[cfg(not(stage0))] on it?
[00:51:34] <strcat> or does that count as 2 items
[00:51:38] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[00:51:42] <toddaaro> cmr: the first input is this "n", number of messages to pingpong for each of "m" pairs, m being the second argument
[00:51:53] <strcat> pauls: ^
[00:52:09] * strcat just won't worry about it for now
[00:52:38] <toddaaro> http://pastebin.mozilla.org/2812997
[00:52:51] <toddaaro> my run command, brson notice anything I might be doing wrong?
[00:52:59] <strcat> https://github.com/mozilla/rust/pull/8408 r? checked-overflow intrinsics/traits
[00:53:01] <brson> I have to believe this is just idle callback madness
[00:53:13] <strcat> (needed for a fast generic range_step)
[00:53:21] <brson> toddaaro: yeah, RUST_OLDRT=0 will just use the old runtime
[00:53:23] <brson> :)
[00:53:29] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[00:53:34] <brson> the check is just that it's defined
[00:53:43] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Quit: WeeChat 0.4.1)
[00:53:45] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[00:54:20] <toddaaro> wait, is it RUST_OLDRT or OLD_RT
[00:54:23] *** Quits: mark_edward (quassel@moz-57A72B6E.hsd1.in.comcast.net) (Client exited)
[00:54:46] <brson> RUST_OLDRT
[00:55:11] <tikue> what is Bus error: 10
[00:55:14] <toddaaro> ok, so that would explain why they looked similar
[00:55:24] <toddaaro> now I just get an rtabort
[00:55:25] <brson> the gap seems to get wider the more messages are sent. I think the idle callbacks are probably just piling up and being stupid
[00:55:29] <sully> ok, yeah, tjc's fix makes 56 tests fail.
[00:55:33] <sully> so I guess that is the problem.
[00:55:46] <brson> toddaaro: the test case needs to use spawn() instead of spawntask_later
[00:55:51] <toddaaro> ohhhh
[00:56:23] <toddaaro> yea, so, I noticed it was faster my way
[00:56:40] <toddaaro> I should investigate that more
[00:56:46] <toddaaro> as I didn't think too hard about it
[00:57:03] <brson> probably because the spawn path has to check the context()
[00:57:10] <brson> that's part of the problem with the local heap slowdown
[00:57:13] <tikue> when I try to compile I get ```Bus error: 10``` have any of you seen that?
[00:57:17] <brson> just removing the old runtime will speed a few things up
[00:57:31] <kmc> tikue: o_O  nope, gdb any help?
[00:57:55] <sp3d> "bus error" is generally the same as "segfault", I believe
[00:58:00] <tikue> ah
[00:58:11] <kmc> yeah, you get it more on OS X
[00:58:18] <tikue> Program received signal EXC_BAD_ACCESS, Could not access memory.
[00:58:18] <tikue> Reason: KERN_INVALID_ADDRESS at address: 0x00000001057ffe28
[00:58:19] <tikue> [Switching to process 87042 thread 0x4503]
[00:58:20] <tikue> 0x0000000100e3aa3f in middle::ty::fold_regions_and_ty::_cb77c282f78a79a5::_0$x2e8$x2dpre ()
[00:58:21] <tikue> lol
[00:58:38] <tikue> not much help there
[00:58:47] <brson> stack overflow maybe
[00:59:13] <tikue> ooh that's definitely possible
[00:59:19] <brson> tikue: you are on master?
[00:59:24] <tikue> brson: yes
[00:59:35] <brson> gr, rustc really loves stack
[00:59:51] <brson> tikue: you can try changing the STACK_SIZE constant in librustc/rustc.rs
[01:00:02] <tikue> ok
[01:00:03] <brson> maybe I should add a RUSTC_STACK_SIZE env var for testing
[01:00:12] <toddaaro> brson: ok, now I'm seeing the 3x speed difference
[01:00:36] <sp3d> apparently segfault is more like EACCES (disallowed but theoretically valid in some context) and bus error is more like ENOENT (unaligned access or invalid address)
[01:00:36] <toddaaro> n=1000000 m=8 oldrt is 4s newrt 11s
[01:01:20] *** Quits: lmandel-pto (lmandel@moz-BECB9379.dsl.bell.ca) (Ping timeout)
[01:03:46] <strcat> it would help quite a bit if we removed the 3 unused words from stack closure headers, there are a *lot* of them
[01:04:29] <strcat> well, a lot fewer now that loops aren't using them
[01:06:14] <toddaaro> http://pastebin.mozilla.org/2813080 : a super simple script I hacked out to run a few benches, and the output I got on my machine
[01:06:38] <strcat> hm
[01:06:51] <strcat> I guess range_step could be defined as going until the end or an overflow
[01:07:05] *** Joins: lmandel-pto (lmandel@62615120.A1163AD8.ADB88A9.IP)
[01:07:22] *** Quits: true_droid (true_droid@moz-123FD9B8.beck.volia.net) (Client exited)
[01:08:26] <strcat> range_step(int::min_value, 100, -1) // underflows immediately, should it loop around to 100?
[01:08:40] <jack> how come i get errors from `use extra::url::Url;`? the docs show it being there. did it move?
[01:08:48] <bstrie> brson: does the new runtime allow one to swap out libuv for other event loops? if so, can you give an example of when you'd want to do this?
[01:09:00] <brson> toddaaro: was your presentation today?!
[01:09:15] <jack> brson: tomorrow.
[01:09:17] <strcat> brson: gtk/qt/sdl want to be *the* event loop
[01:09:19] <strcat> er
[01:09:21] <toddaaro> brson: yea, tomorrow
[01:09:21] <strcat> bstrie: *
[01:09:27] <brson> oh, whew
[01:09:28] <toddaaro> brson: I think it might have originally been today?
[01:09:36] <brson> why don't i get emails about this stuff?
[01:09:53] <toddaaro> the instructions e-mail I didn't read until today told me I'm supposed to invite my team
[01:09:57] <brson> strcat: that's true
[01:10:00] <toddaaro> so probably because I didn't e-mail you
[01:10:22] <brson> most years they send out invitations to the entire office
[01:10:30] *** Joins: vk_ (chatzilla@F92596F.2DEF7520.EF7679FA.IP)
[01:10:41] <brson> wonder why they're keeping it so low-key
[01:10:42] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[01:10:52] <brson> toddaaro: what time?
[01:11:05] *** Joins: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP)
[01:11:17] <brson> bstrie: not yet, but it is designed for it. for the windowing system as strcat mentioned
[01:11:25] <brson> needs ~traits to work first
[01:11:26] <toddaaro> brson: I think there is a block of four of us scheduled for 1pm, not sure when the "real" time is
[01:11:35] <tikue> brson: i thought ~traits work now?
[01:12:02] <toddaaro> brson: ah, e-mail said, 1:30
[01:12:14] <brson> tikue: i've heard that claim before! i haven't revisited this in a while
[01:12:24] <tikue> brson: https://gist.github.com/tikue/c82d64f2093dc81f7102#file-primes-rs
[01:12:33] <brson> toddaaro: ok, what do you make of those numbers you pasted. i'm still trying to understand what i'm looking at
[01:12:36] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Quit: Leaving)
[01:12:37] *** Joins: brianm (brianm@moz-9B7D279E.dsl.static.sonic.net)
[01:12:37] <tikue> brson: code snippet i wrote using ~trait
[01:13:06] *** Quits: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP) (Ping timeout)
[01:13:17] <toddaaro> brson: the pingpong ones at the bottom are rust_threads,n,m,real time elapsed, %utilization
[01:13:31] <toddaaro> the other two are just rust_threads,n,real time elapsed, %utilization
[01:13:52] <brson> toddaaro: oh, i see. it's not comparing to oldrt
[01:13:57] <toddaaro> brson: yea, not yet
[01:14:02] <brson> now i understand it
[01:14:29] <toddaaro> now that I know that just doing the env variable works I'll tweak the benchmarks and spit out a version with both
[01:14:48] <strcat> bjz_: ping
[01:15:25] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[01:16:30] *** Parts: doomlord_ (servitor@moz-13E69BC8.range86-180.btcentralplus.com) (Leaving)
[01:16:36] *** Joins: doomlord_ (servitor@moz-13E69BC8.range86-180.btcentralplus.com)
[01:17:05] *** Joins: mark_edward (quassel@moz-57A72B6E.hsd1.in.comcast.net)
[01:18:45] *** Quits: mark_edward (quassel@moz-57A72B6E.hsd1.in.comcast.net) (Ping timeout)
[01:19:07] *** Joins: mark_edward (quassel@moz-57A72B6E.hsd1.in.comcast.net)
[01:20:01] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Client exited)
[01:21:12] *** Quits: lmandel-pto (lmandel@62615120.A1163AD8.ADB88A9.IP) (Quit: lmandel-pto)
[01:22:05] <tikue> what's the best way to debug ```Bus error: 10```
[01:22:08] <tikue> gdb?
[01:22:08] <toddaaro> brson: yikes, oldrt spawn is expensive
[01:22:39] <toddaaro> 1.8s for 100k spawns newrt, 20s oldrt
[01:22:57] *** Joins: maikklein (maik@moz-5AED6CF8.dip0.t-ipconnect.de)
[01:23:04] <cmr> I'd just like to point out https://github.com/mozilla/rust/issues/7532 again
[01:23:19] <toddaaro> brson: trying a million spawns, newrt 17s oldrt crashes with malloc error
[01:23:40] <vk_> erickt: ping
[01:23:41] <cmr> toddaaro: hey that smells a bit like linear scaling, nice!
[01:23:50] <cmr> (for newrt)
[01:24:24] <toddaaro> cmr: yea, it did work out linear (though this is the single-spawner thread running in RUST_THREADS=1)
[01:24:34] *** Joins: rustyPipe (Mibbit@moz-5949C51B.dllstx.fios.verizon.net)
[01:24:59] <rustyPipe> Is it better to use internal iterators or external iterators?
[01:25:04] <cmr> rustyPipe: internal iterators are gone
[01:25:51] <strcat> in master, at least
[01:26:07] <rustyPipe> So you can't use use std::iter?
[01:26:17] <strcat> std::iter is gone
[01:26:32] <cmr> ...more or less
[01:26:37] <strcat> well it's actually gone.
[01:26:38] <engla> external iterators are easier to compose
[01:26:38] <cmr> all that's left is the Times trait
[01:26:49] <strcat> cmr: yeah but I want to kill that too ;p
[01:26:57] <strcat> or at least make it an external one
[01:27:04] <strcat> rustyPipe: http://static.rust-lang.org/doc/tutorial-container.html#iterators
[01:27:17] <brson> toddaaro: lol. yeah the task lifecycle in the old runtime was a mess of hand-over-hand locking
[01:27:36] *** Joins: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net)
[01:27:39] *** Quits: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net) (Client exited)
[01:27:45] <rustyPipe> So the documentation on the website doesn't reflect the removal of internal iterators yet, right?
[01:27:52] *** Joins: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net)
[01:28:06] <strcat> rustyPipe: it does, you're probably looking at the 0.7 docs
[01:28:11] <brson> tikue: so it wasn't stack overflow?
[01:28:13] <goffrie> rustyPipe: the front page hasn't been updated, but "trunk" docs are up-to-date
[01:28:13] <rustyPipe> Yeah, I am
[01:28:18] <rustyPipe> Oh, okay
[01:28:26] <tikue> brson:  I don't really know how to determine whether or not it was
[01:29:35] <rustyPipe> So how would I iterator over an array?
[01:29:41] <cmr> rustyPipe: v.iter()
[01:29:49] <goffrie> rustyPipe: `for x in xs.iter()`
[01:30:07] <rustyPipe> So the syntax is a little bit more like Python?
[01:30:10] <goffrie> yup
[01:31:04] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[01:31:04] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[01:31:27] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[01:31:59] <cmr> toddaaro: so is the data the script spits out useful at all?
[01:32:05] <cmr> for me to gist it or something, I mean
[01:32:12] <cmr> (I can also run it with RUST_OLDRT=1)
[01:32:38] <rustyPipe> Does anyone know how to make an array that contains a range of values?
[01:32:52] <cmr> rustyPipe: what do you mean?
[01:32:59] <cmr> there's std::vec::from_fn
[01:33:07] <cmr> also std::iterator::range for numeric ranges without a step
[01:33:08] <goffrie> rusti: let rustyPipe: ~[int] = range(0, 10).collect()
[01:33:09] -rusti- <anon>:6:4: 6:5 error: expected `;` but found `}`
[01:33:09] -rusti- <anon>:6     };
[01:33:10] -rusti-              ^
[01:33:10] -rusti- application terminated with error code 101
[01:33:14] <goffrie> rusti: let rustyPipe: ~[int] = range(0, 10).collect(); rustyPipe
[01:33:15] -rusti- ~[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
[01:33:26] <toddaaro> cmr: maybe? at this point I think it is mostly "for our own amusement", once we knock out idle callback overload and the rtdebug strings I'll start caring more about results
[01:33:31] <goffrie> if that's what you mean, but in many cases you don't want that
[01:33:36] <cmr> toddaaro: 
[01:33:38] <cmr> ok
[01:33:47] <toddaaro> cmr: and at that point I'll probably try and find a collection of people to bug for perf reports on different machines
[01:34:53] <brson> tikue: did increasing the amount of stack requested by rustc by some ridiculous amount help at all? you could also try gdb and seeing how deep the stack is
[01:35:09] <toddaaro> cmr: though knowing that "it ran" on your machine is kinda useful, gives me some more confidence in the tests
[01:35:29] <cmr> toddaaro: it did :)
[01:35:37] <tikue> brson: sorry, I got distracted -- how do I actually increase stacks ize?
[01:36:02] <brson> tikue: there's a variable in librustc/rustc.rs call STACK_SIZE
[01:37:34] <tikue> ok 
[01:38:55] <tikue> and recompile i assume
[01:38:55] *** Joins: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net)
[01:38:57] <rustyPipe> Do we have to dereference x (i.e. for x in i.iter()) in order to access the underlying object, in order to, say, do addition and subtraction with it?
[01:39:19] <mark_edward_> depends on the iterator
[01:39:33] <mark_edward_> rustyPipe: for vectors i'm pretty sure the answer is yes
[01:40:03] <goffrie> ^ yup, vector iterators produce references
[01:40:12] <rustyPipe> Vectors can only contain homogeneous objects, right?
[01:40:13] <cmr> rustyPipe: or for &x in i.iter(), or for x in i.consume_iter()
[01:40:24] <goffrie> rustyPipe: yeah, same types
[01:40:33] <rustyPipe> What's consume_iter()?
[01:40:39] *** Joins: brendan (brendaneic@moz-FB09EACF.public.wayport.net)
[01:40:52] <cmr> rustyPipe: yields values rather than references, but also takes ownership of the vector and "consumes" it (you can't use it anymore)
[01:41:12] <rustyPipe> So once it is done with it, you cannot access it again?
[01:41:16] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[01:41:28] <cmr> correct
[01:41:40] <rustyPipe> okay
[01:42:01] <rustyPipe> Out of all the iterators, which is the most efficient one?
[01:42:13] *** Quits: azakai (alon@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[01:42:52] <goffrie> rustyPipe: I doubt anybody knows the answer to that question :) especially because it'll depend a lot on factors like what you're iterating over
[01:43:02] <sammykim> Is generic type can be copyable?
[01:43:03] <mark_edward_> rustyPipe: i don't know exactly what you mean, but i'd guess the vector iterator... or maybe std::iterator::Counter
[01:43:18] <mark_edward_> sammykim: no, you need <T: Clone> constraint
[01:43:19] <cmr> sammykim: you need to have <T: Clone> and explicitly copy it by calling the .clone() method
[01:43:49] <rustyPipe> Forgive me if I am wrong, but if you use consume_iter(), is there garbage collection going on?
[01:43:58] <mark_edward_> rustyPipe: vector iterator boils down to adding an offset to a pointer
[01:44:11] <rustyPipe> What do you mean by that?
[01:44:13] <goffrie> rustyPipe: nope, it's move-semantics, the vector is destroyed statically when the iterator goes out of scope
[01:44:17] <mark_edward_> rustyPipe: no, consume iter moves the value out. no garbage collection
[01:44:42] <rustyPipe> Ok, a destructor gets called once out of scope.
[01:44:52] <Seldaek> if someone is bored, adding a rust page to http://learnxinyminutes.com sounds like a good activity
[01:45:05] <rustyPipe> That would be nice
[01:45:05] <goffrie> hmm, how many minutes does it take to learn rust
[01:45:38] *** Joins: Nisstyre (wes@moz-FD86289.netflash.net)
[01:45:40] <rustyPipe> For me, I'm still trying to understand ownership
[01:45:56] <cmr> rustyPipe: really, ownership boils down to "Who needs to free this memory?"
[01:46:02] <cmr> Destructors are just extra fanciness
[01:46:22] <vk_> Is there an example repo that can be installed using rustpkg some where?
[01:46:52] *** Quits: brendan (brendaneic@moz-FB09EACF.public.wayport.net) (Ping timeout)
[01:46:54] <Seldaek> goffrie: don't know if it has to be quantified in minutes, but I think it's pretty awesome to have a standard place to check for a quick primer on any language that follows a common form
[01:47:08] <cmr> vk_: rustdoc_ng can be installed with rustpkg
[01:47:31] <vk_> cmr: oh cool, thanks.
[01:47:44] <rustyPipe> Then there is also learning about the differences between the heap and the stack, and owned and managed boxes
[01:47:59] <goffrie> Seldaek: I was just wondering out loud :p
[01:48:13] <cmr> And also references and macros and traits and closures!
[01:48:56] <rustyPipe> I read somewhere on reddit rust that owned boxes were preferred over managed boxes? I forgot to bookmark the post, but can someone explain why that is so?
[01:49:15] <cmr> rustyPipe: Managed boxes require GC, owned boxes don't.
[01:49:17] <cmr> Simple as that
[01:49:34] <SiegeLord> Except now you have to explain why GC is bad :P
[01:49:47] <cmr> Mutable managed boxes also introduce dynamic failure, mutable owned boxes have no different semantics than owned boxes.
[01:50:08] <goffrie> cmr: well, insofar as "mutable owned boxes" exist :P
[01:50:11] <rustyPipe> How do they introduce dynamic failure?
[01:50:28] <strcat> ~T is identical to 'struct Foo(T)' except that ~T is pointer size - same semantics as any old value type
[01:50:36] <strcat> plain-old*
[01:50:56] <cmr> rustyPipe: So the thing about managed boxes is you can share them, have multiple references to them etc. If two pieces of code try to mutate a @mut at the same time, the task fails.
[01:51:04] <cmr> Rather, if you borrow two &muts
[01:51:10] <cmr> Or borrow a &mut while a &mut is borrowed
[01:51:17] <goffrie> rustyPipe: @mut doesn't imply exclusive mutability (ie anyone else can mutate it under your feet); so if you borrow to &mut, which _does_ imply exclusive mutability, it will fail if you do that twice at the same time.
[01:51:18] <cmr> Erm, borrow a & while a &mut is borrowed
[01:51:21] <cmr> and the other way around
[01:51:50] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Client exited)
[01:51:56] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[01:52:43] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[01:52:43] *** ChanServ sets mode: +o brson
[01:53:11] <bjz_> strcat: hoy
[01:53:29] <strcat> bjz_: any ideas on what to call the overflow checked arithmetic ops?
[01:53:35] <strcat> I have a PR implementing them with the LLVM intrinsics
[01:53:42] <strcat> checked_{add,mul,sub} atm
[01:53:55] <strcat> (kind of long)
[01:53:58] *** Joins: brson_ (brson@moz-BBE3ABD.mv.mozilla.com)
[01:54:10] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[01:54:12] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[01:54:29] *** Quits: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net) (Quit: eatkinson)
[01:54:53] <bjz_> hmm
[01:55:42] <bjz_> perhaps bikeshed it on the numerics issue?
[01:56:02] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[01:58:54] *** Quits: thomaslee (thomaslee@moz-6C3931E3.static.twtelecom.net) (Client exited)
[01:59:02] *** Joins: froystig (froystig@424CFC39.4C7E3E47.E4D621DB.IP)
[01:59:15] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[01:59:23] *** Joins: thomaslee (thomaslee@moz-6C3931E3.static.twtelecom.net)
[01:59:43] <cmr> toddaaro: ping!
[02:00:04] <cmr> toddaaro: I have an exciting developement
[02:00:06] <strcat> bjz_: sounds good ;]
[02:00:32] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[02:00:38] <cmr> I made rtdebug! do nothing, ie, it expands to `if cfg!(debug) { old_body }`, and now I am seeing acpi_pm_read on the top of the traces
[02:01:03] *** Quits: thomaslee (thomaslee@moz-6C3931E3.static.twtelecom.net) (Ping timeout)
[02:01:04] <cmr> toddaaro: but it only drops from 11s to 9s
[02:04:25] *** Quits: hjr3 (hradtke@374E545A.3A8E9B0C.F9D9C60E.IP) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[02:04:54] <bblum> rtdebug should already do nothing
[02:04:56] <cmr> ... "only"
[02:04:59] <bblum> rtdebug_ is the one
[02:05:07] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[02:05:07] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/7OLe2g
[02:05:07] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[02:05:25] <cmr> rtdebug! does let _x = ...
[02:05:35] <cmr> which doesn't get optimized out
[02:05:38] <cmr> fmt still runs
[02:06:00] <tikue> brson_: making the stack larger did not solve this problem
[02:08:05] *** Joins: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP)
[02:08:05] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/VftrPw
[02:08:05] *** Parts: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP) ()
[02:08:06] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[02:08:06] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/7sR2Tg
[02:08:06] <ghrust> 13rust/06auto 1495b3689 15Stepan Koltsov: Implement FromStr for IpAddr and SocketAddr...
[02:08:06] <ghrust> 13rust/06auto 1458b1122 15Stepan Koltsov: Use FromStr for IpAddr in rt::uv::net
[02:08:06] <ghrust> 13rust/06auto 147a1b61d 15bors: auto merge of #8336 : stepancheg/rust/socket-addr-from-str, r=brson...
[02:08:08] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[02:08:11] <toddaaro> cmr: wow awesome, ~18% perf win from a one line change
[02:08:16] <brson_> hey something merged!
[02:08:17] <cmr> two line, but whatevs
[02:08:21] <brson_> the world isn't ending
[02:08:23] <cmr> brson_: my rollup merged :(
[02:08:29] <brson_> cmr: grats
[02:08:38] <brson_> why you sad?
[02:08:45] <cmr> because you didn't notice it :p
[02:09:01] <cmr> http://octayn.net/benches/nortdebug_pingpong.svg
[02:09:17] <cmr> looks like the idle handlers is 15% of the runtime
[02:09:52] <cmr> maybe more like 17%
[02:10:06] <cmr> toddaaro: acpi_pm_read is from clock_gettime fwiw
[02:10:32] * cmr turns his clocksource back to tsc
[02:10:43] <brson_> i wonder why libuv needs clock_gettime
[02:11:21] <cmr> Using a proper clocksource brings it down from 9s to 6s
[02:11:34] *** Joins: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP)
[02:11:48] <brson_> hopefully those mallocs and frees will decrease proportionally to the idle_cbs
[02:12:04] <strcat> clock_gettime with just CLOCK_MONOTONIC doesn't do a syscall
[02:12:07] <cmr> http://octayn.net/benches/nortdebug_pingpong_tsc.svg
[02:12:41] <toddaaro> cmr: yea, 6s is starting to look pretty competitive with oldrt
[02:12:57] <toddaaro> cmr: so once we clean up idlecallbacks I think we will be mostly there
[02:13:03] <cmr> toddaaro: I can't ruin the bench with oldrt, it fails with tls key stuff
[02:13:14] <tikue> brson_: for reference this is the code causing the problem https://gist.github.com/tikue/99b25a8cf060a585ef7f
[02:13:26] <toddaaro> cmr: ah yes, I was bad and used a newrt primitive for spawn, go replace spawntask_later with just spawn and you should be set for oldrt
[02:13:35] *** Quits: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP) (Ping timeout)
[02:13:36] <toddaaro> I need to PR that soon
[02:13:46] <strcat> tikue: it's because BinTree is infinite size
[02:13:51] <brson_> tikue: oh, it's a recursive type, rustc is probably ... yeah
[02:13:56] <tikue> oh lol
[02:14:01] <brson_> it's smashing the stack
[02:14:16] <cmr> I thought the compiler was fixed to reject that
[02:14:19] <tikue> why isn't there a compiler error for that
[02:14:25] <strcat> it tries
[02:14:28] <strcat> it just doesn't try hard enough
[02:14:31] <tikue> lol
[02:14:46] <cmr> brson_: which spawntask_later should I replace? rt/sched.rs? all of them?
[02:15:01] <cmr> Oh probably in the benchmark...
[02:15:05] <strcat> rusti: struct Foo { x: Option<Foo> }
[02:15:06] -rusti- ()
[02:15:09] <strcat> rusti: struct Foo { x: Foo }
[02:15:09] -rusti- <anon>:5:9: 5:30 error: this type cannot be instantiated without an instance of itself; consider using `Option<main::Foo>`
[02:15:09] -rusti- <anon>:5          struct Foo { x: Foo }
[02:15:09] -rusti-                   ^~~~~~~~~~~~~~~~~~~~~
[02:15:10] -rusti- error: aborting due to previous error
[02:15:10] -rusti- application terminated with error code 101
[02:15:15] <strcat> see? ;p
[02:15:21] <brson_> cmr: yeah, the ones in the benchmark
[02:15:26] <strcat> rusti: struct Foo { x: [Foo, ..2] }
[02:15:27] -rusti- ()
[02:15:27] <cmr> std::task::spawn right?
[02:15:35] <strcat> it's really not a very good check
[02:15:44] <strcat> but it's probably going to be costly to do it right
[02:15:47] <brson_> cmr: yes
[02:16:11] <cmr> strcat: it used to handle it correctly didn't it?
[02:16:18] <strcat> cmr: no, it handled some cases better
[02:16:21] <strcat> but never all
[02:16:22] <cmr> oh
[02:16:34] <strcat> fixed-size arrays always let you hack past it
[02:16:52] <tikue> rusti: let xs: ~[&int] = ~[];
[02:16:53] -rusti- <anon>:5:13: 5:15 warning: unused variable: `xs` [-W unused-variable (default)]
[02:16:53] -rusti- <anon>:5          let xs: ~[&int] = ~[];
[02:16:53] -rusti-                       ^~
[02:16:53] -rusti- ()
[02:17:13] <cmr> newrt for 1000000 8 with rtdebug nop'd is 6.117s, for oldrt it's 24.294s
[02:17:15] <tikue> rusti: let xs: ~[&int] = ~[]; let x = ~1; xs.push(y); xs
[02:17:16] -rusti- <anon>:5:52: 5:53 error: unresolved name `y`. Did you mean `x`?
[02:17:16] -rusti- <anon>:5          let xs: ~[&int] = ~[]; let x = ~1; xs.push(y); xs
[02:17:16] -rusti-                                                              ^
[02:17:16] -rusti- error: aborting due to previous error
[02:17:16] -rusti- application terminated with error code 101
[02:17:22] <tikue> rusti: let xs: ~[&int] = ~[]; let x = ~1; xs.push(x); xs
[02:17:22] -rusti- <anon>:5:52: 5:53 error: mismatched types: expected `&int` but found `~<VI0>` (expected &-ptr but found ~-ptr)
[02:17:22] -rusti- <anon>:5          let xs: ~[&int] = ~[]; let x = ~1; xs.push(x); xs
[02:17:23] -rusti-                                                              ^
[02:17:23] *** concrete.mozilla.org sets mode: +M 
[02:17:23] -rusti- error: aborting due to previous error
[02:17:25] -rusti- application terminated with error code 101
[02:17:26] <cmr> brson_: toddaaro: that's pretty damn good, 4x faster
[02:17:39] *** Quits: brson_ (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[02:17:42] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[02:17:42] *** ChanServ sets mode: +o brson
[02:17:52] *** brson sets mode: -M 
[02:18:17] <toddaaro> cmr: whoa, that is a change
[02:18:25] <strcat> fmt is really bad ;p
[02:18:27] <brson> cmr: what's the change?
[02:18:55] *** Quits: Earnestly (earnest@3F74F9E2.8E6FE497.30311652.IP) (Ping timeout)
[02:19:19] <tikue> is there a way to push an owned pointer to a vector of borrowed pointers
[02:19:38] <toddaaro> ls
[02:19:39] <brson> oh, i see
[02:19:51] <brson> damn that's great
[02:20:04] <bblum> toddaaro: . .. toddaaros_crap
[02:20:07] *** Quits: froystig (froystig@424CFC39.4C7E3E47.E4D621DB.IP) (Quit: leaving)
[02:20:37] <bblum> tikue: you hafta get the types to match up :P
[02:20:47] <tikue> bblum: what do u mean
[02:20:56] <tikue> i have ~int and want &int what do
[02:20:58] <engla> tikue: an owned pointer it should autoborrow when you pass it to the .push method
[02:21:04] <tikue> it didn't tho
[02:21:07] <tikue> rusti: let xs: ~[&int] = ~[]; let x = ~1; xs.push(x); xs
[02:21:08] -rusti- <anon>:5:52: 5:53 error: mismatched types: expected `&int` but found `~<VI0>` (expected &-ptr but found ~-ptr)
[02:21:09] -rusti- <anon>:5          let xs: ~[&int] = ~[]; let x = ~1; xs.push(x); xs
[02:21:09] -rusti-                                                              ^
[02:21:09] -rusti- error: aborting due to previous error
[02:21:09] -rusti- application terminated with error code 101
[02:21:12] <cmr> toddaaro: brson: https://gist.github.com/cmr/113f5d274788b87dbbf8
[02:21:14] <bblum> tikue: &*x
[02:21:15] <aatch> rusti: let xs: ~[&int] = ~[]; let x = ~1; let xp : &int = x; xs.push(xp); printfln!("%?",xs);
[02:21:16] -rusti- <anon>:5:63: 5:65 error: cannot borrow immutable local variable as mutable
[02:21:17] -rusti- <anon>:5          let xs: ~[&int] = ~[]; let x = ~1; let xp : &int = x; xs.push(xp); printfln!("%?",xs);
[02:21:17] *** concrete.mozilla.org sets mode: +M 
[02:21:17] -rusti-                                                                         ^~
[02:21:17] -rusti- error: aborting due to previous error
[02:21:18] -rusti- application terminated with error code 101
[02:21:25] <aatch> rusti: let mut xs: ~[&int] = ~[]; let x = ~1; let xp : &int = x; xs.push(xp); printfln!("%?",xs);
[02:21:26] -rusti- ~[&1]
[02:21:26] -rusti- ()
[02:21:35] <strcat> aatch: https://github.com/mozilla/rust/pull/8408 r?
[02:21:41] <tikue> rusti: let xs: ~[&int] = ~[]; let x = ~1; xs.push(&*x); xs
[02:21:42] -rusti- pastebinned 19 lines of output: http://sprunge.us/SXUh
[02:21:42] <cmr> brson: I mean, it was already 11s vs 24s, on my box
[02:21:57] *** brson sets mode: -M 
[02:22:18] <cmr> toddaaro: is this still using the trivially locked thing?
[02:22:40] <cmr> 3% is spent in ___lll_unlock_wake
[02:23:01] <toddaaro> cmr: yea, the work queues are still the really silly queue in a mutex
[02:23:14] <cmr> toddaaro: that's very promising :)
[02:23:26] <toddaaro> cmr: so that patch actually compiles? it doesn't throw angry "unused variable" warnings at you?
[02:23:35] <cmr> toddaaro: nope
[02:23:44] <cmr> toddaaro: the cfg should probably be rtdebug
[02:23:57] <toddaaro> oh, I guess it can't tell that the variables aren't used most of the time so it doesn't complain about not using them
[02:24:00] <toddaaro> brilliant
[02:24:17] <cmr> dbaupp: cfg! is super awesome, thanks for writing it
[02:24:17] <tikue> rusti: let x = ~1; let foo = Some(x); for x in foo.iter() { printfln!(x); } x
[02:24:18] <toddaaro> I'll have to update my code to match yours and run more tests
[02:24:19] -rusti- pastebinned 8 lines of output: http://sprunge.us/LhBZ
[02:24:21] <strcat> oh well this makes Add 2.5x faster
[02:24:25] <strcat> on vectors
[02:24:29] <aatch> strcat, oh the joys of repetitive code.
[02:24:34] <tikue> rusti: let x = ~1; let foo = Some(x); for x in foo.iter() { printfln!(x); } foo
[02:24:35] -rusti- &~1
[02:24:35] -rusti- Some(~1)
[02:24:35] <strcat> aatch: yep :(
[02:24:41] <strcat> aatch: some could be macro-ized
[02:24:42] <aatch> strcat, done, btw
[02:24:43] <tikue> rusti: let x = ~1; let foo = Some(x); for &x in foo.iter() { printfln!(x); } foo
[02:24:43] -rusti- <anon>:5:44: 5:46 error: cannot move out of dereference of & pointer
[02:24:43] -rusti- <anon>:5          let x = ~1; let foo = Some(x); for &x in foo.iter() { printfln!(x); } foo
[02:24:44] -rusti-                                                      ^~
[02:24:44] -rusti- error: aborting due to previous error
[02:24:44] -rusti- application terminated with error code 101
[02:24:50] <strcat> aatch: but I ran into macro limitations and gave up :P
[02:24:57] <strcat> it just can't be done as generically as I wanted
[02:24:59] <aatch> strcat, I did macro-ize a little in the compiler, that ifn! is mine
[02:25:12] <strcat> aatch: ah I mean the Checked{Add,Sub,Mul} impls
[02:25:25] <strcat> aatch: also found 2 bugs this way - our InsertValue was wrong, and an assert was backwards
[02:25:27] * strcat sighs
[02:25:54] <strcat> (I had no end of confusion caused by those)
[02:26:11] *** Joins: mozuser (chatzilla@9EA5B612.EE395964.5B6BFE7D.IP)
[02:26:30] <aatch> strcat, so what did you add those for? Just 'cos?
[02:26:45] <strcat> aatch: I need CheckedAdd for range_step
[02:26:58] <strcat> and there are a bunch of ad-hoc and likely wrong overflow checks ;p
[02:27:04] * brson dinner
[02:27:07] <aatch> strcat, right.
[02:27:08] <strcat> so I just added them all
[02:27:16] *** Joins: mozuser_ (chatzilla@moz-BCA817FA.hsd1.ca.comcast.net)
[02:27:24] <engla> that's great
[02:27:26] <aatch> We could implement a big-int type with them!
[02:27:41] <engla> everywhere there are uint for size, there is checks for overflow
[02:27:44] *** Parts: mozuser_ (chatzilla@moz-BCA817FA.hsd1.ca.comcast.net) ()
[02:27:45] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[02:28:04] *** Joins: enix (enix@moz-1CD86B39.hsd1.md.comcast.net)
[02:28:08] *** Quits: mozuser (chatzilla@9EA5B612.EE395964.5B6BFE7D.IP) (Ping timeout)
[02:28:11] <strcat> engla: well there's one in reserve on vecs for sure
[02:28:22] <strcat> push, etc. don't need them because it'd imply OOM before you got there
[02:28:42] <engla> the crash on vec.reserve(-1) was dumb
[02:28:45] <engla> :)
[02:28:47] *** Quits: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[02:29:33] <engla> I was fumbling with overflow checks in ChunkIter
[02:30:22] <cmr> brson: btw dbaupp said you were inquiring about my benchmarks
[02:31:23] <cmr> brson: I have a proper builder setup now, so my box will basically be doing builds for a while. I'll run benchmarks when I'm asleep, so it can have the box all to itself.
[02:32:26] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[02:33:33] *** Quits: boredomist (user@moz-63CF9F31.res-cmts.sesp.ptd.net) (Ping timeout)
[02:33:59] <strcat> svn makes me want to cry
[02:34:06] <Luqman> r? https://github.com/mozilla/rust/pull/8410
[02:34:31] <engla> I think saturating add and checked add fit well with a safe language  (I know you are going to say bignums are even better)
[02:35:08] <cmr> Luqman: does LLVM not do the -march=native type thing?
[02:35:20] <strcat> that's probably clang
[02:35:36] <Luqman> cmr: well, we were just always passing generic to llvm
[02:35:47] * cmr wonders if they could move that into llvm or if we could call into libclang for that
[02:35:50] <cmr> Luqman: right, just wondering
[02:36:37] <strcat> Luqman: is there a way to pass -march via that stuff?
[02:37:05] *** Quits: zz_kimundi (kimundi@moz-A60F0B0C.dip0.t-ipconnect.de) (Ping timeout)
[02:37:11] <Luqman> strcat: --target-feature no?
[02:37:17] <cmr> nope
[02:37:19] <cmr> well
[02:37:24] <cmr> llc has a -march option
[02:37:27] <strcat> Luqman: -march has auto-detection of the cpu/features though with llc/clang
[02:37:27] <cmr> this is different than it
[02:37:45] <cmr> llc --version shows the host cpu correctly
[02:38:26] <cmr> it doesn't accept -march=native though
[02:38:35] <strcat> oh
[02:38:40] <cmr> but if you don't give it an explicit build triple apparently infers, according to the man page
[02:38:48] <strcat> guess it's in libclang then
[02:39:59] <Luqman> strcat: then what's the difference between say -march=armv5te and --target-feature v5te ?
[02:40:11] <strcat> Luqman: hm, no idea
[02:40:47] *** Joins: zz_kimundi (kimundi@moz-8FE337DC.dip0.t-ipconnect.de)
[02:41:05] *** zz_kimundi is now known as kimundi
[02:43:10] <jack> can you not have wildcards in struct pattern matches?
[02:43:18] <jack> Foo { * } doesn't seem to work
[02:43:20] <cmr> jack: the wildcard is, inconsistently, _
[02:43:25] <cmr> it means the same as *
[02:43:28] <jack> oh weird
[02:44:08] <strcat> I have an open bug about it
[02:46:00] <bblum> oops. i can't use a oneshot to fix the select problem because of the paraguay bug
[02:46:06] <bblum> sigh.
[02:46:09] <maikklein> any idea how I can caputre mutable variables? https://gist.github.com/MaikKlein/6190778
[02:46:18] <aatch> bblum, paraguay bug?
[02:46:20] <cmr> bblum: what is the paraguay bug?
[02:46:32] <strcat> aatch and cmr just had a race condition
[02:46:40] <aatch> strcat, I won
[02:46:46] <cmr> yes you did
[02:47:18] * aatch creates certificate in MS Publisher
[02:47:24] <bblum> aatch: cmr: it is a name from CMU's OS course, for a race condition in which a task blocks on one condvar (pipe), wakes up, blocks on a second condvar (pipe), and then someone else trying to send on the first condvar triggers a spurious wakeup from the second one
[02:48:10] <cmr> what's the story behind the name?
[02:48:29] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Client exited)
[02:48:39] <strcat> I'll add a benchmark to make cmr happy
[02:48:43] <aatch> bblum, ahh. So you can't use a oneshot because you might need to use it again if the wakeup is spurious?
[02:48:53] <cmr> strcat: <3
[02:49:01] <bblum> cmr: a TA for the course was grading a student's project that appeared to be bug-free, but he was determined to not let the project go without finding something wrong with it, so he stared and stared, and eventually discovered this bug. he is from paraguay.
[02:49:58] <cmr> heh
[02:50:14] <bjz_> cmr: pushed some code for the generator - it's pretty ugly
[02:50:24] <bblum> aatch: In most cases the atomic-swap protocol prevents this bug from being relevant. But in select(), in between blocking yourself on all the ports and unblocking yourself from all of them, you are registered as blocked on a bunch of ports without actually having stopped running.
[02:50:33] <bjz_> cmr: only collects the enums into a struct for now
[02:51:08] <bblum> aatch: So I tried to use a oneshot in between those points, blocked on it, and then a sender on one of the ports that I was selecting on came and gave me a spurious wakeup.
[02:51:16] <maikklein> http://stackoverflow.com/questions/18139407/how-do-i-capture-mutable-variables
[02:51:20] <cmr> bjz_: https://github.com/bjz/gl-rs#checking-if-a-function-is-loaded
[02:51:29] <cmr> bjz_: how, when the function is called, try and load it first :p
[02:51:37] * cmr will look to see how this is implemented later
[02:51:53] *** Joins: eschweic (Adium@moz-CF8BEBEF.dia.static.qwest.net)
[02:52:02] <cmr> I mean it obviously adds dispatch overhead
[02:52:03] <bjz_> cmr: ?
[02:52:06] <cmr> should likely be optional
[02:52:19] <bjz_> dispatch?
[02:52:32] <cmr> yes, you need to check if the function has been loaded before you call it
[02:52:35] <strcat> heh it barely helped
[02:52:48] <bjz_> cmr: oh yeah, that would be in  client code
[02:52:56] <bjz_> cmr: if you want it
[02:53:17] * cmr goes to bed
[02:53:30] *** Joins: lkuper (lkuper@63686BC7.F689A8C9.EB438161.IP)
[02:53:34] <bjz_> cmr: or to figure out what graphical feature to enable
[02:53:37] <maikklein> better to check all available functions in the start 
[02:53:39] <strcat> test vector_add ... bench: 164 ns/iter (+/- 1)
[02:53:40] <bjz_> *features
[02:53:41] <strcat> before
[02:53:43] <strcat> test vector_add ... bench: 112 ns/iter (+/- 2)
[02:53:45] <strcat> after
[02:53:47] <strcat> :[
[02:53:50] <bjz_> maikklein: ofc
[02:53:53] <maikklein> like glload
[02:54:03] <bblum> aatch: However, if I do an unkillable receive instead of a killable one, that makes BlockedTask::make_selectable() use a different kill-flag to store the blocked task in. So a sender on a selected-on port won't collide with it.
[02:54:13] <bblum> (this is the solution that i just came up with)
[02:54:21] <brson> there's a festival happening on castro st. right now
[02:54:32] <aatch> bblum, clever. A little hacky, but clever
[02:54:53] <bjz_> maikklein: the pointers are stored in structs: pub struct FnPtr<F> { f: F, is_loaded: bool }
[02:55:05] <aatch> (I consider most valid concurrent code to be a bit hacky)
[02:55:14] <maikklein> bjz_, ah nice
[02:55:23] <bblum> aatch: yeah... the semantics of how the task-killing code works has gotten pretty complicated since the addition of select
[02:55:38] <bblum> hard to keep track of all the quirks
[02:55:50] <bjz_> maikklein: the gl methods call f
[02:56:09] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[02:56:45] <bjz_> maikklein: so: (self.glFn.f)()
[02:57:16] <bjz_> maikklein: that way you can do : gl.glFn()
[02:57:48] <bjz_> maikklein: actually more like gl.Fn() (the gl is omitted)
[02:59:24] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[02:59:24] *** ChanServ sets mode: +o brson
[02:59:42] <jack> where is Encode defined?
[02:59:54] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[03:01:47] <maikklein> bjz_, but if you call gl.glFn() it doesn't always check if it's loaded right?
[03:02:10] <bjz_> maikklein: of course not :)
[03:02:17] <maikklein> so you just do if gl.glFn().isLoaded {gl.glFn();}
[03:02:22] <maikklein> bjz_, ok :)
[03:02:28] <bjz_> maikklein: it would probably segfault
[03:02:47] *** Quits: ab (alex@BC9D99CC.37C1012D.FE617B51.IP) (Ping timeout)
[03:02:47] <bjz_> maikklein: do the methods are accordingly unsafe
[03:02:53] <bjz_> *so
[03:03:12] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[03:03:50] <maikklein> can't wait to use opengl in rust :D
[03:04:10] <maikklein> atm I doing everything in sdl :X
[03:04:23] <bjz_> https://github.com/bjz/gl-rs/blob/master/gl_core_4_3.rs
[03:04:24] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[03:04:24] *** ChanServ sets mode: +o brson
[03:04:49] <bjz_> maikklein: as you can see - 3 months ago :)
[03:05:27] *** Joins: maikklein2 (maik@moz-98BDCEDC.dip0.t-ipconnect.de)
[03:05:40] <maikklein2> .
[03:05:45] <bjz_> ..
[03:05:52] <maikklein2> bjz_, do you know what is wrong with 6661?
[03:05:59] <bjz_> not a clue
[03:06:26] *** Joins: ab (alex@BC9D99CC.37C1012D.FE617B51.IP)
[03:06:31] *** Quits: maikklein (maik@moz-5AED6CF8.dip0.t-ipconnect.de) (Ping timeout)
[03:07:07] <bjz_> maikklein2: I've been telling h3r3tic for months now that we're super close - he doesn't believe me any more ^_^
[03:07:09] *** maikklein2 is now known as maikklein
[03:07:20] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[03:07:23] <maikklein> bjz_, haha
[03:07:26] <bjz_> heh
[03:07:36] <bjz_> oh well - all in good time
[03:07:50] <maikklein> bjz_, your quote "This should land soon though, so stay tuned!"
[03:07:51] <maikklein> :D
[03:08:01] <toddaaro> anyone have a link to a presentation with a particularly good "single slide" rust introduction?
[03:08:14] <bjz_> ha
[03:08:24] <aatch> toddaaro, tjc did a Rust talk that had good slides.
[03:08:33] <aatch> I don't have a link on hand unfortunately.
[03:08:53] <aatch> try looking through TWiR posts: cmr.github.io
[03:08:57] <bblum> hmmmmmmmm
[03:09:09] <bblum> i must be misunderstanding something about the visibility rules
[03:09:11] <toddaaro> aatch: ah yes, found them on his site
[03:09:15] <toddaaro> aatch: thanks for the pointer
[03:09:31] <bblum> shouldn't "mod foo;" in a library mean that, even if things inside that mod are public, they are not visible outside the crate?
[03:09:47] <bblum> the goal here is to make something public to the rest of libstd but not visible to the outside
[03:09:49] *** Joins: froystig (froystig@424CFC39.4C7E3E47.E4D621DB.IP)
[03:10:00] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[03:11:00] <maikklein> bblum, yeah that is my understanding of it too
[03:11:18] <maikklein> unless you mark sth pub in the mod 
[03:11:29] <aatch> bblum, I'm not sure. The visibility rules there are a little odd. I don't think we have enough expressiveness for crate-local module-public items
[03:11:38] <bblum> uh, well, hm
[03:11:43] <aatch> Which could be very useful...
[03:11:52] <bblum> i do have pub items inside the mod
[03:12:01] *** Joins: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP)
[03:12:01] *** Quits: gavinb (gavinb@moz-CA19A0CF.vic.adsl.internode.on.net) (Quit: gavinb)
[03:12:06] <bblum> yeah, this would be necessary to solve my select trait problem
[03:12:18] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[03:13:47] <aatch> In terms of exporting the symbols, llvm supports pretty much every sort of visibility. I think a cascading visibility attribute would work.
[03:14:00] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[03:14:00] *** ChanServ sets mode: +o brson
[03:14:07] *** Quits: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP) (Ping timeout)
[03:14:12] *** Quits: froystig (froystig@424CFC39.4C7E3E47.E4D621DB.IP) (Quit: leaving)
[03:14:32] <aatch> so #[visibility=<something other than pub/priv>]
[03:15:05] <aatch> And that cascades in the same way lint attributes do.
[03:15:21] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[03:15:25] <bblum> our visibility stuff is enforced before llvm though
[03:16:02] <bblum> sigh, we don't have a way to do this
[03:16:03] *** Joins: fresawr (Mibbit@2890C718.185376DF.A5DEA753.IP)
[03:16:06] <bblum> this should be a bug
[03:16:09] <aatch> bblum, yeah, you still stick with pub/priv for that side.
[03:16:24] <aatch> bblum, sure, I actually have some thoughts about it, so I'll put them there.
[03:16:30] <bblum> please do yeah
[03:16:42] <aatch> bblum, wait, you open the bug or me?
[03:16:50] <bblum> either?you?
[03:16:55] <aatch> I'll do it then.
[03:17:12] <aatch> (It's a friday afternoon, I'm allowed to slack off)
[03:17:22] <bblum> aatch: basically i think pub items inside nonpub mods should have crate-wide, but no wider, visibility
[03:17:53] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[03:18:30] <aatch> bblum, I did find this though. https://github.com/mozilla/rust/issues/3505
[03:19:18] *** Quits: fresawr (Mibbit@2890C718.185376DF.A5DEA753.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[03:19:20] <jeaye> Congrats on the new runtime, folks. :)
[03:19:39] <bblum> aatch: oh, i will just comment and reopen
[03:19:41] <bblum> aatch: you can comment too
[03:20:20] <aatch> bblum, yeah, I'm just going to confirm some things first (I don't want to write up a ton of stuff based on a faulty mental model)
[03:22:01] *** Joins: kaqurs (Mibbit@2890C718.185376DF.A5DEA753.IP)
[03:22:29] <kaqurs> Rust does not support tail recursion. Is there any macro to emulate it?
[03:22:57] <kaqurs> rusti: if true
[03:22:59] -rusti- <anon>:6:4: 6:5 error: expected `{` but found `}`
[03:22:59] -rusti- <anon>:6     };
[03:22:59] -rusti-              ^
[03:22:59] -rusti- application terminated with error code 101
[03:23:54] <aatch> kaqurs, nope.
[03:24:14] <aatch> kaqurs, but you should be able to re-write it as a loop.
[03:24:41] <kaqurs> aatch: So what should I do? That restriction prevents me from writing purely functional code.
[03:24:58] <engla> rust supports tail recursion, but no TCO
[03:25:10] <aatch> kaqurs, either risk stack overflow, or use a loop.
[03:25:37] <kaqurs> aatch: Loops aren't functional.
[03:25:37] <sp3d> stack overflow, in theory, is as hard to get as OOM (though newrt doesn't expand stacks atm, right?)
[03:25:51] <aatch> kaqurs, so? Rust isn't functional
[03:26:04] <aatch> sp3d, not right now.
[03:26:25] *** Quits: kaqurs (Mibbit@2890C718.185376DF.A5DEA753.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[03:28:25] <jack> I thought there was a Random trait
[03:28:51] <aatch> jack, I think it's called Rand
[03:29:17] <jack> aatch: thanks. somehow i missed it :)
[03:29:42] *** Quits: erickt (etryzelaar@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[03:31:03] *** Quits: maikklein (maik@moz-98BDCEDC.dip0.t-ipconnect.de) (Ping timeout)
[03:32:47] <doomlord_> http://dobkeratops.github.io/rftest/libstd/iterator.rs.html#55 ... more WIP handles traits/generics a bit better
[03:33:46] *** Quits: KindOne (KindOne@moz-AA7E0BE6.dynamic.ip.windstream.net) (Ping timeout)
[03:33:52] *** Joins: rumpler (Mibbit@2890C718.185376DF.A5DEA753.IP)
[03:34:00] *** Quits: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP) (Quit: ëžœë¤ì€ ì‡ í‡´í–ˆìŠµë‹ˆë‹¤.)
[03:34:16] <rumpler> Is it possible to specify default values for function arguments?
[03:36:29] *** Joins: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP)
[03:36:34] <engla> rumpler: it isn't
[03:36:36] *** Joins: gavinb (gavinb@moz-CA19A0CF.vic.adsl.internode.on.net)
[03:37:00] *** Quits: enix (enix@moz-1CD86B39.hsd1.md.comcast.net) (Quit: Konversation terminated!)
[03:37:30] *** Quits: rumpler (Mibbit@2890C718.185376DF.A5DEA753.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[03:37:59] <engla> doomlord_: that's cool!
[03:38:51] <doomlord_> :) motivated by the lack of IDE ..
[03:39:13] *** Joins: KindOne (KindOne@moz-AA302A43.dynamic.ip.windstream.net)
[03:39:29] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[03:42:01] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[03:42:31] *** Quits: eschweic (Adium@moz-CF8BEBEF.dia.static.qwest.net) (Quit: Leaving.)
[03:43:45] *** Quits: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com) (Client exited)
[03:44:06] *** Joins: ruxtea (Mibbit@2890C718.185376DF.A5DEA753.IP)
[03:44:29] *** Quits: panzi (chatzilla@moz-B475CCDD.adsl.highway.telekom.at) (Quit: ChatZilla 0.9.90.1 [Firefox 23.0/20130807192336])
[03:45:03] <erickt1> r? https://github.com/mozilla/rust/pull/8296
[03:45:12] <erickt1> latest version of my remove-trailing-nulls patch
[03:45:23] *** Joins: froystig (froystig@424CFC39.4C7E3E47.E4D621DB.IP)
[03:45:30] *** Joins: recrack (Mibbit@B4104EBB.3CC170B1.1E14B209.IP)
[03:45:51] <ruxtea> Is tail recursion a language design feature or an implementation feature?
[03:45:54] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[03:46:21] <strcat> ruxtea: both
[03:46:33] <strcat> LLVM does sibling call optimization, and it works fine for rust
[03:46:44] *** Parts: ruxtea (Mibbit@2890C718.185376DF.A5DEA753.IP) ()
[03:46:47] <bstrie> acrichto: regarding https://github.com/mozilla/rust/issues/5495 , is it really true that `pub` is forbidden in all the right places now?
[03:46:50] <strcat> so if you *actually* write a tail recursive function where all the recursive calls have the same signature, it will optimize to a loop
[03:47:29] <strcat> LLVM also has the ability to do TCO regardless of matching signatures, but it has a performance impact on all calls to make the guarantee, does not work on all archs and does not work cross-library
[03:47:39] <acrichto> bstrie: hmm... probably not `struct { pub a: int }` is still allowed I think
[03:47:58] * strcat shrugs
[03:48:07] <acrichto> bstrie: but I think specific bugs should be opened now instead of a blanket one
[03:48:19] <strcat> why do people leave before their question is answered ;p
[03:48:26] <brson> erickt1: r+ you're a saint. fyi you can just r=whoever after someone's already reviewed
[03:48:36] <erickt1> thanks brson!
[03:50:30] <bstrie> acrichto: I've reopened it because I'm honestly not sure where pub is allowed where it doesn't need to be
[03:50:43] <bstrie> this is where a parser generated from a formal grammar would be great :P
[03:51:05] <acrichto> bstrie: I'm not sure this is a grammar type thing, but I'll try to write down all the cases that I can think of
[03:51:42] *** Quits: vk_ (chatzilla@F92596F.2DEF7520.EF7679FA.IP) (Quit: ChatZilla 0.9.90.1 [Firefox 23.0/20130729175331])
[03:52:01] <bstrie> "Were I a game programmer I would start learning now. In two years at least 51% of all new video game code will be in Rust."
[03:52:06] <bstrie> HN is a tad optimistic
[03:52:37] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[03:53:15] <doomlord_> is that a quote from somewhere, or wishfull thinking
[03:54:32] *** Joins: mib_leap (Mibbit@894D2C62.9F275360.C28326FD.IP)
[03:55:33] <strcat> acrichto: https://github.com/mozilla/rust/pull/8412 r? very minor perf improvement ;p
[03:55:52] *** Quits: froystig (froystig@424CFC39.4C7E3E47.E4D621DB.IP) (Quit: leaving)
[03:55:53] <strcat> err sec
[03:56:08] <acrichto> strcat: oh whoops
[03:56:11] <acrichto> just r=me anyway
[03:56:16] *** Quits: rustyPipe (Mibbit@moz-5949C51B.dllstx.fios.verizon.net) (Quit: http://www.mibbit.com ajax IRC Client)
[03:56:17] <strcat> yeah I left an unused import
[03:57:15] *** Quits: flowsnake (flowsnake@moz-1918C33E.aztw.cable.virginmedia.com) (Connection reset by peer)
[03:59:20] *** Joins: maikklein (maik@moz-98BDCEDC.dip0.t-ipconnect.de)
[04:01:50] *** Joins: flowsnake (flowsnake@moz-1918C33E.aztw.cable.virginmedia.com)
[04:08:39] *** Quits: Jesin (Jessin_@moz-157A63DD.cc.lehigh.edu) (Ping timeout)
[04:11:51] *** Joins: Jesin (Jessin_@moz-157A63DD.cc.lehigh.edu)
[04:12:33] *** Joins: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP)
[04:13:31] <maikklein> this syntax looks extremly weird "&'self self"
[04:14:35] *** Quits: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP) (Ping timeout)
[04:15:30] <erickt1> hey folks, does anyone know if there's a bug already for this error? https://gist.github.com/erickt/6191149
[04:15:54] <aatch> erickt1, I think so.
[04:16:41] <erickt1> aatch: I thought so too, but I haven't been able to find a issue number yet
[04:17:10] <erickt1> it's easy enough to fix by writing `1i`
[04:17:24] <acrichto> erickt1: that was closed INVALID for me awhile back (5462)
[04:18:15] <erickt1> ah, thanks acrichto! I won't file a bug then
[04:18:54] *** Quits: lkuper (lkuper@63686BC7.F689A8C9.EB438161.IP) (Quit: lkuper)
[04:19:06] <erickt1> I wonder if the IteratorUtil2 is fixing the type to be an integer too early
[04:19:15] <strcat> erickt1: imo the real bug is that it sometimes falls back to an `int`
[04:20:16] <strcat> erickt1: it won't infer from .is_even because it's a method call
[04:20:37] <strcat> it needs to know the type to resolve the method
[04:20:49] <strcat> and that happens before the fallback to an int
[04:21:33] <mib_leap> what is the reason for rust not supporting parameter names for enum variant constructors?
[04:21:50] <aatch> mib_leap, because we struct variants
[04:21:51] <strcat> mib_leap: you can write variants with named fileds
[04:22:00] <strcat> they are the same as structs
[04:22:04] <strcat> enum Foo { Bar }
[04:22:06] <strcat> struct Bar;
[04:22:11] <strcat> enum Foo { Bar(int, int) }
[04:22:16] <strcat> struct Bar(int, int)
[04:22:20] <aatch> enum Foo { Struct { foo: int, bar: int } }
[04:22:25] <strcat> yep
[04:22:26] <aatch> rusti: enum Foo { Struct { foo: int, bar: int } }
[04:22:30] -rusti- ()
[04:22:55] <aatch> rusti: enum Foo { Struct { foo: int, bar: int } } Struct { foo 1, bar 2 }
[04:22:55] -rusti- <anon>:5:59: 5:60 error: expected `;` or `}` after expression but found `{`
[04:22:55] -rusti- <anon>:5          enum Foo { Struct { foo: int, bar: int } } Struct { foo 1, bar 2 }
[04:22:56] -rusti-                                                                     ^
[04:22:56] -rusti- application terminated with error code 101
[04:23:06] *** Joins: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP)
[04:23:06] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/7sR2Tg
[04:23:06] *** Parts: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP) ()
[04:23:26] <aatch> rusti: enum Foo { Struct { foo: int, bar: int } } Struct { foo: 1, bar: 2 }
[04:23:27] -rusti- Struct(1, 2)
[04:23:49] <mib_leap> cool, so the memory layout is tag + struct, right?
[04:23:59] <aatch> mib_leap, it's whatever it wants
[04:24:10] <aatch> representation of enums is undefined.
[04:24:46] <mib_leap> aatch: oh,
[04:24:57] <strcat> for example 'enum Foo<T> { Bar, Baz(~T) }' is represented as a nullable ptr
[04:25:03] <aatch> mib_leap, I mean, you are right. But you can't rely on it.
[04:25:20] <strcat> yeah there's no ABI guarantee
[04:25:42] <strcat> you could expect certain obvious cases to remain pretty much the same, but enum tags will get smaller
[04:26:30] <mib_leap> thanks everyone, one more quick question, what are the rules for the 'as' operator? 
[04:26:47] <aatch> mib_leap, must be a scalar-to-scalar cast
[04:27:05] <aatch> or a pointer-to-trait object cast
[04:27:19] <mib_leap> aatch: scalar means fixed size right?
[04:27:20] <aatch> so `1u8 as int` `~a as ~Trait`
[04:27:30] <aatch> mib_leap, basically numbers and raw pointers.
[04:27:59] <aatch> so `raw_p as uint` works.
[04:28:50] <mib_leap> aatch: when to use transmute and when to use 'as'?
[04:29:24] <aatch> mib_leap, transmute is unsafe and works for any two types that are the same size.
[04:30:02] <aatch> so you can't transmute from u8 to int, for example, because one is 8 bits and the other is 32/64 bits
[04:30:05] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[04:30:38] <aatch> transmute is only needed if you need either get around the type system or do some crazy representation-level stuff
[04:30:54] <mib_leap> aatch, got it, thanks
[04:31:59] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[04:32:05] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[04:32:07] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[04:32:07] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/BFMiXg
[04:32:07] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[04:32:08] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[04:32:08] <ghrust> 01[13rust01] 15bors pushed 30 new commits to 06auto: 02http://git.io/s4VHiQ
[04:32:08] <ghrust> 13rust/06auto 146011f83 15Erick Tryzelaar: std: minor cleanup
[04:32:08] <ghrust> 13rust/06auto 1408b6cb4 15Erick Tryzelaar: std: add str.to_c_str()
[04:32:08] <ghrust> 13rust/06auto 14fd293df 15Erick Tryzelaar: std: rewrite run::with_{argv,envp,dirp} to copy C strings
[04:32:09] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[04:32:11] *** Quits: KindOne (KindOne@moz-AA302A43.dynamic.ip.windstream.net) (Ping timeout)
[04:33:37] <dbaupp> rusti: use std::rand::*; rng().gen::<(uint, uint)>() // jack
[04:33:39] -rusti- (7685297355225533868, 2906989245834999923)
[04:35:49] *** Joins: wting_ (wting@moz-60F72FDF.hsd1.ca.comcast.net)
[04:35:53] *** Quits: wting_ (wting@moz-60F72FDF.hsd1.ca.comcast.net) (Quit: wting_)
[04:36:08] *** Joins: KindOne (KindOne@moz-2ED7D416.dynamic.ip.windstream.net)
[04:36:57] <maikklein> http://stackoverflow.com/questions/18140088/borrow-issue-with-self
[04:41:06] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[04:41:06] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 148483674 to 147a1b61d: 02http://git.io/N3iJvQ
[04:41:06] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[04:41:08] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[04:41:08] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/W4gqjQ
[04:41:08] <ghrust> 13rust/06auto 148d3c62a 15Dmitry Ermolov: Better documentation for --emit-llvm option....
[04:41:08] <ghrust> 13rust/06auto 141fa0a8c 15Dmitry Ermolov: Hide stuff that are not used outside of _match.rs
[04:41:09] <ghrust> 13rust/06auto 141710125 15Dmitry Ermolov: Added testcases for `match` keyword...
[04:41:11] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[04:41:18] <engla> maikklein: when you do this   fn spawn_actor<'r>(&'r self) -> Actor<'r> { }   all of `self` is frozen for the lifetime of Actor<'r>
[04:42:28] *** Quits: aatch (aatch@moz-B437F499.pocketrent.com) (Quit: Leaving)
[04:42:32] <maikklein> hm
[04:43:30] <engla> of course it would be useful sometimes to pass a &'r derived from an object, into that object's &mut method
[04:45:15] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[04:45:50] <maikklein> I don't understand why it freezes
[04:46:29] <maikklein> what could happen that invalidates my GameManger?
[04:46:49] <engla> you are holding a borrowed pointer to Level
[04:47:06] <maikklein> can't I make the borrowed level immutable?
[04:47:15] <strcat> it's doing that for you
[04:47:29] <engla> it's a good question I think
[04:47:35] <strcat> you have to pattern match out of types if you want an &mut to part of it and an & to another part
[04:47:48] <strcat> it won't let you create an overlapping &mut and &
[04:48:38] <strcat> rusti: struct Foo { x: int, y: int }; let mut x = Foo { x: 2, y: 5 }; let Foo { x: ref a, y: ref mut b }; (*a, *b)
[04:48:39] -rusti- pastebinned 14 lines of output: <html>
[04:48:39] -rusti-  <head>
[04:48:39] -rusti-   <title>500 Internal Server Error</title>
[04:48:39] -rusti-  </head>
[04:48:39] -rusti-  <body>
[04:48:39] -rusti-   <h1>500 Internal Server Error</h1>
[04:48:39] -rusti-   The server has either erred or is incapable of performing the requested operation.<br /><br />
[04:48:41] -rusti-  </body>
[04:48:42] -rusti- </html>
[04:48:45] <strcat> great
[04:48:45] *** concrete.mozilla.org sets mode: +M 
[04:49:03] <strcat> sprunge is down ;p
[04:49:07] <acrichto> is there a reason bool isn't i1?
[04:49:24] <strcat> acrichto: yes, it can't be stored that way - most archs can't index bits, and it's inefficient
[04:49:37] <acrichto> bummer
[04:49:41] <strcat> acrichto: it should be stored as i8, and then truncated down to i1 as soon as you load it
[04:49:47] <strcat> and extended to i8 on a store
[04:49:50] <strcat> like clang does
[04:49:55] <acrichto> makes sense I guess
[04:50:00] <strcat> but we leave it as i8
[04:50:05] <strcat> and that's bad
[04:50:12] <acrichto> I was hoping to remove some of the ever-increasing number of intrinsics
[04:50:23] <acrichto> in favor of #[link_name = "llvm.xxx.xxx"]
[04:50:37] <strcat> sadly we can't call any using i1
[04:50:41] <acrichto> yeah :(
[04:50:54] <acrichto> all of the float ones can be removed though
[04:51:46] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[04:51:49] *** Joins: maikklein2 (maik@moz-98BDCEDC.dip0.t-ipconnect.de)
[04:52:56] *** Joins: maikklein3 (maik@moz-98BDCEDC.dip0.t-ipconnect.de)
[04:53:08] *** Quits: maikklein2 (maik@moz-98BDCEDC.dip0.t-ipconnect.de) (Quit: Leaving)
[04:53:14] *** Quits: maikklein3 (maik@moz-98BDCEDC.dip0.t-ipconnect.de) (Quit: Leaving)
[04:53:26] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[04:53:44] *** concrete.mozilla.org sets mode: -M 
[04:54:07] *** Joins: froystig (froystig@C99AC435.145B8BD0.58B1C2DD.IP)
[04:54:16] *** Quits: Jesin (Jessin_@moz-157A63DD.cc.lehigh.edu) (Ping timeout)
[04:54:20] <maikklein> .
[04:54:44] <maikklein> is it possible to recover a password in this irc chan?
[04:55:30] *** Joins: Jesin (Jessin_@moz-157A63DD.cc.lehigh.edu)
[04:56:25] *** Quits: froystig (froystig@C99AC435.145B8BD0.58B1C2DD.IP) (Quit: leaving)
[04:59:10] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[05:01:35] <acrichto> strcat: were you thinking of removing `offset` entirely?
[05:01:41] <acrichto> as an intrinsic
[05:01:41] <strcat> acrichto: yes
[05:01:55] <acrichto> would current users all be updated to offset_inbounds?
[05:01:59] <strcat> I don't see a reason to offset into memory you can't deref from - but maybe there's an edge case
[05:02:02] <strcat> acrichto: yeah
[05:02:18] <acrichto> strcat: well this is defined on *T which we don't necessarily have guarantees about
[05:02:26] <acrichto> for something like ffi stuff maybe
[05:02:28] <strcat> offset_inbounds is unsafe
[05:02:37] <acrichto> but what if you don't want inbounds?
[05:02:37] <strcat> acrichto: you can't deref *T if it's out of bounds
[05:02:42] <strcat> acrichto: why would you?
[05:02:44] <strcat> you can't deref it
[05:02:46] <acrichto> i dunno...
[05:02:52] <acrichto> what does inbounds add?
[05:02:55] <acrichto> llvm-wise
[05:03:04] <strcat> with GEP, indexing out of bounds is not undef, deref is undef
[05:03:18] *** Quits: maikklein (maik@moz-98BDCEDC.dip0.t-ipconnect.de) (Ping timeout)
[05:03:18] <strcat> with inbounds GEP, both are undef - it's much better optimized, and that's what pointer arithmetic does in C/C++
[05:03:36] <strcat> offset is a huge performance cost
[05:03:44] <acrichto> strcat: oh, so should we just remove offset_inbounds and make offset generate gep inbounds?
[05:03:56] <strcat> yeah, and it would be an unsafe fn
[05:03:57] <acrichto> flagging offset as unsafe
[05:04:06] <strcat> we would have to remove the Add/Sub impls
[05:04:07] <acrichto> ok, I'll do that in a cleanup branch I'm working on
[05:04:17] <acrichto> I think that's ok
[05:04:24] <acrichto> it's unsafe anyway
[05:04:27] <acrichto> kinda...
[05:04:30] <strcat> acrichto: it's *possible* there's a use case for GEP, but only in the same way as there's a use case for &const - in that we don't know of one ;p
[05:05:02] <strcat> C doesn't have it, and people get by
[05:05:05] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[05:05:07] <acrichto> hmm... I'll remove it for now in a removable commit and see if a kerfuffle is raised
[05:05:24] <strcat> acrichto: also, inbounds means inside the object or one past the end
[05:05:28] <strcat> so it's still pretty flexible
[05:05:38] <strcat> for example the vec iterator takes advantage of indexing one past the end
[05:05:49] <acrichto> yeah
[05:06:10] <acrichto> man I wanted to remove the memcpy intrinsics as well
[05:06:11] <acrichto> damn i1
[05:06:25] <strcat> acrichto: you could probably cut those in half
[05:06:33] <acrichto> how so?
[05:06:35] <strcat> by branching on 32 vs 64 bit in foreign.rs
[05:06:52] <acrichto> they're already a helper function
[05:07:02] *** Joins: thpickert (thpickert@moz-34341F25.dynamic.dsl.tng.de)
[05:07:13] <strcat> acrichto: yeah but they're exposed as memset{32,64}, etc.
[05:07:37] <acrichto> oh as in the generation of 32vs64 is like one extra line in the compiler
[05:07:41] *** Joins: vk_ (chatzilla@moz-389FEE13.hsd1.ca.comcast.net)
[05:07:46] <acrichto> removing one wouldn't help a whole lot
[05:08:39] <strcat> acrichto: the use case of GEP vs inbounds GEP is indexing out of the object and then *back into it* before you deref
[05:08:53] <strcat> it's a very theoretical use case imo
[05:09:02] <strcat> acrichto: LLVM originally only had inbounds GEP - and it was just GEP
[05:09:07] <strcat> they split it
[05:09:40] <strcat> can go find that thread and see why they even have non-inbounds
[05:09:42] <strcat> what the use case is
[05:09:58] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[05:09:59] <acrichto> I had no idea that the non-inbounds was an obscure ase
[05:10:27] <strcat> acrichto: http://llvm.1065342.n5.nabble.com/new-LLVM-IR-features-td36053.html
[05:11:16] <strcat> well maybe there's a better thread ;p
[05:11:52] <strcat> acrichto: http://lists.cs.uiuc.edu/pipermail/llvmdev/2009-July/024248.html here it is
[05:12:45] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Connection reset by peer)
[05:12:59] <acrichto> strcat: interesting, thanks!
[05:13:01] *** Joins: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP)
[05:13:14] <strcat> acrichto: look at the thread view, because clicking next thread will go into a separate thread ;p
[05:13:38] <strcat> anyway I'm surprised that was in 2009
[05:14:07] <strcat> but I guess LLVM being a solid compiler is new ;p
[05:14:54] <acrichto> oh yay I can remove morestack_addr
[05:15:05] *** Quits: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP) (Ping timeout)
[05:15:26] <strcat> acrichto: one silly example of us depending on that is how the 2nd offset parameter was a uint
[05:15:35] <strcat> so if you wanted to do -1, it would pass uint::max_value and wrap
[05:15:41] <strcat> undef behaviour with inbounds
[05:15:50] <acrichto> oh yeah I can see where that'd be bad
[05:15:58] <acrichto> we like our optimizations...
[05:16:21] <strcat> rusti: 2 + std::uint::max_value
[05:16:22] -rusti- 1
[05:16:24] <strcat> so yeah
[05:17:10] *** Joins: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net)
[05:17:31] *** Quits: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net) (Quit: ozten)
[05:22:41] *** Joins: fyolnish (fyolnish@moz-BE2BAE5B.miinet.jp)
[05:23:01] <fyolnish> hi, I just compiled from trunk
[05:23:13] <fyolnish> but every time I try to compile anything I get "error: multiple matching crates for `std`"
[05:23:22] <strcat> fyolnish: seems you still have an old rust around
[05:23:33] <fyolnish> hm, let me double check
[05:24:28] *** Joins: mihneadb (mihneadb@E48845AB.3A9F9BD4.4C2245EF.IP)
[05:24:50] <strcat> rusti: 2
[05:24:50] -rusti- Bad system call
[05:24:51] -rusti- application terminated with error code 159
[05:24:54] <strcat> huh
[05:25:00] <strcat> silly new runtime
[05:25:04] <strcat> makes some new syscall
[05:25:06] * strcat debugs
[05:25:27] <fyolnish> abh
[05:25:37] <fyolnish> you were right
[05:25:41] <fyolnish> the prefix I installed to was dirty
[05:26:16] <strcat> pipe2, epoll_create1
[05:26:31] <strcat> rusti: 1
[05:26:31] -rusti- 1
[05:26:36] <strcat> rusti: 2 + 2
[05:26:37] -rusti- 4
[05:26:44] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[05:27:35] <strcat> aha
[05:28:51] <tiffany> how do you iterate through the characters of a string?
[05:29:17] <mihneadb> rusti: for ch in "hello" { printfln!("%?", ch) }
[05:29:17] -rusti- <anon>:5:9: 6:5 error: type `&mut &'static str` does not implement any method in scope named `next`
[05:29:17] -rusti- <anon>:5          for ch in "hello" { printfln!("%?", ch) }
[05:29:17] -rusti- <anon>:6     };
[05:29:18] -rusti- error: aborting due to previous error
[05:29:18] -rusti- application terminated with error code 101
[05:29:23] <mihneadb> rusti: for ch in "hello".iter() { printfln!("%?", ch) }
[05:29:24] -rusti- pastebinned 6 lines of output: <html>
[05:29:24] -rusti-  <head>
[05:29:24] -rusti-   <title>500 Internal Server Error</title>
[05:29:24] -rusti-  </head>
[05:29:24] *** concrete.mozilla.org sets mode: +M 
[05:29:24] -rusti-  <body>
[05:29:24] -rusti-   <h1>500 Internal Server Error</h1>
[05:29:24] -rusti-   The server has either erred or is incapable of performing the requested operation.<br /><br />
[05:29:27] <mihneadb> rusti: for ch in "hello".iter() { printfln!("%?", ch) }
[05:29:29] -rusti-  </body>
[05:29:30] -rusti- </html>
[05:29:32] -rusti- pastebinned 6 lines of output: <html>
[05:29:33] -rusti-  <head>
[05:29:34] -rusti-   <title>500 Internal Server Error</title>
[05:29:35] -rusti-  </head>
[05:29:36] -rusti-  <body>
[05:29:37] -rusti-   <h1>500 Internal Server Error</h1>
[05:29:38] -rusti-   The server has either erred or is incapable of performing the requested operation.<br /><br />
[05:29:39] <mihneadb> rusti is broken :(
[05:29:43] -rusti-  </body>
[05:29:44] -rusti- </html>
[05:29:59] <mihneadb> rusti: 5
[05:29:59] -rusti- 5
[05:30:02] <mihneadb> rusti: for ch in "hello".iter() { printfln!("%?", ch) }
[05:30:03] -rusti- pastebinned 6 lines of output: <html>
[05:30:03] -rusti-  <head>
[05:30:03] -rusti-   <title>500 Internal Server Error</title>
[05:30:03] -rusti-  </head>
[05:30:03] -rusti-  <body>
[05:30:03] -rusti-   <h1>500 Internal Server Error</h1>
[05:30:03] -rusti-   The server has either erred or is incapable of performing the requested operation.<br /><br />
[05:30:05] -rusti-  </body>
[05:30:06] -rusti- </html>
[05:30:57] <mihneadb> tiffany: anyway, that line works for me in rusti
[05:31:07] <mihneadb> watch out however, that is utf8
[05:32:33] <tiffany> is the in syntax changed from rust 0.7?
[05:32:50] *** Quits: Jesin (Jessin_@moz-157A63DD.cc.lehigh.edu) (Ping timeout)
[05:33:31] *** Joins: Jesin (Jessin_@moz-157A63DD.cc.lehigh.edu)
[05:34:01] *** Joins: tikue (tkuehn@moz-CF8BEBEF.dia.static.qwest.net)
[05:34:10] <mihneadb> tiffany: yes, this is the rust that is on github master
[05:34:11] <strcat> mihneadb: it's not broken, the pastebin site it uses is
[05:34:11] <mihneadb> HEAD
[05:34:13] <strcat> ;p
[05:34:20] <strcat> let me switch it to paste.xinu.at
[05:34:24] *** concrete.mozilla.org sets mode: -M 
[05:34:24] <mihneadb> strcat: my bad, actually it was obvious
[05:34:35] <mihneadb> strcat: I am trying to convert myself to use refheap
[05:34:41] <mihneadb> https://www.refheap.com/
[05:34:53] <mihneadb> powered by clojure
[05:34:59] <mihneadb> they use persona
[05:35:20] <strcat> but paste.xinu.at lets me paste up to 1GiB files ;p
[05:35:26] * strcat preferred ompldr but it's dead
[05:35:41] <mihneadb> strcat: I don't know what the limits are on refheap but probably enough for rusti :P
[05:36:07] <mihneadb> tiffany: in 0.7 I think you can do something like .each or .advance, strcat would know better
[05:36:38] <strcat> 0.7 has the old for loop, so advance is needed as an adaptor
[05:36:49] <strcat> you really want to use master though ;p
[05:37:52] <strcat> goodbye sprunge
[05:37:55] <mihneadb> :)
[05:37:57] <strcat>         r = requests.post("http://sprunge.us", {"sprunge": b"".join(lines)})
[05:38:01] <strcat> what a nice api though ;p
[05:38:37] <strcat> ix.io is pretty nice too
[05:39:11] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[05:39:16] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:39:31] <strcat> rusti: for i in range(0, 5) { printfln!("%d", i) }
[05:39:32] -rusti- pastebinned 6 lines of output: ERROR f: 0
[05:39:32] -rusti- 1
[05:39:32] -rusti- 2
[05:39:32] -rusti- 3
[05:39:33] -rusti- 4
[05:39:33] -rusti- ()
[05:39:33] -rusti- http://ix.io/
[05:39:35] <strcat> heh
[05:39:55] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[05:41:03] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:41:07] <strcat> rusti: for i in range(0, 5) { printfln!("%d", i) }
[05:41:12] -rusti- pastebinned 6 lines of output: http://ix.io/79q
[05:41:19] <strcat> rusti: for i in range(0, 5) { printfln!("%d", i) }
[05:41:21] -rusti- pastebinned 6 lines of output: http://ix.io/79q
[05:41:32] <strcat> rusti: for i in range(0, 10) { printfln!("%d", i) }
[05:41:35] -rusti- pastebinned 11 lines of output: http://ix.io/79r
[05:41:40] <strcat> slower than sprunge ;[
[05:42:02] <mihneadb> does the job I guess
[05:42:32] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[05:42:32] *** ChanServ sets mode: +o brson
[05:44:51] <mihneadb> I might do a rust cli tool to pastebin on refheap.com 
[05:44:59] <mihneadb> practice some rust
[05:45:38] <strcat> ix.io is almost as simple as sprunge, at least
[05:45:42] <strcat> r = requests.post("http://ix.io", {"f:0": b"".join(lines)}) ;p
[05:45:43] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Client exited)
[05:47:40] *** Joins: jdm (jdm@9FB21CB6.76DE1AD5.AE2B2F80.IP)
[05:50:18] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[05:51:53] <mihneadb> strcat: what's f?
[05:52:17] <strcat> just the key they use to mean file content
[05:52:34] <strcat> and you have to give an arbitrary id, because you can paste N files per POST along with other commands
[05:53:38] <mihneadb> oh
[05:53:38] <mihneadb> ok
[05:53:52] <mihneadb> so I take it your rusti wrapper is python?
[05:54:39] <strcat> well
[05:54:43] <strcat> the irc bot is pytho
[05:54:45] <strcat> n
[05:55:14] <strcat> https://github.com/thestinger/playpen the important part
[05:55:25] *** Joins: maikklein (maik@moz-98BDCEDC.dip0.t-ipconnect.de)
[05:55:34] *** Quits: LimeBurst (me@247D1419.D73964AC.27A8748.IP) (Quit: leaving)
[05:55:35] <mihneadb> oh nice
[05:55:39] <mihneadb> cgroups and everything
[05:55:43] *** Joins: LimeBurst (me@247D1419.D73964AC.27A8748.IP)
[05:55:58] <strcat> mihneadb: http://ix.io/79s for example here's my web frontend version, just a thin wrapper
[05:56:03] <maikklein> .
[05:56:13] *** Joins: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP)
[05:56:32] <mihneadb> strcat: nice!
[05:56:50] *** maikklein is now known as maik
[05:58:35] *** Joins: MaikKlein (maik@moz-98BDCEDC.dip0.t-ipconnect.de)
[05:58:38] <strcat> playpen could be rust, but I'm lazy and 90% of it would be declaring C function definitions + dealing with varargs somehow
[05:58:40] *** Parts: MaikKlein (maik@moz-98BDCEDC.dip0.t-ipconnect.de) (Leaving)
[05:58:57] <mihneadb> don't think it's worth it
[05:59:17] <mihneadb> strcat: so I was wondering.. what is keeping rust from being a general purpose language?
[05:59:17] *** Joins: maik_ (maik___@moz-98BDCEDC.dip0.t-ipconnect.de)
[05:59:24] *** Quits: maik_ (maik___@moz-98BDCEDC.dip0.t-ipconnect.de) (Quit: Leaving)
[05:59:24] *** Quits: maik (maik@moz-98BDCEDC.dip0.t-ipconnect.de) (Quit: Leaving)
[05:59:29] <strcat> it is a general purpose language ;P
[05:59:32] <ChrisMorgan> Maturity?
[05:59:45] *** Joins: maik (maik___@moz-98BDCEDC.dip0.t-ipconnect.de)
[05:59:50] <mihneadb> strcat: you guys advertise it as a systems language
[05:59:57] <mihneadb> ChrisMorgan: I meant in the long run :)
[06:00:13] <strcat> a systems language is a general purpose language
[06:00:22] <strcat> almost everything is written in C or C++
[06:00:51] <mihneadb> right
[06:01:08] <mihneadb> but I mean more than that
[06:01:13] <mihneadb> not necessarily like python
[06:01:26] <mihneadb> but.. something more than "I need to write a driver" or whatever like that
[06:01:32] <strcat> python has a nicer stdlib than rust, only reason I still use python for anything
[06:01:41] <strcat> I'd love to write web stuff in rust, but it needs http
[06:01:52] <mihneadb> strcat: ok, so there is a goal of that
[06:02:07] <mihneadb> for example some guy made the "revel" web framework for go, which mimics Play, which is kind of nice
[06:02:19] <strcat> and it needs automatic integration with C libraries via libclang to make something like playpen painless to write
[06:02:35] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Ping timeout)
[06:02:49] <strcat> there's bindgen, but it should be done by rustc on-demand at compile-time from the platform's headers
[06:03:45] * jdm shakes his fist at varags
[06:03:51] <strcat> #[header = "sqlite3.h"] #[link_args = "-lsqlite3"] extern {}, something like that and not needing to declare anything
[06:03:54] <jdm> and by extension, spidermonkey error reporting
[06:03:56] <mihneadb> I'd say a wider stdlib would get you closer to more people using it
[06:04:11] <maik> i heard only bad things from play
[06:04:30] <strcat> jdm: yeah I'm almost tempted to talk to the linux kernel directly instead of using libseccomp2 :s
[06:04:34] <mihneadb> also I'd love map literals. 
[06:04:45] <strcat> jdm: berkeley packet filter by hand is actually kind of fun ;p
[06:04:50] <mihneadb> maik: I don't know, I only checked out revel and it seemed pretty nice for a 1.0 language
[06:04:51] <jdm> eww
[06:05:18] <sp3d> I *almost* wrote a shell script in rust the other day, but the stdlib was lacking w/r/t chmod and other file utils
[06:05:18] <strcat> seccomp uses varargs as sugar for the rule definitions
[06:05:26] <strcat> libseccomp*
[06:06:03] * ChrisMorgan doesn't like the look of some things in Play... too much "code" in other than the programming language
[06:06:20] <mihneadb> ChrisMorgan: I think that is more the fault of java
[06:06:26] * mihneadb is just making guesses
[06:06:32] <ChrisMorgan> But I guess there's this: at least it isn't XML.
[06:07:04] <mihneadb> haha
[06:07:36] *** Quits: recrack (Mibbit@B4104EBB.3CC170B1.1E14B209.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[06:07:44] <ChrisMorgan> Seriously, enterprise Java code seems to spend most of its time trying to work around Java's static typing...
[06:07:51] *** Joins: recrack (Mibbit@B4104EBB.3CC170B1.1E14B209.IP)
[06:07:54] <ChrisMorgan> brson: BTW, I caved to pressure and so my HTTP stuff is now maintained at https://github.com/chris-morgan/rust-http
[06:08:47] <strcat> :)
[06:08:57] <brson> ChrisMorgan: beautiful :)
[06:09:38] <brson> lol
[06:10:01] *** Joins: alisdair (textual@moz-FBF4138A.vc.shawcable.net)
[06:10:12] <strcat> it's too bad we don't have more of rust's history in the git repo
[06:10:24] <ChrisMorgan> brson: I've just put up https://github.com/chris-morgan/rust-http/blob/master/doc/client-plan.rst, any comments on it?
[06:10:52] *** Joins: froystig (froystig@moz-7B0110AD.mv.mozilla.com)
[06:11:11] <ChrisMorgan> I've started refactoring it to provide an HTTP client today, hence libhttp rather than the initial name of librusthttpserver.
[06:11:11] *** Quits: froystig (froystig@moz-7B0110AD.mv.mozilla.com) (Quit: leaving)
[06:11:51] <mihneadb> strcat: so is that static try rust of yours hosted somewhere?
[06:12:07] <strcat> mihneadb: not yet, I want it to be on rust-lang.org
[06:12:17] <mihneadb> strcat: do it! :)
[06:12:21] <strcat> the sample on the main page could be executable - I just can't host it myself, my internet sucks
[06:12:50] <mihneadb> strcat: I hear this mozilla company deals with lots of internet stuff :P
[06:12:50] <strcat> it didn't used to suck this much but rogers got much worse ;[
[06:13:32] *** Joins: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP)
[06:14:36] <strcat> ace has support for rust so you even get a nice text editor with syntax highlighting, code folding, etc.
[06:14:40] <strcat> and hey, even a vim mode.
[06:14:46] <mihneadb> strcat: oh yes
[06:14:47] <mihneadb> seriously
[06:14:51] <mihneadb> this has to exist!
[06:15:01] <mihneadb> willing to help if I can
[06:15:07] <strcat> well it exists as a few files next to rusti the irc bot
[06:15:35] *** Quits: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP) (Ping timeout)
[06:15:35] *** Joins: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru)
[06:15:40] <mihneadb> I m pretty sure the website gives more exposure
[06:15:42] <strcat> it'd be neat to make a few roots with different versions of rust and have that be a drop-down selection
[06:15:59] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[06:16:38] <strcat> atm, the latest stable + git master
[06:16:54] *** Joins: mrordinaire (Mibbit@1A659656.A607747.FD383126.IP)
[06:17:17] <mihneadb> sure
[06:17:26] <mihneadb> imo for starters even one is fine
[06:17:38] <mrordinaire> hi, could anyone give me some pointer on how to fix https://github.com/mozilla/rust/issues/8392 ?
[06:18:30] <strcat> mihneadb: yeah I am enthusiastic about it, don't worry :) - it'll happen
[06:19:09] <mihneadb> strcat: ok, nice. ping if you need some sort of help, I'm sure you guys are busy with core language stuff which I can't help out with anyway
[06:21:49] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[06:21:55] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Connection reset by peer)
[06:22:27] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[06:27:01] *** Joins: fabiand (fabiand@moz-5D01EC14.adsl.alicedsl.de)
[06:27:15] *** Quits: mrordinaire (Mibbit@1A659656.A607747.FD383126.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[06:31:51] *** Joins: z0w0 (zack@moz-E12708D5.lns6.woo.bigpond.net.au)
[06:35:53] *** Quits: maik (maik___@moz-98BDCEDC.dip0.t-ipconnect.de) (Ping timeout)
[06:40:15] <brson> ChrisMorgan: omg what timezone are you in?! you always catch me when I'm exhausted ...
[06:40:22] <ChrisMorgan> brson: AEST
[06:40:31] <ChrisMorgan> 4:40pm
[06:40:33] <brson> lol
[06:41:00] * ChrisMorgan is writing an HTTP client right now
[06:41:46] <brson> ChrisMorgan: thanks for the refactoring and docs. I intend to start focusing on this topic soon, maybe tomorrow.
[06:41:55] <ChrisMorgan> I'll see what I can have done by then.
[06:42:03] <ChrisMorgan> Then you shall see what I have in mind.
[06:42:04] <brson> i'll read this eagerly, though maybe not tonight
[06:43:16] <strcat> mihneadb: https://github.com/cdnjs/cdnjs/pull/1686 assuming they merge that, I could at least run it alongside the irc bot
[06:43:43] <ChrisMorgan> That document is already a little out of date as I've actually tried doing it.
[06:43:46] <strcat> but it's too much to serve with their crappy 1mbit upload that's really a lot smaller most of the time ;p
[06:44:35] * strcat thinks it has to do with them cracking down on P2P - anything that's encrypted like ssh/https is throttled and if you have >20 conns it starts sending tcp rsts :(
[06:44:42] <strcat> yay canada
[06:45:05] *** Joins: Ms2ger (Ms2ger@35CC4A24.2B12F798.F15B0BB3.IP)
[06:45:06] *** Joins: maik (maik___@moz-98BDCEDC.dip0.t-ipconnect.de)
[06:45:06] <mihneadb> wow, sketchy
[06:45:20] <mihneadb> strcat: so you'd serve it from the CDN? can you do that?
[06:45:32] <strcat> mihneadb: well, would serve ace from there
[06:45:37] <strcat> maybe there's actually a CDN with it
[06:45:41] <mihneadb> ah, just for ace
[06:46:04] <mihneadb> strcat: but don't you guys have a server for rust-lang.org already?
[06:46:48] <strcat> mihneadb: I don't work at mozilla :), and I don't think it's trivial to just deploy a new server
[06:47:05] <mihneadb> strcat: ah, I thought you did
[06:47:19] <strcat> I think graydon put in a request for it
[06:47:27] * strcat doesn't know what that entails
[06:47:30] <mihneadb> right
[06:47:37] <mihneadb> but.. isn't the website on some server already?
[06:47:44] <mihneadb> or is it some sort of github pages static site thing
[06:47:45] <strcat> ideally, it would have a dedicated machine
[06:48:02] <strcat> spinning up rustc instances concurrently and running user code with a cap at 128MiB needs a lot of memory
[06:48:06] <strcat> cap of*
[06:48:21] <strcat> if it was on the main page at least
[06:48:25] <ChrisMorgan> I can see that falling over when it gets to HN.
[06:48:32] <mihneadb> yeah
[06:48:44] <strcat> ChrisMorgan: the only limit is memory
[06:48:51] <strcat> there's no contention between playpen instances
[06:48:52] *** Joins: tchoma (tchoma@moz-E58E29CC.dsl.static.sonic.net)
[06:49:02] <strcat> ofc someone could DoS it
[06:49:57] <mihneadb> strcat: since rust is getting pretty big and important and we even have partnerships with samsung on servo.. I think mozilla could find the resources
[06:50:02] <strcat> with ~4GiB of memory dedicated to it, it could easily do 30 concurrent requests
[06:50:17] <strcat> mihneadb: more about needing to spend the time setting it up than resources
[06:50:39] <mihneadb> strcat: should be like a day, I guess
[06:51:03] <fyolnish> where exactly is the parser? I cannot seem to find the grammar
[06:51:17] <mihneadb> anyway I m off to sleep, good night / bye
[06:51:22] *** Quits: mihneadb (mihneadb@E48845AB.3A9F9BD4.4C2245EF.IP) (Input/output error)
[06:52:25] <strcat> ChrisMorgan: also the timeout could be something like 1s instead of 5s
[06:53:18] *** Joins: sebcrozet (sebcrozet@moz-7FB6C00B.w193-252.abo.wanadoo.fr)
[06:53:34] *** Quits: maik (maik___@moz-98BDCEDC.dip0.t-ipconnect.de) (Ping timeout)
[06:54:29] *** Joins: froystig (froystig@moz-288D8DB1.hfc.comcastbusiness.net)
[06:55:04] *** Quits: tchoma (tchoma@moz-E58E29CC.dsl.static.sonic.net) (Quit: tchoma)
[06:56:13] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[06:56:30] *** Joins: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net)
[06:58:29] *** Joins: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP)
[06:58:56] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[07:02:18] * ChrisMorgan wishes he could conveniently have enum inheritance like enum GeneralHeader { A(...), B(...) } enum EntityHeader { C(...), D(...) } enum RequestHeader { *GeneralHeader, *EntityHeader, E(...), F(...) } enum ResponseHeader { *GeneralHeader, *EntityHeader, G(...), H(...) }
[07:03:01] <hopplaboppla> Does the compiler check that the arguments to fmt! are given the right types?
[07:03:09] <ChrisMorgan> Sure.
[07:03:16] <hopplaboppla> That is just awesome!
[07:03:17] <shachaf> ChrisMorgan: Where {Request,Response}Header would be 6-ary sums?
[07:03:55] <strcat> hopplaboppla: fmt! is a syntax extension, so it basically reads in some tokens and outputs a rust AST
[07:04:01] <strcat> so the regular type checking catches errors
[07:04:19] *** Quits: gavinb (gavinb@moz-CA19A0CF.vic.adsl.internode.on.net) (Quit: gavinb)
[07:04:30] <strcat> (in the future, user-defined syntax exts will be possible)
[07:04:41] <ChrisMorgan> shachaf: https://github.com/chris-morgan/rust-http/blob/master/src/libhttp/headers.rs#L646-786
[07:04:54] *** Joins: jaen (jaen@moz-ED2EC791.neoplus.adsl.tpnet.pl)
[07:04:59] <strcat> rusti: fmt!("%d", "foo")
[07:05:01] -rusti- pastebinned 7 lines of output: http://ix.io/79x
[07:05:09] <strcat> that's why it says 'expansion site'
[07:06:06] <shachaf> ChrisMorgan: Those don't have any common fields, do they?
[07:06:16] <shachaf> Well, I guess they're supposed to?
[07:07:02] <ChrisMorgan> shachaf: they don't; but a request can have headers which are general-header, entity-header or request-header.
[07:07:19] <ChrisMorgan> Observe the nasty AnyRequestHeader below.
[07:07:32] *** Quits: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru) (Quit: dim-an)
[07:07:32] <shachaf> You can do but something like enum RequestHeader { General(GeneralHeader), ... } but I guess you don't like the extra nesting?
[07:07:45] <ChrisMorgan> Indeed.
[07:07:50] <strcat> ChrisMorgan: if we had scheme-like identifiers you could just use the repr of enum variants for that fn ;p
[07:08:11] <strcat> those fns*
[07:08:17] <shachaf> I guess that's what AnyRequestHeader is doing. I'm not sure whether inlining it directly is really reasonable to do, rather than having it as an extra variant.
[07:08:43] <ChrisMorgan> At present I'm leaning towards inlining, wrapping them up in a separate module for the purpose.
[07:08:51] <hopplaboppla> How do i do unit testing in rust? "rustpkg test" says something like 'test not yet implemented'
[07:09:18] <shachaf> By "inheritance" you mean a kind of subtyping also?
[07:09:32] *** Joins: maik (maik___@moz-98BDCEDC.dip0.t-ipconnect.de)
[07:09:32] <ChrisMorgan> hopplaboppla: `rust test x.rs` or `rustc --test x.rs && ./x --test`
[07:09:43] <ChrisMorgan> Well, I don't actually care about that.
[07:09:46] * shachaf doesn't quite know how sum subtyping works except that it's somewhat different from product subtyping (like prisms vs. lenses).
[07:10:32] <ChrisMorgan> It'd be nice, though, if one could have the enum variants in the same module and which could be of one of two different types. But I know that'd cause a lot of trouble.
[07:10:36] <hopplaboppla> thx
[07:10:40] *** Quits: maik (maik___@moz-98BDCEDC.dip0.t-ipconnect.de) (Connection reset by peer)
[07:11:08] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[07:11:08] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/W4gqjQ
[07:11:08] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[07:11:28] <strcat> ChrisMorgan: http://smallcultfollowing.com/babysteps/blog/2012/08/24/datasort-refinements/ tangentially related
[07:11:55] *** Quits: vk_ (chatzilla@moz-389FEE13.hsd1.ca.comcast.net) (Quit: ChatZilla 0.9.90.1 [Firefox 23.0/20130729175331])
[07:13:09] *** Joins: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru)
[07:14:01] *** Quits: jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net) (Quit: zzz)
[07:14:07] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[07:14:07] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/KzKidQ
[07:14:07] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[07:14:24] *** Quits: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru) (Quit: dim-an)
[07:17:08] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[07:17:08] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/KzKidQ
[07:17:08] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[07:17:09] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[07:17:09] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/1YNwIw
[07:17:09] <ghrust> 13rust/06auto 14b4d6ae5 15OGINO Masanori: Remove redundant Ord method impls....
[07:17:09] <ghrust> 13rust/06auto 14094e426 15bors: auto merge of #8357 : omasanori/rust/cleanup, r=alexcrichton...
[07:17:10] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[07:19:42] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[07:21:08] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[07:22:49] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[07:23:58] <mib_leap> is it possible to give an llvm ir file as input to rustc?
[07:25:08] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[07:27:21] * ChrisMorgan wonders how to resolve a domain name
[07:27:52] <ChrisMorgan> mib_leap: surely you'd pass it to LLVM instead?
[07:28:19] <dbaupp> ChrisMorgan: how was the talk?
[07:29:02] <ChrisMorgan> dbaupp: t'was good. Got tolerable answers to my questions, but alas! he did not know quite how one would start something like Servo :-)
[07:29:37] <mib_leap> ChrisMorgan: does building rustc alsob build llvm binaries?
[07:31:15] <ChrisMorgan> mib_leap: yes, in llvm/*/Release+Asserts/bin/ (* being x86_64-unknown-linux-gnu for me)
[07:32:04] *** Quits: alisdair (textual@moz-FBF4138A.vc.shawcable.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[07:34:06] <acrichto> strcat: I tried adding an attribute #[last_i1 = "0"] for memset/ctlz intrinsics, but memset requires a constant alignment, that makes me sad that this can't be a thing
[07:34:51] <strcat> acrichto: yeah that's why I had to make those use a generic type param
[07:35:06] <dbaupp> acrichto: fwiw, jensnockert did a pile of work to move the intrinsics out of the compiler
[07:35:21] <dbaupp> (it didn't get merged)
[07:35:34] <acrichto> strcat: yeah I was basing mine of his, do you think it's worth leaving the last_i1 for the ctlz/cttz intrinsics?
[07:35:35] <dbaupp> (this is assuming that you're working on something like that.)
[07:35:44] *** Quits: flowsnake (flowsnake@moz-1918C33E.aztw.cable.virginmedia.com) (Connection reset by peer)
[07:35:51] <acrichto> it's like an extra ~20 lines in one function
[07:35:53] <ChrisMorgan> Looks like I need to see if I can port get_addr from https://github.com/mozilla/rust/blob/9ed82fbb43804ebc7e06daca5812079630ec8952/src/libextra/net/ip.rs to std::rt::io::net::ip.
[07:36:12] <strcat> acrichto: dunno, seems almost more complex than just exposing them as intrinsics
[07:36:13] <acrichto> dbaupp: yeah I'm basically doing the same thing, but not using this constant_arg thing
[07:36:36] *** Quits: Ms2ger (Ms2ger@35CC4A24.2B12F798.F15B0BB3.IP) (Quit: bbl)
[07:36:47] <acrichto> strcat: intrinsics are sad b/c they're defined in 3 separate locations when it seems like those should be inferred
[07:36:55] <strcat> acrichto: agreed
[07:37:12] * strcat shrugs
[07:37:42] *** Quits: jdm (jdm@9FB21CB6.76DE1AD5.AE2B2F80.IP) (Ping timeout)
[07:37:44] <mib_leap> ChrisMorgan: thanks
[07:37:48] <acrichto> well it looks like the only other instruction with a trailing i1 is llvm.objectsize...
[07:38:09] <brson> ChrisMorgan: DNS resolution is a high priority and not implemented in rt::io
[07:39:28] <ChrisMorgan> brson: I presume you mean the getaddrinfo stuff that old implementation depended on isn't there?
[07:39:47] <strcat> I guess it'd be async
[07:39:58] <strcat> under the hood
[07:40:00] <brson> yeah
[07:40:30] <ChrisMorgan> I guess that HTTP client won't get name resolution for the moment, then.
[07:40:35] *** Joins: flowsnake (flowsnake@moz-1918C33E.aztw.cable.virginmedia.com)
[07:40:42] *** Joins: alisdair (textual@moz-FBF4138A.vc.shawcable.net)
[07:41:07] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[07:41:31] <mib_leap> ChrisMorgan: I have an .ll file generated by rustc. how to i turn it into a rust crate?
[07:41:50] * ChrisMorgan doesn't know if it's possible
[07:42:50] <mib_leap> ChrisMorgan: Or can i use llvm to generate the object file and then pass it to rustc?
[07:43:11] * ChrisMorgan doesn't know much about rustc yet
[07:43:38] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Connection reset by peer)
[07:43:55] <dbaupp> ChrisMorgan: you could just shell out to nslookup or whatever
[07:44:01] <mib_leap> ChrisMorgan: no problem, will try to figure something out
[07:44:44] <dbaupp> mib_leap: I believe you use one of the llvm tools, not rustc
[07:45:07] <brson> llc will do it, but you'll need to also link to morestack.a at the least
[07:45:41] <mib_leap> dbaupp: i need a crate
[07:45:52] <mib_leap> from an .ll file generated by rustc
[07:46:08] <dbaupp> mib_leap: the .ll file should include all the information that llvm needs to make a proper crate
[07:46:35] <mib_leap> dbaupp: what about the name of the generated dll?
[07:46:40] <brson> mib_leap: if you run rustc with RUST_LOG=middle::trans::link it will show how rustc invokes the linker and that will  give some hints about how to build a crate
[07:47:05] <mib_leap> brson: thanks i;ll try it 
[07:47:15] <dbaupp> -Z print-link-args probably does something similar
[07:47:16] <brson> figuring out the name-mangled dll name without using rustc is pretty hopeless though - it's a complex hash
[07:47:58] <dbaupp> brson: it appears the newrt gives a faster bootstrap, btw.
[07:48:16] <brson> dbaupp: nice! what do you mean by 'bootstrap' exactly
[07:48:18] <dbaupp> (the buildbot graphs have finally updated.)
[07:48:32] <brson> crap I completely forgot to fix the local heap regressions today
[07:48:51] <dbaupp> http://huonw.github.io/isrustfastyet/buildbot/ boostrap == the build the builders do
[07:48:57] <brson> that was like all i worked on today and then i just ... drifted off
[07:49:17] <brson> well, nice! I'm glad that huge spike wasn't real
[07:49:49] <brson> it's already 1 am :(
[07:52:25] <ChrisMorgan> dbaupp: :-( memory figures aren't being updated
[07:52:59] <dbaupp> ChrisMorgan: /mem ?
[07:53:12] <dbaupp> ChrisMorgan: i'm not being fed data
[07:53:30] <ChrisMorgan> Can anything be done about it?
[07:53:35] <dbaupp> pester cmr
[07:53:50] <dbaupp> (well, not really, it's going to be up in the near future.)
[07:54:10] *** Quits: sebcrozet (sebcrozet@moz-7FB6C00B.w193-252.abo.wanadoo.fr) (Ping timeout)
[07:54:31] *** Joins: sebcrozet (sebcrozet@moz-A855F6C0.w82-127.abo.wanadoo.fr)
[07:55:36] <mib_leap> brson, middle:trans::link doesn't seem to be in the crate map, and also only rustc::middle::resolve is availabe according to RUST_LOG=::help
[07:55:43] <ChrisMorgan> Looks like 32-bit builds are slower and 64-bit faster. Suits me, I use a 64-bit OS.
[07:56:02] <mib_leap> dbaupp, -Z print-link-args doesn't give any info
[07:56:15] <dbaupp> mib_leap: you have to run it on a source file, right?
[07:56:43] <mib_leap> dbaupp: thats what i meant, it tried to compile a source file with the flag
[07:57:07] <ChrisMorgan> mib_leap: why exactly are you doing it? Testing a modification at the LLVM IR level?
[07:57:17] <mib_leap> ChrisMorgan: yes
[07:57:25] <brson> mib_leap: rustc::middle::trans::link maybe
[07:57:48] <brson> no
[07:57:54] <brson> rustc::middle::back::link
[07:57:55] <brson> sry
[07:58:00] <dbaupp> mib_leap: oh, it fails for me too; looks like it's possibly broken
[07:58:00] <brson> it's late
[07:58:13] *** Joins: jviereck (Adium@moz-DB8AC6A2.ethz.ch)
[07:58:19] <brson> omg
[07:58:21] <brson> rustc::back::link
[07:58:37] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[07:59:12] <mib_leap> brson: rust_log spec matched 0 of the specified
[07:59:21] <mib_leap> thats the waring i get
[07:59:46] *** Quits: jviereck (Adium@moz-DB8AC6A2.ethz.ch) (Quit: Leaving.)
[07:59:47] <mib_leap> for both rustc:middle::trans::link as well as rustc::back::link
[08:00:18] <mib_leap> dbaupp: yup, it's definitely broken
[08:00:40] *** Quits: sebcrozet (sebcrozet@moz-A855F6C0.w82-127.abo.wanadoo.fr) (Ping timeout)
[08:00:50] <brson> well that's bogus!
[08:01:39] <brson> hm, verified
[08:02:02] <mib_leap> brson: you mean it works?
[08:02:07] <brson> no i mean it doesn't
[08:02:11] * brson sad
[08:02:27] <dbaupp> I guess it's because it's printed by debug! statements
[08:02:39] <brson> oh, grum
[08:02:44] <mib_leap> dbaupp: so?
[08:02:48] <brson> yeah, i hate debug!
[08:03:01] <brson> it should be info!
[08:03:04] <dbaupp> building with ./configure --enable-debug should be more helpful
[08:03:11] <brson> i think that was a mistake
[08:03:30] <mib_leap> dbaupp: i should rebuild rustc?
[08:03:41] <brson> mib_leap: the logging you are looking for is not compiled by default
[08:03:42] <dbaupp> mib_leap: debug!() statements are removed unless --cfg debug is passed to rustc (which --enable debug does)
[08:04:03] <mib_leap> ha,
[08:04:17] <dbaupp> brson: I guess having debug!()'s on by default might be more useful
[08:04:23] <klutzy> the cheapest alternative method of -Z print-link-args is.. to build some rust code with nonexistent extern fn
[08:04:24] *** Quits: alisdair (textual@moz-FBF4138A.vc.shawcable.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[08:04:34] <klutzy> it will emit link args because link fails :p
[08:04:38] *** Joins: sebcrozet (sebcrozet@moz-A855F6C0.w82-127.abo.wanadoo.fr)
[08:04:58] <mib_leap> klutzy: nice
[08:05:20] *** Quits: lerc (quassel@B2E8CAD3.A8D14E52.788638A4.IP) (Ping timeout)
[08:07:22] <brson> oh i didn't no about -Z print-link-args. that sounds useful
[08:07:25] *** Joins: lerc (quassel@B2E8CAD3.A8D14E52.788638A4.IP)
[08:08:13] <mib_leap> hey, rustc uses gcc to link?
[08:08:22] <brson> yep
[08:08:24] *** Joins: dim-an (ermolovd@moz-74FA7782.yandex.net)
[08:08:29] <brson> pretty lame
[08:08:35] <mib_leap> what about llvm linker?
[08:08:55] <brson> waiting for it to mature and for someone to integrate it
[08:09:13] <mib_leap> brson: oh...thats sad
[08:13:20] *** Quits: KindOne (KindOne@moz-2ED7D416.dynamic.ip.windstream.net) (Ping timeout)
[08:16:33] *** Parts: dim-an (ermolovd@moz-74FA7782.yandex.net) ()
[08:17:04] *** Joins: KindOne (KindOne@moz-8E394FB9.dynamic.ip.windstream.net)
[08:17:55] *** Quits: tikue (tkuehn@moz-CF8BEBEF.dia.static.qwest.net) (Quit: tikue)
[08:18:09] *** Joins: true_droid (true_droid@moz-123FD9B8.beck.volia.net)
[08:18:16] *** Joins: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP)
[08:20:05] *** Joins: hjr3 (hradtke@moz-842BF853.hsd1.ca.comcast.net)
[08:20:40] *** Quits: KindOne (KindOne@moz-8E394FB9.dynamic.ip.windstream.net) (Ping timeout)
[08:21:30] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[08:24:00] *** Joins: madalynn (Mibbit@8A14CAC6.8DAC06CA.CAD5678C.IP)
[08:25:28] <madalynn> Is the code-blocks-as-expressions feature unique to Rust or also used by other languages?
[08:26:39] <dbaupp> madalynn: ruby is the same
[08:27:00] <madalynn> dbaupp: What about Scala?
[08:27:04] <dbaupp> functional programming languages too
[08:27:13] * dbaupp doesn't know anything about Scala
[08:27:28] <dbaupp> (although it's functional (right?), so I guess so.)
[08:28:37] *** Joins: CarpNet (ac@moz-FD24B77.sohonet.co.uk)
[08:29:01] <pnkfelix> SmallTalk too, right?
[08:31:07] *** Quits: Jesin (Jessin_@moz-157A63DD.cc.lehigh.edu) (Ping timeout)
[08:31:07] <pnkfelix> (which makes it very old indeed)
[08:32:17] *** Quits: madalynn (Mibbit@8A14CAC6.8DAC06CA.CAD5678C.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[08:32:23] *** Quits: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net) (Quit: eatkinson)
[08:33:05] *** Joins: KindOne (KindOne@5873B915.5D2364C3.EC6A1518.IP)
[08:38:53] *** Joins: Jesin (Jessin_@moz-157A63DD.cc.lehigh.edu)
[08:43:50] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[08:44:18] *** Joins: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net)
[08:50:45] *** Quits: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net) (Quit: eatkinson)
[08:54:36] <hopplaboppla> Is this idiomatic rust? http://pastie.org/8221136 
[08:55:00] *** Joins: jensnockert (jensnocker@moz-61E1062F.tbcn.telia.com)
[08:55:20] <dbaupp> hopplaboppla: except for the `return`s on each branch, yes
[08:55:39] <dbaupp> hopplaboppla: it could be `return match num { ... }`
[08:56:02] <dbaupp> or, you could even drop the `return` entirely, if it is the last expression in a block.
[08:56:06] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[08:56:12] <dbaupp> *in the block
[08:57:33] <hopplaboppla> ok thx
[08:57:44] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[08:58:12] <hopplaboppla> very neat :)
[08:59:01] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[08:59:53] *** Joins: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl)
[09:00:26] *** Joins: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk)
[09:06:53] *** Joins: rust-noob (Mibbit@moz-3112320B.graz.surfer.at)
[09:10:03] <rust-noob> hey! I'm looking for a function that searches a vector and returns () if it doesn't include the wanted item, does anybody know about such a functon? ;)
[09:11:47] <nmatsakis> pnkfelix: ping
[09:11:54] <pnkfelix> nmatsakis: pong
[09:12:12] <rust-noob> hmm, bsearch seems to meet my needs! :D
[09:12:26] <nmatsakis> pnkfelix: so I was talking to sully, and he thinks that default methods on @Objects ought to work, though supertrait methods do not. Do you have a test case for the problems you saw with default methods and @Visitor?
[09:12:35] <pnkfelix> nmatsakis: not a minimal one
[09:12:51] *** Quits: geomyidae (geomyidae@DD6F7E3A.21468E9A.30200F38.IP) (Client exited)
[09:12:52] <pnkfelix> nmatsakis: but I think I have the branch where I was seeing ICEs stashed away
[09:12:56] <nmatsakis> also, my branch for &Objects seems to be working! :)
[09:13:04] <pnkfelix> nmatsakis: let me see if I can extract a small test case.
[09:13:07] <bblum> rust-noob: do you plan to have an inaccurate nick in the future or how will we know you when you get better
[09:13:10] <bblum> just curious here
[09:13:15] <pnkfelix> nmatsakis: also, I've been meaning to ask you a silly question
[09:13:25] <pnkfelix> nmatsakis: (which may become irrevelant in the semi-near future)
[09:14:34] *** Joins: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP)
[09:15:12] *** Joins: lucian_ (lucian@6B2B4644.4304AE1E.CE5E78F6.IP)
[09:15:12] *** Quits: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP) (Connection reset by peer)
[09:16:16] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Connection reset by peer)
[09:17:21] <pnkfelix> nmatsakis: If I have `x : @mut T` and a function `f(y:@T)`, I cannot currently pass `x` into `f`.  Likewise, if I want to make a struct that holds a `@T`, I cannot put `x` in it.
[09:17:31] <nmatsakis> pnkfelix: correct
[09:17:46] <pnkfelix> nmatsakis: So, should my mental model here be that there is a strict partitioning between `@mut T` and `@T`, and never the twain shall meet?
[09:18:38] <nmatsakis> pnkfelix: Yes, those are quite distinct types, though you can borrow both of them to an &T
[09:19:04] <pnkfelix> nmatsakis: Can I somehow build up a shared graph structure incrementally (via @mut T's), and then convert the whole thing, once I want to commit it to a @T ?
[09:19:09] <nmatsakis> pnkfelix: I think we plan to move mut into Cell<T>, in which case that'd be... more obvious? you'd have @T and @Cell<T>
[09:19:16] <nmatsakis> pnkfelix: that is not currently possible
[09:19:18] <pnkfelix> nmatsakis: or do I need to resort to unsafe code to accomplsh that?
[09:19:34] <nmatsakis> pnkfelix: well, the way I do it in the compiler is to use an owned array and represent nodes with indices
[09:19:41] <pnkfelix> nmatsakis: I was wondering about that
[09:20:05] <pnkfelix> nmatsakis: so is the recommended pattern to use indices instead of pointers (in many cases) then?
[09:20:09] <nmatsakis> pnkfelix: see e.g. src/librustc/middle/graph.rs
[09:20:17] <nmatsakis> pnkfelix: I would recommend that, yes
[09:20:25] <nmatsakis> pnkfelix: I prefer newtype'd indices :)
[09:20:33] <pnkfelix> nmatsakis: I can't decide whether I'm unhappy about that or not.
[09:20:45] <nmatsakis> pnkfelix: understandable, it's a bit of a compromise
[09:20:54] *** Quits: KindOne (KindOne@5873B915.5D2364C3.EC6A1518.IP) (Ping timeout)
[09:21:47] <pnkfelix> nmatsakis: my main gut feeling is that I don't like passing around numbers, though newtyping them will hide the fact that they are numbers.  And I could even wrap them in structs if I really wanted the compiler to stop me from mixing things up, right?
[09:21:48] <nmatsakis> pnkfelix: or...just use @mut, I guess. I'd say it depends on whethre you'll ever need to GC individual nodes
[09:22:03] <nmatsakis> pnkfelix: well thta's what a newtype'd index is
[09:22:09] <nmatsakis> pnkfelix: a struct wrapping the index
[09:22:19] <pnkfelix> nmatsakis: Oh, I was thinking of a typedef thing...
[09:22:38] <pnkfelix> nmatsakis: `type foo = int` is a typedef, but you meant `struct foo(int)`, right?
[09:22:39] *** Joins: geomyidae (geomyidae@DD6F7E3A.21468E9A.30200F38.IP)
[09:23:05] <pnkfelix> nmatsakis: I can deal with that.  Okay, I'll try that instead when I get home tonight.
[09:23:40] <pnkfelix> nmatsakis: (I'm back to my attempt to do TAOCP exercises in Rust, though I've decided to jump ahead to stuff from Volume 4, mostly to play with more interesting algorithms)
[09:24:15] <pnkfelix> nmatsakis: and the new external Iterator stuff seemed like a good thing to try out with Knuth's discussion of Generating All XXX
[09:24:17] <nmatsakis> pnkfelix: yeah, I meant `struct NodeIndex(uint)` or something like that. As I said, check out src/librustc/middle/graph.rs -- that is my current thinking for the nicest way to do this sort of thing, but let me know if you have any ideas for improvements
[09:24:35] <nmatsakis> pnkfelix: cool sounds fun, I've always wanted to do something similar
[09:24:57] *** Quits: geomyidae (geomyidae@DD6F7E3A.21468E9A.30200F38.IP) (Client exited)
[09:25:02] <pnkfelix> nmatsakis: well, the sad thing is that I think Knuth's code is usually presented assuming one has generators/coroutines
[09:25:10] <pnkfelix> nmatsakis: And we don't have that sugar yet.  :(
[09:25:10] *** Joins: KindOne (KindOne@moz-D762C29B.dynamic.ip.windstream.net)
[09:25:30] *** Quits: rust-noob (Mibbit@moz-3112320B.graz.surfer.at) (Quit: http://www.mibbit.com ajax IRC Client)
[09:25:49] <nmatsakis> pnkfelix: yeah, that's a tricky one. I feel like it should be doable with macros, but we'd need some sort of hook in our parser I guess
[09:26:03] <pnkfelix> nmatsakis: If you were ever to bring back &const, do you think you'd add @const as well?
[09:26:08] <pnkfelix> nmatsakis: or is that a crazy notion?
[09:26:09] <nmatsakis> pnkfelix: it'd be cool to rewrite the parser to be a bit more extensible, or at least permit adding new keywords
[09:26:16] <nmatsakis> pnkfelix: well we *had* @const...
[09:26:31] *** Joins: geomyidae (geomyidae@DD6F7E3A.21468E9A.30200F38.IP)
[09:26:36] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[09:26:37] <nmatsakis> pnkfelix: it's not a crazy notion
[09:26:38] <pnkfelix> nmatsakis: I'm not even sure I have a notion of what the soundness criteria would be for it
[09:26:59] <nmatsakis> pnkfelix: pretty similar to &const really. basically you can read things out of it, but you can never rely that things will not be mutated,
[09:27:02] <pnkfelix> nmatsakis: Oh, there was one more thing I wanted to mention
[09:27:18] <nmatsakis> pnkfelix: so e.g., if you have an enum or a ~[T] reached via a @const or &const pointer, you couldn't match on the interior,
[09:27:36] <nmatsakis> pnkfelix: so long as you put every enum and every ~ into its own @ box though, things work out ok
[09:27:46] <nmatsakis> pnkfelix: which is of course what most functional languages force you to do
[09:27:55] <nmatsakis> pnkfelix: but we found in practice nobody wanted to do it in Rust
[09:28:01] <pnkfelix> nmatsakis: I see
[09:28:16] <pnkfelix> nmatsakis: the other thing I wanted to mention
[09:28:58] <nmatsakis> oh, I just realized a...rather serious problem with the removal of headers from ~ boxes
[09:29:01] <pnkfelix> nmatsakis: If we were to disallow `x == y` address comparison (Scheme's `eq?`) for `x: @T` and `y: @T`, we could put in a replicating GC
[09:29:12] <pnkfelix> nmatsakis: (I think)
[09:29:27] <nmatsakis> pnkfelix: interesting 
[09:29:41] <pnkfelix> nmatsakis: An incremental replicating GC, that is.
[09:29:42] <nmatsakis> pnkfelix: in general we don't... encourage such pointer comparison
[09:29:57] <nmatsakis> pnkfelix: though I guess that there is a box_eq fn 
[09:30:25] <nmatsakis> eep. I wonder how I can deal with this.
[09:30:49] <pnkfelix> nmatsakis: what's the problem you have now realized with ~ boxes minus headers?
[09:31:11] *** Quits: jensnockert (jensnocker@moz-61E1062F.tbcn.telia.com) (Input/output error)
[09:31:13] <nmatsakis> well, we currently place a header on a ~T iff T contains @
[09:31:18] <nmatsakis> in other words, if the GC has to trace it
[09:31:37] <nmatsakis> problem is that with a ~Object, we don't know what T is
[09:31:42] <nmatsakis> that's kind of the whole point :)
[09:32:05] <nmatsakis> I think the right answer is to put the headers in a negative offset; I've long opposed this,
[09:32:12] <nmatsakis> but I realized a while ago that my reasons for oppositoin were bogus
[09:32:19] <nmatsakis> precisely because of objects
[09:32:43] <nmatsakis> (the other right answer is not to require headers at all)
[09:33:05] *** Joins: Palmik (palmik@moz-CC484FDD.tmcz.cz)
[09:33:32] <nmatsakis> incidentally this has the interesting implication that one could conceivably "borrow" ~[@T] into &[&T]
[09:33:55] <nmatsakis> though I don't quite know how to make the type system smart enough for that. maybe just make an unsafe method for it.
[09:33:59] <pnkfelix> nmatsakis: I've been meaning to get a better grip on this
[09:34:56] <pnkfelix> nmatsakis: for a trait T and a, I don't know the term, "concrete type" S (e.g. a struct), and a `x: @S`
[09:35:01] <pnkfelix> nmatsakis: when you do `x as @T`
[09:35:21] <pnkfelix> nmatsakis: I've been assuming that the `x as @T` expression allocates a wrapper
[09:35:29] <nmatsakis> not so
[09:35:32] <pnkfelix> nmatsakis: (but I haven't attempted to verify this)
[09:35:38] <nmatsakis> though it used to be true
[09:35:46] <pnkfelix> nmatsakis: How does it get the vtable in there?
[09:35:55] <nmatsakis> an object is represented as the pair of a vtable and a pointer
[09:36:01] <nmatsakis> so sizeof(@Trait) == 2
[09:36:08] <nmatsakis> or rathre 2 * sizeof(uint)
[09:36:11] <pnkfelix> nmatsakis: okay, so its not heap-allocating anything
[09:36:14] *** Quits: Jesin (Jessin_@moz-157A63DD.cc.lehigh.edu) (Quit: Leaving)
[09:36:16] <nmatsakis> right
[09:36:20] <pnkfelix> nmatsakis: but the @Trait itself occupies two words
[09:36:24] <nmatsakis> right
[09:36:28] <nmatsakis> much like @fn etc
[09:36:36] <pnkfelix> nmatsakis: is the vtable itself allocated at that point?  I guess that should just be statically allocated.
[09:36:40] <nmatsakis> right
[09:36:44] <nmatsakis> statically allocated
[09:36:59] <pnkfelix> nmatsakis: so, then, for your ~Trait case
[09:37:01] <nmatsakis> I guess I can put a boolean flag into the vtable to indicate whether T has headers
[09:37:10] <nmatsakis> but yuck
[09:37:35] <pnkfelix> nmatsakis: you still have two words on the ~Trait, but the payload could have been headerless ?
[09:37:59] <nmatsakis> yeah, in this csae, the problem is that ~Trait is represented as (vtable, data) where data is ~T for some T
[09:38:03] <nmatsakis> but without knowing T...
[09:38:18] <pnkfelix> nmatsakis: can the GC inspect the vtable to figure out how to trace the payload ?
[09:38:41] <nmatsakis> pnkfelix: yes, the vtable includes a pointer to the type descriptor, which includes the info needed to trace
[09:38:52] <pnkfelix> nmatsakis: ah, but there migth be dynamic info
[09:39:07] <pnkfelix> nmatsakis: that is not in the vtable?  Such as length?
[09:39:21] <nmatsakis> pnkfelix: e.g. for @[T]?
[09:39:31] <nmatsakis> pnkfelix: or are you asking what's in the headers?
[09:39:33] *** Quits: hjr3 (hradtke@moz-842BF853.hsd1.ca.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[09:39:35] <pnkfelix> nmatsakis: well, I'm trying to understand what the missing header is going to give you
[09:39:44] <nmatsakis> pnkfelix: I see, the headers currently contain a linked list of all allocations
[09:39:56] <nmatsakis> pnkfelix: or rather all allocations for the current task
[09:40:09] <nmatsakis> pnkfelix: so that we can actually sweep
[09:40:27] <pnkfelix> nmatsakis: oh.  that is not the mental model I had for the header at all.
[09:40:28] <nmatsakis> pnkfelix: (if you thought SM's GC was primitive...)
[09:40:45] <nmatsakis> pnkfelix: it also contains a type descriptor telling the GC what data is present
[09:40:54] <nmatsakis> pnkfelix: though that info is duplicated in the vtable
[09:40:58] <nmatsakis> pnkfelix: in this case
[09:41:33] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[09:41:36] <pnkfelix> nmatsakis: Are you just trying to *skip over* the header that may or may not be there?
[09:41:58] <pnkfelix> nmatsakis: and share the same vtable for header-less and header-full objects?
[09:43:08] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[09:43:24] <nmatsakis> pnkfelix: well, for any given type, the header will always be there, so the vtables for ~S and ~T (where S and T are the true types of the objects) are not the same
[09:43:45] <nmatsakis> pnkfelix: but when I see a ~Object, I don't know whether it is ~S or ~T (or something else...) statically
[09:43:56] <nmatsakis> pnkfelix: and the problem is I have to be able to borrow the contents to an &S or &T,
[09:44:02] <nmatsakis> pnkfelix: which means skipping the headers if they are present
[09:44:12] <nmatsakis> pnkfelix: as I said the right fix is to not have this problem,
[09:44:22] <nmatsakis> pnkfelix: but if I want to avoid adding yet another dependency on this branch,
[09:44:33] <nmatsakis> pnkfelix: I am contemplating storing an offset into the type descriptor,
[09:44:52] <nmatsakis> pnkfelix: so that I can basicaly just load the offset (which will either be 0 or sizeof(Header)) and add it to the pointer
[09:45:00] <nmatsakis> pnkfelix: so as to convert from ~T to &T
[09:45:14] <nmatsakis> pnkfelix: actually that's not such a horrible sol'n I guess
[09:45:18] <pnkfelix> nmatsakis: where is the type descriptor in this picture?
[09:45:26] <nmatsakis> pnkfelix: well the type descriptor is found in the vtable
[09:45:29] <pnkfelix> nmatsakis: okay
[09:45:33] <nmatsakis> pnkfelix: (also in the header)
[09:45:41] <nmatsakis> pnkfelix: (but of course I don't KNOW the header is present)
[09:45:48] <pnkfelix> nmatsakis: right.  but you'll always have the vtable
[09:46:48] <pnkfelix> nmatsakis: Is there any case where the ~T to &T borrowing adjustment will need to be more complicated than a fixed offset stored ahead of time in the shared type descriptor?
[09:47:20] <pnkfelix> nmatsakis: Seems unlikely
[09:47:27] <nmatsakis> pnkfelix: That's what I was just trying to contemplate. In today's world, no, but it occurs to me that this whole idea of fat @T doesn't play as nicely with DST
[09:47:46] <pnkfelix> nmatsakis: (I was briefly wondering about multiple-inheritance type insanity)
[09:48:05] <pnkfelix> nmatsakis: (but I don't think that's ever going to be something we deal with)
[09:48:19] <nmatsakis> pnkfelix: but that's kind of a separate issue I think. In particular you wouldn't be able to take x:@Trait and do `x as @SomeOtherTrait`
[09:48:39] <pnkfelix> nmatsakis: Which idea of fat @T?  Is that how you describe the two-word (vtable, payload) representation?
[09:48:41] <nmatsakis> pnkfelix: but it's kind of meaningless to even contemplate, unless Trait is a subtrait of SomeOtherTrait, and that's a special case
[09:48:44] <nmatsakis> pnkfelix: yes
[09:49:11] <pnkfelix> nmatsakis: I've wanted to do `x:@Trait â€¦ x as @SomeOtherTrait`
[09:49:39] <nmatsakis> pnkfelix: more important is that if we can't support @[] as @Trait, because borrowing @[] yields &[], and @[] is narrow while &[] is fat
[09:49:41] <pnkfelix> nmatsakis: but I had assumed it would need to chain
[09:50:03] <nmatsakis> pnkfelix: yes, but in that case you would have to do @x as @SomeOtherTrait
[09:50:09] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[09:50:10] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/1YNwIw
[09:50:10] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[09:50:29] <pnkfelix> nmatsakis: as, so `@x as @SomeOtherTrait` would wrap and thus chain
[09:50:30] <nmatsakis> pnkfelix: because when you have v:@T and you do "v as @SomeOtherTrait", that requires that V:SomeOtherTrait
[09:50:42] <pnkfelix> sed -e s/as/ah/
[09:50:48] <nmatsakis> pnkfelix: but if T is a trait, then it's an existential type,
[09:51:01] <nmatsakis> pnkfelix: er, s/V:SomeOtherTrait/T:SomeOtherTrait/
[09:51:13] <nmatsakis> pnkfelix: anyway, if we don't know what T is, we can't make that guarantee
[09:52:01] <nmatsakis> pnkfelix: anyhow I... guess I'm ok with not supporting @[] or @str as @Trait, though it's unfortunate. It sure would be nice if slices were thin pointers.
[09:52:20] <nmatsakis> but then you can't do a subslice.
[09:52:35] <pnkfelix> nmatsakis: you said "v:@T â€¦ v as @SomeOtherTrait" would require "T:SomeOtherTrait" â€¦ but I think I was trying to deal with the case of impl<T:OriginalTrait> SomeOtherTrait for T
[09:52:36] * nmatsakis wrinkles his brow
[09:52:53] <pnkfelix> nmatsakis: not sure if that just would require the wrapping/chaining construction
[09:53:03] <nmatsakis> pnkfelix: I see, yes I guess in that case we could theoretically make it work
[09:53:08] <pnkfelix> nmatsakis: but I can live with it if it does
[09:53:09] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[09:53:10] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/6e5G2A
[09:53:10] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[09:53:10] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[09:53:10] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/toBFxw
[09:53:10] <ghrust> 13rust/06auto 140b47b4c 15Alex Crichton: Fix node hashes
[09:53:10] <ghrust> 13rust/06auto 142fe2e59 15bors: auto merge of #8361 : alexcrichton/rust/fix-node-hashes-in-crates, r=thestinger...
[09:53:10] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[09:53:19] <nmatsakis> pnkfelix: but in practice we cannot because of monomorphization
[09:53:39] <nmatsakis> pnkfelix: since we'd have to generate an instance of that impl for the specific T in question,
[09:53:49] <nmatsakis> pnkfelix: but of course we don't know what T is ...
[09:54:04] <pnkfelix> nmatsakis: ah yes
[09:54:22] <pnkfelix> nmatsakis: yeah, okay, you're forced to chain.  Which we express via wrapping.
[09:54:37] <pnkfelix> nmatsakis: I think I was just missing that last part, of how to properly express it.
[09:56:09] <nmatsakis> pnkfelix: note that you can also wrap with an & pointer,
[09:56:13] <nmatsakis> pnkfelix: so it doens't strictly require alloc
[09:56:16] <nmatsakis> pnkfelix: just indirection
[09:56:37] <pnkfelix> nmatsakis: mm, that's assuming &Trait objects work...?
[09:57:16] <pnkfelix> nmatsakis: (which reminds me, I should get back to trying to fulfill that promise I made to reproduce/isolate that ICE)
[09:58:33] <nmatsakis> pnkfelix: right. which they do in my branch :)
[09:58:44] <nmatsakis> pnkfelix: at least more than they do in norma llife
[09:58:55] <nmatsakis> pnkfelix: this is a branch for #5762,
[09:59:08] <nmatsakis> pnkfelix: which I've been messing with for a while, and I'm trying to finish it off
[09:59:48] <nmatsakis> pnkfelix: (that's my goal these days: just land all this branch for #5762 and the branch for #3678 (extern "C" fn) so I can get to new stuff)
[10:00:01] <pnkfelix> sounds good
[10:00:17] <pnkfelix> Such more impressive goals than mine for today
[10:01:22] *** Quits: KindOne (KindOne@moz-D762C29B.dynamic.ip.windstream.net) (Input/output error)
[10:01:58] *** Joins: KindOne (KindOne@moz-D762C29B.dynamic.ip.windstream.net)
[10:18:43] *** Quits: recrack (Mibbit@B4104EBB.3CC170B1.1E14B209.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[10:19:43] <pnkfelix> nmatsakis: ping
[10:20:13] <ChrisMorgan> There's fn x(&self) and fn x(&mut self) and fn x(self), but no fn x(mut self)?
[10:22:23] <ChrisMorgan> OK... one just does `let mut mut_self = self` and merrily uses `mut_self` instead of `self`.
[10:23:36] <pnkfelix> ChrisMorgan: RIght. Note of course that you are making copies.
[10:23:52] <pnkfelix> ChrisMorgan: (i.e. passing-by-value)
[10:23:53] <ChrisMorgan> That moves the object.
[10:26:50] <pnkfelix> ChrisMorgan: It would move it if its moved by defaultâ€¦  See: https://gist.github.com/pnkfelix/6192665
[10:28:30] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[10:31:02] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[10:39:03] * ChrisMorgan is struck yet again with crazy error messages due to having used the name "stream".
[10:39:08] <nmatsakis> pnkfelix: pong (but distracted)
[10:39:30] <pnkfelix> nmatsakis: I was going to ask how bad an idea it would be to add a `last_token` field to the parser
[10:40:09] <pnkfelix> nmatsakis: it seems like it would be easy to maintain, in its current structure.  But now I just realized that Tokens are not a trivial C enum, which explains some of the stuff about avoiding copying them
[10:40:28] <nmatsakis> pnkfelix: what for?
[10:40:41] <pnkfelix> nmatsakis: I'm trying to fix #3192
[10:40:50] <pnkfelix> nmatsakis: which is about improving the parser's error messages
[10:41:28] <pnkfelix> nmatsakis: (in the case of unit-struct construction)
[10:41:54] <nmatsakis> pnkfelix: yeah, I think it's ... ambiguous though,
[10:41:56] <pnkfelix> nmatsakis: (though I'm hoping that the style I'm adopting could be generalized to other situations where the parser might recover and continue parsing to find other errors)
[10:42:07] <pnkfelix> nmatsakis: the approach bblum was going to put in is ambiguous
[10:42:14] <pnkfelix> nmatsakis: that's not what I'm doing
[10:43:16] <pnkfelix> nmatsakis: There's a number of points where the parser has just finished parsing an expression (or a statement, which I'll get to in a sec), and it invoke e.g. `self.expect(&token::SEMI)`
[10:43:19] <nmatsakis> pnkfelix: ok, I think tokens are pretty cheap to copy though
[10:43:32] <nmatsakis> pnkfelix: so it shouldn't be terrible
[10:43:52] <pnkfelix> nmatsakis: My strategy modifies those `expect` calls to also check for unexpected inputs that we can recover from
[10:44:02] <pnkfelix> nmatsakis: So the reason I wanted to track the last_token
[10:44:04] <nmatsakis> I see, cool
[10:44:19] <pnkfelix> nmatsakis: is that I don't want to make the error message situation worse.
[10:44:49] <pnkfelix> nmatsakis: so I want my recovery code to have some safeguards.  Its easy in the case where we are commiting to an expression to e.g. inspect the expression to make sure it matches what we think the erroneous input was
[10:45:25] *** Joins: Florob (Florob@moz-39532932.de)
[10:45:31] <pnkfelix> nmatsakis: but for the case of a statement, I can either attempt to inspect the statement to find out if it ends with the kind of expression that we expected to be followed by the erroneous input we are trying to recover from
[10:45:51] <pnkfelix> nmatsakis: or, for the case of unit-struct construction, I can just look at the last token, see if its an identifier.
[10:47:29] <pnkfelix> nmatsakis: So I'm debating about which approach is worse.  (The third option is to not attempt recovery at all when we commit to a statement, only for when we commit to an expression.  But that will miss some common cases, e.g., the example from #3192 itself)
[10:48:40] <pnkfelix> nmatsakis: the reason I had worried that token copies are expensive are because of the comment in `fn bump()`: "Avoid token copies with `util::replace`."
[10:48:54] *** Joins: fyolnish_ (fyolnish@moz-BE2BAE5B.miinet.jp)
[10:49:51] *** Quits: fyolnish (fyolnish@moz-BE2BAE5B.miinet.jp) (Ping timeout)
[10:50:34] *** Quits: fyolnish_ (fyolnish@moz-BE2BAE5B.miinet.jp) (Ping timeout)
[10:59:10] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[10:59:20] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[11:00:36] <pnkfelix> nmatsakis: size_of(Token): 192
[11:01:03] *** Quits: richard|s (mindginati@moz-268511E5.dsl.dyn.ihug.co.nz) (Quit: brb)
[11:01:21] <pnkfelix> nmatsakis: maybe I did something wrong.  I'll gist my test code.  But it seems like we should avoid having such large Tokens...
[11:02:44] <bjz_> I've heard static analysis mentioned a few times in the context of C++ and Java. Will rust benefit from that in the future, or is the neat type safety and lints etc meant to make that uneccesary?
[11:02:46] <pnkfelix> nmatsakis: https://gist.github.com/pnkfelix/6192821
[11:03:29] <dbaupp> pnkfelix: just looking at token, it looks like it's probably nt_block(ast::Block) that's causing the bloat.
[11:03:54] <pnkfelix> bjz_: A type system is one kind of static analysis.  Can you provide more info on what sort of static analysis you wolud like?
[11:04:04] <pnkfelix> dbaupp: Yes I agree, that seems like a potential culprit
[11:04:20] <dbaupp> pnkfelix: and/or nt_path
[11:04:28] <bjz_> pnkfelix: no idea, just heard carmack mention it a few times in some of his speeches
[11:04:28] <pnkfelix> bjz_: (There has been discussion in the past of having an effect system, which is another example of a static analysis)
[11:04:51] <bjz_> pnkfelix: effect system?
[11:05:13] <pnkfelix> bjz_: google?
[11:05:28] <bjz_> will do :)
[11:05:32] <dbaupp> bjz_: I guess a lot of static analysis for C++ is designed to catch buffer overflows, null pointers and use-after-frees (all of which are unnecessary in rust)
[11:05:53] <dbaupp> so it's presumably less of a necessity
[11:06:16] <pnkfelix> bjz_: (You may have heard Rust developers refer more often to "Typestate" rather than "effect system"; the two notions are related.)
[11:06:29] <dbaupp> pnkfelix: INTERPOLATED(nonterminal) => INTERPOLATED(~nonterminal) might help?
[11:06:39] <pnkfelix> dbaupp: Yeah I've been thinking about that
[11:06:47] <pnkfelix> dbaupp: Don't want to get taken too far afield of my current task
[11:07:06] <dbaupp> pnkfelix: ok
[11:07:29] <bjz_> pnkfelix dbaupp: cool
[11:07:31] <dbaupp> bjz_: https://github.com/mozilla/rust/wiki/Proposal-for-effects is a proposal by bblum for a new effect system
[11:08:23] <pnkfelix> dbaupp: in any case, I think I now see why the comments talk about avoiding token copies.  (And why tokens themselves are so often passed-by-borrowed-reference)
[11:08:41] <dbaupp> pnkfelix: because they're so ridiculously huge? :(
[11:08:51] <pnkfelix> dbaupp: right-o
[11:09:10] <dbaupp> (also, ast::Ty is nonterminal, that's also large.)
[11:09:54] *** Joins: sankha94 (Instantbir@7061CD01.D6BD0D91.22D41759.IP)
[11:13:38] *** Joins: tikue (tkuehn@moz-CF8BEBEF.dia.static.qwest.net)
[11:15:32] <tikue> the thread on r/rust about functor traits is really interesting
[11:15:38] <tikue> it seems like there's no solution as of now?
[11:17:01] <dbaupp> tikue: http://www.reddit.com/r/rust/comments/1jp4kf/better_way_to_define_this_trait/ this one?
[11:17:10] <tikue> dbaupp: yep that one
[11:23:48] *** Quits: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com) (Client exited)
[11:28:06] *** Joins: Ms2ger (Ms2ger@moz-E9883900.access.telenet.be)
[11:28:25] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[11:30:17] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[11:31:57] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[11:32:08] <tikue> is there some kind of integral trait? i.e. a trait that could be implemented e.g. by ints, uints, etc. but not by floats, f32 etc
[11:33:06] <tikue> is that what the Integer trait is?
[11:33:49] *** Joins: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net)
[11:37:04] <dbaupp> tikue: I believe so, yes
[11:37:14] <tikue> dbaupp: do you know how I would do something like...
[11:38:06] <tikue> rusti: use std::num::Integer; fn two<I: Integer> -> I { 2 }
[11:38:06] -rusti- <anon>:5:51: 5:53 error: expected `(` but found `->`
[11:38:06] -rusti- <anon>:5          use std::num::Integer; fn two<I: Integer> -> I { 2 }
[11:38:06] -rusti-                                                             ^~
[11:38:06] -rusti- application terminated with error code 101
[11:38:16] <tikue> rusti: use std::num::Integer; fn two<I: Integer>() -> I { 2 }
[11:38:16] -rusti- <anon>:5:60: 5:61 error: mismatched types: expected `I` but found `<VI0>` (expected type parameter but found integral variable)
[11:38:16] -rusti- <anon>:5          use std::num::Integer; fn two<I: Integer>() -> I { 2 }
[11:38:16] -rusti-                                                                      ^
[11:38:16] -rusti- error: aborting due to previous error
[11:38:17] -rusti- application terminated with error code 101
[11:39:17] <Blub\w> (maybe '2 as I'?)
[11:39:29] <tikue> rusti: use std::num::Integer; use std::num::from; fn two<I: Integer>() -> I { from::<I>(2) }
[11:39:30] <dbaupp> rusti: use std::num::*; fn two<I: Integer> -> I { One::one() + One::one() }
[11:39:32] -rusti- pastebinned 8 lines of output: http://ix.io/79G
[11:39:32] -rusti- <anon>:5:45: 5:47 error: expected `(` but found `->`
[11:39:32] -rusti- <anon>:5          use std::num::*; fn two<I: Integer> -> I { One::one() + One::one() }
[11:39:32] -rusti-                                                       ^~
[11:39:32] -rusti- application terminated with error code 101
[11:39:41] <tikue> rusti: use std::num::Integer; use std::num::from; fn two<I: Integer>() -> I { from::<I>(2) }
[11:39:44] -rusti- pastebinned 8 lines of output: http://ix.io/79G
[11:39:45] <dbaupp> rusti: use std::num::*; fn two<I: Integer>() -> I { One::one() + One::one() }
[11:39:47] -rusti- pastebinned 7 lines of output: http://ix.io/79H
[11:40:12] <dbaupp> rusti: use std::num::*; fn two<I: Integer>() -> I { One::one::<I>() + One::one() }
[11:40:13] -rusti- ()
[11:40:39] <dbaupp> rusti: use std::num::*; fn two<I: Integer + IntConvertible>() -> I { IntConvertible::from_int(2) }
[11:40:40] -rusti- ()
[11:42:03] <tikue> hm
[11:42:26] <tikue> rusti: use std::num::Integer; use std::num::NumCast; fn two<I: Integer>() -> I { NumCast::from(2) }
[11:42:27] -rusti- <anon>:5:83: 5:96 error: failed to find an implementation of trait std::num::NumCast for I
[11:42:27] -rusti- <anon>:5          use std::num::Integer; use std::num::NumCast; fn two<I: Integer>() -> I { NumCast::from(2) }
[11:42:27] -rusti-                                                                                             ^~~~~~~~~~~~~
[11:42:27] -rusti- application terminated with error code 101
[11:42:42] <tikue> rusti: use std::num::Integer; use std::num::NumCast; fn two<I: Integer + NumCast>() -> I { NumCast::from(2) }
[11:42:43] -rusti- ()
[11:44:35] *** Joins: jensnockert (jensnocker@moz-61E1062F.tbcn.telia.com)
[11:45:02] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Connection reset by peer)
[11:45:11] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[11:47:58] *** Quits: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net) (Quit: msingle)
[11:50:21] <tikue> rusti: use std::num::Integer; use std::num::NumCast; fn two<I: Integer + NumCast>() -> I { NumCast::from(2) } fn two2() -> uint { two() }
[11:50:22] -rusti- ()
[11:50:28] <tikue> rusti: use std::num::Integer; use std::num::NumCast; fn two<I: Integer + NumCast>() -> I { NumCast::from(2) } fn two2() -> uint { two() } two2()
[11:50:29] -rusti- 2
[11:50:32] <tikue> das cool
[11:52:11] *** Joins: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au)
[11:55:28] <tikue> rusti: use std::num::Integer; use std::num::NumCast; fn two<I: Integer + NumCast>() -> I { NumCast::from<I>(2) } fn two2() -> uint { two() } two2()
[11:55:30] -rusti- line longer than 150 columns, pastebinned 5 lines of output: http://ix.io/79I
[11:55:41] <tikue> rusti: use std::num::Integer; use std::num::NumCast; fn two<I: Integer + NumCast>() -> I { NumCast::from::<I>(2) } fn two2() -> uint { two() } two2()
[11:55:43] -rusti- line longer than 150 columns, pastebinned 5 lines of output: http://ix.io/79J
[11:56:15] <tikue> rusti: use std::num::Integer; use std::num::NumCast; fn two<I: Integer + NumCast>() -> I { NumCast::from(2u) } fn two2() -> uint { two() } two2()
[11:56:16] -rusti- 2
[11:56:43] *** Joins: Earnestly (earnest@3F74F9E2.8E6FE497.30311652.IP)
[12:00:02] <tikue> no idea what i'm doing wrong here
[12:00:03] <tikue> https://gist.github.com/tikue/66c35a110cc2c2c4a460
[12:00:23] <tikue> looks like the type is pretty constrained to me...
[12:03:14] <dbaupp> tikue: I guess it's just type inference isn't quite powerful enough to reason through all the layers of iterators
[12:03:34] <dbaupp> tikue: if you just put ::<I> on all the froms it might work?
[12:03:53] <tikue> the type param wouldn't be I though, it'd be int or whatnot
[12:04:21] <dbaupp> https://gist.github.com/tikue/66c35a110cc2c2c4a460#file-generics-rs-L8 here it would be I
[12:04:47] <tikue> numcast's type param is the type of the num being cast from, not to
[12:04:49] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[12:04:53] <bstrie> so irfy seems to indicate that we've shaved 10 minutes off of compile times since july 31
[12:05:11] <tikue> unless there's a way to parameterize over the trait rather than the method?
[12:05:47] <dbaupp> bstrie: 10 minutes??
[12:06:43] <dbaupp> tikue: it probably takes 2 then, so you just put uint (or whatever) for the first, and I for the second
[12:07:24] <tikue> i double checked, numcast doesn't take any trait parameters. idk how it works lol
[12:08:01] <dbaupp> rusti: std::num::NumCast::from::<uint, int>(1)
[12:08:02] -rusti- 1
[12:08:13] <dbaupp> rusti: std::num::NumCast::from::<uint, int>(1i)
[12:08:13] -rusti- 1
[12:08:36] <dbaupp> so you probably need `NumCast::from::<I, uint>(2)` etc.
[12:08:50] <tikue> ah interesting
[12:09:04] <dbaupp> there's the implicit Self type parameter
[12:10:06] <ChrisMorgan> bstrie: and that ten minutes is over twenty on my machine.
[12:10:19] <tikue> oh that makes sense
[12:10:48] <tikue> is there an ```implicitly copyable``` trait
[12:11:04] <dbaupp> nope
[12:11:23] <dbaupp> but Clone is essentially costless for such types
[12:11:43] *** Joins: peterdn (chatzilla@moz-97742234.new.ox.ac.uk)
[12:11:50] <bstrie> "[rust is] like communism, great in theory, miserable in practice [...] no escape analysis either by the looks of things"
[12:11:54] <bstrie> oh #go-nuts
[12:11:57] <bstrie> you so silly
[12:12:21] <tikue> :( that's just not true at all. besides, communism is _not_ great in theory
[12:12:35] <tikue> no offense to any communists out there
[12:13:08] <ChrisMorgan> The primary problem with communism is humans. Fix them up and it'd work a lot better.
[12:13:24] <bstrie> ChrisMorgan: I find that the primary problem with humans, is humans
[12:13:29] <tikue> i fundamentally disagree ChrisMorgan 
[12:14:27] <bstrie> in any case enough arguing about political philosophy, that's time that could be spent implementing escape analysis for rust!
[12:14:31] <tikue> :P
[12:15:17] <tikue> the problem with not having an implicitly copyable trait is you can't do things like iter().transform(|&n| n)
[12:15:29] <tikue> you just get ```cannot move out of dereference of & pointer```
[12:15:50] <tikue> and u have to do transform(|n| n.clone())
[12:17:21] <hopplaboppla> I am still not fully used to the various ways to control memory, does this copy the returned array: fn generate() -> ~[int] {......}
[12:18:20] <tikue> ha! got it to compile
[12:18:26] <bstrie> hopplaboppla: nope, you're returning a pointer there
[12:18:35] <hopplaboppla> ok, good
[12:18:37] <hopplaboppla> thx
[12:18:49] <tikue> it's quite a bit slower than the non-generic version
[12:18:52] <tikue> maybe all the copies
[12:18:56] <tikue> :(
[12:18:59] <ChrisMorgan> What is a const type, e.g. const Foo, &const Foo?
[12:19:20] * tikue really wants ImplicitClone or something
[12:19:21] <bstrie> ChrisMorgan: I think those are on the chopping block
[12:19:29] <bstrie> they're pretty ill-understood
[12:19:45] <ChrisMorgan> That's what I had heard rumours of; I was largely just wondering what they actually are.
[12:20:20] <bstrie> so I think the difference between &Foo and &const Foo is that the former says "I won't mutate this" and the latter says "nobody will mutate this"
[12:20:40] <dbaupp> bstrie: otherway around
[12:20:43] <bstrie> dammit :P
[12:21:15] <ChrisMorgan> That's weird. I can't see what that gets you.
[12:21:23] *** Joins: vosen (vosen@moz-266BA656.icpnet.pl)
[12:21:41] <bstrie> ChrisMorgan: https://github.com/mozilla/rust/issues/7700#issuecomment-22058480
[12:22:08] <tikue> well here's the generic primes code https://gist.github.com/tikue/66c35a110cc2c2c4a460
[12:22:18] <tikue> unfortunately there's lots of clones, but i can't think of a better way to do it
[12:22:22] *** Joins: Earnestea (earnest@3F74F9E2.8E6FE497.30311652.IP)
[12:22:38] <tikue> goodnight!
[12:22:40] <bstrie> tikue: show it to bjz_, maybe he can help
[12:22:43] <bstrie> or go to bed!
[12:22:45] <bstrie> that works too
[12:22:45] <tikue> :P
[12:22:50] <tikue> i stayed up too late tonight
[12:23:02] <tikue> â€¦it's not really night anymore 
[12:23:10] <bstrie> better just keep working on rust then :)
[12:23:13] *** Quits: Earnestly (earnest@3F74F9E2.8E6FE497.30311652.IP) (Ping timeout)
[12:23:13] <tikue> haha
[12:23:18] <tikue> oy
[12:23:23] * tikue takes his leave
[12:23:24] *** Quits: tikue (tkuehn@moz-CF8BEBEF.dia.static.qwest.net) (Quit: tikue)
[12:26:01] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[12:27:03] *** Quits: jensnockert (jensnocker@moz-61E1062F.tbcn.telia.com) (Input/output error)
[12:27:41] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[12:29:42] *** kimundi is now known as zz_kimundi
[12:31:46] * ChrisMorgan wonders why extra::url::Url.port is Option<~str> rather than Option<u16>
[12:32:11] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[12:32:11] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/toBFxw
[12:32:11] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[12:35:04] <bstrie> ChrisMorgan: I wonder why it's Option<~str> rather than Option<Port> :)
[12:35:08] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[12:35:08] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/-C3T2g
[12:35:08] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[12:35:08] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[12:35:08] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/SfLxGw
[12:35:08] <ghrust> 13rust/06auto 14c3825c8 15Steven Fackler: env! syntax extension changes...
[12:35:08] <ghrust> 13rust/06auto 146928a10 15bors: auto merge of #8362 : sfackler/rust/env, r=alexcrichton...
[12:35:09] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[12:35:26] <ChrisMorgan> bstrie: what, with `pub type Port = u16`?
[12:35:43] <bstrie> pub type Port = Option<~str>
[12:36:07] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[12:36:15] *** Quits: hopplaboppla (Mibbit@moz-963D6814.redpill-linpro.com) (Quit: http://www.mibbit.com ajax IRC Client)
[12:36:32] <bstrie> why's it need the option? don't all URLs just default to 80, or is that just a nonstandard thing that web browsers do?
[12:36:42] <bstrie> er, 80/443
[12:36:49] <bstrie> but I presume this is http
[12:38:07] <ChrisMorgan> bstrie: you could normalise http://www.example.com:80/ to http://www.example.com/, but for FromStr::from_str, you want to know what's in the URL, not what it's normalised to.
[12:38:23] <bstrie> ok
[12:38:33] <ChrisMorgan> Also the URL is not necessarily just HTTP or HTTPS.
[12:38:51] *** Joins: hopplaboppla (Mibbit@moz-963D6814.redpill-linpro.com)
[12:40:51] <Florob> FWIW, <https://tools.ietf.org/html/rfc3986#section-3.2.3>. Which also means I'm equally confused about the ~str, I would've guessed it might allow a service name, but apparently URLs require the digest notation.
[12:41:03] <Florob> *digit
[12:42:30] *** Joins: sonwow (Mibbit@9CCFE499.1957CB35.CF51B3F5.IP)
[12:44:29] <bstrie> ChrisMorgan: if it's protocol-independent then isn't it a URI instead of a URL?
[12:44:38] <bstrie> I always forget the difference...
[12:44:48] <Ms2ger> No
[12:44:55] <Ms2ger> They're all URLs
[12:45:26] <Ms2ger> And you'll want http://url.spec.whatwg.org/
[12:45:34] <ChrisMorgan> bstrie: URI = URL + URN (URN being things like `isbn:1234567890`)
[12:46:11] <bstrie> Ms2ger: interesting
[12:46:57] <ChrisMorgan> Ms2ger: at present I'm just working with extra::url; haven't checked it to see if it's incompatible with that, yet, but I would expect to eventually.
[12:53:47] <bstrie> so C++ exposes a C-compatible interface via `extern "C"` and Rust does roughly the same thing, right?
[12:56:00] *** Quits: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au) (Quit: gavinb)
[12:57:27] *** Joins: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca)
[12:57:54] *** Joins: maxli (maxli@13F2CEC5.7672369.D8E68FF6.IP)
[13:03:36] <doomlord> yes
[13:04:36] *** Quits: z0w0 (zack@moz-E12708D5.lns6.woo.bigpond.net.au) (Client exited)
[13:05:07] <dbaupp> doomlord: http://dobkeratops.github.io/rftest/libstd/iterator.rs.html is yours, right?
[13:05:15] <doomlord> yes
[13:05:33] <dbaupp> it's really cool.
[13:06:10] <dbaupp> I can just click on things and it takes me around... all from the comfort of my web browser. :)
[13:06:17] <doomlord> motivated by me missing IDE's :)
[13:06:58] <doomlord> and if web-browsing gadgets can become useful for coding i have an excuse to by more toys perhaps
[13:07:31] <doomlord> i've yet to figure out how to get cross-crate links working and you'lll see some other bugs here and there
[13:08:04] <dbaupp> yeah, some of the line links seem to be off-by-one
[13:08:36] <doomlord> i have some indecision on one vs zero based indices in my code-base... 
[13:08:52] <Yoric> Make it parametric, as Turbo Pascal :)
[13:09:06] <bstrie> doomlord: oh awesome, I didn't know that was yours
[13:10:02] <dbaupp> doomlord: just split the difference and go for 0.5 based indices
[13:10:37] <doomlord> heh. like float texel indexing bugs
[13:10:43] <doomlord> do they round up or down :)
[13:12:51] <doomlord> have default arguments been considered ... would the way to add those be  to add an array of ~[expr] to fn_decl ... and make the parser inline those ? ... 
[13:13:02] <ChrisMorgan> Hmm... concerning. This HTTP client is exiting with status 141 before finishing writing its request, most of the time.
[13:14:25] <bstrie> doomlord: https://github.com/mozilla/rust/issues/6973
[13:14:45] *** Quits: Liothen (liothen@moz-80EF0CD7.spkn.qwest.net) (Quit: Textual IRC Client: www.textualapp.com)
[13:15:07] <ChrisMorgan> SIGPIPE.
[13:15:34] <bstrie> ChrisMorgan: I can't tell if that's an error or an ACM conference
[13:15:52] <ChrisMorgan> Under GDB it normally finishes sending the request, but outside GDB it normally doesn't.
[13:15:56] <Yoric> It can be an erroneous conference.
[13:16:38] <Yoric> the SIGPLAN on Preparing, Interrupting and Processing Exceptions
[13:18:13] <bstrie> wonderful
[13:19:56] *** Joins: nano (nano@moz-74CAD1CA.superkabel.de)
[13:23:11] <hopplaboppla> why does "fmt!("%d",i)" yield "error: not enough arguments to fmt! for the given format string" ?
[13:23:29] <bstrie> rusti: fmt!("%d",1)
[13:23:30] -rusti- ~"1"
[13:23:43] <bstrie> rusti: let i = 1; fmt!("%d",i)
[13:23:44] -rusti- ~"1"
[13:23:45] <hopplaboppla> huh?
[13:23:50] <bstrie> no idea
[13:24:07] <doomlord> would the rust syntax eventually allow naming arguments when defaults are supplied.. eg fn Foo(a=1,b=2,c=3){} ...Foo( c=10) /* ==Foo(1,2,10) */... personally coming from c++ i'm used to sorting the parameters by importance already
[13:24:17] <bstrie> hopplaboppla: which version of rust?
[13:24:38] <bstrie> doomlord: did you see the issue I linked?
[13:24:40] <doomlord> yes
[13:24:55] <dbaupp> doomlord: I don't think there's any definite syntax at all; so it's far to early to say.
[13:25:14] <dbaupp> (but presumably something like that would be the point of having default arguments anyway.)
[13:25:20] <hopplaboppla> 0.8-pre
[13:25:33] <bstrie> hopplaboppla: weird
[13:25:34] <hopplaboppla> built from master today
[13:25:43] <bstrie> rusti is also built from master every day
[13:26:07] *** Quits: donri (dag@moz-9BB61102.tbcn.telia.com) (Client exited)
[13:26:16] <doomlord> that would be icing on the cake, but even the C++ way where you can only provide defaults for the lat parameters would be very useful 
[13:26:19] <hopplaboppla> it must be something else cause it works elsewhere in _the same file_.... :S
[13:26:35] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[13:27:43] <hopplaboppla> hmm can something be cached? If I comment it out it _still_ gives the same error
[13:27:56] <dbaupp> presumably it's somewhere else, then?
[13:28:06] <bstrie> hopplaboppla: can you paste the file?
[13:28:14] <bstrie> or otherwise minimize it?
[13:28:15] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[13:28:27] <hopplaboppla> sure, sec
[13:28:47] *** zz_kimundi is now known as kimundi
[13:29:33] <hopplaboppla> http://pastie.org/8221740'
[13:29:36] <hopplaboppla> http://pastie.org/8221740
[13:29:51] <hopplaboppla> trivial code really
[13:30:22] <hopplaboppla> its the commented part below that baffles me
[13:30:26] <dbaupp> `assert!(expected == generate(8),"Expected %s, got %s",expected.flatmap());` that looks like it needs 2 args?
[13:30:40] <ChrisMorgan> i will be an &int rather than an int
[13:30:51] <ChrisMorgan> rusti: fmt!("%d", &42)
[13:30:55] <hopplaboppla> ahh doh!
[13:30:56] -rusti- pastebinned 7 lines of output: http://ix.io/79Q
[13:30:59] <hopplaboppla> thx!
[13:30:59] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[13:31:41] <klutzy> well, in that case rust emits type error. it is strange that "not enough arguments" has thrown
[13:32:18] <hopplaboppla> testEight was not complete in any way so that was it
[13:32:37] <klutzy> oh aha
[13:36:54] *** Joins: Azdle_ (Azdle@moz-B334B496.hfc.comcastbusiness.net)
[13:43:35] <smvv> TIL <-> was an operator. What was the reason to make it deprecated syntax?
[13:45:09] <bstrie> smvv: we could do it as a function instead
[13:45:18] <bstrie> right now it's std::util::swap
[13:45:20] <smvv> util.swap?
[13:45:23] <smvv> right :)
[13:48:58] *** Joins: reyre (reyre@FCCEA34F.7672369.D8E68FF6.IP)
[13:53:22] * ChrisMorgan finally has response reading vaguely working for his HTTP client
[13:53:27] *** Joins: DasIch (dasich@moz-5EDA591.de)
[13:55:04] <hopplaboppla> I really like the #[test] annotation for testing. Does it hold up for really large projects too or does it bloat?
[13:55:46] <dbaupp> hopplaboppla: rustc uses it, and that's the larges project in Rust at the moment
[14:00:42] *** Joins: mrordinaire (Mibbit@1A659656.A607747.FD383126.IP)
[14:01:02] <mrordinaire> hi, is there any equivalence for continue in Java for Rust?
[14:01:19] <klutzy> loop;
[14:01:21] <hopplaboppla> it feels really nice and encourages tdd to have the tests really close
[14:02:12] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[14:02:50] *** Quits: mark_edward_ (quassel@moz-57A72B6E.hsd1.in.comcast.net) (Client exited)
[14:06:02] *** Joins: mark_edward_ (quassel@moz-57A72B6E.hsd1.in.comcast.net)
[14:06:22] *** Joins: ikona_ (ikona@moz-9E8C585A.adsl.alicedsl.de)
[14:06:28] <mrordinaire> klutzy: thanks
[14:07:06] *** Quits: hopplaboppla (Mibbit@moz-963D6814.redpill-linpro.com) (Quit: http://www.mibbit.com ajax IRC Client)
[14:07:20] *** Quits: ikona (ikona@moz-380B1CA5.adsl.alicedsl.de) (Ping timeout)
[14:07:58] *** Joins: hopplaboppla (Mibbit@moz-963D6814.redpill-linpro.com)
[14:08:46] *** Joins: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au)
[14:08:53] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Bye!)
[14:08:58] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[14:12:43] *** Quits: jaen (jaen@moz-ED2EC791.neoplus.adsl.tpnet.pl) (Ping timeout)
[14:15:02] <bstrie> ChrisMorgan: a working http lib would be a godsend, lack of networking is probably the #1 most common reason that I have to turn people away
[14:15:13] <bstrie> everybody wants to write servers
[14:15:37] <smvv> why not zmq + mongrel2?
[14:15:48] *** Joins: doener (bs@moz-AA189A5A.unitymedia.biz)
[14:16:37] <doener> is pcwalton on holidays?
[14:16:46] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[14:17:02] <ChrisMorgan> smvv: why zmq + mongrel2?
[14:17:02] <bstrie> smvv: 1) I only vaguely know what those words mean, and 2) I don't know how often they get updated. we really need a lib that tracks master, which would happen for any lib used in servo
[14:17:26] <bstrie> doener: he was here yesterday
[14:17:35] <ChrisMorgan> Besides which, that's server only. I've started with server but am now working on client too.
[14:18:13] <doener> bstrie: ok, thanks
[14:18:26] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[14:19:06] <smvv> bstrie: mongrel2 is a language agnostic http server, which uses zeromq to connect to a program language. zeromq is a extreme low latency networking toolkit
[14:19:26] <bstrie> ok
[14:19:41] <ChrisMorgan> smvv: why would you do it that way rather than having a pure Rust system?
[14:19:41] *** Joins: saneyuki_s (Mibbit@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[14:20:00] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[14:20:07] <bstrie> you'd still have to make sure the bindings are up-to-date, and you'd probably want a rust-y layer on top of them too
[14:20:39] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[14:20:42] <smvv> i've been working on a web framework which uses mongrel2 and zmq. Example of usage: https://github.com/smvv/iron/blob/master/src/demo/header_dump.rs it's up-to-date with a recent rustc version
[14:20:51] <ChrisMorgan> Pure Rust should be faster.
[14:21:39] <bstrie> smvv: neat
[14:21:40] <smvv> ChrisMorgan: it's takes less time to build on top of other software
[14:21:43] <ChrisMorgan> Pure Rust is *much* simpler to manage deployment: on your server, just install the binaries and associated libraries, rather than also needing to install Mongrel2 and ZeroMQ.
[14:22:32] <ChrisMorgan> Pure Rust also allows me to work with my grand goal of avoiding string typing which *almost* everything does very conveniently.
[14:22:46] <smvv> i agree. but developing a library in rust comparible to zemomq takes a lot of effort
[14:22:53] <bstrie> stringly-typed
[14:23:11] <hopplaboppla> zmq/mongrel2 is nice but having Rust native capable http lib would be awesome
[14:23:13] <ChrisMorgan> I'll admit that development in pure Rust is slower to start with, but the end result will be *much* better.
[14:23:45] <bstrie> ChrisMorgan: are you also building libs for ip and tcp?
[14:23:46] <ChrisMorgan> Then too, I've learned quite a bit about HTTP that I only vaguely knew in the process already, and I haven't even got very far...
[14:24:01] <ChrisMorgan> bstrie: no. std::rt::io::net::{ip, tcp}
[14:24:21] <dbaupp> doener: is https://github.com/mozilla/rust/pull/8270#issuecomment-22396755 with or without -O?
[14:24:39] <bstrie> ChrisMorgan: are those bespoke implementations, or do they just call into libuv?
[14:24:44] <ChrisMorgan> libuv
[14:24:50] <doener> dbaupp: with -O (--opt-level=3 gives the same result)
[14:24:58] <bstrie> ok, so libuv provides ip/tcp, but not http
[14:25:05] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[14:25:19] <dbaupp> doener: probably worth noting :)
[14:25:26] <bstrie> I really like how the length of the acronyms increases as you go up the protocol stack
[14:25:54] *** Joins: bent (chatzilla@moz-932324BF.hsd1.ca.comcast.net)
[14:25:58] <ChrisMorgan> bstrie: correct
[14:25:58] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[14:26:15] <ChrisMorgan> bstrie: what sits on top of HTTP?
[14:26:19] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[14:26:24] <smvv> session layer
[14:26:37] <ChrisMorgan> What's the acronym for it?
[14:26:46] <ChrisMorgan> Gotta be at least five characters long, clearly.
[14:26:46] <bstrie> slxxx
[14:26:48] <smvv> HTTPS :)
[14:27:01] <smvv> (ssl is session based)
[14:27:36] <bstrie> and the acronym for ethernet can just be "e" :)
[14:27:52] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[14:28:02] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[14:28:18] *** Quits: ikona_ (ikona@moz-9E8C585A.adsl.alicedsl.de) (Quit: Leaving)
[14:28:21] <ChrisMorgan> bstrie: what's ""?
[14:28:49] <doener> dbaupp: added non-optimized results 
[14:29:06] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[14:29:19] <dbaupp> doener: cool
[14:29:20] <bstrie> ChrisMorgan: whatever comes below the physical layer. perhaps the spiritual layer?
[14:29:36] <ChrisMorgan> bstrie: Ethernet isn't the physical layer.
[14:29:58] <bstrie> ChrisMorgan: right but then the joke doesn't work :P
[14:30:13] <mrordinaire> hi, is there anyway to clone a CharIterator?
[14:30:46] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[14:31:02] <engla> mrordinaire: not at the moment. You can clone the char offset iterator
[14:31:14] <bstrie> rusti: "asdf".char_iter()
[14:31:15] -rusti- <anon>:5:9: 6:5 error: type `&'static str` does not implement any method in scope named `char_iter`
[14:31:15] -rusti- <anon>:5          "asdf".char_iter()
[14:31:15] -rusti- <anon>:6     };
[14:31:15] -rusti- error: aborting due to previous error
[14:31:15] -rusti- application terminated with error code 101
[14:31:23] <bstrie> rusti: "asdf".iter_char()
[14:31:24] -rusti- <anon>:5:9: 6:5 error: type `&'static str` does not implement any method in scope named `iter_char`
[14:31:24] -rusti- <anon>:5          "asdf".iter_char()
[14:31:24] -rusti- <anon>:6     };
[14:31:24] -rusti- error: aborting due to previous error
[14:31:25] -rusti- application terminated with error code 101
[14:31:33] <bstrie> rusti: "asdf".iter()
[14:31:34] -rusti- {iter: {index_front: 0, index_back: 4, string: "asdf"}, f: }
[14:31:43] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[14:32:00] <engla> bstrie: it's a Map adaptor around the char offset iter, and Map is not clonable atm
[14:32:27] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[14:34:14] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[14:34:14] *** Joins: infynyxx_ (infynyxx@moz-E95B370B.nyc.res.rr.com)
[14:34:20] * bjz ventured into the world on #gamedev.... O_O
[14:34:24] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[14:35:07] <mrordinaire> engla: thanks. but how do i do that?
[14:36:16] *** Quits: hopplaboppla (Mibbit@moz-963D6814.redpill-linpro.com) (Quit: http://www.mibbit.com ajax IRC Client)
[14:36:29] *** Quits: doener (bs@moz-AA189A5A.unitymedia.biz) (Quit: leaving)
[14:36:38] *** Quits: infynyxx_ (infynyxx@moz-E95B370B.nyc.res.rr.com) (Connection reset by peer)
[14:36:58] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[14:37:02] <engla> rust-buildbot: let it = "hi".char_offset_iter(); it.next(); it.clone()
[14:37:07] <engla> rusti: let it = "hi".char_offset_iter(); it.next(); it.clone()
[14:37:07] -rusti- <anon>:5:43: 5:45 error: cannot borrow immutable local variable as mutable
[14:37:08] -rusti- <anon>:5          let it = "hi".char_offset_iter(); it.next(); it.clone()
[14:37:08] -rusti-                                                     ^~
[14:37:08] -rusti- error: aborting due to previous error
[14:37:08] -rusti- application terminated with error code 101
[14:37:16] <engla> :(
[14:37:21] <engla> rusti: let mut it = "hi".char_offset_iter(); it.next(); it.clone()
[14:37:22] -rusti- {index_front: 1, index_back: 2, string: "hi"}
[14:37:50] *** Joins: jdm (jdm@9FB21CB6.76DE1AD5.AE2B2F80.IP)
[14:39:37] *** Quits: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net) (Client exited)
[14:39:39] <mrordinaire> engla: cool. thanks :)
[14:39:59] *** Joins: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net)
[14:40:28] <engla> rusti: let mut it = "hi".char_offset_iter(); it.next(); let mut jt = it.clone(); (it.next(), jt.next())
[14:40:29] -rusti- (Some((1, 'i')), Some((1, 'i')))
[14:41:41] *** Quits: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net) (Ping timeout)
[14:42:50] *** Joins: jaen (jaen@moz-C815560A.play-internet.pl)
[14:46:12] *** Joins: hjr3 (hradtke@moz-6DF8C224.public.wayport.net)
[14:46:53] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[14:46:54] <mark_edward_> where is from_str_radix located?
[14:47:03] <mark_edward_> and is it at all dependent on capitalisation?
[14:47:29] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[14:48:28] <bstrie> mark_edward_: capitalization?
[14:48:42] <bstrie> you mean like 1e2 as opposed to 1E2?
[14:48:48] <mark_edward_> bstrie: yeah
[14:50:33] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[14:50:38] <kimundi> mark_edward_: It doesn't care about caps
[14:50:48] <mark_edward_> okay
[14:51:02] *** Joins: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com)
[14:51:38] <kimundi> rusti: ::std::from_str::FromStrRadix::from_str_radix::<uint>("Ff", 16)
[14:51:39] <bstrie> rusti: std::int::from_str_radix("G", 17)
[14:51:43] -rusti- pastebinned 11 lines of output: http://ix.io/79Z
[14:51:43] -rusti- Some(16)
[14:51:44] <mark_edward_> kimundi: do you know in what module(s) it is defined? can't find it in the docs
[14:51:48] <bstrie> nifty
[14:52:11] <mark_edward_> bstrie: isn't that wrong?
[14:52:14] <mib_leap> what does the term 'monomorphize' mean?
[14:52:24] <bstrie> mark_edward_: git grep indicates that it's defined in quite a few places, for different types
[14:52:36] <bstrie> mib_leap: specialization, like what C++ does on templates
[14:52:52] <kimundi> mark_edward_: there are shortcut impls in all number modules, trait impls for ToStrRadix in all number modules, and the actual backend implementataion for them all is in std/num/strconv
[14:53:05] <mark_edward_> kimundi: ah i see
[14:53:06] <bstrie> mib_leap: we take a generic function, and for each type that uses it, we generate a specific function for that type
[14:53:17] <kimundi> (I wrote it, but it's prtty crappy)
[14:53:20] <bstrie> mark_edward_: how is it wrong?
[14:53:28] <mark_edward_> bstrie: isn't that conversion wrong though? 0xFF should be 255 shouldn't it?
[14:53:31] *** Quits: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au) (Quit: gavinb)
[14:53:33] <mib_leap> bstrie: thats it? a scary term 
[14:53:43] <bstrie> mark_edward_: my example was base 17
[14:53:55] <kimundi> rusti: std::int::from_str_radix("Ff", 16)
[14:53:56] -rusti- Some(255)
[14:54:03] <kimundi> rusti: std::int::from_str_radix("Z", 36)
[14:54:04] -rusti- Some(35)
[14:54:08] <mark_edward_> ah i got confused
[14:54:08] <kimundi> rusti: std::int::from_str_radix("10", 36)
[14:54:09] -rusti- Some(36)
[14:54:32] *** Quits: hjr3 (hradtke@moz-6DF8C224.public.wayport.net) (Ping timeout)
[14:54:41] <bstrie> ok, now make it do base64
[14:54:49] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[14:54:58] <bstrie> rusti: std::int::from_str_radix("+", 64)
[14:55:02] -rusti- line longer than 150 columns, pastebinned 2 lines of output: http://ix.io/7a0
[14:55:05] <kimundi> bstrie: You could write it in a way that accepts arbitrary bases and arbitrary alphabets
[14:56:20] <kimundi> actually, that would probably be best from a code reuse standpoint, we just need special cased fastpaths for base 10 :P
[14:57:02] <kimundi> maybe I'm gonna try to rewrite all that stuff a second time, this time trying to actually make the code fast
[14:58:32] *** Joins: hjr3 (hradtke@moz-6DF8C224.public.wayport.net)
[14:58:37] *** Joins: dherman (dherman@moz-FEEC7E9.hsd1.ut.comcast.net)
[14:58:37] *** ChanServ sets mode: +o dherman
[14:59:54] *** Quits: dherman (dherman@moz-FEEC7E9.hsd1.ut.comcast.net) (Quit: dherman)
[15:02:03] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[15:02:58] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[15:04:07] *** Quits: jaen (jaen@moz-C815560A.play-internet.pl) (Quit: WeeChat 0.4.1)
[15:04:19] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[15:05:08] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[15:05:08] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/SfLxGw
[15:05:08] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[15:06:38] <nmatsakis> pnkfelix: belatd pong
[15:08:10] *** Joins: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP)
[15:08:10] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/_RudYw
[15:08:10] *** Parts: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP) ()
[15:08:11] *** Joins: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP)
[15:08:11] <ghrust> 01[13rust01] 15bors pushed 31 new commits to 06auto: 02http://git.io/W_is2A
[15:08:11] <ghrust> 13rust/06auto 146011f83 15Erick Tryzelaar: std: minor cleanup
[15:08:11] <ghrust> 13rust/06auto 1408b6cb4 15Erick Tryzelaar: std: add str.to_c_str()
[15:08:11] <ghrust> 13rust/06auto 14fd293df 15Erick Tryzelaar: std: rewrite run::with_{argv,envp,dirp} to copy C strings
[15:08:12] *** Parts: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP) ()
[15:08:33] *** Joins: dherman (dherman@moz-FEEC7E9.hsd1.ut.comcast.net)
[15:08:33] *** ChanServ sets mode: +o dherman
[15:08:55] <pnkfelix> nmatsakis: I've forgotten what my question was about
[15:09:10] <nmatsakis> pnkfelix: ok, I see you wrote some comments about sizeof Token...
[15:09:19] <nmatsakis> pnkfelix: there are a few places in the AST where I think we should really introduce some indirection
[15:09:24] <pnkfelix> nmatsakis: yeah
[15:09:33] <pnkfelix> nmatsakis: I was going to file a ticket.  or rather, see if one already existed
[15:09:48] <nmatsakis> pnkfelix: but as far as copying tokens go, the other question is whether tokens use any ~[T] or other ~ pointers that would require deep clones
[15:09:56] <nmatsakis> pnkfelix: used to be they embedded ~str's sometimes
[15:10:05] <nmatsakis> pnkfelix: I think those were replaced with interned strings? but maybe not always
[15:11:04] <pnkfelix> nmatsakis: Does ~[T] require a deep clone?  ~T does not ...
[15:11:27] <pnkfelix> nmatsakis: ah I see
[15:11:35] <pnkfelix> nmatsakis: the Clone impl for &'self [T]
[15:11:56] <nmatsakis> pnkfelix: how does ~T not require a deep clone?
[15:12:15] <pnkfelix> nmatsakis: because clone() already does a deep clone for ~T
[15:12:23] <pnkfelix> nmatsakis: according to clone.rs ...
[15:12:28] <nmatsakis> pnkfelix: oh, well, what Imeant is that you will have to call clone() to save the prev token
[15:12:30] *** Joins: adrema (adrema@1453496A.70C7F49.B68672D5.IP)
[15:12:41] <pnkfelix> nmatsakis: yeah, I figured that out already
[15:12:46] <nmatsakis> pnkfelix: and it will do a deep clone, for every token, even when that's rarely needed
[15:13:03] <pnkfelix> nmatsakis: yes, which is a reason that I should consider not doing this
[15:13:17] <pnkfelix> nmatsakis: I already have to make last_token an Option type
[15:13:33] <pnkfelix> nmatsakis: so I could only do the copy for known cheap cases.
[15:13:47] <pnkfelix> nmatsakis: not really thrilled by that prospect though.
[15:14:59] <mark_edward_> is there any alternative to "esaxd".iter().collect() for getting a string as a vector of chars?
[15:15:06] <nmatsakis> pnkfelix: yeah, annoying.
[15:17:01] *** Quits: Ralith (ralith@moz-50F3C77.vc.shawcable.net) (Ping timeout)
[15:17:06] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[15:17:06] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14ce2e594 to 146928a10: 02http://git.io/N3iJvQ
[15:17:06] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[15:17:06] *** Joins: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP)
[15:17:07] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/_uGXvA
[15:17:07] <ghrust> 13rust/06auto 14ae81151 15Stepan Koltsov: Fix Ipv6Addr to_str for ::1:x.x.x.x addresses...
[15:17:07] <ghrust> 13rust/06auto 1474efdf6 15bors: auto merge of #8352 : stepancheg/rust/ipv6-to-str, r=luqmana...
[15:17:07] *** Parts: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP) ()
[15:17:10] <bstrie> rusti: "asdf".as_buf()
[15:17:10] -rusti- <anon>:5:9: 6:5 error: type `&'static str` does not implement any method in scope named `as_buf`
[15:17:11] -rusti- <anon>:5          "asdf".as_buf()
[15:17:11] -rusti- <anon>:6     };
[15:17:11] -rusti- error: aborting due to previous error
[15:17:11] -rusti- application terminated with error code 101
[15:17:17] *** Joins: DoomBoom (DoomBoom@6B14631A.ACEC7723.5D1D3FEF.IP)
[15:18:43] <bstrie> mark_edward_: I'm sure there is, it was something with the word "buf"
[15:18:46] <mark_edward_> rusti: "assdf".as_imm_buf()
[15:18:49] -rusti- pastebinned 9 lines of output: http://ix.io/7a2
[15:18:58] <bstrie> rusti: "asdf".as_mut_buf()
[15:18:58] -rusti- <anon>:5:9: 6:5 error: type `&'static str` does not implement any method in scope named `as_mut_buf`
[15:18:58] -rusti- <anon>:5          "asdf".as_mut_buf()
[15:18:59] -rusti- <anon>:6     };
[15:18:59] -rusti- error: aborting due to previous error
[15:18:59] -rusti- application terminated with error code 101
[15:19:56] <mark_edward_> bstrie: i don't think there is. those functions use it as a libc::char, not a rust char
[15:20:11] <ChrisMorgan> Just committed https://github.com/chris-morgan/rust-http/commit/721c421979045a38e6aa66366ddad546bf0cb20e which is a (very) basic HTTP client.
[15:20:47] <bstrie> rusti: let x = ~"asdf"; x.as_imm_buf()
[15:20:49] -rusti- pastebinned 9 lines of output: http://ix.io/7a3
[15:21:14] <mark_edward_> bstrie: that needs closure
[15:24:28] *** Joins: huseby (huseby@moz-4E8C421A.husebyhome.com)
[15:24:37] <mark_edward_> you know what'd be useful? a debugf!() macro so i dont have to type debug!(fmt!(...)) all the time
[15:24:53] <bstrie> mark_edward_: you could define one :) or just use printf!
[15:25:05] <bstrie> or error!
[15:25:06] *** Quits: fabiand (fabiand@moz-5D01EC14.adsl.alicedsl.de) (Quit: Verlassend)
[15:25:25] <mark_edward_> bstrie: true, but i want these to be debug statements that get stripped out in an optimized bild
[15:26:09] <bstrie> rusti: printf!("foo")
[15:26:11] -rusti- "foo"()
[15:26:20] <bstrie> rusti: printf!(1)
[15:26:20] -rusti- 1()
[15:26:26] <cmr> rusti: debug!("%s", "asdf")
[15:26:27] -rusti- ()
[15:26:30] <bstrie> mark_edward_: if printf! can do it, so can debug!
[15:26:30] <cmr> mark_edward_: it already works that way.
[15:26:59] <mark_edward_> cmr: zomg praise to jeebus. i have a lot of debug stateents to fix
[15:27:12] <mark_edward_> *statements
[15:27:49] <mark_edward_> cmr: does debug! automatically add a newline??
[15:28:06] <cmr> mark_edward_: that is up to the logging system
[15:28:13] <cmr> (yes)
[15:28:18] <mark_edward_> i seee
[15:28:54] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[15:34:59] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[15:35:04] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[15:37:34] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[15:39:32] *** Quits: dherman (dherman@moz-FEEC7E9.hsd1.ut.comcast.net) (Quit: dherman)
[15:39:48] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[15:41:29] <mib_leap> i was looking at a rustc generated LLVM assembly, and noticed that all rust funtions have their first parameter as { i32, %tydesc*, i8*, i8*, i8 }* what is it?
[15:42:32] <mib_leap> i'm sure the function that was translated is not a closure, so it cant be the environment, right?
[15:43:48] <cmr> mib_leap: all functions are translated as closures
[15:43:55] *** Joins: steven_is_false (user@C5B76363.1FF1EBF8.1ECA502.IP)
[15:44:02] <cmr> mib_leap: pretty sure that's the bug with extern fn that nmatsakis has fixed
[15:44:05] <toddaaro> cmr: finally ran my bench script with your rtdebug change, all around 50% perf improvement
[15:44:22] <cmr> toddaaro: very nice! probably a combination of icache + less work overall
[15:44:25] <cmr> fmt isn't cheap
[15:44:34] <toddaaro> yea, and it was doing a *lot* of it
[15:45:00] <cmr> mib_leap: see trans_fn, around line 1888, src/librustc/middle/trans/base.rs
[15:46:48] <toddaaro> cmr: do you want to do that PR or should I get around to it today?
[15:46:51] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[15:46:53] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Ping timeout)
[15:47:02] <cmr> toddaaro: I'll do it if you have better things to do
[15:47:25] <toddaaro> cmr: up to you, I can fit it in this afternoon easily
[15:47:37] <cmr> I'll do it
[15:48:18] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[15:48:32] *** Joins: jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net)
[15:49:47] <mark_edward_> is ther a continue keyword?
[15:49:51] <cmr> mark_edward_: `loop`
[15:50:13] *** Joins: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net)
[15:50:15] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[15:50:27] <mark_edward_> cmr: but if i'm in a loop, and i want to skip to the next iteration
[15:50:39] <cmr> mark_edward_: right, use `loop`
[15:50:50] <cmr> the keyword has two uses
[15:50:56] <mark_edward_> cmr: oh okay!
[15:51:21] *** Quits: wting (wting@moz-250C027.csres.utexas.edu) (Client exited)
[15:51:30] <cmr> toddaaro: Should I get rid of rtdebug_ and merge it with the cfg!(rtdebug) rtdebug! ?
[15:52:13] * Florob really wonders what's up with all those nops in some functions
[15:52:32] <cmr> Florob: does clang also generate lots of noop for similar functions in C++ or C?
[15:52:58] <mark_edward_> cmr: what happens if you call read_line and get an EOF?
[15:53:18] <cmr> mark_edward_: from std::io?
[15:53:23] <mark_edward_> cmr: yeah
[15:53:24] *** Quits: mib_leap (Mibbit@894D2C62.9F275360.C28326FD.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[15:53:33] <Florob> cmr, I don't think so. Or at least I've never seen it. "Similar" might be a bit peculiar to define in this context though...
[15:54:02] <cmr> mark_edward_: I think it just gives you whatever it got
[15:54:13] <cmr> mark_edward_: std::io is really awful, doesn't handle errors at all really
[15:54:19] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[15:54:23] <mark_edward_> i wish it returned an option or result or something...
[15:54:37] <cmr> the newrt io is much better
[15:54:37] <mark_edward_> cmr: if it gets an eof do you get an empty string?
[15:54:47] <cmr> mark_edward_: dunno, try it?
[15:56:39] *** Joins: alisdair (textual@moz-FBF4138A.vc.shawcable.net)
[15:59:30] *** Joins: mihneadb (mihneadb@E48845AB.3A9F9BD4.4C2245EF.IP)
[16:03:15] <Florob> cmr, hmm... looking at some largish codebase compiled with clang (libopus in this case), it does in fact do that. It emits long nops in stead of a bunch of 0x90 though. (And I still wonder why. 15 bytes seems a bit excessive for e.g. padding)
[16:03:16] *** Joins: infynyxx_ (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[16:03:36] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[16:03:54] <cmr> Florob: 15 bytes is exactly what you need for 16 byte alignment
[16:04:03] <cmr> or, the most you need
[16:04:23] *** Quits: nano (nano@moz-74CAD1CA.superkabel.de) (Connection reset by peer)
[16:04:26] <cmr> alignment is really important for performance, I would investigate what architecture you're using and what its programming manual suggests
[16:04:39] <jack> what is replacing timer::sleep()?
[16:04:58] *** Quits: sonwow (Mibbit@9CCFE499.1957CB35.CF51B3F5.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[16:05:06] <Florob> cmr, 16 byte alignment for a 3 byte cmp? I doubt it.
[16:05:25] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[16:06:01] <engla> there are many ways to encode a nop
[16:06:38] *** Quits: thesnowdog (doug@94FEF15E.9D0B7490.6F17036B.IP) (Connection reset by peer)
[16:07:05] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[16:09:44] *** Joins: graydon (graydon@moz-F14EE0DB.cable.teksavvy.com)
[16:09:44] *** ChanServ sets mode: +qo graydon graydon
[16:10:03] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[16:11:14] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[16:12:18] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[16:14:04] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[16:15:02] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[16:15:49] *** Quits: DoomBoom (DoomBoom@6B14631A.ACEC7723.5D1D3FEF.IP) (Quit: Leaving)
[16:17:40] <steven_is_false> So I'm trying to get Rust, on MinGW, on Wine, on Linux to build again (for testing with Valgrind), and I was wondering if anyone knew any way to speed up the build?
[16:18:06] <steven_is_false> I think Wine, on Linux has even slower process creation than Windows.
[16:18:17] <Seldaek> steven_is_false: wouldn't it better to use a VM? :)
[16:18:28] <cmr> VM would require a windows license
[16:18:47] <Seldaek> you can run with an unactivated one for 180 days or something
[16:18:52] <Seldaek> then start again
[16:19:13] <steven_is_false> Seldaek: One can use Valgrind with VMs?
[16:19:23] <cmr> oh right, and valgrind doesn't run on windows
[16:19:24] <cmr> that too
[16:19:24] *** Joins: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com)
[16:20:21] <steven_is_false> I wonder maybe someone could build all the tests on a Windows box, and then run them under Wine with Valgrind?
[16:21:11] *** Joins: mib_leap (Mibbit@393F3D58.CB450964.520CDC98.IP)
[16:21:27] *** Quits: hjr3 (hradtke@moz-6DF8C224.public.wayport.net) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[16:21:49] *** Joins: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net)
[16:22:05] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[16:22:25] <Seldaek> steven_is_false: ah I missed the valgrind part sorry :)
[16:22:27] <cmr> sounds like it could work to me
[16:22:33] <steven_is_false> Seldaek: Fair enough.
[16:23:23] <steven_is_false> cmr: I was thinking of trying out the Windows developer preview for 8 on a VM possible anyways
[16:24:21] *** Quits: cdidd (cdidd@moz-6B78B066.broadband.corbina.ru) (Input/output error)
[16:25:21] *** Quits: saneyuki_s (Mibbit@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Quit: http://www.mibbit.com ajax IRC Client)
[16:29:10] <steven_is_false> So Rust's configure script uses uname to detect the OS type. I'm considering patching it so one can set it manually.
[16:30:56] <mib_leap> cmr: is it right that trans_fn is only for functions with a definition?
[16:31:01] <jdm> wasn't there an RFC about trait-associated constants?
[16:31:03] * jdm can't find it
[16:31:05] *** Quits: acrichto (acrichto@moz-B63D64BD.res.cmu.edu) (Quit: leaving)
[16:31:12] <bstrie> jdm: try niko's blog
[16:31:13] <cmr> mib_leap: no idea
[16:31:16] *** Joins: acrichto (acrichto@moz-69F2E428.ugrad.cs.cmu.edu)
[16:33:14] *** Joins: cdidd (cdidd@moz-907AC78C.broadband.corbina.ru)
[16:33:20] <steven_is_false> Who is most familiar with Rust's byzantine build process?
[16:33:30] <cmr> graydon or pnkfelix I imagine
[16:33:34] <cmr> graydon wrote it originally I think
[16:33:41] <cmr> pnkfelix has been doing quite a bit of work with the makefiles
[16:33:42] <pnkfelix> steven_is_false: what's up?
[16:34:11] <steven_is_false> pnkfelix: I'm looking at building Rust on Wine, on Linux (with Valgrind) again.
[16:34:14] <mib_leap> why are external functions wrapped in 2 layers? a shim and a wrapper...
[16:34:30] <pnkfelix> steven_is_false: my knowledge of Wine dates from 15 years ago
[16:34:39] <steven_is_false> Ouch
[16:34:55] <pnkfelix> steven_is_false: but lets see what I can do
[16:35:10] <steven_is_false> I sort of wish I could just do ../src/rust/configure --windows
[16:35:19] <pnkfelix> steven_is_false: well, lets start with small goals
[16:35:30] <steven_is_false> ls
[16:35:34] <steven_is_false> Oops.
[16:36:03] <steven_is_false> pnkfelix: Fair enough. But I don't really know how to decompose the problem properly.
[16:36:16] <pnkfelix> steven_is_false: sure.  Help me do some quick catchup
[16:36:39] <pnkfelix> steven_is_false: How much of the infrastructure remains outside of wine? E.g., are you still invoking `make` from the non-wine side ?
[16:37:24] <steven_is_false> pnkfelix: I last tried doing everything from inside of the wineconsole (wineconsole --backend=curses /home/steven/.wine/drive_c/MinGW/msys/1.0/bin/bash.exe --login -i)
[16:37:46] <steven_is_false> But that's way to slow, and error filled.
[16:37:49] <pnkfelix> steven_is_false: I was worried you were going to say that.  Okay, so we're living within the MinGW version of make then
[16:38:08] <steven_is_false> Right but I don't think this is the right approach.
[16:38:25] <pnkfelix> steven_is_false: Otherwise, I'd suggest (as I have to others) that you start using GNU remake as a way to work with the esoteric makefiles
[16:38:38] <pnkfelix> steven_is_false: http://bashdb.sourceforge.net/remake/
[16:38:43] *** kimundi is now known as zz_kimundi
[16:38:45] <pnkfelix> steven_is_false: namely `remake --trace`
[16:38:51] *** Quits: mrordinaire (Mibbit@1A659656.A607747.FD383126.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[16:39:00] <steven_is_false> That would be useful.
[16:39:17] <pnkfelix> steven_is_false: I never would have been able to make any progress on the makefiles without that.
[16:40:19] <steven_is_false> Side question. My own personal uses of Make heavily abuse the $(shell) function. How well does remake cope with that?
[16:42:15] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[16:42:20] <graydon> steven_is_false: you probably want to look in mk/platform.mk
[16:42:46] <graydon> steven_is_false: in particular lower down where there are blocks of per-target variables
[16:42:50] <steven_is_false> graydon: Yeah that seems smart.
[16:43:06] *** Quits: reyre (reyre@FCCEA34F.7672369.D8E68FF6.IP) (Client exited)
[16:43:09] <graydon> steven_is_false: cross-build for wine should not be _super_ difficult, but it'll be some work
[16:43:21] *** Quits: alisdair (textual@moz-FBF4138A.vc.shawcable.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[16:43:44] *** Joins: reyre (reyre@FCCEA34F.7672369.D8E68FF6.IP)
[16:43:50] <graydon> you'll need to use winegcc or something for the C compiler, and ensure that both LLVM and rust are configured with a mingw target or subtarget
[16:44:18] <graydon> I'm not sure if you can get by using the existing mingw target configs or will have to make another copy of it for mingw-in-wine-world
[16:44:32] <steven_is_false> graydon: Yeah, I was wondering if I could do something like CC=winegcc ../src/rust/configure
[16:44:45] <graydon> not that easily, no
[16:44:56] <graydon> rustc is a cross compiler though
[16:45:04] <steven_is_false> Would I have to edit config.mk?
[16:45:23] <graydon> so you're going to want to do a build=linux, host=linux, target=mingw configuration
[16:45:31] <graydon> no, config.mk is emitted by configure. don't touch it.
[16:45:32] <jack> i need some help. i'm on an icfp team using rust, and the problem has a lot of webapi stuff which i have to throttle. how can i sleep? sleep() appears to have died.
[16:45:41] <steven_is_false> Okay.
[16:45:58] <jack> (we're using std::run with curl to work around lack of rust-http-client)
[16:46:02] <graydon> jack: std::rt::io::timer
[16:46:45] <jack> graydon: !! thanks
[16:46:48] <steven_is_false> So that should be the --target-triples flag right?
[16:47:24] <steven_is_false>  --target-triples=x86_64-something-mingw ?
[16:47:29] *** Quits: Florob (Florob@moz-39532932.de) (Client exited)
[16:47:40] <cmr> i686 I think
[16:47:47] <cmr> it might be i486
[16:47:50] <graydon> steven_is_false: yes. something like --target-triples=i686-pc-mingw or such
[16:47:57] *** Joins: alisdair (textual@moz-FBF4138A.vc.shawcable.net)
[16:47:58] *** Quits: alisdair (textual@moz-FBF4138A.vc.shawcable.net) (Quit: alisdair)
[16:47:58] *** Joins: lkuper (lkuper@63686BC7.F689A8C9.EB438161.IP)
[16:48:01] <pnkfelix> steven_is_false: remake is a fork of GNU make; most make features that I'm aware of "just work" on remake, because it is not a rewrite.
[16:48:13] <steven_is_false> pnkfelix: Great.
[16:48:46] <graydon> steven_is_false: the thing is, if you look in platform.mk, there's already a target block for i686-pc-mingw
[16:49:05] <graydon> for when we're building _on_ mingw, when host=build=target
[16:49:49] <graydon> steven_is_false: you want a slightly different target, one that uses the wine mingw tools specifically
[16:49:59] <graydon> (winegcc not CC, etc.)
[16:51:00] *** sankha94 is now known as sankha93_
[16:51:27] <steven_is_false> So, i686-pc-mingw32 is for 32. I should do 64 bits though right?
[16:51:44] <cmr> we don't support 64bit windows or mingw I don't think
[16:51:55] <steven_is_false> cmr: Oh. Okay then.
[16:52:00] <graydon> we're still working on win64, yeah
[16:52:16] <steven_is_false> Isn't LLVM still working on win64!
[16:52:38] <graydon> I don't think so, but maybe
[16:52:44] <graydon> anyway that's not the concern today
[16:52:50] <graydon> I'd also like to get wine cross configs working!
[16:52:57] <graydon> if you want to spend energy on it, that's great
[16:53:00] <pnkfelix> I hadn't even consider this as an option
[16:53:26] <pnkfelix> (though I guess I'm probably better off focusing on making sure things work in a *normal* windows install..)
[16:53:27] <graydon> pnkfelix: oh it's super useful. fast builds, not necessary to use check-fast, can run stuff under valgrind, can use real profilers
[16:53:40] <steven_is_false> Or, Wine on MinGW on Wine on MinGW on Wine on ... STACK OVERFLOW..
[16:53:59] *** Joins: mib_dolghw (Mibbit@moz-D3D15A0C.vie.surfer.at)
[16:54:07] <pnkfelix> graydon: fast builds?  where does that come from in this stew?
[16:54:13] <graydon> linux tooling is way better than windows tooling, at least in my hands. I guess if we had a team of zillions of people hacking support into msvc for us the opposite would be true, but ..
[16:54:33] <steven_is_false> pnkfelix: Process creation on Windows is slower.
[16:54:34] <graydon> pnkfelix: forking a subprocess is incredibly slow on mingw-hosted-on-linux
[16:54:37] <graydon> er, on win32
[16:54:45] *** Quits: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk) (Client exited)
[16:55:18] <steven_is_false> I wonder if there could be some way of making lightweight process on Windows? Not green threads but green processes.
[16:55:18] <graydon> filesystem stuff is also slow. you know how we read the entire metadata segment of rustc on every small-file compile? :)
[16:55:26] <pnkfelix> steven_is_false: didn't you just say: "I think Wine, on Linux has even slower process creation than Windows." ?
[16:55:33] <cmr> Windows has fibers
[16:55:40] <graydon> don't go down that path
[16:55:47] <cmr> It'd be better if we could also use threads instead of processes
[16:55:53] <steven_is_false> pnkfelix: Yep. Which is why I thought that running under wineconsole is bad.
[16:55:55] <cmr> win32 processes have a ton of non-process-releated overhead
[16:56:05] <pnkfelix> steven_is_false: oh I see what you're saying
[16:56:07] <cmr> plus lack of cow
[16:56:15] <graydon> cmr: subprocesses like _sub processes_. like if we run 'grep' or 'python' or the 90,000 processes that LLVM's configure script runs
[16:56:19] <graydon> those sorts of processes
[16:56:24] <steven_is_false> msvsc foo | cowsay
[16:56:42] <steven_is_false> Needs more cowbell. msvc foo | cowsay | cowsay
[16:57:54] <graydon> steven_is_false: you don't have to run under wineconsole. that's a host=mingw32 configuration
[16:58:07] <steven_is_false> Right, and that's bad.
[16:58:24] *** Quits: CarpNet (ac@moz-FD24B77.sohonet.co.uk) (Quit: Leaving)
[16:58:28] <graydon> steven_is_false: well, it's potentially interesting too!
[16:58:32] <graydon> just a different config
[16:58:35] <engla> steven_is_false: as an expert on these matters, it's cowsay -n for the second invocation
[16:59:01] <graydon> even just being able to produce a linux binary that compiles .dll/.exe files that can run under wine will be useful
[16:59:03] <steven_is_false> engla is an expert cowsayer.
[16:59:20] <graydon> if you get to that point, host=wine will probably not be a huge step further
[16:59:39] <graydon> but like, for android right now, I don't think they're bothering to do a host=android configuration
[16:59:42] <olsonjeffery> engla speaks the truth. engla is a moothsayer.
[16:59:43] <graydon> just target
[16:59:45] <steven_is_false> So aside from ../../src/rust/configure --target-triples=i686-pc-mingw32 I need to make it use winegcc right?
[17:00:39] *** Quits: StarLight (StarLight@moz-880B9767.pppoe.avangarddsl.ru) (Ping timeout)
[17:00:40] <steven_is_false> That would just be a make option though make CC=winegcc correct?
[17:01:04] <graydon> steven_is_false: what I'm suggesting is to make a new target called i686-wine-mingw32 or something
[17:01:17] <steven_is_false> graydon: Okay.
[17:01:40] <graydon> which sets CC and such appropriately and also has a CFG_RUN and CFG_RUN_TARG pair that invoke 'wine' on the output
[17:02:53] <steven_is_false> I think I understand now.
[17:04:42] <klutzy> steven_is_false: do you want to cross-build linux to windows?
[17:05:04] *** Joins: StarLight (StarLight@moz-E1607E2E.dynamic.avangarddsl.ru)
[17:05:18] <steven_is_false> klutzy: Correct, (and then run under wine)
[17:05:51] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[17:06:03] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[17:06:27] <klutzy> steven_is_false:  I think it's worth to note that mingw-w64 provides linux/mac to win cross compiler, well though I never tried to it to build rust.
[17:06:38] <pnkfelix> heh.  Running a binary generated via winegcc from an ssh connection is intersting
[17:06:47] <pnkfelix> Hello World wants to open up a systray ...
[17:06:57] *** Quits: infynyxx_ (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[17:07:00] <steven_is_false> pnkfelix: Neat.
[17:07:15] <pnkfelix> steven_is_false: I assume this is par for the course in your experience?
[17:07:40] * pnkfelix probably should go look at a winegcc tutorial or something
[17:07:54] <steven_is_false> graydon: So I can see where all the configs are defined in platform.mk But I have to explain to configure that i686-wine-mingw32 is an acceptable target right?
[17:07:55] *** Joins: thomaslee (thomaslee@moz-6C3931E3.static.twtelecom.net)
[17:10:09] <steven_is_false> Oh nice! It's grepped from platform.mk.
[17:10:15] <steven_is_false> So I don't need to do that.
[17:10:24] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Client exited)
[17:10:29] <pnkfelix> graydon: Did you know that size_of(parse::token::Token) is 192?  https://gist.github.com/pnkfelix/6192821
[17:10:38] <pnkfelix> graydon: I was a bit surprised by that.
[17:10:47] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[17:10:54] <cmr> pnkfelix: the ast is very very large
[17:11:17] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[17:11:40] <pnkfelix> cmr: yeah, I guess I'm used to the word "token" being used to denote simple lexical tokens.
[17:11:57] <pnkfelix> cmr: Not sub-tree structures in and of themselves.
[17:12:13] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:12:29] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Ping timeout)
[17:12:31] <steven_is_false> graydon: So you'd prefer it to be called i686-wine-ming32?
[17:12:58] <engla> pnkfelix: how to easily find the big part? Is it just this one? INTERPOLATED(nonterminal)
[17:13:12] <pnkfelix> engla: I think there are more cases than that 
[17:13:31] <pnkfelix> engla: but I'm not sure.  dbaupp went through ealier today and pointed out a bunch of candidates
[17:13:34] <engla> a very quick look suggests that the others are 24 bytes max
[17:14:04] <cmr> it think it's LIT_FLOAT
[17:14:29] *** Joins: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net)
[17:14:30] <cmr> Well, maybe not
[17:14:36] *** Joins: Kruppe (user@moz-4DDA8AB8.uwaterloo.ca)
[17:14:55] <engla> nope, it's 24 bytes
[17:14:59] <cmr> yeah that'd only be 24 bytes
[17:15:05] <cmr> 16 for the ident and 8 for the float_ty
[17:15:22] *** Joins: hjr3 (hradtke@moz-842BF853.hsd1.ca.comcast.net)
[17:15:24] <cmr> I bet it'd be a big win to have discriminant shrinking
[17:15:29] <cmr> 8 bytes is kinda gluttonous
[17:15:31] *** Joins: azakai (alon@moz-BBE3ABD.mv.mozilla.com)
[17:16:06] <engla> this is a good example
[17:16:08] <cmr> especially for these tiny enums where it could be two bits :p
[17:16:10] <steven_is_false> I get what CFG_RUN is but what is CFG_RUN_TARG?
[17:16:27] *** zz_kimundi is now known as kimundi
[17:16:40] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[17:17:35] <engla> pnkfelix: we can try to add an indirection to INTERPOLATED?
[17:17:56] <pnkfelix> engla: I've been thinking about it.  Niko suggested that we should be trying to put more indirections in
[17:18:09] <pnkfelix> engla: but I also know that pcwalton was hacking recently on the parser
[17:18:19] <cmr> Some well-placed indirection would be spanned<T>
[17:18:27] <pnkfelix> engla: not sure whether I should ping him first, to avoid conflicts
[17:18:31] <cmr> Instead the span should be looked up in a table based on the NodeId
[17:18:38] <engla> ok. ITERPOLATED directly includes  ast::Ty without @, so it may be directly related to the de-@ and re-@ of Ty
[17:18:53] *** Quits: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net) (Quit: eatkinson)
[17:19:02] <cmr> It'd be cool to have an analysis pass that dumps the size of every type
[17:19:12] <cmr> I don't know how to go about that though
[17:19:13] *** Quits: lucian_ (lucian@6B2B4644.4304AE1E.CE5E78F6.IP) (Input/output error)
[17:19:21] <steven_is_false> cmr: Isn't there that in -Z ?
[17:19:35] <cmr>     -Z count-type-sizes     -- count the sizes of aggregate types
[17:19:42] <cmr> by golly there is!
[17:20:18] <steven_is_false> cmr: Don't feel bad, there's always more to do. For example, it was suggested that warnings might be given based on type sizes.
[17:20:27] <cmr> steven_is_false: yeah, I was working on that lint
[17:20:33] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[17:20:34] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[17:20:36] <steven_is_false> cmr: Cool.
[17:20:55] *** Joins: dherman (dherman@moz-FEEC7E9.hsd1.ut.comcast.net)
[17:20:55] *** ChanServ sets mode: +o dherman
[17:21:00] * cmr will have to look at count-type-sizes to see how it does its thing
[17:21:41] <engla> it would be cool if it could point out which variants that bloat an enum
[17:21:54] <cmr> yeah, that's a separate lint that I want to do
[17:22:09] <cmr> echo 2 > /proc/sys/vm/drop_caches
[17:22:12] <cmr> whoops
[17:22:17] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[17:22:49] *** Joins: wting (wting@moz-250C027.csres.utexas.edu)
[17:25:44] <steven_is_false> Awesome! http://fortran90.org/ Finally, I can embrace the bleeding edge of 1990!
[17:27:12] <steven_is_false> Thank you for you help, graydon, and pnkfelix. I feel I'll be able to get it working.
[17:28:25] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Textual IRC Client: www.textualapp.com)
[17:31:28] *** Joins: alisdair (textual@moz-FBF4138A.vc.shawcable.net)
[17:31:57] *** Quits: Kruppe (user@moz-4DDA8AB8.uwaterloo.ca) (Client exited)
[17:32:08] *** Joins: Kruppe (user@moz-4DDA8AB8.uwaterloo.ca)
[17:32:31] *** Quits: Kruppe (user@moz-4DDA8AB8.uwaterloo.ca) (Client exited)
[17:32:40] <engla> pnkfelix: fyi, adding an indirection in INTERPOLATED seems to reduce size of Token to 32
[17:32:52] <pnkfelix> engla: wow.  Okay we should probably do that.
[17:33:16] *** Joins: echristo (echristo@DCF57675.D6CCE4AE.77834EAA.IP)
[17:33:35] <engla> just using ~
[17:34:22] <cmr> I an ast::Ty sufficiently large that just using ids and a TLS hashmap would be desirable?
[17:34:27] <graydon> 32 bytes?
[17:34:51] <graydon> cmr: no. we need less of that sort of magic, not more.
[17:35:05] <pnkfelix> graydon: that's compared to the current 192 bytes
[17:35:19] <cmr> graydon: 8 byte discrim plus 16 byte ast::ident plus 8 byte discrim
[17:35:19] <engla> yes. The biggest variant is LIT_FLOAT(ast::ident, ast::float_ty) which is uint + uint + enum tag   and then enum tag for the Token enum
[17:35:26] <graydon> pnkfelix: I understand, I'm just checking
[17:36:16] <engla> pnkfelix: it's not even completely current master but https://gist.github.com/anonymous/773a42c605f3f8bc6995
[17:37:01] <graydon> engla: right.
[17:37:38] <graydon> time to bust out the "actually use the smallest int type for a tag" logic we've been discussing?
[17:37:39] <jack> graydon: std::rt::io::timer doesn't seem to actually sleep.
[17:37:46] <graydon> jack: are you on newrt?
[17:37:50] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[17:37:54] <jack> i thought it was the default?
[17:37:54] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: devinus)
[17:38:05] <jack> how can i check?
[17:38:25] <engla> pnkfelix: maybe it's not teh best place though, put the indirection in the nonterminal enum instead?
[17:38:25] *** Quits: true_droid (true_droid@moz-123FD9B8.beck.volia.net) (Client exited)
[17:38:29] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[17:39:03] <pnkfelix> engla: <shrug>, I don't yet have an intuition about where the indirection would be best.
[17:39:08] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:39:10] <graydon> grep for a probe for "RUST_NEWRT" env var in the code. the switch came with a change to probing env for "RUST_OLDRT"
[17:39:23] <graydon> jack: ^
[17:39:54] <engla> pnkfelix: I've never contributed to rustc/libsyntax itself either ^^.. since nonterminal has a slew of @ variants, I guess the remaining ones can be ~ instead of by-value
[17:40:11] <jack> graydon: I have the OLDRT probe
[17:40:26] <graydon> jack: then I don't know. ask olsonjeffery perhaps
[17:40:30] *** Quits: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net) (Ping timeout)
[17:40:35] <graydon> (he wrote the new timer)
[17:40:59] *** Joins: hopplaboppla (Mibbit@moz-535184AB.customers.ownit.se)
[17:41:00] *** Quits: mib_dolghw (Mibbit@moz-D3D15A0C.vie.surfer.at) (Quit: http://www.mibbit.com ajax IRC Client)
[17:41:22] <jack> olsonjeffery: any ideas? timer.sleep(2500) doesn't seem to sleep for 2.5 seconds. or for any reproducible amount of time for that matter.
[17:41:51] <hopplaboppla> i just built rust on another computer and get this when quering the version http://pastie.org/8222348
[17:42:07] <hopplaboppla> Same does not happen with rustc
[17:42:28] *** Quits: TD-Linux (TD-Linux@E338EB99.2B4F0AE0.A0A36CCE.IP) (Ping timeout)
[17:42:47] <cmr> hopplaboppla: the rust tool is known to be sketchy
[17:42:53] *** Joins: TD-Linux (TD-Linux@E338EB99.2B4F0AE0.A0A36CCE.IP)
[17:43:13] <hopplaboppla> so no problem yet at least?
[17:43:21] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[17:44:06] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[17:44:06] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/_uGXvA
[17:44:06] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[17:45:06] <jack> olsonjeffery: ok. must have been something dumb i did. seems to be working ok now.
[17:45:10] <cmr> graydon: I think that smaller enum tags would be a huge memory win
[17:45:30] <cmr> enums are everywhere, and almost all (maybe even all?) can fit in a byte
[17:45:56] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[17:46:03] <graydon> cmr: I know. I thought there was a bug on this.
[17:46:29] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[17:46:54] <graydon> https://github.com/mozilla/rust/issues/1647
[17:47:00] <graydon> (there are some other relatives)
[17:47:07] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[17:47:07] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Sy4N1Q
[17:47:07] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[17:47:08] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[17:47:08] <ghrust> 01[13rust01] 15bors pushed 31 new commits to 06auto: 02http://git.io/jrs0Fg
[17:47:08] <ghrust> 13rust/06auto 146011f83 15Erick Tryzelaar: std: minor cleanup
[17:47:08] <ghrust> 13rust/06auto 1408b6cb4 15Erick Tryzelaar: std: add str.to_c_str()
[17:47:08] <ghrust> 13rust/06auto 14fd293df 15Erick Tryzelaar: std: rewrite run::with_{argv,envp,dirp} to copy C strings
[17:47:09] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[17:47:15] <graydon> I think jld is possibly the best bet for attacking it. not sure what he's up to lately.
[17:48:54] <nmatsakis> graydon: fyi my branch for fixing #5762 also fixes &Trait objects
[17:49:08] <nmatsakis> graydon: in patricular it aso converts the visitor from @Trait to &Trait
[17:49:10] <bstrie> so what is the practical use of `int` and `uint`? is it just that, because they're as large as a platform pointer, they're guaranteed to be fast to operate on?
[17:49:26] <bstrie> just wondering why one would choose `int` over `i32`
[17:49:42] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[17:49:45] <nmatsakis> graydon: (still fixing a few lingering issues in that branch though)
[17:49:46] <cmr> bstrie: they're used for lengths and offsets too, although I don't know the precise reason why
[17:49:54] <engla> uint plays the role of size_t
[17:49:55] <steven_is_false> bstrie: uint is like size_t in C
[17:49:57] *** Joins: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:50:02] <strcat> oh wow, oracle changed the berkeley db license to AGPL :|
[17:50:19] <nmatsakis> pnkfelix: were you ever able to narrow down the bug with @Visitor?
[17:50:37] <pnkfelix> nmatsakis: No, because I've been making progress with the other line of attack on it
[17:50:49] <graydon> nmatsakis: which visitor, the reflection one?
[17:50:52] <bstrie> I'm just wondering if it would be catastrophic if `int` and `uint` didn't exist, and you were forced to think more about the sizes of your integers
[17:50:57] <nmatsakis> pnkfelix: ok, I was hoping we could sick sully on it 
[17:51:05] <nmatsakis> graydon:es
[17:51:06] <nmatsakis> *yes
[17:51:07] <pnkfelix> nmatsakis: it might have been something as stupid as #8417
[17:51:13] <graydon> nmatsakis: that's amazing! wonderful!
[17:51:14] <kmc> in  'impl Trait for Ty { pub fn foo() { ... } }'  is the pub ever needed?
[17:51:23] <pnkfelix> nmatsakis: (which I discovered while trying to recreate it)
[17:51:31] <strcat> kmc: no, the trait determines the visibility
[17:51:38] <strcat> kmc: for a non-trait impl it's needed
[17:51:39] <nmatsakis> pnkfelix: I see
[17:51:53] <graydon> nmatsakis: is there anything I can do to help you land it?
[17:52:04] *** Quits: mib_leap (Mibbit@393F3D58.CB450964.520CDC98.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[17:52:17] <pnkfelix> nmatsakis: wait, you're literally porting @Visitor to &Visitor now?
[17:52:29] <pnkfelix> nmatsakis: ugh.  I'm going home.
[17:52:35] <nmatsakis> pnkfelix: not that visitor
[17:52:51] <pnkfelix> nmatsakis: we need to give things things different names.  :)
[17:52:51] <nmatsakis> pnkfelix: that is, not the AST visitor, but the one that's used for reflection
[17:52:59] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[17:53:05] <pnkfelix> sed -e s/things things/these things/
[17:53:19] <kmc> strcat: right, ok thanks
[17:53:20] <nmatsakis> graydon: not sure, I...think it's close?
[17:53:36] <nmatsakis> graydon: right now I'm dealing with an interesting ramification of strcat's work on ~T header removal...
[17:53:47] <graydon> mhm
[17:53:47] <nmatsakis> in paricular, in a ~Object, you don't know what kind of ~T you are dealing with,
[17:53:51] <nmatsakis> so you don't know if there is a header!
[17:54:01] <strcat> nmatsakis: it seems to currently handle that via the tydesc
[17:54:02] <nmatsakis> I'm solving this atm by adding a header_offset into the type descriptor
[17:54:05] <graydon> right
[17:54:09] <graydon> oh god. bleh.
[17:54:19] <nmatsakis> probably the best thing is either to do away with the headers, as I know you have discussed,
[17:54:22] <engla> with the indirection in enum nonterminal, size_of(Token) = 40
[17:54:22] <nmatsakis> or use negative offsets
[17:54:27] <nmatsakis> I was always opposed to the negative offsets but maybe it's not worth the trouble
[17:54:37] <nmatsakis> in particular I realized that objects obviate my main objection
[17:54:49] <graydon> I am not sure I get the issue
[17:54:55] <graydon> but it's not important that I do
[17:55:10] <nmatsakis> basically if oyu invoke an &self mtehod on a ~object,
[17:55:16] <nmatsakis> we need to convert from the ~T pointer we have to an &T pointer,
[17:55:22] <nmatsakis> but do so without knowing the type T,
[17:55:28] <bstrie> rusti: std::sys::size_of<std::libc::size_t>()
[17:55:29] -rusti- <anon>:5:27: 5:44 error: unresolved name `std::libc::size_t`.
[17:55:29] -rusti- <anon>:5          std::sys::size_of<std::libc::size_t>()
[17:55:29] -rusti-                                     ^~~~~~~~~~~~~~~~~
[17:55:29] -rusti- error: aborting due to previous error
[17:55:29] -rusti- application terminated with error code 101
[17:55:32] <nmatsakis> and that is not possible without adding a bit of info to the type descriptor,
[17:55:40] <nmatsakis> because the type T tells us whether ~T has a header or not
[17:56:19] * pnkfelix thinks that rusti should private message more of its output, and just say "error" to the group at large.
[17:56:36] <strcat> pnkfelix: it could pastebin everything longer than 1-2 lines
[17:56:41] <strcat> it crosses over at 5 atm
[17:56:44] *** Joins: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com)
[17:56:44] *** ChanServ sets mode: +o pcwalton
[17:56:59] *** Joins: eschweic1 (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:57:00] <pnkfelix> strcat: I guess my intution was that errors are often not of interest to the immediate group at large
[17:57:00] <strcat> rusti: for i in range(0, 5) { printfln!("%d", i) }
[17:57:02] -rusti- pastebinned 6 lines of output: http://ix.io/79q
[17:57:11] <pnkfelix> strcat: while correct output, even that occupying five lines, could well be.
[17:57:12] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[17:57:29] <pnkfelix> strcat: (this is only a very rough heuristic, I freely admit)
[17:57:29] *** Quits: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP) (No route to host)
[17:57:41] <bstrie> rusti: std::sys::size_of::<int>()
[17:57:42] -rusti- 8
[17:57:47] <bstrie> rusti: std::sys::size_of::<size_t>()
[17:57:49] -rusti- pastebinned 8 lines of output: http://ix.io/7ad
[17:58:01] <graydon> I find rusti chatter in the channel is ... _usually_ not helpful to most?
[17:58:07] <graydon> I mean, I'm glad it's here
[17:58:31] <graydon> but I wonder if it might be possible to have it switch to privmsg by default and require a directive to talk in-channel
[17:58:33] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[17:58:33] *** ChanServ sets mode: +o tjc
[17:58:36] <pnkfelix> maybe strcat has the right idea: pastebin if output > 2 lines?
[17:58:50] * pcwalton remembered when brson came in and said to me "hey patrick, #rust is a REPL"
[17:59:08] <kimundi> haha
[17:59:09] *** Joins: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP)
[17:59:09] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[17:59:10] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14b45a452 to 1474efdf6: 02http://git.io/N3iJvQ
[17:59:10] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[17:59:10] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[17:59:10] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/rV6IVw
[17:59:10] <ghrust> 13rust/06auto 14b326176 15Young-il Choi: std: run test fix for ARM android
[17:59:10] <ghrust> 13rust/06auto 14492cbce 15Young-il Choi: mk: install.mk fix to specify ADB variables not adb
[17:59:11] <ghrust> 13rust/06auto 14d463f4c 15Young-il Choi: mk: test.mk fix to specify ADB variables not adb
[17:59:11] <graydon> no, I mean, most of the time it's just people doing very idle check-a-value stuff they would use a repl for 
[17:59:13] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[17:59:19] <doomlord_> http://dobkeratops.github.io/rftest/index.html << more WIP.. cleaned up some more, and tried it on more of the rust sourcetree, excuse the placeholder index page..
[17:59:25] <strcat> graydon: well, that was supposed to be the idea of enabling private messages to it ;p
[17:59:30] *** Joins: mschifer1 (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:59:37] *** Quits: alisdair (textual@moz-FBF4138A.vc.shawcable.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[17:59:38] <bstrie> sorry :P
[17:59:43] <graydon> strcat: indeed. yet .. do you have stats on how many people do that?
[17:59:51] *** Joins: mschifer2 (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:59:53] *** Quits: mschifer1 (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[18:00:00] *** Quits: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[18:00:00] <strcat> graydon: nope, I could start logging :P
[18:00:04] * cmr does it
[18:00:07] <engla> rusti-the-program is working well nowadays
[18:00:08] <graydon> bstrie: it's ok, I'm not like upset or anything, just given that we're discussing limiting its output to be less chatty ... I think _most_ of the chattiness comes from one-off expression checks
[18:00:09] <kimundi> bstrie: we're all at fault
[18:00:11] <pnkfelix> graydon: is this a sign that we need to improve `rust sketch`?  Or is the habit of using rusti even for private usage too ingrained at this point?
[18:00:21] <graydon> dunno
[18:01:09] <graydon> (is rust sketch online? I thought we blocked on finding a viable host)
[18:01:11] <strcat> pnkfelix: well maybe people will use the soon to come web version
[18:01:29] <pnkfelix> graydon: I just mean the terminal version of `rust sketch`
[18:01:34] <pnkfelix> graydon: aka `rusti`
[18:01:49] <graydon> oh. well, it has been through a lot of iterations.
[18:01:53] <nmatsakis> graydon: in your new emacs mode, the indentation for `foo(\nbar` is wrong (it matches `bar` up with the `(`)...has this been fixed?
[18:02:16] <graydon> I think it's pretty good now? I don't use it though. but I don't have the habit of repls for static languages. don't know why.
[18:02:23] <graydon> never used the ocaml one either. rarely haskell.
[18:02:27] <strcat> pnkfelix: I still just write test programs because the actual rusti always screws up somehow
[18:02:32] <strcat> it likes to exit for no reason :s
[18:02:32] <pnkfelix> strcat: same here
[18:02:42] <kimundi> i think people use rusti here because its reliable, up to date, and easy accesible
[18:02:47] <graydon> nmatsakis: that's intentional. where would you want it to line up?
[18:02:56] <graydon> kimundi: yes, definitely
[18:03:02] <strcat> pnkfelix: http://ix.io/7ae
[18:03:12] <nmatsakis> graydon: usually if you have an open paren, but nothing afterwards, then the next line is indented four spaces rather than matching the open paren
[18:03:21] <strcat> well it doesn't work at all anymore
[18:03:24] <strcat> maybe it stack overflows
[18:03:25] <graydon> I'm not opposed to rusti being here at all. glad it's here. wonder if we can alter its behavior a touch so that it nudges users into privmsg-bound conversation
[18:03:46] <nmatsakis> graydon: so that you can do `foo(something_very_long(), something_else_long())` and not be too horizontal?
[18:03:54] <graydon> I guess I'm the only one who uses an IRC client with tabs
[18:04:07] <strcat> graydon: mine has tabs/splits ;p
[18:04:21] <strcat> I have 10 channels already though
[18:04:31] * strcat just lurks in 8
[18:04:45] <graydon> nmatsakis: ah, when it's _just_ a ( at end of line, I see. the algorithm it has now is based on assuming you split somewhere mid-list foo(a,b,c,<break here>,d,e,f)
[18:05:14] <nmatsakis> graydon: right, and in that case it is doing the right thing
[18:05:15] <engla> graydon: is it the wrong time to try to shrink enum Token (because of others working on it)?
[18:05:31] <pnkfelix> pcwalton: ^
[18:05:41] <engla> oh thanks pnkfelix 
[18:05:42] <pnkfelix> pcwalton: (since I know you've been doing parser hacking recently)
[18:05:43] <pcwalton> nope
[18:05:46] <pcwalton> feel free
[18:06:07] <engla> great
[18:06:08] <graydon> engla: I don't know of anyone working on it except you.
[18:06:10] *** Quits: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[18:06:14] <pcwalton> we should write a genetic algorithm to randomly insert @ and ~ boxes into AST nodes and see what that does to compile times
[18:06:21] <graydon> oh
[18:06:22] <pcwalton> (kidding of course)
[18:06:41] <graydon> it's a funny thing :)
[18:06:52] <strcat> pcwalton: on a related note, when rusti encounters a type error it should just automatically insert a transmute ;P
[18:06:52] <pcwalton> but I seriously have no intuitions about what speed gains are likely by adding or reducing indirection in the AST
[18:07:00] <strcat> er, when rustc*
[18:07:02] <graydon> "control over memory layout" means you have to make a lot of decisions that are rarely clear
[18:07:31] <pcwalton> strcat: we should give rusti ops and then it should kick you if you give it an expression with a type error
[18:07:32] <graydon> (note: this is not an argument for no-control; in uniform-representation languages you're SOL)
[18:07:35] *** Joins: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com)
[18:08:26] <strcat> nmatsakis: a possible third layout for ~T is storing elements smaller than pointer-size in-place too, but maybe I'm crazy for thinking that's a good idea :P
[18:08:30] *** Quits: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com) (Max SendQ exceeded)
[18:08:37] <graydon> I would be really interested to see a research project that looks at a data structure and tells you (somehow, using $MAGIC static analysis / runtime instrumentation / etc.) which bits are better changed from direct to indirect, or vice versa
[18:08:59] *** Joins: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com)
[18:09:06] <strcat> but ideally the headers would be gone on all of them since the gc already knows that stuff
[18:09:40] <strcat> graydon: it probably depends a lot on the CPU cache
[18:10:01] *** Quits: dherman (dherman@moz-FEEC7E9.hsd1.ut.comcast.net) (Quit: dherman)
[18:10:11] <graydon> mhm
[18:10:18] <jld> graydon: At the moment, using the ICFP contest as an excuse to learn JavaScript.
[18:10:32] *** Joins: doener (doener@moz-121949B3.unitymediagroup.de)
[18:10:37] <graydon> haha
[18:11:02] <pnkfelix> pcwalton: the reason I was interested in indirections was because I saw some comments in parser.rs about avoiding copying Tokens
[18:11:23] <pnkfelix> pcwalton: which led to me to say "What?  Aren't tokens tiny?"  And then discover that they currently are 192 bytes.
[18:11:31] <kmc> o_O
[18:11:34] <jld> O_o
[18:11:39] <tjc> 0_0
[18:11:41] *** Quits: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[18:11:45] <kmc> ê™®_ê™®
[18:11:47] <pcwalton> heh
[18:11:54] <pnkfelix> pcwalton: (which is probably a mistake from the de-@'ing and re-@'ing of Ty.  Maybe)
[18:11:55] <pcwalton> I think it is worth looking at AST node sizes in general
[18:12:08] <kmc> i'm trying to write Â«fn next(&'self mut self) -> Option<&'self Range>Â» and I get "method `next` has an incompatible type: expected concrete lifetime, but found bound lifetime parameter &", but if I have just "&mut self" then I get a borrow error which suggests I need a lifetime there
[18:12:10] *** Joins: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com)
[18:12:10] <graydon> that's exactly why I added the type size -Z flag
[18:12:14] *** kimundi is now known as zz_kimundi
[18:12:17] <kmc> what to do :(
[18:12:45] <pnkfelix> oh man, the ICFP contest is this weekend?  shoot...
[18:12:59] <doener> pcwalton: do you have a moment to look at / comment on https://github.com/mozilla/rust/pull/8270 please?
[18:13:04] <strcat> kmc: it's an Iterator impl?
[18:13:07] <kmc> yep
[18:13:08] <engla> pnkfelix: I'm running tests on the change to put it at 40 bytes.
[18:13:09] *** Quits: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com) (Max SendQ exceeded)
[18:13:17] <strcat> kmc: yeah it won't let you put a region on &self
[18:13:17] <pcwalton> kmc: what is the signature of the trait you're implementing?
[18:13:27] <strcat> kmc: it has to come from the type definition
[18:13:37] <engla> pnkfelix: it's not perfect, but enum tag shrinking can do something too
[18:13:39] <strcat> because in generic code, iterators lifetime is not tied to what they return
[18:13:52] <strcat> you're allowed to make an iterator to a container, yield some elements, and have the iterator go out of scope
[18:13:57] <strcat> the ptrs to elements are tied to the container
[18:14:01] <kmc> sure
[18:14:03] <nmatsakis> what is the best way to translate offsetof() into LLVM... constgepi?
[18:14:10] <nmatsakis> I guess I can see what clang does
[18:14:18] <pcwalton> nmatsakis: see what cl...yeah :)
[18:14:24] <strcat> nmatsakis: yeah inbounds GEP with a constant
[18:14:32] <strcat> I think struct GEP *has* to be a constant though
[18:14:38] <strcat> if you're selecting by field #
[18:14:42] <kmc> strcat: I guess this is a kind of synthetic iterator that generates elements on the fly
[18:14:50] <kmc> and those generated elements are stored in the iterator struct itself
[18:14:55] <nmatsakis> I'm using LLVMConstInBoundsGep, but I'm getting some kind of odd iterator
[18:14:58] <nmatsakis> *error
[18:15:02] <kmc> so that's probably not compatible with the current iterator API :(
[18:15:11] *** Quits: hjr3 (hradtke@moz-842BF853.hsd1.ca.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[18:15:11] <doener> pcwalton: thanks
[18:15:25] <strcat> kmc: yeah I don't think it will be, you'd have to have an &mut reference to a vector to store them in
[18:15:30] <strcat> and tie that 'self lifetime to the return
[18:15:35] <nmatsakis> oh, wait... maybe I'm casting to the wrong type
[18:16:10] <strcat> kmc: how about just generating them and returning them by-value?
[18:16:18] <kmc> yeah I can do that in this case
[18:16:35] <strcat> kmc: we could have an adaptor like `tee` storing stuff
[18:16:39] <kmc> we have return value optimization, right? so that basically just generates them in the caller's scope
[18:17:02] <strcat> kmc: in theory, yes, but it doesn't work very well with the IR we generate
[18:17:19] <kmc> ok, well in my case they are small enough that passing by value is ok anyway
[18:17:24] <strcat> it likes to allocate a local and memcpy it into the ptr instead of just writing into the ptr in the first place
[18:17:58] <kmc> I wonder if I should stop using the lifetime name 'self when possible... it seems to produce confusion :)
[18:18:05] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[18:18:11] <strcat> whenever you use 'self, you're probably going to run into an ICE :)
[18:18:20] <strcat> regular lifetimes I haven't hit one for ages
[18:18:26] <kmc> why does 'self exist anyway
[18:18:35] <strcat> kmc: just an arbitrary legacy naming restriction
[18:18:35] <tjc> kmc: philosophers have asked that question for ages
[18:18:52] <kmc> D
[18:18:54] <kmc> :D
[18:19:11] *** Quits: echristo (echristo@DCF57675.D6CCE4AE.77834EAA.IP) (Ping timeout)
[18:19:15] *** Quits: doener (doener@moz-121949B3.unitymediagroup.de) (Quit: leaving)
[18:19:16] <nmatsakis> kmc: the need for 'self will be lifted .. shortly :)
[18:19:44] <nmatsakis> "real soon now" (meaning: I haven't started working on it yet)
[18:21:39] *** Joins: Ralith (ralith@moz-50F3C77.vc.shawcable.net)
[18:21:47] *** Joins: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com)
[18:22:10] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[18:23:39] *** Quits: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[18:23:41] *** Quits: reyre (reyre@FCCEA34F.7672369.D8E68FF6.IP) (Client exited)
[18:23:54] *** Joins: echristo (echristo@DCF57675.D6CCE4AE.77834EAA.IP)
[18:23:57] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[18:24:17] <engla> so isrustfastyet says that the builders are compiling faster now after newrt landed
[18:24:27] <bstrie> acrichto: ifmt is really nifty
[18:25:06] <bstrie> irfy says that we're compiling 500 seconds faster than july 31
[18:25:29] <bstrie> combination of newrt and newfor
[18:25:39] <strcat> there are more easy wins with for loops
[18:25:52] <strcat> if only I could figure out why those loop passes don't like our loop pattern
[18:26:12] *** Joins: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com)
[18:26:16] <bstrie> strcat: vectorization passes?
[18:26:34] <acrichto> bstrie: thanks! once it's snapshotted we even have the possibility of removing fmt!
[18:26:39] <strcat> bstrie: more than just that one
[18:26:50] *** Joins: milinda (milinda@3CE69972.ED81CFCE.51B6877.IP)
[18:27:06] <pcwalton> acrichto: have you benchmarked how fast the new fmt compiles?
[18:27:08] <pcwalton> it might be interesting
[18:27:17] <bstrie> acrichto: one thing though: can {} automatically call .to_str() rather than using reflection? %? isn't suitable for use in safe code
[18:27:24] <strcat> loop-{simplify,rotate,unswitch,idiom,vectorize,deletion} aren't happy
[18:27:25] <acrichto> pcwalton: the compilation time or the comparison with the old fmt!?
[18:27:52] *** Joins: reyre (reyre@FCCEA34F.7672369.D8E68FF6.IP)
[18:27:54] <strcat> bstrie: unrolling actually seems to work though :s
[18:27:58] <pcwalton> write something like 10,000 lines of old fmt and 10,000 lines of new fmt and see how the compilation time differs
[18:28:01] <acrichto> bstrie: perhaps, there may be bugs preventing that though... 
[18:28:05] *** zz_kimundi is now known as kimundi
[18:28:15] <bstrie> acrichto: also, what the heck does %.*s do?
[18:28:38] <acrichto> bstrie: the first argument is a uint and the second is a string, the uint is how long the string should be printed
[18:28:39] <strcat> in C, * is for runtime settings on limits, padding, etc.
[18:28:49] <acrichto> pcwalton: I'll look into it, it'll take awhile to build a copy locally though
[18:28:58] <bstrie> oh, so that isn't literally what you'd write?
[18:29:16] <bstrie> or is it
[18:29:19] <bstrie> it's hard to google for
[18:29:20] *** Quits: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[18:29:45] <acrichto> bstrie: no that is, it's in place of something like %10s where the '10' is a #define'd constant
[18:29:49] *** Joins: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com)
[18:30:02] <bstrie> ok
[18:30:18] *** Quits: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com) (Client exited)
[18:30:40] *** Joins: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com)
[18:31:31] <bstrie> acrichto: also, I'm not sure how to use named arguments: http://ix.io/7aj
[18:31:47] <acrichto> bstrie: ifmt!("{foo}", foo=foo)
[18:31:51] <bstrie> aha
[18:31:55] <acrichto> or foo=2
[18:31:57] <acrichto> things like that
[18:35:09] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:35:09] *** ChanServ sets mode: +o brson
[18:37:17] <kmc> I have this feeling that API design with region pointers is really hard :)
[18:37:21] <toddaaro> brson: want to read over my slides quickly? can send them over now
[18:37:28] <strcat> engla: the drop in rustc compilation might have more to do with segmented stacks than the scheduler
[18:38:09] *** Joins: huddler (Mibbit@393F3D58.CB450964.520CDC98.IP)
[18:38:19] <brson> toddaaro: sure!
[18:38:31] <toddaaro> brson: what is your e-mail?
[18:38:35] <engla> good point. I was mostly thinking of a lack of regression to be honest
[18:38:40] <brson> toddaaro: banderson@mozilla.com
[18:38:56] <toddaaro> brson: sent
[18:39:06] <brson> there shouldn't be any difference in stack-related performance on 64-bit platforms (of course there may be anyway)
[18:39:17] <brson> well, we're actually allocating half as much stack
[18:39:20] *** Quits: sankha93_ (Instantbir@7061CD01.D6BD0D91.22D41759.IP) (Quit: Gone to save the world!)
[18:39:23] <brson> so maybe that could cause a diff
[18:39:42] <brson> we were already using 4MB segments
[18:39:46] *** Joins: Florob (Florob@moz-39532932.de)
[18:40:55] *** Joins: ruediger (quassel@moz-C9B8D8D0.org)
[18:41:12] <ruediger> hi
[18:41:26] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[18:42:13] <jdm> kmc: it's certainly more complicated than just throwing an @ in there :)
[18:44:04] <ruediger> where can I find information about the exception system in rust?  There doesn't seem to be anything in the manual (or I'm blind).  The homepage says "Exception handling: unrecoverable unwinding with task isolation".  So are there no longer plans for common lisp-style restarts?
[18:44:33] <cmr> ruediger: we have a condition system in std::condition
[18:44:48] <bstrie> strcat: now's your chance to reenable jemalloc while the stacks are big enough, and then when they try to turn on split stacks they'll get rejected by the regression ratchets :P
[18:45:04] <cmr> ruediger: we don't have exceptions, though. not really. when a task fails, it unwinds, and the parent task can "catch" the failure
[18:45:21] <strcat> brson: do we still have the same __morestack preludes?
[18:45:33] <ruediger> cmr: so it's erlang-like?
[18:45:48] <cmr> ruediger: I don't know anything about erlang to answer that question
[18:45:50] <ecr> reudiger: erlang is probably the most similar system
[18:46:01] <strcat> ruediger: you can handle conditions at the call site, otherwise you can catch failures at task boundaries
[18:46:16] <strcat> there are no catchable exceptions except at task boundaries though
[18:46:33] <strcat> so for error handling, you essentially have a choice between a condition or a sum type
[18:46:36] <brson> strcat: yes
[18:47:25] <ruediger> ok, thanks.
[18:47:28] <strcat> on a function like read() or write() where the purpose is a side effect, I think you'll always want a condition
[18:49:36] <cmr> brson: r? https://github.com/mozilla/rust/pull/8419
[18:50:09] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[18:51:54] <huddler> whats a drop glue?
[18:52:40] *** Joins: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net)
[18:53:13] <acrichto> pcwalton: compiling ifmt is 2x faster https://gist.github.com/anonymous/6196146
[18:53:25] <strcat> huddler: the code generated by the compiler for destructors
[18:53:31] <acrichto> pcwalton: although I'm not sure why...
[18:54:05] <bstrie> acrichto: can you explain what's happening at https://github.com/mozilla/rust/blob/ffb670ffcd69ed8e7cd13a7f06375ede752349e2/src/test/run-pass/ifmt.rs#L60 ?
[18:54:13] <huddler> strcat: oh...why is called 'glue'?
[18:54:43] <bstrie> acrichto: specifically what is "plural" for, and why is it "zero" instead of "=0" ?
[18:54:43] <acrichto> bstrie: to prefix this, I plan on writing nice long documentation for ifmt! at some point before we remove fmt!
[18:55:24] <engla> acrichto: it's nice. will it support wprintf as well (to a Writer)?
[18:55:26] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Client exited)
[18:55:39] <strcat> huddler: it glues together all rust programs? dunno ;p
[18:55:41] *** Joins: lmandel-pto (lmandel@62615120.A1163AD8.ADB88A9.IP)
[18:55:47] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[18:55:48] *** Quits: eschweic1 (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[18:55:53] <bstrie> huddler: since when has CS jargon ever made sense?
[18:55:58] <bstrie> like, what the heck is a "string"
[18:55:58] <Ms2ger> Heh
[18:56:00] <strcat> there's also take glue (implicit copies), visit glue (fmt!("%?", x))
[18:56:01] <acrichto> bstrie: basically `plural` is a method that selects over an unsigned int passed in, and then cases are specified. =N means that if the argument is exactly N, then that case is executed. There are also a number of keywords (zero, one, two, few, many) which can be defined per-locale. The keywords also take into account the `:offset` parameter. Finally there, the `#` is a back-reference to what's being matched by the `plural` method
[18:56:32] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[18:56:35] <bstrie> acrichto: is there prior art for this?
[18:56:41] <acrichto> engla: it will indeed! currently there's a lot of bugs blocking that (8401, 8398, 8249, 8248)
[18:57:00] <engla> great!
[18:57:09] <acrichto> bstrie: http://www.icu-project.org/apiref/icu4j/com/ibm/icu/text/MessageFormat.html
[18:57:18] <acrichto> bstrie: also https://github.com/SlexAxton/messageformat.js
[18:57:25] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[18:57:28] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Ping timeout)
[18:57:32] <bstrie> ah neat
[18:57:32] <huddler> bstrie:  Phil Karlton agrees with you :P
[18:57:38] <acrichto> engla: but yeah I plan on making a `fprintf` function and possibly a `ffmt` macro to go along with it or something like that
[18:58:16] <bstrie> acrichto: can we just follow this ICU spec and get everything we need, with no bikeshedding? :)
[18:58:46] <acrichto> bstrie: the ICU spec I don't think had stuff about things like integer precision or formats or widths or things like that
[18:59:02] <acrichto> bstrie: but for methods like select/plural, I will definitely be following the ICU spec (should already be implemented)
[18:59:03] <graydon> acrichto: what are the size differences on the outputs from that compile run?
[18:59:49] <acrichto> graydon: less exciting fmt was 310k, ifmt was 529k
[18:59:50] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[19:00:13] <acrichto> interesting that it's a 2x speedup with 2x more memory...
[19:00:13] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: zzzzzzzzzz)
[19:00:30] <graydon> how about the sizes of the .text and .data / .rodata sections?
[19:00:34] <engla> huddler: glue code is called that because it's needed to tie different models together. Say the Rust language with the llvm implementation of it
[19:00:44] <acrichto> graydon: is the a convenient command to print that out?
[19:01:18] <graydon> acrichto: which platform?
[19:01:23] <acrichto> graydon: ah found it, one sec (osx)
[19:02:00] <graydon> gobjdump -h <filename>
[19:02:59] <huddler> engla: ha..that makes sense now...thanks :)
[19:03:04] <acrichto> graydon: fmt -- text 0x9848, data small, ifmt -- text 0x658c, data 0x3a890
[19:03:18] *** Parts: steven_is_false (user@C5B76363.1FF1EBF8.1ECA502.IP) (ERC Version 5.3 (IRC client for Emacs))
[19:03:22] <acrichto> graydon: https://gist.github.com/alexcrichton/6196232
[19:03:37] <graydon> right
[19:03:46] <graydon> so it's the statics that make the size difference
[19:03:54] <acrichto> yeah that's what I would have expected
[19:04:01] <acrichto> not quite so drastic though
[19:04:30] *** Quits: lkuper (lkuper@63686BC7.F689A8C9.EB438161.IP) (Quit: lkuper)
[19:04:32] <graydon> can you look into making them mergeable?
[19:04:51] <graydon> in many cases I bet the piece specifiers will be value-equivalent
[19:04:56] <strcat> unnamed_addr
[19:05:03] *** Joins: true_droid (true_droid@moz-123FD9B8.beck.volia.net)
[19:05:05] <graydon> mhm. do we support that?
[19:05:05] <acrichto> strcat: we don't do that currently?
[19:05:14] <strcat> we only put it on glue code
[19:05:28] <graydon> you wouldn't want to put it on pub statics
[19:05:32] <strcat> and it doesn't do anything with the mergefunc pass on glue code
[19:05:38] <strcat> without*
[19:05:38] <graydon> but private statics should be .. well, plausible?
[19:05:42] * nmatsakis wonders how adding a field to the type descriptor caused 67400 objects to leak
[19:05:46] <strcat> graydon: only if they're not user-visible
[19:05:48] <acrichto> graydon: TLS being keyed off addresses could cause problems with that
[19:05:48] <graydon> strcat: this is for data, not fns
[19:06:02] <acrichto> perhaps a #[allow_merge] attribute or something like that?
[19:06:07] <graydon> yeah. it could at least be possible to put an attribute, I think?
[19:06:11] <strcat> yes
[19:06:23] <cmr> nmatsakis: did you add it to the end? I'm sure there's lots of code that depends on the exact order of the fields
[19:06:27] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[19:06:38] <acrichto> graydon: I'll look into it though
[19:06:44] <acrichto> b/c that'd be pretty sweet to merge all of it
[19:06:45] <nmatsakis> cmr: I did not, and I should hope not!
[19:06:47] <acrichto> anyway brb
[19:06:53] <nmatsakis> cmr: there are constants...
[19:07:24] <nmatsakis> cmr: but yes I presume it's something like that.
[19:07:31] <strcat> nmatsakis: you'll need to update them in libstd/unstable/raw.rs too
[19:07:40] <strcat> er
[19:07:44] <strcat> well, if it's just the tydesc no
[19:07:53] <strcat> I forget where the libstd version of that is
[19:08:06] <nmatsakis> I updated that
[19:08:21] <nmatsakis> I *think* I updated all the redundant copies of that structure that are lying around :)
[19:08:35] <nmatsakis> one in rt, one in std, one in trans, the constants in abi
[19:08:39] <strcat> nmatsakis: maybe it's a stage mismatch with libstd?
[19:08:45] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Ping timeout)
[19:08:50] <nmatsakis> hmm actually that could be
[19:09:03] <nmatsakis> I didn't #[cfg(stage0)] it, but I guess I do have to
[19:09:07] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[19:09:13] <nmatsakis> oh, and the runtime--- urgh.
[19:09:19] <nmatsakis> maybe I should add it to the end :)
[19:09:24] <strcat> the runtime actually has macros for that now
[19:09:34] <nmatsakis> do we build multiple copies now?
[19:09:36] <strcat> yeah
[19:09:38] <nmatsakis> ok
[19:11:27] <nmatsakis> still, cmr's right, adding it to the end is better, I think then I don't need any #[cfg] business
[19:11:43] <nmatsakis> (since this field is not used from std)
[19:11:51] <strcat> nmatsakis: they might use it by-value somewhere though
[19:12:07] <nmatsakis> I don't think so, but yes that would be trouble 
[19:12:53] *** Quits: lmandel-pto (lmandel@62615120.A1163AD8.ADB88A9.IP) (Quit: lmandel-pto)
[19:15:37] *** Quits: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl) (Ping timeout)
[19:17:23] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[19:17:33] *** Joins: Home (chatzilla@moz-C13912C2.dynamic.isp.telekom.rs)
[19:18:12] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[19:22:18] *** Quits: olsonjeffery (pf@B8927AE1.CFEFA148.239A1A9E.IP) (Ping timeout)
[19:23:01] *** Quits: igl (igl@moz-EE0266CC.adsl.alicedsl.de) (Ping timeout)
[19:23:04] *** Joins: igl (igl@moz-5D0EF5D5.adsl.alicedsl.de)
[19:24:45] *** Quits: Home (chatzilla@moz-C13912C2.dynamic.isp.telekom.rs) (Client exited)
[19:25:18] *** Joins: Home (chatzilla@moz-C13912C2.dynamic.isp.telekom.rs)
[19:28:08] *** Quits: huddler (Mibbit@393F3D58.CB450964.520CDC98.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[19:30:18] <graydon> brson: ever seen this before? https://gist.github.com/graydon/35290fe8eef25a814bc3
[19:37:07] *** Quits: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com) (Quit: tchoma)
[19:37:56] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[19:38:35] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[19:39:55] <heftig> env! is expanded to a string literal at compile-time?
[19:40:03] <cmr> heftig: yes
[19:40:07] <heftig> hm, interesting.
[19:40:17] <cmr> that is why it's a syntax extension and not a regular function in a regular library
[19:41:04] <heftig> I suppose for option_env!, the dead code is eliminated?
[19:41:20] <cmr> only if you compile with optimizations
[19:42:33] <engla> here is the shrink enum Token PR, https://github.com/mozilla/rust/pull/8420  
[19:42:52] <acrichto> strcat: you said that we put unnamed_addr on glue right now?
[19:43:01] <strcat> acrichto: yes
[19:43:12] <strcat> it doesn't result in any optimizations yet
[19:43:20] <acrichto> strcat: where is it? (in the code)
[19:44:28] <kmc> so in "cannot root managed value long enough", a "managed value" is anything that contains @/@mut transitively, and "rooting" means making sure it doesn't disappear while borrowed?
[19:44:47] <nmatsakis> the first part isn't quite right
[19:44:47] <kmc> (and making sure it doesn't move, with a hypothetical moving GC)
[19:44:50] <nmatsakis> necessarily
[19:45:01] <nmatsakis> it means that you are borrowed the content of an @ box
[19:45:15] <nmatsakis> but there is no guarantee that the @ box will stay live as long as your borrow
[19:45:24] <strcat> acrichto: I can't find it :s
[19:45:32] <nmatsakis> the phrase "root managed value" means that the compiler will automaticaly add a root, but it can't add one that lasts long enough
[19:45:34] <acrichto> strcat: oh well, I'll just add it to rustwrapper.cpp
[19:46:03] <strcat> I did expose it before...
[19:46:13] <strcat> maybe I never sent a PR
[19:47:01] <strcat> acrichto: https://github.com/mozilla/rust/pull/6787
[19:47:10] <kmc> nmatsakis: i see
[19:47:15] <acrichto> strcat: perfect, thanks!
[19:47:30] <strcat> acrichto: doesn't seem it was ever actually merged... don't remember why
[19:47:37] <strcat> you could just start with those, though
[19:47:38] <nmatsakis> are the buildbots stuck?
[19:47:41] <acrichto> strcat: test failures?
[19:47:48] <strcat> acrichto: don't remember if it was related or not
[19:49:43] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Quit: Lost terminal)
[19:50:24] <engla> cmr: thanks :)
[19:50:55] *** Quits: mihneadb (mihneadb@E48845AB.3A9F9BD4.4C2245EF.IP) (Ping timeout)
[19:54:30] *** Quits: thpickert (thpickert@moz-34341F25.dynamic.dsl.tng.de) (Quit: thpickert)
[19:54:46] <nmatsakis> woohoo, now able to bootstrap a rustc with ~objects and &objects that work, or work more anyhow
[19:55:18] * nmatsakis settles in to wait for `make check`
[19:56:08] <bstrie> ooh
[19:56:12] <bstrie> &objects!!
[19:56:26] * bstrie wonders how sully is coming along with default methods
[19:56:40] <cmr> I haven't had a bug with default methods
[19:56:45] <cmr> for quite some time
[19:57:08] <cmr> it's mostly just trait object inheritance that is broken, but that's not just a default method problem I don't think
[19:57:46] *** Joins: mihneadb (mihneadb@E48845AB.3A9F9BD4.4C2245EF.IP)
[19:57:52] <acrichto> strcat: how come you just closed 5613?
[19:58:03] <strcat> I accidentally opened it
[19:58:14] <acrichto> strcat: huh ok
[19:58:28] <strcat> we can't put it on globals
[19:59:19] <acrichto> not by default at least
[20:02:20] *** Joins: Blub\0 (wry@7E3BB9D.71150E1A.237AE2BA.IP)
[20:02:26] *** Quits: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP) (Ping timeout)
[20:03:05] <sully> bstrie: default methods I think are basically fixed
[20:03:11] <sully> trait object inheritance is broken
[20:03:16] <sully> it isn't related to default methods
[20:03:20] <sully> I am likely to take a look at it soon
[20:05:08] <jack> aren't intern presentations now?
[20:05:18] <jack> i dont' see anything on air.mozilla
[20:05:28] <cmr> are those recorded or otherwise broadcasted?
[20:05:32] * cmr wants to watch
[20:05:43] <jack> https://air.mozilla.org/intern-presentations-summer-2013/
[20:06:15] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[20:06:25] *** Quits: Ms2ger (Ms2ger@moz-E9883900.access.telenet.be) (Quit: nn)
[20:06:26] <jack> on the 13th are bblum, eatkinson, and eschweic
[20:06:44] *** Joins: eschweic1 (Adium@moz-BBE3ABD.mv.mozilla.com)
[20:06:44] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[20:06:46] <jack> on the 14th it's sully
[20:07:12] <jack> supposed to start at 1pm pacfici, but seems delayed today
[20:07:49] *** Quits: jdm (jdm@9FB21CB6.76DE1AD5.AE2B2F80.IP) (Ping timeout)
[20:08:00] <bblum> oh aaron's is in 20 minutes isn't it
[20:08:49] *** Joins: dim-an (ermolovd@moz-74FA7782.yandex.net)
[20:08:56] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[20:09:26] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:09:35] <Florob> +
[20:10:15] *** Quits: metasyntax (tvenable@moz-63D9B3D.med-web.com) (Quit: Leaving)
[20:11:41] *** Quits: nielsle (nielsle@moz-5CE8ECCD.boa.fiberby.dk) (Ping timeout)
[20:12:38] <jack> what's the RUST_LOG magic to turn on info!
[20:12:50] <cmr> RUST_LOG=module=3
[20:12:52] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[20:12:52] *** ChanServ sets mode: +o brson
[20:12:56] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[20:12:56] *** ChanServ sets mode: +o tjc
[20:13:12] <jack> is debug=1 and error=5? or the other way?
[20:13:41] <cmr> debug=4, error=1
[20:14:09] <cmr> (info=3, warn=2)
[20:14:24] *** Joins: fyolnish (fyolnish@moz-1E2C1F00.uqwimax.jp)
[20:14:36] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:15:58] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[20:16:04] <pcwalton> sully: is it intentional that when you invoke static methods with the ::<> explicit type parameter syntax, Self is the first type parameter there?
[20:16:11] *** Joins: eholk (eholk@moz-EA69C7A5.wavecable.com)
[20:16:45] *** Joins: Blub\1 (wry@7E3BB9D.71150E1A.237AE2BA.IP)
[20:16:49] <pcwalton> actually this is all messed up
[20:16:57] * pcwalton goes to fix
[20:17:11] *** Quits: Blub\0 (wry@7E3BB9D.71150E1A.237AE2BA.IP) (Ping timeout)
[20:17:16] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[20:17:16] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/rV6IVw
[20:17:16] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[20:17:20] <acrichto> strcat: is there a reason that strings are internal linkage instead of private (clang uses private)
[20:17:24] <sully> pcwalton: yes
[20:17:32] <strcat> acrichto: probably not
[20:17:33] <pcwalton> sully: this seems strange
[20:17:43] <pcwalton> and also doesn't seem to work right
[20:17:50] <sully> pcwalton: well, it is "all of the trait type params", then self, then "all of the method type params"
[20:17:50] <acrichto> strcat: mk testing with private now, unnamed_addr on ifmt statics didn't merge anything
[20:17:51] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[20:18:02] <pcwalton> sully: can I change that?
[20:18:14] <sully> I'm honestly not sure what you would change it to.
[20:18:21] <pcwalton> just inferring Self always
[20:18:21] *** Quits: milinda (milinda@3CE69972.ED81CFCE.51B6877.IP) (Input/output error)
[20:18:26] <pcwalton> and putting the type parameters on the trait
[20:18:27] <pcwalton> e.g.
[20:18:43] <pcwalton> let _: S<int> = Newable::<int>::new::<float>(1, 1.0);
[20:18:46] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[20:18:46] *** ChanServ sets mode: +o tjc
[20:18:51] <pcwalton> I have a WIP patch that nearly does this
[20:19:07] <sully> well, not being able to specifiy the self type ever seems like it *might* be problematic?
[20:19:11] <sully> not sure
[20:19:21] <pcwalton> I think it's the same as haskell, no?
[20:19:43] <pcwalton> it would be nicer if we had a type ascription operator instead of having to use let
[20:19:52] <pcwalton> but that's just a conciseness issue
[20:20:15] <sully> well, in haskell, would you ascribe a type for the function or something
[20:20:17] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[20:20:17] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/xPCphQ
[20:20:18] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[20:20:23] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[20:20:23] <ghrust> 01[13rust01] 15bors pushed 31 new commits to 06auto: 02http://git.io/UP4QYQ
[20:20:23] <ghrust> 13rust/06auto 146011f83 15Erick Tryzelaar: std: minor cleanup
[20:20:23] <ghrust> 13rust/06auto 1408b6cb4 15Erick Tryzelaar: std: add str.to_c_str()
[20:20:23] <ghrust> 13rust/06auto 14fd293df 15Erick Tryzelaar: std: rewrite run::with_{argv,envp,dirp} to copy C strings
[20:20:23] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[20:20:30] <sully> haskell doesn't have a way to explicitly provide type params
[20:20:33] <pcwalton> you can just ascribe a type for the result
[20:20:34] <pcwalton> yeah
[20:20:35] <sully> but it also needs it less, I feel
[20:20:39] <pcwalton> they usually make do
[20:20:42] <pcwalton> I'm not sure
[20:20:42] *** Joins: Kruppe (user@moz-4DDA8AB8.uwaterloo.ca)
[20:20:49] <pcwalton> in any case I think the ordering is confusing, we had a proposal to allow <self Foo> for this case
[20:20:53] <pcwalton> which I think is clearer
[20:21:07] <pcwalton> if we want to adopt that proposal I think that's better than just stacking the parameters
[20:21:14] *** Quits: Kruppe (user@moz-4DDA8AB8.uwaterloo.ca) (Client exited)
[20:22:09] <graydon> cmr tjc: re per-directory defaults, https://plus.google.com/u/0/111990768169655655719/posts/Se5eFQdAWk8
[20:22:54] <cmr> graydon: I'm convinced
[20:22:54] *** Quits: reyre (reyre@FCCEA34F.7672369.D8E68FF6.IP) (Client exited)
[20:22:59] *** Joins: milinda (milinda@3CE69972.ED81CFCE.51B6877.IP)
[20:23:04] <cmr> Developers are more important that uses 98% of the time anyway
[20:23:13] *** Joins: azita (Azita@moz-7E81A256.static.qsc.de)
[20:23:16] <cmr> *than users
[20:23:48] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[20:24:30] *** Quits: Blub\1 (wry@7E3BB9D.71150E1A.237AE2BA.IP) (Ping timeout)
[20:25:10] <graydon> !
[20:25:36] <graydon> I don't know about that. but I'm also not sure users have an easier time of it if we do the other way.
[20:27:21] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[20:28:15] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[20:28:15] *** Quits: eschweic1 (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[20:28:16] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[20:28:17] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[20:28:21] *** Quits: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:28:31] <nmatsakis> graydon: another comment on the new emacs mode is that it doesn't indent return values to line up with the arguments, which I think is the agreed upon Rust style conventions?
[20:28:41] <nmatsakis> (ps I love it in general)
[20:29:27] <nmatsakis> pcwalton: regarding ascribing the self type, I believe that this was the point of pnkfelix's syntax proposals
[20:29:35] <pcwalton> nmatsakis: right
[20:29:44] <pcwalton> I like those better than just squashing down the type parameters
[20:29:59] <pcwalton> nmatsakis: btw, my last few days have been spent getting Foo::<int>::bar::<float> to work and it is nearly there
[20:30:02] <graydon> nmatsakis: best thing about the new mode: easy to hack on
[20:30:02] <graydon> :)
[20:30:02] <pcwalton> besides the self type ascription
[20:30:16] *** Joins: nielsle (nielsle@moz-5CE8ECCD.boa.fiberby.dk)
[20:30:35] <nmatsakis> pcwalton: neat
[20:30:39] *** Quits: milinda (milinda@3CE69972.ED81CFCE.51B6877.IP) (Input/output error)
[20:31:00] <nmatsakis> graydon: was that a nicer way of sayings "patches welcome"? :)
[20:31:14] <graydon> it's the 21st century, we take PRs
[20:31:22] <nmatsakis> indeed.
[20:31:38] <nmatsakis> but I prefer to just moan and whine!
[20:31:42] <cmr> https://air.mozilla.org/intern-presentations-summer-2013/ toddaaro is going now
[20:31:53] <graydon> (but yeah -- the whole indent function is really straightforward, 50 lines of lisp)
[20:32:01] *** Joins: bknotic (bknotic@moz-D3D15A0C.vie.surfer.at)
[20:32:12] <nmatsakis> yes, I was looking at it. I'll take a crack at those changes :)
[20:32:57] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:33:35] *** Quits: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com) (Ping timeout)
[20:34:10] *** Joins: jgilbert (jgilbert@moz-7B0110AD.mv.mozilla.com)
[20:34:12] *** Quits: sk (sk@61A494B3.BA40E8A.AAC02D62.IP) (Quit: Leaving)
[20:34:41] <acrichto> graydon: before hand fmt/ifmt was 310k/529k, with unnamed_addr its now down to 310k/202k (yay!0
[20:35:39] <graydon> acrichto: nice! 202k is still .. a bit surprising. isn't this a test where all the fmt structs are literally identical?
[20:35:53] <acrichto> graydon: yes, although there's 1000 calls
[20:36:07] <graydon> the calls don't generate more .data
[20:36:22] <graydon> what I mean is: shouldn't, in this case, all the statics collapse down to one?
[20:36:38] <acrichto> let me verify the section size real quick
[20:37:06] <bstrie> hurrah for fmt improvements
[20:37:14] <acrichto> graydon: yeah, const_data is tiny (0xf0) because everything is exactly the same, also one ifmt! == 10k
[20:39:56] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[20:40:01] *** Joins: jdm (jdm@9FB21CB6.76DE1AD5.AE2B2F80.IP)
[20:40:27] <graydon> acrichto: where is the other 190k?
[20:40:37] <graydon> acrichto: maybe I don't understand. what's the 10k?
[20:41:12] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[20:41:13] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 145f8a26a to 14c20b906: 02http://git.io/N3iJvQ
[20:41:13] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[20:42:13] <acrichto> graydon: `fn main() {}` == 9.1k, `fn main() { ifmt!(...) }` == 9.8k, then a file with 1000 ifmt! calls == 202k
[20:42:43] *** Quits: azita (Azita@moz-7E81A256.static.qsc.de) (Quit: azita)
[20:42:57] <acrichto> I think most of it is just text for all the ifmt! calls
[20:43:10] <acrichto> also cleanup glue is probably thrown in there a lot because all the strings have to be deallocated
[20:43:46] *** kimundi is now known as zz_kimundi
[20:43:53] <graydon> acrichto: that's not 10k?
[20:44:05] <acrichto> I forgot -O :(
[20:44:07] <graydon> acrichto: when you say "310k/202k" above, what are those two measuring?
[20:44:10] <acrichto> previously
[20:44:19] <acrichto> 310k == 1000 fmt! calls, 202k == 1000 ifmt! calls
[20:44:33] <graydon> ohhhhhh, I was confused, I thought that was .text/.data
[20:44:37] <graydon> misreading
[20:44:41] <acrichto> oh sorry
[20:45:12] <acrichto> all this really did was validate that unnamed_addr + internal linkage == constant merging
[20:45:46] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[20:46:38] <graydon> yeah, great!
[20:47:17] <graydon> so ifmt! is now both smaller and faster
[20:47:23] <graydon> best kind of improvement :)
[20:47:36] <bstrie> but it's one character longer! throw it out
[20:47:41] <graydon> transitionary!
[20:47:44] <acrichto> and once more bugs are fixed, it'll even be able to format into streams
[20:47:49] <acrichto> bstrie: {} == %? :D
[20:47:51] <cmr> solution: `ft!`
[20:47:55] *** Quits: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com) (Quit: pcwalton)
[20:48:00] <acrichto> oh that :(
[20:48:47] *** Quits: maxli (maxli@13F2CEC5.7672369.D8E68FF6.IP) (Quit: Leaving.)
[20:48:54] <tiffany> are there any parser generators for rust?
[20:49:06] <cmr> there's a ragel backend
[20:49:08] <joelteon> f!(...)
[20:49:08] <cmr> but beyond that no
[20:49:12] <joelteon> or just !(...)
[20:50:34] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[20:50:34] *** ChanServ sets mode: +o brson
[20:51:02] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[20:51:40] *** Joins: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com)
[20:52:39] <engla> strcat: did you see the peekable PR from SimonSapin? It seems like a good addition
[20:53:10] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[20:53:10] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 146616a22 to 14c20b906: 02http://git.io/N3iJvQ
[20:53:10] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[20:53:11] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[20:53:11] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/hffmeg
[20:53:11] <ghrust> 13rust/06auto 14d392556 15Brian Anderson: std: Fix perf of local allocations in newsched...
[20:53:11] <ghrust> 13rust/06auto 141de201c 15bors: auto merge of #8415 : brson/rust/newrt-local-heap-perf, r=pcwalton,brson...
[20:53:12] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[20:55:14] *** Quits: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net) (Quit: msingle)
[20:56:43] <SimonSapin> engla, strcat: Iâ€™m convinced it is! :)
[20:58:45] <engla> now the name issue, maybe we can rename the existing .peek_ to .manhole
[20:59:49] <engla> or something with the same meaning
[20:59:57] <cmr> I don't see why the existing peek
[20:59:59] <cmr> is useful
[21:00:26] <engla> the existing peek is just like a filter that is always true
[21:02:34] *** Quits: victorporof (victorporo@B4B1C8EE.73B1E539.9B1E38F4.IP) (Quit: victorporof)
[21:02:50] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[21:03:10] <cmr> I know, and I don't see why it's useful
[21:07:12] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[21:07:26] *** Joins: azita (Azita@moz-7E81A256.static.qsc.de)
[21:07:38] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[21:08:32] <SimonSapin> cmr: I donâ€™t see either. But Iâ€™m biased, I only want the one I proposed :)
[21:09:03] <engla> it had a motivation when introduced, make it easy to get a manhole into the iteration pipeline
[21:09:18] <engla> but any closure in it can do that
[21:10:17] <jdm> if there's a trait Foo with a static method Bar
[21:10:32] <jdm> and an impl of Foo for type T
[21:10:47] <jdm> how can I call Bar?
[21:10:55] <cmr> Foo::Bar()
[21:11:08] <jdm> cmr: I get unconstrained type errors
[21:11:16] <jdm> /home/jdm/sdb/servo/src/components/gfx/text/shaping/harfbuzz.rs:111:27: 111:48 error: cannot determine a type for this bounded type parameter: unconstrained type
[21:11:19] <jdm> /home/jdm/sdb/servo/src/components/gfx/text/shaping/harfbuzz.rs:111             let x_offset = AuUtils::from_frac_px(x_offset);
[21:11:50] <strcat> jdm: assuming it returns a generic type, you need a type hint
[21:11:57] <jdm> strcat: it doesn't
[21:12:00] <jdm> that's the weird thing
[21:12:06] <jdm>     pub fn zero_point() -> Point2D<Au>;
[21:12:31] <cmr> Maybe Foo::Bar::<T>() ?
[21:12:36] <cmr> dunno how that works
[21:12:37] <strcat> jdm: there's nowhere to infer Self from there though
[21:12:46] <strcat> assuming that's on a trait
[21:12:51] <jdm> strcat: it is
[21:13:14] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[21:13:23] <jdm> cmr: interesting, that works
[21:13:27] <jdm> pretty gross looking
[21:13:30] <cmr> Guess it has an implicit Self parameter
[21:13:49] <strcat> all traits do
[21:13:58] <cmr> huh, didn't know that
[21:14:02] <strcat> they're implemented for specific types
[21:14:08] *** Quits: Home (chatzilla@moz-C13912C2.dynamic.isp.telekom.rs) (Quit: ChatZilla 0.9.90.1 [Firefox 25.0a2/20130808004004])
[21:14:10] <strcat> so it *always* needs a way to infer the type
[21:14:15] <cmr> jdm: once pcwalton's path changes land, that'll be Foo::<T>::Bar()
[21:14:21] <strcat> you could have
[21:14:23] <strcat> fn foo() -> int
[21:14:24] <jdm> that makes slightly more sense
[21:14:30] <strcat> returning 5 with 1 type, and 6 with another
[21:14:34] <strcat> like, if size_of was in a trait
[21:14:45] <strcat> (say, once we have Sized)
[21:14:52] *** Quits: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net) (Quit: ozten)
[21:15:00] *** Joins: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net)
[21:16:52] *** Joins: jedisct1 (Mibbit@F4489DB3.9747582C.3464FAC3.IP)
[21:16:58] <jedisct1> Hi everybody
[21:16:59] *** bent is now known as bent|errands
[21:17:17] <jedisct1> I'm a bit confused by closures and moved values.
[21:17:23] <jedisct1> https://gist.github.com/jedisct1/aa5ff43421aa7c9e3af7/raw
[21:17:51] <jedisct1> How can I keep calling cb() in this loop?
[21:18:30] <cmr> jedisct1: spawn requires a ~fn()
[21:18:40] *** Joins: Sergio965 (sergiobz@F97FD8F5.16CB087B.3A99D594.IP)
[21:18:45] <cmr> which requires moving cb into the closure environment
[21:18:57] <cmr> but you can't do that since it's a &fn, it doesn't own the environment
[21:19:29] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[21:19:42] <jedisct1> Mmmm okay...
[21:20:38] *** Joins: olsonjeffery (pf@B8927AE1.CFEFA148.239A1A9E.IP)
[21:21:23] <jedisct1> How can I copy the &fn into a ~fn?
[21:22:35] <engla> I think the proper way to do it is to take a callback function that produces a new ~fn() each time it is called, and that ~fn() can be passed into  do spawn { }
[21:23:25] <hopplaboppla> Should I think of ~ as a pointer or merely that the stuff is on the heap?
[21:23:41] <jedisct1> But how to keep the loop around the do spawn if you do that?
[21:24:05] <cmr> hopplaboppla: you should think of it as a pointer that you are responsible for freeing.
[21:24:18] *** Joins: bytewise (bytewise@moz-4A801D04.unitymediagroup.de)
[21:25:47] <engla> SimonSapin: I'm testing .peek(), and it's a bit tricky to use since .peek() freezes the iterator.  match it.peek() {   ... => it.next() }    is impossible because of this
[21:25:59] *** Quits: thomaslee (thomaslee@moz-6C3931E3.static.twtelecom.net) (Client exited)
[21:26:03] <hopplaboppla> does leaving scope frees? is there another way? The docs talk of destructors but the examples (so far) are mostly about leaving scope
[21:26:10] *** Joins: steven_is_false (user@C5B76363.1FF1EBF8.1ECA502.IP)
[21:26:27] <cmr> hopplaboppla: yes. the other way is `let _ = foo;`. Forces it to leave scope, and frees it.
[21:26:32] *** Joins: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com)
[21:26:32] <cmr> Destructors are implicitly called.
[21:26:52] <hopplaboppla> ok thx!
[21:26:55] <engla> anytime you move a value into a function call
[21:26:56] <strcat> cmr: it doesn't though
[21:27:01] <SimonSapin> engla: really? This buils fine for me: https://github.com/SimonSapin/servo-style/blob/master/selectors.rs#L112
[21:27:02] *** Quits: mschifer2 (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[21:27:03] <cmr> strcat: it doesn't?
[21:27:11] <strcat> let _ = expr doesn't call the destructor
[21:27:19] <strcat> it gets called when it goes out of scope, as usual
[21:27:22] <cmr> oh
[21:27:36] <strcat> maybe it's an implementation bug, but it's how it is atm
[21:27:48] <SimonSapin> engla: though admittedly itâ€™s not tested
[21:27:54] <hopplaboppla> so, implicit free on out of scope
[21:28:02] <engla> thanks for the example, I'll look what's different
[21:28:09] <cmr> hopplaboppla: for ~T, yes.
[21:28:15] <strcat> for all types with destructors
[21:28:15] <hopplaboppla> cool
[21:28:39] <strcat> ~T acts the same way as T
[21:29:12] <hopplaboppla> i have so mnuch to grokk in this bit of rust most other things are fairly like whatever Java, C etc but this bit givs lots of more options
[21:29:27] *** Joins: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com)
[21:29:27] *** ChanServ sets mode: +o pcwalton
[21:29:33] <cmr> hopplaboppla: it gives syntax to things that are merely convention in C
[21:29:34] <hopplaboppla> boxes i belkieve is the name?
[21:29:34] <steven_is_false> Hi guys. What packages should I download so I can cross compile c stuff to 32 bit?
[21:29:55] <jedisct1> engla, how do you "produce a new ~fn every time" when you have &fn? (or ~fn, whatever).
[21:30:17] <engla> jedisct1: the function returns it.  &fn() -> ~fn(..) -> ..
[21:31:25] *** Joins: jeff (jeff@moz-FC89C5BA.nycmny.east.verizon.net)
[21:31:51] <jedisct1> oh, I see.
[21:32:26] <jedisct1> So cb returns itself...
[21:33:40] <engla> a cb to return a cb
[21:33:47] <engla> a cb factory
[21:34:02] <jedisct1> engla: what type should cb be? Looks like endless recursion...
[21:34:22] <engla> oh no, that's just confusing syntax for fill in your own function signature
[21:34:28] <engla> &fn() -> ~fn() is fine
[21:34:29] <jedisct1> (~fn() -> (~fn() -> ~fn()) ...?
[21:34:41] <jedisct1> Oh. Ok.
[21:35:51] <nrc> question about building rust: after I run make, where should I expect to find rustc? I don't want to run make install
[21:36:12] *** Quits: eholk (eholk@moz-EA69C7A5.wavecable.com) (Quit: eholk)
[21:36:21] <cmr> nrc: ./$target-triple/stage2/bin
[21:37:03] <hopplaboppla> configure takes prefix argument?
[21:37:13] <cmr> it does
[21:37:43] <hopplaboppla> nrc: then you can install it in home or wherever you want
[21:38:07] <jedisct1> engla: I'm still confused about how to use cb in the closure
[21:38:10] <nrc> cmr: and there it is :-) thanks!
[21:38:32] *** Joins: echristo_ (echristo@moz-1892C634.hsd1.ca.comcast.net)
[21:39:22] <cmr> nrc: there's a bunch of libs it needs in .../lib
[21:39:36] <jedisct1> Something like let mut cb2 = cb() and then using cb2 = cb2() in the closure doesn't work, since it thinks that cb2 returns ()
[21:39:50] <engla> jedisct1: I don't know if it's the best way to do it
[21:40:15] <steven_is_false> Strange. When I'm trying to cross-compile I get errors in rust_task.h as RED_ZONE_SIZE is defined both for __WIN32__  __i386__, and for __linux__ __i386
[21:40:27] *** Quits: Sergio965 (sergiobz@F97FD8F5.16CB087B.3A99D594.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[21:40:30] <engla> jedisct1:  fn spawn_alot(factory: &fn() -> ~fn()) { loop {  let this_cb = factory(); do spawn { this_cb() }  } }
[21:40:33] <nrc> cmr: should I just be able to run it in place?
[21:40:44] <cmr> nrc: pretty sure yeah
[21:40:52] <steven_is_false> __linux__ should NOT be defined.
[21:40:58] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[21:41:08] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Ping timeout)
[21:41:10] <nrc> cmr: great, thanks
[21:41:10] *** Quits: echristo_ (echristo@moz-1892C634.hsd1.ca.comcast.net) (Quit: echristo_)
[21:41:14] *** Joins: echristo_ (echristo@moz-1892C634.hsd1.ca.comcast.net)
[21:41:59] <jedisct1> I see. Thanks a million for your help, engla.
[21:42:32] <engla> yw!
[21:42:40] <brson> steven_is_false: are you trying to cross compile to wine?
[21:42:53] <engla> SimonSapin: the borrow checker disagrees about my every use of .next() in this example   https://gist.github.com/anonymous/28960dc0e283018e51ec
[21:43:04] <steven_is_false> brson: Yep.
[21:43:21] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[21:43:24] <brson> neat
[21:43:52] *** Quits: brianm (brianm@moz-9B7D279E.dsl.static.sonic.net) (Quit: Leaving...)
[21:44:48] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[21:44:48] *** Quits: bknotic (bknotic@moz-D3D15A0C.vie.surfer.at) (Quit: WeeChat 0.4.0)
[21:45:21] *** Quits: azita (Azita@moz-7E81A256.static.qsc.de) (Quit: azita)
[21:46:12] <doomlord_> before i try it, could anyone comment if its easy to compile multiple crates's sources together ... eg. if i want to compile one crate that includes libstd, libsyntax, librustc .. (eg because i dont have cross-crate links in a tool working :) )
[21:46:48] *** Quits: Ralith (ralith@moz-50F3C77.vc.shawcable.net) (Ping timeout)
[21:46:48] <cmr> doomlord_: not possible
[21:46:56] <cmr> well, kinda possible, but only kinda
[21:47:11] <doomlord_> .. because all the internal links are going to be wrong ? (crate relative.. )
[21:47:13] <cmr> you'd need to finagle with the namespacess
[21:47:28] <doomlord_> (internal 'paths' rather)
[21:47:32] *** Quits: fzzzy (fzzzy@A5CBE5CF.A81CC6E.44FA8ED.IP) (Ping timeout)
[21:47:39] <cmr> ... also libsyntax and all that dependencies on libstd, and they need to be resolved at compile time and at link time from a crate.
[21:47:49] <cmr> the compilation model just doesn't support it at all atm
[21:47:59] *** Joins: fzzzy (fzzzy@A5CBE5CF.A81CC6E.44FA8ED.IP)
[21:48:10] <doomlord_> is this somethign you already tried with rustdoc :)
[21:50:05] *** Quits: mihneadb (mihneadb@E48845AB.3A9F9BD4.4C2245EF.IP) (Connection reset by peer)
[21:50:26] *** Joins: mihneadb (mihneadb@E48845AB.3A9F9BD4.4C2245EF.IP)
[21:51:11] <engla> SimonSapin: not sure if it's important
[21:51:30] <SimonSapin> engla: do you have a full example that I could build?
[21:51:31] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Connection reset by peer)
[21:51:32] *** Quits: heftig (heftig@moz-CB9CAA22.dip0.t-ipconnect.de) (Ping timeout)
[21:51:46] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[21:51:50] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[21:51:57] <engla> sure
[21:52:35] <steven_is_false> Okay, actually I think it makes sense for both __linix__ and __WIN32__ to be defined.
[21:53:00] <steven_is_false> It's rust_task.h which is wrong here, I think.
[21:53:59] <steven_is_false> What's annoying is I have two options.
[21:54:32] <steven_is_false> Compile to Windows, and run under Wine, or compile to Linux using Wine libraries.
[21:54:47] <steven_is_false> I'm not sure which approach is better.
[21:55:05] <engla> SimonSapin: https://github.com/blake2-ppc/rust/tree/peekable
[21:57:23] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[21:59:29] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[22:00:29] *** Joins: heftig (heftig@moz-4E9B137.dip0.t-ipconnect.de)
[22:00:52] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[22:01:51] *** nrc is now known as nrc|afk
[22:02:10] *** Quits: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP) (Quit: Leaving.)
[22:02:26] <sully> .... *weird*
[22:02:32] <sully> trying to make check my changes
[22:02:53] <sully> and a build failed linking with `cc`
[22:03:00] <sully> *then* had an invalid free
[22:03:22] <ozten> If I want to deal with a Set, is HashSet the way to go? I've got a vec of items, but don't care about duplicates
[22:03:30] *** Joins: brianm (brianm@moz-7A18C72.hsd1.ca.comcast.net)
[22:03:34] *** Joins: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com)
[22:03:38] <SimonSapin> engla: I donâ€™t really see the difference between my code and yours regarding peek() :(
[22:03:54] <strcat> ozten: really depends on what you are going to do with it
[22:04:04] <ozten> ~[~str]
[22:04:11] *** Joins: eschweic1 (Adium@moz-BBE3ABD.mv.mozilla.com)
[22:04:12] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[22:04:13] <strcat> yeah, and it depends what you are going to use it for
[22:04:14] <ozten> I want to find union and disjoint sets
[22:04:51] <strcat> a vector, HashSet or TreeSet will all work fine depending on exactly how you're going to use it
[22:04:52] <engla> SimonSapin: your code doesn't have living borrowed references where.next() is called
[22:04:58] <engla> SimonSapin: it's solvable
[22:05:03] <strcat> if you build them all in advance, you can sort them vectors
[22:05:16] <ozten> strcat: I'll read up on them, thanks
[22:05:21] <strcat> and union/disjoint will be O(n) (as they are for TreeSet - just a walk over the elements in-order)
[22:05:36] <sully> hm, so
[22:05:42] <sully> we seem to supress cc output
[22:05:49] <sully> is there a way to get the output from it as to why it failed?
[22:05:58] <SimonSapin> engla: doesnâ€™t it? But yours does?
[22:06:10] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Textual IRC Client: www.textualapp.com)
[22:06:15] <tjc> graydon: ping
[22:06:23] <graydon> tjc: pong
[22:06:44] <engla> SimonSapin: mine does. Well, the _ in match arms shouldn't count but it does, too
[22:07:22] <tjc> graydon: silly question, butâ€¦ right now does workcache actually write the database to disk?
[22:07:45] <graydon> tjc: it doesn't yet
[22:08:03] <engla> SimonSapin: peekable could easily define another method to peek by value (A: Clone)
[22:08:34] <strcat> engla: it doesn't seem useful to me if it does that
[22:08:48] <strcat> why not just call next() and store the result?
[22:08:50] *** Joins: eholk (eholk@moz-EA69C7A5.wavecable.com)
[22:09:03] <SimonSapin> engla: peek() requires Clone, and .peek_ref() is the existing code?
[22:09:05] <graydon> tjc: it should be reasonably easy to add that. see for example the dump/load routine in extra::test::MetricMap::{save,load}
[22:09:25] <tjc> graydon: Ok, thanks
[22:09:37] <engla> strcat: then I'd keep the Focus adaptor in treemap, which is almost identical to Peekable :)
[22:09:47] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[22:09:51] <strcat> engla: it clones?
[22:10:18] <SimonSapin> strcat: current PR doesnâ€™t
[22:10:31] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[22:10:39] <engla> strcat: treemap code just accesses the member, and the member is copyable (it's a &T)
[22:11:09] <engla> strcat: Focus just refactors the save-result-of-next into one place.. just like Peekable also does :)
[22:12:08] <engla> strcat: relax. the clone I'm suggesting for using peekable in treemap would clone the iterator element -- a &T
[22:12:12] <Seldaek> is it possible to do GUI stuff yet on windows?
[22:12:35] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[22:13:15] *** Quits: graydon (graydon@moz-F14EE0DB.cable.teksavvy.com) (Ping timeout)
[22:13:22] *** Quits: olsonjeffery (pf@B8927AE1.CFEFA148.239A1A9E.IP) (Ping timeout)
[22:14:11] *** bent|errands is now known as bent
[22:14:16] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[22:15:02] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[22:17:11] *** Quits: eholk (eholk@moz-EA69C7A5.wavecable.com) (Ping timeout)
[22:17:51] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[22:17:57] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[22:18:55] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[22:19:43] *** Quits: echristo (echristo@DCF57675.D6CCE4AE.77834EAA.IP) (Quit: echristo)
[22:19:43] *** echristo_ is now known as echristo
[22:19:59] *** Quits: huseby (huseby@moz-4E8C421A.husebyhome.com) (Quit: Leaving)
[22:21:01] *** Quits: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net) (Input/output error)
[22:21:54] *** Quits: tchoma (tchoma@moz-BBE3ABD.mv.mozilla.com) (Quit: tchoma)
[22:22:47] *** Quits: eschweic1 (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[22:22:48] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[22:24:52] *** Joins: dherman (dherman@moz-FEEC7E9.hsd1.ut.comcast.net)
[22:24:52] *** ChanServ sets mode: +o dherman
[22:25:24] *** zz_kimundi is now known as kimundi
[22:25:51] <engla> SimonSapin: peek by value is fine. no idea about method names. But I know PeekableIterator must drop the Iterator suffix to fit in
[22:26:34] <steven_is_false> cfg: target triples x86_64-unknown-linux-gnu i686-wine-mingw32, this doesn't seem right to me. Shouldn't the config override the previous target, and not be appended to it?
[22:26:50] <engla> (by fine, it compiles and passes the tests)
[22:27:12] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[22:27:45] <Luqman> steven_is_false: no, it'll build a rustc that can target both x86_64-unknown-linux-gnu & i686-wine-mingw32
[22:28:06] <steven_is_false> Luqman: Oh okay then.
[22:28:50] *** Joins: lkuper (lkuper@63686BC7.F689A8C9.EB438161.IP)
[22:28:52] *** Parts: steven_is_false (user@C5B76363.1FF1EBF8.1ECA502.IP) (ERC Version 5.3 (IRC client for Emacs))
[22:30:06] <SimonSapin> engla: .peek_clone()?
[22:30:50] <engla> no, that would clone the Option<&'a T> and just be identical
[22:31:15] <engla> it's   f<A: Clone>(x: Option<&A>) -> Option<A>
[22:31:17] <sully> argh, apparently rustc needs a bunch of env variables declared to be built
[22:31:51] <sully> that the makefiles quietly declare
[22:31:51] <engla> SimonSapin: oops, I read  .peek().clone() as the question for some reason. I'm sorry
[22:32:02] <sully> this makes running a rustc build in a debugger annoying
[22:32:56] <SimonSapin> engla: naming: .peek() returns a &, .peek_clone() copies, and exists only in the values implement Clone
[22:33:01] <tjc> Has anyone else had building rustdoc segfault for them, on a Mac using the latest master?
[22:33:15] *** Quits: peterdn (chatzilla@moz-97742234.new.ox.ac.uk) (Ping timeout)
[22:33:54] <SimonSapin> engla: does that sound good to you?
[22:34:36] <dim-an> Hi I updated repository of rust from upstream (mozilla/rust/master) and can't build it anymore.
[22:34:48] <dim-an> `make` fails with segmentation fault
[22:34:50] <engla> SimonSapin: yes I think so. Don't know a good role model for the naming of .peek_clone
[22:35:15] *** Joins: olsonjeffery (pf@B8927AE1.CFEFA148.239A1A9E.IP)
[22:35:25] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[22:35:50] <tjc> dim-an: are you on a Mac?
[22:36:03] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[22:36:16] <dim-an> tjc: oh, sorry, Linux 64 bit
[22:36:23] <dim-an> tjc: Ubuntu 12.10
[22:36:28] <tjc> dim-an: Hmm. Can you paste the compiler output from just before where it segfaults?
[22:36:41] <dim-an> tjc: sure
[22:37:30] <dim-an> tjc: http://pastebin.com/2AGhF4HA
[22:38:19] <tjc> dim-an: Hmmâ€¦ not the same problem I'm seeing on my machine. Too bad! 
[22:38:50] <dim-an> tjc: I saw different one
[22:38:58] <dim-an> tjc: different errors
[22:39:04] <tjc> dim-an: if you're willing to do one more thing, can you: VERBOSE=1 make check; then paste the last command-line before the failure, and do gdb --args followed by the command line?
[22:39:09] <tjc> and then do a backtrace in gdb?
[22:39:19] <dim-an> tjc: something about double free
[22:39:32] <dim-an> tjc: sure will do
[22:40:26] <tjc> brb
[22:40:52] <dim-an> tjc: will take some time though
[22:41:26] *** Joins: stepancheg (Mibbit@moz-58AD93C5.yandex.net)
[22:41:34] *** Joins: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net)
[22:41:51] <tjc> dim-an: no rush
[22:42:05] <tjc> dim-an: my answer will probably be "file a bug" in any case, but I'd be curious to see the backtrace
[22:42:13] <bstrie> acrichto: ping
[22:42:20] <acrichto> bstrie: pong
[22:42:26] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[22:42:26] *** ChanServ sets mode: +o brson
[22:42:29] <dim-an> tjc: I ran git bisect at some point
[22:42:49] <bstrie> acrichto: so ifmt is faster with the address_insignificant thing... but do you know the reason why ifmt is bigger than fmt without that?
[22:43:14] <stepancheg> Hi all. I'm trying to implement issue: https://github.com/mozilla/rust/issues/8406#issuecomment-22427308 . I did first part and I need help with second part: how to prohibit moving the value?
[22:43:29] <sully> ok, I am now officially confused
[22:43:41] <SimonSapin> engla: updated https://github.com/mozilla/rust/pull/8396
[22:43:42] <dim-an> tjc: it blamed 85aaa44bec2a87f8df290d4f9b3f7350de50d067 commit
[22:43:52] <acrichto> bstrie: yes, ifmt! creates *a lot* of local `static`s which describe a "pre-compiled" format string. This is also for speed in that the format string doesn't have to be re-parsed at runtime. Because of all this `static` generation, a lot of stuff got shoved into a .const_data section but it was all duplicated (at least in that test case)
[22:43:59] *** Quits: dherman (dherman@moz-FEEC7E9.hsd1.ut.comcast.net) (Quit: dherman)
[22:44:05] <tjc> dim-an: I'll see which one that is
[22:44:17] <dim-an> tjc: turn on new runtime
[22:44:26] <tjc> dim-an: yup, that's what I was afraid of
[22:44:28] <tjc> brson: ^
[22:44:33] <brson> stack overflow is most likely
[22:44:41] <tjc> aha
[22:44:46] <tjc> then would increasing the stack size help?
[22:44:59] <engla> SimonSapin: nice. don't you think the nesting of match is too much? can just be if self.peeked.is_none() { self.peeked = .. } match { }
[22:45:00] <brson> maybe. unfortunately rustc overrides the stack size explicitly
[22:45:07] <acrichto> bstrie: also I don't think it was any faster with address_insignificant, but rather just a smaller executable
[22:45:09] <brson> and it's probably rustc that's crashing?
[22:45:24] <brson> I'll add a RUSTC_STACK_SIZE env var to help diagnose this problem
[22:46:24] <brson> dim-an: you can try using valgrind or gdb to figure out whether it's a stack overflow. rustc uses 4MB stacks, so if the difference between esp from the bottom to the top of the stack is in that range that's probably what's going on
[22:46:39] <brson> or can change STACK_SIZE in librustc/rustc.rs to something much bigger to see if the problem goes away
[22:46:40] <SimonSapin> engla: yeah, I had that at first but it does one more match when peeked.is_some()
[22:47:07] <dim-an> brson: I think I'll get gdb trace in 5-10 minutes
[22:47:37] <tjc> In general, what do you do when you want to call a &mut self method from a destructor?
[22:47:43] <tjc> unsafe code, or is there something nicer?
[22:47:51] <brson> maybe i'll just make rustc obey RUST_MIN_STACK
[22:47:53] *** Quits: true_droid (true_droid@moz-123FD9B8.beck.volia.net) (Client exited)
[22:49:18] *** Quits: lkuper (lkuper@63686BC7.F689A8C9.EB438161.IP) (Quit: lkuper)
[22:50:03] <dim-an> brson: heh new crash this time ^_^
[22:50:16] <engla> SimonSapin: ok
[22:50:38] <SimonSapin> itâ€™s minor
[22:50:41] *** Joins: lkuper (lkuper@63686BC7.F689A8C9.EB438161.IP)
[22:50:53] <brson> dim-an: what did you do differently?
[22:51:00] <dim-an> brson: https://gist.github.com/dim-an/6197958
[22:51:15] <engla> SimonSapin: it's not pretty :)
[22:51:25] <dim-an> brson: nothing, but it looks like I already saw similar crash when bisected
[22:51:27] *** Quits: Nisstyre (wes@moz-FD86289.netflash.net) (Quit: Leaving)
[22:51:30] *** Joins: Jesin (Jessin_@moz-3AD6F09F.res.lehigh.edu)
[22:52:38] <SimonSapin> engla: I mean Iâ€™m not too attached to it. If not pretty is judged more important than this untested micro-optimization, I can change it back.
[22:52:59] <brson> dim-an: that's alarming
[22:53:08] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[22:53:22] <dim-an> brson: ?
[22:53:31] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[22:53:37] *** kimundi is now known as zz_kimundi
[22:53:55] <brson> the double-free
[22:54:05] <engla> SimonSapin: I can't judge what's better for performance anyway
[22:54:37] <brson> dim-an: actually, I guess this *could* still be the result of a stack overflow. that's still the first thing i'd try to rule out
[22:54:58] <dim-an> brson: ok I run `make` one more time
[22:55:04] <strcat> brson: shouldn't __morestack still be protecting us from stack overflow?
[22:55:09] <brson> yeah, it probably is. free is detecting a corruption when freeing a stack segment
[22:55:11] <strcat> or does it not actually set a size
[22:55:17] <Seldaek> is there a way I can paint stuff to a window? even just showing text would do for now. how is servo handling this (ping pcwalton)?
[22:55:40] <brson> strcat: we're not setting the stack pointer at all right now. it would be relatively easy to add that and turn __morestack into an abort
[22:56:02] <dim-an> brson: I'm trying to run a command which make itself runs, and get "error: Environment variable CFG_VERSION not defined"
[22:56:08] <cmr> Seldaek: SDL?
[22:56:20] <cmr> Seldaek: servo has its own compositor aiui
[22:56:21] <pcwalton> Seldaek: SDL is the easiest way, or GLFW if you want OpenGL
[22:56:25] <pcwalton> servo uses GLFW
[22:56:41] *** Joins: graydon (graydon@moz-F14EE0DB.cable.teksavvy.com)
[22:56:41] *** ChanServ sets mode: +qo graydon graydon
[22:56:44] <brson> dim-an: you are trying to build rustc and rustc uses env! to pull it's version number out of the CFG_VERSION environment variable
[22:56:49] <sully> ok, *weeeeeeeird*
[22:56:55] <brson> which the Makefiles export
[22:56:57] <sully> something is screwed up with one of my build directories
[22:57:03] <sully> that causes stage2 rustc to fail in it
[22:57:05] <dim-an> brson: ok, can you tell me what should I put there 
[22:57:11] <sully> that isn't repaired by make clean
[22:57:23] <brson> dim-an: CFG_VERSION=0 should be fine. rustc doesn't care
[22:57:28] <dim-an> brson: ok
[22:57:33] <dim-an> brson: thanks
[22:57:33] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[22:57:41] <brson> or "0.8-pre" if you want it to be correct
[22:58:08] *** Joins: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP)
[22:58:08] <brson> dim-an: so the crash is whin compiling rustc?
[22:58:29] <Seldaek> cmr, pcwalton: k thanks, no opengl no, I'd be happy with text & perhaps html 2d canvas style would be awesome enough.
[22:58:41] <Seldaek> do you know if there is an example of something using sdl anywhere?
[22:58:43] <cmr> Seldaek: sdl does 2d quite fine
[22:58:43] <dim-an> brson: looks like this
[22:58:59] <pcwalton> the easiest way to do that is SDL + rust-azure but rust-azure is pretty underdocumented
[22:59:11] <graydon> I'm always a little surprised about git's branching and committing commands
[22:59:16] <graydon> maybe I am using it wrong
[22:59:18] *** Joins: huseby (huseby@moz-4E8C421A.husebyhome.com)
[22:59:35] *** Quits: Azdle_ (Azdle@moz-B334B496.hfc.comcastbusiness.net) (Quit: Leaving)
[22:59:40] <graydon> the one thing I always want to do, and always wind up doing in an awkward order, is "commit these changes I am working on right now as a new branch rather than an extension of the current one"
[22:59:53] <cmr> git checkout -b new_branch; git commit ...
[22:59:58] <graydon> checkout clobbers the changes
[23:00:03] <engla> nope
[23:00:17] <cmr> certainly not checkout -b
[23:00:20] <cmr> I do it all the time
[23:01:02] <graydon> "This form switches branches by updating the index, working tree, and HEAD to reflect the specified branch or commit."
[23:01:03] *** Quits: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP) (Connection reset by peer)
[23:01:04] <Seldaek> graydon: in rare cases with checkout -b you might have to stash your changes first, but that's only if you do a "checkout -b new_branch origin/master" from another feature branch 
[23:01:11] <engla> git checkout can do many different things http://stevelosh.com/blog/2013/04/git-koans/#one-thing-well
[23:01:16] *** Quits: dew (Instantbir@moz-8A63B53.dhcp.stls.mo.charter.com) (Ping timeout)
[23:01:59] <Seldaek> pcwalton: eh ok, this might be a bit much for me to tackle right now :/ 
[23:02:19] *** Quits: saml (sam@moz-14C16814.cst.lightpath.net) (Quit: Leaving)
[23:02:41] <graydon> that ..
[23:02:51] <graydon> I don't get it. that is _exactly not_ what the docs say the command will do
[23:03:01] <cmr> read them more
[23:03:17] <cmr> "Specifying -b causes a new branch to be created as if git-branch(1) were called and then checked out."
[23:03:29] <graydon> yes
[23:03:41] <Seldaek> graydon: checkout with -b essentially just branches out from the current state, so the updating the index/working tree part is a noop
[23:04:01] <graydon> so when I do 'git branch somestuff' on its own it creates a new branch called somestuff pointing at HEAD
[23:04:05] <graydon> which is the uncommitted state
[23:04:12] *** Joins: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP)
[23:04:14] <graydon> so if "checkout -b" is the same as calling "branch" then "checkout"
[23:04:20] <engla> You need to open your mind, remove all the svn, hg, and other system knowledge, put git in there, and close the mind again :) you are at peace
[23:04:23] <graydon> it should arrive at a new checkout of a new branch pointing to HEAD
[23:04:30] <cmr> HEAD never points to uncommited state, it can only point to a branch
[23:04:33] <cmr> erm, to a commit
[23:04:38] <graydon> engla: please. I wrote the thing git is a copy of.
[23:04:42] <graydon> cmr: yes. that's my point
[23:04:44] <graydon> HEAD points to master
[23:04:51] <graydon> I have some uncommitted stuff that's ahead of master
[23:04:59] <graydon> when I say "git branch foo" it makes foo = HEAD = master
[23:05:04] <graydon> _not including_ my uncommitted stuff
[23:05:08] <engla> graydon: you did? is that monotone?
[23:05:11] <graydon> yes
[23:05:21] <cmr> right, and then you commit
[23:05:23] <graydon> if "checkout -b foo" does "branch foo && checkout foo"
[23:05:31] <graydon> then it should be the same as checkout master
[23:05:34] <graydon> which will throw away my changes
[23:05:34] <Seldaek> graydon: no but if you checkout foo and you're on master and foo == master == HEAD then your uncommited stuff is carried along unchanged
[23:05:43] <graydon> checkout clobbers changes
[23:05:50] <cmr> not checkout -b
[23:05:55] <graydon> I use it all the time to revert to a tree-state
[23:06:05] *** Joins: Nisstyre (wes@moz-FD86289.netflash.net)
[23:06:07] <strcat> graydon: yeah, checkout does 1000 things
[23:06:16] <dim-an> brson: https://gist.github.com/dim-an/6198050
[23:06:16] <graydon> "This form switches branches by updating the index, working tree, and HEAD to reflect the specified branch or commit."
[23:06:18] <graydon> I mean ..
[23:06:20] <dim-an> brson: gdb backtrace
[23:06:26] <graydon> (that's the form including -b)
[23:06:44] <Seldaek> graydon: it only trashes files if you checkout a file path like "git checkout .", if you checkout a branch the uncommitted stuff is kept
[23:06:49] <strcat> graydon: it updates it, but doesn't clobber it
[23:06:54] <Seldaek> and if it can't keep it because of a conflict, it aborts
[23:07:04] <graydon> Seldaek: why does it say it updates the working tree?
[23:07:11] <strcat> graydon: it does, but it won't clobber
[23:07:31] <Seldaek> graydon: well, foo == master == HEAD so updating the working tree from master to foo means there's nothing to do
[23:07:34] <cmr> graydon: if you don't give it a start_point it won't update anything afaik
[23:07:37] <engla> git checkout will try to keep your uncommitted changes if you move to a different branch too. If it can't merge, it refuses
[23:07:39] <strcat> graydon: checkout *also* lets you check out a path, and clobber your working copy
[23:07:41] <cmr> in the wokring tree that mis
[23:07:44] <strcat> but that's a separate action
[23:07:59] <graydon> Seldaek: ok. that's the missing fact. I have never seen it do that (merging workspace rather than clobbering it)
[23:08:02] <graydon> I always use it to clobber
[23:08:04] <strcat> git follows the principle of most astonishment so it reuses the same names for totally unrelated commands :]
[23:08:11] <cmr> graydon: what version of git are you using?
[23:08:22] <Seldaek> strcat: haha
[23:08:30] <graydon> no no that's fine, I just literally had no idea it workspace-merged during a branch-based checkout rather than workspace-clobbering
[23:08:50] *** Joins: choi (choi@8B3AF678.4DBF37E.6FE028F4.IP)
[23:08:51] <graydon> since it workspace-clobbers when you checkout a path
[23:08:57] <graydon> and _does_ rewrite the workspace on branch-based
[23:09:00] <dim-an> brson: didn't like this instruction:   	mov    %rdx,-0x1280(%rbp)
[23:09:03] <cmr> right
[23:09:04] <graydon> just rewrites  by merging. very weird.
[23:09:05] <graydon> ok
[23:09:08] <cmr> it is weird
[23:09:12] <cmr> don't think about it to hard :p
[23:09:32] <graydon> that's fine. goes in the bucket of git quirks. I was trying to reconcile what it says its doing with my (I think relatively accurate) mental model of what it's doing.
[23:09:42] <Seldaek> the CLI is kinda messed up, but as long as you know what to run when it works pretty ewll
[23:09:55] <brson> dim-an: how deep is the call stack? how many frames?
[23:10:02] <graydon> no, the right way to use git is to think about it very very hard, and know exactly what it's doing. and then memorize commands that are unrelated to what they would at first appear to say they're doing.
[23:10:08] <graydon> but usually the docs clarify with precision.
[23:10:22] <brson> dim-an: and can you tell the difference between the frame pointer in the first frame and the last frame using `info frame` or something?
[23:10:23] <dim-an> brson: 1428
[23:10:28] <graydon> I see the docs for this command are slightly unclear on whether they'll clobber or merge when "updating" the workspace
[23:10:31] <graydon> I assumed clobber
[23:10:36] <graydon> as they do for files
[23:10:37] <graydon> s'ok
[23:10:39] <strcat> graydon: your mistake is reading the man pages
[23:10:40] <graydon> thanks for the lesson!
[23:10:45] * brendanc bites his tongue
[23:10:48] <Seldaek> graydon: I think the issue here is that checkout has so many outcomes and logical branches that it's hard to document in a sane way
[23:10:52] <graydon> strcat: I'd be totally lost without the manpages
[23:11:14] <graydon> brendanc: hey man, we've both got a layer of scar tissue from all the tongue biting on this topic :)
[23:11:18] <brendanc> hehe
[23:11:22] <strcat> graydon: http://git-scm.com/documentation ;p
[23:11:30] *** Joins: dherman (dherman@moz-FEEC7E9.hsd1.ut.comcast.net)
[23:11:30] *** ChanServ sets mode: +o dherman
[23:11:55] <graydon> strcat: *sigh* seriously, when you look up the docs for content addressed VCS, the diagrams that back it all, that's stuff I drew. I am not like really easily confused by this copic.
[23:11:56] <graydon> topic
[23:12:20] <strcat> yeah but the commands are very poorly designed from a UX POV
[23:12:23] <strcat> they do too much
[23:12:35] <strcat> so the man pages are pretty confusing, because you're never going to need 90% of the stuff in them
[23:12:46] <graydon> this is a very minor CLI-quirk. it just bugged me since it seemed like, indeed, "branch -b foo" behavior is more or less what you'd want to do all the time, and every time I read the docs to check if there was a variant that did that, they appeared to be saying "no, this command doesn't do that"
[23:12:51] <dim-an> brson: https://gist.github.com/dim-an/6198080
[23:12:57] *** Quits: adrema (adrema@1453496A.70C7F49.B68672D5.IP) (Quit: ChatZilla 0.9.90.1 [Firefox 22.0/20130618035212])
[23:13:07] <dim-an> brson: if I calculated correctly it's 3'998'256 bytes
[23:13:27] <dim-an> brson: between rbp on 0 frame and 1427 frame
[23:13:35] *** Joins: dew (Instantbir@moz-8A63B53.dhcp.stls.mo.charter.com)
[23:13:56] <brson> dim-an: it's a stack overflow. can you increase the STACK_SIZE value in librustc/rustc.rs to something that works for you and submit a pull request?
[23:13:58] <brendanc> pretty sure git's ui is designed to maximize the pleasure you can get from saying "no you idiot, this is what you should have typed"
[23:14:10] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[23:14:10] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/hffmeg
[23:14:10] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[23:14:25] <Seldaek> pcwalton, cmr: so I'm checking a basic text writing sdl example, and I want to gauge my eye balls out. It does reinforce my love for rust though :p
[23:14:29] <brson> 4MB of stack is apparently not enough for rustc to build itself
[23:14:36] <strcat> yeah and then I always try to figure out how to make git reset do what I want, when I really need git checkout-index
[23:14:50] <graydon> brendanc: I don't think it is designed much at all. I think it just accreted. which is understandable, if not entirely forgivable. they were in a hurry and it got wired into too many workflows too fast to change.
[23:15:17] * cmr looks for a CLI tool that interacts with a git repository and isn't git
[23:15:18] <brendanc> it is the curse of esr
[23:15:28] <graydon> haha
[23:15:28] <brendanc> cmr: hg-git ?
[23:15:40] *** Joins: Ralith (ralith@moz-AB653EB1.wireless.sfu.ca)
[23:15:45] <cmr> brendanc: does that operate directly on a git repo without an intermediate hg repo?
[23:15:48] * cmr hasn't used it much
[23:15:49] <graydon> maybe the curse of tom lord
[23:15:51] <brendanc> no
[23:15:52] <Seldaek> cmr: the issue is once you know git enough to build that, you don't see the problems anymore :p
[23:15:52] <brendanc> hehe
[23:16:21] <smvv> cmr: there's dulwich as well (pure python implementation of git)
[23:16:24] <doomlord> its not just me, gits' command line takes more getting used to than other dvcs?
[23:16:30] <dim-an> brson: will do
[23:16:43] <cmr> Seldaek: I think the problem is that once you know enough git, you just stop being as motivated, because it doesn't bother you anymore :p
[23:16:53] <brson> dim-an: thanks. sorry for the inconvenience
[23:16:53] <brendanc> there is a guy working on a no-hg-repo version of hg-git called hgit, but I don't think it's mature yet
[23:17:11] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[23:17:11] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/iGYZNQ
[23:17:11] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[23:17:13] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[23:17:13] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/pibn-w
[23:17:13] <ghrust> 13rust/06auto 147c1eb83 15Tim Chevalier: rustpkg: Eliminate a copy
[23:17:13] <ghrust> 13rust/06auto 14e751c90 15Tim Chevalier: Makefiles: make rustpkgtest depend on rustpkg executable
[23:17:13] <ghrust> 13rust/06auto 1496fd606 15Tim Chevalier: std/rustc/rustpkg/syntax: Support the `extern mod = ...` form...
[23:17:15] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[23:17:40] <graydon> doomlord: it's been the object of extreme derision since the day it was launched. it was just made in a hurry and beat its competitors on a few reasonably important axes (speed, simplicity and local namespaces)
[23:17:44] <cmr> Most of the tools I've tried to "make git's ui better" force a particular workflow on you, which isn't what's useful for me.
[23:17:48] <Seldaek> cmr: I think it plays on stockholm syndrome a bit as well
[23:18:25] <brendanc> https://bitbucket.org/durin42/hgit
[23:18:54] <brendanc> (but I recognize that hg is probably the plan9 of version control)
[23:19:15] <graydon> there's someone working on a js implementation too. git network effects and natural engineering advantages seem to have completely won the problem space
[23:19:17] <doomlord> typically i always hated VCS, they were things imposed on me in the workplace.. when i heard about DVCS i liked the idea a lot... the first one i tried was BZR, and it was the first VCS i actually enjoyed , ever.
[23:19:42] <graydon> it's ok. it was getting to be a tedious fight near the end and there were like 19 competitors
[23:19:42] <doomlord> ^linux torvalds comments on non-dvcs made me feel alot better about hating all non dvcs
[23:19:47] <cmr> doomlord: yeah, using tfs/svn/cvs is wretched
[23:19:49] <Ralith> most first things stay first thing forever
[23:19:53] <Ralith> that's kind of what 'first' means
[23:19:54] <Seldaek> would anyone have a newish windows build of 0.8-dev? is it possible to access those of the build bots?
[23:19:57] <Ralith> at least with regard to time
[23:20:00] <graydon> Ralith: it wasn't anywhere near first :)
[23:20:09] *** Quits: vosen (vosen@moz-266BA656.icpnet.pl) (Quit: Leaving)
[23:20:10] <Ralith> graydon: I was replying to doomlord 
[23:20:14] <doomlord> then i tried Git, it being the famous one.. i found the commands confusing
[23:20:21] <graydon> Ralith: 2nd and 3rd movers often have major advantages
[23:20:24] <graydon> ah k
[23:20:33] <doomlord> .. but forced myself to persevere for the suprerior branching 
[23:20:55] <cmr> So uh
[23:21:06] <cmr> Why does the test runner use colors when RUST_THREADS=1, but no other time?
[23:21:13] <mcpherrin> There's a bunch of problem spaces that still love perforce way more than git, so it hasn't completely won the VCS war.
[23:21:14] <cmr> Is it beause of interleaving?
[23:21:14] * brendanc wonders how often graydon hears people say git was the first dvcs
[23:21:27] <Ralith> graydon: I do wonder how much of git's victory is thanks to github, though
[23:21:39] <Ralith> I know it's what motivated me
[23:21:39] <cmr> Ralith: github is basically the only reason I started using git
[23:21:49] <cmr> I used and enjoyed fossil before it
[23:21:58] <mcpherrin> Github got me to move from mercurial.
[23:22:05] <Seldaek> it definitely helped crush the competition
[23:22:45] *** Quits: choi (choi@8B3AF678.4DBF37E.6FE028F4.IP) (Ping timeout)
[23:22:45] <graydon> brendanc: *shrug* dunno, it's all trivia. mtn wasn't first either by quite a ways, and beyond the interests of archivists / technical historians, or people stuck using them, also-rans don't really matter.
[23:23:06] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[23:23:55] <mcpherrin> Are there Skia bindings for rust anywhere?
[23:23:56] <brendanc> yeah. I don't feel so strongly about it any more, just a bit sad that something with an interface only a perl programmer could love won out
[23:24:03] <mcpherrin> The closest I've found is azure in servo.
[23:24:05] <graydon> I was always fond of aegis, for example..
[23:24:21] <Seldaek> graydon: I think they do, as long as something was used by people, they remember. I had sort of positive downfalls years later from old moderately successful OSS stuff that long since got made irrelevant
[23:24:29] <jedisct1> task <unnamed> failed at 'Unhandled condition: io_error: {kind: BrokenPipe, desc: "broken pipe", detail: None}', /private/tmp/rust-696l/src/libstd/condition.rs:43
[23:24:38] <graydon> brendanc: I'm glad the problem space was solved somehow. the need was painful and painfully obvious 
[23:24:43] <jedisct1> Is there a way to get a backtrace to figure out where the signal was (not) catched?
[23:24:44] <brendanc> yes
[23:25:11] <brson> jedisct1: are you sure that's a problem? there are test cases that intentionally create that error
[23:25:22] <brendanc> and at this point I've got finger memory for enough git that it doesn't enrage me :)
[23:25:27] <graydon> yeah, likewise
[23:25:44] <brson> jedisct1: breaking on rust_begin_unwind may help though
[23:26:02] <jedisct1> I'm just reading data from a TcpStream, and this happens randomly when using siege
[23:26:17] <jedisct1> ok
[23:26:58] *** Quits: Palmik (palmik@moz-CC484FDD.tmcz.cz) (Quit: Lost terminal)
[23:27:54] <graydon> oh gosh
[23:28:24] <graydon> I went to check on the state of aegis. Peter Miller has leukaemia :((
[23:28:52] <brson> jedisct1: depending on what spawn and message passing patterns you are using it could be a problem with the scheduler starving the i/o loop. i'll be happy to look at a test case if you have one
[23:29:36] <brendanc> ugh
[23:30:40] <jedisct1> brson: http://www.justbeamit.com/bk2cn
[23:30:58] <jedisct1> Just run siege -b -t 30s http://localhost:8000
[23:31:22] <jedisct1> It serves a few thousands queries, then always gets the SIGPIPE
[23:31:49] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: zzzzzzzzzz)
[23:32:47] <jedisct1> That's on OSX. Didn't try on another platform yet.
[23:33:34] <brson> jedisct1: and you are using RUST_THREADS=1
[23:33:44] <brson> cmr: yes, interleaving control codes
[23:33:57] <cmr> brson: Shouldn't it just use a single writer task?
[23:34:06] <cmr> Or, rather couldn't
[23:34:11] <cmr> I'm sure it's just a matter of NYI
[23:34:13] <jedisct1> Same thing with and without RUST_THREADS=1
[23:35:49] <brson> cmr: tests themselves spew junk to stdout/sterr
[23:35:51] <sully> sigh, another match fix where the hardest part is documenting it
[23:36:01] <jedisct1> Run siege, then hit ctrl-c to quickly abort all the connections -> sigpipe
[23:37:41] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Ping timeout)
[23:40:46] <dim-an> brson: https://github.com/mozilla/rust/pull/8425
[23:41:32] <brson> dim-an: thanks!
[23:42:36] *** Joins: choi (choi@4538D0B9.5A884B1C.6FE028F4.IP)
[23:43:09] <brson> jedisct1: testing here
[23:43:10] <dim-an> brson: you are wellcome 
[23:43:16] *** Parts: dim-an (ermolovd@moz-74FA7782.yandex.net) ()
[23:44:11] <brson> jedisct1: seems to work successfully on linux. yay!
[23:44:15] <brson> not that that helps you
[23:44:29] <jedisct1> :)
[23:44:41] <brson> i'll try a mac. it will take a while to build
[23:45:11] *** Quits: stepancheg (Mibbit@moz-58AD93C5.yandex.net) (Quit: http://www.mibbit.com ajax IRC Client)
[23:47:06] *** Quits: mark_edward (quassel@moz-57A72B6E.hsd1.in.comcast.net) (Client exited)
[23:47:09] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[23:47:22] *** Quits: Florob (Florob@moz-39532932.de) (Client exited)
[23:47:25] *** Quits: jdm (jdm@9FB21CB6.76DE1AD5.AE2B2F80.IP) (Quit: Lost terminal)
[23:48:57] <brson> jedisct1: 2399.73 trans/sec. do you know how good or bad that is?
[23:49:11] <brson> i wonder if -O changes anything
[23:49:25] <jedisct1> It's ok. I get around 1200/s (with -O) on my laptop
[23:49:45] *** Quits: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com) (Ping timeout)
[23:50:14] *** Joins: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com)
[23:50:14] *** ChanServ sets mode: +o pcwalton
[23:50:20] *** Joins: steven_is_false (user@C5B76363.1FF1EBF8.1ECA502.IP)
[23:50:35] *** Quits: steven_is_false (user@C5B76363.1FF1EBF8.1ECA502.IP) (Client exited)
[23:50:37] <brson> jedisct1: do you know how that compares other single-threaded http servers, e.g. node?
[23:50:45] <jedisct1> Trying with nginx right now
[23:51:28] <brson> jedisct1: can you make nginx single-threaded? anything with multithreading is going to trounce us for sure
[23:51:48] <jedisct1> Yes, only 1 worker
[23:52:20] <jedisct1> Transaction rate:	     1139.00 trans/sec
[23:52:30] <jedisct1> nginx with 1 worker
[23:52:36] <jedisct1> That's pretty good :)
[23:52:47] <brson> far out
[23:52:48] <cmr> what code is this?
[23:53:02] *** Quits: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[23:53:07] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[23:53:10] *** Quits: mark_edward_ (quassel@moz-57A72B6E.hsd1.in.comcast.net) (Ping timeout)
[23:53:11] <brson> jedisct1: if i optimize httpserver it crashes
[23:53:28] <jedisct1> And my rust code is crap, I'm just beginning.
[23:53:33] <jedisct1> Oh, so it doesn't crash without -O ?
[23:54:02] <brson> jedisct1: appears to be the case. still investigating
[23:54:14] *** Joins: eschweic1 (Adium@moz-BBE3ABD.mv.mozilla.com)
[23:54:15] <jedisct1> It definitely does here
[23:54:18] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[23:54:23] <jedisct1> Just tried without -O => sigpipe
[23:54:31] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[23:54:47] *** Quits: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[23:54:49] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[23:55:10] *** Quits: brianm (brianm@moz-7A18C72.hsd1.ca.comcast.net) (Quit: Leaving...)
[23:55:55] <brson> jedisct1: are you running with RUST_THREADS=1?
[23:56:07] <brson> because i haven't been, probably why it sometimes crashes
[23:56:11] <brson> for me at least
[23:56:26] <jedisct1> Nope, that's without RUST_THREADS
[23:56:33] *** Quits: eschweic1 (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[23:57:18] *** Quits: choi (choi@4538D0B9.5A884B1C.6FE028F4.IP) (Input/output error)
[23:57:36] <jedisct1> Try sysctl -w net.inet.tcp.msl=1000 before running the test
[23:59:57] <strcat> brson: 2k/s is pretty slow - is that on linux?
