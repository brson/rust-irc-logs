[00:01:01] <brson> aturon: r? https://github.com/rust-lang/rust/pull/26200
[00:01:07] *** Quits: yjv (yjv@moz-ll38tk.pa.comcast.net) (Connection closed)
[00:06:26] <brson> pnkfelix: did notable changes to dropck make it into 1.1?
[00:07:50] <pnkfelix> brson: no I think the last fire I put out w.r.t. dropck was gh24895 which was before 1.0
[00:07:50] <[o__o]> Copy: Clone has made dropck implementation unsound!: https://github.com/rust-lang/rust/issues/24895
[00:09:08] <pnkfelix> (oh, there was a different more recent fire that was still before 1.0)
[00:09:28] <eddyb> playbot: #[derive(Display)] struct Foo;
[00:09:29] -playbot- <anon>:9:18: 9:25 error: `#[derive]` for custom traits is not stable enough for use and is subject to change
[00:09:29] -playbot- <anon>:9         #[derive(Display)] struct Foo;
[00:09:29] -playbot- output truncated; full output at: http://bit.ly/1GgD8xY
[00:09:35] <eddyb> riiight
[00:10:28] <pnkfelix> eddyb: you think we should support derive of Display? 
[00:10:56] <eddyb> pnkfelix: no, just checking, would simplify some impl I have
[00:11:32] *** Joins: genbattle (genbattle@moz-4v0.gkd.16.182.IP)
[00:14:45] <eddyb> playbot: struct Foo; impl Clone for Vec<Foo> { fn clone(&self) -> Vec<Foo> {unimplemented!()} }
[00:14:46] -playbot- output truncated; full output at: http://bit.ly/1fibfzG
[00:14:47] *** kimundi is now known as zz_kimundi
[00:15:05] <eddyb> that... complicates things :/
[00:21:31] *** Quits: erz (erz@moz-ab429s.broadband.corbina.ru) (Quit: My Mac has gone to sleep. ZZZzzz…)
[00:23:14] *** Joins: erz (erz@moz-imu.af0.232.213.IP)
[00:24:14] *** Joins: Johannes (Johannes@moz-4et8d7.ocn.ne.jp)
[00:24:53] *** Joins: Johanne__ (Johannes@moz-4et8d7.ocn.ne.jp)
[00:25:51] *** Quits: ytain (ytain@moz-p96068.dsl.teksavvy.com) (Quit: Textual IRC Client: www.textualapp.com)
[00:27:11] *** Quits: Johannes_ (Johannes@moz-4et8d7.ocn.ne.jp) (Ping timeout: 121 seconds)
[00:27:32] *** Quits: genbattle (genbattle@moz-4v0.gkd.16.182.IP) (Ping timeout: 121 seconds)
[00:28:05] *** Joins: genbattle (genbattle@moz-4v0.gkd.16.182.IP)
[00:28:25] *** Quits: Johannes (Johannes@moz-4et8d7.ocn.ne.jp) (Ping timeout: 121 seconds)
[00:29:09] *** Quits: erz (erz@moz-imu.af0.232.213.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[00:29:19] <frewsxcv> is there anything i can do to help advance https://github.com/rust-lang/rust/issues/13180 ?
[00:29:28] <frewsxcv> (serving rust-lang.org over HTTPS)
[00:29:28] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[00:34:04] <brson> frewsxcv: it just requires changing dns at this point
[00:34:36] <frewsxcv> ah okay, so nothing i can do then
[00:35:13] <brson> edunham: maybe you should just do #13180. people keep complaining about it
[00:35:25] *** Joins: Johannes (Johannes@moz-4et8d7.ocn.ne.jp)
[00:37:57] *** Quits: Johanne__ (Johannes@moz-4et8d7.ocn.ne.jp) (Ping timeout: 121 seconds)
[00:39:30] <eddyb> nmatsakis: do you have any reason for printing TyS with the default Debug impl
[00:40:00] <eddyb> nmatsakis: I had to remove it because Repr was replaced by fmt::Debug
[00:42:11] <reem> What’s the best way to write a macro pattern similar to [$($x:expr),*] which allows an optional trailing comma
[00:44:49] <huon> is it acceptable to be compulsory?
[00:45:13] <reem> I just move the , within the $() to get that
[00:45:22] <huon> right, i'm wondering if that's enough
[00:45:22] <reem> It seems like it will be complicated, so I’ll probably just do that
[00:45:33] <reem> (complicated to make it optional, I mean)
[00:45:36] <huon> I think one approach is to write out the pattern twice, one with the trailing comma, one without and have the latter just recur with the former
[00:45:50] *** chmanchester is now known as chmanchester|afk
[00:46:07] <huon> macro_rules! foo { ( $($x: expr, )*) => {}; ( $($x: expr),*) => { foo!($($x,)*) }; 
[00:50:40] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[00:51:22] *** Joins: Stebalien (Stebalien@moz-mpa15s.csail.mit.edu)
[00:53:05] <reem> makes sense
[00:53:09] <reem> not worth the effort in this case
[00:53:13] <frewsxcv> can someone close https://github.com/rust-lang/rust/issues/22673 ?
[00:54:25] <frewsxcv> thanks eddyb 
[00:56:19] <frewsxcv> can someone remove the needstest label on https://github.com/rust-lang/rust/issues/22566 ?
[00:56:32] <sfackler> done
[00:56:52] <frewsxcv> thanks
[01:01:05] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[01:02:02] *** Joins: Johannes_ (Johannes@moz-4et8d7.ocn.ne.jp)
[01:02:35] *** Quits: Johannes (Johannes@moz-4et8d7.ocn.ne.jp) (Ping timeout: 121 seconds)
[01:06:55] <Quxxy> reem: I've used $(,)* as an optional trailing comma matcher
[01:07:03] <eddyb> Quxxy: wait, that works?
[01:07:06] <reem> genius
[01:07:14] <Quxxy> Technically, it allows *any* number of trailing commas, but I doubt most people will notice
[01:07:22] <eddyb> oh, right, you just can't grab the number of matches
[01:07:32] <Quxxy> Right, but I don't *care* :P
[01:07:36] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[01:07:44] <eddyb> yeah, I had something more valuable than a comma :P
[01:07:44] <Quxxy> https://github.com/DanielKeep/rust-error-type/blob/master/src/lib.rs#L460
[01:09:06] <ChrisMorgan> We need a $(,)? for “optional”.
[01:09:18] <Quxxy> Yes!  Plz!
[01:09:20] <eddyb> ChrisMorgan: not backwards compatible :P
[01:09:32] <bluss> I didn't know it accepted repeats without parameters inside
[01:09:32] <reem> we need a new macro system...
[01:09:33] <ChrisMorgan> eddyb: I wondered whether someone would say that.
[01:09:56] <Quxxy> Just add $[...] as a new sequence matcher
[01:11:43] <Quxxy> I'm also beginning to get nervous itching and thoughts of writing an eval! macro for a simple DSL
[01:12:01] <Quxxy> I wanna compare idents and do math, damnit :(
[01:12:17] <reem> It is not pleasant to write a non-trivial macro today
[01:12:36] * Quxxy points to the above link
[01:12:58] <Quxxy> I actually made it *even worse* yesterday, trying to add extensions to the syntax (*i.e.* user-provided macros that extend the macro)
[01:13:00] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[01:13:16] <Quxxy> But I got stuck on not being able to determine equality of idents
[01:15:52] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[01:24:03] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Connection closed)
[01:28:56] *** Joins: vky (vky@moz-fqci96.ca.comcast.net)
[01:29:37] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[01:30:32] <frewsxcv> do warnings for tests in run-pass get supressed?
[01:30:37] <frewsxcv> suppressed* 
[01:30:43] *** Joins: ryanhiebert (ryanhiebert@moz-fbs5jk.hfc.comcastbusiness.net)
[01:31:13] *** Quits: ryanhiebert (ryanhiebert@moz-fbs5jk.hfc.comcastbusiness.net) (Quit: Leaving...)
[01:32:35] *** Quits: dcb (dcb@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[01:35:01] <frewsxcv> yes
[01:40:55] *** Quits: Murarth (Murarth@moz-jpotpi.phnx.qwest.net) (Quit: Mani Mani is always Mani Mani at Mani Mani with all Mani Mani Mani)
[01:41:28] *** Joins: Murarth (Murarth@moz-plj.u0s.166.46.IP)
[01:50:45] *** Quits: Murarth (Murarth@moz-plj.u0s.166.46.IP) (Quit: brb, washing the cat)
[01:51:02] *** Joins: Murarth (Murarth@moz-jpotpi.phnx.qwest.net)
[01:58:09] *** Joins: summerlight_ (summerlight@moz-99k.2mj.130.121.IP)
[02:00:13] *** Quits: vky (vky@moz-fqci96.ca.comcast.net) (Quit: Leaving)
[02:00:16] *** Joins: vky (vky@moz-fqci96.ca.comcast.net)
[02:01:34] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[02:09:30] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (Ping timeout: 121 seconds)
[02:09:35] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[02:11:47] *** Quits: Amaranth (travis@moz-1raqsl.cpe.cableone.net) (Connection closed)
[02:12:03] *** Joins: Amaranth (travis@moz-1raqsl.cpe.cableone.net)
[02:14:22] *** Quits: Johannes_ (Johannes@moz-4et8d7.ocn.ne.jp) (Connection closed)
[02:21:34] *** Joins: Johannes (Johannes@moz-4et8d7.ocn.ne.jp)
[02:21:36] *** Quits: Johannes (Johannes@moz-4et8d7.ocn.ne.jp) (Connection closed)
[02:21:38] *** Joins: Johannes (Johannes@moz-4et8d7.ocn.ne.jp)
[02:23:15] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[02:23:15] *** ChanServ sets mode: +o pcwalton
[02:25:36] *** Quits: Johannes (Johannes@moz-4et8d7.ocn.ne.jp) (Quit: Leaving...)
[02:25:43] *** Joins: Johannes (Johannes@moz-4et8d7.ocn.ne.jp)
[02:30:08] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[02:33:04] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[02:36:05] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[02:46:32] *** Quits: zz_kimundi (kimundi@moz-357luu.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:47:57] *** Joins: zz_kimundi (kimundi@moz-or1.1hh.188.87.IP)
[02:48:03] *** zz_kimundi is now known as kimundi
[02:51:28] <frewsxcv> Can someone close https://github.com/rust-lang/rust/issues/14564 ?
[02:55:57] <aatch> frewsxcv, done.
[02:56:06] <frewsxcv> thanks
[03:00:32] <bstrie> larsberg: you used to work for microsoft, right? think you can pull some strings to get them to donate windows buildbots to rust? :)
[03:02:40] *** Quits: Stebalien (Stebalien@moz-mpa15s.csail.mit.edu) (Ping timeout: 121 seconds)
[03:03:05] <bstrie> hm, why do we ship valgrind in src/rt? I'm always unclear if we even build with valgrind
[03:03:20] <frewsxcv> do we need more powerful machines or different platforms?
[03:03:47] <bstrie> frewsxcv: I'd like to begin testing on windows 10, and also our windows buildbots are megaslow, and also we're looking to cut costs :)
[03:04:17] <WindowsBunny> bstrie: I'd be more happy with Microsoft giving us the details on PDB
[03:04:37] <bstrie> I'd be happy if you gave me the details on PDB
[03:04:48] <bstrie> platform... dependent... binaries?
[03:04:54] <frewsxcv> python debugger?
[03:05:17] <bstrie> Php Data Base?
[03:05:19] <Mutabah> Portable Debugging Binary?
[03:05:43] <Mutabah> (I'm being serious, I know it's the debugging format emitted/used by VS)
[03:06:37] <bstrie> okay well lack of details on PDB is not costing us exorbitant amounts of money that we could be spending on another contractor
[03:07:02] *** Quits: vky (vky@moz-fqci96.ca.comcast.net) (Ping timeout: 121 seconds)
[03:07:05] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[03:11:13] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (Ping timeout: 121 seconds)
[03:13:46] <aatch> huon, ping
[03:14:38] <WindowsBunny> bstrie: It just means that rust binaries have awful debuginfo if at all on windows
[03:15:31] <bstrie> how bout https://www.reddit.com/r/rust/comments/3a49ff/profiling_rust_on_windows_with_intel_vtune/
[03:15:39] <cmr> vtune speaks dwarf
[03:15:51] <bstrie> we also speak dwarf
[03:16:19] <huon> aatch: pong
[03:16:45] *** Joins: semarie (semarie@moz-a523dr.bpv6.bg1u.41d0.2001.IP)
[03:16:50] <aatch> huon, this part of deriving: https://github.com/rust-lang/rust/blob/master/src/libsyntax/ext/deriving/generic/mod.rs#L547-L574
[03:17:20] <aatch> huon, as far as I can tell it will *only* generate duplicate where clauses.
[03:17:45] <aatch> huon, which makes it seem like there's something wrong with it.
[03:18:05] <huon> aatch: I... didn't write that code directly
[03:18:12] <huon> but I did review it... let me think
[03:18:51] <huon> hm, what do you mean by duplicate?
[03:18:56] <aatch> huon, https://github.com/rust-lang/rust/issues/26384
[03:19:29] <WindowsBunny> bstrie: With the msvc target though, debuginfo is completely rekt
[03:19:35] <huon> aatch: I mean, what are they duplicate with?
[03:19:48] <huon> or is that if generating multiple copies for each typaram?
[03:20:01] <aatch> huon, the expansion actually has (for example, `where T: Clone, T: Clone`)
[03:20:21] <aatch> Don't know why I put parenthesis there...
[03:20:33] <huon> oh, I see
[03:20:44] <huon> it's duplicating https://github.com/rust-lang/rust/blob/master/src/libsyntax/ext/deriving/generic/mod.rs#L505
[03:21:11] <huon> I think I agree with what you said
[03:22:43] <aatch> huon, that entire loop seems redundant.
[03:23:14] <huon> aatch: yeah, it seems so
[03:23:42] <aatch> huon, wasn't the idea to not bound the type params directly but to bound the field types?
[03:23:58] <huon> I think that didn't work, due to privacy
[03:24:06] <huon> but i think that code is left over from that, yeah
[03:25:16] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[03:34:53] *** Joins: dcb (dcb@moz-j72nfe.ca.comcast.net)
[03:35:24] *** Quits: O01eg (o01eg@moz-fe1qqi.m45p.3egh.2698.2a02.IP) (Client exited)
[03:37:01] *** Quits: dcb (dcb@moz-j72nfe.ca.comcast.net) (Quit: Textual IRC Client: www.textualapp.com)
[03:37:03] *** Joins: dcb (dcb@moz-j72nfe.ca.comcast.net)
[03:40:36] *** Quits: Nashenas88 (Nashenas88@moz-of81j9.miamfl.sbcglobal.net) (Client exited)
[03:56:30] *** Joins: vky (vky@moz-fqci96.ca.comcast.net)
[04:00:46] <Gankro> nmatsakis: Do you think it would make sense to lint against producing unbound lifetimes?
[04:00:48] <eddyb> Receiving objects: 100% (72497/72497), 58.19 MiB | 4.70 MiB/s, done.
[04:01:00] <eddyb> 60MB for a LLVM upgrade o_O?
[04:01:05] <Gankro> Oh wait it's like midnight for him
[04:01:07] <Gankro> *shrug*
[04:10:24] <gsingh93> how do I enable logging for rustc? there are some log statements in typeck I want to see, and RUST_LOG=debug doesn't work
[04:12:22] *** Quits: Jesin (Jesin@moz-4jre1i.eecs.lehigh.edu) (Quit: Leaving)
[04:12:54] <aatch> gsingh93, it's `RUST_LOG=<path::to::module>`
[04:13:26] <gsingh93> aatch: I thought specifying no module would enable it for everything?
[04:13:47] <aatch> gsingh93, you don't want to enable it for everything.
[04:13:53] <eddyb> make[4]: Entering directory '/home/eddy/Projects/rust/x86_64-unknown-linux-gnu/llvm/lib/ExecutionEngine/RuntimeDyld'
[04:14:19] <gsingh93> aatch: i don't, but even when I do, I only get log statements from "rustc::metadata::loader"
[04:14:20] <eddyb> kimundi: ^^ just saw that and it might be interesting for plugins
[04:14:59] <eddyb> gsingh93: RUST_LOG=rustc_typeck
[04:15:31] <eddyb> if you don't get anything, it's likely because debug assertions (and logging) are disabled
[04:15:46] <gsingh93> yea, i don't get anything so they must be disabled
[04:15:51] <gsingh93> how do i enable them?
[04:16:56] *** Quits: joneshf-laptop (joneshf@moz-l4h.b5s.208.98.IP) (Connection closed)
[04:17:02] *** Joins: joneshf-laptop (joneshf@moz-l4h.b5s.208.98.IP)
[04:17:22] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[04:19:13] <eddyb> gsingh93: are you building rustc yourself?
[04:19:19] <gsingh93> eddyb: yup
[04:19:30] <eddyb> I'm not sure exactly how, let me check
[04:19:51] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[04:19:51] *** ChanServ sets mode: +ao erickt erickt
[04:19:54] <eddyb> gsingh93: RUSTFLAGS="-C debug-assertions"
[04:19:58] <eddyb> gsingh93: I've used that in the past
[04:20:11] <aatch> gsingh93, there's a configure flag
[04:20:26] <eddyb> aatch: re-configuring for this is meh
[04:20:29] <eddyb> rm x86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/stamp.rustc_typeck
[04:20:48] <eddyb> gsingh93: ^^ that's what I use to trigger a rebuild of just the crate I care about (typeck in this case)
[04:21:05] <eddyb> change stage0 to something else if you need to
[04:22:17] <gsingh93> thanks, i'll give it a shot
[04:43:35] *** Quits: genbattle (genbattle@moz-4v0.gkd.16.182.IP) (Ping timeout: 121 seconds)
[04:46:07] *** Joins: lowlifer (Mibbit@moz-c2kif7.tpgi.com.au)
[04:47:30] *** Joins: eerie_ (eerie@moz-2u3428.red.bezeqint.net)
[04:47:48] <eddyb> having done `npm install --save` recently, I was a bit jealous. and now there's https://github.com/withoutboats/cargo-add
[04:49:04] *** Quits: bdero (bran@moz-lbs.91h.47.73.IP) (Ping timeout: 121 seconds)
[04:50:33] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Ping timeout: 121 seconds)
[04:52:14] *** Quits: dcb (dcb@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[04:52:24] *** Quits: eerie_ (eerie@moz-2u3428.red.bezeqint.net) (Connection closed)
[04:52:28] *** Joins: p1start (p1start@moz-nftjhe.org)
[04:55:46] *** Quits: vky (vky@moz-fqci96.ca.comcast.net) (Ping timeout: 121 seconds)
[04:57:58] <lowlifer> hi, i have been trying to find this answer on Google for while, but have no idea...  so i wish to the "allocate" function from the liballoc/heap.rs file
[04:58:10] <lowlifer> i have done this in my rs file: "use alloc::heap::{allocate, deallocate};"
[04:58:25] <lowlifer> but i get the error "error: unresolved import `alloc::heap::allocate`. Did you mean `self::alloc::heap`?"
[04:58:40] <eddyb> lowlifer: do you have `extern crate alloc;`?
[04:59:02] <lowlifer> yes
[04:59:30] <lowlifer> i'm running it using "cargo test" command
[04:59:50] <eddyb> lowlifer: is this `extern crate;` at the top of your crate, src/lib.rs or src/main.rs?
[05:00:08] <lowlifer> src/my_module/mod.rs
[05:00:29] <lowlifer> in my src/lib.rs i have "pub my_module;"
[05:00:41] <lowlifer> "pub mod my_module;"
[05:00:54] <eddyb> lowlifer: either put `extern crate alloc;` in src/lib.rs or import the functions with `use self::alloc::heap::{allocate, deallocate};`
[05:01:34] <eddyb> technically, `use my_module::alloc::heap::{allocate, deallocate};` should also work
[05:02:50] *** Joins: krax (archdev@moz-hff.m76.69.68.IP)
[05:03:11] <lowlifer> okay, thank you eddyb
[05:03:15] *** Joins: yjv (yjv@moz-ll38tk.pa.comcast.net)
[05:03:17] <lowlifer> i think it's working now
[05:03:38] <lowlifer> except i get an error when i try to use it:  error: unresolved name `allocate`
[05:04:52] <lowlifer> okay
[05:05:14] <lowlifer> got it, i need to put this inside my mod { ... } scope
[05:05:15] <lowlifer> cool
[05:05:23] <lowlifer> okay, another error now.. "error: use of unstable library feature 'alloc'"
[05:05:31] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[05:06:28] <lowlifer> eddyb, i got this error before when i was trying to use str.graphemes(true) .. but never managed to solve it so I just gave up... how do i get around this unstable error?
[05:07:13] <eddyb> lowlifer: are you using the stable compiler, or the nightly one?
[05:07:27] <lowlifer> i believe the stable v1.0.0
[05:07:48] <eddyb> then you just can't use the unstable features like allocator internals
[05:07:59] <lowlifer> rustc 1.0.0 (a59de37e9 2015-05-13) (built 2015-05-14)
[05:08:09] <eddyb> for graphemes, there is a library on crates.io which replaces it (the error message should mention that library)
[05:08:17] <lowlifer> but my cargo is nightly cargo 0.2.0-nightly (efb482d 2015-04-30) (built 2015-04-30)
[05:08:21] <eddyb> for alloc, there isn't anything you can do
[05:08:37] <eddyb> lowlifer: there's odd, you didn't get the rustc+cargo bundle?
[05:08:37] <lowlifer> so i can't actually use it? is that right?
[05:08:50] <eddyb> if you switch to the nightly compiler, you can use it
[05:08:54] <krax> can I ask for some help understanding some pieces needed to compile libstd?
[05:09:25] <eddyb> krax: in what context?
[05:09:28] <lowlifer> i did "curl -sSf https://static.rust-lang.org/rustup.sh | sh" from the website
[05:09:55] *** Joins: dcb_ (dcb@moz-j72nfe.ca.comcast.net)
[05:10:00] <eddyb> that should include rustc and cargo
[05:10:10] *** Quits: dcb_ (dcb@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[05:10:22] <krax> shorter question: trying to compile libstd resultsin a linker error where rustrt_native, rust_builtin, and backtrace cant be found, and I cant figure out where those come from
[05:10:48] <eddyb> krax: are you trying to compile libstd outside of the Rust build system?
[05:10:59] <eddyb> becuase that's not exactly easy
[05:11:34] <lowlifer> eddyb thank you, but what if i wish to use it for something stable?  do i need to implement my own and hook it to some C library?
[05:11:45] <krax> eddyb: essentially, yes. im trying to target emscripten and the standard ./configure && make doesn't care for that much, so I'm trying to go step by step to see what I can do.
[05:12:30] <eddyb> lowlifer: if you just want to allocate some bytes, you can just use Vec::<u8>::with_capacity(size) and some unsafe code
[05:12:46] <eddyb> krax: you have to go through make
[05:13:08] <eddyb> krax: usually this involves adding a new target
[05:13:26] <eddyb> krax: maybe something like this https://github.com/rust-lang/rust/pull/26355/files
[05:13:44] <eddyb> (see the existing files in mk/cfg)
[05:14:28] <eddyb> krax: ./configure --target=foo-bar-baz will use the foo-bar-baz triple instead of the auto-detected host
[05:14:40] *** Joins: hyperassociative (Mibbit@moz-gn0vp5.ca.comcast.net)
[05:15:03] <eddyb> krax: I think klutzy got emscripten working, and maybe tomaka (he's in #rust-gamedev) or Aaron
[05:16:07] <lowlifer> eddyb, yes i agree that is a possible work around... but it's nothing as fun as being extremely unsafe. Do you know if the alloc module will be allowed to be used in the future?
[05:16:38] <lowlifer> thank you eddyb, i will use Vec as you have suggested.
[05:16:41] <eddyb> lowlifer: only after we get an allocator interface
[05:21:55] <WindowsBunny> acrichto: conemu + cargo seems to cause jemalloc to EnterCriticalSection on a broken critical section in a global variable initializer, thus causing a segfault
[05:22:12] <WindowsBunny> acrichto: Issue exists on multiple versions of cargo, but oddly not rustc itself
[05:22:31] <WindowsBunny> acrichto: a program compiled with rustc exhibits the same crash as cargo itself
[05:23:45] <WindowsBunny> acrichto: This lock specifically is the one that attempts to lock a broken critical section: https://github.com/rust-lang/jemalloc/blob/e24a1a025a1f214e40eedafe3b9c7b1d69937922/src/jemalloc.c#L692
[05:27:31] <klutzy> uh, jemalloc failure..
[05:27:55] <klutzy> sounds like thread-local area broken
[05:28:36] <eddyb> didn't we use to trash it :P?
[05:29:12] <WindowsBunny> Well it's specifically an issue combined with conemu
[05:29:42] <klutzy> WindowsBunny: months ago I've met this failure: https://github.com/rust-lang/rust/issues/22710
[05:31:13] <klutzy> maybe totally unrelated
[05:32:35] <WindowsBunny> klutzy: https://github.com/rust-lang/rust/issues/14600#issuecomment-113042180
[05:33:10] <WindowsBunny> klutzy: I hate conemu, I hate jemalloc Q_Q
[05:44:23] *** Quits: aatch (james@moz-i1k1ks.tlms.2o1v.e006.2406.IP) (Connection closed)
[05:44:56] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[05:47:01] *** Quits: yjv (yjv@moz-ll38tk.pa.comcast.net) (Connection closed)
[05:49:49] *** Joins: James_ (quassel@moz-g7un1m.range86-163.btcentralplus.com)
[05:57:04] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[06:01:06] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (Ping timeout: 121 seconds)
[06:09:36] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[06:22:03] *** Quits: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au) (Ping timeout: 121 seconds)
[06:24:32] *** Joins: mib_wp0k5l (Mibbit@moz-hu6.nja.252.72.IP)
[06:25:07] *** Joins: dustinm (dustinm@moz-9ms.n6q.68.208.IP)
[06:26:15] *** Quits: mib_wp0k5l (Mibbit@moz-hu6.nja.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[06:31:55] *** Parts: hyperassociative (Mibbit@moz-gn0vp5.ca.comcast.net) ()
[06:33:00] *** Joins: hyperassociative (Mibbit@moz-gn0vp5.ca.comcast.net)
[06:33:06] *** Parts: hyperassociative (Mibbit@moz-gn0vp5.ca.comcast.net) ()
[06:34:23] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[06:41:07] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[06:43:40] *** Quits: krax (archdev@moz-hff.m76.69.68.IP) (Quit: leaving)
[06:45:57] *** Quits: summerlight_ (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[06:51:56] <SimonSapin> Are `'a: 'b` and `for<'a>` documented? I don’t see them in http://doc.rust-lang.org/book/lifetimes.html or in http://doc.rust-lang.org/reference.html
[06:52:00] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[06:52:17] <SimonSapin> I understand the former, but never remember which way around it goes
[06:52:24] <SimonSapin> I don’t really understand the latter yet
[06:58:49] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[06:58:51] *** Quits: James_ (quassel@moz-g7un1m.range86-163.btcentralplus.com) (Ping timeout: 121 seconds)
[06:59:40] *** Quits: lowlifer (Mibbit@moz-c2kif7.tpgi.com.au) (Quit: http://www.mibbit.com ajax IRC Client)
[07:03:31] <SimonSapin> ah, src/librustc/middle/infer/higher_ranked/README.md looks relevant
[07:09:31] <SimonSapin> eddyb: At the concrete call site in Servo, I now get "error: the trait `for<'a> selectors::tree::TNode<'a>` is not implemented for the type `dom::bindings::js::JSRef<'_, dom::node::Node>`"
[07:09:45] <SimonSapin> the impl is "impl<'a> style::node::TNode<'a> for JSRef<'a, Node>"
[07:09:45] *** Quits: nham (nham@moz-lglsfe.il.comcast.net) (Quit: leaving)
[07:11:10] <SimonSapin> trying with two different lifetimes in the impl
[07:14:32] <SimonSapin> it builds!
[07:14:40] <SimonSapin> tho I still have no idea what I’m doing
[07:15:26] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[07:20:25] *** Quits: bgamari (bgamari@moz-m173ho.hsi8.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[07:21:51] *** Joins: bgamari (bgamari@moz-m173ho.hsi8.kabel-badenwuerttemberg.de)
[07:22:39] *** Joins: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au)
[07:23:55] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[07:30:02] *** Joins: summerlight_ (summerlight@moz-99k.2mj.130.121.IP)
[07:32:44] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[07:35:36] *** Joins: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP)
[07:43:20] <aatch> Bah, this code isn't working, and I don't know why!
[07:45:47] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Connection closed)
[07:46:03] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[07:46:43] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[07:48:31] *** Joins: doener_ (bs@moz-3ajdi1.fixip.bitel.net)
[07:49:39] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[07:51:41] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[07:51:45] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (Ping timeout: 121 seconds)
[07:54:46] *** Quits: chc4 (chc4@moz-pdo0at.ma.comcast.net) (Quit: AHHHHH BEES)
[08:00:08] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[08:01:34] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[08:03:50] *** Quits: doener_ (bs@moz-3ajdi1.fixip.bitel.net) (Quit: leaving)
[08:04:21] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[08:06:20] <kimundi> eddyb: What does RuntimeDyld do, exactly?
[08:07:13] <kimundi> eddyb: AH, this looks promising: http://llvm.org/docs/MCJITDesignAndImplementation.html
[08:09:00] <aatch> Hooray, I managed to get past compiling libsyntax, the mark towards bootstrapping continues!
[08:28:34] *** Quits: bstrie (ben@moz-avu3ju.members.linode.com) (Ping timeout: 121 seconds)
[08:28:35] *** Joins: bstrie (ben@moz-avu3ju.members.linode.com)
[08:28:48] *** Joins: imperio (Mibbit@moz-ddsl0n.abo.wanadoo.fr)
[08:29:15] <doener> eddyb: re: failed alias analysis: running opt again properly eliminates all the stores, 
[08:29:17] <imperio> steveklabnik: ping
[08:30:13] <doener> eddyb: so it's just the "usual" thing of the PM configuration not being optimal for the code we generate I guess
[08:31:57] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[08:37:56] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[08:38:06] *** Joins: zeldatrix (Mibbit@moz-hu6.nja.252.72.IP)
[08:40:15] *** Quits: zeldatrix (Mibbit@moz-hu6.nja.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[08:48:22] <SimonSapin> Next build error in this higher-ranked lifetime adventure: "error: the trait `for<'a> style::node::TElementAttributes` is not implemented for the type `<_ as selectors::tree::TNode<'a>>::Element`"  The corresponding bound is "for<'a> <N as TNode<'a>>::Element: TElementAttributes". The _ / N type at this call site is LayoutNode<'ln>, and I have "impl<'ln, 'a> TNode<'a> for LayoutNode<'ln> { type Element = LayoutElement<'a>; ... }" and 
[08:48:22] <SimonSapin> "impl<'le> TElement for LayoutElement<'le>"
[08:48:40] <SimonSapin> As far as can tell the trait *is* implemented, but I don’t know how to convince the compiler of that.
[08:50:13] <SimonSapin> Exciting, right? Anyone wanna help?
[08:51:53] *** Joins: erz (erz@moz-imu.af0.232.213.IP)
[08:53:56] *** Quits: njn (chatzilla@moz-0ah9lm.iinet.net.au) (Quit: ChatZilla 0.9.91.1 [Firefox 41.0a1/20150531163607])
[09:02:07] *** Quits: erz (erz@moz-imu.af0.232.213.IP) (Ping timeout: 121 seconds)
[09:03:15] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[09:03:23] *** Joins: erz (erz@moz-ab429s.broadband.corbina.ru)
[09:05:12] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[09:06:24] *** Joins: oli_obk__ (Mibbit@moz-7bq.0sb.52.141.IP)
[09:10:09] *** Joins: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net)
[09:10:30] *** Joins: Quxxy_ (chatzilla@moz-efh10q.internode.on.net)
[09:11:29] *** Quits: Quxxy (chatzilla@moz-efh10q.internode.on.net) (Ping timeout: 121 seconds)
[09:11:33] *** Quxxy_ is now known as Quxxy
[09:16:08] *** Parts: kimundi (kimundi@moz-or1.1hh.188.87.IP) ("leaving")
[09:16:17] *** Joins: kimundi (kimundi@moz-or1.1hh.188.87.IP)
[09:21:23] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[09:24:01] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[09:36:55] *** Joins: aepsil0n (eduard@moz-6491ha.mv2h.pepi.8071.2a02.IP)
[09:37:26] *** Quits: aepsil0n (eduard@moz-6491ha.mv2h.pepi.8071.2a02.IP) (Quit: Leaving.)
[09:41:58] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[09:45:21] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[09:48:40] *** Quits: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP) (Quit: Leaving...)
[10:01:25] *** Joins: globin (globin@moz-isrgf8.de)
[10:03:55] *** Quits: mtsr_ (mtsr@moz-s5jpgs.yourbnc.co.uk) (Connection closed)
[10:05:55] *** Joins: delma (aopkarja@moz-6l6mf3.cs.helsinki.fi)
[10:08:56] *** Joins: vmx (vmx@moz-f4uhap.pools.vodafone-ip.de)
[10:09:05] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[10:13:04] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[10:20:35] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[10:22:40] <Manishearth>   SimonSapin ?
[10:22:43] <Manishearth> code please
[10:23:54] <Manishearth> well, TNode is not TElementAttributes
[10:24:13] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Quit: Leaving)
[10:24:21] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[10:33:42] <SimonSapin> Manishearth: pushing a branch now
[10:37:29] <SimonSapin> Manishearth: method is here: https://github.com/servo/servo/blob/0882512cf6/components/style/selector_matching.rs#L193-L203 ,  call site / error is https://github.com/servo/servo/blob/0882512cf6/components/layout/css/matching.rs#L550-L554 , full error message is https://gist.github.com/anonymous/9ce1838d083c93678b3f ,  relevant impls are https://github.com/servo/servo/blob/0882512cf6/components/layout/wrapper.rs#L350-L351 and  https://github.
[10:37:29] <SimonSapin> com/servo/servo/blob/0882512cf6/components/layout/wrapper.rs#L653
[10:43:12] <Manishearth> SimonSapin: uh, the for<'a> in the declaration looks bad
[10:43:19] <Manishearth> I think you want fn<'a>
[10:43:29] <SimonSapin> eddyb recommended it
[10:43:41] <Manishearth> it's not the same 'a, basically
[10:43:46] <Manishearth> and you want it to be the same 'a
[10:43:52] <Manishearth> I don't think we gan group HRLs
[10:43:55] <Manishearth> *can
[10:44:03] <SimonSapin> oh, I see
[10:44:16] <Manishearth> for<'a" {something: somethingelse<'a>, otherthing: otherthingelse<'a>}
[10:44:43] <Manishearth> that's what you want, but we don't have that -- the second pair of 'as in your code are not the same as the first
[10:44:46] <SimonSapin> The starting point is https://github.com/servo/rust-selectors/compare/non-copy-nodes#diff-ecc927991c14fae6e03a511ed1d458b3
[10:45:13] <SimonSapin> (to enable Rc-based nodes in Kuchiki)
[10:47:44] <Manishearth> SimonSapin: so what does fn foo<'a> do to it?
[10:48:53] <SimonSapin> and removing for<'a> ?
[10:49:20] <SimonSapin> error: the trait `for<'a> selectors::tree::TNode<'a>` is not implemented for the type `N`
[10:49:44] <SimonSapin> at the call site of rust-selector methods that still have for<'a>
[10:52:07] <SimonSapin> another attempt: https://gist.github.com/anonymous/7f203e1bee95095517ef
[11:03:01] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[11:03:44] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[11:05:53] *** Joins: Quxxy_ (chatzilla@moz-efh10q.internode.on.net)
[11:07:29] *** Quits: Quxxy (chatzilla@moz-efh10q.internode.on.net) (Ping timeout: 121 seconds)
[11:07:41] *** Quxxy_ is now known as Quxxy
[11:20:21] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Connection closed)
[11:21:38] *** Joins: laumann (thomas@moz-poa.3kq.109.2.IP)
[11:25:30] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[11:29:09] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[11:29:40] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (Ping timeout: 121 seconds)
[11:29:46] <Manishearth> SimonSapin: hm
[11:30:19] <Manishearth> SimonSapin: I'm suggesting all for<'a"s be removed
[11:30:28] <Manishearth> use regular lifetimes
[11:30:31] <SimonSapin> I’d ask pnkfelix, but he’s apparently not in the office
[11:30:43] <SimonSapin> Manishearth: then I go back to my original problem with Kuchiki
[11:31:31] <SimonSapin> … which is here: https://github.com/SimonSapin/kuchiki/blob/rc/src/select.rs
[11:31:43] <pnkfelix> SimonSapin: I'm on my way now
[11:32:05] <SimonSapin> pnkfelix: then I’ll bother you with this later if you have time :)
[11:32:40] <SimonSapin> In as_element(), I want the return &'a ElementData value to have the lifetime of &'a self
[11:32:53] <SimonSapin> because self is a Rc, and the element data is inside that Rc
[11:33:23] <SimonSapin> but since the return value of as_element is an associated type, 'a needs to be a parameter of the trait
[11:33:43] <SimonSapin> and when using that trait as a bound, I need to provide it
[11:34:10] <Manishearth> uh ... wha
[11:34:19] <Manishearth> hm
[11:34:31] <SimonSapin> and if the code with that bound itself has 'a as a parameter instead of for<'a>, then it’s the same 'a for all nodes
[11:34:46] <SimonSapin> which doesn’t work for n.get_element() v.s. n.get_parent().get_element()
[11:34:47] <Manishearth> YEAH
[11:34:49] <Manishearth> *yeah
[11:34:50] <Manishearth> hm
[11:35:13] <SimonSapin> That’s where eddyb suggested for<'a> yesterday
[11:35:37] <Manishearth> yeah now I see why you want it
[11:36:01] <Manishearth> technically keeping <'a> out of the trait and making type Element = for<'a> &'a Elementdata might work
[11:36:04] <Manishearth> but
[11:36:09] <Manishearth> you can;t constrain that properly
[11:36:45] *** kimundi is now known as zz_kimundi
[11:37:40] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[11:39:13] <SimonSapin> I’d like that, but "error: expected ident, found `&`"
[11:39:24] <SimonSapin> at "type Element = for<'a> &'a ElementData;"
[11:39:39] *** Joins: munksgaard (munksgaard@moz-bk8.2r1.225.130.IP)
[11:39:40] *** Quits: _Vi (vi@moz-bbs.vhj.131.104.IP) (Ping timeout: 121 seconds)
[11:44:48] *** Quits: summerlight_ (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[11:49:06] *** Joins: arielb1 (Mibbit@moz-btgh0i.tau.ac.il)
[11:49:21] <arielb1> nmatsakis: ping
[11:49:28] <arielb1> gh26391
[11:49:28] <[o__o]> Clarify cast rules (tracking issue for RFC 1052): https://github.com/rust-lang/rust/issues/26391
[11:55:18] <Manishearth> eddyb: I FIGURED OUT HOW TO SOMEWHAT STABILIZE SYNTAX EXTENSIONS!!111
[11:55:23] <Manishearth> :D :D
[11:55:27] <Mutabah> Manishearth: O.O
[11:55:32] <SimonSapin> Manishearth: go on :)
[11:55:48] <Manishearth> So it's somewhat similar to what syntex does
[11:55:50] <Manishearth> except
[11:55:53] <Manishearth> it doesn't need syntex
[11:56:18] <Manishearth> Note that I am talking about syntax extensions being used in libs like h5e
[11:56:28] <Manishearth> not exported syntax extensions
[11:56:44] <Manishearth> The thing is, syntax extensions of these kinds are only to help the dev, really
[11:57:10] <Manishearth> So the syntax extensions can't be stabilized
[11:57:22] <Manishearth> but the generated code is fine
[11:57:22] *** Joins: Sho (sho@moz-aig7ns.cust.telecolumbus.net)
[11:57:34] <Manishearth> syntex solves this by generating the code via magick hacks
[11:57:44] <Manishearth> but syntex doesn't really solve the stability issue
[11:57:45] <Manishearth> however
[11:58:10] <SimonSapin> Manishearth: https://github.com/servo/html5ever/issues/53 suggests  shipping the output of rustc-nightly --pretty expanded
[11:58:12] <Manishearth> what if, when publishing, we could also publish a post-expansion version?
[11:58:17] <Manishearth> eeexactly!
[11:58:22] <Manishearth> So the idea is to modify cargo
[11:59:05] <Manishearth> So when I do `cargo publish --stabilize`, it publishes an alternate version
[11:59:37] <Manishearth> (without overwriting the existing nightly one -- with syntex it's a bit hard to get a good stable-nightly choice, you have to choose one over the other for the library)
[11:59:47] <Manishearth> this alternate version does not have any plugins in its deps
[12:00:04] <Manishearth> and is locally --pretty=expanded'ed
[12:00:11] <Manishearth> and is locally checked for any unstable features
[12:00:35] <Manishearth> (we could have a mode to rustc nightly that makes it behave like stable as far as features go)
[12:00:49] <Manishearth> so cargo now has two versions of the same lib
[12:01:11] <Manishearth> and when you cargo build with a stable, it will try to pull in a stabilized version if possible
[12:01:21] <Manishearth> minimal changes to the compiler, mostly changes to crates
[12:01:25] <oli_obk__> Manishearth: why do you need both the unexpanded and the expanded version? wouldn't the expanded be enough for cargo?
[12:01:59] <Manishearth> oli_obk__: because some of us like using nightlies and don't want to have to  debug horrible expanded code :)
[12:02:13] <Manishearth> otherwise that is already almost possible by making all libraries use syntex
[12:02:17] <Manishearth> but then there's not a choice
[12:03:29] <oli_obk__> Manishearth: you actually debug code downloaded from crates.io? I never tried that, I always get the original repos when there's a bug in a crate i'm importing
[12:04:16] *** zz_kimundi is now known as kimundi
[12:04:46] <bluss> I tried fixing a bug right in cargo's downloaded version. That was very confusing as soon as I forgot I did it
[12:08:01] *** Quits: det (chris@moz-6q2one.lv.cox.net) (Connection closed)
[12:22:45] *** Joins: det (chris@moz-6q2one.lv.cox.net)
[12:27:41] *** Joins: manishea1th (manishearth@moz-uc30rq.anapnea.net)
[12:27:44] *** Quits: arielb1 (Mibbit@moz-btgh0i.tau.ac.il) (Quit: http://www.mibbit.com ajax IRC Client)
[12:28:13] *** kimundi is now known as zz_kimundi
[12:30:04] *** Joins: Nashenas88 (Nashenas88@moz-of81j9.miamfl.sbcglobal.net)
[12:30:24] *** Quits: Manishearth (manishearth@moz-uc30rq.anapnea.net) (NickServ (RECOVER command used by manishea1th))
[12:30:24] *** manishea1th is now known as Manishearth
[12:30:24] *** ChanServ sets mode: +ao Manishearth Manishearth
[12:32:16] *** Joins: Sho_ (sho@moz-aig7ns.cust.telecolumbus.net)
[12:32:25] *** Quits: Sho (sho@moz-aig7ns.cust.telecolumbus.net) (Ping timeout: 121 seconds)
[12:32:59] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[12:33:45] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[12:39:35] *** Quits: luzie (lu.cy@moz-g11uhv.lu) (Quit: WeeChat 1.3-dev)
[12:39:42] *** Joins: luzie (lu.cy@moz-g11uhv.lu)
[12:40:51] *** Quits: luzie (lu.cy@moz-g11uhv.lu) (Quit: WeeChat 1.3-dev)
[12:40:56] *** Joins: luzie (lu.cy@moz-g11uhv.lu)
[12:59:56] <eddyb> Manishearth: the post-expansion thing is not a new idea
[13:00:55] <eddyb> Manishearth: but there is no good serialization format for it
[13:01:02] <Manishearth> eddyb: I'm not serializing
[13:01:04] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[13:01:08] <Manishearth> eddyb: (I'm writing a prerfc)
[13:01:22] <eddyb> Manishearth: post-expansion is not stable code
[13:01:35] <eddyb> syntex is actually better than builtin for this
[13:01:46] <Manishearth> eddyb: why is post-expansion not stable?
[13:01:52] *** Joins: mukilan (mukilan@moz-b2t.h6f.164.122.IP)
[13:02:02] <eddyb> becuase stable macros can call unstable code
[13:02:02] <Manishearth> -Z pretty=expanded I mean
[13:02:12] <Manishearth> oh right. I have a way of addressign that
[13:02:13] <Manishearth> sort of
[13:02:18] <eddyb> I do too :P
[13:02:23] <Manishearth> expand only syntax extensions
[13:03:00] <eddyb> Manishearth: https://www.reddit.com/r/rust/comments/36i5eg/serde_04_now_supports_syntax_extensions_in_stable/cre92re
[13:03:18] <eddyb> yeah but I bet you didn't think of using macro_rule wrappers to achieve hygiene :P
[13:03:41] <eddyb> and hoist unexpanded inner macros that you shouldn't expand
[13:04:00] <eddyb> actually, no, the other way around
[13:04:23] *** Joins: ytain (ytain@moz-p96068.dsl.teksavvy.com)
[13:04:43] <eddyb> *macro_rules
[13:05:02] <eddyb> hoist expanded inner macro invocations from inside an invocation of a macro you can't expand
[13:05:45] <eddyb> well, libsyntax has the advantage of knowing the built-in macros and which ones expand to unstable code
[13:06:13] *** Quits: mukilan (mukilan@moz-b2t.h6f.164.122.IP) (A TLS packet with unexpected length was received.)
[13:06:20] *** Joins: mukilan (mukilan@moz-b2t.h6f.164.122.IP)
[13:06:29] *** Quits: Quxxy (chatzilla@moz-efh10q.internode.on.net) (Ping timeout: 121 seconds)
[13:07:03] <eddyb> Manishearth: oh and you might want to output a file structure similar to the original, which we currently don't do
[13:08:03] *** Joins: bdero (bran@moz-nd2f6b.dyn.mit.edu)
[13:08:05] *** Quits: bdero (bran@moz-nd2f6b.dyn.mit.edu) (Quit: Leaving.)
[13:08:06] *** Joins: bdero (bran@moz-e4f4ei.mit.edu)
[13:08:42] <eddyb> and try to "align" the output to it has the same line placement (it's actually easier not to pretty-print anything in the original code, e.g. reuse whitespace from spans, and hoist everything else)
[13:08:50] *** Joins: bdero1 (bran@moz-nd2f6b.dyn.mit.edu)
[13:08:58] *** Quits: bdero1 (bran@moz-nd2f6b.dyn.mit.edu) (Quit: Leaving.)
[13:08:58] *** Joins: bdero1 (bran@moz-e4f4ei.mit.edu)
[13:09:02] *** Quits: bdero (bran@moz-e4f4ei.mit.edu) (Quit: Leaving.)
[13:09:17] <eddyb> Manishearth: now that we got that out of the way, feel free to start experimenting :D
[13:09:30] *** Quits: mukilan (mukilan@moz-b2t.h6f.164.122.IP) (A TLS packet with unexpected length was received.)
[13:09:35] *** Joins: mukilan (mukilan@moz-b2t.h6f.164.122.IP)
[13:10:07] <eddyb> SimonSapin, Manishearth: also, type Foo = for<'a> ...; would be an odd form of type Foo<'a> = ...; which is HKT, which Rust doesn't have, hence the lifetime parameter on the trait
[13:11:03] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[13:11:04] <eddyb> doener: I was wondering if that was the case :(
[13:12:30] <eddyb> zz_kimundi: haven't seen those docs, but they do seem to be talking about what you'd want from a plugin. alternatively... we write our own ELF loader :P
[13:12:53] <eddyb> and Mach-O and PE and then it will be 2021
[13:14:54] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[13:15:37] <SimonSapin> eddyb: oh, ok. I didn’t realize this was HKT
[13:16:56] <SimonSapin> eddyb: I tried other things with pnkfelix and at this point the error message is error: type mismatch resolving `for<'a> <wrapper::LayoutNode<'_> as selectors::tree::TNode<'a>>::Element == _` expected bound lifetime parameter 'a, found concrete lifetime 
[13:17:47] <SimonSapin> but explaining the context takes a while, and I should be doing something else :]
[13:18:07] <eddyb> SimonSapin: what's the code?
[13:18:19] <eddyb> SimonSapin: I mean, the source of that associated item path
[13:19:12] <eddyb> SimonSapin: oh and there's a limitation in the current implementation, which I think is what you're hitting
[13:19:34] <eddyb> SimonSapin: associated types under `for<'a>` are not (always) fully resolved to a concrete type right now
[13:20:33] <eddyb> nmatsakis knows more, but what I gather is that it's entirely possible, just needs more work
[13:20:47] <SimonSapin> eddyb: pushin a branch…
[13:21:17] <eddyb> SimonSapin: only that line would be enough to confirm it's the same issue (if you know where it is)
[13:21:32] <SimonSapin> eddyb: https://github.com/servo/servo/blob/f96f7b6702f2be07c51869aadb0701cb07512c8b/components/style/selector_matching.rs#L193-L203 is the method being called. I adde the type parameter E to work around 'a not being the same in two for<'a> bounds
[13:21:41] <SimonSapin> which line?
[13:22:11] *** Joins: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP)
[13:22:14] <eddyb> the line with the associated type path in the error
[13:22:35] <SimonSapin> https://github.com/servo/servo/blob/f96f7b6702f2be07c51869aadb0701cb07512c8b/components/layout/wrapper.rs#L351 this impl?
[13:22:37] <eddyb> yeah, the thing you linked would exhibit the problem
[13:22:56] <eddyb> SimonSapin: nah, the bound of the first function, i.e. N: for<'a> TNode<'a, Element=E>
[13:23:45] <eddyb> that's a shorthand for: N: for<'a> TNode<'a>, for<'a> <N as TNode<'a>>::Element == E (which I don't think is valid syntax right now)
[13:24:12] <SimonSapin> except that 'a is the same evewhere, right?
[13:24:29] <Manishearth> eddyb: hey, aside from Erick and Keegan who else was at that stable-syntax-extension meeting at Portland?
[13:24:36] <eddyb> SimonSapin: it's for<'a> so it doesn't matter :P
[13:24:37] <Manishearth> I'm sure there was someone else
[13:24:40] <Manishearth> but I forget who
[13:24:51] <eddyb> SimonSapin: since it means "for every possible lifetime"
[13:25:04] <eddyb> Manishearth: burntsushi?
[13:25:06] * Quxxy is jealous of Erick and Keegan
[13:25:09] <eddyb> wait no
[13:25:18] <Manishearth> eddyb: burntsushi wasn't at portland?
[13:25:20] <Manishearth> was he?
[13:25:27] <eddyb> I didn't see "portland" :P
[13:25:31] <Manishearth> heh
[13:25:33] <eddyb> I thought you meant some random meetup
[13:25:35] <eddyb> Manishearth: acrichto
[13:25:37] <Manishearth> nrc!
[13:25:40] <Manishearth> no it was nrc
[13:25:43] <eddyb> okay
[13:25:56] <SimonSapin> eddyb: I think one of the earlier issues is that in "N: for<'a> TNode<'a>, for<'a> <N as TNode<'a>>::Element: TElementAttributes" , the 'a of both for<'a> was not the same
[13:26:16] <eddyb> Quxxy: well, you've got a Q in your name, no need to be jealous because they have K's
[13:26:31] <eddyb> SimonSapin: 'a is not anything concrete
[13:26:36] <Quxxy> eddyb: But I have a 'K' in my name, too
[13:26:45] <eddyb> oh, right :P
[13:26:49] <Quxxy> And *three* 'e's
[13:26:54] <SimonSapin> eddyb: right, it’s "for any 'a", and then "for any *other* 'a"
[13:27:35] <SimonSapin> … AFAIU
[13:27:41] <eddyb> well...
[13:28:13] <eddyb> "for any x in F(x)" and "for any y in F(y)" are completely equivalent
[13:28:27] <eddyb> there is no "other" 'a
[13:28:52] <eddyb> SimonSapin: for any concrete 'a, both of those bounds apply
[13:29:34] <eddyb> the issue is that the second bound has `for<'a> associated_path: trait`
[13:29:46] <SimonSapin> eddyb: so maybe I misunderstood the earlier build error
[13:29:50] <eddyb> and that's not properly resolved to a concrete type
[13:29:50] <bluss> playbot: "bab".trim_matches("bab")
[13:29:51] -playbot- output truncated; full output at: http://bit.ly/1BlwhaZ
[13:29:59] <eddyb> SimonSapin: no, you hit the same issue twice with two different usecases
[13:30:10] <SimonSapin> eddyb: ok, so what’s the issue?
[13:30:30] <eddyb> SimonSapin: I didn't realize I led you to basically having Servo blocked on the same issue I hit a few days ago
[13:30:44] <SimonSapin> which is?
[13:31:00] <eddyb> <N as TNode<'a>>::Element under for<'a> isn't resolved even if N is known
[13:31:43] <SimonSapin> ok
[13:31:51] <SimonSapin> is it in the issue tracker?
[13:31:58] <eddyb> let me see
[13:34:25] *** zz_kimundi is now known as kimundi
[13:35:56] <eddyb> SimonSapin: can't find one
[13:41:05] <Manishearth> eddyb: https://internals.rust-lang.org/t/pre-rfc-stablized-syntax-extensions-sort-of/2259
[13:42:19] <eddyb> Manishearth: you didn't touch on any of the solutions to stability *or* hygiene?
[13:42:26] <eddyb> you didn't even mention hygiene!
[13:42:34] <Manishearth> I did?
[13:42:39] <eddyb> pretty-printed expanded code is broken hygiene-wise
[13:42:47] <Manishearth> eddyb: Changes to rustc
[13:42:55] <Manishearth> > For full flexibility, it would be nice if rustc could have a more nuanced expansion mode where only syntax extensions not defined by rustc itself are expanded. This means that macros still work, and macro stability still works. (otherwise macros with unstable innards will fail) Complex nesting might still be broken though.
[13:42:56] <eddyb> I used Ctrl+F
[13:43:03] <Manishearth> > An additional wishlist item would be for that expansion mode to expand file-by-file to maintain the file structure as much as possible.
[13:43:14] <eddyb> Manishearth: oh, wait
[13:43:14] <Manishearth> oh, I forgot to mention gensym
[13:44:02] <Manishearth> edited
[13:44:10] <eddyb> Manishearth: fwiw gensym would be wrong
[13:44:32] <Manishearth> note that since it compiles again the worst that could happen would be that the library can't be ported to stable without tweaks
[13:44:34] <eddyb> as you may not know what identifiers are used for and you'd be changing their visible representation
[13:44:38] <Manishearth> better than the status quo
[13:44:45] <Manishearth> eddyb: no I mean gensym only when necessary
[13:44:48] <Manishearth> yeah
[13:45:26] <eddyb> Manishearth: yeah but you can still need it and still have it be wrong
[13:45:44] <Manishearth> sure
[13:45:44] <eddyb> you can't tell between the two foo's in format!("{foo}", foo = foo)
[13:46:22] *** kimundi is now known as zz_kimundi
[13:46:40] <Manishearth> hm
[13:46:41] <eddyb> Manishearth: whereas creating hoisting macro_rules wrappers preserves the hygiene
[13:48:17] <eddyb> Manishearth: every expansion is turned into an one-time-use macro_rules definition with all unique identifiers from the original invocation being passed in, and used wherever they appear in the expanded AST
[13:48:27] <imperio> does someone know how to get  https://github.com/rust-lang/rust/blob/master/src/librustc_typeck/check/method/suggest.rs#L85 ?
[13:49:48] <eddyb> playbot: use std::fmt::{Display, Debug}; 0.fmt(panic!());
[13:49:49] -playbot- more than 5000 bytes of output; bailing out
[13:49:53] <eddyb> oops
[13:49:59] <eddyb> playbot: use std::fmt::{Display, Debug}; 0u32.fmt(panic!());
[13:50:00] -playbot- <anon>:9:46: 9:59 error: multiple applicable methods in scope [E0034]
[13:50:01] -playbot- <anon>:9         use std::fmt::{Display, Debug}; 0u32.fmt(panic!());
[13:50:01] -playbot- output truncated; full output at: http://bit.ly/1GuukHZ
[13:50:27] <eddyb> imperio: ^^ that?
[13:50:36] <imperio> eddyb: it's when two traits implement the same type ?
[13:50:42] <imperio> eddyb: yes, totally, thanks haha
[13:50:51] <eddyb> the same type implements two traits
[13:50:57] <eddyb> playbot: use std::fmt::{Display, Debug}; <i32>::fmt;
[13:50:58] <imperio> same function, not type
[13:50:58] -playbot- <anon>:9:41: 9:52 error: multiple applicable methods in scope [E0034]
[13:50:58] -playbot- <anon>:9         use std::fmt::{Display, Debug}; <i32>::fmt;
[13:50:58] -playbot- output truncated; full output at: http://bit.ly/1BlySSd
[13:51:17] *** Quits: Florob (Florob@moz-je09t8.de) (Ping timeout: 121 seconds)
[13:51:22] <eddyb> imperio: the same type implements two traits with a common method name
[13:51:40] <eddyb> (I was nitpicking on the fact that types implement traits, not the other way around)
[13:52:27] <imperio> eddyb: then why http://is.gd/81B4b9 does work ?
[13:52:43] <eddyb> my bet is priority
[13:53:08] <eddyb> imperio: yeah, it's priority of inherent impls over trait ones
[13:53:20] *** Joins: Florob (Florob@moz-je09t8.de)
[13:53:22] <imperio> hum...
[13:53:36] <imperio> Well, for now I'll take your example if you don't mind ^^
[13:54:19] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Connection closed)
[13:54:21] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[13:55:07] <eddyb> sure. it's one that sometimes annoys me :P
[13:56:56] *** ChanServ sets mode: +o nmatsakis
[14:11:03] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[14:13:27] *** Joins: summerlight_ (summerlight@moz-99k.2mj.130.121.IP)
[14:14:28] <imperio> eddyb: another way of having this error: http://is.gd/Esv4xe
[14:14:37] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[14:14:56] <eddyb> sure
[14:15:49] *** Joins: mtsr_ (mtsr@moz-b5lsuq.yourbnc.co.uk)
[14:18:41] <imperio> http://is.gd/1kibjb it says Test is never used, isn't it an error ?
[14:18:42] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (Ping timeout: 121 seconds)
[14:20:50] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Connection closed)
[14:27:33] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Quit: Leaving.)
[14:28:48] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[14:33:30] *** Joins: bjz (bjz@moz-puppgq.tpgi.com.au)
[14:34:11] *** Joins: mib_em1vi7 (Mibbit@moz-g3i.lmg.221.106.IP)
[14:34:29] *** Parts: mib_em1vi7 (Mibbit@moz-g3i.lmg.221.106.IP) ()
[14:34:52] <Mutabah> Anyone here know what the format of the clobber list is for asm!
[14:35:08] <Mutabah> llvm seems to be ignoring my clobber list, and using a clobbered register
[14:35:16] *** Joins: O01eg (o01eg@moz-fe1qqi.m45p.3egh.2698.2a02.IP)
[14:35:35] <eddyb> Mutabah: what are you using?
[14:35:42] <eddyb> it should be pretty close to GCC
[14:36:09] *** zz_kimundi is now known as kimundi
[14:36:19] <Mutabah> eddyb: asm!("syscall" : "={rax}" (rv) : "{rax}" ($id) $(, $reg ($val))* : "%rcx %r11" : "volatile" );
[14:36:34] <Mutabah> I've tried "rcx r11" and "{rcx} {r11}" as well
[14:36:43] <eddyb> have you tried "rcx", "r11"?
[14:36:50] <Mutabah> TRPL implies that "{rcx}" is vali....
[14:36:54] * Mutabah headdesks
[14:37:00] <eddyb> {rcx} is for input/output
[14:37:34] <Mutabah> http://doc.rust-lang.org/nightly/book/inline-assembly.html#clobbers
[14:37:58] * eddyb shrugs
[14:38:03] <Mutabah> eddyb: Also, thanks. It was that syntax
[14:40:12] <doener> uhm, this looks weird: CFG_LLVM_LINKAGE_FILE=/home/doener/storage/builds/rust-submit/x86_64-unknown-linux-gnu/rt/llvmdeps.rs LD_LIBRARY_PATH=/home/doener/storage/builds/rust-submit/x86_64-unknown-linux-gnu/stage1/lib:$LD_LIBRARY_PATH   x86_64-unknown-linux-gnu/stage1/bin/rustc --cfg stage1  -O --cfg rtopt -C debug-assertions=on -C prefer-dynamic --target=x86_64-unknown-linux-gnu  -D warnings -L "x86
[14:40:18] <doener> _64-unknown-linux-gnu/rt" -L "/home/doener/storage/builds/rust-submit/x86_64-unknown-linux-gnu/llvm/Release+Asserts/lib"    --out-dir x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib -C extra-filename=-d8ace771 /home/doener/src/rust-submit/src/libcore/lib.rs
[14:40:23] <doener> arg... wrong clipboard
[14:40:52] <doener> this is what I actually wanted: getelementptr inbounds [1 x i8**], [1 x i8**]* %4, i32 0, i32 3
[14:40:59] *** Joins: yjv (yjv@moz-j0cdis.fios.verizon.net)
[14:42:02] <eddyb> 3? what for?
[14:42:26] <eddyb> wait, no, how
[14:42:34] <eddyb> doener: that doesn't look valid
[14:43:03] *** chmanchester|afk is now known as chmanchester
[14:43:05] <eddyb> it just "derefes" but has two indexes
[14:44:12] <doener> eddyb: it just theoretically runs out of bounds, given the array size, but the actual object is large enough and llvm probably doesn't care (this is looking up a method in a vtable)
[14:46:26] <eddyb> doener: but the types look like they don't match
[14:47:00] <eddyb> shouldn't the result be of type i8***?
[14:47:32] <eddyb> not [1 x i8**]*, which is the same type as the input pointer
[14:50:43] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Connection closed)
[14:51:18] <doener> eddyb: oh, now I see what you mean, no, the pointee type is just what the given pointer points to, it's not about the resulting pointer
[14:51:38] <doener> eddyb: the resulting pointer is indeed i8***
[14:51:48] <eddyb> oops
[14:52:19] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[14:52:28] <eddyb> doener: I forgot about Schrodinger's pointer types
[14:52:47] <doener> it's just for the future when we'll have something like: getelementptr inbounds [1 x i8**], ptr %4, i32, i32 3
[14:53:08] <eddyb> simultaneously opaque and not opaque
[14:53:24] <eddyb> doener: it would be nice to have a typed vtable
[14:58:38] *** Joins: harrisonclarke (harrisoncla@moz-th044a.ns.bellaliant.net)
[15:04:06] <doener> ah, way better: https://gist.github.com/dotdash/a89b480bc172604a06f7
[15:05:19] <eddyb> doener: you made it simpler?
[15:05:46] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[15:05:47] <doener> basically just the result of passing fat pointers as immediates
[15:06:16] <doener> but my initial version had an intermediate alloca for the fat pointer, and now it does the call directly
[15:06:49] <eddyb> doener: this should devirtualize much faster
[15:07:25] <doener> I sure hope so
[15:07:38] <eddyb> as you'll be passing a constant pointer, creating a constant GEPi, and the load from that is trivially folded
[15:07:55] <eddyb> at least for functions that take &Trait et. co
[15:08:04] <eddyb> (et co.? :P)
[15:09:19] <eddyb> middle/traits/select.rs: 91 .repr() calls. y u do dis nmatsakis?
[15:09:57] <nmatsakis> eddyb: ?
[15:10:39] *** Quits: imperio (Mibbit@moz-ddsl0n.abo.wanadoo.fr) (Quit: http://www.mibbit.com ajax IRC Client)
[15:10:49] <eddyb> nmatsakis: just having to replace {} with {:?} one repr call at a time (yay carpal tunnel)
[15:11:27] <eddyb> nmatsakis: in other news, SimonSapin hit the same HRTB+projection issue I did, but he's working on something in Servo
[15:11:45] <eddyb> nmatsakis: is there an open issue for it? I couldn't find one
[15:12:28] <SimonSapin> (well, the end goal is making some of Servo’s code, CSS selector matching, usable outside of Servo)
[15:16:34] <nmatsakis> eddyb: I don't think there's an issue. I just looked at the relevant code and it doesn't like a FIXME, just a comment: https://github.com/rust-lang/rust/blob/master/src/librustc/middle/traits/project.rs#L266-L276
[15:17:00] <nmatsakis> eddyb: you can probably just search-and-replace `{}` with `{:?}` and `.repr(...)` with `` :)
[15:17:12] <eddyb> nmatsakis: except that doesn't work
[15:17:27] <eddyb> I need to replace only the {} for which the argument used .repr()
[15:17:42] <eddyb> and I don't have a Rust IDE do it for me :D
[15:17:51] <nmatsakis> eddyb: I meant just replace them all
[15:18:09] <eddyb> terrible idea, user-facing output has to use {}
[15:18:18] <nmatsakis> I mean, at least in librustc/middle/traits, there is no user-facing output 
[15:18:22] <nmatsakis> maybe in error_reporting.rs
[15:18:23] <eddyb> maybe replacing all {} inside debug! might work
[15:18:31] <eddyb> nmatsakis: oh, on a file-by-file basis
[15:18:37] <nmatsakis> yes
[15:18:41] <nmatsakis> and inside a debug! is better still, yes
[15:18:48] * eddyb tries to find false positives
[15:19:30] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[15:20:33] <eddyb> there's a few of them
[15:24:24] <eddyb> nmatsakis: oh, inside a specific file I can just use the regular find&replace and skip the false positives manually
[15:30:18] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Connection closed)
[15:31:45] *** Joins: chc4 (chc4@moz-pdo0at.ma.comcast.net)
[15:37:10] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[15:37:15] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[15:42:32] *** Quits: chc4 (chc4@moz-pdo0at.ma.comcast.net) (Connection closed)
[15:42:56] *** Joins: chc4 (chc4@moz-pdo0at.ma.comcast.net)
[15:43:03] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[15:43:03] *** ChanServ sets mode: +ao erickt erickt
[15:46:12] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[15:50:15] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (Ping timeout: 121 seconds)
[16:01:07] <erickt> acrichto: actually this would be a better place since it's actually more of a rustc question. So quasiquoting and source location
[16:01:31] <erickt> right now in libsyntax's quote, it generates code that outputs "<quote expansion>" as the filename
[16:03:02] <erickt> have any ideas off hand of a better filename to use?
[16:05:00] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[16:07:57] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[16:08:41] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[16:08:56] *** Quits: doener (doener@moz-eku96m.hsi08.unitymediagroup.de) (Connection closed)
[16:10:23] <eddyb> erickt: the original source where the quote! invocation appears :D
[16:11:01] <acrichto> erickt: that's probably a fine filename, it may just need to avoid the source map somehow
[16:11:16] <erickt> that would be nice, but I'm not sure if I have that info
[16:12:34] <erickt> hm. does the ExtCtxt have the location of the current file getting parsed? maybe I could pull it out from that
[16:13:46] *** Joins: doener (doener@moz-eku96m.hsi08.unitymediagroup.de)
[16:15:31] <erickt> acrichto: are you getting these .d files with "rustc --emit dep-info ..."?
[16:15:40] <acrichto> erickt: yeah
[16:16:03] *** Quits: oli_obk__ (Mibbit@moz-7bq.0sb.52.141.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[16:16:47] <erickt> acrichto: and when you filed https://github.com/serde-rs/serde/issues/85, were you using nightly with libsyntax and plugins, or syntex?
[16:17:17] <acrichto> erickt: hm... I kinda forget :(
[16:17:23] <erickt> np
[16:17:30] <acrichto> erickt: it was originally derived from one of the linked cargo issues
[16:17:39] <acrichto> and I think I just checked out those projects and inspected the .d files
[16:18:36] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[16:19:35] <erickt> ok
[16:20:05] <erickt> I just checked quasi_macros, and it's not appearing to spit out "<quote expansion" in the .d files
[16:25:39] *** Quits: harrisonclarke (harrisoncla@moz-th044a.ns.bellaliant.net) (Connection closed)
[16:26:02] *** Joins: harrisonclarke (harrisoncla@moz-th044a.ns.bellaliant.net)
[16:26:59] *** Joins: oli_obk__ (Mibbit@moz-7bq.0sb.52.141.IP)
[16:27:48] *** Quits: harrisonclarke (harrisoncla@moz-th044a.ns.bellaliant.net) (Connection closed)
[16:29:54] *** Joins: eerie (eerie@moz-qld.8t4.67.109.IP)
[16:30:25] *** Joins: bdero (bran@moz-3au5rc.dyn.MIT.EDU)
[16:30:39] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[16:31:07] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[16:32:01] *** Quits: laumann (thomas@moz-poa.3kq.109.2.IP) (Ping timeout: 121 seconds)
[16:33:02] *** Quits: bdero1 (bran@moz-e4f4ei.mit.edu) (Ping timeout: 121 seconds)
[16:34:50] *** Joins: imperio (Mibbit@moz-8otf3a.fbx.proxad.net)
[16:35:12] <imperio> steveklabnik: ping again (I disconnected between)
[16:35:37] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Ping timeout: 121 seconds)
[16:35:55] <imperio> question: I created 5 PRs for adding error explanation, but wouldn't it be better if I have I regroup all them in one ?
[16:37:29] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[16:38:22] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[16:39:33] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: Textual IRC Client: www.textualapp.com)
[16:39:43] <mukilan> It looks like rustc generates memory access to the wrong address when accessing a DST struct's last field when it is misaligned. Is this a known bug? https://play.rust-lang.org/?gist=fcdeb47dbc05e243cfc6&version=nightly 
[16:39:52] <eddyb> mukilan: kinda
[16:40:10] <eddyb> mukilan: not sure it's been reported, but a few people know about it
[16:40:46] <eddyb> it's not a problem with, e.g. Rc<T> because it already has the maximum alignment (ignoring SIMD)
[16:40:57] <mukilan> eddyb: cool. i couldn't find an bug report as well
[16:41:12] <eddyb> there's two ways to fix it
[16:41:14] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[16:41:50] <eddyb> either add dynamic alignment computation or make DST-ready structures right-aligned before the DST field
[16:42:02] <eddyb> (or both, with the latter being opt-in)
[16:42:39] <eddyb> the latter also requires pointing at the DST field instead of the start of the structure
[16:43:32] <mukilan> eddyb: do you think I should file a bug? 
[16:43:39] <eddyb> sure
[16:46:30] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[16:47:47] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[16:48:27] *** Joins: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net)
[16:48:57] *** Quits: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP) (Ping timeout: 121 seconds)
[16:50:22] <eddyb> nmatsakis: there, done https://github.com/rust-lang/rust/pull/26351
[16:51:06] <eddyb> nmatsakis: any chance it can be reviewed before it rots again?
[16:53:04] <mukilan> eddyb: issue filed! https://github.com/rust-lang/rust/issues/26403
[16:56:35] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[16:57:14] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[16:57:33] <eddyb> mukilan: thanks :D
[16:57:50] <mukilan> eddyb: np :)
[16:59:11] <simukis> remind me, what do we call <Instance as Trait>::method() call syntax?
[16:59:59] <simukis> Was something along the lines of Unified Something Something Call syntax?
[17:00:01] <cmr> !ufcs
[17:00:01] <rustbot> Universal Function Call Syntax (Type::Method(type)) - https://doc.rust-lang.org/book/ufcs.html | https://github.com/rust-lang/rfcs/blob/master/text/0132-ufcs.md
[17:00:06] *** Joins: eerie_ (eerie@moz-qld.8t4.67.109.IP)
[17:00:08] <simukis> great!
[17:00:32] <benh> can't we just call it explicit member access or w/e
[17:00:49] <cmr> rust doesn't do members
[17:00:55] *** Quits: yjv (yjv@moz-j0cdis.fios.verizon.net) (Ping timeout: 121 seconds)
[17:00:57] <cmr> and because of traits, "member" doesn't make a lot of sense.
[17:00:57] <eddyb> s/member/associated
[17:01:06] *** Joins: pcwalton (pcwalton@moz-nh2.o1i.216.216.IP)
[17:01:06] *** ChanServ sets mode: +o pcwalton
[17:01:15] <eddyb> simukis: the technical term is "fully qualified associated path"
[17:01:17] <benh> traits have members!
[17:01:25] <eddyb> benh: they're associated items
[17:02:00] *** Quits: munksgaard (munksgaard@moz-bk8.2r1.225.130.IP) (Ping timeout: 121 seconds)
[17:02:28] *** Joins: yjv (yjv@moz-j0cdis.fios.verizon.net)
[17:02:46] *** Quits: eerie_ (eerie@moz-qld.8t4.67.109.IP) (Connection closed)
[17:02:56] *** Quits: eerie (eerie@moz-qld.8t4.67.109.IP) (Ping timeout: 121 seconds)
[17:03:07] <simukis> eddyb: I just needed that for https://github.com/rust-lang/rust/pull/26398/files#r32752484
[17:03:25] <simukis> I don’t care much about how it is called 😊
[17:03:36] <eddyb> bleah
[17:04:39] <eddyb> simukis: if the trait is imported from somewhere else, you can avoid importing both at once (and have `use` inside the e.g. function wanting one of the traits)
[17:05:02] <eddyb> simukis: but, yeah, fully qualified paths are the general solution
[17:06:19] *** Quits: oli_obk__ (Mibbit@moz-7bq.0sb.52.141.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[17:17:49] *** Joins: arielby (Mibbit@moz-gdrjsj.tau.ac.il)
[17:17:52] <simukis> https://github.com/rust-lang/rust/pull/26374#issuecomment-113219233 ← steveklabnik
[17:18:25] <eddyb> error: method `bar` has a `ByReferenceExplicitSelfCategory(ReLateBound(DebruijnIndex { depth: 1 }, BrAnon(0)), MutImmutable)` declaration in the impl, but not in the trait [E0185]
[17:18:26] <eddyb> oops
[17:18:42] <arielby> eddyb: yours
[17:18:55] <eddyb> my fault? yupp
[17:20:29] *** Joins: nham (nham@moz-lglsfe.il.comcast.net)
[17:27:12] <eddyb> pcwalton: r? https://github.com/rust-lang/rust/pull/26351
[17:27:52] <pcwalton> 8,000 line patch, eh
[17:27:58] <pcwalton> give me a little bit ;)
[17:28:17] <eddyb> pcwalton: most of it is stuff like s/.repr()//
[17:28:19] <pcwalton> (is this for parallel compilation)?
[17:28:27] <nmatsakis> eddyb: hey :) I'll review it if you want, gimme a sec
[17:28:40] <eddyb> I think you should fork-join the review
[17:29:33] <pcwalton> eddyb: I assume this is prereq work for parallel typechecking?
[17:29:35] <pcwalton> or parallel trans
[17:29:45] *** chmanchester is now known as chmanchester|afk
[17:30:11] *** Joins: harrisonclarke (harrisoncla@moz-6v8.jf9.227.142.IP)
[17:30:13] <eddyb> pcwalton: maybe in the farther future, though the global/local split is for keeping inference by-products confined to the typeck of individual functions
[17:30:29] <pcwalton> ah, what is the reason for that?
[17:30:36] <eddyb> pcwalton: last I checked they accounted for 90% of all type-related allocations
[17:30:46] <pcwalton> (I can think of several but I wanted to know which you had in mind)
[17:30:52] <pcwalton> ah, OK, performance/memory use then
[17:31:27] <eddyb> nmatsakis and jroesch might have other reasons, they're also discussing it, or so I hear :)
[17:32:33] *** Quits: pcwalton (pcwalton@moz-nh2.o1i.216.216.IP) (Client exited)
[17:32:54] <eddyb> nmatsakis: did I scare him off? :P
[17:33:04] <jroesch> haha
[17:34:01] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Connection closed)
[17:34:43] <eddyb> test result: ok. 1766 passed; 0 failed; 11 ignored; 0 measured
[17:34:58] <nmatsakis> eddyb: ok so I read the important bits :) I'm wondering, in what cases (if any) does the output of user_string() differ?
[17:35:12] <eddyb> nmatsakis: none AFAIK
[17:35:41] <eddyb> the output of fmt::Debug differs a bit in a few places
[17:35:58] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[17:36:00] <eddyb> if the Repr impl was close enough to the auto-derived one I just removed the Repr impl
[17:36:06] <nmatsakis> eddyb: that's fine
[17:36:15] <nmatsakis> eddyb: I don't much care about the output of Debug 
[17:36:18] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[17:36:34] <eddyb> nmatsakis: Fn<NonTuple> will be different
[17:36:47] <eddyb> that's the only one I can recall
[17:36:56] <eddyb> it will print Fn<T> instead of Fn(T)
[17:36:59] <Manishearth> edunham: +1 on your discourse avatar
[17:37:08] <eddyb> (which is arguably the correct form)
[17:37:21] <edunham> Manishearth: thanks :)
[17:37:35] <nmatsakis> eddyb: why was this commit necessary https://github.com/eddyb/rust/commit/24457331c80e713bf0ac18a84edc57ccb99150b7
[17:37:45] <edunham> i also registered https://github.com/rustacean for testing gh bots without spamming the real ones
[17:37:51] <eddyb> nmatsakis: so I can have the tcx in the TLS
[17:37:59] <nmatsakis> oh of course duh
[17:37:59] <nmatsakis> ok
[17:38:14] <nmatsakis> well, it's not strictly needed, but it helps **ensure** that it will be there
[17:38:18] <eddyb> nmatsakis: the commits are not perfectly ordered
[17:38:36] <eddyb> the one with the tls::enter definition makes more sense
[17:39:15] <nmatsakis> eddyb: r+ https://github.com/rust-lang/rust/pull/26351#issuecomment-113231575
[17:39:56] *** Quits: summerlight_ (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[17:39:57] <eddyb> whoa, thanks
[17:40:48] <nmatsakis> eddyb: seems...fast, but from what I could tell, this seemed to be a fairly shallow change..? (modulo the move from `.repr(tcx)` to `{:?}` of course)
[17:41:06] <nmatsakis> the idea of "lifting" to an Option<Foo<'tcx>> is cute
[17:41:37] <eddyb> nmatsakis: a lot of it was mechanical, yes, but there are very few temporary strings now in ppaux
[17:42:02] <eddyb> the only ones created "with intent" are for regions, which can produce "" and that needs to be detected
[17:42:07] <nmatsakis>  I didn't review the actual changes to ppaux so I'm just sort of trusting you on that ;)
[17:42:20] <eddyb> it worked out better than I had hoped
[17:42:25] <nmatsakis> or, that is, I skimmed them
[17:42:32] <eddyb> and I came up with a start_or_continue trick for sequences
[17:43:14] <eddyb> (sequences with multiple sources. if it just came from an iterator, I used `if let Some(elem) = iter.next()` to handle the first element specially)
[17:43:29] <jroesch> eddyb: when those changes are in master can you give me a heads up? I would like to merge them into my branch
[17:43:39] <eddyb> will do
[17:44:10] * nmatsakis can't wait to rebase over this
[17:44:11] <nmatsakis> ;)
[17:44:17] <nmatsakis> actually I have been more and more annoying by ppaux
[17:44:21] <nmatsakis> *annoyed
[17:46:04] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[17:47:17] <arielby> nmatsakis: what should be done with gh26147?
[17:47:18] <[o__o]> A few fixes for associated types: https://github.com/rust-lang/rust/pull/26147
[17:48:50] <nmatsakis> arielby: Hmm, I have to consider your latest comment -- in particular, consider_unification_despite_ambiguity should just never arise in trans, so perhaps you are correct that it's ok, but it's certainly subtle.
[17:49:18] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[17:49:23] <nmatsakis> arielby: at least adding a comment to that effect is definitely a good idea :)
[17:49:40] <arielby> nmatsakis: I think it can occur
[17:49:46] <arielby> if there is a "race"
[17:50:02] <arielby> during fulfillment
[17:50:45] <arielby> I mean, if the projection predicate is in the fulfillment list but wasn't yet processed
[17:50:58] <arielby> we just have to make it harmless through
[17:53:40] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[17:54:07] *** Quits: zeiris (dan@moz-8jbmam.letter.agency) (Ping timeout: 121 seconds)
[17:55:27] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[17:56:10] *** Joins: zeiris (dan@moz-8jbmam.letter.agency)
[17:56:18] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Connection closed)
[17:57:05] *** Joins: Jesin (Jesin@moz-4jre1i.eecs.lehigh.edu)
[17:57:42] <eddyb> nmatsakis: is this good? https://github.com/eddyb/rust/commit/a4fef22ccaec5288eff6f3f76110b9a396a07edb
[17:59:19] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[18:01:33] <eddyb> (feel free to r- if not and I'm not around)
[18:02:05] *** Joins: graydon (Adium@moz-jbr.dr1.172.69.IP)
[18:03:24] *** Joins: eerie (eerie@moz-qld.8t4.67.109.IP)
[18:05:08] <arielby> nmatsakis: why is gh26279 T-lang?
[18:05:08] <[o__o]> nightly rustc breaks stable code for some type inferences: https://github.com/rust-lang/rust/issues/26279
[18:06:09] <arielby> given that the problem is the new extend implementation?
[18:06:41] <arielby> I mean, the impl<'a, T> Extend<&'a T> for Vec<T> where T: Copy + 'a
[18:07:17] *** Quits: ytain (ytain@moz-p96068.dsl.teksavvy.com) (Quit: Textual IRC Client: www.textualapp.com)
[18:07:22] <eddyb> x86_64-unknown-linux-gnu/stage0/test/rustc_drivertest-x86_64-unknown-linux-gnu: symbol lookup error: /home/eddy/Projects/rust/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libfmt_macros-d8ace771.so: undefined symbol: _ZN3fmt10char.Debug3fmt20h9867a7f24c208c374INE
[18:07:22] <cmr> I think it's even allowed as a breaking change by the API evolution RFC, since it's fixable by UFCS.
[18:07:31] *** Quits: eerie (eerie@moz-qld.8t4.67.109.IP) (Ping timeout: 121 seconds)
[18:07:46] <eddyb> acrichto: make check-stage0-rustc_driver doesn't work
[18:07:58] <eddyb> acrichto: but running the binary manually does (no env vars)
[18:09:13] <eddyb> acrichto: if I prepend env LD_LIBRARY_PATH=/home/eddy/Projects/rust/x86_64-unknown-linux-gnu/stage1/lib - then it stops working
[18:09:26] <arielby> eddyb: you got a dynamic stage0
[18:09:36] <eddyb> no
[18:09:40] <eddyb> I'm using the snapshot
[18:09:40] <arielby> try ldd x86*/stage0/bin/rustc
[18:09:51] <eddyb> arielby: no, check-stage0 never worked
[18:10:07] <eddyb> or rarely so. it only exists because of a for loop which creates it alongside everything else
[18:10:28] <eddyb> and apparently it doesn't work because it uses the wrong LD_LIBRARY_PATH
[18:11:10] <eddyb> arielby: it's trying to run:
[18:11:12] <eddyb> LD_LIBRARY_PATH=/home/eddy/Projects/rust/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib:$LD_LIBRARY_PATH  x86_64-unknown-linux-gnu/stage0/test/rustc_drivertest-x86_64-unknown-linux-gnu
[18:11:42] *** chmanchester|afk is now known as chmanchester
[18:11:55] <eddyb> arielby: the stage1 in that LD_LIBRARY_PATH should be stage0
[18:12:46] <eddyb> if check-stage0-std works, well, I know a lot of people who modify libstd and wait for rustc to compile to run the tests :P
[18:13:13] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[18:14:10] <eddyb> not to mention that travis could run those tests
[18:14:42] <eddyb> acrichto: sync::mutex::tests::test_mutex_arc_access_in_unwind failed, but everything else looks functional
[18:15:55] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[18:17:28] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[18:17:28] *** ChanServ sets mode: +o pcwalton
[18:18:06] <nmatsakis> arielby: I don't know I was wondering the same :) perhaps issues are (almost) always T-compiler, and RFCs (almost) always T-lang
[18:18:41] <arielby> sounds like P-errata T-libs for me
[18:18:47] <cmr> I agree, seems like a T-libs
[18:19:01] <arielby> and P-errata, not P-high
[18:20:28] *** Joins: dinfuehr (dinfuehr@moz-12m21g.highway.telekom.at)
[18:23:27] <eddyb> LD_LIBRARY_PATH_ENV_TARGETDIR$(1)_T_$(2)_H_$(3) := $$(CURDIR)/$$(TLIB1_T_$(2)_H_$(CFG_BUILD))
[18:23:29] <eddyb> wtf
[18:23:48] <eddyb> that's saying that all test should run with LD_LIBRARY_PATH set to stage1
[18:24:04] <eddyb> wouldn't that break stage2 tests? or are they statically linked?
[18:24:50] <eddyb> yupp, check-stage0 starts working if I replace 1 with $(1) there
[18:26:30] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[18:29:36] *** Quits: imperio (Mibbit@moz-8otf3a.fbx.proxad.net) (Quit: http://www.mibbit.com ajax IRC Client)
[18:31:37] * eddyb has grown fond of the online github editor
[18:36:49] *** Quits: oli_obk (smuxi@moz-q7vqj2.clients.your-server.de) (Connection closed)
[18:45:21] *** Joins: ker (smuxi@moz-q7vqj2.clients.your-server.de)
[18:46:33] *** ker is now known as oli_obk
[18:49:27] *** Quits: mukilan (mukilan@moz-b2t.h6f.164.122.IP) (A TLS packet with unexpected length was received.)
[18:49:55] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[18:49:56] *** ChanServ sets mode: +o brson
[18:49:59] <arielby> nmatsakis: gh26147 updated
[18:49:59] <[o__o]> A few fixes for associated types: https://github.com/rust-lang/rust/pull/26147
[18:50:32] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[18:52:35] *** Quits: harrisonclarke (harrisoncla@moz-6v8.jf9.227.142.IP) (Connection closed)
[18:52:48] *** Quits: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net) (Ping timeout: 121 seconds)
[18:52:59] *** Joins: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net)
[18:53:37] <kimundi> Heh, good cite from #rust: <dfockler> Rust is like screaming into the void, and the void screams back "a's lifetime doesn't last long enough"
[18:54:41] <aturon> brson: ^ twir material :)
[18:54:42] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[18:54:54] <cmr> Put it on the discourse thread!
[18:58:53] <brson> thanks
[19:03:57] <arielby> nmatsakis: I was somewhat mistaken about consider_unification_despite_ambiguity
[19:04:04] <arielby> the case I was afraid of can't really happen in practice
[19:04:09] *** Joins: eerie (eerie@moz-qld.8t4.67.109.IP)
[19:04:27] <arielby> because ty_closure: Fn is only ambiguous if the closure kind is uncertain
[19:04:39] <nmatsakis> arielby: so I'm trying to figure out when this fix "kicks in"
[19:04:45] <nmatsakis> I guess I should read the test case
[19:04:59] <arielby> nmatsakis: the consider_unification_despite_ambiguity wasn't the whole fix
[19:05:04] <arielby> (of course)
[19:05:42] <nmatsakis> but what role does it play then, if closure arg types should already be normalized during typeck, and this code is only entered during typeck
[19:06:08] <nmatsakis> or is it just that
[19:06:08] <arielby> I didn't realize that ty_closure: Fn can only be ambiguous because of the closure kind
[19:06:25] <nmatsakis> you changed the closure_trait_ref fn,
[19:06:29] <nmatsakis> that is, its signature,
[19:06:32] <nmatsakis> and that led to this fallout
[19:06:36] <arielby> nmatsakis: yes
[19:06:51] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[19:06:59] <arielby> that's what happened
[19:07:04] <arielby> then I changed project to match
[19:07:05] <nmatsakis> does that argue for extracting a `unnoramlized_closure_trait_ref` and calling that?
[19:07:05] <arielby> select
[19:07:14] <nmatsakis> seems like it might :)
[19:07:21] <nmatsakis> (with a comment explaining why it is ok)
[19:07:35] <arielby> nmatsakis: closure_trait_ref should always be normalized
[19:07:38] <nmatsakis> it's more or less the same as calling normalize and ignoring the projections, but ... somehow feels clearer to me
[19:07:49] <nmatsakis> well, didn't we just say that in this particular path, normalization should be a no-op?
[19:08:07] <arielby> yes
[19:08:13] *** Quits: eerie (eerie@moz-qld.8t4.67.109.IP) (Ping timeout: 121 seconds)
[19:08:28] <arielby> so maybe
[19:08:42] <arielby> maybe add a comment to that effect?
[19:09:01] <nmatsakis> well I'm saying that if we have two fns,
[19:09:10] <nmatsakis> it avoids doing work that we believe is a no-op,
[19:09:23] <nmatsakis> it does (I think) still require a comment explaining why it's ok to call the unnormalized variant
[19:10:06] <arielby> sounds like a good idea
[19:10:53] <nmatsakis> (I think the normalizing variant would call the unnormalized one, and then normalized the result...and I would make the normalizing one be called "closure_trait_ref", since it's the "safer, more correct" variant)
[19:13:35] <arielby> nmatsakis: I am afraid of someone managing to implement Fn(WrongInput) for a closure somehow
[19:14:01] <arielby> is that always impossible?
[19:14:24] <arielby> and will stay impossible after we get anonymized return types?
[19:14:40] <nmatsakis> arielby: I dont' quite follow what WrongInput signifies here, sorry
[19:14:50] <arielby> some input type other than the closure's real one
[19:15:16] *** Quits: zeiris (dan@moz-8jbmam.letter.agency) (Ping timeout: 121 seconds)
[19:15:27] <arielby> while we are processing projections, there may be still a TyInfer in the closure substs
[19:15:35] <arielby> which could lead to an ambiguity with that impl in trans
[19:15:44] <arielby> (which of course will be resolved after we process the projection)
[19:16:22] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[19:17:04] *** Joins: zeiris (dan@moz-8jbmam.letter.agency)
[19:20:54] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[19:21:08] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[19:21:24] *** Quits: zeiris (dan@moz-8jbmam.letter.agency) (Ping timeout: 121 seconds)
[19:22:19] *** Joins: zeiris (dan@moz-8jbmam.letter.agency)
[19:23:37] <eddyb> ../src/librustdoc/clean/mod.rs:525         let mut sized_bound = ty::BuiltinBound::BoundSized.clean(cx);
[19:23:46] <eddyb> the *one time* I don't compile rustdoc
[19:24:57] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Ping timeout: 121 seconds)
[19:24:57] <arielby> eddyb: I have a script that runs all tests
[19:25:12] <arielby> and prints a red error if they fail
[19:25:16] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (Ping timeout: 121 seconds)
[19:29:32] *** Quits: dinfuehr (dinfuehr@moz-12m21g.highway.telekom.at) (Connection closed)
[19:31:34] *** Quits: untitaker (untitaker@moz-mc32k8.highway.telekom.at) (Ping timeout: 121 seconds)
[19:32:57] *** Joins: sigma (sigma@moz-uqk2kb.range86-146.btcentralplus.com)
[19:34:33] *** Joins: untitaker (untitaker@moz-98e4cr.highway.telekom.at)
[19:35:17] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[19:35:22] *** Quits: graydon (Adium@moz-jbr.dr1.172.69.IP) (Quit: Leaving.)
[19:42:18] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[19:42:35] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[19:47:42] *** Quits: blank_name (blank_name@moz-p4egrb.mi.frontiernet.net) (Quit: leaving)
[19:48:53] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Connection closed)
[19:49:30] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[19:49:30] *** ChanServ sets mode: +o brson
[19:49:38] *** Joins: blank_name (blank_name@moz-p4egrb.mi.frontiernet.net)
[19:51:02] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[19:55:21] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[19:55:27] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[19:56:19] *** chmanchester is now known as chmanchester|afk
[19:56:24] <brson> acrichto: unless you are already on it i'll finish the backports today and do a build
[20:01:03] *** Quits: zeiris (dan@moz-8jbmam.letter.agency) (Ping timeout: 121 seconds)
[20:01:34] *** Joins: yjv_ (yjv@moz-j0cdis.fios.verizon.net)
[20:01:55] <nmatsakis> arielby: I don't...know how someone could manage to implement Fn(WrongInput) -- it seems impossible to me, yes.
[20:01:59] *** Joins: zeiris (dan@moz-8jbmam.letter.agency)
[20:02:30] *** Joins: mib_nlu3ju (Mibbit@moz-hu6.nja.252.72.IP)
[20:03:07] *** Quits: semarie (semarie@moz-a523dr.bpv6.bg1u.41d0.2001.IP) (Ping timeout: 121 seconds)
[20:03:25] *** Quits: yjv (yjv@moz-j0cdis.fios.verizon.net) (Ping timeout: 121 seconds)
[20:04:21] *** Joins: genbattle (genbattle@moz-4v0.gkd.16.182.IP)
[20:04:47] <arielby> nmatsakis: I will push it in a moment
[20:05:06] <arielby> pushed
[20:05:10] *** Joins: eerie (eerie@moz-qld.8t4.67.109.IP)
[20:06:01] *** Quits: bdero (bran@moz-3au5rc.dyn.MIT.EDU) (Ping timeout: 121 seconds)
[20:07:59] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Quit: Leaving)
[20:08:11] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[20:09:15] *** Quits: eerie (eerie@moz-qld.8t4.67.109.IP) (Ping timeout: 121 seconds)
[20:10:01] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[20:14:05] *** Quits: sigma (sigma@moz-uqk2kb.range86-146.btcentralplus.com) (Ping timeout: 121 seconds)
[20:20:29] *** Quits: arielby (Mibbit@moz-gdrjsj.tau.ac.il) (Quit: http://www.mibbit.com ajax IRC Client)
[20:22:16] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[20:26:42] *** Quits: burntsushi (burntsushi@moz-t92kn9.ma.charter.com) (Ping timeout: 121 seconds)
[20:26:57] *** Joins: burntsushi (burntsushi@moz-t92kn9.ma.charter.com)
[20:27:07] <acrichto> brson: be my guest!
[20:27:17] <nrc> acrichto: so, I have a Path p, when I do p.to_str() I get "/home/ncameron/rust3/src/../src/liballoc/lib.rs". What I want is the 'normalised' version, getting rid of the `src/..` in the middle. Is there a way to do that for Paths?
[20:30:45] <brson> aturon: i need you to review these relnotes https://github.com/rust-lang/rust/pull/26200
[20:30:48] <eternaleye> nrc: Not out of the box, though you could likely do it using .components() and .peek()
[20:30:53] <brson> please
[20:31:05] *** Quits: Sho_ (sho@moz-aig7ns.cust.telecolumbus.net) (Quit: Konversation terminated!)
[20:31:07] <aturon> brson: oy, sorry! will do immediately.
[20:31:17] <eternaleye> nrc: The thing is that on some systems, actually traversing .. puts you somewhere other than the syntactic result
[20:31:19] <nrc> brson: talking of which, did you see email with build times?
[20:31:24] <eternaleye> nrc: Consider symlinks to directories
[20:31:47] <aturon> nrc: ooh, can i get a copy of that? i was going to ask you about that, since we'd like to talk about perf improvements in the release announcement as well
[20:31:51] <nrc> eternaleye: yuck
[20:32:00] <nrc> aturon:  sure, I'll forward
[20:32:11] <brson> nrc: ah, yeah thanks for the reminder. i'll incorporate that into the highlights
[20:32:12] <eternaleye> nrc: So there's syntactic canonicalization, and semantic canonicalization. The latter requires asking the OS.
[20:33:05] <eternaleye> nrc: Now, that can be done via realpath(3) http://man7.org/linux/man-pages/man3/realpath.3.html
[20:33:22] <eternaleye> nrc: So if you want that, it's almost certainly in the libc crate
[20:34:09] <eternaleye> nrc: What do you actually want the path for, though?
[20:34:11] <aturon> acrichto: nmatsakis: your teams have some beta-nominated issues: https://github.com/rust-lang/rust/pulls?q=is%3Apr+label%3Abeta-nominated
[20:34:23] <aturon> acrichto: nmatsakis: brson needs to know the decision on these ASAP
[20:34:37] <eternaleye> nrc: If you're going to be opening it at any point, then you almost certainly want semantic canonicalization
[20:34:49] <eternaleye> nrc: But if it's never presented to the user, than why canonicalize at all?
[20:35:04] <eternaleye> nrc: (since the OS does semantic canonicalization on open)
[20:35:56] <nmatsakis> aturon: hmm yes do I have license to decide this unilaterally if it seems unambiguous?
[20:35:58] <eternaleye> *then
[20:36:07] <aturon> nmatsakis: yeah
[20:36:40] <brson> i've updated relnotes with a highlight of a 32% bootstrap improvement
[20:37:02] <nmatsakis> brson: nice
[20:37:28] <aturon> brson: i left one minor nit, otherwise r+ on relnotes
[20:37:52] <nmatsakis> nrc: thoughts on https://github.com/rust-lang/rust/pull/26038 being backported? I'm of two minds
[20:38:00] <aturon> nrc: i'd also be curious to hear of the perf difference between 1.1 and nightly
[20:38:52] <nmatsakis> brson: aturon: what is the deal with backporting, do I have to prepare the PR? :) 
[20:39:11] <nmatsakis> sorry, not been keeping up with those tags as well as I should
[20:39:14] <nmatsakis> I need a checklist for triage 
[20:39:19] * nmatsakis bad
[20:39:27] <nmatsakis> anyway https://github.com/rust-lang/rust/pull/26062 seems like a pretty safe bet
[20:39:56] <brson> nmatsakis: just tag it beta-accepted and i'll do the backport today
[20:40:04] <nmatsakis> brson: ok I did that already
[20:40:06] <acrichto> nrc: how do you feel about backporting https://github.com/rust-lang/rust/pull/26347
[20:43:29] <brson> git says https://github.com/rust-lang/rust/pull/26062/commits has already been picked ...
[20:44:05] <acrichto> brson: oh I may have backported that by accident?
[20:44:10] <acrichto> I thought that was already accepted
[20:44:24] <brson> indeed it han
[20:44:27] <brson> *has
[20:44:31] <brson> nbd
[20:50:06] <nrc> aturon: sure, give me a little while
[20:50:13] *** Quits: zeiris (dan@moz-8jbmam.letter.agency) (Ping timeout: 121 seconds)
[20:51:23] *** Joins: bdero (bran@moz-0e2lk5.sns9.e6pb.0197.2601.IP)
[20:51:32] <nrc> eternaleye: the path is getting saved to a file for use by another tool, I guess the tool should probably be canonicalising. It never actually opens the file though and may not even have access to the disk with the file on, so I think it makes more sense for the compiler to do the canonicalisation
[20:52:00] *** Joins: zeiris (dan@moz-8jbmam.letter.agency)
[20:52:33] <nrc> nmatsakis: yeah, I'm really not sure on that. It fixes a regression, but not an ICE, so I'm inclined to say its not worth the risk
[20:52:46] *** Joins: Astrum|Lap_ (Astrum|Lap@moz-7enfbr.co.comcast.net)
[20:52:49] <nrc> then again its small and useful...
[20:52:59] <nmatsakis> nrc: I guess the question is how risky it is
[20:53:10] <nmatsakis> nrc: the main reason I wasn't sure is that the regression is in stuff that's only sort of "semi-stable"
[20:53:13] <nrc> acrichto: I'm in favour of backporting that
[20:53:29] <acrichto> nrc: brson: ok cool, let's backport 26347 then
[20:53:47] <acrichto> tag added
[20:53:57] <nmatsakis> nrc: I guess it depends on whether we're announcing "DST coercions" as a feature of 1.1 :)
[20:54:37] <nrc> nmatsakis: right. My feeling is that it is fairly low risk
[20:54:45] <eternaleye> nrc: What I mean is that canonicalization should *only* be done if the path is presented to a human
[20:54:57] *** Quits: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net) (Ping timeout: 121 seconds)
[20:54:57] *** Astrum|Lap_ is now known as Astrum|Lap
[20:55:01] <eternaleye> nrc: Because actually opening the file *does the semantic canonicalization*
[20:55:17] <nrc> I'd err on the side of not doing that - if we could feature gate we would have, so it would not be available yet
[20:55:21] <nrc> nmatsakis: ^
[20:55:26] <eternaleye> nrc: So on presenting it to a human, realpath(3) should be used, so the human's expectations match reality
[20:55:42] <nrc> I would leave announcing until we stabilise the trait, and not backport that PR
[20:55:49] <nmatsakis> nrc: ok I tend to agree
[20:56:00] <brson> nrc: what trait don't you want to announce?
[20:56:08] <brson> UnsizeCoerce?
[20:56:15] <nrc> eternaleye: a human never sees the path though - only a tool
[20:56:15] <brson> or whatever
[20:56:16] <nmatsakis> brson: right, it's marked as unstable 
[20:56:21] <nrc> brson: yep
[20:56:22] <eternaleye> nrc: Exactly
[20:56:31] <eternaleye> nrc: And thus, it should *not* try to canonicalize it.
[20:56:32] <brson> nrc: I have a highlight about DST coercions
[20:56:44] <brson> nrc: it doesn't explicitly mention the traits. should i remove the highlight if it's not fully baked?
[20:56:45] <nmatsakis> brson: for 1.1 or 1.2?
[20:57:01] <brson> nmatsakis: 1.1. the highlight says that putting [T] in a smart poniter works now
[20:57:05] <eternaleye> nrc: Because that would change the meaning of the path (for semantic canonicalization, the only kind possible without the FS)
[20:57:11] <brson> and linkes to the dst coercion rfc
[20:57:15] <eternaleye> er, syntactic
[20:57:16] <nrc> eternaleye: it needs to - it is using the path as a key into a hashmap and it gets the path in different forms
[20:57:27] <eternaleye> nrc: ewwwwww
[20:57:40] <eternaleye> nrc: In that case, you're between Scylla and Charybdis.
[20:58:06] <nrc> brson: hmm, I would hold off on that until 1.2
[20:58:14] <brson> nrc: ok
[20:58:18] <nmatsakis> I agree:)
[20:58:21] * nmatsakis outtyped
[20:58:25] <eternaleye> nrc: Unless the hashmap is only in the same case where you *do* have FS access
[20:58:40] <eternaleye> nrc: In which case realpath(3) is the right choice
[20:58:49] *** Quits: mib_nlu3ju (Mibbit@moz-hu6.nja.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[20:59:04] <nrc> Rc<[T]> technically worked before, its just creating them that didn't and now creating them *mostly* works. I'd hold off until it properly works
[20:59:04] <brson> so fyi the three highlights for 1.1 i have are: std::fs, expanded error descs, compile perf improvements
[20:59:25] <eternaleye> nrc: But any canonicalization beyond what Rust already does (// -> /, /./ -> /) requires the FS be available to avoid introducing some *nasty* potential bugs
[20:59:31] <nrc> eternaleye: the hashmap thing happens when I don't have access to the file systems
[20:59:34] <eternaleye> nrc: Which might be security bugs, considering ..
[21:00:02] <nrc> so this implies I really should do the canonicalisation while I can
[21:00:10] <nrc> not in the tool
[21:00:51] *** Joins: arielb1 (Ariel@moz-1uf694.red.bezeqint.net)
[21:01:48] <brson> nmatsakis nrc: so no backport for gh26038 right?
[21:01:48] <[o__o]> Allow nested generics for the last field of structs in unsizing.: https://github.com/rust-lang/rust/pull/26038
[21:01:59] <nrc> correct
[21:02:07] *** Joins: yjv (yjv@moz-j0cdis.fios.verizon.net)
[21:03:27] *** Quits: yjv_ (yjv@moz-j0cdis.fios.verizon.net) (Ping timeout: 121 seconds)
[21:04:23] <aturon> nrc: i'm pretty surprised at the 32% bump from 1.0 to 1.1 -- have we been backporting that much of the perf work since 1.1 beta on may 15th?
[21:04:43] <brson> acrichto: oh, heh. that pr i said was already cherry-picked earlier wasn't really. i had just already cherry-picked it into my branch and forgotten
[21:04:52] <acrichto> brson: ah
[21:04:54] <nrc> aturon: that wouldn't include backports, and I don't think we did backport any perf work
[21:05:12] <nrc> aturon there were a couple of big drops in compile time in that period
[21:05:48] <aturon> nrc: ah, the period between the final beta and 1.0?
[21:05:53] <nrc> one was due to arielb1 fixing some trait thing (my memory fails to be more precise), I never figured out what the other was due to
[21:06:21] <nrc> between 1.0 and 1.1 - i.e., between 1st April and 15th May
[21:06:26] <nrc> on master
[21:06:50] <aturon> nrc: ok, thanks for clarifying! excited to see what's happened since then :D
[21:07:40] <brson> acrichto: r? https://github.com/rust-lang/rust/pull/26409
[21:08:39] * acrichto merges
[21:09:18] <nrc> eternaleye: what do you mean by realpath(3) ?
[21:09:53] *** Joins: graydon (Adium@moz-jbr.dr1.172.69.IP)
[21:10:04] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[21:11:41] <brson> 1.1.0-beta.4 is building
[21:11:45] <aturon> brson: \o/
[21:12:11] <cmr> nrc: man 3 realpath
[21:12:45] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[21:12:58] <nrc> oh right, is there API to get that from within Rust?
[21:14:06] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Ping timeout: 121 seconds)
[21:14:22] <brson> restarting mac3 and mac4
[21:14:29] * brson grumble grumble
[21:15:10] <nrc> cmr, eternaleye ^^^
[21:15:38] <cmr> nrc: beyond FFI? I don't know.
[21:16:01] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[21:17:02] <nrc> hmm, sadness
[21:17:19] *** Quits: zeiris (dan@moz-8jbmam.letter.agency) (Ping timeout: 121 seconds)
[21:18:19] *** Joins: zeiris (dan@moz-8jbmam.letter.agency)
[21:19:38] <eddyb> nrc: grep the stdlib? :D
[21:20:14] <eddyb> nrc: src/libstd/sys/unix/fs.rs-pub fn canonicalize(p: &Path) -> io::Result<PathBuf> {
[21:20:16] <eddyb> this calls realpath
[21:20:53] <nrc> ah nice
[21:27:35] *** Quits: bdero (bran@moz-0e2lk5.sns9.e6pb.0197.2601.IP) (Ping timeout: 121 seconds)
[21:29:21] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[21:32:58] *** Quits: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net) (Ping timeout: 121 seconds)
[21:40:05] *** Quits: zeiris (dan@moz-8jbmam.letter.agency) (Ping timeout: 121 seconds)
[21:40:21] *** Joins: zeiris (dan@moz-8jbmam.letter.agency)
[21:41:45] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[21:42:04] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[21:42:42] *** Joins: ConnorDo_ (ConnorDoyle@moz-70n.7f4.118.12.IP)
[21:43:34] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[21:43:37] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[21:45:49] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (Ping timeout: 121 seconds)
[21:46:03] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[21:48:37] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[21:51:21] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Connection closed)
[21:52:41] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[21:54:45] *** Joins: bdero (bran@moz-0e2lk5.sns9.e6pb.0197.2601.IP)
[21:56:07] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[21:56:44] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Ping timeout: 121 seconds)
[21:57:45] *** Quits: vmx (vmx@moz-f4uhap.pools.vodafone-ip.de) (Quit: Leaving)
[22:02:01] *** Joins: yjv_ (yjv@moz-j0cdis.fios.verizon.net)
[22:02:08] *** Quits: zeiris (dan@moz-8jbmam.letter.agency) (Ping timeout: 121 seconds)
[22:02:40] *** Joins: zeiris (dan@moz-8jbmam.letter.agency)
[22:04:04] *** Quits: yjv (yjv@moz-j0cdis.fios.verizon.net) (Ping timeout: 121 seconds)
[22:05:12] *** Joins: James_ (quassel@moz-g7un1m.range86-163.btcentralplus.com)
[22:08:10] *** Quits: zeiris (dan@moz-8jbmam.letter.agency) (Ping timeout: 121 seconds)
[22:08:27] *** Joins: zeiris (dan@moz-8jbmam.letter.agency)
[22:11:37] *** Quits: ConnorDo_ (ConnorDoyle@moz-70n.7f4.118.12.IP) (Ping timeout: 121 seconds)
[22:12:38] *** Joins: ConnorDoyle (ConnorDoyle@moz-q1ne35.PUBLIC.monkeybrains.net)
[22:13:06] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[22:14:01] <gsingh93> i think i might have run into a parallel codegen bug when building the compiler
[22:14:36] <eternaleye> nrc: realpath(3) is the man page convention
[22:14:45] <huon> nrc: gsingh93 ^
[22:14:49] <eternaleye> nrc: Of saying "the man page for the realpath function is in section 3 (libc functions)
[22:14:51] <eternaleye> :
[22:15:02] *** Quits: ConnorDoyle (ConnorDoyle@moz-q1ne35.PUBLIC.monkeybrains.net) (A TLS packet with unexpected length was received.)
[22:15:10] <nrc> gsingh93: please tell
[22:15:11] *** Joins: summerlight (summerlight@moz-99k.2mj.130.121.IP)
[22:15:17] <nrc> eternaleye: cool, thanks!
[22:15:21] <eternaleye> nrc: char *realpath(const char *path, char *resolved_path);
[22:15:51] <eternaleye> nrc: Also, it *is* thread-safe
[22:16:14] <gsingh93> nrc: i was working on some changes in typeck, and i ran into some strange LLVM errors. I then stashed all my changes and tried and got the same LLVM error, then I removed the codegen units flag and it worked
[22:16:30] <gsingh93> nrc: here's the error: http://pastebin.com/J1HgnXgr
[22:16:46] <eternaleye> nrc: On Linux, resolved_path=NULL makes it work more like asprintf (allocate and return buffer)
[22:17:05] <gsingh93> i'm assuming you've tested this on a clean build of the compiler, so maybe it has something to do with the fact that this wasn't a clean build?
[22:17:27] <eternaleye> nrc: POSIX.1-2001 says that resolved_path=NULL is undefined, but POSIX.1-2008 pins it down to the allocating behavior
[22:17:54] <eternaleye> nrc: Er, implementation-defined, not undefined
[22:18:32] <eternaleye> nrc: see the BUGS section of the manpage for more info
[22:18:41] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[22:19:07] <nrc> gsingh93: eek, yeah, that seems like a problem. If you go back to using codegen_units, does the problem come back?
[22:19:20] <gsingh93> yea, i just retried with the codegen units, it comes back
[22:19:32] <eternaleye> nrc: There's also the GNU extension char *canonicalize_file_name(const char *path), defined as equal to realpath(path, NULL) in the 2008 form
[22:20:12] *** Joins: njn_ (chatzilla@moz-0ah9lm.iinet.net.au)
[22:20:26] *** njn_ is now known as njn
[22:20:29] <nrc> gsingh93: and that is without your changes?
[22:20:33] <gsingh93> nrc: yup
[22:21:28] <nrc> gsingh93: are you using codegen_units for a stage 1 build or just for stage 2?
[22:21:37] <gsingh93> stage 1
[22:22:05] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[22:22:44] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[22:23:43] <nrc> gsingh93: codegen_units is currently only bug free at stage 2. However, this bug seems orthogonal to any of the known stage 1 bugs
[22:24:16] <nrc> gsingh93:  could you look at your obj dir please, something like rust/x86_64-unknown-linux-gnu/stage1/lib
[22:24:54] <gsingh93> nrc: what about it?
[22:25:17] <nrc> there should be a bunch of .so files, and some of them have numbers before the .so, e.g., librustc_typeck.0.so or something
[22:25:22] <nrc> is that the case?
[22:27:33] <gsingh93> nrc: i don't see any so files with numbers
[22:28:48] <nrc> hmmm
[22:29:01] <gsingh93> nrc: so actually, while a build without my changes does produce an LLVM error, it's a different error
[22:29:06] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[22:29:07] <gsingh93> maybe it's one of the known ones?
[22:29:11] <gsingh93> let me paste it
[22:29:27] <nrc> I want to try to repro locally, but my machine is busy indexing stuff
[22:29:35] <gsingh93> nrc: http://pastebin.com/ewnSeark
[22:29:54] <nrc> yep, that is a known one
[22:30:45] <nrc> gsingh93: I'll try to repro this myself. If you could try and repro it in a stage2 build, that would be really awesome. If you do, please file an issue and cc me
[22:31:37] <nrc> gsingh93: you can use ` RUSTFLAGS_STAGE2='-Ccodegen_units=4'` to only set the codegen_units at stage 2
[22:32:22] <nrc> I think there is probably a bug here, I suspect that the intermediate object files are not being overwritten properly after a rebuild
[22:32:49] <nrc> but I need to try a bit harder to find them and see what is going on
[22:33:57] <gsingh93> so is it likely that the known issue is the same issue that's causing the new error when I make minor modifications?
[22:34:11] <gsingh93> or do you think they're unrelated?
[22:34:19] *** Quits: summerlight (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[22:34:24] <gsingh93> i'm running a stage2 build now
[22:34:34] <nrc> hard to say. I think they are unrelated, but my confidence is very low
[22:35:21] <nrc> I'm fairly sure the issue you get without the changes is the known issue and fixed at stage 2. The first errors you showed me, I have not seen before and think could be an unrelated issue
[22:35:54] *** Quits: yjv_ (yjv@moz-j0cdis.fios.verizon.net) (Connection closed)
[22:39:01] *** Joins: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP)
[22:44:49] <gsingh93> nrc: here's a stage2 build without my changes: http://pastebin.com/RMRJsmUq
[22:44:59] <gsingh93> is that expected?
[22:48:09] *** ChanServ sets mode: +ao burntsushi burntsushi
[22:49:10] <nrc> gsingh93: no, definitely not!
[22:49:15] <nrc> is that a recent pull?
[22:49:50] <gsingh93> nrc: yesterday night, hash 20d23d8e57c0313c
[22:50:06] * nrc curses
[22:50:43] <nrc> that seems like a regression, I'll try and repro locally
[22:51:10] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[22:51:16] <nrc> gsingh93: thanks for experimenting for me!
[22:51:24] <gsingh93> no problem
[22:54:24] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[22:56:33] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[22:56:37] *** ChanServ sets mode: +o bstrie
[22:57:28] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Quit: ChatZilla 0.9.91.1 [Firefox 38.0.5/20150525141253])
[22:58:15] *** Quits: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net) (Client exited)
[23:01:07] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[23:01:24] <carllerche> Are there any drawbacks to bounding a type by Any if it already is bound by 'static?
[23:01:41] <carllerche> (besides maybe rustdoc?)
[23:05:12] *** Quits: James_ (quassel@moz-g7un1m.range86-163.btcentralplus.com) (Ping timeout: 121 seconds)
[23:05:14] <eddyb> carllerche: any callers will also need the bound
[23:07:14] *** Joins: yjv (yjv@moz-ll38tk.pa.comcast.net)
[23:08:09] *** Quits: yjv (yjv@moz-ll38tk.pa.comcast.net) (Connection closed)
[23:08:43] *** Joins: geofft (geofft@moz-i01917.mit.edu)
[23:10:01] *** Quits: arielb1 (Ariel@moz-1uf694.red.bezeqint.net) (Quit: Ex-Chat)
[23:14:58] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[23:16:19] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[23:17:20] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[23:19:17] <brson> acrichto: i am trying to leave some helpful feedback about how to hide the massive amounts of pnacle-specific code
[23:19:45] <acrichto> brson: ok
[23:19:56] <acrichto> brson: I haven't taken a look recently if it's changed radically
[23:20:18] <brson> not really
[23:21:29] *** Quits: zeiris (dan@moz-8jbmam.letter.agency) (Ping timeout: 121 seconds)
[23:22:22] <eddyb> acrichto: oh I guess I won't get to see if my PR stacking trick works
[23:23:16] *** Joins: zeiris (dan@moz-8jbmam.letter.agency)
[23:43:26] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[23:43:33] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[23:44:16] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[23:44:24] *** Quits: bjz (bjz@moz-puppgq.tpgi.com.au) (Quit: My Mac has gone to sleep. ZZZzzz…)
[23:44:54] *** Joins: bjz (bjz@moz-puppgq.tpgi.com.au)
[23:45:23] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[23:48:57] *** Quits: bjz (bjz@moz-puppgq.tpgi.com.au) (Ping timeout: 121 seconds)
[23:49:26] <WindowsBunny> reem: How should Debug for an error with an error string be formatted?
[23:49:54] <WindowsBunny> Error { repr: Os(num), msg: "This is the error message" } ?
[23:50:05] <reem> That looks good to me
[23:50:09] <carllerche> It would be nice if there was some sugar to avoid repeating the same generic bounds for a single type across many impl blocks
[23:50:11] <reem> I was about to suggest a phantom field
[23:50:26] <WindowsBunny> reem: I could also leave out the field name
[23:50:30] <cmr> carllerche: In general I suspect using Any/Reflect will in the future cause rustc to disable certain compiler optzns that are based on parametricity.
[23:50:36] <WindowsBunny> Error { repr: Os(num), "This is the error message" }
[23:50:46] <WindowsBunny> or it could be part of Os
[23:50:55] <WindowsBunny> Error { repr: Os(num, "This is the error message") }
[23:50:58] <carllerche> cmr: what sort of optimizations?
[23:51:05] <reem> I like the phantom field best since it's easy to mix in and is formatted just like everything else
[23:51:25] <reem> So it cooperates with the debug builder formatting
[23:51:28] <cmr> carllerche: one possible optimization would be monomorphizing only one Vec<T> per size class, for example.
[23:51:50] <cmr> But when code can break parametricity such an optimization becomes unsound.
[23:51:50] <WindowsBunny> Lemme see what #[derive(Debug)] generates so I can copy the impl :P
[23:52:19] <carllerche> cmr: why does Any break that? (sorry, i don't know much :P)
[23:52:47] <carllerche> I should probably look up exactly what monomorphism is
[23:53:07] <reem> TypeId::of::<T>() monomorphizes to a different hash for every T
[23:53:11] <WindowsBunny> How do I use --pretty to get the expanded code after macros/syntax extensions?
[23:53:18] <cmr> WindowsBunny: --pretty=expanded
[23:54:49] <reem> carllerche: monomorphization is the name for expanding generics as "templates"
[23:55:41] <carllerche> yeah, but I don't see how that applies to Vec<T> given that the generated code is more or less the same?
[23:55:52] <cmr> Precisely, Vec<T> respects parametricity.
[23:55:54] <carllerche> i mean, i don't know what would be different
[23:55:58] <cmr> I offered it as an example of something that can exploit it.
[23:56:58] <reem> Methods like Any::downcast_ref have different behavior depending on the T
[23:58:34] <carllerche> well, i assume downcast_ref actually is the same and the variance is on type_id
[23:58:40] <carllerche> or, TypeId::of
