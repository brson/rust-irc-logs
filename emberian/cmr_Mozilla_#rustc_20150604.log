[00:34:59] <nrc> Anyone have any objections to my proposal for r+'ing at the end of this thread?
[00:35:01] <nrc> https://internals.rust-lang.org/t/adding-new-features-to-rustc-llvm/2168/4
[00:35:12] <nrc> I'm going to do that later today unless anyone objects
[00:35:26] *** kimundi is now known as zz_kimundi
[00:42:35] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[00:44:38] *** Joins: brson (brson@moz-3ia.c9m.56.172.IP)
[00:44:38] *** ChanServ sets mode: +qo brson brson
[01:02:19] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[01:21:02] *** Quits: marcusklaas (marcus@moz-14bm7d.upc-g.chello.nl) (Ping timeout: 121 seconds)
[01:47:18] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[01:58:27] *** Quits: brson (brson@moz-3ia.c9m.56.172.IP) (Quit: leaving)
[02:04:40] *** Quits: zz_kimundi (kimundi@moz-iru09r.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:06:25] *** Joins: zz_kimundi (kimundi@moz-ugi.lub.188.87.IP)
[02:06:32] *** zz_kimundi is now known as kimundi
[02:44:21] *** WindowsBunny is now known as BunnyServ
[02:50:13] *** Quits: whipsch (whipsch@moz-bl4i0b.from.irc.camp) (Ping timeout: 121 seconds)
[02:56:07] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[03:03:00] *** Quits: kimundi (kimundi@moz-ugi.lub.188.87.IP) (Ping timeout: 121 seconds)
[03:04:27] *** Joins: zz_kimundi (kimundi@moz-b6c.mnt.188.87.IP)
[03:04:33] *** zz_kimundi is now known as kimundi
[03:23:36] *** Joins: whipsch (whipsch@moz-bl4i0b.from.irc.camp)
[03:37:25] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[04:20:03] *** Quits: whipsch (whipsch@moz-bl4i0b.from.irc.camp) (Ping timeout: 121 seconds)
[04:24:49] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[04:37:07] *** Joins: whipsch (whipsch@moz-bl4i0b.from.irc.camp)
[06:19:04] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[06:57:10] *** Quits: [o__o] ([o__o]@moz-4s2t5k.compute-1.amazonaws.com) (Ping timeout: 121 seconds)
[07:08:24] *** Joins: [o__o] ([o__o]@moz-4s2t5k.compute-1.amazonaws.com)
[07:41:56] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Connection closed)
[07:51:13] *** Joins: Tobba (Tobba@moz-6oh.7ki.21.217.IP)
[07:57:32] *** Joins: eddyb (eddyb@moz-2fd.hlc.26.188.IP)
[08:15:24] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[09:00:56] *** Quits: Tobba (Tobba@moz-6oh.7ki.21.217.IP) (Ping timeout: 121 seconds)
[09:10:47] *** Joins: Tobba (Tobba@moz-6oh.7ki.21.217.IP)
[09:13:55] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[09:27:14] *** Quits: Tobba (Tobba@moz-6oh.7ki.21.217.IP) (Ping timeout: 121 seconds)
[09:50:50] *** Quits: nrc (nrc@moz-14pjgj.xtra.co.nz) (Ping timeout: 121 seconds)
[09:53:14] *** Joins: nrc (nrc@moz-14pjgj.xtra.co.nz)
[09:53:14] *** ChanServ sets mode: +qo nrc nrc
[09:59:28] *** Joins: Tobba (Tobba@moz-6oh.7ki.21.217.IP)
[10:41:51] *** Joins: marcusklaas (marcus@moz-14bm7d.upc-g.chello.nl)
[10:51:39] *** Quits: nrc (nrc@moz-14pjgj.xtra.co.nz) (Ping timeout: 121 seconds)
[10:59:04] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[11:40:13] <pnkfelix> marcusklaas: i hate to suggest it, but one option for checking a span wtih pretty much 100% precision would be a run-make test that pipes the output to a file and then runs diff
[11:40:23] <pnkfelix> marcusklaas: this is pretty much a terrible idea, though. :)
[11:41:53] <marcusklaas> pnkfelix: Haha, that would work. Unfortunately, my patch has *just* been merged :p
[11:41:57] <marcusklaas> https://github.com/rust-lang/rust/pull/25994
[11:42:13] <pnkfelix> ah good
[11:42:19] <pnkfelix> no chance of you adopting that idea then.  :)
[11:42:48] <pnkfelix> (it would set a terrible precedent; it would be better to extend compiletest to allow more precise span annotation when desired)
[12:11:51] *** Quits: marcusklaas (marcus@moz-14bm7d.upc-g.chello.nl) (Client exited)
[12:27:14] <eddyb> pnkfelix: do you happen to know if we have a policy on error codes? should I add a new one at the end, or reuse gaps?
[12:27:34] <pnkfelix> eddyb: I'd add one at the end
[12:27:39] <eddyb> thanks
[12:28:02] <pnkfelix> eddyb: I cannot remember if the gaps represent codes that were retired (hopefully retired codes are explicitly noted in the source)
[12:28:24] <pnkfelix> eddyb: but everything is geared towards adding to the end, e.g. the script that prints the next error code
[12:29:02] <eddyb> there's a script?
[12:30:30] <pnkfelix> eddyb: yeah, I think there's a make target that runs it.
[12:30:34] <pnkfelix> eddyb: let me find that
[12:31:16] <pnkfelix> eddyb: make tidy-errors I think
[12:32:06] <pnkfelix> eddyb: it both attempts to check for duplicate error codes and also prints out the highest error code, so that you can add 1 to it
[12:32:49] <eddyb> well, I have git grep -h '^ *E[0-9]' src/**/diagnostic* | sed 's/^ *//' | sort
[12:33:14] <eddyb> finding gaps by just looking isn't that easy, but the last error code is merely tail -n 1 :P
[12:33:51] <pnkfelix> right, well, either way, adding to the end seems safest
[12:36:06] <eddyb> hmm, there's no easy to make "noop" ty_param substs for a given number of generic type params
[12:37:50] <eddyb> uh oh I can't avoid dragging ty::Generics around
[12:46:57] *** Joins: laumann (thomas@moz-gqpfnm.science.ku.dk)
[12:52:58] *** Joins: marcusklaas (marcus@moz-14bm7d.upc-g.chello.nl)
[13:02:20] *** Quits: Tobba (Tobba@moz-6oh.7ki.21.217.IP) (Ping timeout: 121 seconds)
[13:22:35] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[14:08:47] *** Joins: killercup (killercup@moz-8bi.bjk.170.84.IP)
[14:12:38] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[14:26:04] *** Quits: marcusklaas (marcus@moz-14bm7d.upc-g.chello.nl) (Client exited)
[15:58:36] *** Quits: laumann (thomas@moz-gqpfnm.science.ku.dk) (Quit: leaving)
[16:46:13] *** Joins: arielb1 (Mibbit@moz-ernkhh.tau.ac.il)
[17:07:05] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[17:07:06] *** ChanServ sets mode: +qo brson brson
[17:52:55] *** Joins: killercu_ (killercup@moz-8bi.bjk.170.84.IP)
[17:55:28] *** Quits: killercup (killercup@moz-8bi.bjk.170.84.IP) (Ping timeout: 121 seconds)
[17:59:02] *** BunnyServ is now known as WindowsBunny
[18:32:48] *** Quits: [o__o] ([o__o]@moz-4s2t5k.compute-1.amazonaws.com) (A TLS packet with unexpected length was received.)
[18:33:05] *** Joins: [o__o] ([o__o]@moz-4s2t5k.compute-1.amazonaws.com)
[19:13:56] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[19:43:05] *** Joins: nrc (nrc@moz-14pjgj.xtra.co.nz)
[19:43:05] *** ChanServ sets mode: +qo nrc nrc
[19:58:03] <eddyb> nmatsakis: what does normalization in trans do? projections?
[19:58:34] <nmatsakis> eddyb: yes, same as everywhere else. that is, if we pull a type like <Foo as Trait>::Bar from a struct, it'll resolve it to whatever the impl specifies
[19:59:12] <eddyb> nmatsakis: I need to replace some types in trans and I'm not sure where to put that
[19:59:30] <eddyb> RegionEraser seems... a bit too specific
[20:00:17] <eddyb> actually, it does only region erasure and stores the result in a "normalized cache"
[20:01:05] <nmatsakis> eddyb: "replace some types"?
[20:01:31] <eddyb> nmatsakis: replace a specific set of types with some other types
[20:02:29] <eddyb> I could just use ty::fold_ty
[20:03:12] <eddyb> oh, no I can't, because normalize_associated_type is generic
[20:05:42] <arielb1> eddyb: what are you trying to do?
[20:05:52] <eddyb> arielb1: implement anonymized return types
[20:06:26] <arielb1> traits::normalize would seem to be the right place
[20:06:30] <eddyb> I've got everything done for the non-trait cases, except deanonymization in trans and maybe cross-crate
[20:06:40] <eddyb> arielb1: yeah, except it shouldn't happen before trans
[20:07:02] <arielb1> add a flag on the tcx?
[20:07:08] <arielb1> or a flag to normalize, rather
[20:07:11] <eddyb> I could do it on the typer
[20:07:30] <eddyb> it already uses NormalizingClosureTyper
[20:08:17] <arielb1> maybe put it on the selcx with intercrate
[20:08:51] <arielb1> it will fit there nicely
[20:10:02] <arielb1> nmatsakis: could you re-r+ gh25975
[20:10:07] <arielb1> it had a stupid bug
[20:32:33] <brson> the 'consider using an explicit lifetime parameter as shown' help message has never been correct for me
[20:37:08] <eddyb> brson: that's interesting, it got better and better after it was implemented
[20:37:33] <eddyb> brson: but once elision was enabled, I started seeing it less
[20:37:41] <eddyb> and maybe elision made it less reliable
[20:37:43] <nrc> I found it really helpful when learning Rust, now the false positive rate is too high, but I think that is more due to the mistakes I make rather than error message
[20:38:24] <eddyb> nrc: regionck also has terrible (no?) blame resolution
[20:39:35] <eddyb> it's going to point in all the wrong places if it can
[20:40:44] <eddyb> because inference is eager and a bad information source could poison the whole function and shame everyone else for not agreeing
[20:41:22] <eddyb> it's not that big of an issue with type inference as it is with region inference, because the latter needs no annotations
[20:45:58] <eddyb> error: internal compiler error: fictitious type impl core::iter::Iterator<Item=u8> + Sized in sizing_type_of()
[20:46:30] <eddyb> arielb1: well, that didn't work
[20:46:44] <eddyb> arielb1: ah!
[20:47:31] <eddyb> arielb1: has_projection_types is not true. not sure what to do about that
[20:53:12] *** Quits: arielb1 (Mibbit@moz-ernkhh.tau.ac.il) (Quit: http://www.mibbit.com ajax IRC Client)
[21:05:44] <eddyb> nmatsakis: is projection normalization expensive?
[21:06:49] <nmatsakis> eddyb: not as cheap as I'd like, though i've been doing a lot of profiling and it doesn't seem to be much of a factor
[21:09:49] <nmatsakis> brson: I'm very interested in getting back to error msgs, I think I told you, and rewriting that suggestion code is high on my list;
[21:09:58] <nmatsakis> brson: I agree that it's quality has deteriorated;
[21:10:06] <nmatsakis> brson: I think this is in part because the type system has gotten more complicated;
[21:10:19] <nmatsakis> brson: and eddyb is right that the code which tries to assign blame when region inference fails is broken, though I think I understand why now
[21:13:19] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[21:15:12] <eddyb> by the time it's fixed, one year will have passed since I struggled with it when adding 'tcx :P
[21:16:19] <eddyb> nmatsakis: if I handle ty_anon -> concrete type in traits::project, like arielb1 suggested, then I have to run all of that even when no projections exist
[21:16:33] <eddyb> I could add "has_anonymized_types", but is that the right way?
[21:17:18] <nmatsakis> eddyb: sorry, I missed what you're trying to do?, oh "impl trait"?
[21:17:22] <eddyb> I also feel like region erasure should happen at the same time, though anonymized types are kinda special (and they'll probably break with regions)
[21:17:25] <eddyb> nmatsakis: yupp
[21:19:43] <nmatsakis> eddyb: adding a flag seems like a way to avoid useleeeeeeess work, yes
[21:19:46] * nmatsakis curses bluetooth
[21:20:28] <eddyb> nmatsakis: it's pretty simple (if we ignore `impl Trait` in trait methods), really, just that some places have non-obvious requirements
[21:20:46] <eddyb> nmatsakis: thanks, I'll see how far I can get that way
[21:21:03] <eddyb> I should also start pushing my work because it's getting non-trivial
[22:23:34] *** WindowsBunny is now known as BunnyHitler
[22:23:54] *** BunnyHitler is now known as WindowsBunny
[22:25:02] *** eddyb is now known as thitlerrors
[22:25:13] *** thitlerrors is now known as eddyb
[22:35:50] <nrc> we really need to some design work on impl trait before we even think about pushing changes to rustc
[22:35:59] *** nrc is now known as nrc|distracted
[22:47:42] <nrc|distracted> eddyb, nmatsakis ^
[22:59:20] <eddyb> nrc|distracted: you mean the bits that act like associated items?
[23:00:22] <nrc|distracted> I mean all of it - the last RFC got closed months ago with a bunch of unresolved issues. AIUI, the final design isn't really fixed in anyone's minds
[23:01:08] <eddyb> I don't remember any issues in the non-trait forms
[23:01:17] * eddyb takes another look
[23:01:57] <nrc|distracted> non-trait? Isn't the whole idea to "return a trait"?
[23:02:24] <eddyb> nrc|distracted: I mean, outside of trait methods
[23:02:33] <eddyb> nrc|distracted: because in that case, it does something *entirely different*
[23:02:54] <eddyb> in a trait method's return type, impl Trait is an anonymous associated type
[23:04:27] <eddyb> hmm, the RFC is really not clear on that
[23:04:53] <eddyb> nrc|distracted: but in that case, impls could be allowed to have concrete types where `impl Trait` is written in the trait signatures
[23:05:26] <eddyb> I also ignored using `impl Trait` as anonymous generics, because that provides no new functionality AFAIK
[23:06:19] <eddyb> things have changed since that RFC and the path forward for naming the type is probably going to go through typeof and Fn::Output
[23:13:53] *** Quits: killercu_ (killercup@moz-8bi.bjk.170.84.IP) (Quit: Bye)
[23:25:00] *** Quits: nrc|distracted (nrc@moz-14pjgj.xtra.co.nz) (Ping timeout: 121 seconds)
