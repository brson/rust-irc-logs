[00:15:23] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Connection closed)
[00:18:51] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[02:38:17] *** Quits: kimundi (kimundi@moz-d29tad.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:40:07] *** Joins: kimundi (kimundi@moz-jppfl0.aq82.95ei.4fe2.2002.IP)
[06:12:15] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[06:30:49] *** Joins: eddyb_ (eddyb@moz-r5fa20.residential.rdsnet.ro)
[06:31:04] *** Quits: eddyb (eddyb@moz-qfi.dmj.25.188.IP) (Connection closed)
[06:38:01] *** eddyb_ is now known as eddyb
[07:02:28] *** Joins: laumann (thomas@moz-3m6.3kq.109.2.IP)
[08:39:32] *** Joins: killercup (killercup@moz-4u70ka.dip0.t-ipconnect.de)
[09:11:08] *** Joins: aatch (james@moz-tr6.omt.54.210.IP)
[10:29:18] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[10:44:41] *** Quits: aatch (james@moz-tr6.omt.54.210.IP) (Ping timeout: 121 seconds)
[11:38:10] <doener> what do you think about creating fake file metadata for enum types that claims that they originate from "<unknown>" as a quick workaround for gh26447?
[11:38:23] <doener> looks like properly solving that would take quite some effort
[11:39:35] <doener> pnkfelix: ^^ that would actually fix building with --enable-debug --enable-optimize
[11:49:55] <eddyb> doener: you mean, using something other than the first byte of the crate root, for DUMMY_SP?
[11:51:43] <doener> eddyb: no, specifically creating file metadata with filename "<unknown>" and directory ""
[11:52:12] <eddyb> and pointing DUMMY_SP at it?
[11:53:57] <eddyb> (probably the easiest thing is to keep DUMMY_SP the way it is, and reserve that first byte of the codemap for this "<unknown>" thing)
[11:54:57] <doener> eddyb: https://github.com/dotdash/rust/commit/f7ed24a544f9eeda9a46da3636177f046b310bc8
[11:55:32] <eddyb> doener: you don't even check for DUMMY_SP?
[11:56:03] <doener> eddyb: it must be the same filename/directory across _all_ crates.
[11:56:10] <doener> eddyb: even if the type is local
[11:56:18] <eddyb> ohhhh that part was not clear at all
[11:56:28] <doener> sorry
[11:56:47] <eddyb> nah, I have no clue about debuginfo stuff
[11:57:28] <eddyb> doener: I'd rather fix the current situation and at least give proper file, line and column numbers for external crates
[11:58:01] <eddyb> even if the source isn't encoded in the metadata
[11:58:56] <doener> eddyb: I guess that starts at extending FileMap to contain the directory information in addition to the filename... and I'm completely clueless about that code
[11:59:15] <eddyb> doener: ... directory information?
[11:59:28] <eddyb> the issue is that spans are not encoded *at all*
[11:59:29] <doener> eddyb: file debuginfo has two parts, filename and directory
[11:59:42] <eddyb> so you get DUMMY_SP
[12:00:04] <eddyb> and the codemap has no knowledge of anything found in external crates (other than macro_rules macros)
[12:00:28] <doener> eddyb: hm, it looked like the crate metadata has the whole codemap
[12:00:55] <doener> eddyb: it's just not imported into the local codemap unless it's inlineable code
[12:01:05] <eddyb> huh
[12:01:23] <doener> but I might be totally wrong here... only had a quick look through the code yesterday
[12:01:39] <eddyb> doener: but Span itself is never encoded, and always decoded as DUMMY_SP
[12:02:12] <eddyb> https://github.com/rust-lang/rust/blob/master/src/librustc/middle/astencode.rs#L233 what?
[12:03:26] <eddyb> doener: I might have been wrong about all of this :/
[12:03:28] <doener> eddyb: yeah, that's used for code that has its ast encoded. I couldn't figure out how to use it for enums though
[12:03:50] <doener> eddyb: and since it would be missing the directory information anyway, I gave up and tested that <unknown> workaround
[12:04:36] <eddyb> how can I trigger an error in a crate that already compiled?
[12:04:58] <eddyb> playbot: unsafe { std::mem::transmute<i32, i64>(0) }
[12:04:59] -playbot- <anon>:9:41: 9:42 error: expected one of `!`, `.`, `::`, `;`, `{`, `}`, or an operator, found `,`
[12:05:00] -playbot- <anon>:9         unsafe { std::mem::transmute<i32, i64>(0) }
[12:05:00] -playbot- output truncated; full output at: http://bit.ly/1IqgqEF
[12:05:04] <eddyb> playbot: unsafe { std::mem::transmute::<i32, i64>(0) }
[12:05:05] -playbot- <anon>:9:18: 9:49 error: transmute called on types with different sizes: i32 (32 bits) to i64 (64 bits)
[12:05:05] -playbot- <anon>:9         unsafe { std::mem::transmute::<i32, i64>(0) }
[12:05:05] -playbot- output truncated; full output at: http://bit.ly/1VMPLvR
[12:07:45] <eddyb> doener: okay, so this code changed sometime in the past year of so and I've been full of shit otherwise
[12:09:30] <eddyb> doener: the code to translate spans should move to rustc::metadata
[12:10:31] <eddyb> and they should be encoded, and maybe retrieved through a method on tcx
[12:25:54] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[13:57:37] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[15:02:07] *** Quits: rdgawdzi (sid91768@moz-mt7qcd.highgate.irccloud.com) (Connection closed)
[15:12:55] *** Quits: laumann (thomas@moz-3m6.3kq.109.2.IP) (Ping timeout: 121 seconds)
[15:30:38] *** Quits: killercup (killercup@moz-4u70ka.dip0.t-ipconnect.de) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[15:36:49] *** Joins: brson (brson@moz-u3dg2t.sfo1.mozilla.com)
[15:36:49] *** ChanServ sets mode: +qo brson brson
[15:37:50] *** Joins: arielb1 (Ariel@moz-1hdjvc.cablep.bezeqint.net)
[16:33:22] *** Quits: WindowsBunny (Peter@moz-vlal7g.east.verizon.net) (Ping timeout: 121 seconds)
[16:37:41] *** Joins: WindowsBunny (Peter@moz-vlal7g.east.verizon.net)
[17:10:10] *** Joins: rdgawdzi (sid91768@moz-mt7qcd.highgate.irccloud.com)
[18:02:38] *** Joins: eddyb_ (eddyb@moz-ir3t1r.residential.rdsnet.ro)
[18:05:00] *** Quits: eddyb (eddyb@moz-r5fa20.residential.rdsnet.ro) (Ping timeout: 121 seconds)
[18:05:30] *** Joins: sigma (sigma@moz-ennbau.range86-141.btcentralplus.com)
[18:07:46] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[18:33:22] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[18:39:30] *** Quits: kimundi (kimundi@moz-jppfl0.aq82.95ei.4fe2.2002.IP) (Ping timeout: 121 seconds)
[18:39:53] *** Joins: kimundi (kimundi@moz-jppfl0.aq82.95ei.4fe2.2002.IP)
[18:40:14] *** eddyb_ is now known as eddyb
[18:40:59] *** Quits: arielb1 (Ariel@moz-1hdjvc.cablep.bezeqint.net) (Quit: Ex-Chat)
[18:43:49] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[19:04:46] *** Quits: brson (brson@moz-u3dg2t.sfo1.mozilla.com) (Quit: leaving)
[19:59:00] *** Joins: brson (brson@moz-u3dg2t.sfo1.mozilla.com)
[19:59:00] *** ChanServ sets mode: +qo brson brson
[20:27:07] *** Quits: sigma (sigma@moz-ennbau.range86-141.btcentralplus.com) (Connection closed)
[21:05:11] <pnkfelix> doener: hmm yeah it is tough deciding between a quick hack here versus a proper fix
[21:05:33] <pnkfelix> doener: but I am not totally opposed to considering a quick hack.  I'd really like to get an --enable-debug build bot going
[21:55:23] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[22:23:07] *** Quits: brson (brson@moz-u3dg2t.sfo1.mozilla.com) (Quit: leaving)
[22:48:18] *** Joins: killercup (killercup@moz-4u70ka.dip0.t-ipconnect.de)
[23:25:39] *** Quits: killercup (killercup@moz-4u70ka.dip0.t-ipconnect.de) (Quit: Bye)
