[00:11:02] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[00:31:30] *** Joins: arielb1 (Ariel@moz-2jg.ri7.19.46.IP)
[00:32:30] *** Quits: arielb1 (Ariel@moz-2jg.ri7.19.46.IP) (Quit: Ex-Chat)
[01:29:03] <nrc> acrichto: I'm getting the error "found possibly newer version of crate `core` which `syntax` depends on" when building Servo using a custom rustc. I remember that this error crops up for reasons other than the obvious one but forget what they might be - this is a stage 2 build and in the details, the two versions of the crate are the .so and the .rlib of
[01:29:03] <nrc> libsyntax
[01:30:11] <acrichto> nrc: did the bootstrap finish? e.g. was libsyntax rebuilt?
[01:32:01] <nrc> yes - bootstrap finished fine
[01:32:15] <nrc> the time stamps look a bit odd though
[01:32:42] <acrichto> hm weird, you may want to try a `make clean` and a re-make
[01:32:56] <nrc> I'll give it a go, thanks
[01:35:34] *** Joins: aatch (james@moz-i1k1ks.tlms.2o1v.e006.2406.IP)
[01:44:42] <eddyb> acrichto: can you confirm this is a bug? could probably have a fix in a few minutes https://github.com/rust-lang/rust/issues/26690
[01:45:15] <eddyb> well, more like an hour if I want to test it
[01:56:32] <acrichto> eddyb: a bug in the sense that it's possible?
[01:56:40] <acrichto> eddyb: #[prelude_import] use std; <- this works
[01:56:51] <eddyb> acrichto: the fact that it's not unstable
[01:57:00] <acrichto> yeah that's probably a bug
[01:57:02] <eddyb> while it's a resolve hack
[01:57:08] <eddyb> thanks
[02:08:53] <eddyb> acrichto: ahhh I figured why it's like that. I need to make sure stability checking recognizes the attribute as being compiler-internal otherwise std_inject is going to trigger the feature gating
[02:09:17] <eddyb> doubt DUMMY_SP will cut it
[02:12:04] <eddyb> huon: how does format_args! handle stability?
[02:15:33] <huon> eddyb: what do you mean?
[02:15:59] <eddyb> how does it get away with emitting calls to unstable functions?
[02:16:33] <huon> there's some handling in the compiler
[02:16:35] <eddyb> AFAIK it's something to do with spans but I can't figure out how to create a dummy span that allows unstable features
[02:16:46] <huon> search for allow_internal_unstable iirc
[02:16:47] <eddyb> huon: I can't see anything special in syntax::ext::format
[02:16:58] <eddyb> oh, it's macro_rules-based?
[02:17:02] <huon> gtg, sorry I can't help more now
[02:17:12] <eddyb> np, thanks for the hint
[02:17:29] <eddyb> src/libsyntax/ext/expand.rs:                NormalTT(ref expander, tt_span, allow_internal_unstable) => {
[02:17:36] <eddyb> this more or less explains it
[02:18:48] <eddyb> src/libsyntax/test.rs:        callee: NameAndSpan {
[02:18:50] <eddyb> aha!
[02:32:44] *** Quits: kimundi (kimundi@moz-2dkqph.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:33:00] <eddyb> acrichto: I believe I got the right strategy figured out (though I think we should have a more general solution), I'll let you know if it actually works
[02:34:04] *** Joins: kimundi (kimundi@moz-didlps.13u2.kfms.57bc.2002.IP)
[02:59:05] <huon> eddyb: the attribute for macro_rules can be set by syntax extensions too
[02:59:10] <huon> I guess you've worked this out
[03:01:09] <eddyb> huon: yupp. thanks a lot!
[03:01:47] <eddyb> I was going to write some more but I have to leave for exams https://github.com/rust-lang/rfcs/pull/1168#issuecomment-117418440
[03:02:00] *** Joins: brson (brson@moz-lrp27o.hsia.telus.net)
[03:02:01] *** ChanServ sets mode: +qo brson brson
[04:37:57] <sfackler> eddyb: here's what the Debug deriving ext does to use unstable stuff: https://github.com/rust-lang/rust/blob/master/src/libsyntax/ext/deriving/show.rs#L70-L71
[04:54:55] *** Quits: brson (brson@moz-lrp27o.hsia.telus.net) (Quit: leaving)
[05:45:49] *** Quits: aatch (james@moz-i1k1ks.tlms.2o1v.e006.2406.IP) (Quit: Leaving)
[09:40:53] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[09:42:31] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[10:01:17] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[10:21:00] <eddyb> sfackler: thanks, but huon's hint led me to find a function in syntax::test that did exactly what I needed
[10:21:11] <eddyb> sfackler: this is the result btw https://github.com/rust-lang/rust/pull/26699
[11:25:25] *** Quits: c74d (c74d3a4ebb6@moz-kn41j4.mggc.hibn.4404.2002.IP) (Connection closed)
[11:25:50] *** Joins: c74d (c74d3a4ebb6@moz-kn41j4.mggc.hibn.4404.2002.IP)
[12:08:49] *** Joins: laumann (thomas@moz-3m6.3kq.109.2.IP)
[12:13:15] *** Joins: eddyb_ (eddyb@moz-vvc.hlc.26.188.IP)
[12:15:57] *** Quits: eddyb (eddyb@moz-l3g.mv7.25.188.IP) (Ping timeout: 121 seconds)
[12:26:27] *** Joins: arielb1 (Mibbit@moz-qqq0k1.tau.ac.il)
[12:32:11] *** Quits: laumann (thomas@moz-3m6.3kq.109.2.IP) (Ping timeout: 121 seconds)
[12:44:37] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Connection closed)
[12:44:46] *** Joins: laumann (thomas@moz-3m6.3kq.109.2.IP)
[12:46:12] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[12:56:09] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[12:58:20] *** eddyb_ is now known as eddyb
[13:09:11] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[13:25:23] *** Quits: laumann (thomas@moz-3m6.3kq.109.2.IP) (Quit: leaving)
[13:31:21] *** Joins: laumann (thomas@moz-3m6.3kq.109.2.IP)
[13:34:21] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Connection closed)
[13:35:20] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[15:10:23] *** Quits: laumann (thomas@moz-3m6.3kq.109.2.IP) (Ping timeout: 121 seconds)
[15:22:29] *** Quits: arielb1 (Mibbit@moz-qqq0k1.tau.ac.il) (Quit: http://www.mibbit.com ajax IRC Client)
[16:34:39] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Ping timeout: 121 seconds)
[16:52:39] *** Quits: doener (doener@moz-fnh.n4j.147.5.IP) (Quit: leaving)
[17:29:41] *** Joins: madmalik (uid13697@moz-3s7k1j.kkpo.i718.8300.2604.IP)
[17:36:53] *** Joins: mw (mw@moz-f1s7jp.vie.surfer.at)
[17:37:04] *** Parts: mw (mw@moz-f1s7jp.vie.surfer.at) ("")
[17:52:04] *** Joins: arielb1 (Ariel@moz-ov9088.red.bezeqint.net)
[17:52:08] <arielb1> eddyb: ping
[18:13:15] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Quit: Leaving.)
[18:13:18] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[18:19:19] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[18:51:56] *** Joins: sigma (sigma@moz-l8bauc.range217-44.btcentralplus.com)
[19:33:54] *** Quits: sigma (sigma@moz-l8bauc.range217-44.btcentralplus.com) (Connection closed)
[20:04:24] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[20:10:27] <jroesch> nrc: ping, I think my PR is good to go opened the issue and fixed or clarified any nits
[20:10:46] <nrc> sweet
[20:10:51] <nrc> jroesch: link?
[20:11:04] <jroesch> https://github.com/rust-lang/rust/pull/26677
[20:11:18] <jroesch> nrc: the fn vs. closure thing was due to a bug
[20:11:27] <jroesch> I tried to use a closure and it wouldn't type check
[20:11:33] <jroesch> seems to be fixed on nightly
[20:11:36] <jroesch> but not the snapshot
[20:11:43] <nrc> huh
[20:11:59] <jroesch> unless the snapshot has been bumped recently and I missed it
[20:12:14] <jroesch> I'll see if I can pull the error up
[20:13:44] <jroesch> it vanished was attached to a commit that got rebased I think :(
[20:18:34] <jroesch> nrc: if you get a chance I think it would be good to have a compiler-team person look over this one as well: https://github.com/rust-lang/rust/pull/26705, had Gankro review the collection-y pieces 
[20:21:00] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[20:21:14] *** Quits: arielb1 (Ariel@moz-ov9088.red.bezeqint.net) (Ping timeout: 121 seconds)
[20:22:04] <nrc> It seems to be a bit anti-abstraction to move all the bit-twiddling logic into BuiltinBounds, rather than keeping it a collection and BuiltinBounds having that collection as a field
[20:25:35] <jroesch> nrc: fair point, if you want we could move the underlying logic to rustc_datastructures, it just seemed like we had a very particular use case in this one spot with a fixed number of members that we could optimize for
[20:26:39] <nrc> is there a great optimisation advantage over using a generic bitset? Or even a U8BitSet?
[20:29:03] <jroesch> nrc: well afaik our current bitset allocates a vector under the covers and has also recently been deprecated and moved out of tree
[20:30:08] <jroesch> nrc: Gankro's PR landed last night https://github.com/rust-lang/rust/pull/26034
[20:30:42] <nrc> jroesch: But we could have our own BitSet in the compiler - either generic or fixed length
[20:31:20] <jroesch> nrc: of course :), if you think that is better I will generalize this and move it to the data structures crate 
[20:33:51] <nrc> Are there advantages to the current approach which I'm missing? If it's just a minor performance difference, then I'd much prefer a separate collection
[20:35:20] <jroesch> not if we implement a U8BitSet that doesn't alloc a vector, it was just the only place we are currently doing something like that
[20:35:42] <jroesch> I'll update the PR and ping you again later :)
[20:39:15] <nrc> cool, thanks
[20:42:06] *** Joins: arielb1 (Ariel@moz-tn5.ri7.19.46.IP)
[20:42:20] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[20:43:53] <arielb1> nrc: do you have an opinion on gh26680?
[20:43:57] <arielb1> gh26680
[20:44:29] <arielb1>  Default associated types defined in terms of other associated types don't work. #26680 
[20:44:32] <arielb1> https://github.com/rust-lang/rust/issues/26680
[20:44:58] *** Quits: arielb1 (Ariel@moz-tn5.ri7.19.46.IP) (Quit: Ex-Chat)
[20:45:17] *** Joins: arielb1 (Ariel@moz-tn5.ri7.19.46.IP)
[20:50:53] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[20:53:03] <nrc> hmm, the result of the discussion yesterday was that there was no way we could feature gate default assoc types, right?
[21:11:44] <arielb1> nrc: yes
[21:12:01] <arielb1> they were out in 1.0
[21:12:37] <arielb1> we could implement a flag on the supplier side
[21:14:24] <jroesch> nrc: so I went with a generic bitset that supports anything that acts like an unsigned integer so we can keep it light weight in terms of allocation
[21:15:41] <arielb1> jroesch: we essentially have it
[21:15:42] <arielb1> bitflags!
[21:15:47] <arielb1> it just lacks iterator
[21:16:13] <jroesch> I forgot about that, where does the impl live?
[21:17:03] <nrc> arielb1: what do you mean by supplier side?
[21:17:07] <eddyb> arielb1: pong
[21:17:20] <arielb1> nrc: on the side that supplies the trait
[21:17:48] <arielb1> it can have a flag that allows it to rely on its default associated types
[21:18:46] <eddyb> nrc, jroesch: but BuiltinBounds is obsolete, what's the point in keeping around a bitset for it?
[21:19:37] <nrc> arielb1: but that would break some crates which were using default ssoc types syntax even though they did nothing, correct?
[21:19:40] <eddyb> any effort put into making a bitset work is effort which could be used for removing BuiltinBounds instead
[21:19:56] <arielb1> nrc: yes
[21:20:14] <jroesch> I'm inclined to agree there, but removing it is a decision that has to be made by more people then me
[21:21:58] <eddyb> pretty sure nmatsakis has already made his decision, it's just not written down anywhere yet
[21:22:11] <nrc> I think the point is that in the short term it lets us remove EnumSet from libcollections. If there is not too much urgency on that, then leave everything the way it is and work on removing BuiltinBounds
[21:22:11] <eddyb> (we were discussing this a few months ago)
[21:33:43] <nrc> arielb1: then I would like to see 26680 fixed and back ported, or at least the bit about all assoc items needing to be overridden
[21:34:04] <arielb1> fixed?
[21:34:42] <arielb1> warning for 1.2, hard error for 1.3?
[21:35:06] <jroesch> eddyb: this is done I'll just push this PR out then delete bounds next
[21:35:16] <jroesch> well in between the defaults work
[21:35:24] <nrc> depends on the patch I guess, if it looks relatively low risk, then error on 1.2 too
[21:45:40] <arielb1> nrc: won't that be a breaking change on 1.2?
[21:45:43] <arielb1> (it will be)
[21:46:12] <nrc> I thought we allowed breaking changes in beta?
[21:46:19] <nrc> reluctantly
[21:46:27] <arielb1> that's a breaking change from 1.1/1.0
[21:46:31] <arielb1> that's the problem
[21:47:09] <arielb1> some people use "type Ty = XXX;" in 1.1/1.0
[21:47:23] <arielb1> (it compiles, just uselessly)
[21:47:43] <arielb1> if they also have default methods
[21:47:46] <arielb1> silent API change
[21:47:58] <arielb1> *API breakage
[21:48:00] <nrc> argh, because default assoc types  didn't force the overriding behaviour?
[21:48:09] <arielb1> nrc: they didn't do anything
[21:48:15] <nrc> everything is terrible
[21:48:20] <arielb1> accepted and ignored by the parser
[21:48:31] <arielb1> I *am* going to require them to be well-formed
[21:48:36] <arielb1> and call that "just-a-bug"
[21:48:37] <nrc> So, I think this is a bug fix and therefore does not count as a 'proper' breaking change
[21:48:37] <arielb1> through
[21:48:57] <nrc> but I think you are right that we should warn for at least a cycle
[21:50:12] <arielb1> this seems at the boundary between bug and spec-not-matching-reality
[21:51:41] <arielb1> this seems like a bigger change than lifetime elision
[21:53:08] <nrc> it is bigger, but it is still an edge case since it is a brand new feature (even if people were incorrectly using it before)
[21:53:23] <nrc> and I think it still qualifies as a bug - the compiler simply does not match the spec
[21:55:39] <arielb1> I have a PR
[21:55:52] <arielb1> that makes it an error
[21:56:03] <arielb1> a branch, I mea
[22:26:11] *** Quits: c74d (c74d3a4ebb6@moz-kn41j4.mggc.hibn.4404.2002.IP) (Connection closed)
[22:26:34] *** Joins: c74d (c74d3a4ebb6@moz-iclfcj.mggc.hibn.4404.2002.IP)
[22:50:26] *** Quits: arielb1 (Ariel@moz-tn5.ri7.19.46.IP) (Ping timeout: 121 seconds)
[23:35:01] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Quit: Leaving.)
