[00:00:01] <jensnockert> (And the samples are PCM)
[00:00:45] <jensnockert> My Mac Mini is broken, so don't have any BE systems to test with anyhowâ€¦ so I'll spare that until I get to AIFF.
[00:00:47] *** Quits: MaikKlein (maik@moz-EFA928EF.dip0.t-ipconnect.de) (Ping timeout)
[00:01:01] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[00:01:40] <jensnockert> (I don't event think Rust can build apps for OS X/PPC?)
[00:01:44] <dbaupp> awesome
[00:01:49] <cmr> dbaupp: pong
[00:02:08] <dbaupp> cmr: I can't believe you didn't list https://github.com/huonw/rust-malloc in twir
[00:02:15] <cmr> oh poo
[00:02:16] * dbaupp is infinitely offended
[00:02:23] <cmr> I forgot mw's status update AGAIN too
[00:02:26] * cmr goes back to add
[00:03:49] <dbaupp> jensnockert: isn't the big-endian as "simple" as reading it normally and swapping the bytes?
[00:04:01] <jensnockert> dbaupp: It is, but I don't do it.
[00:04:05] <jensnockert> Also, 24-bit samples.
[00:04:06] <cmr> jensnockert: you even wrote conditional byteswap intrinsics
[00:04:10] <cmr> you really have no excuse :p
[00:04:26] <dbaupp> cmr: (I'm not actually offended, btw :) )
[00:04:34] <jensnockert> I really don't, but I need to fix the API first.
[00:04:34] <cmr> dbaupp: (I figured)
[00:04:42] <dbaupp> cmr: (good)
[00:04:53] <cmr> dbaupp: top of the list, even (because it's cool)
[00:05:02] <cmr> Update your zero.rs with the optional langitems having landed!
[00:05:11] * dbaupp is infinitely unoffended
[00:05:23] <dbaupp> cmr: I'm pretty sure I can delete the whole thing except for the intrinsics
[00:05:26] <dbaupp> that's pretty cool.
[00:06:07] <doomlord> is it possible to get the type of an expression into a string with macros, (i've found stringify! which in conjunction with fmt("%?") makes for a great debug dump macro)
[00:06:28] <cmr> doomlord: no, macros run long before type checking
[00:06:54] <dbaupp> doomlord: probably not, but you can get the type at compiletime, `let x: () = expression_that_definitely_isnt();`
[00:07:21] <doomlord> heh good idea
[00:10:01] <doy> see also: http://youtu.be/52VsgyexS8Q
[00:12:40] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[00:13:32] <ChrisMorgan> rusti: enum E{}impl FromStr for E{fn from_str(_s:&str)->Option<E>{None}}E::from_str("foo")
[00:13:35] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/JHBc
[00:13:43] <ChrisMorgan> Now I remove the "FromStr for".
[00:13:44] <ChrisMorgan> rusti: enum E{}impl E{fn from_str(_s:&str)->Option<E>{None}}E::from_str("foo")
[00:13:45] -rusti- None
[00:13:53] <cmr> How is monad pronounced? I live near a Mt Monadnock and it's pronounaced mahnahdnawk, so I figured it was mahnahd, but these guys pronounce it mownahd
[00:13:54] <ChrisMorgan> Why is this the case?
[00:14:00] <cmr> (http://www.youtube.com/watch?v=ZhuHCtR3xq8, was in related videos)
[00:15:16] <ChrisMorgan> So, why is `E::from_str()` working if it's just an `impl E`, but not if it's `impl FromStr for E`?
[00:15:45] <cmr> ChrisMorgan: is the trait in scope?
[00:15:54] <ChrisMorgan> cmr: sure. You saw it there.
[00:16:05] <cmr> oh, duh
[00:16:08] <ChrisMorgan> FromStr is in the prelude.
[00:16:39] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[00:16:39] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/eErs2g
[00:16:39] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[00:16:41] <goffrie> cmr: I've only ever heard/said "mow nahd"
[00:16:45] *** Quits: RMF (RMF@moz-348663EF.dsl.telepac.pt) (Client exited)
[00:17:02] <cmr> ChrisMorgan: that seems like a really weird bug
[00:17:28] *** Joins: aatch (aatch@moz-B437F499.pocketrent.com)
[00:17:44] *** Joins: RMF (RMF@moz-348663EF.dsl.telepac.pt)
[00:17:59] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[00:18:06] <ChrisMorgan> Sounds like I need to report it?
[00:18:14] <dbaupp> cmr: why is it weird?
[00:18:31] <ChrisMorgan> dbaupp: well, can you explain why it isn't compiling?
[00:18:42] <cmr> dbaupp: enums always create a namespace don't they?
[00:18:43] <ChrisMorgan> I can't come up with any reason. The trait that is being implemented is in scope.
[00:18:52] <dbaupp> ChrisMorgan: it's already been reported, it's part of the bikeshedding about how traits work/their syntax.
[00:18:56] <cmr> The weird part is '<anon>:7:74: 7:85 error: use of undeclared module `E`'
[00:19:01] <dbaupp> oh.
[00:19:26] <goffrie> well, `impl X for Y` is scoped under trait X, right?
[00:19:27] <dbaupp> cmr: right, `impl` with static methods just puts things into a module with the same name as the type
[00:19:35] <dbaupp> goffrie: yes
[00:19:37] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[00:19:37] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/74BTjg
[00:19:37] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[00:19:46] <goffrie> so it wouldn't be in E::
[00:20:23] <ChrisMorgan> But the function works fine in just an impl block; then it's E::from_str, as I'd expect. But if I'm implementing FromStr, then it *isn't* there.
[00:20:25] <cmr> goffrie: it would, since it's a static method
[00:20:31] <cmr> That is, an associated function
[00:20:54] <dbaupp> https://github.com/mozilla/rust/issues/6894
[00:20:56] <goffrie> ooh I didn't catch that, not sure then
[00:20:59] <aatch> ChrisMorgan, because the method is on the trait, not the type implementing it.
[00:21:16] <cmr> aatch: associated function
[00:21:19] *** Quits: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net) (Client exited)
[00:21:23] <aatch> cmr, right, sorry.
[00:21:39] *** Joins: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net)
[00:21:41] <dbaupp> (what aatch is still true though.)
[00:21:45] <cmr> EVERYONE initially misses that, for any question people ask using associated functions
[00:21:51] <cmr> I have a feeling this is a really bad syntax wart
[00:21:57] <cmr> it is nice to use but hard to read
[00:22:36] <dbaupp> cmr: yes, there is a whole pile of bikeshedding about it
[00:22:38] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[00:22:38] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/74BTjg
[00:22:38] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[00:22:39] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[00:22:39] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/TxDbwg
[00:22:39] <ghrust> 13rust/06auto 1413b474d 15Daniel Micay: rm obsolete no-op lints
[00:22:39] <ghrust> 13rust/06auto 144d91311 15bors: auto merge of #7936 : thestinger/rust/cleanup, r=alexcrichton
[00:22:39] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[00:23:19] *** Quits: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net) (Ping timeout)
[00:23:34] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[00:23:36] <dbaupp> (well, not just bikeshedding, since it's much deeper than just syntax; affects resolve etc too.)
[00:23:44] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[00:23:45] <cmr> yeah
[00:23:51] <cmr> it's a hard problem to solve well
[00:23:55] <cmr> lots of conflicting requirements
[00:24:05] <cmr> I have a feeling what we have now will stick
[00:24:05] <ChrisMorgan> Are people agreed that this case of mine is a bug, or not?
[00:24:40] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[00:24:43] <dbaupp> ChrisMorgan: the one about Trait::foo() rather than Type::foo() is #6894 ^
[00:25:17] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[00:25:17] *** ChanServ sets mode: +o dherman
[00:25:33] <dbaupp> strcat: (rusti's gone?)
[00:26:14] <ChrisMorgan> Oh, so as long as it's *static* methods I need to do it on the trait, rather than the type. :-/
[00:26:31] <dbaupp> yes
[00:29:48] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[00:29:53] <strcat> rusti: 2
[00:29:54] -rusti- 2
[00:29:57] <strcat> rusti: 2
[00:29:57] -rusti- 2
[00:30:17] <dbaupp> rusti: enum Foo{Bar} Foo::doesnt_exist()
[00:30:18] <engla> doy: interesting link
[00:30:20] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/dFFc
[00:30:49] <dbaupp> ChrisMorgan: the error message "undeclared module" *is* a bug (but it's independent of the trait stuff)
[00:31:21] <cmr> It's a bug that's going to be near impossible to fix without a serious resolve revamp
[00:31:23] <erickt> nmatsakis: ping
[00:31:27] <cmr> (I touched that code a lot)
[00:32:51] <dbaupp> cmr: it could check if there's an type `Foo` in scope, and add `or type` to the message
[00:33:01] <dbaupp> cmr: (it could even just add `or type` straight out.)
[00:33:13] <cmr> Heh, that's a cheap fix, nice call
[00:33:40] <dbaupp> actually
[00:33:55] <dbaupp> wait. this error message is because there isn't a static method at all on Foo
[00:34:10] <dbaupp> rusti: enum Foo{} impl Foo { fn exists() {} } Foo::doesnt_exist()
[00:34:10] -rusti- <anon>:7:48: 7:65 error: unresolved name `Foo::doesnt_exist`.
[00:34:11] -rusti- <anon>:7          enum Foo{} impl Foo { fn exists() {} } Foo::doesnt_exist()
[00:34:11] -rusti-                                                          ^~~~~~~~~~~~~~~~~
[00:34:11] -rusti- error: aborting due to previous error
[00:34:11] -rusti- application terminated with error code 101
[00:34:17] *** Quits: Nefzaoui (chatzilla@BB4F14E.ED9AB01B.80E43DAF.IP) (Quit: ChatZilla 0.9.90.1 [Firefox 22.0/20130618035212])
[00:34:20] * ChrisMorgan likes having an HTTP server which starts up in an imperceptibly short period of time
[00:34:32] <dbaupp> so it actually needs to be "type doesn't have any static methods"
[00:35:11] <dbaupp> (or maybe, every type should create its "static method mod" by default, so things are consistent.)
[00:35:20] <ChrisMorgan> Such a change from dynamic systems where it takes a while to start on account of having to check everything and sort everything out.
[00:35:42] <cmr> ChrisMorgan: what http servers are *you* using that are written in dynamic languages? O_o
[00:36:00] <dbaupp> cmr: Rails, right?
[00:36:00] <jensnockert> Webrick \o/
[00:36:01] <ChrisMorgan> cmr: Django, mostly.
[00:36:07] <cmr> Neither of those are servers
[00:36:12] <jensnockert> Eww, snakesâ€¦
[00:36:14] <cmr> well, not HTTP servers
[00:36:26] <erickt> shucks, nmatsakis has been idle for 2 days. Does anyone else know if it's possible to define a value who's lifetime is the superset of multiple regions? For example, `static x: &'static int = &5; let y = &6; let z = [x, y]`?
[00:36:28] <ChrisMorgan> cmr: Did I say "server" in my second line? I said "dynamic *systems*.
[00:36:54] <cmr> ChrisMorgan: fair enough
[00:36:55] <strcat> erickt: yes, should work
[00:37:11] <strcat> erickt: it will have the lifetime of y there
[00:37:19] <dbaupp> rusti: static x: &'static int = &5; let y = &6; let z = [x, y];
[00:37:19] -rusti- error: internal compiler error: unexpected failure
[00:37:20] -rusti- note: the compiler hit an unexpected failure path. this is a bug
[00:37:20] -rusti- note: try running with RUST_LOG=rustc=1,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues
[00:37:20] -rusti- application terminated with error code 101
[00:37:25] <erickt> strcat: I get a lifetime mismatch
[00:37:41] <strcat> erickt: sec
[00:38:22] <dbaupp> (I guess that code doesn't run because there are problems with static inside fns.)
[00:38:35] <strcat> erickt: I get an ICE ;p
[00:38:56] <erickt> strcat: I'm getting an ICE like that too, lemme gist my example that gets a lifetime mismatch
[00:39:04] <dbaupp> ChrisMorgan: do you wanna file an issue about `undeclared module` or should I?
[00:39:23] <ChrisMorgan> dbaupp: you'll probably describe it better than I.
[00:39:41] <erickt> strcat: https://gist.github.com/erickt/6050584
[00:40:04] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Ping timeout)
[00:40:31] <erickt> strcat: although it's possible I've done something weird in my attempt to add `*'a T`
[00:40:40] <erickt> that's triggering this error
[00:41:00] <erickt> strcat: odd, rust 0.7 compiles it fine though
[00:41:01] <ChrisMorgan> OK, I think I have a large enough subset of HTTP supported that I can now make a file serving example. No cache control or anything like that yet, but that's of secondary importance.
[00:41:40] <erickt> ChrisMorgan: cool! got your code posted somewhere? My webserver hasn't worked since rust 0.4 :(
[00:41:57] <ChrisMorgan> erickt: http://hg.chrismorgan.info/rusthttpserver
[00:43:24] <erickt> ChrisMorgan: neat! Mine is at https://github.com/erickt/mre
[00:43:36] <dbaupp> ChrisMorgan, cmr: (https://github.com/mozilla/rust/issues/7950 fwiw)
[00:43:37] <strcat> erickt: wow I hit a weird error
[00:43:55] <cmr> almost in 8000
[00:43:55] <strcat> erickt: http://ix.io/6N5 try this
[00:43:58] <strcat> your mind will boggle too
[00:44:00] <strcat> ;p
[00:44:01] <erickt> ChrisMorgan: We didn't have working sockets back then, so I used zeromq to talk to mongrel2
[00:44:07] <strcat> erickt: and then change x to 'let x = &5' and it works
[00:44:10] <strcat> the error is incredibly strange
[00:44:30] <cmr> whua
[00:44:56] <erickt> strcat: was it "error: only refutable patterns allowed here"?
[00:45:12] <ChrisMorgan> erickt: yes, I came across MRE back then, didn't really like the concept, wanting instead a proper I-can-do-anything server. Plus I have my own ideas for a web framework which uses Rust's type system a lot.
[00:45:14] <strcat> erickt: yep
[00:45:23] <erickt> ChrisMorgan: :)
[00:45:42] * dbaupp set #[warn(non_uppercase_statics)] for exactly that reason
[00:45:54] <ChrisMorgan> Oh, hang on... I can't do a file server with newrt yet, can I?
[00:45:59] <cmr> dbaupp: it's in *function arguments too*?
[00:46:01] *** Quits: tjc (tjc@moz-5D7271A0.dsl.snfc21.pacbell.net) (Quit: zzzzzzzzzz)
[00:46:01] <cmr> yikes
[00:46:16] <ChrisMorgan> So much for that plan...
[00:46:25] <cmr> ChrisMorgan: call into libc :p
[00:46:31] <dbaupp> cmr: statics can interfere anywhere there is a pattern
[00:46:42] <dbaupp> ChrisMorgan: do the file-reading syscalls directly
[00:46:52] <dbaupp> ChrisMorgan: https://gist.github.com/Aatch/5894562 :P
[00:47:13] <erickt> strcat: how weird
[00:47:23] <cmr> the backslash in haskell is lambda!
[00:47:24] <ChrisMorgan> cmr/dbaupp: I think I prefer the alternative plan: work on something directly profitable rather than something which will just need to be torn out after a while
[00:47:25] <aatch> (That only works for x86 linux, btw)
[00:47:27] <cmr> it all makes so much more sense
[00:47:36] <dbaupp> aatch: *x86-64
[00:47:37] <cmr> ChrisMorgan: So go write file io for the runtime? :D
[00:47:42] <strcat> erickt: http://ix.io/6N6 that works fine
[00:47:45] * strcat shrugs
[00:47:56] <strcat> erickt: I haven't had much luck getting the inference to work without using functions
[00:48:23] *** Quits: maxli1 (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[00:48:30] <ChrisMorgan> cmr: I think it'd be better for it not to have me do that with my present knowledge of newrt (basically nil).
[00:48:46] <dbaupp> strcat, erickt, cmr: incidentally https://github.com/mozilla/rust/issues/7526
[00:49:19] <erickt> dbaupp: oh, thanks I was just about to file a bug about this :)
[00:54:01] <aatch> Goddamn I hate gcc's error messages.
[00:54:21] <erickt> strcat: hrm, so in my case, it looks like I need to introduce a function in order to get a named region, as in https://gist.github.com/erickt/6050622
[00:55:04] <erickt> I can't just add a `<'a>` to the outer function, because it seems to forget the region if it's not used in the arguments
[00:57:33] <aatch> erickt, regions are fixed, so there is nothing to forget. Naming them causes the compiler to enforce a particular relationship between two otherwise independent regions.
[01:00:22] <erickt> aatch: do you know how to achieve something like `foo` in https://gist.github.com/erickt/6050630?
[01:00:59] <aatch> erickt, well what's the use case?
[01:01:39] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[01:01:39] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 144d91311 to 14fe3f75f: 02http://git.io/N3iJvQ
[01:01:40] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[01:01:41] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[01:01:41] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/K3UWXA
[01:01:41] <ghrust> 13rust/06auto 1413b474d 15Daniel Micay: rm obsolete no-op lints
[01:01:41] <ghrust> 13rust/06auto 14b2eda1d 15bors: auto merge of #7936 : thestinger/rust/cleanup, r=alexcrichton
[01:01:41] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[01:03:10] <engla> spurious test fail
[01:04:04] <aatch> What you have doesn't work for the same reason calling `fn foo<T>()` doesn't work
[01:04:59] <erickt> aatch: ooh, I wrote a better example and it worked for me :) https://gist.github.com/erickt/6050648
[01:05:28] *** Joins: heftig (heftig@6835D69C.6FC4DE2F.FEC4A986.IP)
[01:05:33] <aatch> erickt, the region system confuses people for some reason. I think it's because it's too simple.
[01:05:49] <erickt> aatch: I'll see if I can map this to my code. This is all to support my "add regions to unsafe pointers" fix (https://github.com/mozilla/rust/issues/7694)
[01:06:55] <erickt> aatch: I got it working, but one of the trickier edge cases is how to deal with std::run::with_argv
[01:07:30] <jensnockert> aatch: I think it is partially because it is new, and partially because remembering where to place the region names is hard. :S
[01:07:58] <aatch> jensnockert, I get there are reasons. I meant more that people expect some sort of complex magic.
[01:08:02] <erickt> aatch: which takes `(prog: &str, args: &[~str])` and I need to put them into a `*'A *'A c_char`.
[01:08:30] <cmr> The only time I get tripped up by the region system is where there are bugs in it, or &[]/~[]/~str/&str is acting weird and I don't want double indirection
[01:08:44] <jensnockert> aatch: Ah, wellâ€¦ I guess, yeah. People tend to expect complex stuff if they don't know exactly how it works.
[01:10:39] <aatch> jensnockert, magical thinking is an unfortunate hazard in software development.
[01:11:07] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[01:11:17] <Crnobog> All the tests are broken on Windows :/
[01:11:27] <jensnockert> aatch: Well, to be honest, when you look at languages like C++ or Java, thinking random stuff is magical isn't a too bad approximation.
[01:11:31] <cmr> Crnobog: that is what happen when they never get run :(
[01:11:46] <jensnockert> Example from C++, Boost.
[01:11:54] <Crnobog> Well I'm gonna run them and add bugs >:(
[01:12:06] <cmr> Crnobog: does the test runner itself work now?
[01:12:06] <aatch> jensnockert, good point.
[01:12:12] <bjz> eh, could somebody look at this? https://gist.github.com/bjz/1b46e0fb93ef70b17579
[01:12:23] <Crnobog> cmr: Yeah it was only tests with aux crates that were broken
[01:12:25] <jensnockert> I doubt anyone understands even 90% of Boost.
[01:12:26] <aatch> it's more that it becomes a habit, so people jump at magic first.
[01:12:26] <Luqman> cmr: is it also check-fast that also run on incoming tests as well? i thought it ran the full check there
[01:12:27] <bjz> getting this error that I can't fix
[01:12:29] <Crnobog> I fixed that and submitted a pull request
[01:12:38] <cmr> Luqman: only check-fast is ever run
[01:12:53] <cmr> Luqman: master never ran the full check, and we don't even run tests on master anymore, we run them all on auto
[01:13:27] <cmr> Crnobog: you can add // xfail-win32
[01:13:30] <cmr> To the failing tests
[01:13:39] <aatch> bjz, try `Some(&dmap)`
[01:13:39] *** Quits: bytewise (bytewise@moz-649C630D.unitymediagroup.de) (Quit: Leaving)
[01:13:50] <cmr> And they will be skipped by the test runner (aiui)
[01:13:59] <bjz> aatch: oh wait
[01:14:11] <bjz> aatch: that's what I had before, but it didn't work
[01:14:13] <Crnobog> cmr: Yeah I've been adding xfail-test locally to progress past broken tests and see which others are broken
[01:14:20] <bjz> aatch: https://gist.github.com/bjz/1b46e0fb93ef70b17579 <-updated
[01:14:28] <bjz> aatch: I copied the wrong thing
[01:14:34] <Crnobog> But if it's kosher to add xfail-win32 once there's an issue in github I can do that and submit a pr
[01:14:45] <cmr> It is
[01:14:46] <bjz> aatch: error: mismatched types: expected `@mut private::WindowData` but found `&mut @mut private::WindowData` (expected @-ptr but found &-ptr
[01:14:54] <cmr> usually it's // xfail-win32 #issuenumber, iirc
[01:15:02] <bjz> aatch: I would like to get rid of the @, but I don't know how
[01:15:15] <Crnobog> Ok cool
[01:15:16] <dbaupp> cmr: (that's just a convention, fwiw.)
[01:15:30] <cmr> dbaupp: right, thus usually :p
[01:15:42] <Luqman> bjz: does dereferencing not work?
[01:15:49] <Crnobog> I'll do some of that tomorrow then since it is now 2am
[01:15:52] <dbaupp> Crnobog: you don't need to file an issue for each specific test case, just the each failure mode
[01:15:59] <bjz> Luqman: where?
[01:16:21] <aatch> bjz, well you can't really get rid of the @mut for now since it's part of the TLS api
[01:16:29] <cmr> Crnobog: or you could use a single metabug for every "this test fails on windows"
[01:16:30] <bjz> Luqman: the trouble is it doesn't give any info on where the line is
[01:16:31] <Crnobog> dbaupp: I think they're all different issues though
[01:16:47] <dbaupp> Crnobog: aha :)
[01:16:50] <bjz> aatch: well, I have @mut WindowDataMap
[01:17:01] <Luqman> bjz: what do you want the match to return? @mut private::WindowDataMap ?
[01:17:02] <bjz> that's not part of the tls api
[01:17:09] <dbaupp> aatch: TLS no longer uses @ extensively
[01:17:10] <bjz> Luqman: yup
[01:17:18] <aatch> dbaupp, oh right.
[01:17:20] <dbaupp> aatch: (at all, now, I think.)
[01:17:35] <bjz> Luqman: do I can do find_or_insert on it
[01:17:46] <bjz> aatch: pub fn get<T: 'static, U>(key: Key<@T>, f: &fn(Option<&@T>) -> U) -> U {
[01:17:56] <goffrie> looking at https://github.com/mozilla/rust/blob/master/src/libstd/rt/uv/uvio.rs#L285 can someone explain why newtype structs would be preferred?
[01:18:15] <Luqman> bjz: try Some(dmap) => *dmap
[01:18:55] <bjz> Luqman: same error
[01:19:37] <dbaupp> goffrie: not sure for that one... 3 fields seems like it should be a normal struct
[01:20:00] <goffrie> mmhmm, (also that bug is fixed, and the other instance of the same comment is on a newtype struct already)
[01:20:04] <dbaupp> goffrie: (although 6090 in the fixme is fixed.)
[01:20:04] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[01:20:09] <dbaupp> haha, yeah
[01:20:24] <bjz> Luqman: maybe my key needs to be: priv static data_map_tls_key: local_data::Key<@@mut WindowDataMap> = &local_data::Key;
[01:20:49] <goffrie> aha, I see it, it used to be just a one-field struct but the comment didn't get updated
[01:21:04] <aatch> bjz, find_or_insert returns &'mut T
[01:21:28] <dbaupp> strcat: are you doing/done a new snap?
[01:21:39] <bjz> aatch: ahh!
[01:22:09] <bjz> aatch: *facepalm*
[01:22:16] <aatch> if you change it to `*do local_data ...` it should work.
[01:22:43] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[01:23:08] <bjz> aatch, Luqman: ok, now I get some scary stuff: https://gist.github.com/bjz/1b46e0fb93ef70b17579#file-window_data_error-L1
[01:23:25] <aatch> bjz, you can ignore that.
[01:23:28] *** Quits: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net) (Ping timeout)
[01:23:28] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[01:23:32] <bjz> ok
[01:23:43] <bjz> well, it works now!
[01:23:46] <bjz> thanks!
[01:23:47] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[01:24:01] <bjz> needed another set of eyes
[01:24:53] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[01:24:53] *** ChanServ sets mode: +o dherman
[01:26:18] *** Quits: KindOne (KindOne@C1F6E399.FEF4604.EC6A1518.IP) (Ping timeout)
[01:27:36] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[01:27:46] <erickt> strcat / aatch: in case you're interested in seeing what I'm trying to do, here's what I'm trying to achieve: https://gist.github.com/erickt/6050736. What's not shown in this is that `*c_char`s now live in a region to make sure they won't escape
[01:30:29] *** Joins: KindOne (KindOne@4373AC8F.5D2364C3.EC6A1518.IP)
[01:31:41] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:35:33] <Luqman> bjz: i feel silly :P the reason it wasn't working was because find_or_insert gives you &mut @mut WindowData and you wanted just @mut WinddowData 
[01:35:50] <bjz> Luqman: I know, aatch helped me
[01:35:57] <bjz> I was just as silly :)
[01:36:23] <aatch> Luqman, you were so close, just derefed the wrong thing.
[01:36:52] <Luqman> aatch: well no that part too, since the the 2 match arms were returning different types originally
[01:37:32] <aatch> Luqman, well yes. But that was fixed by either your de-ref or my &-pattern
[01:37:41] <Luqman> right
[01:37:47] <aatch> (Both work, it's a matter of style normally)
[01:40:42] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[01:40:42] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14b2eda1d to 14fe3f75f: 02http://git.io/N3iJvQ
[01:40:42] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[01:40:44] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[01:40:44] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/YliC-A
[01:40:44] <ghrust> 13rust/06auto 1485387e1 15Jyun-Yan You: syntax: print visibilities of foreign items
[01:40:44] <ghrust> 13rust/06auto 14a576245 15bors: auto merge of #7938 : crabtw/rust/foreign-vis, r=huonw
[01:40:45] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[01:40:50] <dbaupp> eurgh, rustpkg failed twice in a row
[01:41:46] <engla> and before too
[01:45:43] *** Quits: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net) (Quit: jclements)
[01:47:28] *** Joins: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net)
[01:47:40] *** Joins: nyx114 (nyx114@moz-86F96554.com)
[01:51:53] *** nyx114 is now known as nyx
[01:52:12] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[01:53:35] *** Quits: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net) (Quit: jclements)
[02:00:07] *** Joins: Nefzaoui (chatzilla@BB4F14E.ED9AB01B.80E43DAF.IP)
[02:04:21] <doomlord> main.rs:389:14: 389:27 error: mismatched types: expected `@fn:'static(@syntax::ast::item, (@mut MyData,syntax::visit::vt<@mut MyData>))` but found `extern "Rust" fn(@syntax::ast::item, (@mut MyData,syntax::visit::vt<@mut MyData>))` (expected fn but found extern fn)
[02:04:22] <doomlord> main.rs:389 	v.visit_item=my_visit_item;
[02:04:24] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Quit: Leaving)
[02:04:53] <doomlord> ^^ struggling with type errors trying to setup a visitor. i've copied bits of code from rustdoc_ng
[02:05:10] <dbaupp> doomlord: you need a closure
[02:05:33] <dbaupp> doomlord: { visit_item: |i, tup| my_func(i, tup) }
[02:05:47] <cmr> that's not what I do...
[02:05:52] <doomlord> i'll try,that makes sense, 
[02:06:04] <cmr> https://github.com/cmr/rustdoc_ng/blob/master/visit.rs#L110
[02:06:22] <doomlord> but yeah.. i saw what rustdoc_ng did .. this code is cut/paste/break
[02:06:37] <cmr> I'm curious why mine works if yours doesn't
[02:07:06] <doomlord> one difference is your outer functoin setting up the whole thing is in a self impl
[02:07:28] <dbaupp> cmr: yours is in a struct literal, while doomlord's is setting the field directly, maybe.
[02:07:28] <doomlord> you have fn's inside... do they inherit the 'self' perhaps, making them like the closure
[02:07:36] <dbaupp> doomlord: no
[02:07:50] <doomlord> originally i was trying the struct-literal- and getting more errors
[02:08:16] <doomlord> i'll try the closure, the idea makes sense
[02:09:23] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Client exited)
[02:09:28] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[02:09:35] <doomlord> the closure works :)  ... i'd like to understand why cmr's approach worked, that looked like functions not closures
[02:09:35] <dbaupp> ok, yeah, it looks like it is the struct literal
[02:09:43] <dbaupp> doomlord: what errors?
[02:10:05] <doomlord> i'll try again with a closure.. i can't recall exactly
[02:10:15] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[02:11:13] <dbaupp> I'd guess they weren't related to @fn vs extern "Rust" fn. (but I could easily be wrong.)
[02:11:14] <doomlord> ok the struct literal works too. it must have been the same thing, my function type was wrong and probably infering something else making confusing errors
[02:12:17] <doomlord> i can see why cmr wanted to make functions instead of closures inplace, its going to be a rather large struct literal .. but avoiding temporary names is appealing
[02:12:26] <cmr> doomlord: exactly
[02:12:38] <cmr> and I dont want to pollute the global namespace
[02:12:42] <cmr> well, "global"
[02:12:44] <cmr> module really
[02:12:47] <cmr> I could use priv but meh, typing
[02:12:49] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[02:13:37] <dbaupp> cmr: things are module local always, except if they've got pub, right?
[02:13:55] <cmr> dbaupp: ... good point
[02:14:00] <cmr> shows how well I know rust :)
[02:14:30] <dbaupp> doomlord: temporary names like `visit_item` are good enough ;)
[02:17:53] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Client exited)
[02:18:18] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[02:19:26] *** Joins: MaikKlein (maik@moz-EFA928EF.dip0.t-ipconnect.de)
[02:19:38] *** Joins: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP)
[02:19:38] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14a576245 to 14fe3f75f: 02http://git.io/N3iJvQ
[02:19:38] *** Parts: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP) ()
[02:19:41] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[02:19:41] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/aZapww
[02:19:41] <ghrust> 13rust/06auto 1413b474d 15Daniel Micay: rm obsolete no-op lints
[02:19:41] <ghrust> 13rust/06auto 14e781a50 15bors: auto merge of #7936 : thestinger/rust/cleanup, r=alexcrichton
[02:19:41] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[02:19:59] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[02:20:41] *** Joins: etw (john@moz-B2936CAB.nyc.res.rr.com)
[02:20:46] <aatch> grr, stupid tiny errors.
[02:20:53] *** Quits: qmx (qmx@moz-D6C3C2E6.qmx.me) (Ping timeout)
[02:21:08] <aatch> needed: `>=` had: `>`
[02:21:31] *** Joins: qmx (qmx@moz-D6C3C2E6.qmx.me)
[02:22:34] <dbaupp> aatch: i spent an hour debugging a bug caused by an extra `!`
[02:22:51] <dbaupp> aatch: and then another hour debugging the same problem in a different place
[02:22:56] *** Joins: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net)
[02:23:00] * dbaupp didn't have fun that day
[02:23:07] <aatch> dbaupp, Ouch, I've had the absence of `!` do the same thing.
[02:23:35] <dbaupp> why can't rustc just work out which we want? :'(
[02:23:44] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[02:23:57] <cmr> compiler is good, but not good enough
[02:24:20] <aatch> I invoke "Sufficiently Smart Compiler"!
[02:24:34] <cmr> I was just thinking about that phrase
[02:24:36] <cmr> and you know?
[02:24:38] *** Quits: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP) (Ping timeout)
[02:24:49] <cmr> LLVM, given sufficient metadata, is almost a sufficiently smart compiler
[02:24:57] <bjz> Luqman: any idea if it is possible to get rid of the @s in this: https://github.com/bjz/glfw-rs/blob/master/src/private.rs#L70
[02:24:58] <cmr> for backend stuff at least
[02:26:09] <dbaupp> cmr: it doesn't elide/add !'s based on what we *want* to do though... *clearly* it should be able to do so ;P
[02:26:53] <dbaupp> bjz: isn't there a "local_data:get_mut" or something?
[02:27:01] <bjz> ya
[02:27:13] *** Joins: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net)
[02:27:17] <dbaupp> so you can just store HashMap<thing, Window> without the @mut
[02:27:34] <dbaupp> and then get_mut to get &mut Window to be able to modify it?
[02:27:42] <bjz> dbaupp: I have troubles with lifetimes in the get method
[02:28:01] <bjz> get_or_init
[02:28:07] <bjz> i mean
[02:28:21] <dbaupp> yeah, you won't be able to extract it from get[_mut] without @
[02:28:34] <dbaupp> (or extra::Rc, or some other shared pointer.)
[02:28:41] <bjz> ok
[02:28:52] <bjz> what sould I do then?
[02:28:54] <dbaupp> (or unsafe code.)
[02:29:21] <dbaupp> either, keep the @, or have everything go through callbacks
[02:29:23] <MaikKlein> cmr, your rustdoc will output json right?
[02:29:36] *** Quits: paulproteus (quassel@rose.makesad.us) (Ping timeout)
[02:29:39] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[02:29:47] *** Joins: paulproteus (quassel@moz-E86A3B42.makesad.us)
[02:29:52] <bjz> dbaupp: jack was trying to help me go to messages internally
[02:30:00] <dbaupp> engla: for #7719 and #7900, do you have the pull requests that fixed it?
[02:30:16] <bjz> dbaupp: here is his gist: https://gist.github.com/metajack/5982180
[02:30:18] <dbaupp> engla: wait, doesn't matter, github's picked up the references
[02:30:31] <bjz> dbaupp: bit complex for my tinsy mind though :/
[02:30:33] *** Quits: Nefzaoui (chatzilla@BB4F14E.ED9AB01B.80E43DAF.IP) (Quit: ChatZilla 0.9.90.1 [Firefox 22.0/20130618035212])
[02:30:55] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[02:31:07] <cmr> MaikKlein: will and does.
[02:31:09] <cmr> MaikKlein: want a sample?
[02:31:37] <MaikKlein> bjz, I now have time again,  do you need any help :)?
[02:31:56] <bjz> MaikKlein: with mathemagics?
[02:32:09] <dbaupp> bjz: ... I don't really have enough context to be able to help
[02:32:13] * dbaupp likes mathemagics
[02:32:23] <MaikKlein> cmr, sure I am thinking of writing like a wiki page where we can hook the docs in
[02:32:30] <MaikKlein> bjz, haha new name :D ?
[02:32:49] <bjz> dbaupp: lmath is getting much nicer
[02:32:53] <bjz> :]
[02:33:01] <cmr> MaikKlein: there's plenty of fairly low-hanging fruit on rustdoc_ng too if you want to help
[02:33:01] <bjz> MaikKlein: no, heh
[02:33:03] <cmr> How were exams?
[02:33:15] <MaikKlein> pretty good
[02:33:21] <bjz> MaikKlein: just being weird :]
[02:33:23] <MaikKlein> i wrote 3 times 1.3 :/
[02:33:28] <dbaupp> bjz: does it support general matrices yet? (if not, /me is not interested :P )
[02:33:33] <bjz> MaikKlein: mathemagiks is magikal
[02:33:41] <MaikKlein> bjz, :D
[02:33:49] *** Quits: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com) (Ping timeout)
[02:33:50] <dbaupp> bjz: ok, reading that gist, I think I understand it...
[02:33:51] *** Joins: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com)
[02:33:56] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[02:34:00] * dbaupp is probably wrong
[02:34:08] <bjz> dbaupp: unfortunately no, yeah - only really computer gfx stuff
[02:34:15] <doomlord> ok my visitor sort of works
[02:34:15] <MaikKlein> wait do you get your marks in letters? (US)?
[02:34:22] <MaikKlein> like A B C ...?
[02:34:29] <bjz> dbaupp: I probs need higher dimensional matricies soon though
[02:34:44] <dbaupp> bjz: high dimensional, i.e. 4x4 or 3x3x3?
[02:34:47] *** Joins: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP)
[02:34:51] <bjz> dbaupp: hope to use it for collision detection/physics
[02:35:02] <bjz> dbaupp: 6x6
[02:35:21] <MaikKlein> bjz,  I saw that you went crazy on lmath :), probably 1000+ new lines :p
[02:35:34] <bjz> MaikKlein: well, abit of refactoring too
[02:36:56] <MaikKlein> cmr, I am reading though rustdoc now
[02:37:07] <bjz> MaikKlein: trying to keep the core pretty general, then making the other modules more specific
[02:37:12] <dbaupp> bjz: anyway, I think that the message passing solution is pretty neat
[02:37:24] <bjz> dbaupp: yeah
[02:37:26] <doomlord> the function visit_crate relies on any functions you provide to sub-iterate i see
[02:37:30] <MaikKlein> what message passing?
[02:37:43] <cmr> doomlord: yep, visit_crate is the start of all visiting
[02:37:48] <bjz> dbaupp: you want to keep glfw on the os main thread
[02:38:00] <bjz> dbaupp: atm you can set it up wrong
[02:38:01] <dbaupp> MaikKlein: https://gist.github.com/metajack/5982180
[02:38:03] <doomlord> i wonder if it would be as easy to bypass visit_crate
[02:38:33] <dbaupp> doomlord: there's a pile of standalone functions in sytax::visit that perform the subiteration for you
[02:38:48] <dbaupp> doomlord: you just call them at the appropriate time
[02:38:56] <dbaupp> (in your visit functions.)
[02:39:13] <bjz> Jeaye: did some rejiggering of glfw-rs, let me know if you have any issues
[02:39:45] <bjz> Jeaye: glfw::private is more comprehensible now
[02:40:25] <doomlord> this seems to use a manually-rolledvtable - is it something that  trait objects could handle when they are stable
[02:40:47] <dbaupp> doomlord: yes
[02:41:09] <dbaupp> doomlord: aatch had a rewrite to use traits + default methods, but it hit a variety of problems
[02:41:12] <doomlord> i guess with closures, ,manually rolled vtables are ok
[02:41:25] *** Quits: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com) (Ping timeout)
[02:42:38] <bjz> MaikKlein, dbaupp, jack: https://github.com/bjz/glfw-rs/issues/23
[02:42:40] <MaikKlein> dbaupp, yeah it does look pretty nice, I always love messaging
[02:43:36] *** Quits: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net) (Quit: jclements)
[02:44:56] <cmr> doomlord: aatch did write a trait-based visitor!
[02:45:03] <cmr> (It didn't use trait objects, it used default methods)
[02:45:09] <cmr> it was quite nice
[02:45:15] <cmr> it was never destined to live, though
[02:46:37] <doomlord> i can see why with closures and enums traits are deprioritized
[02:47:32] <strcat> they aren't deprioritized
[02:49:15] <MaikKlein> bjz, it looks really neat but .... ah nvm
[02:49:19] <dbaupp> doomlord: the problem wasn't just a problem with traits.. it was also trying to get the correct api to make the visitor usable. (https://github.com/Aatch/rust/issues/2)
[02:49:25] <bjz> MaikKlein: ?
[02:49:42] <dbaupp> doomlord: lint does evil and horrible things to visitors.
[02:49:48] <MaikKlein> bjz, nvm I thought poll_events would block, but u used peek :)
[02:50:11] <bjz> MaikKlein: that was jack's gist, not mine
[02:50:17] <aatch> C++ produces the weirdest errors
[02:50:26] <MaikKlein> bjz, oh still looks pretty neat :p
[02:50:53] <MaikKlein> cmr, do you still use aatch's visitor thingy?
[02:50:54] <bjz> MaikKlein: just have to work out how to implement it myself
[02:50:59] <cmr> MaikKlein: no
[02:51:08] <bjz> MaikKlein: messaging still blows my mind
[02:51:26] <MaikKlein> bjz, :D
[02:52:14] <MaikKlein> bjz, where is the problem? maybe I can help
[02:52:22] <doomlord> what i'd like to do now is scan the ast to find the node correspondig to a source location...
[02:52:34] <cmr> doomlord: that... is going to be very tricky.
[02:52:52] <cmr> the name would be something like span_to_item
[02:52:55] <aatch> isn't that what the codemap is for?
[02:52:58] <cmr> but I'm not even sure it's possible
[02:53:01] <dbaupp> bjz: "implement it yourself" = "use copy-paste" :P
[02:53:14] <cmr> aatch: the codemap is span -> source string
[02:53:16] <doomlord> it must be possible :) just not necaserily straightforward
[02:53:23] <cmr> he wants span -> ast node
[02:53:37] <cmr> doomlord: well, it's easier than I initially though
[02:53:46] <dbaupp> doomlord: you could scan through the whole ast and find the node that has the smallest span that contains your location.
[02:53:47] <aatch> aren't spans attached to the AST nodes to start with?
[02:53:49] <cmr> basically just walk the entire ast and look for the item whose span contains yours
[02:53:50] <doomlord> i was assuming those 'spans' are the ranges in the source corresponding to the nodes
[02:53:51] <cmr> aatch: yeah
[02:54:00] <doomlord> so i should be able to just drill down in the visitor
[02:54:10] <dbaupp> doomlord: yes
[02:54:29] <doomlord> ... then i need to get the 'use' paths before it...
[02:54:35] <doomlord> ... do name resolution.. 
[02:54:37] <MaikKlein> bjz, I just don't understand this line  chan.send(Event { ... }); . chan should only be able to send a Msg
[02:54:50] <dbaupp> MaikKlein: Event is a type of Msg, right?
[02:54:56] <doomlord> and then the reverse , to get the actual declaration of the requested source item.
[02:55:31] <dbaupp> MaikKlein: well, chan is actually a KeyEvent chan
[02:55:51] <dbaupp> MaikKlein: so that's probably a typo and is meant to be KeyEvent
[02:56:01] <cmr> doomlord: you could copy my get_ast_and_resolve or whatever it's named wholesale, it will have run everything needed to do that
[02:56:35] <doomlord> yes i've cut/pasted bits of that , it helped me alot
[02:56:52] <cmr> (you want to use the def_map to resolve to the definition)
[02:57:39] <MaikKlein> dbaupp, well it's missing in the enum then, but it illustrates the use of messaging pretty well. 
[02:58:04] <doomlord> ah so you basically have the reverse implemented there
[02:58:24] <dbaupp> MaikKlein: (it's a different type.)
[02:59:03] *** Quits: zz_kimundi (kimundi@moz-693E7409.dip0.t-ipconnect.de) (Ping timeout)
[02:59:14] <dbaupp> MaikKlein: `SetKeyCallback(*c_void, Chan<KeyEvent>),` the Chan sends KeyEvents, not Msgs
[02:59:16] <MaikKlein> dbaupp, ohhh
[02:59:39] <MaikKlein> dbaupp, yeah I saw that now too, SetKeyCallback(win, chan)
[03:00:12] *** Joins: fenster (Mibbit@2BE01119.9E73CD93.2EF39EB3.IP)
[03:01:42] <sam113101> can you use C libs with rust?
[03:01:55] <dbaupp> bloody hell, rustpkg failed again! >:(
[03:02:06] *** Joins: zz_kimundi (kimundi@moz-251673E5.dip0.t-ipconnect.de)
[03:02:08] <cmr> 3 strikes and it's out?
[03:02:26] *** zz_kimundi is now known as kimundi
[03:03:28] <dbaupp> sam113101: yes
[03:03:42] <dbaupp> sam113101: http://static.rust-lang.org/doc/tutorial-ffi.html (if you have any questions, feel free to ask.)
[03:04:19] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[03:04:19] <ghrust> 01[13rust01] 15thestinger pushed 1 new commit to 06master: 02http://git.io/l00Qaw
[03:04:19] <ghrust> 13rust/06master 14fc05819 15Daniel Micay: Merge pull request #7936 from thestinger/cleanup...
[03:04:19] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[03:05:16] <doomlord> if i'm reading this right, the sub-nodes are always contained in specific enum cases ? ... that seems to complicate traversal .. but i can see it would have other advantages..
[03:05:22] <strcat> I should just disable those tests and push it
[03:05:42] <strcat> if the snapshot fails I'll be sad
[03:05:54] <doomlord> .. compared to the way libclang works where its just a tree of nodes (common structure, but  you query the nodes for specific info)
[03:05:56] <dbaupp> strcat: do it!
[03:06:14] <MaikKlein> cmr, I just had an idea, what do you think of an "view on github" function?
[03:06:34] <dbaupp> doomlord: why make it less typesafe?
[03:06:39] <cmr> MaikKlein: yes, view source, planned and implemented in the JSON already, just needs a UI :)
[03:06:49] <MaikKlein> cmr, oh.. nice :)
[03:07:29] <doomlord> i might essentially end up writing an alternative iterator to do what i have in mind
[03:07:37] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[03:07:37] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14e781a50 to 14fc05819: 02http://git.io/N3iJvQ
[03:07:37] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[03:07:38] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[03:07:38] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/I87ftA
[03:07:38] <ghrust> 13rust/06auto 14a74d92e 15Brian Anderson: syntax: Bless mod.rs. #4116...
[03:07:38] <ghrust> 13rust/06auto 14f37ad18 15bors: auto merge of #7926 : brson/rust/issue-4116, r=graydon...
[03:07:38] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[03:08:10] <cmr> doomlord: what are you writing?
[03:08:37] <dbaupp> doomlord: is this the ast -> s-expr converter?
[03:08:41] <MaikKlein> cmr, how do you intend to create the ui?
[03:08:50] <doomlord> my aim is to get symbol under cursor
[03:09:01] <cmr> MaikKlein: /I/ don't plan on doing it, that's other peoples' job ;P
[03:09:02] <doomlord> more accurately than my regex hacks :)
[03:09:07] <MaikKlein> cmr, :p
[03:09:19] <MaikKlein> cmr, do we want just raw html?
[03:09:27] <cmr> MaikKlein: Seldaek is writing one, HTML generator in nodejs
[03:09:37] <strcat> aatch: is element_type the opposite of ptr_to?
[03:09:38] <doomlord> first goal is a command line tool to do it - i can call that from gedit 
[03:09:46] <strcat> aatch: like, I have *T and need T (with LLVM types)
[03:09:51] <aatch> strcat, should be.
[03:10:06] <doomlord> dbaupp - i gave up on ast-> s-expr since i discovered the joy of fmt!("%?" )
[03:10:16] <doomlord> i've got enough debug now
[03:10:18] <dbaupp> oh... isn't that really ugly?
[03:10:25] <cmr> MaikKlein: #rustdoc-wg channel
[03:10:28] <doomlord> i wrote a formatter, less ugly
[03:11:35] <dbaupp> strcat: are you going to push the xfail-rustpkg thing?
[03:11:46] <strcat> dbaupp: later
[03:11:50] *** Quits: fenster (Mibbit@2BE01119.9E73CD93.2EF39EB3.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[03:14:41] *** Quits: LU324 (stuff@moz-A17E9A7B.dyn.embarqhsd.net) (Ping timeout)
[03:15:51] <aatch> Wow, the issues on the HipHop tracker are awful...
[03:16:05] <aatch> It's very frustrating not being able to close them.
[03:16:29] <Jeaye> bjz: Sure, I'll let you know.
[03:17:44] <dbaupp> aatch: example?
[03:18:51] <aatch> dbaupp, https://github.com/facebook/hiphop-php/issues/857
[03:19:19] <dbaupp> aatch: haha, that's not an issue!
[03:19:50] <dbaupp> aatch: (I assume most of them are "how do I ..." help-requests?)
[03:19:51] <aatch> So many like that "How do I do X" or "I can't get Y to work"
[03:20:00] <dbaupp> :(
[03:20:10] <aatch> They have a channel for that stuff!
[03:20:21] <dbaupp> I guess they don't spend as much time on triage/community work as mozilla and/or rust
[03:20:23] <aatch> And they're pretty helpful in there.
[03:21:22] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[03:21:28] <cmr> dbaupp: we don't really get the "how do I do X" though
[03:21:35] <cmr> not in the bug tracker
[03:21:37] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[03:21:39] <aatch> I asked for help on the issue tracker when I started on the Postgres extension. But it was a comment on an issue about implementing one, and I also announced that I was doing at the same time.
[03:21:42] <dbaupp> cmr: not yet, anyway.
[03:21:55] <aatch> It's almost certainly a PHP programmer thing.
[03:22:07] <cmr> yeah, I was thinking formulating a thought about that
[03:22:07] <aatch> They aren't always the best...
[03:22:29] * cmr is very tired, thinking slowly
[03:22:32] <dbaupp> aatch: (or a inexperienced programmer thing, but I guess there's a reasonable correlation between the two.)
[03:22:36] *** Joins: strcat1 (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:22:45] * aatch splits them off from "programmers that know PHP"
[03:22:47] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[03:22:51] *** strcat1 is now known as strcat
[03:22:55] <ChrisMorgan> What on earth are you doing with *PHP*?
[03:23:02] <ChrisMorgan> I mean, it's PHP! ;-)
[03:23:11] <aatch> ChrisMorgan, work. Getting paid.
[03:23:29] <dbaupp> aatch: just apply for a job at mozilla research ;P
[03:23:29] <aatch> Though in the past 2 weeks I've written more C++ than PHP
[03:23:56] <doomlord> what i have in mind is an iterator that takes an item-callback, which returns 'continue/recurse' like in libclang
[03:23:57] *** Joins: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com)
[03:24:19] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[03:24:39] <MaikKlein> PHP => please help the programmer?
[03:24:47] <MaikKlein> :p
[03:25:20] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[03:25:20] *** ChanServ sets mode: +o dherman
[03:25:34] <aatch> Also, the main issue with PHP is that it's really easy to write bad code in it. So you get all this awful, functioning, PHP in the wild
[03:25:42] * aatch looks at Wordpress
[03:26:10] <dbaupp> doomlord: that looks a lot like a standard internal iterator ;P
[03:26:20] <doomlord> maybe it could be done as a sort of tree filter/fold ...    my_visit( input:Accumulator,   fn(input:Accumulator, node)->(Accumulator,continueOrRecurse))->Accumulator
[03:26:23] <aatch> It's a bit like C++, but with exponential slowdown instead segfaults.
[03:27:10] <dbaupp> zslayton: ping
[03:27:15] <doomlord> (Then for my specific use case, the input accumulator is just ignored, i just want to return a Node refernce from the whole thing..)
[03:27:43] <doomlord> or the 'accumualtor' could be an array of node references - the whole tree path to the node I'm looking for
[03:28:37] <cmr> Well, I crashed the game I was playing, that means it's bed time, 'night all
[03:28:46] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[03:28:48] <zslayton> dbaupp: pong
[03:28:51] <doomlord> it seems to do this with the existing framework i have to fill in specific code for each node type i can visit anyway
[03:29:15] <doomlord> ^(with sub-iteration called in place, i mean)
[03:29:16] <dbaupp> zslayton: I assume you're zslayton on github? (I'm huonw, fwiw.)
[03:29:30] <Jeaye> First time I'm diving into lifetypes instead of @mut, what's wrong with this? https://gist.github.com/Jeaye/679c14daca2753759d1b
[03:29:47] <dbaupp> Jeaye: you need -> Foo<'self>
[03:29:53] <aatch> dbaupp, nope.
[03:29:56] <zslayton> dbaupp: I am, yes. I looked to see if huonw was in the list, so I decided to comment on the issue
[03:30:10] <dbaupp> Jeaye: oh, impl<'self> Foo<'self>
[03:30:11] <zslayton> dbaupp: Now I know better! :P
[03:30:18] <dbaupp> zslayton: :)
[03:30:31] <aatch> you want `fn new<'r>(m: &'r Bar) -> Foo<'r>`
[03:30:32] <Jeaye> Ok, got it compiling.
[03:31:13] <aatch> (It'll probably break when you try to actually call Foo::new otherwise
[03:31:14] <aatch> )
[03:31:18] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[03:35:24] <Jeaye> dbaupp: The rules for this are not in the tutorial, nor in the manual.
[03:35:41] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[03:35:42] <dbaupp> Jeaye: they may be in http://static.rust-lang.org/doc/tutorial-borrowed-ptr.html
[03:35:49] <dbaupp> (but I don't know)
[03:36:48] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[03:36:48] <dbaupp> ok, doesn't look like it. ... the best way to learn how to use lifetimes is to try things until the compiler stops complaining, and asking here.
[03:38:02] <Jeaye> haha
[03:38:07] <Jeaye> Such is the way with Rust. :P
[03:38:33] <Jeaye> Thanks, dbaupp. I'll be trying to move my @mut habits toward &mut and lifetimes.
[03:38:40] <aatch> Jeaye, the important thing to remember is that you have no control over the lifetimes with `'r`
[03:39:08] <aatch> In much the same way you can't change the actual type of something using type parameters
[03:39:14] <strcat> aatch: hrm, how do I get a ptr to a field? GEPi derefs afaict
[03:39:28] <ChrisMorgan> How should one test a non-pub fn? The convention I've seen in `#[cfg(test)] mod tests { #[test] fn test_foo() { } }`, but once it's in a different module it can't access private functions.
[03:39:33] <aatch> strcat, GEPi does not de-ref.
[03:39:39] <strcat> hrm
[03:40:07] <dbaupp> ChrisMorgan: yeah, it's a limitation
[03:40:08] <aatch> strcat, GEP only works if it can statically calculate offsets.
[03:40:16] <nyx> is there an example for starting processes with rust?
[03:40:19] <strcat> aatch: GEP is working
[03:40:29] <strcat> I'm just grabbing a tydesc from a box's tydesc field
[03:40:34] <strcat> but... it's a ptr to an i8
[03:40:41] <strcat> isn't a tydesc supposed to be a pointer itself?
[03:40:44] <nyx> figured it out
[03:40:46] <dbaupp> strcat: (rusti?)
[03:40:46] <strcat> I guess not
[03:40:50] <nyx> std/run
[03:40:55] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:41:04] <ChrisMorgan> dbaupp: well, how would you work around it?
[03:41:21] <strcat> rusti: print(std::str::from_bytes(std::run::process_output("uname", [~"-a"]).output))
[03:41:23] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[03:41:23] -rusti- Linux playpen 3.10.1-1-ARCH #1 SMP PREEMPT Sun Jul 14 11:00:04 CEST 2013 x86_64 GNU/Linux
[03:41:23] -rusti- ()
[03:41:44] <dbaupp> ChrisMorgan: by making it pub, or putting the test in the same module as the function
[03:42:29] <ChrisMorgan> Why do people put it in a separate mod? So that #[cfg(test)] is only needed once? (Or does #[test] have the same effect?)
[03:42:55] <Jeaye> aatch: I thought the name after ' didn't matter.
[03:43:01] <Jeaye> 'self == 'foo
[03:43:05] <aatch> Jeaye, yes and no.
[03:43:11] <dbaupp> ChrisMorgan: dunno... convention?
[03:43:20] <dbaupp> ChrisMorgan: it groups things together more nicely?
[03:43:33] <dbaupp> ChrisMorgan: (and yeah, #[test] strips them too.)
[03:43:44] <strcat> aatch: so to clarify... if I have an i8 field, GEPi will hand be *i8?
[03:43:49] <strcat> hand me*
[03:43:51] <strcat> that's what I expect
[03:43:52] <ChrisMorgan> Yep, I just made sure of that.
[03:44:05] <aatch> strcat, it should, yes
[03:44:14] <Jeaye> aatch: 
[03:44:17] <Jeaye> woops
[03:44:23] <Jeaye> "yes and no"?
[03:44:55] <aatch> ChrisMorgan, oh, it's because sometimes people write helper functions
[03:45:23] <aatch> ChrisMorgan, and this means you can just throw everything in a single `test` module.
[03:45:41] <dbaupp> ChrisMorgan: (I guess it also makes the source easier to read too, don't need to manually filter out the #[test] functions.)
[03:45:48] <aatch> Jeaye, lifetimes bounds can be a little odd sometimes.
[03:46:05] <Luqman> Jeaye: currently, there are some places where the compiler will only allow 'self
[03:46:15] <aatch> (As in, <'r> as opposed to &'r)
[03:46:30] <Jeaye> Does 'r mean anything special?
[03:46:36] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[03:46:36] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14f37ad18 to 14fc05819: 02http://git.io/N3iJvQ
[03:46:36] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[03:46:37] *** Joins: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP)
[03:46:37] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/VbtDIA
[03:46:37] <ghrust> 13rust/06auto 1485387e1 15Jyun-Yan You: syntax: print visibilities of foreign items
[03:46:37] <ghrust> 13rust/06auto 143d6c0bc 15bors: auto merge of #7938 : crabtw/rust/foreign-vis, r=huonw
[03:46:37] *** Parts: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP) ()
[03:46:38] <doomlord> http://pastebin.com/D2PW1Z5F <<< thats the approach i have in mind at the minute..
[03:46:38] <aatch> Jeaye, nope
[03:46:47] <dbaupp> Jeaye: no, only 'static and 'self have special meaning
[03:46:48] <ChrisMorgan> Seems to me the standard incantation is to wrap tests in #[cfg(test)] mod tests { use super::*; use a_few_other_things_which_were_also_imported_at_the_top_but_we_cannot_get_them_here; ... }
[03:47:08] <Jeaye> dbaupp: So I can't use 'foo where I'm using 'self in that previous post of mine?
[03:47:24] <dbaupp> Jeaye: depends where you're talking about
[03:47:52] <Luqman> in type declarations, only 'self is allowed (i.e. struct Foo<'self> { x: &'self int })
[03:48:06] <dbaupp> rusti: struct Foo<'self>(&'self str); impl<'self> Foo<'self> { fn new<'r>(s: &'r str) -> Foo<'r> { Foo(s) } }
[03:48:06] -rusti- ()
[03:48:10] <Jeaye> https://gist.github.com/Jeaye/679c14daca2753759d1b
[03:48:27] <dbaupp> Jeaye: I believe ^^ that's the minimal use-of-self
[03:48:28] *** Quits: MaikKlein (maik@moz-EFA928EF.dip0.t-ipconnect.de) (Ping timeout)
[03:48:46] <aatch> rusti: struct Foo<'self>(&'self str); impl<'self> Foo<'self> { fn new<'r>(s: &'r str) -> Foo<'r> { Foo(s) } } Foo::new("Test")
[03:48:47] -rusti- {__field__: "Test"}
[03:48:55] <dbaupp> rusti: struct Foo<'self>(&'self str); impl<'r> Foo<'r> { fn new(s: &'r str) -> Foo<'r> { Foo(s) } }
[03:48:58] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/ZPRP
[03:48:59] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[03:48:59] <strcat> aatch: afaict GEPi doesn't hand me a ptr...
[03:49:04] <aatch> rusti: struct Foo<'self>(&'self str); impl<'self> Foo<'self> { fn new(s: &'self str) -> Foo<'self> { Foo(s) } } Foo::new("Test")
[03:49:05] -rusti- {__field__: "Test"}
[03:49:09] <strcat> GEPi(bcx, cbox, [0u, abi::box_field_tydesc])
[03:49:13] <strcat> I expect a ptr to the field here
[03:49:15] <aatch> Hmm, I thought that might break...
[03:49:28] <dbaupp> aatch: I think it does weird things with freezing, etc.
[03:49:32] <Jeaye> So it seems nobody's quite sure how they work? :P
[03:49:34] <strcat>             ctx.int_type, ctx.tydesc_type.ptr_to(),
[03:49:36] <strcat>             Type::i8().ptr_to(), Type::i8().ptr_to()
[03:49:39] <strcat> the type comes from there
[03:49:45] <strcat> it's already a ptr, so I expect **T
[03:49:47] <strcat> but it's *T
[03:49:48] <aatch> Jeaye, only in that case ^^ really.
[03:50:12] <Luqman> aatch: why would that break?
[03:50:15] <aatch> strcat, odd.
[03:50:19] <Jeaye> Well, I'll fuck around with it some more and bug you all if I break things. Thanks!
[03:50:31] <aatch> Luqman, I thought it'd have issues trying to infer the lifetime.
[03:51:06] <dbaupp> strcat: rustpkg broke again
[03:51:16] * strcat shrugs
[03:51:20] <strcat> I really want to get this working first
[03:51:43] <dbaupp> strcat: (although, the mac-snap passed.)
[03:51:53] <strcat> I know
[03:51:56] <dbaupp> :D
[03:53:29] <ChrisMorgan> Hmm... I would be correct in believing that a struct containing a ~str cannot have a constant made of it?
[03:54:34] <dbaupp> ChrisMorgan: yes
[03:54:43] <ChrisMorgan> It seems to me that &'static is very poorly supported. Every case that I can think of where a ~ would do, a &'static would do also.
[03:54:55] <dbaupp> it's not that poorly supported, is it?
[03:55:04] <dbaupp> it's a standard str slice?
[03:55:56] <ChrisMorgan> dbaupp: I mean, the places where a regular & wouldn't do and so you need a ~, &'static tends to satisfy the requirements also.
[03:56:34] <aatch> ChrisMorgan, yes, but there are a number of confounding factors.
[03:56:39] <dbaupp> ChrisMorgan: oh, yes, aatch made a StringRef enum that handled that
[03:56:43] <strcat> except that &'static has to point to something statically allocated and it's not mutable
[03:56:52] <aatch> like you can't modify a &'static
[03:57:14] <ChrisMorgan> dbaupp: yes, I remember that. It was stalled last time I looked at it.
[03:57:28] * aatch can't remember what happened.
[03:57:57] <zslayton> dbaupp: I've got a forked repo with the changes to the tutorial in place. [ http://git.io/36FRPA ] What's the next step?
[03:57:57] <ChrisMorgan> https://github.com/mozilla/rust/pull/7599
[03:57:59] <strcat> aatch: I think I know what's wrong
[03:58:23] <strcat> aatch: anyway, I have *Box and want to store something in a box header field... but I keep hitting horrid asserts ;p
[03:58:29] <dbaupp> zslayton: ah, ok, you want to make a "pull request"
[03:58:29] * strcat sighs
[03:58:34] <strcat> llvm hates me tonight
[03:58:39] <strcat> usually this would be easy
[03:58:57] <dbaupp> zslayton: https://help.github.com/articles/creating-a-pull-request
[03:59:09] <zslayton> dbaupp: tyvm
[03:59:31] <dbaupp> zslayton: the target branch should be mozilla master
[03:59:49] <aatch> Heh, my error messages are better than the standard PHP ones :D
[04:01:08] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[04:04:25] <strcat> aatch: oh, I was missing a deref
[04:04:27] * strcat sighs
[04:05:33] <zslayton> dbaupp: Much obliged! http://git.io/rE5WqA
[04:07:09] <dbaupp> zslayton: looks good (if you change `addresses issue 7689` to `fixes #7689` (without any links), then github will automatically make the link, and automatically close that issue when the pull request gets merged.)
[04:07:19] <dbaupp> (in the pr description.)
[04:08:33] <zslayton> dbaupp: (Good to know, thank you!)
[04:09:13] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[04:09:50] <jmgrosen> so i'm transitioning from Copy-ing to Clone-ing, and i have this question: why does cloning an array ([T, ..n]) return a slice? (&[T])
[04:11:14] <zslayton> dbaupp: Updated! I'm heading to bed. Thanks for the help!
[04:11:28] <dbaupp> jmgrosen: because [T,..n] doesn't implement Clone, so it gets auto-borrowed to &[T], which does implement Clone
[04:11:38] <dbaupp> zslayton: thank you for fixing that issue!
[04:11:56] <zslayton> dbaupp: My pleasure. 'Night!
[04:12:13] <jmgrosen> dbaupp: any way to fix that, other than implementing Clone for all `n`?
[04:12:14] <zslayton> dbaupp: Or not night, depending on where you are.
[04:12:17] <dbaupp> jmgrosen: nope
[04:12:22] <dbaupp> zslayton: afternoon ;)
[04:12:23] *** Quits: zslayton (Mibbit@moz-14AA87A9.nyc.res.rr.com) (Quit: http://www.mibbit.com ajax IRC Client)
[04:12:56] <dbaupp> jmgrosen: (in fact, I think there is literally no way to safely clone [T,..n] at the moment.)
[04:13:14] <jmgrosen> dbaupp: oh. that's not good o_O
[04:13:18] <dbaupp> no :(
[04:13:33] <dbaupp> you can do it for types without destructors
[04:14:05] <dbaupp> and I guess for types with them... but you have to be very careful about not failing in the middle of the clone.
[04:15:08] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[04:16:49] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[04:17:30] <ChrisMorgan> ::rt::backtrace gives almost-useless information (no method names or anything like that in my code, not even the LLVM munged names). Is there any way I can get it to tell my any more?
[04:17:48] <aatch> ChrisMorgan, that's odd. it normally gives methods
[04:17:58] <aatch> except in some cases with inlining
[04:18:31] <ChrisMorgan> It gives the mangled names for libstd et al., but in my own methods, just an address, e.g. "rusthttpserver[0x421a42]"
[04:18:43] <aatch> ChrisMorgan, oh, wait. Hmm... I remember this issue
[04:18:56] <aatch> (it strips the names because it's an executable)
[04:19:08] <aatch> ChrisMorgan, try compiling with -Z debug-info
[04:19:10] <ChrisMorgan> (This is when I'm running tests.)
[04:19:16] <ChrisMorgan> I tried that. No seegar.
[04:19:50] <aatch> ChrisMorgan, hmm... bad luck then sorry. There's no way to turn it off in rustc atm.
[04:20:14] <ChrisMorgan> Off?
[04:20:31] <aatch> ChrisMorgan, marking all functions in an exe as internal
[04:20:51] <ChrisMorgan> Oh, I see. I do actually get rusthttpserver(_rust_main+0x2e)[0x447b8e], but that's not a great deal of help.
[04:20:56] <aatch> We do it because it allows LLVM to make optimizations it might not otherwise.
[04:21:15] <aatch> ChrisMorgan, yeah, because _rust_main isn't considered internal.
[04:21:19] <strcat> and it makes the binary less huge
[04:21:21] <ChrisMorgan> :-/
[04:21:36] <ChrisMorgan> So my code is internal, and its generated code isn't... remarkable.
[04:21:38] <strcat> can't you turn on debug info
[04:21:59] *** Joins: strcat1 (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[04:22:07] <strcat1> rusti: 2
[04:22:11] <dbaupp> ChrisMorgan: what's the failure?
[04:22:28] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (NickServ (GHOST command used by strcat1))
[04:22:33] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[04:22:37] <aatch> I guess -Z debug-info should make it so they're not internal anymore.
[04:22:44] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (NickServ (GHOST command used by strcat1))
[04:22:51] <strcat1> aatch: they should still be internal
[04:22:54] <strcat1> there's just debug info
[04:22:56] *** strcat1 is now known as strcat
[04:23:05] <strcat> internal functions in C work perfectly fine with debug info
[04:23:25] <aatch> strcat, well then whatever is causing this issue.
[04:23:30] <ChrisMorgan> dbaupp: it's an is_ascii() failure, but I was just wanting to confirm that it really was happening where it seemed to be. I have now done so with printing. The problem: the string in question is "http/1.1"
[04:23:48] <strcat> aatch: it won't know names of functions without debug info if they aren't externally exposed
[04:23:57] <strcat> rust apparently isn't outputting that debug info
[04:23:58] <strcat> that's all
[04:24:06] *** Joins: telotortium (rmi1@moz-90BFA359.dhcp.mdsn.wi.charter.com)
[04:24:48] <strcat> if they aren't part of the external ABI, they are just addresses + the DWARF info saying what they're called, what the variables are, how to unwind from them, etc.
[04:25:52] <aatch> strcat, my guess is that it isn't output putting info for the declarations themselves, since I wouldn't be surprised if the symbol table for exported fns just gets re-used for debugging support.
[04:27:37] * dbaupp thinks someone should file a bug, and assign it to michaelwoerister and let him work it out ;)
[04:28:25] <strcat> it doesn't work with debug info enabled?
[04:28:41] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[04:30:18] <aatch> I'll shall do so when I get home
[04:30:39] *** Quits: aatch (aatch@moz-B437F499.pocketrent.com) (Client exited)
[04:31:27] <dbaupp> ChrisMorgan: is "http/1.1" not ascii??
[04:31:34] <ChrisMorgan> It *is*.
[04:32:28] <strcat> dbaupp: meh
[04:32:31] <strcat> snapshot segfaulting
[04:32:35] <strcat> in stage1
[04:32:36] <strcat> ;[
[04:32:40] <ChrisMorgan> Hang on... not failing any more :-/
[04:33:47] <doomlord> can i 'name a region' /'create a lifetime' for a scope block... i have some code taking types which  need a lifetime parameter. that wont compile as it says it can't infer
[04:34:03] <dbaupp> strcat: o_O
[04:34:20] <dbaupp> strcat: I think aatch met this before too, on the last snapshot he created
[04:35:00] <dbaupp> doomlord: code?
[04:35:48] <strcat> well that's great
[04:35:51] <strcat> ;[
[04:36:02] <dbaupp> strcat: where's it segfaulting?
[04:36:04] <ChrisMorgan> Hang on, this is weird. Now I get all my tests passing, but also get in the middle of it the stray line "rust: task failed at 'assertion failed: self.is_ascii()', /home/chris/vc/rust/src/libstd/str/ascii.rs:143". Huh?
[04:36:09] <strcat> dbaupp: sec
[04:36:12] <strcat> compiling again.
[04:36:21] <doomlord> (i'm trying it with @s instead )
[04:36:22] <dbaupp> ChrisMorgan: do you have a #[should_fail] test?
[04:36:57] <ChrisMorgan> Ah!
[04:36:59] <dbaupp> ChrisMorgan: (because they still output to stderr)
[04:37:03] <ChrisMorgan> Thanks, dbaupp. That makes sense now.
[04:37:49] <strcat> dbaupp: oh
[04:37:51] <strcat> forgot to fix the runtime
[04:37:55] <strcat> it's a null ptr deref
[04:38:25] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[04:38:31] <dbaupp> strcat: something you can fix without a new snap?
[04:38:36] <strcat> it's fixed
[04:38:40] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[04:38:57] <dbaupp> ;D
[04:39:32] <strcat> dbaupp: https://github.com/mozilla/rust/pull/7955 r?
[04:39:36] <strcat> think it should be all good now
[04:40:01] *** Quits: huseby (huseby@moz-4E8C421A.husebyhome.com) (Ping timeout)
[04:40:26] <dbaupp> strcat: 800 deletions \o/
[04:41:09] <jmgrosen> i'm trying to change the colors on a window from a socket -- what's the best way to communicate from the socket to the window, which needs to update 60fps?
[04:41:20] <strcat> dbaupp: there are a few more things I can remove actually
[04:41:23] <strcat> sec
[04:41:25] <strcat> will just r=you
[04:41:29] <dbaupp> yup
[04:41:45] <strcat> #[non_owned]
[04:41:47] <sp3d> jmgrosen: ...have you considered the wayland protocol? ;)
[04:42:05] <jmgrosen> sp3d: haha :P
[04:42:07] *** Joins: huseby (huseby@moz-4E8C421A.husebyhome.com)
[04:42:18] <jmgrosen> i have the window, using OpenGL, working
[04:42:19] <sp3d> it's used for embedded cases like that by webkit
[04:42:55] <bjz_> Jeaye: did you have a chance to try glfw out?
[04:43:16] <dbaupp> jmgrosen: do you have reading-from-the-socket working in Rust?
[04:43:43] <Jeaye> bjz_: Not yet. I'm writing up some code right now that has q3 in a busted state. Once that's finished, I'll update Rust and all my submodules.
[04:43:47] <Jeaye> I'll let you know. ;)
[04:43:53] <bjz_> ok, cool
[04:44:01] <jmgrosen> dbaupp: i haven't tried yet -- i started with RWARCs, but haven't been able to get the capturing worked out yet, but i'll try it first without actually controlling the screen
[04:44:13] <bjz_> Jeaye: the implementation is much nicer behind the scenes now
[04:44:18] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[04:44:24] <bjz_> Jeaye: no fail cases
[04:44:37] <Jeaye> bjz_: Badass. Glad to see it's always improving. :)
[04:44:42] <Jeaye> I still need to look into those crashes.
[04:44:49] <Jeaye> Maybe they've been resolved!
[04:44:49] <dbaupp> bjz_: using the message passing, or not yet?
[04:44:57] <bjz_> no, not yet
[04:45:01] <bjz_> working on lmath
[04:45:20] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Ping timeout)
[04:45:33] <dbaupp> bjz_: (this is all working up to a game, right? ... have you even started, or are you still shaving all the yaks? :) )
[04:45:45] <bjz_> shaving yaks :)
[04:46:26] <bjz_> dbaupp: once I have some noise stuff I'll be able to have a landscape
[04:46:31] <jmgrosen> wait, net::tcp::listen is blocking? o_O
[04:46:39] <bjz_> dbaupp: which will be great
[04:46:51] <dbaupp> jmgrosen: you're "meant" to push things into little tasks
[04:47:13] <dbaupp> jmgrosen: (at least, I believe that's apart of the motivation for having such lightweight tasks.)
[04:47:22] <dbaupp> bjz_: :D
[04:47:37] <jmgrosen> dbaupp: hm, i knew that the callbacks were all called in one task, but didn't realize `listen` itself was on the same thread
[04:47:48] <dbaupp> oh
[04:47:55] <doomlord> passing @'s all over the place i still run into 'cannot move out of dereference of@ pointer'  errors :( i thought the gc stuff would be easier :)
[04:48:09] <dbaupp> doomlord: stop trying to move out of it then ;P
[04:48:15] <ChrisMorgan> jmgrosen: you know that extra::net::tcp is disappearing?
[04:48:26] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Quit: WeeChat 0.4.1)
[04:48:26] <dbaupp> doomlord: (use `ref` patten bindings)
[04:48:48] <jmgrosen> ChrisMorgan: it is? thank god :D but being replaced by what?
[04:49:07] <ChrisMorgan> jmgrosen: by what is currently std::rt::io::net::tcp
[04:49:43] <ChrisMorgan> For a very simple usage example, see http://stackoverflow.com/questions/17445485/example-tcp-server-written-in-rust/17473420
[04:49:52] <dbaupp> strcat: (what happened to #[mutable] and #[non_owned], btw?)
[04:50:29] <ChrisMorgan> In response to that question I've provided both old RT and new RT editions of the same server, so you can see the difference.
[04:50:31] * dbaupp wished SO had Rust syntax highlighting
[04:50:42] <strcat> dbaupp: #[no_freeze] and #[no_send]
[04:50:52] <dbaupp> strcat: oh.
[04:50:55] <jmgrosen> ChrisMorgan: o_O o_O o_O SO MUCH SIMPLER.
[04:51:02] * dbaupp was expecting something more than a renaming
[04:51:17] <ChrisMorgan> dbaupp: SO's syntax highlighting is altogether awful.
[04:51:29] <dbaupp> ChrisMorgan: but it's better than 0
[04:52:49] <ChrisMorgan> dbaupp: you know where to start: https://code.google.com/p/google-code-prettify/source/browse/#svn%2Ftrunk%2Fsrc
[04:53:28] * dbaupp already writes far too much js maintaining IRFY
[04:53:32] <doomlord> http://pastebin.com/tuT3BGKT<<< heres what i cant get working
[04:54:09] <dbaupp> doomlord: what's it complaining about?
[04:54:10] <strcat> dbaupp: hm, buildbot web UI is lagging like cray
[04:54:12] <strcat> crazy*
[04:54:20] <strcat> do you know offhand what the 3 failing tests are?
[04:54:50] <doomlord> main.rs:417:36: 417:38 error: mismatched types: expected `@syntax::ast::view_item` but found `&syntax::ast::view_item` <<for the code pasted, but every permuation of @ & ref i've tried produces various errors,usually 'can't move dereference out..'
[04:55:03] <dbaupp> strcat: http://buildbot.rust-lang.org/builders/auto-mac-64-opt/builds/511/steps/test/logs/stdio
[04:55:13] <dbaupp>     tests::rustpkg_library_target    tests::test_install_git    tests::test_package_version
[04:55:37] <dbaupp> doomlord: what's the problem with for m.view_items.iter().advance |vi|, btw?
[04:55:45] <jmgrosen> ChrisMorgan: so it looks like there's no file io in the new RT yet?
[04:55:45] <dbaupp> (rather than the while loop.)
[04:55:59] <ChrisMorgan> jmgrosen: that's what I've been led to believe
[04:56:09] <doomlord> i tried that originally - i figured it was passing &-pointer, and wondered if i needed to make a @pointer
[04:56:20] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[04:56:23] <jmgrosen> ChrisMorgan: awwâ€¦ I need both network IO and file IO :(
[04:56:40] <doomlord> i get more 'missmatched types' on various permutations there
[04:56:40] <jmgrosen> dbaupp: ok, so my socket stuff is working -- how should i talk to my OpenGL task?
[04:56:55] <dbaupp> doomlord: but the problem is view_item's are all stored as ~[view_item]
[04:56:58] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[04:57:16] <dbaupp> doomlord: so you'll have to create your own @view_item if you really want one
[04:57:18] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[04:57:27] <dbaupp> jmgrosen: std::comm?
[04:57:40] <dbaupp> jmgrosen: e.g. `stream()`?
[04:57:44] <ChrisMorgan> jmgrosen: sorry, thenâ€”you're stuck with extra::net::tcp for the moment; make sure you don't update your rust after https://github.com/mozilla/rust/pull/7883 is merged
[04:58:12] <jmgrosen> dbaupp: how do i get the color without blocking on a `recv`?
[04:58:20] <doomlord> main.rs:417:11: 417:14 error: cannot move out of dereference of & pointer
[04:58:20] <doomlord> main.rs:417 		let bvi=@*vi; <<< how to create a @view_item :(
[04:58:26] <jmgrosen> ChrisMorgan: alright, thanks for the help
[04:58:39] <dbaupp> jmgrosen: I think .peek checks if there is a message without blocking
[04:58:48] <dbaupp> doomlord: you need to copy it
[04:58:59] <dbaupp> doomlord: (well, clone it.)
[04:59:47] <jmgrosen> dbaupp: ah, hadn't noticed that :3
[04:59:59] <dbaupp> jmgrosen: that's what #rust is for :)
[05:00:41] <ChrisMorgan> #rust is the best thing since Rust.
[05:00:41] <doomlord> ok that compiles and runs now. but i think i made an un-necasery copy of the source to do so :)
[05:01:43] <doomlord> i think i'd prefer it to work with &'s but i'll need to figure out how to get a lifetime in a scope block, i think the original structure has @s aswell
[05:01:49] <doomlord> hmmm.
[05:03:04] <strcat> dbaupp: https://github.com/mozilla/rust/pull/7955 there
[05:03:49] <jmgrosen> how do i get a SharedChan?
[05:03:52] <dbaupp> strcat: (I think the normal "disable" is #[ignore], isn't it? but it doesn't matter)
[05:03:58] <dbaupp> jmgrosen: SharedChan::new()?
[05:04:01] * dbaupp doesn't know
[05:04:20] <jmgrosen> dbaupp: â€¦somehow i missed that. o_O again, #rust to the rescue :3
[05:04:29] <dbaupp> jmgrosen: I was guessing :P
[05:04:47] <mark_edward> yup, SharedChan::new()
[05:05:04] <mark_edward> SharedChan::new(chan) to be exact.
[05:05:17] <mark_edward> you need to pass an existing regular old chan
[05:05:46] <ChrisMorgan> Typical form would be `let my_ch = SharedChan::new(my_ch)`
[05:06:22] <mark_edward> rusti: use std::comm::*; let (port, chan): (Port<int>, Chan<int) = stream(); let schan = SharedChan::new(chan); 5
[05:06:22] -rusti- <anon>:7:65: 7:66 error: expected `,` but found `)`
[05:06:22] -rusti- <anon>:7          use std::comm::*; let (port, chan): (Port<int>, Chan<int) = stream(); let schan = SharedChan::new(chan); 5
[05:06:22] -rusti-                                                                           ^
[05:06:23] -rusti- application terminated with error code 101
[05:07:09] <mark_edward> im confused ?
[05:07:10] <dbaupp> rusti: use std::comm::*; let (port, chan) = stream(); let schan = SharedChan::new(chan); schan.send(1i); port.recv()
[05:07:12] -rusti- 1
[05:07:22] <dbaupp> mark_edward: you have `Chan<int)`
[05:07:27] <ChrisMorgan> You can't use the Chan instance afterwards, so it's best to just shadow it.
[05:07:49] <dbaupp> mark_edward: (also, unnecessary type hints :P )
[05:08:14] <mark_edward> rusti: use std::comm::*; let (port, chan) = stream(); let chan = SharedChan::new(chan); chan.send(1i); port.recv()
[05:08:16] -rusti- 1
[05:08:18] <ChrisMorgan> Note also that you still don't want to send on the SharedChan. You need to clone it suitably.
[05:08:23] <mark_edward> that works???
[05:08:39] <mark_edward> i don't like it :-[
[05:08:41] <dbaupp> mark_edward: which part is surprising?
[05:08:58] <mark_edward> that i can redeclare chan
[05:09:01] <ChrisMorgan> http://hg.chrismorgan.info/rusthttpserver/file/5ac0eedb3444/src/librusthttpserver/server.rs, with its perf_ch, shows an example of using SharedChan.
[05:09:11] <ChrisMorgan> mark_edward: sure you can, so long as you use let.
[05:09:12] <dbaupp> ChrisMorgan: (you *can* send on it though, it's just not that useful doing it in one task.)
[05:09:25] <dbaupp> mark_edward: you don't have to redeclare it
[05:09:27] <mark_edward> ChrisMorgan: i know, i've used it before
[05:09:47] <ChrisMorgan> dbaupp: I know you can send on it, but if you're doing that, you wasted your time creating a SharedChan.
[05:09:58] <dbaupp> ChrisMorgan: yes
[05:10:37] <dbaupp> ChrisMorgan: (although, you might split off a few worker tasks and also reuse the current one, in some instances.)
[05:11:10] *** Quits: cdidd (cdidd@moz-7CD01F40.broadband.corbina.ru) (Input/output error)
[05:12:58] <jmgrosen> can i clone a ~[SharedChan<T>] into a task?
[05:13:16] *** Joins: cdidd (cdidd@moz-8DE79444.broadband.corbina.ru)
[05:13:23] <ChrisMorgan> jmgrosen: take a look at the example I showed
[05:13:25] *** Joins: keret (Mibbit@26B17D2D.F725E9FD.A4E97CBD.IP)
[05:13:31] <ChrisMorgan> Sorry, not reading properly :-/
[05:13:57] <ChrisMorgan> Clone is shallow, so I don't think that would do what you wanted.
[05:14:14] <dbaupp> ChrisMorgan: it should still work
[05:14:16] <dbaupp> jmgrosen: yes
[05:14:28] *** Quits: keret (Mibbit@26B17D2D.F725E9FD.A4E97CBD.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[05:14:29] <ChrisMorgan> dbaupp: why would it work?
[05:14:35] <jmgrosen> dbaupp: and how?
[05:14:43] *** Quits: vladimir-lu (vladimir-l@moz-428433D9.cable.virginmedia.com) (Ping timeout)
[05:14:56] <dbaupp> ChrisMorgan: v.clone() clones everything that v owns, ~[x,y,z] owns x y z, @t doesn't own t. etc
[05:15:31] <dbaupp> jmgrosen: it should just be `let clone_chans = chans.clone(); do spawn { ... clone_chans.stuff() ... }`
[05:15:47] <ChrisMorgan> But that makes it not a shallow copy, surely.
[05:15:56] <dbaupp> ChrisMorgan: it's as shallow as it can be
[05:16:00] <jmgrosen> dbaupp: it has to be done outside of the spawn? so i can't clone it more than once?
[05:16:08] <dbaupp> jmgrosen: no you can
[05:16:17] <dbaupp> jmgrosen: you just have to clone a new one for each task
[05:16:26] <dbaupp> jmgrosen: (because it gets moved into the task.)
[05:16:56] <jmgrosen> dbaupp: but if i have an unknown number of tasks (from socket connections) ...?
[05:17:10] <dbaupp> jmgrosen: i.e. they're spawned in a loop?
[05:17:16] <jmgrosen> dbaupp: pretty much
[05:17:18] <dbaupp> jmgrosen: just clone in the loop too
[05:17:41] <jmgrosen> dbaupp: it's giving me "capture of moved value: `chains`"
[05:17:49] <dbaupp> jmgrosen: code?
[05:19:13] <jmgrosen> dbaupp: https://gist.github.com/jmgrosen/6051437
[05:20:45] <dbaupp> jmgrosen: where's the erorr?
[05:21:04] <dbaupp> *error
[05:21:26] <jmgrosen> dbaupp: refresh the gist
[05:21:41] <dbaupp> jmgrosen: oh, the clone needs to be outside the spawn
[05:22:14] <dbaupp> (also, general stylistic thing, `while true {}` => `loop {}` :) )
[05:22:22] <jmgrosen> dbaupp: ah, right :P
[05:22:27] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[05:22:28] *** ChanServ sets mode: +o dherman
[05:22:47] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[05:22:51] <dbaupp> jmgrosen: also, for (leds as uint).times { .. }
[05:23:03] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[05:23:45] <jmgrosen> dbaupp: ok, thanks
[05:24:15] <jmgrosen> dbaupp: after moving it outside the task::spawn, one of the error blocks goes away
[05:24:25] *** Joins: robertknight_ (robertknig@moz-AB0E96D7.range86-162.btcentralplus.com)
[05:24:39] <dbaupp> jmgrosen: but the others hang around?
[05:24:50] <jmgrosen> dbaupp: yeah -- i've updated the gist
[05:25:24] <dbaupp> jmgrosen: hm, you probably have to clone before the net::tcp::listen call too
[05:25:32] *** Joins: geomyidae (cole@DD6F7E3A.21468E9A.30200F38.IP)
[05:25:52] <jmgrosen> dbaupp: but then how do i clone it for each connection?
[05:25:54] <dbaupp> ChrisMorgan: does net::tc::listen accept each request in its own task?
[05:26:04] <dbaupp> jmgrosen: clone it twice
[05:26:31] <dbaupp> jmgrosen: (although, you possible don't need to clone for the inner one, after cloning just before listen)
[05:26:37] <ChrisMorgan> Yes, you have to call accept() in each callback.
[05:26:57] <ChrisMorgan> That is, it spawns the task when it receives a new connection, but you still have to accept it manually.
[05:27:47] <dbaupp> jmgrosen: you don't need the inner spawn
[05:27:57] <jmgrosen> dbaupp: ok
[05:30:50] *** Quits: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net) (Ping timeout)
[05:31:15] *** Joins: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net)
[05:31:37] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[05:31:37] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/VbtDIA
[05:31:37] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[05:31:41] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[05:31:57] * dbaupp hopes the snapshot passes
[05:32:08] <geomyidae> this (https://github.com/brson/rust/tree/io/src/libstd/rt/io/net) is newer than this (https://github.com/brson/rust/tree/io/src/libextra/net) right?
[05:33:32] <dbaupp> geomyidae: yes
[05:34:37] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[05:34:37] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/kO82mw
[05:34:37] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[05:34:39] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[05:34:39] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/vol6wg
[05:34:39] <ghrust> 13rust/06auto 14ed67cdb 15Daniel Micay: new snapshot
[05:34:39] <ghrust> 13rust/06auto 14f51e2ad 15Daniel Micay: temporarily disable 3 rustpkg tests...
[05:34:39] <ghrust> 13rust/06auto 1474f4bad 15bors: auto merge of #7955 : thestinger/rust/snapshot, r=huonw
[05:34:41] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[05:35:21] <geomyidae> dbaupp: oh my, is this tcp/udp fleshed out enough to put together play network apps?
[05:35:33] <dbaupp> geomyidae: ask ChrisMorgan
[05:35:54] <dbaupp> (he's writing a HTTP server, which is currently working, so I guess yes.)
[05:36:26] <geomyidae> "chrismorgan doesn't have any repositories you can view." :( :(
[05:36:41] <ChrisMorgan> geomyidae: at present, http://hg.chrismorgan.info/rusthttpserver
[05:36:58] <geomyidae> delightful. thanks.
[05:37:15] <ChrisMorgan> I had my HTTP server running on both, and it works fine. std::rt::io::net is distinctly faster that old RT and mostly a little more pleasant to work with.
[05:38:35] <dbaupp> (and also under active-ish development.)
[05:38:53] <dbaupp> (and most importantly; not about to be deleted.)
[05:39:03] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:39:05] <geomyidae> yeah, that's what I thought was most important :)
[05:39:09] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:39:21] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[05:39:23] <geomyidae> This is very cool, can't wait to try to grok this.
[05:41:17] <jmgrosen> is there a debug-ish way to tell if a task failed?
[05:41:33] <dbaupp> it normally prints it
[05:41:42] <dbaupp> rusti: do spawn { fail!() };
[05:41:46] -rusti- rust: task failed at 'explicit failure', <anon>:7
[05:41:46] -rusti- ()
[05:41:46] -rusti- rust: domain main @0x7fa420201f20 root task failed
[05:41:46] -rusti- application terminated with error code 101
[05:41:54] <jmgrosen> dbaupp, ok
[05:42:02] <dbaupp> rusti: do std::task::spawn_unlinked { fail!() };
[05:42:03] -rusti- ()
[05:42:03] -rusti- rust: task failed at 'explicit failure', <anon>:7
[05:45:04] <Jeaye> What did 'pub extern' become?
[05:45:12] <dbaupp> Jeaye: pub on each fn
[05:45:25] <Jeaye> thanks
[05:46:12] <Jeaye> Ohh, what if it's used without fn?
[05:46:20] <Jeaye> As in, just to link external libs?
[05:46:31] <Jeaye> pub extern { }
[05:46:31] <geomyidae> ChrisMorgan: are you or other working or planning to work on some sort of something like Gorilla's tools or at least something like a mux etc?
[05:46:33] <jmgrosen> dbaupp: i do need the inner spawn -- reading bytes isn't working without it -- but then how do i get the chans working?
[05:46:37] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[05:46:56] <geomyidae> ChrisMorgan: or is that potentially fair game for a "I should learn rust" project for me?
[05:47:20] <dbaupp> jmgrosen: oh, .clone just before the listen, and the just before the inner spawn?
[05:47:24] <dbaupp> (i.e. clone twice.)
[05:47:57] <dbaupp> Jeaye: I don't think the pub is necessary in that case
[05:48:12] *** Joins: mihneadb (mihneadb@moz-329F29A3.lightspeed.sntcca.sbcglobal.net)
[05:48:13] <dbaupp> Jeaye: i.e. the linker args get passed anyway? (I could very easily be wrong.)
[05:48:28] <jmgrosen> dbaupp: that worked, thanks
[05:48:51] * jmgrosen respects the all-knowing dbaupp
[05:49:11] * dbaupp is actually all-guessing
[05:49:26] <jmgrosen> all-guessing works for me when the guesses are always right :3
[05:49:27] <ChrisMorgan> geomyidae: I do intend to get to writing a framework on top of it, but naturally I need to start out with the server. If you want to build a framework or toolkit on top of it, go for it! If you want to work on the lower-level stuff, that'd be nice too.
[05:49:48] * dbaupp has apparently used Rust enough that his guesses are occasionally accurate
[05:50:31] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Quit: Leaving)
[05:50:47] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[05:51:02] <dbaupp> geomyidae: (there's no reason that duplicating work can't be a learning project... in fact, duplicating things in such a new language helps to explore the possible design choices that Rust allows.)
[05:52:58] <geomyidae> dbaupp: that's a good point anyway, writing a mux can't be that hard, especially since I'm sure I can read an easy Go one and translate. The design and Rust patterns/idiomatics is what more intimidates me.
[05:57:27] *** Quits: victorporof (victorporo@9D267AB6.30DB0DDD.9B1E38F4.IP) (Ping timeout)
[05:57:37] *** Joins: victorporof (victorporo@9D267AB6.30DB0DDD.9B1E38F4.IP)
[06:01:51] <dbaupp> geomyidae: you basically get to invent both of them at the moment.
[06:06:05] *** Quits: robertknight_ (robertknig@moz-AB0E96D7.range86-162.btcentralplus.com) (Ping timeout)
[06:06:21] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[06:11:55] <mark_edward> ChrisMorgan: can you link me your httpclient?
[06:13:04] <ChrisMorgan> mark_edward: haven't written one in Rust.
[06:13:32] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[06:15:22] *** Joins: vladimir-lu (vladimir-l@moz-428433D9.cable.virginmedia.com)
[06:16:12] <ChrisMorgan> There will be a fair amount of code in common between the two, though.
[06:19:08] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[06:21:57] <Jeaye> bjz_: The crash closing glfw-rs is gone!
[06:22:04] <Jeaye> Great work.
[06:22:48] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[06:22:49] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[06:24:57] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[06:26:31] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[06:30:03] *** Quits: naq (naq@D5C2D2DF.E4265FCD.E481B5B.IP) (Ping timeout)
[06:31:27] <Jeaye> Why would a ~[Foo] need a lifetime?
[06:31:37] <Jeaye> It's ~
[06:31:56] <mark_edward> ChrisMorgan: why don't you put your project on bitbucket too? they support mercurial, and it's got all the nice features like github
[06:32:47] <ChrisMorgan> mark_edward: it was simply faster and easier for me to put it on my own website, to start with. When I did it I only had a few minutes before I had to go somewhere.
[06:34:28] <mark_edward> i see.
[06:35:38] <mark_edward> ChrisMorgan: you're involved with PortableApps! that stuff was a lifesaver for me in highschool!
[06:36:06] <ChrisMorgan> mark_edward: well, I have been. I haven't done much there for the past year or so.
[06:36:20] <mark_edward> still, cool stuff man!
[06:36:24] *** Quits: igl (igl@moz-B3821D62.adsl.alicedsl.de) (Connection reset by peer)
[06:39:40] <bjz_> Jeaye: yayy!
[06:39:43] <Jeaye> ^_^
[06:39:47] <bjz_> Jeaye: dunno what I did
[06:39:51] <Jeaye> Me neither
[06:39:52] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[06:40:00] <bjz_> Jeaye: but simplifying things must have helped
[06:40:05] <Jeaye> But it closes cleanly now, which is a breath of fresh air.
[06:40:54] <bjz_> certainly
[06:41:20] <Jeaye> Do you know why line 4 would need a lifetime? https://gist.github.com/Jeaye/679c14daca2753759d1b
[06:42:12] <dbaupp> Jeaye: I'm guessing it's because MeshRendered contains borrowed pointers
[06:42:27] <dbaupp> (or contains other things that need lifetimes.)
[06:42:38] <Jeaye> It does contain &Mesh
[06:42:43] <dbaupp> Jeaye: so it sould be ~[MeshRenderer<'self>>]
[06:42:48] <dbaupp> s/>>/>/
[06:42:55] <Jeaye> Ohgawd
[06:43:07] <Jeaye> These lifetimes are a plague
[06:43:31] <Jeaye> I mean it with love, but they just spread everywhere.
[06:44:07] <dbaupp> yep
[06:44:09] <geomyidae> so, how and where to is serve_forever() wired up to? http://hg.chrismorgan.info/rusthttpserver/file/66390edc6b6c/src/examples/info.rs
[06:44:41] <ChrisMorgan> geomyidae: it comes from rusthttpserver::server::ServerUtil
[06:44:46] <Jeaye> dbaupp: So Mesh_Renderer needs 'self to describe how long it lives with regard to Model because Mesh_Renderer describes how long its internals live with regard to itself?
[06:44:51] <dbaupp> geomyidae: http://hg.chrismorgan.info/rusthttpserver/file/66390edc6b6c/src/librusthttpserver/server.rs#l73
[06:45:05] <ChrisMorgan> (It would come from Server but for a couple of bugs there mean it needs to be in a different thing.)
[06:45:11] <Jeaye> Model_Renderer, not Model
[06:45:54] <dbaupp> Jeaye: yes, Model_Renderer needs assert that everything that everything it refers to lasts for sufficiently long
[06:46:17] <dbaupp> Jeaye: (or, alternatively, restrict its validity to the validity of the things it refers to.)
[06:46:28] <dbaupp> Jeaye: (both are correct interpretations of lifetimes.)
[06:46:37] <Jeaye> aye
[06:46:50] <Jeaye> But only because Mesh_Renderer also has borrowed pointers
[06:46:54] <dbaupp> yes
[06:47:03] <Jeaye> Otherwise it's just POD, essentially.
[06:47:03] <geomyidae> Hm, so if I implement the traits Send Clone and Server, I automatically get serve_forever via Server(Util).
[06:47:11] <dbaupp> Jeaye: right
[06:47:23] <Jeaye> Either that or managed
[06:47:29] <Jeaye> Like the shader
[06:47:39] <geomyidae> So does Send -> handle_request and Server -> get_config ?
[06:47:50] <geomyidae> I guess I know enough to look at the code, sorry. talking aloud
[06:47:51] <Jeaye> Ok, that's reasonable. Thanks again, dbaupp.
[06:47:55] <dbaupp> Jeaye: yeah. (I guess having a destructor makes it not POD, but not in the sense we're interested in here.)
[06:48:11] <Jeaye> aye
[06:48:45] <dbaupp> geomyidae: Send is a builtin trait that describes when something can be transferred between tasks.
[06:49:09] <geomyidae> oh dear
[06:49:21] <geomyidae> Let me revisit that advanced topic page quickly :)
[06:50:41] <dbaupp> geomyidae: (Server provides both handle_request and get_config, http://hg.chrismorgan.info/rusthttpserver/file/66390edc6b6c/src/librusthttpserver/server.rs#l22 )
[06:51:24] <geomyidae> dbaupp: yup, I got that one figured out, I just don't see any other methods being called that I would guess are related to the Send trait
[06:51:42] <geomyidae> dbaupp: also, haven't found the docs for the Send trait yet, it wasn't where I thought :P
[06:51:52] <dbaupp> http://static.rust-lang.org/doc/std/kinds.html
[06:52:22] <ChrisMorgan> http://static.rust-lang.org/doc/rust.html#type-kinds
[06:53:41] <dbaupp> geomyidae: (Send doesn't have any methods, it's just implicitly used when moving into (e.g.) the closure for spawn.)
[06:58:35] *** Quits: mihneadb (mihneadb@moz-329F29A3.lightspeed.sntcca.sbcglobal.net) (Quit: Leaving)
[06:59:55] <geomyidae>  I think it clicked. Why are send and clone not redundant then?
[07:00:43] *** Joins: cataska (cataska@33ED961D.66EB4E1A.98A751AA.IP)
[07:01:03] <geomyidae> send is just implicit signaling, hm okay
[07:02:02] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[07:04:44] <ChrisMorgan> What does ! mean as a function return type? fn()->!{...}
[07:06:10] <sp3d> "doesn't return"
[07:06:21] <sp3d> presumably it loops forever or fail!s
[07:06:26] <dbaupp> e.g. fail!() and abort() are -> !
[07:08:47] <kemurphy> is there an attribute i can use to tell the linker to put e.g. a static item into a certain section
[07:09:00] <ChrisMorgan> Good, that's what I presumed it to mean.
[07:09:01] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[07:09:16] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[07:10:36] <dbaupp> kemurphy: I don't think so yet
[07:11:35] <kemurphy> dbaupp: is it a desired feature, and is anyone working on it/is there an open issue?
[07:11:48] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[07:12:15] <dbaupp> kemurphy: I assume it's "desired" in the sense that a pull request adding it will get merged, and I don't know.
[07:12:46] <kemurphy> dbaupp: cool. do you know where in the compiler section placement is handled?
[07:13:10] <dbaupp> no idea, I'd assume it's some metadata that we should set to pass to LLVM
[07:13:36] <dbaupp> I'd guess librustc/middle/trans/item.rs (if it exists.)
[07:14:00] <kemurphy> yeah, i was gonna look in trans first if you didn't know
[07:14:23] <dbaupp> const.rs would probably be astart
[07:14:26] <dbaupp> *a start
[07:14:33] <dbaupp> *consts.rs
[07:14:35] <kemurphy> a quick grep -i rodata didn't show anything useful
[07:14:54] <kemurphy> anyway, /me -> dig
[07:15:05] <kemurphy> thanks
[07:15:16] <dbaupp> kemurphy: trans_item is on base.rs:2136
[07:15:42] <dbaupp> kemurphy: I guess you can use that to add the placement data on consts and fns
[07:15:56] <dbaupp> (assuming that adding it on fns is relevant.)
[07:16:23] <kemurphy> i don't see why not, i think it's reasonable to maybe want to put some fn in .boottext instead of .text, for example
[07:16:42] <dbaupp> yeah
[07:20:58] *** Joins: Ms2ger (Ms2ger@E699BE68.4A4AF98A.F15B0BB3.IP)
[07:21:04] <ChrisMorgan> How can I tell the capacity of a &mut [u8]?
[07:22:03] <Luqman> i think there was a capacity method
[07:22:35] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[07:22:35] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/vol6wg
[07:22:35] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[07:22:46] *** Joins: strcat1 (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[07:22:48] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[07:22:52] <strcat1> ChrisMorgan: it doesn't have a capacity
[07:22:56] <strcat1> it's a pointer and a length - only a view of an existing vector
[07:23:03] *** strcat1 is now known as strcat
[07:23:09] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[07:23:23] <dbaupp> ChrisMorgan: if you do need a reference to a vector you can append to: &mut ~[u8[
[07:23:32] <dbaupp> *]
[07:23:55] <ChrisMorgan> Then, with std::rt::io::net, how does it determine how much it should read with read(&mut self, buf: &mut [u8])?
[07:24:16] <ChrisMorgan> Silly me... "Read bytes, up to the length of `buf` and place them in `buf`."
[07:25:03] <strcat> dbaupp: snapshot landed :)
[07:25:11] <dbaupp> strcat: :D
[07:25:30] * dbaupp gets to use default methods more
[07:25:35] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[07:25:35] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/uwL0ww
[07:25:35] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[07:25:38] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[07:25:38] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/hOql6g
[07:25:38] <ghrust> 13rust/06auto 143b10e93 15Michael Woerister: Adapted `trans::common::{block, fn_ctxt, scope_info}` to new naming convention.
[07:25:38] <ghrust> 13rust/06auto 142051574 15bors: auto merge of #7848 : michaelwoerister/rust/trans_cleanup_1, r=jdm...
[07:25:38] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[07:26:05] <kemurphy> is section name part of the llvm module context?
[07:26:12] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[07:27:44] <dbaupp> kemurphy: you could look at how clang handles it (assuming you're ok with more source diving.)
[07:28:54] <dbaupp> kemurphy: https://github.com/llvm-mirror/clang fwiw
[07:29:20] <acrichto_> kemurphy: if you're looking to add this to the compiler, you'd probably want the LLVMSetSection function
[07:29:35] *** Quits: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net) (Quit: zzz)
[07:31:05] <kemurphy> acrichto_: yup, that looks like what i want. thanks!
[07:31:26] <acrichto_> kemurphy: llvm-c/Core.h has many wonders within :)
[07:31:48] <kemurphy> would around trans/base.rs:2461 be the right spot to put the attr check?
[07:31:50] <dbaupp> kemurphy: (also, it should probably be #[section=".rodata"], or whatever, which you can get with i.attrs.name_value_str(), I think.)
[07:32:32] <kemurphy> dbaupp: awesome. so, definitely just "section" as opposed to something like, "link_section"?
[07:33:02] <dbaupp> oh, don't know about name. I was meaning the general syntax/extraction procedure
[07:33:26] <kemurphy> oh, gotcha. yeah, i figured as much :)
[07:33:58] <kemurphy> acrichto_: yeah, i'm surprised that my various googles didn't point me at that *shrug*
[07:35:17] <dbaupp> kemurphy: but yes, that'd be the right spot. not sure #[link_section] makes sense for things like mod or struct, does it?
[07:35:47] <dbaupp> oh, wait, that's just for constants
[07:35:49] <kemurphy> dbaupp: no, i don't think so. i just envisioned static, static mut, and fn
[07:35:57] <dbaupp> yeah, sounds good.
[07:36:58] *** Joins: naq (naq@D5C2D2DF.E4265FCD.E481B5B.IP)
[07:37:29] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[07:38:05] <kemurphy> heh, "register_fn_fuller"
[07:38:46] <Luqman> full and fuller :D
[07:39:41] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[07:41:35] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Quit: jmgrosen)
[07:42:07] <dbaupp> kemurphy: (also, I lied about i.attrs.name_value_str(), you'll have to search for an attribute with .name() == "section", and then call .value_str() on it, can probably add it to syntax::attr near find_linkage_metas, I guess.)
[07:42:36] <Ms2ger> "If you find yourself writing a function with the word “fuller” at the end, I suggest you take a step back and think about the life choices that led you here."
[07:44:41] <dbaupp> http://aatch.github.io/blog/2013/06/19/paying-technical-debt-in-rustc/, right?
[07:44:45] <kemurphy> dbaupp: what about attr::contains_name?
[07:45:41] <dbaupp> kemurphy: that's just a check to see if the item has #[link_section] or #[link_section="foo"] or #[link_section(foo)], it doesn't actually give you the attribute that it corresponds to
[07:45:54] <Ms2ger> Yeah
[07:45:56] <kemurphy> right, but i mean to check if it's there
[07:46:31] <kemurphy> oh
[07:46:37] <kemurphy> nvm, /me parse fail
[07:47:56] <kemurphy> dbaupp: looks like first_attr_value_str_by_name would do the trick
[07:52:08] <dbaupp> right, yes
[08:00:16] *** Joins: jaen (jaen@moz-59F96A32.neoplus.adsl.tpnet.pl)
[08:00:39] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Ping timeout)
[08:01:38] <ChrisMorgan> How do I load src/etc/zsh/_rust so I get fancy completion for rustc in zsh?
[08:02:23] *** Quits: graydon (graydon@moz-1C52C8D0.cable.teksavvy.com) (Ping timeout)
[08:03:19] <klutzy> ChrisMorgan: I think this will work: fpath=($fpath /path/to/rust/src/etc/zsh)
[08:03:24] <klutzy> in your zshrc
[08:05:13] <ChrisMorgan> Thanks, that's working.
[08:06:23] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[08:08:03] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[08:08:11] <kemurphy> dbaupp: presumably i should write a tiny test using the new attr that like, makes sure it compiles or somesuch?
[08:09:02] <kemurphy> rustc has zsh completion now? :D
[08:10:57] *** Quits: victorporof (victorporo@9D267AB6.30DB0DDD.9B1E38F4.IP) (Ping timeout)
[08:15:13] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[08:16:09] *** Joins: z0w0 (zack@moz-E12708D5.lns6.woo.bigpond.net.au)
[08:18:23] *** Joins: doener (bs@moz-AA189A5A.unitymedia.biz)
[08:21:59] <dbaupp> kemurphy: yes
[08:22:01] *** Joins: CarpNet (ac@moz-FD24B77.sohonet.co.uk)
[08:22:35] <dbaupp> kemurphy: it'd be neat to write a test that it actually ended up in the right section, but that might be tricky
[08:23:32] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:26:41] <kemurphy> dbaupp: would the test be able to call out to an llvm tool that could read the generated binary, or would we have to rely on the system having readelf/objdump/whatever-you-use-for-mach-o/etc
[08:29:23] <dbaupp> kemurphy: hm, not sure. I'd guess you could just not bother with an automated test (but verify by hand, etc), and file an issue about it.
[08:31:05] <dbaupp> (i.e. when after lands, file "link_section needs test" or something.)
[08:31:39] <dbaupp> kemurphy: and/or ask graydon, who knows more about what compiletest can/should do
[08:32:20] <kemurphy> dbaupp: ok, yeah that sounds easier/better
[08:32:55] *** Joins: mye (mye@moz-4DC329CE.dip0.t-ipconnect.de)
[08:38:57] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:46:53] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[08:46:58] <kemurphy> dbaupp: okay so it works, but there's one (unsurprising) caveat
[08:47:29] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[08:47:39] <kemurphy> if you stick a static mut and a static in the same section, and the static was declared first, and you try to modify the static mut, you segfault
[08:48:36] <dbaupp> what type of segfault?
[08:48:45] <kemurphy> any reason to bother enforcing separate sections, or just pass it off as "we told you it was unsafe :P"
[08:48:54] <kemurphy> trying to write to a read-only page
[08:49:09] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[08:49:17] <kemurphy> readelf shows the section is read-only when the static comes first
[08:49:23] <kemurphy> when the static mut comes first it's writable
[08:49:58] <dbaupp> I'd guess a static mut going in any section should make it writeable?
[08:50:10] <dbaupp> (what do C compilers do?)
[08:50:24] * kemurphy hacks up an example
[08:54:52] <kemurphy> lol.c:4:10: error: bar causes a section type conflict with foo
[08:54:53] <kemurphy>  unsigned bar __attribute__ ((section ("boot"))) = 15;
[08:55:14] *** Quits: geomyidae (cole@DD6F7E3A.21468E9A.30200F38.IP) (Quit: Konversation terminated!)
[08:55:24] *** Joins: geomyidae (cole@DD6F7E3A.21468E9A.30200F38.IP)
[08:55:35] <kemurphy> gcc errors with ^
[08:55:42] <kimundi> cmr: Old re: "So.. why hasn't anyone wrote a robust cross-platform C library to handle this yet?" I'd guess the main problem is that a correct one is not performant (Needs bignum fractionals).
[08:55:43] <kemurphy> clang accepts it and segfaults
[08:56:01] <kemurphy> dbaupp: ^
[08:57:43] *** Quits: heftig (heftig@6835D69C.6FC4DE2F.FEC4A986.IP) (Quit: Quitting)
[08:58:11] *** Joins: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP)
[09:00:35] * kemurphy thinks it's llvm's problem, fwiw
[09:01:37] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[09:04:28] <kemurphy> also, it does the right thing when you mix rodata and text
[09:09:05] <joshua_> kemurphy, hmm, having *two* rust-tangentially-associated people at work... maybe we could *actually* convince someone to follow up on eholk's work!
[09:09:14] *** Joins: victorporof (victorporo@7EA800E4.67625325.D111398B.IP)
[09:09:35] <kemurphy> joshua_: what are you referring to? i am in and out of the loop
[09:10:08] <joshua_> eholk wrote a CUDA PTX backend target for rustc at some point as a research project
[09:10:16] <kemurphy> *drool*
[09:10:55] <kemurphy> yeah, i bet i could convince my manager to allocate that somewhere after my current project matures a bit more
[09:10:59] <joshua_> I should say 'eholk et al', because it is certainly not fair to list him as the only one
[09:11:40] <kemurphy> sure, of course
[09:11:56] <joshua_> http://www.cs.indiana.edu/~eholk/papers/hips2013.pdf
[09:11:57] <kemurphy> but yeah, that would be awesome if we could get some sort of blessed work on that happening
[09:12:35] <kemurphy> oh, i remember reading that, didn't realize eholk's name was on it
[09:23:28] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[09:27:43] *** Quits: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP) (Quit: Leaving.)
[09:30:00] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[09:32:09] *** Joins: true_droid (Adium@moz-123FD9B8.beck.volia.net)
[09:32:25] *** Joins: kendle (Mibbit@moz-ECA15484.campus.fu-berlin.de)
[09:33:38] *** Quits: kendle (Mibbit@moz-ECA15484.campus.fu-berlin.de) (Quit: http://www.mibbit.com ajax IRC Client)
[09:37:09] <kemurphy> r? https://github.com/mozilla/rust/pull/7958
[09:39:34] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[09:41:31] *** Quits: Kauhsa (kauhsa@moz-A78B2D1A.fi) (concrete.mozilla.org gravel.mozilla.org)
[09:41:31] *** Quits: jhark (jhark@moz-B9920504.jhark.net) (concrete.mozilla.org gravel.mozilla.org)
[09:44:12] <doomlord> latest gem from lpapp.
[09:44:29] <doomlord> he can't understand why you bloated 'switch' with => instaed of :
[09:45:40] <doener> doomlord: where's that?
[09:47:50] <doomlord> http://pastebin.com/26m10XGE
[09:48:18] <doomlord> so far his main criticisms of rust are... "fn " , and now "=>"  :)
[09:49:13] *** Joins: sigma (sigma@CB3F6051.C886FCFF.DF0EE696.IP)
[09:49:25] <Deewiant> Speaking of syntax stuff...
[09:49:35] <Deewiant> rusti: fmt!("foo").len()
[09:49:36] -rusti- <anon>:7:20: 7:21 error: unexpected token: `.`
[09:49:36] -rusti- <anon>:7          fmt!("foo").len()
[09:49:36] -rusti-                              ^
[09:49:36] -rusti- application terminated with error code 101
[09:49:38] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[09:49:38] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 142051574 to 1474f4bad: 02http://git.io/N3iJvQ
[09:49:38] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[09:49:40] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[09:49:40] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/YUxePA
[09:49:40] <ghrust> 13rust/06auto 14634eddb 15Alex Crichton: Allow all warnings in stage0 to account for bugs
[09:49:40] <ghrust> 13rust/06auto 1440a48e6 15bors: auto merge of #7957 : alexcrichton/rust/ignore-warnings, r=thestinger...
[09:49:40] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[09:49:44] <Deewiant> Why is that an error?
[09:50:13] <Deewiant> rusti: (fmt!("foo").len())
[09:50:14] -rusti- 3
[09:50:34] <StarLight> rusti: (fmt!("foo")).len()
[09:50:35] -rusti- 3
[09:51:58] <Deewiant> It doesn't seem like a precedence issue, since it works if you wrap the whole thing in parens or put it in a tuple or whatever
[09:52:03] *** Joins: jdeng (Mibbit@moz-6548813B.blktn6.nsw.optusnet.com.au)
[09:53:12] <jdeng> @lilac it will probably require a snapshot, because it's the quote_item from the old version of the compiler (where lifetimes were still idents) trying to interface with the new libsyntax (where lifetimes are Names).
[09:53:29] <jdeng> How to get a snapshot?
[09:53:57] <doener> Deewiant: (fmt!("foo")).len() expands to ({ let __fmtbuf = ~"foo"; __fmtbuf }).len();
[09:54:39] <doener> Deewiant: without the parens, it would be invalid. You could argue that the expansion should include the parens though. Maybe file an issue?
[09:55:03] <kimundi> rusti: {let x = ~"foo"; x}.len()
[09:55:04] -rusti- 3
[09:55:14] <kimundi> that's not the problem
[09:55:19] <StarLight> well, that was unexpected
[09:55:26] <Deewiant> heh
[09:55:53] <kimundi> The problem is thaet macros and syntax extensions at the start of a line get pansed as statements instead of expressions
[09:55:59] <doener> kimundi: oh right... blocks are expressions
[09:56:04] <kimundi> parsed*
[09:56:08] *** Joins: Kauhsa (kauhsa@moz-A78B2D1A.fi)
[09:56:10] <Deewiant> Ah, that makes sense
[09:56:21] <Deewiant> Is it necessary for some reason?
[09:56:25] <kimundi> It's an annoying limitation :)
[09:56:29] <kimundi> Dunno
[09:56:36] <kimundi> might be
[09:56:49] *** Joins: jhark (jhark@moz-B9920504.jhark.net)
[09:57:59] <kimundi> I think the reason could be that rustc has to make a definite decision in those cases because else it couldn't parse the following code without expanting the macro
[09:58:01] <Deewiant> I guess it's necessary if LL(1) is a goal, as I believe it is
[09:58:15] <kimundi> expanding*
[09:59:57] <kimundi> foo!().bar() => would parse if foo!() expands to an expression, wouldn't parse if foo!() expands to an item
[10:00:00] <Deewiant> Yep, seems sensible
[10:01:16] <Deewiant> Although (foo!().bar()) won't parse either if foo!() doesn't expand to an expression, so I guess it has to have some post-expansion parsing anyway?
[10:02:47] <Deewiant> I'm thinking along the lines of: what would break if foo!() were always assumed to be an expression first
[10:07:14] <kemurphy> is there any way to set the discriminator values for enums that aren't c-like?
[10:07:35] *** Quits: sigma (sigma@CB3F6051.C886FCFF.DF0EE696.IP) (Ping timeout)
[10:10:34] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[10:10:43] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Input/output error)
[10:11:32] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[10:14:02] *** Quits: jdeng (Mibbit@moz-6548813B.blktn6.nsw.optusnet.com.au) (Quit: http://www.mibbit.com ajax IRC Client)
[10:19:30] *** Joins: Earnestly (earnest@2AB30F53.FB5005.2BCC804A.IP)
[10:23:14] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[10:24:23] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[10:24:57] *** Joins: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP)
[10:27:18] <kimundi> Deewiant: I think the difference that foo in (foo!()).bar() HAS to be an expression, while in foo!().bar() it could be either. Remeber, it can't look ahead to the bar() for deciding that or else it would be unlimited lookahead
[10:28:21] <Deewiant> kimundi: But why does it need to know which it is before expanding foo?
[10:30:01] <kimundi> because they represent different things internally. I don't really know about the details myself, I'm trying to think of a good example...
[10:32:33] <kimundi> rusti: -5
[10:32:45] <Deewiant> He's gone again
[10:33:46] <Deewiant> Either foo!() expands to an expression, allowing both plain foo!() (since expressions are statements) and foo!().bar(), or foo!() expands to a statement, which again allows foo!() while foo!().bar() errors out when it gets expanded
[10:34:25] <Deewiant> I presume I'm missing something, I just don't know what
[10:34:40] <kimundi> Deewiant: It needs to know it before expanding because that means it doesn't need to expend macros during parsing
[10:35:32] <Deewiant> kimundi: It never "knows" it, it just makes an educated guess, e.g. in (foo!().bar()) it thinks foo!() is an expression because that's the only thing allowed there but that doesn't mean that foo!() necessarily expands to an expression
[10:35:58] <kimundi> Deewiant: No, it has to expand to an expression or be an syntax error
[10:36:01] <Deewiant> I.e. it still has to expand them while being prepared for failure at a later stage
[10:36:22] <kimundi> They are different grammars
[10:36:48] <kimundi> what you are allowed to write in a item is different to what you are allowed in an expression
[10:36:52] <Deewiant> kimundi: Right, so it's an error if it's not an expression; likewise in foo!().bar() the foo!() could be an error if it's not an expression
[10:37:09] <Deewiant> But that doesn't mean the parser knows it when it encounters foo!().bar()
[10:37:18] <kimundi> and that has implications to what is coming afetrwards, and about how the AST is build
[10:37:29] <Deewiant> Sure
[10:38:20] <kimundi> Maybe it's actually not an issue and it can be fixed like you think, I just don't know :(
[10:38:33] <Deewiant> But when we're looking at just a line saying foo!().bar() the alternatives are error (what happens now) or (pseudo) statement(dotexpression(foo!(), bar()))
[10:39:06] <Deewiant> Whereas with just foo!() it's statement(expression(foo!())) or expression(foo!())
[10:39:29] <Deewiant> And it's always possible for foo!() to expand to the "wrong" thing later on and cause an error
[10:39:48] <kimundi> hum, I 'm talking about items, not statements
[10:40:13] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[10:40:33] <kimundi> pauls: ping
[10:40:44] <Deewiant> I'm not sure that items affect the issue
[10:42:01] <kimundi> Deewiant: I think the important part here is that the devs want a clear compiler desing
[10:42:23] <kimundi> parisng->ast->...->macro expansion->...
[10:42:30] <Deewiant> Yes sure
[10:42:51] <Deewiant> I don't think that this implies that that would have to change
[10:43:02] <kimundi> and item macror vs expression macro result in different ast nodes
[10:44:41] <kimundi> basically, I think it checks errors that result from it being an item where an expression shuold be or otherway round before actually expanding the macros.
[10:45:09] <kimundi> wich means if the macro could be both it'd have to do the same afterwards
[10:45:09] <Deewiant> My point is that it has to do some kind of checking after expanding macros as well
[10:45:25] <Deewiant> So why not defer this check as well
[10:45:28] <kimundi> not if you have strict rules
[10:45:43] <dbaupp> Deewiant: I think it's a actually bug
[10:46:20] <dbaupp> *actually a
[10:46:33] <Deewiant> dbaupp: I guess I'll file an issue about it then?
[10:47:15] <dbaupp> Deewiant: yeah... at least it'll get more eyes onto it, and someone who knows what the final design is meant to be can make a decision.
[10:47:28] <Deewiant> dbaupp: Alright, thanks
[10:47:54] <dbaupp> that said, what kimundi says about item vs expression macros is strue.
[10:47:56] <dbaupp> *true
[10:48:03] * dbaupp cannot type tonight
[10:48:15] <Deewiant> kimundi: I think with such strict rules macros would be much more limited
[10:48:22] *** Joins: gavinb (gavinb@729F1EF6.91478B6C.6F50E8A8.IP)
[10:48:44] <kimundi> doesn't seem much like a limit to me
[10:48:44] <Deewiant> Granted I don't really know anything about their capabilities currently
[10:50:08] <Deewiant> Well you'd need to statically guarantee that they always expand to a semantically valid expression/statement/item/whatever, and only that, and know it beforehand
[10:50:34] <kimundi> wich is what it does right now
[10:50:36] <Deewiant> Only then could you avoid any kind of error checking (except type checking) after macro expansion
[10:50:40] <smvv> does someone known when strcat is generally online? i would like to ask him if he could give some pointer about where to start with https://github.com/mozilla/rust/issues/6750
[10:51:42] <dbaupp> smvv: he's not only from a few hours ago to a few hours in the future
[10:51:54] <dbaupp> but seems to be mostly online other than that.
[10:52:06] <Deewiant> kimundi: Actually, then if it knows from beforehand that it's an expression, this whole problem is avoided :-)
[10:52:09] <kimundi> Deewiant: The current rule ensure that a macro expansion results in syntactically correct rust code in the correct subgrammar for the place in the ast it's in.
[10:52:27] <smvv> dbaupp: ok ty
[10:52:27] <dbaupp> kimundi: not quite true
[10:52:46] <kimundi> dbaupp: Okay, then I shuold stop bullshitting here xD
[10:52:58] <dbaupp> smvv: iirc, he was suggesting writing it in Rust, and providing a wrapper to allow LLVM to call it
[10:53:45] <kimundi> I don't know anything about the system really... Just trying to remeber what I've read here before
[10:54:18] <smvv> dbaupp: there are two approaches; set metadata on instructions and use llvm's tbaa, or implement tbaa specific to rust
[10:54:33] <dbaupp> kimundi, Deewiant: e.g. `macro_rules! item(() => { fn foo() {} }) fn main() { (item!()).len() }`
[10:54:47] <dbaupp> that parses fine, but there's an error caught during expansion.
[10:55:07] <dbaupp> smvv: I believe that tbaa specific to rust will be the gold standard
[10:55:17] <dbaupp> smvv: (so that's what we should be trying to do.)
[10:55:22] <dbaupp> smvv: but I don't really know.
[10:55:54] <dbaupp> (i.e. I don't know how to implement it, or if llvm's tbaa will be good enough to capture all the aliasing info rustc has.)
[10:56:15] <gavinb> What is the idiomatic way of storing a ~[u8] result into a fixed size buffer [u8, ..16] ? transmute? vdc::copy_from??
[10:56:17] <dbaupp> kimundi, Deewiant: it's caught after expansion, as far as I can tell.
[10:56:29] <Deewiant> dbaupp: Seems so, since --parse-only doesn't catch it.
[10:57:34] <dbaupp> gavinb: do you have an "empty" [u8, .. 16]?
[10:57:56] <dbaupp> gavinb: (or are you trying to create a new one out of your ~[u8]?)
[10:58:11] <gavinb> dbaupp: well not really; this is in a 'new' function, so I'm about to populate a struct.
[10:58:37] <dbaupp> ah, so new takes a ~[u8]?
[10:58:52] <dbaupp> gavinb: (some code would be helpful :) )
[10:58:58] *** Quits: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net) (Ping timeout)
[10:59:25] <gavinb> dbaupp: sorry, on train! :) Which pastebin do ppl normally use here?
[10:59:44] *** Quits: Jesin (Jessin_@moz-3AD6F09F.res.lehigh.edu) (Quit: Leaving)
[10:59:47] <dbaupp> gavinb: pastebin.com or gist.github.com... doesn't really matter
[11:00:13] <smvv> dbaupp: i think means populating a fixed buffer with elements of a ~[u8] vector
[11:00:16] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[11:00:19] <smvv> he means*
[11:01:12] *** Joins: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net)
[11:01:37] <gavinb> I think he does!
[11:01:39] <gavinb> dbaupp: http://pastebin.com/h31YaEdx
[11:02:21] <dbaupp> gavinb: aha, bytes is a [u8, .. 16]?
[11:02:27] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[11:02:31] <gavinb> yes
[11:03:07] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[11:03:24] <dbaupp> I think `let mut uuid = UUID { bytes: [0, .. 16] }; vec::bytes::copy_memory(uuid.bytes, ub, 16);` is the way to go
[11:04:12] <gavinb> aha! I didn't realise that was the syntax for creating an empty array. Cool, thanks!
[11:04:29] <doomlord> is it actually possible to create a managed box that is a component of another managed box, ... eg  struct Foo { a:Bar,b:Baz }   ...  p:@Foo ....     let q:@Baz=@x.b;
[11:05:18] <doomlord> i'm not sure if it should even be possible, since  'q' would really have to say 'keep p in scope' ?
[11:05:30] <dbaupp> rusti: let x = @1; let y = @@x; let z = @@@@@y; z
[11:05:31] -rusti- @@@@@@@@1
[11:05:33] <gavinb> dbaupp: woohoo! works :) thanks mate
[11:05:40] <dbaupp> gavinb: np :)
[11:05:46] *** Quits: gavinb (gavinb@729F1EF6.91478B6C.6F50E8A8.IP) (Quit: gavinb)
[11:05:52] <dbaupp> doomlord: oh
[11:05:59] <doomlord> yes struct *component* :)
[11:06:26] <dbaupp> doomlord: what that does is copy x.b into a new box, it's different to x.b
[11:06:52] <doomlord> right thats a bad thing, if x.b happens to be somethnig like an entire AST :)
[11:06:54] <dbaupp> (or move it into the new box, destroying the rest of `x`, depending if it can be implicitly copied or not.)
[11:07:11] <doomlord> i'm tempted to give in and write this in unsafe { ... } :)
[11:07:35] <doomlord> the original structure has @s ... and i'm certainly confused about when you can & @s
[11:07:38] <dbaupp> well, not that bad, because most of the ast is hidden behind @'s, and only .deep_clone() will copy through that
[11:07:42] *** Joins: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net)
[11:07:53] *** Quits: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net) (Ping timeout)
[11:08:09] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[11:08:18] <dbaupp> doomlord: (I have this feeling, without seeing the code, that you're making things too complicated for yourself, if you're having to rebox subsections of the ast... I could be wrong though.)
[11:08:57] <doomlord> its possible; i have the dual unfamiliarty of rust and someone elses AST code after programming myself with clang
[11:09:16] <doomlord> i think what i'm trying to do is make a traversal look more like libclang traversal :)
[11:09:18] <dbaupp> haha, yeah :)
[11:09:41] *** Joins: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net)
[11:11:05] <doomlord> its this "get node from span" ("node" could be *anything*, view_item / expr  / item) )
[11:11:24] <dbaupp> aha, what's the biggest sticking point?
[11:11:46] <doomlord> so i've wrapped  "enum MyAstNode {   ViewNode(), Item(), Expr() }"  - thats  what my query will return
[11:12:06] <doomlord> the sticking point is as discussed - i dont think i've mastered mixing & and @ at all
[11:12:50] <doomlord> originally i tried to write it passing &'s for intermediates which would make more sense but i couldn't figure out how to get  a region/lifetime for the initial call working.
[11:12:53] <dbaupp> oh, for actually doing the traversal? have you had a look at examples of using syntax::visit?
[11:13:12] <dbaupp> (are you using syntax::visit?)
[11:13:24] <doomlord> yeah. maybe i'm NIH-ing but it seemed i'd have to write quite alot of the same code as a new traversal
[11:13:31] <doomlord> i'll pastebin what i'm trying , 1min..
[11:13:55] <doomlord> keep the goal in mind. source location -> Node (could be anything)
[11:14:13] <Deewiant> kimundi, dbaupp: In case you want to comment on it: I opened #7965
[11:14:25] *** Quits: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net) (Ping timeout)
[11:14:56] * dbaupp adds some labels
[11:15:25] *** Joins: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net)
[11:15:25] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[11:15:31] <doomlord> http://pastebin.com/uaiYsMRm <<< 
[11:16:17] <doomlord> i'm still in the habit of writing code backwards to avoid prototyping in C , lol. the outermost function is at the bottom
[11:16:43] <dbaupp> ok, just for context, https://github.com/mozilla/rust/blob/master/src/librustc/middle/effect.rs is a pretty small example of using syntax::visit
[11:17:46] <doomlord> i've worked something derived from  cmr's  code and have used syntax::visit somewhere else ..  maybe i'll have another bash at that but i found the wrapping in a fake vtable a bit long winded
[11:17:58] *** Quits: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net) (Ping timeout)
[11:18:32] <doomlord> i figured with this i just have an extra "match" to get from the 'MyAstNode() to the individual cases, where in the syntax::visit i would be submitting seperate closures 
[11:18:42] <dbaupp> you should only need to define the methods that do something special.
[11:19:14] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[11:19:24] <doomlord> everything needs to acess 'span' slightly differently .. or is there a unified way to do that? (i was wondering if there was a trait "Span" impled for view_item, expr, etc.
[11:19:32] <dbaupp> nope
[11:20:03] <doomlord> i've seen the 'spanned<T>' thing elsewhere but it seems some peices are 'spanned<T> whereas others need span + node_id..
[11:20:30] <doomlord> i have to fill in a callback for each type - since the query can return any ast peice
[11:21:45] *** Quits: ross (ross@moz-8A84103E.br.br.cox.net) (Quit: )
[11:21:50] <doomlord> does this seem like a trait-ey problem? for much of my query, i'm looking for one peice of behaviour- 'spanned' - and another - 'traverse sub-nodes, but i dont need to know what they are'
[11:22:17] <doomlord> trait Spanned.... trait NodeContainer { fn visitSubNodes() }    perhpas
[11:23:02] <doomlord> i'm probably still trying to think in C++
[11:23:26] *** Joins: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net)
[11:23:33] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[11:24:17] <dbaupp> well... you can NIH the visitor
[11:24:38] <doomlord> i'm doing pretty well not having started a new parser yet :)
[11:24:51] <dbaupp> or you can use the state arg to the syntax::visit Visitor to store the return value
[11:25:16] *** Joins: heftig (heftig@1103CD12.9A77AED9.3663C14F.IP)
[11:25:28] <dbaupp> e.g. https://gist.github.com/huonw/d42c3187c35193326cd3
[11:25:28] <doomlord> ok i'll have another bash at that
[11:25:57] *** Quits: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net) (Ping timeout)
[11:26:17] *** Joins: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net)
[11:26:27] <dbaupp> that presumably doesn't compile
[11:26:43] <dbaupp> (and I just updated it with how you continue the recursion when you want to.
[11:26:44] <dbaupp> )
[11:26:55] <doomlord> ok that looks reasonable 
[11:27:50] *** Quits: KindOne (KindOne@4373AC8F.5D2364C3.EC6A1518.IP) (Ping timeout)
[11:28:13] <dbaupp> (and updated again, I missed the crucial `.. *visit::default_visitor()` line.)
[11:28:16] <doomlord> ok i would have lots of code in C++ that manually recurses like that too. (an actual call required at the end)
[11:28:31] <doomlord> most of my node-visits in c++ do look more like that
[11:31:16] *** Joins: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP)
[11:31:50] *** Joins: KindOne (KindOne@66CC4AA4.5D2364C3.EC6A1518.IP)
[11:32:11] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Connection reset by peer)
[11:34:39] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[11:34:39] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/YUxePA
[11:34:39] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[11:34:42] *** Quits: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net) (Ping timeout)
[11:34:54] *** Joins: kertap (kertap@moz-5AE34C97.b-ras3.mvw.galway.eircom.net)
[11:35:17] *** Joins: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net)
[11:37:00] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Ping timeout)
[11:37:11] *** Joins: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au)
[11:37:37] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[11:37:38] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/wjGBwA
[11:37:38] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[11:37:41] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[11:37:41] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/CdekUw
[11:37:41] <ghrust> 13rust/06auto 14a74d92e 15Brian Anderson: syntax: Bless mod.rs. #4116...
[11:37:41] <ghrust> 13rust/06auto 147b2218d 15bors: auto merge of #7926 : brson/rust/issue-4116, r=graydon...
[11:37:41] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[11:37:56] *** Quits: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net) (Ping timeout)
[11:38:53] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[11:42:49] *** Joins: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net)
[11:44:37] <doener> hm, the requirement to wrap stack closure in new stack closure to borrow them has apparently introduced 200+ new functions just for iter_bytes implementations
[11:45:09] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[11:47:00] <dbaupp> doener: yeah, I was wondering if that would cause a proliferation of new closures because one is needed at each layer
[11:47:37] <doener> dbaupp: not just at each layer. A struct with 5 elements creates 5 closures
[11:48:00] <dbaupp> with #[deriving(IterBytes)], you mean?
[11:48:15] <dbaupp> but, yeah... yuck
[11:48:24] <dbaupp> (does LLVM optimise them out?)
[11:51:29] <doener> dbaupp: with deriving, yeah. Not sure if LLVM optimizes them away. But it is a dynamic call, so I'd not bet on it
[11:51:43] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[11:51:52] <dbaupp> :( was the non-copyability a soundness thing?
[11:52:24] <engla> yes. https://github.com/mozilla/rust/pull/7363
[11:54:24] <doener> dbaupp: another thing that might be easier to solve is that derived clone impls suck atm. Option<int> is not a memcpy(dst, src, 16) but something like "if src.descr == 0 { dst.descr = 0 } else { dst.descr = 1; dst.value = src.value }"
[11:55:03] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[11:55:03] <jensnockert> memcpy all the things!
[11:55:17] <dbaupp> doener: yeah, that would be nice. But (on first glace) it'd *extremely* hard to do: #[deriving] has no access to the types.
[11:55:20] <doener> dbaupp: and llvm can't optimize that away because the retval is caller allocated and thus it (currently?) doesn't know that "value" is initially garbage anyway
[11:55:46] <doener> dbaupp: it doesn't? How does it iterate over them then?
[11:55:59] <dbaupp> doener: it just touches each field and calls .clone()
[11:56:25] <dbaupp> (and creates a call to the appropriate type constructor.)
[11:56:59] <dbaupp> it should probably mark them #[inline] (or at least provide a way for them to be inlined cross-crate), but people said no to this.
[11:57:19] <dbaupp> (#[inline] without the hint to LLVM, preferably.)
[11:58:13] <dbaupp> doener: to be clear, the only type info it has is about the current thing #[deriving] has been called on, so it knows all the variants and fields etc, but not their types (other than the raw ast representation of them.)
[11:58:16] <doener> even then, llvm couldn't get rid of the conditional jmp atm
[11:58:23] <dbaupp> :(
[11:58:43] <doener> yeah, forgot that it runs at parse time
[11:58:47] <dbaupp> can we conditionally mark the value as padding?
[11:59:09] <dbaupp> (or something that makes llvm stop worrying.)
[12:00:26] <doener> maybe sret + lifetimes work. No idea tbh, I'm totally clueless about LLVM optimizations
[12:02:19] *** Joins: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk)
[12:02:33] <dbaupp> engla: (thanks for that link, btw.)
[12:03:28] *** Quits: qmx (qmx@moz-D6C3C2E6.qmx.me) (Ping timeout)
[12:06:06] <engla> you are welcome
[12:06:09] <dbaupp> doener: in any case, there are basically 2 options for improving our deriving impls: push deriving deeper into the compiler, or make LLVM work harder to optimise them
[12:07:11] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[12:07:31] *** Joins: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com)
[12:07:32] *** Joins: qmx (qmx@moz-D6C3C2E6.qmx.me)
[12:07:43] <engla> since you said memcpy, maybe the POD trait could help. It could also be a compiler intrinsic instead of a builtin trait
[12:10:57] *** Joins: yegor (primate@moz-7DA865BF.yandex.net)
[12:11:20] *** Joins: LU324 (stuff@moz-A17E9A7B.dyn.embarqhsd.net)
[12:16:11] <dbaupp> engla: even then it'd be tricky for #[deriving] to use it, because it has such little type information.
[12:16:32] <dbaupp> cmr: much nicer! https://github.com/huonw/rust-malloc/blob/master/zero.rs
[12:19:19] <engla> oh right, it's a syntax extension
[12:20:42] <dbaupp> yeah it causes a whole pile of non-intuitive errors
[12:22:54] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[12:23:23] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[12:26:48] *** Joins: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP)
[12:27:09] <doener> dbaupp: I can't really tell if/what llvm is inlining, the closures look all the same
[12:27:18] <dbaupp> :(
[12:29:11] <doener> hm, no doesn't seem to inline those. There are two anon expr_fn functions for the same iter_bytes implementation that are both called from somewhere
[12:30:18] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[12:30:51] <doener> saddest part is that the function are completely identical, except for their names
[12:31:52] <dbaupp> I see https://gist.github.com/huonw/6de698025fddf494faf4 for Foo { x: uint, y: uint }
[12:32:02] <true_droid> Î» rustc -c 02-borrowed-closure.rs
[12:32:02] <true_droid> error: main function not found
[12:32:05] <dbaupp> (that's with -O )
[12:32:10] <true_droid> why is the main() functoin required for compiling?
[12:32:24] <dbaupp> true_droid: where else will the program start executing from?
[12:32:42] <dbaupp> true_droid: every binary needs an entry point
[12:32:52] <true_droid> dbaupp: it doesn't have to start executing, I'm passing the -c flag telling it not to link
[12:33:04] <true_droid> is the compile/link model different from C?
[12:33:25] <dbaupp> doener: it definitely seems like that stream of gep calls is suboptimal
[12:33:34] *** Quits: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com) (Client exited)
[12:33:35] <dbaupp> doener: but it also looks like things where inlined.
[12:33:35] *** Quits: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au) (Quit: gavinb)
[12:33:39] <dbaupp> *were
[12:33:48] <dbaupp> true_droid: apparently yes
[12:34:12] <dbaupp> true_droid: the existence of main is checked at compile time, not link time
[12:34:32] <dbaupp> true_droid: (you can compile with --lib if you just want to typecheck etc.)
[12:34:40] <dbaupp> and that won't check for main.
[12:35:17] <true_droid> dbaupp: thanks
[12:37:27] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[12:39:00] <doener> dbaupp: try an enum
[12:39:29] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[12:40:41] <dbaupp> doener: o_O 500 lines of this
[12:41:06] <dbaupp> (for Bar(uint,uint), Baz(f64,f64))
[12:41:29] <doener> awesome, eh?
[12:41:34] <dbaupp> but it looks like the subclosures are inlined?
[12:42:01] <dbaupp> (at least, I can't see any anon_fn's, and there are a pile of llvm.lifetime.start/llvm.lifetime.ends?)
[12:42:16] <doener> hm, maybe it only breaks when there are multiple actual users if it, happened for from_elem() as well
[12:42:26] * dbaupp doesn't really know what he's looking for.
[12:42:28] <doener> I just glanced over the optimized librustc.ll
[12:42:35] <dbaupp> o_O
[12:42:49] <dbaupp> some short bedtime reading? :P
[12:43:25] <dbaupp> what do you mean by "multiple users"? actually calling iter_bytes() on some value?
[12:43:25] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[12:43:39] *** Joins: Lovot (root@AE31FB56.8153C3BF.F3C9A2D9.IP)
[12:43:47] *** Parts: Lovot (root@AE31FB56.8153C3BF.F3C9A2D9.IP) ()
[12:45:38] <doener> dbaupp: yeah
[12:46:01] <doener> but that's not it either
[12:46:40] *** Joins: jdeng (Mibbit@moz-6548813B.blktn6.nsw.optusnet.com.au)
[12:46:48] *** Quits: z0w0 (zack@moz-E12708D5.lns6.woo.bigpond.net.au) (Client exited)
[12:46:52] *** Quits: qmx (qmx@moz-D6C3C2E6.qmx.me) (Ping timeout)
[12:47:01] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[12:47:32] *** Quits: jdeng (Mibbit@moz-6548813B.blktn6.nsw.optusnet.com.au) (Quit: http://www.mibbit.com ajax IRC Client)
[12:47:35] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[12:48:06] *** Joins: qmx (qmx@moz-D6C3C2E6.qmx.me)
[12:48:14] <dbaupp> doener: yeah, still no anon fns
[12:48:58] <doener> hm, can't reproduce it with a code snippet
[12:49:24] *** Joins: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net)
[12:49:26] <dbaupp> :/
[12:49:44] <dbaupp> I guess this is something that might be resolved by mergefuncs?
[12:50:21] <dbaupp> (at least, having a large number of copies of the same thing.)
[12:52:27] <doener> I hope so
[12:52:28] <doener> https://gist.github.com/dotdash/1fa19f1afbf669ff4bf1
[12:52:40] <doener> from optimized librustc.ll
[12:53:15] <doener> and that's just for two types
[12:53:29] *** Quits: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net) (Quit: jclements)
[12:54:06] <dbaupp> yuckyuckyuck :(
[12:57:20] *** Joins: sigma_android (androirc@moz-AD7B3E68.dab.02.net)
[12:57:31] <engla> how do you get the IR?
[12:57:34] *** Joins: bytewise (bytewise@moz-649C630D.unitymediagroup.de)
[12:57:37] <smvv> dbaupp: what time (or timezone) is it where strcat lives? (just to understand what a normal day for him would be, because that makes it easy for me to know when he could be online)
[12:57:41] <doener> engla: --emit-llvm -S
[12:57:49] <engla> thanks
[12:57:55] <doener> dbaupp:   2848472 librustc.ll
[12:57:55] <doener>   3127829 librustc-noopt.ll
[12:58:15] <dbaupp> smvv: us time, don't know the exact timezone.
[12:58:24] <smvv> ok
[12:58:36] <dbaupp> doener: getting closer!
[12:58:43] <doener> dbaupp: wc -l output... And IIRC my open PR bring the unoptimized one down to sligtly under 3M
[12:58:56] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[12:59:08] <dbaupp> ooh, wow! I assume optimisation kills a pile of stuff, but inlining adds a pile more?
[12:59:30] <bstrie> smvv dbaupp: according to his github profile he's in toronto
[13:00:15] <dbaupp> doener: should I r+ it?
[13:00:18] <bstrie> oh god, github has started automatically detecting your "preferred languages" to put on your profile
[13:00:22] <bstrie> mine are "
[13:00:23] <doener> dbaupp: probably... Given the larger number of redundant load/stores we still have, I would have expected a _way_ larger difference
[13:00:23] <bstrie> JavaScript, Shell, Perl 
[13:00:25] <bstrie> "
[13:00:30] *** Joins: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au)
[13:00:36] <bstrie> thanks github :|
[13:00:58] <true_droid> is this a bug? https://gist.github.com/alco/6053658
[13:01:16] <true_droid> I'm referring to the warning, as the assignment a = 6 is obviously not dead code
[13:01:40] <dbaupp> true_droid: yes, a bug.
[13:02:33] <true_droid> if I specify the type of the closure to be ~fn, it says "error: mutable variables cannot be implicitly captured"
[13:02:37] <bstrie> curiously it doesn't warn if you delete the a=6 line
[13:02:59] <true_droid> so, is it a bug that mutable captures are allowed for &fn closure, or the warning itself is a bug?
[13:03:01] <dbaupp> bstrie: (it's warning about that line, right? so it's not that surprising that it disappears?)
[13:03:06] <doener> dbaupp: if you think it's good, sure, why not ;-) But it's not like it's important to get it in. Optimized builds don't benefit much/at all from it, so...
[13:03:11] <dbaupp> true_droid: the warning is a bug.
[13:03:16] <smvv> bstrie: ty. it's still a bit strange to me to work with different time zones :)
[13:03:18] <bstrie> oh right, just noticed the specific line
[13:03:31] <dbaupp> doener: not, but it's awesome
[13:03:34] <dbaupp> *no
[13:03:41] * dbaupp joins the doener fan club
[13:03:58] <dbaupp> doener: it even adds a sensible IR builder!
[13:04:14] <doener> haha
[13:04:54] *** Joins: MaikKlein (maik@moz-EFA928EF.dip0.t-ipconnect.de)
[13:05:28] * dbaupp feels like all these if cx.unreachable { .. } checks would slow down trans a lot.
[13:07:24] <dbaupp> doener: doesn't `static cnull: *c_char = 0 as *c_char;` work? (for builder::noname)
[13:07:44] <doener> dbaupp: noname needs to pointer _to_ 0, no a null pointer
[13:07:52] <dbaupp> oh...
[13:07:57] <dbaupp> right.
[13:08:05] <doener> dbaupp: I made the same mistake when first looking at it though ;-)
[13:08:07] <true_droid> dbaupp: I'm afraid of opening an issue because I'm running 0.7 and this might be fixed on master. And building master takes too much time. Can someone verify this warning is emitted on master? https://gist.github.com/alco/6053658
[13:08:22] <dbaupp> bstrie: were you testing on master?
[13:08:59] <dbaupp> true_droid: yeah, it still emits it for me
[13:09:03] <engla> rusti:  let mut a = 5; let adder = |x: int| x + a; a = 6; println(fmt!("%d", adder(1)));
[13:09:04] -rusti- <anon>:7:53: 7:54 warning: value assigned to `a` is never read [-W dead-assignment (default)]
[13:09:04] -rusti- <anon>:7           let mut a = 5; let adder = |x: int| x + a; a = 6; println(fmt!("%d", adder(1)));
[13:09:04] -rusti-                                                               ^
[13:09:04] -rusti- 7
[13:09:06] -rusti- ()
[13:09:28] <true_droid> thanks
[13:09:31] *** Joins: sawrubh (uid6719@moz-5F4AA75A.irccloud.com)
[13:09:38] <engla> rusti agrees
[13:09:57] <doener> dbaupp: the unreachable check don't matter much. Even the stats collection that looks into a hashmap for every instruction only add 200ms to a libstd build with an unoptimized rustc
[13:10:18] <dbaupp> doener: oh. where do we spend all the time?
[13:10:36] <doener> dbaupp: LLVM's IR builder does internal checks to outweigh those two
[13:10:45] <doener> dbaupp: not sure
[13:11:05] *** Quits: Houm (Houm@moz-25669AA8.fbx.proxad.net) (Ping timeout)
[13:11:25] <doener> probably writing stuff to the stack, reading it back, writing it to another stack location and reading it back again
[13:13:53] <dbaupp> there's still bigger fish to fry at the moment, I assume.
[13:15:29] <doener> bad clone code, closure proliferation, unnecessary ret blocks, needless copies of temporaries passed as function arguments, needless copies of immediate return value
[13:15:31] *** Quits: sigma_android (androirc@moz-AD7B3E68.dab.02.net) (Ping timeout)
[13:15:48] *** Joins: saml (sam@moz-14C16814.cst.lightpath.net)
[13:15:54] <doener> that's what I have on my radar. Though I probably won't touch the first two any time soon
[13:16:24] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[13:16:46] <dbaupp> yeah, I think the "fix" for bad #[deriving] is writing them by hand, atm.
[13:17:17] <dbaupp> (but even that doesn't work very well for generics, since, for e.g. Clone, you actually need to call Clone on the contained elements.)
[13:17:20] *** Quits: mye (mye@moz-4DC329CE.dip0.t-ipconnect.de) (Quit: mye)
[13:17:48] <dbaupp> *.clone()
[13:19:10] <Crnobog> A test failing on Windows because the filesystem is case-insensitive but compiletest is not, hrm
[13:19:25] <Crnobog> And libstd doesn't seem to have anything yet for case-insensitive string compares
[13:23:06] <dbaupp> Crnobog: you can use std::ascii for to_upper/to_lower
[13:23:08] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[13:23:14] <dbaupp> Crnobog: but we don't have proper unicode support yet.
[13:23:34] *** Quits: jfbk (textual@moz-EEA9CFB3.nyc.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[13:23:42] <engla> maybe casefolding is simple as a special case
[13:23:53] * engla has no idea
[13:24:00] <engla> unicode requires some big tables
[13:24:12] * ChrisMorgan doesn't know how insensitive FAT32/NTFS are to Unicode case
[13:24:15] <Crnobog> I wasn't sure how people would feel about me making compiletest only work properly for ascii paths
[13:24:35] <Crnobog> Obviously I can make it only do a case insensitive compare for win32
[13:25:04] <dbaupp> Crnobog: it's better than not working at all.
[13:25:37] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[13:25:37] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/CdekUw
[13:25:37] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[13:26:21] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[13:27:06] <engla> http://www.unicode.org/Public/UNIDATA/CaseFolding.txt  by itself it's ok
[13:28:02] *** Joins: mw (mw@moz-1EA0AD3E.adsl.highway.telekom.at)
[13:28:11] *** Parts: mw (mw@moz-1EA0AD3E.adsl.highway.telekom.at) ()
[13:28:19] *** Joins: mw (mw@moz-1EA0AD3E.adsl.highway.telekom.at)
[13:28:21] <dbaupp> engla: it's only 60KB with all the comments!
[13:28:36] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[13:28:36] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/w1AK6g
[13:28:36] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[13:28:38] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[13:28:39] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/YWkmMw
[13:28:39] <ghrust> 13rust/06auto 14d405117 15BjÃ¶rn Steinbrink: Avoid creating llenv blocks when there's nothing to load...
[13:28:39] <ghrust> 13rust/06auto 143cccdbd 15BjÃ¶rn Steinbrink: Remove an unnecessary block/jump from the drop glue for @-pointer...
[13:28:39] <ghrust> 13rust/06auto 14565a9bf 15BjÃ¶rn Steinbrink: Provide lower level access to the LLVM IR builder...
[13:28:41] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[13:29:20] <engla> yeah
[13:29:42] <engla> I guess there aren't that many cased scripts after all
[13:30:39] <dbaupp> yeah, looks like it.
[13:31:36] * MaikKlein hates magic
[13:32:03] <dbaupp> engla: although that is just case-folding, not full to_upper/to_lower support
[13:32:10] <engla> absolutely
[13:32:35] <MaikKlein> what could I improve in std?
[13:32:37] <ChrisMorgan> dbaupp: I reckon that most of the time people care about case it's just for comparison. At the least, it's a significant fraction of it.
[13:32:47] <dbaupp> ChrisMorgan: yeah
[13:32:59] <dbaupp> MaikKlein: converting things to methods
[13:33:25] <MaikKlein> dbaupp, with things you mean the functions?
[13:33:47] <ChrisMorgan> How much memory does a char take? 32 bits?
[13:34:08] <engla> yes
[13:34:09] <dbaupp> MaikKlein: yeah, stand-alone fns to methods either in traits or plain impls. (e.g. std::either and std::result are full of them.)
[13:34:26] <MaikKlein> dbaupp, ok thanks I have a look
[13:34:55] <dbaupp> MaikKlein: (try to do each one as a separate commit, because they occasionally cause problems, and need to be reverted.)
[13:35:37] <dbaupp> MaikKlein: as an example, https://github.com/mozilla/rust/pull/7060
[13:35:50] <kimundi> I tried adding stubs for unicode case folding once. People didn't like it :)
[13:35:51] <ChrisMorgan> How much would a [char] take with one, two or three chars in it? I presume there's a header?
[13:36:18] <dbaupp> ChrisMorgan: for ~[] there is a 2 word header (length & capacity)
[13:36:37] <dbaupp> for &[] there is no header (the length is stored on the stack next to the pointer.)
[13:37:12] <kimundi> well there is till a header wherevever the actual allocation is
[13:37:20] <MaikKlein> dbaupp, ok I will thanks
[13:37:21] <kimundi> unless it's static
[13:37:26] <kimundi> or fixed size
[13:37:30] <dbaupp> kimundi: as in, the malloc's header?
[13:38:34] <kimundi> well, to get a &[] there still needs to be a ~[], [, ..N] somewhere
[13:38:42] *** Joins: mye (mye@moz-4DC329CE.dip0.t-ipconnect.de)
[13:40:05] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[13:40:40] <dbaupp> oh, I see, yes.
[13:41:00] <dbaupp> (although a stack &[...] has no header.)
[13:41:15] <dbaupp> at least, I hope it has no header.
[13:41:43] <kimundi> well, a stack &[] is just suger for a hidden [,..N] anyway. wich yeas has no header
[13:42:06] <kimundi> which, yes, has no header*
[13:42:13] <dbaupp> haha
[13:42:18] * dbaupp understood
[13:42:22] <dbaupp> but cool! :)
[13:42:37] <ChrisMorgan> So, that case fold table, with 1161 entries, each comprised of a char, a C, F, S or T and somewhere between one and three chars. 1057 with one char, 88 with two, 16 with three. If the C, F, S or T takes one word rather than the two bits needed, I believe that ends up 23,700 bytes. Much lighter than a full Unicode table :-)
[13:42:41] * kimundi really needs to improve his typing somehow
[13:43:38] <ChrisMorgan> I guess you could shrink it further with an appropriate enum which would take into account the cardinality of the char vec and whether it's C, F, S or T... that'd take it back down to around 10KB.
[13:43:38] <kimundi> still, that's 32kb for char::eg_no_case()
[13:44:01] <kimundi> 23kb for char::eq_no_case() *
[13:44:37] <ChrisMorgan> (All the ones with more than one char in the expanded version are F, none of the others are.)
[13:45:16] <kimundi> hm, this could be implemnete as an case fold iteraor
[13:45:20] <engla> right, that's why they are marked F because the string grows
[13:45:31] <engla> with an iterator version it doesn't need to allocate to compare 
[13:45:36] <ChrisMorgan> Yep, I was just making it a little clearer with what I said earlier.
[13:45:47] <dbaupp> ChrisMorgan: yeah, an enum CharMap { C(char), F(&'stiatc [char]) ,... } might work
[13:45:48] <kertap> why does this code result in an error saying expected &-ptr but found vector
[13:45:48] <kertap>   let mut ca: ~[char] = ~[];
[13:45:49] <kertap>   vec::push(ca, 'a');
[13:45:53] <ChrisMorgan> And there's really no need for more than 16-bit per char... not sure if you can take advantage of that.
[13:46:04] <dbaupp> kertap: you need &mut ~[]
[13:46:07] <kimundi> string -> Iterator<char> -> CaseFoldIterator -> Iterator<char> -> string
[13:46:10] <engla> ChrisMorgan: unicode needs 21 bits
[13:46:22] <dbaupp> kertap: (you should be using ca.push('a') btw.)
[13:46:24] <engla> max char is 0x10ffff
[13:46:37] <engla> *max sensibe char
[13:46:55] <saati> hello
[13:47:01] <kertap> dbaupp: Cool. I new there was something I was missing. I'm using 0.6 at the moment. I installed with homebrew. I'll update a little later
[13:47:07] <dbaupp> ChrisMorgan: there's a bug open about making enums smart about discriminants, including collapsing it into the high bits of char's.
[13:47:08] <saati> how do i get a stack trace out of the test harness?
[13:47:26] <saati> i'd like make check to run without ipv6
[13:47:28] <dbaupp> kertap: oh! that's very old... is homebrew not updated to 0.7 yet?
[13:47:37] <ChrisMorgan> Whoops, I was misinterpreting the hex number as decimal... of course 0x10000 is over 16-bits.
[13:47:58] <dbaupp> saati: `RUST_LOG=::rt::backtrace make check`?
[13:47:58] <ChrisMorgan> saati: run it with RUST_LOG=::rt::backtrace
[13:47:58] <kertap> dbaupp: it isn't. although I'm not sure what the --dev version points too
[13:48:08] <saati> thanks
[13:48:29] <dbaupp> ChrisMorgan: that decimal digit 'f'? :P
[13:48:30] <engla> ChrisMorgan: ok I see what you mean. There's a tension between having a table generated from the unicode tables, and doing specializations to make it go fast
[13:48:52] <dbaupp> engla: we just need a more intelligent table generator :P
[13:48:56] <ChrisMorgan> dbaupp: I was looking at the 10427! No f there!
[13:49:32] <dbaupp> ChrisMorgan: stop raining on my parade! :P
[13:49:45] <engla> we could just decide that deseret gets no case fold. But it would trip the deseret people up with their windows file systems
[13:50:29] <ChrisMorgan> Anyway, it looks to me like it should be able to be got to around 12KB.
[13:50:51] <ChrisMorgan> engla: nah, we need to keep that in. Make it an advertising point for Rust: "Supports Deseret!"
[13:51:01] <MaikKlein> what is the fastest way to build std?
[13:51:13] <dbaupp> "Deseret is a Unicode block containing characters invented by the The Church of Jesus Christ of Latter-day Saints (LDS Church) to write English"
[13:51:37] <engla> oh
[13:52:32] <kertap> dbaupp: actually now that I look, I think my homebrew is super out of date
[13:53:53] * dbaupp wonders how many type-faces actually have support for deseret
[13:54:02] <dbaupp> kertap: oh? so it does have 0.7?
[13:54:32] <kertap> dbaupp: It does. I'm upgrading now!
[13:54:45] <dbaupp> have fun upgrading all your programs :P
[13:54:57] <MaikKlein> dbaupp, result already have methods, they just use function for the methods like "pub fn get_ref<'a>(&'a self) -> &'a T { get_ref(self) }"
[13:55:20] <dbaupp> MaikKlein: yeah, move the body of the function into the method, and delete the function.
[13:55:25] <MaikKlein> dbaupp, okay
[13:55:32] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[13:55:36] *** Joins: bent (chatzilla@moz-2CD73AA6.triad.res.rr.com)
[13:56:21] <dbaupp> MaikKlein: (make sure to make the #[inline] annotations on the methods match that on the deleted function, and also keep the most complete documentation.)
[13:57:19] <dbaupp> kertap: (#rust will happily answer your questions (or refer you to a page that will answer them) about upgrading.)
[13:59:09] <kertap> dbaupp: Excellent! I'm always a little nervous asking questions because they seem so silly
[13:59:22] <MaikKlein> [o_o]: dance
[13:59:22] *** Quits: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net) (Ping timeout)
[14:00:04] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[14:00:19] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[14:01:58] *** Joins: achim (achim@48D08254.C47AE098.3170947E.IP)
[14:02:48] <true_droid> can someone clarify why returning a &'r fn is illegal here? https://gist.github.com/alco/6054014 I understand that the environment for &fn is allocated on the stack, but since the lifetimes of captured variables and the fn itself are the same, would it be legal to copy the environment to the caller's stack? Basically I'm asking if it would be possible to define just fn (not a pointer) that would copy the function pointer and copy the whole envir
[14:03:41] *** Quits: bent (chatzilla@moz-2CD73AA6.triad.res.rr.com) (Quit: ChatZilla 0.9.90-rdmsoft [XULRunner 18.0.2/20130201065344])
[14:03:45] <MaikKlein> can I add lifetimes to ref?
[14:03:59] <engla> true_droid: I'd love to do that too
[14:04:08] *** Joins: bent (chatzilla@moz-2CD73AA6.triad.res.rr.com)
[14:04:15] <kimundi> MaikKlein: afaik no, it just uses the largest possible
[14:04:26] <bstrie> true_droid: it might be possible, using unsafe code and deep magic
[14:04:45] <engla> or just a closure-like explicit construction
[14:05:06] <engla> err I mean lambda without closing on anything and explicit environment. at the moment
[14:05:14] *** Joins: lmandel (lmandel@F2D29657.F60B0462.67AC9B1.IP)
[14:05:18] <MaikKlein> kimundi, ok thanks then my code should compile :)
[14:06:05] <dbaupp> rusti: fn foo<'a>(x: &'a int) -> &'a fn() -> &'a int { || x } let x = 1; *(foo(&x)())
[14:06:09] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/daRG
[14:06:09] <kimundi> MaikKlein: Generally you only ever need to use lifetimes if you want to a) return something with a & ptr in it or b) define a type with a &ptr in it
[14:06:25] <cmr> kimundi: dtoa.c looks robust, correct, and performant, although I'm sure if it were less correct it could be more performant
[14:06:49] <cmr> dbaupp: that is much nicer!
[14:07:45] <kimundi> cmr: It's also hardcoded to base 10. Wich is fine, but I'd like to see also general base support
[14:07:50] <MaikKlein> kimundi, atm I want to return a pointer with a match statement like "Ok(ref t) => t" where my return looks like -> &'a T
[14:08:18] <dbaupp> MaikKlein: ref should automatically get the lifetime of the thing you're matching on
[14:08:27] <kimundi> MaikKlein: then the value you match on needs to have lifetime 'a
[14:08:28] <MaikKlein> dbaupp, ok nice
[14:09:23] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[14:09:35] <MaikKlein> btw how much faster does rust compile if I do "./configure --disable-optimize --disable-optimize-cxx --disable-optimize-llvm"?
[14:09:41] *** Joins: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP)
[14:10:14] <cmr> MaikKlein: it will be slower
[14:10:18] <MaikKlein> I don't see a speedup it still compiles for ~20mins
[14:10:22] <cmr> the stage1 build will be faster
[14:10:22] <MaikKlein> cmr, ?
[14:10:31] <cmr> but everything else will be slower because our generated code is awful
[14:10:38] <MaikKlein> cmr, :X
[14:10:54] <kimundi> cmr: The string <-> float impls should probably in the end have special cases for bases 10, 2, 4, 8, 16, 32 etc, each doing the fastest one possible
[14:10:55] <MaikKlein> cmr, so I am working on std, I shouldn't use optimize?
[14:11:17] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[14:11:28] <cmr> MaikKlein: I always use optimizations with rustc
[14:12:05] <engla> you don't need -O if you just build a test execuable
[14:12:45] <dbaupp> MaikKlein: apparently it's slightly faster with doener's latest changes
[14:13:13] <dbaupp> MaikKlein: (if you're just testing std, build the whole thing once, and then use `make check-stage2-std NO_REBUILD=1`.)
[14:13:14] <cmr> is it still slower than valgrind?
[14:13:42] <dbaupp> cmr: don't think so after https://github.com/mozilla/rust/pull/7941 lands
[14:13:43] <doomlord> ( ok getting somewhere with node from span, using the recomended syntax::visit stuff )
[14:14:02] <cmr> dbaupp: ah, nice
[14:14:15] <dbaupp> cmr: (you should be "nice"-ing to doener ;P )
[14:14:29] <cmr> doener: you are a trans hero
[14:16:50] <dbaupp> cmr: I'm hoping to wake up to the bencher being active ;P (good night!)
[14:16:59] *** Quits: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au) (Quit: gavinb)
[14:17:17] <cmr> dbaupp: unlikely
[14:17:23] <cmr> although not impossible!
[14:22:35] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[14:23:16] <saati> is rusti written in rust?
[14:23:22] <cmr> rusti in irc?
[14:23:31] <saati> yes
[14:23:51] <cmr> no, python and shell and c++
[14:24:02] *** Joins: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca)
[14:24:11] <cmr> he's really not impressive, it basically just echos your input into a file and runs rustc on it
[14:25:11] <cmr> (the c++ is for the sandbox, https://github.com/thestinger/playpen)
[14:26:47] *** Quits: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com) (Quit: bye bye)
[14:28:41] <engla> rusti the REPL is working now
[14:28:54] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[14:28:59] *** Quits: achim (achim@48D08254.C47AE098.3170947E.IP) (Quit: Computer has gone to sleep.)
[14:29:00] <engla> I think it's impressive, but it requires all variables to save between lines to be encodable
[14:29:30] *** Joins: brianm (brianm@moz-D74EBD8D.hsd1.co.comcast.net)
[14:32:14] <true_droid> this is weird https://gist.github.com/alco/6054272
[14:32:21] <true_droid> is /** a special syntax for something?
[14:32:45] <engla> yes, doc comment
[14:32:52] <bstrie> true_droid: it's one of our six different ways to make doc comments
[14:32:56] <bstrie> surprise, all of them are terrible
[14:33:05] <cmr> bstrie: 6? there are only 4
[14:33:32] <cmr> well, unless you're counting #[doc=foo]
[14:33:40] <cmr> but that's hardly a comment
[14:33:44] <true_droid> ok, thanks
[14:33:45] <bstrie> but it is
[14:34:28] <bstrie> it's hard to argue that #[doc=foo] isn't a doc comment when our doc comments themselves are just sugar for the attributes!
[14:34:31] <bstrie> hence the error in the gist
[14:34:54] <cmr> doc comments use the comment syntax
[14:35:10] <cmr> even though they're hardly comments, since they are semantically important
[14:36:20] <bstrie> call it a docstring then, if you like. the whole situation is still the Third-Worst Thing In Rust
[14:36:31] <cmr> I don't mind it
[14:36:36] <saati> what are the first two?
[14:36:40] <cmr> I don't really see any better way to do it
[14:36:47] <cmr> saati: ///, ///!, /**, /**!
[14:37:03] <saati> i mean the first two worst things in rust
[14:37:09] <bstrie> the Second-Worst Thing In Rust: significant semicolons in attributes
[14:37:22] <bstrie> the First-Worst Thing In Rust: ::<> for type annotations
[14:37:33] <cmr> I don't think ::<> is that bad
[14:37:33] <bstrie> at least the second one has a chance to get fixed
[14:37:39] <bstrie> you're a madman
[14:37:40] <cmr> the bad part is that ALL of the parameterization has to go in the last item
[14:37:49] *** Quits: StarLight (StarLight@moz-C4C8A7D2.dynamic.avangarddsl.ru) (Ping timeout)
[14:38:05] <engla> I think the implementation has about 100 issues more important than your list bstrie :)
[14:38:09] *** Joins: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP)
[14:38:21] *** Parts: mw (mw@moz-1EA0AD3E.adsl.highway.telekom.at) ()
[14:38:23] <bstrie> engla: pah, those are just bugs
[14:38:37] <engla> true
[14:38:45] <saati> yeah ok, if this is the worst of rust this will be awesome
[14:38:48] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[14:38:54] <cmr> significant semicolons in attributes is pretty bad though yeah
[14:38:56] <bstrie> saati: that was exactly graydon's response :P
[14:39:01] <cmr> saati: the language itself has few problems IMO
[14:39:05] <cmr> it's all implementation :)
[14:39:45] <engla> worst part of rust is compilation speed
[14:39:50] <doy> i really don't see why the semicolon thing is so bad
[14:39:55] <dbaupp> cmr: (it's //! and /*!, btw.)
[14:39:55] <doy> it's never been confusing to me
[14:39:58] *** Joins: bheylin (brianheyli@moz-3D24C757.static.chello.nl)
[14:39:59] <true_droid> cmr: it is ironic that C++ is used to secure rusti
[14:40:01] <cmr> dbaupp: oh, oops
[14:40:13] <bstrie> doy: semicolons in return position are fine, it's semicolons being signficant in *attributes* that I don't like
[14:40:15] <cmr> doy: it's not confusing, it's just easy to miss
[14:40:26] <doy> bstrie: yeah, i don't mind either
[14:40:37] <bstrie> doy: good, then you won't mind my campaign to remove them :)
[14:40:48] <saati> true_droid: it's mostly system calls
[14:40:54] <doy> just as long as the replacement isn't worse d:
[14:41:09] <SiegeLord> Just enforce a specific variant per-attribute
[14:41:38] <bheylin> anyone know why rust command is crashing? https://gist.github.com/brianheylin/6054343 
[14:41:39] <SiegeLord> And not allow some attributes to be valid with the semicolon and without
[14:41:40] <doy> i think that would be more confusing
[14:41:49] <doy> oh, you mean keep the semicolon
[14:41:53] <cmr> SiegeLord: the solution is different syntax IMO
[14:41:55] <doy> but just enforce that it's used in a certain way
[14:42:00] <doy> yeah, that would be okay
[14:42:10] <true_droid> bheylin: rust run should work fine
[14:42:13] *** Joins: StarLight (StarLight@moz-3D9AA212.dynamic.avangarddsl.ru)
[14:42:14] <saati> cmr: what are the current problems?
[14:42:16] <SiegeLord> There are already some attributes that can't be used both ways
[14:42:22] <SiegeLord> I think I ran into some at some point
[14:42:23] <bstrie> bheylin: the "rust" tool is generally untrustworthy, just use rustc directly for now
[14:42:33] <cmr> bheylin: harmless crash though
[14:42:38] <cmr> saati: in the implementation?
[14:42:42] <saati> yes
[14:42:42] <dbaupp> bheylin: https://github.com/mozilla/rust/issues/7617
[14:42:50] <bheylin> @bstrie all good
[14:43:15] <bheylin> also is there any known issues with logging
[14:43:36] <bheylin> i was trying to use debug! last night for first time
[14:43:56] <bheylin> followed guide on wiki, rust -Z debug-info â€¦ and set RUST_LOG
[14:43:56] <bstrie> bheylin: we recently made it so that debug! only shows up if you compile with the correct flag
[14:43:57] <cmr> saati: lots of bugs in the region system, resolve, trait objects are broken, trait object inheritance never worked, trait inheritance is broken, codegen is bad, ...
[14:44:08] <cmr> bheylin: which guide is that?
[14:44:17] <cmr> needs to be updated to use `--cfg debug` too
[14:44:22] *** Quits: dbaupp (Thunderbir@moz-712A1135.lns20.syd6.internode.on.net) (Ping timeout)
[14:45:22] <engla> I would love if this small PR for option chain_mut_ref could be reviewed https://github.com/mozilla/rust/pull/7931  thanks.
[14:46:07] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[14:46:15] <bheylin> @cmr http://static.rust-lang.org/doc/0.7/rust.html#logging-system
[14:46:27] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[14:47:19] <doomlord> http://pastebin.com/yb9Lu4y1 <<<< before i go cut/pasting all the cases, any comments on the approach here? does 'view_item/item/expr' handle all the cases... or do i need all the subnode types that ast::visitor handles
[14:48:00] <doomlord> seems to work, i get the enclosing nodes
[14:48:26] <cmr> doomlord: that should be it
[14:48:33] <doomlord> i just look at this cut paste and wondering if i''m doing something wrong...  is this the sort of code that will get more elegant with trait objects later
[14:48:45] <doomlord> i'm happy to proceed with this method
[14:50:07] <cmr> not really. it'd look mostly the same, you'd just be using a trait impl instead of setting fields
[14:50:57] <cmr> I don't know why you have the astnode enum?
[14:51:47] <doomlord> the raw query can return any type of node - so i think i need an enum to enclose the options
[14:52:14] <bheylin> @cmr logging is working, was indeed missing --cfg debug
[14:52:17] <doomlord> the cursor could be anywhere when you hit 'jump to definition''
[14:52:27] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[14:54:43] <doomlord> Compared to the way libclang  is structured, i think i need the astnode enum to compensate for the fact that rusts' ast has more specific node information - i'd need a universal 'base node' or trait that all nodes implement , i think. eg. trait Spanned, impl for view_node, item, expr , ...
[14:54:44] <cmr> there isn't an enum in syntax::ast that covers that already?
[14:55:20] <doomlord> if there is i'm unaware, i can't say i know syntax::ast inside out or anything 
[14:55:52] <doomlord> i think the types are more specific, and perhaps it creates them specifically as its parsing
[14:56:05] <engla> Why does bitv use a pointer in Small(~SmallBitv)? The SmallBitv is just an uint, so it could just be embedded and avoid the indirection.  Theoretically rustc could use tagged pointers for the enum tag, but it doesn't, so it should be the same size.
[14:56:29] <doomlord> any further information is welcome, if anyone knows how to improve it .. especially before i go filling in all the cases 
[14:57:42] *** Joins: Houm (Houm@moz-25669AA8.fbx.proxad.net)
[14:57:49] *** Joins: jdm (jdm@92FB48CA.8B5E9DF.9A8C35B4.IP)
[14:59:17] <cmr> doomlord: hm, I thought there was, but you're right, there isn't
[14:59:53] <doomlord> clang's ast.. you have to do more work to extract *specific* information
[15:00:18] <doomlord> rusts's ast, youve' got more specifics - and have to do more work to extract the most general information.
[15:00:29] <doomlord> ^^^ that seems to be whats going on
[15:00:53] <doomlord> in clangs ast... you have to scan general purpose nodes to get fields, types, whatever
[15:05:20] *** Joins: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net)
[15:06:08] *** Quits: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP) (Quit: ëžœë¤ì€ ì‡ í‡´í–ˆìŠµë‹ˆë‹¤.)
[15:06:13] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[15:06:51] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[15:08:16] *** Quits: bheylin (brianheyli@moz-3D24C757.static.chello.nl) (Quit: bheylin)
[15:08:18] <doomlord> cmr - does the information in DocContext::tycx handle namespace resolution
[15:08:42] <cmr> doomlord: yes
[15:09:04] <cmr> the def_map and items fields is most of it
[15:09:46] *** Joins: nano (nano@moz-972880B.superkabel.de)
[15:10:50] *** Joins: bheylin (brianheyli@moz-3D24C757.static.chello.nl)
[15:12:32] *** Quits: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net) (Client exited)
[15:12:53] *** Joins: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net)
[15:13:09] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[15:13:36] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[15:13:36] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/YWkmMw
[15:13:36] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[15:14:34] *** Quits: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net) (Ping timeout)
[15:16:33] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[15:16:33] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Ax0O2A
[15:16:34] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[15:17:54] *** Joins: Kruppe (user@moz-4DDA8AB8.uwaterloo.ca)
[15:18:00] *** Quits: bheylin (brianheyli@moz-3D24C757.static.chello.nl) (Quit: bheylin)
[15:19:34] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[15:19:34] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Ax0O2A
[15:19:34] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[15:19:35] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[15:19:35] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/LZ1g4Q
[15:19:35] <ghrust> 13rust/06auto 144bd1424 15Michael Woerister: Ast spanned<T> refactoring, renaming: crate, local, blk, crate_num, crate_cfg....
[15:19:35] <ghrust> 13rust/06auto 145aee3e0 15Michael Woerister: De-spanned<T> and renamed ast::field (now ast::Field)
[15:19:35] <ghrust> 13rust/06auto 1452b7fc1 15bors: auto merge of #7903 : michaelwoerister/rust/end_of_spanned, r=jdm...
[15:19:37] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[15:20:33] *** Quits: MaikKlein (maik@moz-EFA928EF.dip0.t-ipconnect.de) (Ping timeout)
[15:23:17] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[15:25:11] *** Joins: xraycat (Adium@moz-1BAB142.pool.mediaways.net)
[15:26:25] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Connection reset by peer)
[15:28:14] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[15:29:30] <kimundi> bstrie: afaik it's already semi-decidid to just change #[att]; to #![att]
[15:29:39] *** Quits: bytewise (bytewise@moz-649C630D.unitymediagroup.de) (Quit: Leaving)
[15:30:05] *** Joins: maxli1 (maxli@F2D29657.F60B0462.67AC9B1.IP)
[15:30:12] <kimundi> Only need a special rule that something starting with #![ on the first line is not to be considered a shebang
[15:30:23] *** Quits: zslayton1 (Mibbit@1D191528.269AFE30.6A3AF4D7.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[15:30:27] *** Joins: yonran (yonran@moz-962F33EB.acuitus.com)
[15:30:35] *** Quits: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP) (Ping timeout)
[15:31:05] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[15:31:10] *** Quits: yegor (primate@moz-7DA865BF.yandex.net) (Ping timeout)
[15:31:41] <doomlord> isn't #[ specific enough already or something
[15:31:55] <kimundi> hm?
[15:32:13] <SiegeLord> That's... strangely consistent with the /*! doc comments
[15:32:28] <kimundi> #![...] == apply to outer, #[...] == apply to following
[15:33:00] <kimundi> SiegeLord: That's because I proposed because of them xD
[15:33:02] <cmr> kimundi: And how are we going to get that special rule into all the kernels and the SUS?
[15:33:17] <kimundi> cmr: You won't
[15:33:56] <kimundi> cmr: If you want your rust source file to be executable put a proper shebang at first line or insert an empty line to prevent it
[15:34:31] <kimundi> It's not like yuo are forced to have a correct shebang file there
[15:34:37] <kimundi> line*
[15:34:48] <cmr> so... what's the special rule/
[15:35:56] <pnkfelix> kimundi: wait, who is adding this special rule you refer to then?
[15:36:06] <kimundi> the rule is for rustc itself. "Ignore first line if it starts with #!", "Don't ignore it if it starts with #!["
[15:36:26] <pnkfelix> kimundi: Oh, do we already ignore shebang'ing first lines?
[15:36:30] <kimundi> yes
[15:37:01] <kimundi> you can already write rust script by including a shebang for rust run ;)
[15:37:04] <bstrie> kimundi: I was vaguely the one who proposed that rule, but other than a sense of "slight general enthusiasm" from graydon I haven't heard of any other progress on that front
[15:37:42] <pnkfelix> kimundi: huh.  I think I'd prefer a lint that just warns on a first line that starts with "#![", rather than making it a special case of a special case
[15:37:43] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[15:37:54] <pnkfelix> kimundi: but I guess I see your point
[15:38:00] <kimundi> Yeah, might have doe a to stron assertion here. "No disagreement that one time it came up" would be more accurate
[15:38:07] <cmr> The first line of my crates is a #[link ...];
[15:38:10] <kimundi> dona* strong*
[15:38:23] *** Joins: ecr (Thunderbir@moz-19C7F72B.uoregon.edu)
[15:38:26] <kimundi> grr... what the hell is wrong with my keyboard
[15:38:28] <pnkfelix> kimundi: (that is, that it would be even weirder to ignore an initial line of the form "#![â€¦]"
[15:38:32] <bstrie> yeah, the reason I'm reserved on the #!-for-attributes proposal is because of tools that attempt to automatically detect shebangs
[15:38:54] <bstrie> if they exist
[15:38:57] <bstrie> which I'm not sure
[15:38:58] <bstrie> but they could
[15:39:17] <cmr> Why don't we append the !?
[15:39:27] <kimundi> bstrie: A lint that says "this works, but might confuse external tools, better add a newline" sounds good
[15:39:28] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[15:39:43] <pnkfelix> cmr: because that would be just as subtle as the current rule where appending ";" is the discriminating syntax?
[15:39:57] <cmr> pnkfelix: it's only subtle because it's a semicolon
[15:40:05] <cmr> imo
[15:40:11] <SiegeLord> You'd never run a rust file with #![ at the beginning
[15:40:14] <bstrie> it's still better because it doesn't collide with our current semicolons-in-return-position rule
[15:40:20] <bstrie> not super great, but less terrible
[15:40:21] <pnkfelix> cmr: (I probably shouldn't be speaking on this topic, I'm not really in any of the established camps)
[15:40:22] *** Quits: maxli1 (maxli@F2D29657.F60B0462.67AC9B1.IP) (Ping timeout)
[15:40:22] *** Quits: ecr (Thunderbir@moz-19C7F72B.uoregon.edu) (Quit: ecr)
[15:40:31] <cmr> pnkfelix: (neither am I :p)
[15:40:59] <kimundi> #^[], ##[], #[]
[15:41:05] <pnkfelix> SiegeLord: I think cmr said they would, with their example of always starting with "#link[â€¦];"
[15:41:16] *** Joins: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net)
[15:41:17] *** Joins: stereotype441 (pberry@moz-8E88FB0F.jf.intel.com)
[15:41:20] <kimundi> the possiblities are endless :P But I like the !
[15:41:21] *** Joins: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP)
[15:41:24] <SiegeLord> pnkfelix: They'd do ./blah.rs ?
[15:41:26] *** Quits: stereotype441 (pberry@moz-8E88FB0F.jf.intel.com) (Quit: stereotype441)
[15:41:30] <cmr> pnkfelix: You'd never *run* a rust file like that though
[15:41:44] <cmr> I think the idea of a shebang that runs a compiler is bonkers
[15:41:59] <pnkfelix> cmr: I've heard that the D compiler is fast enough to support that use-case
[15:42:11] <pnkfelix> cmr: (to compile-and-run the subsequent D program)
[15:42:28] <cmr> pnkfelix: our JIT could be fast enough too, but it still seems like an insane use case
[15:42:50] <jedestep> question: I have a library with a lot of network code (makes use of extra::net::tcp and such) and thus a lot of @'s. how can I best future-proof this?
[15:43:08] <kimundi> cmr: Doesn't sound that bonkers to me... It's just a matter of the compiler being fast enough.
[15:43:08] <pnkfelix> SiegeLord: I see, I misread your original note
[15:43:22] <cmr> jedestep: port it to std::rt::io
[15:44:09] *** Quits: doener (bs@moz-AA189A5A.unitymedia.biz) (Quit: leaving)
[15:45:27] <jedestep> did this library exist on 0.7 or is it too new
[15:45:34] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[15:45:39] <cmr> it's the new runtime
[15:45:41] *** Quits: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP) (Quit: )
[15:45:45] <cmr> I think it existed
[15:45:52] *** Joins: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP)
[15:46:03] <cmr> it's still WIP and not all-there yet, but it's the most future-proof solution, considering all of extra::net is going away
[15:46:10] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[15:46:11] *** Quits: echristo (echristo@moz-1892C634.hsd1.ca.comcast.net) (Quit: echristo)
[15:46:13] *** Quits: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP) (Ping timeout)
[15:46:42] *** Joins: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP)
[15:46:44] <SiegeLord> Even in D, using #! doesn't really start up as a dynamic language script... I considered using it for a build script, but gave up
[15:46:45] <jedestep> yeah looks like it did
[15:46:58] <jedestep> will extra::net be gone by 0.8?
[15:47:07] <SiegeLord> It was adding an additional quarter of a second to my build time, which wasn't really acceptable
[15:47:28] <pnkfelix> SiegeLord: fair enough, I was basing statement on hearsay, not personal experience.
[15:47:34] *** Joins: MaikKlein (maik@moz-EFA928EF.dip0.t-ipconnect.de)
[15:47:49] <bstrie> jedestep: no way to know
[15:47:59] <SiegeLord> pnkfelix: I think it is used in practice though, so it's not incorrect :)
[15:49:01] <SiegeLord> It's no less practical for Rust than the 2 second pauses between evaluations in rusti :P
[15:50:21] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[15:51:14] *** Quits: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP) (Ping timeout)
[15:51:25] *** Joins: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP)
[15:51:45] *** Quits: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP) (Max SendQ exceeded)
[15:53:22] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Ping timeout)
[15:54:02] <engla> it's a start, at least it works <3 acrichto_ 
[15:56:32] *** Joins: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP)
[15:58:20] <SiegeLord> I wonder... can you pipe input to rust run?
[15:59:22] <engla> yes
[16:00:09] *** Quits: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net) (Quit: jclements)
[16:00:10] *** Joins: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net)
[16:00:10] <pnkfelix> what are the rules for who is responsible for freeing the string produced by str::as_c_str ?
[16:00:22] <engla> SiegeLord: hm, I spoke too soon. it parses but doesn't build
[16:00:39] <pnkfelix> (I am trying to review PR 7958 and got worried about when the C string will be freed)
[16:00:39] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[16:00:55] <engla> pnkfelix: the string is still owned by rust, it lives during the closure call
[16:00:58] <cmr> pnkfelix: it doesn't get freed
[16:01:47] *** Joins: wilmoore (wilmoore@moz-1248C037.mystrotv.com)
[16:02:20] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[16:02:38] <pnkfelix> engla: so if you pass the char* to a function that stashes it somewhere globally (rather than making a copy and stashing that instead), then you might have a problem
[16:02:40] <pnkfelix> engla: right?
[16:02:49] <cmr> pnkfelix: you definitely have a problem
[16:03:20] <cmr> the char* isn't supposed to outlive the closure
[16:03:51] <pnkfelix> cmr: yeah that's what I thought
[16:03:55] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Ping timeout)
[16:03:55] <engla> if you check the code there are two cases.. in one of them, the char* only lives for the duration of as_c_str
[16:04:42] *** Joins: mib_7vzdbe (Mibbit@BBE7C46A.B4F11D08.8612FA94.IP)
[16:04:50] <engla> to_owned(self).as_c_str(|s| f(s))    is this even valid?
[16:05:01] <engla> where is the ~str free'd
[16:05:46] <pnkfelix> engla: I think this is related to niko's Rvalue Lifetimes post here: http://smallcultfollowing.com/babysteps/blog/2012/09/15/rvalue-lifetimes/
[16:05:52] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[16:06:01] <pnkfelix> engla: I don't know if he's finalized the rules he wants for such cases
[16:06:25] <engla> I thought I heard users shouldn't use such constructs with as_c_str.. then that method does it itself..
[16:07:35] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[16:08:19] <pnkfelix> engla: I would certainly be happier if the code were rewritten to bind the result to a temporary before calling as_c_str
[16:09:15] *** Joins: mihneadb (mihneadb@moz-BE33DA21.fw1.sfo1.mozilla.net)
[16:09:23] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[16:11:11] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Ping timeout)
[16:11:41] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[16:13:16] <engla> I'd like to know how it works first
[16:15:04] *** Quits: jaen (jaen@moz-59F96A32.neoplus.adsl.tpnet.pl) (Quit: WeeChat 0.4.1)
[16:15:29] <pnkfelix> engla: Well "how it works" might be subject to change depending on the status of Issue 3511
[16:15:44] <pnkfelix> engla: that's why I pointed out Niko's Rvalue lifetimes blog post
[16:16:39] <pnkfelix> engla: I think the main thing is that the lifetime will never be less than the innermost enclosing statement.  At least that's my take-away from skimming Issue #3511
[16:20:27] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[16:20:52] <pnkfelix> engla: (much of the blog post is concerned with defining what the *upper bound* on the dynamic extent is, since you want to know that to be able to predict the latest possible point where destructors will run.  But our concern here is on what the lower bound on the dynamic extent is, which is not discussed as much there.)
[16:23:08] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[16:24:14] <engla> right
[16:24:30] <engla> free is called in the right place in this instance
[16:25:47] *** Joins: lkuper (lkuper@5188CCE.A402E718.C082B7DC.IP)
[16:27:58] <pnkfelix> engla: in the instance of as_c_str() ?  Or are you referring to PR 7958 ?
[16:28:03] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[16:28:21] <pnkfelix> engla: (I'd love to be wrong about PR 7958, but I'd also like someone to explain the mistake in my reasoning there.)
[16:28:33] *** Quits: Ralith (ralith@moz-50F3C77.vc.shawcable.net) (Ping timeout)
[16:28:45] <engla> to_owned(self).as_c_str8)
[16:28:48] <engla> just that one
[16:28:56] <pnkfelix> engla: okay, thanks.
[16:31:17] <engla> ok, do you know if the function requires the string to stay around? the llvm api should probably copy it if it needs it
[16:31:23] <engla> regarding that PR
[16:32:13] <pnkfelix> engla: I dove a little into the LLVM source code.  I saw no sign that the string being copied.
[16:32:24] <engla> aha
[16:32:26] <pnkfelix> engla: so I pointed out my concern
[16:32:46] <pnkfelix> engla: Its possible there's some magic between the lines that I missed.
[16:33:03] <pnkfelix> engla: (i.e., I did *not* step through the execution and confirm that a copy never happened.)
[16:33:05] <engla> StringRef constructor from const char * I guess
[16:33:41] *** Quits: etw (john@moz-B2936CAB.nyc.res.rr.com) (Ping timeout)
[16:33:41] *** Quits: heftig (heftig@1103CD12.9A77AED9.3663C14F.IP) (Connection reset by peer)
[16:33:42] <engla> hm nope
[16:34:02] <pnkfelix> engla: StringRef.h explicitly says that the class does not own the string data, and that its not in general safe to store it.
[16:34:11] *** Joins: heftig (heftig@6835D69C.6FC4DE2F.FEC4A986.IP)
[16:35:02] <engla> they should try pointer lifetimes
[16:35:07] <engla> would make this clearer
[16:36:02] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[16:38:02] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[16:39:33] <MaikKlein> i need some help
[16:40:08] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[16:40:34] <bstrie> MaikKlein: it will take me a few hours to get to germany, don't walk into the light!
[16:40:46] * bstrie hurries
[16:41:03] <MaikKlein> I am doing some cleanup in std::result now I should make each change a single commit, but now extra::tcp::ip doesn't compile anymore. Should I make the changes in extra::tcp::ip?
[16:41:06] <MaikKlein> bstrie, haha
[16:41:46] <MaikKlein> the commit for extra::tcp::ip would then be in my cleanup here https://github.com/mozilla/rust/pull/7969
[16:41:48] <bstrie> MaikKlein: in general try to make it so that every intermediate commit compiles
[16:41:56] <bstrie> MaikKlein: this helps when doing a git bisect
[16:42:08] <MaikKlein> bstrie, okay
[16:42:16] <MaikKlein> bstrie, thanks
[16:42:24] <bstrie> it's not a super-strict rule, just a guideline
[16:43:19] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[16:43:30] *** Joins: bytbox (s@moz-75D4B5A8.wireless.umd.edu)
[16:43:42] <Ms2ger> You will only be quartered if you don't follow it, that's all :)
[16:43:53] *** Joins: eholk (eholk@223C5EED.83FFA18A.ABD5273E.IP)
[16:45:34] *** Joins: graydon (Adium@A5087023.2354C43D.D8E68FF6.IP)
[16:45:34] *** ChanServ sets mode: +qo graydon graydon
[16:47:22] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[16:48:21] *** Quits: bytbox (s@moz-75D4B5A8.wireless.umd.edu) (Ping timeout)
[16:48:59] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[16:50:26] *** bent is now known as bent|errands
[16:51:10] *** Joins: Ralith (ralith@moz-A82A640F.wireless.sfu.ca)
[16:51:21] *** Quits: Houm (Houm@moz-25669AA8.fbx.proxad.net) (Ping timeout)
[16:51:48] *** Quits: CarpNet (ac@moz-FD24B77.sohonet.co.uk) (Quit: Leaving)
[16:52:40] *** Quits: xraycat (Adium@moz-1BAB142.pool.mediaways.net) (Quit: Leaving.)
[16:52:54] *** Quits: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk) (Client exited)
[16:53:17] *** Quits: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com) (Ping timeout)
[16:54:14] *** Quits: mark_edward (quassel@moz-4A9A2F15.dynamic.utc.edu) (Ping timeout)
[17:00:03] *** Joins: doener (doener@moz-121949B3.unitymediagroup.de)
[17:00:44] <MaikKlein> bstrie, btw is it okay to open a PR if I am still working on it?
[17:02:53] *** Quits: nano (nano@moz-972880B.superkabel.de) (Connection reset by peer)
[17:03:50] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[17:04:31] <pnkfelix> MaikKlein: as a way to request a review for in-progress work, you mean?
[17:04:39] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[17:04:39] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/LZ1g4Q
[17:04:39] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[17:05:12] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[17:05:41] *** Joins: tcsc (tcsc@moz-7246F5CD.hsd1.ma.comcast.net)
[17:05:54] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[17:07:36] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[17:07:36] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/fHI2qQ
[17:07:36] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[17:07:37] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[17:07:37] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/hq4m7w
[17:07:37] <ghrust> 13rust/06auto 1493133ab 15Corey Richardson: Doc for ast::Path
[17:07:37] <ghrust> 13rust/06auto 1448f115e 15bors: auto merge of #7940 : cmr/rust/comments, r=pnkfelix
[17:07:37] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[17:07:45] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[17:08:10] *** Joins: erickt1 (Adium@8C9ECD8F.3A598286.F12515B4.IP)
[17:09:43] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[17:10:23] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[17:11:10] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[17:11:21] <true_droid> seems the compiler has outsmarted itself https://gist.github.com/alco/6055642
[17:12:49] <MaikKlein> pnkfelix, yeah
[17:12:58] <true_droid> oh, sorry, I thought the warning complained about line 2, it doesn't
[17:14:01] <tcsc> are rust structs abi compatible with c structs?
[17:14:11] <olsonjeffery> tcsc: yes
[17:14:25] <pnkfelix> true_droid: wait, I thought that warning *is* about line 2, and the line number info in the output is lying to you?
[17:14:40] *** Joins: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com)
[17:14:40] *** ChanServ sets mode: +o pcwalton
[17:14:43] <bstrie> tcsc: though you probably have to make sure all the underlying types are the same width
[17:14:44] <olsonjeffery> tcsc: you can pass an unsafe pointer to a rust struct held in memory to a c function and work with it
[17:14:45] <tcsc> olsonjeffery: so no pitfalls to be aware of other than use the c_* types?
[17:14:49] *** Joins: bnicholson (bnicholson@moz-BBE3ABD.mv.mozilla.com)
[17:14:50] *** Quits: kertap (kertap@moz-5AE34C97.b-ras3.mvw.galway.eircom.net) (Quit: kertap)
[17:14:55] <pnkfelix> true_droid: (as in, the value 10 is what will be read by the invocation of adder(1), and the value 3 will never be used)
[17:15:23] <tcsc> my question relates to a c function which returns a struct by value
[17:15:25] <olsonjeffery> tcsc: for interacting with c calls that're expecting "standard" c types, yeah..
[17:15:31] <olsonjeffery> tcsc: oh. that.
[17:15:46] <pnkfelix> true_droid: which does make it seem like that warning is conflicting with the first error message you listed ...
[17:15:46] <olsonjeffery> yeah. that's.. sub-optimal, right now. :/
[17:16:01] *** Joins: mark_edward (quassel@moz-4A5B1251.wisolt4.epbfi.com)
[17:16:12] <true_droid> pnkfelix: I thought it would complain about line 2. But it does not. And the warning about a = 10 has already been filed as an issue
[17:16:13] <tcsc> so i should write a wrapper (in c) which takes pointers?
[17:16:31] <olsonjeffery> al
[17:16:31] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[17:16:38] <pnkfelix> true_droid: ah okay.  Do you have the issue number handy so I can double-check it?
[17:16:44] <olsonjeffery> my understanding is that anything larger than a word, or so, gets clobbered on some arches
[17:17:05] <true_droid> pnkfelix: https://github.com/mozilla/rust/issues/7966
[17:17:14] <olsonjeffery> tcsc: brson, or perhaps pcwalton could speak to that better than i
[17:17:55] <tcsc> i'm comfortable in c so writing a wrapper is nbd
[17:17:59] <olsonjeffery> yeah
[17:18:05] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[17:18:10] <olsonjeffery> a pointer based approach would be most portable at this time
[17:18:25] <olsonjeffery> that being said, by-val returns from C is a definite need
[17:18:32] <olsonjeffery> its just really hard to get right
[17:18:53] <pnkfelix> true_droid: I see.  But your example would be a good thing to add to #7966, as a way of pointing out that removing the initial initialization of `a` by changing it to `let mut a;` would introduce a new problem.
[17:19:04] <olsonjeffery> graydon: anything to add to what i said? did i misspeak?
[17:19:15] <tcsc> i'm surprised that llvm doesn't take care of that.
[17:19:17] <graydon> sorry, sec
[17:19:20] <olsonjeffery> re: gotchas on by-val return from C
[17:19:23] <pnkfelix> true_droid: (I'm still suspicious about what that warning is actually complaining about.)
[17:19:51] <graydon> olsonjeffery: concerning by-value returns from C?
[17:19:56] <graydon> yeah, we're ..
[17:20:00] <graydon> we can do it most of the time :)
[17:20:01] <pnkfelix> true_droid: (actually, I'll take a moment to poke around and confirm whether its span info is correctly reflecting what its saying)
[17:20:12] <graydon> sorry I guess that's an inappropriate smiley
[17:20:23] <graydon> there are some bugs in 32bit cases IIRC
[17:20:25] <graydon> for structures
[17:20:53] <graydon> I think we usually get scalars right. 64bit values in structures on 32bit platforms IIRC was the iffy case.
[17:21:03] <graydon> so like a struct with some doubles in it
[17:21:36] <tcsc> my concern was a struct { double d; int i; } 
[17:22:01] <tcsc> so yeah, i'll write some c glue
[17:22:10] <olsonjeffery> tcsc: id say map the struct in rust, alloc it with empty values on the rust stack/heap.. pass it to C as a borrowed ptr (ensuring its only accessed in that thread context)
[17:22:14] <olsonjeffery> and you should be good
[17:22:38] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[17:22:57] <olsonjeffery> anywho. sounds like you got a handle on it.
[17:23:12] <true_droid> pnkfelix: I think it would be another issue: missing warning for dead initialization of a. Here https://gist.github.com/alco/6055642#file-gistfile2-txt-L2 the compiler is able to see (theoretically) that the variable gets assigned before the closure is called. But this is kind of advanced. If the compiler doesn't learn to check for that, fixing 7966 would not cause any more problems â€” you'd still get the error of possibly uninitialized variabl
[17:23:17] *** Quits: Ralith (ralith@moz-A82A640F.wireless.sfu.ca) (Ping timeout)
[17:23:23] <pnkfelix> true_droid: okay, I was wrong; its not a matter of rustc reporting the wrong span info.  The dead-assignment warning is just broken here.
[17:23:36] <olsonjeffery> graydon: so #7916 failed because that git failure that broke bors on friday.. did that ever get merged? or is it still in the queue?
[17:24:18] <olsonjeffery> also looking at that failure.. seems like something in the pre-build/git phase.. ?
[17:24:22] <engla> olsonjeffery: it needs to be marked for retry http://buildbot.rust-lang.org/bors/bors.html
[17:24:43] <MaikKlein> i should probably also do a full compile + make check every time I do a commit right?
[17:24:59] <graydon> tcsc: apologies, it's a longstanding pain point we have been trying to get The Last Bug fixed on for aeons. ABIs are fussy.
[17:25:55] *** Joins: rlbaker (rlbaker@moz-C8EE266C.hfc.comcastbusiness.net)
[17:26:07] *** Joins: nano (nano@moz-972880B.superkabel.de)
[17:26:14] *** Joins: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net)
[17:26:48] *** Quits: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net) (Input/output error)
[17:26:54] *** Joins: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net)
[17:27:17] <tcsc> graydon: of course. i figured it would be buggy, unless it fell out of using llvm
[17:27:23] *** Quits: ssbr (ssbr@moz-141F89C6.block0.gvtc.com) (Ping timeout)
[17:27:23] *** Quits: nano (nano@moz-972880B.superkabel.de) (Connection reset by peer)
[17:27:42] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Connection reset by peer)
[17:27:47] *** Joins: nano (nano@moz-972880B.superkabel.de)
[17:28:03] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[17:28:32] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[17:28:40] <graydon> tcsc: it .. kinda does? LLVM basically draws a jagged line across this area of the IR/backend balance of responsibilities. you have to do a Surprisingly Large Amount of what one would _think_ were target-specific things in your code generator
[17:28:59] <graydon> tcsc: IOW, in LLVM-land they have a pile of ABI logic in clang
[17:29:02] <graydon> which we had to duplicate
[17:29:12] <graydon> because LLVM-per-se doesn't do it for you
[17:29:55] <graydon> olsonjeffery: marked for retry
[17:30:04] <olsonjeffery> ty
[17:30:12] <pnkfelix> true_droid: it looks to me like if you move the `let adder = â€¦` down below your assignment `a = 10;` then the warning goes away.  Not sure if you've already discovered that.
[17:30:50] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[17:30:50] *** ChanServ sets mode: +o tjc
[17:31:27] <pnkfelix> true_droid: (It looks to me like the lint pass is treating the capture into the adder-closure as an immediate read at the time that the closure is creataed, rather than treating it as any number of potential future reads according to when the closure is called.)
[17:31:30] <tcsc> graydon: that's a bummer but makes sense. my intuition would be that stuff of that nature would be needed eventually for a c++ ffi
[17:32:40] *** Quits: mark_edward (quassel@moz-4A5B1251.wisolt4.epbfi.com) (Ping timeout)
[17:32:47] *** Joins: mark_edward (quassel@moz-4A5B1251.wisolt4.epbfi.com)
[17:32:55] <true_droid> pnkfelix: sure, moving the adder further down removes the warning. But that would defeat the purpose of show-casing what capturing a mutable variable means
[17:33:18] <graydon> tcsc: yes, and much more. this is even just handling C. the really gnarly one is x64: https://github.com/mozilla/rust/blob/master/src/librustc/middle/trans/cabi_x86_64.rs
[17:33:24] <pnkfelix> true_droid: no disagreement here.  I more mentioned it as it may provide a hint hint as to what the underlying bug is in the lint analysis.
[17:33:27] *** Joins: echristo (echristo@DCF57675.D6CCE4AE.77834EAA.IP)
[17:33:56] <graydon> tcsc: by comparison the x86 one is pretty benign. https://github.com/mozilla/rust/blob/master/src/librustc/middle/trans/cabi_x86.rs
[17:33:56] *** Joins: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net)
[17:34:33] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[17:34:33] *** ChanServ sets mode: +o brson
[17:34:51] *** Quits: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP) (Input/output error)
[17:36:59] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[17:37:10] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[17:37:54] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[17:38:52] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[17:40:36] <olsonjeffery> brson: so, for async tcp .. #6842 is pretty gnarly and talks about all kinds of runtime level stuff, it seems.. and there's no real concensus there, either.. but based on my read of the newsched tcp code, i feel like we can do something right now
[17:41:07] <olsonjeffery> amusingly, the .NET async socket API is quite close to libuv..and we saw how that worked out before
[17:41:25] <olsonjeffery> in terms of begin/end methods for operations, use of callbacks ,etc
[17:42:20] <olsonjeffery> with some additional wiring that isn't really relevant for us (the mutex that you use block until an operation completes, for example, is instantiated by the user)
[17:42:22] <tcsc> graydon: those are actually much simpler than I expected. I can't find the code atm, but i remember that logic being much more complicated in factor's jit
[17:42:48] *** Joins: Ralith (ralith@moz-50F3C77.vc.shawcable.net)
[17:42:58] <olsonjeffery> brson: anyways.. im thinking of, to start, perhaps flushing out a ReaderAsync et al Trait and impl'ing it for TcpStream..?
[17:43:45] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[17:43:47] <tcsc> although that even handles weird stuff like _Complex
[17:43:51] <olsonjeffery> with a similar api.. although the question of how to handle the buffer allocation would go down (buf: &mut [u8])..
[17:44:39] <olsonjeffery> it seems like that would be returned as part of a future..
[17:44:42] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[17:45:10] <olsonjeffery> or would it just be that the user allocs that buffer and moves it into the async call.. and then it is moved into the callback when the operation is complete? could that work/
[17:45:13] <olsonjeffery> ?
[17:45:19] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[17:45:55] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[17:47:10] *** Quits: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net) (Quit: jclements)
[17:48:13] *** Quits: tcsc (tcsc@moz-7246F5CD.hsd1.ma.comcast.net) (Quit: computer sleeping)
[17:48:43] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Quit: Computer has gone to sleep.)
[17:49:45] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[17:50:08] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[17:50:48] *** Quits: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP) (Quit: Textual IRC Client: www.textualapp.com)
[17:50:51] *** Quits: mihneadb (mihneadb@moz-BE33DA21.fw1.sfo1.mozilla.net) (Ping timeout)
[17:51:13] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[17:51:30] *** Joins: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP)
[17:51:45] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[17:52:04] *** Joins: mihneadb (mihneadb@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:52:57] *** Joins: Wapitidou (Poppy@moz-A3D39C51.adsl-dyn.isp.belgacom.be)
[17:53:07] *** Joins: achim (achim@moz-D200DC82.pools.arcor-ip.net)
[17:54:26] *** Joins: Mowah (Mowah@moz-436C35C5.cust.bredbandsbolaget.se)
[17:54:31] <brson> olsonjeffery: I believe that an async I/O API will need to use heap-allocated buffers
[17:55:19] *** Quits: tav (tav@moz-E0A503B0.range109-156.btcentralplus.com) (Quit: tav)
[17:55:28] <olsonjeffery> would the user still alloc them? or would they indicate the buffer size?
[17:55:31] *** Joins: seth (seth@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:55:42] <olsonjeffery> in that case, the signature changes to `buf: ~[u8]` .. ?
[17:55:51] <olsonjeffery> and that becomes a param in the callback..
[17:55:59] *** Joins: dherman (dherman@9FDD6B3.897ED74E.4EA770CF.IP)
[17:55:59] *** ChanServ sets mode: +o dherman
[17:56:02] <Wapitidou> Hi, I've trouble reading files in rust 0.7, i'm simply doing "let reader = file_reader(Path("file.txt")); but the compiler  whines "unresolved name file_reader".
[17:57:05] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[17:57:10] <tjc> Wapitidou: you have to say io::file_reader(Path("file.txt"));
[17:57:12] <graydon> huh
[17:57:20] <tjc> or else: use std::io::file_reader; at the beginning
[17:57:31] <graydon> which module in std should I put benchmarks-of-random-language-stuff in?
[17:57:43] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[17:57:45] <graydon> like "how fast we allocate a @-box" or "how fast we destructure a vec"
[17:57:56] *** Joins: kertap (kertap@moz-5AE34C97.b-ras3.mvw.galway.eircom.net)
[17:58:58] <Wapitidou> thanks tjc 
[17:59:06] <tjc> Wapitidou: you're welcome
[17:59:18] <pnkfelix> graydon: you're putting microbenchmarks in std and not extra?  â€¦ is that because you'll be using the microbenchmark timings as part of the gating you're planning?
[17:59:25] <Wapitidou> Also, why does the for [1, 2, 3].each |var| syntax no longer works ?
[17:59:49] <graydon> pnkfelix: if they are stable enough, yes. if not they are at least things we can collect, plot, watch for regressions.
[17:59:50] *** Quits: eholk (eholk@223C5EED.83FFA18A.ABD5273E.IP) (Quit: eholk)
[18:00:06] <engla> tjc: I think it must be std::io::file_reader, io is not in prelude
[18:00:37] <brson> olsonjeffery: what does .net do?
[18:00:38] *** Quits: rlbaker (rlbaker@moz-C8EE266C.hfc.comcastbusiness.net) (Quit: rlbaker)
[18:00:43] <tjc> engla: ah ok, I lost track of whether that was changed or not
[18:00:59] *** Joins: eholk (eholk@223C5EED.83FFA18A.ABD5273E.IP)
[18:01:09] <engla> it's much neater now with everything inside io
[18:01:13] <engla> inside std:: I mean
[18:01:19] *** Quits: eholk (eholk@223C5EED.83FFA18A.ABD5273E.IP) (Quit: eholk)
[18:01:39] *** Joins: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com)
[18:01:42] *** Joins: rlbaker (rlbaker@moz-C8EE266C.hfc.comcastbusiness.net)
[18:02:07] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[18:02:16] *** Joins: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl)
[18:02:18] *** Joins: vosen (vosen@moz-266BA656.icpnet.pl)
[18:02:54] <olsonjeffery> brson: well.. good point/question. the socket takes an Object as "state", and you'd probably stick a reference type instance in there that contains a buffer, which you'd pass into the call to BeginReceive, called within the AcceptCallback.. see: http://msdn.microsoft.com/en-us/library/fx6588te.aspx
[18:03:23] <olsonjeffery> AsyncTcpStream<T>, where T is the state obj passed into the ctor? and the T is available in callbacks.. ?
[18:04:42] <olsonjeffery> actually, i misspoke.
[18:04:54] <olsonjeffery> the state is passed into the BeginReceive, heh.
[18:05:28] <olsonjeffery> so, when accepting: 1) alloc space containing the buffer.. 2) pass the buffer *and* state-object into the BeginReceive call
[18:06:55] <olsonjeffery> but, simultaneously .. the semantics of C#/.Net are so much different from rust.. so, yes. they heap alloc it in their async api. but: most everything [useful/non-trivial] is heap allocated in .net!
[18:07:12] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[18:08:04] <olsonjeffery> but perhaps the point is that we can't really get away with keeping the data on the stack.. but id like to explore it. i think it'd be nifty if TcpStream kept both sync and async impls and you could switch, as-needed. but that may be a recipe for trouble.
[18:08:12] <olsonjeffery> and .net clearly keeps them separate (sync vs async sockets)
[18:08:20] <brson> is this really the .net api that people say is so great?
[18:09:22] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Quit: jmgrosen)
[18:09:26] <true_droid> which version will signify that Rust will have reached the maturity #1 milestone?
[18:09:36] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[18:09:37] <brson> i don't see any futures here
[18:09:44] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[18:09:44] <jedestep> speaking of tcp libraries, should the read() and write() methods of TcpStream be public?
[18:09:46] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[18:10:39] <bstrie> "i don't see any futures here" sounds like a line you'd recite to a roomful of schoolchildren to crush their dreams
[18:11:45] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[18:11:47] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[18:11:52] *** Quits: doener (doener@moz-121949B3.unitymediagroup.de) (Quit: leaving)
[18:11:55] <brson> olsonjeffery: are you  familiar with ReadAsync?
[18:11:56] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[18:12:58] *** Quits: Earnestly (earnest@2AB30F53.FB5005.2BCC804A.IP) (Quit: WeeChat 0.4.2-dev)
[18:13:12] <brson> i wish there were some good articles about .net's async I/O. I remember it being a big deal when they introduced it
[18:13:34] <brson> the async/await keyword stuff
[18:13:57] <olsonjeffery> oh, that's totally different
[18:14:02] <brson> olsonjeffery: can you review this stuff: http://msdn.microsoft.com/en-us/library/kztecsys.aspx
[18:14:15] *** Joins: Earnestly (earnest@2AB30F53.FB5005.2BCC804A.IP)
[18:14:28] <olsonjeffery> that stuff works a lot of c#'s yield .. it generates a state machine
[18:14:35] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[18:15:20] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[18:15:51] <jedestep> are read() and write() on TcpStream supposed to be private? it seems like that's the API I should be using but I can't import those functions
[18:16:14] *** Joins: tikue_ (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[18:16:21] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[18:16:21] *** tikue_ is now known as tikue
[18:16:21] <brson> bstrie: lol
[18:16:21] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[18:16:44] <brson> jedestep: yes, they should be public
[18:17:04] <brson> jedestep: but they are impls of public traits
[18:17:07] <brson> or should be
[18:17:26] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[18:17:28] <bstrie> I think sanxiyn knows C# well? perhaps he can comment
[18:17:44] *** Quits: rlbaker (rlbaker@moz-C8EE266C.hfc.comcastbusiness.net) (Quit: rlbaker)
[18:17:48] <jedestep> I'm using std::rt::io::net::tcp::* but it tells me that no method called read() or write() are in scope, so I'm guessing the lack of pub qualifier is causing it
[18:17:56] <jedestep> I also import std::rt::io::{Reader,Writer}
[18:18:33] *** Joins: eholk (eholk@223C5EED.83FFA18A.ABD5273E.IP)
[18:18:33] <brson> jedestep: that's surprising. importing Reader/Writer should do it
[18:19:14] *** Joins: MaikKlein1 (maik@moz-CE64528C.dip0.t-ipconnect.de)
[18:20:15] *** Quits: nano (nano@moz-972880B.superkabel.de) (Connection reset by peer)
[18:20:19] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: zzzzzzzzzz)
[18:20:28] *** Quits: MaikKlein (maik@moz-EFA928EF.dip0.t-ipconnect.de) (Ping timeout)
[18:20:34] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[18:21:12] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[18:21:12] *** ChanServ sets mode: +o tjc
[18:21:30] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[18:23:07] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[18:27:23] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[18:29:44] *** Joins: Lilly (PinkLace@moz-145A6857.bredband.comhem.se)
[18:31:00] *** Joins: Uther (Instantbir@moz-1B244B05.hfc.dyn.abo.bbox.fr)
[18:31:55] <Lilly> Hello, I'm wondering something. Am I the only one who thinks that the "shortened" keywords look a bit silly? I'm talking about, for example, "pub" and "priv". I remember "ret" was used instead of return a long time ago, and I think it's worth considering replacing some of the shortened keywords with longer and more readable words.
[18:31:56] *** Quits: mark_edward (quassel@moz-4A5B1251.wisolt4.epbfi.com) (Ping timeout)
[18:32:40] <jedestep> I don't mind pub
[18:32:59] <Lilly> Idk, maybe it's just me
[18:33:04] <Eridius> I'm all for pub and priv. It's just syntactic noise, no need to make it any noisier
[18:33:17] <doomlord> i prefer them, if only for the fact they look less like c# and java. the fact it *needs* public often, i'm much happier with it being short . remember it also pairs up with fn
[18:33:18] <Lilly> I think it becomes a bit harder to read
[18:33:40] *** Joins: mark_edward (quassel@moz-4A5B1251.wisolt4.epbfi.com)
[18:33:49] <Lilly> I may just be used to Java and C++
[18:33:52] <doomlord> pub fn   not public    priv fn  vs private.    The rust examples mean you have one thing to grep for to find functions
[18:34:00] <doomlord> i'm used to C++ and welcome a change
[18:34:24] <doomlord> i'm fed up of things not changing
[18:34:36] <engla> pub is great
[18:35:19] <engla> it shouldn't take up more space
[18:35:21] <Lilly> yeah you're right doomlord
[18:35:30] *** Joins: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP)
[18:36:17] <Lilly> But in that case, why was "ret" raplacecd with "return"?
[18:36:29] <doomlord> because they have somethign even shorter for ret :)
[18:36:48] <Lilly> I guess. I prefer writing out "return" rather than levaing off the ;
[18:37:11] <bstrie> I prefer writing out return for anything that's not a one-liner
[18:37:12] <Lilly> Becomes more readable in my opinion
[18:37:34] <Lilly> bstrie: Agreed; I use the short syntax for one line functions
[18:37:43] <Lilly> or expressions
[18:38:32] <doomlord> i  like the expression style of doing things where possible ..  again if only because its different.  escape the routine..
[18:38:36] <strcat> well that's not the style used in the codebase
[18:38:43] <strcat> it leaves out 'return' except for early returns
[18:38:51] <kemurphy> pnkfelix: re https://github.com/mozilla/rust/pull/7958#commitcomment-3687659, what's the right thing to do? copy the string into a ~ and track it until cleanup?
[18:38:57] <Lilly> I think the codebase is hard to read :s
[18:39:19] <strcat> it's hard to read the last expr of the function being a return?
[18:39:35] <Lilly> It looks like the function doesn't return at all
[18:40:09] <olsonjeffery> it's something i've learned to notice.
[18:40:26] <doomlord> you just have to start reading expressions rather than statements. its refreshing IMO
[18:40:27] <olsonjeffery> just because something isn't immediately intuitive, based on given expectations, doesn't mean a person can't retrain themselves
[18:40:33] <olsonjeffery> otherwise we'd all be writing machine code
[18:40:43] <Lilly> Very true
[18:41:15] <Lilly> I guess I'm just too used to seeing return when something returns. :)
[18:41:24] <doomlord> i do find my fingers still always write the types first - but i have no problem reading the syntax changes
[18:41:59] <Lilly> I for one really liked the "let x: T" syntax
[18:42:05] <doomlord> speaking of machine code, you can say that the absence of return is natural - whatevers last evaluated is just there ... :)
[18:42:08] <Lilly> Adapted to is quickly
[18:42:37] <Lilly> doomlord: haha, that's a nice way to think about it :)
[18:42:59] <doomlord> i still remember let and fn from formative years (basic) ... and i liked auto in c++11 alot- and let is a clear step forward over auto
[18:43:14] <doomlord> DEF FNblah .. DEF PROCblah .. :)
[18:43:32] <Lilly> I think I've also maybe read too much code without semicolons at the end of statements
[18:43:49] <Lilly> So it just looks like a statement
[18:44:00] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[18:44:01] <Lilly> I know Rust doesn't have statements
[18:44:11] <Lilly> But you are all right
[18:44:16] <Lilly> Better to just learn to adapt
[18:44:19] <bstrie> we do have statements? it's all very confusing
[18:44:30] <Lilly> Or change would never happen :)
[18:44:30] <doomlord> i like their choices, 80% of the time they are improvements over c++
[18:44:51] *** Joins: wilmoore_ (wilmoore@moz-7EE4D9D6.mystrotv.com)
[18:44:51] <Lilly> bstrie: aren't the only statements "let"?
[18:45:11] <Wapitidou> I'm sorry to bother you again, I can't find where FileFlag are, they should be in std::io::FileFlag, right ?
[18:45:12] *** Quits: wilmoore (wilmoore@moz-1248C037.mystrotv.com) (Ping timeout)
[18:45:54] <Lilly> doomlord: I agree
[18:46:04] *** Joins: ecr (Thunderbir@moz-19C7F72B.uoregon.edu)
[18:46:12] <bstrie> Lilly: I dunno, someone explained it to me before and I promptly forgot how it all works
[18:46:13] *** Quits: ecr (Thunderbir@moz-19C7F72B.uoregon.edu) (Quit: ecr)
[18:46:23] <Lilly> I really prefer "let x = y" to "auto x = y"
[18:46:30] <doomlord> the types going after makes it easier to write neater declarations, you can line them up in columns
[18:46:43] *** Quits: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP) (Client exited)
[18:46:52] <doomlord> you have to read less far to see the salient information
[18:47:03] <Lilly> bstrie: I *think* that everything except "let" (and maybe a few other things?) are expressions
[18:47:07] <Lilly> rather than statements
[18:47:22] <Lilly> 'if' for example
[18:47:51] *** Joins: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP)
[18:48:05] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[18:48:06] <Lilly> doomlord: also it becomes more apparent that you are declaring a variable
[18:48:30] <doomlord> i became OCD about context sensitive grammar. now i'm just starting to unlearn a C habit..
[18:48:46] <Lilly> seeing a line starting with "let" instantly let's me know we are declaring a variable
[18:48:50] <doomlord> .. i always write my programs upside down, to avoid prototyping things
[18:49:06] <doomlord> now in rust i can actually write ''main' at the top :)
[18:50:08] <Lilly> I also like the lang=main thingy
[18:50:22] <Lilly> I was always annoyed that my main function HAD to be called "main"
[18:50:26] <Lilly> like it's some magic word
[18:50:40] *** Joins: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com)
[18:50:43] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[18:51:07] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[18:51:35] *** Joins: igl (igl@moz-2E0BD007.adsl.alicedsl.de)
[18:52:40] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[18:52:40] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/hq4m7w
[18:52:40] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[18:52:47] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: zzzzzzzzzz)
[18:52:50] *** Joins: milinda (milinda@DA212585.7CFC0820.51B6877.IP)
[18:53:52] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Ping timeout)
[18:53:55] *** jyeo is now known as jyeo_brb
[18:54:30] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[18:55:26] *** Quits: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com) (Quit: pcwalton)
[18:55:38] <graydon> pcwalton: if I were to take a stab at the remaining matters blocking fast-hello-world, do you think it's the sort of thing I would figure out and get done, or would flail around helplessly at?
[18:55:40] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[18:55:40] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/sdfCQA
[18:55:40] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[18:55:40] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[18:55:40] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/Ba8BRQ
[18:55:40] <ghrust> 13rust/06auto 149f3fbc0 15Jeff Olson: std: add RtioTimer and UvTimer impl atop rt::uv
[18:55:40] <ghrust> 13rust/06auto 14cc29be8 15Jeff Olson: std: add rt::io::Timer
[18:55:40] <ghrust> 13rust/06auto 1439ddb21 15Jeff Olson: std: minor timer cleanup based on feedback
[18:55:42] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[18:56:14] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[18:56:40] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[18:57:31] *** Quits: wilmoore_ (wilmoore@moz-7EE4D9D6.mystrotv.com) (Connection reset by peer)
[18:57:44] *** Joins: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com)
[18:57:44] *** ChanServ sets mode: +o pcwalton
[18:57:47] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[18:59:09] *** Joins: Houm (Houm@moz-25669AA8.fbx.proxad.net)
[19:00:42] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Connection reset by peer)
[19:00:52] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[19:01:43] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[19:01:43] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14b7994e8 to 1448f115e: 02http://git.io/N3iJvQ
[19:01:43] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[19:02:07] *** Joins: nano (nano@moz-972880B.superkabel.de)
[19:04:18] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[19:04:22] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[19:04:30] <Wapitidou> Nobody knows ?
[19:05:11] <Ms2ger> that the dice are loaded...
[19:05:20] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[19:05:20] *** ChanServ sets mode: +o tjc
[19:05:37] <engla> Wapitidou: it's in std::io
[19:05:37] *** Joins: tchoma (textual@moz-BE33DA21.fw1.sfo1.mozilla.net)
[19:05:48] *** Joins: mschifer1 (Adium@moz-BBE3ABD.mv.mozilla.com)
[19:05:48] *** Quits: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[19:05:51] *** Quits: lkuper (lkuper@5188CCE.A402E718.C082B7DC.IP) (Quit: lkuper)
[19:06:09] <Wapitidou> I did import that one, but still, he doesn't recognize it
[19:06:39] <tjc> graydon: ping
[19:07:18] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Ping timeout)
[19:07:18] <graydon> tjc: pong
[19:07:25] <engla> Wapitidou: if you 'use std::io' you have to say 'io::Create' to refer to a flag
[19:08:02] <tjc> graydon: Question about the Makefiles...
[19:08:12] <tjc> I'm trying to change test.mk so the rule for rustpkgtest depends on the rustpkg executable
[19:08:22] <Ms2ger> Poor graydon 
[19:08:28] *** Quits: MaikKlein1 (maik@moz-CE64528C.dip0.t-ipconnect.de) (Ping timeout)
[19:08:46] <tjc> so I just copied/pasted the definition of rustpkg from tools.mk
[19:09:02] <tjc> but I get: *** No rule to make target `/rustpkg', needed by `x86_64-apple-darwin/stage2/test/rustpkgtest-x86_64-apple-darwin'
[19:09:11] <tjc> it refers to TBIN and I can't figure out where that's defined
[19:09:56] <Wapitidou> undeclared module io engla :/ So sorry for bothering you
[19:10:18] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[19:10:36] <Wapitidou> So let me get this straight, I'd like to acess the FileFlag enum inside the io module, but don't know how (to use with file_writer() )
[19:10:47] <engla> Wapitidou: ok, what's your rust version?
[19:11:02] <graydon> tjc: you'll need to show me a diff
[19:11:09] <tjc> graydon: ok, 1 sec
[19:11:10] <Wapitidou> 0.7 engla 
[19:12:07] <tjc> graydon: https://gist.github.com/catamorphism/6056682
[19:13:29] <strcat> tjc: it's probably just not defined where you're using it
[19:14:16] <strcat> a bunch of the makefile is templated within the part handling stages
[19:14:52] <strcat> hm
[19:15:05] <engla> Wapitidou: something like this should be fine..   use std::io; io::file_writer(file_path, [io::Create])
[19:15:30] <kertap> how would I go about turning &mut ~[u8] into ~[u8]?
[19:15:38] <strcat> tjc: the TBIN targets are defined in tools.mk
[19:15:45] *** Quits: milinda (milinda@DA212585.7CFC0820.51B6877.IP) (Input/output error)
[19:16:40] <graydon> strcat: no, they're defined in Makefile.in
[19:16:43] <graydon> but that's not the problem
[19:16:50] <graydon> the problem is you're using $(4) in there
[19:17:05] <jedestep> is anyone familiar with what might be causing a program running some fairly simple rt::io::net::tcp stuff to throw SIGABRT
[19:17:16] <graydon> tjc: are you trying to depend on host or target bin?
[19:17:25] <strcat> jedestep: out-of-memory? catch it with gdb and you can get a backtrace
[19:17:33] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Ping timeout)
[19:17:42] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[19:17:50] <graydon> tjc: TBIN_* are variables relating to where target binaries go. HBIN_* are variables relating to host binaries
[19:18:10] <graydon> tjc: I'm guessing you want host binaries
[19:18:21] <tjc> graydon strcat: Sorry, was afk
[19:18:27] *** Quits: dherman (dherman@9FDD6B3.897ED74E.4EA770CF.IP) (Quit: dherman)
[19:18:42] <tjc> hmm, I guess I want the host binary, since the tests need to run rustpkg on the machine that's building it
[19:18:53] <graydon> yeah
[19:19:27] <graydon> tjc: so the first problem with what you copied is that it is TBIN not HBIN; the more-serious problem is that it's using $(4) in a define-block that only has 3 arguments, not 4
[19:19:49] <graydon> define-blocks are makefile template that gets expanded-and-interpreted
[19:20:02] <graydon> the $(1) .. $(4) variables are arguments to the define block
[19:20:07] <Wapitidou> Thanks a lot engla !
[19:20:09] *** bent|errands is now known as bent
[19:20:11] <graydon> you copied code out of a block with 4-args
[19:20:15] *** jyeo_brb is now known as jyeo
[19:20:16] <graydon> and pasted it into a block with 3-args
[19:20:18] <Wapitidou> I'm slowly getting the grasp
[19:20:21] <graydon> which doesn't work :)
[19:20:51] <tjc> graydon: Yeah, so I'm guessing I want: 		$$(HBIN$(1)_H_$(2))/rustpkg$$(X_$(3))       instead?
[19:20:58] <graydon> tjc: maybe
[19:21:02] <graydon> if you're trying to run tests
[19:21:05] *** Joins: mellum (falk@moz-1BE50B64.dip0.t-ipconnect.de)
[19:21:06] <graydon> they are typically target tests
[19:21:11] <graydon> so maybe you want the target rustpkg?
[19:21:18] *** Joins: strcat1 (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[19:21:52] <graydon> it depends what this edge is trying to do. rustpkgtest is a target artifact, yes?
[19:21:52] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[19:22:02] *** strcat1 is now known as strcat
[19:22:06] <mellum> Hi. Is it possible that the rust syntax changed a lot lately? Because I'm trying to compile sample programs and they just don't compile
[19:22:06] <tjc> yeah
[19:22:15] <graydon> if you're testing that it can install stuff _as_ the target, then you want TBIN after all
[19:22:35] <graydon> sorry, I guess .. cross compilation is confusing, doubly so when you're running tests of a cross-aware package manager :(
[19:22:38] <tjc> yeah
[19:22:42] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[19:22:48] <tjc> so how do I import the thing that defines TBIN?
[19:22:49] <Crnobog> stage0 and stage1 rustc are now looking for different libpthreads on mingw :/
[19:23:03] <kemurphy> would it be feasible to allow, say, [T, ..0] for static items? (think the 0-sized-array-at-end-of-struct trick in C)
[19:23:21] <mellum> more precisely, I'm looking at this one http://rusttutorial.blogspot.de/2012/09/command-line-user-input-stdin.html
[19:23:24] <graydon> tjc: it's imported already. it's in Makefile.in
[19:23:27] <tjc> kemurphy: Not sure, but I think () should have zero size now, so you could use that for the end-of-struct value
[19:23:34] <graydon> tjc: you just need to name the correct TBIN variable. there are a lot of them.
[19:23:44] *** Joins: zslayton (Mibbit@1D191528.269AFE30.6A3AF4D7.IP)
[19:23:53] <graydon> tjc: one for each target/host pair
[19:24:14] <tjc> graydon: since it depends on the librustc in TLIB$(1)_T_$(2), _H_$(3), I'm guessing I want the same pattern for rustpkg?
[19:24:22] <bblum> ugh, the change to the build system that made it remove previous libraries made my testing experience *worse*, not better
[19:24:25] <graydon> tjc: likely!
[19:24:37] <tjc> well, here goes nothing
[19:24:39] <graydon> bblum: how so?
[19:24:41] <bblum> because now for basically 99% of the time while i have a build running, the libraries aren't in place to do other stuff
[19:24:49] <graydon> oh
[19:24:53] <kemurphy> tjc: it's more that i want an array to appear inline at the end of the struct, but don't want to bother updating the bounds value
[19:24:56] <graydon> yeah. it also complains a lot :(
[19:25:26] <Ms2ger> kemurphy, sounds like you want to avoid memory safety? :)
[19:25:47] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[19:25:58] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[19:26:08] <kemurphy> Ms2ger: well, this is only for a static item, presumably the compiler could still enforce safety and just infer the length of the struct :P
[19:26:12] <jedestep> memory doesn't seem to be an issue. does raising a condition cause a SIGABRT?
[19:26:20] <graydon> tjc: the TBIN variables are defined in Makefile.in line 372. they have 3 varrefs inside them: stage number, target triple, host triple
[19:26:22] <bblum> if it could just remove old stuff right before it's about to write out the new library
[19:26:27] <jedestep> (or at least did it on 0.7)
[19:26:32] <strcat> jedestep: it shouldn't
[19:26:36] <strcat> what platform are you on?
[19:26:42] <graydon> tjc: so make sure that whatever $(n) you're putting in those positions, they are in fact stage number, target triple and host triple
[19:26:43] <jedestep> osx 10.8
[19:26:44] <tjc> graydon: Yeah, I see that now; based on running make -n check, I *think* I did the right thing (testing for real now)...
[19:26:45] <tjc> thanks
[19:26:49] <jedestep> x86 64bit
[19:26:52] <kemurphy> Ms2ger: but yes, my use case is in unsafe code anyway
[19:27:19] <graydon> tjc: also check the $$(X_$(n)) thing for getting the exe extension right
[19:27:33] <graydon> tjc: the line you pasted had a $(4) in there too
[19:28:21] <tjc> graydon: I think the extension becomes $2 here, since the rule is making rustpkgtest-$(2)$$(X_$(2))?
[19:28:25] *** Quits: tchoma (textual@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[19:29:02] <graydon> tjc: in that rule, $(2) is the target
[19:29:12] *** Joins: tchoma (tchoma@moz-BE33DA21.fw1.sfo1.mozilla.net)
[19:29:13] *** Joins: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net)
[19:29:16] <graydon> tjc: and $(X_$(2)) is the target .exe extension, yeah
[19:29:32] *** Joins: robertknight (robertknig@moz-AB0E96D7.range86-162.btcentralplus.com)
[19:29:34] <graydon> (there's a separate X_$(foo) variable for each target triple)
[19:29:40] <graydon> it's all just variable indirection
[19:29:45] <tjc> Oh, X for extension. well, obviously :-)
[19:30:07] <graydon> in GNU make all you have are like 'eval', 'call', macros and synthetic variable indirection.
[19:30:34] <Ms2ger> Bless you
[19:30:51] <true_droid> I can capture a mutable value inside a managed closure https://gist.github.com/alco/6056871
[19:30:59] <true_droid> how to do the same for an owned closure?
[19:31:14] *** Quits: robertknight (robertknig@moz-AB0E96D7.range86-162.btcentralplus.com) (Ping timeout)
[19:31:15] <bblum> true_droid: currently that is forbidden
[19:31:48] <bblum> true_droid: to work around it, you might put the value in a std::cell::Cell, and let mut x = x.take() it inside the closure
[19:31:51] *** Quits: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP) (Quit: Leaving.)
[19:32:23] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Quit: jmgrosen)
[19:32:24] <engla> true_droid: ~fn has the bound Send by default, and @mut T is not compatible with Send
[19:32:38] <true_droid> bblum: I think I've found a way https://gist.github.com/alco/6056871#file-gistfile2-txt-L1
[19:33:00] <true_droid> engla: sure, but I don't want to capture @mut a, I want to captue let mut b = ~a;
[19:33:45] <bblum> true_droid: you should not need the ~a for that; you should just be able to let mut b = a;
[19:33:49] <engla> you can capture ~a, but you can't move out of it
[19:33:51] <bblum> because ints are copyable
[19:34:27] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[19:35:02] <true_droid> bblum: let mut b = a; does not work because https://gist.github.com/alco/6056871#file-gistfile3-txt-L1
[19:35:37] *** Joins: sigma (sigma@CB3F6051.C886FCFF.DF0EE696.IP)
[19:35:43] <bblum> true_droid: inside the closure
[19:35:49] <bblum> |x| { let mut b = a;
[19:36:40] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[19:37:20] <jedestep> it appears that when Listener::bind raises a condition, the runtime throws a SIGABRT. no idea if this is unique to this instance or what
[19:37:26] <true_droid> bblum: right, but the effect is actually not what I wanted: b gets reassigned to the same value of a on each invocation
[19:37:37] <bblum> true_droid: i see
[19:37:52] *** Joins: int3_ (int3_@moz-7B0110AD.mv.mozilla.com)
[19:39:03] <bblum> true_droid: this is something of an interesting point. currently rustc forbids exactly what you are trying to do, on the justification that allowing it would cause potential confusion to someone who was expecting it *not* to change between iterations
[19:40:44] <true_droid> bblum: I was expecting it work the same way @mut does. Since the closure would be the only owner of the value, it should be able modify it at will if the value is mutable. In fact, I've seen the ~mut errors out with "deprecated syntax" error and this makes me think that ~mut used to be allowed and capturing it the same way as @mut was probably allowed too
[19:41:11] <bblum> true_droid: Your analysis is correct.
[19:41:43] <bblum> nmatsakis: ping, you may be interested in this discussion
[19:42:04] <bblum> true_droid: with the current version of rustc, the best you can do is use Cell, and use .take() and .put_back()
[19:42:09] <bblum> or .with_mut_ref()
[19:42:20] *** Quits: int3_ (int3_@moz-7B0110AD.mv.mozilla.com) (Client exited)
[19:42:30] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[19:42:45] <true_droid> bblum: yep, thanks for this workaround
[19:43:00] <jedestep> how can I catch a condition?
[19:43:23] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[19:43:45] <pcwalton> the servo stuff going on right now is way more exciting than hacking rustc :)
[19:43:51] <tjc> jedestep: check out the examples in the unit tests for conditions, in std::condition -- there are also some uses of conditions in rustpkg that are pretty straightforward
[19:43:54] <pcwalton> we're a few bugs away from acid1
[19:44:00] <graydon> pcwalton: !
[19:44:06] <jedestep> tjc: thanks :)
[19:44:11] <graydon> how is that .. _possible_?
[19:44:12] <pcwalton> graydon: https://www.evernote.com/shard/s2/sh/614d62a9-ec8a-421b-a603-f2d814cf1d41/686028c31c376f4bfac5372d841a9a0e/deep/0/Servo.png
[19:44:16] <pcwalton> getting there
[19:44:21] <pcwalton> that's with the text removed
[19:44:28] * graydon boggles
[19:44:28] <pnkfelix> kemurphy: sorry for delay in response.   I don't know the right answer, but what you suggest sounds like a better option than what is there now.  I'm curious whether any similar bugs are lying dormant in the code base
[19:44:58] <graydon> I wonder which order it's most useful to group benchmark metric results in
[19:45:00] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Ping timeout)
[19:45:22] <graydon> rev/builder/slave/metrics-set.json?
[19:45:51] <graydon> builder/slave/rev/metrics-set.json?
[19:45:58] <graydon> hooray for relational databases
[19:46:16] <kemurphy> pnkfelix: fwiw, i've seen that pattern elsewhere in trans; i think anything kept in the ast is at least around long enough for llvm emission.
[19:46:57] <kemurphy> could be wrong though; anyone else know better?
[19:46:59] *** Joins: milinda (milinda@moz-C79ADF95.dhcp-bl.indiana.edu)
[19:47:28] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[19:47:33] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[19:47:49] *** Joins: MaikKlein1 (maik@moz-CE64528C.dip0.t-ipconnect.de)
[19:48:10] *** Joins: int3_ (int3_@moz-7B0110AD.mv.mozilla.com)
[19:49:23] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[19:49:39] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[19:51:13] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Connection reset by peer)
[19:52:47] *** Joins: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com)
[19:52:58] *** Joins: Guest__ (textual@BBE7C46A.B4F11D08.8612FA94.IP)
[19:53:22] *** Quits: Axord (xord@moz-C3CCF156.lsanca.dsl-w.verizon.net) (Ping timeout)
[19:55:25] *** Joins: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com)
[19:56:12] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[19:57:11] *** Joins: ssbr (ssbr@moz-141F89C6.block0.gvtc.com)
[19:57:30] *** Joins: Khmar (user@A420B6CD.B01207CF.FA4E5DC4.IP)
[19:57:42] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[19:57:46] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[19:58:53] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[19:59:52] *** Quits: Khmar (user@A420B6CD.B01207CF.FA4E5DC4.IP) (Ping timeout)
[20:00:05] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[20:00:39] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Quit: Leaving.)
[20:00:44] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[20:01:08] *** Joins: BitPuffin (quassel@moz-1789B472.bredband.tre.se)
[20:02:59] *** Quits: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com) (Ping timeout)
[20:03:18] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[20:03:25] *** Joins: Khmar (user@A420B6CD.B01207CF.FA4E5DC4.IP)
[20:03:51] * sully adds another table to ty::ctxt
[20:04:17] *** Joins: jmgrosen (jmgrosen@moz-BF80C818.sbcc.edu)
[20:04:22] <jedestep> https://github.com/mozilla/rust/issues/7976
[20:04:53] *** Quits: nano (nano@moz-972880B.superkabel.de) (Connection reset by peer)
[20:05:16] <bblum> configure: error: C compiler cannot create executables.
[20:05:18] <bblum> false.
[20:05:38] *** Quits: kertap (kertap@moz-5AE34C97.b-ras3.mvw.galway.eircom.net) (Quit: kertap)
[20:05:46] * strcat hates autotools
[20:05:56] *** Quits: milinda (milinda@moz-C79ADF95.dhcp-bl.indiana.edu) (Input/output error)
[20:06:35] *** Quits: jmgrosen (jmgrosen@moz-BF80C818.sbcc.edu) (Quit: jmgrosen)
[20:06:59] *** Joins: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com)
[20:07:09] <Khmar> Hello everyone. I was trying out the rust tutorial. Specifically the part that deals with redefining variable types. I tried this and expect a warning as a tutorial suggests but get an error. Am I doing something wrong or does the documentation need an update? - http://pastebin.mozilla.org/2688945
[20:07:16] *** Joins: Axord (xord@moz-C3CCF156.lsanca.dsl-w.verizon.net)
[20:07:28] <erickt1> jedestep: #7976 should be using conditions, but I don't see any documentation about how to use them
[20:07:52] <erickt1> jedestep: lemme see if I can find an example for you
[20:08:00] <bblum> Khmar: interesting, that probably just changed, and the tutorial is outdated; please file a bug
[20:09:02] <jedestep> erickt1: it appears to be using conditions. even if I trap them it still aborts
[20:09:18] <Khmar> bblum: Will do. Thanks!
[20:09:43] <strcat> Khmar: does it really call that *redefining* a variable type? because it's not
[20:09:44] <erickt1> jedestep: that's a separate issue :) can you add the code that exhibits the issue to #7976?
[20:09:58] <Khmar> One sec.
[20:10:04] <mellum> I'm getting an error message "cannot move out of captured outer variable" for this program: http://pastebin.mozilla.org/2689011 can someone explain to me how to avoid this?
[20:10:47] <Khmar> strcat: It says local variables can "shadow" earlier declarations. 
[20:10:52] <bblum> mellum: https://github.com/mozilla/rust/wiki/Doc-under-construction-FAQ#once-functions
[20:12:31] <engla> mellum: your dist function should probably work on string slices (&str) anyway?
[20:12:34] <bblum> mellum: in your particular case, 'iterate' might run the closure more than once, so the workaround suggested there won't help
[20:12:45] <bblum> so 'lines' should be referenced with & somewhere
[20:13:16] <mellum> engla: I don't know what "slices" are, I'm new :-) It's just supposed to compare two strings
[20:13:43] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[20:14:03] <jedestep> erickt1: https://gist.github.com/jedestep/6057219 also posted it on the issue
[20:15:12] <engla> mellum: right, ~str is an owned string and &str is a string slice or "borrowed" string. If you take ~str arguments, those arguments will be consumed (= the function you call will take ownership of the ~str)
[20:15:37] <engla> for comparison you only need to examine the strings, not take ownership, so you'd use &str
[20:15:55] <mellum> engla: ah! okay, so I'll use &str then
[20:16:30] <bblum> engla: good explanation
[20:17:13] <erickt1> jedestep: but you are still getting the abort if you add in a rt::io::io_error condition?
[20:17:23] <mellum> is this uint.iterate really the simplest way to loop from 0 to n-1?
[20:17:38] <jedestep> erickt1: yes, it aborts no matter what
[20:17:47] <erickt1> does it give a message?
[20:17:59] <Ms2ger> mellum, probably
[20:18:13] <Khmar> strcat: https://github.com/mozilla/rust/issues/7977
[20:18:43] <engla> mellum: I think uint::range is exactly the same as uint::iterate. But the former is used all the time
[20:19:03] <zslayton> Khmar: the error you're seeing is due to declaring monster_factor as a float but assigning it an integer literal in the same line. You can write that 10 as either 10f or 10.0 to fix the problem. I suspect that due to that first issue you're not getting to see the warning the tutorial mentions.
[20:19:49] <Khmar> That works zslayton 
[20:19:52] <jedestep> erickt: "Abort trap: 6"
[20:20:07] *** Quits: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP) (Quit: )
[20:20:16] <erickt1> jedestep: how about running it with "gdb" and getting a backtrace?
[20:20:24] *** Joins: reyre (rick@B2D8AB09.33EE9F8A.1139E686.IP)
[20:20:43] <erickt1> I thought conditions fail instead of SIGABRT
[20:20:53] *** Joins: Vert (quassel@8A83479C.391ACC8C.CAF63861.IP)
[20:20:57] <jedestep> I tried making a test program that just raised some random condition and it failed as expected
[20:21:02] <jedestep> gave me a nice error message and everything
[20:21:03] <Khmar> I'm closing the bug.
[20:21:11] <jedestep> it seems to just be things from this library
[20:21:34] *** Quits: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl) (Quit: Leaving)
[20:21:58] <erickt1> jedestep: I don't think newio has been officially blessed yet. brson, is this still the case?
[20:22:30] <Khmar> Thanks zslayton. I've closed the bug. I should go through the tutorial when I'm less sleepy.
[20:24:01] <zslayton> Khmar: Sure thing! haha, no worries
[20:24:09] *** Quits: Khmar (user@A420B6CD.B01207CF.FA4E5DC4.IP) (Ping timeout)
[20:24:48] <brson> erickt1: the new io subsystem is very much not ready yet
[20:24:58] <brson> and doesn't work at all without the new scheduler
[20:25:03] <brson> which is still off
[20:25:03] <jdm> Thiez: remember that conversation we had about move_val_init on Friday? your suggestion fails when I deal with generic types :(
[20:25:25] <erickt1> jedestep: see brson's reply ^
[20:25:41] <jdm> https://gist.github.com/jdm/6057331
[20:26:02] <jedestep> well then
[20:26:19] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[20:26:27] <jedestep> i'll stop pounding my head against this issue
[20:27:52] <brson> jedestep: the new scheduler can be turned on with RUST_NEWRT=1
[20:28:18] <strcat> jdm: well you can't move out of &mut T
[20:28:18] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[20:28:21] <strcat> because you don't own it
[20:28:29] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[20:28:32] <strcat> and move_val_init wants by-value
[20:28:48] <jdm> strcat: did you look at the gist? the foo function works just fine
[20:29:00] <jdm> only foo2 fails
[20:29:08] <strcat> was looking only at foo2
[20:29:09] <engla> jdm: the S type is implicitly copyable
[20:29:21] <jdm> yeah, that figures
[20:29:30] *** Quits: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:29:31] <strcat> jdm: when it's non-generic, it's implicitly copyable
[20:29:39] <strcat> because it's known that it doesn't have a destructor or contained &mut
[20:29:55] <strcat> generic types are assumed to not be implicitly copyable though, so anything by-value is a move
[20:29:55] <jdm> what does implicitly copyable mean when it contains a unique pointer?
[20:30:14] <strcat> well, it's just struct S{x:int,y:int}
[20:30:23] <jdm> strcat: I know, I'm asking hypothetically.
[20:30:32] <strcat> jdm: well it wouldn't be implicitly copyable if it contained ~
[20:30:39] <strcat> because ~ has a destructor
[20:30:43] <jdm> ah
[20:30:46] <strcat> by-value would be a move of ownership
[20:30:56] <strcat> and to do that you need to own the source
[20:31:03] <engla> the equivalent code in generic form would be with T: Copy before..  now you need .clone()
[20:31:06] <erickt1> jedestep: I'm going to close out your bug, please file a new issue if you run into other problems with RUST_NEWRT
[20:31:40] <jdm> ok, so backing up to the original problem I'm trying to solve
[20:31:45] <jdm> I'm trying to replicate placement new
[20:31:52] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Ping timeout)
[20:31:53] *** Joins: rlbaker (rlbaker@moz-C8EE266C.hfc.comcastbusiness.net)
[20:31:55] *** Quits: rlbaker (rlbaker@moz-C8EE266C.hfc.comcastbusiness.net) (Quit: rlbaker)
[20:32:22] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[20:32:52] *** Joins: rlbaker (rlbaker@moz-C8EE266C.hfc.comcastbusiness.net)
[20:32:53] <jdm> my current solution is to create my value then move it into a buffer prepared for it
[20:32:57] *** Quits: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com) (Quit: bye bye)
[20:33:04] <kmc> there's a placement new in the implementation of Rc<T>
[20:33:19] <strcat> jdm: http://ix.io/6O7 yeah I ended up using move_val_init for Rc::new
[20:33:19] <jdm> kmc: yeah, but it doesn't seem to work for
[20:33:22] *** Quits: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP) (Quit: Leaving.)
[20:33:29] <jdm> strcat: yes, hence why I was hoping to do so
[20:33:47] <strcat> move_val_init takes the source by-value
[20:33:59] <strcat> so your function should take a generic T by-value like that
[20:34:14] <strcat> and the caller can choose to clone if they can't just hand you ownership
[20:34:22] <jdm> huh
[20:34:29] <jdm> cloning would be bad, I'm pretty sure
[20:34:39] *** Quits: int3_ (int3_@moz-7B0110AD.mv.mozilla.com) (Client exited)
[20:34:53] <engla> if you pass &mut T you have to clone in every case
[20:35:10] *** Joins: milinda (milinda@moz-C79ADF95.dhcp-bl.indiana.edu)
[20:38:57] *** Quits: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com) (Quit: pcwalton)
[20:39:36] <kimundi> mellum: Late response, but yeah rusts syntax has changed a lot in the last 10 months. Right now it's mostly stable, but that just means that now the libraries are changing a lot in the future.
[20:39:36] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[20:39:43] <mellum> what do I do if I want the program to abort if the match _ is reached? "_ => assert!(false)" doesn't work since it's not the right type
[20:39:54] <mellum> kimundi: okay, good to know :-)
[20:40:25] *** Joins: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com)
[20:40:25] *** ChanServ sets mode: +o pcwalton
[20:40:39] <engla> mellum: fail!("message") or just fail!()
[20:40:43] <brson> mellum: fail!() or util::unreachable()
[20:40:48] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[20:41:06] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[20:41:23] *** Joins: int3_ (int3_@moz-7B0110AD.mv.mozilla.com)
[20:41:49] <engla> you can put fail!() anywhere so it's useful to stub out parts
[20:42:03] <mellum> cool, thanks
[20:43:39] <bblum> toddaaro: https://gist.github.com/bblum/6057504
[20:43:43] <tikue> bblum: https://gist.github.com/tkuehn/050cc8a6adb6efb99be3
[20:43:51] <tikue> bblum: does that look like the best way to do that
[20:43:59] <bblum> toddaaro: the same thing also for switch_running_task_and_then(), if that still exists
[20:44:09] <true_droid> hey guys, I've pushed a draft of my blog post about Rust closures https://github.com/alco/blog/blob/master/posts/2013-07-22-Rust-lambdas.md
[20:44:14] <true_droid> literally spent the whole day on it
[20:44:29] <true_droid> I'll be grateful if someone proof-reads it for inaccuracies
[20:44:30] <true_droid> thanks
[20:45:26] <mellum> is there something like list comprehensions? What I want is the [u8] from a str where each element is transformed by aa_id(c: char) -> u8
[20:46:09] <kimundi> mellum: Not list comprehension, but we have cool new external iterators for that
[20:46:22] <kimundi> (those are also the reaso why there is no .each anymore)
[20:46:34] <engla> good job at writing it yourself when nobody else has true_droid :)
[20:46:41] *** Joins: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP)
[20:46:41] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/QhPI9g
[20:46:41] *** Parts: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP) ()
[20:46:47] <mellum> kimundi: how would you use these for this example?
[20:46:55] *** Quits: achim (achim@moz-D200DC82.pools.arcor-ip.net) (Quit: Computer has gone to sleep.)
[20:47:41] <true_droid> engla: thanks
[20:48:37] <zslayton> mellum: I think that strings have an as_bytes() method which will return a vector of u8
[20:49:09] <kimundi> rusti: let x = [1u8,2,3,4,5,6]; let mut i = x.iter(); for i.transform(|e| (*e)*3 + 100 ).advance |e| { printf!("%? ", e);  }
[20:49:13] -rusti- <anon>:7:42: 7:43 warning: variable does not need to be mutable [-W unused-mut (default)]
[20:49:13] -rusti- <anon>:7          let x = [1u8,2,3,4,5,6]; let mut i = x.iter(); for i.transform(|e| (*e)*3 + 100 ).advance |e| { printf!("%? ", e);  }
[20:49:13] -rusti-                                                    ^
[20:49:13] -rusti- 103 106 109 112 115 118 ()
[20:49:16] <mellum> zslayton: ah, I guess then I can use vec.map or something
[20:49:37] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[20:49:37] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/ALIx1Q
[20:49:37] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[20:49:38] <kimundi> mellum: vec map went also instinct I think
[20:49:39] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[20:49:39] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/JZkRmg
[20:49:39] <ghrust> 13rust/06auto 1430f13e6 15Gareth Smith: Add slice_from and slice_to methods for vec, like the...
[20:49:39] <ghrust> 13rust/06auto 149ed82fb 15bors: auto merge of #7943 : Dretch/rust/vec-slice-from-to, r=huonw
[20:49:39] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[20:49:46] <strcat> kimundi: not yet
[20:49:56] <zslayton> mellum: you can also do my_string.iter() to get an external iterator over each char
[20:50:02] <strcat> still need in-place algorithms though
[20:50:09] <kimundi> mellum: anyway, the above is how you'd iterate over an external iterator
[20:50:26] <strcat> I was trying to think up a way to implement them generically on iterators of &mut T, maybe it would just work like that
[20:50:55] *** Joins: Jesin (Jessin_@moz-1B1307FF.eecs.lehigh.edu)
[20:51:19] <kimundi> rusti: let x = [1u8,2,3,4,5,6]; let i = x.iter(); for i.transform(|e| (*e)*3 + 100 ).advance |e| { printf!("%? ", e);  } println("");
[20:51:19] -rusti- 103 106 109 112 115 118 
[20:51:20] -rusti- ()
[20:51:55] <kimundi> can also collect them into a vector directly
[20:52:09] *** Joins: achim (achim@moz-D200DC82.pools.arcor-ip.net)
[20:52:18] <zslayton> mellum: You can map a function over the iterator's returned results and get a vector of the results with my_string.iter().transform(<your closure here>).collect()
[20:52:22] <kimundi> rusti: let x = [1u8,2,3,4,5,6]; let i = x.iter(); let v: ~[u8] = i.transform(|e| (*e)*3 + 100 ).collect(); v
[20:52:23] -rusti- ~[103, 106, 109, 112, 115, 118]
[20:52:29] *** Joins: nmatsaki_ (nmatsakis@moz-D343FE64.bstnma.fios.verizon.net)
[20:52:33] <zslayton> kimundi: Thanks. :)
[20:53:05] *** Joins: ecr (Thunderbir@moz-19C7F72B.uoregon.edu)
[20:53:14] <engla> true_droid: ok I'm reading it, for your information the name of the 'function pointer' is `extern "Rust" fn(Arg) -> R` (with return type and arguments filled in
[20:53:14] *** Joins: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com)
[20:53:24] *** Parts: ecr (Thunderbir@moz-19C7F72B.uoregon.edu) ()
[20:53:57] *** Quits: mihneadb (mihneadb@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: Leaving)
[20:54:02] <zslayton> mellum: 'transform()' will become 'map()' soon -- it's on the docket
[20:54:42] *** Quits: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net) (Quit: msingle)
[20:54:45] <true_droid> engla: by "the name" you mean how it's referred to in the community? I found that an argument of type &fn(â€¦) -> â€¦ can accept functions to
[20:54:48] <true_droid> *too
[20:55:03] *** Quits: Vert (quassel@8A83479C.391ACC8C.CAF63861.IP) (Ping timeout)
[20:55:18] <engla> true_droid: the type
[20:55:54] <kimundi> true_droid: extern fn is a function pointer, &fn et al are closures
[20:56:00] <engla> https://github.com/mozilla/rust/pull/7944
[20:56:06] <engla> oops wrong paste
[20:56:10] <engla>  expected `()` but found `extern "Rust" fn(<V5>) -> <V5>`
[20:56:31] *** Joins: lkuper (lkuper@5188CCE.A402E718.C082B7DC.IP)
[20:56:32] <kimundi> a function pointer can be coerced to a closure
[20:56:43] *** Joins: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com)
[20:56:47] *** Quits: nmatsaki_ (nmatsakis@moz-D343FE64.bstnma.fios.verizon.net) (Quit: Computer has gone to sleep.)
[20:56:48] *** Parts: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com) ()
[20:56:52] <engla> it's autoborrowed, it gets a null environment
[20:56:54] <mellum> why is the type annotation "v: ~[u8]" needed there? It seems it should be inferable
[20:57:10] <kimundi> mellum: This is a specific case where it's NOT inferable
[20:57:18] <true_droid> engla: OK, I'll read up about extern tomorrow and make appropriate edits
[20:57:18] <kimundi> at least not as is
[20:57:29] <engla> true_droid: it's not an important thing
[20:57:40] <engla> what the type is called
[20:57:53] <kimundi> mellum: collect is a generic method. You can collect to anything: vectors, hassets, linked lists, etc
[20:58:04] <mellum> kimundi: ah, I see. That's cool actually.
[20:58:14] <kimundi> so, you have to somehow tell the compiler which one you want
[20:58:55] <engla> true_droid: there is another thing with closures not mentioned, you can specify the trait bounds (builtin trait) for the environment.  ~fn() is ~fn:Send() by default and I think the other closure types have no bounds by default
[20:59:04] <kimundi> It might still be inferable with later uses of methods on x, but changes are those are trait methods also present on other possible matching types
[21:00:24] <kimundi> mellum: However, what we probably want in the future is to leave of inferable parts of the type: 'let x: ~[?] = foo.bar.collect()'
[21:00:31] <engla> mellum: so basically you can map from any collection to any other
[21:01:30] *** Quits: milinda (milinda@moz-C79ADF95.dhcp-bl.indiana.edu) (Input/output error)
[21:01:31] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[21:01:43] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[21:02:07] *** Quits: Ms2ger (Ms2ger@E699BE68.4A4AF98A.F15B0BB3.IP) (Quit: nn)
[21:03:49] <true_droid> engla: those bounds seem not documented very well, I can only find some issues mentioning them
[21:04:12] <sp3d> ughhhh I just dug up more language specifications than I ever want to see again
[21:04:29] *** Quits: Kruppe (user@moz-4DDA8AB8.uwaterloo.ca) (Ping timeout)
[21:05:57] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[21:06:02] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[21:06:51] <engla> true_droid: by the way, I think we say closure for the object, but lambda expression for the  |_| { .. }  syntax
[21:07:56] *** Quits: igl (igl@moz-2E0BD007.adsl.alicedsl.de) (Connection reset by peer)
[21:08:54] <true_droid> engla: I thought so too, but the tutorial refers to both as just closures, so I kept that simplification in my post
[21:09:07] *** Quits: sigma (sigma@CB3F6051.C886FCFF.DF0EE696.IP) (Quit: Leaving.)
[21:09:32] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[21:09:53] <true_droid> engla: I think I'll mention bounds and externs as topics for future posts. So far, I can only see them explained in Nico's blog and I can't yet fully understand what is already working and what is still planned 
[21:10:30] <engla> there's nothing extern about it. it's just the name of the type for a function. extern "Rust" fn()
[21:11:47] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[21:13:50] <bblum> graydon: i don't have triage bugs yet for this week
[21:13:53] <bblum> i would like some
[21:14:16] <bblum> otherwise i will spend all afternoon waiting for stdtest builds, and be sad
[21:15:10] <mellum> so int is the width of long in C, or something?
[21:15:18] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[21:15:51] <strcat> mellum: no, intptr_t
[21:16:25] <mellum> strcat: I see
[21:18:07] *** Quits: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net) (Quit: jclements)
[21:18:54] <tjc> I don't have triage bugs either, bblum
[21:18:56] <tjc> maybe nobody does?
[21:19:05] <brson> no
[21:19:10] <brson> no triage bugs
[21:19:10] *** Quits: zslayton (Mibbit@1D191528.269AFE30.6A3AF4D7.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[21:19:11] <tjc> you could always sort bugs by least-recently-updated, though...
[21:19:13] <tjc> and go ahead and triage
[21:19:20] <tjc> you don't have to stick to just the randomly assigned ones :-)
[21:19:23] <brson> zarro triage boogs
[21:19:39] <graydon> I probably messed something up, sec.
[21:20:17] <sp3d> brson: what did you mean by "nominating" on bug 7946?
[21:20:44] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[21:20:49] <graydon> sending triage email now
[21:20:49] *** Quits: mark_edward (quassel@moz-4A5B1251.wisolt4.epbfi.com) (Ping timeout)
[21:20:54] <graydon> (messed up the .json file, python is picky)
[21:20:54] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[21:21:08] <brson> sp3d: that means i think it's worthy of being on a milestone
[21:21:24] <brson> sp3d: specifically because it affects the language grammar
[21:21:31] <sp3d> ah, but not any particular one
[21:21:34] <strcat> graydon: what's the "[ ]" for in the bullet list of triage issues?
[21:22:13] <graydon> github markdown extension so you can paste it into a gist and get checkboxes
[21:22:14] <graydon> cmr asked for it
[21:22:22] <strcat> ah
[21:22:22] <graydon> he's been doing 100 a week and was having trouble keeping track
[21:22:43] <toddaaro> wait a 100 of what
[21:23:18] *** Joins: bytewise (bytewise@moz-649C630D.unitymediagroup.de)
[21:23:41] *** Joins: Nisstyre (wes@moz-FD86289.netflash.net)
[21:24:07] *** Joins: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net)
[21:24:21] <bblum> thanks graydon 
[21:24:28] <bblum> i have them now
[21:24:35] <strcat> toddaaro: bug triage
[21:24:59] <strcat> bugs being the measurement unit ;p
[21:25:39] <graydon> usually. occasionally it's just a single bug, difficulty 100
[21:25:42] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[21:25:46] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[21:25:49] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[21:25:51] <graydon> bug boss fight
[21:25:53] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[21:27:04] <tjc> bug triage: nightmare mode
[21:27:20] <toddaaro> that is a super impressive amount of triage
[21:27:43] <mellum> So, I finished my first Rust program :-) It's about 4 times slower than C++. Is that about expected?
[21:27:53] *** Joins: reyre_ (reyre@moz-9002CDDA.cpe.net.cable.rogers.com)
[21:28:10] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[21:29:08] <strcat> mellum: are you compiling with optimizations?
[21:29:12] *** Quits: tchoma (tchoma@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: Textual IRC Client: www.textualapp.com)
[21:29:26] *** Joins: mccr8 (mccr8@moz-BBE3ABD.mv.mozilla.com)
[21:29:39] <strcat> if it's any slower than C++, something is wrong
[21:29:44] <strcat> (more than 10-20%)
[21:31:13] <mellum> strcat: I have --opt-level=3
[21:31:21] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[21:31:38] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[21:32:51] <strcat> generally if you write equivalent code in rust and C++ it will compile to similar machine code, but that would mean using unsafe {} in rust
[21:33:10] <strcat> because lots of the library abstractions are poorly implemented right now
[21:33:17] <strcat> anyway can't really tell you much without knowing more
[21:34:10] <mellum> strcat: the program is here: http://pastebin.mozilla.org/2689409
[21:34:30] <mellum> the inner loop doesn't really use any library functions
[21:34:31] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[21:35:00] <tjc> mellum: for one thing, you'll probably want to make the mutation_dist vector a top-level static
[21:35:05] <tjc> not sure if LLVM will do that for you or not
[21:35:06] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[21:35:23] <strcat> mellum: what's the code in C++?
[21:35:50] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Ping timeout)
[21:35:55] *** Joins: mark_edward (quassel@moz-4A9A2F15.dynamic.utc.edu)
[21:36:01] <strcat> I wouldn't be surprised if this was I/O bound in rust though
[21:36:15] <strcat> the current non-experimental I/O libraries are really awful
[21:36:37] <strcat> println and fmt! are very bad
[21:36:44] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[21:37:00] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[21:37:03] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[21:37:59] *** Quits: bent (chatzilla@moz-2CD73AA6.triad.res.rr.com) (Quit: ChatZilla 0.9.90-rdmsoft [XULRunner 18.0.2/20130201065344])
[21:38:34] <mellum> the c++ is here http://pastebin.mozilla.org/2689435
[21:38:39] <mellum> needs -std=c++11
[21:38:54] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[21:39:22] <mellum> output is only 42860 lines so it shouldn't take up so much time
[21:39:57] <strcat> mellum: the I/O libraries are incredibly bad though
[21:40:02] <strcat> really wouldn't be surprised if it was that
[21:40:16] <strcat> println and fmt! are going to be turning into hundreds of lines of IR
[21:40:18] <strcat> and they
[21:40:21] <strcat> they're in the inner loop*
[21:40:57] <strcat> they'll dwarf the size of the actual code
[21:42:13] <mellum> well, if I comment out the printf, it gets only marginally faster
[21:42:22] <mellum> even though then it could be optimized to nothing :-)
[21:42:26] <MaikKlein1> oO is this a typo? let message_cell == Cell::new(message);
[21:42:42] <strcat> mellum: assert!/fail! are I/O too
[21:42:50] *** Quits: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[21:42:54] <MaikKlein1> rusti: let a == 5;
[21:42:54] -rusti- <anon>:7:15: 7:17 error: expected `;` but found `==`
[21:42:54] -rusti- <anon>:7          let a == 5;
[21:42:55] -rusti-                         ^~
[21:42:55] -rusti- application terminated with error code 101
[21:43:05] *** Joins: jgilbert (jgilbert@moz-7B0110AD.mv.mozilla.com)
[21:43:31] <mellum> strcat: right
[21:43:35] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Client exited)
[21:43:59] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[21:44:05] <strcat> assert turns to ~1200 lines of IR
[21:44:15] *** Joins: sigma (sigma@CB3F6051.C886FCFF.DF0EE696.IP)
[21:44:24] <mellum> so how do I make a 2D array static? static mutation_dist: ~[~[int]] = [... gives me "error: mismatched types: expected `~[~[int]]` but found `[[<VI440>, .. 21], .. 21]` ([] storage differs: expected ~ but found 21)"
[21:44:53] <strcat> mellum: the type is [[int, ..21], ..21]
[21:45:02] <strcat> ~[] is a dynamically sized array on the heap
[21:45:29] <mellum> hmm, can I have it static too? and have Rust count itself? :-)
[21:45:55] <strcat> not sure exactly what you mean
[21:45:55] *** Quits: sigma (sigma@CB3F6051.C886FCFF.DF0EE696.IP) (Ping timeout)
[21:45:55] *** Joins: dherman (dherman@moz-288175F4.public.wayport.net)
[21:45:55] *** ChanServ sets mode: +o dherman
[21:46:07] <strcat> ~[int] is like std::vector, and [int, ..21] is like std::array
[21:46:20] <strcat> and allocations aren't static
[21:46:34] <strcat> so only the latter is allowed in a static var
[21:46:37] <mellum> ah, that actually did the trick! it now only 1.58 times longer than c++
[21:47:00] <Lilly> Is there any way to ensure that you don't get out of bounds errors with arrays at compile time?
[21:47:37] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[21:47:54] <strcat> mellum: I think the assert!/fail! is probably turning into a lot of machine code and bloating the cache
[21:48:07] *** Quits: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP) (Quit: carllerche)
[21:48:16] <strcat> there were actually a few debug!/assert! left around in rust's hashmap and it made it 15% slower just from all the code bloat
[21:48:16] <slaren> does this look like a safe way to get the offset of a field ? https://gist.github.com/slaren/6058013
[21:48:19] <mellum> strcat: but there is no way to avoid counting the initializer size myself and have the compiler count it?
[21:48:44] <strcat> mellum: no, not atm
[21:48:56] *** Quits: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net) (Input/output error)
[21:49:00] <strcat> mellum: because rust makes you declare types explicitly on functions/statics
[21:49:16] <strcat> that could be optional for statics at least
[21:49:28] *** Quits: jgilbert (jgilbert@moz-7B0110AD.mv.mozilla.com) (Ping timeout)
[21:49:32] <strcat> at least ones with local scope
[21:49:56] *** Quits: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net) (Ping timeout)
[21:49:56] <strcat> rusti: fn foo() { static x: &str = "foo"; } // that's pretty annoying
[21:49:57] -rusti- <anon>:7:30: 7:34 error: Illegal anonymous lifetime: only 'static is allowed here
[21:49:57] -rusti- <anon>:7          fn foo() { static x: &str = "foo"; } // that's pretty annoying
[21:49:57] -rusti-                                        ^~~~
[21:49:57] -rusti- error: aborting due to previous error
[21:49:58] -rusti- application terminated with error code 101
[21:50:02] <strcat> rusti: fn foo() { static x: &'static str = "foo"; } // that's pretty annoying
[21:50:03] -rusti- ()
[21:50:23] *** Joins: jgilbert (jgilbert@moz-7B0110AD.mv.mozilla.com)
[21:50:33] <mellum> strcat: actually, replacing that fail! in dist with DIST_INFINITE makes it *slower*. That's weird
[21:50:40] *** Joins: wilmoore_ (wilmoore@moz-7EE4D9D6.mystrotv.com)
[21:51:25] <strcat> mellum: possible some are optimized out, if it can prove they're never hit
[21:51:29] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Ping timeout)
[21:51:42] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[21:51:42] <strcat> I think we have debug_assert! now for a debugging-only assert
[21:51:50] *** Joins: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net)
[21:52:12] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[21:52:39] <Lilly> shouldn't debug! expand to nothing if cfg doesn't contain debug?
[21:53:51] <brson> why is assert! so bloated? scary that we're removing important invariants
[21:54:28] <strcat> brson: fmt! is really awful, and it uses that
[21:54:45] <brson> that seems like an easy fix for cases where we're not actually passing a string
[21:54:47] <Eridius> Lilly: it expands to the current construct so the args are typechecked
[21:54:53] <strcat> imo throwing out fmt! is important, partly because of the performance and partly because %? is really unsound (lets you walk private fields, and assumes they're valid)
[21:54:58] <Eridius> but if false { .. } should get removed entirely due to dead code stripping
[21:54:59] <brson> most asserts don't pass a failure message
[21:55:11] <brson> does assert! even take a string?
[21:55:14] <strcat> brson: it always generates a message with stuff like the line number
[21:55:26] <brson> strcat: sure, but that doesn't _need_ to go through fmt
[21:55:43] <strcat> right
[21:55:55] <Lilly> are compiler annotations handeled after macros?
[21:55:55] <engla> assert_eq has a runtime message
[21:56:06] <strcat> %? is really bad though
[21:56:10] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[21:56:12] <strcat> because the visit glue is a lot of bloat
[21:56:17] <brson> i'm kind of surprised nobody has taken up the rewrite-and-or-redesign fmt! project
[21:56:18] <strcat> and visiting private fields is really bad
[21:56:28] <brson> but i guess it's a bit hairy
[21:56:35] *** Quits: Wapitidou (Poppy@moz-A3D39C51.adsl-dyn.isp.belgacom.be) (Quit: Leaving)
[21:56:35] <graydon> brson: yeah. it's a big piece to bite off.
[21:56:41] <engla> brson: someone had a wip
[21:56:42] <strcat> brson: well, it involves making a new trait for conversion to string-like things
[21:56:44] <brson> some for logging
[21:56:45] <graydon> and I think it's a bit blocked on IO libraries in general
[21:56:46] <bjz> brson: aatch and dbaupp were working on it
[21:56:48] <brson> *same
[21:56:52] <strcat> because ToStr isn't really acceptable because it allows allocates
[21:56:57] <strcat> always allocates*
[21:56:57] <pauls> Lilly: like `#[...]`?
[21:57:10] <Lilly> pauls: yeah
[21:57:16] <graydon> hmm
[21:57:19] <strcat> so someone would have to replace all of the existing conversion functions ;p
[21:57:27] <bjz> brson: but it seems like they got distracted
[21:57:32] <pauls> Lilly: I'm not sure, but I think they may be handled in the same pass.
[21:57:32] <engla> right. and use the new IO traits for Writers
[21:57:39] <pauls> If not, they're probably afterwards.
[21:57:44] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[21:57:48] *** Joins: gareth0 (gareth0@7C428FA9.3FD5F917.1A294DCF.IP)
[21:57:51] <mellum> can you suppress array bounds checks somehow?
[21:57:54] <bjz> brson: might have been because they were waiting for the IO, but I'm not sure
[21:58:17] <Lilly> What I mean is if you could add #[cfg=debug] inside the macro, and that would make the macro expand to nothing if debug isn't set
[21:58:22] <strcat> mellum: not without writing unsafe code, there are unchecked methods
[21:58:23] <graydon> this is a minor thing but: does anyone terribly mind if I store metrics logs under timemstamp directories calculated from the buildbot's sense of time, not git's?
[21:58:36] <graydon> getting the git timestamp threaded through to the right place turns out to be a bit .. tricky
[21:58:48] <graydon> (also: I hate time)
[21:58:58] <strcat> graydon: does it really need a timestamp? could it just use git describe?
[21:59:09] <graydon> strcat: I definitely can't run git describe in the middle of this step
[21:59:25] <strcat> graydon: it could be set as an env variable earlier though
[21:59:26] <graydon> I guess I could .. possibly do it client-side
[21:59:39] <graydon> this is about what the server does after it gathers up logs
[21:59:40] <strcat> oh this is on the server receiving them?
[21:59:42] <strcat> ah
[21:59:43] <graydon> it's putting them on s3
[22:00:00] <strcat> graydon: the client could tag them that way though
[22:00:05] <graydon> yeah, it could
[22:00:28] * strcat really likes git describe
[22:00:30] <graydon> I would prefer to avoid relying on client data too much. also that'll push me getting it working back a couple days.
[22:00:47] <MaikKlein1> how do I match on specific types again like match x { Err(v: T) => ... }?
[22:00:54] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[22:01:00] <graydon> I'm really trying to figure what'l be most useful for people writing tools that harvest the data
[22:01:05] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[22:01:16] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[22:01:20] <engla> MaikKlein1: the type is known at that point and can't be matched on
[22:01:22] <graydon> git describe also won't bin things by date, so expiring old data will be harder. maybe it's not important.
[22:01:43] <vladimir-lu> rusti: use std::libc::{c_void}; pub type CURL = c_void; fn foo { let x: *CURL = 0 as *CURL; }
[22:01:44] -rusti- <anon>:7:65: 7:66 error: expected `(` but found `{`
[22:01:44] -rusti- <anon>:7          use std::libc::{c_void}; pub type CURL = c_void; fn foo { let x: *CURL = 0 as *CURL; }
[22:01:45] -rusti-                                                                           ^
[22:01:45] -rusti- application terminated with error code 101
[22:01:49] <strcat> mellum: if you use iterators instead of indexing with an integer you won't have bounds checks though
[22:01:52] <vladimir-lu> rusti: use std::libc::{c_void}; pub type CURL = c_void; fn foo() { let x: *CURL = 0 as *CURL; }
[22:01:53] -rusti- <anon>:7:73: 7:74 warning: unused variable: `x` [-W unused-variable (default)]
[22:01:53] -rusti- <anon>:7          use std::libc::{c_void}; pub type CURL = c_void; fn foo() { let x: *CURL = 0 as *CURL; }
[22:01:53] -rusti-                                                                                   ^
[22:01:53] -rusti- ()
[22:01:54] <graydon> maybe I should bin by hashes. or not bin at all, just put it all in one big directory.
[22:01:56] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[22:02:02] <strcat> mellum: although I don't think it will matter on a statically sized array
[22:02:03] <vladimir-lu> why is that allowed and not unsafe?
[22:02:05] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[22:02:09] <graydon> s3 clearly doesn't care about having a million files in a directory
[22:02:17] <vladimir-lu> i quite clearly made a NULL pointer
[22:02:25] <strcat> vladimir-lu: because raw pointers act like integers
[22:02:35] <strcat> it's totally safe to do arithmetic with them or create them
[22:02:41] <strcat> dereferencing them is unsafe
[22:03:03] <strcat> same reason 'uint' is safe but unchecked indexing on an array is unsafe (that's the deref operation)
[22:03:06] <vladimir-lu> ok, let me think about this
[22:03:13] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[22:03:14] *** Quits: parcha (quassel@moz-A9A9F340.hsd1.ma.comcast.net) (Connection reset by peer)
[22:03:33] *** Joins: milinda (milinda@moz-C79ADF95.dhcp-bl.indiana.edu)
[22:03:36] <strcat> raw pointers can become dangling at any point so there's no hope in enforcing that they're always valid
[22:03:40] <strcat> dereferencing has to be the unsafe op
[22:03:54] <pauls> Lilly: sounds like it's worth a shot. What are you trying to do with conditionally expanding macros?
[22:03:56] <tikue> rusti: let mut a = 1; let mut b = 1; match (a, b) => { (a, b) => {a += 1; (a, b)} }
[22:03:56] -rusti- <anon>:7:52: 7:54 error: expected `{` but found `=>`
[22:03:56] -rusti- <anon>:7          let mut a = 1; let mut b = 1; match (a, b) => { (a, b) => {a += 1; (a, b)} }
[22:03:57] -rusti-                                                              ^~
[22:03:57] -rusti- application terminated with error code 101
[22:04:01] *** Quits: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com) (Quit: pcwalton)
[22:04:16] <tikue> rusti: let mut a = 1; let mut b = 1; match (a, b) { (a, b) => {a += 1; (a, b)} }
[22:04:17] <Lilly> pauls: I was just thinking it would be good for debug macros
[22:04:19] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/UePi
[22:04:23] *** Joins: parcha (quassel@moz-A9A9F340.hsd1.ma.comcast.net)
[22:04:24] <MaikKlein1> engla, right .... I was just stupid
[22:05:10] *** Joins: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com)
[22:05:10] *** ChanServ sets mode: +o pcwalton
[22:05:33] <jclements> Lilly: sounds like you could just create a single macro, debug!, that expands into unit if config doesn't include "debug".
[22:05:57] <vladimir-lu> strcat: my main worry is about not having any unsafe blocks passing it to a c function
[22:06:04] <jclements> Lilly: sounds useful!
[22:06:04] <vladimir-lu> but of course C invocation is unsafe already
[22:06:09] <Lilly> jclements: Yeah, that was what I was thinking; but is it possible right now?
[22:06:51] <strcat> vladimir-lu: any function taking a raw pointer and dereferencing it needs to be unsafe
[22:06:54] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[22:06:57] <strcat> vladimir-lu: nothing guarantees raw pointers remain valid
[22:07:02] <Lilly> To make deubg! basically create nothing if debugging is disabled
[22:07:13] <vladimir-lu> strcat: i know, i was just slightly surprised creating pointers is not unsafe
[22:07:25] <vladimir-lu> but it makes sense to only make deref unsafe
[22:07:35] <jclements> Lilly: yes, I think it should be. Erm... I think you can only hang a #[cfg...] annotation on an item, so it might get a bit hairy. You might have to put a module inside the expansion of the macro....
[22:08:02] <jclements> Lilly: sorry, no, no module necessary.  But you might have a few nested functions.
[22:08:12] <Lilly> Yeah, sounds a bit dirty
[22:08:34] <jdm> rusti: std::sys::size_of(~str)
[22:08:35] -rusti- <anon>:7:28: 7:31 error: unresolved name `str`.
[22:08:35] -rusti- <anon>:7          std::sys::size_of(~str)
[22:08:35] -rusti-                                      ^~~
[22:08:35] -rusti- error: aborting due to previous error
[22:08:35] -rusti- application terminated with error code 101
[22:08:49] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[22:08:49] <jdm> rusti: std::sys::size_of::<~str()
[22:08:49] -rusti- <anon>:7:33: 7:34 error: expected `,` but found `(`
[22:08:50] -rusti- <anon>:7          std::sys::size_of::<~str()
[22:08:50] -rusti-                                           ^
[22:08:50] -rusti- application terminated with error code 101
[22:08:52] <jdm> rusti: std::sys::size_of::<~str>()
[22:08:53] -rusti- 8
[22:08:59] <Lilly> I don't know if debug! might already be kinda clean, using annotations in macros was just an idea I got :)
[22:09:09] <jdm> rusti: std::sys::size_of::<~int>()
[22:09:10] -rusti- 8
[22:09:37] <jdm> rusti: std::sys::size_of::<Option<int>>()
[22:09:38] -rusti- 16
[22:09:43] <jdm> derp
[22:09:47] <jdm> that would be my problem
[22:10:01] <strcat> rusti: std::sys::size_of::<Option<~int>>()
[22:10:01] -rusti- 8
[22:10:05] *** Quits: jclements (jclements@moz-98A7BA64.ngn.east.myfairpoint.net) (Quit: jclements)
[22:10:16] <Lilly> About that^,  why do you need to type "size_of::<T>", instead of "size_of<T>"?
[22:10:19] <jdm> strcat: too bad I can't do that :(
[22:10:20] <vladimir-lu> rusti: std::sys::size_of::<Option<[int, ..3]>>()
[22:10:21] -rusti- 32
[22:11:50] <brson> Lilly: it's a parsing ambiguity with less-than
[22:11:52] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[22:12:01] <Lilly> brson: ah I see, thanks
[22:12:10] *** Quits: dherman (dherman@moz-288175F4.public.wayport.net) (Quit: dherman)
[22:12:35] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[22:13:27] <strcat> rusti: 5
[22:13:27] *** Joins: nmatsakis|phone (androirc@moz-D343FE64.bstnma.fios.verizon.net)
[22:13:27] -rusti- 5
[22:14:15] <jdm> rusti: enum A { A1, A2 }; enum B { AnA(A), AnInt(int) }; std::sys::size_of::<B>()
[22:14:16] -rusti- 16
[22:14:22] <jdm> rusti: enum A { A1, A2 }; enum B { AnA(A), AnInt(int) }; std::sys::size_of::<A>()
[22:14:23] -rusti- 8
[22:14:28] <jdm> geeze, that's rough
[22:14:32] <jdm> I'm being destroyed here
[22:14:39] *** Joins: nmatsakis-mobile (androirc@moz-81878F95.tmodns.net)
[22:14:47] *** Quits: Axord (xord@moz-C3CCF156.lsanca.dsl-w.verizon.net) (Ping timeout)
[22:14:57] <strcat> jdm: well int is align 8, so even if it knew to use a 1-byte tag it would be 16
[22:15:10] <jdm> yeah, I suppose you're right
[22:15:24] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[22:15:30] <vladimir-lu> oh alignment plays into into sizing?
[22:15:34] <strcat> yes
[22:15:42] *** Quits: nmatsakis|phone (androirc@moz-D343FE64.bstnma.fios.verizon.net) (Ping timeout)
[22:15:45] <strcat> for example say you have
[22:15:52] <strcat> struct Foo { x: int, y: bool }
[22:16:12] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[22:16:14] <strcat> and int is align 8, so it needs to be at addresses that are multiples of 8
[22:16:17] <strcat> and you have
[22:16:20] <strcat> [Foo, ..2]
[22:16:44] <vladimir-lu> the bool makes the struct 16
[22:16:47] <strcat> yep
[22:16:57] <vladimir-lu> makes sense :)
[22:17:04] <strcat> there's #[packed], to disable the padding
[22:17:11] <saati> rusti: std::sys::size_of::<int>()
[22:17:12] -rusti- 8
[22:17:17] <strcat> x86 allows unaligned memory accesses, other architectures usually don't
[22:17:21] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[22:17:23] <strcat> and it's much slower until sandy/ivy bridge
[22:17:30] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[22:17:44] <saati> int is the native word size always in rust?
[22:18:01] <strcat> saati: int/uint are the same as intptr_t/uintptr_t (also ssize_t/size_t)
[22:18:29] <strcat> they have to be able to address every byte in the address space
[22:19:07] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[22:19:15] *** Joins: mihneadb (mihneadb@moz-BE33DA21.fw1.sfo1.mozilla.net)
[22:19:49] *** Quits: nmatsakis-mobile (androirc@moz-81878F95.tmodns.net) (Ping timeout)
[22:19:54] <strcat> rusti: print(std::str::from_bytes(std::run::process_output("uname", [~"-a"]).output))
[22:19:55] -rusti- Linux playpen 3.10.2-1-ARCH #1 SMP PREEMPT Mon Jul 22 08:47:24 CEST 2013 x86_64 GNU/Linux
[22:19:55] -rusti- ()
[22:20:15] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[22:20:16] * strcat should try porting rust to x32
[22:21:32] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[22:22:07] <vladimir-lu> oh we don't have 32-bit build?
[22:22:29] *** Quits: milinda (milinda@moz-C79ADF95.dhcp-bl.indiana.edu) (Input/output error)
[22:22:33] <saati> i think that's an alternate x86_64 abi in linux
[22:23:03] <strcat> it's x86_64 with 32-bit pointers
[22:23:03] <vladimir-lu> rusti: print(std::str::from_bytes(std::run::process_output("ps", []).output))
[22:23:04] -rusti-   PID TTY          TIME CMD
[22:23:04] -rusti-     1 ?        00:00:00 out
[22:23:04] -rusti-    13 ?        00:00:00 ps
[22:23:05] -rusti- ()
[22:23:20] *** Quits: mib_7vzdbe (Mibbit@BBE7C46A.B4F11D08.8612FA94.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:23:25] <StarLight> rusti: print(std::str::from_bytes(std::run::process_output("whoami", []).output))
[22:23:26] -rusti- ()
[22:23:40] <strcat> StarLight: probably don't have the syscalls whitelisted for those
[22:23:52] <graydon> I'd be happy to forget x32 exists entirely
[22:23:56] <vladimir-lu> and you have the 16 registers instead of 8
[22:24:17] <vladimir-lu> rusti: print(std::str::from_bytes(std::run::process_output("hostname", []).output))
[22:24:18] -rusti- ()
[22:24:36] *** Quits: mellum (falk@moz-1BE50B64.dip0.t-ipconnect.de) (Quit: mellum)
[22:24:40] <graydon> it's "faster" because nobody really has 80 quadrillion exabytes of memory
[22:24:53] <strcat> rusti: print(std::str::from_bytes(std::run::process_output("env", []).output))
[22:24:54] <graydon> (and a >4gb memory program is relatively rare on desktops, even today)
[22:24:56] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/EjXd
[22:25:12] <StarLight> rusti: print(std::str::from_bytes(std::run::process_output("pwd", []).output))
[22:25:13] -rusti- /home/rust
[22:25:13] -rusti- ()
[22:25:19] <StarLight> rusti: print(std::str::from_bytes(std::run::process_output("ls", []).output))
[22:25:19] -rusti- out
[22:25:20] <strcat> graydon: you could use x32 + multiprocessing though
[22:25:20] -rusti- ()
[22:25:39] <StarLight> rusti: print(std::str::from_bytes(std::run::process_output("cat", [~"out"]).output))
[22:25:43] -rusti- line longer than 150 columns, pastebinned: http://sprunge.us/hGWY
[22:25:45] <StarLight> wow
[22:26:06] <graydon> yeah, you could. it just feels like a narrow window in which it'll be a smart move, with a pretty high maintenance burden. I wouldn't bother implementing it just to throw it away in a few years.
[22:26:08] <strcat> 'out' is the binary compiled from the input you give it
[22:26:10] <strcat> it's also init
[22:26:16] <StarLight> yeah, that's what i thought
[22:26:19] <strcat> since it gets exec'ed
[22:26:33] <strcat> there's no file for the input because rustc actually just accepts it over a pipe
[22:26:38] <strcat> used to be
[22:26:42] <vladimir-lu> well also aslr is less effective, arguably
[22:27:21] <vladimir-lu> rusti: print(std::str::from_bytes(std::run::process_output("ip addr", []).output))
[22:27:22] -rusti- ()
[22:27:27] <strcat> graydon: I don't think it would be that hard to maintain, you'd just tell rust it's 32-bit but use the x32 backend
[22:27:31] <strcat> just needs the supporting asm
[22:27:48] <StarLight> rusti: print(std::str::from_bytes(std::run::process_output("ifconfig", []).output))
[22:27:48] <vladimir-lu> is there anything else you get besides the requisite registers?
[22:27:49] -rusti- ()
[22:27:52] <strcat> more useful than mips ;p
[22:28:09] <strcat> vladimir-lu: executable permissions on memory, etc.
[22:28:11] <graydon> vladimir-lu: sse2, PIC data references
[22:28:20] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[22:28:23] <strcat> syscall instruction for faster syscalls
[22:28:27] <graydon> they mopped up a lot of awkward when shifting from x86->x64
[22:28:30] <vladimir-lu> rusti: print(std::str::from_bytes(std::run::process_output("cat", [~"/sys/class/net/eth0/address"]).output))
[22:28:31] <strcat> graydon: can use sse2 with x86 though
[22:28:32] -rusti- ()
[22:28:38] <strcat> graydon: just not as a baseline arch
[22:28:49] <vladimir-lu> right
[22:29:00] <graydon> I'm aware of its lifecycle (mostly :)
[22:29:12] * vladimir-lu still can't believe he threw away the free intel manuals
[22:29:22] <graydon> (long ago I think I .. might have helped teach valgrind to parse sse2?)
[22:29:35] <olsonjeffery> brson: hey i just did a forced push update for #7916 because of, i believe, toddaaro's recently landed changes.. can i get a r+/retry?
[22:30:03] <olsonjeffery> .resume_task_immediately -> .resume_blocked_task_immediately was the only change, but i rebased
[22:30:33] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[22:31:14] *** Quits: lmandel (lmandel@F2D29657.F60B0462.67AC9B1.IP) (Quit: lmandel)
[22:31:15] <strcat> graydon: I'd rather not have a 3rd set of libs for multiarch though ;p
[22:31:21] <graydon> yeah
[22:31:23] <strcat> although the only thing using silly x86 is steam
[22:31:36] <graydon> huh?
[22:31:43] <strcat> I mean on my computer
[22:32:02] <graydon> aha. I was going to say. firefox and chrome still ship 32bit on a couple little platforms here and there. windows say.
[22:32:18] *** Joins: Axord (xord@moz-C3CCF156.lsanca.dsl-w.verizon.net)
[22:32:22] <olsonjeffery> ty
[22:32:46] <strcat> flash is even 64-bit now, so it can crash faster
[22:32:58] <graydon> isn't it discontinued yet?
[22:33:05] <strcat> graydon: the nsapi one is on linux
[22:33:06] <StarLight> i am not sure if it's a good thing or bad
[22:33:18] <strcat> graydon: but there's the pepper api one, although I use ffx so I can't use it
[22:33:46] <strcat> they still do security updates for the abandoned linux nsapi one though
[22:34:17] <graydon> shumway will save us
[22:34:44] <strcat> 11.2.202.297 the nsapi one, 11.8.800.97 pepper
[22:34:47] *** Quits: MaikKlein1 (maik@moz-CE64528C.dip0.t-ipconnect.de) (Ping timeout)
[22:35:06] <strcat> no idea if google is actually maintaining it or if adobe is just being cruel
[22:36:23] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[22:36:27] *** Quits: reyre_ (reyre@moz-9002CDDA.cpe.net.cable.rogers.com) (Ping timeout)
[22:36:31] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[22:36:46] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[22:37:39] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[22:37:39] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/JZkRmg
[22:37:39] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[22:37:49] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:38:09] *** Joins: reyre_ (reyre@moz-9002CDDA.cpe.net.cable.rogers.com)
[22:38:39] <strcat> graydon: firefox's gstreamer support + youtube-viewer have mostly weaned me off it anyway ;p
[22:38:59] <brson> where in the compiler is the code for auto-derefing self?
[22:39:27] <toddaaro> brson: do you know if there are any quirks in importing rt::local::Local to task/mod.rs?
[22:39:46] <toddaaro> brson: toggling it I get either a lint flag for unused import, or a missing import crash
[22:39:54] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[22:40:08] <pcwalton> I get to rewrite most of 31 files in rustc
[22:40:10] <pcwalton> wheeeee
[22:40:17] <pcwalton> changing visitor to use traits
[22:40:39] * strcat found another weird default method issue
[22:40:39] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[22:40:40] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/jBw8vw
[22:40:40] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[22:40:40] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[22:40:40] <ghrust> 01[13rust01] 15bors pushed 8 new commits to 06auto: 02http://git.io/JQnSpA
[22:40:40] <ghrust> 13rust/06auto 14219c1c7 15Brian Anderson: extra: Remove uv, net, timer code...
[22:40:40] <ghrust> 13rust/06auto 14a637db2 15Brian Anderson: extra: Add url module...
[22:40:40] <ghrust> 13rust/06auto 14f8c4d99 15Brian Anderson: std: Remove weak_task API. Unused
[22:40:42] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[22:40:55] <strcat> another xcrate one I think
[22:41:26] <strcat> it actually breaks rustc to make container::Container::is_empty a default method
[22:41:32] <toddaaro> brson: oh nevermind, unused import hiding in a function definition
[22:41:48] <pcwalton> maybe I should keep visit around and rename it to oldvisit
[22:42:33] <strcat> the bargain price tour of rust's types
[22:43:25] <graydon> pcwalton: I'd recommend landing a new visit as newvisit and doing incremental conversion
[22:43:31] <graydon> pcwalton: unless you've already done that
[22:43:39] <vladimir-lu> where is the uv stuff heading?
[22:43:46] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[22:44:04] <graydon> vladimir-lu: the new scheduler runs on uv internally. the explicit uv bindings are obsolete.
[22:45:09] <vladimir-lu> graydon: and the net stuff that was there - being rewritten i guess?
[22:45:14] <graydon> yes
[22:45:21] <graydon> much improved form
[22:45:33] <graydon> mostly already rewritten, aiui
[22:45:57] *** jyeo is now known as jyeo_afk
[22:46:17] *** Joins: zslayton (Mibbit@99121A90.5F4BC84E.66C78B76.IP)
[22:46:24] *** Quits: zslayton (Mibbit@99121A90.5F4BC84E.66C78B76.IP) (Quit: zslayton)
[22:46:44] <brson> most of the capabilities that the old net code had are already present under the new scheduler in some form, but it's still pretty rough. should improve quickly though once the old sched is dead
[22:46:58] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[22:48:16] <eevee> what's new scheduler look like?  any docs or blog posts yet?
[22:48:37] <toddaaro> eevee: not yet unfortunately
[22:49:06] <toddaaro> mostly just trying to get the thing going and remove the old code before we start writing
[22:50:24] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[22:50:43] *** Joins: ecr (Thunderbir@moz-19C7F72B.uoregon.edu)
[22:50:52] <bblum> brson: is there a plan to port old pipes.rs to the new runtime, so pipec works?
[22:51:14] <bblum> it does not seem difficult to port it in a way that works but that doesn't allow pipec to avoid allocating in pingpong-esque cases
[22:51:43] <bblum> seems like we should do that to enable removing the old rt, then put off actually porting it properly until far-future
[22:52:59] *** Joins: etw (john@moz-B2936CAB.nyc.res.rr.com)
[22:54:37] *** Joins: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com)
[22:54:50] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[22:55:04] <brson> bblum: i intend to delete it. imo the channel protocol concept should be revisited in the future with a complete rewrite
[22:55:31] <bblum> what about it warrants a rewrite?
[22:55:42] *** Quits: sp3d (a@moz-49806493.dhcp.stls.mo.charter.com) (Ping timeout)
[22:55:51] <bblum> implementation or interface/design?
[22:59:16] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[22:59:27] <jdm> I have a type Blob that lives in the dom::blob module
[22:59:41] <jdm> I would like arbitrary code to be able to do |use dom::*| and have access to the Blob type
[22:59:51] <brson> bblum: both. it's been very hard to maintain because of the library surface area exposed to macros. it was written in an old dialect. it's oriented toward the old scheduler model. the code is hard to understand. it has leaky abstractions (Select)
[22:59:55] <jdm> I've got a dom/mod.rs in which I'm trying to make this possible, but the magic isn't working for me
[23:00:03] <steven_is_false> Hello! What is the future of C++ in Rust's runtime? I know a lot of it is goingto be rewritten in Rust but will any of it remain in C++?
[23:00:36] *** Quits: donri (dag@moz-9BB61102.tbcn.telia.com) (Client exited)
[23:00:36] <bblum> brson: oh, what's wrong with select? i hope i did not copy the badness in my new implementation
[23:00:55] *** Quits: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[23:02:46] <jdm> is it possible for me to re-export a lower-down name into a higher module namespace?
[23:03:19] <graydon> jdm: yes
[23:03:36] <jdm> graydon: any prior art I can cargo-cult from? I'm hitting a chicken and egg problem with my attempts.
[23:03:38] <graydon> jdm: barring bugs and possible corner cases where names collide or such. example you want to get working?
[23:04:06] <graydon> std::libc contains some horriffic/beautiful examples
[23:04:06] <jdm> graydon: Blob exists in dom/blob.rs, I'd like it accessible via dom::*.
[23:04:10] <bblum> brson: is there some reason for having spawntask_try in rt::test that does different but similar things from task::try?
[23:04:38] <graydon> jdm: is dom/mod.rs a file implementing the dom module itself?
[23:05:05] <graydon> jdm: if so, put 'pub use blob::Blob;' in dom/mod.rs
[23:05:07] <jdm> graydon: mod.rs is a new attempt by me to get this working; previous dom was just a module.
[23:05:20] <jdm> graydon: when I do that, I can't declare the |pub mod blob|
[23:05:33] <brson> bblum: the Selectable macro is defined in std::pipes and exposes the PacketHeader concept. std::comm then reexports Selectable
[23:05:46] <jdm> graydon: either that comes first and I can do the pub use statements, or the pub use statements complain that blob isn't resolvable
[23:06:15] <graydon> jdm: sure. so 'pub mod blob; pub use blob::Blob;' ?
[23:06:45] <jdm> graydon: error: `use` and `extern mod` declarations must precede items
[23:06:52] <bblum> brson: doesn't seem like it should need to reexport selectable
[23:06:53] <graydon> oh, no pub use's before items, right
[23:07:02] <graydon> er, after items
[23:07:16] <bblum> brson: at least, i think my design does basically the same thing but doesn't reexport
[23:07:44] <graydon> jdm: curious. I would expect the correct order 'pub use blob::Blob; pub mod blob;' would work.
[23:08:10] <graydon> jdm: because the mod blob "exists" while the uses are being resolved. or it _should_
[23:08:13] <brson> bblum: spawntask_try was written before the std::task api was wired up to the new scheduler, and I was generally trying to keep the api's used for testing the new scheduler seperate from the public apis, mainly because I knew that the internal apis worked as i expected, particularly re: failure
[23:08:26] <bblum> i see
[23:08:37] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Textual IRC Client: www.textualapp.com)
[23:08:43] <graydon> pcwalton: am I misunderstanding the constraints on resolve? jdm is having a funny problem
[23:08:47] *** Quits: gareth0 (gareth0@7C428FA9.3FD5F917.1A294DCF.IP) (Broken pipe)
[23:08:53] <brson> bblum: there are public functions in comm that take Selectable types
[23:09:32] <pcwalton> graydon: jdm: that should work
[23:09:38] <pcwalton> however make sure that pub use is using the full path
[23:09:40] <pcwalton> to blob
[23:09:43] <pcwalton> foo::bar::blob::Blob
[23:09:58] <bblum> brson: sure, but the user should only need to see those types and those functions, not the trait itself, right?
[23:10:05] <bblum> i guess i should write a test program to verify this
[23:10:06] <jdm> pcwalton: aha, that did it
[23:10:07] <graydon> ah right, relative paths are probably biting you here
[23:10:15] <graydon> you can also do pub use self::blob::Blob I believe?
[23:11:54] *** Quits: mark_edward (quassel@moz-4A9A2F15.dynamic.utc.edu) (Client exited)
[23:12:14] <toddaaro> bblum: gist.github.com/toddaaro/6058532
[23:12:45] *** Joins: mark_edward (quassel@moz-4A9A2F15.dynamic.utc.edu)
[23:13:44] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[23:15:03] <cmr> toddaaro: it's not /that/ impressive
[23:15:08] *** Quits: brianm (brianm@moz-D74EBD8D.hsd1.co.comcast.net) (Ping timeout)
[23:15:16] *** Quits: rlbaker (rlbaker@moz-C8EE266C.hfc.comcastbusiness.net) (Quit: rlbaker)
[23:15:17] <cmr> on average 2 hrs a week. which would otherwise be spent playing video games :p
[23:15:24] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[23:15:25] *** Quits: jez0990 (quassel@moz-3BA8545E.kimsufi.com) (Ping timeout)
[23:15:32] *** Joins: brianm (brianm@moz-D74EBD8D.hsd1.co.comcast.net)
[23:16:00] <strcat> steven_is_false: it can all be rewritten as Rust, excluding any third party libs
[23:16:50] *** Joins: brianm_ (brianm@moz-D74EBD8D.hsd1.co.comcast.net)
[23:17:20] *** Quits: brianm (brianm@moz-D74EBD8D.hsd1.co.comcast.net) (Ping timeout)
[23:17:53] <cmr> steven_is_false: none of it is planned to be C++ and especially now that we have globals, it doesn't need to be
[23:18:16] *** Quits: nyx (nyx114@moz-86F96554.com) (Ping timeout)
[23:19:16] *** Quits: Guest__ (textual@BBE7C46A.B4F11D08.8612FA94.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[23:19:17] <doomlord> anyone know what visit_expr_post does vs visit_expr
[23:19:27] <brson> bblum: idk. they are currently parameterized over Selectable
[23:19:31] <pcwalton> visit_expr_post is called after the expression is visited
[23:19:45] <pcwalton> do default methods on @Traits work in stage0?
[23:19:54] <strcat> pcwalton: well I just snapshotted last night
[23:19:59] <strcat> so if it works in stage1, yeah ;p
[23:20:05] *** kimundi is now known as zz_kimundi
[23:20:10] <cmr> strcat: did the snapshot changes land?
[23:20:15] *** Quits: achim (achim@moz-D200DC82.pools.arcor-ip.net) (Quit: Computer has gone to sleep.)
[23:20:17] <pcwalton> ok, cool
[23:20:19] <strcat> cmr: yes
[23:20:22] <cmr> wonderful
[23:20:23] <pcwalton> I sure hope so or else I'll be copy and pasting about 200 lines 50 times
[23:20:51] <graydon> I have just enabled a config change to buildbot that means it will try to start harvesting metrics logs
[23:20:58] <graydon> and posting them to s3
[23:21:07] <graydon> if you see any weird behavior in the next while, please yell at me
[23:22:12] <strcat> I think what we need is a RandomAccess trait inheriting from Container, and then you could chain random access things
[23:22:27] <strcat> probably need MutableRandomAccess too..
[23:24:11] *** Quits: true_droid (Adium@moz-123FD9B8.beck.volia.net) (Quit: Leaving.)
[23:24:41] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[23:25:29] <olsonjeffery> cmr: we have globals? in master?
[23:25:33] <cmr> olsonjeffery: yes.
[23:25:35] <cmr> static mut
[23:26:29] <olsonjeffery> truly we live in a time of miracles
[23:26:37] *** Quits: kaeso (kaeso@moz-F21FF626.unstable.it) (Ping timeout)
[23:26:47] *** Joins: jez0990 (quassel@moz-3BA8545E.kimsufi.com)
[23:26:56] <olsonjeffery> is there a ticket that covers their semantics?
[23:27:07] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[23:27:07] <olsonjeffery> i don't recall any [recent] discussion of this
[23:27:11] *** Joins: kaeso (kaeso@moz-F21FF626.unstable.it)
[23:27:16] <cmr> I dunno, probably on the pull request that landed it, and in the tests
[23:27:18] <jdm> cmr: are those global to all tasks?
[23:27:19] <cmr> acrichto_ added it
[23:27:27] <strcat> jdm: yes they require unsafe to read/write
[23:27:29] <cmr> jdm: yes
[23:27:29] <pcwalton> jdm: yes
[23:27:43] <jdm> feh
[23:27:47] *** Joins: nyx (nyx114@moz-86F96554.com)
[23:27:52] <acrichto_> yay thread safety!
[23:27:54] <nyx> is there an example of ipc with rust?
[23:27:59] <jdm> I suppose I'll need to get my codegenerator to understand TLS
[23:28:02] <nyx> does anyone know of an example?
[23:28:52] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Connection reset by peer)
[23:29:10] *** Quits: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com) (Quit: webber46)
[23:29:20] <nyx> im really stuck
[23:29:37] <doomlord> eevil. "pub struct t" 
[23:30:22] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[23:30:40] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[23:30:53] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[23:32:24] <brson> nyx: here's an old example of using extra::flatpipes to do message-based ipc over stdio
[23:32:27] <brson> https://github.com/brson/rust/blob/9f7745f84cbe670bf0d4d818e52f0b6dae8ea6fd/src/test/run-pass/proctask.rs
[23:32:59] <brson> not sure how relevant it is these days, but maybe you could get some ideas
[23:33:20] <nyx> huh
[23:33:22] <nyx> ty
[23:33:25] <cmr> Do we support UNIX domain sockets yet?
[23:33:32] <brson> cmr: no
[23:33:35] *** Quits: wilmoore_ (wilmoore@moz-7EE4D9D6.mystrotv.com) (Client exited)
[23:33:59] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[23:34:14] <doomlord> heh. "to reduce reference cunting cost, we're representing type as unsafe pointers throughout the compiler..."
[23:34:39] <toddaaro> brson: there is a test in task.rs "future_result", and I can't figure out what it does. It relies on a "builder" created via task()? These are not methods or names that mean anything in the context of the new runtime as far as I know.
[23:34:47] <jdm> do I get any warning if a type is being implicitly copied versus moved?
[23:34:55] <jdm> I really don't want a copy to occur
[23:35:08] <cmr> I thought there was a lint for it
[23:35:10] <toddaaro> brson: what do you know about the test?
[23:35:16] <strcat> cmr: Copy is gone
[23:35:40] <strcat> jdm: by-value will do a shallow copy implicitly, it's just that for types with destructors (or containing &mut) that counts as a move of ownership
[23:35:47] <strcat> it will never implicitly allocate or anything like that though
[23:35:48] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Ping timeout)
[23:35:50] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: zzzzzzzzzz)
[23:35:54] <jdm> hmm, ok
[23:35:55] *** Quits: Lilly (PinkLace@moz-145A6857.bredband.comhem.se) (Quit: Byeee~~~~)
[23:36:13] <brson> toddaaro: TaskBuilder is the public interface for configuring task spawning, in std::task. future_result tells the task to send a success/fail message on a pipe when the task terminates
[23:36:51] <toddaaro> brson: did that all get ported to the new runtime and I didn't notice?
[23:37:18] *** Joins: pnathan_ (pnathan@moz-ABA29727.pools.spcsdns.net)
[23:37:19] *** Quits: pnathan_ (pnathan@moz-ABA29727.pools.spcsdns.net) (Quit: pnathan_)
[23:37:20] <toddaaro> brson: it seems odd for the newrt tests to use it as we don't actually have it
[23:37:32] <brson> toddaaro: most of it is ported, yes
[23:37:54] <strcat> jdm: for an actual copy of non-implicitly-copyable type, you need to use Clone (which will do a copy up to the boundaries of what it owns - it won't traverse @/Rc, DeepClone will)
[23:38:17] <strcat> it's really nice to have Copy gone ;p
[23:38:17] <brson> toddaaro: the only major thing that isn't ported and that we need still is SingleThreaded scheduling mode, which under newsched means, create a scheduler that refuses to run non-pinned tasks and then pin a task to it
[23:38:47] <brson> the TaskBuilder interface is going to need an overhaul. Some of the things it supports map wierdly to the new scheduler
[23:38:54] <strcat> pcwalton: I guess we could rename Clone -> Copy now
[23:39:04] <pcwalton> yeah
[23:39:25] <toddaaro> brson: ah, ok then
[23:39:35] <toddaaro> brson: I'll have to read up on that code then
[23:39:38] * pcwalton is confused as to how the visitor pairs work in lint
[23:40:14] *** Joins: dbaupp (Thunderbir@moz-712A1135.lns20.syd6.internode.on.net)
[23:40:36] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[23:40:36] *** ChanServ sets mode: +o tjc
[23:41:42] <acrichto_> pcwalton: look at the add_lint function for where they're created, but basically one is used to visit an item and then the other is used to recurse (the second stops at any further item seen)
[23:43:57] <pcwalton> this is annoying because there are now two types of visitors
[23:44:07] <pcwalton> while I make the change to make visitor use trait
[23:44:11] <pcwalton> use @Trait
[23:45:06] <pcwalton> actually the whole scheme is incompatible with @Trait visitors
[23:45:20] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[23:45:26] <pcwalton> since there is no difference between the concept of "the visitor used for recursion" and "the visitor used for visiting"
[23:45:42] *** Quits: lkuper (lkuper@5188CCE.A402E718.C082B7DC.IP) (Quit: lkuper)
[23:46:15] <acrichto_> pcwalton: yeah the visitors created for linting are a bit entangled and probably took too much advantage of the linting struct interface
[23:46:32] <pcwalton> can we just ... not make the linting visitors descend into subitems?
[23:46:38] <pcwalton> I think that's what this scheme is trying to do?
[23:47:11] <acrichto_> pcwalton: kinda, but they have to visit the root item
[23:47:18] <acrichto_> so they have to skip all items except the first
[23:50:00] <pcwalton> oh, I see
[23:50:04] <pcwalton> bah, this is a mess
[23:50:36] <pcwalton> I'll just use a flag
[23:51:07] <nyx> brson: rather than figuring out IPC, i decided to just use a webserver. https://github.com/schaars/simple-web-server
[23:51:11] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[23:51:56] *** Joins: nmatsakis-mobile (androirc@moz-D343FE64.bstnma.fios.verizon.net)
[23:51:57] *** Joins: MaikKlein1 (maik@moz-CE64528C.dip0.t-ipconnect.de)
[23:51:58] *** Quits: nmatsakis-mobile (androirc@moz-D343FE64.bstnma.fios.verizon.net) (Client exited)
[23:51:59] *** Joins: nmatsakis-mobile (androirc@moz-D343FE64.bstnma.fios.verizon.net)
[23:52:06] *** Quits: nmatsakis-mobile (androirc@moz-D343FE64.bstnma.fios.verizon.net) (Quit: nmatsakis-mobile)
[23:52:48] *** Quits: bytewise (bytewise@moz-649C630D.unitymediagroup.de) (Quit: Leaving)
[23:54:07] <mark_edward> doomlord: pong
[23:54:11] <doomlord> would ctxt_.node_types + ctxt_.def_map   have sufficient information for "jump to definition" (here i am trying to extract ast nodes under the cursor with visitors)
[23:54:14] <doomlord> hi
[23:54:32] <engla> bblum: thanks for the review, I don't know how to use r=bblum or even if I can (I'm not a reviewer).
[23:54:52] <cmr> doomlord: You need to get the node_id associated with the thing under the cursor, from there you can look up the definition in the def_map
[23:55:02] <engla> regardless, I renamed the methods
[23:55:17] <mark_edward> doomlord: hey! do you have any projects going on that you think a novice programmer like myself could collaborate with you on? either in rust or C++ or whatever
[23:55:24] *** Quits: vladimir-lu (vladimir-l@moz-428433D9.cable.virginmedia.com) (Ping timeout)
[23:55:27] <doomlord> cmr- ive pushed my current attempt onto github, just throwing debug out at the minute
[23:56:02] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[23:56:10] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[23:56:19] <doomlord> mark_edward, i've thrown several small half finished things on github recently ,if you want to finish them feel free :)
[23:56:31] <mark_edward> can you link your github profile?
[23:56:35] <cmr> mark_edward: can always use help with rustdoc_ng :)
[23:56:37] <bblum> engla: oh ok, well, link me to the new thing?
[23:56:49] <doomlord> i'm trying various approaches for (a) c++ -> rust bindings and (b) Rust navigation support for editors 
[23:56:56] <mark_edward> cmr: can you link yours as well?
[23:56:59] <engla> bblum: https://github.com/mozilla/rust/pull/7944  
[23:57:08] <cmr> mark_edward: https://github.com/cmr/
[23:57:12] <doomlord> https://github.com/dobkeratops
[23:57:13] <cmr> Specifically https://github.com/cmr/rustdoc_ng
[23:57:21] <mark_edward> doomlord: (a) sounds... near impossible, and (b) sounds really cool@
[23:57:31] <bblum> engla: oh i see about the nodes; when i built dlist, it was exposed
[23:57:50] <doomlord> (a) - i dont need 100% support by any means - i can adjust my own c++ source to match my supported subset
[23:57:53] <bblum> engla: i wonder if it would be possible to expose nodes again
[23:58:04] <bblum> because the whole reason i built dlist was so that you oculd remove from the middle
[23:58:07] <engla> I think it would be
[23:58:18] <Crnobog> cmr: What are the goals of rustdoc_ng?
[23:58:37] <doomlord> i think i can create Rust views of C++ collection classes , and wrappers for methods - i have a libclang based tool that's spitting out the rust header - and i had an attempt at adding type parameter info+method-wrappers to rust-bindgen.
[23:58:37] <cmr> Crnobog: https://github.com/mozilla/rust/wiki/Bikeshed-rustdoc
[23:58:48] <engla> bblum: it's much trickier to modify an owned dlist
[23:58:54] <doomlord> both are a bit incomplete but i've seen enough to be encouraged that its *possible*
[23:59:05] <cmr> Crnobog: basically more extensible and generic and better code and an easy to navigate interface
[23:59:15] <Crnobog> I was looking at the docs online and I was thinking it would be useful to have something that generates the methods available on a type in the std lib regardless of where that type is declared
[23:59:46] <Crnobog> e.g. std::ascii declares and impls traits for str and char but you have to be looking for it to discover that
[23:59:54] <mark_edward> doomlord: (b) sounds a bit more promising. what about things you can't really match one-to-one? like integer template params?
[23:59:58] <dbaupp> pcwalton: ping
