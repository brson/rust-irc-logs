[00:05:59] <strcat> olsonjeffery: the user-mode scheduling is still 1:1, but you can have a subset of threads managed by a scheduler you control
[00:06:27] <strcat> if they block or hit a page fault, it passes control to a supervisor thread
[00:06:57] <strcat> so it's basically our M:N threading but without actually blocking on system calls or page faults and with proper TLS, thread ID, priority, affinity and so on
[00:07:24] <strcat> but even 1:1 threads without this has all of that, just with context switch overhead and lack of much control
[00:08:26] <strcat> it will scale as well resource-wise, but you won't get throughput that's as high as a pool or fine control over what kind of priorities you want without the user-mode part
[00:09:06] <strcat> certainly simpler though, I think you'd just have something like Scheduler able to take ownership over a Thread
[00:09:29] <strcat> and it could have whatever policies you wanted (round-robin without preempt? sure, maybe you do want preempt? that works too)
[00:10:38] <strcat> whether or not it becomes more portable than linux/windows, it will exist and people will want it ;p
[00:26:16] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[00:26:16] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14aa7471d to 1449c6ae1: 02http://git.io/N3iJvQ
[00:26:16] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[00:26:23] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[00:26:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/1ewBUg
[00:26:23] <ghrust> 13rust/06auto 14d328ab7 15Benjamin Peterson: be more robust when removing download artifacts and remove bogus raise statement
[00:26:23] <ghrust> 13rust/06auto 148a3b35f 15bors: auto merge of #10464 : gutworth/rust/snap-err, r=pnkfelix...
[00:26:24] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[00:27:33] *** Joins: brson (brson@5AB4884B.FCC4549.14D5B978.IP)
[00:27:33] *** ChanServ sets mode: +qo brson brson
[00:28:29] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[00:28:29] *** ChanServ sets mode: +ao pcwalton pcwalton
[00:31:11] *** Joins: jdm (jdm@5AB4884B.FCC4549.14D5B978.IP)
[00:39:43] *** Quits: brson (brson@5AB4884B.FCC4549.14D5B978.IP) (Client exited)
[00:40:57] *** Joins: brson (brson@5AB4884B.FCC4549.14D5B978.IP)
[00:40:57] *** ChanServ sets mode: +qo brson brson
[00:42:34] *** Joins: yuriks (yuriks@7AA6475F.89F39BB3.5419EADB.IP)
[01:06:04] *** Quits: jdm (jdm@5AB4884B.FCC4549.14D5B978.IP) (Quit: Lost terminal)
[01:09:36] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[01:09:58] *** Quits: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP) (Ping timeout)
[01:15:53] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Quit: pcwalton)
[01:30:27] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[01:41:26] *** Quits: tikue (tkuehn@561622AD.21C37D63.689607DE.IP) (Quit: tikue)
[01:41:27] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[01:41:27] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/1ewBUg
[01:41:27] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[01:44:54] *** Joins: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP)
[01:46:18] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[01:46:18] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/B7FZFg
[01:46:18] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[01:46:26] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[01:46:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/FaiOtg
[01:46:26] <ghrust> 13rust/06auto 142e3fc31 15Alex Crichton: Implement native::IoFactory...
[01:46:26] <ghrust> 13rust/06auto 14e4b5004 15bors: auto merge of #10457 : alexcrichton/rust/native-io, r=brson...
[01:46:27] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[01:57:29] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[01:57:29] *** ChanServ sets mode: +ao pcwalton pcwalton
[02:00:50] *** Quits: notmatt (notmatt@moz-6071FD3.lightspeed.sntcca.sbcglobal.net) (Client exited)
[02:09:59] *** Joins: ktt3ja (Mibbit@moz-6B6EE8C0.hsd1.va.comcast.net)
[02:23:06] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Quit: pcwalton)
[02:27:12] <cmr> andrew-d_w: am now
[02:28:58] <klutzy> acrichto: is there other process_status test than signal-exit-status?
[02:29:54] <acrichto> klutzy: there's one in rtio-processes, but it is only defined for unix
[02:30:04] <acrichto> klutzy: signals may just not be a thing on windows
[02:30:11] <acrichto> but it seems like libuv should handle that
[02:31:15] <klutzy> in libuv/src/win/process.c, uv_process_proc_exit() knows handle has exit_signal
[02:31:18] <klutzy> hmm
[02:31:57] <klutzy> anyway I got some debug-info test failures, don't know why it passed silently when I was sleeping
[02:32:08] <acrichto> klutzy: I wonder what that's defined to be on windows
[02:32:11] <acrichto> the exit_signal field
[02:32:16] <acrichto> oh nvmd that's a libuv thing
[02:32:39] <acrichto> klutzy: lol libuv
[02:32:47] <acrichto> it only sets exit_signal if you call uv_process_kill
[02:32:52] <acrichto> that's kinda hilarious
[02:33:05] <acrichto> klutzy: I'm gonna r+ that patch, windows just doesn't haevv signals
[02:33:07] <pcmattman> ewww
[02:33:41] <klutzy> acrichto: but I just got debug-fail test :o I think it needs some investigation
[02:33:45] <acrichto> man I really need to start running tets before I submit a patch
[02:33:54] <acrichto> klutzy: ok cool, just ping me when it's updated
[02:34:00] <klutzy> yep ;)
[02:34:09] <acrichto> klutzy: would you mind adding a comment to the documentation of ExitSignal?
[02:34:37] <acrichto> just warning that windows doesn't have signals so the exit status on windows will be different than on unix if things died because of a signal
[02:34:40] <acrichto> or like a segfault
[02:36:28] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[02:36:28] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14e4b5004 to 148a3b35f: 02http://git.io/N3iJvQ
[02:36:28] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[02:36:30] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[02:36:30] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/YKW7uw
[02:36:30] <ghrust> 13rust/06auto 14e91cb47 15Joe Schafer: Add Window build directory to .gitignore
[02:36:30] <ghrust> 13rust/06auto 14c86f2dc 15bors: auto merge of #10473 : jschaf/rust/ignore-windows-build-dir, r=alexcrichton...
[02:36:30] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[02:39:38] <acrichto> klutzy: btw you are a saint for all this awesome windows work
[02:39:57] <acrichto> I hope we can enable a full make check on the win bots soon
[02:48:58] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[02:49:39] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[02:55:16] <klutzy> I may be just a masochist :p
[03:01:10] <acrichto> klutzy: whaot debug-info works at all on windows?!
[03:01:12] <acrichto> that's amazing!
[03:01:35] <acrichto> that's even better than osx!
[03:01:53] <cmr> deubginfo doesn't work on os x?
[03:02:07] <acrichto> I don't think so, at least I've had a horrible track record with it
[03:02:31] <dbaupp> don't we run the debug-info tests on mac on bors?
[03:02:32] <cmr> with gdb or lldb?
[03:03:48] <acrichto> debug-info is disabled on bors for osx
[03:03:56] <acrichto> needs extra privileges or somethign like that for gdb I think
[03:04:03] <acrichto> cmr: lldb, but I'm also no lldb wizard
[03:04:45] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[03:04:45] *** ChanServ sets mode: +ao pcwalton pcwalton
[03:05:09] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Quit: pcwalton)
[03:13:00] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[03:13:00] *** ChanServ sets mode: +ao pcwalton pcwalton
[03:14:51] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Quit: pcwalton)
[03:16:19] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[03:16:19] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14c86f2dc to 148a3b35f: 02http://git.io/N3iJvQ
[03:16:19] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[03:16:27] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[03:16:28] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/uRWelw
[03:16:28] <ghrust> 13rust/06auto 149bcf557 15Alex Crichton: Implement native::IoFactory...
[03:16:28] <ghrust> 13rust/06auto 14bf49228 15bors: auto merge of #10457 : alexcrichton/rust/native-io, r=brson...
[03:16:28] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[03:21:01] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[03:22:42] *** Quits: brson (brson@5AB4884B.FCC4549.14D5B978.IP) (Ping timeout)
[03:28:50] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[03:39:30] *** Quits: zz_kimundi (kimundi@moz-A21FC351.dip0.t-ipconnect.de) (Ping timeout)
[03:44:01] *** Joins: zz_kimundi (kimundi@moz-3CF1A7E.dip0.t-ipconnect.de)
[03:44:02] *** zz_kimundi is now known as kimundi
[03:46:22] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[03:46:22] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14bf49228 to 148a3b35f: 02http://git.io/N3iJvQ
[03:46:22] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[03:46:26] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[03:46:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/ELWBWA
[03:46:26] <ghrust> 13rust/06auto 149bcf557 15Alex Crichton: Implement native::IoFactory...
[03:46:26] <ghrust> 13rust/06auto 1458b5c61 15bors: auto merge of #10457 : alexcrichton/rust/native-io, r=brson...
[03:46:27] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[03:46:47] <dbaupp> does anyone know the answer to https://github.com/mozilla/rust/pull/10475/files#diff-f1fb8bf8b79dbede838e4e13228c765dR523 ?
[03:49:48] <acrichto> we have a pretty version of node ids
[03:49:56] <acrichto> well pretty-ish, not like a user-facing one
[03:51:19] <cmr> acrichto: is it #[cfg(windows)]? I would have figured I'd be getting stuff like "could not link to kernel32.dll" and unresolved symbols for VirtualAlloc and stuff if it weren't #[cfg(win32)]
[03:51:43] <acrichto> did you compile on windows?
[03:51:56] <cmr> hm, that'd be it :p
[03:51:58] <acrichto> cfg(win32) would just be always stripped
[03:52:04] <cmr> right..
[03:58:18] *** Joins: geoffhill (geoffhill@moz-738DC0DB.org)
[03:58:21] <dbaupp> acrichto: you mean ast_map::node_id_to_str?
[03:58:45] <acrichto> dbaupp: yeah, I don't think that'll work for foreign crates though
[03:58:58] <dbaupp> acrichto: oh :(
[04:01:29] <strcat> cmr: you're using NO_RESERVE with VirtualAlloc right?
[04:01:35] <strcat> or whatever it's called
[04:02:25] <strcat> ah MEM_RESERVE, right
[04:02:54] <strcat> heh
[04:02:57] <strcat> I guess not ;\
[04:03:29] <cmr> It *should* be using MEM_RESERVE, shuoldn't it
[04:03:31] <cmr> ?
[04:03:41] <strcat> cmr: ah right, MEM_COMMIT|MEM_RESERVE I guess
[04:03:47] <cmr> that's what we are using
[04:03:57] <strcat> that's overcommit fwiw
[04:04:26] <strcat> but I think it marks disk space as reserved
[04:04:31] <strcat> doesn't touch it though.
[04:06:32] <cmr> MEM_COMMIT says it does, MEM_RESERVE says it doesn't... no idea what the combination of them does :\
[04:07:59] <dbaupp> magic
[04:10:12] <dbaupp> is MEM_COMMIT vs MEM_RESERVE 0/1 in the same bit?
[04:10:26] <strcat> no
[04:10:35] <cmr> I hopenot, msdn recommends usnig both
[04:10:43] <strcat> if you just MEM_RESERVE, you then have to commit it later
[04:10:49] <strcat> if you use both, it's overcommit
[04:14:38] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[04:16:30] *** Joins: eddyb (eddy@336E3A7F.D51DAF03.FB866788.IP)
[04:18:22] *** Quits: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP) (Ping timeout)
[04:34:54] *** Joins: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP)
[04:38:06] *** Joins: brson (brson@5AB4884B.FCC4549.14D5B978.IP)
[04:38:07] *** ChanServ sets mode: +qo brson brson
[04:38:17] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[04:39:50] *** Joins: jdm (jdm@5AB4884B.FCC4549.14D5B978.IP)
[04:40:49] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[04:41:51] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[04:41:59] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[04:41:59] *** ChanServ sets mode: +ao pcwalton pcwalton
[04:42:00] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[04:44:44] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[04:45:59] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[04:46:18] *** Quits: geoffhill (geoffhill@moz-738DC0DB.org) (Quit: )
[04:51:19] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[04:51:19] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/ELWBWA
[04:51:19] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[04:51:40] <dbaupp> acrichto: \o/
[04:51:46] <acrichto> hurray!
[04:52:03] <acrichto> have have native I/O passing the full io::fs test suite on osx/linux right now as well
[04:52:07] <acrichto> just polishing off the windows impl
[04:52:13] <dbaupp> nice
[04:52:19] <acrichto> next up is native locks
[04:52:22] <acrichto> I really want to get that done
[04:52:30] <acrichto> it's been on the back of my mind for like forever
[04:56:20] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[04:56:20] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/83Hukw
[04:56:20] <ghrust> 13rust/06auto 14e91cb47 15Joe Schafer: Add Window build directory to .gitignore
[04:56:20] <ghrust> 13rust/06auto 14b70755d 15bors: auto merge of #10473 : jschaf/rust/ignore-windows-build-dir, r=alexcrichton...
[04:56:21] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[04:56:50] <cmr> You know
[04:57:08] <cmr> Thatis the exact sort of thing someone could have foldedinto their PR that could *actually* affect tests
[04:59:56] <dbaupp> cmr: that's the only thing in the queue
[05:00:21] <cmr> ah
[05:12:19] *** Quits: yuriks (yuriks@7AA6475F.89F39BB3.5419EADB.IP) (Ping timeout)
[05:15:12] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[05:16:59] *** Joins: yuriks (yuriks@ECB1DF0D.88B480FC.748B6D8D.IP)
[05:18:07] <jdm> do ~SomeType and @SomeType still share the same representation?
[05:18:31] <jdm> at one point in time you could cast both to *Box<SomeType> and it was valid
[05:18:46] <cmr> jdm: no
[05:18:51] <jdm> uh oh
[05:19:03] <cmr> ~SomeType is just a ptr to SomeType, if SomeType doesn't contain managed ptrs.
[05:19:36] <jdm> cmr: does Option<@mut Something> count as a managed pointerA?
[05:19:42] <cmr> jdm: yes
[05:19:49] <jdm> well, I sure dodged that bullet
[05:19:59] <jdm> that seems like a scary thing to rely upon
[05:20:46] <jdm> would size_of::<@SomeType> == size_of::<~SomeType> assert that that was still the case?
[05:23:19] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[05:24:13] <dbaupp> no
[05:24:46] <dbaupp> @ and ~ are still single word pointers
[05:25:00] <dbaupp> the Box is at the other end of the allocation.
[05:25:01] <jdm> yeah, you're right
[05:26:13] <jdm> checking that SomeType is not sendable is only an approximation, unfortunately
[05:26:58] <dbaupp> what do you need to be checking?
[05:27:16] <dbaupp> (or, what is the fundamental task you need to accomplish?)
[05:27:44] <jdm> dbaupp: there's a type in servo that's going to be used with both ~ and @
[05:27:58] <jdm> and there's another type that transmutes those to unsafe pointers
[05:28:13] <jdm> and I need to guarantee that I can unwrap that value to a *Box<T>
[05:28:13] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[05:28:22] <jdm> and grab the original value from inside of it
[05:28:31] <dbaupp> would unwrapping to a *T be ok?
[05:28:36] <jdm> no
[05:28:38] <dbaupp> or does it need to be Box<T>?
[05:28:39] <dbaupp> oh
[05:28:42] <jdm> all of the existing code requires Box<T>
[05:28:46] <dbaupp> eurgh
[05:28:48] <jdm> since all of the prior code only worked with @
[05:28:53] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[05:28:56] <jdm> the ~ is a new requirement
[05:29:18] * dbaupp has a feeling this isn't easily possible
[05:29:56] <cmr> Adding a dummy field of Option<@mut ()> is the "obvious" workaruond
[05:30:02] <jdm> theoretically there could be a trait that provides a function that unwraps
[05:30:05] <cmr> err, @(), not @mut
[05:30:16] <jdm> but I think that would have very broad effects through the code
[05:30:33] <sfackler> acrichto: would the native locks be statically initializable?
[05:30:52] <acrichto> sfackler: they must be
[05:31:04] <acrichto> sfackler: or rather, that's the only way we'll drop the C++ dep
[05:31:14] <sfackler> sweet
[05:31:19] <acrichto> sfackler: the only method I know of doing that is a CAS on a malloc'd pthread and then it leaks
[05:31:50] *** Quits: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP) (Ping timeout)
[05:32:08] <sfackler> I had to hack a statically initialized latch together with two atomic bools and task::deschedule :(
[05:32:44] <jdm> cmr: the prospect of adding another pointer-sized value to the fundamental type in the DOM in Servo is not appealing :)
[05:33:00] <acrichto> sfackler: yeah the problem is that there's no such thing as a statically initialized mutex on windows
[05:33:27] <sfackler> even through pthreads?
[05:33:41] <acrichto> sfackler: http://stackoverflow.com/questions/3555859/is-it-possible-to-do-static-initialization-of-mutexes-in-windows
[05:33:55] <acrichto> I think that under the hood pthreads does CAS business 
[05:34:22] <sfackler> ah
[05:34:40] <dbaupp> jdm: the "easiest" way may be to adjust the compiler to support a #[managed_header] struct Foo { ... ] attribute, which puts a Box on ~Foo... :S
[05:35:19] <jdm> I'll ask brson how he feels about that
[05:35:25] <acrichto> sfackler: I think that CAS works just fine, the leaking may not be that great
[05:36:07] <cmr> jdm: yeah, that wouldn't be that great.
[05:37:05] <klutzy> acrichto: now my `make check` passes all :D
[05:37:16] <sfackler> other than making valgrind sad, I'm not hugely opposed to leaking the locks
[05:37:25] <sfackler> they're supposed to be around for the entire lifetime of the program anyway
[05:37:32] <dbaupp> jdm: is it at all feasible/desirable to go @ -> ~ in Servo? (not necessarily right now, of course)
[05:37:33] <klutzy> acrichto: I've added one-line comment, but I'm not sure if this is sufficient https://github.com/klutzy/rust/commit/8b97745d42c51962de0e1dfacbac0d74d5fa9b7d#diff-62fa42b183d103547698d6e90e658e3dR23
[05:37:35] <acrichto> sfackler: yeah I personally think it's ok
[05:38:07] <jdm> dbaupp: no; only to Rc if anything. we're eventually going to be doing placement new into portions of the JS heap
[05:38:23] <acrichto> klutzy: oh could you comment on the enum definition of ExitSignal itself?
[05:38:27] <acrichto> or ProcessExit
[05:38:32] <dbaupp> jdm: ah, I see.
[05:38:34] <acrichto> sfackler: were you gonna try to work on static mutexes?
[05:39:10] <jdm> well, the other options is to have all DOM objects use something like JSManaged<DOMType> which could conceivably hold ~
[05:39:21] <dbaupp> cmr: can we mmap say, 200MB, and mprotect 100 separate pages to get around the mmap limits?
[05:39:24] <jdm> right now the impedence mismatch occurs because we store references inside the DOM to @mut DOMType
[05:39:40] <sfackler> acrichto: it wasn't on the top of my list
[05:39:40] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[05:39:43] <cmr> dbaupp: no
[05:39:53] <cmr> dbaupp: the limit applies to mprotect's too
[05:40:01] <dbaupp> cmr: :(
[05:40:12] <cmr> at least afaict
[05:40:14] <acrichto> sfackler: oh no worries, just curious
[05:40:15] * cmr consults the source
[05:40:17] <dbaupp> jdm: I guess Rc also has no Box header, fwiw.
[05:40:20] <acrichto> I may attempt to do so soon
[05:40:22] <jdm> yep
[05:40:47] <jdm> I think I only just realized why Patrick always talks about using JSManaged and gets confused by the use of @ everywhere
[05:41:04] <jdm> I'm not sure if it's worth transitioning before the fused bindings, though
[05:41:17] <sfackler> achrichto: I may try to resurrect the Mut proposal though. do you know if that ever got discussed at a weekly meeting?
[05:42:12] <acrichto> sfackler: we were all in favor of it
[05:42:56] <sfackler> cool. I figure I'll leave Cell around until the ~fn -> proc changeover happens
[05:43:52] <klutzy> acrichto: added https://github.com/klutzy/rust/commit/09cb7ecc6729e12a6561d62744697e134d362238
[05:43:59] <jdm> acrichto: #10457 is very cool
[05:44:58] <cmr> dbaupp: hmm maybe not
[05:45:13] <cmr> experimenting now..
[05:48:41] <strcat> acrichto: I'm not sure it will really replace RcMut/GcMut
[05:48:56] <strcat> Gc<Mut<TraitObject>> /* does this work? */
[05:49:52] <acrichto> I haven't really been following DST, so I dunno
[05:50:02] <ktt3ja> is there a reason why when an ast::Path is a normal struct, def_map would map its NodeId to some item_struct(@struct_def, Generics) (or maybe `struct_def`), whereas if it's a tuple- or enum-like struct, def_map would map its NodeId to `struct_def.ctor_id`?
[05:50:47] <cmr> ktt3ja: because tuple/enum-like struct constructors are functions (the ctor_id is that function)
[05:53:58] <ktt3ja> I see
[05:56:16] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[05:56:18] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14b70755d to 1458b5c61: 02http://git.io/N3iJvQ
[05:56:18] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[05:56:23] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[05:56:23] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/mcPc1g
[05:56:23] <ghrust> 13rust/06auto 14fcf9844 15klutzy: test: Clean up xfail-{fast,win32} tests...
[05:56:23] <ghrust> 13rust/06auto 1409cb7ec 15klutzy: test: Fix signal-exit-status on windows
[05:56:23] <ghrust> 13rust/06auto 14bbcd346 15klutzy: rustpkg: Disable test suite on windows...
[05:56:25] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[05:57:50] <cmr> acrichto: With Buffered, I don't call consume after fill, will subsequent reads *will* yield those bytes?
[05:58:46] <acrichto> cmr: yes
[06:02:00] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[06:02:19] <sfackler> hmm, what's the right way to take over this PR? it's about 2 months old, so a lot of the changes will really just have to be redone from scratch. should I try to keep as many as possible for the sake of attribution, or just redo it all myself?
[06:03:06] <acrichto> sfackler: have you been able to reach out to engla?
[06:03:38] <sfackler> nope, and his github's been idle since the beginning of october or so
[06:04:03] <acrichto> hm, I think that's ok then
[06:04:11] <acrichto> to take what's there and run with it
[06:04:20] <acrichto> just be sure to attribute him in the pull request message
[06:04:25] <sfackler> cool. i'll put a reference to the original pr in the commit message
[06:06:08] <dbaupp> I've seen engla pop in and out of IRC occasionally recently.
[06:06:12] <dbaupp> (fwiw)
[06:06:40] <sfackler> yeah, i tried pinging him a couple of days ago and he didn't reply
[06:12:11] * dbaupp was looking at https://blake2.net/ and noticed a link to https://github.com/cmr/libblake2 ... it's a small world.
[06:12:29] <cmr> dbaupp: it is!
[06:18:43] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[06:29:13] *** Joins: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP)
[06:54:46] <ktt3ja> is checking dead code for type desirable?
[06:55:21] <dbaupp> ktt3ja: you mean type ala `type Foo = int;`?
[06:55:36] <ktt3ja> I feel like it's not that useful especially since there would be lot of type symbols to hold inside live_symbols set
[06:55:39] <ktt3ja> yea, that's what I mean
[06:55:53] <dbaupp> there wouldn't be a lot of `type` symbols, would there?
[06:56:06] *** Quits: lbergstrom (Adium@5AB4884B.FCC4549.14D5B978.IP) (Quit: Leaving.)
[06:56:08] <cmr> ktt3ja: I think it'd be useful
[06:56:18] <dbaupp> (but, yes, it's less useful than dead code for fns and structs etc, but it would still be neat)
[06:57:24] <ktt3ja> if it's `type Foo = int;`, then Foo would be of type ast::Ty, right?
[06:57:24] *** Joins: lbergstrom (lbergstrom@moz-DB4A9C19.scl3.mozilla.com)
[06:57:29] <sfackler> how broken are destructors on generic types?
[06:57:58] <dbaupp> this broken: [--------]
[06:59:08] <dbaupp> ktt3ja: I'm not really sure what you mean
[06:59:27] <dbaupp> sfackler: I think that dtors basically ignore the possibility of having differing generics
[06:59:39] <dbaupp> e.g. trait bounds are ignored
[06:59:58] <dbaupp> and monomorphisations are incorrectly shared (this one might be fixed, though.)
[07:00:44] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[07:01:10] <dbaupp> ktt3ja: do you mean the `Foo` as it is stored in the `type Foo = int` declaration in the ast?
[07:01:23] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[07:01:23] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/mcPc1g
[07:01:23] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[07:01:43] <ktt3ja> dbaupp: I mean the whole `type Foo = int` would be ast::item_ty
[07:01:52] <ktt3ja> is that correct?
[07:03:12] <dbaupp> ktt3ja: oh, yes, that's correct
[07:04:00] <ktt3ja> item_ty(Ty, Generics)
[07:04:07] <ktt3ja> would Foo be Ty, and int be Generics?
[07:04:21] <dbaupp> no
[07:04:25] <dbaupp> Ty is the RHS
[07:04:47] <dbaupp> the Foo is the ident on the item
[07:05:06] <dbaupp> the generics are T in `type Foo<T> = ~@T;`
[07:05:25] <dbaupp> so that would be ident = Foo, ty = ~ ( @ ( T ) ), generics = T
[07:05:54] <dbaupp> (ident == the ident field on the 'item' struct in syntax::ast.)
[07:06:09] <ktt3ja> right
[07:06:17] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[07:06:17] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/WgurGg
[07:06:17] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[07:06:26] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[07:06:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/lXwLdQ
[07:06:26] <ghrust> 13rust/06auto 14e91cb47 15Joe Schafer: Add Window build directory to .gitignore
[07:06:26] <ghrust> 13rust/06auto 146f40147 15bors: auto merge of #10473 : jschaf/rust/ignore-windows-build-dir, r=alexcrichton...
[07:06:26] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[07:10:26] <ktt3ja> then if I have a local variable foo: Foo, then it would be a Local struct whose Ty field is Foo?
[07:11:16] <dbaupp> you mean like `let foo: Foo = 1;`?
[07:11:26] <ktt3ja> uh huh
[07:12:24] <dbaupp> yes
[07:13:36] <dbaupp> btw, you can often answer ast questions by grepping for how they are constructed in parser.rs, in this case, https://github.com/mozilla/rust/blob/master/src/libsyntax/parse/parser.rs#L3097-L3116
[07:14:01] <dbaupp> (although asking IRC works too :P )
[07:14:51] <ktt3ja> ah
[07:15:12] <ktt3ja> yea, this would be helpful
[07:20:04] <ktt3ja> hmm, look like I can't look up Ty Def in def_map like I do with fn, struct, and enum
[07:22:02] <dbaupp> It'd probably be ok to submit a patch that doesn't handle type, and then finish that off in a second one.
[07:22:23] <dbaupp> (at least, you'll get feedback earlier that way.)
[07:22:38] <ktt3ja> yea, I think I should do Trait first
[07:23:18] <dbaupp> have you got `struct NoFields;` working, btw?
[07:24:02] <ktt3ja> yea
[07:24:07] <dbaupp> \o/ awesome
[07:24:39] <dbaupp> assuming it's just trait and type to go, I'd say clean up the code and submit a PR to start getting some feedback
[07:25:16] <ktt3ja> when I traverse item, I have to manually check if the item has ctor_id
[07:25:31] <ktt3ja> and if it does, then I use that id for lookup in the live_symbols map
[07:25:55] <dbaupp> ah, that's a little weird
[07:25:57] <ktt3ja> that's how I got the tuple- and enum-like structs to work
[07:26:20] <ktt3ja> yea, those structs are inconsistent compared to the rest :/
[07:33:47] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[07:51:57] *** flaper87|afk is now known as flaper87
[08:00:42] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Quit: pcwalton)
[08:04:11] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[08:04:11] *** ChanServ sets mode: +o pnkfelix
[08:11:19] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[08:11:19] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/lXwLdQ
[08:11:19] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[08:16:21] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[08:16:22] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/WdtjYA
[08:16:22] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[08:16:23] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[08:16:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/1X_pKw
[08:16:23] <ghrust> 13rust/06auto 148a041e6 15Tim Chevalier: docs: Change "workspace" to "package directory"...
[08:16:23] <ghrust> 13rust/06auto 14f9cea4b 15bors: auto merge of #10476 : catamorphism/rust/rustpkg-doc-fix, r=catamorphism...
[08:16:23] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[08:17:50] <ktt3ja> I cleaned it up and submitted a PR: https://github.com/mozilla/rust/pull/10477
[08:17:56] <ktt3ja> going to sleep now
[08:18:11] *** Quits: ktt3ja (Mibbit@moz-6B6EE8C0.hsd1.va.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[08:18:33] *** Quits: tikue_ (quassel@moz-FEADCD38.hsd1.pa.comcast.net) (Connection reset by peer)
[08:25:18] *** Joins: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP)
[08:25:18] *** ChanServ sets mode: +ao pcwalton pcwalton
[08:36:35] *** Quits: acrichto (acrichto@moz-69F2E428.ugrad.cs.cmu.edu) (Ping timeout)
[08:40:36] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[08:42:51] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[08:42:51] <ghrust> 01[13rust01] 15catamorphism 04force-pushed 06try from 143af2c9a to 146fa6dc2: 02http://git.io/k471pw
[08:42:51] <ghrust> 13rust/06try 146fa6dc2 15Tim Chevalier: fix 8711 -- reword this commit message
[08:42:51] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[08:43:19] *** Quits: brson (brson@5AB4884B.FCC4549.14D5B978.IP) (Ping timeout)
[08:45:18] *** Quits: jdm (jdm@5AB4884B.FCC4549.14D5B978.IP) (Quit: Lost terminal)
[08:45:59] *** Quits: pcwalton (pcwalton@5AB4884B.FCC4549.14D5B978.IP) (Quit: pcwalton)
[08:46:53] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[08:47:59] *** Joins: acrichto (acrichto@moz-69F2E428.ugrad.cs.cmu.edu)
[08:47:59] *** ChanServ sets mode: +o acrichto
[09:01:46] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[09:20:23] *** Joins: jensnockert (jensnocker@moz-5D53B643.cust.bredband2.com)
[09:21:22] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[09:21:22] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/1X_pKw
[09:21:22] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[09:21:29] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[09:21:59] <Yurume> <lifthrasiir> mia: ((42.5e80f64).to_i32(), (42.5e80f64) as i32)
[09:21:59] <Yurume> <mia> (Some(-2147483648i32), 2147483647i32)
[09:22:04] <Yurume> it's so amusing. ;)
[09:22:12] <Yurume> related issue: https://github.com/mozilla/rust/issues/10481
[09:24:32] *** Quits: Kxepal (Miranda@moz-876F9B77.pppoe.mtu-net.ru) (Ping timeout)
[09:28:11] *** Joins: Kxepal (Miranda@moz-3A55D1EB.pppoe.mtu-net.ru)
[09:32:51] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[09:41:48] <dbaupp> Yurume: 'mia'
[09:41:49] <dbaupp> ?
[09:42:49] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[09:50:56] <klutzy> dbaupp: it's rustibot on rust-kr channel with no sandbox
[09:51:01] <klutzy> using trust-the-user method :p
[09:52:18] *** Quits: jensnockert (jensnocker@moz-5D53B643.cust.bredband2.com) (Input/output error)
[09:52:31] <Yurume> dbaupp, ah, yeah, that's a log from rust-kr channel.
[09:53:01] <dbaupp> klutzy: hahaha, highest security
[09:58:22] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[09:58:48] <dbaupp> Yurume: going back to the bug itself... that's not just "inexact"... it's entirely wrong!
[09:59:42] <Yurume> dbaupp, uhm, I'll change the title.
[10:00:08] <Yurume> inexact and/or wrong :)
[10:00:34] <dbaupp> I'd guess that 100_0000_0000_0000_2345u64 -> 1000000000000002244f64 is just floating point precision?
[10:00:55] <Yurume> yes, but it might not be what the user wants.
[10:01:06] <dbaupp> (although python gets to ...0002304)
[10:01:20] <Yurume> in fact, currently int->float and float->int conversion is implemented using a plain casting.
[10:01:35] <dbaupp> rusti: 100_0000_0000_0000_2345u64 as f64
[10:01:36] -rusti- 1000000000000002244f64
[10:01:42] <Yurume> wait, rusti lives? :)
[10:01:50] <dbaupp> using 0.8
[10:01:54] <Yurume> (I thought rusti was dead!)
[10:02:10] <dbaupp> yeah master-rusti is dead... for now.
[10:02:16] <Yurume> aha
[10:20:41] *** Quits: doomlord_ (servitor@moz-4625DF14.range86-184.btcentralplus.com) (Client exited)
[10:26:11] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[10:30:15] *** kimundi is now known as zz_kimundi
[10:33:27] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[10:42:57] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[10:48:18] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[10:52:20] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[11:17:42] *** zz_kimundi is now known as kimundi
[11:17:53] *** Joins: jyyou_ (jyyou@moz-47B052FA.cs.nctu.edu.tw)
[11:18:28] *** Quits: jyyou (jyyou@moz-1A35BF79.cs.nctu.edu.tw) (Quit: leaving)
[11:18:46] *** jyyou_ is now known as jyyou
[12:03:36] *** Joins: doomlord_ (servitor@moz-4625DF14.range86-184.btcentralplus.com)
[12:04:29] *** Quits: doomlord_ (servitor@moz-4625DF14.range86-184.btcentralplus.com) (Quit: Leaving)
[12:16:12] *** Joins: doomlord_ (servitor@moz-4625DF14.range86-184.btcentralplus.com)
[12:48:04] <dbaupp> cmr: is the builder off?
[12:55:23] *** kimundi is now known as zz_kimundi
[12:58:26] <KokaKiwi> Oh. Why this code works outside of unsafe block? :o (0 as fn())()
[12:59:43] <dbaupp> KokaKiwi: https://github.com/mozilla/rust/issues/8728
[13:03:06] <KokaKiwi> Meh, And I thought I found a hole in Rust :(
[13:04:39] <dbaupp> you did
[13:04:54] <dbaupp> (just not an unknown one)
[13:13:19] *** Joins: pcwalton (pcwalton@9C2E78E6.8C982E60.292610BC.IP)
[13:13:20] *** ChanServ sets mode: +ao pcwalton pcwalton
[13:13:28] *** Quits: pcwalton (pcwalton@9C2E78E6.8C982E60.292610BC.IP) (Quit: pcwalton)
[13:19:09] *** Joins: brson (brson@9C2E78E6.8C982E60.292610BC.IP)
[13:19:09] *** ChanServ sets mode: +qo brson brson
[13:21:22] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[13:21:22] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/UN8Xbw
[13:21:22] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[13:21:26] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[13:21:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/ti5F9A
[13:21:26] <ghrust> 13rust/06auto 14e538c95 15Geoff Hill: Typeck: Disallow scalar casts to bare_fn....
[13:21:26] <ghrust> 13rust/06auto 14af62adf 15bors: auto merge of #9788 : geoffhill/rust/bare-fn-cast, r=pnkfelix...
[13:21:27] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[13:39:05] *** zz_kimundi is now known as kimundi
[13:51:23] *** Joins: jdm (jdm@9C2E78E6.8C982E60.292610BC.IP)
[14:11:39] *** Joins: mw1 (mw@moz-B436A392.adsl.highway.telekom.at)
[14:16:12] *** Parts: mw1 (mw@moz-B436A392.adsl.highway.telekom.at) ()
[14:22:30] *** Quits: brson (brson@9C2E78E6.8C982E60.292610BC.IP) (Quit: leaving)
[14:26:26] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[14:26:26] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/ti5F9A
[14:26:26] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[14:40:35] <cmr> dbaupp: yup, kicking it back on
[14:41:52] <cmr> (rust updated, forgot to rebuild it)
[14:59:25] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[15:31:52] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[15:38:56] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[15:41:46] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[15:54:40] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[16:01:45] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[16:01:45] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/tzujgw
[16:01:45] <ghrust> 13rust/06auto 14bc698ba 15Noufal Ibrahim: Fixes formatting...
[16:01:45] <ghrust> 13rust/06auto 1411ece44 15bors: auto merge of #10484 : nibrahim/rust/docfix, r=cmr...
[16:01:45] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[16:01:46] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[16:01:47] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/6AcLiQ
[16:01:47] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[16:07:08] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[16:24:29] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[16:26:12] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[16:29:47] *** Joins: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP)
[16:30:33] *** kimundi is now known as zz_kimundi
[16:37:37] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[16:39:55] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[16:41:21] *** Quits: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP) (Quit: leaving)
[16:47:30] *** Joins: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP)
[16:51:58] <cmr> acrichto: I'm refactoring some things to make Session sendable. The span_handler trait is a needless abstraction: exactly one type implements it. Should I just remove it? I don't see anything in the compiler implementing it on top of what we have now.
[16:57:40] <cmr> Hm, well, I suppose it'd be useful if you want to substitute in anotherhandler
[16:57:51] <cmr> And I *do* see that desirable for eg json logging
[16:57:59] <cmr> So nevermind!
[17:06:29] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[17:06:29] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/tzujgw
[17:06:29] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[17:08:37] *** Joins: notmatt (notmatt@118CCA77.D1B89392.602E4FC1.IP)
[17:13:08] <nmatsakis> pnkfelix: actually let me take this into this channel :)
[17:13:29] <nmatsakis> pnkfelix: I was thinking a bit more about GC composability with user-defined pointers etc
[17:13:56] <nmatsakis> pnkfelix: If you can't put GC things into (e.g.) RC things,
[17:14:13] <nmatsakis> pnkfelix: I am worried that we'll wind up with segregated libraries that don't place nice together.
[17:14:33] <pnkfelix> nmatsakis: yes that is a legitimate worry.
[17:14:45] <pnkfelix> nmatsakis: but is the constraint really that you cannot put GC things into RC things?
[17:14:53] <nmatsakis> pnkfelix: I guess we already covered the options.
[17:15:13] <nmatsakis> that is: 1. tagging fields of *T type and saying "go ahead and trace this"
[17:15:16] <pnkfelix> nmatsakis: we do need to make sure that the GC knows about the storage that it needs to trace
[17:15:20] <nmatsakis> 2. having the GC call a deref operator
[17:15:24] <nmatsakis> (user-defined code)
[17:15:44] <nmatsakis> 3. some kind of "rooting" callbacks from RC<T>
[17:15:45] *** Joins: doomlord__ (servitor@moz-4625DF14.range86-184.btcentralplus.com)
[17:15:56] *** Quits: doomlord__ (servitor@moz-4625DF14.range86-184.btcentralplus.com) (Client exited)
[17:16:05] <pnkfelix> nmatsakis: so e.g. one way to go about this is to have some trait/struct that you have to extend it you want to hold GC things without being a GC thing yourself
[17:16:05] <nmatsakis> i.e., when an RC is constructed, it calls GC::Register::<T>(p) or something
[17:16:09] <nmatsakis> that 
[17:16:29] <nmatsakis> pnkfelix: yeah, that's more-or-less the idea of invoking the deref operator, no?
[17:16:29] <pnkfelix> nmatsakis: Right, I think you're suggesting something similar to what I'm thinking of
[17:16:52] <nmatsakis> that is, if there is a standard deref trait, and the GC knows how to call it,
[17:17:09] <nmatsakis> then when it finds a RC<T> and T contains managed pointers, it can trace those by deref'ing the RC to get back an &T and traversing
[17:17:11] <pnkfelix> nmatsakis: the GC will have to know that it needs to be called, so it needs a list of there roots
[17:17:13] <nmatsakis> interestingly,
[17:17:22] <nmatsakis> this basically *requires* some kind of `const` deref,
[17:17:24] <pnkfelix> nmatsakis: that is, as you said, you'll need to register th eroots
[17:17:43] <nmatsakis> to avoid running afoul of Mut<T> borrowing errors
[17:17:58] <pnkfelix> nmatsakis: (and there's a question of whether the registration should be a dynamic call, which is what I think you suggested, or if it is something that you have to decide at the time the root object is allocated)
[17:18:12] <nmatsakis> pnkfelix: I suggested two things
[17:18:14] <pnkfelix> nmatsakis: this is why I was thinking up-above that it might need to be a trait/struct you inherit from
[17:18:28] <nmatsakis> the trait version did not (in my mind) involve a dynamic call,
[17:18:34] <nmatsakis> but it does involve the GC somehow knowing what code to invoke
[17:18:49] <nmatsakis> basically a vtable
[17:18:54] <nmatsakis> this affects the design of the deref trait somewhat,
[17:19:09] <nmatsakis> it suggests a higher-kinded approach would be better than what I was presently thinking
[17:19:21] <pnkfelix> I'm not sure I'm following exactly all the details of how deref solves this
[17:19:33] <pnkfelix> Are you somewhere that you could take a quick vidyo call?
[17:19:37] <nmatsakis> yes
[17:19:49] <pnkfelix> okay, give me a sec to get resituated.
[17:20:00] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[17:20:56] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[17:21:34] <pnkfelix> nmatsakis: k in your room
[17:21:46] <nmatsakis> pnkfelix: ok 2 mins
[17:24:32] <nmatsakis> pnkfelix: https://etherpad.mozilla.org/3FQFR7dOVM
[17:25:34] *** zz_kimundi is now known as kimundi
[17:35:45] *** Joins: geoffhill (geoffhill@moz-738DC0DB.org)
[17:53:48] *** Joins: hack (chatzilla@moz-87E1666F.rev.onenet.an)
[17:54:45] <hack> hello everyone
[17:55:34] <hack> question: what's the best way to debug the compiler code? anyone has a special technique to create kind of break points in code?
[17:56:19] <cmr> hack: not really
[17:56:27] <cmr> RUST_LOG=rustc=4 is the best way.
[17:56:40] <cmr> But you can use gdb if you build with RUSTFLAGS='-Z extra-debug-info'
[17:57:01] <hack> cmr: yes I'm looking for getting extra debug info
[17:57:57] <hack> right now Im using 'make -j8' or other 'make ..' commands to recompile the code and test
[17:58:00] *** Quits: geoffhill (geoffhill@moz-738DC0DB.org) (Quit: )
[17:58:58] <klutzy> clang works on windows, but I don't have answer for second question. hmm it's interesting
[17:59:01] <klutzy> oops
[17:59:06] <klutzy> sorry
[17:59:15] <cmr> hack: `make clean; RUSTFLAGS="-Z extra-debug-info" make -j8`
[17:59:49] <hack> just testing that one ;-)
[17:59:52] <cmr> you might actually need to re-configure...
[18:00:15] <hack> cmr : you mean like having to './configure' again?
[18:00:47] <cmr> hack: yeah
[18:01:15] <hack> cmr: ok, good to know when I want to properly test the changes
[18:01:37] <cmr> I'm not sure about that, though
[18:02:20] <hack> cmr:I have been playing with the code, changing and building. You in Win or Mac?
[18:02:49] <cmr> Linux
[18:02:55] <hack> cmr:Im using mac, and every time I change something and is not good, it breaks
[18:03:08] <hack> without recompiling
[18:03:10] <cmr> acrichto: ping
[18:03:20] <cmr> hack: what do you mean by breaks?
[18:03:22] <acrichto> cmr: pong
[18:03:35] <hack> cmr: I mean it dails 
[18:03:37] <hack> fails
[18:03:38] <cmr> acrichto: Were you working on reworking the logging system?
[18:03:52] <acrichto> cmr: awhile ago yes, but I "finished" that work
[18:04:30] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[18:05:11] <acrichto> cmr: how come?
[18:05:29] <cmr> acrichto: I'm reworking the compiler's logging entirely. q3 also reimplements logging. I'm wondering if we should have something better in extra, or if it's possible to have flexible logging with the builtin macros... Maybe for rustc, a struct with fmt::Default that does span-handling?
[18:06:02] <acrichto> what do you mean by flexible logging?
[18:08:00] <cmr> q3 wants to log to a gui thing, rustc wants to adding coloring and be able to log to a machine-parsable format
[18:08:12] <cmr> The default logging only does stdio
[18:09:21] <acrichto> I don't see why it shouldn't be possible
[18:09:31] <acrichto> logging and compiler messages are a little orthogonal though
[18:09:40] <acrichto> logging is off by default, compiler messages are on by default
[18:10:27] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[18:11:22] <cmr> They're the same thing, in my mind, and they both boil down to "this event X happened with level Y".
[18:11:36] <olsonjeffery> acrichto: is there a ticket for what came out of the 1:1 scheduling pursefight yesterday?
[18:11:47] <cmr> pursefight?
[18:11:47] <acrichto> olsonjeffery: not yet
[18:12:30] * olsonjeffery will respectfully apologize for using the "pursefight" descriptor.
[18:12:40] <cmr> I've never heard that word :p
[18:13:45] <olsonjeffery> i imagine a bunch old english ladies (perhaps the cast of monty python in drag, if you prefer) slapping at each other with handbags.
[18:13:51] <cmr> heh
[18:14:06] <acrichto> ar rcs x86_64-apple-darwin/rt/uv_support/libuv_support.a /Users/alex/code/rust3/src/rt/rust_uv.c
[18:14:10] <acrichto> something is wrong with that command
[18:14:13] <acrichto> 10 points if you can find out
[18:14:42] <cmr> You're linking a .c :P
[18:14:54] <acrichto> xcode complained, and rightfully so!
[18:20:57] <acrichto> cmr: btw you can have secrets on travis
[18:21:10] <cmr> acrichto: go on, I am intrigued
[18:21:20] <acrichto> I htink http://about.travis-ci.org/docs/user/encryption-keys/ is the relevant documentation
[18:21:22] <cmr> it didn't have that last I used it in any depth
[18:21:30] <cmr> hmm
[18:21:32] <acrichto> travis is actually pretty legit
[18:21:32] <cmr> neat
[18:21:43] <cmr> Yes, I love travis
[18:21:47] <acrichto> wycats was suggesting the other day that perhaps mozilla could donate boxes
[18:21:49] <cmr> I think I might be about to love it more :P
[18:21:53] <acrichto> and we could build nightlies on them
[18:22:15] <acrichto> not sure if we'd do that, but it'd be pretty sweet to offload everything to travis
[18:22:39] <Seldaek> don't they have a build time limit?
[18:22:57] <acrichto> I would feel real bad about building rust on travis, but if we donated our own boxes I wouldn't feel bad t all
[18:27:48] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[18:34:45] *** kimundi is now known as zz_kimundi
[18:35:10] <sfackler> Travis VMs only have 512MB of RAM allocated by default
[18:44:25] <acrichto> haha that's so woefully inadequate
[18:49:26] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[19:01:17] *** zz_kimundi is now known as kimundi
[19:02:57] <nmatsakis> acrichto: cmr: I have strong opinions about compiler logging
[19:03:04] <cmr> nmatsakis: do go on!
[19:03:10] <nmatsakis> so if you are thinking about doing work on it, particularly redesign-y work, I'd be interested to chime in :)
[19:03:14] <cmr> Please do
[19:03:25] <nmatsakis> I think rustc could really use a very custom tailored logging system
[19:03:34] <nmatsakis> you should be able to express indentation conveniently,
[19:03:42] <nmatsakis> but also to express which node-id(s) the things you are doing is relevant to,
[19:03:57] <nmatsakis> and inherit those node-ids from outer scopes, (thta connects to indentation)
[19:04:13] <nmatsakis> debug levels are not especially useful in a compiler I don't think
[19:04:19] <nmatsakis> like info vs debug
[19:04:30] <nmatsakis> better is probably some kind of hashtags
[19:04:42] <nmatsakis> I've mostly thought about doing this as a sort of post-processing
[19:04:46] <nmatsakis> pnkfelix and I were talking about at one point
[19:04:53] <cmr> I also plan on adding diagnostic id's to enable https://github.com/mozilla/rust/issues/2092
[19:04:53] <nmatsakis> conventions on rustc's debug messages
[19:05:31] <nmatsakis> and then you could do queries like "type-related logs, emitting from module X, pertaining to fn Y"
[19:05:55] <nmatsakis> cmr: I really want that, but that's more about error messages, right?
[19:06:12] <cmr> nmatsakis: We might not be thinking about the same thing
[19:06:19] <nmatsakis> that's possible
[19:06:22] <cmr> nmatsakis: I'm thinking more syntax::diagnostic
[19:06:26] <nmatsakis> ah ok
[19:06:28] <nmatsakis> nm :)
[19:06:41] <nmatsakis> my main opinion there is that we should do #2092 and find a nice way to embed links
[19:06:56] <nmatsakis> unfortunately using a terminal is limiting, though maybe we can use mozilla's link shortener,
[19:07:07] <nmatsakis> I guess my other hair brained idea is to hvae rustc start up a web server
[19:07:13] <nmatsakis> so that you can see th emessages complete with links into your code
[19:07:14] <nmatsakis> :)
[19:07:27] <nmatsakis> sorry, links into (an annotated version of...) your code
[19:07:30] <nmatsakis> man that'd be so neat
[19:07:34] <cmr> Annotated with rustfind!
[19:07:36] <nmatsakis> and so much work
[19:07:53] <nmatsakis> I was envisioning you could do things like hover over a variable to see its inferred type,
[19:07:53] <cmr> nmatsakis: if we can co-opt rustfind (cc doomlord_), it'd be super sweet
[19:07:56] <nmatsakis> but also to visualize lifetimes
[19:08:23] <nmatsakis> and in fact that this mode would just be useful on its own, even if no error occurred at all
[19:08:28] <nmatsakis> yes, co-opting rustfind makes sense
[19:08:37] <cmr> It'd also be useful for rustdoc's src links too
[19:08:47] <nmatsakis> I've always hoped to interest an intern in it
[19:08:48] <nmatsakis> so far I've failed
[19:10:16] <cmr> I don't think using rustfind directly is a good idea, actually.
[19:10:27] <cmr> The pretty printer needs to be reworked to enable things like rustfind
[19:10:40] <cmr> Rather than having everything (this includes rustdoc) have its own form of pretty printing.
[19:12:33] <nmatsakis> yes
[19:12:37] <nmatsakis> that's an interesting problem
[19:12:51] <nmatsakis> I don't even know the full set of use cases, much less an idea what's the right sol'n
[19:13:40] <cmr> I've been thinking about it for a while, haven't really come to any conclusions yet.
[19:16:27] <doomlord_> hi, 
[19:16:49] <doomlord_> if you have any suggestions that would make it more useful i'm open to that
[19:16:57] <doomlord_> eeasier to link with rustdoc etc
[19:17:03] <cmr> doomlord_: it's super useful, it's just that it practically reinvents the AST
[19:17:18] <cmr> which is indicative of a larger problem
[19:17:41] <doomlord_> bear in mind the motivatin for writing it :)
[19:17:52] <doomlord_> making it easier to search source :)
[19:18:21] <doomlord_> next time i write something i can leverage whats there better i guess
[19:18:39] <cmr> nmatsakis: it seems every non-trivial use of the AST runs up into problems with how it is designed. It's not a very useful interface for doing analysis or AST->non-AST transforms
[19:18:42] <doomlord_> there's a few things in it i know could be cleaned up
[19:19:11] <cmr> I don't have any formal knowledge in this area, though, so it's hard for me to think about it.
[19:19:27] <nmatsakis> I feel like it's a bit cludgy, but not fundamentally wrong?
[19:19:37] <nmatsakis> I am not sure if there will ever be The One True Representation of an AST
[19:19:39] <doomlord_> i can tell you i found clang AST easier to work with, but that could be familiarity with C/C++ aswell
[19:19:56] <doomlord_> agree making "one true representation" is hard
[19:19:59] <nmatsakis> I'd certainly like to change it, but mostly because I want to enable better parallelizaiton within rustc and improve perf
[19:20:11] <nmatsakis> Java's compiler exports an interface to their AST, which is interesting,
[19:20:14] <nmatsakis> we might consider the same
[19:20:22] <cmr> CPython does too
[19:20:25] <nmatsakis> that is, they have an explicit abstraction layer
[19:21:11] <doomlord_> i got the impression rusts' ast representation was subject to change
[19:23:30] <cmr> nmatsakis: where specifically do you see opportunity for parallelization?
[19:23:50] <nmatsakis> cmr: most of the compiler passes can process each fn item independently
[19:23:57] <nmatsakis> cmr: though that'll get harder for type checking if we add return type inference
[19:24:00] <cmr> Ok, so our thinking is mostly in line
[19:24:16] <nmatsakis> cmr: but there's a LOT of refactoring that needs to be done first
[19:24:21] <cmr> yes, very much so
[19:25:58] <doomlord_> i wondered if GitHub might eventually get a linked source browser
[19:26:14] <cmr> I'm becoming more dissatisfied with github the more I use it
[19:26:33] <cmr> It's fantastic for smaller projects, but at the size of Rust it becomes painful
[19:26:46] <doomlord_> one feature i miss is voting on posts
[19:26:50] <cmr> Maybe it's just our workflow though
[19:27:02] <doomlord_> do you use anything else that you prefer to github
[19:27:38] <cmr> I still don't mind the email-diffs method, but phabricator (LLVM uses it) is very nice
[19:28:38] <cmr> It's not as friendly as github. Github has the wonderful property that 1. it's almost ubiquitous, 2. getting started contributing to a project using it is very very easy
[19:28:44] *** Quits: notmatt (notmatt@118CCA77.D1B89392.602E4FC1.IP) (Client exited)
[19:29:08] <doomlord_> friendly UI to new users goes a long way to making something ubiquitous
[19:29:14] <sfackler> I like gerrit's review system way more than github's
[19:29:23] <doomlord_> and then the value becomes the number of people that use it
[19:29:25] <sfackler> or at least its diff view
[19:29:31] <cmr> sfackler: almost anything is better than github's.
[19:29:35] <cmr> exactly, the diff view is awful
[19:34:13] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[19:39:45] *** Joins: lkuper (lkuper@moz-2820171B.hfc.comcastbusiness.net)
[19:43:37] *** Joins: notmatt (notmatt@118CCA77.D1B89392.602E4FC1.IP)
[19:51:27] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[19:51:28] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/hLoUAg
[19:51:28] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[19:55:31] *** Joins: ktt3ja (Mibbit@moz-6B6EE8C0.hsd1.va.comcast.net)
[19:56:31] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[19:58:43] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[19:59:50] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[19:59:50] *** ChanServ sets mode: +o tjc
[20:03:32] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[20:15:01] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: zzzzzzzzzz)
[20:17:12] <nmatsakis> cmr: I agree, I am frustrated with github. 
[20:17:56] <nmatsakis> cmr: when working on SM, we use bugzilla, which is probably the world's worst UI, but I really like how the code review presents diffs (more readable), how the uploading of patches keeps a clean and complete history, with github everything feels so ephermeral
[20:18:02] <nmatsakis> SM=SpiderMonkey
[20:18:20] <nmatsakis> oh, and when doing code review, you can add comments and then go back and revise before making the entire review live
[20:18:36] <nmatsakis> just so many things I like better
[20:18:52] <nmatsakis> oh that and github doens't own all the metadata and retain the right to delete it whenevre they want (which I recently learned)
[20:19:09] <olsonjeffery> acrichto: hey so i know i keep bugging you about this and im sure you're sick of hearing.. would you be interested in putting your thoughts down in writing somewhere about how to tackle 1:1 within new sched? im pretty keenly interested and would like to help. i assume you're taking the lead.. don't know what the priority is, either.
[20:19:20] <nmatsakis> I'd be curious to read that,
[20:19:34] <nmatsakis> in particular, acrichto, did you have in mind some kind of global switch?
[20:19:49] <olsonjeffery> nmatsakis: it'd be whether librustuv is linked, iirc
[20:19:56] <olsonjeffery> he's building that in w/ native io right now.. as a fallback
[20:20:18] <olsonjeffery> i think the threading mechanisms that live outside of Scheduler have to move into EventLoop, though.. as well as work scheduling.. it requires a lot of thought.
[20:20:19] <nmatsakis> somehow this doesn't feel right to me, but it may be the best design
[20:20:52] <olsonjeffery> nmatsakis: yeah. id like to see an approach, and contrast it against the more.. total approach proposed by strcat
[20:20:54] <nmatsakis> intuitively I'd like to see something where users can instantiate explicit M:N threadpoools and create tasks in them, or else create tasks which have a thread of their own
[20:21:07] <nmatsakis> and some convenient way to get a "default" threadpool
[20:21:50] <nmatsakis> but I haven't tried to elaborate this and I haven't dove into precisely how it interacts with UV
[20:21:55] <nmatsakis> I'm ready to believe it doesn't work in practice
[20:22:17] <olsonjeffery> its doable if you're starting point is total opt-out of the runtime
[20:22:31] <nmatsakis> not sure what you mean exactly
[20:22:44] <olsonjeffery> id like to see better separation, in libstd, between stuff that requires "the runtime", in-the-large, and stuff that doesn't
[20:23:07] <olsonjeffery> TLS, fail!, etc
[20:23:36] <nmatsakis> it seems to make sense that services like that would be dynamically scoped
[20:23:42] <nmatsakis> which implies TLS
[20:23:59] <nmatsakis> it's hard to imagine code tht doesn't use fail! or assert!
[20:24:21] <cmr> The task model, including failure and local storage, is too fundamental to get rid of.
[20:24:39] <cmr> Even if it becomes the case that task failure is abort and local storage is just globals
[20:24:48] *** Quits: jdm (jdm@9C2E78E6.8C982E60.292610BC.IP) (Ping timeout)
[20:25:03] *** Joins: geoffhill (geoffhill@moz-738DC0DB.org)
[20:27:06] <nmatsakis> failure at minimum
[20:27:33] <nmatsakis> I could imagine someting like "CoreLanguageServices::fail" that checks dynamically whether TLS is avail and falls back to abort
[20:27:54] <olsonjeffery> nmatsakis: you're pretty much describing the runtime
[20:28:07] <olsonjeffery> so, when we talk about 'newsched' its just in the context of the Scheduler, tasks, io, etc
[20:28:23] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[20:28:42] <nmatsakis> olsonjeffery: I had a feeling I was... I feel like I'm coming late to the party in that there was a lot of work this summer that I haven't caught up on
[20:28:46] <olsonjeffery> i think it should expand to cover *everything* that it should. i think there's a bunch of stuff that was punted as being orthogonal that really isn't.
[20:28:59] <nmatsakis> olsonjeffery: though I read a lot of the scheduler, it was very much in the small, I feel like I don't undersatnd (or have forgotten) the overall view
[20:30:35] <nmatsakis> olsonjeffery: can you be a bit more specific?
[20:30:44] <acrichto> nmatsakis olsonjeffery: ah yes, I will do that right now, I was thinking that #[no_uv] is the "global controller"
[20:30:50] <olsonjeffery> i think Scheduler, EventLoop, IoFactory, the std::io traits, etc are all flexible enough to present working interfaces with widely disparate underlying impls
[20:31:10] <olsonjeffery> and where we have "Creeping POSIX'isms" or overly libuv-leaning APIs, we can deal with that.
[20:31:19] <olsonjeffery> in the traits, i mean
[20:32:10] <cmr> There should be a core set of features that needs to be defined.
[20:32:24] <cmr> That a runtime can implement, and then libstd suddenly works on that platform.
[20:32:59] <acrichto> cmr: I agree, right now we are 100% at that goal for I/O
[20:33:09] <acrichto> we are not close to the goal for task spawning/task communication, however.
[20:33:12] <cmr> mmm
[20:33:42] <olsonjeffery> i think EventLoop isn't really just what its name suggests
[20:34:07] <nmatsakis> I worry about global switches
[20:34:15] <nmatsakis> but maybe it's actually the better approach in practice
[20:34:19] <olsonjeffery> at the least we needs to handle TLS and threading/context creation for new tasks
[20:34:34] <acrichto> nmatsakis: how so?
[20:34:39] <olsonjeffery> scheduler is tricky because its pretty much on-rails as being M:N.. the threading happens outside of scheduler
[20:34:59] <acrichto> I think that 1:1 can live with no scheduler at all
[20:35:03] <olsonjeffery> so assumptions have to change if we allow 1:1 scheduling for tasks.
[20:35:04] <olsonjeffery> yes. that.
[20:35:07] <olsonjeffery> +1 acrichto
[20:35:16] <olsonjeffery> so then a runtime check in spawn() ?
[20:35:26] <nmatsakis> acrichto: global usually means non-composable to me, I guess
[20:35:41] <acrichto> nmatsakis: this "global switch" is only a switch in the end executable
[20:35:56] <acrichto> you can compose any libraries using std::io interfaces over 1:1 and M:N implementations
[20:35:58] <nmatsakis> acrichto: yes, so I worry that I have app #1 and app #2 and I want to put them together into a bigger app and it fails
[20:36:10] <acrichto> I suppose it could get hair
[20:36:12] <acrichto> hairy*
[20:36:25] <nmatsakis> here I am assuming an "app executable" model like rustc: the guts are a library
[20:36:41] <nmatsakis> otoh, it could be that trying to avoid a global switch makes that failure to compose more likely in practice
[20:36:45] <olsonjeffery> i wonder if we could have a lint for coupling to a scheduling model?
[20:37:09] <nmatsakis> i.e., if you took the design I was thinking baout,
[20:37:09] <olsonjeffery> so a vendor lib could certify as being agnostic across M:N and 1:1
[20:37:15] <nmatsakis> where M:N schedulers are basically objects
[20:37:41] <acrichto> you should be agnostic if you use the non-unstable parts of libstd
[20:37:45] <olsonjeffery> that's basically what id like, nmatsakis
[20:38:02] <olsonjeffery> but recall that we tried it w/ global_loop in the second iteration of async io
[20:38:09] <olsonjeffery> and the dependency extraction was pretty unpopular
[20:38:18] <olsonjeffery> i think newsched is partly a response to that (the global inference)
[20:39:23] <nmatsakis> I guess having a global switch,
[20:39:35] <nmatsakis> permits someone to try and build a M:N object-y approach,
[20:39:37] <nmatsakis> on top of 1:1
[20:40:49] <acrichto> I'll try to write up what I'm thinking before the end of the day though
[20:40:55] <acrichto> I'd love to make some progress on this soon
[20:41:20] <olsonjeffery> id like tp help if there's room for it
[20:41:29] <olsonjeffery> understand if not
[20:41:42] <acrichto> oh there certainly is!
[20:41:52] <acrichto> this needs some careful design
[20:42:22] <cmr> Can we break iterator and option and everything else independant of runtime into its own crate?
[20:42:42] <acrichto> I would rather not resort to that
[20:42:51] <cmr> "resort"?
[20:42:52] <benh> we could call it libcore <:)
[20:42:53] <acrichto> if we must I believe we can, but I also don't believe that we must
[20:43:20] <acrichto> nmatsakis: how did you write a macro that took attributes on a function?
[20:44:24] <acrichto> ah nvmd I just won't do that
[20:44:40] <cmr> My usecase here is targeting a platform like GHI's Medusa. There is no real traditional IO, you're talking to chips over i2c and other busses.
[20:45:04] <acrichto> do you have libc?
[20:45:07] <cmr> no
[20:45:17] <acrichto> at some point virtually nothing in libstd works without libc
[20:45:29] <acrichto> you'd want the types/intrinsics and that's all you'd get
[20:45:57] <acrichto> applications for things as specialized as that probably wouldn't be implementing a runtime interface
[20:46:00] <cmr> well, kinda, I mean there's malloc and such, but no signals, no atexit, no file streams
[20:46:06] <acrichto> or they wouldn't be spawning/communicating
[20:46:20] <cmr> Exactly, that's my point. But Option, Result, iterators, etc is independant of that
[20:46:56] <acrichto> it'd be tricky, I would still rather not split libstd
[20:47:08] <acrichto> but it may be inevitable
[20:47:57] <cmr> There's a lot of competing tensions here. At one side you have servo, a huge application which just needs to be fast, and at the otherside you have embedded work, which has unique platform constraints
[20:53:01] <nmatsakis> acrichto: it's a bit of a pain but there is an attribute macro parser type or something like that that I added
[20:56:21] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[20:56:21] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Kw-v9A
[20:56:22] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[21:01:37] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[21:01:37] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/9N5Xhg
[21:01:37] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[21:01:38] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[21:01:38] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/38-m8w
[21:01:38] <ghrust> 13rust/06auto 14be09626 15Florian Hahn: Remove type overflow checks from check_const.rs, refs #4220...
[21:01:39] <ghrust> 13rust/06auto 1420627c7 15Florian Hahn: Check inferred integer literals for overflows, closes #4220
[21:01:39] <ghrust> 13rust/06auto 14ade310c 15bors: auto merge of #10018 : fhahn/rust/check-inferred-ints, r=alexcrichton...
[21:01:41] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[21:04:19] *** Quits: geoffhill (geoffhill@moz-738DC0DB.org) (Ping timeout)
[21:22:59] *** Joins: tikue (quassel@moz-FEADCD38.hsd1.pa.comcast.net)
[21:27:58] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[21:27:58] *** ChanServ sets mode: +o tjc
[21:47:02] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[21:53:27] *** Quits: lkuper (lkuper@moz-2820171B.hfc.comcastbusiness.net) (Ping timeout)
[21:54:20] *** Joins: lkuper (lkuper@moz-2820171B.hfc.comcastbusiness.net)
[22:00:09] *** Quits: eddyb (eddy@336E3A7F.D51DAF03.FB866788.IP) (Ping timeout)
[22:01:22] *** Quits: lkuper (lkuper@moz-2820171B.hfc.comcastbusiness.net) (Ping timeout)
[22:02:24] *** Joins: lkuper (lkuper@moz-2820171B.hfc.comcastbusiness.net)
[22:04:58] *** Quits: hack (chatzilla@moz-87E1666F.rev.onenet.an) (Quit: ChatZilla 0.9.90.1 [Firefox 25.0/20131025151332])
[22:06:40] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[22:06:40] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/38-m8w
[22:06:40] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[22:07:14] *** kimundi is now known as zz_kimundi
[22:08:02] *** Quits: lkuper (lkuper@moz-2820171B.hfc.comcastbusiness.net) (Ping timeout)
[22:11:25] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[22:11:25] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/7NCW7w
[22:11:25] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[22:11:33] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[22:11:33] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/dJZuzQ
[22:11:33] <ghrust> 13rust/06auto 148eb3e38 15Patrick Walton: librustc: Remove calls to `upcall_reset_stack_limit`
[22:11:33] <ghrust> 13rust/06auto 14fb396c4 15bors: auto merge of #10156 : pcwalton/rust/reset-stack-limit, r=alexcrichton...
[22:11:33] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[22:18:56] *** Joins: geoffhill (geoffhill@moz-738DC0DB.org)
[22:29:10] <acrichto> olsonjeffery nmatsakis: https://github.com/mozilla/rust/issues/10493
[22:32:07] *** Joins: tjc (tjc@8977BF93.FD5C31A1.284344F5.IP)
[22:32:07] *** ChanServ sets mode: +o tjc
[22:37:26] *** flaper87 is now known as flaper87|afk
[22:40:31] *** Joins: lkuper (lkuper@3A916FC1.14CD977C.51B6877.IP)
[22:41:59] *** Quits: tjc (tjc@8977BF93.FD5C31A1.284344F5.IP) (Ping timeout)
[22:42:53] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[22:45:28] *** Joins: tjc (tjc@8977BF93.FD5C31A1.284344F5.IP)
[22:45:28] *** ChanServ sets mode: +o tjc
[22:50:29] *** Quits: tjc (tjc@8977BF93.FD5C31A1.284344F5.IP) (Ping timeout)
[22:52:14] *** Joins: tjc (tjc@8977BF93.FD5C31A1.284344F5.IP)
[22:52:14] *** ChanServ sets mode: +o tjc
[22:55:29] <acrichto> tjc: ping
[22:55:37] <tjc> acrichto: pong
[22:55:47] <acrichto> tjc: what is package_id vs naem ?
[22:56:11] <tjc> the package_id is the fully qualified path (like github.com/mozilla/rust)
[22:56:19] <tjc> the short name is used to make the link name (so, it would be "rust" in that case)
[22:56:47] <tjc> Actually, short_name might not need to be a separate field anymore
[22:56:52] <tjc> it could just be a method that gets the last component of the package_id
[22:56:57] <acrichto> hm ok, it seems weird to have rustc complain so much when building with --lib now
[22:57:10] <tjc> what does rustc complain about?
[22:57:18] <acrichto> just warnings about missing name/vers/package_id
[22:57:45] <tjc> It always complained about missing name and vers, though, right?
[22:57:56] <tjc> There was a patch (not from me) that made it so rustc always introduces a package ID automatically.
[22:58:03] <acrichto> yeah, it's a little more confusing now though 
[22:58:04] <tjc> but that seems weird that it would warn rather than just inserting one
[22:58:09] <acrichto> package_id and name seem like the same thing
[22:58:52] <tjc> Not necessarily
[22:59:09] <tjc> if my package's id is github.com/catamorphism/foo, the library is going to be called libfoo-[hash].dylib
[22:59:17] <tjc> and not libgithub.com/catamorphism/foo-[hash].dylib
[22:59:31] <acrichto> I like the idea of it inferring name from package_id
[22:59:33] <acrichto> and stop requiring name
[22:59:56] <tjc> acrichto: Yeah, see https://github.com/mozilla/rust/issues/8523
[23:05:07] <acrichto> tjc: how does the tests in 10494 work? it seems like you're depending on 'test-pkg' but you never create anything with that name
[23:06:58] <tjc> acrichto: Looking
[23:07:37] <tjc> acrichto: oh, that's the default name that git_repo_pkg() (which is just a test function) uses
[23:07:45] <acrichto> ah ok
[23:08:42] <tjc> It's a little crufty, but hey, it's just a test runner :P
[23:09:29] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[23:09:52] <acrichto> in general, how tied is rustpkg to git?
[23:10:14] <tjc> it's pretty tied to it right now
[23:10:37] <acrichto> isn't the idea to support multiple VCS systems?
[23:10:37] <tjc> At least, insofar as the code that deals with git doesn't have any of the command names abstracted out or anything...
[23:10:47] <tjc> though I feel like the code that deals with VCS is pretty well-separated from everything else
[23:11:03] <acrichto> just seems kinda odd to have 'let mut use_git = true'
[23:11:05] <tjc> Yes, that is the idea, I just thought at the time it was easier to start by getting git working than to prematurely come up with some abstraction that covers all VCes
[23:15:02] <acrichto> tjc: I'm certainly not familiar with rustpkg at all, so I can't really comment on architecture-y parts, but the code all looks good to me
[23:15:09] <acrichto> can you add a negative test though?
[23:15:33] <acrichto> also, are folders with versions in the name tested at all?
[23:15:44] <tjc> acrichto: Sure! I know you're not all that familiar, I just figured everybody else was busy with the work week :-)
[23:15:52] <tjc> I'll add a test for folders with versions in the name too
[23:15:57] <acrichto> basically r+ with some more tests
[23:16:04] *** nrc is now known as nrc|holiday
[23:16:05] <acrichto> a negative one is the big one that I thought it might need
[23:16:15] <acrichto> I have git foo with tag 0.1, but I want version 0.2
[23:16:16] <tjc> For a negative test, you mean something like a URL-fragment with two '#'s in it? Or...
[23:16:20] <tjc> a version that doesn't exist?
[23:16:25] <acrichto> version that doesn't exist
[23:16:26] <tjc> Ah, ok, the latter
[23:16:28] <tjc> Sure
[23:16:32] <acrichto> r=me
[23:17:10] <tjc> Thanks!
[23:17:29] <acrichto> np
[23:17:47] *** Quits: geoffhill (geoffhill@moz-738DC0DB.org) (Input/output error)
[23:27:59] *** Quits: Kxepal (Miranda@moz-3A55D1EB.pppoe.mtu-net.ru) (Quit: Kxepal)
[23:28:10] *** Joins: Kxepal (Miranda@moz-3A55D1EB.pppoe.mtu-net.ru)
[23:37:08] <olsonjeffery> acrichto: this is a solid, actionable proposal.
[23:37:38] <acrichto> olsonjeffery: thanks :), and of course comments are welcome!
[23:38:00] <olsonjeffery> part of wishes that, instead of the "do we have a scheduler?" checks all over the place, things were generalized and backed-out enough that it would just be "do we have a 'real' scheduler? no? fall back to *this* native scheduler" or eventloop or whatever..
[23:38:12] <olsonjeffery> im hung up on that whole EVENTLOOP ALL THE THINGS approach, i guess
[23:38:33] <cmr> which proposal?
[23:38:33] <olsonjeffery> but it may not possible. the semantics are probably too different. so this is a good thing and we can do it now. i support it.
[23:38:42] <olsonjeffery> cmr: https://github.com/mozilla/rust/issues/10493
[23:38:52] <cmr> thanks
[23:38:55] *** Quits: tjc (tjc@8977BF93.FD5C31A1.284344F5.IP) (Quit: zzzzzzzzzz)
[23:39:26] <acrichto> an event loop seems like an inherent scheduler-related thing
[23:40:07] <olsonjeffery> yeah. i would love to see it grow to take on everything TLS, to malloc, threading, failure/unwinding, everything
[23:40:25] <olsonjeffery> there would be "rust-core", just an EventLoop (or whatever it's called) impl with really close-to-the-metal uses
[23:40:42] <olsonjeffery> or in cmr's case, whatever register fiddling is neccesary to tell the microcontroller you want to do some magical thing
[23:40:54] <olsonjeffery> there would be no "rust-core", i mean
[23:41:08] <acrichto> I don't think I'd call it an EventLoop, but I would love for that to be "the interface"
[23:41:15] <olsonjeffery> yes. that's what i mean.
[23:41:18] <olsonjeffery> RunTime
[23:41:34] <olsonjeffery> that's probably not right either. it's one word.
[23:41:52] <olsonjeffery> but, yeah. my gut instinct it to just grow that one trait to tackle everything
[23:42:41] <acrichto> hm, I agree
[23:42:49] <olsonjeffery> but. with all of those jobs taken into account, the semantics are quite possibly too disparate across different scenarios (virtualized servers vs embedded vs desktop vs everything else)
[23:43:00] <olsonjeffery> to really be useful
[23:43:07] <olsonjeffery> that is the core of strcat's critique, as i see it
[23:44:05] <acrichto> it seems like a vaild argument, but I have a hard time visualizing it
[23:44:26] <acrichto> I think that you can almost always poke holes in an actual system, but then you can also optimize/modify an actual system
[23:44:26] <olsonjeffery> yeah i know too little about the "runtime'y" things that fall outside of Scheduler/EventLoop.
[23:44:31] <acrichto> it's hard to do that with theoretical systems
[23:44:33] <olsonjeffery> TLS, malloc, unwinding/failure, etc
[23:44:51] <acrichto> there's actually not a whole lot
[23:44:55] <acrichto> when I stopped to think about it
[23:45:05] <acrichto> TLS is a thing, but TLS is always going to be TLS, it's just what's in it and what it's used for
[23:45:14] <acrichto> malloc is always malloc, that'll never change
[23:45:24] <olsonjeffery> could you conceive generalizing the API of those things and sticking it into a proposed Runtime trait?
[23:45:27] <acrichto> unless you have gc_malloc, then it's a per-task thing
[23:45:52] <acrichto> I could indeed
[23:46:34] <olsonjeffery> malloc is a langitem right now?
[23:46:58] <acrichto> yes
[23:47:33] <acrichto> cmr: stop doing rust and study lol
[23:47:43] <cmr> acrichto: you have no idea how incredibly hard that is!
[23:48:05] <acrichto> don't worry, rust will be here when you get back :)
[23:48:59] *** Quits: dbaupp (Thunderbir@moz-4CA0D523.lns20.syd6.internode.on.net) (Ping timeout)
[23:52:30] *** Joins: dbaupp (Thunderbir@moz-4CA0D523.lns20.syd6.internode.on.net)
[23:54:15] *** Quits: dbaupp (Thunderbir@moz-4CA0D523.lns20.syd6.internode.on.net) (Ping timeout)
[23:56:51] *** Quits: ktt3ja (Mibbit@moz-6B6EE8C0.hsd1.va.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
