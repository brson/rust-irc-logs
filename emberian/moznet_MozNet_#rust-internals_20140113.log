[00:09:21] <bjz> acrichto: ping
[00:16:36] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[00:16:36] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/xiqlIg
[00:16:36] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[00:16:37] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[00:16:37] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/fq95QQ
[00:16:37] <ghrust> 13rust/06auto 141246f0b 15Brendan Zabarauskas: Remove RealExt...
[00:16:37] <ghrust> 13rust/06auto 14cd248e2 15Brendan Zabarauskas: Clean up std::num::cmath and remove stale comments
[00:16:37] <ghrust> 13rust/06auto 146e352d7 15bors: auto merge of #11504 : bjz/rust/std-num-cleanups, r=brson...
[00:16:39] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[00:18:02] <bjz> \o/ for simplification
[00:31:47] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[00:34:58] *** Quits: c-a (c-a@moz-57C82A9.a163.priv.bahnhof.se) (Quit: Ex-Chat)
[00:47:55] <bjz> brson: we really need a well-defined mandate for the std
[00:48:31] <bjz> brson: that would help a great deal when deciding what to add/remove/retain
[00:48:32] <cmr> I've been treating it as "Anything dealing with the builtin types, IO, or widespread utilities"
[00:48:44] <bjz> yeah
[00:49:22] <bjz> it would be good to have that made clear though. possibly even in the top level doc comment
[00:49:28] <cmr> yeah
[00:50:04] <bjz> it's super important for evaluating future changes to the lib
[00:51:20] <bjz> I find the idea of a lean stdlib appealing, but it would also be good to have a number of other 'official' libs so that folks could still find the batteries easily if the need them
[00:51:35] <cmr> We really need a solid package manager
[00:51:37] <cmr> Like, real bad.
[00:51:41] <cmr> It hurts me to not have one
[00:51:49] <bjz> yeah, the situation is painful
[00:52:12] * bjz is avoiding projects that depend on other libs for this reason
[00:54:08] <bjz> A language is more than just semantics, syntax, and an implementation - it's about an ecosystem and a community. Without that it dies.
[00:54:36] <bjz> (or is forgotten)
[00:57:09] <brson> agree. it's a dire problem
[00:57:29] <ChrisMorgan> Personally I feel the two most urgent priorities at present to be documentation and package management.
[00:57:38] <brson> i intend to get rustpkg back on track soon
[01:03:49] <bjz> brson: \o/
[01:14:32] *** Joins: dbaupp (Thunderbir@1D1B1F7A.D5A1DCF.37681C44.IP)
[01:26:36] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[01:26:36] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/fq95QQ
[01:26:36] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[01:31:06] <bjz> \o/
[01:31:22] <dbaupp> RIP parts of std::num
[01:31:42] <bjz> long live parts of std::num (in a new form)
[01:32:36] <bjz> btw, I have Algebraic, Trigonometric and Transcendental in num-rs
[01:32:42] <bjz> :)
[01:32:46] <dbaupp> bjz: btw, std::rand::distributions would be perfect for libnumbe-rs, but I'd encourage you to not delete it from std until we have a sane package manager (since they are dramatically harder to reimplement since they are not libm bindings.)
[01:33:01] <bjz> oh cool
[01:33:05] <bjz> yeah
[01:33:06] <bjz> agreed
[01:33:55] <bjz> I would hope that num-rs wouldn't be too sprawling
[01:34:06] <bjz> but provide traits that other libs could use
[01:34:25] <bjz> like say, libunits or something
[01:34:50] <bjz> (compile time units of measure, if ever it is possible)
[01:34:58] * ChrisMorgan really wants that
[01:35:07] <bjz> <3 <3
[01:35:19] <ChrisMorgan> But then, I really want lots of things.
[01:35:27] <bjz> no mars orbiter issues for rust!
[01:38:26] <bjz> ChrisMorgan: btw: https://github.com/bjz/num-rs
[01:42:14] *** Quits: tikue (tkuehn@moz-879E86A9.hsd1.ca.comcast.net) (Ping timeout)
[01:42:48] <bjz> Haw haw haw. brson take note, *this* is how you start the release notes of your language: http://blog.selflanguage.org/2014/01/12/self-mallard-4-5-0-released/
[01:42:59] <bjz> "Named after the majestic, awe inspiring Anas platyrhynchos, the latest Self release 4.5.0 is now available for download."
[01:43:03] <bjz> xD
[01:44:38] <bjz> but yeah, they didn't say what Self actually was (which is what you always get right, heh)
[01:48:13] <cmr> ChrisMorgan: with libnative we trounce go
[01:48:17] <dbaupp> we need named releases! After dinosaurs, so we can have Stegosaurust and Tyrannosaurust, etc.
[01:48:21] <dbaupp> cmr: \o/
[01:48:28] <bjz> heh
[01:48:33] <cmr> https://gist.github.com/cmr/00e196c8b842a2042ac5
[01:48:38] <cmr> oops wrong channel
[01:50:00] *** Joins: tikue (tkuehn@moz-879E86A9.hsd1.ca.comcast.net)
[01:51:34] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[01:51:34] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/VjuRLw
[01:51:34] <ghrust> 13rust/06auto 1446905c0 15Brian Anderson: Bump version to 0.10-pre
[01:51:34] <ghrust> 13rust/06auto 14cb9c102 15bors: auto merge of #11442 : brson/rust/0.10-pre, r=alexcrichton
[01:51:35] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[01:51:37] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[01:51:37] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/YENO6w
[01:51:37] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[01:52:29] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[02:01:18] <nrc> dbaupp++
[02:01:59] <Luqman> yes, making a new alloca and then passing it to a function that expects it to not be null is exactly what should happen :/
[02:07:15] <brson> dbaupp: lol. how many sauruses are there?
[02:07:27] <cmr> brson: as many as we care to invent.
[02:07:29] <cmr> :P
[02:07:33] <brson> lol
[02:08:50] <brson> bjz: when i saw their release notes, the first thing i thought was 'ok, what is self?'
[02:09:01] <bjz> really?
[02:09:08] <brson> then i went to their home page, and again I thought the same thing
[02:09:21] <bjz> Self is a classic lang :)
[02:09:27] <brson> oh, actually their homepage is good
[02:09:29] <dbaupp> brson: the html of http://en.wikipedia.org/wiki/List_of_dinosaur_genera has 836 lines containing 'saurus'
[02:09:33] <brson> the release notes are on their blog
[02:09:42] <bjz> yeah, I hate that
[02:09:52] <brson> bjz: i did know that
[02:09:55] <bjz> when it's hard to get to the homepage from the blog
[02:33:57] <dbaupp> neat, the 0.9 release gave us nearly 2500 additional unique visitors to the mozilla/rust repo ( https://github.com/mozilla/rust/graphs/traffic possibly only visible for those with push privileges)
[02:35:26] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[02:35:42] *** Joins: brson (brson@981AA104.E81F12CD.76F66111.IP)
[02:35:42] *** ChanServ sets mode: +qo brson brson
[02:43:23] <ChrisMorgan> dbaupp: yes, traffic stats are only for admins/pushers
[02:52:01] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[03:02:22] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[03:02:22] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/VjuRLw
[03:02:22] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[03:13:03] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[03:15:12] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[03:17:31] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[03:18:24] *** Quits: kimundi (kimundi@moz-6726BDB1.dip0.t-ipconnect.de) (Ping timeout)
[03:21:58] *** Joins: kimundi (kimundi@moz-B9792FFA.dip0.t-ipconnect.de)
[03:26:12] *** kimundi is now known as zz_kimundi
[03:30:34] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[03:32:07] <brson> r? https://github.com/mozilla/rust/pull/11506
[03:33:02] *** zz_kimundi is now known as kimundi
[03:36:39] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[03:36:40] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/jBqH4A
[03:36:40] <ghrust> 13rust/06auto 1458097c1 15Brian Anderson: xfail two tests that hang on Android (#11419)
[03:36:40] <ghrust> 13rust/06auto 14b93a4da 15bors: auto merge of #11506 : brson/rust/androidfixes, r=cmr
[03:36:40] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[03:45:12] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[03:46:41] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[03:51:37] *** Quits: brson (brson@981AA104.E81F12CD.76F66111.IP) (Quit: Lost terminal)
[03:52:15] *** Joins: brson (brson@981AA104.E81F12CD.76F66111.IP)
[03:52:15] *** ChanServ sets mode: +qo brson brson
[03:54:41] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[03:54:41] *** ChanServ sets mode: +ao dherman dherman
[03:55:20] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[04:01:06] *** Quits: brson (brson@981AA104.E81F12CD.76F66111.IP) (Ping timeout)
[04:02:31] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[04:07:42] *** kimundi is now known as zz_kimundi
[04:09:15] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[04:24:12] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[04:26:28] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[04:37:09] *** Quits: tikue (tkuehn@moz-879E86A9.hsd1.ca.comcast.net) (Quit: tikue)
[04:44:28] *** Joins: blank_name (blank_name@BC51D793.16360A46.537E532E.IP)
[04:50:22] <dbaupp> acrichto: https://github.com/mozilla/rust/pull/11509
[04:56:37] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[04:56:37] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/jBqH4A
[04:56:37] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[05:24:25] <acrichto> bjz: pong
[05:27:47] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[05:27:51] *** Quits: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net) (Connection reset by peer)
[05:30:20] *** Joins: tikue (tkuehn@moz-879E86A9.hsd1.ca.comcast.net)
[05:47:26] *** Quits: limeburst (me@247D1419.D73964AC.27A8748.IP) (Quit: leaving)
[05:47:42] *** Joins: limeburst (me@247D1419.D73964AC.27A8748.IP)
[05:51:07] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[05:57:13] <bjz> acrichto: dw, brson merged it
[05:57:25] <acrichto> \o/
[05:57:31] <acrichto> merge all the things!
[05:57:36] <bjz> acrichto: https://github.com/mozilla/rust/pull/11504
[05:57:51] <acrichto> +81/-236
[05:57:56] <acrichto> bors should auto-merge thouse
[05:58:00] <bjz> heh
[05:58:14] <acrichto> tsk tsk fixing spelling
[05:58:17] * bjz deletes mozilla/rust
[05:58:24] <acrichto> people like you are why we don't have staticant any more :(
[05:58:27] <acrichto> :P
[05:58:33] <bjz> hahaha
[05:58:40] <bjz> I loved that
[05:58:45] <acrichto> new goal in life, name a variable staticant
[05:58:58] <bjz> best find/replace gone wrong
[05:59:14] <acrichto> Archimedes' staticant
[05:59:18] <bjz> I think pcwalton literally laughed out loud when he saw that
[05:59:47] <bjz> acrichto: well this is what num-rs will have: https://github.com/bjz/num-rs/blob/master/src/lib.rs#L533
[05:59:52] <bjz> :P
[06:00:09] <acrichto> https://github.com/mozilla/rust/blob/master/src/libstd/num/f32.rs#L124
[06:00:13] <acrichto> we still have staticants!
[06:00:34] <acrichto> bjz
[06:00:36] <acrichto> oh bjz
[06:00:42] <acrichto> you make me sad
[06:00:43] <acrichto> https://github.com/mozilla/rust/commit/cd248e29b14e58dc583d71b6bcdf2b8091fb9a9f#diff-d1c874655ee4372b3b07e088e4d97d78L223
[06:00:52] <acrichto> we only have one living staticant now
[06:00:59] <acrichto> that has yet to endure your wrath
[06:01:04] <bjz> haha
[06:01:32] * acrichto goes back to email backlog
[06:11:09] <dbaupp> wait... what?
[06:11:19] <dbaupp> I thought I did a search and replace of staticant?
[06:11:20] <dbaupp> weird
[06:11:55] <dbaupp> maybe acrichto added it back in
[06:12:59] * acrichto is sneaky
[06:18:03] <acrichto> cmr: would you happen to have perf reports of http://cmr.github.io/blog/2014/01/12/the-state-of-rust-0-dot-9/ ?
[06:18:18] <acrichto> I'm curious why librustuv is 2x slower than libnative
[06:34:36] *** Quits: tikue (tkuehn@moz-879E86A9.hsd1.ca.comcast.net) (Quit: tikue)
[06:46:40] <bjz> acrichto: needs mor staticant
[07:07:57] *** Quits: canhtak (canhtak@moz-DB18D73D.wl.t.ulaval.ca) (Quit: canhtak)
[07:11:29] *** Quits: Kxepal (Miranda@moz-D1EB3C25.pppoe.mtu-net.ru) (Ping timeout)
[07:12:19] *** Quits: dbaupp (Thunderbir@1D1B1F7A.D5A1DCF.37681C44.IP) (Ping timeout)
[07:14:59] *** Joins: Kxepal (Miranda@moz-DC764D4E.pppoe.mtu-net.ru)
[07:24:01] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[07:59:27] *** flaper87|afk is now known as flaper87
[08:12:57] *** Joins: dbaupp (Thunderbir@moz-6002BAEA.lns20.syd6.internode.on.net)
[08:16:44] <eddyb> dbaupp: so, if you were to make a decision... drop ExprSelf or not?
[08:18:47] <dbaupp> um
[08:18:59] <dbaupp> dunno
[08:19:06] <eddyb> right now resolve jumps through a hoop to map it to the first argument
[08:19:17] <eddyb> I think DefSelf is not created anywhere now
[08:20:18] <eddyb> dbaupp: I am getting *silly* errors from typeck, this is fun :)
[08:21:18] <dbaupp> will you still have auto-{ref,deref} only on self?
[08:21:54] <eddyb> dbaupp: you mean the first argument of a method call :P?
[08:22:11] <eddyb> there is no such thing as "receiver" anymore
[08:23:49] <dbaupp> yes
[09:01:34] <eddyb> dbaupp: I actually thing auto-{ref,deref} is broken, I remember some errors about mismatched types - &&T vs &T
[09:01:58] <eddyb> s/thing/think
[09:02:20] <eddyb> that is, among all the errors about a missing argument in overloaded op method calls
[09:11:46] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[09:11:46] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/36IZtA
[09:11:46] <ghrust> 13rust/06auto 142c4c2ba 15Yehuda Katz: Add Clone, Eq, and Ord traits
[09:11:46] <ghrust> 13rust/06auto 1480284ec 15bors: auto merge of #11510 : wycats/rust/clone-treeset, r=alexcrichton
[09:11:46] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[09:11:48] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[09:11:48] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/7qWAIg
[09:11:48] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[09:12:00] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[09:14:00] *** Quits: wtw (wtw@moz-D8FB7390.org) (Quit: Lost terminal)
[09:28:36] <eddyb> I wish rustc could tell me what function generated the errors
[09:30:27] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[09:45:18] *** Joins: rca (rcatolino@moz-5C941ACC.adsl.proxad.net)
[09:54:29] <eddyb> dbaupp: this is a hack without generic autoref
[09:58:44] *** Quits: Kxepal (Miranda@moz-DC764D4E.pppoe.mtu-net.ru) (Ping timeout)
[10:02:09] *** Joins: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP)
[10:02:25] *** Joins: Kxepal (Miranda@moz-49BF091C.pppoe.mtu-net.ru)
[10:02:31] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[10:04:47] <SimonSapin> Hi. Is 1:1 IO considered "complete" in 0.9?
[10:05:01] <dbaupp> SimonSapin: don't think so
[10:05:09] <dbaupp> still missing some things
[10:05:12] <dbaupp> like, um...
[10:05:39] <dbaupp> unix sockets and timers
[10:06:38] <SimonSapin> thanks
[10:06:40] <eddyb> error: internal compiler error: method call not in method map
[10:06:42] <eddyb> OOPS
[10:11:00] *** Joins: c-a (c-a@moz-57C82A9.a163.priv.bahnhof.se)
[10:24:44] <eddyb> err, what, fn foo(_: u8) {} doesn't compile
[10:24:55] <dbaupp> eddyb: I think you broke something
[10:25:05] <dbaupp> I just have this little inkling
[10:25:18] <eddyb> in LLVM? I don't see what went wrong
[10:25:59] <dbaupp> oh, it causes an LLVM assertion?
[10:26:31] <eddyb> methods cause a SIGSEGV while functions give me Invalid TypeID
[10:26:42] <dbaupp> awks
[10:27:26] <eddyb> --> mapped t=u8 (0x7f6647f7d580 as *()) to llty=i8
[10:27:35] <eddyb> so what breaks it?
[10:27:53] <eddyb> most of my trans changes are metadata
[10:28:03] <dbaupp> are you outputting the correct type signature?
[10:28:52] <eddyb> I can't tell. I don't think I'm not
[10:29:38] <dbaupp> heh. well, apparently something is incorrect
[10:30:35] <eddyb> I can tell...
[10:30:41] <eddyb> (that. but nothing more)
[10:30:52] <dbaupp> RUST_LOG=rustc
[10:31:03] <eddyb> rustc::middle::trans
[10:31:16] <eddyb> very little info
[10:31:53] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[10:31:53] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/KESTxg
[10:31:53] <ghrust> 13rust/06auto 148f6ffde 15Yehuda Katz: Add Clone to TreeSet
[10:31:53] <ghrust> 13rust/06auto 14caf316a 15bors: auto merge of #11510 : wycats/rust/clone-treeset, r=huonw
[10:31:53] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[10:31:56] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[10:31:56] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1480284ec to 14b93a4da: 02http://git.io/N3iJvQ
[10:31:56] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[10:34:49] <eddyb> create_llargs_for_fn_args only calls llvm::LLVMGetParam
[10:36:14] <eddyb> wait, I'm getting different errors
[10:37:26] <eddyb> aaaaah, SIGSEGV is caused by trying to print an invalid type
[10:38:06] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Ping timeout)
[10:39:34] <eddyb> or, rather, the other way around. the Invalid TypeID is caused by trying to print the type, the SIGSEGV is caused by using the type
[10:43:27] <eddyb> Store void -> i8*
[10:43:50] <eddyb> for some reason, -Z extra-debug-info allows me to get further
[10:45:08] <eddyb> copy_args_to_allocas: args=[Datum { val=void, ty=u8, mode=ByValue }]
[10:45:41] <eddyb> cx.arg_pos(i) // I'm an idiot
[10:45:51] <eddyb> I didn't realize arg_pos was a Rust function, that explains it
[10:48:23] *** Quits: gavin (gavin@moz-DB4A9C19.scl3.mozilla.com) (Ping timeout)
[10:49:08] <dbaupp> you fixed it?
[10:52:43] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[10:52:55] *** Joins: gavin (gavin@moz-DB4A9C19.scl3.mozilla.com)
[10:56:55] <eddyb> dbaupp: wait a second... allocas are bubbled up to the start of the function *intentionally*? that doesn't sound nice
[10:58:35] <dbaupp> eddyb: talk to doener about that (iirc he implemented that)
[11:04:30] *** zz_kimundi is now known as kimundi
[11:10:24] <eddyb> dbaupp: I'm tempted to remove some Cells from FunctionContext
[11:10:52] <dbaupp> are they unnecessary?
[11:16:14] <dbaupp> r? https://github.com/mozilla/rust/pull/11513
[11:19:35] <eddyb> dbaupp: it's on the stack when they are written to
[11:19:51] <eddyb> so those functions can take &mut
[11:19:55] <eddyb> dbaupp: define internal void @foo::h8c35884776189e65ac::v0.0(i8) unnamed_addr #4 {
[11:20:02] <eddyb> how cool is that? :D:D
[11:20:53] <dbaupp> <3
[11:21:10] <dbaupp> does it coerce to a closure?
[11:21:31] <eddyb> that's a lot more work :S
[11:24:30] <eddyb> I might have to add a bare_fn_closure_wrappers: RefCell<HashMap<ty::t, ValueRef>> to CrateContext. I don't think outputting the actual code will be hard
[11:25:03] *** Quits: blank_name (blank_name@BC51D793.16360A46.537E532E.IP) (Ping timeout)
[11:25:13] <dbaupp> will it be a wrapper for each function or for each type?
[11:25:27] <dbaupp> (oh, ty::t, looks like by type)
[11:27:57] *** Joins: blank_name (blank_name@BC51D793.16360A46.537E532E.IP)
[11:33:04] <eddyb> dbaupp: hard to make it for each function. for each type makes it equivalent to impl<..Args, Ret> Fn<..Args, Ret> for fn(..Args) -> Ret
[11:33:46] *** Quits: blank_name (blank_name@BC51D793.16360A46.537E532E.IP) (Ping timeout)
[11:46:42] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[11:46:42] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/KESTxg
[11:46:42] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[11:48:01] *** Joins: blank_name (blank_name@BC51D793.16360A46.537E532E.IP)
[11:49:42] *** Quits: blank_name (blank_name@BC51D793.16360A46.537E532E.IP) (Ping timeout)
[11:53:01] *** Joins: blank_name (blank_name@BC51D793.16360A46.537E532E.IP)
[11:56:52] <eddyb> AAAAAAH, resolve_method_map_entry was replacing self_ty from the method_map_entry and then assigning it to a *different* ID
[11:57:00] *** Quits: blank_name (blank_name@BC51D793.16360A46.537E532E.IP) (Ping timeout)
[11:59:16] <eddyb> no, it doesn't. I'm confused
[12:06:48] *** Joins: blank_name (blank_name@29F64526.16360A46.537E532E.IP)
[12:13:45] <eddyb> dbaupp: this is stupid
[12:14:04] <eddyb> why are generic impls not type checked?
[12:14:20] <eddyb> err, I was stupid
[12:15:00] <dbaupp> eddyb: as in, they are type checked?
[12:15:17] <eddyb> yes, and the method map is filled
[12:15:26] <eddyb> monomorphization should be able to use that information
[12:23:47] *** Quits: rca (rcatolino@moz-5C941ACC.adsl.proxad.net) (Ping timeout)
[12:29:29] *** Quits: sigma (sigma@moz-9EAC972C.range86-184.btcentralplus.com) (Client exited)
[12:34:09] *** Joins: sigma (sigma@moz-9EAC972C.range86-184.btcentralplus.com)
[12:37:32] *** kimundi is now known as zz_kimundi
[12:39:33] *** Quits: sigma (sigma@moz-9EAC972C.range86-184.btcentralplus.com) (Client exited)
[12:40:11] <eddyb> though I think strcat's problem has something to do with vtables
[12:42:21] *** Joins: sigma (sigma@moz-9EAC972C.range86-184.btcentralplus.com)
[12:45:57] <dbaupp> eddyb: generic destructors?
[12:46:10] <eddyb> yeah
[12:47:12] *** Joins: rca (rcatolino@moz-5C941ACC.adsl.proxad.net)
[12:48:05] <dbaupp> I thought that was because there was no way for typeck to communicate the vtables to trans for the destructors (because they aren't in the AST)
[12:49:59] <eddyb> why would typeck hold the vtables :)?
[12:50:21] <eddyb> I'm not saying it doesn't, I'm saying I don't think that's a good design
[12:53:27] <dbaupp> history? and because that's the place that knows how to construct the vtables
[12:53:35] <dbaupp> (I don't actually know)
[12:55:07] <eddyb> all typeck info should be available to trans. anyways, I figured out my little map entry issue
[12:55:43] <eddyb> I was right that resolve_method_map_entry did something important. I wasn't right that it was a different *ID*. nope, it was a different HashMap
[12:56:27] <eddyb> should've been obvious, it's in writeback. it writes the temporary entry to a global HashMap, after applying some transformation on the self_ty (which is no longer required
[12:56:29] <eddyb> )
[13:03:47] <pnkfelix> dbaupp: ping
[13:04:29] <eddyb> what's callee_id for?
[13:04:38] <eddyb> i.e. the extra ID for method calls
[13:06:54] <dbaupp> pnkfelix: pong
[13:07:21] <pnkfelix> dbaupp: I have started looking over PR 11399 (the std::gc collector you've been playing with)
[13:07:55] <pnkfelix> dbaupp: I haven't tried running it yet (and I haven't finished reading all of the code), but I thought I could give you some pointers in the meantime
[13:08:18] <eddyb> (no pun intended?)
[13:08:46] <pnkfelix> dbaupp: I can put such comments on the PR itself, or we can talk about them here.  I thought I'd try here since we might need to have dialogue in order to reach common understanding.
[13:08:59] <pnkfelix> dbaupp: Sound okay?
[13:09:05] <dbaupp> pnkfelix: sure thing (I've got about half an hour before I've got to go)
[13:09:22] <pnkfelix> dbaupp: Okay, yeah I was concerned that time zone and schedules might be an issue.
[13:09:25] <dbaupp> pnkfelix: (can you give me 5 minutes to clean up what I'm working on?)
[13:09:35] <pnkfelix> dbaupp: sure, just ping me when you're available.
[13:14:32] <dbaupp> pnkfelix: ping
[13:14:49] <pnkfelix> dbaupp: pong.  Now good?
[13:14:53] <dbaupp> yep
[13:15:31] <pnkfelix> dbaupp: okay. So, the main piece of feedback I have right now is about the collection policy in collector.rs
[13:16:31] <pnkfelix> dbaupp: If I understand the structure correctly, you are counting the number of allocations, and comparing it to gc_allocs_per_collection_mask
[13:16:39] <pnkfelix> dbaupp: and that is what drives collection
[13:16:50] <dbaupp> pnkfelix: yes
[13:17:55] <pnkfelix> dbaupp: And the current policy does not automatically attempt to update the gc_allocs_per_collection
[13:18:11] <dbaupp> yes
[13:18:24] <pnkfelix> dbaupp: You have exposed setters for it (set_allocs_per_collection and set_collection_frequency), but that's not quite sufficient
[13:18:33] <pnkfelix> dbaupp: So there are two problems here.
[13:19:07] <dbaupp> (The setters are mostly for debugging purposes, to make it collect more often... I really should just expose std::gc::collect(), I think.)
[13:19:08] <pnkfelix> dbaupp: The first is that I think it usually makes more sense to use #words-allocated as the allocation metric that drives collection, not #allocation-calls
[13:19:42] *** zz_kimundi is now known as kimundi
[13:19:44] <pnkfelix> dbaupp: (But to be fair, that claim may not be true for this ptrmap structure that you are using)
[13:19:48] <eddyb> error: unused variable: `self`, #[deny(unused_variable)] on by default
[13:19:50] <eddyb> hehehehe
[13:20:18] <pnkfelix> dbaupp: But for the moment, lets put aside the question of whether to use #allocation-calls versus #words-allocated
[13:20:35] <pnkfelix> dbaupp: Because there's a more fundamental (and I think more subtle) issue here.
[13:21:10] <pnkfelix> dbaupp: In a managed-runtime where the heap size grows (proportionally to the needs of the application)
[13:22:44] <pnkfelix> dbaupp: The cost of each GC is going to be proportional to the heap size
[13:23:20] <dbaupp> Ah, so this strategy is quadratic time
[13:23:34] <pnkfelix> dbaupp: So if your collection policy says "collect every K calls to alloc" (or every K words allocated, the distinction doesn't matter for this argument)
[13:23:41] <dbaupp> (in the worse case)
[13:24:01] <pnkfelix> dbaupp: Right. If K is fixed, then its quadratic, exactly.
[13:24:53] <pnkfelix> dbaupp: So the easy way out of this is to allow K to vary, and to choose K = Theta(M) where M is the heap size (or the amount of live data, depending on other aspects of the collector's design).
[13:25:59] <dbaupp> pnkfelix: yeah, that sounds better. What do other collectors do?
[13:26:03] <pnkfelix> dbaupp: This relationship between K and M is related to the notion of the "inverse load factor"
[13:26:16] * dbaupp notes down the jargon
[13:27:01] <pnkfelix> dbaupp: The collector's I've worked choose some load factor L, where is some real number where L > 1
[13:27:13] <pnkfelix> dbaupp: Common values are L = 2, or L = 2.5, or L = 3.
[13:28:52] <dbaupp> pnkfelix: Then K = M / L?
[13:29:27] <pnkfelix> dbaupp: (these values for L are technically "inverse load factors", since the definition of load-factor is n/k... e.g. in a hash table n is number of entries in the table, and k is the number fo buckets (i.e. the capacity), so these L's correspond to k/n rather than n/k.)
[13:30:18] <pnkfelix> dbaupp: well, if K represents the number of words we will allow the application to allocate before we do another collection
[13:30:44] <pnkfelix> dbaupp: and if M is the amount of live data
[13:31:01] <pnkfelix> dbaupp: then I'd do something like K = L*M - M
[13:31:47] <pnkfelix> dbaupp: Because L*M is the amount of total data we're thinking we'd like to allow to be allocated before the next collection
[13:31:55] <pnkfelix> dbaupp: and M is the amount we have allocated right now
[13:32:26] <pnkfelix> dbaupp: (That is, that assignment `K := L*M - M` is something you do immediately after each full-gc on the task.)
[13:32:46] <pnkfelix> dbaupp: (Its not an invariant that holds at all times)
[13:32:48] <dbaupp> pnkfelix: so (L - 1) * M allocations until the next full-gc?
[13:32:53] *** Quits: rca (rcatolino@moz-5C941ACC.adsl.proxad.net) (Ping timeout)
[13:33:01] <pnkfelix> dbaupp: Yeah that's right
[13:33:29] <pnkfelix> dbaupp: In usual practice one usually chooses some L >= 2
[13:33:36] <dbaupp> Ok, awesome. Should be easy enough to implement
[13:34:43] <pnkfelix> dbaupp: because as L drops below that, and as it approaches 1, you end up spending a lot more time in the Gc uselessly (because the program has not been given enough time for it to make enough progress for objects to start to die)
[13:34:44] <dbaupp> pnkfelix: is the trade off for values of L: small L gives lower memory usage while big L gives few collections (and so, in theory, higher performance)?
[13:34:52] <pnkfelix> dbaupp: that's exactly right
[13:34:56] <dbaupp> *fewer
[13:35:12] <pnkfelix> dbaupp: Let me give you a link to a bugzilla ticket from when I was at Adobe that discussed at particularly nasty case of this in Flash
[13:35:12] *** Joins: rca (rcatolino@moz-5C941ACC.adsl.proxad.net)
[13:36:00] <dbaupp> (Presumably delaying collections too much hits second order effects like stressing the OS allocator (or OOMing) that make very large L actually have lower performance)
[13:36:07] <pnkfelix> dbaupp: Just to let you see how subtle this can get, 
[13:36:23] <pnkfelix> dbaupp: Here's a change that someone thought was a good idea: https://bugzilla.mozilla.org/show_bug.cgi?id=544695
[13:36:40] * dbaupp reads
[13:36:51] <pnkfelix> dbaupp: and here's why it was a terrible idea (at least for the values that were selected at the limit): https://bugzilla.mozilla.org/show_bug.cgi?id=619885
[13:37:57] <pnkfelix> dbaupp: in those cases, they allowed L to drop as low as 1.05
[13:39:12] <dbaupp> pnkfelix: and then it just spent far too long in GC?
[13:39:18] <pnkfelix> dbaupp: which implies that for every word you allocate, you're going to attempt to trace 20 words
[13:39:45] <pnkfelix> dbaupp: (this is called the "mark/cons ratio" -- that's another good bit of jargon to jot down, I think it has much more uptake than "inverse load factor")
[13:40:11] <pnkfelix> dbaupp: See in particular https://bugzilla.mozilla.org/show_bug.cgi?id=619885#c23
[13:41:35] <pnkfelix> dbaupp: As for the effects of very large L, yes I can imagine second order effects could come into play.  Its realizations like that that probably inspired the original change to the Flash GC (where it would vary L itself, choosing a large L for small M and then telescoping L down to smaller values as M grows)
[13:43:04] <pnkfelix> dbaupp: The only other thing I wanted to mention was that I would be a little worried about the space overhead of storing individual finalizers and tracers for each allocation
[13:43:27] <dbaupp> pnkfelix: I was going to change that to a single pointer to both finaliser and tracer
[13:43:32] <pnkfelix> dbaupp: but I have only looked at collector.rs, not the PtrMap nor mod.rs
[13:44:07] <dbaupp> pnkfelix: In theory PtrMap will be replaced by a better data structure: it's a very thing wrapper around std::trie
[13:44:29] <pnkfelix> dbaupp: Yeah.  Did you know that graydon had also used std::trie for his Gc prototype?
[13:44:45] <dbaupp> yeah, I'd looked at it
[13:45:49] <dbaupp> I think his was working in a paradigm with headers inline on every managed pointer, where as mine is storing everything in the trie
[13:46:10] <pnkfelix> dbaupp: Anyway, while it probably would be better to use one ptr for fianalizer+tracer, I was more thinking that it might be good to try to either (1) associate a whole slew of allocations with the same finalizer+tracer pair, or (2) try to optimize the code to avoid needing to store tracers at all (e.g. to use the TyDesc that is presumably already attached to Gc allocations)?
[13:46:11] <dbaupp> (err, *thin wrapper)
[13:46:36] <dbaupp> pnkfelix: TyDesc is not currently associated
[13:47:08] <dbaupp> but putting tracing info into the tydesc would allow that
[13:47:42] <pnkfelix> dbaupp: Yeah that was what I was thinking: Extend tydesc as necessary to support tracing, and then make sure all managed-objects carry TyDesc.
[13:48:20] <dbaupp> pnkfelix: going back to the bugzilla; am I reading it correctly that the conclusion was that going all the way down to 1.05 was too far, and 1.25 was better?
[13:48:30] <pnkfelix> dbaupp: Also, I've been talking with the team about trying to use a different paradigm than finalizers for managed-data
[13:48:32] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[13:48:44] <pnkfelix> dbaupp: Namely something more like reference-queues/guardians
[13:49:15] <dbaupp> pnkfelix: fine by me, I just did the simplest thing I could think of for getting Gc<Vec<T>> to free the inner vector
[13:49:30] <pnkfelix> dbaupp: sure, I just thought I'd mention it.
[13:49:44] <dbaupp> I've noted it down :)
[13:49:49] <pnkfelix> dbaupp: Overall, I'm pretty impressed by how *little* code you needed to write to get this going
[13:50:20] <pnkfelix> dbaupp: (My original screed on finalization is here: http://blog.pnkfx.org/blog/2013/01/29/implicit-versus-explicit-finalization/  but I think I will probably need to write an update soon, once I've actually had more direct experience.)
[13:51:18] <eddyb> that's... an year old :)
[13:51:19] <pnkfelix> dbaupp: Okay, that's all from me.  Thanks again for the PR; I'll read the rest of it now.
[13:52:50] <dbaupp> pnkfelix: one "advantage" of the design which avoids the tydesc is I can use some intrinsics + null function pointers to avoid having to do guaranteed-be-unnecessary virtual tracer/finaliser calls, although the prediction cost branch on is-this-function-pointer-null may be equally as a bad a virtual call to an empty function pointer. (I haven't measured)
[13:53:46] <dbaupp> pnkfelix: also, by avoiding "hard coding" tracing schemes into the tydesc we can have pluggable GCs (pluggable per-task, even) more easily. Although I have no idea if this would be at all useful?
[13:54:22] <pnkfelix> dbaupp: Well... where is the TyDesc stored?   In the static area of the binary?
[13:54:27] <dbaupp> pnkfelix: yes
[13:54:31] <dbaupp> (afaik)
[13:54:57] <pnkfelix> dbaupp: hmmm.  If we were willing to put the TyDesc in mutable storage, then you could still plug in other Gc's.
[13:55:10] <dbaupp> That... feels dangerous
[13:55:11] <pnkfelix> dbaupp: (though I guess then it wouldn't be pluggable per-task)
[13:55:30] <dbaupp> pnkfelix: is there much of a use-case for pluggable GCs?
[13:55:58] <pnkfelix> dbaupp: (Well, I guess you could do a copy-on-write scheme to make copies of the TyDesc each time you created a task with a GC different from its parent)
[13:56:12] <pnkfelix> dbaupp: "copy-on-write" was poor word choice.
[13:56:18] <pnkfelix> dbaupp: just "copying"
[13:57:06] <pnkfelix> dbaupp: I don't know whether a pluggable GC is a good idea or not.  It sounds *interesting*, but I don't know if we can make something that's pluggable and sufficiently-flexible-to-be-of-interest and competive.
[13:57:55] <pnkfelix> dbaupp: (e.g. as soon as you want to do stuff like generational and/or incremental, you need write barriers, i.e. compiler integration of some form)
[13:58:12] <pnkfelix> sed -e s/competive/competitive/
[13:58:49] <dbaupp> pnkfelix: we could have a Collector trait, and then each task stores a ~Collector object, and the various write barriers and so on become (virtual :( ) calls into that
[13:59:00] <pnkfelix> dbaupp: Anyway, I'm not so hung up on the breakdown of whether we attach tracers to the TyDescs or stash it elsewhere.
[13:59:04] <dbaupp> those things that don't need the barriers just have a no-op implementation
[13:59:13] <dbaupp> but... virtual calls may kill it
[13:59:25] <pnkfelix> Yeah, I think virtual calls for all write-barriers are a non-starter
[14:00:13] <pnkfelix> dbaupp: More realistically would be something where you have an inlined portion of the write barrier that everybody agrees on that guards the virtual call.
[14:00:38] <dbaupp> pnkfelix: Tracing will need compiler integration of some sort, to allow library data structures to store GC objects without having to require that they can *only* store Trace objects (where Trace is the trait that provides tracing)
[14:01:05] <pnkfelix> dbaupp: yes I've always assumed that there would be some compiler integration.
[14:01:06] <dbaupp> pnkfelix: yeah, I think I discussed with someone (you?) that we could use struct inheritance of some sort to possibly handle that
[14:01:40] <pnkfelix> dbaupp: While we're talking
[14:01:56] <pnkfelix> dbaupp: Is this a project you're interested in working on longer term?
[14:02:31] <dbaupp> pnkfelix: I am interested
[14:02:37] <pnkfelix> dbaupp: I like the idea of having a partner on this task.
[14:02:50] <pnkfelix> dbaupp: Okay good.  I think that will make brson happy.
[14:02:57] <dbaupp> but uni semester starts at the end of february so I'll have fewer cycles to dedicated to the task then.
[14:03:11] <pnkfelix> dbaupp: Okay, understood.  Hmm.  When at the end of february?
[14:03:16] <pnkfelix> dbaupp: (i.e., what day?)
[14:03:29] <dbaupp> give me a sec
[14:03:59] <dbaupp> pnkfelix: my lectures start on 3 March
[14:04:10] <pnkfelix> dbaupp: Oh okay, so beginning of march then.  Great.
[14:04:41] <cmr> acrichto: still want me to get profiles?
[14:04:42] <dbaupp> but I may be distracted from the 24th or so (not compulsorily though)
[14:04:54] <pnkfelix> dbaupp: okay.  Good to know.
[14:05:23] <pnkfelix> dbaupp: Discussions with you and pcwalton last week regarding Boehm inspired me to try to integrate it into the build
[14:05:30] <dbaupp> pnkfelix: (and I'm semi-occupied for the next 3 weeks... sorry for all the caveats)
[14:05:38] <dbaupp> oooh, and?
[14:05:44] <pnkfelix> dbaupp: I don't have much to report yet
[14:05:57] <pnkfelix> dbaupp: The big point is, I'm not going to get hung up on trying to make it work in task-local mode
[14:06:07] <pnkfelix> dbaupp: Rather, I think it would be good to have a way to compile BDW in
[14:06:11] <eddyb> should I git blame on that unneeded mut self I've found?
[14:06:12] <pnkfelix> dbaupp: As a sanity check
[14:06:21] <dbaupp> ah, just let it stop the whole executable like it would in C?
[14:06:24] <pnkfelix> dbaupp: Right
[14:06:30] <pnkfelix> dbaupp: The idea would be
[14:06:40] <pnkfelix> dbaupp: Just to sanity-check that the performance of whatever we come up with
[14:06:54] <pnkfelix> dbaupp: Is actually able to compete with the end-to-end performance of BDW
[14:07:33] <dbaupp> pnkfelix: we would be expecting to be able to significantly out-perform BDW in our "final" GC, right?
[14:07:39] <pnkfelix> dbaupp: And then after that, we can consider trying to hack BDW into supporting task-local GC.  But honestly I suspect I would rather invest time into making a GC written in Rust work.
[14:07:44] <dbaupp> (given we have far more information about it.)
[14:07:50] <dbaupp> s/it/pointers/
[14:07:54] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[14:08:18] <pnkfelix> dbaupp: I would hope so.  But I've heard that Boehm has a precise mode where you can feed it ptrmap info?
[14:08:19] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[14:08:23] <dbaupp> pnkfelix: yeah, I think pcwalton said that the trie that BDW uses is state-of-the-art
[14:08:36] <pnkfelix> dbaupp: Yes he's mentioned that to me as well
[14:08:39] <cmr> steal it \o/
[14:08:40] <dbaupp> pnkfelix: it has http://www.hpl.hp.com/personal/Hans_Boehm/gc/gc_source/gc_typedh.txt
[14:08:48] <dbaupp> cmr: hard to implement, aiui
[14:08:55] <cmr> steal it anyway \o/
[14:09:06] <dbaupp> pnkfelix: which just lets you specific which words can possibly contain pointers and which definitely don't
[14:09:38] <dbaupp> *specify
[14:10:35] <dbaupp> I think by boehm bindings include support for that
[14:10:38] <dbaupp> *my
[14:10:44] <dbaupp> not sure if I pushed it or not.
[14:11:35] <dbaupp> ah, yes, I did.
[14:11:47] <pnkfelix> dbaupp: Okay well now we've gone past your 30min threshold.  :)
[14:11:59] <dbaupp> heh
[14:12:22] <dbaupp> thanks for the review; I'll get to the collection policy tomorrow hopefully.
[14:13:01] <pnkfelix> dbaupp: Maybe start by making a microbenchmark, try to expose the quadratic blowup
[14:13:39] <pnkfelix> dbaupp: (Though there might be other ways that it blows up that a load-factor based policy won't fix)
[14:14:03] <dbaupp> I think I've actually noticed my benchmarks are quadratic, without actually thinking about why they'd be doing that.
[14:14:29] <pnkfelix> dbaupp: I just remembered an exact instance where I made this exact mistake
[14:14:59] <pnkfelix> dbaupp: If I find a link to a record for it I'll jot it to you.
[14:17:20] <dbaupp> pnkfelix: heh
[14:17:59] <dbaupp> pnkfelix: anyway, I've actually got go; catch you tomorrow (maybe).
[14:18:14] <pnkfelix> dbaupp: k, later.  Thanks for the chat.
[14:26:06] *** Quits: sigma (sigma@moz-9EAC972C.range86-184.btcentralplus.com) (Client exited)
[14:26:14] *** Joins: sigma (sigma@moz-9EAC972C.range86-184.btcentralplus.com)
[14:26:19] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[14:27:51] *** Joins: gwty (gwtypc@6DBFAC54.62E8A8A5.137C914F.IP)
[14:28:03] *** Joins: gwty_ (gwtypc@6DBFAC54.62E8A8A5.137C914F.IP)
[14:37:15] <pnkfelix> (for people interested, the "exact instance of this mistake" I mentioned above was this: https://github.com/larcenists/larceny/issues/119 )
[14:37:41] <pnkfelix> (though that discussion on that ticket is ... very steeped in its own context.)
[14:40:31] *** Joins: glaebhoerl (glaebhoerl@moz-3590251D.kabelnet.hu)
[14:40:42] <eddyb> Load(entry_bcx, C_null(Type::i8p())); llvm::LLVMGetFirstInstruction(entry_bcx.llbb)
[14:40:48] <eddyb> LOL what a nasty trick
[14:40:57] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[14:41:37] <eddyb> inserting a dummy instruction just to move allocas to the top scope
[14:48:03] <eddyb> aaaand I was dumb, I can't avoid cells
[15:10:02] <eddyb> (creating the entry block takes a borrow of FunctionContext, so I can't have any &mut borrows at the same time - but most of the mutation with those cells happens at the creation of FunctionContext)
[15:10:07] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[15:14:48] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[15:15:03] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[15:29:31] <eddyb> nmatsakis: any chance you have time to look at my deletions from the largely unmaintained typeck docs? https://github.com/mozilla/rust/pull/11485
[15:32:56] *** kimundi is now known as zz_kimundi
[15:33:05] <eddyb> I'm close to bootstrapping and then I have to implement closure wrappers for bare fns. what a joy
[15:35:40] <eddyb> nmatsakis: would you mind if I unify vstore and trait_store into something like UnsizedStore?
[15:36:51] <eddyb> I'd like to move the mutability into the borrowed variant (right now ~mut str, ~[mut T] and ~mut Trait are possible :P)
[15:41:13] <nmatsakis> eddyb: I can take a look at that PR, yes.
[15:41:54] <eddyb> and of course there's the variadic stuff that we haven't talked about for weeks, feeling less confident that I'll be able to pull it off for 1.0
[15:41:54] <nmatsakis> eddyb: regarding the merging of vstore etc, there is definitely some deferred cleanup of the types
[15:42:32] <nmatsakis> eddyb: my feeling is that we have too many new features planned for 1.0 as is,
[15:42:48] <eddyb> and too much old code to refactor
[15:42:49] <nmatsakis> eddyb: and I want to wait until dust has settled before we discuss new features.
[15:42:57] <nmatsakis> still more unknowns than I would like
[15:43:09] <nmatsakis> I had planned to bring this up at the meeting this week
[15:43:26] <nmatsakis> (obviously this is not specific to the variadic stuff)
[15:44:42] <nmatsakis> (also, not to say we shouldn't continue to discuss design for variadics -- ok, g2g for a bit)
[15:54:44] <eddyb> Type::func([Type::nil().ptr_to(), t], &Type::void())
[15:55:00] <eddyb> oh, that's why it's screwing up
[16:04:20] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[16:11:03] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[16:12:15] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[16:15:47] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[16:15:47] *** ChanServ sets mode: +ao dherman dherman
[16:29:08] <eddyb> I so wish match x { UpperCamelCase => ..., _ => ... } would give me a suggestion about UpperCamelCase not being in scope, it's annoying that I have to remember that it's treated as a binding
[16:35:40] <eddyb> I think only astconv cares about the contents of ExplicitSelf anymore
[16:36:01] <eddyb> (well, there's the SelfStatic/others distinction, which is slightly more important than the type)
[16:36:20] <pnkfelix> eddyb: That's https://github.com/mozilla/rust/issues/10304
[16:36:38] <pnkfelix> eddyb: (the match thing)
[16:49:15] *** Joins: jdm (jdm@FCCEA34F.7672369.D8E68FF6.IP)
[16:51:24] *** Quits: jdm (jdm@FCCEA34F.7672369.D8E68FF6.IP) (Ping timeout)
[16:52:04] *** Joins: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP)
[16:52:21] *** Quits: glaebhoerl (glaebhoerl@moz-3590251D.kabelnet.hu) (Ping timeout)
[16:55:42] *** Joins: doener (doener@moz-C68F600D.unity-media.net)
[16:57:10] *** Quits: Kxepal (Miranda@moz-49BF091C.pppoe.mtu-net.ru) (Ping timeout)
[17:02:25] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[17:05:47] <acrichto> cmr: ah it's ok, I ended up benching myself and we're much faster with RUST_THREADS=1 so I think this just needs scheduler tuning
[17:08:16] *** Joins: Kxepal (Miranda@moz-2D7B8971.pppoe.mtu-net.ru)
[17:09:58] *** zz_kimundi is now known as kimundi
[17:21:43] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[17:21:43] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/oseYJA
[17:21:43] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[17:21:50] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[17:21:50] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/H5Ka6A
[17:21:50] <ghrust> 13rust/06auto 14e25d706 15Huon Wilson: rustc: make error messages containing generic more self-explanatory....
[17:21:50] <ghrust> 13rust/06auto 14b97ace2 15bors: auto merge of #11513 : huonw/rust/generic-errs, r=alexcrichton...
[17:21:50] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[17:22:03] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Client exited)
[17:22:24] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[17:24:06] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Ping timeout)
[17:29:43] <doener> am I missing something or is it weird that LLVM didn't eliminate that branch? https://gist.github.com/dotdash/8404275
[17:30:14] <acrichto> is that optimized IR?
[17:30:19] <doener> yes
[17:30:33] <acrichto> it does kinda depend on the aliasing guarantees of %1 and %5
[17:30:34] <doener> from "rustc --emit-llvm -S --opt-level 3"
[17:30:49] <acrichto> or maybe it's not smart enough to see that they're both 3?
[17:30:52] <acrichto> that's... weird.
[17:31:03] <acrichto> what are %1 and %5?
[17:31:06] <acrichto> alloca slots/
[17:31:07] <acrichto> ?
[17:31:33] <doener> updated to include the start of the function
[17:31:50] <eddyb> doener: --opt-level=3?
[17:31:51] <doener> it's from: let mut x = ~3; assert_eq!(*x, 3);
[17:32:04] <eddyb> also, run through c++filt to get nicer symbols
[17:32:34] <eddyb> what's weird is the load from %5 not being optimized, but it makes sense because it's malloc
[17:32:47] <eddyb> doener: run with -Z lto
[17:33:17] <acrichto> doener: in the past I think we've seen that bitcasts essentially turn off optimizations in some cases, so maybe that's coming into play?
[17:33:35] <eddyb> maybe we should mark malloc_raw with #[inline]
[17:33:37] <acrichto> doener: what happens if you reorder the load before the store into %1?
[17:34:16] <eddyb> acrichto: I think it can't prove a dead store because it doesn't know anything about malloc
[17:34:31] <doener> eddyb: -Z lto makes the filesize go through the roof and I can't find the relevant bits ;-)
[17:34:45] <acrichto> that shouldn't have anything to do with malloc though b/c everything happens after allocation of the box
[17:34:52] <eddyb> doener: -o /dev/stdout | c++filt | less and then use / to find the function
[17:35:13] <eddyb> acrichto: inlining malloc_raw is cheating because LLVM knows malloc doesn't alias and can remove calls to it
[17:36:01] <eddyb> maybe we should mark calls to an exchange_malloc lang item with noalias
[17:36:01] <acrichto> seems weird that it would think it would alias when the malloc function couldn't possibly have access to any local variables
[17:36:45] <doener> eddyb: ah, sorry, have been looking at the wrong "main" function. Branch is gone with -Z lto
[17:36:57] <eddyb> doener: is the malloc call gone?
[17:37:01] <doener> no
[17:37:05] <acrichto> eddyb: appears you're right!
[17:37:11] <acrichto> aliasing is crazy
[17:37:30] <eddyb> acrichto: I learnt from the best (i.e. payed attention to strcat's rambling)
[17:37:33] <doener> eddyb: added the llvm output as a comment to the gist
[17:38:08] <acrichto> whoa, I thought abort() was flagged as noreturn
[17:38:11] <doener> eddyb: well, malloc_raw is gone, it's directly calling malloc now
[17:38:37] <acrichto> doener: if you look for the declaration of @malloc, what does it have in terms of attributes?
[17:38:58] <doener> declare noalias %"enum.std::libc::types::common::c95::c_void[#1]"* @malloc(i64) unnamed_addr #0
[17:39:12] *** Joins: tikue (tkuehn@268C2DFE.FAD414BA.D74CC41D.IP)
[17:39:13] <acrichto> does #0 contain anything interesting?
[17:39:21] <doener> nounwind
[17:39:22] <eddyb> acrichto: yeah, that's interesting. Rust also doesn't output code for ty_bot
[17:39:37] <acrichto> eddyb: oh wait it's libc::abort which we don't flag specifically
[17:39:40] <acrichto> (I think)
[17:39:47] <eddyb> fixit
[17:40:00] <acrichto> also, wasn't there discussion awhile back that anything returning ~T could be noalias?
[17:40:00] <eddyb> I've seen this kind of bloat before
[17:40:15] <eddyb> acrichto: some of ~T are noalias, others aren't
[17:40:24] <acrichto> which one's aren't?
[17:40:32] <eddyb> ~[T] (in some places) is noalias, ~str isn't noalias
[17:40:44] <acrichto> how can two ~str alias?
[17:40:50] <eddyb> I saw it recently, someone forgot several cases
[17:40:53] <doener> acrichto: reordering the stores helps
[17:41:06] <acrichto> doener: I guess that confirms that this is an aliasing issue
[17:41:08] <eddyb> acrichto: nah, I mean, the trans code handling that is incomplete
[17:41:24] <acrichto> eddyb: how so? (just curious)
[17:41:30] <eddyb> doesn't help that the lang item isn't marked as noalias as it returns *u8 IIRC
[17:41:35] <doener> acrichto: unaligned aliasing even, right? Since both stores write the same value
[17:41:55] <eddyb> acrichto: I haven't looked at it in detail. I know it doesn't handle ~str, but there's probably more missing
[17:41:59] <acrichto> doener: LLVM may not be that smart (to see the same value was stored in both locations which could possibly alias)
[17:42:09] <doener> hm, wait, there's an alignment given for the store...
[17:42:24] <acrichto> eddyb: that's unfortunate... although the lang item sounds like it could definitely be flagged as noalias
[17:42:35] <eddyb> why doesn't it dead-store-remove the malloc/free nonsense?
[17:42:50] <eddyb> because of the posibility to abort?
[17:42:57] <eddyb> that sounds like a downer
[17:44:02] <eddyb> fn main(){~5;} should optimize to ret void, can someone check and open a bug report if so?
[17:44:17] <acrichto> eddyb: not necessarily, that would be changing behavior
[17:44:23] <doener> eddyb: removing the @abort call doesn't make it remove the malloc/free pair
[17:44:24] <eddyb> (I don't even have a working compiler. oh, look, it's segfaulting now)
[17:44:27] <acrichto> that says "abort the process if I'm OOM"
[17:44:34] <eddyb> doener: ouch, that's bad
[17:44:44] <eddyb> acrichto: writing to a NULL ptr would crash the process
[17:44:54] <acrichto> not through abort though
[17:44:54] <eddyb> LLVM is supposed to be able to do this
[17:45:00] <acrichto> really?
[17:45:03] *** Quits: tikue (tkuehn@268C2DFE.FAD414BA.D74CC41D.IP) (Quit: tikue)
[17:45:24] <eddyb> there's an example on our wiki showing off dead-store elimination *with LTO across C and Rust*
[17:46:27] <doener> eddyb: added the @abort-less version to the gist
[17:46:46] <eddyb> doener: it still does a branch
[17:46:56] <doener> in case that malloc fails
[17:47:01] <acrichto> a little terrifying that you store before you check?
[17:47:12] <eddyb> free(NULL) is noop AFAIK
[17:47:30] <doener> yep
[17:47:48] <eddyb> doener: does it remove the whole function body without that branch?
[17:48:15] <eddyb> acrichto: maybe we should test that potential optimization and see if it does any good
[17:48:27] <doener> acrichto: ignore the store, that's just me being stupid when modifying the code. It's from the branch where @abort was called
[17:48:41] <eddyb> sure, it's not the sanest thing to do in production - but what if it's safe?
[17:50:11] <eddyb> what do we have so far? abort() -> ! and noalias exchange_malloc
[17:50:14] <doener> eddyb: no, still calls @malloc and @free (added to the gist)
[17:50:36] <eddyb> maybe it doesn't recognize them
[17:50:44] <acrichto> hm, that may be the bitcast
[17:50:51] <eddyb> acrichto: it's required
[17:51:07] <acrichto> as in the bitcast is turning off the optimization
[17:51:13] <doener> removed the store as well, ends up as "call @malloc; call @free; ret"
[17:51:19] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[17:51:19] <acrichto> https://gist.github.com/8404727
[17:51:23] <doener> no bitcast remains
[17:51:23] <acrichto> that optimizes to nothing
[17:51:31] <acrichto> that's bad
[17:51:42] <acrichto> is llvm not recognizing our malloc/free?!
[17:51:45] <eddyb> so our declarations are bad?
[17:51:48] <eddyb> gg
[17:51:58] <acrichto> doener: try changing everything to i8?
[17:52:04] <eddyb> acrichto: {}* vs i8*, of course
[17:52:05] <acrichto> that's what I did and it appeard to work
[17:52:07] <doener> already on it
[17:52:13] *** Quits: pauls (pauls@moz-7140CF01.ccs.neu.edu) (Ping timeout)
[17:53:24] <eddyb> acrichto: what does clang output?
[17:53:35] <eddyb> in terms of LLVM IR declarations for malloc/free
[17:54:12] <acrichto> declare void @free(i8*)
[17:54:16] <acrichto> declare i8* @malloc(i64)
[17:54:29] *** Quits: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[17:54:31] <acrichto> define i32 @main() nounwind readnone ssp uwtable
[17:54:32] <eddyb> there we go, std::libc is wrong
[17:54:32] <acrichto> fancy
[17:56:12] <eddyb> acrichto: can you check whether some simple run-pass tests are compiled to ret void?
[17:56:18] <eddyb> that would be a really cool trick
[17:56:41] <acrichto> dunno, "simple" is probably tough to reason about sometimes
[17:56:48] <eddyb> (with the above mentioned changes to std::libc and our intrinsics)
[17:57:03] <eddyb> acrichto: heap allocation but no side effects on success
[17:57:10] <eddyb> (i.e. no debug output, just asserts)
[17:59:36] <doener> yeah, changing void to "type i8" gives an empty main 
[17:59:40] <doener> just ret void
[17:59:41] *** Joins: glaebhoerl (glaebhoerl@3391DE98.E9231B2.A0179ACD.IP)
[18:00:39] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[18:00:39] *** ChanServ sets mode: +ao pcwalton pcwalton
[18:00:39] <doener> changing enum.std::lib::...::c_void that is
[18:00:58] <eddyb> doener: the malloc/free definitions are wrong, not c_void
[18:01:03] *** Quits: nuts (tii@822A8E7E.6AD15BF5.75D3BBDB.IP) (Ping timeout)
[18:01:14] <eddyb> I'm amazed this hasn't visiblity bitten us before
[18:01:27] <eddyb> and the code generated on the abort branch - it's ridiculous
[18:02:23] <doener> eddyb: changing the type was easier than adjusting the 5000 uses of c_void in that .ll file ;-)
[18:02:38] <eddyb> riiight
[18:02:40] *** Joins: glaebhoer1 (glaebhoerl@3391DE98.E9231B2.A0179ACD.IP)
[18:03:13] *** Quits: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net) (Quit: Sharp)
[18:03:26] *** Quits: glaebhoerl (glaebhoerl@3391DE98.E9231B2.A0179ACD.IP) (Ping timeout)
[18:03:28] <eddyb> doener: src/libstd/libc.rs, malloc, free and abort - I think you should be able to use the stage0 compiler to avoid rebuilding rustc just for those changes
[18:04:23] <eddyb> now... is it faster to optimize tests to a noop or to run them? oh I'm just being silly
[18:05:31] *** Joins: ninechars (glaebhoerl@3391DE98.E9231B2.A0179ACD.IP)
[18:06:25] *** Quits: glaebhoer1 (glaebhoerl@3391DE98.E9231B2.A0179ACD.IP) (Ping timeout)
[18:08:24] *** Joins: pauls (pauls@moz-7140CF01.ccs.neu.edu)
[18:09:25] <doener> eddyb: hm, C void is represented as i8* by clang though, and malloc should return void*... 
[18:09:30] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:09:30] *** ChanServ sets mode: +qo brson brson
[18:09:43] <eddyb> doener: that's interesting...
[18:09:46] *** Quits: sigma (sigma@moz-9EAC972C.range86-184.btcentralplus.com) (Client exited)
[18:09:47] <acrichto> that's surprising
[18:09:52] <doener> err, void* that is, not void
[18:10:05] <acrichto> maybe void should be a lang item
[18:10:36] <eddyb> #[repr(u8)]?
[18:10:42] <ninechars> didn't catch the beginning of this, but I still maintain that C's void is our ()...
[18:10:46] *** ninechars is now known as glaebhoerl
[18:10:59] <acrichto> semantically, not according to llvm though
[18:11:12] <eddyb> why is void not LLVM void or {}?
[18:11:41] <eddyb> is there a clang design decision for this?
[18:11:42] <doener> for clang: void = void, void* = i8*
[18:11:50] <doener> can we handle that at all?
[18:12:17] <eddyb> you can't have void in another type, which means there's no reason to optimize the non-pointer version
[18:12:59] <eddyb> you can't construct c_void which means it can be u8, so pointers to it have nicer types
[18:13:20] <eddyb> I don't know, I should get back to my messy job
[18:13:54] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Input/output error)
[18:16:53] <eddyb> I wish I had a snapshot so I can see the debug info from my previous trans changes
[18:22:18] *** Quits: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz)
[18:24:56] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[18:26:08] *** Joins: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net)
[18:29:57] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[18:29:57] *** ChanServ sets mode: +o tjc
[18:30:14] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Client exited)
[18:31:58] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[18:31:58] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/H5Ka6A
[18:31:58] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[18:34:40] <doener> hm, strange abort has return type bottom, but has no noreturn flag
[18:34:50] <doener> same for @exit...
[18:36:48] <eddyb> decl_rust_fn checks for ty_bot
[18:36:52] <doener> seems that we're not setting noreturn for extern functions
[18:37:09] <acrichto> yeah :(
[18:38:19] <doener> c_void has a comment on it, that it should only be used for pointers, so I'm changing that to i8 just to test it
[18:38:34] <eddyb> ok, so the check should move from decl_rust_fn to decl_fn
[18:38:42] <Eridius> doener: I thought a ! return type implied noreturn?
[18:38:55] <eddyb> Eridius: the check is in a rust-specific function
[18:39:00] <doener> Eridius: only for rust functions, not externs
[18:39:21] <eddyb> it's relatively easy to move it, just need to add the return type to decl_fn's arguments and move the check there
[18:39:22] <doener> fn bot() -> ! {} <<== gets noreturn, extern { fn bla() -> !; } <<== doesn't
[18:39:30] *** Joins: rca_ (rcatolino@moz-1D2195F3.adsl.proxad.net)
[18:39:36] <Eridius> eddyb: curious
[18:39:44] <eddyb> I know how to fix this, but I'd rather not have *another* pending PR while I'm working on this one :P
[18:40:06] <doener> eddyb: I'll try to get that fixed when the c_void one is done compiling
[18:40:09] *** Quits: rca (rcatolino@moz-5C941ACC.adsl.proxad.net) (Ping timeout)
[18:40:11] <eddyb> doener: cool :D
[18:40:27] <eddyb> (don't wait for rustc to compile with c_void, test with stage0)
[18:40:59] <doener> I need to compile that one, don't I?
[18:41:17] <eddyb> doener: make rustc-stage1, stop it when it starts compiling libsyntax
[18:41:46] <eddyb> then run ./x*/stage0/bin/rustc --emit-llvm -S -o /dev/stdout and whatever other flags you need
[18:41:46] *** Quits: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz)
[18:42:03] <eddyb> ./i* if it's ia32
[18:42:10] <doener> I plan on just letting it run, so I can run "make test" afterwards (unless it breaks horribly early on)
[18:42:25] <eddyb> oh, okay, don't mind me then
[18:42:31] <doener> (i.e. do the above early, but let it run)
[18:42:50] <doener> thanks anyway
[18:42:54] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[18:43:03] <eddyb> you can run make check-stage1, but I'm not sure if it works (might need a new snapshot)
[18:45:25] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[18:45:25] *** ChanServ sets mode: +o tjc
[18:46:56] <doener> this is... interesting? https://gist.github.com/dotdash/8405757
[18:47:22] <doener> with --opt-level 3 -Z lto
[18:48:20] <eddyb> it's not removing the allocas?
[18:48:39] <eddyb> doener: can you run opt -O 3 on that?
[18:49:54] <doener> doesn't like the input file :-(
[18:50:45] <doener> error added to the gist
[18:53:00] *** Quits: blank_name (blank_name@29F64526.16360A46.537E532E.IP) (Quit: leaving)
[18:53:01] <eddyb> doener: keep just the function
[18:53:09] <eddyb> and the defintions of those two types it mentions
[18:53:16] <eddyb> and maybe a few other things
[18:56:17] *** Joins: blank_name (blank_name@29F64526.16360A46.537E532E.IP)
[18:57:10] <doener> eddyb: results in an empty module 
[18:57:15] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[18:57:26] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[18:57:47] <eddyb> doener: remove "internal" from the main function
[18:57:57] <doener> just "ret void" remains
[18:59:20] <eddyb> okay, so LTO doesn't optimize again, interesting
[19:00:17] <eddyb> makes you wonder how much -Z lto could actually strip if it ran all the optimizations afterwards
[19:03:14] <jack> acrichto: is there a fix for https://github.com/mozilla/rust/issues/11162 yet?
[19:03:19] <jack> i just ran into it trying to build servo
[19:03:26] <acrichto> jack: no
[19:03:49] *** Quits: c74d (c74d@moz-E2EAC718.oc.oc.cox.net) (Ping timeout)
[19:05:12] *** Joins: Fatalnix (bhodgins@moz-1F0BEDCC.static.gwi.net)
[19:06:42] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[19:06:42] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/zgzxgA
[19:06:42] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[19:06:42] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[19:06:43] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/BPYx5A
[19:06:43] <ghrust> 13rust/06auto 14c74c854 15Florian Hahn: Better error message for semicolon on the last line of a function...
[19:06:43] <ghrust> 13rust/06auto 14b8c60f9 15bors: auto merge of #11482 : fhahn/rust/issue-8005-better-error-msg-semi-last-stmt, r=alexcrichton...
[19:06:43] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[19:07:04] <jack> acrichto: oddly, make clean && make seems to have resolved it.
[19:07:26] <acrichto> jack: hm interesting, I wouldn't expect that...
[19:07:48] <jack> i got it bulding servo not rust too.
[19:09:11] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Client exited)
[19:09:32] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[19:10:46] *** Joins: deens_ (deens@moz-A47475CE.hsd1.ca.comcast.net)
[19:10:51] <Fatalnix> bstrie sent me here I guess to wonder about ways to build a plugin system that dynamically loads code at runtime, without knowlege at compile time. Anyone happen to have any ideas about that?
[19:11:02] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Connection reset by peer)
[19:12:27] <sfackler> Fatalnix: check out std::unstable::dynamic_lib
[19:13:11] <Fatalnix> sfackler: Well that sounds promising, thanks!
[19:13:42] <Fatalnix> I wonder just how unsafe it is...
[19:13:53] <Fatalnix> :D
[19:14:04] <sfackler> just about as unsafe as a normal dlopen, dlsym would be
[19:16:46] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[19:16:49] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[19:16:50] *** ChanServ sets mode: +qo brson brson
[19:17:22] *** Joins: c74d (c74d@moz-E2EAC718.oc.oc.cox.net)
[19:17:28] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[19:17:45] <eddyb> Store i8 (i32)* -> i8 ({ i64, %tydesc*, i8*, i8*, i8 }*, i32)**
[19:17:58] <eddyb> that is the part where I have to invent closure wrapper for bare fns
[19:18:02] <eddyb> *wrappers
[19:19:52] <eddyb> how convenient, trans::expr::add_env
[19:31:04] *** jdm is now known as jdm|f00ding
[19:47:02] *** Quits: glaebhoerl (glaebhoerl@3391DE98.E9231B2.A0179ACD.IP) (Ping timeout)
[19:52:11] *** Joins: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP)
[19:54:37] *** jdm|f00ding is now known as jdm
[19:55:07] <cmr> gahhh I lost my patch.
[19:55:26] <doener> hm?
[19:55:43] <cmr> I had an @str/@[] removal patch, and I can't find it :(
[19:56:08] <eddyb> hah
[19:56:20] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[19:56:23] <eddyb> cmr: it would be useful if you can remove @Trait, also
[19:56:31] <benh> A .patch file or a git branch?
[19:56:34] <cmr> eddyb: out ofscope
[19:56:38] <cmr> benh: branch
[19:57:00] <benh> tried those git reflog shenanigans etc?
[19:57:32] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[19:57:35] <eddyb> cmr: not really, see my comment above about UnsizedStore
[19:58:07] <cmr> eddyb: it really is, I'm not touching trans.
[19:58:42] <eddyb> cmr: I would like to unify some of the handling of trait/vec/str "store modes" in the compiler
[19:58:54] <eddyb> which means I would have to remove @Trait myself
[19:58:56] <cmr> benh: the problem is that I have 4 different workspaces, and I recently rebuilt one of them because it got FUBAR
[19:59:13] <cmr> aha
[19:59:16] <benh> aw
[19:59:24] <cmr> https://github.com/cmr/rust/tree/issue-2243
[19:59:29] <cmr> \o/
[20:00:08] <eddyb> cmr: vstore and trait_store FYI
[20:00:41] <eddyb> though DST might just come and get rid of that whole nonsense
[20:04:06] *** Quits: doener (doener@moz-C68F600D.unity-media.net) (Quit: leaving)
[20:06:33] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[20:06:36] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[20:08:03] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:11:28] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[20:11:28] *** ChanServ sets mode: +qo brson brson
[20:13:21] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[20:13:55] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[20:17:15] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[20:24:39] <nmatsakis> woohoo, my branch for temporaries bootstraps.
[20:24:50] <nmatsakis> (and passes run-pass/compile-fail)
[20:25:15] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[20:25:19] <nmatsakis> now just gotta rebase (ugh), write some comments... 
[20:26:37] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[20:26:38] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/BPYx5A
[20:26:38] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[20:32:19] <eddyb> nmatsakis: I hope you won't change much of the overlapping area, because I changed most of those things again
[20:41:48] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[20:48:49] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Ping timeout)
[20:49:33] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[20:53:21] *** Joins: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[20:53:21] *** ChanServ sets mode: +ao pcwalton pcwalton
[21:02:24] *** Quits: deens_ (deens@moz-A47475CE.hsd1.ca.comcast.net) (Client exited)
[21:02:46] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[21:04:31] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Ping timeout)
[21:11:29] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[21:11:52] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[21:13:00] <nmatsakis> brson: I saw it, I'll take a closer look
[21:13:48] <nmatsakis> brson: exciting to see progress in that area
[21:15:53] <brson> r? https://github.com/mozilla/rust/pull/11518
[21:16:09] <brson> bors has nothing to work on right now
[21:16:57] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[21:17:02] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[21:17:17] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[21:17:17] *** ChanServ sets mode: +ao dherman dherman
[21:17:20] <acrichto> brson: these test failures are sounding like libnative just doesn't work on android at all
[21:18:43] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[21:19:12] *** Quits: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz)
[21:19:50] <eddyb> good night now, closure wrappers for bare fns next morning :D
[21:21:40] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[21:21:40] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/TzO9Hw
[21:21:40] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[21:22:15] <acrichto> zomg dead_code just saved me again
[21:22:17] <acrichto> I love this lint
[21:22:37] <brson> acrichto: seems possible, yes
[21:22:45] <eddyb> acrichto: I found an unneeded mut self in std::io, did I tell you about it?
[21:22:52] <acrichto> eddyb: where at?
[21:23:00] <acrichto> brson: you wouldn't happen to have backtraces would you?
[21:23:32] <eddyb> acrichto: BufferedSomething, pub fn unwrap(mut self) -> W { self.inner.unwrap() }
[21:23:33] <brson> acrichto: no, i haven't learned how to debug android yet
[21:23:41] <acrichto> brson: mk, no worries
[21:23:47] <acrichto> eddyb: looks unnecessary to me!
[21:24:02] <acrichto> eddyb: although hm I wonder why the compiler isn't catching that
[21:24:10] <eddyb> acrichto: that's the only one though. new accidental lint, liveness needed special code for ignoring unused self (can't ignore self)
[21:24:31] <eddyb> but I left it run unneeded mut for self, since that's not required to match the trait
[21:24:39] <eddyb> acrichto: because self wasn't an argument :)
[21:24:58] <eddyb> before I made it so and brought rainbows to this world and saved the princess
[21:25:05] <eddyb> wait, that was another cast- I mean, story
[21:25:06] <acrichto> hm we need to fix that then
[21:25:27] <eddyb> fix the mut if you want to, the rest is close to bootstrap
[21:25:38] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[21:25:38] *** ChanServ sets mode: +o tjc
[21:26:00] <eddyb> acrichto: see above my "good night" line, just one item missing
[21:26:06] <eddyb> I'll sleep now if you don't mind that
[21:26:11] <acrichto> hehe
[21:28:51] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[21:32:27] <acrichto> wishing we had libcomm right about now
[21:36:42] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Ping timeout)
[21:36:49] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[21:38:09] <acrichto> <3 libnative backtraces
[21:39:22] *** Quits: c74d (c74d@moz-E2EAC718.oc.oc.cox.net) (Ping timeout)
[21:39:54] *** Quits: doomlord_ (servitor@moz-CA917A47.range86-184.btcentralplus.com) (Ping timeout)
[21:40:00] *** Joins: c74d (c74d@moz-E2EAC718.oc.oc.cox.net)
[21:50:35] *** Quits: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz)
[21:52:01] *** Quits: dbaupp (Thunderbir@moz-6002BAEA.lns20.syd6.internode.on.net) (Ping timeout)
[21:52:40] <jdm> what's the envvar to control simultaneous tests?
[21:52:43] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[21:54:10] <acrichto> jdm: RUST_TEST_TASKS
[21:54:35] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[21:56:27] <jdm> thanks
[22:00:14] *** Quits: Fatalnix (bhodgins@moz-1F0BEDCC.static.gwi.net) (Quit: Lost terminal)
[22:04:14] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Client exited)
[22:04:35] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[22:06:20] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Ping timeout)
[22:11:38] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[22:11:52] *** Quits: gwty_ (gwtypc@6DBFAC54.62E8A8A5.137C914F.IP) (Connection reset by peer)
[22:11:54] *** Quits: gwty (gwtypc@6DBFAC54.62E8A8A5.137C914F.IP) (Connection reset by peer)
[22:14:51] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[22:14:52] *** ChanServ sets mode: +ao dherman dherman
[22:15:09] *** Joins: gwty (gwtypc@3D97BDC1.C4000CA7.137C914F.IP)
[22:15:20] *** Joins: gwty_ (gwtypc@3D97BDC1.C4000CA7.137C914F.IP)
[22:19:02] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[22:19:05] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Client exited)
[22:25:08] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[22:25:13] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[22:25:13] *** ChanServ sets mode: +ao dherman dherman
[22:26:14] *** Quits: rca_ (rcatolino@moz-1D2195F3.adsl.proxad.net) (Ping timeout)
[22:37:35] <acrichto> brson: r? https://github.com/mozilla/rust/pull/11112
[22:38:07] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[22:38:29] <brson> acrichto: did you get a review on the channel upgrade patch?
[22:38:36] <brson> i think i've been ignoring it
[22:38:51] <acrichto> haven't put one up just yet (but just finished implementing it!)
[22:38:54] <acrichto> there's a few others though
[22:38:55] <brson> so many prs that need to get r+ed
[22:38:59] <acrichto> :(
[22:39:04] <acrichto> it went below 40 yesterday
[22:39:07] <acrichto> and then it went back up...
[22:39:22] <acrichto> brson: also https://github.com/mozilla/rust/pull/11413
[22:39:26] <acrichto> (neither have upgrades)
[22:41:36] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[22:41:37] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/fBN4lQ
[22:41:37] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[22:46:37] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[22:46:37] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/HJBKQg
[22:46:37] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[22:46:37] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[22:46:37] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/gsrXTA
[22:46:37] <ghrust> 13rust/06auto 14ce358fc 15Patrick Walton: libsyntax: Make managed box `@` patterns obsolete
[22:46:37] <ghrust> 13rust/06auto 14a5aa8e0 15Patrick Walton: librustc: Remove `@` pointer patterns from the language
[22:46:38] <ghrust> 13rust/06auto 14ba463fe 15bors: auto merge of #11305 : pcwalton/rust/at-patterns, r=pcwalton...
[22:46:40] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[22:49:55] <acrichto> brson: the tough part of introducing a new enum is that you don't have all the fun Option methods
[22:50:10] <acrichto> although we could always have to_option()
[22:51:06] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[22:51:35] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[22:51:35] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14ba463fe to 14480b0f4: 02http://git.io/N3iJvQ
[22:51:35] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[22:51:36] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[22:51:36] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/TX7lJg
[22:51:36] <ghrust> 13rust/06auto 14ce358fc 15Patrick Walton: libsyntax: Make managed box `@` patterns obsolete
[22:51:36] <ghrust> 13rust/06auto 14119c614 15Patrick Walton: librustc: Remove `@` pointer patterns from the language
[22:51:37] <ghrust> 13rust/06auto 14ab66f76 15bors: auto merge of #11305 : pcwalton/rust/at-patterns, r=pcwalton...
[22:51:39] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[22:51:45] <brson> acrichto: yeah :(
[22:52:05] <acrichto> although I think that's the best route
[22:52:13] <acrichto> you can just match on it
[22:52:21] <acrichto> or we have some helper method
[22:52:54] <acrichto> enum Result<T> { Data(T), Empty, Disconnected } ?
[22:55:17] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[22:58:10] *** Joins: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net)
[22:59:02] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[22:59:11] <Luqman> hmm, what is at env + 8 for a method call?
[22:59:40] <cmr> after the env ptr, or on the other side of the env ptr?
[22:59:58] <Luqman> mov 0x8(%rdi),%rcx
[23:01:03] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Ping timeout)
[23:05:18] *** Joins: dbaupp (Thunderbir@DF3B07E7.D5A1DCF.37681C44.IP)
[23:07:01] *** Quits: c-a (c-a@moz-57C82A9.a163.priv.bahnhof.se) (Quit: Ex-Chat)
[23:11:00] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[23:13:24] <cmr> Luqman: the type descriptor
[23:13:36] <cmr> (wow I got sidetracked)
[23:15:30] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[23:16:02] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[23:18:08] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[23:18:14] <Luqman> cmr: hmm, really?
[23:18:20] *** Quits: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP) (Connection reset by peer)
[23:18:37] <cmr> Luqman: afaict yes?
[23:18:39] <Luqman> so i get a segfault at mov (%rcx),%rdx
[23:18:53] <cmr> the env is { i64, %tydesc*, i8*, i8*, i8 }*
[23:18:59] <brson> acrichto: yes, but don't call it `Result` since that's confusing. Maybe RecvResult
[23:19:03] <cmr> i64 is 8, so it has to be the tydesc
[23:20:13] <Luqman> cmr: this segfault just makes me sad
[23:20:29] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[23:20:54] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[23:21:54] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[23:24:05] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[23:24:43] *** flaper87 is now known as flaper87|afk
[23:27:52] *** kimundi is now known as zz_kimundi
[23:28:40] *** Joins: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net)
[23:51:20] *** Quits: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP) (Quit: Lost terminal)
