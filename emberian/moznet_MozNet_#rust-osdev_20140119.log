[00:03:48] *** Joins: canhtak (canhtak@moz-6C22A50C.wl.t.ulaval.ca)
[00:05:58] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[00:16:33] *** Quits: tiffany (kawaii@moz-FC0DB29D.dhcp.embarqhsd.net) (Input/output error)
[00:43:53] *** Joins: ptc (Adium@moz-192425C4.nyc.res.rr.com)
[00:45:43] *** Quits: ptc (Adium@moz-192425C4.nyc.res.rr.com) (Ping timeout)
[01:07:14] *** kimundi is now known as zz_kimundi
[01:25:40] *** Joins: ptc (Adium@moz-192425C4.nyc.res.rr.com)
[01:26:58] *** Quits: ptc (Adium@moz-192425C4.nyc.res.rr.com) (Connection reset by peer)
[01:27:04] *** Joins: ptc (Adium@6C906E9F.9ECAA4DB.BCDD830B.IP)
[01:32:46] *** Quits: dbaupp (Thunderbir@moz-54209D42.lns20.syd6.internode.on.net) (Ping timeout)
[01:33:34] *** Joins: dbaupp (Thunderbir@moz-BFB46368.lns20.syd6.internode.on.net)
[01:33:41] *** Quits: ptc (Adium@6C906E9F.9ECAA4DB.BCDD830B.IP) (Ping timeout)
[01:34:20] *** Joins: ptc (Adium@moz-192425C4.nyc.res.rr.com)
[01:38:55] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[01:39:21] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[01:57:04] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[02:15:53] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Ping timeout)
[02:28:21] *** Quits: Tobba (Tobba@moz-462B7F7F.ias.bredband.telia.com) (Ping timeout)
[03:10:53] *** Quits: zz_kimundi (kimundi@moz-EAE0F638.dip0.t-ipconnect.de) (Ping timeout)
[03:13:06] *** Quits: dbaupp (Thunderbir@moz-BFB46368.lns20.syd6.internode.on.net) (Ping timeout)
[03:14:19] *** Joins: zz_kimundi (kimundi@moz-F79A61BC.dip0.t-ipconnect.de)
[03:14:21] *** zz_kimundi is now known as kimundi
[03:17:18] *** Joins: dbaupp (Thunderbir@moz-A840EB3D.lns20.syd6.internode.on.net)
[03:58:57] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[05:34:17] *** Joins: ptc1 (Adium@moz-192425C4.nyc.res.rr.com)
[05:34:18] *** Quits: ptc (Adium@moz-192425C4.nyc.res.rr.com) (Connection reset by peer)
[05:34:20] *** Quits: ptc1 (Adium@moz-192425C4.nyc.res.rr.com) (Client exited)
[05:50:09] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[05:50:34] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[06:14:53] <yuriks> anyone here's doing EFI stuff?
[06:15:29] <yuriks> I got a basic program running, but when I tried linking in rust-core it cause x86_64-w64-mingw-ld to crash :P
[06:16:05] <yuriks> I tried linking with my native ld (which for some reason can output pei-x86-64 too), but it doesn't allow setting a subsystem, the option isn't recognized
[06:16:33] <yuriks> I tried linking without setting a subsystem and then using x86_64-w64-mingw-objcopy to change the subsystem, which worked, but the application still doesn't load
[06:18:00] <yuriks> anyone have any leads on how to check what's wrong? I tried building a EFI toolchain using crosstool-ng, but couldn't figure out how to make it target x86_64-efi-pe
[06:18:08] <strcat> how are you building?
[06:18:10] <yuriks> I'm working off the "Booting to Rust" article
[06:18:21] <strcat> compile to LLVM and build that with llc/clang
[06:18:27] <strcat> LLVM bytecode*
[06:18:34] <yuriks> strcat: rustc -c -O --lib src/main.rs
[06:18:56] <yuriks> isn't that just what rustc does under the covers?
[06:19:03] <strcat> yuriks: you need -Z lto -Z no-landing-pads too
[06:19:18] <strcat> yuriks: no, rustc doesn't let you disable the segmented stack preludes
[06:19:53] <strcat> and you need to disable exceptions (unless you want to build support for them) and that requires only building with LTO atm
[06:25:31] <yuriks> hrm, now I can't even get it to work like it was before, hang on...
[06:30:53] <yuriks> strcat: can I use clang to compile it down to a .o or does it need to be the driver?
[06:31:18] <strcat> yuriks: can compile to a .o with clang/llc
[06:35:44] <yuriks> http://hastebin.com/yiguwimese.sm
[06:35:56] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[06:36:01] <yuriks> passing -flto do clang it doesn't produce an object file, but llvm ir instead
[06:36:15] <yuriks> if I don't pass -flto then ld crashes again when linking it
[06:36:19] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[06:39:40] *** Quits: canhtak (canhtak@moz-6C22A50C.wl.t.ulaval.ca) (Quit: canhtak)
[06:41:03] <yuriks> hm, I got something
[06:42:56] <yuriks> hm, compiling rust-core with --staticlib produces *both* a .a and a .rlib O_o
[06:43:21] <yuriks> strcat: does rust-core need to be built with -Z lto too?
[06:43:56] <strcat> yuriks: no, rlib has both the static/lto libs
[06:46:49] <yuriks> hm, I just needed -Z lto
[06:46:54] <yuriks> didn't even need to compile to bitcode
[06:47:15] <strcat> yuriks: you want -Z no-landing-pads too
[06:47:20] <yuriks> I'm using that
[06:47:22] <yuriks> it's working now
[06:47:22] <strcat> ah
[06:47:30] <yuriks> what's up with the crash?
[06:47:38] <strcat> hm?
[06:47:41] <yuriks> ld crashing
[06:47:46] <strcat> dunno
[06:47:50] <strcat> broken usage of exceptions
[06:47:53] * strcat shrugs
[06:48:01] <yuriks> don't need -Z no-landing-pads on rust-core either
[06:48:15] <strcat> yuriks: yeah because with lto it reloads all of the bytecode
[06:48:18] <strcat> and optimizes it again
[06:48:30] * strcat shrugs
[06:48:36] <yuriks> neither on my code. So it's just -Z lto on my code and that makes ld stop crashing
[06:48:39] <yuriks> weird.
[06:48:51] <strcat> yuriks: if you're not going bytecode -> llc/clang, the problem is that it's outputting segmented stack code - and it could easily crash afaik
[06:49:01] <strcat> at runtime
[06:49:21] <yuriks> ah, let me add a function call or two and see what happens
[06:53:57] <yuriks> calling a #[inline(never)] function call works, do I need to force it to grow the stack?
[06:54:08] <yuriks> also, aren't segmented stacks going to be removed?
[06:54:32] <dbaupp> We still use the prelude for stack "safety"
[06:54:41] <dbaupp> (it's not very safe)
[06:54:45] <yuriks> heh
[06:55:06] <dbaupp> i.e. we abort if the "does the stack need to grow" check fails
[06:59:46] <yuriks> http://hastebin.com/nofakacino.Makefile
[06:59:50] <yuriks> does this look safe?
[07:13:19] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[07:13:29] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[07:27:22] <yuriks> well, it looks like this right now: https://github.com/yuriks/starbreaker/blob/master/Makefile
[07:27:26] <yuriks> thanks for the help strcat
[08:08:18] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[08:28:59] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:29:14] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:29:14] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:43:43] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[08:45:02] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:45:05] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:45:16] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[09:30:56] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[09:58:37] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[10:35:03] *** Joins: tiffany (kawaii@moz-FC0DB29D.dhcp.embarqhsd.net)
[12:21:34] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[12:33:15] *** Joins: Tobba (Tobba@moz-462B7F7F.ias.bredband.telia.com)
[12:44:30] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Connection reset by peer)
[12:46:16] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[15:43:50] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[15:53:48] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[15:56:46] *** Joins: canhtak (canhtak@moz-6C22A50C.wl.t.ulaval.ca)
[16:23:44] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[16:34:37] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[17:01:26] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[17:04:40] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[18:36:32] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[18:44:23] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[18:47:41] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[19:13:20] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[20:02:03] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[20:18:35] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[20:48:22] *** Quits: c74d (c74d@moz-E2EAC718.oc.oc.cox.net) (Ping timeout)
[20:48:52] *** Joins: c74d (c74d@moz-E2EAC718.oc.oc.cox.net)
[21:49:16] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Ping timeout)
[23:24:44] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[23:29:38] *** Quits: Tobba (Tobba@moz-462B7F7F.ias.bredband.telia.com) (Ping timeout)
[23:30:14] *** Quits: geomyidae (quassel@DD6F7E3A.21468E9A.30200F38.IP) (Client exited)
[23:31:27] *** Joins: geomyidae (quassel@DD6F7E3A.21468E9A.30200F38.IP)
