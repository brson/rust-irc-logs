[00:03:30] <acrichto> round 43, fight!
[00:06:10] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[00:06:10] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/jgiy3w
[00:06:11] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[00:06:12] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[00:06:12] <ghrust> 01[13rust01] 15bors pushed 24 new commits to 06auto: 02http://git.io/Mu0Guw
[00:06:12] <ghrust> 13rust/06auto 14bb138bf 15Alex Crichton: Implement io::net::unix
[00:06:12] <ghrust> 13rust/06auto 14e9fe4b1 15Alex Crichton: Finish implementing io::net::addrinfo...
[00:06:13] <ghrust> 13rust/06auto 14fddf370 15Alex Crichton: Address a few XXX comments throughout the runtime...
[00:06:15] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[00:08:28] *** Joins: pjenvey (pjenvey@moz-B23F7990.org)
[00:14:31] <dbaupp> acrichto: I assume that https://github.com/mozilla/rust/issues/10039 isn't "outlawing" using `as &mut Trait` explicitly?
[00:15:38] <acrichto> dbaupp: nah I would just want it to infer, kinda like auto-deref
[00:16:25] <dbaupp> acrichto: what happens when you explicitly want a &mut Trait (e.g. for a generic function)?
[00:16:37] * dbaupp *hates* how auto-deref isn't controllable
[00:17:11] <acrichto> I'm not entirely sure if the semantics are even possible, but trait objects are still pretty painful to use
[00:17:22] <acrichto> I at least wanted to bring it up for discussion to see what others think about it
[00:17:48] <dbaupp> acrichto: wait, are you saying that the inference would be in addition to `as &mut ..` (I'd like this), or that it's replacing it (I would not like this)?
[00:18:11] * dbaupp possibly misinterpreted the "nah"
[00:18:55] <acrichto> hm I'm a bit confused
[00:19:02] <acrichto> fn foo(&mut Trait)
[00:19:12] <acrichto> foo(&mut my_object) instead of foo(&mut my_object as &mut Trat0
[00:19:16] <acrichto> that's what I want
[00:19:46] <dbaupp> yeah, but what about `fn foo<T: Bound>(x: T)`: what's `fn foo(&mut y)`?
[00:20:22] <acrichto> that I would think wouldn't coerce
[00:20:34] <dbaupp> i.e. can one still use `&mut y as &mut Trait` there to explicitly make T = &mut Trait, or does one have to use a temporary `let x: &mut Trait = &mut y; foo(x)`
[00:20:49] <acrichto> nah I'd want to leave the explicit casting
[00:20:53] <acrichto> although pcwalton may not like it
[00:21:07] * dbaupp likes the explicit casting too
[00:21:15] * pcwalton doesn't really care
[00:21:16] <acrichto> I think that the only reason we have `as` is for constant expressions, and it's kinda just borrowed for trait casts right now
[00:21:25] <acrichto> ah, then I'd like to keep it :)
[00:21:38] <acrichto> I still want type ascription of an expression... although that may be awhile
[00:21:43] <dbaupp> also, what if Bound is implemented for only `&mut Trait` and no other `&mut anything`'s? would that infer the trait object?
[00:22:28] <acrichto> it would infer to pain
[00:22:38] <dbaupp> yeah, just checking.
[00:22:50] <acrichto> I'm ok with it being a very limited inference
[00:23:02] <acrichto> as in we concretly know that the parameter is a trait and the value is a struct
[00:23:10] <acrichto> but that may not be useful
[00:24:53] <dbaupp> it'd help for the fmt stuff, yeah? (Although it's not clear to me that we want to force the use of trait objects for that... I guess I should measure the speed difference of a sprintf equivalent for using the MemWriter directly vs using a trait object.)
[00:25:20] <acrichto> it would help with write a lot certainly, I'm worried about making it generic though
[00:25:30] <dbaupp> code-bloat, yeah?
[00:25:32] <acrichto> we already have a massive LLVM code bloat in slurping in libstd
[00:25:51] <acrichto> I originally did it because I didn't think that it needed to have a non-trait-object
[00:25:55] <strcat> we have weird pointless abstractions
[00:25:57] <dbaupp> (in the general case one would use &mut Writer as the generic parameter, just for the write-directly-to-memory style parameter, I think.)
[00:25:58] <acrichto> I didn't consider speed to be that much of an issue
[00:26:13] <dbaupp> *just using non-trait-object
[00:26:30] <strcat> like std::unstable::intrinsics having transmute, and then wrapping transmute with a function using the same signature in std::cast
[00:26:31] <acrichto> it certainly could be possible
[00:26:55] <strcat> vectors go ~10 levels deep in calls just for push
[00:27:11] <dbaupp> even with -O? o_O
[00:27:14] <strcat> no
[00:27:17] <strcat> I mean pre-optimization
[00:27:26] <dbaupp> ah
[00:27:50] * strcat wants to make rust-core competitive with stuff like EASTL
[00:28:01] <strcat> which means fast non-optimized code
[00:28:09] <strcat> and fast compile times
[00:28:12] *** lbergstrom is now known as lbergstrom|away
[00:37:43] <aatch> strcat, oh, on the topic of rust-core, what kind of plans do you have for it functionality-wise? I'd like to contribute, but I don't know what you want there to be in it.
[00:38:18] <strcat> aatch: I want it to at least be competitive with the C/C++ standard libraries
[00:38:25] <strcat> in terms of features/performance
[00:38:55] <dbaupp> strcat: are direct syscalls in scope?
[00:39:00] <strcat> dbaupp: unsure
[00:39:04] <strcat> I would say no for now
[00:39:13] <dbaupp> yeah, that's reasonable.
[00:39:20] <strcat> at least on linux you can just use musl and link it with LTO
[00:40:32] <pcwalton> strcat: +1 on that idea
[00:40:56] <pcwalton> on Windows you have to use kernel32 because the NTAPI isn't stable
[00:41:12] <strcat> making direct system calls is interesting if you use segmented stacks but rust-core definitely won't be trying to support that
[00:42:23] <strcat> the more interesting parts are when you don't have libc anyway (writing containers able to use custom allocators, etc.)
[00:42:45] <strcat> and figuring out less unsafe ways of having things like intrusive data structures
[00:42:54] <kmc> strcat: wait, didn't I ask yesterday if direct syscalls are in scope and you said "yes"? ;P
[00:42:55] <pcwalton> strcat: reading the design docs for EASTL makes me sad as a compiler author
[00:43:06] <dbaupp> pcwalton: link?
[00:43:10] <pcwalton> "we don't use function abstractions because the compiler might be bad at inlining"
[00:43:16] <pcwalton> I'm like "noooooooooo"
[00:43:23] <dbaupp> ( http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2271.html ?)
[00:43:33] <pcwalton> dbaupp: yeah http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2271.html
[00:43:37] <kmc> i want direct syscalls because I enjoy writing programs with no libc, for entertainment value
[00:43:39] <strcat> pcwalton: well it's very pragmatic, meet-the-deadline focused ;p
[00:43:54] <strcat> so it's a good comparison to see if we're really offering what people want in that niche
[00:43:58] <pcwalton> I know, but... Rust just isn't designed to be a language for dumb compilers
[00:44:20] <pcwalton> I feel like if we wanted a dumb compiler language we wouldn't even use iterators, we'd just be like Go and say "<3 for loops"
[00:44:37] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[00:44:57] <aatch> kmc, heh, same as me
[00:45:11] <strcat> pcwalton: their problem with inlining is mostly that they need their debug builds to not be slow
[00:45:19] <pcwalton> that just makes me so sad
[00:45:26] <pcwalton> why deny yourself the power of a language for that
[00:45:35] <strcat> since then, gcc has gained -Og and -fvar-tracking-assignments and so on
[00:45:43] <strcat> LLVM is still weak for fast debug builds
[00:45:50] <pcwalton> let's fix LLVM then :P
[00:46:01] <strcat> I agree, I won't be copying their manual inlining ;p
[00:46:18] <strcat> C++11 seems to have adopted most of the EASTL things anyway
[00:46:27] <strcat> they made allocators work more like EASTL, didn't realize
[00:46:28] <pcwalton> okay, that's good to hear :)
[00:46:42] <pcwalton> I don't mind the other requirements really
[00:47:03] <dbaupp> http://gcc.gnu.org/wiki/Var_Tracking_Assignments "Run-time efficienty"
[00:48:58] <strcat> dbaupp: I assume his native language is portuguese, he's brazilian, *shrug*
[00:49:26] <strcat> gcc is notoriously bad at maintaining their wiki
[00:49:51] <dbaupp> strcat: ok (I have no idea who "he" is...)
[00:49:54] <strcat> someone makes a draft and then 5 years after the feature has been implemented and rewritten several times, it's still there ;p
[00:50:14] <dbaupp> in any case, that sounds like looks a useful feature... does LLVM support it?
[00:50:18] <strcat> dbaupp: nope
[00:50:31] <strcat> and not -Og either, but they *sort of* treat -O1 that way
[00:51:00] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[00:51:01] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 143164ca6 to 14e2428b7: 02http://git.io/N3iJvQ
[00:51:01] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[00:51:06] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[00:51:07] <ghrust> 01[13rust01] 15bors pushed 24 new commits to 06auto: 02http://git.io/3OJkjg
[00:51:07] <ghrust> 13rust/06auto 14bb138bf 15Alex Crichton: Implement io::net::unix
[00:51:07] <ghrust> 13rust/06auto 14e9fe4b1 15Alex Crichton: Finish implementing io::net::addrinfo...
[00:51:07] <ghrust> 13rust/06auto 14fddf370 15Alex Crichton: Address a few XXX comments throughout the runtime...
[00:51:09] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[00:52:55] <strcat> dbaupp: gcc is quite a bit more advanced in terms of implemented features/optimizations than LLVM, but they are much more flaky.
[00:53:08] <strcat> they have way more optimization passes, but they don't work ;P
[00:53:15] <strcat> lots are enabled by default but not proven to speed up code
[00:53:44] <strcat> gcc -O3 is worse than gcc -O2 more often than not...
[00:53:54] <strcat> (and it's buggy)
[00:55:42] <strcat> their loop-vectorize is still in -O3 because the heuristics are too flaky. so clang leaped ahead their even though the vectorization isn't nearly as complete
[00:55:47] <strcat> ahead there*
[00:57:15] * strcat should rewrite std::trie
[00:58:25] <pcwalton> http://blog.golang.org/strings whoa, Go doesn't require that strings always contain valid utf-8
[00:58:30] <pcwalton> only when they're constructed
[00:58:40] <strcat> pcwalton: yeah they have a function to check if they're valid... it's pretty bad
[00:58:51] <pcwalton> that's just a bug in Go :P
[00:59:19] <strcat> pcwalton: http://golang.org/src/pkg/unicode/utf8/utf8.go?s=9826:9857#L405
[00:59:27] <strcat> types.... not using them right
[01:00:08] <pcwalton> the problem with "worse is better" is that sometimes worse is worse
[01:00:47] <strcat> pcwalton: you should see what they do with reflection
[01:00:58] <pcwalton> I sorta know
[01:01:00] <pcwalton> what do they do?
[01:01:00] <strcat> they'll have something take a Reader, and then reflect that it's also a Writer and write to it
[01:01:05] <strcat> it's very weird
[01:01:19] <pcwalton> oh yeah
[01:01:20] <pcwalton> I saw that
[01:01:22] <aatch> strcat, oh, I remember reading about that
[01:01:32] <pcwalton> they use it to get around the "standard library APIs are frozen"
[01:01:40] <pcwalton> which apparently means "the types are frozen"
[01:01:46] <pcwalton> but doesn't mean "we won't break your code"
[01:01:48] <strcat> "standard library APIs aren't related to the actual API" ;p
[01:01:54] <pcwalton> but does mean "we will continue to claim backwards compatibility"
[01:01:56] <strcat> pcwalton: sounds like LLVM's C API :)
[01:02:30] <strcat> the ABI is stable, they just turn old functions into no-ops
[01:02:54] <pcwalton> I take issue with calling that "backwards compatibility"
[01:03:03] <pcwalton> that's "your code will continue to typecheck and will... do something"
[01:03:08] <pcwalton> not "backwards compatibility"
[01:03:10] <strcat> (I wish we could magically use the C++ API somehow)
[01:03:25] <pcwalton> "backwards compatibility" means your code will still *work*
[01:03:41] <pcwalton> Go has never committed to backwards compatibility
[01:04:33] <aatch> I've seen patches that break bc without affecting the API at all, mostly security fixes
[01:04:47] <pcwalton> security fixes are different, I think it's fine to break backwards compat for them
[01:04:52] <pcwalton> in most cases
[01:06:03] <aatch> pcwalton, oh, not complaining about it, just mentioning that breaking bc doesn't always mean an API change. So even the "stable API" argument is flawed
[01:06:57] <aatch> Also, mostly security fixes because if it wasn't for security they tend to get rejected with something like "Make a new API and deprecate the old one" or something similar
[01:07:28] <strcat> sqlite's way is _v2, _v3 ;p
[01:08:55] <pcwalton> we are going to eventually have to have a plan for how to do it
[01:09:07] <pcwalton> Graydon did want some sort of symbol versioning support
[01:09:23] <pcwalton> there are things we will hate in Rust 1.0 and will want to change
[01:10:10] <strcat> wow, sqlite4 drops support for IEEE floats.
[01:16:42] <cmr> whu?
[01:16:48] <cmr> what are they using instead?
[01:17:49] <strcat> 'SQLite4 does all numeric computations using decimal arithmetic. SQLite4 never uses C datatypes double or float (except in interface routines when converting between double and the internal decimal representation). Instead, all numeric values are represented internally as an 18-digit decimal number with a 3-digit base-10 exponent. '
[01:18:15] <strcat> it's a bit weird.
[01:18:42] <cmr> what's their reason? consistency?
[01:20:41] <cmr> foudn http://sqlite.org/src4/doc/trunk/www/design.wiki
[01:23:31] <cmr> "faster than LevelDB" they've got my interest now
[01:24:35] <cmr> yup, seems consistency is their main goal
[01:25:13] <strcat> ughhh
[01:25:25] <strcat> I always accidentally put the current bug number when closing a dupe...
[01:39:50] <cmr> hansjorg: ping
[01:41:03] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[01:41:03] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14c85d7c9 to 14e2428b7: 02http://git.io/N3iJvQ
[01:41:03] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[01:41:04] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[01:41:05] <ghrust> 01[13rust01] 15bors pushed 24 new commits to 06auto: 02http://git.io/dIKN2Q
[01:41:05] <ghrust> 13rust/06auto 14bb138bf 15Alex Crichton: Implement io::net::unix
[01:41:05] <ghrust> 13rust/06auto 14e9fe4b1 15Alex Crichton: Finish implementing io::net::addrinfo...
[01:41:05] <ghrust> 13rust/06auto 14fddf370 15Alex Crichton: Address a few XXX comments throughout the runtime...
[01:41:07] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[01:49:02] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[01:49:07] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[01:49:59] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[01:50:34] <strcat> dbaupp: I think salsa20 would beat both ISAAC/MT
[01:52:02] <strcat> and it's a stronger stream cipher than ISAAC
[01:52:15] <cmr> brson: it's so weird seeing my name in communication
[01:52:27] <cmr> everyone that addresses me IRL calls me Rust, and online I'm cmr.
[01:53:36] <strcat> dbaupp: http://cr.yp.to/chacha.html could compare to one of those too
[02:03:50] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[02:16:29] *** Quits: zz_kimundi (kimundi@moz-DBB29B3E.dip0.t-ipconnect.de) (Ping timeout)
[02:19:11] *** Quits: pcwalton (pcwalton@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: pcwalton)
[02:19:53] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[02:20:22] <brson> cmr: people in real life call you 'Rust'?!
[02:20:22] *** Joins: zz_kimundi (kimundi@moz-C410002E.dip0.t-ipconnect.de)
[02:20:24] *** zz_kimundi is now known as kimundi
[02:20:42] <cmr> brson: yes.
[02:20:53] <cmr> everyone in the open source labs here :p
[02:20:59] <brson> hardcore
[02:21:22] <cmr> it's a nice name, I don't mind
[02:36:04] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[02:36:04] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14eef5ea5 to 14e2428b7: 02http://git.io/N3iJvQ
[02:36:05] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[02:36:06] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[02:36:06] <ghrust> 01[13rust01] 15bors pushed 24 new commits to 06auto: 02http://git.io/Fy3fMQ
[02:36:06] <ghrust> 13rust/06auto 14bb138bf 15Alex Crichton: Implement io::net::unix
[02:36:06] <ghrust> 13rust/06auto 14e9fe4b1 15Alex Crichton: Finish implementing io::net::addrinfo...
[02:36:07] <ghrust> 13rust/06auto 14fddf370 15Alex Crichton: Address a few XXX comments throughout the runtime...
[02:36:09] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[02:41:42] <cmr> Alright so I think my attempt at a hiatus can be officially declared dead
[02:42:04] <cmr> I caught up faster than I thought I was going to
[02:42:07] <cmr> (with schoolwork)
[02:44:41] *** Joins: pcwalton (pcwalton@moz-471501F5.snfc.ca.megapath.net)
[02:44:41] *** ChanServ sets mode: +ao pcwalton pcwalton
[02:57:19] *** Quits: pcwalton (pcwalton@moz-471501F5.snfc.ca.megapath.net) (Quit: pcwalton)
[03:03:36] *** Joins: jeffdb_ (jeff@moz-D13B6004.hsd1.ca.comcast.net)
[03:06:27] *** Quits: geoffhill (geoffhill@moz-244CF33A.amazon.com) (Ping timeout)
[03:10:36] <cmr> bstrie: you should add #rust-osdev to the reddit sidebar :)
[03:21:05] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[03:21:05] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 144513a3e to 14e2428b7: 02http://git.io/N3iJvQ
[03:21:05] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[03:21:11] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[03:21:12] <ghrust> 01[13rust01] 15bors pushed 24 new commits to 06auto: 02http://git.io/4LR9ow
[03:21:12] <ghrust> 13rust/06auto 14bb138bf 15Alex Crichton: Implement io::net::unix
[03:21:12] <ghrust> 13rust/06auto 14e9fe4b1 15Alex Crichton: Finish implementing io::net::addrinfo...
[03:21:12] <ghrust> 13rust/06auto 14fddf370 15Alex Crichton: Address a few XXX comments throughout the runtime...
[03:21:14] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[03:25:01] *** Joins: pcwalton (pcwalton@moz-B51927E9.hsd1.ca.comcast.net)
[03:25:01] *** ChanServ sets mode: +ao pcwalton pcwalton
[03:29:41] *** Joins: eddyb (eddy@3C6E2DBB.FFB4E060.A5830293.IP)
[04:05:34] *** Quits: jeffdb_ (jeff@moz-D13B6004.hsd1.ca.comcast.net) (Ping timeout)
[04:16:04] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[04:16:04] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14aa7c492 to 14e2428b7: 02http://git.io/N3iJvQ
[04:16:04] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[04:16:10] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[04:16:10] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/ECz2uA
[04:16:10] <ghrust> 13rust/06auto 146a2a47c 15Heather: support for GNU configure syntax
[04:16:10] <ghrust> 13rust/06auto 140651bb7 15Heather: Correct prefix / CFG_PREFIX work in configure / install.mk
[04:16:11] <ghrust> 13rust/06auto 143d0909b 15bors: auto merge of #9990 : Heather/rust/configure-changes, r=brson...
[04:16:13] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[04:26:05] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[04:26:05] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 143d0909b to 14e2428b7: 02http://git.io/N3iJvQ
[04:26:05] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[04:26:08] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[04:26:08] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/GRMfqA
[04:26:08] <ghrust> 13rust/06auto 14eb35737 15Daniel Micay: drop unused `frame_address` intrinsic...
[04:26:08] <ghrust> 13rust/06auto 148f55a71 15bors: auto merge of #10040 : thestinger/rust/frame_address, r=alexcrichton...
[04:26:09] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[04:36:04] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[04:46:06] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[04:46:06] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 148f55a71 to 14e2428b7: 02http://git.io/N3iJvQ
[04:46:06] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[04:46:11] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[04:46:11] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/AS7X0A
[04:46:11] <ghrust> 13rust/06auto 14ce54c34 15Daniel Micay: drop unused `frame_address` intrinsic...
[04:46:11] <ghrust> 13rust/06auto 14f27dfa0 15bors: auto merge of #10040 : thestinger/rust/frame_address, r=alexcrichton...
[04:46:11] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[05:04:31] *** Quits: tikue_ (tikue_star@5D962672.CD72397.689607DE.IP) (Ping timeout)
[05:16:29] *** Quits: Kxepal (Miranda@moz-C38F0777.pppoe.mtu-net.ru) (Ping timeout)
[05:19:48] *** Joins: Kxepal (Miranda@moz-6B9ED67C.pppoe.mtu-net.ru)
[05:30:14] <kimundi> brson: ping
[05:45:28] *** Quits: klutzy (th@BA61F396.8E859986.ECA1BB11.IP) (Ping timeout)
[05:46:05] *** Joins: klutzy (th@BA61F396.8E859986.ECA1BB11.IP)
[05:51:06] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[05:51:06] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/AS7X0A
[05:51:06] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[05:56:01] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[05:56:01] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/WrT87g
[05:56:01] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[05:56:06] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[05:56:06] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/vWNuJg
[05:56:06] <ghrust> 13rust/06auto 144fe522f 15Matthew Iselin: Set external linkage on Rust functions defined with foreign ABIs.
[05:56:06] <ghrust> 13rust/06auto 142d35d78 15Matthew Iselin: Make all functions, not just foreign ABI ones, link with external linkage if they are publically visible.
[05:56:08] <ghrust> 13rust/06auto 14cc4b7b5 15Matthew Iselin: Link statics with external linkage if they are publically visible
[05:56:10] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[05:56:43] *** kimundi is now known as zz_kimundi
[06:02:37] *** Quits: pcwalton (pcwalton@moz-B51927E9.hsd1.ca.comcast.net) (Quit: .)
[06:15:20] *** Quits: eddyb (eddy@3C6E2DBB.FFB4E060.A5830293.IP) (Ping timeout)
[06:25:43] *** Joins: eddyb (eddy@37F72125.9065A63B.FCAAE698.IP)
[06:29:29] *** zz_kimundi is now known as kimundi
[06:31:09] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[06:31:09] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 148715ac0 to 14f27dfa0: 02http://git.io/N3iJvQ
[06:31:09] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[06:31:14] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[06:31:14] <ghrust> 01[13rust01] 15bors pushed 24 new commits to 06auto: 02http://git.io/3oOgZw
[06:31:14] <ghrust> 13rust/06auto 14bb138bf 15Alex Crichton: Implement io::net::unix
[06:31:14] <ghrust> 13rust/06auto 14e9fe4b1 15Alex Crichton: Finish implementing io::net::addrinfo...
[06:31:15] <ghrust> 13rust/06auto 14fddf370 15Alex Crichton: Address a few XXX comments throughout the runtime...
[06:31:17] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[06:36:34] *** Joins: nrc (nrc@moz-BAE8D951.pck.nerim.net)
[06:44:50] <brson> kimundi: i'll catch you tomorrow
[06:45:41] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[06:46:08] *** Quits: Kxepal (Miranda@moz-6B9ED67C.pppoe.mtu-net.ru) (Quit: Kxepal)
[06:46:26] *** Joins: Kxepal (Miranda@moz-6B9ED67C.pppoe.mtu-net.ru)
[06:48:59] *** Quits: nrc (nrc@moz-BAE8D951.pck.nerim.net) (Ping timeout)
[07:06:26] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[07:29:57] *** flaper87|afk is now known as flaper87
[07:32:56] *** Joins: nielsle (nielsle@moz-5CE8ECCD.boa.fiberby.dk)
[07:40:57] *** Joins: sanxiyn (tinuviel@B4104EBB.3CC170B1.1E14B209.IP)
[07:42:27] *** Joins: nrc (nrc@DA4ABEAF.1DE10CA8.D8E68FF6.IP)
[07:43:06] *** Quits: dbaupp (Thunderbir@moz-CB11E887.lns20.syd6.internode.on.net) (Ping timeout)
[07:47:06] *** Joins: dbaupp (Thunderbir@moz-EA27E3E6.lns20.syd6.internode.on.net)
[07:53:37] <hansjorg> cmr: pong
[07:53:57] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[08:01:32] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[08:09:14] *** Parts: sanxiyn (tinuviel@B4104EBB.3CC170B1.1E14B209.IP) (Leaving)
[08:11:55] *** kimundi is now known as zz_kimundi
[08:17:10] *** zz_kimundi is now known as kimundi
[08:17:50] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[08:18:02] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[08:35:33] *** Joins: jdm (jdm@87C1F78E.1DE10CA8.D8E68FF6.IP)
[08:37:06] *** Quits: StarLight (StarLight@moz-2CB27D18.dynamic.avangarddsl.ru) (Ping timeout)
[08:40:34] *** Joins: StarLight (StarLight@moz-3D8C0C7A.dynamic.avangarddsl.ru)
[09:25:39] *** kimundi is now known as zz_kimundi
[09:35:57] *** Joins: mib_yctcy6 (Mibbit@3183EF9E.AD86A6FF.57DA49D3.IP)
[09:41:29] *** Quits: mib_yctcy6 (Mibbit@3183EF9E.AD86A6FF.57DA49D3.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[10:02:33] *** zz_kimundi is now known as kimundi
[10:53:24] *** flaper87 is now known as flaper87|afk
[11:44:20] *** flaper87|afk is now known as flaper87
[11:56:30] *** kimundi is now known as zz_kimundi
[12:11:07] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[12:11:07] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14a5c00e8 to 14f27dfa0: 02http://git.io/N3iJvQ
[12:11:07] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[12:11:10] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[12:11:10] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/KLQS0A
[12:11:10] <ghrust> 13rust/06auto 14a3ae48c 15Daniel Micay: mark some functions as returning !...
[12:11:10] <ghrust> 13rust/06auto 147075eb3 15bors: auto merge of #10042 : thestinger/rust/fail, r=sanxiyn...
[12:11:11] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[12:25:01] *** zz_kimundi is now known as kimundi
[12:38:12] <bstrie> cmr: oh, I thought I already had...
[12:46:44] *** Joins: SimonSapin (simon@moz-9A1FE870.exyr.org)
[12:47:10] <SimonSapin> Hi. std::libc::c_float is f32 on my system. Can I rely on that always being the case on various systems?
[12:48:06] <dbaupp> SimonSapin: does the C standard require float == f32? (If not, I don't think so)
[12:48:21] <dbaupp> (if it does require it, then yes.)
[12:48:46] <eddyb> SimonSapin: it will always be the case for the same architecture
[12:49:00] <bstrie> float: single precision floating-point type. Actual properties unspecified (except minimum limits), however on most systems this is the IEEE 754 single-precision binary floating-point format. This format is required by the optional Annex F "IEC 60559 floating-point arithmetic".
[12:49:11] <eddyb> I'm pretty sure x86, x86_64 and arm all use float = f32, double = f64
[12:49:57] <bstrie> "The actual size and behavior of floating-point types also vary by implementation. The only guarantee is that long double is not smaller than double, which is not smaller than float. Usually, the 32-bit and 64-bit IEEE 754 binary floating-point formats are used, if supported by hardware."
[12:50:13] <dbaupp> "I've worked on machines where float is 64 bits (and double is 64 bits, and long double is 128 bits). These were Cray vector machines, where the native word size is 64 bits." http://bytes.com/topic/c/answers/531401-does-float-always-occupy-32-bits
[12:50:15] <bstrie> https://en.wikipedia.org/wiki/C_data_types
[12:50:22] <SimonSapin> For context: rust-cssparser has a RGBA struct for colors that should be compatible with Azure (aka. moz2d.) rust-azure uses c_float
[12:50:25] <dbaupp> (well, http://bytes.com/topic/c/answers/531401-does-float-always-occupy-32-bits#post2074332 )
[12:51:18] <SimonSapin> I suppose I can just use c_float as well, though itâ€™s not pretty
[12:51:34] <SimonSapin> (the two libs are unrelated other than Servo uses them both)
[12:51:47] <bstrie> the real question is whether C floats are single-precision on all platforms that rust supports :P
[12:51:48] <dbaupp> I'd guess servo will only be running on 32-bit C float platfomrs in the forseeable future?
[12:52:11] <eddyb> bstrie: yes
[12:52:18] <dbaupp> (and if someone is trying to port it to a non-32-bit float platform, it just involves a few `as f32`'s)
[12:52:27] <eddyb> (you can add MIPS to my last list)
[12:52:56] <dbaupp> although I guess such a platform wouldn't support f32 in hardware at all, so one wouldn't want the Rust code to be using f32 either anyway.
[12:53:22] <eddyb> does rust even have f128?
[12:53:30] <dbaupp> So... I say: use 'f32'.
[12:53:32] <dbaupp> eddyb: no
[12:53:33] <bstrie> eddyb: not yet
[12:53:39] <bstrie> possible future extension
[13:00:43] <SimonSapin> If I have a type (struct) and a function (enum variant constructor) with the same name, will 'use module::Foo' import both?
[13:01:32] <bstrie> good question! it probably will?
[13:01:47] <SimonSapin> Iâ€™ll try it :)
[13:03:19] <eddyb> can you even do that?
[13:03:31] <eddyb> rusti: struct Foo; enum Bar {Foo, Baz}
[13:03:32] -rusti- pastebinned 10 lines of output: http://sprunge.us/ahWg
[13:06:12] <SimonSapin> eddyb: https://github.com/mozilla-servo/rust-cssparser/blob/master/color.rs#L30
[13:06:40] <SimonSapin> also https://github.com/mozilla-servo/rust-cssparser/blob/master/ast.rs#L102
[13:06:54] <eddyb> rusti: struct Foo; enum Bar {Foo(int), Baz}
[13:06:55] -rusti- pastebinned 10 lines of output: http://sprunge.us/cdZP
[13:07:20] <eddyb> SimonSapin: uhm... that doesn't look like it would/should compile at all :|
[13:07:52] <SimonSapin> rusti: struct Foo { foo: int }; enum Bar { Foo, Baz }
[13:07:53] -rusti- ()
[13:08:21] <SimonSapin> {}-constructors and ()-constructors seem to have different namespaces
[13:08:24] <eddyb> aaaaah, I see. since an empty struct defines a value
[13:08:33] <SimonSapin> I donâ€™t know if thatâ€™s intentional
[13:08:39] <eddyb> SimonSapin: in my example, Foo is both a type and a value
[13:08:58] <SimonSapin> rusti: struct Foo(int); enum Bar { Foo { foo: Foo }, Baz }
[13:08:59] -rusti- pastebinned 10 lines of output: http://sprunge.us/PbNL
[13:09:18] <eddyb> rusti: struct Foo; format!("{:?}", Foo)
[13:09:18] -rusti- ~"main::Foo"
[13:10:36] <bstrie> if I check out a really old version of rust, is there a way to see the version numbers of libuv and llvm for that version?
[13:14:25] <eddyb> SimonSapin: ()-constructors are functions, and an empty struct is actually a value. but enum variants always expose that name, even if they're object-like instead of tuple-like
[13:16:08] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[13:16:09] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/KLQS0A
[13:16:09] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[13:21:04] <bstrie> what the heck is the "gyp" submodule
[13:21:05] <bstrie> that's new
[13:25:55] <SimonSapin> bstrie: build system for something (libuv?), Iâ€™m told
[13:26:45] <kaeso> for libuv, yes
[13:27:26] <bstrie> weird that the canonical repo for gyp appears to live in the chromium project
[13:28:02] <bstrie> at least according to our gitmodules file
[13:29:05] <kaeso> they have a SVN, but IIRC the chromium git is the most updated location
[13:29:55] <SimonSapin> it appears to be maintained by chromium developers %
[13:29:58] <SimonSapin> s/%//
[13:37:29] <bstrie> hm, it's impossible to look at the submodules of old rust versions
[13:37:39] <bstrie> becuase the references have changed
[13:48:14] *** lbergstrom|away is now known as lbergstrom
[14:00:35] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[14:04:31] *** kimundi is now known as zz_kimundi
[14:21:47] <SimonSapin> bstrie: taking a random commit, the link @ 4119fda work fine on https://github.com/mozilla/rust/tree/0094ffd99b09f2fc8c639df28b12e10211cff6ce/src
[14:26:38] <bstrie> hm, my local checkout didn't work
[14:26:43] <bstrie> reference is not a tree, etc
[14:27:11] <cmr> hansjorg: what I wanted to talk to you about is in an email now :)
[14:28:03] <SimonSapin> Iâ€™m getting link-time "undefined reference" errors :(
[14:28:11] <SimonSapin> (trying to have private modules and only re-exporting the bits that I want to be public.)
[14:30:59] <cmr> SimonSapin: that means bugs in privacy/visibility
[14:35:33] <SimonSapin> cmr: it looks like https://github.com/mozilla/rust/issues/9790, but Iâ€™m on rustc 0.9-pre (3f240fe 2013-10-18 06:11:18 -0700) which should be more recent than the fix
[14:37:18] *** zz_kimundi is now known as kimundi
[14:41:31] <SimonSapin> cmr: will, this is public methods on types publicly re-exported from a private module 
[14:41:37] <SimonSapin> s/will/well/
[15:03:55] <SimonSapin> ok, the difference with #9790 is that Iâ€™m using associated functions (static methods)
[15:04:14] <SimonSapin> filed https://github.com/mozilla/rust/issues/10051 , ping acrichto
[15:12:06] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[15:12:22] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[15:20:03] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[15:20:23] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[15:34:07] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Quit: leaving)
[15:45:40] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[16:08:11] <acrichto> SimonSapin: I thought I fixed that...
[16:09:05] <SimonSapin> acrichto: itâ€™s fixed for "normal" methods (that take self) but not static methods
[16:10:37] <acrichto> SimonSapin: hm, this looks like it's fixed on master, what version of rust are you using?
[16:11:10] <SimonSapin> 0.9-pre (3f240fe 2013-10-18 06:11:18 -0700)
[16:11:30] <SimonSapin> which does have the fix for #9790
[16:11:34] <SimonSapin> I can try and upgrade
[16:11:40] <acrichto> SimonSapin: I think a25bbcc27fcbddb005b3025086f87940937b7619 is the commit you want
[16:12:02] <acrichto> yeah it looks like you may just need to upgrade
[16:30:51] *** Quits: jdm (jdm@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Lost terminal)
[16:43:30] *** Quits: nrc (nrc@DA4ABEAF.1DE10CA8.D8E68FF6.IP) (Ping timeout)
[16:49:40] *** Joins: steveklabnik (steveklabn@moz-9CCDFEEB.public.wayport.net)
[17:00:33] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[17:00:33] *** ChanServ sets mode: +qo brson brson
[17:01:25] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[17:01:25] *** ChanServ sets mode: +o tjc
[17:05:04] *** flaper87 is now known as flaper87|afk
[17:17:28] *** Joins: pcwalton (pcwalton@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:17:28] *** ChanServ sets mode: +ao pcwalton pcwalton
[17:17:52] *** Joins: lkuper_ (lkuper@B95BCDDD.14CD977C.51B6877.IP)
[17:19:52] *** Quits: steveklabnik (steveklabn@moz-9CCDFEEB.public.wayport.net) (Ping timeout)
[17:26:04] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[17:26:04] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/DtEp9A
[17:26:04] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[17:26:12] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[17:26:12] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/jUSLsA
[17:26:12] <ghrust> 13rust/06auto 144fe522f 15Matthew Iselin: Set external linkage on Rust functions defined with foreign ABIs.
[17:26:12] <ghrust> 13rust/06auto 142d35d78 15Matthew Iselin: Make all functions, not just foreign ABI ones, link with external linkage if they are publically visible.
[17:26:14] <ghrust> 13rust/06auto 14cc4b7b5 15Matthew Iselin: Link statics with external linkage if they are publically visible
[17:26:16] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[17:34:05] *** Quits: lkuper_ (lkuper@B95BCDDD.14CD977C.51B6877.IP) (Quit: lkuper_)
[17:48:56] *** Joins: nrc (nrc@DA4ABEAF.1DE10CA8.D8E68FF6.IP)
[17:53:33] *** Joins: tikue_ (tikue_star@7FD2F500.F3E8A984.689607DE.IP)
[17:57:14] <nmatsakis> brson: did we have rust-triage? 
[17:57:18] <nmatsakis> just realized I totally forgot
[17:57:27] <pcwalton> nmatsakis: we're still triaging
[17:59:50] *** Joins: steveklabnik (steveklabn@moz-BAF03CE5.hfc.comcastbusiness.net)
[18:12:03] *** Quits: steveklabnik (steveklabn@moz-BAF03CE5.hfc.comcastbusiness.net) (Ping timeout)
[18:16:20] <acrichto> brson: umm... is there a reason that uv_idle_t is allocated with a C++ 'new' rather than malloc?
[18:17:00] <brson> acrichto: no
[18:17:14] <acrichto> valgrind is not happy about that
[18:27:21] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[18:32:22] *** kimundi is now known as zz_kimundi
[18:33:47] *** Quits: pcwalton (pcwalton@moz-BE33DA21.fw1.sfo1.mozilla.net) (Input/output error)
[18:34:08] <acrichto> man it's like a breath of fresh air to use valgrind/gdb on linux
[18:35:05] *** Joins: pcwalton (pcwalton@moz-BE33DA21.fw1.sfo1.mozilla.net)
[18:35:05] *** ChanServ sets mode: +ao pcwalton pcwalton
[18:37:08] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[18:43:39] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[18:43:45] *** zz_kimundi is now known as kimundi
[18:43:54] <kimundi> brson: Trying to make future_result() return an ~Any on failure makes the whole thing kinda ugly... I need to untangle the whole unwinding path again, and add a lot of allocations... Is there a way to have an port that applies an function to the value it receives? If I could lazyly allocate the ~Any on future_results receive instead of on the chan side, then the whole problem would disappear.
[18:46:40] *** Joins: geoffhill (geoffhill@moz-244CF33A.amazon.com)
[18:48:38] <cmr> sigh
[18:48:38] *** Quits: geoffhill (geoffhill@moz-244CF33A.amazon.com) (Ping timeout)
[18:49:04] <cmr> Why does this irc network get this spam?
[18:50:16] <tjc> cmr: why does any network ever get any spam? =)
[18:50:26] <cmr> tjc: good question
[18:50:32] <cmr> silly humans
[18:50:44] <tjc> because the cost of sending it is extremely low, and the payoff is greater than that cost
[18:52:55] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[18:54:23] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[19:02:21] <cmr> tjc: can you respond to https://github.com/mozilla/rust/issues/9003 ?
[19:02:34] <tjc> cmr: Yes, sorry, it's in my inbox to respond to
[19:15:50] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[19:22:07] *** Quits: nrc (nrc@DA4ABEAF.1DE10CA8.D8E68FF6.IP) (Ping timeout)
[19:28:40] *** Quits: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com) (Quit: Leaving)
[19:37:54] <strcat> I really don't understand why destructors take this weird code path (get_res_dtor)
[19:38:11] <tjc> strcat: historical accident
[19:38:33] <strcat> going to try to fix this so generic destructors can work... cross-crate stuff makes it really annoying ;p
[19:38:35] <tjc> before traits and impls, only "resources" had destructors
[19:38:47] <tjc> a "resource" was a weird thing that wasn't exactly a type, or exactly the same thing as anything else
[19:39:01] <strcat> well, that explains why destructors are so weird :)
[19:39:05] <tjc> yep
[19:39:14] <strcat> https://gist.github.com/thestinger/7132988 I ran into it with this (user-defined allocators for containers)
[19:39:41] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[19:39:41] <strcat> fairly bad error message too ;p, complains about missing vtables when it really just wants compile-time information afaict.
[19:39:46] <tjc> Yeah
[19:40:00] <tjc> error messages raised by trans that actually reflect typechecker bugs are not rare
[19:41:11] <strcat> I'm tempted to look back in the history and see what resources were
[19:41:15] <strcat> I was only here for drop blocks :)
[19:42:05] <tjc> heh
[19:42:13] <tjc> you should be able to find an old version of the reference manual, if nothing else
[19:42:20] <tjc> hmm, well, assuming resources were ever documented
[19:42:34] <tjc> probably looking in the history at the old test cases for destructors is the most reliable way :-)
[19:43:20] *** Quits: StarLight (StarLight@moz-3D8C0C7A.dynamic.avangarddsl.ru) (Ping timeout)
[19:43:25] <kimundi> strcat: Did you see nmatsakis blog posts about a safety issue with Iterators over &mut T ?
[19:43:49] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[19:44:18] *** Joins: StarLight (StarLight@moz-9EB0C86E.dynamic.avangarddsl.ru)
[19:44:31] * strcat was surprised a long time ago when implementing &mut iterators over trees didn't hit an error
[19:45:41] <strcat> because the compiler can't know you only have a next method and you're never going to look in the other nodes again
[19:48:22] <nmatsakis> strcat: actually, that gives me a thought
[19:48:45] <nmatsakis> you could implement a safe mut vec iterator with a different primitive (which would itself be unsafe, but less scarily so)
[19:49:15] <nmatsakis> fn pop<'v, T>(v: &mut &'v mut [T]) -> &'v mut T
[19:49:30] <nmatsakis> which basically removes front most element from *v, updates *v not to include it, and then returns that pointer
[19:49:43] <strcat> nmatsakis: that's essentially what next() is though
[19:49:43] <nmatsakis> that's relatively easy to validate
[19:50:00] <strcat> D calls next pop, and next_back pop_back
[19:50:01] <nmatsakis> yeah, but it's...not the way I implemented it in that example :)
[19:50:18] *** Quits: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr) (Quit: ZNC - http://znc.sourceforge.net)
[19:50:24] <nmatsakis> but yeah 
[19:50:35] <nmatsakis> point is, the "unsafe primitive" you need is smaller than I originally thought
[19:50:38] <kimundi> nmatsakis: Heh, I assumed you picked that example on purpose :)
[19:51:02] <nmatsakis> kimundi: well, it's still true that you need unsafe code somewhere,
[19:51:12] <kimundi> nmatsakis: Yeah
[19:51:12] <nmatsakis> because the safe mechanism we have doesn't quite work,
[19:51:28] <nmatsakis> but limiting it to pop feels fine to me
[19:51:29] <kimundi> But _everything_ uses unsafe code far enough down :P
[19:51:31] <nmatsakis> right
[19:51:42] <kimundi> So I don't think thats bad
[19:51:46] <nmatsakis> no, I don't either.
[19:51:51] <strcat> the unsafe iterator implementation in std::vec is actually more sound than slices because it doesn't do inbounds GEP past the end of an array of zero-size types
[19:51:58] * strcat finds it easier to *not* have to deal with trans
[19:52:03] <kimundi> haha
[19:52:17] <nmatsakis> strcat: well, my main point was that I wanted there to be a "safe variant" of the unsafe code that's in vec now,
[19:52:26] <strcat> ah
[19:52:28] <nmatsakis> strcat: that is, the unsafe code that's there is for perf, and that's fine,
[19:52:37] <nmatsakis> but if you didn't care about perf, you should be able to write it safely
[19:52:43] *** Joins: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr)
[19:52:56] <nmatsakis> it's still true that this approach doesn't "generalize"
[19:53:06] <nmatsakis> well, it sort of does
[19:53:09] <kimundi> having a &mut [T] where you're poping the front and back elements from seems fine for that
[19:53:11] <nmatsakis> as I recall, when you posed the tree problem,
[19:53:21] <nmatsakis> I came up with a sol'n that was basd on the same principle,
[19:53:29] <nmatsakis> that is, keeping a queue of "nodes to visit" or something
[19:53:36] <nmatsakis> I'll have to go look back at the code
[19:53:51] <strcat> nmatsakis: it would be nice if we didn't have a distinction between slices/iterators at all, but I think there are performance concerns
[19:54:04] *** Quits: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr) (Quit: ZNC - http://znc.sourceforge.net)
[19:54:49] <strcat> the iterator is (ptr, end_ptr) to avoid needing a length update
[19:55:06] <strcat> and a slice is (ptr, len) to avoid needing pointer arithmetic to get the length
[19:55:56] *** Joins: nrc (nrc@moz-BAE8D951.pck.nerim.net)
[19:56:33] <strcat> slices could be a library type too ;p
[19:56:38] <strcat> but the sugar is nice
[19:57:15] <eddyb> make sugar configurable pls :)
[19:57:27] <eddyb> i.e. desugar to lang items
[19:57:33] <nmatsakis> strcat: anyway, hmm, I'll have to ponder this, write a follow up post. 
[19:57:50] <strcat> eddyb: slices are a primitive thing anyway (block of memory)
[19:58:11] <strcat> the ~T and ~[T] sugar is more an annoyance than a help when you want to have allocators, handling out-of-memory, etc.
[19:59:33] *** Joins: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr)
[20:00:54] <strcat> I broke Drop even more \o/
[20:00:57] <strcat> now it just segfaults
[20:01:04] <kimundi> yay
[20:01:19] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[20:01:19] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14f36a651 to 147075eb3: 02http://git.io/N3iJvQ
[20:01:19] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[20:01:23] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[20:01:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/4F2YdA
[20:01:23] <ghrust> 13rust/06auto 14e53aae4 15Marvin LÃ¶bel: Cleaned, documented, wrote tests for up std::bool...
[20:01:23] <ghrust> 13rust/06auto 1461f8c05 15bors: auto merge of #10007 : Kimundi/rust/add_docs_01, r=cmr...
[20:01:23] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[20:06:55] <eddyb> strcat: about rust-core, do what you may. I'm obviously not fit enough for any kind of development :(
[20:07:10] <strcat> eddyb: hm?
[20:07:17] <strcat> it's just not possible to implement allocators yet :(
[20:07:19] <strcat> compiler bug
[20:07:24] <eddyb> nah forget that
[20:08:17] <eddyb> strcat: I got frustrated earlier today because I couldn't keep up. done nothing this week and tomorrow's my lame ass bday. I don't feel like I can start working on anything at all
[20:09:30] <eddyb> strcat: just don't worry about rustic's use of rust-core. or discuss that with pcmattman
[20:10:08] *** fredy is now known as fredy_away
[20:10:12] *** fredy_away is now known as fredy
[20:12:50] *** Quits: eddyb (eddy@37F72125.9065A63B.FCAAE698.IP) (Quit: Konversation terminated!)
[20:13:15] *** Quits: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr) (services.mozilla.org (Too many invalid passwords))
[20:13:22] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[20:13:23] *** Joins: eddyb (eddy@37F72125.9065A63B.FCAAE698.IP)
[20:13:24] *** Joins: lkuper (lkuper@moz-6A5F610D.dhcp-bl.indiana.edu)
[20:14:03] *** Joins: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr)
[20:14:38] *** Quits: lkuper (lkuper@moz-6A5F610D.dhcp-bl.indiana.edu) (Quit: lkuper)
[20:14:54] *** Joins: lkuper (lkuper@moz-6A5F610D.dhcp-bl.indiana.edu)
[20:15:26] *** Quits: eddyb (eddy@37F72125.9065A63B.FCAAE698.IP) (Ping timeout)
[20:20:17] <acrichto> brson: got a sec to talk about linked failure and I/O?
[20:22:03] <acrichto> pcwalton: is there a reason that glue_drop doesn't use invoke instructions?
[20:22:20] <pcwalton> acrichto: does it cause problems to invoke while unwinding?
[20:22:23] <pcwalton> I'm not sure
[20:22:28] <acrichto> https://gist.github.com/alexcrichton/7144291
[20:22:30] <pcwalton> I guess not
[20:22:33] <acrichto> that program will never ptint "dropping b"
[20:22:43] <pcwalton> yikes
[20:22:58] <acrichto> the linked failure causes the drop method of A to fail
[20:23:08] <acrichto> and the glue_drop for struct A doesn't use an invoke instruction to call A's "fn drop"
[20:23:13] <acrichto> so the fields are never dropped
[20:23:16] <pcwalton> yeah, that's bad.
[20:23:29] <acrichto> that only took a week to figure out
[20:23:40] <acrichto> I'll open an issue
[20:23:47] <pcwalton> acrichto: talk to strcat, he's looking at drop glue right now.
[20:26:12] <acrichto> pcwalton: oh this is just https://github.com/mozilla/rust/issues/910
[20:29:35] *** Quits: lbergstrom (Adium@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net) (Quit: Leaving.)
[20:33:00] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[20:36:54] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[20:37:59] *** Quits: tikue_ (tikue_star@7FD2F500.F3E8A984.689607DE.IP) (Ping timeout)
[20:38:17] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[20:39:32] *** Joins: eddyb9 (eddy@37F72125.9065A63B.FCAAE698.IP)
[20:39:51] <nmatsakis> strcat: kimundi: http://smallcultfollowing.com/babysteps/blog/2013/10/24/iterators-yielding-mutable-references-take-2/
[20:39:57] <nmatsakis> also pcwalton  brson ^
[20:40:18] <pcwalton> nmatsakis: cool, will read
[20:40:23] <pcwalton> now
[20:41:21] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[20:41:30] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Ping timeout)
[20:42:19] <kimundi> nmatsakis: Completely irrelevant, but instead of 'data.slice(1, data.len())' we have 'data.slice_from(1)' these days :)
[20:42:25] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[20:42:52] <nmatsakis> kimundi: yeah, true.
[20:43:22] <nmatsakis> kimundi: updated :) might as well make Rust not look crufty. It's also true that (*data)[0] can be written data[0]
[20:43:33] <nmatsakis> kimundi: but I thought that might be less clear for people not familiar with our autoderef rules
[20:45:03] <kimundi> True, making the blog entry understandable is more important than making the code elegant
[20:46:19] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[20:47:39] *** Joins: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com)
[20:47:49] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[20:48:37] <brson> nmatsakis: that's clever. nice thinking
[20:49:53] *** Quits: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com) (Ping timeout)
[20:50:43] *** Joins: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com)
[20:53:56] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[20:54:39] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[20:55:21] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[20:55:21] *** ChanServ sets mode: +o pnkfelix
[20:58:17] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[20:58:49] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[20:58:58] *** Quits: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com) (Ping timeout)
[21:01:12] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[21:01:26] *** Joins: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com)
[21:01:31] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[21:02:25] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[21:02:37] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[21:02:58] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[21:04:35] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[21:06:14] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[21:06:14] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/4F2YdA
[21:06:14] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[21:06:53] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[21:07:30] *** Quits: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com) (Ping timeout)
[21:07:37] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[21:10:06] *** Joins: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com)
[21:10:56] *** Joins: tjc (tjc@moz-FF2FB35A.lightspeed.sntcca.sbcglobal.net)
[21:10:56] *** ChanServ sets mode: +o tjc
[21:11:12] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[21:11:13] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/wgJjwA
[21:11:13] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[21:11:19] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[21:11:42] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[21:12:54] *** Quits: nrc (nrc@moz-BAE8D951.pck.nerim.net) (Ping timeout)
[21:13:36] *** Joins: nrc (nrc@moz-BAE8D951.pck.nerim.net)
[21:15:27] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[21:15:59] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[21:18:53] *** Joins: lbergstrom (Adium@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net)
[21:19:27] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[21:19:42] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[21:23:16] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[21:23:44] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[21:26:15] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[21:26:15] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/wgJjwA
[21:26:15] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[21:26:16] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[21:26:17] <ghrust> 01[13rust01] 15bors pushed 24 new commits to 06auto: 02http://git.io/0NWwNA
[21:26:17] <ghrust> 13rust/06auto 14bac9681 15Alex Crichton: Implement io::net::unix
[21:26:17] <ghrust> 13rust/06auto 141db783b 15Alex Crichton: Finish implementing io::net::addrinfo...
[21:26:17] <ghrust> 13rust/06auto 14c6fa4e2 15Alex Crichton: Address a few XXX comments throughout the runtime...
[21:26:19] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[21:26:52] *** Quits: nrc (nrc@moz-BAE8D951.pck.nerim.net) (Ping timeout)
[21:31:39] <strcat> Global is external, but doesn't have external or dllimport or weak linkage!
[21:31:41] <strcat> :s
[21:31:45] *** Quits: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com) (Ping timeout)
[21:31:57] <strcat> this is the weirdest LLVM error message ever
[21:32:06] <strcat> it's external but it's not external?
[21:33:22] *** Joins: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com)
[21:34:23] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[21:34:38] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[21:34:55] <strcat> ah
[21:35:02] <strcat> I made it so that dtors aren't being inlined by default
[21:35:08] <strcat> but the tydesc... expects them to be?
[21:35:10] <strcat> hm
[21:35:15] <tjc> strcat: I think before, dtors were always inlined
[21:35:18] <tjc> I can't remember, though
[21:35:21] <tjc> It was either always or never :-)
[21:35:26] <strcat> they are always regenerated in every crate atm
[21:35:35] <strcat> and I stopped that  by fixing this part to work like methods
[21:35:40] <strcat> this error is so weirs
[21:35:42] <strcat> weird*
[21:35:59] <strcat> it checks that it has external linkage, then notices that it *also* has local linkage and bails out
[21:36:09] <strcat> and then... says it doesn't have external linkage
[21:36:43] <tjc> Yeah, that sounds like errors I saw when I was working on classes :-)
[21:36:58] * strcat should just turn off the verifier and look at the IR
[21:37:23] <tjc> probably, yeah
[21:37:26] <strcat> tjc: yeah it happens from xcrate uses of libstd dtors in libextra
[21:37:55] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[21:38:26] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[21:38:33] <strcat> a weird puzzle.
[21:38:42] <tjc> only libextra? Or any other library?
[21:38:51] <strcat> tjc: well it doesn't make it further :)
[21:39:12] <tjc> strcat: Sure, you can run the compiler directly on a test case that only uses libstd, though, without building extra :-)
[21:39:26] <tjc> for me, that was always an easier way to make progress than bootstrapping first
[21:39:48] <strcat> yeah dtors don't work at all anymore, at least it's not an edge case
[21:41:33] <strcat> huh.
[21:41:35] <strcat> it makes two
[21:41:39] <strcat> define internal void @"_ZN22std..rc..Rc$LT$int$GT$9glue_drop19h579632b9eaa157a8a2E"({}*, %"struct.std::rc::Rc<int>[#1]"*) #6 {
[21:41:41] <strcat> with an actual def
[21:41:44] <strcat> declare internal void @"_ZN2rc7Drop$Rc4drop21hc088e0a0709be710QMa44v0.0E"({ i64, %tydesc*, i8*, i8*, i8 }*)
[21:41:46] <strcat> without one >.<
[21:41:58] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[21:42:07] <strcat> the assert is poorly worded, it's mad that there's an internal function with no definition
[21:42:30] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[21:43:20] <strcat> and... fixed, I think
[21:43:41] <tjc> yeah, there must be two different places in trans that mangle names for dtors, and do it slightly differently
[21:43:48] <tjc> Actually, i think the code for the decl is different from the code for the body
[21:43:53] <tjc> wouldn't surprise me at all, anyway :-)
[21:43:55] <strcat> tjc: no I think I'm translating it twice ;p
[21:44:01] <tjc> strcat: Ah, ok
[21:44:07] *** Joins: geoffhill (geoffhill@moz-244CF33A.amazon.com)
[21:44:18] <strcat> hrm
[21:46:39] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[21:46:40] <strcat> attempt 2!
[21:47:06] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[21:47:41] <acrichto> brson: what was the main reason for removing the crate map from the start function again?
[21:49:02] *** Quits: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com) (Quit: Leaving)
[21:49:20] <strcat> tjc: I think I know why dtors can't be inlined too...
[21:49:29] <tjc> strcat: why?
[21:49:34] <strcat> all the mistakes are neatly arranged in a single if-else
[21:49:46] <tjc> mistakes?
[21:49:55] <strcat> tjc: it just assumes it is a) generic, b) local or c) external
[21:50:08] <strcat> tjc: well this get_res_dtor function looks like it was never updated when the regular code path was
[21:50:25] <tjc> strcat: "it" being the monomorphizing code?
[21:50:31] <strcat> tjc: base::get_res_dtor
[21:50:39] <strcat> it doesn't follow the normal trans_fn path
[21:50:44] <tjc> Ah, yeah
[21:50:44] <strcat> it skips a lot of stuff
[21:50:53] <tjc> Right, the inevitable result of having two code paths
[21:51:00] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[21:51:02] <strcat> I think I've got it following the correct code path now
[21:51:07] <strcat> just working out other fallout ;p
[21:51:14] <brson> acrichto: primarily so there is no before main code emitted by rustc and 'start' is just the C main function
[21:51:17] <tjc> \o/
[21:51:22] <strcat> basically.... just have it using trans_fn_ref now instead of skipping to monomorphic_fn
[21:51:46] <acrichto> brson: hm, I wish weak symbols worked better on windows then...
[21:51:51] <strcat> it's nice when I don't even have to write any LLVM calls
[21:52:07] <strcat> every time I write a Store or a Load I always get the pointer indirection off by one.
[21:52:12] <brson> acrichto: is the solution we are using problematic?
[21:52:43] <acrichto> brson: for the crate map we know the symbol name (and do an explicit dynamic library lookup ourselves), but with my "event loop factory" idea we don't know the symbol name and I was hoping to avoid hardcoding it
[21:53:03] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[21:53:30] <brson> acrichto: can a pointer be put into the crate map?
[21:54:04] * acrichto smacks forehead
[21:54:20] <tjc> cmr: I replied at https://github.com/mozilla/rust/issues/9003#issuecomment-27015645 , sorry I was a little slow with the response!
[21:56:10] <acrichto> brson: btw turned out linked failure was causing my problems in libuv
[21:56:48] <acrichto> brson: https://gist.github.com/alexcrichton/7144291 doesn't have B's destructor run b/c glue_drop doesn't use invoke instructions (we haven't defined what it means to be failing while failing)
[21:57:15] <acrichto> and all of the I/O uses destructors to invoke libuv's close functions, and then after that's done the home handle is destroyed, but the home handle wasn't getting destroyed (because of linked failure)
[21:57:27] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[21:57:50] <acrichto> for now this was only a problem because the only instance of movement of an I/O resource between tasks was in run::process_output (two tasks spawned to read off stderr/stdout), so for now I changed spawn to spawn_unlinked
[21:58:04] <acrichto> the story for I/O in general with linked failure is going to need some fleshing out though
[21:58:19] * acrichto is just praying 9901 finally lands
[21:58:57] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[22:00:01] <brson> acrichto: that's sad that drop glue doesn't invoke. that seems like an easy change to make, even if we don't define what double failure does
[22:00:35] <acrichto> brson: I was hesitant to do so b/c I don't think that I quite gasp the implications just yet
[22:00:47] <acrichto> I don't *think* that it matters because we never actually throw twice as-is
[22:01:33] <brson> throwing twice should result in an abort currently
[22:01:40] <acrichto> it does
[22:02:27] <acrichto> brson: I was also thinking that the Exclusive acquiring a wait/signal interface is a bit sad
[22:02:46] <acrichto> I may just manually manage the lock for basicloop
[22:03:04] <acrichto> Exclusive seems like a nice interface we would want to expose externally
[22:03:56] <strcat> tjc: ick, the problem seems to be that it creates a call to a destructor with a local name, but I actually translate the function with a name like std::Foo::Drop (mangled, ofc)
[22:03:59] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[22:04:28] * strcat doesn't understand why that happens...
[22:05:07] <tjc> strcat: it's a destructor defined in libstd?
[22:05:10] <strcat> yeah
[22:05:33] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[22:05:45] <strcat> trans_fn_ref seems to be the issue
[22:06:04] <tjc> trans has a notion of whether or not a function is exported
[22:06:11] <strcat> it defines it with the "foreign" name
[22:06:18] <tjc> maybe there's inconsistency about whether or not destructors are considered "exported"
[22:07:59] <cmr> tjc: my other unresolved questino about rustpkg is how to have a crate which is both a library and an executable at the same time.
[22:08:33] <tjc> cmr: interesting question. It had never occurred to me that that was a thing someone would want to do
[22:08:43] <cmr> rustdoc used to do it
[22:10:11] <acrichto> I find myself comenting out #[crate_type = "lib"] for rustdoc all the time
[22:11:53] <tjc> hmm
[22:11:58] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[22:12:06] <acrichto> fairly minor use case though
[22:12:13] <tjc> cmr: So, I think the way right now is to do a similar thing to the "alternate test crate root" approach that we're getting rid of for tests
[22:12:29] <tjc> and yes, that has the same problem as the test crate root, which is that you have to duplicate all the `extern mod` and `mod` directives
[22:12:36] <tjc> but I think it's a sufficiently rare case that it's probably okay
[22:12:44] <tjc> if it ends up being too painful, we can re-think that, but for now, try it
[22:13:16] <kimundi> WHy does it need to be both a library and a executable?
[22:13:44] *** Quits: lkuper (lkuper@moz-6A5F610D.dhcp-bl.indiana.edu) (Quit: lkuper)
[22:13:45] <kimundi> cmr: Can't you just make a stube executable that uses the library?
[22:13:51] <kimundi> stub*
[22:14:27] *** Joins: lkuper (lkuper@moz-6A5F610D.dhcp-bl.indiana.edu)
[22:15:38] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[22:16:08] <strcat> tjc: how do I convert a DefId for a generic fn from another crate to a NodeId? hrm
[22:16:13] <strcat> I think that's what I'm doing wrong
[22:16:27] * strcat was just reading the node field
[22:17:09] <tjc> strcat: The DefID encodes both the crate identity and the item identity, so a NodeID from a foreign crate doesn't really mean anything without the crate ID
[22:18:34] *** Quits: lkuper (lkuper@moz-6A5F610D.dhcp-bl.indiana.edu) (Quit: lkuper)
[22:18:42] <Luqman> strcat: if you're trying to get the item associated with some NodeId and it's cross crate you'll have to go through csearch afaik
[22:20:30] <strcat> I have a DefId 'class id' for a method in another crate and need to get the vtables, basically
[22:21:07] <strcat> I don't really see where the normal function translation does this, but it must because cross-crate generics work
[22:21:53] <tjc> So do cross-crate destructors not work at all right now? If so, the bug is probably that the metadata encoder isn't dumping the ASTs for the destructor bodies into the crate metadata
[22:22:04] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[22:22:06] <strcat> tjc: they work
[22:22:14] <tjc> Ok, so they must be there in the metadata
[22:22:17] <tjc> Wait, no
[22:22:20] <strcat> but type bounds on destructors don't work, and inlining cross-crate destructors doesn't work
[22:22:21] <Luqman> strcat: trait methods? it may be ty::provided_trait_methods which does the cross-crate magics
[22:22:36] <tjc> is it that *generic* destructors specifically don't work? Sorry, you probably said, but I'm trying to carry on two conversations at once :-)
[22:22:50] <strcat> tjc: yes, generic destructors (if they have a type bound) don't work
[22:22:58] <strcat> because we don't pass the vtables to monomorphic_fn
[22:23:25] <strcat> and the vtable getters want a NodeId
[22:23:35] <tjc> Yeah
[22:23:37] <strcat> but the reference to the 'class' is a DefId
[22:23:39] <tjc> So it could be a metadata problem
[22:23:50] <tjc> because only generic things need to have their monomorphizable bodies get dumped into the metadata
[22:23:55] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[22:24:03] <tjc> It sounds like the vtable getters should take a DefID
[22:24:04] <tjc> huh
[22:24:06] <tjc> I wonder why that works at all
[22:25:10] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[22:25:18] <acrichto> \o/ std::io is gone!
[22:25:31] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[22:25:31] *** ChanServ sets mode: +o pnkfelix
[22:26:02] <Luqman> i though generic destructors didn't work on type by type basis since we kept track of it in a table key-ed on the DefId of the struct and hence applied to all instantiations
[22:26:55] <strcat> well it just calls monomorphic_fn 
[22:27:01] <strcat> it doesn't keep track of a table itself
[22:27:14] <strcat> if we passes vtables to monomorphic_fn, afaik type bounds would Just Work
[22:27:19] <strcat> if we passed*
[22:27:36] <strcat> this is a layer of rustc I truly don't understand ;p
[22:27:43] <strcat> the low-level trans parts I understand...
[22:28:03] <Luqman> i meant the destructor_for_type hashmap on tcx
[22:28:17] <cmr> kimundi: not if I want to use internals
[22:28:29] <strcat> Luqman: oh I don't think that's used in trans
[22:28:46] <strcat> trans just lets monomorphic_fn do everything
[22:28:52] <strcat> this code *does* typeck already
[22:29:02] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[22:29:09] <cmr> kimundi: once I thought about it more I realized there's no cases where I'd actually want that though; if extern mod isn't sufficient, then the library isn't useful.
[22:29:32] <strcat> LTO will strip every symbol but main if there is main
[22:31:02] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[22:31:02] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/0NWwNA
[22:31:02] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[22:31:44] <cmr> strcat: sure, the problem is making rustpkg build an executable.
[22:31:51] <cmr> acrichto: you killed std::io? :D
[22:31:55] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[22:34:11] <strcat> acrichto: std::io is gone? I can finally send in the char PR I made ages ago
[22:34:18] <strcat> acrichto: https://github.com/mozilla/rust/pull/10056 r?
[22:34:25] <acrichto> haha that was fast
[22:34:58] <strcat> also fixes bools to not be considered signed there but it doesn't matter.
[22:35:20] <acrichto> hm I suppose bools are indeed not signed
[22:35:50] <strcat> it only matters if you use the sign bit anyway but.... why not tell LLVM the truth ;p
[22:35:59] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[22:36:43] <strcat> tjc: http://ix.io/8K8 on the positive side, I fixed this bug unintentionally
[22:37:27] <strcat> sort of fixed... it looks wrong
[22:37:29] * strcat sighs
[22:37:42] <tjc> strcat: Ah, metadata bugs, always the best
[22:37:45] <tjc> by "best" I mean that other thing
[22:38:10] <acrichto> use std::rt::io::net::ip::{SocketAddr what
[22:38:23] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[22:41:07] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[22:41:07] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/82hvfQ
[22:41:07] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[22:41:10] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[22:41:10] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/9o7Z1w
[22:41:10] <ghrust> 13rust/06auto 14b0378f9 15Daniel Micay: trans: add range asserts to loads of `char`
[22:41:10] <ghrust> 13rust/06auto 1465d7bd3 15bors: auto merge of #10056 : thestinger/rust/char, r=alexcrichton
[22:41:11] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[22:42:07] <strcat> that was part of an attempt to make LLVM do a better job with the unicode matches but I think they became tables now anyway
[22:42:10] * strcat shrugs
[22:42:12] <strcat> can't hurt!
[22:44:33] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[22:46:55] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[22:48:48] *** Quits: nielsle (nielsle@moz-5CE8ECCD.boa.fiberby.dk) (Ping timeout)
[22:52:02] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[22:54:00] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[22:55:39] *** Joins: olsonjeffery (jeff@moz-57D1CF86.compute-1.amazonaws.com)
[22:58:37] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[23:00:12] <strcat> tjc: yeah it's missing from metadata afaict.
[23:00:32] <strcat> and somehow you get *other* functions instead
[23:00:41] * strcat sighs
[23:00:46] <tjc> strcat: haha, color me surprised
[23:00:54] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[23:01:08] <tjc> it's not really so surprising that you get other functions, because there's scary magic that happens to translate local-def-IDs into foreign-def-IDs
[23:01:10] <tjc> during metadata reading
[23:01:13] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[23:01:13] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1465d7bd3 to 143f5b221: 02http://git.io/N3iJvQ
[23:01:13] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[23:01:14] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[23:01:14] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/77KgBw
[23:01:14] <ghrust> 13rust/06auto 14aeaa12b 15Daniel Micay: trans: add range asserts to loads of `char`
[23:01:14] <ghrust> 13rust/06auto 142e0d070 15bors: auto merge of #10056 : thestinger/rust/char, r=alexcrichton
[23:01:14] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[23:01:21] <tjc> and if the set of def IDs isn't consistent from one place to the next, good luck
[23:01:39] <tjc> (naming: the hardest problem in computer science)
[23:03:24] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[23:05:19] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[23:06:02] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[23:07:54] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[23:08:04] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[23:08:08] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[23:08:10] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[23:08:19] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[23:08:21] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[23:08:27] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[23:14:03] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[23:16:27] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[23:22:04] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[23:22:58] <acrichto> it's unfortunate that a call to fail! results in at least 10 stack frames being on the top of a backtrace
[23:23:00] <strcat> acrichto: meh there are still some bad transmutes
[23:24:41] <acrichto> brson: for using the basic loop, I switched everything over in rt::test to using BasicLoop by default, and I'm going one-by-one failure-wise switching them back to libuv if they need I/O services
[23:24:47] <strcat> I forgot I marked them all with FIXMEs
[23:24:54] <acrichto> strcat: where are the others?
[23:24:57] <strcat> json
[23:25:00] <strcat> and some others
[23:25:00] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[23:25:06] <acrichto> json should be update-able now
[23:25:07] <acrichto> ish
[23:25:58] <strcat> acrichto: grep for 8971
[23:26:16] <strcat> I'll deal with them later
[23:26:17] <acrichto> haha the lexer
[23:26:20] <strcat> yeah
[23:26:24] <strcat> that's where that error came from :D
[23:26:38] <strcat> it most certainly did optimize based on it ;p
[23:26:54] <acrichto> that's pretty cool actually
[23:27:22] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[23:27:28] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[23:27:59] <acrichto> man hashmaps need task_rng which needs osrng which nees io services
[23:28:05] <acrichto> and task::spawn creates an empty hash set
[23:28:06] <acrichto> :(
[23:29:03] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[23:33:12] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[23:33:21] <acrichto> pnkfelix: wow this is printing a lot
[23:33:32] <acrichto> pnkfelix: compiling libstd with regionmanip
[23:33:35] <pnkfelix> acrichto: which is?
[23:33:36] <acrichto> but it worked!
[23:33:42] <pnkfelix> acrichto: then you're getting further than I am
[23:33:43] <acrichto> no segfaults that is
[23:33:48] <acrichto> pnkfelix: 9901 just landed
[23:33:49] <pnkfelix> acrichto: what host oS ?
[23:33:51] <acrichto> about an our ago
[23:33:54] <pnkfelix> acrichto: oh I see
[23:35:00] <pnkfelix> acrichto: hmm.  Do i keep digging to ensure I understand the original problem, or do I just rebase to latest master ...
[23:35:23] <acrichto> pnkfelix: I don't think there's much of a problem to investigate
[23:35:24] *** Quits: tjc (tjc@moz-FF2FB35A.lightspeed.sntcca.sbcglobal.net) (Quit: zzzzzzzzzz)
[23:35:37] <acrichto> our printing code was tenuous at best (didn't handle all the right errno's) with native file I/O
[23:35:46] <acrichto> one unhandled error triggers a stack overflow
[23:35:54] <acrichto> b/c we attempt to print our errors
[23:35:58] <pnkfelix> acrichto: yes I know
[23:36:01] <pnkfelix> acrichto: I worked around that
[23:36:13] <acrichto> so in theory the room for improvement is making our printing more robust (handling more errors), but I don't think that it's really worth the trouble now
[23:37:02] <pnkfelix> acrichto: the thing that worries me is that I'm consistently seeing the failure on fmt's hadling of `{}` on strings.  Switching to `{:?}` makes those instances of the problem go away
[23:37:29] <acrichto> pnkfelix: it could just be that :? makes lots of short writes while {} makes one large write normally
[23:37:34] <acrichto> or vice versa...
[23:37:41] <pnkfelix> acrichto: not a bad theory, actually.
[23:37:48] <acrichto> and long writes having a higher likelihood of getting interrupted or something like that
[23:37:52] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[23:37:56] <acrichto> that is weird though...
[23:45:33] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[23:51:10] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[23:57:01] *** Joins: tjc (tjc@moz-F65A248F.tmodns.net)
[23:57:01] *** ChanServ sets mode: +o tjc
