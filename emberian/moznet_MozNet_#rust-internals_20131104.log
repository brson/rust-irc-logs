[00:00:22] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[00:06:05] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[00:06:06] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1463de29d to 14702767d: 02http://git.io/N3iJvQ
[00:06:06] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[00:06:09] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[00:06:09] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/ctbebw
[00:06:09] <ghrust> 13rust/06auto 14c118b89 15Noufal Ibrahim: Fixed formatting....
[00:06:09] <ghrust> 13rust/06auto 14c4c2b38 15bors: auto merge of #10248 : nibrahim/rust/docformatting, r=pcwalton...
[00:06:10] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[00:11:17] *** Quits: steveklabnik (steveklabn@moz-A4503A72.socal.res.rr.com) (Ping timeout)
[00:11:27] *** Joins: steveklabnik (steveklabn@moz-A4503A72.socal.res.rr.com)
[00:12:08] *** Quits: steveklabnik (steveklabn@moz-A4503A72.socal.res.rr.com) (Quit: leaving)
[00:16:51] *** Joins: ktt3ja (Mibbit@moz-6B6EE8C0.hsd1.va.comcast.net)
[00:24:38] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[00:24:38] <ghrust> 01[13rust01] 15alexcrichton pushed 5 new commits to 06try: 02http://git.io/VIsITg
[00:24:38] <ghrust> 13rust/06try 14d7b6502 15Alex Crichton: Move rt::io traits into the prelude...
[00:24:38] <ghrust> 13rust/06try 147bf58c2 15Alex Crichton: Modify IoFactory's fs_mkdir, and add fs_rename...
[00:24:39] <ghrust> 13rust/06try 149c18510 15Alex Crichton: Remove all blocking std::os blocking functions...
[00:24:41] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[00:44:13] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[00:47:22] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[01:03:42] *** Joins: tjc (tjc@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[01:03:42] *** ChanServ sets mode: +o tjc
[01:06:23] *** Quits: tautologico (shung@4FCDF73C.2F29D054.7B974E06.IP) (Quit: tautologico)
[01:10:48] *** Joins: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP)
[01:11:11] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[01:11:11] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/ctbebw
[01:11:12] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[01:13:34] * dbaupp thought acrichto's io stuff just landed... but then realised he'd pushed to try.
[01:13:44] <acrichto> if only :(
[01:15:07] <sfackler> acrichto: are you okay with me just #[ignore]ing the failing test in https://github.com/mozilla/rust/pull/10254 ?
[01:16:08] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[01:16:08] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/fpc9VA
[01:16:08] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[01:16:15] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[01:16:15] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/KXpJUg
[01:16:16] <ghrust> 13rust/06auto 144ea5fe9 15Daniel Micay: simplify memcpy/memmove/memset intrinsics...
[01:16:16] <ghrust> 13rust/06auto 1420ece7a 15bors: auto merge of #10251 : thestinger/rust/ptr, r=alexcrichton...
[01:16:16] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[01:16:38] <acrichto> sfackler: hm I haven't looked into it much, I'd want to see how bad it was before ignoring it for now
[01:17:40] <sfackler> it's testing to ensure that rustpkg doesn't rebuild tests that didn't change
[01:17:56] *** Quits: tjc (tjc@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: zzzzzzzzzz)
[01:18:05] <acrichto> is it actually running the tests?
[01:18:07] <sfackler> and the way that it checks is to run tests, make the test executable read only and then test again
[01:18:26] <sfackler> and then checking the exit status of the second test run to see if thigns broke
[01:18:45] <acrichto> shouldn't the exit status be that it failed to run the executable?
[01:19:25] <sfackler> right, but rustpkg test always returns a status code of 0 unless compilation fails
[01:19:38] <sfackler> until now
[01:20:08] <acrichto> shouldn't that just expect a different exit status?
[01:20:20] <sfackler> it expects an exit status of 0
[01:20:23] *** Joins: tjc (tjc@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[01:20:23] *** ChanServ sets mode: +o tjc
[01:20:28] <acrichto> but that's how the test should change, right?
[01:20:29] <sfackler> since it shouldn't rebuild, but just run the old tests in place
[01:21:38] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[01:21:46] <acrichto> hm it seems like a better test would be to swap out the executable
[01:24:45] <sfackler> ah, looks like the real bug is that it's setting it to just S_IRUSR instead of S_IRUSR | S_IXUSR
[01:25:00] <sfackler> so yeah, this test should never have worked
[01:28:55] <strcat> ugh, wat
[01:29:15] <strcat> isn't int_type the target int_type?
[01:29:28] <strcat> hrm
[01:30:49] *** Quits: tjc (tjc@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: Places to go, people to annoy)
[01:31:23] <strcat> oh
[01:31:24] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[01:31:24] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1420ece7a to 14c4c2b38: 02http://git.io/N3iJvQ
[01:31:24] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[01:31:25] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[01:31:25] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/fqpkNg
[01:31:25] <ghrust> 13rust/06auto 14da43676 15Huon Wilson: docs: Replace std::iterator with std::iter.
[01:31:25] <ghrust> 13rust/06auto 1429359d0 15bors: auto merge of #10252 : huonw/rust/docs, r=alexcrichton
[01:31:26] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[01:31:26] <strcat> I see the issue :)
[02:19:18] *** Joins: tikue__ (quassel@moz-FEADCD38.hsd1.pa.comcast.net)
[02:19:50] *** Quits: tikue (quassel@moz-FEADCD38.hsd1.pa.comcast.net) (Ping timeout)
[02:36:07] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[02:36:07] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/fqpkNg
[02:36:07] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[02:41:05] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[02:41:05] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/spmZbg
[02:41:05] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[02:41:12] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[02:41:12] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Q0yqfA
[02:41:12] <ghrust> 13rust/06auto 142328ba6 15Alex Crichton: Move io::file to io::fs and fns out of File...
[02:41:12] <ghrust> 13rust/06auto 1492f0b39 15bors: auto merge of #10179 : alexcrichton/rust/rt-improvements, r=cmr...
[02:41:12] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[02:45:58] *** Quits: tikue_ (tikue_star@8AFE1ED2.F3E8A984.689607DE.IP) (Ping timeout)
[02:53:27] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[03:10:32] *** nrc|away is now known as nrc
[03:31:12] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[03:31:12] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1492f0b39 to 1429359d0: 02http://git.io/N3iJvQ
[03:31:12] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[03:31:19] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[03:31:19] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/odJc3Q
[03:31:19] <ghrust> 13rust/06auto 1467966fa 15Daniel Micay: simplify memcpy/memmove/memset intrinsics...
[03:31:19] <ghrust> 13rust/06auto 14556088c 15bors: auto merge of #10251 : thestinger/rust/ptr, r=alexcritchton...
[03:31:19] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[03:36:06] *** Joins: tikue_ (tikue_star@8AFE1ED2.F3E8A984.689607DE.IP)
[03:52:50] *** Quits: zz_kimundi (kimundi@moz-B705BA84.dip0.t-ipconnect.de) (Ping timeout)
[03:56:31] *** Joins: zz_kimundi (kimundi@moz-E2D26A0B.dip0.t-ipconnect.de)
[03:56:32] *** zz_kimundi is now known as kimundi
[04:07:42] *** Joins: strobegen (Adium@A75B6238.EACE1F8D.A133900E.IP)
[04:20:11] *** Joins: SlickRick (SlickRick5@moz-A08E7E6C.hsd1.fl.comcast.net)
[04:21:00] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[04:21:47] <SlickRick> https://www.youtube.com/user/blazetek555
[04:22:13] *** Quits: SlickRick (SlickRick5@moz-A08E7E6C.hsd1.fl.comcast.net) (Z:lined (diaf))
[04:22:29] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[04:41:04] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[04:41:04] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/odJc3Q
[04:41:04] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[05:21:23] *** Joins: sanxiyn (tinuviel@B4104EBB.3CC170B1.1E14B209.IP)
[05:29:29] <strcat> acrichto: *sigh*, they still didn't merge http://llvm-reviews.chandlerc.com/D2034
[05:30:33] <acrichto> strcat: I've found them to be quite selective on merging patches
[05:30:52] <strcat> they'll happily merge it once someone looks at it again
[05:31:05] <strcat> I nagged someone on irc to get that initial review
[05:31:58] <acrichto> would that patch benefit our array indexes?
[05:32:05] <acrichto> array accesses*
[05:32:06] <strcat> yes we already output the expect hint
[05:32:12] <strcat> but it isn't used yet
[05:32:43] <acrichto> :(
[05:37:34] *** Quits: Jesse_ (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Connection reset by peer)
[05:38:07] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[05:45:57] <strcat> acrichto: rust no longer seems to build in a clean clone
[05:45:59] <strcat> ;(
[05:46:22] <acrichto> oh dear
[05:46:25] <acrichto> what's the error?
[05:48:18] <strcat> note: cc: error: i686-unknown-linux-gnu/stage1/lib/rustc/i686-unknown-linux-gnu/lib/lib.o: No such file or directory
[05:48:29] <strcat> this is without make -jN
[05:48:47] <acrichto> what's the target it was making?
[05:49:27] <strcat> /build/rust-git/src/rust/mk/tools.mk:132: recipe for target 'i686-unknown-linux-gnu/stage1/lib/rustc/i686-unknown-linux-gnu/lib/librustdoc.so' failed
[05:49:35] <dbaupp> like an empty variable?
[05:49:38] <dbaupp> *looks like
[05:49:58] <acrichto> strcat: did rustc print that out?
[05:50:06] <strcat> hm?
[05:50:06] <acrichto> the 'No such file or directory'
[05:50:25] <strcat> rustc called gcc and gcc printed it out
[05:50:34] <strcat> error: linking with `cc` failed with code 1
[05:50:35] <strcat> note: cc arguments: -L/build/rust-git/src/rust/i686-unknown-linux-gnu/stage1/lib/rustc/i686-unknown-linux-gnu/lib -m32 -o i686-unknown-linux-gnu/stage1/lib/rustc/i686-unknown-linux-gnu/lib/librustdoc-a437806a76c5f37a-0.9-pre.so i686-unknown-linux-gnu/stage1/lib/rustc/i686-unknown-linux-gnu/lib/lib.o
[05:50:37] <strcat> -L/build/rust-git/src/rust/i686-unknown-linux-gnu/stage1/lib/rustc/i686-unknown-linux-gnu/lib -lstd-6c65cf4b443341b1-0.9-pre -L/build/rust-git/src/rust/i686-unknown-linux-gnu/stage1/lib/rustc/i686-unknown-linux-gnu/lib -lextra-a7c050cfd46b2c9a-0.9-pre -L/build/rust-git/src/rust/i686-unknown-linux-gnu/stage1/lib/rustc/i686-unknown-linux-gnu/lib -lsyntax-64629f7f0c6a9bc-0.9-pre
[05:50:39] <strcat> -L/build/rust-git/src/rust/i686-unknown-linux-gnu/stage1/lib/rustc/i686-unknown-linux-gnu/lib -lrustc-d3cb8c2ccd84a7a7-0.9-pre -lsundown -Li686-unknown-linux-gnu/rt/sundown -L/build/rust-git/src/rust/.rust -L/build/rust-git/src/rust -shared -lrt -ldl -lm -lmorestack -lrustrt -Wl,-rpath,$ORIGIN/.
[05:50:41] <strcat> -Wl,-rpath,/build/rust-git/src/rust/i686-unknown-linux-gnu/stage1/lib/rustc/i686-unknown-linux-gnu/lib -Wl,-rpath,/usr/lib/rustc/i686-unknown-linux-gnu/lib
[05:50:43] <strcat> note: cc: 
[05:50:45] <strcat> heh, line wrapping made that pretty long
[05:50:55] <strcat> (the note: cc: thing is the error above)
[05:51:01] <acrichto> strcat: could you paste the log of make?
[05:51:06] <strcat> yes
[05:52:20] <strcat> acrichto: http://sprunge.us/WOMB hm
[05:52:32] <strcat> that's from earlier
[05:52:36] <strcat> before I tried without -j4
[05:53:49] <acrichto> well it got everything correct except for lib.o => rustdoc.o
[05:54:04] <acrichto> oh haha
[05:54:12] <strcat> hm?
[05:54:12] <acrichto> this must have been the rustdoc.rs => lib.rs change
[05:54:24] <acrichto> or not wait what?
[05:54:38] <acrichto> it has #[link(name = "...")]
[05:55:04] <acrichto> strcat: if you look in that directory is there a rustdoc.o lying around?
[05:55:20] <strcat> I can't look in the dir :(
[05:55:35] <acrichto> ah oh well
[05:55:48] <acrichto> we have so many linker flags :(
[05:56:10] <strcat> hm
[05:56:12] <acrichto> oh wait
[05:56:16] <strcat> cron hates me suddenly
[05:56:17] <acrichto> that may be because of -j
[05:56:29] <acrichto> if you build librustpkg and librustdoc simultaneously 
[05:56:29] <strcat> yeah it's refusing to let me start new jobs now 
[05:56:32] <acrichto> and they both output lib.o
[05:56:35] <acrichto> one's gonna remove it
[05:56:39] <strcat> ha
[05:56:55] <acrichto> we must not name the temp .o file based on the #[link] name
[05:57:59] <acrichto> oh dear there is a lot of logic building those filenames
[05:58:42] <acrichto> hm no it should pick up on the link name
[05:58:47] <benh> I tried to figure out the correspondence of command line parameters to output filenames a while ago for some simple issue and gave up like four layers into it :(
[05:59:26] * dbaupp wants rustpkg, but guesses it will just move the complexity to be in a .rs file rather than a .mk file.
[05:59:47] <acrichto> although rust is arguably much easier to read than make
[06:00:06] <acrichto> $(CC) -o $@ -c $<
[06:00:06] <dbaupp> I guess we have proper loops etc, true.
[06:00:07] <acrichto> what
[06:00:15] <dbaupp> *magic*
[06:00:19] <olsonjeffery> as time progresses, the probability of a non-trivial project's build infrastructure becoming complete spaghetti approaches 1
[06:00:19] <acrichto> also $^ vs $<
[06:01:29] <acrichto> $$(STAGE$(1)_T_$(4)_H_$(3)) $$(WFLAGS_ST$(1)) --out-dir $$(@D) $$< && touch $$@
[06:01:33] <acrichto> just gonna leave that there
[06:01:52] <strcat> acrichto: have you seen autotools projects? ;p
[06:02:01] <acrichto> thankfully no
[06:02:04] <strcat> the best part is that they all bundle those horrible check rules
[06:02:07] <strcat> and they get out of date
[06:02:09] <acrichto> I want to keep my eyes plz
[06:02:18] <dbaupp> a language with more sigils than Rust  \o/
[06:02:30] <strcat> acrichto: so, autotools projects basically compile 200 C programs
[06:02:32] <strcat> to check for features
[06:02:34] * dbaupp migrates all his code into make
[06:02:40] <aatch> I love autotools projects. They take the problem of writing makefiles and make it the problem of writing of a makefile generator
[06:02:40] <strcat> cross-compilation? what's that? you have to cache results
[06:02:55] <acrichto> strcat: this is the bug, it's not even using the crate attributes
[06:03:32] <acrichto> yup
[06:03:43] <acrichto> ok so how to test this...
[06:03:54] * strcat is glad he found a real bug but would like it if cron let him start a job now
[06:04:10] <strcat> Message-Id: <20131103214947.A3372C002D@mail.pkgbuild.com>
[06:04:11] <strcat> Date: Sun,  3 Nov 2013 21:49:47 +0000 (UTC)
[06:04:12] <acrichto> to start a cron one must first embrace the cron
[06:04:13] <strcat> From: thestinger@pkgbuild.com (fcron)
[06:04:15] <strcat> build_and_add:13: 'i686' build for 'rust-git' failed
[06:04:17] <strcat> thanks cron
[06:05:10] <acrichto> <3 cron
[06:05:23] <strcat> timer units are so much better :(
[06:05:42] <acrichto> strcat: https://gist.github.com/alexcrichton/7298652
[06:05:52] <strcat> \o/
[06:06:03] <acrichto> need to figure out how to test it though
[06:06:07] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[06:06:07] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/-4Kd5A
[06:06:07] <ghrust> 13rust/06auto 141850d26 15Alex Crichton: Remove lots of uv/C++ wrappers
[06:06:07] <ghrust> 13rust/06auto 1497e95d1 15Alex Crichton: Provide cleaner initialization of uv handles
[06:06:08] <ghrust> 13rust/06auto 1469a8559 15Alex Crichton: uv: Provide a helper fn to Result<(), IoError>
[06:06:10] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[06:06:22] <strcat> acrichto: I still love how fcron segfaults when you ctrl-d from the prompt
[06:06:30] <strcat> fcrondyn> zsh: segmentation fault  fcrondyn
[06:06:31] <strcat> \o/
[06:07:13] <acrichto> well at least they exit
[06:07:18] <acrichto> rust will just refuse to exit
[06:07:47] <dbaupp> acrichto: what does .homing_missiles() do? when you call it code is guaranteed to be executed on the appropriate IO scheduler until the dtor runs?
[06:07:59] <dbaupp> *fire_missiles()
[06:08:26] <acrichto> dbaupp: the function plants you on your home I/O scheduler, and the destructor sends you back to your actual home scheduler if you're a homed task
[06:08:39] <acrichto> and then there's an assertion you didn't leave the I/O scheduler in the meantime
[06:08:55] <acrichto> pcwalton with the lightning r+
[06:09:01] <dbaupp> ok, that's what I thought. (weird that there are two things called "home scheduler" though)
[06:09:18] <acrichto> yeah we may use the term "home" too much
[06:09:32] <acrichto> and then I just wanted an excuse to write "missile" as much as possible
[06:09:54] <acrichto> I tried to document a distinction between "home I/O" and "home scheduler" though, but probably didn't do a good job
[06:10:20] <strcat> acrichto: anyway it was just this thing being too clever for its own good
[06:10:24] * dbaupp didn't read the PR in detail
[06:10:26] <strcat> it didn't want to rebuild because rust's git rev didn't change
[06:10:35] <strcat> afaict at least
[06:10:54] <acrichto> strcat: if you build without -j it should work just fine
[06:10:58] <strcat> yeah
[06:11:04] <acrichto> you could also play a game with the kernel
[06:11:07] <strcat> just had to add back unset MAKEFLAGS
[06:11:07] <acrichto> and build with -j
[06:11:23] <acrichto> do you feel lucky today?
[06:11:29] <strcat> acrichto: I have limited resources on this server ;p
[06:11:40] <acrichto> -j20
[06:11:43] <acrichto> wait, -j
[06:11:59] <acrichto> -j alone is an awesome configuration
[06:12:11] <acrichto> I wonder how far an llvm build would get with that...
[06:12:26] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[06:13:04] <dbaupp> before you run out of memory?
[06:13:34] <acrichto> when I did that once before with firefox my whole system just deadlocked
[06:14:45] <acrichto> hm, I'm not actually sure of the best way to test this, so I'm gonna r? strcat and hope he gets there before dbaupp does
[06:15:27] * dbaupp wonders why he has to be slow
[06:15:45] <acrichto> I'll just wait for you to fall asleep
[06:16:24] <acrichto> no I'd actually like to figure out a way to test this
[06:16:28] <acrichto> seems like a reasonable thing to do
[06:18:29] <Luqman> acrichto: that is why i only do -j on the machine with 192gb of ram ;P
[06:18:43] * acrichto wants to work on a machine with 192gb of ram
[06:19:16] * strcat has run into a problem far worse than a makefile race
[06:19:26] <strcat> I wanted oatmeal cookies but there's not enough margarine ,_,
[06:19:47] <strcat> I guess I can substitute dog hair for the butter instead
[06:20:32] <strcat> acrichto: you can make your system behave well during OOM ;p
[06:21:12] <dbaupp> strcat: file a bug
[06:21:17] <dbaupp> tag it A-food
[06:21:28] <strcat> I-hungry
[06:21:54] <dbaupp> hah
[06:22:49] <strcat> I guess I could make a half batch, division by two isn't overly hard at 1am
[06:24:02] <dbaupp> it's just a shift
[06:32:51] *** Quits: ktt3ja (Mibbit@moz-6B6EE8C0.hsd1.va.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[06:35:35] *** Parts: sanxiyn (tinuviel@B4104EBB.3CC170B1.1E14B209.IP) (Leaving)
[06:40:10] <sfackler> acrichto: r? https://github.com/mozilla/rust/pull/10254
[06:45:51] <Yurume> is it normal for metadata to weigh more than 200KB?
[06:53:37] *** Joins: eddyb (eddy@FE23D96E.F33C1089.FB866788.IP)
[06:56:02] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[06:56:02] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 144cb4a1b to 14556088c: 02http://git.io/N3iJvQ
[06:56:02] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[06:56:09] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[06:56:09] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Jg7-6A
[06:56:09] <ghrust> 13rust/06auto 14ff859ed 15Steven Fackler: Ensure rustpkg test fails if tests failed...
[06:56:09] <ghrust> 13rust/06auto 1494677c1 15bors: auto merge of #10254 : sfackler/rust/rustpkg-test-failure, r=alexcrichton...
[06:56:10] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[07:02:43] <strcat> Yurume: likely yes
[07:02:54] <strcat> Yurume: anything generic or #[inline] is output in the metadata rather than as code
[07:03:12] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[07:03:51] <Yurume> ah, #[inline]!
[07:06:27] <strcat> if we had LTO it would output a crate as optimized bytecode and then load + optimize to link, so #[inline] would only matter for libraries with a stable ABI + stable definitions of #[inline] functions
[07:06:43] <strcat> (and the non-release build alternative to LTO would just be static linking, without pervasive inlining)
[07:06:47] * strcat shrugs ;p
[07:08:13] <strcat> acrichto: https://github.com/thestinger/rust-core/commit/8523fb4ada419f7dac2077f51f91486356c6fad6 pretty! ;p
[07:11:51] <Yurume> strcat, I was investigating why the compiled crate for rust-encoding seems to be bloat (2x the generated table)
[07:12:32] <Yurume> and it seems I have mistakenly put #[inline] to 27 reverse-mapping functions (named "backward"), each having one match containing 128 arms
[07:22:07] <acrichto> strcat: now that does look much more appealing
[07:22:40] <strcat> acrichto: and I realized intrinsics can't just be passed through trivially due to env ptrs ;[
[07:22:55] <acrichto> passed through to what?
[07:23:20] <strcat> as in return the LLVM intrinsic ValueRef directly
[07:23:28] <strcat> for simple ones
[07:24:12] <strcat> because it's not really an ABI, it's the Rust ABI
[07:28:10] <dbaupp> remove the env pointer? ;)
[07:30:07] <dbaupp> strcat, acrichto: is there a bug for rust not building?
[07:30:21] <eddyb> is the env pointer for anything else other than closures?
[07:30:38] <strcat> eddyb: no
[07:30:39] <eddyb> because then it can be part of the distinct closure type, I would think
[07:30:42] <strcat> eddyb: well, methods are fucked
[07:30:49] <acrichto> dbaupp: not yet, but I have a fix, I just need to figure out how to test it
[07:30:51] <strcat> they have an env ptr param but they pass self in it
[07:30:56] <eddyb> haha
[07:30:56] <strcat> even if self is by-value, they pass it through a ptr
[07:30:58] * strcat sighs
[07:31:01] <strcat> it's really terrible
[07:31:11] <strcat> I think that's where removing it should start
[07:31:19] <eddyb> fix that, move env to closures, implement variadic generics and Fn :P
[07:31:26] <strcat> change the type of the method env ptr to the proper self type, removing indirection for by-value self
[07:31:45] <strcat> and then it's fairly obvious that it has to be removed from free functions for function reform, with boxed closures generating a wrapper fn
[07:31:51] <strcat> and eventually we can have unboxed closures
[07:31:57] <strcat> pay for what you use! ;p
[07:32:52] <sfackler> rust doesn't build anymore?
[07:33:21] <dbaupp> sfackler: the makefiles got confused, or something.
[07:33:29] <acrichto> sfackler: it's likely with -j that you'll hit an error if rustpkg and rustdoc finish building at the same time
[07:35:59] <Yurume> woah, inling 27 `match`es added ~150 KBs of metadata...
[07:36:06] <Yurume> how is that possible at all?
[07:36:39] <strcat> Yurume: it inlines the AST
[07:36:44] <dbaupp> Yurume: are they big matches?
[07:36:46] * strcat shrugs
[07:36:54] <strcat> er
[07:36:58] <strcat> serializes the AST*
[07:37:01] <Yurume> dbaupp, 128 arms per match.
[07:37:04] <strcat> to a weird binary XML format
[07:37:08] <dbaupp> ... so yes.
[07:37:26] <Yurume> does that really amount to 150 KBs?
[07:37:40] <dbaupp> apparently
[07:38:02] <Yurume> I can't understand what's happening in metadata! XD
[07:38:17] <dbaupp> wait... that's only 43 bytes per arm, which isn't that ridiculous (although, if they're short arms, it sounds pretty big.)
[07:39:03] <Yurume> each arm is a simple integer to integer mapping, does it take 43 bytes?
[07:39:18] <Yurume> FYI the relevant commit in rust-encoding is: https://github.com/lifthrasiir/rust-encoding/commit/86c8a7a
[07:39:40] <dbaupp> it has to store at least an Expr in the ast, which is pretty big, iirc.
[07:40:09] <Yurume> something like a tower of Expr(AddExpr(MulExpr(...)))?
[07:41:47] <dbaupp> Yurume: yeah, it's ExprMatch(mathee, ~[Arm { ~[pattern], None, Block {view_items: ~[], stmts: ~[],  expr: Some(ExprLit(LitInt(...))) ... } ....})
[07:41:53] <dbaupp> so quite a lot of stuff
[07:45:25] <strcat> I really hate POSIX APIs :(
[07:45:35] <strcat> otherwise I'd have exposed threading in rust-core already...
[07:45:52] <strcat> pthreads are so bad
[07:46:16] <strcat> I like how the locks are basically unusable in a portable way
[07:46:56] <dbaupp> doesn't C11 have threads in the spec?
[07:47:01] <strcat> C11 threads are cute since the standard allows threads to not share address spaces
[07:47:03] <strcat> dbaupp: yes
[07:47:18] <strcat> they are champions of standardizing so little that the standard is useless
[07:47:23] <dbaupp> :/
[07:47:48] <strcat> dbaupp: http://en.cppreference.com/w/c/thread
[07:48:21] <strcat> the difference from C++ is mostly that they had to drop first-class functions, nice usage of destructors and vowels
[07:49:13] <strcat> (MSVC++ implements C++11 threads, but ofc not C11! so it provides close to zero more portability than pthreads)
[07:49:35] <dbaupp> silly old MSVC++
[07:50:15] <strcat> I was thinking that if I did stick to this subset of pthreads I could make a library wrapping C++11 threads on windows (it maps 1:1 to a specific subset of the functions/constants/macros)
[07:50:22] <strcat> at least once we stop using mingw and start using LLVM
[07:50:34] <strcat> (as in the LLVM platform)
[07:50:47] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[07:51:31] <strcat> dbaupp: http://gustedt.wordpress.com/2012/10/14/c11-defects-c-threads-are-not-realizable-with-posix-threads/ there's a table of how C11 threads are *supposed* to map to POSIX ones here
[07:52:07] <strcat> except pthreads is like.... 120 functions?
[07:54:27] <dbaupp> so, in theory, one could implement C11 threads by spawning them on an entirely new machine...
[07:54:34] <strcat> dbaupp: probably
[07:55:34] <strcat> dbaupp: pthreads are less abstract
[07:55:50] <strcat> but you *can* make a POSIX compliant implementation of them without pre-emptive scheduling
[07:57:22] <dbaupp> neat
[08:00:35] <strcat> what happens to bors with a negative priority?
[08:00:37] * strcat is curious
[08:01:35] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[08:01:35] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Jg7-6A
[08:01:35] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[08:02:22] <Sharp> Where does the bors source code live?
[08:03:39] <strcat> https://github.com/graydon/bors
[08:03:47] <Sharp> Ah, thanks.
[08:04:54] <Sharp> Hm, well, it does have a provision for negative priority, I think
[08:05:30] <Sharp> But the way it's implemented, if you give it a negative priority it will just return as priority = 0
[08:05:46] <Sharp> So not very interesting.
[08:06:18] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[08:06:19] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/BZXfAA
[08:06:19] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[08:06:26] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[08:06:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/JI6bmA
[08:06:26] <ghrust> 13rust/06auto 14c3089a1 15Alex Crichton: Fix the temporary name of the object file created...
[08:06:26] <ghrust> 13rust/06auto 1470e9b5a 15bors: auto merge of #10260 : alexcrichton/rust/fix-temp-name, r=thestinger...
[08:06:26] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[08:14:40] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[08:18:01] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[08:20:00] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[08:36:06] *** kimundi is now known as zz_kimundi
[08:44:28] *** Quits: tikue_ (tikue_star@8AFE1ED2.F3E8A984.689607DE.IP) (Ping timeout)
[08:51:47] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[08:55:11] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[09:07:20] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Ping timeout)
[09:11:20] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[09:11:20] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/JI6bmA
[09:11:20] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[09:15:10] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[09:21:22] *** Quits: dbaupp (Thunderbir@moz-9879E359.lns20.syd6.internode.on.net) (Ping timeout)
[09:22:00] *** Joins: dbaupp (Thunderbir@moz-9879E359.lns20.syd6.internode.on.net)
[09:22:01] *** zz_kimundi is now known as kimundi
[10:18:54] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[10:42:09] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[10:49:08] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[10:50:56] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[10:55:23] *** kimundi is now known as zz_kimundi
[11:10:29] *** zz_kimundi is now known as kimundi
[11:20:52] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[12:28:22] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[12:35:21] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[12:39:26] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[12:53:09] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[12:58:00] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[12:58:31] *** Quits: dbaupp (Thunderbir@moz-9879E359.lns20.syd6.internode.on.net) (Ping timeout)
[13:05:02] *** Joins: dbaupp (Thunderbir@moz-9879E359.lns20.syd6.internode.on.net)
[13:22:16] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[13:30:14] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[13:46:00] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[15:04:28] *** kimundi is now known as zz_kimundi
[15:06:08] *** zz_kimundi is now known as kimundi
[15:26:45] *** Joins: lbergstrom (Adium@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net)
[15:39:17] *** Quits: Kxepal (Miranda@moz-BFDD5152.pppoe.mtu-net.ru) (Ping timeout)
[15:42:35] *** Joins: Kxepal (Miranda@moz-653B3EC5.pppoe.mtu-net.ru)
[16:01:28] *** kimundi is now known as zz_kimundi
[16:05:54] *** Quits: StarLight (StarLight@moz-F519B723.dynamic.avangarddsl.ru) (Ping timeout)
[16:08:47] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[16:08:47] *** ChanServ sets mode: +o tjc
[16:10:19] *** Joins: StarLight (StarLight@moz-40E177E9.dynamic.avangarddsl.ru)
[16:16:56] *** Quits: strobegen (Adium@A75B6238.EACE1F8D.A133900E.IP) (Quit: Leaving.)
[16:22:36] *** Quits: StarLight (StarLight@moz-40E177E9.dynamic.avangarddsl.ru) (Ping timeout)
[16:28:52] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[16:57:00] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[17:06:06] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[17:06:06] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/4ROkYA
[17:06:06] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[17:06:07] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[17:06:07] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/_Av5aA
[17:06:07] <ghrust> 13rust/06auto 141850d26 15Alex Crichton: Remove lots of uv/C++ wrappers
[17:06:07] <ghrust> 13rust/06auto 1497e95d1 15Alex Crichton: Provide cleaner initialization of uv handles
[17:06:08] <ghrust> 13rust/06auto 1469a8559 15Alex Crichton: uv: Provide a helper fn to Result<(), IoError>
[17:06:10] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[17:13:43] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[17:23:20] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[17:26:26] <dbussink> acrichto: so i had a little time to spend further on that thread in rust issue, but getting an abort on mutex usage in lock_and_signal now
[17:26:50] <dbussink> acrichto: so i'm wondering what the general approach is you'd use for debugging, dunno, maybe compile options so stuff isn't optimized out etc.
[17:28:06] <acrichto> in theory we have -Z extra-debug-info to generate all the necessary dwarf info, but I don't think that this works on OSX and I've barely used it
[17:28:20] <acrichto> I know that it all works really well on linux though b/c we have plenty of tests ensuring that it doesn't break
[17:28:33] <acrichto> otherwise I just use gdb and stare at backtraces all day
[17:29:22] <dbussink> acrichto: hehe
[17:29:52] <dbussink> acrichto: i could also show a diff i have if that would help in pointing something out
[17:30:00] <dbussink> because i'm likely just doing something very stupid :P
[17:30:02] <acrichto> how large is it?
[17:30:43] <dbussink> acrichto: let's see, 370 lines in diff format but large part is removing the old stuff
[17:30:49] <dbussink> the changes themselves aren't that huge
[17:31:08] <acrichto> sure I can take a look at it
[17:31:12] <acrichto> no guarantees though :P
[17:31:14] <dbussink> acrichto: https://gist.github.com/dbussink/540806e6bd26d86d534e
[17:31:19] <dbussink> acrichto: of course :)
[17:32:13] <dbussink> acrichto: i tried the ~~fn() type, but i was wondering, does the casting need to be different in where it's passed down and where it's retrieved again?
[17:33:07] <acrichto> hm that looks like it's all correct
[17:33:11] <acrichto> what's the problem you're seeing again?
[17:33:21] <dbussink> pthread_mutex_lock(&_mutex) failed in /Users/dirkjan/Code/rust/src/rt/sync/lock_and_signal.cpp at line 79, result = 22 (Invalid argument)
[17:33:25] <dbussink> when compiling stuff during make
[17:33:29] <acrichto> what's the backtrace?
[17:33:31] <dbussink> or make check for that matter
[17:33:57] <dbussink> it's some race condition btw, it only fails sometimes :s
[17:34:48] <acrichto> hm I remember seeing weird things as well when I was playing with that code
[17:34:51] <dbussink> acrichto: https://gist.github.com/dbussink/3c3de7d51ae15bf215d7
[17:34:59] <dbussink> that's inside gdb
[17:35:03] <acrichto> I thought I could make it such that the ~fn() wasn't owned by the Thread, but I failed to do soo...
[17:35:26] <dbussink> ah ok
[17:35:32] <dbussink> could this be a similar problem?
[17:35:48] <acrichto> perhaps, I never investigated it enough to know anything about it
[17:35:55] <dbussink> ah ok
[17:35:57] <acrichto> also what, you're grabbing a static lock
[17:36:05] <acrichto> how can that have an invalid argument
[17:36:20] <dbussink> you mean the tis key?
[17:36:20] *** Joins: StarLight (StarLight@moz-C73AADD.dynamic.avangarddsl.ru)
[17:36:23] <dbussink> as that is static?
[17:36:30] <acrichto> yeah
[17:36:35] <dbussink> is there a way i can compile the cpp parts here without optimizations?
[17:36:41] <dbussink> right now there's not much to inspect with gdb
[17:36:51] <acrichto> I think it's --disable-cxx-optimize to ./configure or something like that
[17:37:23] <dbussink> --disable-optimize-cxx according to configure, i'll try that
[17:37:31] <acrichto> ah yes that's it
[17:37:44] <acrichto> I wish it could tell you which argument is invalid
[17:37:51] *** Joins: jeffdb (jeff@moz-ED35AD97.hsd1.ca.comcast.net)
[17:39:58] <dbussink> [EINVAL]           The value specified by mutex is invalid.
[17:40:06] <dbussink> according to the pthread_mutex_lock manpage
[17:40:16] <dbussink> but that would mean the memory is some invalid value :s
[17:40:52] <acrichto> you could try breaking on writes
[17:41:10] <dbussink> you mean to the memory location of the tis lock?
[17:41:22] <acrichto> yeah
[17:41:26] <acrichto> just to see if anything is corrupting it
[17:41:32] <acrichto> although it may also have pointers to thing inside of it
[17:41:42] <dbussink> yeah, seems sensible, i'll see if i can get that out of it
[17:41:51] <dbussink> i wonder if it might not be initialized for some reason
[17:41:55] <dbussink> with pthread_mutex_init
[17:44:19] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[17:44:19] *** ChanServ sets mode: +ao pcwalton pcwalton
[17:47:36] <acrichto> tjc: ping
[17:48:41] *** zz_kimundi is now known as kimundi
[17:50:02] <tjc> acrichto: pong, but can you give me 15 minutes?
[17:50:08] <acrichto> sure, no worries
[17:51:07] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[17:51:08] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1498e47a6 to 1470e9b5a: 02http://git.io/N3iJvQ
[17:51:08] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[17:55:12] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[17:57:20] *** Quits: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk) (Quit: Ex-Chat)
[18:00:17] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[18:02:06] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:02:06] *** ChanServ sets mode: +qo brson brson
[18:03:13] <dbussink> acrichto: so seeing a slightly different issue now, basically looks like the main thread is exiting
[18:03:37] <acrichto> that's unusual...
[18:03:40] <dbussink> acrichto: but some other threads still have the static lock and it fails with pthread_mutex_destroy(&_mutex) failed in /Users/dirkjan/Code/rust/src/rt/sync/lock_and_signal.cpp at line 67, result = 16 (Resource busy)
[18:03:46] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[18:03:54] <dbussink> i wonder if my change broke pthread_join in some subtle way then
[18:04:09] <acrichto> are you asserting the return value of pthread_join?
[18:04:27] <dbussink> no, not yet, i'm going to add that
[18:04:37] <dbussink> is there a standard way to do it like the CHECK c++ macro?
[18:04:43] <dbussink> or CHECKED
[18:04:51] <acrichto> assert!(foo() == 0) ?
[18:04:55] <dbussink> hehe
[18:05:52] <dbussink> acrichto: just wondering if there's something that then also checks errno and prints that etc.
[18:06:10] <acrichto> not that I know of
[18:06:33] *** Quits: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP) (Quit: leaving)
[18:09:52] *** Joins: tikue_ (tikue_star@CDF3161A.E2CAEE6E.689607DE.IP)
[18:12:10] <dbussink> acrichto: interesting, it's indeed pthread_join that fails
[18:12:18] <dbussink> acrichto: onto  further debugging :)
[18:12:39] <acrichto> hurray integer error codes!
[18:13:20] <acrichto> can I gdb a parent process and then have it break when a forked process segfaults?
[18:13:52] <dbussink> there's some child fork follow voodoo that might work
[18:14:03] <acrichto> nothing on https://sourceware.org/gdb/onlinedocs/gdb/Forks.html seems to be helping much :(
[18:14:40] <dbussink> acrichto: a trick i've used with rubinius is that we have a segfault signal handler
[18:14:41] <dbussink> that just sleeps
[18:14:45] <dbussink> so you can attack gdb
[18:14:48] <dbussink> attack
[18:14:49] <dbussink> attach
[18:14:53] <acrichto> that would be so useful
[18:14:54] <dbussink> typing is hard
[18:15:05] <dbussink> it sleeps based on an env var btw
[18:15:08] <dbussink> if that's present or not
[18:15:17] <dbussink> but i've found it to be really useful in multiprocess debugging
[18:15:17] <acrichto> hm, perhaps I should consider something similar
[18:16:06] <dbussink> acrichto: so given this assertion fails inside rust, can i easily inspect objects etc. or do i need that -Z option and linux probably?
[18:16:45] <acrichto> you won't have the same level of debug info about stuff as C++, inspecting things I've never gotten via just compiling and then using gdb
[18:16:59] <acrichto> I normally break on rust_begin_unwind to detect a failure and then go up the stack in gdb to poke at things
[18:17:09] * acrichto needs to get gdb on osx working again
[18:18:00] <dbussink> ah ok, i'll just wrap the ffi functions now with shims in c++
[18:18:09] <dbussink> to see why pthread_join fails
[18:18:42] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[18:19:02] <dbussink> oh, man, i'm such an idiot
[18:19:13] <dbussink> and this problem is going to be tricky
[18:19:32] <dbussink> acrichto: so the reason pthread_join is failing, is because it needs pthread_t as the first argument, not a pthread_t*
[18:19:50] <acrichto> isn't a pthread_t a word-sized thing?
[18:19:59] <acrichto> which just ends up being a pointer to somewhere else though
[18:20:13] <dbussink> i think it is, i don't know if that's guaranteed though
[18:22:20] <dbussink> acrichto: from some ibm docs: http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=%2Fapis%2Fconcep17.htm
[18:22:48] <acrichto> yeah makes sense
[18:23:51] <dbussink> but do i understand it correctly that if this needs to be passed in, rust needs to know this exact type?
[18:24:06] <dbussink> or would an ffi shim that receives a pthread_t* and translates it be better
[18:24:44] <acrichto> I think that we're destined to have ffi shims forever, so I'm personally ok with a small one (it's certainly smaller than rust_thread.{h,cpp}
[18:25:03] <dbussink> right
[18:25:43] <dbussink> as long as the system interface for stuff like this is basically c headers, that kind of keeps being a pain point
[18:26:53] *** Quits: tikue_ (tikue_star@CDF3161A.E2CAEE6E.689607DE.IP) (Ping timeout)
[18:27:29] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[18:27:29] <ghrust> 01[13rust01] 15alexcrichton merged 06auto into 06snap-stage3: 02http://git.io/zo03hA
[18:27:29] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[18:28:42] <dbussink> acrichto: this 'simple' issue turns out to have a lot more interesting edges than i'd thought :p
[18:29:20] <acrichto> hehe, I've found that happens to me a lot as well
[18:31:23] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[18:31:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/oONnhA
[18:31:23] <ghrust> 13rust/06auto 143c3ed14 15Alex Crichton: Move io::file to io::fs and fns out of File...
[18:31:23] <ghrust> 13rust/06auto 14c9c5df5 15bors: auto merge of #10179 : alexcrichton/rust/rt-improvements, r=cmr...
[18:31:23] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[18:31:25] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[18:31:25] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14bf4b86c to 1470e9b5a: 02http://git.io/N3iJvQ
[18:31:25] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[18:33:08] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[18:33:08] *** ChanServ sets mode: +o pnkfelix
[18:43:27] <cmr> acrichto: gave up on landing it all as one?
[18:43:41] <acrichto> hopefully not
[18:44:06] <cmr> nmatsakis: ping; can you look at https://github.com/mozilla/rust/issues/7713 quickly?
[18:45:17] <cmr> holy crap
[18:45:23] <cmr> this is truly a testament to rust's stability
[18:45:32] <cmr> an example in an issue from 4 months ago still compiles and runs!
[18:45:38] *** Joins: tikue_ (tikue_star@CDF3161A.E2CAEE6E.689607DE.IP)
[18:45:49] <nmatsakis> :)
[18:51:54] <acrichto> brson: ping
[18:52:08] <brson> acrichto: pong
[18:53:04] <acrichto> brson: so I've been thinking about these libuv bindings for awhile, and I'm having difficuly coming up with any mildly safe abstraction to them while still making the bindings nice to use for others
[18:53:59] <acrichto> it's always the case that you want to execute some arbitrary code in a callback
[18:54:09] <acrichto> and I want to stop forcing allocations, and in some cases ~proc() doesn't make sense
[18:54:58] <acrichto> so the best idea that I was able to come up with was to take a stack closure which then returns some sort of handle that invalidates calling the user callback if the handle is dropped
[18:55:27] <acrichto> but that's not really safe if you invoke two operations in a row, so I was a bit torn
[18:56:04] <acrichto> basically, I think that we can write optimized completely safe bindings which force use of the scheduler, or we can write mostly safe non allocating bindings without using the scheduler and then build the scheduler ones on top of those
[18:57:03] <brson> acrichto: let's prioritize making rust fast and not worry too much about making safe, reusable bindings; in practice probably nobody cares about using libuv but us
[18:57:19] <acrichto> ok, will do
[18:57:19] <brson> probably best that the code is maintainable, less important that the underlying bindings are safe
[18:58:15] <brson> thanks. sorry for the hassle
[18:58:34] <acrichto> I think it's really good to at least consider this though
[18:58:42] <acrichto> and it was certainly an interesting thought exercise :P
[18:58:54] <acrichto> I've been too busy trying to land rt-improvements to give this serious thought anyway
[19:00:56] *** Quits: StarLight (StarLight@moz-C73AADD.dynamic.avangarddsl.ru) (Ping timeout)
[19:01:18] *** Quits: tikue_ (tikue_star@CDF3161A.E2CAEE6E.689607DE.IP) (Ping timeout)
[19:02:13] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: zzzzzzzzzz)
[19:12:08] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Ping timeout)
[19:13:09] *** Joins: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[19:13:09] *** ChanServ sets mode: +ao pcwalton pcwalton
[19:14:21] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[19:16:24] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[19:28:15] *** Joins: geoffhill (geoffhill@moz-244CF33A.amazon.com)
[19:38:06] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[19:38:06] <ghrust> 01[13rust01] 15alexcrichton 04force-pushed 06snap-stage3 from 14bf4b86c to 1470e9b5a: 02http://git.io/f3Qwfg
[19:38:06] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[19:54:36] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[20:21:15] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[20:21:15] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/wsheLw
[20:21:15] <ghrust> 13rust/06auto 143c3ed14 15Alex Crichton: Move io::file to io::fs and fns out of File...
[20:21:15] <ghrust> 13rust/06auto 14658637b 15bors: auto merge of #10179 : alexcrichton/rust/rt-improvements, r=cmr...
[20:21:16] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[20:33:33] <pnkfelix> nmatsakis: ping
[20:33:34] *** Joins: tikue (tikue_star@6E903C9.B753798.689607DE.IP)
[20:39:59] *** Quits: tikue (tikue_star@6E903C9.B753798.689607DE.IP) (Ping timeout)
[20:41:54] <pnkfelix> nmatsakis: nm, i'll ask you tomorrow morning
[20:42:01] <nmatsakis> pnkfelix: pong -- ok
[20:42:08] <pnkfelix> nmatsakis: oh, well if you're ther
[20:42:25] <nmatsakis> pnkfelix: sort of here =)
[20:43:05] <pnkfelix> nmatsakis: the question is "just": I am a little surprised that one does not derive additional constraints from `fn items`, e.g. within a trait ...
[20:44:02] <pnkfelix> nmatsakis: the current code just walks through the structure of fn, and doesn't use the fact that parameters are used as arguments/return types.
[20:44:24] <pnkfelix> nmatsakis: I found this a little surprising.  But I still think I am better off talking to you about it tomorrow morning
[20:44:53] <nmatsakis> pnkfelix: ok let's talk tomorrow morning, I will review cod etoo
[20:46:04] <pnkfelix> nmatsakis: actually, my example is flawed, you *do* walk over methods of a trait when you look at the trait itself
[20:46:58] <pnkfelix> nmatsakis: so I guess I was thinking solely of standalone fn items.
[20:47:23] <pnkfelix> nmatsakis: I'll play around with the code a little, see if I can come up with concrete examples rather than just thought experiments.  We'll talk tomorrow.
[20:48:49] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[20:49:27] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[20:49:27] *** ChanServ sets mode: +o tjc
[20:50:36] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:53:12] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[20:56:19] *** Quits: eddyb (eddy@FE23D96E.F33C1089.FB866788.IP) (Ping timeout)
[20:59:11] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[21:01:25] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[21:01:25] *** ChanServ sets mode: +qo brson brson
[21:06:08] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[21:08:13] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[21:15:23] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[21:17:27] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[21:18:02] *** Joins: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP)
[21:22:47] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[21:26:03] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[21:26:03] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/wsheLw
[21:26:03] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[21:26:56] <cmr> acrichto: \o/
[21:28:07] <acrichto> oh jeez finally!
[21:33:06] <brson> acrichto: what did you land?
[21:33:17] <acrichto> brson: rt::io::file => rt::io::fs
[21:35:22] <brson> nice
[21:37:38] <acrichto> oh brson, this also came up today, right now we have #[cfg(unix)] mod unix inside of rt::io::net
[21:37:54] <acrichto> but it turns out that libuv actually uses named pipes on windows, so everything should "just work" on windows
[21:39:29] <cmr> should they be named away from unix? "unix domain socket" is not really an apt name these days, IMO
[21:40:23] <acrichto> I'm ok with just moving them under io::pipe or possibly net::pipe
[21:40:28] <acrichto> I still think that io::net::tcp is a lot of typing
[21:40:53] *** Joins: reedlepee (Mibbit@9B9315E1.A6025CA.1C37C358.IP)
[21:41:11] <cmr> well that's why you `use std::io::net::tcp` :p
[21:41:16] <acrichto> :(
[21:42:18] <mletterle> it's going to break all the things
[21:46:21] *** Joins: tikue (tikue_star@E3D1796E.21C37D63.689607DE.IP)
[21:46:43] <brson> acrichto: i do think the deep io hierarchy is kind of at odds with the structure of the rest of std
[21:47:02] <brson> i originally intended to reexport a bunch of stuff at more canonical locations
[21:47:17] <acrichto> I'd be ok with reexports
[21:47:19] <brson> maybe the ::net:: module just doesn't need to exist
[21:47:32] <acrichto> io::fs, io::tcp, io::udp, io::pipe
[21:47:34] <acrichto> kinda nice
[21:48:17] <brson> yeah, better
[21:48:40] <acrichto> once the uv bindings are rewritting I plan to scrutinize our net bindings very closely
[21:49:01] * acrichto is reminded of something he forgot for io::fs
[21:53:36] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Client exited)
[21:54:43] <dbussink> the network is ubiquitous ;)
[21:55:48] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[21:55:55] <brson> acrichto: there's a lot of stuff in std::os that *sounds* like it should be in a module called 'fs'
[21:56:07] <acrichto> brson: I should have removed almost all of it
[21:56:26] <acrichto> hm I should make another pass-through though
[21:56:32] <acrichto> 'fs' is more-encompassing than 'file'
[21:56:39] <brson> my branch is old, i'll update and take another look
[21:56:48] <acrichto> nah tmpdir/change_dir should both move
[21:56:56] <acrichto> probably homedir
[21:57:07] <acrichto> make_absolute (although that should be on Path I think)
[21:57:21] <acrichto> it's not as bad as it used to be
[21:57:25] <brson> indeed, you've moved a bunch of stuff
[21:57:35] <acrichto> the only blocking things should be in libc now
[21:58:03] <brson> std::os is kind of a grab bag
[21:58:07] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[21:58:23] <acrichto> it's becoming a little more refined, but it should probably get completely dissolved
[21:58:39] <acrichto> or perhaps not, os::args() makes a lot of sense
[21:58:46] <acrichto> along with os::getenv() and such
[22:00:08] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[22:00:08] *** ChanServ sets mode: +o tjc
[22:00:32] *** Quits: reedlepee (Mibbit@9B9315E1.A6025CA.1C37C358.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:00:33] <brson> acrichto: I'm really happy with all the improvements you've made to std. This is getting fairly presentable now
[22:00:45] <acrichto> hurray! still a long way to go though :(
[22:02:18] <brson> well, that's not fair. a lot of people have been making a lot of great improvements to std lately
[22:02:22] <brson> like kimundi :)
[22:02:34] * acrichto is very happy to have ~Any
[22:05:40] <kimundi> :)
[22:06:06] <acrichto> nmatsakis: could you take a look at #10182 when you get a chance? no rush at all of course
[22:06:28] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[22:06:28] <ghrust> 01[13rust01] 15alexcrichton merged 06auto into 06snap-stage3: 02http://git.io/wsheLw
[22:06:28] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[22:11:20] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[22:18:31] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[22:18:31] *** ChanServ sets mode: +o tjc
[22:27:47] <brson> i wonder how hard it would be to factor the entire runtime into its own crate now, similar to uv. the hardest parts to deal with are probably failure, logging and local data
[22:28:30] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[22:29:22] <acrichto> brson: you are a brave man, but that would be truly awesome
[22:29:31] <acrichto> that would be a huge step forward for a runtimeless rust
[22:39:05] <strcat> acrichto: the stdlib uses the runtime everywhere though
[22:39:22] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Input/output error)
[22:39:23] <acrichto> it certainly wouldn't be an easy step
[22:39:44] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[22:41:27] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Ping timeout)
[22:43:07] <strcat> hm, where do all extern {} blocks get marked as unsafe
[22:44:39] <strcat> ah, there
[22:46:06] <Luqman> nmatsakis: ok, squashed it down a single commit + tests
[22:46:19] <dbaupp> strcat: in resolve somewhere (which I assume you found)
[22:46:37] <strcat> dbaupp: yes
[22:46:57] <nmatsakis> Luqman: acrichto: ok
[22:47:43] *** Quits: tikue (tikue_star@E3D1796E.21C37D63.689607DE.IP) (Ping timeout)
[22:49:29] *** Joins: tikue (tikue_star@E3D1796E.21C37D63.689607DE.IP)
[22:50:56] <nmatsakis> acrichto: why change the typedescriptor fields from priv to pub?
[22:51:36] <acrichto> nmatsakis: oh replied on github as well
[22:51:41] <acrichto> basically I think it was erroneously done recently
[22:51:51] <nmatsakis> acrichto: ok I figured that'd be the case
[22:51:58] <acrichto> nmatsakis: 0ada7c7f was the commit
[22:51:59] <brson> acrichto: i think it may be fairly straightforward as long as we can tolerate another layer of virtual calls for all the runtime services. every single call into std::rt becomes a call through the crate map
[22:52:31] <brson> though i don't think we should do it for 1.0
[22:52:36] <strcat> I'm not convinced it would help runtimeless rust at all
[22:52:40] <nmatsakis> acrichto: r+
[22:52:40] <acrichto> brson: hm I'm very easily convinced that we can take the hit for I/O, but not necessarily for the runtime
[22:52:45] <acrichto> nmatsakis: thanks :)
[22:53:00] <strcat> I think either way you need a whole different stdlib (whether you do it via cfg flags or a separate codebase)
[22:53:15] <acrichto> brson: although I wouldn't think that the virtual dispatch would hurt much, I'd want numbers to back it up
[22:53:20] <acrichto> that being said this is definitely not 1.0
[22:53:38] <acrichto> strcat: I think the biggest benefit is a "proof of concept" style situation where it is extracted
[22:53:50] <nmatsakis> grr I really miss bugzilla's patch-review system when working with github
[22:53:50] <brson> good for seperation of concerns no matter what
[22:53:51] <acrichto> so for libuv there's a "proof of concept" method of swapping out the I/O backend
[22:54:13] <acrichto> it may not work to swap out the backend, but it's at least designed such that it should be
[22:54:16] <strcat> but the most wanted alternative will be 1:1 threading and blocking I/O
[22:54:28] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[22:54:33] <acrichto> and you can do that with this backend
[22:54:40] <acrichto> or the swappable backends that is
[22:55:11] <Luqman> nmatsakis: if you're looking for your comments https://github.com/luqmana/rust/commit/d7e08b00aae70a4bebf8668e389b6324c7738469
[22:55:59] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[22:55:59] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/YyYYFw
[22:55:59] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[22:56:07] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[22:56:08] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/frL4Iw
[22:56:08] <ghrust> 13rust/06auto 146163743 15Alex Crichton: Add a type_id intrinsic...
[22:56:08] <ghrust> 13rust/06auto 14b004493 15Alex Crichton: Remove unnecessary unwind messages...
[22:56:08] <ghrust> 13rust/06auto 14ecfa654 15bors: auto merge of #10182 : alexcrichton/rust/typeid-intrinsic, r=nikomatsakis...
[22:56:10] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[22:56:46] *** Joins: geoffhill_ (geoffhill@moz-79C8D45C.amazon.com)
[22:56:49] *** Quits: geoffhill (geoffhill@moz-244CF33A.amazon.com) (Ping timeout)
[22:56:49] *** geoffhill_ is now known as geoffhill
[23:01:18] <nmatsakis> is there any way to jump from the diff to the corresponding line in the new file?
[23:01:43] <strcat> nmatsakis: in the github UI?
[23:01:48] <nmatsakis> yes
[23:02:30] <nmatsakis> strcat: I know there is the "View file" button, but that's doesn't take me to the spot I'm looking at now, and when there are a lot of hunks from a single file the "View file" button is often very far away
[23:03:15] <nmatsakis> Luqman: looking good, added one comment
[23:03:36] <aatch> Hey what's the status on implementing Select for io things (like streams)/What would it look like?
[23:06:27] <dbaupp> strcat: is https://github.com/mozilla/rust/issues/10267 wanting to replace `extern { fn foo(); }` with `extern { unsafe fn foo(); }` with a lint that checks that externs have `unsafe` on error by default?
[23:06:32] *** Quits: jeffdb (jeff@moz-ED35AD97.hsd1.ca.comcast.net) (Ping timeout)
[23:06:35] <strcat> yes
[23:07:04] <strcat> so we can disable the lint in some modules where we want to do a more careful safety audit
[23:07:18] <dbaupp> or even just on specific extern blocks
[23:07:29] <strcat> well, can we disable a lint for a specific block?
[23:07:45] <dbaupp> they take attributes, so if the lint visitor handles it properly, yes.
[23:07:49] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[23:08:11] <strcat> I want to kill off the wrappers around functions like size_of because you end up with thousands of instantiations
[23:09:47] <dbaupp> (lints do work on extern {}, fwiw.)
[23:11:09] <acrichto> dbaupp: I don't think that attributes on an extern block affect lint levels
[23:11:19] <acrichto> they could be altered to do so, however
[23:11:21] <dbaupp> acrichto: they do...
[23:11:29] <acrichto> oh wait
[23:11:30] <acrichto> they're an item
[23:11:31] <acrichto> nvmd
[23:11:36] <acrichto> hurray everything as items
[23:11:49] <strcat> hm
[23:12:21] <kimundi> strcat: Do you have any thoughts about that issue a I talked about on that mailing list thread about the Result API? The one about as_ref adapters and a ToStr bound on the error type clashing?
[23:12:48] <dbaupp> the hardest bit will be bootstrapping, since `extern { unsafe fn ... }` no longer parses.
[23:13:37] <strcat> kimundi: I haven't really being paying much attention to rust lately, so I don't know
[23:14:09] <kimundi> Hm, okay
[23:14:23] <strcat> I *can* say that if out-of-memory is ever going to be something you can handle via unwinding, destructors shouldn't be allocating memory
[23:15:27] <strcat> if an error string has to be created (and it's not static) it would be done at the failure site
[23:15:43] <strcat> and then the handler for the errors itself wouldn't have to allocate
[23:15:54] <strcat> but I think handling OOM in libstd is a hopeless prospect ;\
[23:16:32] <dbaupp> do you have plans for rust-core to handle OOM?
[23:16:47] <strcat> kind of, I'm not sure if unwinding is a good way to do it
[23:16:52] <strcat> it's certainly the easiest cop-out ;p
[23:17:20] <strcat> at the very least with unwinding, all the dtors get called
[23:18:17] <strcat> either way it seems you would need to allocate the upper bounds on resources in advance to be fully robust
[23:20:22] <strcat> uhhh, we don't even store the unsafety of a foreign fn
[23:24:18] <strcat> can extern abi functions not be unsafe?
[23:26:06] <dbaupp> you mean an `extern "C" fn foo() { ... }`?
[23:26:16] <strcat> yep
[23:26:18] <dbaupp> https://github.com/mozilla/rust/issues/10025
[23:26:53] *** kimundi is now known as zz_kimundi
[23:26:55] <strcat> yeah a function is either extern, impure or unsafe
[23:26:56] <strcat> ;\
[23:27:13] <Luqman> extern "C" unsafe fn(f: int, x: u8) is a valid type though afaik
[23:27:32] <strcat> not in libsyntax
[23:28:01] <Luqman> it's been working for me https://github.com/luqmana/rust/commit/baaeba95cf0b475e83a9867e7c65766ae267d750#diff-f55b6d8011bc3df3e9f43f8d0530660eR42
[23:28:36] <strcat> Luqman: and you've verified that it actually expects an unsafe fn with the "C" abi?
[23:28:39] <strcat> I know it will parse
[23:28:43] <pcmattman> strcat: aren't extern ABI functions unsafe by nature because they can happily go nuts with the memory etc?
[23:28:50] <strcat> pcmattman: no
[23:28:59] <strcat> otherwise how can you wrap them with a safe function?
[23:29:14] <strcat> 'unsafe' means not memory safe for all inputs
[23:29:21] <dbaupp> pcmattman: not an `extern "C" fn foo() { ... }`, the code in the block is known to the Rust compiler, so it can be verified by it.
[23:29:23] <strcat> obviously it is memory safe for some inputs, or there would be no point
[23:29:32] <pcmattman> yep, sorry, I got confused by "extern" again
[23:29:43] <pcmattman> I thought that was pulling in an external function, as you were :)
[23:29:53] <strcat> a foreign C function that's used by a rust program does have to be considered same for some inputs or it can't be used
[23:29:54] <Luqman> strcat: yes, i can't assign sprintf to x because it will complain about a mismatch in unsafe 
[23:30:07] <strcat> hm
[23:30:54] <strcat> ah I see
[23:31:09] <strcat> abiset is separate
[23:31:44] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: zzzzzzzzzz)
[23:33:20] <strcat> the fact that purity has 'extern' as a state at all seems like the bug
[23:33:57] * strcat still really doesn't get how this could work
[23:36:39] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[23:36:39] *** ChanServ sets mode: +o tjc
[23:50:41] *** Joins: jeffdb (jeff@moz-ED35AD97.hsd1.ca.comcast.net)
