[00:02:53] *** Joins: tikue (tkuehn@CDCD6B77.F3E8A984.689607DE.IP)
[00:13:59] <brson> acrichto: is https://github.com/mozilla/rust/pull/10495 ready?
[00:14:34] <acrichto> brson: it should be, although I'd guarantee that it bounces at least once
[00:14:48] <acrichto> it's ready in that there is no more work I was intending to do on it at this time
[00:31:41] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[00:31:41] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/_ukcnw
[00:31:41] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[00:32:18] <brson> wish the great justice thread would die
[00:33:02] <acrichto> for great justice!
[00:34:26] <acrichto> brson: opinions on inclusion of libunwind. There appears to be an official git repo that requires some autoXXXX tool to make ./configure, there also appears to be official tarballs
[00:34:38] <acrichto> inclusion of tarball in src/ or inclusion of unzipped tarball?
[00:36:37] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[00:36:37] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/of9bww
[00:36:37] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[00:51:15] <brson> acrichto: unzipped tarball i guess
[00:51:33] *** Joins: ktt3ja (Mibbit@moz-D69B60E4.hsd1.va.comcast.net)
[00:52:42] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[00:54:30] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[01:03:53] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[01:05:40] <acrichto> error: 'rebind' following the 'template' keyword does not refer to a template
[01:05:43] <acrichto> c++ scares me
[01:06:31] <strcat> what are you doing in C++? ;p
[01:07:26] <acrichto> trying to build libcxxabi
[01:07:28] <acrichto> on linux
[01:07:34] <acrichto> and failing miserably
[01:08:01] <brson> what are we going to use libcxxabi for?
[01:08:13] <acrichto> libcxxabi + libunwind == exception handling
[01:08:25] <acrichto> libunwind = unwinding whatnot, libcxxabi = c++ exception handling whatnot
[01:08:48] <brson> does that mean anything more than the personality function an _cxx_throw?
[01:08:59] <brson> where does libcxxabi come  from?
[01:09:04] <strcat> brson: llvm
[01:09:07] <acrichto> http://libcxxabi.llvm.org/
[01:09:09] <strcat> it's really libc++abi
[01:09:18] <strcat> they just don't want to put + in a url ;p
[01:09:39] <strcat> acrichto: libc++abi has an unwind implementation in the source
[01:09:45] <strcat> did you try building that? I don't know how
[01:09:48] <acrichto> not building that
[01:09:52] <acrichto> just building libcxxabi
[01:09:58] <acrichto> I got it to build on osx
[01:09:58] <strcat> it does build for me on linux because I packaged libc++abi + libc++ in the arch repos ;p
[01:10:02] <acrichto> I don't think that it's going to build on linux
[01:10:13] <acrichto> can you show me a build script?
[01:10:20] <acrichto> I need some help lol
[01:10:21] <strcat> I just used their builtit script
[01:10:54] <strcat> I should probably statically link it into libc++ but I've been too lazy to do anything but use their script
[01:11:13] <acrichto> wait, so you check out libcxxabi from llvm, cd lib, and ./buildit?
[01:11:38] <strcat> acrichto: https://projects.archlinux.org/svntogit/community.git/tree/trunk/PKGBUILD?h=packages/libc++abi
[01:11:52] <acrichto> invalid branch?
[01:12:33] <strcat> er, sorry
[01:13:03] <strcat> vimperator stopped escaping urls properly :(
[01:13:20] <strcat> acrichto: https://projects.archlinux.org/svntogit/community.git/tree/trunk/PKGBUILD?h=packages/libc%2B%2Babi
[01:13:30] <strcat> but yeah
[01:13:35] <strcat> I just run their lib/builtit
[01:13:37] <strcat> buildit*
[01:13:40] <acrichto> what version of clang do you have?
[01:14:21] <strcat> 3.3
[01:14:48] <acrichto> hm, so the ubuntu I"m using has 3.0
[01:14:52] <acrichto> I wonder if that's causing problems
[01:15:01] <strcat> probably
[01:15:21] <acrichto> what is _NOEXCEPT?
[01:15:26] <acrichto> is that a #define from somewhere?
[01:15:26] <strcat> acrichto: you don't even really need to ask me, I just have the latest stable of everything but rust and mpv ;p
[01:15:27] <acrichto> or a keyword?
[01:15:39] <strcat> _NOEXCEPT is probably a macro expanding to noexcept or throw()
[01:15:56] <strcat> clang 3.0 likely doesn't have noexcept, it's C++11
[01:16:12] <strcat> libc++/libc++abi are a C++11/C++14 implementation
[01:16:18] <acrichto> so there's no definition of _NOEXCEPT in libcxxabi
[01:16:23] <acrichto> if I make it noexcept, things start compiling
[01:16:27] <acrichto> but then other things start dying
[01:16:33] <strcat> acrichto: it comes from libc++ I guess
[01:16:54] <acrichto> this is also pulling in my system cxxabi.h instead of the local cxxabi.h
[01:16:57] <acrichto> causing all kinds of havoc
[01:17:11] <strcat> you need libc++ to build libc++abi
[01:17:17] <strcat> and then you have to rebuild libc++ with libc++abi
[01:17:20] <strcat> :)
[01:17:40] <acrichto> urgh, this is really not helping our use case
[01:21:06] <acrichto> strcat: how recent is decltype?
[01:21:18] <strcat> C++11, maybe clang 3.2/3.3
[01:21:31] <strcat> acrichto: http://clang.llvm.org/cxx_status.html
[01:21:39] <acrichto> ok we're building clang locally
[01:21:42] <strcat> hm
[01:21:43] <acrichto> wait, no we're not
[01:21:59] <acrichto> this would be a lot easier if we just used the clang we just built with llvm
[01:22:05] <strcat> no decltype is in clang 2.9
[01:22:12] <acrichto> error: expected expression
[01:22:15] <acrichto> pointing at decltype
[01:22:17] <strcat> where?
[01:22:20] <acrichto> static const bool value = decltype(__test<_Tp>(nullptr))::value;
[01:22:20] <strcat> is it like this?
[01:22:28] <acrichto> /home/alex/libcxx/include/type_traits:3279:31:
[01:22:51] <strcat> acrichto: are you building manually or via buildit?
[01:23:05] <acrichto> I'm heavily modifying buildit b/c the script doesn't work at all on ubuntu
[01:23:39] <acrichto> but it appears the only relevant change is downloading libcxx and adding its include folder to the flags
[01:23:43] <acrichto> and also using clang and not gcc
[01:23:46] <brson> acrichto: it seems like we should just build clang if we're going to start packing in it's c++ libs. to get away from mingw we will need to use llvm's libc++, start snapshotting everything
[01:24:01] <acrichto> oh god building is going to take even longer
[01:24:30] <brson> we can even snapshot clang and be completely self-hosting
[01:24:37] <brson> more completely
[01:24:41] <brson> i guess the rabbit hole goes forever
[01:24:44] <acrichto> a terrifying though, but I think we need to do that
[01:24:46] <brson> until we write RusTOS
[01:24:49] <acrichto> lol
[01:24:54] <strcat> and then we could move bindgen in-tree and move towards supporting it as a rust pass
[01:25:05] <strcat> maybe we can even use clang for ABI handling ;p
[01:25:13] * acrichto learns how to build clang now
[01:25:19] <acrichto> my life, how did it come to this
[01:25:23] <brson> lol
[01:25:25] <strcat> acrichto: can you do compiler-rt while you're at it? :)
[01:25:30] <acrichto> strcat: might as well
[01:25:30] <strcat> I want CheckedMul to work on 32-bit :(
[01:25:40] <brson> we should probably discuss this. we already added and removed clang once, and it was controversial then
[01:25:44] <acrichto> strcat: say more about compiler-rt
[01:25:56] <strcat> acrichto: it's a static lib providing 99% of what libgcc_s is used for
[01:26:06] <acrichto> brson: it looks like we need a very-recent clang to compile libcxxabi on linux systems (if at all)
[01:26:09] <strcat> it's faster, and it has functions LLVM generates that libgcc doesn't have calls to
[01:26:16] <strcat> for example, 64-bit checked multiplication on 32-bit
[01:26:26] <strcat> compiler-rt has the fallback it needs, libgcc doesn't
[01:26:29] <acrichto> strcat: so this would be added to all link commands for rust?
[01:26:40] <acrichto> and this is a static library?
[01:26:49] <strcat> acrichto: yes
[01:26:50] <brson> i'm interested in how this work helps us get away from mingw. removing c++ deps is neat, but not critical
[01:27:07] <strcat> compiler-rt is needed to fill in some missing support functions
[01:27:26] <strcat> https://github.com/mozilla/rust/issues/8449
[01:27:40] <strcat> it's not a very big lib
[01:27:45] <acrichto> strcat: where does one find compiler-rt?
[01:27:49] <strcat> acrichto: it's a repo
[01:27:52] <strcat> has to be built with LLVM
[01:27:57] <strcat> well, at least in the LLVM tree
[01:28:02] <strcat> (clang does too)
[01:28:11] <acrichto> geez we are literally cloining all of https://github.com/llvm-mirror/ except lldb
[01:28:15] <strcat> http://compiler-rt.llvm.org/
[01:28:20] <acrichto> oh no nvmd
[01:28:49] <strcat> acrichto: afaik we're already using compiler-rt on OS X and freebsd10
[01:29:03] <strcat> but we're using GNU tools/support on windows/linux
[01:29:07] <acrichto> brson: btw if there are more pressing things I can go work on those as well
[01:29:08] <strcat> gcc links libgcc
[01:29:16] <acrichto> brson: this has just been nagging at me forever
[01:29:18] <strcat> acrichto: moving to mingw-w64 seems much more important
[01:29:39] <strcat> and getting us using a recent gcc on windows (likely going to happen at the same time)
[01:29:44] <strcat> they changed the ABI.
[01:29:49] <strcat> to match MSVC++
[01:30:58] <acrichto> https://github.com/mozilla/rust/pull/5615
[01:31:02] <acrichto> we had so few builders back then...
[01:31:39] <strcat> that's probably shortly after graydon made bors
[01:32:48] <acrichto> brson: I'm thinking we shouldn't distribute clang/clang++, right?
[01:34:47] <strcat> acrichto: yeah we shouldn't distribute them
[01:35:04] <strcat> we'll just need libclang when we want to start using it
[01:36:26] <acrichto> ugh and libunwind apparently doesn't work on windows
[01:39:21] <strcat> brson: we could have static linking as default for -O0/-O1 (where inline isn't used anyway), and then have a flag to disable it at -O2/-O3
[01:39:24] * strcat shrugs
[01:39:26] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[01:39:31] <strcat> er
[01:39:34] <strcat> to disable LTO*
[01:40:03] <strcat> so then people could stop worrying about using #[inline], you just need #[inline(always)] for --opt-level=1 if you care
[01:41:08] *** Quits: notmatt (notmatt@CC62CF7E.1E7FDFDB.A82DBDDB.IP) (Client exited)
[01:41:32] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[01:41:32] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/OvM2KQ
[01:41:32] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[01:44:23] <brson> acrichto: i'm not sure. let's discuss tomorrow
[01:46:33] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[01:46:33] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/-Xby5w
[01:46:33] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[01:46:36] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[01:46:36] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/LvCGKg
[01:46:36] <ghrust> 13rust/06auto 14f4c222f 15Brian Anderson: rt: Namespace all C functions under rust_
[01:46:36] <ghrust> 13rust/06auto 142a984c9 15bors: auto merge of #10440 : brson/rust/cnamespace, r=bstrie
[01:46:37] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[01:57:01] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[02:01:42] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[02:01:48] *** Quits: tikue (tkuehn@CDCD6B77.F3E8A984.689607DE.IP) (Quit: tikue)
[02:02:19] <brson> strcat: possibly, yeah. would need to include both the machine code and the AST in .rlib files, but we're pretty close to that point already
[02:04:20] *** Joins: geoffhill (geoffhill@moz-738DC0DB.org)
[02:26:50] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[02:30:43] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[02:33:13] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[02:45:32] *** Quits: jdm (jdm@moz-ED0C7AC7.hinet-ip.hinet.net) (Quit: Lost terminal)
[02:51:35] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[02:51:35] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/LvCGKg
[02:51:35] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[02:51:36] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[02:53:37] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[02:54:17] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Connection reset by peer)
[02:54:29] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[02:55:30] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[02:56:32] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[02:56:32] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/NxtYOg
[02:56:32] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[02:56:40] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[02:56:40] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/aaY3kg
[02:56:40] <ghrust> 13rust/06auto 148883138 15Young-il Choi: temporarily disable tests on android and tagging issue number #10455
[02:56:40] <ghrust> 13rust/06auto 14c45870b 15Young-il Choi: fix #10450
[02:56:40] <ghrust> 13rust/06auto 14093757c 15Young-il Choi: add path environments
[02:56:42] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[03:04:08] *** Quits: brson (brson@6A848D32.C1B840DD.76F66111.IP) (Quit: leaving)
[03:06:25] *** Joins: erickt (etryzelaar@49C4075F.3AC15C18.2321E71E.IP)
[03:14:01] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[03:23:37] *** Joins: jdm (jdm@moz-99690620.hinet-ip.hinet.net)
[03:25:19] *** Quits: geoffhill (geoffhill@moz-738DC0DB.org) (Quit: )
[03:28:18] *** Quits: strcat (strcat@moz-61B073BC.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[03:33:10] *** Quits: zz_kimundi (kimundi@moz-6EA0FED4.dip0.t-ipconnect.de) (Ping timeout)
[03:35:44] <sfackler> acrichto: any idea when the native mutexes will land?
[03:36:07] <acrichto> sfackler: had to deal with a lot of build issues, but I think we're all good now
[03:36:35] <sfackler> cool
[03:36:46] <acrichto> but thena gain I always say that
[03:36:50] <acrichto> and I'm always wrong
[03:36:55] *** Joins: zz_kimundi (kimundi@moz-3F7C7055.dip0.t-ipconnect.de)
[03:36:56] *** zz_kimundi is now known as kimundi
[03:37:05] <acrichto> not blocked on anything fundamental though
[03:37:40] <dbaupp> is it still a combined cond-var and mutex?
[03:37:51] <acrichto> yes
[03:37:59] <acrichto> straight port of lock_and_signal
[03:38:17] <dbaupp> ah, cool
[03:38:26] <dbaupp> (C++)-- \o/
[03:38:32] <acrichto> hehe
[03:38:37] <acrichto> certainly has some room for improvement
[03:40:34] *** Quits: rusti (rusti@moz-61B073BC.cpe.net.cable.rogers.com) (Ping timeout)
[03:44:22] *** Quits: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP) (Ping timeout)
[04:00:32] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[04:01:39] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[04:01:39] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/aaY3kg
[04:01:39] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[04:06:19] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[04:06:19] *** ChanServ sets mode: +ao pcwalton pcwalton
[04:06:31] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[04:06:31] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/7TirVQ
[04:06:31] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[04:11:34] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[04:11:34] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/7TirVQ
[04:11:34] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[04:11:38] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[04:11:38] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/vl6GRA
[04:11:38] <ghrust> 13rust/06auto 1424eb1b4 15Alex Crichton: Implement a native mutex type...
[04:11:38] <ghrust> 13rust/06auto 14e8bf078 15Alex Crichton: Remove the C++ lock_and_signal type...
[04:11:39] <ghrust> 13rust/06auto 146d33bdb 15Alex Crichton: Move runtime files to C instead of C++...
[04:11:41] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[04:12:00] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[04:15:22] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[04:16:33] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[04:16:33] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/VQym9A
[04:16:33] <ghrust> 13rust/06auto 1424eb1b4 15Alex Crichton: Implement a native mutex type...
[04:16:33] <ghrust> 13rust/06auto 14e8bf078 15Alex Crichton: Remove the C++ lock_and_signal type...
[04:16:33] <ghrust> 13rust/06auto 14696bf9b 15Alex Crichton: Move runtime files to C instead of C++...
[04:16:35] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[04:16:39] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[04:20:57] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[04:23:52] *** Joins: tikue (tkuehn@moz-DB51A23.pitbpa.fios.verizon.net)
[04:24:32] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[04:26:29] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[04:26:29] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 149e10d42 to 14ab7fe9d: 02http://git.io/N3iJvQ
[04:26:29] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[04:26:37] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[04:26:37] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/nLlZng
[04:26:37] <ghrust> 13rust/06auto 1424eb1b4 15Alex Crichton: Implement a native mutex type...
[04:26:37] <ghrust> 13rust/06auto 14e8bf078 15Alex Crichton: Remove the C++ lock_and_signal type...
[04:26:37] <ghrust> 13rust/06auto 143e5aa07 15Alex Crichton: Move runtime files to C instead of C++...
[04:26:39] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[04:36:30] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[04:36:30] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 142612f4f to 14ab7fe9d: 02http://git.io/N3iJvQ
[04:36:30] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[04:44:11] *** Quits: quvarxa (chatzilla@moz-978E4C31.static.tpgi.com.au) (Ping timeout)
[04:55:23] *** Joins: eddyb (eddy@336E3A7F.D51DAF03.FB866788.IP)
[05:00:57] *** Quits: Kxepal (Miranda@moz-ADF2988C.pppoe.mtu-net.ru) (Quit: Kxepal)
[05:01:20] *** Joins: Kxepal (Miranda@moz-ADF2988C.pppoe.mtu-net.ru)
[05:13:39] *** Joins: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP)
[05:16:30] *** Quits: erickt (etryzelaar@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[05:16:35] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[05:16:35] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14335a476 to 14ab7fe9d: 02http://git.io/N3iJvQ
[05:16:35] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[05:25:58] <sfackler> acrichto: am I crazy or did this fail due to a test that doesn't exist in master or your commits? http://buildbot.rust-lang.org/builders/auto-linux-32-nopt-t/builds/1635/steps/test/logs/stdio
[05:28:01] <acrichto> sfackler: looked like it was a test added in that commit
[05:29:19] <sfackler> oh, I thought it was the native lock commit c.c
[05:29:46] <acrichto> our build system is bad
[05:29:55] <acrichto> if you delete a file and don't run make clean everything dies
[05:30:00] <acrichto> and of course make clean on windows does nothing
[05:30:03] <acrichto> b/c the find command isn't htere
[05:31:57] <dbaupp> acrichto: does reachable need to visit the expr on the RHS of `static BAR: type = ...;`? because it doesn't currently
[05:41:47] <acrichto> dbaupp: hm, I don't think so
[05:42:05] <acrichto> all symbols generated in the middle shouldn't be accessible anyway
[05:42:08] <acrichto> only the root symbol
[05:50:59] *** Quits: jdm (jdm@moz-99690620.hinet-ip.hinet.net) (Ping timeout)
[05:51:32] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[05:51:32] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14dd914d7 to 14ab7fe9d: 02http://git.io/N3iJvQ
[05:51:32] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[05:51:39] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[05:51:39] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/QccMpw
[05:51:39] <ghrust> 13rust/06auto 1424eb1b4 15Alex Crichton: Implement a native mutex type...
[05:51:39] <ghrust> 13rust/06auto 14e8bf078 15Alex Crichton: Remove the C++ lock_and_signal type...
[05:51:40] <ghrust> 13rust/06auto 14508b7b9 15Alex Crichton: Move runtime files to C instead of C++...
[05:51:42] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[05:51:59] <cmr> acrichto: mingw doesn't distribute find?!
[05:52:15] <acrichto> cmr: they do, apparently the bots are using windows find though
[05:52:21] <cmr> ...oh
[05:52:29] <acrichto> not sure why
[05:52:33] <acrichto> didn't want to find out
[05:52:41] <acrichto> was easier to just make the makefiles awful for now
[05:56:00] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[05:56:04] *** Joins: jdm (jdm@moz-99690620.hinet-ip.hinet.net)
[06:01:10] <ktt3ja> acrichto: if I have a `pub struct Foo;` that's never used, and the crate is not being built as a library, should `Foo` be warned?
[06:02:20] <ktt3ja> this is for dead-code warning pass, btw
[06:04:06] <cmr> ktt3ja: ehh, I'd say no
[06:04:14] <cmr> Wel
[06:04:15] <cmr> *Well
[06:04:17] <cmr> Actually, yes.
[06:04:55] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Ping timeout)
[06:05:17] <strcat> acrichto: why does it need find?
[06:05:26] <acrichto> ktt3ja: if it's unreachable, then possibly, but reachable code should probably never get warned about
[06:05:39] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[06:05:45] <acrichto> strcat: we have .d files that are included, and the old .d files point to a nonexistent file, we use find to clean out the old ones
[06:06:17] <strcat> acrichto: I don't get it ;p
[06:06:21] <strcat> example?
[06:06:33] <acrichto> rust_builtin.cpp used to exist
[06:06:40] <acrichto> rust_builtin.d pointed to the cpp file
[06:06:44] <acrichto> I moved that to rust_builtin.c
[06:06:56] <acrichto> the .d file has a target pointing at the cpp file
[06:07:08] <acrichto> when not cleaned out, it points to the old file
[06:07:16] <acrichto> make then errors out
[06:08:03] <strcat> acrichto: so what is find being used for? finding the .d files?
[06:08:19] <acrichto> find $target -name '*.[doasS]' | xargs rm
[06:08:45] <strcat> acrichto: could just use a glob
[06:08:52] <strcat> there are recursive bash globs
[06:08:56] <acrichto> pull requests welcome
[06:11:03] <strcat> acrichto: shopt -s globstar; for file in **/*.{d,o,a,s,S}; do rm "$file"; done
[06:11:04] <strcat> :P
[06:11:17] <strcat> er
[06:11:48] * strcat forgot $target
[06:30:48] *** Quits: tikue (tkuehn@moz-DB51A23.pitbpa.fios.verizon.net) (Quit: tikue)
[06:33:55] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[06:49:11] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[06:49:11] *** ChanServ sets mode: +o tjc
[06:56:33] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[06:56:33] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/QccMpw
[06:56:33] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[07:01:38] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[07:01:38] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/t54y-A
[07:01:38] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[07:02:44] <cmr> acrichto: ping
[07:03:18] <dbaupp> ((C++)--)++ \o/
[07:04:06] <cmr> acrichto: unping
[07:06:35] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[07:06:35] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/t54y-A
[07:06:35] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[07:06:36] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[07:06:36] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/Fdpm8Q
[07:06:36] <ghrust> 13rust/06auto 14500a8f1 15Patrick Walton: libstd: Change all `~fn()`s to `proc`s in the standard library....
[07:06:36] <ghrust> 13rust/06auto 146a5736d 15Patrick Walton: libextra: Remove `~fn()` from libextra.
[07:06:37] <ghrust> 13rust/06auto 1477f621b 15Patrick Walton: librustc: Remove the one use of `~fn()`
[07:06:39] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[07:10:59] *** Joins: quvarxa (chatzilla@moz-978E4C31.static.tpgi.com.au)
[07:29:38] <cmr> strcat: mind weighing in on https://github.com/mozilla/rust/issues/10564 ?
[07:29:51] <strcat> you 403 Forbidden
[07:29:53] <strcat> Request forbidden by administrative rules. 
[07:30:03] <strcat> oh wow I get 403 for all of github
[07:30:06] <strcat> wtf?
[07:30:11] <cmr> that's not good
[07:30:17] <cmr> still wfm :\
[07:33:19] <dbaupp> strcat: have you been spamming github with too many force-pushed? :P
[07:33:21] <dbaupp> *pushes
[07:33:27] <strcat> nope ;[
[07:33:30] <strcat> I wasn't doing *anything*
[07:33:56] <dbaupp> cmr: do I count as weighing in? :P
[07:34:05] <strcat> I had rust-core open in a tab and I guess I recently opened a bug
[07:34:07] <strcat> nothing else ;\
[07:34:24] <cmr> dbaupp: feel free to comment on it :p
[07:34:36] <cmr> strcat: email support@github.com ?
[07:34:43] <strcat> I'll wait a bit first
[07:34:48] *** kimundi is now known as zz_kimundi
[07:34:51] <strcat> then I'll try smacking it, that always works
[07:34:54] <cmr> heh
[07:35:04] <ktt3ja> hmm
[07:35:07] <ktt3ja> now I get 403, too
[07:35:14] <strcat> http://www.brennanv.com/errors/forbidden-403.html wtf.
[07:35:50] <strcat> I guess I shouldn't have enabled js, a 404 page has never tried to give me a heart attack before
[07:35:52] <cmr> The raptor was a ncie surprise
[07:35:55] <dbaupp> haha
[07:35:56] <cmr> :P
[07:36:02] * cmr also jumped a bit
[07:36:16] <dbaupp> "All systems operational" https://status.github.com/
[07:36:26] <klutzy> I also got 403 for all pages
[07:36:38] <klutzy> some others don't. strange
[07:37:04] <dbaupp> http://www.brennanv.com/errors/404-Notfound.html is disappointing :(
[07:37:55] <klutzy> dbaupp: 404 page has 403 in title
[07:38:03] <dbaupp> haha
[07:38:06] <dbaupp> so it does
[07:38:16] <cmr> And now I get 403 too
[07:38:19] <strcat> dbaupp: the links on the home page don't work for me at all ;p
[07:38:36] <strcat> cmr: github got you all for associating with a known force pusher
[07:38:57] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: Textual IRC Client: www.textualapp.com)
[07:38:57] <ktt3ja> dbaupp is the last man standing
[07:39:00] <strcat> dbaupp: http://i.imgur.com/2A3ihEW.gif
[07:39:05] <cmr> strcat: I was unaware github followed Order 66 :(
[07:39:25] <dbaupp> strcat: ahahaha
[07:40:17] * dbaupp merrily continues using github without a hint of a 403
[07:42:08] <strcat> on the positive side I can still force push
[07:42:17] <strcat> I just can't visit anything via http
[07:42:34] <strcat> I guess I'm lucky I don't use git over https? ;p
[07:46:09] <cmr> http://blog.booking.com/hardening-perls-hash-function.html
[07:46:40] <cmr> It's scary when your hashmap implementation becomes security-critical
[07:46:43] <dbaupp> ah, there we go
[07:46:54] <dbaupp> a good old 403
[07:47:39] <dbaupp> cmr: we already have a good implementation though (for exactly that reason)
[07:47:45] <cmr> I know
[07:51:24] <cmr> Ooh, the 403s have stopped
[07:52:18] <strcat> not for me.
[07:52:24] <cmr> I had to clear my cache
[07:52:33] <cmr> Or.. maybe not
[07:52:44] <cmr> It did work for a minute or so htere :p
[07:52:57] <strcat> cmr: ah ctrl-f5 worked
[07:52:59] <klutzy> ^f5 or just waiting did the magic for me
[07:53:08] <strcat> f5 doesn't work
[07:53:13] <strcat> so yeah, something in my cache is screwed
[07:53:17] <strcat> I wonder how that happens ;s
[07:53:29] <strcat> how can it *still* be broken after I just loaded it with ctrl-f5?
[07:53:38] <strcat> oh nvm it's totally gone now
[07:53:44] * strcat thinks that was a fluke
[07:56:24] *** Quits: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP) (Ping timeout)
[07:56:31] *** Joins: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP)
[07:56:43] <cmr> It seems OPW is bringing in a bunch of contributions?
[07:57:32] <klutzy> ahh, 403 again
[07:57:41] <cmr> Yes, I'm getting them sporadically now
[07:57:52] <cmr> ctrl-shift-r clears them up though
[08:11:30] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[08:11:30] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Fdpm8Q
[08:11:30] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[08:16:29] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[08:16:29] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/0bXoSQ
[08:16:29] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[08:16:37] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[08:16:37] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/dQVVQA
[08:16:37] <ghrust> 13rust/06auto 14119a181 15Alex Crichton: Implement more native file I/O...
[08:16:37] <ghrust> 13rust/06auto 144cd8249 15bors: auto merge of #10495 : alexcrichton/rust/more-native-io, r=brson...
[08:16:38] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[08:25:26] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[08:26:29] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[08:26:29] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 144cd8249 to 14f4c22f7: 02http://git.io/N3iJvQ
[08:26:29] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[08:26:33] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[08:26:33] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/pVGpPQ
[08:26:33] <ghrust> 13rust/06auto 14e6fb622 15Huon Wilson: std::rand: wrappers for floats from [0,1] and (0,1)....
[08:26:33] <ghrust> 13rust/06auto 14c4e28ae 15bors: auto merge of #10542 : huonw/rust/open01, r=alexcrichton...
[08:26:33] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[08:31:35] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Connection reset by peer)
[08:32:42] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[08:34:19] *** zz_kimundi is now known as kimundi
[08:37:12] *** flaper87|afk is now known as flaper87
[08:50:24] *** Quits: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP) (Ping timeout)
[09:27:18] *** Joins: jensnockert (jensnocker@E26F71DB.81840CBC.B0E77544.IP)
[09:29:02] *** Quits: Kxepal (Miranda@moz-ADF2988C.pppoe.mtu-net.ru) (Ping timeout)
[09:31:32] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[09:31:32] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/pVGpPQ
[09:31:32] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[09:32:18] *** Joins: Kxepal (Miranda@moz-E7192F22.pppoe.mtu-net.ru)
[09:36:27] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[09:36:27] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/4K87jQ
[09:36:27] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[09:36:29] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[09:36:29] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/NA5Q7w
[09:36:29] <ghrust> 13rust/06auto 14632b6fe 15Patrick Walton: libstd: Change all `~fn()`s to `proc`s in the standard library....
[09:36:29] <ghrust> 13rust/06auto 1473b43f2 15bors: auto merge of #10554 : pcwalton/rust/procify-libstd, r=pcwalton...
[09:36:30] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[09:37:33] <dbaupp> erm, didn't that just land?
[09:37:40] <dbaupp> https://github.com/mozilla/rust/pull/10561 ?
[09:38:49] <cmr> How did bors even let that in?
[09:38:55] <cmr> It has merge conflicts according to the webui
[09:39:25] * dbaupp close it
[09:41:25] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[09:41:25] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1473b43f2 to 14c4e28ae: 02http://git.io/N3iJvQ
[09:41:25] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[09:41:26] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[09:41:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/HZBQDw
[09:41:26] <ghrust> 13rust/06auto 14df0f503 15Huon Wilson: Mark some derived methods as #[inline]....
[09:41:26] <ghrust> 13rust/06auto 149647d58 15bors: auto merge of #10557 : huonw/rust/inline-deriving, r=pcwalton...
[09:41:26] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[09:43:52] <dbaupp> cmr: probably because actual-git detected they were the same and just elided the merge https://github.com/mozilla/rust/commit/73b43f27443a0f6d986ae11c9c6e3be72152a0bb
[09:47:49] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[10:02:17] *** Quits: quvarxa (chatzilla@moz-978E4C31.static.tpgi.com.au) (Ping timeout)
[10:03:39] *** Joins: quvarxa (chatzilla@moz-978E4C31.static.tpgi.com.au)
[10:23:59] *** Quits: jensnockert (jensnocker@E26F71DB.81840CBC.B0E77544.IP) (Input/output error)
[10:41:35] *** kimundi is now known as zz_kimundi
[10:43:29] <friggle> nmatsakis: pnkfelix is offline now, but saw discussion of stackmaps in llvm in scrollback. An Ocaml hacker gave a talk about that here (Cambridge) yesterday. Basically it can be done with llvm.gcroot, but it's painful as a stackmap can not handle values in registers so you have to spill, and this hurts
[10:44:10] *** zz_kimundi is now known as kimundi
[10:44:42] <friggle> but modulo bugs, gcroot+spilling everything should work
[10:46:43] *** Joins: w3lcome (Mibbit@moz-177EEEFC.home.otenet.gr)
[10:47:20] *** Quits: w3lcome (Mibbit@moz-177EEEFC.home.otenet.gr) (Quit: http://www.mibbit.com ajax IRC Client)
[10:47:41] *** Joins: w3lcome (Mibbit@moz-177EEEFC.home.otenet.gr)
[11:01:46] <nmatsakis> friggle: thanks
[11:02:40] <friggle> there were general feelings that many people would find a solution supporting registers useful, but of course nobody has taken the lead on implementing it...
[11:02:50] <nmatsakis> friggle: what precisely do you mean by "have to spill" -- i.e., in the generating IR we have to create loads/stores?
[11:03:10] <nmatsakis> yes, we tried for a while, but I think we've given up
[11:03:52] <nmatsakis> I have come to the opinion that I... don't care. At least not right now. Spilling seems like a small price to pay for functioning GC, and this can be overcome later -- esp since it's only GC roots, which in Rust is not nearly as prevelant as other langs
[11:04:14] <nmatsakis> but I'm not the only one who is involved in this decision :) 
[11:05:51] <friggle> nmatsakis: that is my understanding. The llvm.gcroot intrinsic can't be applied to a register
[11:07:10] <nmatsakis> right
[11:08:19] <friggle> nmatsakis: spilling certaily seems less costly than the alternatives: conservative scanning, putting pointers on a separate stack (ghc does this), a shadow stack (which I admit I don't really follow how it helps)
[11:09:36] <nmatsakis> friggle: or, I believe, ref counting (what we currently do)
[11:10:41] <nmatsakis> friggle: a shadow stack is very similar to spilling, just minus the stack maps. basically you just put structs onto the stack with all your roots, and each struct has a pointer to the prior stack frame and a descriptor, so your "stack map" is built dynamically, rather than being built on the side and then walked using the frame pointers etc
[11:11:06] <friggle> nmatsakis: ah I see, thanks
[11:11:06] <nmatsakis> friggle: a separate stack may not actually be all *that* costly
[11:11:09] *** Quits: jdm (jdm@moz-99690620.hinet-ip.hinet.net) (Quit: Lost terminal)
[11:11:21] <nmatsakis> might be worth investigating
[11:11:37] <nmatsakis> still, all things being equal, I'd be inclined to do it "the llvm way", on the basis that it will be improved upon over time
[11:12:27] <friggle> nmatsakis: well, any of those options could be considered the "LLVM way" :) but yes, using gcroot and accepting it should be improved in future seems sensible
[11:14:15] <strcat> I don't think it really matters if the GC is a super-leaky conservative implementation with long pauses and low throughput... Rust offers plenty of alternatives (we've made it this far without a GC, it can't be that important)
[11:14:21] <strcat> it's task-local anyway
[11:14:29] <strcat> so it won't pause the whole process
[11:15:56] <strcat> as long as it exists so the Gc<T> API can be made
[11:15:57] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[11:17:20] <strcat> the important property of a GC is supporting user-defined data structures
[11:17:40] <friggle> strcat: but given that register spilling or shadow stacks are relatively easy to implement and precise, is there any real advantage of being conservative?
[11:17:46] <strcat> not being able to define a custom vector in a library is a deal-breaker for the language imo
[11:18:22] <strcat> friggle: well if it's easy, why isn't it implemented? ;p
[11:18:37] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[11:19:03] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[11:19:38] <friggle> strcat: I meant not appreciably more complex than the conservative scan :)
[11:19:55] <strcat> a very conservative GC doesn't do anything ;p
[11:20:13] <strcat> why bother looking for things that might be references if you can just leak!
[11:20:56] <strcat> (seriously though, I'd love to have #[thread_local] + support for Drop types in #[thread_local] so I could have thread-local allocators...)
[11:21:07] <strcat> well I guess I could use pthread_cleanup
[11:21:23] <strcat> and atexit for main()
[11:21:35] <nmatsakis> what is #[thread_local] supposed to mean?
[11:21:48] <strcat> nmatsakis: https://github.com/mozilla/rust/pull/10312
[11:21:55] <strcat> it doesn't really work for the stdlib
[11:22:10] <strcat> it's enough for rust-core to have static thread-locals, wrapped behind a macro it can be a safe API
[11:22:19] <nmatsakis> ah, ok
[11:22:32] <friggle> strcat: it is on the agenda for today https://etherpad.mozilla.org/Rust-meeting-weekly
[11:23:37] <strcat> nmatsakis: it was just a weird thought, a thread-local leak-until-thread-ends allocator ;p
[11:24:21] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[11:24:54] <friggle> strcat: well that's a pretty sensible technique. Seems morally similar to Apache using a pool allocated and then deallocated for each request
[11:24:56] <nmatsakis> strcat: I imagine it'd be easy enough to build by combining TLS with an arena
[11:24:59] <strcat> that's basically what jemalloc/tcmalloc do anyway...
[11:25:00] *** Joins: tikue (quassel@moz-FEADCD38.hsd1.pa.comcast.net)
[11:25:13] <nmatsakis> strcat: we probably need to rationalize our TLS APIs a bit; specifically to support lifetime'd things like arenas better
[11:25:20] <nmatsakis> I haven't really looked at them in detail,
[11:25:26] <strcat> nmatsakis: I really like the C++11 thread-local storage
[11:25:41] <strcat> static init + dtors run on end of threads is fantastic
[11:25:44] * strcat shrugs
[11:25:45] <nmatsakis> I'd like to be able to do tls::push(my_tls_key, &arena, || ... /* arena is value for my_tls_key here */)
[11:25:57] <strcat> it's harder in rust because of safety issues
[11:27:15] <nmatsakis> hmm I have to think if that works :) specifically, what type does tls::get(my_tls_key) return? it'd have to be tls::with(my_tls_key, || ...)
[11:27:33] <nmatsakis> well, anyway, a TLS stack, with whatever API, would be nice.
[11:27:45] <strcat> nmatsakis: it could return & without a closure
[11:27:53] <nmatsakis> no, it can't. with what lifetime?
[11:28:06] <strcat> just tie it to the current scope?
[11:28:15] <nmatsakis> what is the "current scope"?
[11:28:26] <nmatsakis> we could conceivably add a new feature
[11:28:29] <nmatsakis> but if you have:
[11:28:39] <nmatsakis> fn tls_get<T>(key: TlsKey<T>) -> &'z T
[11:28:42] <nmatsakis> you need to write somtehing for 'z
[11:28:45] <strcat> well I was thinking a macro could output a local that's not going to go out of scope immediately but maybe they can't do that
[11:29:37] <nmatsakis> I'm not sure what you mean by "not going to go out of scope immediately"
[11:30:15] <strcat> well it doesn't really make sense, it wouldn't work :)
[11:30:17] <nmatsakis> the main thing I am trying to prevent is that the value returned by tls_get outlives the tls_push
[11:30:33] <nmatsakis> but using a closure is straightforward enough and not (I don't think) particularly expensive
[11:30:49] <nmatsakis> this would be more of a building block API anyhow
[11:31:52] <nmatsakis> though this has some similarities with arenas
[11:32:49] <nmatsakis> in the sense that it'd be nice to be able to do "let arena = Arena::new()" and have the type of arena be `Arena<'foo>` where `'foo` is the lifetime of the block where arena will be dropped
[11:32:57] <nmatsakis> there could be a feature brewing there ;)
[11:33:21] <strcat> 'self is now a regular lifetime name, right? we should really replace them all with 'a or something
[11:33:32] <strcat> people are going to be confused by it far into the future otherwise ;p
[11:33:35] <dbaupp> need a snap, I think
[11:34:46] <cmr> I agree
[11:35:43] * strcat likes `let lock = mutex.lock(); cond.wait(&mut lock, || x != foo);` as a mutex API
[11:36:00] <cmr> strcat: that is very nice
[11:36:09] <Yurume> what's x?
[11:36:30] <cmr> Yurume: something in the environment.
[11:36:31] <strcat> some condition to wait for, you have to loop on it so it might as well loop for you
[11:37:34] <strcat> I'm not really sure if you'd ever wait on a cond var and not loop
[11:37:53] <strcat> doesn't seem like you would because it can arbitrarily unblock for no reason
[11:38:00] <cmr> only if you like spurious wakeups :P
[11:38:02] <nmatsakis> strcat: yes I wanted to make 'self illegal, actually
[11:38:10] <nmatsakis> once a snap occurs and we migrate
[11:38:21] <strcat> nmatsakis: as in a lint?
[11:38:23] <nmatsakis> mostly because it seems like a potentially useful reserved word for the future
[11:38:29] <strcat> oh so a real check
[11:38:30] <nmatsakis> no, a hard error
[11:38:39] <nmatsakis> I was going to bring this up at the mtg,
[11:38:45] <nmatsakis> should put it on the agenda 
[11:39:11] <nmatsakis> basically I think there's a useful feature that I don't quite know the contours of yet
[11:39:19] <nmatsakis> maybe 2 of them
[11:39:25] <nmatsakis> to be able to have region pointers that don't outlive an object
[11:39:30] <nmatsakis> and `'self` seems like a good name for it
[11:39:58] <nmatsakis> where by object I mean struct really
[11:40:34] <dbaupp> (isn't self currently a reserved word? or only in the context of values?)
[11:40:47] <cmr> rusti: let self = 5; self
[11:40:48] -rusti- <anon>:9:9: 9:12 error: found `self` in ident position
[11:40:48] -rusti- <anon>:9          let self = 5; self
[11:40:48] -rusti-                   ^~~
[11:40:48] -rusti- error: aborting due to previous error
[11:40:48] -rusti- application terminated with error code 101
[11:40:53] <cmr> Heh, nice span
[11:42:30] <nmatsakis> dbaupp: not for lifetimes unfortunately. we probably ought to make all keywords illegal as lifetime names, but we don't presently
[11:42:40] <nmatsakis> dbaupp: or at least all keywords that don't have special meaning, i.e., 'static
[11:42:45] <dbaupp> nmatsakis: ah, I see.
[11:43:09] <dbaupp> should I file an issue?
[11:45:32] * dbaupp does so
[11:46:10] <nmatsakis> dbaupp: yeah you ought to
[11:46:15] <nmatsakis> dbaupp: issue #?
[11:47:05] <dbaupp> https://github.com/mozilla/rust/issues/10565
[11:48:21] <dbaupp> nmatsakis: ^
[11:48:27] <nmatsakis> dbaupp: thanks
[11:50:09] <cmr> I thought that was a PR for a sec
[11:50:16] <cmr> Was almost massively impressed :P
[11:51:12] <dbaupp> cmr: I got about 20 minutes from pcwalton asking to opening https://github.com/mozilla/rust/pull/10557 this morning  :P
[11:52:36] <cmr> I *was* impressed by that
[11:54:17] *** Joins: jensnockert (jensnocker@E26F71DB.81840CBC.B0E77544.IP)
[11:55:07] <dbaupp> I'd been thinking about it for a while, and I know that code like the back of my hand, so it's not that cool :P
[11:56:03] <cmr> yeah but it's still cool
[11:56:05] <cmr> "I want X"
[11:56:12] <cmr> > X happens almost immediately
[11:56:18] <dbaupp> haha
[11:56:26] * dbaupp liked his moment of being acrichto
[11:56:32] <cmr> heh
[11:56:34] <cmr> so true
[12:02:27] <dbaupp> http://buildbot.rust-lang.org/builders/auto-mac-64-nopt-t/builds/1643/steps/test/logs/stdio :(
[12:02:32] <dbaupp> is that happening a lot?
[12:03:01] * dbaupp retries
[12:05:54] <cmr> Yikes, are our atomics broken?
[12:06:22] <dbaupp> cmr: in what sense?
[12:06:26] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[12:06:26] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 149647d58 to 14c4e28ae: 02http://git.io/N3iJvQ
[12:06:26] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[12:06:35] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[12:06:35] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/oL2Qhg
[12:06:35] <ghrust> 13rust/06auto 14df0f503 15Huon Wilson: Mark some derived methods as #[inline]....
[12:06:35] <ghrust> 13rust/06auto 1432f6c11 15bors: auto merge of #10557 : huonw/rust/inline-deriving, r=pcwalton...
[12:06:35] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[12:07:55] <cmr> dbaupp: in that they're hanging on mac nopt
[12:08:44] <dbaupp> cmr: does it happen regularly?
[12:08:56] <cmr> dbaupp: not that I've seen, no
[12:09:35] <dbaupp> cmr: we'll see if it's my problem then.
[12:11:27] *** Quits: jensnockert (jensnocker@E26F71DB.81840CBC.B0E77544.IP) (Input/output error)
[12:11:37] *** Joins: jensnockert (jensnocker@E26F71DB.81840CBC.B0E77544.IP)
[12:12:57] <cmr> dbaupp: maybe something is getting inlined and LLVM is reordering some things in a way that breaks our code?
[12:13:25] <cmr> Though it looks like it's not even hanging in a test..
[12:25:21] *** Quits: jensnockert (jensnocker@E26F71DB.81840CBC.B0E77544.IP) (Input/output error)
[12:25:53] *** Joins: jensnockert (jensnocker@E26F71DB.81840CBC.B0E77544.IP)
[12:27:36] *** Quits: jensnockert (jensnocker@E26F71DB.81840CBC.B0E77544.IP) (Ping timeout)
[12:30:34] *** Joins: jensnockert (jensnocker@E26F71DB.81840CBC.B0E77544.IP)
[12:37:52] *** Quits: doomlord_ (servitor@moz-4625DF14.range86-184.btcentralplus.com) (Ping timeout)
[12:38:04] *** Joins: doomlord_ (servitor@moz-4625DF14.range86-184.btcentralplus.com)
[12:47:07] *** Quits: quvarxa (chatzilla@moz-978E4C31.static.tpgi.com.au) (Quit: ChatZilla 0.9.90.1 [Firefox 26.0/20131114085019])
[12:48:48] <strcat> nmatsakis: ~[1, 2, 3] and ~([1, 2, 3]) would still be different types under DST for vectors, right?
[12:49:27] <strcat> because fixed-size arrays being fixed-size is a property that's not just related to memory allocation
[12:49:45] <strcat> (although it's a driving force for having them)
[13:01:04] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[13:04:35] *** kimundi is now known as zz_kimundi
[13:08:45] *** Joins: blank_name (blank_name@FAB53C88.7071B2C8.31EC03F3.IP)
[13:11:24] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[13:11:24] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/oL2Qhg
[13:11:24] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[13:12:09] <dbaupp> cmr: it seemed to work that time
[13:12:23] <cmr> dbaupp: did you change anything or just retry?
[13:13:29] <dbaupp> cmr: just retry
[13:16:26] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[13:16:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/NP2ozQ
[13:16:26] <ghrust> 13rust/06auto 1410b956a 15Alex Crichton: Allow piped stdout/stderr use uv_tty_t...
[13:16:26] <ghrust> 13rust/06auto 14d57765d 15bors: auto merge of #10558 : alexcrichton/rust/faster-stdout, r=pcwalton,pcwalton...
[13:16:26] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[13:24:18] *** zz_kimundi is now known as kimundi
[13:24:25] *** Quits: jensnockert (jensnocker@E26F71DB.81840CBC.B0E77544.IP) (Input/output error)
[13:27:36] *** Joins: jensnockert (jensnocker@E26F71DB.81840CBC.B0E77544.IP)
[14:12:32] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[14:13:56] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[14:18:53] *** Joins: jdm (jdm@moz-ED0C7AC7.hinet-ip.hinet.net)
[14:21:29] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[14:21:29] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/NP2ozQ
[14:21:29] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[14:25:27] *** Quits: w3lcome (Mibbit@moz-177EEEFC.home.otenet.gr) (Quit: http://www.mibbit.com ajax IRC Client)
[14:55:32] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[15:05:17] *** kimundi is now known as zz_kimundi
[15:12:52] *** zz_kimundi is now known as kimundi
[15:17:49] <nmatsakis> pnkfelix: I thought of a complication re: GC
[15:18:02] <nmatsakis> pnkfelix: well, more of an interaction I hadn't considered
[15:18:27] <pnkfelix> nmatsakis: over here, I thought of another reason to use conservative stack scanning
[15:18:30] <nmatsakis> pnkfelix: if we opt for Vector<T> over DST -- and to some extent even if we don't -- we'll have to be prepared to trace through a *T that points at multiple T values
[15:18:43] <nmatsakis> pnkfelix: so the idea of "just trace *T" doesn't really work
[15:18:54] <pnkfelix> nmatsakis: namely that I fully expect people to be loosey-goosey with transmutes on local varialbes to get our intptr_t's.
[15:19:14] <nmatsakis> pnkfelix: true. but that's more of an argument *against* conservative stack scanning in my book.
[15:19:26] <pnkfelix> nmatsakis: in that bugs will go masked?
[15:19:27] <nmatsakis> i.e., I want that to break :)
[15:19:30] <nmatsakis> pnkfelix: yes.
[15:19:45] <nmatsakis> pnkfelix: well unless we are prepared to commit to conservative
[15:19:54] <pnkfelix> nmatsakis: hmm.  I dunno.  I like being able to debug code by putting in printouts of pointers and computations on pointers.
[15:20:05] <nmatsakis> pnkfelix: but there do seem to be nasty interactions between conservative and tracing through smart ptrs
[15:20:07] <pnkfelix> nmatsakis: obviously we can handle that in some other ways
[15:20:13] <pnkfelix> nmatsakis: but, back to the problem you noted
[15:20:15] <nmatsakis> pnkfelix: oh, transmuting is fine,
[15:20:27] <nmatsakis> pnkfelix: the problems arise when you don't root etc
[15:20:38] <nmatsakis> to put another way, ptr -> int: check plus, int -> ptr: check minus
[15:20:44] <nmatsakis> though I know sometimes it happens
[15:21:03] <nmatsakis> pnkfelix: anyway, yes, about the problems I noted, carry on :)
[15:21:06] <pnkfelix> nmatsakis: well, that plus ptr -> int and assuming the address is meaningful post GC, check minus.  (unless we promise to pin objects reachable via stack)
[15:21:29] <pnkfelix> nmatsakis: on the problem you noted
[15:21:30] <nmatsakis> yes, I was being blithe
[15:21:38] <nmatsakis> mainly I meant: ptr -> int for the purpose of debug printout, np
[15:21:40] <nmatsakis> :)
[15:21:51] <nmatsakis> except that you may find it harder to interpret than you expect I guess
[15:21:53] <pnkfelix> nmatsakis: Things like this are what I thought we might want a Tracable trait for
[15:22:07] <pnkfelix> nmatsakis: i.e. so that a smart pointer can tell the GC how to walk through the *T payload.
[15:22:17] <pnkfelix> Traceable, not "Tracable"
[15:22:42] <nmatsakis> yes, I was thinking that way too
[15:23:16] <nmatsakis> not sure what the full implications of that are
[15:23:18] <pnkfelix> all the more reason we need a GC soon
[15:23:26] <pnkfelix> in order to be able to work out the API
[15:23:44] <nmatsakis> but how does this work with conservative stack scanning?
[15:23:53] <nmatsakis> i.e., if there is a Smaht<T> on the stack,
[15:23:59] <nmatsakis> absent some sort of stack map,
[15:24:03] <nmatsakis> how can we invoke its trace method?
[15:24:14] <nmatsakis> pnkfelix: ^
[15:25:23] <pnkfelix> nmatsakis: you're right, I was thinking that Smaht<T> would have pointers to either ~-allocated or GC-allocated things
[15:25:40] <pnkfelix> nmatsakis: and those could have info in headers of their allocation blocks 
[15:26:07] <pnkfelix> nmatsakis: but that won't help for stack-allocated data that you create a Smaht<T> into.
[15:26:12] <eddyb> is that german? Smaahhht?
[15:26:17] <nmatsakis> bostonian
[15:26:18] <pnkfelix> eddyb: bostonian.
[15:26:28] <pnkfelix> eddyb: like "Cahh"
[15:26:38] <eddyb> as in, from Boston? lol, TIL
[15:26:48] <nmatsakis> pnkfelix and I share Boston... "roots" isn't quite right. "connection" :)
[15:27:40] <nmatsakis> pnkfelix: anyway, it also wouldn't help for a smart pointer that wants to do the allocation itself in some other way
[15:28:22] <pnkfelix> nmatsakis: there is another way, but I'm not thrilled by it
[15:28:22] <nmatsakis> pnkfelix: also, there was some comments on this channel earlier from friggle regarding an experience report from ocaml
[15:29:05] <nmatsakis> pnkfelix: go on
[15:29:06] *** kimundi is now known as zz_kimundi
[15:29:09] <pnkfelix> nmatsakis: namely force everyone to use a malloc we provide, BDW style
[15:29:33] <pnkfelix> nmatsakis: unlike BDW, we don't scan every task or block every task
[15:30:01] <pnkfelix> nmatsakis: but like BDW, we maintain ability to conservatively scan a task's stack and the non-GC-allocated memory reachable from that task's stack.
[15:31:05] <pnkfelix> nmatsakis: But I don't really like this idea
[15:31:11] <nmatsakis> ok, that's... effectively the same thing, no?
[15:31:18] <nmatsakis> pnkfelix: yeah I'm not thrilled about it.
[15:31:21] <pnkfelix> nmatsakis: same thing as BDW?  No.
[15:31:25] <pnkfelix> nmatsakis: I don't think it is, at least
[15:31:30] <nmatsakis> pnkfelix: no I mean same thing as expecting `~`
[15:31:36] <pnkfelix> nmatsakis: oh oh
[15:31:37] <nmatsakis> pnkfelix: not quite but basically we're saying we want to control alloc
[15:31:44] <pnkfelix> nmatsakis: hmm
[15:31:55] <pnkfelix> nmatsakis: I guess it would be
[15:32:36] <pnkfelix> nmatsakis: except that native libraries would presumably also link to our malloc ?
[15:32:51] <pnkfelix> nmatsakis: but other than that, yeah, its basically the same thing.
[15:33:09] * nmatsakis frowns
[15:33:37] <nmatsakis> pnkfelix: yeah so I feel like precise stack walking is more appealing
[15:33:52] <pnkfelix> nmatsakis: yeah I don't see a way around it for this use case
[15:34:06] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[15:34:11] <pnkfelix> nmatsakis: unless smart pointers
[15:34:14] <pnkfelix> nmatsakis: had to also carry
[15:34:18] <pnkfelix> nmatsakis: a dynamic tag
[15:34:25] <pnkfelix> nmatsakis: for the GC's use
[15:34:50] <pnkfelix> nmatsakis: for looking up its Traceable code.  (Or equivalently, carry a vtable ptr)
[15:35:22] <pnkfelix> nmatsakis: so instead of static stack maps, shift the problem to the dynamic end
[15:35:39] <nmatsakis> pnkfelix: how will you recognize this dynamic tag?
[15:36:03] <pnkfelix> nmatsakis: I was about to say "conservatively"
[15:36:13] <pnkfelix> nmatsakis: but that is bad and dangerous in this context.
[15:37:01] <pnkfelix> nmatsakis: (the (bad) idea being: ensure the runtime knows what the finite set of smart pointers vtables are, so that it can recognize pointers to them.  But this is totally unsound and gross)
[15:37:15] <pnkfelix> nmatsakis: So yeah, back to static stack maps.  That's okay.
[15:39:40] <nmatsakis> pnkfelix: plus ... what if it's an int .. etc
[15:40:16] <pnkfelix> nmatsakis: yeah, false matches were the source of unsoundness I was concerned about.
[15:40:57] <nmatsakis> right ok
[15:41:24] <nmatsakis> pnkfelix: seems to me that precise, whether it be via stack map or shadow stack, is way to go
[15:41:37] <nmatsakis> pnkfelix: still some details to be hammered out with respect to this Trace trait tho
[15:41:51] <nmatsakis> pnkfelix: I guess we can look to SM for inspiration, though what it does is...pretty simple
[15:41:53] <pnkfelix> nmatsakis: yes I cannot figure out a sane way to support arbitrary smart pointers without precise stack walking.
[15:42:43] <pnkfelix> nmatsakis: if I were doing this on my own I'd take the short cut of not allowing arbitrary smart pointers
[15:42:45] <nmatsakis> pnkfelix: In particular I'm wondering ... does this imply Traceable bounds? Are we going to need #[deriving(Trace)] everywhere?
[15:42:51] <pnkfelix> nmatsakis: probably.
[15:43:06] <nmatsakis> pnkfelix: we might be able to use the reflection
[15:43:26] <pnkfelix> nmatsakis: my plan has been to try to use the reflection
[15:43:33] <pnkfelix> nmatsakis: for the prototype i'm working on now
[15:44:05] <pnkfelix> nmatsakis: but it might not be expressive enough
[15:44:14] <eddyb> #[not_deriving(Trace)] with default depending on the presence of a Traceable lang item?
[15:44:25] <nmatsakis> disallow smart ptrs from storing managed data might be expedient
[15:44:34] <nmatsakis> but it is a cop out ;)
[15:44:47] <pnkfelix> nmatsakis: that would fall under 'disallow arbitrary smart pointers'
[15:44:52] <nmatsakis> pnkfelix: that's what I meant
[15:44:57] <eddyb> kinda like #[no_freeze] right now
[15:45:07] <pnkfelix> nmatsakis: Its one of those things that *sounds* okay
[15:45:15] <pnkfelix> nmatsakis: but only if you only think about it shallowly
[15:45:32] <nmatsakis> eddyb: right now we do have "opt out" things for the "bounding traits" -- that is, those traits that are predicates over the type structure but carry no methods,
[15:45:46] <nmatsakis> eddyb: but we don't generally do it for traits with methods, I'd rather not start in on that
[15:46:00] <eddyb> hmm
[15:46:03] <pnkfelix> nmatsakis: namely, its disallowing any transitive reference to managed objects via smart pointers that sounds distatsteful.
[15:46:06] <pnkfelix> nmatsakis: though maybe ...
[15:46:10] <nmatsakis> eddyb: though I might make an exception in this instance.
[15:46:36] <nmatsakis> pnkfelix: I feel like I am not yet desperate enough to accept that restriction except as a temporary limitation
[15:47:11] <pnkfelix> nmatsakis: so, if we *did* accept that restriction, even temporarily
[15:47:28] <pnkfelix> nmatsakis: what would you then do, store numeric indices in the not-so-smart pointers ?
[15:47:46] <nmatsakis> pnkfelix: sorry I don't follow
[15:47:55] <nmatsakis> pnkfelix: numeric indices into what? 
[15:48:04] <pnkfelix> nmatsakis: and pass around a ~Context { vec: ~[@data] }
[15:49:15] <pnkfelix> nmatsakis: So here was my trail of thought: You've been using numeric indices into a vector for e.g. encoding graphs.
[15:49:54] <pnkfelix> nmatsakis: and I wanted to double-check whether such a strategy would succeed or fail if we started imposing these hypothetical restrictions on smart ptrs.
[15:50:27] <pnkfelix> nmatsakis: From an efficiency point-of-view, the above is a terrible idea.
[15:51:11] <nmatsakis> pnkfelix: are you saying, if we disallowed managed data in a smart ptr, but I *wanted* a smart ptr to managed data, what would I do?
[15:51:17] <pnkfelix> nmatsakis: right
[15:51:55] <nmatsakis> pnkfelix: ah. I... well, I don't rightly know. ;) I guess that'd be one workaround. As it happens, I don't frequently want smart pointers so it's not something I've given much thought to.
[15:52:45] <pnkfelix> nmatsakis: I wanted to work out mentally what one might try, and whether it would "work" or not.  (Where "work" here is largely: 1. Will it pass rustc's rules, and 2. Will it preserve the GC's expectations e.g. of being able to trace, and being able to relocate GC<T>'s.)
[15:53:22] <nmatsakis> pnkfelix: I see. So, sure, using indices and a context, if you can manage it, would seem to be a possible workaround
[15:54:18] <pnkfelix> nmatsakis: one issue I first worried about, was if you were breaking the GC's assumptions if you tried to put a &borrow of the ~Context into the smart pointer
[15:54:52] <nmatsakis> pnkfelix: wait, what ?
[15:54:59] <pnkfelix> nmatsakis: (or rather, what I'm really concerned about is if the ownership ends up getting *transferred* to the smart pointer.  So that the GC doesn't even know to trace the ~Context.)
[15:55:13] <nmatsakis> pnkfelix: we were thinking somewhat differently I guess, I thought you meant you'd pass around the Context separately
[15:55:22] <pnkfelix> nmatsakis: No, that is what I meant
[15:55:41] <pnkfelix> nmatsakis: I just want to make sure that small variations on the design
[15:55:50] <pnkfelix> nmatsakis: are either also legal, or disallowed by the rules
[15:55:52] <nmatsakis> pnkfelix: i.e., i'd have fn foo(x: Smaht<uint>, cx: &Context) { ... cx.vecs[*x] } 
[15:56:21] <pnkfelix> nmatsakis: in this case, ownership transfer of ~Context to a smart-ptr would be disallowed, because that would count as the smart-ptr having a reference to a GC-managed thing (transitively).
[15:56:48] <nmatsakis> pnkfelix: so per our discussion yesterday, we might need to trace smart pointers to find `&` references into managed things just to know if those mangaed things must be pinned
[15:57:16] <pnkfelix> nmatsakis: yes.  Yes.
[15:57:17] <nmatsakis> pnkfelix: so I think that even if we disallow smart ptrs from owning managed data -- or even *reaching* managed data -- we still can't have a moving collector unless we can trace
[16:00:42] *** Quits: jensnockert (jensnocker@E26F71DB.81840CBC.B0E77544.IP) (Input/output error)
[16:00:56] * nmatsakis fires up his notes -- this GC topic seems to have a lot of sharp edges
[16:01:04] <pnkfelix> nmatsakis: I'm just trying working through the whole example out loud.  But at this point I'm not able to convince myself that the rule of "No GC-managed things in smart-pointers" actually makes any sense, at least not in a world where one is allowed to borrow &T from @T
[16:01:29] <nmatsakis> agreed, it doesn't help much
[16:01:32] <pnkfelix> nmatsakis: and thus the supposed benefit of this limitation is nil
[16:02:58] <pnkfelix> nmatsakis: on the other hand
[16:03:11] <pnkfelix> nmatsakis: (another bad idea alret)
[16:03:15] <pnkfelix> (alert)
[16:03:17] <nmatsakis> :)
[16:03:43] <pnkfelix> nmatsakis: there is the option of requiring library smart pointers to know enough to register themselves as live roots
[16:03:55] <pnkfelix> nmatsakis: and deregistering themselves on destruction.  I think we briefly discussed this earlier.
[16:04:27] <pnkfelix> nmatsakis: this would probably be analogous to a user-implemented shadow stack, or something
[16:05:40] <nmatsakis> pnkfelix: yes, there is that option
[16:05:49] <nmatsakis> pnkfelix: hard to enforce
[16:06:14] <nmatsakis> pnkfelix: I wonder what we do when things are moved
[16:06:31] <pnkfelix> nmatsakis: well, we could pin things reachable from the shadow stack
[16:07:03] <pnkfelix> nmatsakis: (that or build movement into the api itself, but that requires more design work.)
[16:07:04] <nmatsakis> pnkfelix: yeah, ok, so you don't register the lvalue that may contain a rooted value but rather the value itself
[16:07:27] <pnkfelix> nmatsakis: yeah.  Or at least some way of discovering the value (or set of values)
[16:07:52] * cmr ignores the pnkfelix/nmatsakis discussion and hopes they know  what they're doing
[16:08:38] <nmatsakis> cmr: not yet ;) but hopefully we will 
[16:08:39] <pnkfelix> nmatsakis: becasue I assume some smart pointers libraries would be upset by the prospect of a separate stack pointer entry for every ptr
[16:08:56] <pnkfelix> nmatsakis: s/stack pointer entry/shadow stack entry/
[16:09:09] <nmatsakis> pnkfelix: it seems like a lot of work in any case
[16:09:19] <nmatsakis> pnkfelix: not obviously easier than some kind of tracing scheme
[16:09:28] <pnkfelix> nmatsakis: well, I look at it this way
[16:09:43] <pnkfelix> nmatsakis: we can provide libraries to use for the common cases
[16:10:05] <pnkfelix> nmatsakis: where the data to find is nicely laid out
[16:10:27] <pnkfelix> nmatsakis:   not that I actually  know what the real common cases are here.
[16:11:10] <pnkfelix> nmatsakis: I suppose that is part of my problem here.  I am wrestling with a gap between smart-ptr expressiveness  and  gc-design-sanity 
[16:11:29] <nmatsakis> yeah to some extent it's a "this or that pick one" question
[16:11:36] <pnkfelix> nmatsakis: where making the smart pointers arbitrarily expressive (rather than say making them all go through ~-allocation, as wel outlined earlier)
[16:11:36] <nmatsakis> but ain't that always the way
[16:11:54] <pnkfelix> nmatsakis: is making me jump through hoops on the hypothetical gc design
[16:12:13] <pnkfelix> nmatsakis: lets step back to the original question
[16:12:36] <pnkfelix> nmatsakis: namely, why doesn't conservative stack scanning work for us
[16:13:07] <friggle> well conservative rules out the ability to move objects
[16:13:31] <pnkfelix> friggle:  no.  A fully conservative gc would
[16:13:32] <nmatsakis> pnkfelix: you can't trace through smart pointers unless they use your allocator
[16:14:05] <nmatsakis> pnkfelix: I agree though, we should come up with a kind of decision tree -- there are goin to be a couple of logically coherent spots on the spectrum, with different tradeoffs
[16:14:17] <pnkfelix> friggle: google "Mostly Copying Garbage Collection"
[16:14:35] <pnkfelix> nmatsakis: the big spot where conservative stack scanning would fail for smart poitners
[16:14:48] <pnkfelix> nmatsakis: oh, you just said this: Its when the user uses their own allocator.
[16:14:56] <friggle> pnkfelix: thanks
[16:15:13] <pnkfelix> nmatsakis: so what about forcing them to register blocks of memory that they allocate with our GC's page table?
[16:15:20] <pnkfelix> nmatsakis: is that so absurd?
[16:15:57] <nmatsakis> pnkfelix: not necessarily
[16:16:12] <pnkfelix> nmatsakis: (answer: maybe.  I haven't thought too hard about what kind of page table we might end up using.)
[16:16:52] <pnkfelix> nmatsakis: back at Adobe I changed Flash from using a single bitmap to using a multilevel tree with bitmaps at the leasves
[16:17:13] <pnkfelix> nmatsakis: in order to deal with having to keep bits for potentially disparate blocks of alocated memory
[16:17:53] <pnkfelix> nmatsakis: such a scheme is not ideal.  but then again, it might end up being what we have to resort to, if we cannot force the user to go through our own allocator.
[16:18:35] <nmatsakis> pnkfelix: my (very) condensed notes so far: https://pastebin.mozilla.org/3635958
[16:18:48] <nmatsakis> pnkfelix: sound reasonable? also, I will prob walk home soon and hence be offline for 30 mins
[16:18:59] <pnkfelix> nmatsakis: k
[16:25:04] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[16:31:28] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[16:31:28] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/MT2OmQ
[16:31:28] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[16:31:28] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[16:31:29] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/u7CCEQ
[16:31:29] <ghrust> 13rust/06auto 1468b68c9 15Alex Crichton: Implement more native file I/O...
[16:31:29] <ghrust> 13rust/06auto 1440d56c6 15bors: auto merge of #10495 : alexcrichton/rust/more-native-io, r=brson...
[16:31:29] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[16:39:03] *** zz_kimundi is now known as kimundi
[16:43:28] *** Joins: w3lcome (Mibbit@moz-177EEEFC.home.otenet.gr)
[16:46:25] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[16:46:25] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1440d56c6 to 14d57765d: 02http://git.io/N3iJvQ
[16:46:25] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[16:46:35] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[16:46:35] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/8E1VtQ
[16:46:35] <ghrust> 13rust/06auto 148078729 15Alex Crichton: Implement more native file I/O...
[16:46:35] <ghrust> 13rust/06auto 14905acce 15bors: auto merge of #10495 : alexcrichton/rust/more-native-io, r=brson...
[16:46:35] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[17:18:07] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[17:26:23] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[17:26:24] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14905acce to 14d57765d: 02http://git.io/N3iJvQ
[17:26:24] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[17:26:24] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[17:26:24] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/BMjUIQ
[17:26:24] <ghrust> 13rust/06auto 14087b96c 15Alex Crichton: Implement more native file I/O...
[17:26:24] <ghrust> 13rust/06auto 144d89b7e 15bors: auto merge of #10495 : alexcrichton/rust/more-native-io, r=brson...
[17:26:25] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[17:29:01] *** Quits: Kxepal (Miranda@moz-E7192F22.pppoe.mtu-net.ru) (Ping timeout)
[17:33:59] *** Quits: pauls (pauls@moz-7140CF01.ccs.neu.edu) (Ping timeout)
[17:34:53] *** Joins: pauls (pauls@moz-7140CF01.ccs.neu.edu)
[17:36:39] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[17:36:39] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Ro8mSw
[17:36:39] <ghrust> 13rust/06auto 1400520cd 15Alex Crichton: Implement more native file I/O...
[17:36:39] <ghrust> 13rust/06auto 1403c0fd0 15bors: auto merge of #10495 : alexcrichton/rust/more-native-io, r=brson...
[17:36:39] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[17:36:43] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[17:36:43] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 144d89b7e to 14d57765d: 02http://git.io/N3iJvQ
[17:36:43] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[17:40:07] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[17:40:07] *** ChanServ sets mode: +o tjc
[17:40:36] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[17:45:47] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[17:45:47] <ghrust> 01[13rust01] 15alexcrichton 04force-pushed 06try from 146fa6dc2 to 1461436b1: 02http://git.io/k471pw
[17:45:47] <ghrust> 13rust/06try 1461436b1 15Alex Crichton: Implement more native file I/O...
[17:45:47] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[17:46:13] *** Quits: dbussink (dbussink@moz-E0A5568C.bussink.me) (Quit: bye)
[17:46:34] *** Joins: dbussink (dbussink@moz-E0A5568C.bussink.me)
[17:50:43] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[17:53:03] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[17:53:03] *** ChanServ sets mode: +qo brson brson
[17:59:18] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[17:59:20] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[17:59:20] *** ChanServ sets mode: +qo brson brson
[17:59:57] *** Quits: w3lcome (Mibbit@moz-177EEEFC.home.otenet.gr) (Quit: http://www.mibbit.com ajax IRC Client)
[18:00:11] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[18:00:11] <ghrust> 01[13rust01] 15alexcrichton 04force-pushed 06try from 1461436b1 to 1468d5510: 02http://git.io/k471pw
[18:00:11] <ghrust> 13rust/06try 1468d5510 15Alex Crichton: Implement more native file I/O...
[18:00:11] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[18:02:57] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[18:02:57] *** ChanServ sets mode: +ao pcwalton pcwalton
[18:06:06] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[18:26:21] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Ping timeout)
[18:28:36] *** Joins: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[18:28:36] *** ChanServ sets mode: +ao pcwalton pcwalton
[18:42:28] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Quit: Leaving...)
[18:56:42] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[18:56:43] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1403c0fd0 to 14d57765d: 02http://git.io/N3iJvQ
[18:56:43] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[18:56:48] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[18:56:48] <ghrust> 01[13rust01] 15bors pushed 1 new commit to 06auto: 02http://git.io/q_Zv1Q
[18:56:48] <ghrust> 13rust/06auto 14eef913b 15bors: auto merge of #10495 : alexcrichton/rust/more-native-io, r=brson...
[18:56:48] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[19:03:26] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[19:04:02] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[19:04:02] *** ChanServ sets mode: +o pnkfelix
[19:04:45] <pnkfelix> nmatsakis: i have to go to dinner, but if you have time later, we might want to talk more about GC stuff.  I had a few more thoughts on what info a client might want/need to register about the pages they allocate.
[19:05:07] <pnkfelix> nmatsakis: (but of course, what I really should be doing is dumping all of this info into notes for 1 or more blog posts)
[19:05:48] <nmatsakis> pnkfelix: ok, I prob have some time later, ping me
[19:07:02] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[19:07:31] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[19:07:31] *** ChanServ sets mode: +o pnkfelix
[19:17:46] *** Quits: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[19:18:15] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[19:18:16] *** ChanServ sets mode: +ao pcwalton pcwalton
[19:38:49] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[19:41:03] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[19:43:34] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[19:43:34] *** ChanServ sets mode: +ao pcwalton pcwalton
[19:43:59] *** Quits: jdm (jdm@moz-ED0C7AC7.hinet-ip.hinet.net) (Ping timeout)
[19:47:08] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[19:47:10] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[19:53:17] *** Quits: eddyb (eddy@336E3A7F.D51DAF03.FB866788.IP) (Ping timeout)
[19:56:33] *** Joins: eddyb (eddy@336E3A7F.D51DAF03.FB866788.IP)
[20:03:20] *** Quits: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net) (Ping timeout)
[20:03:46] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[20:03:46] *** ChanServ sets mode: +o tjc
[20:06:24] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[20:06:24] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/H3-gUw
[20:06:24] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[20:41:28] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[20:41:28] *** ChanServ sets mode: +o pnkfelix
[20:51:55] <ktt3ja> acrichto: when I added an `if exported_items.contains(&method.id)` check to this line: https://github.com/mozilla/rust/blob/master/src/librustc/middle/reachable.rs#L332
[20:52:14] <ktt3ja> the tests for issue 9906 and 9968 start to break
[20:52:51] <ktt3ja> does that mean that `exported_items` does not contain some items it should have?
[20:54:20] <ktt3ja> because I feel that if I just check for pub visibility, https://github.com/mozilla/rust/issues/9906 then FooBar::new here would still be visible
[21:04:52] <ktt3ja> reachable*
[21:07:20] *** Joins: tikue__ (tkuehn@1A16C144.CD72397.689607DE.IP)
[21:09:33] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[21:09:34] *** ChanServ sets mode: +qo brson brson
[21:12:24] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[21:12:24] <ghrust> 01[13rust01] 15alexcrichton pushed 4 new commits to 06try: 02http://git.io/2s0aNw
[21:12:24] <ghrust> 13rust/06try 141f6aacf 15Alex Crichton: Add generation of static libraries to rustc...
[21:12:24] <ghrust> 13rust/06try 14c37aa9b 15Alex Crichton: Statically link librustrt to libstd...
[21:12:24] <ghrust> 13rust/06try 144e83093 15Alex Crichton: Add a new run-make test directory...
[21:12:26] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[21:12:42] *** Quits: dbussink (dbussink@moz-E0A5568C.bussink.me) (Ping timeout)
[21:13:23] <acrichto> ktt3ja: that may be a bug in privacy
[21:13:36] <acrichto> ktt3ja: if a method is reachable from another crate, it should be contained in the exported_items set
[21:13:50] *** Joins: dbussink (dbussink@moz-E0A5568C.bussink.me)
[21:15:55] *** Quits: eddyb (eddy@336E3A7F.D51DAF03.FB866788.IP) (Ping timeout)
[21:16:24] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[21:16:24] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/dOFYOg
[21:16:24] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[21:16:24] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[21:16:25] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/W9bJVg
[21:16:25] <ghrust> 13rust/06auto 141946265 15Patrick Walton: libstd: Change all uses of `&fn(A)->B` over to `|A|->B` in libstd
[21:16:25] <ghrust> 13rust/06auto 1418a30af 15Patrick Walton: libextra: Convert uses of `&fn(A)->B` to `|A|->B`.
[21:16:25] <ghrust> 13rust/06auto 14492677e 15Patrick Walton: libsyntax: Change all uses of `&fn` to `||`.
[21:16:27] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[21:23:28] <ktt3ja> acrichto: what would be the best place to look in privacy.rs to fix that?
[21:23:53] <ktt3ja> because I really need that if statement there for dead-code warning
[21:25:00] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[21:25:19] <acrichto> ktt3ja: hm, this is not a trivial fix to privacy
[21:25:48] <ktt3ja> :(
[21:26:22] <acrichto> hm, let me fix this
[21:29:23] *** Joins: brson (brson@6A848D32.C1B840DD.76F66111.IP)
[21:29:23] *** ChanServ sets mode: +qo brson brson
[21:29:49] *** Quits: aatch (James@moz-B437F499.pocketrent.com) (Ping timeout)
[21:31:20] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[21:31:20] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14501a8dc to 14eef913b: 02http://git.io/N3iJvQ
[21:31:20] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[21:31:30] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[21:31:30] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/6gb1eQ
[21:31:30] <ghrust> 13rust/06auto 141946265 15Patrick Walton: libstd: Change all uses of `&fn(A)->B` over to `|A|->B` in libstd
[21:31:30] <ghrust> 13rust/06auto 1418a30af 15Patrick Walton: libextra: Convert uses of `&fn(A)->B` to `|A|->B`.
[21:31:30] <ghrust> 13rust/06auto 14492677e 15Patrick Walton: libsyntax: Change all uses of `&fn` to `||`.
[21:31:32] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[21:36:14] *** Quits: dbussink (dbussink@moz-E0A5568C.bussink.me) (Quit: bye)
[21:37:29] *** Joins: dbussink (dbussink@moz-E0A5568C.bussink.me)
[21:44:17] *** Joins: aatch (James@moz-B437F499.pocketrent.com)
[21:46:15] *** Quits: aatch (James@moz-B437F499.pocketrent.com) (Ping timeout)
[21:52:29] *** Joins: geoffhill (geoffhill@moz-738DC0DB.org)
[21:52:54] <acrichto> ktt3ja: hm I'm confused, something else is going wrong
[21:53:03] <acrichto> ktt3ja: methods appear to all be properly placed in the exported_items set
[21:53:22] <acrichto> ktt3ja: although possibly a little more zealously than they need to be
[21:55:23] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[21:55:57] *** Quits: brson (brson@6A848D32.C1B840DD.76F66111.IP) (Ping timeout)
[21:57:38] <ktt3ja> acrichto: I'll switch my local branch and only modify that part of reachable to see if it still gives the same error
[21:58:00] <acrichto> ktt3ja: it may also help if I take a look at the patch
[21:59:10] <ktt3ja> okay
[21:59:58] <ktt3ja> let me clean it up and then I'll push it
[22:00:43] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[22:06:14] *** Joins: aatch (James@moz-B437F499.pocketrent.com)
[22:12:44] *** Quits: tikue__ (tkuehn@1A16C144.CD72397.689607DE.IP) (Quit: tikue__)
[22:17:51] *** Joins: tikue__ (tkuehn@1A16C144.CD72397.689607DE.IP)
[22:18:56] <tikue__> pcwalton: what was the result of the task joining discussion in the weekly meeting? the notes seemed inconclusive
[22:21:20] <ktt3ja> acrichto: https://github.com/mozilla/rust/pull/10477/commits I think only the first commit should affect it
[22:22:13] <acrichto> ktt3ja: looking
[22:23:54] <acrichto> ktt3ja: and which tests are failing?
[22:24:29] <tikue__> acrichto: i'm guessing you didn't win regarding &*?
[22:24:49] <acrichto> tikue__: how so?
[22:25:05] <tikue__> acrichto: the meeting notes look like no one else favored magic
[22:25:16] <dbaupp> acrichto: run-pass/issue-9906 and -9968
[22:25:27] <acrichto> ah yeah I suppose so, I like the magic, but I prefer readability
[22:25:37] <dbaupp> acrichto: both use pub use cross-crate, and the tests are failing with linking errors
[22:25:58] <acrichto> ah, static methods
[22:26:06] * dbaupp disguises himself as ktt3ja for a bit.
[22:26:13] <tikue__> sugar for &* would be nice. It's not fun having to see that 
[22:27:00] <dbaupp> tikue__: `&sweet foo`? :P
[22:27:10] <tikue__> lol
[22:28:12] <acrichto> ktt3ja: dbaupp: this is an existing bug in the compiler right now
[22:28:24] <acrichto> I think reachability may be doing too much
[22:28:31] <acrichto> it needs to be offloading some of its work to privacy
[22:29:56] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[22:29:56] <ghrust> 01[13rust01] 15alexcrichton pushed 1 new commit to 06try: 02http://git.io/ZgdBCg
[22:29:56] <ghrust> 13rust/06try 14da92af6 15Alex Crichton: test fixes
[22:29:56] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[22:36:37] <tikue__> how does Vector::init([1, 2, 3]) work? wouldn't that require integer parameterization?
[22:36:49] <tikue__> oh it'd just store an unsafe pointer 
[22:36:55] <dbaupp> tikue__: slices, apparently
[22:37:30] <dbaupp> tikue__: i..e it'd move the data from it's argument into what-is-now-called-~[]
[22:37:50] <dbaupp> acrichto: so the fix is? (are you working on it?)
[22:38:24] <tikue__> dbaupp: which is essentially just an unsafe pointer 
[22:38:38] <tikue__> i would assume
[22:39:02] <acrichto> dbaupp: yeah, working on it now
[22:39:20] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[22:39:38] <dbaupp> ktt3ja: ^
[22:41:38] <pcwalton> tikue__: the outcome was basically that we have task joining already and strcat should follow our API
[22:42:03] <pcwalton> although maybe we should change our API
[22:42:15] <pcwalton> in that case we should consider it as a holistic part of the feature
[22:42:42] <tikue__> pcwalton: what did brson's comment "would like a better task api anyway" mean?
[22:42:59] <pcwalton> that our task API is bad and maybe we should look at what strcat has done in rust core anyhow
[22:43:43] *** Joins: Jesse_ (jruderman@moz-7B0110AD.mv.mozilla.com)
[22:43:46] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[22:43:46] <ghrust> 01[13rust01] 15alexcrichton merged 06master into 06snap-stage3: 02http://git.io/FeFKgg
[22:43:46] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[22:46:03] *** Joins: jdm (jdm@moz-ED0C7AC7.hinet-ip.hinet.net)
[22:46:12] *** Quits: Jesse_ (jruderman@moz-7B0110AD.mv.mozilla.com) (Quit: Linkinus - http://linkinus.com)
[22:46:43] <tikue__> ok
[22:47:01] <Luqman> acrichto: where in the makefiles do we trigger building libuv?
[22:48:25] <acrichto> Luqman: mk/rt.mk under the third party rules
[22:48:54] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[22:48:54] <ghrust> 01[13rust01] 15alexcrichton 04force-pushed 06try from 14da92af6 to 146002acb: 02http://git.io/k471pw
[22:48:54] <ghrust> 13rust/06try 146002acb 15Alex Crichton: test fixes
[22:48:54] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[22:50:08] *** Joins: dbussink_ (dbussink@moz-E0A5568C.bussink.me)
[22:50:46] *** Quits: dbussink (dbussink@moz-E0A5568C.bussink.me) (Ping timeout)
[22:50:46] *** dbussink_ is now known as dbussink
[22:52:29] *** Quits: dbussink (dbussink@moz-E0A5568C.bussink.me) (Quit: bye)
[22:52:51] *** Joins: dbussink (dbussink@moz-E0A5568C.bussink.me)
[22:53:44] *** Joins: brson (brson@6A848D32.C1B840DD.76F66111.IP)
[22:53:44] *** ChanServ sets mode: +qo brson brson
[22:55:06] *** Quits: dbussink (dbussink@moz-E0A5568C.bussink.me) (Quit: bye)
[22:57:21] *** Joins: dbussink (dbussink@moz-E0A5568C.bussink.me)
[23:00:29] *** flaper87 is now known as flaper87|afk
[23:00:45] <Luqman> acrichto: is there a reason it's $$(CC) instead of $$(CC_$(1)) on line 221 in mk/rt.mk ?
[23:02:36] <Luqman> i guess it really only matters if you're cross compiling for windows but might as well do it right
[23:02:45] <Luqman> since AR seems to be right
[23:06:31] <acrichto> Luqman: whoops, my bad
[23:13:34] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Ping timeout)
[23:17:28] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[23:21:20] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[23:21:20] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/6gb1eQ
[23:21:20] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[23:28:42] *** Quits: tikue__ (tkuehn@1A16C144.CD72397.689607DE.IP) (Quit: tikue__)
[23:31:37] <Luqman> acrichto: also, LIBUV_FLAG_ stuff that uses $(1) doesn't make sense since $(1) means nothing in that context
[23:32:04] <Luqman> but all that means right now is the ios stuff isn't actually used
[23:32:18] <acrichto> Luqman: look at the top of the file
[23:33:30] <Luqman> acrichto: but we might have more than 1 target hence why everything else is in a define block use a foreach over all the targets
[23:33:53] <acrichto> Luqman: those are arch-specific flags, and it's special-cased for each target on the target's arch
[23:34:18] <Luqman> so which target would $(1) refer to outside the defines?
[23:34:30] <acrichto> it's $$(HOST_$(1))
[23:34:31] <acrichto> not $(1)
[23:34:58] <Luqman> but according to that comment $(1) would be the target triple
[23:35:03] <Luqman> but what target triple?
[23:35:45] <acrichto> third party libraries are only built for each target
[23:36:43] <Luqman> yes, hence why the majority of the rules there are in a define FOO ... endef block and have $(foreach t,$(CFG_TARGET),$(eval $(call FOO,$(t))))
[23:37:02] <Luqman> but i'm talking about the stuff at the top with LIBUV_FLAGS_*
[23:37:22] <Luqman> i don't think $(1) means the target in that context
[23:37:52] <acrichto> oh I see, I think that may have been a copy gone wrong
[23:38:08] <acrichto> that should probably CFG_HOST
[23:38:13] <acrichto> or at least I tink that's the name
[23:38:56] <Luqman> no, that'd be wrong i think
[23:39:29] <Luqman> i think it just needs to make LIBUV_FLAGS per-target
[23:43:35] <acrichto> Luqman: the only special casing is for ios
[23:43:42] <acrichto> you can't build ios on anything other than a darwin host
[23:44:54] <Luqman> but you're not checking for host=arm
[23:45:04] <Luqman> you want host=darwin && target=arm
