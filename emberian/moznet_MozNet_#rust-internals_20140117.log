[00:01:52] <acrichto> brson: confirmed, we're spending *a lot* of time in all these cmpxchgs all over the place
[00:05:53] <strcat> tbb is so impossibly hard to understand
[00:07:04] <strcat> http://ix.io/9UM who knew setting a task name could be so unreadable
[00:07:42] <strcat> s/task/thread/
[00:08:18] *** Quits: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net) (Quit: dherman)
[00:22:58] <brson> erickt: are you thinking of rewriting rust's build system?
[00:26:22] *** Quits: c-a (c-a@moz-57C82A9.a163.priv.bahnhof.se) (Quit: Ex-Chat)
[00:26:27] * acrichto crosses fingers
[00:31:59] <sfackler> :( failures: io::net::tcp::test::read_eof_twice_ip4::native
[00:32:08] <acrichto> ugh
[00:32:10] <acrichto> not that est again
[00:32:13] <acrichto> was it on bsd?
[00:32:18] <sfackler> yep
[00:32:24] <pnkfelix> strcat: ping
[00:32:33] <strcat> pnkfelix: pong
[00:32:54] <acrichto> sfackler: how in the world is that address in use?!
[00:33:01] <pnkfelix> strcat: The global_heap.rs code for exchange_malloc has a comment above it saying "The allocator for unique pointers without contained managed pointers"
[00:33:15] <brson> acrichto: parallel builds?
[00:33:23] <acrichto> brson: this is on the bsd bot though
[00:33:23] <sfackler> do the native and green tests run at the same time?
[00:33:26] <acrichto> there's only one build?
[00:33:33] <acrichto> they run in the same process
[00:33:40] <sfackler> do they use the same port?
[00:33:44] <strcat> pnkfelix: ah, didn't see that when I changed it
[00:33:49] <acrichto> nah they use xadd() to get a port
[00:33:50] <strcat> pnkfelix: no longer true ;]
[00:33:57] <pnkfelix> strcat: Where is the logic implementing that decision?
[00:34:00] <acrichto> unless we're asking for more than 1k ports
[00:34:02] <strcat> pnkfelix: it's gone now
[00:34:07] <acrichto> hmm...
[00:34:12] <brson> at one point there were hacks in the std test suite to change the port range based on the buildbot config
[00:34:14] <pnkfelix> strcat: Ah, that decision is no longer being made.  Explains why I couldn't find it.  THanks.
[00:34:22] <brson> so that parallel builds wouldn't try to use the same port
[00:34:30] <strcat> pnkfelix: if we need to branch on it we can make the lang item generic and set the right type
[00:34:30] <acrichto> brson: https://github.com/mozilla/rust/blob/master/src/libstd/io/test.rs#L88-L118
[00:34:33] <acrichto> still there
[00:34:35] <strcat> pnkfelix: and use contains_managed
[00:35:45] <acrichto> brson: what doesn't make sense to me is that there's only one bsd bot
[00:35:48] <pnkfelix> strcat: sure.  Maybe we will do that in the future.
[00:35:50] <acrichto> so there's no paralellism to worry about
[00:36:19] <pnkfelix> strcat: (I'm currently just trying to identify why Free() is being invoked with addresses that are slightly off)
[00:36:32] <acrichto> oh try builds
[00:36:51] <acrichto> no no try builds :(
[00:36:54] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[00:36:54] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14c08aa41 to 146141662: 02http://git.io/N3iJvQ
[00:36:54] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[00:36:55] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[00:36:56] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/7RVZGw
[00:36:56] <ghrust> 13rust/06auto 14328b47d 15Steven Fackler: Load macros from external modules
[00:36:56] <pnkfelix> strcat: (I thought maybe somewhere in the control flow for the exchange allocator either alloc or free is zigging when it should be zagging)
[00:36:56] <ghrust> 13rust/06auto 1480a3f45 15bors: auto merge of #11151 : sfackler/rust/ext-crate, r=alexcrichton...
[00:36:56] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[00:37:06] <strcat> pnkfelix: 0e885e42b1292fe2592488a52c35d54b9fe50fb8 is the commit that removed it btw
[00:37:12] <strcat> pnkfelix: so that shows you all of the relevant code paths
[00:37:30] <strcat> well and then I also removed borrow_offset
[00:38:31] <pnkfelix> in case anyone cases, examples of what I am talking about: https://gist.github.com/pnkfelix/8466306
[00:39:10] <strcat> pnkfelix: hm, is your repo up-to-date?
[00:39:35] <pnkfelix> strcat: lets see, the last master for me on this is...
[00:40:13] *** Joins: blank_na1e (blank_name@E7821509.94CCB18F.53C6B850.IP)
[00:40:13] <pnkfelix> strcat: 983f307e123f1da3d351ed2032163bf93ea8f638
[00:40:20] <erickt> brson: before I leave, I was thinking about it. I've wrote this a couple years ago: https://github.com/felix-lang/fbuild
[00:40:21] <pnkfelix> strcat: about 10 days old.  So no, not up to date.
[00:40:33] <erickt> brson: but now I must run
[00:40:37] <strcat> pnkfelix: ah, I would try updating then to after my removal of the managed-unique logic
[00:40:40] <pnkfelix> strcat: You think I should rebase up to master?
[00:40:43] <strcat> pnkfelix: yeah
[00:40:53] *** Quits: blank_name (blank_name@A6C6321C.964BADD.93A5C78C.IP) (Ping timeout)
[00:40:57] <strcat> pnkfelix: you're still at the point where it uses local_malloc/local_free for ~ with @ inside
[00:41:00] <pnkfelix> strcat: and that's the commit you linked above ?
[00:41:01] <strcat> and they add headers
[00:41:07] <strcat> pnkfelix: yeah
[00:41:11] <strcat> pnkfelix: it's snapshotted in now
[00:42:04] <pnkfelix> strcat: I would have thought it would be safe to use the older base, as long as it was *consistent* in its use of either local_{alloc,free} or exchange_{alloc,free}
[00:42:10] <pnkfelix> strcat: But I will investigate your suggestion.
[00:42:32] <strcat> pnkfelix: well it's consistent but I'm not really sure what it is you're doing :)
[00:42:45] <strcat> pnkfelix: it does mean not all ~ ptrs point to an object
[00:42:51] <strcat> ones with @ inside point to a header 
[00:43:13] <pnkfelix> strcat: yeah but that's okay, as long as the ptr to the header is what gets passed to the free in the end
[00:43:21] <strcat> yeah it is
[00:43:27] * strcat shrugs
[00:43:35] <strcat> pnkfelix: totally possible something about it was broken
[00:43:40] <pnkfelix> (but then again, a failure to actually do that might be consistent with what I am seeing)
[00:43:49] <strcat> there were still some broken methods like shrink_to_fit on vectors
[00:44:30] <pnkfelix> strcat: Okay.  Thanks for the idea.
[00:44:54] <strcat> hm
[00:45:12] <strcat> pnkfelix: we used to allocate/free stuff in the C++ rt/ dir but that's gone
[00:45:14] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[00:45:22] <strcat> afaik there's none of that now
[00:45:29] <pnkfelix> strcat: actually, looking at this old copy of trans/base.rs
[00:45:47] <pnkfelix> strcat: it seems like the thing you removed might be the problem for me
[00:46:29] <strcat> pnkfelix: it would just allocate ~ with @ inside as @ (same allocator) with a ref_count of -2
[00:46:36] <strcat> and it wrote that ref count by hand
[00:47:20] <pnkfelix> strcat: I'm trying to figure out where the code will call the exchange_free lang item
[00:47:34] <strcat> pnkfelix: free/drop glue
[00:47:37] <strcat> glue.rs
[00:47:45] <strcat> used to be a uniq.rs, it's gone now
[00:48:00] <strcat> pnkfelix: oh and procs use a whole separate allocator...
[00:48:31] <pnkfelix> strcat: okay, I see it now, make_free_glue in uniq.rs, okay
[00:49:10] <brson> erickt: are you drawing a distinction between a build system for rust users and a build system for rust itself? the latter seems much harder
[00:49:32] <brson> but either are worthwhile efforts :)
[00:49:52] <ChrisMorgan> I'd expect the latter to be a superset of the former.
[00:50:31] <brson> yes
[00:50:45] <cmr> I wouldn't expect that.
[00:50:52] <brson> well, potentially. they could meet in the middle someday
[00:50:53] <cmr> I think we should be using a custom tailored build system.
[00:50:58] <cmr> esp for staging.
[00:51:01] <cmr> but maybe not.
[00:51:17] <brson> cmr: certainly rust's own build requires a vast amount of complexity and customization beyond any stock build system
[00:51:32] <brson> but it could be built around a rust-based build system
[00:51:34] <brson> with lots of extensions
[00:51:42] <cmr> probably yeah.
[00:51:46] <brson> being able to manage rust's build system is awesome dogfooding
[00:51:50] * ChrisMorgan agrees
[00:52:23] <brson> we could potentially start by writing various parts of the current build system as rust crates
[00:52:33] <brson> i've always wanted to just completely write all of tests.mk in rust
[00:52:58] <brson> then wait for erickt's fbuild-alike to mature
[00:53:08] <brson> rust-fbuild needs to integrate with rustpkg too
[00:53:40] <cmr> that could be super trivial
[00:53:49] <cmr> just have rust-fbuild ship a pkg.rs
[00:53:52] <cmr> that does all the things
[00:53:58] <cmr> then you include that and done
[01:00:44] <cmr> So one of my coworkers, jxs, has decided to try their hand at creating a Sphinx domain for Rust \o/
[01:02:17] <cmr> ChrisMorgan: ^
[01:02:31] <ChrisMorgan> Public?
[01:07:31] * ChrisMorgan started writing one a while ago but didn't get far due to other things he had to do, and also decided it needed more thought on how precisely it should be managed (especially what should be modelled)
[01:13:00] <ChrisMorgan> cmr: ^
[01:14:16] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[01:14:44] *** Quits: dbaupp (Thunderbir@moz-F3F7375F.lns20.syd6.internode.on.net) (Ping timeout)
[01:17:50] *** Quits: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[01:21:20] <strcat> nmatsakis: is the path forwards for ~[T] decided?
[01:21:27] <strcat> as in will it switch to being just ptr/len
[01:30:56] <steveklabnik> i'm gonna be cozy-ing up to sphinx soon
[01:31:00] <steveklabnik> for an unrelated thing
[01:31:13] <steveklabnik> but i will have a more informed opinion soon
[01:33:47] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: Lost terminal)
[01:34:01] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[01:34:01] *** ChanServ sets mode: +qo brson brson
[01:36:42] <ChrisMorgan> steveklabnik: for a software thing involving API documentation?
[01:37:09] <steveklabnik> nope, for original philosophical research with someone
[01:37:10] <steveklabnik> long story
[01:37:12] <steveklabnik> heheh
[01:37:40] <ChrisMorgan> OK, so no usage of Sphinx domains.
[01:38:38] <cmr> ChrisMorgan: I don't know the answers to that, you should ask jxs yourself :p
[01:38:54] <jxs> Hi ChrisMorgan and steveklabnik, so yeah Corey talked to me about the domains, and  i would like to help you guys 
[01:39:07] <jxs> but yeah, i am still reading the domain API
[01:39:16] <jxs> i only used sphinx for doc generation 
[01:39:26] <steveklabnik> i only recently started at a python shop, so my sphix experience is basically nil
[01:39:45] <cmr> steveklabnik: where are you working now?
[01:43:28] *** Joins: new_one (new_one@F8CB5EE5.6D46D672.B3C0173E.IP)
[01:44:13] *** Joins: tjc (tjc@1DD94176.FD5C31A1.284344F5.IP)
[01:44:14] *** ChanServ sets mode: +o tjc
[01:45:12] <new_one> hi, I was wondering how a named tuple enum variant's creation is represented in the AST (i.e. what kind of item/expression is it)
[01:45:35] <new_one> I probably misworded that so here's an example: http://git.io/Wxw_mg
[01:47:53] <steveklabnik> cmr: https://www.balancedpayments.com/
[01:48:35] *** Quits: tjc (tjc@1DD94176.FD5C31A1.284344F5.IP) (Ping timeout)
[01:49:29] <brson> I urge you not to progress too far into a sphinx implementation for rust without gathering consensus for that direction, lest you find yourself disappointed
[01:49:50] <steveklabnik> pssssh
[01:49:51] <steveklabnik> :p
[01:50:30] <sfackler> new_one: I believe it's treated as a function call by the AST
[01:51:46] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[01:51:46] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/7RVZGw
[01:51:46] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[01:52:00] <strcat> brson: i think there will be people who have sphinx documentation and want to use rust in their existing projects, regardless
[01:52:05] <sfackler> Woo! \o/
[01:52:15] <strcat> brson: so it seems useful
[01:52:16] <new_one> sfackler: oh, that's a bit of a surprise. I'll look into it
[01:52:24] * strcat shrugs
[01:52:35] <kimundi> did loadable syntax extensions just land?
[01:52:41] <brson> strcat: yes, it is independently useful
[01:52:43] <jxs> brson, yeah i do not plan to do anything on my own ofc 
[01:52:57] <kimundi> if so, then \o/
[01:53:07] <sfackler> new_one: the parser doesn't really have any way of telling that it *isn't* a normal function call
[01:53:20] * ChrisMorgan agrees that a Rust domain for Sphinx is not the item of first importance for the documentation
[01:54:13] <sfackler> kimundi: they did!
[01:55:53] <pnkfelix> acrichto: Well, there's at least one place where we malloc from C and free from Rust: in librustuv/net.rs, where it calls free on the address returned from rust_malloc_ip{4,6}_addr.  But that's easily identified.
[01:56:16] <acrichto> pnkfelix: ah good point!
[01:56:23] <acrichto> I should remove all those functions
[01:56:29] <acrichto> we have the necessary defines in std::libc now
[01:56:48] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[01:56:48] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/WA86aA
[01:56:48] <ghrust> 13rust/06auto 143e51c8a 15Florian Hahn: Replace C types with Rust types in libstd, closes #7313
[01:56:48] <ghrust> 13rust/06auto 14a1e8599 15bors: auto merge of #10943 : fhahn/rust/issue-7313-replace-c-types, r=brson...
[01:56:48] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[01:56:50] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[01:56:50] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/zRtyPg
[01:56:50] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[01:58:28] <acrichto> sfackler: nice!
[01:59:09] <sfackler> after a snapshot, we should be able to move std-macros into libstd
[01:59:39] <brson> sfackler: how did you solve the phasing issues?
[01:59:41] <acrichto> coming right up!
[01:59:44] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[01:59:44] <ghrust> 01[13rust01] 15alexcrichton merged 06master into 06snap-stage3: 02http://git.io/BUrjNA
[01:59:44] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[02:00:30] <brson> i guess std macros don't have phasing issues unless the macro AST changes?
[02:00:33] <brson> what happens then?
[02:00:53] <sfackler> sadness probably
[02:00:56] <brson> or do they not have phasing issues at all?
[02:00:58] <sfackler> it may require some restructuring
[02:01:15] <acrichto> I really do think the correct solution is to distribute a dynamic snapshot and all phase things link to rustc's dynamic libs
[02:01:18] <sfackler> I think it'll be doable
[02:01:20] <acrichto> that way bootstrapping can work at all
[02:01:25] <sfackler> especially with a dynamically linked snapshot
[02:01:54] <brson> i'm not sure std macros have a phasing problem actually
[02:02:07] <acrichto> libstd needs std macros
[02:02:15] <brson> but they are defined in std 
[02:02:19] <acrichto> exactly
[02:02:26] <sfackler> that'll be fine, since you can just #[macro_escape] them
[02:02:28] <acrichto> pcwalton and I were talking about this
[02:02:28] <brson> so std just uses the std macros it defines
[02:02:42] <acrichto> we think you shoujld compile the crate twice
[02:02:51] <acrichto> once for the macros, you then dlopen it, then once for the whole libstd
[02:02:55] <acrichto> and you distribute both
[02:03:16] <brson> for syntax extensions sure
[02:03:19] <brson> not macro_rules
[02:03:28] <brson> what are non-macro_rules macros called again?
[02:03:48] <acrichto> macro_rules yeah can just be serialized to crate metadata
[02:03:56] * acrichto wants to move format! into libstd
[02:04:08] <kimundi> brson: Well, the preffered terminology would be "procedural macro" vs the macro_rules "declarative macro"s
[02:04:18] <sfackler> pcwalton had an idea to make macro_rules generate code for normal procedural macros, but I don't know if that's really a good idea
[02:04:20] <brson> kimundi: thanks, that's what i was looking for
[02:04:30] <sfackler> since ast-only macros avoid having to dlopen
[02:04:35] <acrichto> sfackler: I think that compile times will favor serializing macros
[02:04:39] <sfackler> yeah
[02:04:46] <acrichto> also our brains
[02:04:49] <ChrisMorgan> I presume format! doesn't work with #[no_std]?
[02:04:51] <sfackler> haha
[02:05:04] <acrichto> ChrisMorgan: it'd work if you set up all the paths right
[02:05:11] <acrichto> it's all based on just using particular paths
[02:05:16] <sfackler> ChrisMorgan: it may be defined, but you'd have to replicate all of the fmt stuff
[02:05:35] <ChrisMorgan> That's what I thought.
[02:06:00] <brson> acrichto: seems like we'll want the std macros to use their own copies of 'mod std' to be more hygenic once they're in std?
[02:06:14] <brson> e.g. instead of relying on std being at crate level
[02:06:32] <acrichto> their own copy of mod std?
[02:06:34] <brson> not sure if that's possible
[02:06:57] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[02:06:57] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14a1e8599 to 1480a3f45: 02http://git.io/N3iJvQ
[02:06:57] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[02:06:59] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[02:06:59] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/gYvTtg
[02:06:59] <ghrust> 13rust/06auto 144737267 15klutzy: rustc::driver: Capitalize structs and enums...
[02:06:59] <ghrust> 13rust/06auto 14ad4c52b 15klutzy: rustc::metadata: Remove trait FileSearch
[02:06:59] <ghrust> 13rust/06auto 141a512ae 15klutzy: syntax::ast: Remove/Recover tests...
[02:07:00] <brson> yes. have them emit `mod std = ...` then reference *that* std
[02:07:01] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[02:07:15] <acrichto> makes sense
[02:07:28] <acrichto> fn main() { for _ in range(0, 10000000) { task::deschedule(); } }
[02:07:33] <acrichto> that program aborts sometimes :(
[02:07:37] <acrichto> rusti: fn main() { for _ in range(0, 10000000) { task::deschedule(); } }
[02:07:37] <brson> why?
[02:07:39] <acrichto> dunno
[02:07:39] -rusti- pastebinned 13 lines of output: http://ix.io/9V3
[02:07:44] <acrichto> been tracking it down for 3 hours
[02:07:49] <acrichto> rusti: use std::task; fn main() { for _ in range(0, 10000000) { task::deschedule(); } }
[02:07:50] -rusti- <anon>:10:24: 10:89 warning: code is never used: `main`, #[warn(dead_code)] on by default
[02:07:50] -rusti- <anon>:10         use std::task; fn main() { for _ in range(0, 10000000) { task::deschedule(); } }
[02:07:51] -rusti-                                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[02:07:51] -rusti- ()
[02:07:55] <acrichto> rusti: use std::task; fn main() { for _ in range(0, 10000000) { task::deschedule(); } } main()
[02:08:01] -rusti- timeout triggered!
[02:08:04] <acrichto> oh well
[02:08:51] <acrichto> brson: the async callback fired, and the first thing it does is Local::take()
[02:09:00] <acrichto> brson: but the tls pointer is null
[02:09:15] <acrichto> and it looks like some schedulers have shut down
[02:09:38] <brson> that sounds pretty busted!
[02:09:45] <acrichto> I found this when testing mutexes
[02:09:50] <acrichto> stared at mutexes for an hour
[02:09:52] <acrichto> no luck :(
[02:09:58] <acrichto> oh and this only shows up with -Zlto
[02:12:45] <brson> anybody know of good comparisons between markdown and reST?
[02:13:20] <brson> maybe this one http://www.unexpected-vortices.com/doc-notes/markdown-and-rest-compared.html
[02:14:19] <ChrisMorgan> brson: what, my anti-markdown rant isn't good? :P
[02:14:34] *** Joins: dbaupp (Thunderbir@C5782B92.D5A1DCF.37681C44.IP)
[02:15:00] <ChrisMorgan> Are you looking for syntactic, semantic, ideological, or some other form of comparisons?
[02:18:42] <brson> anything convincing about the markup language itself. i imagine sphinx is a better toolchain for writing docs, but i think mardown's problems there can be overcome with code
[02:19:30] <brson> interested in semantic differences relevant to code documentation
[02:20:02] <brson> i'll watch your presentation again
[02:20:58] <ChrisMorgan> That comparison is fairly broad and is missing various things. For example, Markdown supports _italic_ and __bold__ as well as *italic* and **bold**, which is oft troublesome, dangerously so: don't try having leading underscores on normal text or it'll be glad to mess it up. (I'll presume that Pandoc Markdown doesn't turn foo_bar_baz into "foo" Italic("bar") "baz", though Gruber's Markdown does.)
[02:20:58] *** Joins: a_m0d (a_m0d@moz-322A4DE4.acanac.net)
[02:21:11] *** kimundi is now known as zz_kimundi
[02:21:52] <ChrisMorgan> He only shows the ":: as a separate paragraph" code, and not the more common "paragraph ends with a colon already, just double the colon" technique.
[02:22:46] <ChrisMorgan> On links, I think the reStructuredText syntax mostly better; far too often, especially with newcomers, do I see people making a mess of Markdown's [link](href)â€”and as for images, everyone always has to look it up.
[02:23:41] <acrichto> ChrisMorgan: sundown has an option to disable the intra-emphasis (foo_bar_baz) problem and we have it turned on for rustdoc generation
[02:23:42] <ChrisMorgan> On lists, I haven't got a clue what that comparison is talking about.
[02:23:44] <acrichto> (just fyi)
[02:23:50] <steveklabnik> ehhhhh i find markdown WAAAAY nicer for links
[02:24:00] <ChrisMorgan> acrichto: good!
[02:24:52] <ChrisMorgan> Blockquotes, "With reST, the blockquote content looks to me like it might be a code  block â€” I have to check if thereâ€™s a preceeding double-colon to be  sure." Syntax highlighters will tend to highlight them differently (e.g. Vim does) so I don't find that a problem.
[02:25:53] <ChrisMorgan> Again on Misc, syntax highlighting for reStructuredText is handy to have and removes any transient ambiguities.
[02:26:57] <ChrisMorgan> brson: I think that comparison is missing the most important thing about reStructuredText: that it is designed for extensibility with its roles and directives.
[02:27:58] <ChrisMorgan> For something like language documentation, that's a very important thing and allows for *enormously* more semantic expression and conciseness-that-people-expect.
[02:28:08] * ChrisMorgan â†’ lunch, probably back in 20 minutes
[02:29:56] <brson> ChrisMorgan: i'd like to hear more about what 'extensibility with its roles and directives' means
[02:30:05] <brson> (it's probably in your talk. i'll watch)
[02:30:11] <brson> ... later
[02:31:54] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[02:31:54] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14c90b58b to 1480a3f45: 02http://git.io/N3iJvQ
[02:31:54] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[02:31:56] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[02:31:56] <ghrust> 01[13rust01] 15bors pushed 11 new commits to 06auto: 02http://git.io/xNSHiQ
[02:31:56] <ghrust> 13rust/06auto 14419ac4a 15Niko Matsakis: Issue #3511 - Rationalize temporary lifetimes....
[02:31:56] <ghrust> 13rust/06auto 14e71571a 15Niko Matsakis: Use as_slice() method on option
[02:31:57] <ghrust> 13rust/06auto 146badef4 15Niko Matsakis: Remove FIXMEs and add license
[02:31:58] <pnkfelix> ChrisMorgan: I think the point he was making about lists was that the content for lists item in reST are starting at column 2, while for markdown they start at column 4?
[02:31:59] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[02:32:54] <pnkfelix> ChrisMorgan: but it is odd, he didn't seem to demo any nesting of lists themselves.
[02:37:33] *** Quits: carter (carter@moz-3589B90B.c.ircrelay.com) (Quit: IRCRelay - http://ircrelay.com)
[02:40:26] <acrichto> brson: https://github.com/mozilla/rust/pull/11520#issuecomment-32575546
[02:45:35] <brson> acrichto: good measurements
[02:45:42] <brson> acrichto: how does your impl beat pthreads?
[02:50:20] <ChrisMorgan> pnkfelix: four spaces works fine for list items in reStructuredText just the same way as in Markdown.
[02:51:08] *** Joins: jdm (jdm@moz-12626D4B.static.videotron.ca)
[02:51:39] *** Joins: lpy (lpy@7360AA58.F09091A8.1348A864.IP)
[02:51:43] <pnkfelix> ChrisMorgan: yeah, maybe he meant to say "*will* always" rather than "can always"?  I dunno, its a bizarre section of the comparison.
[02:54:08] <cmr> brson: weren't you *there* for his talk?
[02:55:03] <ChrisMorgan> brson: I didn't talk much about the extensibility, just highlighted its existence. But it means that beyond the basic syntax extending the language is done consistently. For example, maths support is done with :math:`a + 2` (LaTeX syntax), an RFC link is :rfc:`1948`, a reference to a trait could be :trait:`TraitName`, &c. That's roles, syntax :role-name:`arbitrary contents`; like a macro expanding to an expression.
[02:56:01] <brson> cmr: no, i was sick, but i did watch it remotely at the time
[02:56:04] <cmr> ah
[02:56:05] <brson> i just have very poor recall
[02:56:35] <cmr> !!!!! synext landed.
[02:57:09] <ChrisMorgan> Directives are the other unit of extensibility, blocks, started with a line ".. directive-name:: arbitrary text", possibly with ":key: value" options on subsequent lines, then with optional arbitrary (indented) contents after a line break. Things like images are implemented that way, e.g. ".. image:: x.jpg" \n "  :width: 32".
[02:58:45] <ChrisMorgan> We can have things like ".. trait:: Foo" \n "  :deprecated: use :trait:`Bar` instead" \n "" \n "  Do something or other". (The value for the :deprecated: option would be entirely optional.)
[02:59:25] <cmr> And this can all be generated by rustdoc, yeah? Or, rather, even generated from rustdoc's json?
[02:59:34] <ChrisMorgan> That could be equivalent to the Rust code /** Do something or other */ #[deprecated(reason = "use :trait:`Bar` instead")] trait Foo {}
[03:00:42] <ChrisMorgan> I'm still not entirely certain down to the precise details of how we're best to meld the two together, but you'd be looking at having a `.. autotrait:: Foo` and it would find all the rest from the rustdoc JSON. Well, it might if only rustdoc *could* export JSON :-/
[03:02:02] <acrichto> brson: I don't think we're actually beating pthreads, the gap is so small I think it's just a measurement offset, but in theory it's b/c we're calling trylock, not mutex_lock
[03:05:06] <cmr> ChrisMorgan: eh? rustdoc can export json.
[03:06:23] <ChrisMorgan> cmr: https://github.com/mozilla/rust/issues/10115
[03:06:46] <cmr> Ah geh that bug again
[03:06:57] <ChrisMorgan> I know it's supposed to be able to export JSON, but I really have not been able to get it to work at all.
[03:08:44] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Client exited)
[03:09:06] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[03:10:48] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Ping timeout)
[03:11:40] <cmr> I'll fix that tomorrow
[03:11:44] <cmr> how annoying :(
[03:11:50] <cmr> ChrisMorgan: can you cc me on any other rustdoc bugs?
[03:12:19] * ChrisMorgan hasn't really been tracking them
[03:12:45] <cmr> well when you report them :p
[03:12:53] * ChrisMorgan wishes he could label issues
[03:13:15] *** Quits: zz_kimundi (kimundi@moz-A0A35D8B.dip0.t-ipconnect.de) (Ping timeout)
[03:13:45] *** Joins: doomlord_ (servitor@moz-CA917A47.range86-184.btcentralplus.com)
[03:16:03] <cmr> yeah
[03:16:08] <cmr> I wish github had more fine grained acls
[03:16:14] *** Quits: dbaupp (Thunderbir@C5782B92.D5A1DCF.37681C44.IP) (Quit: dbaupp)
[03:16:35] <cmr> letting people be able to tag/close/milestone issues without, you know, direct push access.
[03:16:35] <aatch> cmr, join the club
[03:16:37] *** Joins: dbaupp (Thunderbir@C5782B92.D5A1DCF.37681C44.IP)
[03:16:45] *** Joins: zz_kimundi (kimundi@moz-646723D.dip0.t-ipconnect.de)
[03:16:46] *** zz_kimundi is now known as kimundi
[03:16:47] * cmr has lots of problems with github
[03:17:39] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[03:19:40] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[03:21:46] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[03:21:46] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 147543928 to 1480a3f45: 02http://git.io/N3iJvQ
[03:21:46] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[03:29:43] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Input/output error)
[03:32:31] *** Quits: a_m0d (a_m0d@moz-322A4DE4.acanac.net) (Quit: Leaving.)
[03:34:05] *** Joins: a_m0d (a_m0d@moz-322A4DE4.acanac.net)
[03:34:24] *** Quits: a_m0d (a_m0d@moz-322A4DE4.acanac.net) (Quit: Leaving.)
[03:38:23] *** Joins: deen (deen@moz-B2003C49.dip0.t-ipconnect.de)
[03:40:08] *** Quits: aatch (James@moz-B437F499.pocketrent.com) (Client exited)
[03:59:45] *** Quits: ktt3ja (ktt3ja@moz-515C1363.hsd1.va.comcast.net) (Quit: Leaving)
[04:00:31] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[04:10:56] *** Joins: gwty (gwtypc@A3F4FE97.CFB6D583.BD94A9D5.IP)
[04:37:04] <acrichto> rusti: 7.281738281250e+01
[04:37:05] -rusti- 72.81738281f64
[04:37:39] *** nrc is now known as nrc|afk
[04:46:57] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[04:47:31] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Ping timeout)
[04:51:26] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[04:51:50] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[04:51:50] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Qoseww
[04:51:50] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[04:54:50] *** Quits: dbaupp (Thunderbir@C5782B92.D5A1DCF.37681C44.IP) (Ping timeout)
[04:55:50] *** Quits: sfackler (sfackler@moz-AEECCEBA.com) (Ping timeout)
[04:56:18] *** Joins: sfackler (sfackler@moz-AEECCEBA.com)
[04:56:47] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[04:56:47] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/BA9s3A
[04:56:47] <ghrust> 13rust/06auto 14f30a9b3 15klutzy: rustc::driver: Capitalize structs and enums...
[04:56:47] <ghrust> 13rust/06auto 14ec6aba3 15klutzy: rustc::metadata: Remove trait FileSearch
[04:56:48] <ghrust> 13rust/06auto 14b33d2fe 15klutzy: syntax::ast: Remove/Recover tests...
[04:56:50] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[04:56:52] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[04:56:52] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/ImB85g
[04:56:52] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[04:59:40] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[05:01:47] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Ping timeout)
[05:03:06] *** Joins: brson (brson@981AA104.E81F12CD.76F66111.IP)
[05:03:06] *** ChanServ sets mode: +qo brson brson
[05:04:22] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[05:05:33] *** Quits: gwty (gwtypc@A3F4FE97.CFB6D583.BD94A9D5.IP) (Ping timeout)
[05:07:57] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[05:17:29] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[05:20:32] *** Quits: brson (brson@981AA104.E81F12CD.76F66111.IP) (Ping timeout)
[05:21:29] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[05:24:48] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[05:24:49] *** ChanServ sets mode: +qo brson brson
[05:35:37] *** Quits: new_one (new_one@F8CB5EE5.6D46D672.B3C0173E.IP) (Broken pipe)
[05:58:34] *** Joins: dbaupp (Thunderbir@moz-59CE1D72.lns20.syd6.internode.on.net)
[06:04:16] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[06:04:59] *** Joins: gwty (gwtypc@A3F4FE97.CFB6D583.BD94A9D5.IP)
[06:21:46] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[06:21:46] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/BA9s3A
[06:21:46] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[06:26:46] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[06:26:46] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/eWuqnA
[06:26:46] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[06:26:46] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[06:26:47] <ghrust> 01[13rust01] 15bors pushed 12 new commits to 06auto: 02http://git.io/xeJq6w
[06:26:47] <ghrust> 13rust/06auto 14419ac4a 15Niko Matsakis: Issue #3511 - Rationalize temporary lifetimes....
[06:26:47] <ghrust> 13rust/06auto 14e71571a 15Niko Matsakis: Use as_slice() method on option
[06:26:47] <ghrust> 13rust/06auto 146badef4 15Niko Matsakis: Remove FIXMEs and add license
[06:26:49] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[06:35:50] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[06:36:47] *** Quits: gwty (gwtypc@A3F4FE97.CFB6D583.BD94A9D5.IP) (Ping timeout)
[06:36:59] *** Quits: lkuper (lkuper@moz-6881CCA2.dhcp-bl.indiana.edu) (Ping timeout)
[06:49:30] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Quit: Leaving...)
[06:49:38] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[06:50:03] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[06:59:42] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Quit: Leaving...)
[06:59:49] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[07:12:46] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[07:14:25] *** Quits: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net) (Connection reset by peer)
[07:20:55] *** Joins: deen_ (deen@moz-E59E3C65.dip0.t-ipconnect.de)
[07:21:42] *** Quits: deen (deen@moz-B2003C49.dip0.t-ipconnect.de) (Ping timeout)
[07:21:47] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[07:21:47] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 146f6e08f to 145fdc812: 02http://git.io/N3iJvQ
[07:21:47] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[07:21:47] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[07:21:47] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/HWVl4A
[07:21:47] <ghrust> 13rust/06auto 14901dc2c 15Shamir Khodzha: added empty() to Peekable
[07:21:47] <ghrust> 13rust/06auto 144993c7c 15Shamir Khodzha: renamed empty() to is_empty()
[07:21:48] <ghrust> 13rust/06auto 14df0d290 15bors: auto merge of #11479 : khodzha/rust/peekable_empty, r=brson...
[07:21:50] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[07:29:43] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Client exited)
[07:30:04] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[07:31:29] <eddyb> can we pass fat pointers as "two arguments"?
[07:31:50] <eddyb> without the indirection of a similarly sized structure
[07:31:54] <dbaupp> eddyb: i.e. in two registers?
[07:31:55] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Ping timeout)
[07:32:02] <dbaupp> rather than on the stack?
[07:32:26] <eddyb> dbaupp: x86 still uses the stack
[07:33:04] <eddyb> I'm curious if let x = y; let y = &x; actually takes the value of x
[07:33:16] <eddyb> err, let x = 0;
[07:34:42] <eddyb> I have a sneaking suspicion that it doesn't, in which case let x = Some(0); can be %0 = {i64 1, i64 0}
[07:35:15] <eddyb> well, it would be a call there, but it doesn't need to be indirect. thought it's larger than one NEVERMIND ME
[07:35:35] * dbaupp is so confused
[07:35:38] <cmr> yeah
[07:35:41] <dbaupp> what do you mean by "taking the value"?
[07:35:43] <cmr> what are you even talking about
[07:36:08] <eddyb> *taking the address
[07:36:11] *** Quits: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net) (Quit: Textual IRC Client: www.textualapp.com)
[07:36:11] <dbaupp> oh
[07:36:24] <eddyb> I need to stop thinking
[07:36:49] *** Joins: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net)
[07:37:33] <eddyb> or stop thinking out loud, that would be just as good
[07:37:35] <Yurume> eddyb: so, make it possible to pass two-word structs for fat pointers (and I think, closures?) directly via the stack?
[07:39:03] <eddyb> we have to see if it helps devirtualization and how it affects performance overall
[07:39:29] <dbaupp> eddyb: any feedback on your LLVM patch?
[07:39:32] <eddyb> closures and traits use a similar representation (both two words), they will be merged in the future
[07:39:48] *** flaper87|afk is now known as flaper87
[07:40:08] <eddyb> dbaupp: nope, they said to wait a few days. yay holiday review backlog. I know someone who dealt with that code in the past, to CC monday or so if I don't hear anything until then
[07:40:37] <eddyb> rust is quite manageable, you can't complain about anything until you deal with LLVM >_>
[07:40:50] <eddyb> s/until/after
[07:43:00] <eddyb> my env/self PR is talking longer because I got greedy and started replacing opaque_box pointers with i8*
[07:48:14] <eddyb> hmm, what if the weak refcount was the first one in RcBox<T>?
[07:49:01] <eddyb> and then, with an Allocator interface providing something like in-place-maybe-realloc, to restrict the allocation size (to 1 word) without moving it, if possible
[07:50:03] <eddyb> though I'm not sure I expect huge structures in Rc, anything growable would be indirect... so I guess most of the time dropping the contents of the box without freeing the box is okay, nevermind me
[07:50:27] <cmr> eddyb: you know you can query yourself to rubber duck :p
[07:50:29] <cmr> or just not type.
[07:50:56] <eddyb> cmr: but... it's compiling
[07:51:01] <cmr> or even rusti if you want company.
[07:51:35] <cmr> rusti: println!("sometimes I get lonely too");
[07:51:36] -rusti- sometimes I get lonely too
[07:51:37] -rusti- ()
[07:52:06] <eddyb> cmr: notrusti was cool, it could execute arbitrary (sandboxed) commands
[07:52:13] <dbaupp> rusti: it's ok, we're here for you
[07:52:17] -rusti- pastebinned 6 lines of output: http://ix.io/9Vn
[07:52:40] <dbaupp> :( he rejected my attention
[07:53:27] <eddyb> _ZN48_$SP$condition..Handler$LT$$UP$str$C$$UP$str$GT$9glue_drop19h6d005f77d90e5bf9aGE is for type @condition::Handler<~str,~str>
[07:53:45] <eddyb> we really need to figure out a better scheme :/
[07:54:05] <dbaupp> I think it's approximately reversible
[07:54:12] <dbaupp> so just write a filter
[07:54:13] <cmr> it's pretty nice I think
[07:54:21] <dbaupp> cmr: really?
[07:54:24] <dbaupp> all the $'s
[07:54:32] <cmr> dbaupp: they're a necessary evil.
[07:55:01] <eddyb> I should give up and learn C++ mangling in detail
[07:55:04] <cmr> you've seen microsoft's name mangling scheme right? :P
[07:55:23] * dbaupp hasn't
[07:55:24] <eddyb> $U<str> is better for ~str than what we have
[07:55:31] <eddyb> cmr: oh dear, I think I know what you're talking about
[07:55:51] <cmr> ?xyz@?$abc@V?$def@H@@PAX@@YAXXZ
[07:55:59] <eddyb> $C$ for ",", what is this?
[07:56:08] <eddyb> cmr: take that away. SHOO
[07:56:45] <cmr> eddyb: most of the name mangling strangeness is becase android's binutils is picky.
[07:57:28] <eddyb> cmr: my point is to have a mangling scheme that is meaningful, not to leave all characters in play sight
[07:57:52] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[07:58:02] <cmr> you just need to know what the letters mean.
[07:58:03] <eddyb> *plain
[07:58:20] <eddyb> I think we can shorten the hash further (it's a tiny bit useless IMO) if you put type params in generic functions' symbols
[07:58:36] <eddyb> s/you/we/me/do I really want to bother?
[07:58:49] *** Quits: dbaupp (Thunderbir@moz-59CE1D72.lns20.syd6.internode.on.net) (Ping timeout)
[07:58:54] <cmr> shortening the hash at the expense of increasing symbol length is counterproductive.
[07:59:16] <eddyb> cmr: only if you want to keep the symbol short
[07:59:28] <Yurume> cmr: haha, I had to reverse-engineer that :S
[07:59:29] <eddyb> not so if you want to make the symbol meaningful
[07:59:32] <cmr> symbols need to be performant.
[07:59:38] <cmr> *need to be short to be
[07:59:49] <cmr> linkers are crappy, they don't like long symbol names.
[07:59:52] <cmr> plus they bloat the binary.
[08:00:17] <cmr> if it were up to me we'd not even have symbol names, we'd just hash them straight out and use debuginfo when we want names.
[08:00:18] <eddyb> stupid linkers. they should just take the hash, not in hex, not in base64, but a raw value
[08:00:34] <eddyb> yeah, that, but debuginfo doesn't contain... well, I don't know
[08:00:38] <cmr> it does.
[08:00:55] <cmr> everything goes in dwarf :p
[08:01:00] <eddyb> LLVM IR doesn't contain that debug info
[08:01:09] <cmr> sure it does, it's all inline.
[08:01:31] <eddyb> does that mean you need -Z extra-debug-info for function names?
[08:01:43] <cmr> yes.
[08:01:57] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[08:01:57] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14df0d290 to 145fdc812: 02http://git.io/N3iJvQ
[08:01:57] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[08:01:58] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[08:01:58] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/uVcQkw
[08:01:58] <ghrust> 13rust/06auto 14e9b188a 15Carl-Anton Ingmarsson: extra::ebml: Make reader::Res public...
[08:01:58] <ghrust> 13rust/06auto 141130886 15Carl-Anton Ingmarsson: extra::ebml: Add unit test for vuint_at()
[08:01:58] <ghrust> 13rust/06auto 14e52f7c9 15Carl-Anton Ingmarsson: ebml::extra: Optimize reader::vuint_at()...
[08:02:00] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[08:02:02] <cmr> or another map from hash->name
[08:02:18] <eddyb> I want a complete expansion, like C++, no hash, for both gdb and LLVM IR
[08:02:32] <cmr> why bother
[08:02:43] *** Joins: dbaupp (Thunderbir@moz-EE10A658.lns20.syd6.internode.on.net)
[08:02:51] <eddyb> I don't really care that it's not the symbol name, as long as it's present without -Z extra-debug-info
[08:03:34] <eddyb> extra-debug-info is supposed to annotate *everything*
[08:03:48] <cmr> if you're using gdb you want debuginfo anyway. IMO we leak too many details in our binaries.
[08:04:01] <eddyb> -Z strip
[08:04:12] <cmr> doesn't help
[08:04:27] <cmr> also function names are present even with just debug-info
[08:04:36] <eddyb> that is, by default?
[08:04:45] <cmr> debug-info and extra-debug-info weren't destined to be separate, that happened because extra-debug-info was historically broken.
[08:04:47] <eddyb> or are there two levels, nothing by default? I didn't think it was that way
[08:05:18] <Yurume> cmr: is the current mangling scheme just replacing punctuations to $<code>$?
[08:05:20] <cmr> there's no debuginfo, debug-info which does some things, and extra-debug-info which corresponds to -g to cc.
[08:05:24] <cmr> Yurume: more or less.
[08:05:34] <eddyb> I expect extra-debug-info to break some optimization or take longer to compile, etc, not something you want by default
[08:05:42] <eddyb> but I want full function names by default
[08:05:55] <eddyb> Yurume: that's for glue functions
[08:06:03] <cmr> eddyb: debuginfo is 100% out-of-line annotation
[08:06:15] <cmr> and it only takes marginally longer.
[08:06:35] <Yurume> how about tyencode? is it only for metadata?
[08:06:39] <eddyb> oh, I guess, "<optimized out>"
[08:06:42] <eddyb> Yurume: yes
[08:06:58] <eddyb> the glue functions' symbols contain a type and a name (drop/take/visit)
[08:07:49] <eddyb> also, trait methods are mangled with a similar (but different! blame dbaupp - nah, thank him :P) scheme (they also contain a type)
[08:08:09] *** Joins: gwty (gwtypc@C77AC663.B3BCF8B0.45DA6411.IP)
[08:08:30] <eddyb> does C++ mangling allow intserting arbitary characters, in an encoded way? that would kinda solve everything
[08:08:40] <cmr> no
[08:08:49] <eddyb> yay zero future proofing
[08:08:59] <cmr> not the itanium abi, at least.
[08:09:31] <cmr> others might
[08:09:35] <Yurume> cmr: vendor specific identifiers?
[08:09:38] <cmr> it's not like it's standard.
[08:09:56] <cmr> well
[08:10:01] <cmr> Yurume: that's almost cheating :p
[08:10:02] <Yurume> vendor specific "types" are already there, identifiers I doubt
[08:10:20] <cmr> all I know of is types and operators.
[08:10:29] <cmr> but even if it were it wouldn't help because it wouldn't be standard.
[08:11:52] <eddyb> if c++filt and gdb can handle it, it's good
[08:12:01] <cmr> c++filt on which platform :)
[08:12:16] <Yurume> yeah, there is no "identifier" extension possible as long as I see from the standard.
[08:12:40] <eddyb> GNU c++filt (GNU Binutils; devel:gcc / openSUSE_13.1) 2.24.0.20131209-177
[08:12:51] <cmr> yuck gnu tools.
[08:14:17] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[08:14:50] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[08:15:11] <Yurume> c++filt 2.22 certainly supports u21vendor_specific_types, by printing it as "vendor_specific_types".
[08:17:22] <eddyb> OMG
[08:17:55] <eddyb> the LLVM type repr for @T requires creating a ~[Type] then appending to it. bleah
[08:20:07] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:21:59] <eddyb> strcat: Type::opaque_box is gone :D
[08:22:52] <eddyb> and I'm replacing smart_ptr with managed. I hope that's okay (it's the @T box)
[08:23:09] <cmr> didn't pcwalton *just* rename that
[08:24:29] <eddyb> cmr: where?
[08:24:30] <dbaupp> eddyb: please don't replace it with just 'managed'...
[08:24:43] <eddyb> how can we call @T in a short way?
[08:24:48] <eddyb> at_box?
[08:24:50] <dbaupp> eddyb: like 'at_managed' or 'old_managed' would be nicer (from my perspective)
[08:24:53] <dbaupp> something like that
[08:25:00] <dbaupp> but, then, I'm not a core-dev
[08:26:13] <cmr> yes, it was just renamed from box.
[08:27:22] <eddyb> cmr: middle::trans::type_::Type::smart_ptr?
[08:27:27] <cmr> yes
[08:27:54] <eddyb> as in, it was box before?
[08:27:57] <cmr> yes
[08:28:05] <eddyb> why did he rename it? smart_ptr is... wrong
[08:28:24] <cmr> because box became a keyword, and it might *not* be wrong.
[08:28:33] <cmr> pointer reform is still in-progress.
[08:28:35] <eddyb> ah, at_box is fine then :P
[08:28:48] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:28:55] <cmr> (box refers to the allocation, not the type)
[08:33:56] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:37:01] <eddyb> hmm, I think my changes will make DST and/or removal of @ easier :)
[08:38:27] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[08:39:15] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[08:45:38] *** Joins: c-a (c-a@moz-57C82A9.a163.priv.bahnhof.se)
[08:51:21] <eddyb> "Calling a function with a bad signature!"
[08:51:28] <cmr> eddyb: I don't particularly have time atm to carry on my @str/@[] removal, would you like to take it on? :D
[08:51:50] <cmr> (it's just removing usages; it's like 85% done)
[08:51:57] <cmr> (but I invoke the 80/20 rule)
[08:52:15] <eddyb> cmr: strictly after this PR, but I wouldn't mind doing it (and I like removing obsolete things from trans)
[08:52:21] <eddyb> can we get LLVM debug output, somehow?
[08:52:36] <eddyb> I want to know the signatures of those things it complains about :(
[08:52:52] <cmr> I don't think we build llvm in a debug config.
[08:52:59] <cmr> it is quite unfortunate trying to track those down :(
[08:53:13] <eddyb> okay, fuck it. everyone is going to be grateful
[08:53:22] <eddyb> cmr: I'll just add debug output to Call :P
[08:53:33] <cmr> debug! ? sure.
[08:55:26] <strcat> eddyb: you can print out LLVM types
[08:57:48] *** Quits: Yurume (Yurume@A826BD81.8A0DEF81.38747683.IP) (Ping timeout)
[08:57:59] *** Joins: Yurume (Yurume@A826BD81.8A0DEF81.38747683.IP)
[09:00:03] *** Quits: gwty (gwtypc@C77AC663.B3BCF8B0.45DA6411.IP) (Ping timeout)
[09:00:20] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[09:00:39] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[09:01:51] *** Joins: gwty (gwtypc@C77AC663.B3BCF8B0.45DA6411.IP)
[09:03:06] *** Joins: jensnock_ (jensnocker@moz-33279404.customers.ownit.se)
[09:03:58] *** Quits: nrc|afk (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[09:03:58] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Ping timeout)
[09:04:58] *** Quits: lpy (lpy@7360AA58.F09091A8.1348A864.IP) (Quit: Leaving...)
[09:13:15] <eddyb> Call void ({ i64, %tydesc*, i8*, i8*, %"struct.condition::Handler<~str,~str>" }**)* with args (%"struct.condition::Handler<~str,~str>"*)
[09:16:25] <eddyb> that tells me it's trying to call the Struct drop glue for @Struct. but... I didn't touch that
[09:21:47] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[09:21:47] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/uVcQkw
[09:21:47] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[09:26:43] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[09:26:43] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/ssL28Q
[09:26:43] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[09:26:44] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[09:26:44] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/ruOoLg
[09:26:44] <ghrust> 13rust/06auto 145187987 15Flavio Percoco: Add a generic power function...
[09:26:44] <ghrust> 13rust/06auto 142d64494 15bors: auto merge of #11503 : FlaPer87/rust/master, r=huonw...
[09:26:44] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[09:35:50] <eddyb> libstd builds again \o/
[09:38:09] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Ping timeout)
[09:38:15] *** Joins: andrew-d_w (andrew-d_w@4CCE6E0C.339B431B.1E537B93.IP)
[09:38:57] *** Quits: andrew-d_w (andrew-d_w@4CCE6E0C.339B431B.1E537B93.IP) (Input/output error)
[09:39:23] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[09:40:25] *** Joins: rca (rcatolino@22E42357.20117C61.520D6FA6.IP)
[09:41:41] <eddyb> task '[run-pass] run-pass/borrowed-ptr-pattern.rs' failed at 'explicit failure', /home/eddy/Projects/rust/src/compiletest/runtest.rs:895
[09:41:55] <eddyb> there's no stdout/stderr, this is odd. a few tests fail like this
[09:42:50] <eddyb> autobind still does a bad Store, closure-related
[09:50:29] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[09:51:22] *** Joins: binsh (binsh@moz-54F7FD49.cpe.net.cable.rogers.com)
[09:51:23] *** Quits: binsh (binsh@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[09:51:37] *** Joins: notrusti (notrusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[09:54:27] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[09:55:04] *** Quits: jdm (jdm@moz-12626D4B.static.videotron.ca) (Ping timeout)
[10:01:18] *** Quits: gwty (gwtypc@C77AC663.B3BCF8B0.45DA6411.IP) (Ping timeout)
[10:03:46] *** Joins: nrc|afk (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[10:08:13] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[10:08:32] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[10:09:04] <eddyb> hehehe
[10:09:39] <cmr> eddyb: (https://github.com/cmr/rust/tree/issue-2243 is the @str/@[] branch btw)
[10:09:48] <eddyb> strcat: mistery solved. I was mapping DefId to ValueRef for bare-fn-as-closure. guess what happens if the DefId is something generic?
[10:10:02] * cmr -> bed
[10:10:12] <eddyb> it was trying to use the f::<int> wrapper for f::<~str>
[10:10:24] <eddyb> cmr: thanks :D
[10:12:31] *** Quits: nrc|afk (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[10:13:05] <eddyb> strcat, nmatsakis: any idea if ValueRef's can be hashed to the same hash for the same referenced function?
[10:16:53] *** Quits: notrusti (notrusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[10:17:17] *** Joins: notrusti (notrusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[10:20:03] <eddyb> notrusti: stop pls
[10:20:04] -notrusti- bash: stop: command not found
[10:20:04] -notrusti- application terminated with error code 127
[10:21:45] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[10:21:45] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 142d64494 to 1493fb12e: 02http://git.io/N3iJvQ
[10:21:45] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[10:21:47] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[10:21:47] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/amZK1w
[10:21:47] <ghrust> 13rust/06auto 1418ea36e 15Alex Crichton: Tweak the interface of std::io...
[10:21:47] <ghrust> 13rust/06auto 149aa8592 15bors: auto merge of #11598 : alexcrichton/rust/io-export, r=brson...
[10:21:48] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[10:27:08] *** Quits: rca (rcatolino@22E42357.20117C61.520D6FA6.IP) (Ping timeout)
[10:29:25] *** Joins: rca (rcatolino@22E42357.20117C61.520D6FA6.IP)
[10:40:22] *** Joins: gwty (gwtypc@C77AC663.B3BCF8B0.45DA6411.IP)
[10:55:24] <eddyb> dbaupp, strcat: now I have to make @str drop glue work again, while cmr spent time to remove uses of @str/@[T] :P
[10:55:38] <dbaupp> eddyb: just leak 'em :P
[10:55:46] <eddyb> dbaupp: double free I think
[10:55:55] <dbaupp> so don't free at all!
[10:55:56] *** Quits: gwty (gwtypc@C77AC663.B3BCF8B0.45DA6411.IP) (Ping timeout)
[10:56:00] <dbaupp> easy! :P
[10:59:31] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[11:02:31] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[11:03:25] <eddyb> aaaah, tvec::expand_boxed_vec_ty(ccx.tcx, t) instead of getting the actuall inner fake type that it creates. silly me
[11:15:25] *** Quits: cyndis (cyndis@moz-C4357EA7.kapsi.fi) (Ping timeout)
[11:21:45] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[11:21:45] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 149aa8592 to 1493fb12e: 02http://git.io/N3iJvQ
[11:21:45] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[11:21:48] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[11:21:48] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/gibRrw
[11:21:48] <ghrust> 13rust/06auto 14087a686 15Flavio Percoco: Add a generic power function...
[11:21:48] <ghrust> 13rust/06auto 1414a6726 15bors: auto merge of #11503 : FlaPer87/rust/master, r=huonw...
[11:21:49] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[11:23:44] <eddyb> /home/eddy/Projects/rust/src/test/run-pass/expr-block-fn.rs:16:17: 16:24 error: internal error looking up a definition
[11:23:51] <eddyb> /home/eddy/Projects/rust/src/test/run-pass/expr-block-fn.rs:16     let rs: t = { ten };
[11:26:06] <eddyb> how does that fail?
[11:26:25] <eddyb> oooh, I see, it should be without {}
[11:30:34] *** Joins: cyndis (cyndis@moz-C4357EA7.kapsi.fi)
[11:37:27] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[11:39:26] *** Quits: jensnock_ (jensnocker@moz-33279404.customers.ownit.se) (Input/output error)
[11:39:56] *** Joins: jensnockert (jensnocker@moz-33279404.customers.ownit.se)
[11:41:39] *** Quits: jensnockert (jensnocker@moz-33279404.customers.ownit.se) (Ping timeout)
[11:43:43] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[11:44:25] *** Quits: notrusti (notrusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[11:44:56] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[11:46:02] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[11:54:53] <eddyb> Luqman: want to give my PR another try?
[11:55:08] <eddyb> Luqman: though it's not worth it, doing a local check now
[11:56:09] <dbaupp> eddyb: you want me to push something to try?
[11:57:27] <eddyb> nah, I'll ask for r+ if it works locally
[12:00:55] <dbaupp> eddyb: the AST map has an occupancy of 75-80%
[12:00:56] <dbaupp> fwiw
[12:01:07] <eddyb> tested?
[12:01:24] <dbaupp> yeah
[12:01:49] <dbaupp> using smallintmap gives me a 4 MB saving for libextra (compiling without opts)
[12:02:02] <dbaupp> and an 8MB for libsyntax
[12:02:23] <eddyb> needs to be intrusive to remove another word
[12:02:37] <eddyb> dbaupp: there's a lot of maps in ty::ctxt and trans::context::CrateContext
[12:02:38] <dbaupp> yes
[12:02:46] <dbaupp> they're probably less dense
[12:03:13] <eddyb> some of them are hash-based (for which we should maybe use a faster hash)
[12:03:39] <dbaupp> yup
[12:03:54] <dbaupp> need default type parameters to be able to change the hash that HashMap uses ;P
[12:04:27] <eddyb> others map DefId's or NodeId's which might benefit from an intrusive (or not, if Option<V> is nullable) LinearMap
[12:05:43] <dbaupp> depends on occupancy
[12:06:16] <eddyb> types for AST IDs would have a similar occupancy to ast_map
[12:07:59] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[12:10:03] <eddyb> dbaupp: do you think ty::get needs to die?
[12:11:46] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[12:11:46] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1414a6726 to 1493fb12e: 02http://git.io/N3iJvQ
[12:11:46] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[12:11:48] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[12:11:48] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/-vgjjQ
[12:11:48] <ghrust> 13rust/06auto 148f4edf9 15Derek Guenther: Update test run summary
[12:11:48] <ghrust> 13rust/06auto 147d75bbf 15bors: auto merge of #11601 : dguenther/rust/fix_test_summary, r=brson...
[12:11:49] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[12:12:32] <dbaupp> eddyb: no idea
[12:13:27] <eddyb> there is no refcounting anymore
[12:13:42] <eddyb> &'static Ty would just work
[12:14:05] *** Quits: rca (rcatolino@22E42357.20117C61.520D6FA6.IP) (Ping timeout)
[12:15:04] *** Joins: gwty (gwtypc@48DEBDAD.2FB7FDF8.49FF672.IP)
[12:16:32] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Ping timeout)
[12:18:03] <eddyb> hmm, if we move drop_glue to the first entry of the vtable, then we could expose ~Trait to C++ :D
[12:18:52] *** Joins: jensnockert (jensnocker@moz-33279404.customers.ownit.se)
[12:19:42] <eddyb> though we'd have to switch the order from (vtable, ptr) to (ptr, vtable) - which I think is something we should do anyway, for DST
[12:20:07] <dbaupp> didn't strcat want to replace the tydesc with just a pointer straight to the drop-glue anyway?
[12:20:51] <eddyb> dbaupp: well, yeah. what do we do about visit_glue and the other information in tydesc?
[12:22:01] <eddyb> rusti: proc(){}
[12:22:02] -rusti- fn()
[12:22:09] <eddyb> rusti: ~0 as ~Clone
[12:22:10] -rusti- ~std::clone::Clone:Send
[12:22:22] <eddyb> wait, it... doesn't go through trait pointers
[12:22:58] <eddyb> thus it's equivalent to a completely static implementation of the TyVisitor
[12:23:28] <eddyb> same for the name, an intrinsic should help with that
[12:24:33] <eddyb> so should I remove visit_glue and take_glue next? and maybe tydesc altogether \o/
[12:27:00] <dbaupp> you should talk to pnkfelix before you completely remove the tydesc
[12:27:08] <dbaupp> it's almost certainly necessary for tracing GC
[12:28:03] * pnkfelix reads backscroll
[12:28:58] <eddyb> pnkfelix: take_glue seems to be statically resolved and visit_glue is not use dynamically by {:?}, to go through trait pointers - without them, tydesc contains drop_glue and some type metadata
[12:29:03] <eddyb> *is not used
[12:33:15] <pnkfelix> eddyb: so wait, what is {:?} using then?
[12:34:03] *** Quits: gwty (gwtypc@48DEBDAD.2FB7FDF8.49FF672.IP) (Ping timeout)
[12:34:45] *** Joins: rca (rcatolino@22E42357.20117C61.520D6FA6.IP)
[12:35:19] <eddyb> pnkfelix: it's using the intrinsic which starts visiting a type, but it doesn't go through the visit_glue in tydesc (or at least not for traits), which means that we should leave the visit_glue-generated functions as they are, but they don't need to be in tydesc
[12:35:21] <eddyb> or go through it
[12:35:48] *** Joins: gwty (gwtypc@C61DF61.BA3925B4.137C914F.IP)
[12:38:01] <eddyb> /home/eddy/Projects/rust/x86_64-unknown-linux-gnu/test/run-make/c-dynamic-dylib/bar: error while loading shared libraries: libcfoo.so: cannot open shared object file: No such file or directory
[12:38:01] <pnkfelix> eddyb: well my gut says that dbaupp is right that we are likely to want the tydesc in the long term, but who knows, I haven't digested the way this all holds together yet.
[12:38:45] *** Quits: rca (rcatolino@22E42357.20117C61.520D6FA6.IP) (Ping timeout)
[12:39:03] <eddyb> pnkfelix: maybe something like ~Trait:Traceable would contain an extra method? I don't know
[12:39:29] <eddyb> (where Traceable is a kind)
[12:39:45] *** Quits: sigma (sigma@moz-1C81041B.range86-184.btcentralplus.com) (Ping timeout)
[12:40:49] <pnkfelix> eddyb: (its also possible that we'll end up having the mem mgmt store it data layout info itself somewhere else, rather than rely on an embedded ptr to the tydesc)
[12:41:12] <eddyb> yeah, that would probably be more flexible
[12:42:00] *** Joins: sigma (sigma@moz-1C81041B.range86-184.btcentralplus.com)
[12:43:06] <dbaupp> my current thinking is to have the GC sidetable store a pointer to some sort of tydesc itself (we want to be storing the drop glue and the trace glue in one place, so the GC only needs one word to find it, rather than a word for each)
[12:43:07] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Ping timeout)
[12:44:15] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[12:45:59] *** Quits: sigma (sigma@moz-1C81041B.range86-184.btcentralplus.com) (Ping timeout)
[12:46:07] <pnkfelix> dbaupp: one thing I've been idly wondering about is if we will want to try to coalesce the data layout descriptions when multiple types have the same data layout.
[12:46:23] <pnkfelix> dbaupp: But its too soon to be worry about that sort of program size optimization.
[12:46:53] *** Joins: rca (rcatolino@22E42357.20117C61.520D6FA6.IP)
[12:47:28] <dbaupp> pnkfelix: that seems like a reasonable thing to do... later
[12:48:02] <eddyb> I had a similar issue in my JS "decompiler" framework, embedding data in objects (by monkeypatching the prototype) can be inefficient, if you do it using getters/setters and/or intercepting function calls
[12:48:04] <pnkfelix> dbaupp: yeah.  The one case that *could* be of interest is to have a specializd path for data where the layout is very regular
[12:48:19] <eddyb> while lazy side tables would "just work"
[12:48:21] <dbaupp> pnkfelix: what's "very regular" mean in this context?
[12:48:27] <pnkfelix> dbaupp: e.g. for objects that consist of a series of pointers followed by a series of non-ptrs
[12:48:31] <eddyb> (and WeakMap wouldn't drag around tons of objects, either)
[12:48:52] <eddyb> pnkfelix: oh, that can be described with two values, can't it?
[12:49:07] <pnkfelix> dbaupp: hypothetically the GC could have inlined code for scanning such instances
[12:49:19] <dbaupp> pnkfelix: ah, I see
[12:49:25] <pnkfelix> eddyb: sure, but from the point of view of the GC, its one block of memory its parceled out
[12:49:26] *** Joins: sigma (sigma@moz-1C81041B.range86-184.btcentralplus.com)
[12:50:06] <eddyb> (at least I learn some things about GCs while my tests compile)
[12:50:06] <dbaupp> pnkfelix: well... if we have trace glue (i.e. a precise tracing function) then it's all static dispatch & fast, except for any conservative scans
[12:50:27] <pnkfelix> dbaupp: The problem with having trace glue is that you then pay for the code you've generated
[12:50:41] <pnkfelix> dbaupp: It can take up a signficant portion of the code size
[12:50:42] <dbaupp> pnkfelix: i.e. code size?
[12:50:54] <pnkfelix> dbaupp: yes.  Its something that is sometimes overlooked
[12:51:32] <pnkfelix> dbaupp: but again, we don't need to worry about this at the outset
[12:51:35] <dbaupp> yeah
[12:51:39] <pnkfelix> dbaupp: its just something to keep in the back of one's mind.
[12:51:56] <dbaupp> with non-compulsory GC it might not be too bad (if we emit the trace glue lazily)
[12:52:12] * dbaupp shrugs
[12:52:23] <pnkfelix> dbaupp: true
[12:53:08] <eddyb> (hence ~Trait:Traceable :))
[12:53:42] <pnkfelix> dbaupp: and if the API for the trace-glue method is general enough (e.g. where it might receive as an argument a ptr to the layout info stored in the tydesc)
[12:53:44] <dbaupp> pnkfelix: I guess the proof will be in the pudding
[12:54:24] <eddyb> hmm, with trait Trait: BaseA, BaseB; can we go from &Trait to &BaseA or &BaseB?
[12:54:34] <pnkfelix> dbaupp: then you can just have most tracers just share the same code (that act as interpreters over the layout info they were passed), and only generate specialized tracers when its profitable
[12:55:01] <dbaupp> ah, yes
[12:55:23] <dbaupp> specialized tracers could just be impling a Trace trait... hm, this could work
[12:55:47] <eddyb> then we could have Trait+Send an unsized type, instead of Trait:Send. if Send were to have a method, you could call it through &(Trait+Send)
[12:55:48] <pnkfelix> dbaupp: a Trace trait with a default method ?
[12:56:02] <pnkfelix> dbaupp: (that interprets the layout info its been passed?)
[12:56:23] <eddyb> does what I'm saying make sense?
[12:56:35] <pnkfelix> eddyb: I didn't understand the `Trait+Send` thing
[12:56:46] <eddyb> make kinds less special
[12:56:47] <dbaupp> pnkfelix: oh, maybe... but I was thinking the glue would be like the drop glue: autogenerated to call drop on the subfields, but then the Drop trait changes the behaviour
[12:57:04] <pnkfelix> dbaupp: ah I see
[12:57:11] <dbaupp> (although trace glue would be slightly different in that a Trace impl would completely override the compiler autogenerated code)
[12:57:59] <eddyb> if we have a Traceable trait and impl Traceable for T (calling intrinsics and whatnot), then Trait+Traceable would give you that "trace glue"
[12:58:12] <eddyb> and Trait would... wait, no, there's an issue here
[12:58:24] <dbaupp> eddyb: glahbor (misspelt, sorry :( ) suggested that Trait1+Trait2 be a valid "trait", so ~(Trait1+Trait2) would be a perfectly valid trait object
[12:58:29] <eddyb> ~T could coerce to ~(Trait+Traceable), but ~Trait wouldn't have that information
[12:58:48] <eddyb> do we want that annotation cost for GC?
[12:58:56] <pnkfelix> dbaupp: ah.  Aka intersection types
[12:59:05] <dbaupp> pnkfelix: yeah, I guess so
[12:59:19] <eddyb> kinds kinda do that right now, but they don't have methods
[13:00:51] <dbaupp> eddyb: the problem with having to annotate things for GC is generic data structures need the annotations to be able to store GC'd pointers (even if they're just a thing wrapper around, say, ~[] which will support GC automatically)
[13:01:04] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[13:01:04] <eddyb> ouch
[13:01:07] <dbaupp> so you end up with either duplicated constructors for Traceable and non-Traceable
[13:01:21] <dbaupp> or data structures that only work for Traceable things, or don't work for GC'd things
[13:01:25] <eddyb> dbaupp: though, how many things are generic over trait objects?
[13:02:15] <dbaupp> eddyb: oh hm, annotations for just trait objects? I guess nothing is generic over only them, since that sounds rather impossible.
[13:02:23] <dbaupp> (with our current type system)
[13:02:48] <eddyb> something that is required for Gc and can be inferred, at least in local contexts
[13:03:27] <eddyb> Gc<Trait> would imply Traceable, maybe
[13:03:34] <eddyb> dbaupp: all of this is a dat confusing
[13:03:36] <eddyb> *tad
[13:03:42] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[13:05:45] <dbaupp> I think abuse of parametric polymorphism like this will make things and users unhappy (e.g. transmute can cause C++-style errors from inside generic function, that can't be expressed with trait bounds; and GC stuff that doesn't require annotation will probably do something similar... :( )
[13:07:41] <eddyb> transmute? that one's easy :P
[13:07:55] <dbaupp> "easy"?
[13:08:01] <eddyb> transmute<T, U: SameSize<T>>(T) ->U
[13:08:42] <eddyb> if it's a lang item, checking trait bounds could simply have a special case
[13:09:24] <pnkfelix> dbaupp: what did you mean by "C++-style errors" ?
[13:09:33] <pnkfelix> dbaupp: (there's so many interpretations to choose from...)
[13:11:30] <dbaupp> pnkfelix: as in, the constraints aren't expressed in the type signature of the function
[13:11:44] <pnkfelix> dbaupp: k
[13:11:44] <dbaupp> and can only be checked when the function is fully monomorphised
[13:12:20] <eddyb> traits and lang items :)
[13:12:27] <dbaupp> We could have TraceableOrNonManaged trait bound, but that seems kinda weird
[13:12:45] <dbaupp> eddyb: see problems with annotation burden above
[13:13:08] <dbaupp> (i.e. that trait bound would be required on essentially everything, similar to `sized` and `unsized`.)
[13:14:30] <eddyb> dbaupp: such a trait would be implemented by everything
[13:14:50] <dbaupp> I don't think *T or *mut T should implement it
[13:14:53] <dbaupp> but other than that, yes
[13:15:23] <eddyb> rusti: trait Foo {fn foo(&self){}} impl<T> Foo for T{} fn foo<T>(x: &T) {x.foo()}
[13:15:24] -rusti- <anon>:10:57: 10:83 warning: code is never used: `foo`, #[warn(dead_code)] on by default
[13:15:24] -rusti- <anon>:10         trait Foo {fn foo(&self){}} impl<T> Foo for T{} fn foo<T>(x: &T) {x.foo()}
[13:15:24] -rusti-                                                                   ^~~~~~~~~~~~~~~~~~~~~~~~~~
[13:15:24] -rusti- ()
[13:15:38] <eddyb> wait, that works *now*?
[13:15:41] <dbaupp> Well, maybe they could fit under NonManaged
[13:16:18] <eddyb> problem... solved
[13:16:22] <pnkfelix> dbaupp: hmm.  maybe as part of the DST changes, we should incorporate HasRawPtr
[13:16:41] <dbaupp> Ah, what I meant to say was *Gc<T> would be Managed but not Traceable
[13:16:41] <eddyb> (again, needs to be included in trait objects, but nothing else)
[13:16:53] <dbaupp> pnkfelix: "HasRawPtr"? i.e. it contains a *?
[13:16:57] <pnkfelix> dbaupp: yeah
[13:17:13] <pnkfelix> dbaupp: except you'd specify it similarly to `unsized`
[13:17:57] <pnkfelix> dbaupp: i.e. you'd assume a type param didn't have it unless the programmer said otherwise.  I'm not sure, I haven't thought much about it yet.
[13:18:35] <dbaupp> Hm, I guess this pushes the generic-data-structure split to be less visible
[13:19:09] <pnkfelix> clearly the `extern` keyword is the thing to use here.
[13:19:10] * pnkfelix ducks
[13:19:35] <dbaupp> i.e. only *SomeManagedType would require special treatment, and that's probably ok to ignore: if someone is actually storing raw pointers to managed types they can/should make a new-type and implement Trace themselves
[13:19:42] <dbaupp> pnkfelix: a use for `const` \o/
[13:20:00] <dbaupp> `const extern` for extra clarity
[13:20:01] <pnkfelix> dbaupp: oh god that's even worse
[13:20:20] <dbaupp> hehe
[13:20:39] <pnkfelix> actually
[13:20:41] <pnkfelix> unsafe
[13:20:48] <pnkfelix> foo<unsafe T> { ... }
[13:21:05] <pnkfelix> could be a way to say "T has *ptrs"
[13:21:13] <eddyb> why not a trait?
[13:21:23] <eddyb> (at least you're not adding a new keyword, but still)
[13:21:44] <pnkfelix> eddyb: because trait bounds restrict the domain
[13:21:48] <pnkfelix> eddyb: we want something that expands it
[13:21:58] <pnkfelix> eddyb: thus the analogy to `unsized` in DST
[13:22:02] <eddyb> T: !NoRawPtrs
[13:22:13] <eddyb> I don't like unsized, but it might be a necessary evil
[13:22:20] <eddyb> r? https://github.com/mozilla/rust/pull/11595
[13:22:33] <eddyb> it works. bootstraps, tests, everything. TAKE IT
[13:22:37] <dbaupp> r? https://github.com/mozilla/rust/pull/11616
[13:22:59] <eddyb> what's with 11xyx lately?
[13:23:14] <dbaupp> eddyb: #11595 r-... doesn't remove enough code :P
[13:23:47] <eddyb> 900 lines, sorry I can't do more
[13:24:23] <eddyb> dbaupp: priv map: @RefCell<SmallIntMap<Node>>
[13:24:38] <eddyb> dbaupp: you do realize @ there can be just - nevermind, it has to be copiable, 
[13:24:44] <dbaupp> yes
[13:24:51] <dbaupp> I'd already thought about it :P
[13:25:33] <dbaupp> (changing it to be intrusive doesn't make much difference to memory use btw; it just clutters up the Node enum with things downstream users don't want to see.)
[13:25:56] <eddyb> most Node users have _ =>
[13:26:12] <dbaupp> some don't... error messages said so :P
[13:26:12] <eddyb> or Some/None
[13:26:40] <eddyb> dbaupp: did you measure the memory usage difference with an intrusive map? I mean, did you spend time implementing one?
[13:26:48] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[13:26:48] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/-vgjjQ
[13:26:48] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[13:27:29] <dbaupp> eddyb: yes
[13:28:45] <dbaupp> eddyb: https://github.com/huonw/rust/commit/ea1de7ed7687d8f2369d96a4ca0362987341650c
[13:28:55] <eddyb> dbaupp: can you add a comment about it? "The overhead of Option<Node> compared to an intrusive map (using a NodeInvalid variant) was found to be insignificant"
[13:29:05] <dbaupp> sure
[13:30:11] <eddyb> if it really is, I don't want people thinking about microoptimizing it
[13:30:19] <eddyb> dbaupp: oh wow, that is a tiny implementation
[13:30:46] <eddyb> Rust gets pretty close to Haskell in some respects. better than C++, anyway
[13:31:58] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[13:31:58] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/XbNatA
[13:31:58] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[13:33:39] <dbaupp> eddyb: comment added
[13:33:39] *** Quits: rca (rcatolino@22E42357.20117C61.520D6FA6.IP) (Ping timeout)
[13:34:24] *** Joins: rca (rcatolino@22E42357.20117C61.520D6FA6.IP)
[13:35:03] <eddyb> nmatsakis: https://github.com/mozilla/rust/pull/11595 is ready for review, btw, if you have the time to look at it (unlike your PR, it passes tests :P. or at least I hope it will, looks good locally)
[13:35:32] <eddyb> dbaupp: thanks :D
[13:35:48] <pnkfelix> dbaupp: r+
[13:36:39] <dbaupp> pnkfelix: thanks
[13:37:04] <pnkfelix> eddyb: is there no issue number associated with 11595 ?
[13:37:13] <pnkfelix> eddyb: oh sorry,
[13:37:27] <eddyb> pnkfelix: the commit mentions two issues
[13:37:27] <pnkfelix> eddyb: (i didn't hit the ellipsis in the commit msg)
[13:37:42] <eddyb> (did I spam those issues again?)
[13:38:37] <eddyb> https://github.com/mozilla/rust/issues/10667 does this keep the commits alive and non-garbage-collectible?
[13:39:15] <pnkfelix> eddyb: you mean from the POV of github ?
[13:39:20] <eddyb> myeah
[13:41:41] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[13:42:52] *** Joins: jdm (jdm@moz-12626D4B.static.videotron.ca)
[14:03:02] *** Quits: gwty (gwtypc@C61DF61.BA3925B4.137C914F.IP) (Ping timeout)
[14:26:58] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[14:27:17] *** Quits: jdm (jdm@moz-12626D4B.static.videotron.ca) (Quit: Lost terminal)
[14:32:02] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[14:32:02] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 147fb2a3c to 147d75bbf: 02http://git.io/N3iJvQ
[14:32:02] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[14:32:06] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[14:32:06] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/dqvBuQ
[14:32:06] <ghrust> 13rust/06auto 14901dc2c 15Shamir Khodzha: added empty() to Peekable
[14:32:06] <ghrust> 13rust/06auto 144993c7c 15Shamir Khodzha: renamed empty() to is_empty()
[14:32:06] <ghrust> 13rust/06auto 141e1871f 15bors: auto merge of #11479 : khodzha/rust/peekable_empty, r=brson...
[14:32:08] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[14:53:42] <eddyb> cmr, dbaupp: http://lists.cs.uiuc.edu/pipermail/llvm-commits/Week-of-Mon-20140113/201782.html :D
[15:01:31] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[15:01:31] *** ChanServ sets mode: +ao dherman dherman
[15:12:59] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[15:34:16] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Input/output error)
[15:34:41] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[15:35:11] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Input/output error)
[15:36:17] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[15:41:28] *** Joins: lkuper (lkuper@A2C24A61.A0D37E9B.51B6877.IP)
[15:51:48] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[15:51:48] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/dqvBuQ
[15:51:48] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[15:53:44] <eddyb> heh, just one typo. is that good or bad? I don't know, I should wait for a proper review
[15:56:44] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[15:56:45] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[15:56:45] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/nqkJ6g
[15:56:45] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[15:56:47] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[15:56:47] <ghrust> 01[13rust01] 15bors pushed 18 new commits to 06auto: 02http://git.io/GtrnCg
[15:56:47] <ghrust> 13rust/06auto 14419ac4a 15Niko Matsakis: Issue #3511 - Rationalize temporary lifetimes....
[15:56:47] <ghrust> 13rust/06auto 14e71571a 15Niko Matsakis: Use as_slice() method on option
[15:56:48] <ghrust> 13rust/06auto 146badef4 15Niko Matsakis: Remove FIXMEs and add license
[15:56:50] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[16:00:29] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Client exited)
[16:00:51] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[16:00:59] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[16:02:00] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Ping timeout)
[16:02:16] *** Quits: jensnockert (jensnocker@moz-33279404.customers.ownit.se) (Input/output error)
[16:02:31] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Ping timeout)
[16:02:46] *** Joins: jensnockert (jensnocker@moz-33279404.customers.ownit.se)
[16:04:28] *** Quits: jensnockert (jensnocker@moz-33279404.customers.ownit.se) (Ping timeout)
[16:10:14] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[16:13:38] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[16:20:29] *** Quits: Kxepal (Miranda@moz-4F25DFCF.pppoe.mtu-net.ru) (Ping timeout)
[16:31:23] *** Joins: Kxepal (Miranda@moz-5483AA93.pppoe.mtu-net.ru)
[16:42:42] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[16:44:29] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[16:51:02] *** Quits: lkuper (lkuper@A2C24A61.A0D37E9B.51B6877.IP) (Quit: lkuper)
[16:53:27] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[16:53:27] <ghrust> 01[13rust01] 15cmr 04force-pushed 06try from 144522dcf to 1462faac5: 02http://git.io/k471pw
[16:53:27] <ghrust> 13rust/06try 143115968 15Corey Richardson: Add support for arbitrary flags to MemoryMap....
[16:53:27] <ghrust> 13rust/06try 14fe88137 15Corey Richardson: Use `mmap` to map in task stacks and guard page...
[16:53:27] <ghrust> 13rust/06try 1454b3685 15Corey Richardson: Update task-perf-one-million
[16:53:29] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[16:54:15] *** Joins: lkuper (lkuper@moz-6881CCA2.dhcp-bl.indiana.edu)
[17:07:49] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[17:07:56] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[17:16:06] *** Joins: new_one (new_one@A30FB7D1.8BFB2575.B3C0173E.IP)
[17:16:50] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[17:16:51] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/GtrnCg
[17:16:51] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[17:17:17] *** Joins: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP)
[17:18:38] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: rcirc on GNU Emacs 24.3.50.1)
[17:21:02] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[17:21:47] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[17:21:47] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/S5CSvQ
[17:21:47] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[17:21:49] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[17:21:49] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/xyrspA
[17:21:49] <ghrust> 13rust/06auto 14ed7e576 15Flavio Percoco: Add a generic power function...
[17:21:49] <ghrust> 13rust/06auto 1454ea434 15bors: auto merge of #11503 : FlaPer87/rust/master, r=huonw...
[17:21:49] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[17:22:07] <eddyb> nmatsakis: oh, you're making me rebase :/
[17:22:36] <eddyb> (time to remove all the explicit borrow/borrow_mut scopes from rustc)
[17:22:50] <cmr> ohhhhhhh that landed.
[17:24:41] <eddyb> I also have to revert put-each-value-in-a-local in wiREd
[17:25:29] *** Quits: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP) (Ping timeout)
[17:27:52] <acrichto> sfackler: ping
[17:28:36] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[17:30:32] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Ping timeout)
[17:32:14] *** Joins: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP)
[17:35:12] <cmr> jack: friendly reminder: https://github.com/mozilla/rust/pull/11086
[17:44:26] <jack> cmr: attempting to rebas eit.
[17:45:24] <acrichto> nmatsakis: ping
[17:48:35] <larsberg> is there a way to set RUST_LOG when rust didn't create the final executable (it's just a library)?
[17:48:36] <kimundi> Ouh, did extended temporary lifetimes land?
[17:48:43] <larsberg> I get "no crate map found"
[17:48:57] <cmr> kimundi: yup!
[17:49:06] <acrichto> larsberg: are you building with --staticlib and then linking it into something else?
[17:49:07] <cmr> larsberg: no, logging is an attribute of binaries
[17:49:10] <larsberg> the problem is on Android, where we have to create a special, more googly binary, and the rest of servo is just a c function we call into
[17:49:12] <kimundi> nice!
[17:49:31] <larsberg> acrichto: no, it's a .so file that we dynamically load
[17:49:41] <acrichto> larsberg: ah, compile the .so with -Z gen-crate-map
[17:49:53] <larsberg> acrichto: fantastic - thanks much!
[17:50:08] <kimundi> hm, what does gen-crate-map do?
[17:50:15] <cmr> acrichto: why don't we do that by default?
[17:50:17] <acrichto> it forces generation of a crate map
[17:50:24] <acrichto> crate maps are only generated by default for executables
[17:50:33] <cmr> conflicts?
[17:50:35] <acrichto> if we generated it by default for dylibs then we'd get conflicts (all dylibs would have one)
[17:50:44] <acrichto> we in theory should do it by default for staticlibs
[17:50:54] <acrichto> b/c staticlibs are the "end of the road"
[17:50:56] <acrichto> like an executable
[17:51:12] <jack> larsberg: we should put that into the android configure somehow
[17:51:17] <jack> or in the makefile
[17:51:22] <larsberg> jack: definitely
[17:51:26] <kimundi> so, a crate map is neccessary for a finished rust binary to run?
[17:51:36] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Input/output error)
[17:51:45] <larsberg> jack: I'm adding a bunch of stuff to the android glue, e.g. cheesy pthreads that redirect the rust logging output to the android log
[17:51:46] <acrichto> jack: larsberg: is there a distinguishing part about this .so's source? I would rather you not have to change the makefiles, it really should be a crate attribute
[17:51:57] <kimundi> including if ts just a standalone dynamic library that gets called by something else?
[17:52:16] <acrichto> kimundi: no a crate map is just necessary to set logging levels and get rustuv I/O
[17:52:31] <kimundi> ah, okay
[17:52:32] <jack> acrichto: can we have conditional attributes?
[17:52:35] <acrichto> it's purely optiona.l, but super nice to have
[17:52:37] <acrichto> jack: sadly no
[17:52:41] <larsberg> acrichto: it's the toplevel crate for servo - on all other platforms, we generate a binary, but on Android we generate a library
[17:52:53] <kimundi> what informations exactly are stored in the crate map?
[17:52:54] <jack> is it bad to include the crate map all the time? :)
[17:53:11] <larsberg> oh, it would do it anyway, since it's the binary :-)
[17:53:11] <acrichto> it depends, if you attempt to link a dylib with a crate map to an executable you'll probably get errors
[17:53:28] <acrichto> so this crate is sometimes compiled as a library and other times as an executable?
[17:54:21] <larsberg> acrichto: yes
[17:54:25] <jack> acrichto: android apps must start from java, so we can't launch a binary. so there is a shim java app that calls a special loader that links libservo
[17:54:34] * acrichto goes to open an issue
[17:54:34] <jack> but all other platforms, we just compile servo to a binary.
[17:54:41] <acrichto> but for now -Z gen-crate-map is what yo uwant
[17:54:47] <acrichto> I would rather it be an attribute though
[17:55:39] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[17:56:15] <acrichto> jack: larsberg: https://github.com/mozilla/rust/issues/11617
[17:58:02] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[18:04:56] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:04:56] *** ChanServ sets mode: +qo brson brson
[18:05:28] <sfackler> acrichto: pong
[18:05:46] <acrichto> sfackler: it appears that the cross-compilation macro tests are failing
[18:05:49] <acrichto> sfackler: http://buildbot.rust-lang.org/builders/snap3-linux/builds/610/steps/test/logs/stdio
[18:05:59] <acrichto> the host compiler is x86_64, but it's running i686 tests
[18:06:13] <acrichto> which means it's compiling an i686 macro crate, but then then x86_64 compiler is attempting to dlopen it
[18:06:18] <sfackler> ah, yeah
[18:06:25] <brson> this is affecting android too
[18:06:39] <acrichto> I think the best solution would be "// force-host" ?
[18:06:48] <sfackler> I think that compiletest will need to be taught to do a //macro-aux:foo.rs
[18:06:51] <sfackler> or that
[18:07:04] <brson> force-host would not work on andoroid, assuming it means what i think
[18:07:15] <acrichto> brson: you're not compiling on android, are you?
[18:07:25] <brson> oh, nvm i think i see what you're getting at
[18:07:27] <acrichto> I thought android cross-compiled from linux
[18:07:29] <sfackler> would force-host apply to the auxilliary crate?
[18:07:34] <brson> yeah, for the aux crate
[18:07:35] <acrichto> yeah
[18:07:37] <sfackler> that's the only one that should need to be compiled for the host
[18:07:41] <acrichto> macro_crate_test.rs would have "// force-host"
[18:07:51] <sfackler> that should do it
[18:07:52] <acrichto> all macro crates should be compiled for the host
[18:07:56] <sfackler> yep
[18:08:24] <sfackler> iirc there are 2 macro crates: macro_crate_test.rs and macro_crate_def_only.rs or something like that
[18:08:25] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[18:08:28] <acrichto> hm, now does compiletest already know that...
[18:08:29] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:08:29] *** ChanServ sets mode: +qo brson brson
[18:08:49] <acrichto> sfackler: oh I was thinking, you shouldn't have to dlopen() to figure out there's only nonprocedural macros
[18:09:05] <sfackler> I believe it only dlopens if there's a macro_registrar function
[18:09:12] <acrichto> oh excellent!
[18:09:16] <acrichto> that's exactly what I would expect
[18:09:32] <brson> feels like bors' queue is progressing very slowly
[18:09:41] <acrichto> bounces?
[18:10:01] <sfackler> acrichto: if the cross compiler thing is blocking a snapshot, feel free to xfail the macro tests and file an issue against me
[18:10:05] <sfackler> and i'll fix them up tonight
[18:10:09] <brson> no, i just expected my pr to be higher up in the list this morning
[18:10:18] <acrichto> sfackler: eh, I'll see if I can fix locally first
[18:10:29] <acrichto> brson: hm, that is kinda odd...
[18:10:41] <acrichto> http://buildbot.rust-lang.org/grid?branch=auto&width=10
[18:10:48] <acrichto> of the last 10 PRs only 3 have landed
[18:10:51] <acrichto> 4*
[18:10:57] <acrichto> that may be why
[18:11:41] <brson> yeah it doesn't seem like the builds are taking that long
[18:13:57] * acrichto is saddened that the codebase is still littered with FIXME(#9639) essentially everywhere
[18:19:36] <larsberg> acrichto: can you think of any reason we'd be getting "'Unhandled condition: io_error: io::IoError{kind: IoUnavailable, desc: "I/O is unavailable", detail: None}'" for code running on ARM but not on x86? (apologies for being vague; ndk-gdb's backtraces when a breakpoint is hit in rust_fail leaves something to be desired)
[18:19:52] <acrichto> larsberg: are you booting with libgreen or libnative?
[18:20:05] <larsberg> acrichto: we start with libnative
[18:20:18] <acrichto> and this is code running from inside of a rust task?
[18:20:29] <larsberg> but create a green SchedPool almost immediately
[18:20:40] <larsberg> yes, it's definitely coming from one of the tasks
[18:20:55] <acrichto> oh do you have RUST_LOG on?
[18:20:58] <larsberg> Constellation is within a green thread
[18:21:19] <larsberg> I have it on but am still getting the error that there is no crate_map despite using the new flag
[18:21:30] <larsberg> (do I need to statically link against the servo library instead of dynamically loading it?)
[18:21:42] <larsberg> I can try turning it off to see if that's doing it...
[18:21:55] <acrichto> could I see the code for booting up?
[18:22:47] <larsberg> the Rust code is: https://github.com/mozilla/servo/blob/master/src/components/main/servo.rc#L120-L174
[18:22:58] <acrichto> oh man a .rc extension
[18:23:05] <larsberg> like a time machine :-)
[18:23:30] <acrichto> oh!
[18:23:53] <acrichto> do you know which task this is happening on?
[18:24:04] <acrichto> librustuv provides all I/O, so librustuv may not be getting into the crate map
[18:24:14] <larsberg> Constellationat least
[18:24:16] <acrichto> oh wait that's it
[18:24:19] <acrichto> "extern mod rustuv"
[18:24:23] <acrichto> you want libuv-based I/O
[18:24:29] <larsberg> (couple of others)
[18:24:52] <acrichto> although rustuv should get injected...
[18:25:19] <acrichto> the crate map needs to bet set up right in order to get rustuv injected
[18:26:08] <larsberg> so as long as I'm still seeing errors about RUST_LOG not working due to a missing crate map, we should expect to see this?
[18:26:18] <acrichto> hm, no that crate map should be there
[18:26:35] <acrichto> although I've never created a crate map in a dylib, so perhaps that's broken
[18:26:50] <acrichto> no it should work...
[18:27:02] <acrichto> brson: sfackler: currently testing https://github.com/alexcrichton/rust/commit/47bdd67a036ba708b28761c6032579521fc92a03
[18:27:11] <acrichto> gotta build an i686-apple-darwin llvm apparently
[18:28:37] <acrichto> larsberg: so you're sure that -Z gen-crate-map is passed when building the .so?
[18:29:02] <larsberg> acrichto: I'll double-check with verbose on...
[18:29:32] <acrichto> oh wow llvm bulids finish semi-quickly now that we're not building literally everything from LLVM
[18:29:57] *** Quits: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP) (Ping timeout)
[18:30:39] *** Joins: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP)
[18:31:37] <brson> acrichto: what did we cut out?
[18:31:52] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[18:31:55] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:31:55] *** ChanServ sets mode: +qo brson brson
[18:32:00] <acrichto> brson: https://github.com/mozilla/rust/commit/62fbd00bed6ec435b52f03525c48f95d5fce8abd
[18:32:20] <acrichto> brson: we were basically building the whole test suite I think along with lots of tools which we never used (dwarfdump/objdump/etc)
[18:32:20] <larsberg> acrichto: yes, we're definitely passing -Z gen-crate-map when creating the final binary with --lib
[18:32:46] <acrichto> larsberg: can you run 'nm -g' over the .so and see if something called "rust_crate_map_toplevel" is there?
[18:33:04] <brson> acrichto: neat!
[18:33:36] <acrichto> brson: yeah technically we don't need to build any tools at all, but those tools listed are "quick to build" and I use most of them pretty frequently
[18:34:55] <larsberg> acrichto: yup "002d9010 D _rust_crate_map_toplevel" https://gist.github.com/larsbergstrom/8478915
[18:35:37] <brson> acrichto: is llvm-ar equivalent to ar?
[18:35:44] <brson> i.e. can we package it on windows?
[18:35:51] <acrichto> brson: I've never used it, but from what I've seen, yes
[18:36:17] <acrichto> larsberg: hm... so the crate map is discovered through a weak symbol, so this may mean that weak symbols don't work on android?
[18:36:48] <larsberg> acrichto: possible - there's a lot of stuff missing on android, even posixy stuff (e.g., pthread_cancel)
[18:37:12] <acrichto> brson: have you ever had logging work on android before?
[18:37:15] <larsberg> not that I'm the sort of person of dubious character that would call pthread_cancel
[18:37:21] <acrichto> lol
[18:37:39] <larsberg> acrichto: I get the same failure even when I do not set RUST_LOG
[18:38:01] <acrichto> larsberg: I think that's b/c rustuv isn't getting discovered from the crate map
[18:38:14] <acrichto> larsberg: so it's falling back to a "simple event loop" which provides no I/O
[18:38:35] <acrichto> wait no weak symbols must work
[18:38:37] <brson> acrichto: i've not tried. i do think i recently xfailed some i/o related test on android
[18:38:42] <acrichto> if libgreen has ever worked then this should work
[18:39:10] <brson> oh that may have just been a bind test
[18:39:18] <acrichto> yeah no weak symbols definitely work
[18:39:29] <acrichto> although maybe not if you dlopen the crate?
[18:39:52] <acrichto> larsberg: how much of a debugger do you have?
[18:40:03] <larsberg> ndk-gdb... it occasionally works :-)
[18:40:13] <larsberg> it's basically gdb but gives a lot more errors and gives up early
[18:40:19] <acrichto> larsberg: if you can gbreak on the get_crate_map() function inside of std::rt::crate_map, you may be able to see what it thinks the crate map is
[18:42:01] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[18:44:14] <acrichto> brson: out of curiosity, do we want to think about moving to mingw-w64 during this release cycle?
[18:46:12] <Luqman> acrichto: afaik the weak symbols stuff only worked with ndk >= android-18
[18:46:38] <brson> acrichto: yes
[18:46:49] <acrichto> larsberg: hm, how recent is that?
[18:46:51] <brson> i would like to get windows taken care of for 0.10
[18:46:59] <brson> as well as unix binary installers
[18:47:17] <larsberg> acrichto: we're the revision of rust before @-removal, I believe (currently forked to pick up a debug-info fix)
[18:47:24] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[18:47:24] <ghrust> 01[13rust01] 15cmr 04force-pushed 06try from 1462faac5 to 14d538c18: 02http://git.io/k471pw
[18:47:24] <ghrust> 13rust/06try 14461ae48 15Corey Richardson: Use `mmap` to map in task stacks and guard page...
[18:47:24] <ghrust> 13rust/06try 14b222c3e 15Corey Richardson: Update task-perf-one-million
[18:47:24] <ghrust> 13rust/06try 14d538c18 15Corey Richardson: Add benchmarks
[18:47:26] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[18:47:35] <acrichto> larsberg: oh how recent is android-18
[18:47:44] <acrichto> brson: I am excite
[18:47:45] <Luqman> android 4.3
[18:47:52] <Luqman> is api level 18 i believe
[18:48:00] * acrichto knows almost nothing about android
[18:48:03] <acrichto> what are they on right now?
[18:48:08] <Luqman> 4.4
[18:48:16] <acrichto> ah, so very recent
[18:48:23] <larsberg> Luqman: acrichto: I believe I'm building on and running on 18 (nexus 7 target device)
[18:48:34] <larsberg> but I should recheck - some of the build files from samsung are hardcoded to android 14
[18:48:39] <larsberg> maybe that's getting us...
[18:48:49] <larsberg> Luqman: ty :-)
[18:48:57] <brson> larsberg: you are using real hardware??
[18:49:03] <brson> good luck
[18:49:28] <larsberg> brson: yup! the emulator was giving me fits so I begged azita to let me get a nexus7 since they're like $240
[18:49:43] <Luqman> larsberg: yea, there's some info on this here https://github.com/mozilla/rust/issues/9120
[18:49:51] <larsberg> even with a large enough file size, etc, just doing "adb install ServoAndroid.apk" would die 2 in 3 times
[18:50:11] <brson> i'm imagining that real hardware has different properties regarding memory consistency than the emulator
[18:51:26] <larsberg> brson: so, you're basically saying that you expect everything to work perfectly once I get past this? :-)
[18:55:47] <brson> lol
[18:57:16] <acrichto> cmr: "This is possibly the highest comment/code ratio I have ever seen." hahaha
[18:57:19] <acrichto> not sure if that's good or bad
[19:02:31] <brson> acrichto: where is that?
[19:02:33] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[19:02:33] *** ChanServ sets mode: +ao dherman dherman
[19:02:43] <acrichto> brson: the new mutex commit
[19:03:53] <acrichto> brson: sfackler: https://github.com/mozilla/rust/pull/11618
[19:05:13] <erickt> brson: good morning! Sorry I had to run yesterday. Did you have any other questions for me?
[19:06:41] <brson> erickt: i'm curious to hear your thoughts about rust build systems and their package manager integration, so i can have a better idea of the big picture. right now though i have a meeting to attend
[19:06:52] <erickt> np
[19:09:45] <cmr> acrichto: it's definitely good.
[19:10:06] <cmr> but imagine if the rest of the stdlib needed that kind of documentation
[19:10:09] * cmr *shudder*
[19:27:01] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Connection reset by peer)
[19:27:07] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[19:27:07] *** ChanServ sets mode: +ao dherman dherman
[19:27:44] <steveklabnik> psssh
[19:27:49] <steveklabnik> of course it needs that kind of docs ;)
[19:30:41] <sfackler> acrichto: why isn't macro_crate_test.rs xfail-android as well?
[19:31:07] <acrichto> sfackler: you should be able to build macro_crate_test for the host and then compile a target binary which uses that for syntax extensions
[19:31:22] <acrichto> the phase test just needed to *also* link against the host version of the macro_crate_test
[19:31:30] <sfackler> oh right
[19:31:35] <sfackler> lgtm
[19:42:07] <acrichto> brson: steveklabnik: just in case you guys hadn't seen it already, this is pretty slick: https://gobyexample.com/
[19:44:27] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Client exited)
[19:44:33] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[19:44:33] *** ChanServ sets mode: +ao dherman dherman
[19:52:00] <steveklabnik> acrichto: brson up, if i could make a clone of me i'd have done this already
[19:52:04] <steveklabnik> :(
[19:52:09] <steveklabnik> unfortunately i am mutable
[19:52:15] <acrichto> noooo
[19:52:17] <steveklabnik> heh
[19:52:39] *** Quits: new_one (new_one@A30FB7D1.8BFB2575.B3C0173E.IP) (Client exited)
[20:01:09] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[20:02:07] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[20:02:07] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1454ea434 to 144098327: 02http://git.io/N3iJvQ
[20:02:07] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[20:02:09] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[20:02:09] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/hW7P-Q
[20:02:09] <ghrust> 13rust/06auto 14295b46f 15Alex Crichton: Tweak the interface of std::io...
[20:02:09] <ghrust> 13rust/06auto 149bf85a2 15bors: auto merge of #11598 : alexcrichton/rust/io-export, r=brson...
[20:02:09] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[20:07:35] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[20:07:36] *** ChanServ sets mode: +o tjc
[20:09:26] *** Joins: notmatt (notmatt@318A02F5.68FFFFA3.47C41102.IP)
[20:13:29] <brson> i just rejected a rust-dev post from somebody complaining about the performance of the rust game
[20:13:33] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[20:14:13] *** Quits: notmatt (notmatt@318A02F5.68FFFFA3.47C41102.IP) (Connection reset by peer)
[20:14:31] *** Joins: notmatt (notmatt@318A02F5.68FFFFA3.47C41102.IP)
[20:25:12] <acrichto> brson: haha
[20:25:23] <acrichto> at some point those posts will start to decline
[20:25:26] <acrichto> hopefully...
[20:26:44] <cmr> ... maybe
[20:27:19] <cmr> the game does perform pretty poorly
[20:27:25] <cmr> it'd clearly be better if it were written in rust
[20:27:27] <brson> what can we do to sabbotage this game?
[20:27:34] <brson> make it go away
[20:27:37] * cmr plays it
[20:28:29] <acrichto> brson: I think a more reasonable course of action would be to rename the languge
[20:29:02] <brson> lol
[20:29:27] *** Joins: nrc|afk (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[20:29:59] <jack> brson: it's free to play so i assume it will die eventually.
[20:30:05] <cmr> jack: no it's not
[20:30:27] <jack> cmr: hmm. is there another game like that that is free to play that i am confusing it with?
[20:30:42] <jack> I should go onto the steam forums and start asking borrow checker questions.
[20:31:12] <cmr> !!
[20:31:16] <cmr> that is the best path forward.
[20:31:22] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[20:31:29] <cmr> jack: dunno
[20:31:36] <cmr> I don't know of anything else called rust
[20:32:42] *** Joins: gwty (gwtypc@7A0D763F.F5B21253.553D87E5.IP)
[20:32:54] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[20:32:57] <jack> cmr: i think i was thinking of path of exile
[20:33:23] *** Quits: gwty (gwtypc@7A0D763F.F5B21253.553D87E5.IP) (Connection reset by peer)
[20:35:42] <tjc> pay off the game makers to rename their game to something else :-)
[20:35:49] <tjc> such as "Go"
[20:37:31] <kimundi> "Rust and Go"
[20:38:02] <kimundi> ... that sounded funner in my head
[20:38:24] <cmr> "Go and Rust" is more assertive :p
[20:38:37] <jack> maybe we can get these confused people to pay us $20 a pop for our language.
[20:38:51] <tjc> heh
[20:39:02] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[20:39:06] <tjc> who says you can't make money selling a compiler? You can, as long as you convince people it's a video game.
[20:39:20] *** Joins: new_one (new_one@2D115045.D0485D2E.B3C0173E.IP)
[20:39:23] <cmr> QOTW right there
[20:39:43] <tjc> "It's a text-based adventure where you fight a monster called the Borrow Checker by typing cryptic symbols like ~ and @"
[20:39:46] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[20:39:49] <jack> Isn't it one? It's kind of like a text adventure where you have to discover memory safety in your dumb, broken program.
[20:39:51] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[20:39:57] <tjc> exactly
[20:40:18] <eddyb> cmr: someone nominated something else in #rust, yesterday or so
[20:40:23] <cmr> eddyb: I got it
[20:40:56] <cmr> "eddyb> who needs pure functional when you have pure cool?"
[20:40:56] <jack> You have been eaten by a dynamically sized type.
[20:41:03] <tjc> jack++
[20:41:23] <tjc> also, no refunds if you see the words "Internal compiler error", it just means the monsters won
[20:41:31] <jack> PLACATE BORROWCK
[20:41:45] <jack> You have found an internal compiler error. YOU WIN!
[20:41:48] <tjc> heh
[20:42:06] <tjc> this could be a good way to outsource fuzz testing without having to rewrite the fuzzer ;-)
[20:42:49] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Ping timeout)
[20:42:50] <jack> The cave is dark an damp. The cackles of deranged programming language designers echo off every surface. There is a sigil on the floor.
[20:43:24] *** Joins: bytewise (bytewise@moz-4B2383CA.adsl.alicedsl.de)
[20:43:28] <larsberg> "You are in a nondescript text file of nondescript size. Pointers are named north, south, and west. Oh, and there's a Borrowck over there in the corner." 
[20:43:40] <jack> Written in blood on the far wall you see 'r-'.
[20:44:21] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[20:44:37] <larsberg> acrichto: moving the toolchain to android-18 sadly did not change anything
[20:44:58] <larsberg> also, still getting "warning: RUST_LOG set, but no crate map found." at startup
[20:45:03] <larsberg> which leads me to think it's not working
[20:45:06] <larsberg> maybe a grue ate it?
[20:45:16] <eddyb> cmr: heh. I wasn't sure it was me, I didn't remember who said and what was said :P
[20:45:48] <eddyb> larsberg: s/grue/internal symbol stripper
[20:46:09] * jack MOVE NORTH
[20:46:17] <jack> error: Use of already moved value, north.
[20:46:27] <larsberg> lol
[20:46:27] <jack> GO NORTH
[20:46:36] <jack> error: Go is not a systems programming language.
[20:46:49] <eddyb> haha, I was going to make a war in the north reference, but this is much better
[20:46:52] <jack> WALK NORTH
[20:47:02] <jack> error: The tree is infinite. You starve. YOU LOSE.
[20:47:28] <eddyb> #minecraft has a shittyIRCquotes subreddit, we need something similar to hold all of this goodness
[20:47:28] <larsberg> eddyb: before we were thinking the crate map problem might be related to weak symbols
[20:47:46] <eddyb> larsberg: hmm, or that
[20:48:15] <larsberg> but supposedly it works in android-18 ( #9120 )
[20:48:27] <larsberg> #rust-internals needs its own version of crowbot :-)
[20:48:29] <eddyb> go NeMo each intermediary object
[20:48:43] <eddyb> and see where it's gone
[20:49:35] <kimundi> eddyb: http://quotes.burntelectrons.org/
[20:50:19] <kimundi> http://quotes.burntelectrons.org/search?query=rust
[20:50:28] <larsberg> eddyb: https://gist.github.com/larsbergstrom/8478915 _rust_crate_map_toplevel seems to be there
[20:50:41] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Ping timeout)
[20:50:43] <larsberg> (assuming that's what you meant)
[20:50:56] <cmr> Edwards: what is NeMo?
[20:51:21] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[20:51:31] <cmr> eddyb: what is NeMo?
[20:51:39] <eddyb> cmr: what does "nm" come from?
[20:51:44] <larsberg> I was guessing he meant "use nm"
[20:51:49] <eddyb> oh, "name", I'm an idiot
[20:51:50] <cmr> ah
[20:51:56] <cmr> :P
[20:52:41] <eddyb> erickt: I didn't trust myself enough to rewrite typeck to have self as another argument *without* changing semantics
[20:52:49] <acrichto> larsberg: if you can recompile libstd, there's a cfg(windows) in src/libstd/rt/crate_map.rs, switch that to android as well and see if it works possibly?
[20:53:28] <eddyb> erickt: (I'm put this in github tomorrow, I'm not around for long now) also, if you miss something somewhere, libstd throws 5000+ errors at you
[20:54:25] <eddyb> *I'll put
[20:55:02] <larsberg> acrichto: will do!
[20:56:15] <eddyb> erickt: also, ExprCall/ExprMethodCall makes the distinction well enough - I only wish the only difference would be expr (Call) / method name (MethodCall) (the function to call) - MethodCall and all overloadable ops have a "callee_id" which is used to attach resolution information to, by typeck
[20:57:03] <eddyb> I have to rebase some silly stuff now :S
[20:57:11] <erickt> eddyb: :)
[20:57:38] <erickt> eddyb: I admire what you've done. I actually tried to do this a couple months ago and failed completely at it
[20:57:55] <cmr> eddyb: yes, you're doing truly great work
[20:58:11] *** Quits: notmatt (notmatt@318A02F5.68FFFFA3.47C41102.IP) (Client exited)
[20:58:25] <eddyb> oh, you guys make me blush, you're too nice :">
[20:59:16] <cmr> well, most of it is that it's awful work that takes forever and is tedius :p
[20:59:21] <cmr> but it's important and needs to be done.
[21:00:49] <eddyb> erickt: we may fail some battles
[21:01:06] <eddyb> but we will never lose 04:)
[21:02:38] <eddyb> nmatsakis: oh dear, you've changed the types of function arguments I've removed... this will be fun
[21:03:01] <erickt> eddyb: those args[0] do make me feel icky though. I wish there was some other way to isolate that weirdness
[21:04:01] <eddyb> erickt: they should be gone eventually
[21:04:14] <eddyb> do you want me to spend another week rewriting typeck?
[21:04:55] <eddyb> applying autoref (but not auto-mut-ref) to any argument would be a good reason to simplify that nonsense
[21:06:56] <acrichto> rusti: version
[21:06:58] -rusti- "rustc 0.10-pre (db7b9a3 2014-01-15 02:09:57 -0500)"
[21:07:12] <erickt> eddyb: naw, I think it's okay for now
[21:07:13] <acrichto> hm, I still can't do "let foo = slot.borrow().get()"
[21:07:25] <acrichto> ah, nvmd
[21:08:04] <erickt> eddyb: I'd rather have your stuff merged in and then follow on with cleanup
[21:08:17] <erickt> eddyb: and maybe universal function call syntax :)
[21:08:24] *** bstrie_disappeared is now known as bstrie_reappeared
[21:08:44] <eddyb> erickt: UFCS (call a method as a function) is a matter of allowing it resolve, I think
[21:08:48] <eddyb> and/or typeck
[21:09:03] <eddyb> *it in resolve
[21:10:20] <eddyb> nmatsakis: can we have impl<'a> ImmDeref<'a, Ref<'a>> for RefCell and impl<'a> MutDeref<'a, RefMut<'a>> for RefCell? I know there's an issue blocking that fancy use of lifetimes in traits, but (along with rewriting the overloaded op traits to support it) I feel we should have it
[21:10:22] <erickt> eddyb: I expect it wouldn't be *that* hard to do. I just found trans to be inscrutible and couldn't get all the edge cases working
[21:10:28] *** Quits: lkuper (lkuper@moz-6881CCA2.dhcp-bl.indiana.edu) (Quit: lkuper)
[21:11:16] <eddyb> nmatsakis: I could see let p = Rc::new(RefCell::new(Point {x: 0, y: 0})); p.x += p.y; work :D
[21:12:03] <eddyb> let p: RcMut<Point> = box Point {x: 0, y: 0}; too, but that's another sugar
[21:13:00] <eddyb> (well, maybe it wouldn't work if the lifetimes are extended, but I hope it's obvious what I meant there)
[21:14:19] <eddyb> who is glaebhoerl on IRC? I'd like a more direct discussion instead of dragging out something on github
[21:16:02] <cmr> glaebhoerl
[21:16:10] <cmr> they're around most of the time.
[21:16:40] <eddyb> oh, okay, though I don't remember seeing that nickname 
[21:17:54] *** Joins: gwty (gwtypc@5A4087AB.C4444A44.137C914F.IP)
[21:20:51] *** Joins: geoffhill (geoffhill@moz-738DC0DB.org)
[21:21:51] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[21:21:51] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/hW7P-Q
[21:21:51] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[21:21:59] *** Quits: gwty (gwtypc@5A4087AB.C4444A44.137C914F.IP) (Ping timeout)
[21:26:28] <bjz> is there an issue open re. CTFE?
[21:26:40] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[21:26:40] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/TqCA_w
[21:26:40] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[21:26:45] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[21:26:45] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/XiGzEg
[21:26:45] <ghrust> 13rust/06auto 143e51c8a 15Florian Hahn: Replace C types with Rust types in libstd, closes #7313
[21:26:45] <ghrust> 13rust/06auto 14b72697b 15bors: auto merge of #10943 : fhahn/rust/issue-7313-replace-c-types, r=brson...
[21:26:45] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[21:28:24] *** Joins: gwty (gwtypc@5A4087AB.C4444A44.137C914F.IP)
[21:28:58] <bjz> I can't seem to find one open when I search for it in the issues
[21:29:12] <bjz> (need to refer to it in a FIXME)
[21:29:24] <bjz> dbaupp cmr: any idea?
[21:29:58] <cmr> bjz: my browser history has nothing helpful.
[21:30:36] <bjz> ok, I'll add one
[21:30:52] <bjz> surprised on isn't there already
[21:36:03] <nmatsakis> eddyb: I was planning on reading your PR, yep. (#11595)
[21:36:44] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[21:36:45] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14b72697b to 149bf85a2: 02http://git.io/N3iJvQ
[21:36:45] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[21:36:45] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[21:36:45] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/xVA5Nw
[21:36:45] <ghrust> 13rust/06auto 1411dcd9a 15Alex Crichton: Don't run 'ar s' on OSX...
[21:36:45] <ghrust> 13rust/06auto 14aa67e13 15bors: auto merge of #11604 : alexcrichton/rust/issue-11162, r=brson...
[21:36:46] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[21:37:00] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[21:37:07] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[21:37:21] <eddyb> nmatsakis: \o/ - expect a completed rebase by tomorrow - also take a look at my recent comment about traits with lifetime parameters
[21:41:10] <nmatsakis> eddyb: the one relating to ImmDeref etc?
[21:42:26] <eddyb> yupp
[21:45:35] <jack> cmr: https://github.com/mozilla/rust/pull/11086
[21:47:53] *** Quits: luz (lucy@moz-CD18B14B.customer.cdi.no) (Ping timeout)
[21:54:15] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[21:58:19] <bjz> r? https://github.com/mozilla/rust/pull/11622
[22:00:55] *** bstrie_reappeared is now known as bstrie_disappeared_again
[22:06:24] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[22:06:24] *** ChanServ sets mode: +ao dherman dherman
[22:06:51] *** Quits: rca (rcatolino@22E42357.20117C61.520D6FA6.IP) (Ping timeout)
[22:08:36] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[22:10:17] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[22:12:30] *** Joins: luziie (lucy@moz-CD18B14B.customer.cdi.no)
[22:15:01] <bjz> rebased:  https://github.com/mozilla/rust/pull/11622
[22:15:05] <bjz> acrichto: ^?
[22:15:38] *** nrc|afk is now known as nrc
[22:16:07] *** Quits: gwty (gwtypc@5A4087AB.C4444A44.137C914F.IP) (Ping timeout)
[22:18:54] <nrc> hmm, so |let mut x ...| is that just sugar for shoving 'mut' somewhere in the type of x?
[22:19:46] <nrc> and if the type is inferred, what happens to the mutability? Just a constraint on the inference and the ast pretends it never existed?
[22:20:44] <kimundi> nrc: "mut" on a pattern is a binding modifier - it doesn't change anything of the type directly
[22:21:42] <kimundi> let x = foo(); means you may not mutate the value of that variable through the binding "x", let mut x = foo(); means you can mutate the variable through the binding "x"
[22:23:00] <nrc> kimundi: but looking at the ast code, there is no knowledge of whether there is a 'mut' or not, other than in the type (as opposed to statics), so how doe sthe compiler know?
[22:23:46] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[22:24:00] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[22:24:11] <kimundi> Oh, no idea about that :P But obviously he knows somehow, or else it wouldn't work :D
[22:24:52] <new_one> in an enum matching pattern, is there a way to find id's of the variants being matched?
[22:25:10] <new_one> where I'm trying to find out: http://git.io/ARk7bw
[22:30:14] *** Joins: ecr (chatzilla@moz-1FE08DA0.dhcp4.washington.edu)
[22:30:39] <brson> nrc: the mutability in the ast appears to be included in Pat (BindingMode)
[22:30:56] <brson> i.e. 'mut' is part of a pattern, not 'let'
[22:32:23] <nrc> new_one: ast_util::variant_def_ids might help
[22:32:39] <acrichto> bjz: do we really want to define asin in libstd?
[22:32:50] <bjz> acrichto: not sure
[22:33:01] <acrichto> bjz: these all seems like excellent candidates to libnum
[22:33:05] <nrc> brson: thanks, that looks to what I want
[22:33:07] <bjz> acrichto: yeah?
[22:33:09] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[22:33:13] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[22:33:14] <acrichto> bjz: I'd expect libnum to depend on libm
[22:33:49] <bjz> acrichto: this is how it's shaping up btw: https://github.com/bjz/num-rs/tree/master/src
[22:34:21] <acrichto> man that is fancy
[22:34:25] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[22:34:30] <acrichto> fn lcm(&self) -> Self
[22:34:30] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[22:34:32] <acrichto> what
[22:34:34] <cmr> ah the warning police.
[22:34:37] <bjz> acrichto: I've moved the 'bottom' of the numeric tower to a separate module. I think that would make it less intimidating
[22:34:38] <cmr> my good friends.
[22:34:39] <acrichto> fn gcd(&self) -> Self?
[22:35:10] <acrichto> pub trait AdditiveMagma
[22:35:12] <new_one> nrc: thanks, will look
[22:35:14] <acrichto> bahaha I love that name
[22:35:18] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[22:35:18] *** ChanServ sets mode: +ao dherman dherman
[22:35:21] <acrichto> I'm not mathy at alll any more, but that's awesome
[22:35:25] <bjz> acrichto: LCM: lowest common multiple, GCD: greatest common divisor
[22:35:38] <acrichto> bjz: but lcm/gcd of &self is always self?
[22:35:39] <bjz> acrichto: useful for rationals
[22:35:45] <acrichto> bjz: I figured you'd have an argument?
[22:36:15] <bjz> acrichto: not sure - that could be debated. I think there are generalisations for those, but they are usually for integers
[22:36:29] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Ping timeout)
[22:36:53] <acrichto> bjz: LCM(x), that's always x, right? (for integers)
[22:37:11] <bjz> acrichto: I think `AdditiveMagma` could probably be called `AdditiveClosure`
[22:37:37] <acrichto> bjz: http://www.youtube.com/watch?v=UNJU-5vCrJc
[22:38:10] <bjz> acrichto: LCM and GCD take two arguments
[22:38:17] <bjz> http://en.wikipedia.org/wiki/Least_common_multiple
[22:38:24] <acrichto> bjz: so why do they only take one on your trait?
[22:38:39] <bjz> if they do - woops
[22:38:45] <acrichto> ah ok :P
[22:38:56] <bjz> HAH
[22:39:00] <bjz> me so silly
[22:39:15] <bjz> they should be an associated function too, not a method
[22:39:30] <bjz> seeing as there is no obvious `self`
[22:40:26] * bjz wishes there was a way of parameterising traits like: Group<Mul>
[22:41:09] <bjz> trait Group<BinOp> - or something
[22:42:08] <acrichto> what is linux-vdso.so.1
[22:42:30] <ecr> why on earth could you call it a Closure when you could call it a Magma
[22:42:41] <bjz> trait Group<BinOp>: Monoid<BinOp> + Inv<BinOp>
[22:42:59] <ecr> i mean, yeah, the property it encompasses is closure 
[22:43:04] <ecr> but come on. magma
[22:43:11] <bjz> ecr: because I haven't seen the name used all that widely
[22:43:33] <ecr> you and your sensibleness
[22:43:37] <bjz> :P
[22:44:27] <ecr> if i can't scare people with crazy math terms then talking just isn't worth it anymore
[22:44:38] <bjz> heh
[22:46:10] <bjz> ecr: the idea is that the average joe shouldn't usually have to deal with those definitions, only lib developers. It would need improvements to rustdoc though, so that when you look at the `Real` trait it'd show inherited methods from supertraits
[22:46:30] <bjz> so you wouldn't have to go hunting through the algebra stuff
[22:46:56] <ecr> oh are you revising the numeric hierarchy?
[22:47:20] <bjz> ecr: well, simplifying std, which is currently a mess of compromise
[22:47:29] <bjz> I mean, std::num
[22:47:32] <ecr> it'd be pretty neat to get a proper algebraic tower, but i doubt people would go for it
[22:47:55] <ecr> i'm always on the side of more math, but i'm certainly in the minority
[22:48:20] <bjz> ecr: well again, I wouldn't want people to be intimidated, which is a very real issue
[22:48:37] <bjz> ecr: hence the above things I said
[22:48:49] <ecr> definitely. most people just aren't ready for that
[22:49:13] <bjz> you should be able to just do fn foo<T: Real>(x: T) -> T { ... }
[22:49:19] <bjz> for example
[22:49:49] <ecr> right
[22:50:11] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[22:50:26] <bjz> ecr: but again, the docs should be able to show inherited stuff, like the scaladocs do
[22:50:30] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[22:50:39] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[22:50:39] *** ChanServ sets mode: +ao dherman dherman
[22:50:52] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[22:51:32] <bjz> ecr: you don't want to go on a huge journey through abstract algebra to find that Real inherits Mul
[22:51:38] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[22:51:38] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/xVA5Nw
[22:51:38] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[22:51:41] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[22:51:41] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Broken pipe)
[22:51:50] <ecr> bjz: haha
[22:51:53] <ecr> I guess
[22:52:39] *** Quits: c-a (c-a@moz-57C82A9.a163.priv.bahnhof.se) (Quit: Ex-Chat)
[22:54:23] <ecr> it'd be kind of neat to make a quickcheck port, add property tests to the numerical hierarchy for algebraic properties, and then automatically have tests for implementations of the traits
[22:54:28] <bjz> yes
[22:54:32] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:54:40] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:54:48] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:54:55] <bjz> one idea I had was things like fn asser_mul_is_commutative
[22:55:13] <bjz> I mean, `fn assert_mul_is_commutative`
[22:55:27] <ecr> well it's not always commutative
[22:55:33] <bjz> yes
[22:55:51] <bjz> it would be: `fn assert_mul_is_commutative<T: CommutativeAdd>
[22:56:01] <ecr> ah ok
[22:56:14] <bjz> https://github.com/bjz/num-rs/blob/master/src/ops.rs
[22:56:20] <bjz> :)
[22:56:40] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[22:56:40] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/zkBseA
[22:56:40] <ghrust> 13rust/06auto 14363fa51 15Jack Moffitt: Use the libsyntax PkgId parser in Rustpkg, but keep Rustpkg's version smarts....
[22:56:40] <ghrust> 13rust/06auto 14f7088ed 15Jack Moffitt: Change some rustpkg tests to use new crate_id syntax.
[22:56:41] <ghrust> 13rust/06auto 147fb712e 15Jack Moffitt: Warning police.
[22:56:42] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[22:56:44] <ecr> hm, i shall take a look
[22:56:45] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[22:56:45] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/bvpsfg
[22:56:45] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[22:57:08] <bjz> ecr: please don't hesitate to give feedback/critique
[22:57:44] <ecr> bjz: first thing I noticed - addition on floats isn't associative
[22:57:49] <bjz> yes
[22:57:59] <bjz> that is definitely an issue
[22:58:03] <ecr> but it implements AssociativeAdd
[22:58:07] <bjz> dunno how to deal with that
[22:58:10] <ecr> yeah
[22:58:16] <ecr> i've tried to come up with solutions
[22:58:29] <ecr> haven't found a good one beyond telling people to get over it
[22:58:33] <bjz> always going to be an issue with numeric libs
[22:58:44] <bjz> :(
[22:58:57] <strcat> what's the point in the traits if they don't guarantee anything though?
[22:59:26] <ecr> i used to make fun of Ocaml for having different operators for FP ops, but that would actually work pretty well if you want to guarantee properties
[22:59:32] <bjz> yeah
[22:59:49] <bjz> ecr: SML is like that too
[23:00:02] <ecr> bjz: I thought so but I wasn't sure
[23:00:17] <bjz> same with == I think
[23:00:29] <ecr> I think we'd probably have a mutiny if we tried to do something similar with Rust though
[23:00:35] <bjz> floats don't impl == in SML I think
[23:00:39] <bjz> yeah :/
[23:01:05] <bjz> ecr: and IEEE conformance
[23:01:19] <strcat> bjz: hm?
[23:01:28] <strcat> IEEE conformance isn't relevant to traits
[23:01:40] <bjz> strcat: does IEEE require a == operator?
[23:01:49] <strcat> IEEE isn't a language spec
[23:01:51] * bjz isn't familiar with the specifics
[23:02:07] <strcat> IEEE754 describes the operations
[23:02:09] <bjz> strcat: well, I mean an equality function
[23:02:15] <strcat> you could treat it as a hardware spec or a software one
[23:02:24] <strcat> bjz: it doesn't mandate language stuff
[23:02:33] <ecr> from wikipedia:
[23:02:37] <ecr> IEEE operations are
[23:02:49] <bjz> ecr: linky as well?
[23:02:58] <ecr> https://en.wikipedia.org/wiki/IEEE_floating_point
[23:03:01] <ecr> operations section
[23:03:15] <ecr> it requires comparisons and total ordering
[23:03:20] <strcat> ecr: none of which is mandated as part of a language via operators
[23:03:25] <ecr> right
[23:03:28] <ecr> i know
[23:03:39] <strcat> anyway it doesn't 'require' them
[23:03:45] <strcat> it just says 'here is how you would implement X'
[23:03:49] <bjz> oh ok
[23:03:58] <ecr> yeah
[23:04:15] <ecr> but I think we might upset some people if we didn't add equality for floats
[23:04:19] <ecr> just a little bit
[23:04:28] <ecr> :P
[23:04:29] <bjz> how would all this affect generic impls though - seeing as we don't have overloading and or specialization?
[23:05:20] <ecr> hm
[23:05:37] <strcat> ecr: including equality and implementing Eq are too different things
[23:05:44] <strcat> two*
[23:05:47] <ecr> strcat: very true
[23:05:56] <bjz> this is a super important issue that could become emotionally charged quite easily
[23:06:02] <strcat> I think people will be upset that we have both TotalEq and TotalOrd
[23:06:07] <strcat> it's really hard to know what you should use
[23:06:12] <strcat> Eq/Ord doesn't have requirements
[23:06:16] <bjz> yeah
[23:06:21] <strcat> so really doesn't ever make sense to use Eq/Ord bounds
[23:06:24] <strcat> so why have traits?
[23:06:31] <strcat> like, hashmap uses Eq
[23:06:36] <strcat> but it really needs TotalEq
[23:06:47] <strcat> or you can insert the same key N times and it will make new buckets
[23:06:49] <strcat> which is really bad
[23:06:58] <ecr> right
[23:07:00] <bjz> what kind of impact would that kind of thing have on performance?
[23:07:17] <strcat> bjz: inserting a key N times?
[23:07:27] <strcat> they all hash to the same value but don't compare equal (NaN)
[23:07:31] <strcat> it's a DoS attack vector
[23:07:33] <bjz> using the Total comparisons
[23:07:42] <strcat> bjz: for floats? they're not implemented in hardware
[23:07:48] <strcat> probably hundreds of times slower
[23:07:52] <strcat> at least
[23:08:07] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[23:08:09] <bjz> what about for ints
[23:08:11] <strcat> floats as keys in hash tables isn't necessary though
[23:08:14] <strcat> bjz: same speed
[23:08:24] <strcat> bjz: same speed for ints, strings, sequences of TotalEq things, etc.
[23:08:32] <strcat> bjz: TotalOrd is faster than Ord in general
[23:08:35] <strcat> for example with a string
[23:08:37] <strcat> because you can have
[23:08:38] <bjz> ah noce
[23:08:41] <bjz> *nice
[23:08:43] <ecr> you'd have to define your own partial Eq on ints. newtype wrappers, etc.
[23:08:48] <strcat> cmp -> Equal | Less | Greater
[23:08:53] <ecr> if you wanted a nontotal version
[23:09:05] <strcat> and then in a tree for example, you can do 1 string compare and branch
[23:09:12] <strcat> rather than ~1.5 on avg
[23:09:30] <bjz> If we were going to go the opinionated route, it would be extremely important to document the rationales
[23:09:32] <ecr> Ord is still pretty useful though. partial orderings are ALL over the place in CS
[23:09:32] <strcat> ecr: you wouldn't *need* a partial Eq though
[23:09:43] <strcat> ecr: where? ;p
[23:10:05] <strcat> anyway I don't see the point of having Eq where a == a isn't upheld
[23:10:25] <strcat> or Ord where there's not much of a connection to ordering/equality invariants you'd expect
[23:10:38] <bjz> so == makes sense for things like ints and bools?>
[23:10:42] <ecr> stupid floats. breaking all the nice designs...
[23:10:47] <strcat> bjz: yes
[23:10:54] <strcat> bjz: floats are the only issue in rust for Eq/Ord atm
[23:11:00] <bjz> yep
[23:11:14] <strcat> rusti: let mut xs = std::hashmap::HashMap::new(); xs.insert(0.0 / 0.0); xs
[23:11:17] -rusti- pastebinned 9 lines of output: http://ix.io/9WK
[23:11:26] <strcat> rusti: let mut xs = std::hashmap::HashSet::new(); xs.insert(0.0 / 0.0); xs
[23:11:30] -rusti- pastebinned 1 lines of output: http://ix.io/9WL
[23:11:48] *** Joins: bjz_ (bjz@B398BE78.F804C29E.D35A31DF.IP)
[23:11:49] <strcat> rusti: let mut xs = std::hashmap::HashSet::new(); for _ in range(0, 100) { xs.insert(0.0 / 0.0); } xs
[23:11:52] -rusti- pastebinned 1 lines of output: http://ix.io/9WM
[23:12:02] <strcat> destroyed hash table
[23:12:03] <bjz_> woops d/ced
[23:12:03] <strcat> ;p
[23:12:12] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[23:12:35] <bjz_> strcat: but yeah, I was sort of going to go down the 'such is life' route, but it's important not to ignore it
[23:12:50] <strcat> I would say Ord inherits from Eq
[23:12:57] <strcat> and they are total orderings
[23:13:13] <ecr> so then what are you going to do about floats?
[23:13:19] <ecr> just cheat like everyone else?
[23:13:21] <strcat> if you don't care, you can make a new float wrapper implementing them
[23:13:26] <strcat> ecr: just don't implement them
[23:13:45] <ecr> oh, so you want to rename TotalEq/TotalOrd to Eq/Ord
[23:13:48] <strcat> floats have their own min/max/clamp algorithms
[23:14:03] <strcat> you can use sort_by and handle NaN however you want
[23:14:14] * strcat shrugs
[23:14:49] <ecr> you're not going to get an argument from me about making sure Eq/Ord are correct, but good luck getting that change pushed through
[23:14:54] <dbaupp> we probably want to provide std::f64::ieee_total_ord or something, because custom coding a comparison for .sort_by every time is pretty annoying
[23:15:10] <strcat> the total ordering is really weird though
[23:15:33] <strcat> numbers that compare equal with == can compare non-equal with the total ordering iirc
[23:15:38] <dbaupp> well, std::f64::total_ord_nans_last
[23:15:47] <ecr> forall P in { properties of IEEE floats }, P is really weird
[23:16:11] <bjz_> heh
[23:16:23] <ecr> well
[23:16:33] <ecr> i guess multiplication is still commutative and associative
[23:16:34] <ecr> so there's that
[23:16:55] <bjz_> 'RingLike' :P 'AlmostRing' xD
[23:18:17] <ecr> impl UnholyMonstrosity for f32
[23:18:23] <cmr> bahahah.
[23:18:51] <ecr> fn summonCthulu(&mut self) -> GreatOldOne;
[23:18:53] <strcat> or just make a gigantic Float trait
[23:18:54] <bjz_> trait StupidWeirdThingLikeRealButNot
[23:18:59] <strcat> describing IEEE754 float semantics
[23:19:03] <strcat> shove *everything* in it
[23:19:14] <strcat> only stuff implementing IEEE754 floats will implement it
[23:19:23] <bjz_> trait Ieee754
[23:19:23] <ecr> that's probably the way to do it
[23:19:24] <strcat> so you can have f32/f64/f128 or whatever else
[23:19:59] <strcat> anyway, you don't need == sugar for floats imo, it's usually not going to make much sense
[23:20:23] <strcat> since the precision of most things is pretty much left up to the implementation for the most part
[23:20:35] <ecr> and anyone who knows what they're doing with floats will be doing epsilon difference comparisons instead of == anyway
[23:20:36] <strcat> afaik it specifies a maximum error, if anything
[23:21:04] *** Quits: bjz_ (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[23:21:16] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[23:21:24] <ecr> did you know BASIC actually does a small epsilon difference comparison for == on floats?
[23:21:26] <strcat> only the base ops have to be rounded right
[23:21:29] <strcat> ecr: nope!
[23:21:32] <ecr> i don't remember what the range is though
[23:21:50] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[23:21:56] <ecr> and if i remember right, the original BASIC only had floats
[23:22:12] <ecr> so all you had was fuzzy equality on floats if you wanted numbers
[23:22:23] * ecr jazz hands
[23:22:23] <strcat> https://www.gnu.org/software/libc/manual/html_node/Errors-in-Math-Functions.html
[23:22:34] <strcat> lots are rounded correctly
[23:22:35] <strcat> some aren't
[23:22:36] <luziie> does javascript have integers?
[23:22:40] <strcat> and the standard doesn't care
[23:23:06] <strcat> luziie: no, just doubles
[23:23:10] <ChrisMorgan> luziie: JavaScript has Number, which, depending on the range, may be either an integer or a double.
[23:23:13] <bjz> luziie: no, just f64 I think
[23:23:15] <bjz> luziie: but the jits can optimise
[23:23:20] <strcat> ChrisMorgan: no
[23:23:23] <bjz> luziie: afaik
[23:23:30] <strcat> ChrisMorgan: that's an optimization a compiler could do afaik
[23:23:32] <strcat> not semantics
[23:23:42] <ecr> luziie: theoretically it only has doubles, but it will try to keep integers as integers under the hood
[23:23:51] <bjz> luziie: I think they are proposing to add machine types in the new standard, for webgl mainly
[23:24:01] <ecr> i think there's a proposal to add integers to the language though?
[23:24:03] <bjz> luziie: but don't take my word on it
[23:24:18] <strcat> ecr: does it really matter much? they have dynamic typing anyway
[23:24:40] <strcat> x|0 to get an int representation from the VM isn't the end of the world ;p
[23:24:43] <luziie> i think it matters for some things
[23:24:46] <luziie> "JavaScript can only safely represent integers i in the range âˆ’253 < i < 253"
[23:24:47] <ecr> strcat: until you try to index an array with pi
[23:24:58] <strcat> ecr: has dynamic typing anyway
[23:25:00] <strcat> not going to help you
[23:25:00] <luziie> uh
[23:25:13] <luziie> s/253/2^53/
[23:25:24] <ecr> dynamic typing can keep integers as integers...
[23:25:31] <ecr> it just fails if the result isn't an integer
[23:25:34] <strcat> luziie: and the bitwise ops are only defined on 32-bit
[23:26:12] * ChrisMorgan amends his knowledge in line with what strcat says: "The Number type has exactly 18437736874454810627 â€¦ values, representing the double-precision 64-bit format IEEE 754 values as specified in the IEEE Standard for Binary Floating-Point Arithmetic, except that â€¦ â€œNot-a-Numberâ€ values of the IEEE Standard are represented in ECMAScript as a single special NaN value."
[23:26:16] <strcat> ecr: how is that different than failing on a float that's not an integer?
[23:26:40] <strcat> beyond typeof/instanceof, which are insane to use ;p
[23:26:53] <ChrisMorgan> c.f. http://www.ecma-international.org/ecma-262/5.1/#sec-8.5
[23:26:53] * strcat shrugs
[23:27:08] <strcat> they should add 64-bit integers as a type
[23:27:10] <strcat> and big integers
[23:27:20] <strcat> but meh @ needing a 32-bit one
[23:27:32] <strcat> if they add 64-bit ones, then sure
[23:27:32] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[23:27:48] <strcat> it would make sense if you want to appeal to crypto/codec people (as if anyone will ever write that seriously in js)
[23:27:51] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[23:28:01] <strcat> and for making it a compile target
[23:28:07] <strcat> but really, I hate that crap ;p
[23:28:48] <luziie> there is at least a serious webm decoder in javascript
[23:29:06] <bjz> http://www.smlnj.org/doc/Conversion/types.html#Real-equality
[23:29:16] *** Quits: ecr (chatzilla@moz-1FE08DA0.dhcp4.washington.edu) (Ping timeout)
[23:30:35] <strcat> wooo sml
[23:30:38] <strcat> ;p
[23:30:44] <brson> damn acrichto is decimating 1.0 milestone issues
[23:30:44] *** Joins: ecr (chatzilla@moz-1FE08DA0.dhcp4.washington.edu)
[23:30:49] <brson> gold star for acrichto
[23:30:59] <acrichto> the closer we are to 1.0, the better!
[23:31:12] <ecr> what'd i miss? what's the gold star for?
[23:31:41] <brson> ecr: acrichto is rapidly reducing the number of issues on the 1.0 milestone
[23:31:46] <acrichto> brson: I'm also stealing all the easy ones before others can get to them
[23:31:49] <bjz> strcat: this is really important for 1.0 backwards compat
[23:31:56] <bjz> strcat: floating point
[23:32:08] <brson> acrichto: i know! i'm looking at the list to try to claim some easy ones before they're gone
[23:32:33] <strcat> bjz: meh, stdlib issue
[23:32:35] <acrichto> brson: https://github.com/mozilla/rust/issues/11602
[23:32:59] <bjz> strcat: isn't == hardwired into the compiler though?
[23:33:09] <strcat> bjz: yes, but not as Eq
[23:33:15] <acrichto> oh brson I actually wanted to ask you about something
[23:33:16] <bjz> strcat: ahh
[23:33:23] <acrichto> brson: you mentioned compatibility with clang on https://github.com/mozilla/rust/issues/7791
[23:33:27] <bjz> brson: would you be horrified by removing `Eq` for floats?
[23:33:50] <strcat> well, removing TotalEq/TotalOrd and adding requirements to Eq/Ord making floats unable to impl them
[23:34:00] <strcat> bjz: I have an RFC open about this already ;p
[23:34:09] <bjz> strcat: ah cool
[23:34:10] <acrichto> brson: so today we're completely compatible with clang (at least I think), and the proposed solution would be a complete turnaround away from clang, but you're uncomfortable with that? Our needs are a little different, but it would be kinda nice to simplify those flags
[23:34:43] <bjz> strcat: the question is, does IEEE754 belong in the std?
[23:34:53] <strcat> bjz: sure
[23:35:00] <ecr> bjz: i'd say yes
[23:35:04] <acrichto> :(
[23:35:19] <acrichto> "do the majority of all program in existence need this"
[23:35:38] * bjz we really need to define a charter for the std
[23:35:54] <bjz> it's always going to be subjective and fuzzy
[23:36:05] <bjz> but it would be good to have a guide
[23:36:07] *** Joins: a_m0d (a_m0d@moz-322A4DE4.acanac.net)
[23:36:38] <bjz> like, it seems like we are moving to 'the std should be runtime independant'
[23:36:54] <bjz> which is a clear, well defined constraint
[23:37:12] <brson> acrichto: i don't have a strong opinion
[23:37:55] <acrichto> brson: ok
[23:38:00] <dbaupp> acrichto: are we actually compatible with clang? don't they use -emit-llvm instead of --emit-llvm? (minor quibble, of course)
[23:38:30] <acrichto> dbaupp: yeah I guess we're mostly compatible in the sense of the same set, not the exact same syntax
[23:38:45] <dbaupp> true enough
[23:39:23] <dbaupp> (I do like pnkfelix's suggestion of keeping -S though.)
[23:39:41] <acrichto> really?
[23:39:54] <acrichto> I thought the point of the issue was to converge everything in one location
[23:40:02] <acrichto> instead of sprinkling across multiple options
[23:40:28] <dbaupp> well, just as a shorthand for --emit=asm
[23:40:29] * dbaupp shrugs
[23:40:33] <dbaupp> not that important, I guess
[23:43:28] <acrichto> brson: ok this happened again http://buildbot.rust-lang.org/builders/auto-win-32-opt/builds/3630/steps/test/logs/stdio
[23:43:40] <acrichto> this happens every now and then ,it's like basic commands can't be found
[23:43:43] <acrichto> ls/git/echo/grep ?
[23:44:12] <acrichto> and the bot previously succeeded
[23:44:27] * acrichto thinks the windows bots just hate us
[23:44:43] <acrichto> bash.exe: warning: could not find /tmp, please create!
[23:44:45] <acrichto> that's disturbing
[23:44:50] <ecr> it just wants to be loved acrichto
[23:44:56] <strcat> bjz: I think floats should be in libstd
[23:45:29] <strcat> dunno about traits though
[23:45:45] <strcat> I really don't think implementing Eq/Ord and ending up needing 2 more cmp traits is good
[23:45:48] <bjz> strcat, acrichto: https://github.com/mozilla/rust/issues/11624#issuecomment-32663430
[23:46:06] <bjz> strcat: yeah, it would be great to simplify std::cmp
[23:46:43] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[23:46:43] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/sIQKhQ
[23:46:43] <ghrust> 13rust/06auto 14bd46934 15Alex Crichton: test: Add the ability to force a host target...
[23:46:43] <ghrust> 13rust/06auto 142ff358c 15bors: auto merge of #11618 : alexcrichton/rust/force-host, r=brson...
[23:46:44] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[23:48:30] <bjz> strcat: aiming for a tight, well thought out language and compiler is what really excites me. All this implementing pointer types in the libs is really pushing us nicely in that direction.
[23:49:19] <acrichto> bjz: if we can remove the libm dep, I think we're at the sweet spot for runtime deps on all platforms with libstd
[23:49:20] *** Quits: new_one (new_one@2D115045.D0485D2E.B3C0173E.IP) (Ping timeout)
[23:49:33] <acrichto> bjz: it'd only be lib{c,pthread} !
[23:49:41] <strcat> what's wrong with using libm though?
[23:49:49] <acrichto> just fun to have fewer deps
[23:49:59] <brson> removing libm seems pretty hard without reimplementing parts of it
[23:50:03] <acrichto> and it's not really a libstd-kinda thing in my opinion
[23:50:10] <acrichto> oh just moving libm to a non-stdlib lib
[23:50:17] <acrichto> I don't think we should reimplement everything in rust (sounds hard)
[23:50:22] <cmr> so... where do the math functions live.
[23:50:28] <acrichto> libnum
[23:50:30] <cmr> why wouldn't the stuff for dealing with f32/f64 be in libstd?
[23:50:31] <bjz> it could be a gradual process
[23:50:33] <strcat> acrichto: well that implies writing a whole lot of inline asm
[23:50:53] <acrichto> like this isn't an "all or nothing" kinda thing, and I don't really know the repercussions
[23:51:00] <brson> i hadn't considered moving basic math functions out of std. possibly
[23:51:00] <acrichto> the main usage of f32/64 sutff in libstd is formatting
[23:51:13] <bjz> but it would eventually be nice to be completely free of C, from a philosophical point of view
[23:51:14] <acrichto> I suppose "how much can we strip down libstd" can go on for awhile
[23:51:21] <strcat> the repercussion of not having an extensive stdlib is people using a language like Go or Python letting you get stuff done instead imo...
[23:51:39] <bjz> acrichto: 'where do we stop?' is the thing
[23:51:41] <cmr> acrichto: *in* libstd perhaps. but sqrt etc?
[23:51:46] <cmr> acrichto: that's all libm.
[23:51:46] <brson> strcat: we're not talking about *not* providing the functionality
[23:51:46] <strcat> if you have to go searching for packages when you want to get something done, it's not convenient
[23:51:55] <acrichto> strcat: we would distribute more libraries than just lib{std,extra}, insted of 'use std::f32' it'd be 'extern mod num' (which is just as easy)
[23:52:17] <bjz> strcat: we already have libgreen and libnative
[23:52:23] <acrichto> and yeah we always want the libm functionality in some form or another
[23:52:29] <strcat> bjz: which you already I know think shouldn't exist ;p
[23:52:32] <strcat> er
[23:52:34] <acrichto> like right now the community mindset is "use std or extra", we need to break that
[23:52:35] <strcat> s/I //
[23:52:39] <bjz> strcat: I didn't
[23:53:06] <bjz> acrichto: yeah, `extra` is sort of a dumping ground
[23:53:08] *** flaper87 is now known as flaper87|afk
[23:53:51] <dbaupp> we need a working package manager & registry before splitting up extra will be nice... (IMO, anyway)
[23:54:12] <acrichto> oh yeah of course
[23:54:15] <luziie> we should have that first anyway
[23:54:21] <acrichto> that's the reason we have the mindset we have today
[23:54:26] <bjz> so much to do...
[23:54:33] <acrichto> but we distribute like 10 libraries today
[23:54:40] <acrichto> we could just have more as part of the standard distribution
[23:54:58] <acrichto> for now
[23:54:59] <acrichto> as a stopgap
[23:55:01] <dbaupp> I guess so
[23:55:38] <dbaupp> although that will make discoverability harder, since rustdoc only does one crate at a time
[23:55:45] <cmr> it didn't used to.
[23:55:50] <cmr> and I think it should regain that ability.
[23:55:54] <bjz> dbaupp: is that an issue with rustdoc though?
[23:55:59] <luziie> is there an issue open for package manager and registry?
[23:56:03] <cmr> luziie: yes.
[23:56:30] <acrichto> dbaupp: yeah it would be kinda nice if there were an index of "all crates"
[23:56:38] <acrichto> maybe rustdoc should take multiple crates as input
[23:56:44] <acrichto> and create batches of documentation at once
[23:57:19] <bjz> acrichto: that's where the idea of 'workspaces' could be useful
[23:57:39] <acrichto> it may be the wrong concept though
[23:57:50] <bjz> yep -_-
[23:57:54] <acrichto> like what would the end goal be?
[23:58:02] <acrichto> so I define a trait in crate A
[23:58:07] <acrichto> which is implemented by crate B's type
[23:58:18] <acrichto> should crate A's documentation of the trait be updated to reference B?
[23:58:20] <cmr> So my idea right now for rustpkg is that we have something like pkg-config that just has a list of installed crates, where they are, which version they are, which versino of rustc they were built with, and their deps.
[23:58:23] * bjz really needs to get around to writing some of this stuff up
[23:58:24] <acrichto> or do you just want an index of all crates?
[23:58:38] <cmr> acrichto: they should be interreferenced.
[23:58:47] <cmr> it'd require a tex-like two-pass system.
[23:58:49] <acrichto> I'm not sure that's scalable though
[23:58:59] <acrichto> that means that libstd dox can't be built without knowledge of all crates int he world
[23:59:04] <cmr> sure they can be.
[23:59:12] <cmr> they'll just only be hyperlinked together if you have them.
[23:59:29] <acrichto> you want to parallelize this thoug
[23:59:31] <strcat> I don't think you want to include third party crates in official docs
[23:59:34] <acrichto> there should be some fork/join point
[23:59:38] <cmr> of course you can.
[23:59:41] <strcat> if there is a problem with a third party library you may not be able to fix it
[23:59:44] <cmr> each crate gets its docs generated.
[23:59:45] <acrichto> like the fork is "document all crates" and the join is "build some index"
[23:59:48] <cmr> as json
[23:59:50] <cmr> yes.
