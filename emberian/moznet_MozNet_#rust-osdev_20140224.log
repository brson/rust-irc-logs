[00:05:20] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Ping timeout)
[00:07:27] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[00:20:46] *** Joins: huon (Thunderbir@B11C0778.D5A1DCF.37681C44.IP)
[00:34:55] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[01:04:39] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[01:06:46] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[01:14:45] *** Quits: Tobba (Tobba@moz-462B7F7F.ias.bredband.telia.com) (Ping timeout)
[01:40:44] *** kimundi is now known as zz_kimundi
[02:16:30] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[03:09:38] *** Quits: zz_kimundi (kimundi@moz-B191E9F0.dip0.t-ipconnect.de) (Ping timeout)
[03:13:09] *** Joins: zz_kimundi (kimundi@moz-D90B8D7C.dip0.t-ipconnect.de)
[03:13:10] *** zz_kimundi is now known as kimundi
[03:19:49] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[03:20:12] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[03:20:15] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[04:32:56] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[06:06:02] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[06:08:44] *** Joins: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro)
[06:20:21] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[06:32:12] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[07:00:27] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[07:10:17] *** Quits: huon (Thunderbir@B11C0778.D5A1DCF.37681C44.IP) (Quit: huon)
[07:28:50] *** Joins: devbug_ (quassel@23AC5F12.9D950176.3655BBF5.IP)
[07:28:52] *** Quits: devbug_ (quassel@23AC5F12.9D950176.3655BBF5.IP) (Client exited)
[07:36:32] <pcmattman> what's the bug?
[07:56:45] *** Joins: whitglint (uid15486@moz-31ABA2C0.irccloud.com)
[08:18:26] *** Joins: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net)
[08:26:08] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:42:04] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:44:39] *** Joins: vbar (vbar@moz-1E2AA80.resnet.ubc.ca)
[09:26:58] *** Quits: vbar (vbar@moz-1E2AA80.resnet.ubc.ca) (Quit: vbar)
[09:51:36] *** Joins: Tobba (Tobba@moz-462B7F7F.ias.bredband.telia.com)
[09:59:44] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[10:08:30] *** Joins: tiffnya (kawaii@moz-FC0DB29D.dhcp.embarqhsd.net)
[10:08:57] *** Quits: tiffany (kawaii@moz-FC0DB29D.dhcp.embarqhsd.net) (Ping timeout)
[10:38:41] *** Quits: devbug (quassel@23AC5F12.9D950176.3655BBF5.IP) (Connection reset by peer)
[10:46:45] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[10:54:53] *** kimundi is now known as zz_kimundi
[10:57:27] *** Quits: mawuli (mawuli@moz-36C70B7D.com.gh) (Client exited)
[11:30:54] *** zz_kimundi is now known as kimundi
[11:34:53] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[12:13:51] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[13:44:31] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[14:14:18] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[14:20:49] *** Quits: tiffnya (kawaii@moz-FC0DB29D.dhcp.embarqhsd.net) (Ping timeout)
[14:51:06] *** Joins: sbalmos (quassel@CA5677B6.576D0C1.ED2EFC1B.IP)
[14:53:29] *** Joins: nszceta (hax@moz-E458A7C0.pharm.pitt.edu)
[15:53:28] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[15:54:09] *** Quits: nszceta (hax@moz-E458A7C0.pharm.pitt.edu) (Input/output error)
[16:12:50] *** Quits: friggle (friggle@moz-A607EAFA.members.linode.com) (Ping timeout)
[16:12:51] *** Joins: friggle (friggle@moz-A607EAFA.members.linode.com)
[16:30:53] *** Joins: rocode (rocode@moz-398826F7.clsp.qwest.net)
[16:37:18] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[17:18:00] *** Joins: sunfish (chatzilla@moz-42DA0C69.dsl.dynamic.sonic.net)
[17:21:23] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[17:28:20] *** Quits: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro) (Ping timeout)
[17:32:34] *** Joins: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro)
[17:32:38] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[17:41:51] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[17:42:39] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[17:43:20] *** Quits: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro) (Ping timeout)
[17:44:29] *** Joins: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro)
[17:54:48] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[18:04:05] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[18:08:25] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:24:22] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[18:39:11] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[18:40:00] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[18:43:09] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[18:50:30] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[18:50:58] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:56:09] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[19:00:19] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[19:01:49] *** Quits: sunfish (chatzilla@moz-42DA0C69.dsl.dynamic.sonic.net) (Ping timeout)
[19:06:03] *** Quits: rocode (rocode@moz-398826F7.clsp.qwest.net) (Quit: Leaving)
[19:08:13] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[19:22:34] *** Joins: nszceta (hax@moz-E458A7C0.pharm.pitt.edu)
[19:32:26] *** Quits: whitglint (uid15486@moz-31ABA2C0.irccloud.com) (Quit: Connection closed for inactivity)
[19:38:02] *** Joins: esummers (textual@moz-3B015C90.wi.res.rr.com)
[19:52:12] *** Quits: esummers (textual@moz-3B015C90.wi.res.rr.com) (Quit: Textual IRC Client: www.textualapp.com)
[19:54:37] *** Joins: mawuli (mawuli@moz-36C70B7D.com.gh)
[19:57:05] *** Joins: sunfish (chatzilla@moz-BBE3ABD.mv.mozilla.com)
[20:00:02] *** Joins: esummers_ (textual@moz-3B015C90.wi.res.rr.com)
[20:00:48] *** Quits: esummers_ (textual@moz-3B015C90.wi.res.rr.com) (Quit: Textual IRC Client: www.textualapp.com)
[20:15:05] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[20:17:02] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[20:19:22] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[20:41:00] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[20:43:42] *** Quits: sunfish (chatzilla@moz-BBE3ABD.mv.mozilla.com) (Client exited)
[21:11:54] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[21:17:53] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[21:25:55] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[21:27:20] *** Quits: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro) (Ping timeout)
[21:31:55] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[21:33:32] *** Joins: sunfish (chatzilla@moz-BBE3ABD.mv.mozilla.com)
[21:54:34] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[21:55:08] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[22:05:20] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[22:07:46] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[22:10:53] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:13:56] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:18:48] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[22:35:27] *** Quits: mawuli (mawuli@moz-36C70B7D.com.gh) (Broken pipe)
[22:42:28] *** Joins: mawuli (mawuli@moz-36C70B7D.com.gh)
[22:47:13] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[22:48:43] *** Quits: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net) (Quit: huon)
[22:59:22] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[23:03:26] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[23:04:27] *** jld is now known as jld|commute
[23:14:57] <Leo`> pcmattman: a bug that causes my Rust code to be loaded in memory 8 bytes higher than where it should be
[23:15:10] <Leo`> the addresses are correct in the binary, but not upon load in memory
[23:15:41] <Leo`> I used git idontrememberwhat
[23:16:03] <Leo`> git bisect 
[23:16:17] <Leo`> this bug was introduced by the commit that implemented LTO
[23:18:13] <Leo`> ping ed
[23:18:15] <Leo`> fu
[23:18:17] <Leo`> he's not there
[23:18:25] <cmr> Leo`: what's up?
[23:18:32] <Leo`> a bug
[23:18:34] <Leo`> as I said
[23:18:43] <Leo`> hi cmr btw
[23:18:50] <Leo`> :)
[23:18:56] <Leo`> it's a weird bug
[23:19:18] <Leo`> since I upgraded Rustc, Quasar (my toy-OS) is not loaded at the good place in memory
[23:19:22] <Leo`> but 8 bytes too high
[23:19:35] <Leo`> and this "bug" is present since the implementation of LTO, apparently
[23:20:01] <Leo`> I don't know if I can open an issue for this
[23:20:30] <Leo`> since it's quite hard to come up with a reasonnably small example to reproduce it
[23:20:47] <Leo`> my example uses a custom linker script
[23:22:11] <Leo`> pfff :(
[23:27:31] <Leo`> if you have an idea cmr 
[23:34:16] <cmr> how odd.
[23:34:22] <cmr> Leo`: are you even using -Z lto?
[23:37:47] <cmr> Leo`: specifically, what is loading it and how is it being built etc?
[23:37:50] <Leo`> cmr: no
[23:38:07] <Leo`> it's bult as an elf64 binary
[23:38:13] <Leo`> Rust produces object code
[23:38:26] <Leo`> that is linked against other object code generated from an assembly stub
[23:38:31] <Leo`> with a custom linker script
[23:38:35] <Leo`> into a 64 bit elf binary
[23:38:42] <Leo`> that is loaded by Grub
[23:38:49] <Leo`> and no i'm not even using -Z lto, only -O
[23:39:12] <cmr> And you said the offsets are correct in the ELF file?
[23:39:40] <Leo`> yup
[23:40:09] <Leo`> I send readelf outputs for files generated by different version of Rustc to eddyb
[23:40:10] <cmr> incredibly strange.
[23:40:18] <Leo`> I don't known what he actually found
[23:40:29] <Leo`> versions*
[23:40:35] <Leo`> incredibly yep
[23:40:55] <Leo`> i've been blocking on this for about 1 ou 2 weeks now
[23:41:07] <Leo`> it's been quite a time before I figure out it came from Rustc
[23:41:38] <Leo`> I was thinking of a bug in my multiboot headers or my linker script at first
[23:41:51] <Leo`> but they both work perfectly with Rustc 0.8
[23:41:58] <cmr> yes, that is what I would have expected too.
[23:42:12] <Leo`> (and every version of Rustc before LTO apparently)
[23:42:13] <cmr> what's the hash of the commit that introduced the bug?
[23:42:27] <Leo`> let me find out
[23:43:05] <Leo`> fuck
[23:43:13] <Leo`> I compiled on a machine at my college
[23:43:16] <Leo`> in /tmp
[23:43:19] <Leo`> they obviously restarted it
[23:43:38] <Leo`> cmr: https://github.com/mozilla/rust/commit/fce4a174b9ffff71a66feecd9f4960f17fc9c331 this one
[23:43:43] <cmr> :(
[23:43:48] <cmr> ok
[23:44:03] <Leo`> or the one just before
[23:44:07] <Leo`> but since it's unrelated
[23:44:09] <Leo`> I would say this one
[23:44:11] <cmr> and it's being loaded *exactly* eight bytes too high?
[23:44:27] *** jld|commute is now known as jld
[23:44:47] <Leo`> yup
[23:45:01] <Leo`> I noticed this bug because when there are several functions in the crate
[23:45:06] <cmr> this is going to be exciting to track down.
[23:45:15] <Leo`> when I look to where main should be
[23:45:26] <Leo`> I find the return of the function that is located just below it
[23:45:33] <Leo`> then a call to main immediately returns xD
[23:45:43] <cmr> heh
[23:45:46] <Leo`> s/then/so/
[23:46:05] <Leo`> maybe I should talk of this to acrichto
[23:46:12] <Leo`> since he's the guy that implemented LTO
[23:46:16] <cmr> so you said the offset is correct in the ELF header, what is actually parsing + loading it?
[23:46:26] <Leo`> and since he seems to be familiair with le low-level aspects of Rustc
[23:46:33] <Leo`> Grub
[23:46:53] <Leo`> this makes things even harder to reproduce :p
[23:47:18] <Leo`> familiar*
[23:47:45] <cmr> If the offset is correct in the ELF header I can't imagine the bug being anywhere but in grub, and we've started outputting something it doesn't like
[23:47:57] <Leo`> yep
[23:48:12] <Leo`> I'm not saying this is actually a bug and Rustc is in fault eh
[23:48:22] <cmr> right I'm just trying to walk through it
[23:48:36] <Leo`> but I'd like to know if I should report this to Rust/Grub/LLVM/whatever
[23:48:47] <Leo`> and how I can workaround it in the meantime
[23:48:51] <Leo`> oh
[23:48:54] <Leo`> other fun thing
[23:49:08] <cmr> easy workaround could be offsetting it 8 bytes lower in the linker script?
[23:49:30] <Leo`> with version of Rustc that don't have this "bug"
[23:49:46] <Leo`> I have to check but iirc, it only works with --lib
[23:49:56] <Leo`> with --bin, the shift is there, even with older versions
[23:50:17] <cmr> hmmmmm
[23:50:26] <Leo`> cmr: mhh no, because I relay on the adresses of the symbols to interface my Rust code with assembly code
[23:50:43] <Leo`> changing them in the linker script would only shift the problem 8 bytes lower :p
[23:51:29] <Leo`> it seems obvious that Rustc is outputting something that Grub fails to understand correctly
[23:51:40] <cmr> Leo`: can you get a dump of memory from a bugged load?
[23:51:43] <Leo`> wether it's a bug in Rustc or Grub (or even LLVM) I don't know
[23:51:58] <Leo`> but this is really strange
[23:52:03] <Leo`> yup I can
[23:52:13] <cmr> starting preferably 64 bytes before where it's supposed to be loaded...
[23:52:16] <Leo`> but which amount of memory exactly ?
[23:52:18] <Leo`> k
[23:52:27] <cmr> just the first few K should be fine.
[23:53:39] <Leo`> mh
[23:53:43] <Leo`> just a minute
[23:53:47] <cmr> thanks
[23:53:49] <Leo`> I reboot my laptop on Debian
[23:57:42] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[23:58:19] *** Quits: nszceta (hax@moz-E458A7C0.pharm.pitt.edu) (Input/output error)
[23:58:44] <Leo`> cmr: http://paste.placeholder.fr/show/521/
[23:58:58] <Leo`> main is supposed to be at 0xffffffff8010c000
[23:59:20] <Leo`> I suppose you'll want the asm source :p
[23:59:42] <Leo`> http://paste.placeholder.fr/show/522/
