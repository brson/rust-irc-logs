[00:14:53] *** Quits: brson (brson@moz-62518563.mtv2.mozilla.com) (Quit: leaving)
[01:45:35] *** Quits: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net) (Quit: huon)
[08:16:22] *** Joins: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net)
[10:37:16] <Seldaek> wycats: minor nitpick but it's now or never, can't we lowercase the cargo.toml filename? :) I realize there is no strong precedent on this, but most things are lowercased in rust, at least filesystem wise.
[10:38:08] <Seldaek> apart from that thanks for the update/gist, it's great to get info without having to keep up on a daily basis. I hope they keep coming :)
[10:44:06] <cmr> agree
[14:19:11] <huon> wycats: (my ping from #rust) I noticed you were using mod.rs for the crate root file; is this on purpose? (the convention in mozilla/rust is lib.rs)
[14:59:08] *** Joins: brson (brson@moz-62518563.mtv2.mozilla.com)
[15:51:34] <wycats> huon: we went through a bunch of permutations with Alex to get the nesting working
[15:51:56] <wycats> Seldaek: Makefile, Rakefile, Gemfile, etc. are all caps, no?
[15:52:37] <huon> wycats: ok, sounds like it was on purpose :)
[15:52:50] <wycats> huon: I really would rather have foo.rs and foo/*.rs
[15:52:57] <wycats> instead of foo/mod.rs and foo/*.rs
[15:53:01] <wycats> but whatevs
[15:53:12] <huon> yeah
[15:53:24] <huon> oh, btw, while I've got you here
[15:54:24] <huon> are the explicit type hints necessary in https://github.com/carlhuda/cargo/blob/master/src/bin/cargo-read-manifest.rs#L40 ?
[15:54:39] <huon> (it would seem like a bug worth filing if they're not inferring correctly)
[15:55:40] <wycats> oh interesting... I didn't even try without them
[15:55:46] <wycats> good call
[15:55:53] <wycats> I was "being explicit"
[15:55:55] <wycats> but you're right
[15:55:59] <wycats> exec() has the types in it
[15:56:04] <wycats> that's great :)
[15:56:07] <wycats> makes it even simpler
[15:56:10] <wycats> and easier to generate
[15:56:21] <wycats> execute_main!()
[15:56:40] <huon> cool :)
[15:56:52] <wycats> how do you like the general strategy of hiding all the serialization and deserialization details behind the abstraction?
[15:56:57] <wycats> it's working pretty well for us
[15:56:58] <huon> (another thing: Vec<T> is preferred to ~[T])
[15:57:05] <huon> yeah, it looks really slick
[15:57:12] <wycats> yeah... we plan to change it to Vec<T>
[15:57:12] <huon> ... although I'm a little concerned about error handling
[15:57:21] <wycats> huon: what's the concern?
[15:57:25] <huon> but then we've talked about this before
[15:57:44] <wycats> we put in the temporary deprecation attributes just to move on
[15:57:48] <wycats> but we plan to change to Vec soon
[15:57:49] <huon> the error messages possibly looking peculiar
[15:57:55] <wycats> I think Alex added Vec to stdprelude
[15:57:59] <huon> and not as good as the could be
[15:58:02] <huon> yeah, its' in there now
[15:58:10] <wycats> we were waiting for that
[15:58:14] <wycats> huon: ah... we plan to do a full pass on error messages
[15:58:17] <wycats> the good news is:
[15:58:24] <wycats> it's easy to find them
[15:58:29] <huon> (and yes, I totally agree with just using ~[] while you're working fast, no need to do the menial tasks now)
[15:58:31] <wycats> just ack to_cargo_error
[15:59:48] <huon> Does that handle a TOML file with a misspelt field name sanely?
[16:00:21] <wycats> huon: right now, an invalid Toml file fail!s, because the toml library fail!s everywhere
[16:00:28] <wycats> I am planning on contributing changes to make it return a result
[16:00:34] <wycats> Hammer handles errors properly
[16:00:44] <wycats> like: "could not find required flag --manifest-file"
[16:00:51] <huon> ah, very cool
[16:01:11] <wycats> "could not find" is wrong
[16:01:12] <huon> my concerns are allayed
[16:01:15] <wycats> missing something something :)
[16:01:22] <wycats> yeah, we care a lot about error messages
[16:01:31] <wycats> the current infra is basically just so we CAN have good error messages
[16:01:39] <wycats> propagating results properly
[16:01:59] <huon> <3
[16:02:04] <wycats> we basically never fail!, we always .to_cargo_error (changing to to_cargo_result soon) with an error message and exit code
[16:02:23] <huon> my experiences with Decodable & Encodable have been a misery of failure-on-error
[16:02:39] <wycats> huon: yes, Decodable really needs to be based on Result
[16:02:41] <huon> (you are actually allowed to fail: using task::try you can even catch the result)
[16:02:51] <wycats> yes, but that is actually wrong
[16:02:52] <wycats> WRONG
[16:02:53] <wycats> :P
[16:02:58] <huon> haha
[16:03:06] <wycats> people do not want to decode something and get "crash"
[16:03:13] <wycats> they want "could not find field foo"
[16:03:25] <wycats> "expected foo to be decodable to uint, but it was 'foo bar'"
[16:03:57] <huon> yes, but with task::try you can extract the error message and handle it in the supervisor task
[16:03:59] <wycats> ideally with a sane set of errors so they can be converted to something user friendly
[16:04:12] <wycats> in theory that sounds good, but failures are not in the type system
[16:04:15] <wycats> so you can never REALLY know
[16:04:22] <huon> e.g. fail!(DecodingError { msg: "could not find" })
[16:04:49] <wycats> the right way to propagate errors in Rust, unless you have an extreme case (like corrupted, unsafe data), is to propagate a Result
[16:04:51] <wycats> try! is great
[16:04:56] <wycats> it works wonderfully
[16:04:58] <huon> yeah, totally agree
[16:05:31] <huon> anyway I would consider using a supervisor task just in case something does fail!(), to give a nicer "stuff went wrong" message (e.g. rustc's ICE message is via a supervisor task)
[16:05:34] <wycats> the pattern we're using here is actually totally airtight for errors (unlike in Bundler, where we had to be very careful with exceptions) with the exception (no pun intended) of fail!
[16:05:38] <wycats> yes I agree
[16:05:49] <wycats> I can throw that into the execute abstraction
[16:05:49] <wycats> :)
[16:05:55] <wycats> ^^ the reason for the execute abstraction
[16:06:05] <huon> \o/
[16:06:14] <huon> good to see we're in violent agreement
[16:06:30] <huon> but yeah, putting stuff in types is super-nice
[16:06:37] <wycats> we'd probably print something like "An unexpected error has occurred. Run --verbose to see full details"
[16:06:46] <wycats> huon: yeah... we're using Rust... may as well make good use of it
[16:07:01] <wycats> ideally by the time Cargo is heavily used the backtrace stuff will be in :P
[16:07:51] <huon> wycats: https://github.com/mozilla/rust/blob/master/src/librustc/lib.rs#L390 is the section of the compiler handling the supervisor
[16:08:00] <wycats> nice
[16:08:21] <huon> (includes capturing stderr to only print later; not sure if that's correct for cargo though.)
[16:08:22] <wycats> btw: one nice thing about the types factoring is that the commands are *already* "just libraries"
[16:08:40] <wycats> it is probably correct for cargo
[16:08:45] <wycats> unless you're running --verbose
[16:08:56] <wycats> or even if you are
[16:09:08] <huon> lucky we have `if` statements to be able to select \o/
[16:09:10] <wycats> we'd probably print stderr after the "Something went wrong..." in verbose mode
[16:09:12] <huon> graydon thought of everything
[16:09:16] <wycats> hahaha
[16:09:28] <wycats> aren't if statements "a failure in programming" like exceptions and null
[16:09:30] <wycats> I kid I kid
[16:09:47] <huon> computed gotos for everyone
[16:10:13] <wycats> done
[16:10:14] <wycats> call/cc
[16:10:17] <wycats> done
[17:01:07] *** Joins: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net)
[17:18:05] *** Quits: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net) (Ping timeout)
[17:18:56] *** Joins: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net)
[19:27:28] *** Joins: m-r-r (m-r-r@moz-4FB14902.rev.sfr.net)
[20:05:57] <m-r-r> Hello
[20:07:10] <m-r-r> I've cloned the cargo git repository, but i can't compile it.
[20:07:53] <m-r-r> I have the following error: src/toml/lib.rs:963:47: 963:60 error: mismatched types: expected `std::vec::MoveItems<Value>` but found `std::slice::MoveItems<Value>`
[20:08:26] <m-r-r> What version of rust-toml should-I use, in order to be able to build cargo ?
[20:17:58] *** Quits: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net) (Quit: dherman)
[21:15:07] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[22:41:00] *** o11c|interview is now known as o11c
[22:41:18] *** Quits: o11c (ben@moz-C0FD33EF.a357.priv.bahnhof.se) (Quit: WeeChat 0.4.3-dev)
[22:41:24] *** Joins: o11c (ben@moz-C0FD33EF.a357.priv.bahnhof.se)
[23:58:13] *** Quits: m-r-r (m-r-r@moz-4FB14902.rev.sfr.net) (Client exited)
