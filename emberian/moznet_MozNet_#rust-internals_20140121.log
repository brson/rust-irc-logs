[00:03:47] *** Quits: hansjorg (hansjorg@moz-41C5CE61.redpill-linpro.com) (Ping timeout)
[00:03:47] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[00:03:59] *** Joins: hansjorg (hansjorg@moz-41C5CE61.redpill-linpro.com)
[00:05:54] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[00:24:09] *** Joins: easy_muffin (martin@moz-B02205E9.public.t-mobile.at)
[00:27:42] *** Quits: kimundi (kimundi@moz-AEB7B25C.dip0.t-ipconnect.de) (Ping timeout)
[00:31:11] *** Quits: blank_name (blank_name@E7821509.94CCB18F.53C6B850.IP) (Quit: leaving)
[00:32:48] *** Joins: blank_name (blank_name@E7821509.94CCB18F.53C6B850.IP)
[00:39:29] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[00:39:29] <ghrust> 01[13rust01] 15alexcrichton 04force-pushed 06snap-stage3 from 14bf3743c to 14b6400f9: 02http://git.io/f3Qwfg
[00:39:29] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[00:41:40] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[00:41:40] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/vDLdQw
[00:41:40] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[00:46:28] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[00:46:28] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/D9LSvw
[00:46:28] <ghrust> 13rust/06auto 14188167c 15Matthias Einwag: Introduced a chapter that describes how to perform callbacks from C to Rust
[00:46:28] <ghrust> 13rust/06auto 1467d83ac 15Matthias Einwag: Further details on channel idea
[00:46:28] <ghrust> 13rust/06auto 14393191d 15Matthias Einwag: Update guide-ffi.md...
[00:46:31] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[00:46:51] *** Joins: zz_kimundi (kimundi@moz-372D6D0F.dip0.t-ipconnect.de)
[00:46:54] *** zz_kimundi is now known as kimundi
[00:56:29] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[00:56:30] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14b0bcb00 to 14b6400f9: 02http://git.io/N3iJvQ
[00:56:30] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[00:56:32] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[00:56:32] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/JmrcWA
[00:56:32] <ghrust> 13rust/06auto 14caa321a 15Alex Crichton: Don't emit landing pads with -Z no-landing-pads...
[00:56:32] <ghrust> 13rust/06auto 1494236fc 15bors: auto merge of #11653 : alexcrichton/rust/issue-11647, r=luqmana...
[00:56:33] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[01:00:39] <vadimcn> klutzy: ping
[01:00:48] <klutzy> vadimcn: pong
[01:01:17] <vadimcn> do we currently have a #[cfg()] switch to distinguish win32 and win64?
[01:01:39] <acrichto> vadimcn: target_arch ?
[01:01:41] <klutzy> #[cfg(windows, target_arch = "x86")] / "x64"
[01:01:48] <acrichto> os = win32 in all cases I think
[01:02:00] <acrichto> klutzy has a better suggestion :P
[01:03:25] <vadimcn> acrichto: well, I can see both being used in rust source
[01:03:46] <acrichto> win64?
[01:03:58] <acrichto> oh target_os
[01:04:03] <acrichto> eh, I don't think it matters too much
[01:04:03] <vadimcn> so when should one use #[cfg(windows)] vs #[cfg(target_os=...)] ?
[01:04:07] <acrichto> I like the readability of windows better
[01:04:12] <acrichto> b/c that's what it actually is
[01:09:13] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[01:09:32] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[01:09:54] <klutzy> I don't like target_os = "win32" because it confuses people
[01:10:43] <klutzy> it actually indicates both win32/win64
[01:11:04] <ChrisMorgan> klutzy: I think low-level developers are normally familiar with the fact that win32 does not imply 32-bit
[01:12:02] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[01:13:35] <vadimcn> ChrisMorgan: Well, sometimes is does and sometimes it doesn't.   I'd rather Rust did not continue this confusing practice.
[01:14:23] <vadimcn> I think there should be just cfg(target_os="windows")
[01:16:07] <vadimcn> ... and target_arch used to select 32-bit vs 64-bit.    Or, possibly, there should be a new "bitness" switch, - in case code for other OS also cares about 32/64
[01:16:31] *** Quits: jsonnull (Thunderbir@E86DD23.582C899D.494A0F8B.IP) (Quit: jsonnull)
[01:21:10] <vadimcn> klutzy: whaddayathink?
[01:23:30] <klutzy> I want target_os = "windows"!
[01:28:03] <vadimcn> acrichto: would it be OK to change all cfg(windows) to cfg(target_os="windows") and all cfg(unix) to cfg(not(target_os="windows")) ?
[01:28:41] <vadimcn> ... and all cfg(target_os="win32") to cfg(target_os="windows") too, of course
[01:38:31] *** Quits: easy_muffin (martin@moz-B02205E9.public.t-mobile.at) (Quit: Textual IRC Client: www.textualapp.com)
[01:45:08] <acrichto> vadimcn: hm, win32 => windows would probably need to be discussed
[01:45:19] <acrichto> I dunno why it's win32 and not windows, but I presume that there's some good reason
[01:45:30] <acrichto> unix => not(windows) may not be right in all circumstances though
[01:46:58] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[01:47:05] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Connection reset by peer)
[01:57:23] *** Quits: blank_name (blank_name@E7821509.94CCB18F.53C6B850.IP) (Quit: leaving)
[01:57:59] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[01:59:54] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[02:02:56] <vadimcn> acrichto: the way it's implemented right now, unix == !windows
[02:05:51] <acrichto> that may not be true forever though
[02:06:03] <acrichto> dunno how different things like solaris are
[02:13:28] <notmatt> sorry, what's the question? I've been trying (between domestic disasters) to get the build system to go on illumos.
[02:22:50] *** Quits: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca) (Quit: canhtak)
[02:26:24] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[02:26:25] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/JmrcWA
[02:26:25] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[02:31:39] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[02:31:39] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/emcceg
[02:31:39] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[02:52:05] <jld> Looks like compile-fail/macro-crate-unexported-macro and compile-fail/phase-syntax-doesnt-resolve are broke for target!=host?
[02:52:10] <jld> s/broke/&n/
[02:53:01] <acrichto> jld: how recently have you updated?
[02:53:04] <acrichto> that should be fixed on master
[02:53:31] <jld> acrichto: d4640f9d661ac293bce5f5bc9f8e9150d363e178
[02:55:17] <acrichto> hm, that should be fixed by that point
[02:55:28] <acrichto> unless you're running [pretty] tests
[02:55:33] <acrichto> in which case it was fixed in a later commit
[02:55:46] <jld> This imake: *** [tmp/check-stage2-T-i686-unknown-linux-gnu-H-x86_64-unknown-linux-gnu-cfail.ok] Error 101
[02:56:03] <jld> s/^......//
[02:56:18] <acrichto> hmm...
[02:56:20] <acrichto> that's disturbing
[02:56:26] <jld> This is just `make check`, with x86_64 and i686 targets.
[02:56:36] <acrichto> I've got snaps running that should fail there as well
[02:56:42] <acrichto> but they've both been running for quite ahwile
[02:57:11] <jld> Maybe the patch I'm trying to test is broken in some really subtle way.
[03:05:09] *** Joins: c-a (c-a@moz-8D7A06D6.a163.priv.bahnhof.se)
[03:07:08] *** Joins: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca)
[03:13:01] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[03:21:53] *** Quits: c-a (c-a@moz-8D7A06D6.a163.priv.bahnhof.se) (Ping timeout)
[03:22:21] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[03:39:53] *** Quits: kimundi (kimundi@moz-372D6D0F.dip0.t-ipconnect.de) (Ping timeout)
[03:44:00] *** Joins: zz_kimundi (kimundi@moz-BEFFE5BF.dip0.t-ipconnect.de)
[03:44:01] *** zz_kimundi is now known as kimundi
[03:50:56] *** Joins: blank_name (blank_name@E7821509.94CCB18F.53C6B850.IP)
[03:51:41] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[04:01:33] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[04:01:33] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/k-4kPw
[04:01:33] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[04:06:25] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[04:06:25] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/J9HIgw
[04:06:25] <ghrust> 13rust/06auto 141f542cd 15Alex Crichton: Fix a pathological const checking case...
[04:06:25] <ghrust> 13rust/06auto 1480a2306 15bors: auto merge of #11662 : alexcrichton/rust/faster-parens, r=huonw...
[04:06:26] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[04:06:28] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[04:06:28] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/XUTJUA
[04:06:28] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[04:19:01] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[04:23:53] *** Joins: lpy (lpy@7FD2B9AB.3720F6C5.952560D4.IP)
[04:24:59] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[04:25:38] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[04:37:47] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[04:40:12] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[04:41:28] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[04:42:27] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[04:42:27] *** ChanServ sets mode: +ao pcwalton pcwalton
[04:55:59] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[05:06:33] *** Quits: new_one (new_one@1E1119CE.47460DF6.B3C0173E.IP) (Quit: leaving)
[05:09:44] *** Quits: Kxepal (Miranda@moz-77F2B717.pppoe.mtu-net.ru) (Ping timeout)
[05:09:48] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[05:09:48] *** ChanServ sets mode: +ao pcwalton pcwalton
[05:12:56] *** Joins: Kxepal (Miranda@moz-10D65211.pppoe.mtu-net.ru)
[05:17:55] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[05:21:29] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[05:21:30] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/J9HIgw
[05:21:30] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[05:26:26] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[05:26:26] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/teHe7w
[05:26:26] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[05:26:28] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[05:26:28] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/dXzw_Q
[05:26:28] <ghrust> 13rust/06auto 14ec2b8c5 15Andre Arko: document file!
[05:26:28] <ghrust> 13rust/06auto 14e65a8b8 15bors: auto merge of #11674 : indirect/rust/doc_file, r=alexcrichton...
[05:26:28] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[05:36:06] *** Quits: Diamond (dick@moz-80556682.ks.ks.cox.net) (Quit: Leaving.)
[05:36:11] <jld> acrichto: Still broken at 94236fc078474a48fe516394b472027d6b7f66d4.  I guess I could try deleting the entire build directory and reconfiguring from scratch?
[05:36:19] *** Joins: brson (brson@moz-5386576F.sd.sd.cox.net)
[05:36:19] *** ChanServ sets mode: +qo brson brson
[05:37:05] <jld> Hm.  http://buildbot.rust-lang.org/builders/auto-linux-64-x-android-t/builds/651/steps/test/logs/stdio looks similar.
[05:38:50] <jld> ...but the failures that stop right before https://github.com/mozilla/rust/commit/e594acad5f85696ef114999c824acd96950d34b3 look more similar.
[05:38:58] *** Joins: doomlord_ (servitor@moz-D9C46C01.range86-184.btcentralplus.com)
[05:39:38] <jld> Oh.  xfail-android.  
[05:40:07] <jld> That is not maximally helpful for non-Android cross tests, I expect.
[05:46:22] <acrichto> jld: hm, we just had a snapshot succeed so I would imagine that most standard cross-compile situations are working
[05:47:19] <jld> acrichto: The build succeeds, but some of the tests don't work (for the non-host target(s)) because they can't find libsyntax
[05:47:34] <acrichto> jld: we run make check for all targets as well for snaps
[06:02:15] *** Quits: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca) (Quit: canhtak)
[06:10:15] <sfackler> acrichto: do you have any idea how the rust makefile reloads itself after rerunning configure?
[06:10:30] <acrichto> sfackler: it doesn't
[06:10:37] <acrichto> not to my knowledge at least
[06:10:43] <acrichto> I've run into a bunch of bugs related to that
[06:10:47] <sfackler> ah
[06:14:35] *** Joins: jdm (jdm@moz-BDD802ED.hfc.comcastbusiness.net)
[06:20:09] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[06:20:54] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[06:22:06] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[06:22:31] *** Quits: brson (brson@moz-5386576F.sd.sd.cox.net) (Quit: leaving)
[06:32:56] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[06:33:08] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[06:34:05] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[06:38:38] <jld> test [codegen] codegen/iterate-over-array.rs                ... task '<main>' failed at 'Unhandled condition: io_error: io::IoError{kind: FileNotFound, desc: "no such file or directory", detail: None}', /home/jld/src/rust/src/libstd/condition.rs:139
[06:41:23] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[06:41:23] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/dXzw_Q
[06:41:24] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[06:46:20] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[06:46:20] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/v7s4gQ
[06:46:20] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[06:46:26] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[06:46:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/1D6sOA
[06:46:26] <ghrust> 13rust/06auto 141089bfe 15Flavio Percoco: Fix documentation typos
[06:46:26] <ghrust> 13rust/06auto 14813db08 15bors: auto merge of #11684 : FlaPer87/rust/doc_typos, r=cmr
[06:46:27] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[07:29:37] *** Quits: lpy (lpy@7FD2B9AB.3720F6C5.952560D4.IP) (Client exited)
[08:02:00] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[08:02:00] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/1D6sOA
[08:02:00] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[08:06:27] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[08:06:27] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/rqXInQ
[08:06:27] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[08:14:49] *** flaper87|afk is now known as flaper87
[08:21:40] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[08:24:27] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[08:25:10] *** Joins: lpy (lpy@25DD02B9.D19CEE75.952560D4.IP)
[08:26:47] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[08:29:12] *** Joins: mankyKitty (Instantbir@moz-9B898D95.enst-bretagne.fr)
[08:29:59] *** Quits: jdm (jdm@moz-BDD802ED.hfc.comcastbusiness.net) (Quit: Lost terminal)
[08:31:10] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[08:31:31] <flaper87> why are 0-sized structs preferred over attributes? https://github.com/alexcrichton/rust/commit/6ca9ca878df7c85f88430e10007d43397b7ea108
[08:31:38] <flaper87> acrichto: ^ (or anyone)
[08:31:54] <acrichto> flaper87: see https://github.com/mozilla/rust/issues/10834#issuecomment-29981957
[08:32:06] <flaper87> acrichto: thanks :)
[08:32:25] <flaper87> acrichto: ok, those are definitely good points :D
[08:39:20] *** Quits: lpy (lpy@25DD02B9.D19CEE75.952560D4.IP) (Client exited)
[08:46:39] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[09:05:01] *** Quits: Edwards (MeltdownMo@moz-B62E1D6B.members.linode.com) (Ping timeout)
[09:05:01] *** Quits: dbussink (dbussink@moz-E0A5568C.bussink.me) (Ping timeout)
[09:05:23] *** Quits: ggherdov_ (sid11402@moz-E77DEB21.irccloud.com) (Ping timeout)
[09:05:50] *** Quits: km (quassel@moz-777F24DE.kevinmehall.com) (Ping timeout)
[09:05:53] *** Joins: km (quassel@moz-777F24DE.kevinmehall.com)
[09:06:29] *** Joins: ggherdov_ (sid11402@moz-E77DEB21.irccloud.com)
[09:06:30] *** Quits: friggle (friggle@moz-A607EAFA.members.linode.com) (Ping timeout)
[09:07:34] *** Joins: Edwards (MeltdownMo@moz-B62E1D6B.members.linode.com)
[09:08:26] *** Joins: dbussink (dbussink@moz-E0A5568C.bussink.me)
[09:09:53] *** Joins: friggle (friggle@moz-A607EAFA.members.linode.com)
[09:21:51] <flaper87> acrichto: still around? got some minutes?
[09:22:12] <acrichto> flaper87: sure
[09:22:47] <flaper87> acrichto: so, I already have some things done for: https://github.com/mozilla/rust/issues/10577
[09:23:04] <flaper87> acrichto: static items can't have destructors anymore
[09:23:30] <flaper87> acrichto: now, that works but it obviously prevents rust from compiling because the atomic static items have the NonCOpyable stuff
[09:23:56] <flaper87> I started working on the no_copy attribute as discussed in the issue
[09:24:13] <acrichto> you'll want https://github.com/mozilla/rust/pull/11697
[09:24:25] <acrichto> we're moving away from attributes
[09:24:38] <acrichto> you could rebase your changes on that PR
[09:24:51] <acrichto> and make the stage0 NoPod just an empty struct of no importance to allow bootstrapping
[09:25:11] <flaper87> acrichto: exactly what I wanted to ask :)
[09:25:18] <acrichto> hehe
[09:25:43] <flaper87> I wasn't sure about the whole attribute thing, and it didn't make the impl simpler. 
[09:25:51] <flaper87> cool, I guess I'll help reviewing your patch 
[09:26:06] <flaper87> and hopefully it'll land soon. I'll need it to change atomics
[09:26:18] <flaper87> erm, you already did
[09:26:20] <acrichto> feel free to just include my patch in your local branch
[09:26:26] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[09:26:26] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/zNc3Eg
[09:26:26] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[09:26:30] <acrichto> you can add commits on top of it
[09:26:49] <flaper87> yup
[09:27:01] <flaper87> acrichto: thanks
[09:27:17] <acrichto> np
[09:28:46] <flaper87> acrichto: out of curiosity. did you read the review checklist I wrote? I just want to make sure it's aligned with what we all should be doing
[09:28:50] *** Joins: rca (rcatolino@moz-18AEB6AE.adsl.proxad.net)
[09:29:43] <acrichto> I took a quick glance at it yeah, lemme go read it again
[09:30:03] <flaper87> acrichto: no hurries, whenever you have time
[09:31:31] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[09:31:31] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/eLDTXA
[09:31:31] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[09:31:34] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[09:31:34] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/UKtgiw
[09:31:34] <ghrust> 13rust/06auto 14cb12de1 15Alex Crichton: Register new snapshots...
[09:31:34] <ghrust> 13rust/06auto 1440df5a2 15bors: auto merge of #11699 : alexcrichton/rust/snapshot, r=huonw...
[09:31:34] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[09:31:58] <acrichto> flaper87: seems reasonable yeah
[09:33:29] <flaper87> acrichto: cool, thanks
[09:34:13] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[09:54:32] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[10:02:23] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[10:02:28] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[10:05:54] *** Quits: Kxepal (Miranda@moz-10D65211.pppoe.mtu-net.ru) (Quit: Kxepal)
[10:06:10] *** Joins: Kxepal (Miranda@moz-10D65211.pppoe.mtu-net.ru)
[10:19:04] <eddyb> when's the meeting?
[10:19:17] <eddyb> acrichto: is this week overflowing again?
[10:19:40] *** Quits: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP) (Ping timeout)
[10:23:20] <pnkfelix> eddyb: the meeting is in 7.5 hours
[10:25:01] <eddyb> pnkfelix: thanks, relative time is awesome :D
[10:25:35] <pnkfelix> eddyb: yes at this point I think it is the only way I can hope to unambiguously communicate with my fellowearthlings.
[10:25:55] <pnkfelix> eddyb: (hopefully everyone else keeps timestamps on each msg the way I do.  :)
[10:26:03] <eddyb> 7:30pm here. will try to keep that in mind in case I have items on the agenda
[10:26:13] <eddyb> actually, no, 8pm, even easier to remember
[10:26:53] <eddyb> pnkfelix: I think I have timestamped IRC logs from since I was 13 or so :P
[10:27:15] <pnkfelix> eddyb: you just failed the relative time test.  ;)
[10:27:39] <eddyb> pnkfelix: I skipped the minutes like a noob
[10:27:42] <pnkfelix> eddyb: (I'm pretty sure you are > 16, but other than that I have no clue. :)
[10:28:24] <eddyb> pnkfelix: I wish I was younger, but hey, can't stop time
[10:28:36] <pnkfelix> eddyb: not that I need to know your.  Just thought it was funny instance of "absolute time"
[10:28:42] <pnkfelix> *your age
[10:28:43] <eddyb> OOOH
[10:28:54] <eddyb> I thought you referred to me derping up about the minutes. heh
[10:29:16] <eddyb> 5 years ago. oh, the nostalgia. writing an USB stack. much fun
[10:29:47] <eddyb> I may still be the youngest Rust contributor, I don't know for sure
[10:31:59] <eddyb> pnkfelix: pffft you've caught me in a random emotional moment. now I feel like I have to say how Rust is the only thing I have going for me now
[10:32:30] *** Joins: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP)
[10:33:43] <eddyb> it is a privilege to be part of this community
[10:34:06] <pnkfelix> eddyb: and you got named Friend-of-the-Tree last week to boot
[10:34:21] <eddyb> pnkfelix: yeah, that was very nice :)
[10:36:11] <eddyb> @str2440 = internal constant [5 x i8] c"uniq\00"
[10:36:31] <eddyb> why do we add \0 at the end of string constants?
[10:37:09] <eddyb> we don't support that usecase, so why do it?
[10:37:47] <pnkfelix> eddyb: maybe its an artifact from back when we did attempt to have our str backing representation be compatible with C strings?
[10:38:41] <eddyb> /call|invoke is my new favorite less command
[10:39:23] <ChrisMorgan> In what world does \00 mean NUL? \000 (octal) I know, \x00 (hexadecimal) and \0 (straight NUL) I know, but what is this?
[10:39:31] <eddyb> ChrisMorgan: LLVM-specific
[10:39:39] * ChrisMorgan presumed it was so
[10:39:40] <eddyb> probably \XX
[10:39:46] <eddyb> like \x00
[10:40:16] <eddyb> strcat would approve of my abuse of abort instead of unwinding
[10:40:30] <eddyb> failure is pricey
[10:41:32] <eddyb> especially when you have a path potentially triggering an assert (which uses fail! with formatting) inside formatting code
[10:44:11] <eddyb> how can a function that doesn't use invoke still be considered as potentially unwinding?
[10:50:58] <eddyb> oh, I forgot something: acrichto, dbaupp: with my string builder magic trick, it's actually possible to do something like format_args!(|args| this.run_args(this, then), "Some({})", contents); in an implementation of fmt::Default (or any other formatting trait)
[10:51:25] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[10:51:25] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/UKtgiw
[10:51:25] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[10:51:27] <eddyb> s/this, then/args, then/
[10:52:00] <eddyb> that is, inser an arbitrary recursive stream of arguments in the middle of another formatting operation
[10:52:02] *** Joins: easy_muffin (martin@moz-B02205E9.public.t-mobile.at)
[10:53:02] <mankyKitty> That moment when you pick a beginner issue and you feel like there should be something lower.. -.- 
[10:53:06] * mankyKitty feels awkward
[10:53:45] <eddyb> task 'rustc' failed at 'ty_self not found in substs', /home/rustbuild/src/rust-buildbot/slave/snap3-linux/build/src/libstd/option.rs:111
[10:53:48] <eddyb> come on...
[10:54:17] <pnkfelix> mankyKitty: which are you working on?
[10:54:23] <kimundi> mankyKitty: Eh, don't worry, beginner issues doesn'T mean its easy to do, just that its one of the easier ones :)
[10:54:53] <kimundi> Everything you can just do a patch for in an afternoon tends to get taken fast :P
[10:55:03] <rca> mankyKitty: this was about the patterns in extern code? if it helps i've noticed that only invalid patterns seem to ice.
[10:55:25] <mankyKitty> It's just the traditional 'deep end' jitters... good will come of it.. link inc, sec
[10:55:36] <mankyKitty> https://github.com/mozilla/rust/issues/10877
[10:55:37] <eddyb> I want a value iterator now :(
[10:55:45] <eddyb> this is painful to work with
[10:56:32] <eddyb> fn next<F: Formatter, I: Iterator<&Argument<F>>> // why does it want a lifetime for &Argument?
[10:57:38] <kimundi> eddyb: Because it always wants lifetimes, and not wanting one is just a special convenience case.
[10:57:50] <eddyb> it ICEs with a lifetime
[10:58:05] <kimundi> Oh, hm
[10:58:12] <eddyb> bench.rs:35:9: 35:13 error: internal compiler error: Cannot relate bound region: ReLateBound(66, BrNamed(syntax::ast::DefId{crate: 0u32, node: 97u32}, a)) <= ReFree(147, BrAnon(2))
[10:58:34] <dbaupp> eddyb: https://github.com/mozilla/rust/issues/5121
[10:59:00] <eddyb> so how do I write a function generic over an iterator?
[10:59:32] <kimundi> fn foo<A, I: Iterator<A>>(iter: I)
[10:59:43] <kimundi> fn foo<I: Iterator<uint>>(iter: &mut I)
[10:59:46] <eddyb> kimundi: except I know the type inside
[10:59:50] <kimundi> both ought to work
[10:59:51] <eddyb> and it's a &Trait
[11:00:01] <eddyb> it wants &'a Trait and that breaks
[11:00:10] <kimundi> fn foo<'a, I: Iterator<&'a Trait>>(iter: &mut I)
[11:00:14] <kimundi> should work
[11:00:18] <kimundi> if it doesn't, its a bug
[11:00:31] <eddyb> dbaupp: it's weird because it doesn't look related to that one
[11:00:39] <eddyb> I don't have Trait<'a> anywhere
[11:01:22] <eddyb> rusti: fn foo<'a, I: Iterator<&'a Clone>>(_iter: &mut I){} foo(&mut (~[&0 as &Clone]).iter())
[11:01:26] -rusti- pastebinned 16 lines of output: http://ix.io/a1W
[11:01:39] <eddyb> rusti: fn foo<'a, I: Iterator<&'a Clone>>(_iter: &mut I){} foo(&mut (~[&0 as &Clone]).move_iter())
[11:01:42] -rusti- pastebinned 8 lines of output: http://ix.io/a1X
[11:01:50] <eddyb> kimundi: ^^
[11:01:56] <dbaupp> eddyb: well, the error message is the same, so they're probably related in some way.
[11:02:03] <kimundi> Clone doesn'T work as a trait object
[11:02:25] <eddyb> rusti: trait Foo{} impl<T> Foo for T{} fn foo<'a, I: Iterator<&'a Foo>>(_iter: &mut I){} foo(&mut (~[&0 as &Foo]).move_iter())
[11:02:27] -rusti- pastebinned 8 lines of output: http://ix.io/a1Y
[11:04:08] *** Quits: kimundi (kimundi@moz-BEFFE5BF.dip0.t-ipconnect.de) (Ping timeout)
[11:04:15] <mankyKitty> @rca So I need to ensure that a failed check in that fn just errors properly? (and write some tests for it) 
[11:04:34] <eddyb> hmpf, there's one other way to do it :)
[11:04:36] <eddyb> screw iterators
[11:05:09] <mankyKitty> hehe
[11:06:40] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Client exited)
[11:06:53] <eddyb> dragging slice around - I'm expecting this to be inlined anyway
[11:07:05] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[11:07:47] *** Joins: kimundi (kimundi@moz-BEFFE5BF.dip0.t-ipconnect.de)
[11:08:19] <eddyb> hey, it's even shorter :)
[11:09:17] <eddyb> and now I need once stack closures :(
[11:09:52] <eddyb> or use procs. but I don't want to make this even harder for LLVM
[11:10:56] <eddyb> rusti: let f = |x|x; let g = |x|f(x);
[11:10:58] -rusti- pastebinned 7 lines of output: http://ix.io/a1Z
[11:11:12] <eddyb> rusti: let f = |x: int|x; let g = |x|f(x);
[11:11:13] -rusti- <anon>:10:32: 10:33 warning: unused variable: `g`, #[warn(unused_variable)] on by default
[11:11:13] -rusti- <anon>:10         let f = |x: int|x; let g = |x|f(x);
[11:11:13] -rusti-                                          ^
[11:11:13] -rusti- ()
[11:11:24] <eddyb> rusti: let f = |x: int|x; let g = |x|f(x); (f(0), g(0))
[11:11:25] -rusti- (0, 0)
[11:11:35] <eddyb> why does *that* work?
[11:12:16] <kimundi> eddyb: why shouldn't it?
[11:12:21] <eddyb> rusti: fn foo(_: |int|->int){} let f = |x: int|x; let g = ||foo(f); (f(0), g())
[11:12:24] -rusti- pastebinned 7 lines of output: http://ix.io/a20
[11:12:34] <eddyb> kimundi: sorry, wrong testcase
[11:13:38] <eddyb> this is annoying. and all the closures are to be called only once, so I'm not violating any safety rules :/
[11:14:10] <kimundi> Sounds like a time for Option dances! :P
[11:14:43] <eddyb> oh dear
[11:15:17] <eddyb> kimundi: haha that worked, thanks
[11:15:31] <eddyb> but take_unwrap will introduce unwinding again
[11:16:03] <kimundi> yeah - it will never trigger it though
[11:16:14] <eddyb> format_ng is twice as fast as format! :D
[11:16:38] <eddyb> for format!("{}{}", "foo", "bar"); and with some logic stripped out
[11:17:45] <eddyb> "error: cannot call a method whose type contains a self-type through an object" with my self/env PR - how come no tests caught that?
[11:18:11] <eddyb> the trait is: trait Argument<F: Formatter> {fn fmt(&self, f: &mut F, then: |&mut F|);}
[11:21:31] <rca> mankyKitty: I don't know the internals of the compiler very well, but there must be somewhere where ForeignItemFn get treated differently ItemFn. With paterns in normal function beeing checked (walk_pat) and patterns in foreign fn being checked differently. Also if you haven't already, getting a stacktrace of the failure helps to find out where stuff went wrong.
[11:22:11] <eddyb> also RUST_LOG can provide interesting information, but only enable a small subset
[11:22:17] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[11:22:17] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/64qyxw
[11:22:17] <ghrust> 13rust/06auto 143901228 15Huon Wilson: rustc: add lint for parens in if, while, match and return....
[11:22:17] <ghrust> 13rust/06auto 1439713b8 15Huon Wilson: Remove unnecessary parentheses.
[11:22:17] <ghrust> 13rust/06auto 14c1e97e7 15bors: auto merge of #11663 : huonw/rust/paren-lint, r=cmr...
[11:22:18] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[11:24:15] <dbaupp> mankyKitty: -Z time-passes will "list" the various passes the compile does so you can get a grounding in what's going on where with that
[11:24:28] <dbaupp> (i.e. `rustc -Z time-passes hello-world.rs`)
[11:27:36] *** Joins: gwty (gwtypc@BDE8475B.1113450E.6BE1A500.IP)
[11:33:33] *** Quits: mankyKitty (Instantbir@moz-9B898D95.enst-bretagne.fr) (Ping timeout)
[11:44:34] *** Quits: gwty (gwtypc@BDE8475B.1113450E.6BE1A500.IP) (Ping timeout)
[11:46:28] *** Joins: gwty (gwtypc@E0368333.E280EF48.EF1555B.IP)
[11:47:11] <eddyb> #[inline(always)] doesn't change anything, does that mean I've passed all the thresholds?
[11:52:09] *** Joins: jensnockert (jensnocker@moz-33279404.customers.ownit.se)
[11:52:33] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[11:54:18] *** Quits: jensnockert (jensnocker@moz-33279404.customers.ownit.se) (Ping timeout)
[11:56:02] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[12:08:26] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[12:08:27] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[12:08:42] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[12:13:27] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Input/output error)
[12:13:57] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[12:15:42] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Ping timeout)
[12:26:16] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[12:26:17] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/-j2I8g
[12:26:17] <ghrust> 13rust/06auto 143901228 15Huon Wilson: rustc: add lint for parens in if, while, match and return....
[12:26:17] <ghrust> 13rust/06auto 1439713b8 15Huon Wilson: Remove unnecessary parentheses.
[12:26:17] <ghrust> 13rust/06auto 1443cffe9 15bors: auto merge of #11663 : huonw/rust/paren-lint, r=cmr...
[12:26:18] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[12:33:08] *** Joins: mankyKitty (Instantbir@moz-9B898D95.enst-bretagne.fr)
[12:33:45] <eddyb> hmm, can we have ||:NoUnwind? sounds tempting to me
[12:33:47] <mankyKitty> rca, dbaupp: Thank you! (sorry was out to lunch) :)
[12:35:33] *** Joins: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca)
[12:35:39] *** kimundi is now known as zz_kimundi
[12:36:22] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Connection reset by peer)
[12:40:49] <eddyb> dbaupp: LOL, we're missing --passes always-inline
[12:41:05] <eddyb> so #[inline(always)] does nothing more than #[inline]
[12:47:25] <eddyb> now I need #[inline(always)] for closures
[12:51:49] <dbaupp> eddyb: are you sure?
[12:52:03] <eddyb> dbaupp: yeah
[12:53:18] <dbaupp> eddyb: well, `fn foo() {} fn main() { foo() }` doesn't inline it with no opts
[12:53:27] <dbaupp> but *does* if I add #[inline(always)]
[12:53:43] <eddyb> dbaupp: does it get inlined with #[inline]?
[12:54:24] <dbaupp> no
[12:54:57] <eddyb> hmm, maybe our optimization order is wrong
[12:55:23] <eddyb> a few days ago I wanted to find the list of passes we run, because I remember it was somewhere in rustc, and for the life of me I couldn't find it
[13:09:02] *** Quits: easy_muffin (martin@moz-B02205E9.public.t-mobile.at) (Ping timeout)
[13:11:51] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[13:12:06] *** Quits: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca) (Quit: canhtak)
[13:21:24] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[13:24:46] *** Joins: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca)
[13:24:53] *** Quits: benh (ben@moz-4A0366D2.org) (Ping timeout)
[13:25:13] *** Quits: hansjorg (hansjorg@moz-41C5CE61.redpill-linpro.com) (Ping timeout)
[13:25:55] *** Joins: benh (ben@moz-4A0366D2.org)
[13:30:57] *** Joins: hansjorg (hansjorg@moz-41C5CE61.redpill-linpro.com)
[13:36:15] *** Quits: gwty (gwtypc@E0368333.E280EF48.EF1555B.IP) (Ping timeout)
[13:41:17] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[13:41:17] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/-j2I8g
[13:41:17] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[13:41:26] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[13:44:54] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[13:53:37] *** Joins: sigma (sigma@moz-1C81041B.range86-184.btcentralplus.com)
[13:57:12] *** Joins: jensnockert (jensnocker@moz-33279404.customers.ownit.se)
[13:58:06] *** Quits: sigma (sigma@moz-1C81041B.range86-184.btcentralplus.com) (Client exited)
[13:59:00] *** Quits: jensnockert (jensnocker@moz-33279404.customers.ownit.se) (Ping timeout)
[14:23:49] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[14:28:42] *** Joins: easy_muffin (martin@moz-1337D3CC.public.t-mobile.at)
[14:32:40] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[14:33:12] *** Quits: easy_muffin (martin@moz-1337D3CC.public.t-mobile.at) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[14:33:21] *** Joins: easy_muffin (martin@moz-1337D3CC.public.t-mobile.at)
[14:34:32] <strcat> acrichto: hm, I didn't expect splitting commits to be so easy
[14:34:34] <strcat> heh
[14:34:54] <strcat> you've taught me a bad habit, going to have to obsessively split things into meaningful standalone chunks now
[14:35:40] *** Quits: easy_muffin (martin@moz-1337D3CC.public.t-mobile.at) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[14:35:51] *** Joins: easy_muffin (martin@moz-1337D3CC.public.t-mobile.at)
[14:36:07] <eddyb> strcat, acrichto: I may have just achieved dead-store optimization with formatting. in any case, the generated code for something like format!("{}{}{}{}", "foo", "bar", "baz", "moo"); should be a malloc followed by 4 memcpys, much smaller than the format argument setup code
[14:36:30] <eddyb> s/optimization/elimination
[14:36:32] *** Quits: easy_muffin (martin@moz-1337D3CC.public.t-mobile.at) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[14:36:57] <eddyb> strcat: btw, alwaysinline is (somewhat) broken
[14:37:08] <strcat> when is it ever broken?
[14:37:26] <eddyb> I have to run rustc with --passes always-inline and opt with -O3 -always-inline
[14:37:44] <strcat> hm?
[14:37:51] <eddyb> and then it doesn't do constant folding and whatnot after inlining the functions marked with alwaysinline
[14:38:05] <strcat> because it appends passes
[14:38:09] <eddyb> (so I have to assume it gets ran at the end)
[14:38:19] <strcat> what makes you say it's broken though?
[14:38:34] <eddyb> if we do it, we do it in the wrong place
[14:38:38] <strcat> eddyb: no
[14:38:44] <strcat> eddyb: inline is iterative
[14:38:55] <eddyb> hmm?
[14:38:57] <strcat> but that doesn't mean running optimization passes at the end won't catch more
[14:39:05] <strcat> eddyb: some passes retrigger inlining
[14:39:09] <strcat> eddyb: that doesn't mean ALL changes do
[14:39:25] <strcat> eddyb: it can change the code in a way that permit inlining, but without trying it again
[14:39:29] *** Joins: c-a (c-a@moz-8D7A06D6.a163.priv.bahnhof.se)
[14:39:33] <strcat> eddyb: it is based on heuristics
[14:39:37] <strcat> it can't afford to keep trying
[14:39:41] <eddyb> I guess my functions calls were the result of devirtualization
[14:39:55] <eddyb> strcat: yes, but that's why I used #[inline(always)]
[14:40:04] <strcat> instcombine will often be the thing that devirtualizes and I doubt it triggers inlining agaib
[14:40:11] <eddyb> pffft
[14:40:13] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[14:40:13] <strcat> eddyb: inline(always) is not different than regular inline
[14:40:16] <strcat> eddyb: just means 'ignore cost'
[14:40:28] <strcat> eddyb: it's no more likely to succeed when it's below the threshold
[14:40:37] <eddyb> I've been told it's handled by another pass (always-inline)
[14:40:40] <strcat> if a function is below the threshold, it is inlined if possible
[14:40:47] <strcat> eddyb: that pass is not run at -O2 and -O3
[14:40:52] <eddyb> at all?
[14:40:55] *** Joins: new_one (new_one@A5C477B8.E8B7FFCF.B3C0173E.IP)
[14:40:56] <strcat> eddyb: it runs at -O0 and -O1 because they don't run inline
[14:41:04] <strcat> eddyb: again, it's not different than regular inlining
[14:41:09] <strcat> running the pass would not help
[14:41:09] <eddyb> ooooh, I see what you mean
[14:41:15] <strcat> eddyb: the inline pass already handles always inline 
[14:41:25] <strcat> it *also* inlines stuff below the threshold
[14:41:29] <strcat> it's a superset
[14:41:37] <strcat> anyway the problem is that something is turning it into a static call
[14:41:41] <strcat> but inline is not be retriggered
[14:41:44] <strcat> it's not really a bug
[14:41:46] <strcat> just how life is ;p
[14:41:48] <eddyb> riight, I get it now
[14:41:51] <strcat> like
[14:42:00] <strcat> if they think it's very likely that they changed the code in a way that permits inlining
[14:42:10] <strcat> they trigger it again on some subset
[14:42:24] <strcat> but instcombine and similar things run a bunch of times
[14:42:27] <strcat> eddyb: it'll get better
[14:42:39] <strcat> eddyb: atm you can often greatly improve code by running all the passes again....
[14:42:42] <eddyb> so technically I just need to run inline again
[14:42:48] <strcat> eddyb: well, and the other passes
[14:42:50] <strcat> ;p
[14:43:00] <strcat> eddyb: you don't know how far it is when it becomes static
[14:43:14] <eddyb> how can I run the equivalent of opt -O3 via --passes?
[14:43:27] <strcat> eddyb: can't, -O3 sets a higher threshold
[14:43:46] <strcat> -O# includes a set of passes and sets the inlining threshold
[14:43:55] <strcat> only -O2 and -O3 run cost-based inlining
[14:43:58] <strcat> -O3 uses a higher threshold
[14:44:07] <strcat> eddyb: although
[14:44:12] <strcat> you can use -mllvm to pass it to llvm directly
[14:44:13] <eddyb> so the equivalent of -O2 then
[14:44:26] <strcat> eddyb: dunno if you can
[14:44:29] <strcat> eddyb: there are a lot, though
[14:44:32] <eddyb> I want to inline and then run all the passes
[14:44:40] <eddyb> well, let's see what happens with inline and LTO
[14:45:00] <strcat> eddyb: clang foo.c -mllvm -debug-pass=Structure -O2
[14:45:15] <bjz> jensnockert: beep
[14:45:28] <strcat> eddyb: you can't really duplicate it
[14:45:35] <strcat> eddyb: because it runs function passes and then it runs a module pass
[14:45:41] <strcat> and with LTO, there's another LTO module pass
[14:46:00] <eddyb> ./x*/stage0/bin/rustc --test bench.rs --opt-level=3 --passes inline -Z lto
[14:46:11] <eddyb> doesn't make format_ng faster
[14:46:14] <jensnockert> bjz: Boop
[14:46:37] <bjz> jensnockert: could we have flags stored in TLS maybe?
[14:47:09] <bjz> jensnockert: for floating point stuff
[14:47:27] <jensnockert> bjz: No need, there are CPU registers for that.
[14:47:33] <bjz> jensnockert: oh
[14:47:49] <jensnockert> bjz: On context switch they get restored and so on.
[14:47:55] <bjz> jensnockert: to clarify, what do you mean by 'CPU registers'
[14:48:07] <bjz> jensnockert: I should really know this
[14:48:16] <bjz> jensnockert: and 'context switch'
[14:48:41] <bjz> jensnockert: and is there a way for use to access them directly from Rust code?
[14:49:12] <jensnockert> bjz: http://msdn.microsoft.com/en-us/library/yxty7t75.aspx for example.
[14:49:21] <bjz> jensnockert: ok, will have a look
[14:49:21] <jensnockert> bjz: Is the SSE control register on x86
[14:49:45] <bjz> jensnockert: I'm working on a module that has the functionality stuff
[14:49:58] <jensnockert> You should be able to access it via LLVM.
[14:50:01] <bjz> jensnockert: just a skeleton though
[14:50:36] <strcat> jensnockert: btw you can't use rounding mode or fp exceptions
[14:50:47] <jensnockert> strcat: Why not?
[14:50:47] <strcat> LLVM doesn't support it and will optimize in ignorance of it
[14:50:56] <strcat> jensnockert: explicitly unsupported by LLVM
[14:51:15] <strcat> floating point is considered to not read global state or write global state
[14:51:18] <strcat> it is considered pure
[14:51:23] <strcat> and it does constant eval of it too
[14:51:31] <bjz> jensnockert: once we have the API it would be good to have folks helping out to fill this stuff in - using the intrinsics for siome things, and perhaps libm at first
[14:51:48] <strcat> jensnockert: it also doesn't support signalling NaN
[14:51:54] <strcat> need to fix it in LLVM before adding any of it to rust ;p
[14:51:58] <bjz> strcat: hmm ok
[14:52:03] <bjz> strcat: yeek
[14:56:18] <jensnockert> strcat: Clang supports it, so there should be some workaround.
[14:56:27] <strcat> jensnockert: clang doesn't support it
[14:56:58] <strcat> it supports the minimal level necessary from the standard, which means not supporting it but filling it some defines, etc.
[14:57:20] <eddyb> O_O
[14:57:22] <eddyb> clang bench.o -o bench -l pthread -l m -l rustuv-09e0b925-0.10-pre -L ./x*/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/{,librustrt.a}
[14:57:25] <eddyb> this doesn't error
[14:58:13] <eddyb> but now it's dynamically linked against rustuv, great
[14:58:52] <eddyb> clang bench.o -o bench -l pthread -l m ./x*/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/{librustuv-09e0b925-0.10-pre.rlib,librustrt.a}
[14:59:04] <eddyb> strcat: this is awesome, I can use clang to link against .rlib
[14:59:28] <eddyb> and format_ng is still slower... did I miss anything?
[14:59:54] <eddyb> oh, heh, compiled the wrong file
[15:00:14] * cmr regrets even mentioning the ng suffix
[15:00:26] <eddyb> test format_ng  ... bench:         0 ns/iter (+/- 0)
[15:00:33] <eddyb> test uniq       ... bench:       127 ns/iter (+/- 1)
[15:00:56] <eddyb> it's infinitely faster than allocating the result string :P
[15:02:52] <eddyb> strcat: I wonder how many devirtualizations are interrupted by the lack of another inline pass
[15:03:36] <eddyb> at least we have proof that CPS can work in Rust
[15:07:53] <eddyb> (oh, and, every argument was a trait object and it still works fine)
[15:08:32] *** zz_kimundi is now known as kimundi
[15:09:28] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[15:11:13] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Client exited)
[15:11:31] <bjz> jensnockert: yeah I'd really appreciate some guidance on this â€“ if you could maybe do some investigation on our options. I know you are interested in having good floating-point stuff
[15:11:35] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[15:11:56] <pnkfelix> what is the current function to set a breakpoint to break on fail?
[15:12:03] <eddyb> #[inline(never)] fn str_slice_sink(_: &str) {}
[15:12:07] <eddyb> does that not work anymore?
[15:13:28] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Ping timeout)
[15:13:34] <eddyb> nope, it's optimized out :(
[15:14:36] <cmr> pnkfelix: rust_fail
[15:14:53] <jensnockert> bjz, strcat: I cannot see anything on Google that implies that fenv.h doesn't work with Clang?
[15:15:01] <jensnockert> strcat: Do you have a link?
[15:15:17] <strcat> jensnockert: it can certainly read the header...
[15:15:21] <pnkfelix> cmr: ah, yes, thanks.
[15:15:30] <strcat> jensnockert: doesn't mean it works
[15:15:32] <bjz> jensnockert: well, do you have any eveidence it *does*?
[15:15:36] <strcat> it is not *required* to work per the C standard
[15:15:37] <bjz> jensnockert: :P
[15:16:09] <bjz> jensnockert: skepticism sir!
[15:16:51] <eddyb> desperate times call for desperate measures #[inline(never)] fn str_slice_sink(s: &str) {unsafe {*(1 as *mut &str) = s}}
[15:16:54] <strcat> jensnockert: http://llvm.org/bugs/show_bug.cgi?id=8100
[15:17:05] *** Quits: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca) (Quit: canhtak)
[15:17:30] <strcat> jensnockert: http://llvm.org/bugs/show_bug.cgi?id=6050
[15:17:41] <strcat> no fenv, no floating point exceptions, no rounding mode at all
[15:18:01] <strcat> you can certainly set the mode glibc is going to use internally but clang/LLVM won't respect it ;p
[15:18:15] <strcat> you can set the mode for the CPU, but clang/LLVM won't respect that and will ignore it while optimizing
[15:18:22] <strcat> they'll reorder floating point stuff before/after it
[15:18:27] <strcat> they'll constant fold, etc.
[15:18:55] <bjz> strcat: is the IEEE way even decent, or is it a matter of that's what you need to do to work properly with the hardware?
[15:19:25] <strcat> bjz: it's fine, but full IEEE754 support means it's not going to be fast
[15:19:31] <strcat> that's why gcc has switches for this stuff
[15:19:34] <strcat> not all is enabled by default
[15:19:36] <eddyb> cmr, dbaupp, strcat, acrichto: I give you format! "bloat": https://gist.github.com/eddyb/08c1f1a9646616b1bf52 aka I win
[15:19:38] <strcat> and lots that is enabled can be disabled
[15:20:09] <bjz> strcat: should we just say, "screw it, let's not go for full support"
[15:20:32] <strcat> bjz: we can do what gcc does and provide the whole range
[15:20:35] <eddyb> I mean, compare the current code generated by format_args with https://gist.github.com/eddyb/08c1f1a9646616b1bf52#file-format-ll-L168-L192
[15:20:38] <strcat> full IEEE754 conformance if you want
[15:20:43] <strcat> but the ability to tone it down
[15:20:48] <bjz> mmk
[15:20:51] <strcat> even tone it down per-function
[15:21:03] <bjz> attributes?
[15:21:13] <strcat> bjz: LLVM even lets you attach the error you will tolerate to every operation... because IEEE mandates precise results for the basic ops
[15:21:16] <jensnockert> I just ran through the GLIBC test suite for fenv.h, and it passes on clang.
[15:21:25] <strcat> jensnockert: not meaningful, look at the bug reports
[15:21:27] <strcat> it's undefined
[15:21:50] <strcat> 10:19:02      strcat | you can certainly set the mode glibc is going to use internally but clang/LLVM won't respect it ;p
[15:21:52] <strcat> 10:19:16      strcat | you can set the mode for the CPU, but clang/LLVM won't respect that and will ignore it while optimizing
[15:21:54] <strcat> 10:19:23      strcat | they'll reorder floating point stuff before/after it
[15:21:56] <strcat> 10:19:29      strcat | they'll constant fold, etc.
[15:22:18] <jensnockert> Sure, but that is orthogonal to if you can change it with code.
[15:22:21] <strcat> jensnockert: LLVM will *happily* reorder float instructions before/after you set the rounding mode, it considers them to be pure operations not reading or writing any global state
[15:22:24] <strcat> jensnockert: it's not
[15:22:28] <strcat> if you expose it, it needs to work
[15:22:49] <strcat> can't just expose it and say there's absolutely no guarantee it will work
[15:22:57] <strcat> it will change some operations but not others, in unspecified ways
[15:23:06] <strcat> subject to change drastically based on what it decides to inline and so on
[15:23:10] <bjz> strcat: so if we are going to do this, it would require patching llvm?
[15:23:21] <strcat> it's not about patching LLVM
[15:23:23] <eddyb> acrichto: I'm sorry I wasted time instead of finishing the std::fmt rewrite - if only I knew it could get this good :D - but since it works so well (with proper optimizations), I guess it won't need a meeting to decide its inclusion
[15:23:29] <strcat> it wouldn't be something we would ever maintain out-of-tree
[15:23:38] <strcat> bjz: it involves modelling floating point side effects in the LLVM IR
[15:23:47] <bjz> strcat: oh, that's nicer
[15:23:50] <strcat> they are not going to accept considering them impure, it needs to be modelled so in most cases they can optimize
[15:24:01] <strcat> and it is going to need a switch to turn it off
[15:24:09] <bjz> yep
[15:24:16] <eddyb> for -ffast-math or something
[15:24:29] <strcat> eddyb: well -ffast-math includes *all* those switches, some are pretty crazy
[15:24:37] <strcat> you can enable them on a case by case basis
[15:24:48] <strcat> in gcc, you can enable them per-function
[15:24:50] <cmr> as any ricer can tell you, -ffast-math is not a good idea ;p
[15:25:00] <jensnockert> -ffast-math is a bad idea(tm)
[15:25:00] <bjz> jensnockert: how is this sounding to you?
[15:25:01] *** kimundi is now known as zz_kimundi
[15:25:17] <strcat> jensnockert: sure, but the application deciding to relax stuff to get vectorization and so on per function isn't a bad idea
[15:25:25] <eddyb> cmr: -Ofast #yolo
[15:25:31] <strcat> you barely get vectorization of floating point with strict IEEE754 semantics
[15:25:47] <strcat> that's a big part of why compilers can't output anything near the perf of specialized libs
[15:25:50] <strcat> because they don't know what you want
[15:26:45] <jensnockert> strcat: Quite a long way between allowing algebraic transforms and enabling -ffast-math though.
[15:26:54] *** Quits: Kxepal (Miranda@moz-10D65211.pppoe.mtu-net.ru) (Quit: Kxepal)
[15:26:58] <strcat> jensnockert: yes, that's why there are individual flags
[15:27:10] *** Joins: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca)
[15:27:14] <strcat> that's why you can specify an acceptable error per op
[15:27:16] *** Joins: rca_ (rcatolino@moz-5EA2C694.adsl.proxad.net)
[15:27:32] <jensnockert> -fassociative-math is the only sane flag implied by -ffast-math iirc.
[15:27:33] <bjz> strcat: do you think this is something that would be a good idea to push for? or at least provide a backwards compatible foundation for 1.0? is the current state of things backwards compatible?
[15:27:53] <strcat> jensnockert: http://llvm.org/docs/LangRef.html#fast-math-flags
[15:28:01] <jensnockert> I think fenv.h level of support is okay, doesn't have to be in the standard library.
[15:28:13] <strcat> jensnockert: but it's not fenv level of support
[15:28:23] <strcat> jensnockert: fenv is supposed to let you get exceptions from ops like 0 / 0
[15:28:31] <strcat> and it's supposed to let you set the rounding mode
[15:28:36] <strcat> this will *not* work reliably with LLVM
[15:28:40] <jensnockert> No it doesn't.
[15:28:42] *** Quits: rca (rcatolino@moz-18AEB6AE.adsl.proxad.net) (Ping timeout)
[15:28:56] <jensnockert> It allows you to enable exceptions on operations, not constant folding.
[15:29:03] <strcat> not talking about constant folding...
[15:29:11] <strcat> jensnockert: do x / y in your rust code
[15:29:20] <strcat> LLVM provides absolutely no guarantee that it respects a rounding mode you set
[15:29:24] <strcat> it's explicitly broken
[15:29:28] <strcat> intentionally broken
[15:29:44] <jensnockert> You mean, intentionally not implemented.
[15:29:55] <strcat> jensnockert: no it's not about it being not implemented
[15:29:59] <strcat> they could consider floating point ops to be impure
[15:30:03] <strcat> then it would be correct
[15:30:03] <eddyb> it works if LLVM generates *certain patterns of instructions*
[15:30:07] <strcat> but they choose to leave it broken
[15:30:18] <eddyb> but it doesn't in other cases, and you never know
[15:30:33] <strcat> they would much rather generate code competitive in perf with other compilers than worry about full IEEE754 support
[15:30:40] <strcat> eventually, it will support it
[15:30:55] <strcat> but atm it doesn't because they're not going to accept any support for it that doesn't model it in a way that preserves most optimizations
[15:30:57] <strcat> and can be disabled
[15:31:07] <strcat> (or enabled, if it hurts perf a lot)
[15:31:21] <strcat> this isn't a requirement of the C standard so it's just an 'enhancement' to them, not a bug
[15:32:43] *** Joins: sigma (sigma@moz-1C81041B.range86-184.btcentralplus.com)
[15:33:16] <bjz> strcat: so you think there is room to do better than C?
[15:33:27] <strcat> hm?
[15:33:44] <strcat> bjz: well, if you want the same level of support as C via gcc, that requires LLVM work
[15:34:03] <strcat> so no, atm rust can't have competitive IEEE754 support
[15:34:10] *** Quits: sigma (sigma@moz-1C81041B.range86-184.btcentralplus.com) (Client exited)
[15:34:19] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[15:34:24] <bjz> ok, so I'm confused again :[
[15:34:26] <strcat> if you're including exceptions and rounding mode as requirements
[15:34:30] *** Joins: Kxepal (Miranda@moz-10D65211.pppoe.mtu-net.ru)
[15:34:32] <strcat> bjz: what are you confused about?
[15:34:50] <strcat> rust can't support rounding mode + setting/getting floating point exceptions until LLVM makes it well-defined
[15:34:54] <bjz> what we can do without changing llvm, and what we can't
[15:34:55] <strcat> gcc supports it
[15:35:16] <strcat> bjz: can't support changing the rounding mode with specified behaviour for code in rust
[15:35:33] <jensnockert> I still think that setting/getting the mode isn't the problem, signalling that you will read/write it (STD FENV ACCESS ON in C) is the issue.
[15:35:37] <bjz> strcat: what can we do?
[15:35:46] <strcat> jensnockert: it is a problem
[15:35:52] <strcat> jensnockert: LLVM considers floating point math pure
[15:35:58] <eddyb> deja vu?
[15:35:59] <strcat> set_rounding_mode(); do_floating_point_math()
[15:36:03] <strcat> it will reorder that
[15:36:03] <jensnockert> strcat: LLVM considers integer math pure.
[15:36:12] <bjz> strcat: ie. accepting those things, what other parts of the standard are fixable/implementable
[15:36:14] <strcat> jensnockert: and integer math doesn't read a global flag to handle a rounding mode
[15:36:19] <strcat> and it doesn't set exceptions
[15:36:44] <strcat> jensnockert: set_rounding_mode(); do_float_work()
[15:36:48] <strcat> jensnockert: LLVM will happily reorder this
[15:37:04] <strcat> jensnockert: let z = x / y; check_flt_exception()
[15:37:08] <strcat> it will happily reorder that
[15:37:08] <jensnockert> strcat: It writes on x86, and throws exceptions.
[15:37:19] <strcat> jensnockert: LLVM does not model the effects
[15:37:25] <strcat> the optimization passes ignore this
[15:37:31] <strcat> I don't know what you're not getting about what I'm saying
[15:37:56] <strcat> jensnockert: call_c_math_function(); check_for_exception()
[15:37:59] <strcat> jensnockert: unspecified behaviour
[15:38:01] <strcat> why?
[15:38:09] <strcat> because LLVM will happily reorder some of *your* floating point math between it
[15:38:28] <strcat> because it considers floating point math to never read global state and never write global state
[15:38:36] <strcat> it may be reordered, eliminated, etc. anywhere
[15:38:37] <jensnockert> If you read/write the register using volatile asm then it shouldn't reorder?
[15:38:37] *** Joins: ktt3ja (ktt3ja@moz-85E2770C.hsd1.va.comcast.net)
[15:38:41] <strcat> jensnockert: it will reorder
[15:38:45] * bjz has opened can of worms
[15:38:46] <strcat> jensnockert: it considers the floating point math pure
[15:38:48] <jensnockert> Around volatile asm?
[15:38:51] <strcat> jensnockert: yes
[15:38:57] <strcat> jensnockert: the asm is volatile, not the floating point
[15:39:07] * bjz tries to weld said can shut
[15:39:08] <strcat> jensnockert: unless you're saying 'perform all floating point as volatile asm'
[15:39:10] <strcat> sure, that'd work
[15:39:21] <eddyb> I was just going to mention that :P
[15:39:33] <jensnockert> strcat: That isn't a bad idea actually.
[15:39:35] <eddyb> let's implement CheckedAdd for floating-point with inline volatile asm
[15:39:40] <cmr> volatile reordering is only wrt to other volatile.
[15:39:50] <strcat> jensnockert: it means you don't even get dead store elimination though
[15:39:56] <strcat> it can't be on by default
[15:40:07] <jensnockert> strcat: FloatMeHarder32 type.
[15:40:12] <eddyb> hahahaha
[15:40:43] * strcat shrugs ;p
[15:40:49] <strcat> jensnockert: or just a -Z flag
[15:41:06] <strcat> anyway it means you can't use any LLVM intrinsics or any LLVM float ops
[15:41:18] <strcat> and C functions may be a problem because libcalls applies attributes to common C symbols
[15:41:26] <jensnockert> strcat: That isn't much of a loss though.
[15:41:56] <strcat> jensnockert: it's a loss because of the performance hit from opting out of an optimizing compiler ;p
[15:42:14] <strcat> rust is *really* slow without optimizations
[15:42:31] <jensnockert> I doubt Rust speed is much different without floating-point optimizations though.
[15:42:49] <bjz> maybe we should just use GCC as a back end - couldn't be too hard?
[15:42:52] <strcat> jensnockert: not just floating point optimizations you lose
[15:42:56] <eddyb> bjz: shush
[15:42:59] <strcat> jensnockert: you lose even basic optimizations like dead store elimination
[15:42:59] <bjz> ooh
[15:43:02] <jensnockert> Libraries which need correct rounding for non-standard rounding modes might just have to eat that performance cost.
[15:43:04] <strcat> jensnockert: rust generates lots of temporaries, etc.
[15:43:07] <strcat> it won't be able to remove them
[15:43:12] <eddyb> someone is trying to write a custom rust frontend for GCC
[15:43:25] <strcat> eddyb: but they're not using libsyntax/librustc ;\
[15:44:03] <bjz> jensnockert: struct F32(u32);
[15:44:06] <strcat> they could succeed at writing a backend for librustc but they're not going to succeed at reimplementing all of that corectly
[15:44:07] <bjz> :P
[15:44:09] <strcat> correctly*
[15:44:13] <eddyb> they might as well shave yaks for the rest of their life
[15:44:20] *** Quits: Kxepal (Miranda@moz-10D65211.pppoe.mtu-net.ru) (Quit: Kxepal)
[15:44:29] <eddyb> it actually has commercial value
[15:44:33] <strcat> anyway why rewrite a nice thing like librustc in C
[15:44:35] <strcat> ;p
[15:44:41] <strcat> if you think it's bad now...
[15:44:44] <strcat> imagine it in C
[15:44:46] <bjz> haha
[15:45:35] <jensnockert> I still want a float-me-harder type.
[15:45:41] <strcat> anyway I think they are inspired by gcc having a Go frontend but Go is *tiny*
[15:45:56] <jensnockert> I might write one tonight and check out the performance in some randomly designed and totally arbitrary benchmarks.
[15:46:00] <strcat> no type inference, no region stuff, no generics, no metadata
[15:46:09] <strcat> well I guess it does have simple metadata
[15:46:12] * strcat shrugs
[15:46:26] <cmr> jensnockert: yay arbitrary benchmarks!
[15:46:28] * jensnockert hugs strcat for being helpful <3
[15:46:36] <strcat> jensnockert: oh and clang is missing -ffloat-store :)
[15:46:37] <bjz> yay strcat 
[15:46:56] <strcat> jensnockert: but I guess volatile asm solves that too ;p
[15:47:00] * bjz is glad we kept this stray cat
[15:47:21] * bjz pets the little strcat
[15:47:43] * strcat barks
[15:48:01] <bjz> YEEK
[15:48:30] <strcat> bjz: https://www.youtube.com/watch?v=aP3gzee1cps
[15:49:02] <bjz> HAHA
[15:49:05] <bjz> brilliant
[15:49:21] * bjz will imagine strcat like that from now on
[15:50:28] *** Joins: Kxepal (Miranda@moz-10D65211.pppoe.mtu-net.ru)
[15:51:54] <bjz> jensnockert: it would be annoying not being able to use float literals :(
[15:52:13] <jensnockert> bjz: FloatMeHarder32(1.0f32)
[15:52:28] <bjz> ah
[15:59:42] <jensnockert> float_me_harder!(1.0f32)
[16:00:22] *** Joins: nate (pinkeh@moz-B8462C56.members.linode.com)
[16:02:12] *** Joins: easy_muffin (martin@moz-1337D3CC.public.t-mobile.at)
[16:03:27] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Input/output error)
[16:03:58] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[16:05:42] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Ping timeout)
[16:05:49] *** Joins: jdm (jdm@moz-BDD802ED.hfc.comcastbusiness.net)
[16:06:22] *** Quits: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca) (Quit: canhtak)
[16:08:26] *** Joins: erickt (Adium@moz-A9F9654D.keplers.com)
[16:08:51] *** Quits: Kxepal (Miranda@moz-10D65211.pppoe.mtu-net.ru) (Quit: Kxepal)
[16:09:05] *** Joins: Kxepal (Miranda@moz-10D65211.pppoe.mtu-net.ru)
[16:11:59] *** Joins: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca)
[16:15:28] *** Quits: easy_muffin (martin@moz-1337D3CC.public.t-mobile.at) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[16:27:56] *** Quits: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca) (Quit: canhtak)
[16:41:54] *** Quits: new_one (new_one@A5C477B8.E8B7FFCF.B3C0173E.IP) (Client exited)
[16:53:25] *** Joins: lpy (lpy@186AB984.19500BE2.65042015.IP)
[16:54:14] *** Joins: sigma (sigma@moz-1C81041B.range86-184.btcentralplus.com)
[16:58:12] *** Quits: erickt (Adium@moz-A9F9654D.keplers.com) (Quit: Leaving.)
[17:00:30] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[17:00:30] *** ChanServ sets mode: +ao dherman dherman
[17:02:11] *** Quits: lpy (lpy@186AB984.19500BE2.65042015.IP) (Quit: Leaving...)
[17:09:26] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[17:10:34] <acrichto> eddyb: could you explain a little more about the std::fmt rewrite? I looked into this weekend and it looked like the formatting traits got *a lot* more complicated
[17:10:51] <acrichto> sorry I pinged you a couple times but my IRC client was acting up and didn't actually send any messages I think
[17:10:57] <eddyb> it didn't
[17:11:02] *** Joins: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP)
[17:11:19] <eddyb> acrichto: yes, but it dead store eliminates now if I put it through LLVM twice :))
[17:12:03] <acrichto> the optimizations sound super impressive!
[17:12:51] <eddyb> (it's still faster than before, but without the complete inlining caused by optimizing twice - it's hard to get determinstic code sizes)
[17:13:08] <eddyb> acrichto: you saw that it generates less code than before, right?
[17:13:41] <eddyb> it might be uglier in some cases, but we can compare binary sizes if we really want to
[17:13:44] *** Joins: lpy (lpy@186AB984.19500BE2.65042015.IP)
[17:13:45] *** Quits: lpy (lpy@186AB984.19500BE2.65042015.IP) (Client exited)
[17:13:59] <acrichto> my main concern is keeping the std::fmt interface sane
[17:14:02] <pnkfelix> eddyb: where is the PR?  I didn't know there was one posted
[17:14:09] <eddyb> pnkfelix: which PR?
[17:14:21] <pnkfelix> eddyb: i was assuming acrichto was talking about some PR that you had posted
[17:14:43] <pnkfelix> eddyb: based on "looked into this weekend"
[17:14:48] <eddyb> pnkfelix: nope, I gisted my local libstd/fmt/mod.rs
[17:14:53] <pnkfelix> eddyb: oh I see
[17:16:16] <eddyb> acrichto: not a lot more complicated. formatting is now generic over a formatter (you can have FormatToString and FormatToWriter for now - the latter needs a trait object because of that nice task interface *ahem*), and it takes a continuation for which I couldn't find a better name than "then"
[17:17:13] <acrichto> eddyb: yeah the explosion in typing plus a continuation I was very concerned about
[17:17:28] <acrichto> I'm not sure if we have much more CPS throughout the stdlib
[17:17:41] <acrichto> again though, I haven't seen it in its entirety
[17:18:20] <eddyb> acrichto: most format traits' implementations would just pass then along. the mess is inside Formatter's default methods
[17:18:26] *** Joins: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca)
[17:18:43] <acrichto> eddyb: even still there's a higher cognitive burden because it's not just std::fmt implementing the traits
[17:19:25] <eddyb> something like select can actually recurse, iterating over pieces. with my changes, you're recursive over pieces as part of a larger recursion, by threading a continuation through
[17:19:52] <eddyb> acrichto: I did mention I'd like #[must_use] for arguments and stack once fn's
[17:20:10] <acrichto> the optimizations make sense, but we'd need to evaluate whether the perf gain is worth the interface degredation
[17:21:20] <eddyb> sure, though the current state (write!(f.buf, ...)) is not sane either IMO
[17:21:37] *** Quits: sigma (sigma@moz-1C81041B.range86-184.btcentralplus.com) (Client exited)
[17:22:42] <eddyb> for a constant string, you'd write f.append("foo", then); I mentioned using format_args! a couple of times, to format within a format without losing the 0 intermediary heap allocations model
[17:23:09] <pnkfelix> acrichto: eddyb: I'm just inferring from eddyb's comments from past two days, but: Would it help to provide two APIs?
[17:23:18] <pnkfelix> acrichto: eddyb: That is, Is it possible to provide a simple API for those who care not about efficiency, and then a more complicated API for power-users?
[17:23:33] <acrichto> not a bad idea
[17:23:38] <eddyb> pnkfelix: that leads to bad code
[17:23:52] <pnkfelix> eddyb: Bad object code, or bad source code?
[17:23:53] <eddyb> acrichto: I did want to get rid of the continuations from the formatter traits. turns out you need them because of that recursion nonsense in select/plural
[17:24:08] *** Quits: mankyKitty (Instantbir@moz-9B898D95.enst-bretagne.fr) (Quit: mankyKitty)
[17:24:12] <eddyb> pnkfelix: bad source code - like the current state that assumes you're formatting to a &mut Writer
[17:24:24] <acrichto> eddyb: well nothing is using that so we may be able to remove all of it
[17:24:57] <eddyb> not sure if I can still remove the continuation though
[17:25:34] <eddyb> acrichto, pnkfelix: the only issue I see is forgetting to pass then through, everything else should be straight forward
[17:26:02] <acrichto> eddyb: it's hard to comment b/c I don't have a concrete idea of what the new interface is
[17:26:14] <pnkfelix> eddyb: acrichto: Without seeing the code its hard for me to provide much guidance.  I can imagine ways to try to leverage the type system to force the user to pass the continuation along.
[17:26:17] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[17:26:17] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/cTSJZA
[17:26:17] <ghrust> 13rust/06auto 14eca980b 15Alex Crichton: Stop using hardcoded numbers for -Z options...
[17:26:18] <ghrust> 13rust/06auto 1457f8073 15Alex Crichton: Remove obsoleted -Z options...
[17:26:18] <ghrust> 13rust/06auto 14a880777 15Alex Crichton: Purge borrowck from libstd...
[17:26:20] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[17:26:21] <acrichto> I'm skeptical that this is the *only* way to get this optimiztation, but I believe that it is a particular way
[17:26:29] <eddyb> maybe it would help to have the format_to!(f, then, "Some({})", contents) helper macro I mentioned for that usecase?
[17:26:50] <eddyb> acrichto: it's beautiful, in a way that I'm not used to
[17:26:52] <acrichto> I also shied away from generics originally because of the codegen explosion in the client crate
[17:26:54] <pnkfelix> eddyb: anyway, I figured I'd provide my two cents, mostly to second acrichto's concern about overly complicating the interface.
[17:26:54] *** Quits: jdm (jdm@moz-BDD802ED.hfc.comcastbusiness.net) (Quit: Lost terminal)
[17:27:14] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[17:27:22] <eddyb> acrichto: this isn't generic over all writers or anything like that. it's generic over two possible formatters
[17:27:37] <acrichto> eddyb: that still implies a codegen explosion in all client crates
[17:27:58] <eddyb> if it's properly optimized, you're left with no functions
[17:28:09] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[17:28:13] <eddyb> but that's not always the case, so I understand your concerns
[17:28:18] <acrichto> have you measured compilation time?
[17:28:30] <nate> does anyone know if this issue should still be fixed? https://github.com/mozilla/rust/issues/5172
[17:29:53] <strcat> acrichto: I wrote a few new hash tables too ;p
[17:29:57] <strcat> need to work on that more
[17:30:03] <strcat> cuckoo hashing did not really work well...
[17:30:09] * strcat shrugs
[17:30:24] <eddyb> acrichto: I didn't actually try to get everything to bootstrap properly
[17:30:29] *** Quits: yuriks (yuriks@8E8458DA.1755AC6C.F6EE4B40.IP) (Connection reset by peer)
[17:30:38] <eddyb> I've been testing outside of the tree with the snapshot compiler
[17:31:07] <acrichto> eddyb: I'm would suspect that compile times would be higher, but I'm curious what the actual measurements are
[17:31:52] <eddyb> acrichto: yesterday I was afraid it won't optimize at all, and it still doesn't do it well without going twice through LLVM, so I understand any concerns that you may have. the tests I've done were mostly to prove that *we can offer the technology* :D
[17:32:12] <pnkfelix> strcat: that's interesting.  I have a pet interest in cuckoo.  Any insights as to what went wrong?  (Or is this what we talked about some ... months ago?)
[17:32:18] <eddyb> acrichto: I'll let you know if I can come up with something simpler than the current continuation technique
[17:32:29] <acrichto> eddyb: sure thing!
[17:32:46] <strcat> pnkfelix: I remember we talked about concurrent ones
[17:32:48] <eddyb> unboxed closures wouldn't work since the format arguments are trait objects
[17:33:01] <strcat> pnkfelix: these are just normal ones
[17:33:36] <eddyb> acrichto: a stack once closure would make it easier to implement some of the internals (yeah, I have an Option dance in there somewhere)
[17:33:45] <pnkfelix> strcat: okay, yes.  So do you have any intuition as to what went wrong with cuckoo for you?
[17:33:50] <strcat> pnkfelix: nope
[17:33:53] <strcat> I'll play with this more
[17:33:58] <strcat> oh and you know what's scary
[17:34:04] <pnkfelix> strcat: how many hash functions are you using?
[17:34:13] <strcat> pnkfelix: SipHash with different keys
[17:34:30] <strcat> SipHash is pretty slow though ;\
[17:34:33] <eddyb> acrichto: meeting in half an hour? are both default type params and env/self on the agenda :D?
[17:34:45] <strcat> pnkfelix: SipHash has ~100 cycle setup and then it's ~2 cycles per byte
[17:34:59] <acrichto> eddyb: yeah they're both on there
[17:35:00] <strcat> meanwhile... you can have a hash that's 1 cycle per byte without setup
[17:35:15] <eddyb> strcat: not 1 cycle per uint?
[17:35:25] <strcat> eddyb: I mean 'a good hash' ;p
[17:35:29] <eddyb> :(
[17:35:32] <strcat> just not secure against DoS
[17:35:51] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[17:35:51] *** ChanServ sets mode: +ao dherman dherman
[17:36:21] <eddyb> strcat: I wonder if you can leverage those built-in AES instructions...
[17:36:32] <strcat> eddyb: I actually tried
[17:36:39] <strcat> AES-NI is something like 4 cycles per byte
[17:36:44] <strcat> but...
[17:36:44] <eddyb> oh come on
[17:36:48] <strcat> you don't have to run all the rounds
[17:36:57] <strcat> I dunno how many you'd need to run
[17:37:01] <strcat> for 'secure enough'
[17:37:30] <strcat> eddyb: you have to run 10 rounds...
[17:37:42] <strcat> for actual AES-128
[17:38:15] <strcat> you can run the instruction as many times as you want though
[17:38:46] <strcat> eddyb: anyway a block cipher is a good way to do integers
[17:38:52] <strcat> but AES is too strong of a block cipher for this ;p
[17:39:01] <eddyb> no kidding :)
[17:39:44] <eddyb> strcat: I hear Keccak is pretty flexible
[17:41:14] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[17:41:14] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14261682d to 1443cffe9: 02http://git.io/N3iJvQ
[17:41:14] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[17:41:40] <pnkfelix> strcat: so how many different hash-functions/keys did you use in your cuckoo?  2?  4?
[17:41:45] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[17:42:02] <strcat> pnkfelix: 2
[17:42:22] <pnkfelix> strcat: (the wiki article describes it in terms of 2, but my memory is that the original paper on cuckoo talked more generally about arbitrary K)
[17:43:12] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[17:48:47] <acrichto> strcat: on arch, do you know how to delete old core dumps in systemd?
[17:48:57] <strcat> acrichto: no, I disable that
[17:49:07] <acrichto> how do you disable it?
[17:49:26] <strcat> it's enabled by /usr/lib/sysctl.d/50-coredump.conf so you can override it in /etc
[17:49:36] <strcat> ln -s /dev/null /etc/sysctl.d/50-coredump.conf
[17:49:40] <strcat> disables it
[17:50:26] <strcat> well, on boot
[17:50:27] <strcat> y
[17:50:37] <acrichto> ugh, I hit up + enter too much
[17:50:44] <strcat> you have to use sysctl to disable that thing without it
[17:50:45] <acrichto> I successfully ssh'd and the last command was 'sudo reboot'
[17:50:47] <acrichto> so it rebooted again
[17:50:52] <strcat> acrichto: heh
[17:51:00] <ChrisMorgan> strcat: why a symlink to /dev/null rather than just touching an empty file?
[17:51:21] <acrichto> strcat: cool that worked, thanks
[17:51:22] <strcat> ChrisMorgan: *shrug*, it's the systemd convention
[17:51:31] <strcat> it's what systemctl mask, etc. do
[17:51:38] <acrichto> strcat: do I need to do something special to get symbols?
[17:51:53] <strcat> acrichto: debug symbols? yes ;p
[17:51:58] <strcat> we don't have repos of debug symbols yet
[17:52:01] <acrichto> just function symbols
[17:52:15] <acrichto> ah there we go
[17:52:38] <strcat> oh I thought you meant symbols for the official packages
[17:53:05] <Luqman> acrichto: mollyguard :P
[17:53:16] <acrichto> Luqman: ?
[17:54:24] <Luqman> acrichto: to guard against accidental up-enter shutdowns
[17:54:33] <acrichto> hehe, I need that then
[17:54:55] <ChrisMorgan> Or make sudo *always* require the password.
[17:55:09] <acrichto> that's no fun :P
[17:55:15] <acrichto> at least no in a vm
[17:55:15] <strcat> if you're not logged in over ssh it will let you reboot without a password anyway
[17:55:29] <strcat> unless another user is logged in
[17:55:57] <strcat> 'reboot' is really just a symlink for compatibility ;p
[17:57:03] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[17:57:03] *** ChanServ sets mode: +qo brson brson
[17:57:43] <strcat> acrichto: do you have up/down bound to history search like I do? ;p
[17:58:00] <strcat> instead of just cycling through history
[17:58:01] <acrichto> dunno, I probably configured that years ago and have since forgotten about it
[17:58:15] <eddyb> strcat: fish does that by default <3
[17:58:32] <strcat> somewhat configured zsh >>>>> fish, :P
[17:58:55] <eddyb> what I don't like about fish is that it breaks bash compat
[17:59:05] <strcat> zsh breaks bash compat a bit by default too
[17:59:10] <eddyb> otherwise it feels superior
[17:59:23] <eddyb> I haven't tried zsh yet
[17:59:38] <strcat> zsh has more features than fish but really bare defaults
[17:59:42] <strcat> it's worse than bash by default
[18:00:06] <strcat> at least it's not as slow as bash ;p
[18:01:35] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[18:03:13] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[18:04:14] <strcat> acrichto: the core dump thing is really annoying because for example rusti would be able to generate them
[18:04:16] <strcat> so...
[18:04:39] <strcat> anyway I want core dumps off until I ask for one
[18:04:51] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[18:05:50] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[18:05:50] *** ChanServ sets mode: +ao pcwalton pcwalton
[18:06:02] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[18:06:09] <strcat> they conveniently separate it from the 50-default.conf since so many people are going to want it off
[18:06:19] * strcat shrugs
[18:06:19] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[18:06:20] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14b3fea84 to 1443cffe9: 02http://git.io/N3iJvQ
[18:06:20] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[18:06:23] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[18:06:23] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/0xT9kQ
[18:06:23] <ghrust> 13rust/06auto 14eca980b 15Alex Crichton: Stop using hardcoded numbers for -Z options...
[18:06:23] <ghrust> 13rust/06auto 1457f8073 15Alex Crichton: Remove obsoleted -Z options...
[18:06:23] <ghrust> 13rust/06auto 14a880777 15Alex Crichton: Purge borrowck from libstd...
[18:06:25] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[18:06:36] <eddyb> is there a way to "tune in" to the meeting?
[18:09:49] <eddyb> https://github.com/mozilla/rust/pull/11217#issuecomment-32894639 oh this complicates things
[18:14:29] <eddyb> do I dare to look? https://etherpad.mozilla.org/Rust-meeting-weekly
[18:17:08] <eddyb> pcwalton: we didn't actually use function ptr -> closure in str/lib* with the exception of tests (which I've worked around), if that's what you were worried about
[18:17:21] <pcwalton> cool
[18:17:46] <eddyb> acrichto: ^
[18:17:47] <strcat> if you make *closures* take the env ptr last
[18:17:58] <strcat> bare functions can go without an env ptr
[18:18:05] <strcat> because in C, passing extra parameters is fine
[18:18:13] <strcat> might not be fine if we switched to fastcc
[18:18:36] <strcat> it's actually per the C standard that it's fine, glib/gtk uses it for signals
[18:18:55] <sfackler> if implicit coercion was removed, would it be too magical for the compiler to create the wrapping closure for you?
[18:19:14] <strcat> if you have a function pointer it can't know what it is
[18:19:18] <strcat> extern fn()
[18:19:23] <eddyb> strcat: was discussed a few times
[18:19:39] <strcat> if it's the last parameter on closures, then you can call bare functions as closures
[18:19:46] <strcat> without them having an env param
[18:20:01] <eddyb> strcat: now use traits for closures
[18:20:15] <strcat> put the self parameter last
[18:20:16] <eddyb> all the work to make that env param work is nullified
[18:20:18] <strcat> does it matter? ;p
[18:20:24] <eddyb> strcat: it's nuts!
[18:20:34] <eddyb> strcat: keep in mind *we were not using it*
[18:21:22] <eddyb> I found one test doing let f = {bare_fn_name};
[18:22:10] <strcat> meh, it's probably fine to remove
[18:22:12] *** Joins: jdm (jdm@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[18:22:17] <strcat> you can just use closures earlier
[18:22:24] <strcat> so that you go bare fn -> closure instead of the fn ptr
[18:23:21] <eddyb> strcat: yeah
[18:23:35] <eddyb> we still need to make 'static || Send by default and whatnot
[18:24:01] <strcat> pcwalton: btw we don't have managed-unique anymore
[18:24:13] <strcat> pcwalton: I was thinking that we could replace the exchange_malloc lang item with one using a type parameter
[18:24:14] <pcwalton> we don't have headers on them
[18:24:21] <pcwalton> boehm gc doesn't use headers
[18:24:25] <strcat> yeah I know
[18:24:29] <pcwalton> we still have the infra in the compiler which is the most important thing
[18:24:44] <eddyb> oh, alloc<T> sounds cool
[18:25:02] <strcat> pcwalton: using a type parameter would be nice anyway because we could do better than malloc...
[18:25:19] <strcat> i.e. don't need 16-byte alignment for some things
[18:25:41] <strcat> not sure if that's exposed as an actual optimization by malloc/free allocators
[18:25:46] <strcat> via posix_memalign or something
[18:25:55] * strcat guesses no
[18:26:11] <strcat> but *in theory* ;p
[18:29:02] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[18:32:40] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[18:34:49] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[18:46:03] <eddyb> can someone tell me if https://github.com/mozilla/rust/pull/11595 still merges cleanly?
[18:46:29] <cmr> it does.
[18:46:35] <sfackler> eddyb: bors's queue will tell you
[18:46:47] <eddyb> cmr: thanks :)
[18:47:25] *** Joins: nuts (nuts@moz-66D8F032.w90-40.abo.wanadoo.fr)
[18:49:06] <eddyb> sfackler: hmm, how? it's not r+'d
[18:49:19] <strcat> eddyb: github checks
[18:49:34] <eddyb> strcat: I know. but I don't think I can see it
[18:49:44] <strcat> bors can
[18:49:56] <eddyb> strcat: how can it tell me?
[18:50:07] <strcat> eddyb: http://buildbot.rust-lang.org/bors/bors.html
[18:50:14] <strcat> eddyb: it says STALE if it's not mergeable
[18:50:26] <eddyb> strcat: oh, there. I didn't know that :)
[18:53:22] *** zz_kimundi is now known as kimundi
[18:55:09] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Connection reset by peer)
[18:55:37] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[18:56:22] <flaper87> acrichto: https://github.com/mozilla/rust/pull/11697 <- what will be the share kind for? Do you think the patch is likely to be merged? I would like to avoid basing the work of the other bug on this if it might not be merged https://github.com/mozilla/rust/pull/11697
[19:01:04] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[19:01:38] <ktt3ja> what does BAD mean?
[19:01:57] <ktt3ja> tests failed?
[19:02:16] <eddyb> ktt3ja: link?
[19:02:25] <ktt3ja> the bors queue
[19:02:51] <ktt3ja> http://buildbot.rust-lang.org/bors/bors.html
[19:03:02] <ktt3ja> just wondering
[19:03:28] <eddyb> I thought it was FAILED
[19:03:45] <eddyb> nope, BAD. yupp, failed tests
[19:04:10] <acrichto> flaper87: not sure, brson probably knows more about what Shared will be
[19:05:23] <brson> Shared is for types that can be safely shared across threads, used for closure env bounds, could replace Freeze
[19:05:46] <acrichto> and these shadow params wouldn't suffice for it?
[19:05:52] *** Quits: c-a (c-a@moz-8D7A06D6.a163.priv.bahnhof.se) (Quit: Ex-Chat)
[19:05:55] <acrichto> or not really shadow params but 0-sized types
[19:06:18] <eddyb> brson: so... how is different from Send?
[19:06:40] <strcat> eddyb: data parallelism
[19:06:53] <eddyb> strcat: what kind of data?
[19:06:57] <strcat> &T for T: Share is Share, &mut T for T: Share is Share
[19:07:21] <eddyb> like parallel hashmaps?
[19:07:24] <strcat> no
[19:07:36] <strcat> eddyb: like running 10 things on the same &mut [T]
[19:07:45] *** Parts: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Konversation terminated!)
[19:07:52] <brson> acrichto: i don't think so. the way all current kind inferrence works is that composition can force types to *not* be a kind. It wouldn't make sense to declare a type threadsafe just because one field is threadsafe
[19:07:53] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[19:08:07] <eddyb> Ctrl+W strikes again
[19:08:11] <brson> so we would still need a special attribute to say 'trust me this type is shareable'
[19:08:17] <strcat> eddyb: set emacs key theme
[19:08:25] <acrichto> brson: oh, we couldn't infer shareable like we do freezeable?
[19:08:26] <strcat> makes C-w do the proper thing in gtk apps and ffx...
[19:08:27] * strcat shrugs
[19:08:54] <eddyb> strcat: I guess I shouldn't be asking, I don't know enough about all things parallel
[19:08:56] <brson> acrichto: we *could*, but we couldn't use a sentinal Sharable value to like we do NonFreezable?
[19:09:09] <brson> if we see that *all* fields are Share, then we can say the whole type is Share
[19:09:13] <acrichto> brson: yeah opt-in to a kind doesn't make sense with type parameters
[19:09:22] <acrichto> brson: but we could provide an unsafe constructor
[19:09:43] <acrichto> pub struct Share { priv foo: () } impl Share { pub unsafe fn new() -> Share { ... } }
[19:09:49] <acrichto> that way it's unsafe to opt-in
[19:10:20] <flaper87> mmh, unfortunately, I'm not following much the discussion but go ahead. :D I'll have to read again and understand what the probelm with Share really is. 
[19:11:29] <flaper87> oh nevermind, got it
[19:11:31] <flaper87> :D
[19:13:24] <SiegeLord> acrichto: Could I have my exp notation change added to the meeting agenda for whenever there's time for it? :)
[19:13:34] <acrichto> SiegeLord: ah yes will do
[19:13:37] <acrichto> eddyb: ping
[19:13:38] <brson> acrichto: it's just wierd for type inferrence to make a decision that is not sound
[19:13:59] <acrichto> brson: what do you think about an unsafe constructor?
[19:14:21] <acrichto> I'm not really sure how this works in general though, so I can't really comment that much
[19:14:24] <acrichto> (the share kind)
[19:17:00] <eddyb> acrichto: not really around for another ten minutes, but feel free to ask anything in the meanwhile
[19:17:04] <brson> acrichto: it doesn't change my opinion that the kind inferrence would be wrong. imagine a struct like `struct IsThisShare { foo: SomeSharableType, bar: SomeNotSharableType }`. This would end up the Share simply because it contains SomeSharableType. the kind inferencer could treat the Sharable lang item specially, but that seems pretty bad. Right now all the inference around NotFreeze, etc. relies on general, sound type rules
[19:17:52] <acrichto> eddyb: I was concerned about losing coercion from function pointers to closures and I was wondering what the problem was
[19:18:15] <acrichto> brson: hm, why isn't Share analysis like Freeze in that everything in a type must be Freeze for the type to be Freeze?
[19:18:48] *** Joins: gwty (gwtypc@F459DCF8.2CEEE9CF.BD94A9D5.IP)
[19:19:01] <flaper87> brson: acrichto I guess all this would require to change the way type inference is working now and make it all or nothing. At least have a way to do that for some kinds
[19:19:26] <flaper87> and I'm sure that my last message is easir said than done
[19:19:32] <brson> acrichto: hm, i'm not conveying this correctly. the analysis is the same, but the use of our special kind-influencing values is the opposite. Right now thy are all negative: NotFreeze, NotSend. This one needs to be YesShared
[19:19:37] <flaper87> well, it's all around TypeContents, IIRC
[19:19:45] <brson> acrichto: iow, it's always safe to deny a kind
[19:19:51] <brson> but not always safe to opt-in
[19:20:09] <acrichto> why can't share be the same thing as freeze though?
[19:20:14] <acrichto> can you not infer that a type is share?
[19:21:09] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: rcirc on GNU Emacs 24.3.1)
[19:21:15] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[19:21:16] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/0xT9kQ
[19:21:16] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[19:22:26] <brson> it may be possible. we could default all immutable types to Share, use transmutes to do mutation, leaving them Share. then any types that are doing similar tricks that aren't shareable (Cell), need to be NonShare, like they are now NonFreeze.
[19:22:41] <brson> so yeah, we may just be able to redefine Freeze
[19:23:38] <brson> actually, I don't think so
[19:23:47] <brson> MutexArcs can contain types with interior mutability
[19:24:04] <brson> making them not sharable by that analysis
[19:24:54] <brson> lots of things that aren't sharable become so once they are put in a mutex
[19:25:25] <acrichto> why not have the same analysis though with an opt-in marker?
[19:25:32] <eddyb> acrichto: we weren't using that functionality anyways, as I've previously mentioned. I originally implemented wrappers passing the bare fn pointer in the env param, but that only works for closures (procs have a ~(...) in that slot) and nmatsakis wasn't happy about the indirection that it caused
[19:25:34] <acrichto> so if a struct contains the "ShareMarker" it doesn't recurse into the struct
[19:25:52] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Quit: Textual IRC Client: www.textualapp.com)
[19:25:55] <acrichto> brson: we could also make the ShareMarker unsafe to construct so it's unsafe to opt-in
[19:26:12] <acrichto> brson: we'd have TrustMeImShareable and NotShare 
[19:26:13] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[19:26:13] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Sydezg
[19:26:13] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[19:26:14] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[19:26:14] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/PQAVWQ
[19:26:14] <ghrust> 13rust/06auto 1450d0e07 15Ben Harris: Add support for ARM thumb architecture
[19:26:14] <ghrust> 13rust/06auto 14505572b 15bors: auto merge of #11700 : bharrisau/rust/thumb, r=alexcrichton...
[19:26:14] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[19:26:29] <acrichto> where TrustMeImShareable is unsafe to construct, and it halts inference (it doesn't recurse into the type)
[19:26:37] <eddyb> acrichto: you can get that back in the library with impl<..Args, Ret> Fn<..Args, Ret> for fn(..Args) -> Ret; in the future, if you really want it, I hope that makes sense :/
[19:26:41] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[19:26:41] <brson> acrichto: we could, certainly, but it's a new type of mechanism for the compiler that doesn't cleanly piggy back on the standard inferrence rules like the others
[19:26:58] <acrichto> brson: that's true
[19:27:23] <acrichto> eddyb: anything with a Fn trait doesn't really make sense to me, but it seems like a very "functional language-ish" thing which is sad to remove
[19:27:40] <acrichto> we seem to be slowly ripping out our functional roots one by one
[19:29:27] <eddyb> acrichto: like strcat mentioned, it's saner to coerce bare fns to closures from the start. if you want pointers, you'll have to live with non-'static closures
[19:29:54] <acrichto> eddyb: why can't we generate one wrapper function for the whole crate and just pass everything through that?
[19:30:10] <eddyb> acrichto: with ...?
[19:30:12] <strcat> acrichto: the problem is when you have 'extern fn()'
[19:30:17] <strcat> acrichto: you don't know what it is
[19:30:20] <strcat> as in a fn ptr
[19:30:26] <strcat> I don't think it's a big problem though
[19:30:31] <acrichto> I don't follow?
[19:30:39] <acrichto> you generate one wrapper for each fn() signature?
[19:30:41] <strcat> acrichto: fn foo(f: extern fn()) { ... }
[19:30:48] <eddyb> acrichto: I was doing that before
[19:30:51] <strcat> acrichto: extern fn() takes no params
[19:30:54] <strcat> well, no more extern now I guess
[19:30:56] <strcat> anyway
[19:30:57] <eddyb> acrichto: now I'm generating one wrapper per coerced function
[19:31:07] <strcat> acrichto: you receive a fn ptr, you don't know which fn it is
[19:31:08] <acrichto> eddyb: well no only one wrapper per coerced function pointer
[19:31:17] <strcat> acrichto: but the fn ptr is determined at runtime
[19:31:20] <acrichto> strcat: yes, I understand that, that's why you use a wrapper function as the "closure"
[19:31:31] <strcat> acrichto: ah, yeah, that works
[19:31:34] <acrichto> you pass the fn ptr as an env ptr into the generated function
[19:31:37] <strcat> I do that for spawning threads in rust-core
[19:31:39] <eddyb> acrichto: I was doing that before
[19:31:47] <acrichto> eddyb: yes, but not for all functions
[19:31:51] <acrichto> you would only do this for function pointers
[19:31:56] <eddyb> aaah
[19:31:57] <acrichto> if you do it for everything it's needless indirection
[19:32:03] <strcat> acrichto: hm, don't you need one per set of parameters though... ?
[19:32:06] <acrichto> if you only do it for function pointers it's the correct amount of indirection
[19:32:11] <acrichto> maybe yeah
[19:32:12] <eddyb> acrichto: except we don't use it at all
[19:32:22] <acrichto> eddyb: I saw at least one case where you had to change code
[19:32:25] <eddyb> acrichto: we can easily add it later, btw
[19:32:26] <strcat> acrichto: but yeah you can have these per-crate as-needed
[19:32:33] <acrichto> eddyb: and it's a function language thing I would be sadd to see go
[19:32:34] <strcat> +1 for adding it later
[19:32:45] <eddyb> acrichto: one test which was using let f = {foo}; instead of let f = foo for no reason?
[19:32:52] <eddyb> that was silly to see :P
[19:33:15] <acrichto> https://github.com/mozilla/rust/pull/11595/files#diff-7677d02d95fbd5be98ed00e7130d7defR896
[19:33:56] <acrichto> the compiler isn't the best example of *all* usage of rust
[19:34:02] <acrichto> it's just a subset of usage which doesn't have certain patterns
[19:34:13] <acrichto> just because the compiler/stdlib don't use a pattern doesn't mean it should be removed
[19:34:26] *** Joins: easy_muffin (martin@moz-1337D3CC.public.t-mobile.at)
[19:34:47] <eddyb> acrichto: that's actually a closure bug
[19:34:57] <eddyb> acrichto: we need to fix ||:Pod
[19:35:07] <eddyb> and then we can just use a closure there
[19:35:17] <acrichto> ?
[19:35:24] <acrichto> function pointers have no environment?
[19:35:34] <eddyb> acrichto: it's using an extern fn() because it needs to copy it
[19:35:52] <acrichto> I fail to see what that has to do with ||:Pod
[19:36:11] <eddyb> acrichto: extra::test is using function pointers instead of copiable closures
[19:36:30] <eddyb> it also abuses procs in a couple cases for the same reason
[19:36:48] <eddyb> ||:Pod would be copiable
[19:36:53] <acrichto> that's entirely unrelated
[19:36:55] *** Quits: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca) (Quit: canhtak)
[19:37:02] <acrichto> I'm talking about coercing functoin pointers to closures
[19:37:08] <eddyb> 'static || should infer Send, Pod, Freeze etc.
[19:37:36] <eddyb> acrichto: nothing should use function pointers, really
[19:37:43] <acrichto> that's just not true?
[19:37:44] <eddyb> few things still do
[19:37:57] <acrichto> you can't say a whole language shouldn't use function pointers?
[19:38:23] <eddyb> acrichto: people want fn() {...} expressions because we have broken closures
[19:38:30] <acrichto> that's also not true
[19:38:45] <acrichto> like we have function pointers
[19:38:53] <acrichto> that's not going away
[19:39:00] <acrichto> and I don't think we should be demoting them to second-class?
[19:39:22] <eddyb> acrichto: extern "C" fn is useful
[19:39:57] <acrichto> you can't just say that "fn()" is useless
[19:40:12] <acrichto> just because you think it should be used one way doesn't mean that it's forever useless
[19:40:27] <eddyb> extern "Rust" fn - not so much, unless it's some unsafe internal thing that wouldn't attempt to coerce to a closure anyway
[19:41:00] <acrichto> sizeof(fn()) == pointer
[19:41:03] <acrichto> that's super useful sometimes
[19:41:36] <acrichto> I mean this is all orthogonal
[19:41:50] <acrichto> it seems to me like you should be able to support coercion with a generated wrapper for *functoin pointers* only
[19:41:56] <acrichto> named functions should never need a wrapper
[19:42:05] <acrichto> you're opting into a virtual call already with a function pointer
[19:42:33] <eddyb> acrichto: named functions get a wrapper that can be trivially inlined by LLVM
[19:42:48] <eddyb> (just so we don't generate the same function twice)
[19:43:03] <strcat> it can't really
[19:43:08] <strcat> the wrapper will be used as a fn ptr
[19:43:12] <strcat> it won't be something it can eliminate
[19:43:17] <strcat> the non-wrapper will be used as it is
[19:43:30] <strcat> if you inline the non-wrapper into the wrapper, that's just code bloat in most cases
[19:43:53] <eddyb> but it's better than generating the same code twice, right?
[19:44:06] *** Quits: Kxepal (Miranda@moz-10D65211.pppoe.mtu-net.ru) (Quit: Kxepal)
[19:44:26] <eddyb> acrichto: *sigh* I was just trying to show you that extra::test could use closures if they weren't broken in a way. and that would be more idiomatic than using function pointers
[19:45:11] *** Joins: Kxepal (Miranda@moz-10D65211.pppoe.mtu-net.ru)
[19:45:23] <eddyb> acrichto: it's a < 10 line change to make the indirect wrapper work (and only be used for function pointers)
[19:45:38] <acrichto> would you be ok including that?
[19:46:02] <eddyb> acrichto: only if nmatsakis is okay with it - keep in mind it doesn't work for procs
[19:46:14] <flaper87> brson: btw, re the Share discussion. I guess the same issue would arise if we would use attributes. Is there another approach you were considering to tag a type as NoPod / NoFreeze etc w/o using kinds ?
[19:46:20] <eddyb> and maybe we should require explicit coercion in such cases
[19:46:34] <eddyb> s/coercion/casts/
[19:46:42] <acrichto> eddyb: procs are a little different in that they imply an allocation
[19:46:44] <flaper87> I'm working on another bug and it's kinda blocked b/c of this :P I can either help fixing this or pick another one in the meantime
[19:46:57] <acrichto> eddyb: I thought in general we wouldn't support coercion to procs in order to explicitly show that you're allocating
[19:47:03] <acrichto> that was the whole point of the proc || separation I thought
[19:47:22] <eddyb> acrichto: we never *attempt* to free null pointers :P
[19:49:12] <eddyb> acrichto: here's a thought: with a library implementation of Fn for extern "Rust" fn, &Fn (or &mut FnMut or whatever || ends up being) will contain a pointer to a function pointer, instead of having the function pointer unpacked
[19:50:32] <eddyb> acrichto: so one way we might fix this is to make functions a weird kind of DST - or treat them like &'static pointer, to allow casting a fn to &Trait
[19:50:56] <eddyb> *like a
[19:51:50] <flaper87> acrichto: https://github.com/alexcrichton/rust/commit/934969fc86d1e03b234226a09a809a943ec6e18f I was digging where to do that :P
[19:52:05] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[19:52:38] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[19:54:14] <brson> flaper87: the same issue would not arrise with attributes, the way we currently deal with #[no_freeze] etc. since they are just explicitly asking for a type to be a certain kind, while NoFreeze makes an attribute a kind by virtue of kind inferrence
[19:55:27] <bjz> jensnockert: beep
[19:55:33] <jensnockert> bjz: boop
[19:56:26] <bjz> jensnockert: https://gist.github.com/bjz/8547154
[19:56:28] <flaper87> brson: right. Kinds are better than attributes for a couple of reasons. Would it make sense to approve that patch and rework the kinds if a better idea comes out ?
[19:56:36] <bjz> jensnockert: my crazy floaty thingy
[19:56:58] <jensnockert> Yes, that is crazy.
[19:57:05] <jensnockert> Just need to implement the operations.
[19:58:57] <bjz> jensnockert: heh: https://gist.github.com/bjz/8547154#file-f32-rs-L17-L19
[19:59:27] <jensnockert> Cool!
[20:01:08] <bjz> jensnockert: also: https://gist.github.com/bjz/67b5b5bc3f53c14b8057
[20:01:20] <bjz> jensnockert: a real mess atm
[20:01:27] <bjz> jensnockert: but yeah
[20:01:38] <jensnockert> I like how you mirror the standards names.
[20:01:43] <bjz> jensnockert: also need to document the exceptions
[20:02:06] <jensnockert> I'm just writing an emulator for a silly CPU, I should maybe do something srs instead.
[20:02:10] <brson> flaper87: i am not sure right now. i'd like to hear other's opinions about it, particularly niko's
[20:02:25] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[20:02:26] <bjz> jensnockert: well, I think it would be good to have the in snake case, but to document what they match to
[20:02:42] <bjz> jensnockert: like: https://gist.github.com/bjz/67b5b5bc3f53c14b8057#file-ieee754-rs-L409
[20:02:51] <bjz> jensnockert: srs?
[20:02:56] <eddyb> bjz: lowerCam- yeah, you just mentioned it
[20:02:58] <jensnockert> serious.
[20:03:19] <bjz> heh
[20:03:36] <bjz> jensnockert: but do you think this is sort of in the right direction?
[20:03:45] <jensnockert> I think so, yes.
[20:04:27] <bjz> jensnockert: dunno how we would go about implementing this actual stuff - the sign-bit stuff is easy
[20:04:35] <bjz> the rest... less so
[20:05:14] <bjz> we could use libm, but I don't know how conforment it is - and all the other issues with llvm we talked about
[20:05:30] <jensnockert> The hard part is the trigonometric and stuff.
[20:05:35] <bjz> yeah
[20:05:54] <jensnockert> I personally think that there is probably an easy work-around for the llvm problems.
[20:06:00] <bjz> yeah
[20:06:12] <bjz> I'm relying on our creativity!
[20:06:40] <bjz> jensnockert: should I make an ieee754 repo?
[20:06:44] <jensnockert> Wrapping everything in volatile asm for example shouldn't hurt performance much.
[20:06:48] <jensnockert> bjz: Yes please.
[20:06:57] <jensnockert> We could write a bit of a test-suite too.
[20:07:03] <bjz> of course!
[20:08:47] <bjz> jensnockert: we want Rust to have stellar stuff
[20:08:57] <jensnockert> Super-stellar \o/
[20:09:56] <bjz> jensnockert: I really like how this: https://gist.github.com/bjz/8547154#file-f32-rs-L8-L15 only relies on f32 for the literal syntax :)
[20:10:23] <jensnockert> I love Rust.
[20:10:33] <jensnockert> I wish the web was running Rust instead of JS.
[20:10:41] <bjz> hah, I dunno
[20:10:55] <bjz> higher level languages have their place too
[20:11:22] <jensnockert> I don't mind higher level languages, I just have a non-healthy relationship to JS.
[20:11:55] <bjz> hah, careful, we are in mozilla land here ^_^
[20:12:40] <jensnockert> I think they are even more aware of the shortcomings of JS than me.
[20:12:49] * bjz personally thinks clojurescript looks pretty cool
[20:13:23] <bjz> jensnockert: heh, yes
[20:13:34] *** Quits: nuts (nuts@moz-66D8F032.w90-40.abo.wanadoo.fr) (Quit: Lost terminal)
[20:13:53] <bjz> jensnockert: btw, you've also seen num-rs?
[20:14:41] <jensnockert> Looking at it now.
[20:16:56] <bjz> jensnockert: I dunno if you know, after all the numerics work we did, we're simplifying lots of std::num
[20:17:09] <jensnockert> I know.
[20:17:15] <jensnockert> Or noticed at least.
[20:17:28] <bjz> jensnockert: what do you think so far?
[20:17:41] <jensnockert> I haven't used it enough to say, yet.
[20:17:50] <bjz> jensnockert: I'm thinking its looking lots cleaner
[20:18:00] <jensnockert> All my Rust time has been spent on trying to run a user group.
[20:18:16] * bjz wonders how downstream libs are handling it, like sebcrozet's
[20:18:32] <bjz> cgmath doesn't seem to have broken, yet
[20:18:56] <bjz> jensnockert: user group? neat
[20:19:03] <bjz> many folks there?
[20:19:09] <jensnockert> About 20 people each time.
[20:19:13] <bjz> oooh!
[20:19:35] <jensnockert> That's like 4x the cocoa one, and about the same as the Ruby and Node.js ones here, I think its doing alright.
[20:19:37] <bjz> any active in the community? or are they mainly quite workers, or interested folks?
[20:19:51] <bjz> *quiet
[20:19:57] <jensnockert> A few, I think, don't know their IRC nicks though.
[20:20:35] *** Joins: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca)
[20:35:38] *** Quits: canhtak (canhtak@moz-46971EF1.wl.t.ulaval.ca) (Quit: canhtak)
[20:41:25] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[20:41:25] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/PQAVWQ
[20:41:25] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[20:56:17] *** eddyb is now known as __________
[20:56:30] *** bstrie_ng is now known as ________
[20:56:41] *** __________ is now known as eddyb
[20:57:15] *** ________ is now known as bstrieMorgan
[21:01:49] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Ping timeout)
[21:05:44] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[21:15:01] *** bstrieMorgan is now known as bstrie_nan
[21:19:19] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[21:43:20] <flaper87> acrichto: if you don't have a fix for https://github.com/mozilla/rust/issues/11709 already, let me dig into it (if that's fine)
[21:43:53] <flaper87> I've no idea what's going on there nor exactly what the error is but I'm willing to dig and learn from it
[21:45:00] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[21:46:03] <acrichto> flaper87: have at it
[21:46:17] <acrichto> flaper87: you should comment on it that you're working on it
[21:46:23] <flaper87> acrichto: will do
[21:48:39] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[22:02:19] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[22:05:20] <Eridius> hrm, errors in exported macros have a bad span
[22:05:33] <Eridius> at least, in rust as of 3 days ago
[22:09:12] *** Quits: easy_muffin (martin@moz-1337D3CC.public.t-mobile.at) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[22:09:14] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[22:10:11] *** Quits: dbaupp (Thunderbir@moz-A840EB3D.lns20.syd6.internode.on.net) (Ping timeout)
[22:10:30] *** Joins: easy_muffin (martin@moz-1337D3CC.public.t-mobile.at)
[22:13:36] <Eridius> hrm, #[phase(syntax)] extern mod foo; requires a second extern mod foo; if you want to use the mod normally too. Is there any way to say e.g. #[phase(syntax,something)]?
[22:14:03] <acrichto> #[phase(syntax, link)]
[22:18:41] *** Quits: easy_muffin (martin@moz-1337D3CC.public.t-mobile.at) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[22:37:18] *** Quits: rca_ (rcatolino@moz-5EA2C694.adsl.proxad.net) (Ping timeout)
[22:37:31] <sfackler> Eridius: what does the span end up being?
[22:46:49] <bjz> jensnockert: f32 is basically a binary32 right?
[22:47:03] <jensnockert> In what sense?
[22:47:20] <bjz> as in, as defined in IEEE
[22:47:25] <jensnockert> Oh, in IEEE 754, yeah, it is.
[22:47:33] * jensnockert is just tired.
[22:47:36] <bjz> np
[22:47:43] * bjz understands
[22:48:41] <jensnockert> My randomly designed CPU can run some basic instructions though! \o/
[22:48:48] <bjz> yay
[22:49:02] <bjz> almost ready to push to my ieee754 repo btw
[22:49:05] <jensnockert> It is basically a 64-bit 6502 in sillyness right now though.
[22:49:07] <jensnockert> \o/
[22:49:09] <jensnockert> Amazingcakes.
[22:49:50] <bjz> \o/
[22:53:22] <jensnockert> It doesn't decode operations from its own memory though, will have to fix that.
[22:53:26] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[22:53:27] *** ChanServ sets mode: +ao dherman dherman
[23:00:20] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[23:14:11] *** Joins: new_one (new_one@27570337.92B2BFC6.B3C0173E.IP)
[23:15:03] <sfackler> woah, the queue is empty!
[23:15:58] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Client exited)
[23:16:21] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[23:16:22] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[23:19:40] <bjz> sfackler: now to sneak in `Remove std::num::Times`
[23:19:42] <bjz> xD
[23:32:42] *** Joins: dbaupp (Thunderbir@F99D8787.D5A1DCF.37681C44.IP)
[23:32:59] <ktt3ja> how do I add arrow to span_note?
[23:33:40] <dbaupp> http://huonw.github.io/isrustfastyet/buildbot/bench/test.html#benches=std-trie-bench_map-bench_iter_small,std-vec-bench-zero_1kb_mut_iter *experimental* displaying of the #[bench]'s run on the buildbots. (missing several important features, for now...)
[23:33:47] <sfackler> ktt3ja: the ^~~~? it's based off the span you give to it
[23:34:06] <sfackler> dbaupp: dat variance
[23:34:10] <dbaupp> ktt3ja: isn't it just .span_note(span, message)? and the span adds the ^~~~~ bit?
[23:34:20] <dbaupp> sfackler: I know :(
[23:34:26] <ktt3ja> really? :(
[23:34:31] <dbaupp> I think i'll need to filter based on the buildslave
[23:34:39] <dbaupp> (fortunately I'm recording that information from buildbot.)
[23:35:07] <sfackler> ktt3ja: if the span doesn't correspond properly to stuff that's stored in the codemap it won't do the arrow
[23:35:17] <sfackler> or if the span covers multiple lines iirc
[23:35:47] <ktt3ja> yea, I have a span of a whole function `fn blah {}`, and I want an arrow pointing at the last bracket
[23:36:29] <sfackler> ktt3ja: you can make a new span with both "hi" and "lo" set to the old span's "hi" I think?
[23:36:38] <sfackler> (that may be a bad idea)
[23:36:44] <ktt3ja> I tried that
[23:36:49] <ktt3ja> ...and it only showed me the bracket
[23:36:54] <ktt3ja> with the arrow AFTER the bracket
[23:38:34] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[23:46:57] <dbaupp> cmr: ^ that link, if you're interested
[23:49:03] <dbaupp> (since it's not obvious, you can display specific benchmarks with tree under the 'crates' heading, and can remove displayed things either there or by clicking on entry in the legend.)
[23:50:03] <dbaupp> *the entry
[23:56:19] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[23:56:19] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/9VrFPw
[23:56:19] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[23:56:58] <cmr> dbaupp: awesome!
[23:59:15] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
