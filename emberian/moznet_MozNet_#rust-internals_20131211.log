[00:01:08] *** Joins: notmatt (notmatt@CC62CF7E.1E7FDFDB.A82DBDDB.IP)
[00:05:10] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[00:05:16] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Connection reset by peer)
[00:05:25] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[00:05:53] <brson> ChrisMorgan: make it a reserved keyword
[00:06:14] <ChrisMorgan> OK. (That's certainly the easier path.)
[00:06:21] <dbaupp> ChrisMorgan: an obsolete syntax error would be nice, though?
[00:13:56] <brson> yeah, reserved + obsolete!
[00:15:25] * ChrisMorgan will need to check out how to do that, then
[00:15:51] <dbaupp> ChrisMorgan: if you're doing in the lexer, you'll have to just print an error message
[00:15:58] *** Quits: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP) (Input/output error)
[00:16:30] <ChrisMorgan> Good, thanks. (I just hadn't got quite that far into it, focusing on improving syntax::parse::token first.)
[00:16:37] <dbaupp> ChrisMorgan: if you're doing it the parser look at obsolete.rs (and grep for the enum variant defined there for examples)
[00:17:02] <ChrisMorgan> Yep, I had found obsolete.rs and put in a new variant already.
[00:17:19] <ChrisMorgan> (Then I wondered whether that was the preferred way of doing it; I see it is, which is good.)
[00:17:44] <dbaupp> (if you are doing in the lexer, then I think that obsolete.rs won't work.)
[00:24:07] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[00:24:07] *** ChanServ sets mode: +o tjc
[00:27:20] *** Joins: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net)
[00:29:55] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[00:31:54] *** Joins: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP)
[00:32:43] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[00:36:29] *** Quits: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net) (Quit: Textual IRC Client: www.textualapp.com)
[00:42:10] *** Quits: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP) (Input/output error)
[00:51:21] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[00:51:21] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 141c5dd00 to 145aad292: 02http://git.io/N3iJvQ
[00:51:21] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[00:51:21] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[00:51:21] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/q2fyGA
[00:51:21] <ghrust> 13rust/06auto 14b349036 15Jack Moffitt: Make crate hash stable and externally computable....
[00:51:21] <ghrust> 13rust/06auto 14a16753c 15Jack Moffitt: Add missing sundown dependency to rustdoc tests.
[00:51:22] <ghrust> 13rust/06auto 14ac4dd9e 15bors: auto merge of #10593 : metajack/rust/pkgid-hash, r=brson...
[00:51:24] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[00:52:19] *** jdm|away is now known as jdm
[01:11:55] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[01:16:15] *** Joins: blank_name (blank_name@A1428C52.6FF80FE1.6D228269.IP)
[01:19:55] *** Quits: notmatt (notmatt@CC62CF7E.1E7FDFDB.A82DBDDB.IP) (Client exited)
[01:20:04] *** kimundi is now known as zz_kimundi
[01:23:23] *** Joins: MOeltjenbruns (goofy@moz-D9C12442.hsd1.mn.comcast.net)
[01:41:42] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: Lost terminal)
[01:45:56] *** Quits: dbaupp (Thunderbir@1D1B1F7A.D5A1DCF.37681C44.IP) (Ping timeout)
[01:46:14] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[01:46:14] *** ChanServ sets mode: +qo brson brson
[01:48:23] <cmr> jdm: ping
[01:49:15] <jdm> cmr: pong
[01:49:39] <cmr> jdm: I do intend to look at the debuginfo stuff, but I don't know much/anything about it, so I'm probably going to have bunches of questions :)
[01:50:09] <jdm> cmr: fantastic
[01:50:23] <jdm> I should update the bug with what mw and I discovered/tried
[01:50:33] <cmr> please do!
[01:50:36] <jdm> a lot of it is just comparing to clang's output for similar code
[01:52:47] <cmr> acrichto: did you see some of the recent memory benches? static linking did crazy things to gnu ld
[01:52:59] <acrichto> uh oh
[01:53:16] <cmr> it's not too bad, but it does concern me slightly
[01:53:16] <acrichto> cmr: where are they?
[01:53:24] <cmr> it also blew away eddyb's progress re: mem usage :(
[01:53:27] <cmr> acrichto: http://huonw.github.io/isrustfastyet/mem/
[01:53:39] <acrichto> I only see a small bump that's the same size as the other bumps
[01:53:55] <cmr> http://huonw.github.io/isrustfastyet/mem/#898d2c3,859c3ba
[01:54:19] <cmr> and if you zoom in on the end, each smaller spike corresponds to a single static lib
[01:54:44] <acrichto> how?
[01:54:49] <cmr> scroll wheel?/
[01:54:50] <acrichto> how do we have like 20 static libs?
[01:55:02] <cmr> the number there is actually 50
[01:55:10] <cmr> (I counted)
[01:55:14] <cmr> 45 of them are lLVM
[01:55:17] <cmr> *LLVM
[01:55:18] <acrichto> oh that's b/c we're including like 50 llvm libraries
[01:55:42] <acrichto> I certainly wouldn't vouch that our linking process is quick, but that's what you're asking for with rlibs
[01:55:47] <cmr> yeah
[01:55:50] <cmr> just thought I'd inform you
[01:57:16] <acrichto> oh well
[01:57:33] <acrichto> it's also just longer b/c you're producing more things
[02:00:57] *** Joins: dbaupp (Thunderbir@1D1B1F7A.D5A1DCF.37681C44.IP)
[02:03:12] <cmr> It looks like there is really only one lld developer atm, from google.
[02:03:37] <cmr> Some of the older stuff is from apple, but they don't appear to be concerned with it except for their needs
[02:03:39] <cmr> (which is fine)
[02:04:03] <acrichto> I think it will be a long time before lld is usable
[02:04:41] <cmr> looks like all the recent work has been on windows
[02:06:47] <Luqman> last time i tried to use lld with rust the binary it made was failing somewhere in ld-linux.so
[02:07:06] <acrichto> I couldn't even build something with lld
[02:07:14] <cmr> acrichto: on what platform?
[02:13:15] <acrichto> darwin
[02:25:24] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[02:38:48] <jack> oh my gosh, bors is taking so long!
[02:39:08] <jack> I'm starting to suspect I broke it.
[02:40:04] <dbaupp> http://huonw.github.io/isrustfastyet/buildbot/all linux-32 testing has exploded...
[02:40:40] <brson> the linux tests have spilled over to ec2
[02:40:50] <brson> one of our dedicated linux slaves is down
[02:46:39] *** Quits: dbaupp (Thunderbir@1D1B1F7A.D5A1DCF.37681C44.IP) (Quit: dbaupp)
[02:46:44] *** Joins: dbaupp (Thunderbir@1D1B1F7A.D5A1DCF.37681C44.IP)
[02:49:09] *** Quits: dbaupp (Thunderbir@1D1B1F7A.D5A1DCF.37681C44.IP) (Quit: dbaupp)
[02:49:12] *** Joins: dbaupp (Thunderbir@1D1B1F7A.D5A1DCF.37681C44.IP)
[02:54:33] *** Joins: canhtak (canhtak@moz-1D882009.wl.t.ulaval.ca)
[02:57:09] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[03:01:00] *** Quits: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com) (Quit: pcwalton)
[03:05:53] *** Quits: zz_kimundi (kimundi@moz-19623CE3.dip0.t-ipconnect.de) (Ping timeout)
[03:06:32] <cmr> r? https://github.com/mozilla/rust/pull/10913
[03:10:01] *** Joins: zz_kimundi (kimundi@moz-3DA1FAC3.dip0.t-ipconnect.de)
[03:10:03] *** zz_kimundi is now known as kimundi
[03:11:24] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[03:11:24] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/q2fyGA
[03:11:24] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[03:11:40] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[03:11:41] <jack> \o/
[03:12:59] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[03:14:26] <aatch> jack, congrats
[03:14:55] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[03:16:21] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[03:16:21] <ghrust> 01[13rust01] 15bors pushed 14 new commits to 06auto: 02http://git.io/zqXC2w
[03:16:21] <ghrust> 13rust/06auto 14786dea2 15Patrick Walton: libextra: Another round of de-`Cell`-ing....
[03:16:21] <ghrust> 13rust/06auto 147cac9fe 15Patrick Walton: librustuv: RAII-ify `Local::borrow`, and remove some 12 Cells.
[03:16:21] <ghrust> 13rust/06auto 14ab3bec9 15Patrick Walton: libstd: Remove some cells involved in...
[03:16:23] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[03:16:24] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[03:16:25] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/hQlQYg
[03:16:25] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[03:31:13] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[03:36:39] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[03:51:34] <ChrisMorgan> r? https://github.com/mozilla/rust/pull/10891 (now with removed obsolete special identifiers too)
[03:52:42] <ChrisMorgan> There is actually something further I could do; I could make the macro figure out (STRICT|RESERVED)_KEYWORD_(START|FINAL) as well.
[04:03:12] <dbaupp> ChrisMorgan: it should be 'macroise' :P
[04:03:12] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Connection reset by peer)
[04:03:28] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[04:03:44] <ChrisMorgan> dbaupp: or maybe macroicate.
[04:03:45] <dbaupp> ChrisMorgan: how difficult will getting those constants be?
[04:04:18] <dbaupp> (well, how ugly will the macro become?)
[04:04:45] <ChrisMorgan> dbaupp: it just requires splitting the two types of keywords into blocks (so that they can be read) and having simple little first! macro. 
[04:05:26] <ChrisMorgan> Actually, last! will also be needed. (I'd been thinking briefly I could get away without it, but I can't reasonably do so.)
[04:05:43] <ChrisMorgan> last! must be defined recursively, but it works.
[04:10:54] * ChrisMorgan has decided to do it
[04:16:14] <aatch> It always surprises me when I write >100 lines of rust in one shot and get nothing but trivial errors.
[04:16:57] <aatch> This time was that `~str` doesn't implement `ToCStr` (so I had to make it a slice, oh no!)
[04:21:44] * ChrisMorgan still gets that feeling sometimes, the more with macros
[04:22:34] <sfackler> re-r? https://github.com/mozilla/rust/pull/10895
[04:22:52] <sfackler> make some changes that bmyers requested
[04:23:12] <ChrisMorgan> dbaupp: r? https://github.com/mozilla/rust/pull/10891
[04:25:28] <ChrisMorgan> (https://github.com/chris-morgan/rust/commit/dd042efa7e109dee88241358f88a0c8bb57e9269 are the changes to make it figure out (STRICT|RESERVED)_KEYWORD_(START|FINAL) automatically.)
[04:34:58] <ChrisMorgan> dbaupp: ah, the dangers that you get into when you have flexibility to choose syntaxâ€¦!
[04:43:08] <acrichto> it's working! https://gist.github.com/alexcrichton/7905180
[04:46:01] <dbaupp> acrichto: very cool!
[04:46:07] <aatch> acrichto, awesome.
[04:46:32] <acrichto> libgreen has a long way to go, but libnative should be done!
[04:46:40] <acrichto> well, except for filling out all of the I/O implementation
[04:46:46] <acrichto> and polish ofc
[04:47:00] <acrichto> oooh I should test unwinding
[04:47:05] <aatch> So this set up allows libraries to just transparently use whatever IO the actual program wants?
[04:47:18] <acrichto> exactly
[04:47:27] <acrichto> it's actually whatever IO the current task dictates
[04:47:34] <acrichto> so in the same process you can have multiple runtimes
[04:47:36] <aatch> Cool.
[04:47:37] <dbaupp> per task? o_O
[04:47:47] <acrichto> it was actually easier per-task anyway
[04:47:54] <acrichto> and it makes sense if you want a 1:1 world communicating with an M:N world
[04:48:00] <acrichto> (which is a very real possibility)
[04:48:06] <acrichto> and unwinding even works!
[04:48:13] * aatch is working on a native X11 impl
[04:49:34] * ChrisMorgan contemplates the thought of a WebSocket implementation which used chans and ports completely transparently (no idea whether that'd be a good plan or not, it's unlikely to be)
[04:50:48] <ChrisMorgan> Actually that might not be quite such a bad idea by the time you get to end-to-end-Rust web apps.
[04:51:30] <dbaupp> have servo check if it's connect to a rust-http server and use the built-in port/chan websocket impl? :P
[04:58:43] <ChrisMorgan> â€¦
[05:03:36] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[05:07:53] *** Quits: canhtak (canhtak@moz-1D882009.wl.t.ulaval.ca) (Quit: canhtak)
[05:11:17] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[05:12:20] <aatch> Is it possible to borrow ~Trait to &Trait?
[05:12:35] <aatch> Or do I have to settle with &~Trait?
[05:12:52] <dbaupp> I thought it happened automatically now?
[05:13:02] <aatch> dbaupp, gooe enough for me
[05:13:06] <aatch> good*
[05:13:10] <dbaupp> rusti: let a = ~1 as ~Clone; let _b: &Clone = a; 
[05:13:15] -rusti- ()
[05:14:00] <aatch> perfect
[05:14:04] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[05:15:56] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[05:41:20] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[05:41:20] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/zqXC2w
[05:41:20] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[05:42:02] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[05:46:20] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[05:46:20] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/3yOFvw
[05:46:20] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[05:51:35] *** Quits: dbaupp (Thunderbir@1D1B1F7A.D5A1DCF.37681C44.IP) (Ping timeout)
[06:01:56] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[06:01:56] <ghrust> 01[13rust01] 15alexcrichton merged 06master into 06snap-stage3: 02http://git.io/2NbF0w
[06:01:56] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[06:04:50] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[06:07:07] <sfackler> acrichto: r? https://github.com/mozilla/rust/pull/10895
[06:07:28] <acrichto> don't worry, r+ a minute ago
[06:07:43] <sfackler> oh, thanks :)
[06:11:48] <sfackler> is pluginized syntax extension support something that would be accepted pre 1.0?
[06:12:57] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[06:16:25] <acrichto> sfackler: it's something that we all want, and I highly doubt that we would reject some good work in the area
[06:16:43] <acrichto> sfackler: if you were interested in working on that, I'd chat with a few people about what their existing ideas about it are
[06:17:01] <acrichto> it's not clear what we mean by loadable syntax extensions
[06:17:25] <acrichto> b/c one hand it means exporting macros, but it would also be really nice to have programmatic syntax extensions (those in syntx/ext)
[06:17:43] <acrichto> and then if we export macros, how do you export macros? under a path or in a global namespace?
[06:18:17] <sfackler> I was personally hoping more for programmatic macros loaded into rustc
[06:18:44] <sfackler> which would allow for e.g. deriving support for third party traits
[06:19:45] <sfackler> and stuff like compile time perfect hash tables
[06:20:43] <acrichto> that would be amazing
[06:21:09] <acrichto> I suppose that problem is in a bit smaller scope than loading macros in general
[06:21:42] <sfackler> right, they could still load into the global scope along with all of other syntax extensions for now
[06:22:09] <sfackler> there is already std::unstable::dynamic_lib
[06:22:12] <acrichto> yeah that makes sense
[06:22:20] <acrichto> that's the idea I think
[06:22:34] <acrichto> although we haven't had any for-real loading of dynamic libraries yet
[06:22:45] <acrichto> I *think* that there's no existing problems with it
[06:22:49] <sfackler> so theoretically all you'd have to do is declare some #[no_mangle] public method and pass the path to the .so to rustc
[06:23:24] <sfackler> the interface is pretty unsafe, but I don't think that's too much of a big deal
[06:23:29] <acrichto> I think that we were hoping for a little more typechecking than that, but I can see where that would at least work
[06:23:53] <acrichto> if I compile a syntax extension it'll always have to be recompiled whenever the compiler is recompiled
[06:23:54] <sfackler> yeah, it'd be nice to be able to pull the metadata from the so
[06:24:41] <acrichto> I suppose the compiler is lying around
[06:24:45] <sfackler> I think if we're careful about the signature of the method that the plugin implements, we may be able to only force a recompile for actual changes to the structure of the AST
[06:25:25] <acrichto> I agree
[06:25:34] <acrichto> if the signature is based on the current rev of the compiler
[06:25:35] <sfackler> the awkward part is that the metadata parsing stuff isn't in a place that libstd can get to it
[06:25:38] <acrichto> a graceful error would be nice
[06:25:44] <acrichto> libstd doesn't need it
[06:25:55] <acrichto> dynamic_lib shouldn't deal with this
[06:26:03] <acrichto> the compiler would do it before even touching dynamic_lib
[06:26:12] <sfackler> that's true
[06:26:20] <sfackler> it'd be a nice thing to have for dynamic_lib as well though
[06:26:25] <acrichto> that is very true
[06:26:29] <acrichto> that also wants libmetadata
[06:26:39] <acrichto> there's an issue on that
[06:26:41] <acrichto> moving metadata out
[06:26:45] <sfackler> yep
[06:27:10] <sfackler> I think dynamic_lib may actually have to be pulled out into libmetadata to get the dependencies to work out if it will support typechecking
[06:27:19] <acrichto> I'd totally be ok with that
[06:27:25] <acrichto> we could drop the libdl support dep on libstd
[06:27:28] <acrichto> I think
[06:28:09] <eddyb> sfackler: hmm, I think there is (unused?) plugin support in rustdoc, have you seen it?
[06:28:19] <eddyb> it's like what you said, already implemented
[06:28:20] <acrichto> it's just a load of a symbol
[06:28:26] <acrichto> there is no checking of anything at all
[06:32:12] <sfackler> I wonder if @ ref counting would work properly across a dynamically loaded library
[06:32:42] <acrichto> it should
[06:32:52] <acrichto> a dylib should "just" be a large wad of functions
[06:33:08] <acrichto> we're breaching territory of other weird behavior with things like thread_local though
[06:33:38] <sfackler> right, but I would hope that a deriving expander wouldn't need thread locals :P
[06:33:53] <acrichto> hopefully
[06:35:04] <sfackler> so it seems like the simplest possible approach would be to have 2 symbols in the API: a &'static [&'static str] of supported macro names, and a fn(@ExtCtx, Span, &[ast::token_tree]) -> MacResult function
[06:35:14] <sfackler> and then the same for the deriving stuff
[06:35:30] <sfackler> i guess the function would take a &str of the macro name as well
[06:35:32] <sfackler> to disambiguate
[06:36:01] <sfackler> or the vector could contain pairs of macro name, function name
[06:36:06] <sfackler> which might be nicer
[06:36:10] <acrichto> I'd avoid the static array
[06:36:17] <acrichto> it should be passed some sort of context
[06:36:21] <acrichto> which is then used to register things
[06:37:59] <sfackler> something like "fn init(&mut Foo)"? and Foo has a register_extension method taht takes a name and extern "Rust" fn?
[06:38:12] <cmr> libmetadata would sit somewhere between libstd and libsyntax.
[06:38:14] <sfackler> would function pointers work like that over a dlib boundary?
[06:38:17] <cmr> Probably as part of the future extra conglomerate
[06:38:30] <acrichto> sfackler: yeah
[06:38:37] <sfackler> I guess you could just pass the function name instead of the pointer worst case
[06:38:44] <acrichto> sfackler: dynamically loading something via dlopen just shoves the whole thing in the address space somewhere
[06:38:54] <acrichto> it should definitely be a pointer
[06:39:01] <acrichto> dlsym should be used the first time, and that's it
[06:39:18] <sfackler> and the assembler will be smart enough to calculate the function pointer?
[06:39:23] <sfackler> *the address of
[06:39:24] <sfackler> at runtime
[06:39:55] <acrichto> that's that dlsym does
[06:40:00] <acrichto> the dynamic library has a symbol table with it
[06:40:06] <acrichto> the dynamic linker reads it and looks up the symbol
[06:40:24] <acrichto> this is where PIC comes into play
[06:40:33] <acrichto> this wouldn't work at all unless all code is built with PIC
[06:40:36] <acrichto> -fPIC that is
[06:40:43] <sfackler> right
[06:41:08] <sfackler> do Rust .so's get build to be position independent?
[06:41:16] <acrichto> yes, always
[06:41:21] <sfackler> sweet
[06:41:47] <acrichto> https://github.com/mozilla/rust/blob/master/src/librustc/back/link.rs#L157
[06:42:32] * eddyb wants -mrelocation-model=static available *somehow*
[06:42:52] <sfackler> cool. a first pass that skips the typechecking on the load of the init fn seems like it should be able to be hacked out without a ton of trouble
[06:43:08] <eddyb> it produces better code on x86_32 when accessing statics
[06:43:22] <eddyb> but x86 is to blame, no EIP-relative addressing
[06:43:24] <acrichto> sfackler: I agree
[06:43:36] <acrichto> sfackler: to be an official thing though, we're going to want some more safety than that
[06:44:29] <sfackler> right
[06:45:28] <Luqman> eddyb: pssh, just use x86_64. rip-relative is all the rage
[06:46:04] <eddyb> RISC ftw
[06:51:19] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[06:51:19] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14a5f6de2 to 14b8b16ae: 02http://git.io/N3iJvQ
[06:51:19] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[06:51:20] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[06:51:21] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/zj7HcA
[06:51:21] <ghrust> 13rust/06auto 148240faf 15Steven Fackler: Allow ref and mut modifiers for short form field patterns...
[06:51:21] <ghrust> 13rust/06auto 14b8516de 15bors: auto merge of #10833 : sfackler/rust/mut-pat, r=brson...
[06:51:21] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[06:59:11] <Eridius> What the heck happened with the test failure on https://github.com/kballard/rust/compare/use-braces ?
[06:59:16] <Eridius> the quoted failure doesn't match what's in the source
[07:00:00] <sfackler> Eridius: it's a pretty test, so the pretty-printer is messing up
[07:00:11] <sfackler> and turning use {foo, bar} into use ::{foo, bar}
[07:00:20] <Eridius> it re-runs the rpasses after going through the pretty-printer? huh
[07:00:21] <Eridius> I had no idea
[07:00:37] <Eridius> any way to run that specifically without the full `make check`?
[07:01:20] <sfackler> check-stage1-pretty maybe?
[07:02:28] <Eridius> thanks that reproduced it
[07:10:52] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[07:11:18] *** Joins: dbaupp (Thunderbir@moz-EB2EFE6F.lns20.syd6.internode.on.net)
[07:15:11] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[07:16:54] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[07:17:13] <cmr> acrichto: ping
[07:17:25] <acrichto> cmr: pong
[07:17:50] <cmr> acrichto: any particular thoughts on modularizing rustdoc rendering?
[07:17:54] <cmr> Adding troff (man page) output
[07:18:20] <cmr> A lot of the stuff in html::render is fairly useful and could be generic I think
[07:18:37] <acrichto> I agree, the renderer should proably be a trait
[07:18:38] <cmr> Would a folder interface make sense?
[07:18:46] <acrichto> and it's implemented by html/troff/whatnot
[07:18:57] <acrichto> you could even emit markdown
[07:19:05] <acrichto> the specific format of pages would be a little tough
[07:19:09] <acrichto> but it's certainly possible
[07:19:20] <dbaupp> are we going to have a man page for every function?
[07:19:39] <acrichto> yeah that seems kinda odd
[07:19:45] <acrichto> I'd think it'd be more a manpage per module
[07:20:07] <dbaupp> hm, that's probably quite large
[07:20:09] <eddyb> man std::vec::from_elem
[07:20:15] <dbaupp> do we have prior art?
[07:20:20] <eddyb> that would look cool, at least
[07:20:25] <dbaupp> (which we can copy/be inspired by)
[07:20:26] <acrichto> go has good cli documentation
[07:20:27] <cmr> per type
[07:20:29] <cmr> and free function
[07:20:34] <acrichto> go doc net
[07:20:35] <dbaupp> acrichto: with `man` though?
[07:20:50] <cmr> that's that the stl does
[07:20:58] <acrichto> or at least I thought they did
[07:21:14] <cmr> I was just going to copy what the STL docs have.
[07:21:17] <cmr> And perl docs.
[07:21:36] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[07:22:02] <acrichto> did go remove godoc?!
[07:22:14] <acrichto> must have moved in 1.2 ...
[07:22:29] <dbaupp> acrichto: they renamed it or something
[07:22:34] <sfackler> it used to be "go doc"
[07:22:40] <sfackler> now it's "godoc" iirc
[07:22:46] <acrichto> ah indeed
[07:22:51] <acrichto> nah they moved it
[07:22:55] <acrichto> go get code.google.com/p/go.tools/cmd/godoc
[07:23:14] <acrichto> ugh I hate go get it always complains about certificates on code.google.com
[07:23:16] <sfackler> extern mod dependencies aren't resolved until after expansion, right?
[07:23:17] <acrichto> I give up
[07:23:21] <acrichto> sfackler: right now, yes
[07:23:27] <acrichto> (which may be a problem)
[07:23:30] <sfackler> hmm :/
[07:23:35] <sfackler> yeah
[07:23:42] <acrichto> dbaupp: but I remember that go had very good command-line documentation as well has html documentation
[07:23:46] <acrichto> as in manpage-style formtas
[07:23:48] <acrichto> formats*
[07:24:01] <dbaupp> sfackler: yes, getting exported macros will require a lot of changes
[07:24:12] <dbaupp> need metadata accessible to libsyntax too.
[07:24:22] <dbaupp> (assuming you're working on that...)
[07:24:33] <sfackler> dbaupp: I'm working on exported syntax extensions
[07:24:42] <sfackler> which should be a tiny bit easier since you don't need metadata
[07:24:48] <sfackler> for an initial pass
[07:24:57] <dbaupp> sfackler: did you see my PoC?
[07:25:09] <sfackler> no?
[07:25:15] <dbaupp> acrichto: yeah, but that's with a language aware tool, while man isn't, so getting the same quality using man might be hard.
[07:25:37] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[07:25:50] <dbaupp> sfackler: https://github.com/mozilla/rust/pull/6735
[07:25:59] <acrichto> dbaupp: oh no it's like an actual manpage, like I wouldn't be surprised if it just executed 'man'
[07:26:11] <acrichto> it's not saved though, dynamically generated
[07:26:13] <dbaupp> acrichto: oh, really? I stand corrected.
[07:26:18] <acrichto> go can afford to do that
[07:26:20] <acrichto> we really can't
[07:26:40] <dbaupp> sfackler: in any case, you do need parts of rustc::metadata, because that includes the find-the-crates-with-this-name bit.
[07:31:06] <sfackler> since metadata depends on libsyntax, it seems like you'd actually need to pull the syntax extension stuff out into its own crate as well
[07:31:11] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Max SendQ exceeded)
[07:31:18] <sfackler> and I guess add another pass that does the macro expansion
[07:31:33] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[07:32:07] <dbaupp> well, we have a separate pass for macro expansion already
[07:32:50] <sfackler> oh, cool
[07:32:59] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[07:33:15] <dbaupp> anyway, the approximate road map I had for exportable syntax extensions was to move metadata and syntax::ext into their own crates.
[07:33:41] <sfackler> that makes sense to me
[07:34:01] <dbaupp> however, it's not 100% clear to me how we can get a sane loading syntax extensions thing; it seems like one would have to have two libraries to do so
[07:34:18] <dbaupp> i.e. one for the syntax extensions, one for the code.
[07:34:38] <dbaupp> and if one wants to use the code in the syntax extensions, then you can't use your own syntax extensions in the actual library.
[07:34:52] <dbaupp> (the code == the actual library.)
[07:34:59] <sfackler> right, since it isn't built yet
[07:35:04] <sfackler> that's not too bad though
[07:35:11] <sfackler> it's just an extra extern mod
[07:35:33] <dbaupp> that's not quite what I'm saying
[07:36:36] <sfackler> ?
[07:36:37] <dbaupp> you need foo and foo_synext as actual crates; so either foo_synext uses the stuff from foo, or foo uses the foo_synext. can't have both. which seems extremely unfortunate and annoying. :(
[07:37:07] <sfackler> hmm, yeah
[07:37:18] <sfackler> you may just need to end up with an API crate and an impl crate
[07:38:26] <sfackler> dbaupp: you don't actually necessarily need to have a dependency on foo in foo_synext though
[07:38:35] <sfackler> since you'll be assembliing an ast manually
[07:38:38] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[07:38:43] <sfackler> you can just quasiquote it
[07:38:58] <dbaupp> for example, I have no idea how it will even be possible with libstd; since presumably std_synext will (a) be using std (and in fact be using syntax, two steps down the dependency chain), and (b) std will be wanting to use, e.g. format!() from std_synext.
[07:39:31] <sfackler> I think libstd is a bit of a special case since it defines super basic types
[07:40:11] <sfackler> but if I'm writing, say, a compile time lookup table syntax extension, I have my synext crate that does all of the ast assembling and calculates the hash code setup
[07:40:21] <sfackler> and then the runtime crate that has the trait definitions and stuff
[07:40:30] <sfackler> and there's no need for the synext crate do depend on the runtime crat
[07:40:31] <sfackler> e
[07:40:32] <dbaupp> true enough
[07:40:35] <sfackler> (I think)
[07:41:17] <dbaupp> (although I imagine there are instances where one does want the synext crate to depend on the rt one, although with LTO breaking things into more modular crates should be more reasonable now.)
[07:41:20] <sfackler> we may also be able to take care of the libstd issue by having the synext crate depend on the last round bootstrapped libstd
[07:41:25] <dbaupp> speaking of which, has lto landed?
[07:42:04] <dbaupp> sfackler: that sounds possible... I guess we'll have to experiment with it when we get there.
[07:42:09] <sfackler> yeah
[07:42:19] <sfackler> worst case, all of the current syntax extensions have to stay inside the compiler
[07:43:00] <dbaupp> :'(
[07:43:01] <sfackler> but third party stuff should be able to get something reasonable going with a sufficient number of distinct crates
[07:43:19] <sfackler> ooh
[07:43:32] <dbaupp> we'll want good build system for many crates...
[07:43:35] <dbaupp> *support
[07:43:38] <sfackler> it might even be able to boostrap itself by depending on the synext crate both as an extern mod and normal mod :D
[07:43:59] <dbaupp> sfackler: it == std?
[07:44:06] <sfackler> third party stuff
[07:44:14] <dbaupp> what would the normal mod give you?
[07:44:30] <sfackler> downstream users only have to worry about one extern mod declaration
[07:44:34] <dbaupp> oh
[07:44:53] <dbaupp> but what if the downstream users don't want to require libsyntax? :P 
[07:45:12] <dbaupp> (i guess if you don't use anything that uses libsyntax that dependency can be dropped.)
[07:45:19] <sfackler> yeah, maybe they should be separate
[07:45:22] <sfackler> *shug*
[07:45:48] <sfackler> I think for libstd we can probably do something with stage-n std_synext depending on stage-n-1 std
[07:45:54] <sfackler> to get vectors and whatever
[07:46:41] <sfackler> and then recompiling an extra time to get a version that links against the final stage libstd
[07:46:44] <dbaupp> probably, it may result in weirdness when you actually try to load the crate into the compiler
[07:46:47] <dbaupp> oh, that'd fix it
[07:46:59] <dbaupp> it'd break rustc-stage1 :P
[07:47:24] <sfackler> how so?
[07:48:37] <sfackler> wouldn't the initial build depend on the snapshot libstd and then the second build would depend on the stag1 libstd?
[07:49:47] <dbaupp> hm
[07:50:12] <dbaupp> wouldn't that need an extra build of std_synext like the full bootstrap would?
[07:50:35] <sfackler> it would, but then the extra build could be used as the bootstrap build of stage2
[07:50:51] <sfackler> i guess it'd be a bit like doing a tiny bit of the stagen build for the stagen-1 build
[07:51:08] <sfackler> and std_synext should be a pretty quick compile I'd imagine
[07:51:26] <dbaupp> presumably
[07:51:32] <dbaupp> although it'd have to drag in all of syntax
[07:51:59] <sfackler> even that may not be too bad
[07:52:12] <sfackler> I've always found that all of the libs other than librustc take at most a couple of seconds to build
[07:52:13] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Max SendQ exceeded)
[07:52:21] <sfackler> so decoding libsyntax should be not bad
[07:52:33] <sfackler> maybe I'm wrong though
[07:52:40] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[07:52:43] <sfackler> I usually do other things when trying to do a build :P
[07:54:17] <dbaupp> iirc just putting an `extern mod syntax;` on hello world would make it significantly slower to build
[07:54:28] <dbaupp> I could easily be remembering incorrectly though.
[07:55:30] <sfackler> looks like it goes from .1 to .2 seconds for me, though it may go up if you actually start using stuff from it
[07:55:42] <sfackler> er, .2 to .3
[07:56:02] <dbaupp> oh, ok, not so bad.
[07:56:16] <dbaupp> maybe this was before the lazy loading work that pcwalton(?) did
[08:08:17] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Max SendQ exceeded)
[08:08:55] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[08:11:28] <sfackler> man, metadata is wrapped up with basically all of middle :/
[08:11:49] <cmr> metadata is its own hell
[08:12:28] <sfackler> and everything depends on driver::session
[08:12:58] <dbaupp> sfackler: yes. it's horrible
[08:13:07] <dbaupp> cmr: fixing that would be realllllly nice
[08:13:14] <dbaupp> but you might not survive your break
[08:13:29] *** flaper87|afk is now known as flaper87
[08:13:34] <cmr> dbaupp: it's on the backburner.
[08:15:22] <sfackler> it seems like the plan of attack would have to be a) extract driver::session b) extract middle, c) extract metadata, d) maybe begin working on synext
[08:16:09] <dbaupp> extract middle.... o_O
[08:16:31] <dbaupp> wouldn't that leave essentially nothing interesting in librustc
[08:16:49] <sfackler> pretty much
[08:16:52] <cmr> heh
[08:16:58] <dbaupp> basically just the option parser, and the output-filename-decider
[08:17:00] <cmr> driver needs to be entirely redesigned.
[08:17:03] <cmr> it can't be parallelized.
[08:17:06] <sfackler> I mean it seems to me that that's kind of the right thing to do anyways
[08:17:08] <dbaupp> s/@//
[08:17:18] <dbaupp> ^ perfectly good redesign
[08:17:29] <cmr> dbaupp: it's not just that, the logging inf it uses is very... peculiar.
[08:17:42] <cmr> but yes, with the exception that some things need to be &'static
[08:18:02] <dbaupp> sfackler: I'd think that you're basically saying "extract the things other than middle from librustc", since the core of rustc is *middle*
[08:18:06] <dbaupp> but that's just semantics
[08:18:22] <ChrisMorgan> Interesting. The very significant majority of `do` usage (at least, since the proc change) appears to be in tests.
[08:18:40] <dbaupp> cmr: yeah, I attempted to do something about that logging stuff...
[08:18:47] <cmr> so did I
[08:18:48] <dbaupp> it was a waste of time :/
[08:19:09] <cmr> I have a new logging interface, that should work, but it won't be like what it has now.
[08:19:12] <cmr> Which... I don't think is bad.
[08:19:25] <cmr> The current logging is based on the assumption that we'd actually have multiple ways of logging things
[08:19:32] <cmr> When in reality it's just one, duplicated everywhere.
[08:20:33] <dbaupp> yes
[08:20:38] <dbaupp> and it's old
[08:21:07] <dbaupp> in any case, I won't complain when it dies of an @ overdose.
[08:21:59] <dbaupp> assuming modules can do that, of course.
[08:31:02] <acrichto> 91 files changed, 11876 insertions(+), 11014 deletions(-)
[08:31:06] <acrichto> lol not even halfway done
[08:31:13] <cmr> what change is that!?
[08:31:18] <acrichto> libgreen/libnative
[08:31:23] <cmr> ah
[08:31:23] <eddyb> huh?
[08:31:33] <acrichto> extraction of libgreen/libnative out of libstd
[08:31:41] <acrichto> libstd is losing the scheduler and all 1:1 I/O
[08:31:43] <eddyb> aaah. we're already doing that :D?
[08:31:49] <acrichto> just like it lost all green I/O awhile back
[08:32:05] <acrichto> after the channel rewrite, this was the next up to do
[08:32:27] <dbaupp> eddyb: acrichto actually finished it 3 weeks ago, but he's acting slow so that it's not just him writing the whole compiler.
[08:32:41] <eddyb> (splitting libraries now that there's static linking)
[08:33:21] <dbaupp> acrichto: the LTO that landed still has the compilation time problems, right?
[08:33:33] <acrichto> yes
[08:33:38] <acrichto> "problems" == super slow
[08:33:47] <acrichto> not entirely sure how to make faster though, it's mostly an LLVM issue
[08:34:00] <acrichto> there are optimizations we could do on our half, but the lion's share is time spent in LLVM
[08:34:18] * acrichto is not adding #[feature(globs)] to these new libraries
[08:34:42] <dbaupp> is clang that slow?
[08:34:53] <dbaupp> acrichto: any features at all?
[08:35:10] <acrichto> libnative has none, I think libgreen will have macro_rules
[08:35:28] <acrichto> dbaupp: if you have a recent instsall of rust run -Z lto -Z time-ppasses
[08:35:32] <acrichto> you'll see where all the time is
[08:35:38] <dbaupp> yeah, just building myself a compiler
[08:35:41] <acrichto> 90% of it is LTO passes and linking in LLVM bytecode
[08:35:46] <acrichto> not reading llvm bytecode, but linking it in
[08:35:54] <acrichto> I should do that as well
[08:35:56] <dbaupp> oh, that reminds me
[08:36:02] <dbaupp> I need to update irfy
[08:36:04] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[08:37:14] <cmr> eddyb: pintg
[08:37:16] <cmr> *ping
[08:37:22] <eddyb> here :D
[08:37:36] <eddyb> please tell me you have good news
[08:37:45] <cmr> nope!
[08:37:49] <cmr> so, you want benchmarks? :)
[08:37:53] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[08:38:10] <eddyb> since I went blank and forgot to test that #[inline] on finally's drop
[08:38:16] <eddyb> cmr: well, sure
[08:39:21] <eddyb> I think dbaupp's thing actually shows benchmarks, in a different section, it's just that even on master there's no regression benchmarks
[08:40:16] <dbaupp> eddyb: what?
[08:40:25] * dbaupp hasn't seen this section
[08:40:39] <eddyb> dbaupp: then what are the graphs I remember?
[08:40:44] <eddyb> I might be getting confused
[08:41:21] <eddyb> cmr: like the three vector initialization methods. maybe there should be a baseline `memset(uninit_local_vec, 0, 1024);` one to catch an overall regression
[08:41:25] <dbaupp> eddyb: http://huonw.github.io/isrustfastyet/mem/ are just building librustc, and http://huonw.github.io/isrustfastyet/buildbot/ are just end time - start time for the stages of the buildbot builds
[08:41:33] <eddyb> ah, nvm then
[08:41:50] <eddyb> dbaupp: does buildbot not output make check benchmark metrics?
[08:41:50] <cmr> sorry about that delay!
[08:41:58] <dbaupp> eddyb: it does
[08:41:59] <cmr> someone is making a loop with switches
[08:42:03] <dbaupp> but I can't get to them easily
[08:42:05] <dbaupp> :(
[08:42:20] <eddyb> hack the test servers :3
[08:42:41] <dbaupp> https://github.com/mozilla/rust/issues/9436
[08:42:43] <cmr> eddyb: so, if you write something that will run benchmarks and parse the data into some useful JSON, I'll write something to make graphs
[08:42:49] <eddyb> dbaupp: and leave a ssh backdoor which can only execute one command, to pull metrics
[08:42:53] <dbaupp> acrichto: ^ do you happen to have the ability to fix that
[08:43:07] <cmr> eddyb: really we just need more and better benchmarks though
[08:43:10] <cmr> there's an isssue open.
[08:43:15] <dbaupp> eddyb: the only problem is finding the url for them; they're actually uploaded to static.rust-lang.org already
[08:43:58] <eddyb> cmr: yes. regression benchmarks for any perf fix should be a must in the future
[08:44:13] <cmr> I don't r+ without a benchmark anymore.
[08:44:25] <cmr> that's just me though
[08:44:30] <eddyb> this could've been caught earlier and (well, I don't know. I have to check that inline thing)
[08:44:51] <eddyb> cmr: quick, edit the contribution guidelines and pretend it was always there :P
[08:45:29] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[08:45:59] <eddyb> I know I've asked this already, but can I recompile only stage1-std?
[08:46:11] <cmr> the fact that even the unsafe set_memory bench regressed by a good 25ns is really worrying.
[08:46:28] <eddyb> I mean, the one which is used when compiling a rustc executable with stage1 rustc
[08:48:07] <eddyb> wait, set_memory *should* be memset
[08:50:04] <cmr> yes.
[08:50:06] <cmr> it is.
[08:50:20] <dbaupp> so why is it slower?
[08:50:46] <cmr> who knows.
[08:50:53] <cmr> it's ~25ns slower than it used to be.
[08:51:07] <dbaupp> magic
[08:51:56] <eddyb> cmr: lol, set_memory is faster than calloc
[08:53:52] <eddyb> test bench_loop       ... bench:      1528 ns/iter (+/- 15)
[08:54:05] <eddyb> it's not the finally, good thing I tested that
[08:54:31] <eddyb> that's still 7 times slower than it should be
[08:54:50] <dbaupp> what's C?
[08:56:56] <eddyb> echo 'fn main(){let mut v: ~[u8] = ::std::vec::with_capacity(1024); unsafe {::std::vec::raw::set_len(&mut v, 1024);} unsafe {::std::vec::raw::set_len(&mut v, 1024);}}' | ~/Projects/rust/x*/stage1/bin/rustc - -o /dev/stdout --opt-level=3 -S --emit-llvm | ix
[08:56:58] <eddyb> http://ix.io/9ku
[08:57:25] <eddyb> wait, that's tiny compared to what I've seen
[08:59:07] <eddyb> I think this is the loop https://gist.github.com/eddyb/9078327e85b628f72a5a#file-loop-set-ll-L18-L26
[08:59:16] <dbaupp> eddyb: that's not zeroing the vector?
[08:59:33] <eddyb> ERR
[08:59:38] <eddyb> paste fail
[09:01:07] <eddyb> the duplicate unsafe block should've been for i in range(0, 1024) {v[i] = 0;} https://gist.github.com/eddyb/9078327e85b628f72a5a#file-loop-set-ll-L21
[09:01:22] <eddyb> now I have to find the loop. why does it have to be so unreadable?
[09:01:37] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[09:01:37] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/zj7HcA
[09:01:37] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[09:02:50] *** Quits: ssbr (devin@moz-8EC4F450.lightspeed.sntcca.sbcglobal.net) (Ping timeout)
[09:03:58] <eddyb> https://gist.github.com/eddyb/9078327e85b628f72a5a#file-loop-set-ll-L57-L62
[09:04:14] <eddyb> cmr, dbaupp: why on earth is it doing that crazy dance?
[09:04:30] <cmr> who knows
[09:04:51] <eddyb> oooh, it's bound checking
[09:05:30] <eddyb> "match_else" is just annoyingly useless
[09:06:22] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[09:06:22] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Ry6qQA
[09:06:22] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[09:06:23] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[09:06:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/xSHv4A
[09:06:23] <ghrust> 13rust/06auto 14bd36b06 15Kevin Ballard: Support imports of the form `use {foo,bar}`...
[09:06:23] <ghrust> 13rust/06auto 14fff03a5 15bors: auto merge of #10808 : kballard/rust/use-braces, r=alexcrichton...
[09:06:23] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[09:06:37] <eddyb> %9 = phi i64 [ 1024, %"normal return" ], [ %.pre, %next5.match_else_crit_edge ] ; so it has a case in which the length has changed
[09:07:44] <eddyb> cmr: oh wow. this probably hits everyone
[09:08:02] <eddyb> including my png Decoder
[09:08:33] <eddyb> cmr: it can't ellide the bounds check because it's part of the allocation
[09:08:42] <cmr> eddyb: what, bounds checks hit everyone?
[09:08:49] <cmr> unsafe_get is a thing.
[09:09:00] <cmr> the vector iterators omit bounds checks.
[09:09:12] *** Joins: ssbr (devin@moz-8EC4F450.lightspeed.sntcca.sbcglobal.net)
[09:09:16] <eddyb> well, that could work. I'll try mut_iter in a sec
[09:09:42] <eddyb> cmr: I think that's why strcat's fat pointer repr performed better
[09:09:45] <cmr> llvm isn't very smart about bounds checks at all.
[09:10:06] <eddyb> the current repr is asking for bloat from LLVM
[09:10:56] <eddyb> it would have to do aliasing analysis to show that a dumb loop can't overwrite the length
[09:11:18] <cmr> they optimise what clang uses.
[09:11:20] <cmr> and the stl
[09:11:27] <cmr> any deviation from that is asking for pain.
[09:13:00] <eddyb> cmr: if you find the change which made set_memory slower, can you make a -S --emit-llvm diff between that and the previous build?
[09:13:10] <eddyb> if it's fixable, might as well
[09:13:43] <eddyb> it's still faster than calloc, which means we can beat C/C++, if we weren't doing stupid things all over the place
[09:13:52] <eddyb> s/can/could/
[09:15:27] <eddyb> test bench_mut_iter   ... bench:       212 ns/iter (+/- 42)
[09:15:37] <eddyb> that's as fast as vec_repeat. which is slower than set_memory
[09:15:55] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[09:17:32] *** Quits: MOeltjenbruns (goofy@moz-D9C12442.hsd1.mn.comcast.net) (Connection reset by peer)
[09:17:47] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[09:18:24] <eddyb> while it's slower than set_memory, it does use memset https://gist.github.com/eddyb/9078327e85b628f72a5a#file-mut-iter-ll-L30
[09:18:29] <eddyb> so I can't complain there
[09:19:06] <eddyb> it might be the Finallyalizer::drop for from_elem, still
[09:20:00] <eddyb> also updated the bench https://gist.github.com/eddyb/9078327e85b628f72a5a#file-bench-from-elem-rs-L33-L57
[09:20:44] <cmr> eddyb: so what do you want me to do?
[09:21:05] <eddyb> cmr: did you find where set_memory got slower?
[09:21:09] <cmr> no
[09:21:14] <eddyb> that would be one thing
[09:21:17] <cmr> I'm asking you what exactly you want me to do, so I can do it fast :p
[09:21:20] * cmr is semi-busy.
[09:21:43] <eddyb> ahh. nothing else atm. update your bench.rs in case you want to start testing again
[09:23:10] <eddyb> cmr: you could tell me how to rebuild the second std that is built by make rustc-stage1 without rebuilding the first std (and librustc)
[09:23:25] <cmr> if NO_REBUILD=1 doesn't do it, then do it yourself
[09:23:46] <Luqman> you can find the command to copy/paste with VERBOSE=1 make
[09:24:06] <eddyb> Luqman: hmm, thanks
[09:24:27] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[09:25:53] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[09:35:08] *** Quits: Kxepal (Miranda@moz-84D27387.pppoe.mtu-net.ru) (Ping timeout)
[09:38:16] *** Joins: Kxepal (Miranda@moz-EDD846B4.pppoe.mtu-net.ru)
[09:41:42] *** Joins: zmthy (tim@moz-C2881CC3.ecs.vuw.ac.nz)
[09:42:42] *** Quits: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net) (Quit: ChatZilla 0.9.90.1 [Firefox 26.0/20131202182626])
[09:49:18] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[09:54:13] <cmr> So that's curious.
[09:58:00] *** Quits: zmthy (tim@moz-C2881CC3.ecs.vuw.ac.nz) (Quit: leaving)
[09:59:51] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[10:00:00] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[10:04:50] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[10:06:15] <eddyb> you can tell I did something stupid
[10:06:39] <cmr> eddyb: jemalloc removal was cause of regression.
[10:06:40] <eddyb> dbaupp, cmr: I just realized I can build stage0-std and use that with stage0 rustc
[10:06:54] <eddyb> okay, allocations are slower, we can ignore that
[10:07:53] <eddyb> do we have a #[warn_on_use] or #[deprecated] for fn's?
[10:08:02] <cmr> we have #[deprecated]
[10:08:05] <dbaupp> #[deprecated]
[10:08:07] <eddyb> :D
[10:08:14] <dbaupp> it doesn't work for methods yet
[10:08:17] <eddyb> :/
[10:08:20] <dbaupp> unfortunately
[10:08:23] <cmr> one of my break tasks is improving stability attrs.
[10:08:42] <eddyb> anyways, I can use unsafe, this is just a statistic thing
[10:09:05] <dbaupp> cmr: there's not much do to; just work out how to get to a method attributes in rustc
[10:09:15] <cmr> dbaupp: are there warns for them?
[10:09:16] <dbaupp> and work out what to do on modules, etc.
[10:09:20] <dbaupp> cmr: yes
[10:09:21] <cmr> oh
[10:09:26] <cmr> well then.
[10:09:31] <cmr> whoever put that on my list is annoying :p
[10:09:35] <dbaupp> -W help | grep experimental
[10:09:39] <dbaupp> and deprecated
[10:09:42] <dbaupp> and unstable
[10:10:33] <eddyb> I want to mark all length-modifying or capacity-inspectiong/modifying ~[T] methods as unsafe
[10:10:53] <cmr> why
[10:10:55] <eddyb> *then* count the errors in libsyntax/librustc
[10:11:08] <dbaupp> you... won't be able to get through libsyntax
[10:11:13] <eddyb> oh, right :(
[10:11:18] <cmr> that includes .push
[10:11:20] <dbaupp> also, the compiler might quit before printing all the erorr
[10:11:25] <cmr> which is ubiquitous
[10:11:26] <eddyb> cmr: yes
[10:13:07] <eddyb> the long-term plan would be to #[deprecated("~[T] will be non-growable in the future, please switch to std::vec::Vec<T>")] all those methods and add that Vec<T> as an usable growable vector (including conversions to/from ~[T])
[10:13:42] <eddyb> I mean, ~[T] is either going away for good or becoming non-growable
[10:14:08] <eddyb> and the current repr is horrible for bounds checking
[10:15:45] <eddyb> if it becomes a fat pointer, you want to remove that capacity as soon as possible. removing the capacity before everyone switched to Vec<T> will create performance issues (because you can still push, you'll just realloc every time. I might check to see how bad it is with in-place realloc)
[10:17:13] <eddyb> cmr: inlining the finally dtor removes the Finallyalizer from the stack
[10:17:58] <eddyb> there is no mention of [Ff]inally in the entire ll
[10:18:52] <eddyb> how I love attributes required for optimizations to start taking place
[10:19:28] <eddyb> cmr: I fixed it test bench_from_elem  ... bench:       195 ns/iter (+/- 19)
[10:19:30] <eddyb> COMPLETELY
[10:19:35] * dbaupp hugs eddyb 
[10:20:13] <eddyb> I am not even going to test this. I'll create a branch for it, though
[10:20:25] <cmr> just be removing finally?
[10:20:29] <cmr> It wasn't added for no reason.
[10:20:37] <eddyb> #[inline] on the finally dtor
[10:20:54] <eddyb> it wasn't getting inlined, so LLVM was assuming anything can happen
[10:20:58] <cmr> oh
[10:24:39] <eddyb> I was wondering how this was working: // Don't link to std. We are std.
[10:29:34] <eddyb> cmr: I lied. I'm adding the benchmarks to std::vec
[10:29:59] <eddyb> who knows what else this was slowing down
[10:30:53] <dbaupp> well... if someone were to fix #9436 we might have some idea... :P
[10:31:37] <eddyb> really need to borrow the bot that's now in #servo
[10:33:05] <dbaupp> yup
[10:33:46] <eddyb> make check-stage1-std NO_REBUILD=1 TESTNAME=zero_1kb # hopefully this works
[10:34:34] <eddyb> pls don't update llvm
[10:37:01] <eddyb> hah, it runs configure but doesn't rebuild, that's nice
[10:37:51] <eddyb> and I can run check-stage0-std
[10:45:46] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[10:47:54] <eddyb> but I have to compile LLVM first because I pulled master
[10:56:13] <nmatsakis> pnkfelix: ping
[10:58:37] <pnkfelix> nmatsakis: pong
[11:00:52] <nmatsakis> pnkfelix: sigh. now I forgot what I wanted to ping you about.
[11:01:12] <pnkfelix> nmatsakis: heh, usually there's a few hours lag for me before that happens
[11:02:27] <nmatsakis> pnkfelix: I know, I tihnk I had forgotten before I even wrote "ping" ;)
[11:02:37] <nmatsakis> I just remembered "oh, pnkfelix is here, there was something I wanted to say"
[11:03:10] <pnkfelix> nmatsakis: right, I know what you mean.  "I'm sure i'll remember what it was by the time I get ponged"
[11:04:18] <nmatsakis> pnkfelix: I think I was looking at this issue of making fields private by default,
[11:04:41] <nmatsakis> was it you I was talking to about requiring "mut" to be declared on fields
[11:04:44] <nmatsakis> ?
[11:04:52] <pnkfelix> nmatsakis: you had mentioned bringing that back
[11:05:00] <pnkfelix> nmatsakis: I think that was one of the Q's at codemesh
[11:05:13] <nmatsakis> pub struct Point { pub mut x: float32 } does seem pretty intolerable
[11:05:31] <pnkfelix> nmatsakis: (about how mutability is controlled, and about it being useful to be able to carve out immutable subparts)
[11:05:51] <nmatsakis> pnkfelix: right. it's potentially useful, though they are of course not immutable.
[11:06:12] <nmatsakis> pnkfelix: I suppose this can be achieved using privacy too
[11:06:21] <nmatsakis> e.g., struct Imm<T> { priv f: T }
[11:06:34] <nmatsakis> which supports only get() and get_ref() -> &T
[11:06:38] <pnkfelix> nmatsakis: â€¦ do you mean "not immutable" because of unsafe code?  Or is there something else I'm missing?
[11:06:42] <nmatsakis> hmm no that doesn't really work,
[11:06:51] <nmatsakis> since you could always do: x.f = Imm::new(...)
[11:07:02] <nmatsakis> pnkfelix: No, I mean not immutable because you could overwrite the struct as a whole
[11:07:06] <pnkfelix> nmatsakis: oh right
[11:07:22] <pnkfelix> nmatsakis: Is there someway to prevent *that* ?
[11:07:53] <pnkfelix> nmatsakis: (to tie an inline object to the whole object?  I think we've talked about this before, about whether its pointless)
[11:07:53] <nmatsakis> pnkfelix: not really.
[11:08:03] <nmatsakis> pnkfelix: you have to make types "unassignable"
[11:08:11] <nmatsakis> pnkfelix: it leads to a whole mess, I tried it. 
[11:08:37] <nmatsakis> pnkfelix: interestingly, C++ DOES have a similar rule -- if you hvae a const field, it won't make a copy constructor, or something like that. I forget precisely what it is.
[11:09:09] <nmatsakis> pnkfelix: the easiest way is just to return a GC<T> :)
[11:10:39] <dbaupp> nmatsakis: another accuracy-of-docs question (if you have a minute) https://github.com/mozilla/rust/issues/10890
[11:11:11] <nmatsakis> dbaupp: ok
[11:14:46] <eddyb> nmatsakis: what if you add drop? no, you can still assign it by moving to it
[11:16:20] <eddyb> dbaupp: https://github.com/mozilla/rust/pull/10918 I can't have a summary that looks nice for both github and the bors commit
[11:16:21] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[11:16:21] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/xSHv4A
[11:16:21] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[11:16:39] <eddyb> for a second there I thought someone r+'d me
[11:16:41] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[11:16:51] <eddyb> dbaupp: LLVM takes a lifetime and I updated two days ago
[11:18:36] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[11:20:52] <nmatsakis> eddyb: hmm. if you added a drop trait, then it's true you couldn't overwrite something without the drop trait, but that doesn't solve it
[11:21:24] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[11:21:24] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/bPdw9Q
[11:21:24] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[11:21:24] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[11:21:25] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/RKrWzA
[11:21:25] <ghrust> 13rust/06auto 145a93d12 15klutzy: std::io: Add Buffer.lines(), change .bytes() api...
[11:21:25] <ghrust> 13rust/06auto 145c2f8aa 15bors: auto merge of #10856 : klutzy/rust/buf-reader-lines, r=alexcrichton...
[11:21:25] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[11:22:25] <eddyb> Imm could have a special attribute which makes lvalues of its type unassignable
[11:22:41] <eddyb> but I like how we're avoiding a new keyword with types :D
[11:23:16] <eddyb> like that "unsized" thing - either Unsized or !Sized would work, but please not a keyword
[11:24:49] <eddyb> why is llvm building *unit tests* of all the things?
[11:26:48] <nmatsakis> I don't think "true" immutability is necessarily that imp't or what people actually want in any case.
[11:27:37] <eddyb> I guess this is similar to Freeze
[11:28:25] <eddyb> sadly LLVM can't take for granted that a field is constant
[11:43:39] <eddyb> why is std built before rustuv if std uses rustuv?
[11:43:47] <eddyb> is it a circular dependency thing?
[11:44:21] <dbaupp> std doesn't use rustuv directly
[11:44:41] <eddyb> but it wants it
[11:44:45] <dbaupp> trait objects + some compiler magic in putting the factory trait object in the right place
[11:44:57] <dbaupp> does it explicitly `extern mod` it?
[11:45:05] <eddyb> hmm
[11:45:22] <dbaupp> oh, it does, for tests.
[11:45:37] <eddyb> #[cfg(test)] extern mod rustuv = "rustuv#0.9-pre"; // yeah
[11:46:17] <eddyb> nevermind what I said, I'm compiling all of this right now
[11:46:52] <eddyb> wait, I was compiling libsyntax :/
[11:47:10] <eddyb> not libstd. so where's rustuv? did I break it? does it want stage1 rustuv?
[11:47:12] <dbaupp> in any case, getting the tests to work for std are a bit of a hack
[11:47:26] <dbaupp> has anything complained yet?
[11:47:50] <eddyb> dbaupp: I couldn't do make check-stage0-std TESTNAME=zero_1kb # because it was erroring with "can't find rustuv"
[11:48:45] <cmr> eddyb: stage0 is never meant to be tested.
[11:49:05] <dbaupp> heh, the irfy backend hasn't been updated in so long it still uses fmt!
[11:49:13] <dbaupp> (and loop instead of continue)
[11:49:16] <eddyb> yes, but stage1 requires me to build rustc which is too big
[11:50:41] <dbaupp> well
[11:50:50] <dbaupp> do you have a recent rustc locally?
[11:51:04] <dbaupp> or `make check-stage2-std TESTNAME=... NO_REBUILD=1`
[11:51:30] <eddyb> so stage0 isn't supposed to work? I thought it did and I broke it. hmm
[11:51:36] <cmr> nope
[11:51:56] <cmr> the farther away you get from stage2, the weirder things get
[11:53:15] <eddyb> same rustuv error for check-stage1-std
[11:53:19] <eddyb> which surely works
[11:53:30] *** Joins: w3lcome (Mibbit@moz-33A75FFD.home.otenet.gr)
[11:53:37] <eddyb> can I build just rustuv?
[11:54:52] <eddyb> I have x86_64-unknown-linux-gnu/stage0/lib/rustc/x86_64-unknown-linux-gnu/lib/librustuv.so and a .so/.rlib pair for the long name
[11:55:08] <eddyb> same for stage1
[11:56:13] <eddyb> so what did I break?
[11:57:02] <klutzy> `make x86_64-unknown-linux-gnu/stage1/lib/librustuv.so` seems to work
[11:57:05] <eddyb> /home/eddy/Projects/rust/src/librustuv/lib.rs:37:0: 37:26 warning: unknown crate attribute, #[warn(attribute_usage)] on by default
[11:57:05] <eddyb> /home/eddy/Projects/rust/src/librustuv/lib.rs:37 #[pkgid="rustuv#0.9-pre"];
[11:57:14] <eddyb> oh, I ignored that warning
[11:57:48] <eddyb> is master broken?
[11:58:32] <eddyb> or just the snapshot?
[11:58:36] <klutzy> eddyb: currently unknown-attr-lint has "known attributes" list manually
[11:58:55] <klutzy> so it is just that the new attribute is not in librustc/middle/lint.rs somewhere
[11:59:11] <eddyb> new? how new?
[11:59:26] <eddyb> I guess I have to compile stage1 rustc anyway >_>
[12:01:10] <eddyb> and this is how I spend an entire day on this 5-min fix: https://github.com/mozilla/rust/pull/10918
[12:01:31] <klutzy> uh.. "pkgid" exists in the code.
[12:01:53] <klutzy> so it's just that old snapshot doesn't know it
[12:02:38] <eddyb> yupp. at least only stage0 tests need it, so it doesn't break other things
[12:05:55] *** kimundi is now known as zz_kimundi
[12:06:02] *** zz_kimundi is now known as kimundi
[12:26:46] <eddyb> dbaupp, cmr: let's get this over with https://github.com/mozilla/rust/pull/10918
[12:27:40] <dbaupp> eddyb: what were they before on your machine?
[12:28:17] <eddyb> dbaupp: https://gist.github.com/eddyb/9078327e85b628f72a5a#file-bench-from-elem-rs-L61
[12:28:40] <eddyb> from_elem was almost 20 times slower
[12:40:21] *** Joins: canhtak (canhtak@moz-1D882009.wl.t.ulaval.ca)
[12:44:24] *** Quits: canhtak (canhtak@moz-1D882009.wl.t.ulaval.ca) (Quit: canhtak)
[12:47:19] <eddyb> nmatsakis: did you happen to look at that variadics PR?
[12:59:52] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[13:00:17] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[13:16:24] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[13:16:43] *** Joins: canhtak (canhtak@moz-1D882009.wl.t.ulaval.ca)
[13:17:38] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[13:18:41] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[13:19:26] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[13:30:22] <eddyb> what's wrong with bors?
[13:31:20] <eddyb> two hours to test? what's going on?
[13:33:02] <eddyb> is that normal? I recall it being half an hour maybe one full hour
[13:36:19] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[13:36:19] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/RKrWzA
[13:36:19] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[13:41:20] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[13:41:20] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/5ciH8Q
[13:41:20] <ghrust> 13rust/06auto 1422f14fb 15Niko Matsakis: Issue #9629 -- permit freezing `&mut` found within an `&` pointer
[13:41:20] <ghrust> 13rust/06auto 149f7baed 15Niko Matsakis: Address nits for PR for #9629
[13:41:20] <ghrust> 13rust/06auto 141252947 15Niko Matsakis: Make main pub in test case (cc #9629)
[13:41:22] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[13:55:11] *** kimundi is now known as zz_kimundi
[14:00:06] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[14:12:42] *** Joins: Axord (xord@moz-C0D5F15A.lsanca.dsl-w.verizon.net)
[14:16:33] *** Quits: Axord (xord@moz-C0D5F15A.lsanca.dsl-w.verizon.net) (Ping timeout)
[14:18:30] <ChrisMorgan> eddyb: I think I heard one of the linux servers was down
[14:19:38] <ChrisMorgan> There, I think I've finally finished purging all use of `do` (though I haven't removed it yet) and am completely up to date (some decelling came in between and made for quite a few conflicts due to the close proximity of use cases of `Cell` and `do`). Ahh... well, tomorrow I guess it'll bitrot again :-)
[14:23:31] <eddyb> ChrisMorgan: I might have to wait on 10 other PRs :/
[14:23:42] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[14:23:49] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[14:25:13] <ChrisMorgan> Joining PRs could help improve performance; #10888 (Vim updates), for example, needs no testing at all.
[14:33:26] <eddyb> compile errors are fast to catch, so the servers could alternate between PRs, preferring earlier steps
[14:34:30] <eddyb> the total time shouldn't be greater than what is now, and some PRs might get rejected sooner
[14:34:55] <eddyb> also, the non-test build servers can run tests on builds from test build servers
[14:35:07] <eddyb> (not sure why we have so many configurations anyway)
[14:35:42] <eddyb> ChrisMorgan: is this order the order they'll be tried in? http://buildbot.rust-lang.org/bors/bors.html
[14:35:48] <ChrisMorgan> Yes.
[14:36:00] <eddyb> ouch. that screams "seeya tomorrow"
[14:36:09] <eddyb> which means I have time to fix other perf problems
[14:36:21] * ChrisMorgan is now going to bed. Seeya tomorrow.
[14:41:28] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[14:43:35] <eddyb> impl<'self,T> MutableVector<'self, T> for &'self mut [T] {
[14:43:47] <eddyb> that's full of inl- nevermind. it is what I want
[14:44:19] <eddyb> dbaupp, cmr, strcat: does #[inline] work when it's applied to a method in a trait impl?
[14:44:27] <eddyb> because I'm seeing something nasty here
[14:44:41] <cmr> eddyb: it should yes
[14:44:54] <eddyb> I have calls to mut_slice in my code
[14:47:34] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[14:48:48] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[14:49:57] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[14:53:52] <eddyb> cmr: this is really annoying
[14:55:35] <eddyb> cmr: haha, I can't use copy_from because someone forgot to put it in prelude
[15:08:39] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[15:18:34] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[15:20:27] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[15:23:01] *** Quits: canhtak (canhtak@moz-1D882009.wl.t.ulaval.ca) (Connection reset by peer)
[15:23:05] *** Joins: canhtak (canhtak@moz-1D882009.wl.t.ulaval.ca)
[15:35:12] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[15:37:21] <SimonSapin> Does &'static Trait not fulfill Send?
[15:38:15] <cmr> Hm, it should, Send is the default bound
[15:38:18] <cmr> Try &'static Trait:Send
[15:39:11] <nmatsakis> eddyb: No. Sorry, I know I'm slow. It's creeping it's way up on my list of priorities though as things get crossed off.
[15:39:38] <cmr> Someone implement Clone for nmatsakis!
[15:40:14] <nmatsakis> eddyb: in particular I haven't forgotten about it :)
[15:40:14] <SimonSapin> to expand: I have an Encoding trait, and a Stylesheet struct. Stylsheet used to be sendable, but is not anymore when I add a field of type &'static Encoding (a trait object.)
[15:40:37] <SimonSapin> cmr: do you mean changing the field to be of type &'static Encoding:Send ?
[15:40:47] <cmr> SimonSapin: sounds about right, yeah.
[15:40:52] <SimonSapin> this is a trait object, not a generic type parameter
[15:41:01] <cmr> yes
[15:45:54] <eddyb> cmr: shhh, I'm trying to steal his job!
[15:49:40] <SimonSapin> cmr: that seems to work, but I had to change it everywhere this type is used across three libraries :x
[15:54:38] <eddyb> cmr: it's something which I like more and can do better than flipping burgers
[15:55:07] <eddyb> and there's probably more competition on the latter, too
[15:55:50] <eddyb> nmatsakis: eh, being busy is understandable, just making sure it's going somewhere
[15:56:20] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[15:56:21] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/5ciH8Q
[15:56:21] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[15:56:39] <SimonSapin> Are traits and types in the same namespace?
[15:56:43] <eddyb> gj. only 8 to go!
[15:57:14] <eddyb> rusti: type Foo = int; trait Foo {}
[15:57:28] <eddyb> did I... disconnect?
[15:57:37] <SimonSapin> well, itâ€™s probably a bad idea anyway
[15:57:53] <eddyb> rusti: version
[15:59:33] <cmr> eddyb: no?
[15:59:36] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[15:59:38] <cmr> SimonSapin: Not really..
[15:59:57] <eddyb> cmr: gotta love ping timeouts
[15:59:59] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[16:00:05] <SimonSapin> Iâ€™m gonna use this: type EncodingObj = &'static Encoding: Send;
[16:00:15] <eddyb> 3 second lag, what's with this server?
[16:00:17] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[16:00:28] <eddyb> SimonSapin: ah, I see what you were trying to do
[16:00:31] <eddyb> rusti: type Foo = int; trait Foo {}
[16:01:10] -rusti- pastebinned 8 lines of output: http://sprunge.us/ijhM
[16:01:36] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[16:01:36] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/W7avzg
[16:01:36] <ghrust> 13rust/06auto 144ceaf1a 15Vadim Chugunov: Embed Windows application manifest.
[16:01:36] <ghrust> 13rust/06auto 144dda8e0 15bors: auto merge of #10878 : vadimcn/rust/manifest, r=alexcrichton...
[16:01:37] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[16:01:58] <eddyb> what's with the delay?
[16:02:22] <eddyb> though 5 minutes isn't much for two hour builds, it's not ideal either
[16:02:36] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[16:02:41] <eddyb> SimonSapin: hah, it even calls the trait "type"
[16:02:54] <SimonSapin> Indeed. Thanks eddyb 
[16:04:01] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[16:04:18] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[16:08:00] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[16:08:19] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[16:10:50] <acrichto> dbaupp: I was just thinking about discovering benchmarks this morning, sadly I'm not sure my bors prowess is sufficient for that
[16:12:29] *** zz_kimundi is now known as kimundi
[16:16:00] <acrichto> wow without metadata the snapshot is half as large as it used to be
[16:16:06] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[16:19:03] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[16:21:22] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[16:21:22] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 144dda8e0 to 14d441c54: 02http://git.io/N3iJvQ
[16:21:22] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[16:22:15] <eddyb> "chris-morgan/rust/macroize-(or-should-that-be-macroify)-syntax--parse--token-so-that-we-don't-make-mistakes-and-to-reduce-the-maintenance-burden"
[16:22:42] <eddyb> bstrie: I nominate ^^^ as the branch name of the year
[16:24:30] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[16:26:13] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[16:33:55] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[16:39:12] <pnkfelix> grr, link failures, undefined symbols _LLVMRustLinkInExternalBitcode and _LLVMRustRunRestrictionPass
[16:39:32] <acrichto> pnkfelix: I saw that once or twice, I'd run a 'make clean'
[16:39:36] <pnkfelix> (guess I'll try a clean rebuild)
[16:39:45] <pnkfelix> acrichto: k
[17:01:59] *** Joins: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP)
[17:09:51] *** Quits: doomlord_ (servitor@moz-D40D68D6.range86-184.btcentralplus.com) (Connection reset by peer)
[17:19:29] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[17:21:27] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[17:25:32] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[17:29:13] <acrichto> failed to resolve import `std::cell::Cell`
[17:29:16] <acrichto> that makes me happy
[17:29:17] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[17:42:17] *** Quits: w3lcome (Mibbit@moz-33A75FFD.home.otenet.gr) (Quit: http://www.mibbit.com ajax IRC Client)
[17:53:39] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[17:58:30] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[18:03:41] *** Joins: sanxiyn (tinuviel@5572118A.71F82290.4BEB41DB.IP)
[18:11:16] *** Joins: doomlord_ (servitor@moz-D40D68D6.range86-184.btcentralplus.com)
[18:11:51] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[18:23:01] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:23:01] *** ChanServ sets mode: +qo brson brson
[18:24:05] *** Quits: carter (carter@moz-3589B90B.c.ircrelay.com) (Ping timeout)
[18:31:33] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[18:31:33] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/id2hxw
[18:31:33] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[18:36:18] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[18:36:19] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/L8lcPQ
[18:36:19] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[18:36:21] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[18:36:21] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/SJnkSg
[18:36:21] <ghrust> 13rust/06auto 14267ac45 15Chris Morgan: Deduplicate in syntax::parse::token with a macro....
[18:36:21] <ghrust> 13rust/06auto 14d4f5ae0 15Chris Morgan: Remove the following unused special identifiers:...
[18:36:22] <ghrust> 13rust/06auto 14dd042ef 15Chris Morgan: Separate strict/reserved keywords, derive bounds....
[18:36:24] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[18:37:00] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[18:39:08] *** Joins: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[18:39:09] *** ChanServ sets mode: +ao pcwalton pcwalton
[18:39:39] *** Joins: bynaryshef (bynaryshef@moz-B4E38B6F.mem.bellsouth.net)
[18:41:39] *** Joins: carter (carter@moz-3589B90B.c.ircrelay.com)
[18:42:22] *** Joins: notmatt (notmatt@CFB1216.DD50E21A.47C41102.IP)
[18:50:08] *** Joins: w3lcome (Mibbit@moz-E9ABA59E.home.otenet.gr)
[18:50:32] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[19:13:18] <Eridius> oh you've got to be kidding me. With the new #[pkgid] stuff, omitting that attribute produces the wrong library name!
[19:13:54] <Eridius> actually, it produces the wrong name even with it
[19:14:04] <Eridius> it's now apparently based off of the last path component of the #[pkgid] instead of based off of the link attributes
[19:15:00] *** Quits: bynaryshef (bynaryshef@moz-B4E38B6F.mem.bellsouth.net) (Quit: Leaving)
[19:16:09] *** Quits: sanxiyn (tinuviel@5572118A.71F82290.4BEB41DB.IP) (Quit: Bye)
[19:21:49] <Eridius> filed as https://github.com/mozilla/rust/issues/10922
[19:21:58] <Eridius> jack: ^
[19:22:57] *** jdm is now known as jdm|away
[19:23:08] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Ping timeout)
[19:24:09] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[19:38:43] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[19:39:03] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[19:39:33] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[19:41:14] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[19:43:34] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[19:52:52] *** Quits: notmatt (notmatt@CFB1216.DD50E21A.47C41102.IP) (Client exited)
[19:53:40] *** Parts: zokier` (zokier@moz-C4357EA7.kapsi.fi) ()
[19:54:07] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[19:58:34] <jack> Eridius: apparently we're talkign past each other on that bug. maybe we should hash it out here.
[19:58:57] <jack> link metadata is now completely ignored by the compiler except in the case of the new extern block taking it
[19:59:49] <jack> There is no difference inside the compiler as to how libraries are named except as to where the origin of hte name comes from. it used to come from link.name and link.vers and the crate hash. it now comes only from the pkgid attribute.
[20:00:18] <jack> if no link metadata existed, it infered it exactly as it does now. with 0.0 as the version and the name as the filestem of the input file
[20:02:11] <jack> I was expecting we would completely remove the link attribute after the next snapshot, but acrichto used it for one of his PRs so I don't think we can remove it now.
[20:02:40] <jack> If that were the case, libraries that had no link metadata would have been liblib and would still be, and libraries with link metadata would fail to compile.
[20:02:59] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[20:10:44] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[20:11:28] <Eridius> jack: I get that. But I think you're missing my two primary points
[20:11:58] <Eridius> jack: the first is that all existing libraries that used link attributes (as was recommended) are in trouble, unless their root filename happened to be the same as their library name
[20:12:23] <Eridius> jack: until your PR, the conventions, as I understood them, were to use lib.rs as the root name (or main.rs or whatever, but lib.rs seemed to be recommended), and use link attributes to set the name/version
[20:12:42] <Eridius> any library that followed these conventions is now called `liblib-9ed81b85-0.0.ext`
[20:12:55] <Eridius> which is a) completely wrong, and b) going to collide with every other library that followed these conventions
[20:13:49] <Eridius> jack: does this make sense?
[20:14:56] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[20:16:41] <Eridius> the second point boils down to the fact that you can't use the same string as a unique identifier for the hash _and_ as a name for the library, unless you want people to just make up names that have no semantic meaning. But the current interpretation as a /-delimited path ending with #vers very strongly indicates it was expected that the packageid would most commonly be the repo path, e.g. github.com/kballard/rust-lua
[20:16:50] <Eridius> which is incompatible with using it as the sole source for library naming, as I've been saying in the PR discussion
[20:18:23] <jack> yes, that is true. the fix for this would be to disallow link metadata so that those libraries can't compile without updating to the new system
[20:18:38] <jack> but i couldn't do that because then the compiler wouldn't bootstrap, so i figured we had to do it after a snapshot
[20:19:27] <jack> i'm not sure what to do about point 1. other than go back post-snapshot and disallow link metadata.
[20:19:37] <Eridius> jack: why do you keep suggesting disalloing link metadata? That does not solve either issue
[20:20:07] <Eridius> my believe is that #[pkgid] cannot serve as the primary source for both the library name and the hash, as long as it consists of a single string
[20:20:10] <jack> because the issue is that the compiler used to fetch the link name from link metadata, and doesn't now. the link metadata is a unknown attribute as far as the compiler is concerned.
[20:20:17] <Eridius> because the desired properties of a library name, and of a hash, are different
[20:20:54] <jack> so if the problem is that cod ethat doesn't get updated now builds wrong, the solution is to not allow that code to build, the same as when for instance hte for loops changed.
[20:21:14] <Eridius> jack: you seem to be completely ignoring my second point
[20:21:23] <Eridius> which is that I cannot adopt #[pkgid] in my current library
[20:21:25] <jack> i haven't gotten to your second point. i'm just talking about point 1.
[20:21:33] <Eridius> without either getting the wrong library name, or using a bogus package id that has no semantic meaning
[20:21:43] <jack> you use a bogus package name now
[20:21:50] <jack> you don't work with rustpkg now.
[20:22:05] <Eridius> I don't work with rustpkg, but I don't think telling people to just make up meaningless strings is remotely appropriately
[20:22:08] <jack> why is your life so horribly changed to use pkgid="lua" or pkgid="github.com/kballard/rust-lua/lua"
[20:22:10] <Eridius> I can't use #[pkgid="lua"] because that's not unique
[20:22:22] <Eridius> and github.com/kballard/rust-lua/lua is confusing and wrong
[20:22:29] <Eridius> it looks like a path, but it's a path to something that doesn't exist
[20:22:38] <jack> you seem to argue that the hash will collide with some other package named lua or the first laternative (which is true and was potentially true before depending on your dependencies)
[20:22:55] <jack> for the second alternative your arugment is that rustpkg can't use that, which is something that is planned to be fixed.
[20:23:12] <Eridius> The collision issue was mitigated by the fact that I could add link attributes that were sufficiently unique
[20:23:17] <Eridius> not that I necessarily _did_, but it was an option
[20:23:30] <Eridius> the second argument is not just about rustpkg. It's about the fact that it's completely wrong
[20:23:45] <Eridius> I can't move my library into the subfolder "lua", making github.com/kballard/rust-lua/lua a valid path, because of rustpkg limitations
[20:23:51] <Eridius> but that's a separate issue from the fact that I don't want to move it at all
[20:24:00] <jack> it's only right or wrong insofar as we take into account rustpkg semantics.
[20:24:01] <Eridius> I am not rustpkg-compatible, therefore I want to keep it as github.com/kballard/rust-lua
[20:24:07] <Eridius> jack: you're overly focused on rustpkg
[20:24:14] <Eridius> I'm concerned with how this plays out without even looking at rustpkg
[20:24:23] <jack> if you don't care about rustpkg, set hte path of hte pkgid to ANYTHING YOU WANT :)
[20:24:37] <jack> com.eridus.foo/lua
[20:24:57] <jack> to rustc it is an opaque string.
[20:25:12] <Eridius> jack: and how do you then write documentation on this? "Make up a name, ensuring that somehow it's unique, and then add /libname to the end"? That's terrible
[20:25:55] <Eridius> It's really simple to just tell people "use the repo path, e.g. github.com/username/proj".
[20:26:01] <Eridius> that's by far the simplest way to ensure people get unique names
[20:26:09] <Eridius> but it doesn't work if that URL is used as the source for the library name
[20:27:31] <Eridius> jack: what objections do you have to making the library name still use #[link(name="foo")], falling back to the final path component of #[pkgid] if the link attribute is missing?
[20:28:14] <Eridius> That simple change would a) make existing libraries work again, and b) allow me to have the correct library name while still using a semantically-meaningful, unique pkgid
[20:28:21] <jack> It is just as arbitrary as using random strings in the pkgid to me.
[20:28:41] <Eridius> it's simple to document, simple to explain to people, and is compatible with how libraries work today
[20:29:12] <Eridius> it allows us to say, uniequivocally, that "#[pkgid] should be the repo path"
[20:29:38] <jack> what is the point of knowing the repo path if you can't find the librayr?
[20:29:48] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[20:29:53] <jack> which file in the repo is the one that is the library?
[20:30:07] <jack> the pkgid has become a vague namespace at that point
[20:30:20] <Eridius> jack: with the way your PR works today, which file in the repo is the one that is the library?
[20:30:35] <Eridius> I don't see how #[pkgid] solves the question of which file to build
[20:30:42] <jack> pkg.rs and lib.rs are examined.
[20:30:50] <Eridius> there you go, an official recommendation of libr.rs
[20:30:52] <Eridius> *lib.rs
[20:31:23] <jack> i don't think this works in principle which is why people have so much trouble with rustpkg.
[20:31:32] <jack> in practice i mean
[20:31:46] <Eridius> ok, but #[pkgid] does nothing to change that
[20:31:47] <jack> for example, glfw-rs has lots of main.rs's, and how do you know they are exmaples or not?
[20:31:50] <jack> it's a mess.
[20:31:54] <Eridius> picking the correct root source file seems orthogonal to the issue of naming the library
[20:32:09] <jack> agreed. which is why i have no objection to using pkgid liek a generic namespace and saying eridus/lua :)
[20:32:24] <jack> this is what java and clojure and such do
[20:32:32] <Eridius> the fact that it's /-delimited means that it's expected to represent something specific
[20:32:38] <Eridius> notably, a path
[20:32:46] <Eridius> which means, to me, that the path should actually be something real
[20:32:50] <jack> rustpkg is fairly unique in that it tries to make the namespacing overlap with real urls that you can get stuff from
[20:34:13] <Eridius> I just think that the suggestion of "make up some unique string, and tack /libname" on the end is bad, and will be very confusing to explain to new users
[20:34:35] <jack> Eridius: perhaps i just have a different perspective having worked iwth URIs a lot that have paths that don't mean anything and are just opaque strings. i understand your point though.
[20:34:39] <Eridius> But the suggestion of "use the repo path" only works if the final component of the repo path is the name of the library. Which it often isn't
[20:35:23] <jack> should we make pkgids morecomplicated then? github.com/kballard/rust-lua;lua#0.1 ?
[20:35:29] <Eridius> jack: if it was a URI, then yeah, opaque strings have a lot of precedent. #[pkgid] isn't defined as a URI
[20:35:43] <Eridius> jack: hrm... that's actually not a terrible idea
[20:36:02] <Eridius> that would avoid having to reintroduce link attributes, but would provide a name escape hatch, which is all I truly care about
[20:36:21] <Eridius> that coupled with disallowing link attributes (so as to force existing libraries to update) would be workable
[20:36:41] <jack> i would prefer it all to be in one string to make build tooling tractable
[20:37:03] <jack> i am wide open as to what that string should contain
[20:37:15] <Eridius> I was trying to think of some way to do e.g. #[pkgid(path="github.com/kballard/rust-lua#0.1",name="lua")] but I figured that wasn't very good.
[20:37:30] <jack> it works, it's just hard to grep for
[20:37:50] <Eridius> I suppose it could be #[pkg(id="github.com/kballard/rust-lua",vers="0.1",name="lua")] but that's still not ideal
[20:37:55] <jack> well, harder. it's not difficult :)
[20:38:03] <Eridius> #[pkgid="github.com/kballard/rust-lua;lua#0.1"] seems quite acceptable
[20:38:55] <Eridius> #[pkgid="github.com/kballard/rust-lua?lua#01"] also works, and has the benefit of being closer to URL format, but feels kind of wonky to me to use the query string in that way (plus I don't think a proper URI parser will parse the query string on a scheme-less string)
[20:39:22] <jack> they should. it's a valid relative url
[20:40:14] <Eridius> jack: yep, looks like it does parse it
[20:40:16] * Eridius tried NSURL
[20:40:50] <Eridius> but it still feels weird to use the query string in this fashion. Despite the fact that it's not significant to URL parsing (that I'm aware of), I think I like ;lua better
[20:41:02] <jack> i'm trying to think about whether this solves some rustpkg resolution issues
[20:41:15] <Eridius> oh huh, it is significant. Asking for the -path strips the ;lua
[20:41:42] <jack> probably not a valid url char
[20:41:47] <Eridius> ah hah, it's the -parameterString
[20:42:06] <Eridius> I knew ; was significant in URLs, but I thought it was only significant before the path. Looks like it's significant in the path after all
[20:42:23] <Eridius> mm yep <scheme>://<net_loc>/<path>;<params>?<query>#<fragment>
[20:42:32] <jack> really?
[20:42:40] * jack just learned something new about urls
[20:42:50] <Eridius> looks like FTP URLs use that to encode type parameters
[20:43:03] <jack> got an example FTP url that uses that?
[20:43:15] <Eridius> so I gues it could be #[pkgid="github.com/kballard/rust-lua;name=lua#0.1"], but I think I prefer it without the name= bit
[20:43:22] <Eridius> section 3.2.2 of http://www.ietf.org/rfc/rfc1738.txt talks about FTP URLs
[20:43:28] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[20:43:34] <Eridius> saying the url-path component of an FTP URL looks like   <cwd1>/<cwd2>/.../<cwdN>/<name>;type=<typecode>
[20:44:07] <jack> are multiple params allowed? are they separated iwth &?
[20:44:37] <Eridius> the URL BNF doesn't make & or = significant, but allows them both in the parameter string. I assume it's basically encoded the way query is
[20:45:27] <jack> if we allow arbitrary parameters, then canonicalization is a problem.
[20:45:48] <jack> so i'm with you about ;foo instead of ;name=foo
[20:45:50] <Eridius> actually the BNF suggests the parameter string is ;-delimited
[20:46:04] <jack> same problem regardless of delimiter.
[20:46:11] <Eridius> but I guess each scheme can define how parameters are interpreted? I dunno
[20:46:20] <Eridius> anyway, I see no reason to allow multiple parameters
[20:46:40] <jack> well my first thought was name=foo;version=0.1 and skip the hash thing
[20:46:43] <ChrisMorgan> ; isn't special for HTTP. They tried, it failed, we're left with just ?.
[20:47:10] <jack> the nice thing about url parts is that they are strictly ordered
[20:47:41] <Eridius> ChrisMorgan: ; is special for URLs in general
[20:47:47] <Eridius> ChrisMorgan: it's just apparently not used for anything in HTTP URLs
[20:48:02] <Eridius> but e.g. NSURL still parses it out in http://github.com/kballard/rust-lua;lua#0.1 as -parameterString and omits it from -path
[20:48:07] <Eridius> e.g. if you want it in your path you gotta percent-encode it
[20:48:43] <jack> unfortunately github consideres it a 404.
[20:48:50] <ChrisMorgan> Python requirements.txt has things like `git+https://github.com/divio/django-cms/archive/3.0.0.beta2.zip#egg=django-cms==3.0.0.beta2`, for reference.
[20:48:52] <Eridius> jack: the more we talk about it the more I'm a fan of #[pkgid="github.com/kballard/rust-lua;lua#0.1"] (coupled with disallowing the link attributes, so as to break existing library compilation)
[20:49:01] <ChrisMorgan> s/git+//
[20:49:30] <Eridius> jack: luckily nobody's going to see the pkgid directly and surface it as a clickable URL! Heck, there's not even a scheme on it
[20:49:49] <Eridius> and tools that surface the URL from the pkgid can strip the ;lua bit off themselves (just like they should strip off #0.1, because github doesn't care about that)
[20:49:52] <ChrisMorgan> (The Python example *is* a different situation, as it's for installation rather than specification of a package version. But they're similar.)
[20:50:12] <jack> it's solves one problem which is how to identify sub-libraries in repos
[20:50:26] <jack> which rustpkg can't currently do
[20:50:37] <ChrisMorgan> I'd prefer keeping both the lua and 0.1 parts as fragment, myself.
[20:51:27] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[20:51:27] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/SJnkSg
[20:51:27] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[20:51:39] <ChrisMorgan> Eridius: when I say ";" is not special, I say it with the backing of https://tools.ietf.org/html/rfc3986
[20:52:16] <Eridius> jack: my general feeling with sub-libraries is they should be in subfolders, which makes it easy as you can then say #[pkgid="github.com/kballard/rust-lua/sublib"]
[20:52:43] <ChrisMorgan> RFC 3986 more or less scrapped the ";", turning it from something that was in the specification to a "some people do it this way, some that way" feature.
[20:53:02] *** Joins: SiegeLordEx (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[20:53:20] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[20:53:35] <ChrisMorgan> Handling params specially in a URI type is probably not a good sign; it's defined in RFC 3986 as an opaque value.
[20:53:36] <Eridius> ChrisMorgan: ; is a "sub-delim" character, e.g. a delimiter that may or may not be used by a particular scheme
[20:53:48] *** Quits: SiegeLordEx (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[20:54:03] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: Leaving)
[20:54:12] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[20:54:15] <Eridius> ChrisMorgan: my argument is that you have to modify the pkgid to produce an http:// URL anyway, so I don't see the harm in adding "strip the param" to the list of "strip the fragment, add the scheme"
[20:54:50] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[20:55:53] <Eridius> jack: I don't see how using ;lua affects sublibraries, because it doesn't help with the problem of finding the root file. Inspecting all files to find the one that declares #[pkgid] seems acceptable, as does requiring the root to be pkg.rs/lib.rs and sub-libs to be in their own subfolders (and teaching rustpkg to handle libraries in subfolders)
[20:56:04] <ChrisMorgan> For myself, I think rustpkg would be wise to follow Python packaging's direction in most things (sans the historyâ€”copy the latest stuff only)â€”which includes the use of centralised package management so that you can separate *what* something is from *where* you get it from.
[20:56:23] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[20:56:23] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/a-TLdw
[20:56:23] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[20:56:23] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[20:56:24] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/tqnRgw
[20:56:24] <ghrust> 13rust/06auto 145731ca3 15Erik Price: Make 'self lifetime illegal....
[20:56:24] <ghrust> 13rust/06auto 141b12dca 15bors: auto merge of #10897 : boredomist/rust/remove-self-lifetime, r=brson...
[20:56:24] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[20:57:09] <ChrisMorgan> Eridius: but what if there is a semicolon in the genuine path? That's not exactly unthinkable, you know. ("%59"? Yuck.)
[20:57:27] <Eridius> ChrisMorgan: you should be percent-encoding it anyway, to be compatible with the older RFCs that URL parsers are typically built from (e.g. NSURL)
[20:57:41] <Eridius> NSURL is primarily based on RFC 1808
[20:57:47] <ChrisMorgan> Ick.
[20:58:03] <Eridius> the 3 RFCs it's based on are 1808, 1738, and 2732, but 1808 is the one that the URL parsing methods all reference
[20:59:15] <jack> ChrisMorgan: I would be more inclined to follow clojure where you have centralized repos but also namespaced package names.
[20:59:43] * ChrisMorgan isn't familiar with what clojure does
[20:59:46] <jack> I suppose that boils down to me not being fully convinced by url in pkgid thing
[20:59:58] <jack> clojure just uses dotted paths
[21:00:03] <Eridius> jack: for reference, my biggest complaint about Go's package handling is you cannot use relative imports in a go-get-compatible package. You must use the absolute "github.com/foo/bar/baz" import every time, which makes forking a repo a PITA
[21:00:23] <Eridius> but that was an intentional decision (to disallow relative imports), made for what I believe to be stupid reasons
[21:00:24] <ChrisMorgan> Yes, the Go approach is plain silly, and has been causing many people lots of trouble.
[21:00:25] <jack> clojure.core, com.foo.bar.something
[21:01:06] <Eridius> jack: reverse-DNS style paths is something I'm used to, from obj-c, but I'm not convinced that works for open source projects. What are you going to do if you don't own your own domain? com.github.user.projname? That's not very good
[21:01:08] <ChrisMorgan> jack: you can do that in Python too, it's just somewhat less common. (It happens significantly in the Zope side of the world, though.)
[21:01:10] *** Quits: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[21:01:14] <jack> for example: https://clojars.org/com.uswitch/clj-soap
[21:01:28] <jack> you have a namespace and a name separated by a /
[21:01:42] <ChrisMorgan> OK, that's a little different then.
[21:01:43] <Eridius> that looks weird to me
[21:02:20] <jack> syntax is not improtant, but that's how clojure names things in the language
[21:02:25] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[21:02:25] *** ChanServ sets mode: +ao pcwalton pcwalton
[21:02:31] <jack> like a var in the foo.bar namespace is written foo.bar/something
[21:02:37] <jack> so it's just familiar syntax in clojure.
[21:02:46] <Eridius> I see
[21:03:11] <ChrisMorgan> It doesn't sound like it'd be appropriate for Rust; Rust doesn't have that variety of namespacing.
[21:03:32] <ChrisMorgan> Rust extern mods are flat, so I think the Python model holds better?
[21:04:37] <Eridius> ChrisMorgan: I am unclear as to what the python model is
[21:04:46] *** jdm|away is now known as jdm
[21:04:51] <ChrisMorgan> (If I seem to be appealing to Python too frequently, it's because most of my experience has been with Python. There are good things out there that I haven't encountered, I just tend to think that [given the language being what it isâ€”Rust is necessarily somewhat different] it does a good job in most things.)
[21:05:03] <jack> java uses reverse domain name things and it's dots all the way
[21:05:19] <ChrisMorgan> Eridius: http://pypi.python.org/
[21:05:26] <jack> clojure just choose to make the final bit specially
[21:05:58] <jack> my point is that you go to clojars to find packages and you ask for foo or com.example/foo
[21:06:06] <jack> the good part about this is that forking a package is awesome
[21:06:18] <jack> because it's still called foo, but now it's com.something/foo
[21:06:37] <Eridius> I think having a centralized index of packages is useful, but it can be done even when the package IDs are tied to their sources
[21:06:40] <Eridius> e.g. there are listings of Go packages
[21:06:46] <jack> Sure
[21:07:06] <ChrisMorgan> It makes it a whole lot harder and makes moving hard.
[21:07:27] <ChrisMorgan> You want to shift from github.com/foo/bar to bar.com? Have fun.
[21:08:04] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Ping timeout)
[21:08:06] <Eridius> the upside to requiring a centralized listing is, yes, you can move your repo around without much trouble (but how often does that happen?). The downside is now you're dependent upon a single centralized location that could e.g. go down temporarily, thus making it impossible for you to fetch your dependencies
[21:09:08] *** Joins: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[21:09:08] *** ChanServ sets mode: +ao pcwalton pcwalton
[21:09:17] <ChrisMorgan> PyPI is actually designed so that you can have multiple source cheeseshops, and enterprises will often use that (it's quite easy to make mirrors of pypi.python.org covering the packages you need), but you're right that for the proletariat it can be a nuisance if it goes down.
[21:10:47] <ChrisMorgan> I've seen a couple of good articles on the relative merits of the packaging models employed by Go and Python, but of course I can't find them now.
[21:10:49] <Eridius> overall, Go's approach works pretty well, with the one exception being the ban on relative imports I already complained about. But there's no need for Rust to enact a similar ban, which means forking in rustpkg shouldn't be problematic
[21:10:55] <dbaupp> acrichto: fwiw, it could be fixed just by changing the first "MasterShellCommand" step to have a `zip metrics.zip *.json` before the s3cmd step. (i.e. make this two lines http://buildbot.rust-lang.org/builders/auto-win-32-nopt-c/builds/2010/steps/MasterShellCommand/logs/stdio )
[21:11:16] * ChrisMorgan dislikes Go's approach and thinks it unwise
[21:11:49] <acrichto> dbaupp: so the name of the json files are unknown?
[21:12:09] <dbaupp> acrichto: yeah, they have the platform specific prefix
[21:12:28] <ChrisMorgan> I think a more interesting question for packaging is: how will we cope with binary-only packages?
[21:12:33] <acrichto> dbaupp: hm interesting
[21:12:53] <dbaupp> acrichto: (so not exactly unknown, but it seems unproductive to have it hardcoded for every platform, when I could pester people to fix it at the source :) )
[21:13:36] <acrichto> I see the s3cmd location
[21:15:34] <Eridius> ok, so back to #[pkgid]. ChrisMorgan, I recognize that you think this approach is unwise, but it's the approach we already seem to be taking. My feeling is that discussing an alternative way of identifying packages and distributing them should be discussed separately
[21:15:48] <Eridius> I'd like to settle the matter of how to make rust master work with libraries today
[21:16:05] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[21:16:05] <ChrisMorgan> You're right; that can wait for future discussion.
[21:16:22] <Eridius> jack: right now, I think #[pkgid="github.com/kballard/rust-lua;lua#0.1"] is the best proposal
[21:16:48] <Eridius> any code that's already adopted #[pkgid] will work as-is, and this provides an escape hatch, compatible with RFC 1808, for picking a different library name, which is what I want
[21:17:02] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[21:17:06] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[21:17:06] *** ChanServ sets mode: +qo brson brson
[21:17:07] <Eridius> I agree that we should also disallow link args, so as to force existing libraries to update, but I think you said something about acrichto submitting a PR that uses link args?
[21:17:22] <dbaupp> at the risk of bikeshedding why are we trying to fit everything into a string at the user level? `#[pkgid(url="...", name="...", vers="...")]`?
[21:17:45] *** Quits: canhtak (canhtak@moz-1D882009.wl.t.ulaval.ca) (Quit: canhtak)
[21:17:52] <Eridius> dbaupp: I think it's to make external tooling easier, so it can parse the #[pkgid] declaration easily
[21:18:05] <jack> dbaupp: in order for external tooling to determine the crate hash
[21:18:12] <dbaupp> ah, ok
[21:18:14] * ChrisMorgan prefers #[pkgid="github.com/kballard/rust-lua#lua,0.1"] (the comma could be something else, e.g. =)
[21:18:24] <Eridius> although personally, I think the easiest way to determine the crate hash is to build the library, then embed the resulting name in the Makefile
[21:18:27] <jack> dbaupp: it can be done that way, but it involves a lot more complicated parsing and canonicalization
[21:18:38] <jack> right now it's grep for this and run it through SHA256
[21:18:49] <Eridius> making the hash deterministic and based on #[pkgid] is nice because then it won't change out from under me
[21:19:01] <jack> Eridius: that is possible regardless :)
[21:19:06] <jack> well, it's possible *now*
[21:19:09] <ChrisMorgan> Embedding the hash in the Makefile is what I do with rust-http at present.
[21:19:11] <Eridius> jack: until you add `extern mod foo` and the hash changes!
[21:19:16] <Eridius> jack: which happened to me when I was working on rust-lua
[21:19:19] <jack> it doens't change now :)
[21:19:31] <Eridius> (I ended up not committing the extern mod bit because the functionality in extra didn't do quite what I wanted)
[21:19:59] <jack> if you can compute the crate hash, you can make the build tooling even nicer and more robust.
[21:20:04] <Eridius> jack: ok let me rephrase. Having the hash be based on something that the user knows damn well will change the hash when it's modified, and has no need to be modified unless the user wants to change the library name, is a good thing
[21:20:08] <jack> I'll hopefully have an example posted tonight/tomorrow
[21:20:14] <Eridius> but being able to compute it is nice from the perspective of generic build tools
[21:20:52] <jack> That's why i used it manually in my example today. It's easy and clean and it works.
[21:21:11] <jack> It requries you to run the compiler once though :)
[21:21:15] <acrichto> dbaupp: ok I have hopefully reconfigured the bots
[21:21:24] <acrichto> dbaupp: in theory after awhile they should be uploaded as bench.targ.z
[21:21:26] <acrichto> bench.tar.gz
[21:21:53] <acrichto> dbaupp: I'm not sure if the configuration will get picked up though, so I'll try to watch out for it
[21:22:04] * acrichto is not a buildbot ninja
[21:22:05] <jack> ChrisMorgan: why do you prefer using hte fragment? i'd write it the other way, but it also works #1.0;lua
[21:22:07] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[21:22:47] <jack> maybe i wouldn't write it the other way. i dunno. with the fragment, the ordering is less obvious :)
[21:22:56] <jack> but it does solve the problem just as well.
[21:22:59] <Eridius> jack: I prefer ;lua#1.0. Ordering is more obvious
[21:23:21] <ChrisMorgan> I don't like the use of ;params because it makes what looks like it should be a correct URL with http:// prepended not be the correct URL.
[21:23:43] <Eridius> ChrisMorgan: you can't blindly prepend http:// on the pkgid anyway, as it's not actually defined as a relative http URL
[21:24:00] <ChrisMorgan> But it looks like it.
[21:24:12] <ChrisMorgan> (In the fragment of a URL, the ordering is just exactly what you specify, so that's no problem.)
[21:24:13] <Eridius> ChrisMorgan: you could say it's actually a relatve rustpkg: URI
[21:24:27] <Eridius> rustpkg://github.com/kballard/rust-lua;lua#0.1 is perfectly valid, if we define rustpkg: to care about params
[21:24:52] <ChrisMorgan> â€¦ which I don't think is a good idea, because it's not done for HTTP.
[21:25:05] <ChrisMorgan> (If you prefer, s/done/"done"/)
[21:25:08] <Eridius> but it is done for FTP, apparently (and presumably there are other schemes out there that use params)
[21:25:08] <eddyb> ?
[21:25:32] <Eridius> ; is a perfectly legitimate sub-delim in RFC 3986
[21:25:44] <jack> ChrisMorgan: I didn't mean it was ambiguous; we'd pick an order. I just meant that it's possible to have differne topinions which should be picked. as opposed to ;lua which seems pretty straightforward. I understand your concern about ;param though.
[21:26:30] <ChrisMorgan> Eridius: it's not in wide-spread usage and it makes simple scheme replacement fail where there's no good reason why it *should* fail.
[21:26:56] * jack just checked and the fragment is not treated specially by github
[21:27:17] <Eridius> ChrisMorgan: again, back to my point that you can't just slap http:// on there and expect it to work. pkgids are not guaranteed to be URLs
[21:27:24] <Eridius> jack: fragment isn't actually sent to the server in an HTTP request. It's client-side only
[21:27:46] <jack> Eridius: github contains lots of javascript :)
[21:27:52] <ChrisMorgan> (But the client side can then decide to do something with it, which some websites will, especially those that have done #! URLs.)
[21:27:52] <Eridius> point
[21:28:58] <ChrisMorgan> Eridius: I agree that pkgids are not guaranteed to be URLs and all, but if there's no good reason to break scheme substitution for the general case, why break it? Once you're saying it's not guaranteed to be a URL, there's then no good reason for using ; in the first place, except if it be because it's not widely used!
[21:29:44] <Eridius> ChrisMorgan: ; is a nice delimiter that makes it look obviously distinct from the path. When jack suggested it he didn't know that ; was actually defined as a delimiter in RFC1808
[21:30:05] <ChrisMorgan> # makes it look obviously distinct, tooâ€”and it's familiar.
[21:30:07] <Eridius> it just happens to mesh nicely with RFC 1808 parsing, which is one reason why I like it
[21:30:21] <Eridius> ChrisMorgan: but # is already defined as the version. If you try and define it as both version and libname, then it becomes confusing
[21:30:29] <ChrisMorgan> But *not* nicely with RFC 3986 parsing.
[21:30:30] <Eridius> because now you have to impose a sub-ordering on the two that users aren't familiar with
[21:30:44] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[21:30:48] <Eridius> but everyone knows that # is the last thing in a URL, and can easily figure out that it's the last part of the URL-like string
[21:31:04] <ChrisMorgan> That last argument ("# is already defined as the version") didn't make any sense whatsoever to me.
[21:31:04] <jack> To be fair, I was suggesting it in the sense that's it's used in http headers, etc.
[21:31:05] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[21:31:11] <dbaupp> acrichto: awesome! <3
[21:31:35] <Eridius> ChrisMorgan: github.com/kballard/rust-lua#1.0;lua or github.com/kballard/rust-lua#lua;1.0?
[21:31:39] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[21:31:40] <Eridius> there's no obvious way to decide between the two
[21:32:09] <ChrisMorgan> Sure there is; the second seems to me inherently more sensible. Simply define it thus.
[21:32:25] <Eridius> why is that more sensible?
[21:32:32] <ChrisMorgan> You speak of Lua 1.0, so have #lua;1.0.
[21:32:38] <ChrisMorgan> It's getting more specific from left to right.
[21:32:42] <jack> I think I thougth the opposite because I wanted to put the optional part last. I dont' have super strong feelings.
[21:32:47] <Eridius> the first one seems just as sensible. If most paths are of the form github.com/foo/bar#1.0, then slapping ;baz on the end makes just as much sense as inserting baz; before the version
[21:32:59] <ChrisMorgan> Oh, name is optional?
[21:33:09] <Eridius> this library name? yeah
[21:33:14] <jack> well in the general case you infer it from the repo name
[21:33:16] <Eridius> the last path component will be used if it's not provided
[21:33:22] <Eridius> github.com/foo/bar#1.0 has a name "bar"
[21:33:45] <jack> It just doesn't work well with things like glfw-rs and rust-lua where the library name and hte repo its in are different
[21:33:56] <ChrisMorgan> I had missed that; now I see a little more clearly the matter there. Still, inserting "bar;" after the # is not hard.
[21:34:13] <Eridius> ChrisMorgan: it's not about technical difficulty, it's about making it obvious what you're supposed to type
[21:34:14] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[21:34:32] <Eridius> if we use #bar;1.0, I know I'm going to have to refer to the documentation or an existing library every time I make a new lib that needs this because I won't remember which way it goes
[21:34:46] <ChrisMorgan> Really?
[21:34:58] <ChrisMorgan> To me that seemed the natural way of having it.
[21:35:04] <Eridius> there's no obvious way to pick from #bar;1.0 and #1.0;bar, and I don't think I'll be writing new libraries that use this often enough to just remember
[21:35:18] <Eridius> #bar;1.0 does not seem any more natural to me than #1.0;bar
[21:35:45] <jack> We can bikeshed ? for a while instead :)
[21:35:47] <ChrisMorgan> (I could easily be wrong in that and generalising for everyone's experience from my own would not be wise, but it seemed obvious to me which way round it would be and that it would be an optional component in front.)
[21:35:55] <jack> rust-foo?foo#1.0
[21:36:19] <ChrisMorgan> jack: nah, there may already be a ? there
[21:36:20] <Eridius> jack: besides looking really weird to me, this still has ChrisMorgan's complaint of treating it as an HTTP URL would be wrong, because now you're sending an arbitrary query string to the server that might not like it
[21:36:26] <jack> thought that has similar problems to ;foo just doesn't matter as much on the urls i tried.
[21:36:30] <Eridius> and yeah, ? might actually be necessary to identify the repo
[21:36:47] <Eridius> oh hrm, requiring ? to identify the repo actually kills github.com/kballard/rust-lua;lua#1.0
[21:36:57] <Eridius> because that becomes myhost.com/repo;lua?name=lua#1.0
[21:37:03] <Eridius> and I think inserting ;lua before the ? is unacceptable
[21:37:26] <jack> wait, what?
[21:37:44] <Eridius> in RFC 1808, the order is path;params?query
[21:37:51] <Eridius> so if my repo is fetched from myhost.com/repo?name=rust-lua
[21:37:56] <jack> yes, but why would you care about such a crazy edgecase
[21:38:03] <ChrisMorgan> True, I hadn't thought of that. I guess that kills the RFC 1808 justification of that technique?
[21:38:04] <Eridius> and I want the name lua, that makes the pkgid "myhost.com/repo;lua?name=rust-lua#1.0"
[21:38:09] <Eridius> which is really nasty
[21:38:24] <jack> oh i see
[21:38:33] <jack> i really doubt this is going to come up in practice.
[21:38:37] <Eridius> what about github.com/kballard/rust-lua#lua-1.0?
[21:38:39] <ChrisMorgan> I don't in the slightest.
[21:38:45] <Eridius> I'm not a big fan of this, but at least it makes the ordering more obvious
[21:38:45] <jack> it wouldn't surprise me if rustpkg disallowed ?
[21:38:52] <Eridius> because it's the same order as in the filename liblua-<hash>-1.0
[21:38:57] <sfackler> while we're bikeshedding this, I'm not sure I'm on board with just using the github url for stuff
[21:39:05] <Eridius> jack: custom hosting of repos may easily use URLs such as this for HTTP transport
[21:39:06] <jack> dashes are often used in names and in versions
[21:39:07] <ChrisMorgan> jack: wait till we get to general usage; there will be things that want to use ?
[21:39:13] <jack> so dash as a separator there is awful
[21:39:16] <Eridius> sfackler: I thought we agreed to discuss that separately
[21:39:23] <sfackler> oh, okay
[21:39:26] <sfackler> >_>
[21:39:34] * sfackler hasn't been paying attention
[21:39:34] <Eridius> github.com/kballard/rust-lua#lua=1.0 ?
[21:39:39] <Eridius> ..naw that's bad
[21:39:41] <ChrisMorgan> sfackler: some other day. I'll probably write up something on it.
[21:39:45] <ChrisMorgan> I don't think it's bad.
[21:39:47] <sfackler> cool
[21:39:57] <Eridius> #lua:1.0?
[21:40:04] <jack> sfackler: i think everything is up for discussion, but we're trying to find a thing that works given the current choices.
[21:40:04] <ChrisMorgan> I was tossing up between `,`, `;`, `=` and `==`, myself.
[21:40:37] <ChrisMorgan> sfackler: consider this a temporary measure; how centralised package management should be done can come up in a few weeks' time.
[21:40:54] <jack> sfackler: i don't htink any of us are attached teh current choices, we've just chosen to respect those constraints for this particular issue.
[21:40:54] <Eridius> sfackler: I want to solve the problem of pkgid today, if possible, so I can get back to having a working library. Picking a different way to manage packages is a much more involved process
[21:41:10] <ChrisMorgan> jack: that's my thought exactly.
[21:41:54] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[21:41:54] <sfackler> wfm
[21:42:12] <Eridius> any thoughts on #lua:1.0?
[21:42:30] <jack> i can fine with #lua:1.0
[21:42:41] <jack> s/can/am/
[21:42:42] <ChrisMorgan> Not fond of the colon.
[21:42:52] <Eridius> ChrisMorgan: for some reason it seems better than ; to me
[21:43:05] <Eridius> and imposes a kind of ordering. "this is lua: with this version"
[21:43:06] <ChrisMorgan> (Not fond of the semicolon either, truth to tell.)
[21:43:17] *** Quits: dbaupp (Thunderbir@moz-EB2EFE6F.lns20.syd6.internode.on.net) (Ping timeout)
[21:43:20] <Eridius> #lua=1.0 seems odd to me because it implies a key-value pairing, which this is not
[21:43:34] <ChrisMorgan> Perhaps #lua==1.0 fixes that suggestion?
[21:43:57] <Eridius> that seems like I'm trying to assert that "lua" is equal to 1.0
[21:44:03] <ChrisMorgan> (Python would have it tending in the direction of `#egg=lua==1.0`.)
[21:44:21] <Eridius> that brings to mind Haskell-ish version constraints on dependencies
[21:44:29] <Eridius> which suggests I'd be able to import github.com/kballard/rust-lua#lua>=1.0
[21:44:36] <Eridius> and maybe even #lua>=1.0&lua<2.0
[21:44:40] <Eridius> which of course is not at all what this is
[21:45:31] <jack> Since ChrisMorgan suggested it with semi and colon seems fine to the rest of us, I'm putting that as the candidate to beat.
[21:46:44] <strcat> pcwalton: do you think we should separate refcounting types with weak ptr support or just offer 1 type?
[21:46:56] <pcwalton> I would separate the kind that offers weak point
[21:46:58] <pcwalton> ers
[21:47:03] <strcat> pcwalton: it changes it from { uint, value } to { uint, uint, value} + adds a branch to the dtor
[21:47:08] <pcwalton> yeah
[21:47:10] <Eridius> strcat: does having weak-ptr support impact the performance of refcounting when no weak ptrs are being used?
[21:47:14] <Eridius> ah
[21:47:34] <strcat> Eridius: https://github.com/thestinger/rust-core/blob/master/core/weak.rs
[21:47:39] <Eridius> pnkfelix: btw you can Cc yourself on a github issue using the button at the bottom of the page
[21:47:56] <strcat> anyway going to add a NonManaged kind and add it to the stdlib
[21:48:32] <strcat> for Arc there's probably more overhead
[21:48:41] <strcat> it seems like it will need a lock or something, need to figure that out
[21:48:54] <strcat> shared_ptr has to deal with that
[21:49:06] <strcat> I think that might be the rationale for using a linked list of weak ptrs
[21:49:45] <ChrisMorgan> Eridius: specifying versions to install with >= is exactly the effect I'm indicating and what that part of Python is dealing with. (Actually it'd be lua>=1.0<2.0 for specifying multiple constraints.) As you also say, that's not what we're specifying here.)
[21:50:01] <pnkfelix> Eridius: â€¦ I'm already subscribed to the repository
[21:50:03] <ChrisMorgan> jack: between semicolon and colon I have no firm opinion.
[21:50:05] <Eridius> ChrisMorgan: I'd love to see the ability to do constraints like that. But yeah, it's not what pkgid is
[21:50:23] <Eridius> pnkfelix: There's a button at the bottom of each issue page that lets you watch the issue (or mute/unwatch if you're already watching)
[21:50:23] <pnkfelix> Eridius: I type the "cc me" comment so that it goes into my 'Participating" notification box
[21:50:36] <pnkfelix> Eridius: I already get notifications for all issues
[21:50:42] <Eridius> oh you do? I see
[21:50:42] <pnkfelix> Eridius: this is to filter
[21:50:54] <Eridius> I didn't realize github treated actually commenting vs watching an issue separately
[21:51:04] <jack> pnkfelix: that's a neat trick. i might have to copy that.
[21:51:23] <jack> pnkfelix: Care to share your thoughts on the issue? Or still forming them? :)
[21:51:32] <pnkfelix> Eridius: it could be that I misunderstand the expected workflow for github, but at this point its been my best option for trying to keep up with topics I find interesting
[21:51:41] <pnkfelix> jack: I suspect I don't properly understand all the concerns yet
[21:51:47] <Eridius> pnkfelix: it makes sense. I just didn't know github had that distinction
[21:51:50] <pnkfelix> jack: more than "suspect", really
[21:52:02] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[21:53:22] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[21:56:11] <Eridius> jack: Thanks for taking the time to discuss this issue
[21:56:26] <Eridius> At the moment I'm going to guess that #lua:1.0 is going to stay, because nobody seems to be suggesting anything better
[21:56:34] <jack> Eridius: no problem
[21:56:47] <jack> i'll let it sink in for a day or so.
[21:56:49] <Eridius> jack: I assume you're going to take responsibility for making the necessary changes? I'd volunteer, as I pushed for this, but I'm not familiar with the code in question
[21:56:53] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[21:57:11] <jack> In the meantime I'll work on forbidding link metadata
[21:57:17] *** Joins: canhtak (canhtak@moz-1D882009.wl.t.ulaval.ca)
[21:57:45] <jack> the changes to pkgid are fairly trivial, so i can make those easily once we're confident the bikeshedding is concluded.
[21:57:57] <Eridius> jack: thanks
[21:58:27] <jack> acrichto: did the new snapshot for pkgid already happen, or is it just in the queue? does bors do those or are they manual after the bors patch lands?
[21:58:40] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[21:58:40] *** ChanServ sets mode: +qo brson brson
[22:00:46] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[22:05:28] <acrichto> jack: it's in the queue
[22:05:38] <acrichto> https://github.com/mozilla/rust/pull/10919
[22:09:09] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[22:09:47] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[22:09:47] *** ChanServ sets mode: +ao dherman dherman
[22:12:46] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[22:13:14] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[22:14:01] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[22:14:58] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[22:18:13] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[22:20:01] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[22:21:39] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[22:32:50] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[22:32:54] *** Quits: canhtak (canhtak@moz-1D882009.wl.t.ulaval.ca) (Quit: canhtak)
[22:33:40] *** Joins: canhtak (canhtak@moz-1D882009.wl.t.ulaval.ca)
[22:36:59] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[22:43:21] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[22:44:41] *** Quits: w3lcome (Mibbit@moz-E9ABA59E.home.otenet.gr) (Quit: http://www.mibbit.com ajax IRC Client)
[22:47:49] *** Quits: canhtak (canhtak@moz-1D882009.wl.t.ulaval.ca) (Quit: canhtak)
[22:54:43] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[22:55:45] *** Quits: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[22:57:22] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[22:57:22] *** ChanServ sets mode: +ao pcwalton pcwalton
[23:00:09] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Ping timeout)
[23:00:19] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[23:00:20] *** ChanServ sets mode: +qo brson brson
[23:00:39] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[23:00:39] *** ChanServ sets mode: +ao dherman dherman
[23:02:08] *** Joins: dbaupp (Thunderbir@4F13D67D.D5A1DCF.37681C44.IP)
[23:07:30] *** Joins: ktt3ja (ktt3ja@moz-D69B60E4.hsd1.va.comcast.net)
[23:08:42] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[23:11:20] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[23:11:20] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/tqnRgw
[23:11:20] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[23:16:19] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[23:16:20] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/FzVIHQ
[23:16:20] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[23:16:23] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[23:16:23] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/L15sFw
[23:16:23] <ghrust> 13rust/06auto 14949f01b 15Steven Fackler: Add std::io::util...
[23:16:23] <ghrust> 13rust/06auto 14c81c4fe 15Steven Fackler: Add NullReader and make ChainReader take an iterator
[23:16:23] <ghrust> 13rust/06auto 146607cb1 15bors: auto merge of #10895 : sfackler/rust/io-util, r=alexcrichton...
[23:16:25] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[23:17:07] *** flaper87 is now known as flaper87|afk
[23:24:49] <strcat> pcwalton: https://github.com/mozilla/rust/pull/10926 r?
[23:29:05] <aatch> strcat, heh, that'll conflict with pcwalton's Pod PR.
[23:29:28] * strcat will fix it
[23:31:05] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[23:31:40] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[23:31:40] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 146607cb1 to 141b12dca: 02http://git.io/N3iJvQ
[23:31:40] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[23:31:41] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[23:31:41] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/XQHiMA
[23:31:41] <ghrust> 13rust/06auto 14f9ce99f 15Alex Crichton: Don't always modify the symbol table in rlibs...
[23:31:41] <ghrust> 13rust/06auto 14dd306b0 15bors: auto merge of #10908 : alexcrichton/rust/issue-10907, r=cmr...
[23:31:41] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[23:31:49] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Max SendQ exceeded)
[23:32:30] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[23:32:43] <strcat> oh I forgot to fix the tests
[23:32:58] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Max SendQ exceeded)
[23:33:29] <strcat> there
[23:34:29] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[23:36:13] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Ping timeout)
[23:36:53] <strcat> pcwalton: you should probably post that comment again - I edited the last commit
[23:37:03] <strcat> and github didn't preserve it
[23:38:00] * strcat doesn't understand why they can preserve line comments but not commit comments
[23:46:37] <pcwalton> reposted
[23:46:47] <pcwalton> yeah, like I said it's fine by me, just want to make sure everyone is ok with it.
[23:47:06] <pcwalton> Pod will also let you write a super fast serializer/deserializer if you want
[23:47:28] <dbaupp> oh, we're getting a POD kind? awesome
[23:47:51] <aatch> dbaupp, yep
[23:48:13] <aatch> https://github.com/mozilla/rust/pull/10924
[23:57:22] <nmatsakis> pcwalton: POD PR looked good I think
[23:58:33] <pcwalton> nmatsakis: I added the new Cell there too
[23:59:08] <nmatsakis> pcwalton: oh ok let me check that out too :)
