[00:00:33] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[00:01:04] <Seldaek> brson: regarding Times, I think you're both right. It's nice for short loops but it has caveats which means we can't really advertise it to newcomers too much and hence it loses some value
[00:01:15] <Seldaek> I suppose that is not helpful :p
[00:02:01] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[00:02:01] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/zlVKlw
[00:02:01] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[00:02:15] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Connection reset by peer)
[00:02:34] *** Quits: mihneadb (mihneadb@moz-329F29A3.lightspeed.sntcca.sbcglobal.net) (Input/output error)
[00:06:36] *** Quits: heftig (heftig@moz-93D37E6F.dip0.t-ipconnect.de) (Quit: Quitting)
[00:09:29] <olsonjeffery> brson: so i missed the friday deadline i set for myself, obviously.. it's going really well. just going back and tightening stuff up. there were places, starting form the bottom up in rt::uv , where i used ~[u8] when i should've used a slice
[00:09:33] <olsonjeffery> so im going back and dealing with that
[00:10:00] <olsonjeffery> but it's looking really good. i want to have a PR tomorrow. but depends on time. definitely early this week.
[00:10:21] <olsonjeffery> also the thing with the fcntl slices, but that isn't major.
[00:10:28] <olsonjeffery> fcntl consts, i mean
[00:11:25] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[00:12:04] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[00:12:04] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/xCZ00g
[00:12:04] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[00:12:05] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[00:12:05] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/6mbWOw
[00:12:05] <ghrust> 13rust/06auto 140450cde 15Kevin Ballard: Remove obsolete error message regarding do-blocks with internal iters...
[00:12:05] <ghrust> 13rust/06auto 148fff3f4 15bors: auto merge of #8561 : kballard/rust/do-block-internal-err-msg, r=thestinger...
[00:12:06] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[00:13:00] *** flaper87 is now known as flaper87|afk
[00:16:33] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[00:16:48] *** Quits: mark_edward (quassel@21027BAA.520D6B7D.BF46A673.IP) (Ping timeout)
[00:17:20] *** Joins: tikue (tkuehn@moz-F4812C6E.hsd1.fl.comcast.net)
[00:18:28] *** Joins: mark_edward (quassel@21027BAA.520D6B7D.BF46A673.IP)
[00:22:10] *** Quits: SingingBoyo (brandon@4DF3381A.51F4D838.4F048BDC.IP) (Input/output error)
[00:22:43] <brson> olsonjeffery: sounds pretty awesome. what's implemented?
[00:24:41] <acrichto> brson: it appears that libuv no longer keeps a Makefile in tree, and the recommended build process is now 'sh autogen.sh; ./configure; make', do we already have build dependencies on autotools to support this?
[00:25:41] *** Joins: mihneadb (mihneadb@moz-BE33DA21.fw1.sfo1.mozilla.net)
[00:26:16] <olsonjeffery> brson: bindings to uv_fs_{open, unlink, write, read} and some abstractions around maintaining a file descriptor
[00:26:35] <olsonjeffery> so we could hopefully, in quick order, hook it up to STDOUT for an impl of rt::io::println or whatever
[00:27:17] <olsonjeffery> uv_fs_close, also.
[00:29:03] <olsonjeffery> FsRequest was the only thing in the stub of rt::uv::file .. i added FileDescriptor .. open & unlink at static methods on that.. and read, write & close are instance methods
[00:29:22] <olsonjeffery> also bindings for the uv plumbing around cleaning up uv_fs_t requests
[00:30:36] *** Joins: miloshadzic (miloshadzi@5E9C7FE4.FA4D0618.449B8A48.IP)
[00:30:58] *** Joins: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca)
[00:31:19] <olsonjeffery> the rest of the file stuff should come really quick, after that
[00:31:33] <olsonjeffery> someone was asking for a uv_pipe_t abstraction so they could use UDS
[00:35:03] *** Quits: bytewise (bytewise@moz-4A801D04.unitymediagroup.de) (Quit: Leaving)
[00:36:33] *** Quits: glennsl (textual@moz-5D7B804F.getinternet.no) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[00:39:11] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[00:39:49] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[00:41:30] *** Quits: lerc (quassel@B2E8CAD3.A8D14E52.788638A4.IP) (Ping timeout)
[00:42:23] <brson> acrichto: that sucks. we hate autoconf
[00:42:27] <brson> graydon will not be happy
[00:43:28] <brson> oh actually, maybe llvm is using autoconf already
[00:43:33] *** Joins: lerc (quassel@B2E8CAD3.A8D14E52.788638A4.IP)
[00:44:16] <brson> it seems like the llvm repo just contains a pre-autoconfed configure script?
[00:44:30] <Seldaek> I hate anything that needs more work than "rust run ...", I hope rust remains that simple
[00:45:17] <brson> lol 'remains'
[00:45:29] <brson> i hope we get there
[00:45:35] <acrichto> brson: actually there's this thing called gyp which just needs python
[00:45:39] <acrichto> so I'm gonna try to use that instead
[00:45:43] <acrichto> just another small git checkout
[00:45:57] <Seldaek> brson: I don't mean compiling rust itself because it depends on C stuff etc
[00:47:15] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[00:48:24] <carleastlund> Is there a way to initialize a fixed-length vector of a non-copyable type?  The [E, ..N] notation doesn't seem to work for this, unsurprisingly.  Using "for i in range(â€¦) { â€¦ }" doesn't appear to convince the compiler of initialization.
[00:50:34] <carleastlund> Of course my attempts to write a short example of what I'm talking about aren't succeeding.
[00:51:34] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Ping timeout)
[00:52:41] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[00:54:50] <carleastlund> Here we go: https://gist.github.com/carl-eastlund/6264938
[00:55:01] <tikue> carleastlund: there's std::util::noncopyable which may help you make a small test example
[00:55:19] *** Quits: dew (Instantbir@moz-D2FA52B6.static.stls.mo.charter.com) (Ping timeout)
[00:55:28] <carleastlund> tikue: thanks, just came up with the above as you were typing that, obviously :)
[00:55:32] <tikue> :P
[00:55:37] *** Joins: dew (Instantbir@moz-D2FA52B6.static.stls.mo.charter.com)
[00:55:39] <tikue> yup llol
[00:59:00] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[01:00:14] *** Joins: pdurbin (pdurbin@moz-1AC4867B.greptilian.com)
[01:01:04] *** Quits: tikue (tkuehn@moz-F4812C6E.hsd1.fl.comcast.net) (Quit: tikue)
[01:01:39] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[01:04:20] <jeaye> Getting a runtime error with @mut about borrowing; is there anything I can do to see *where/when* the last borrow was?
[01:05:54] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[01:08:29] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[01:08:29] *** ChanServ sets mode: +o dherman
[01:09:57] *** Joins: tikue (tkuehn@moz-F4812C6E.hsd1.fl.comcast.net)
[01:10:26] *** Joins: m_kato (m_kato@moz-C286AD9A.bitcat.net)
[01:11:42] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Ping timeout)
[01:14:13] <acrichto> jeaye: make sure you're not building with -Z no-debug-borrows
[01:14:31] *** Quits: jfbk (textual@moz-EEA9CFB3.nyc.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[01:14:42] <acrichto> jeaye: but a stack trace would probably also show the error
[01:15:13] <jeaye> RUST_LOG=::rt::backtrace ?
[01:16:19] <bjz> brson: I just used times :P
[01:17:11] *** Quits: Earnestly (earnest@B0BDF733.8FDE20A.5411983D.IP) (Ping timeout)
[01:17:26] <jeaye> My logs say ::rt::backtrace is done
[01:17:28] <jeaye> gone
[01:18:21] *** Quits: m_kato (m_kato@moz-C286AD9A.bitcat.net) (Quit: Leaving...)
[01:18:22] <carleastlund> Now I'm having trouble with traits and implementations.  Two errors I don't understand in this short example: https://gist.github.com/carl-eastlund/6265021  Any help appreciated.
[01:18:47] <acrichto> jeaye: gdb is the only place I've ever gotten a backtrace from
[01:19:33] *** Joins: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP)
[01:19:44] <acrichto> carleastlund: when creating a trait object, it has to have the same pointer type, and right now you need an explicit cast. The first line should be "let x = @() as @Thing<u8>"
[01:20:21] <acrichto> carleastlund: although that second error message is interesting...
[01:21:36] <jeaye> gdb gives two threads, both with a backtrace in either pthread or X11 code. None of the frames have my own code at all.
[01:21:45] <carleastlund> acrichto, thanks, the first error is gone now.  :)
[01:21:49] *** Quits: kevincantu (kevincantu@moz-244ED9FD.hsd1.ca.comcast.net) (Quit: kevincantu)
[01:22:20] <acrichto> jeaye: you'll want to break on when the program fails, I forget what the function is now, it used to be upcall_fail
[01:22:22] <carleastlund> acrichto: and changing the argument to the method to &self instead of self fixes it all
[01:22:32] <acrichto> carleastlund: yeah I'm not sure if that's a compiler bug or not
[01:22:36] <acrichto> sully: ^
[01:23:01] <acrichto> carleastlund: I don't see why it wouldn't be defined for `self`, also `@self` works just fine
[01:23:44] <sully> hm?
[01:24:16] <jeaye> Anyone know what upcall_fail became?
[01:24:57] <acrichto> sully: in https://gist.github.com/carl-eastlund/6265021, if the method is defined on `self` you can't call the method
[01:24:58] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[01:25:05] <carleastlund> sully: acrichto wanted to know if the (updated) error here is a bug: https://gist.github.com/carl-eastlund/6265021
[01:25:19] *** Quits: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP) (Quit: Leaving.)
[01:25:48] <acrichto> sully: if it changes to `&self` or `@self` it can resolve the method, but not if it's on `self`
[01:25:58] <acrichto> you'd just been working with traits recently, but this is probably more resolve things
[01:26:23] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[01:26:31] <acrichto> jeaye: try rust_begin_unwind
[01:28:38] <carleastlund> Oooh, propagating what I've just learned about traits to my larger program gets me my third internal compiler error.  Rackin' 'em up!
[01:29:29] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Quit: Leaving)
[01:29:34] <acrichto> carleastlund: be sure to report any issues you find :) also make sure you're using master b/c lots of fixes for traits have come in recently
[01:29:45] <jeaye> acrichto: Not showing up in gdb. I'm not using the new runtime, if it helps.
[01:30:05] <carleastlund> acrichto: yep, the others have been reported and I'm working on the third, and this is a very recent checkout of master
[01:30:16] <acrichto> jeaye: oh maybe upcall_fail is still around for you then
[01:30:20] *** Joins: heftig (heftig@moz-2875B7D7.dip0.t-ipconnect.de)
[01:30:25] <acrichto> carleastlund: awesome! thanks
[01:34:03] *** Joins: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com)
[01:36:55] <jeaye> Unfortunately not. :(
[01:37:10] <jeaye> It's in the source I have checked out, but gdb isn't seeing it.
[01:38:58] *** Quits: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[01:39:54] *** Quits: Voomer (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net) (Ping timeout)
[01:41:21] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[01:41:51] *** Joins: Voomer (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net)
[01:42:33] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[01:44:41] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[01:47:54] *** Joins: m_kato (m_kato@moz-C286AD9A.bitcat.net)
[01:52:15] *** Quits: miloshadzic (miloshadzi@5E9C7FE4.FA4D0618.449B8A48.IP) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[01:54:52] <carleastlund> acrichto: submitted, see https://github.com/mozilla/rust/issues/8601 if interested
[01:56:36] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[01:57:48] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[02:00:02] *** Quits: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net) (Connection reset by peer)
[02:00:17] *** Quits: dave1629 (dave@moz-17578A1A.hsd1.va.comcast.net) (Quit: dave1629)
[02:00:22] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[02:01:40] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[02:01:52] *** Joins: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com)
[02:04:44] *** Quits: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[02:05:03] *** Quits: vosen (vosen@moz-266BA656.icpnet.pl) (Connection reset by peer)
[02:07:03] *** Quits: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net) (Connection reset by peer)
[02:07:32] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[02:08:20] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[02:08:57] *** Joins: kevincantu (kevincantu@moz-244ED9FD.hsd1.ca.comcast.net)
[02:12:03] *** Quits: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net) (Connection reset by peer)
[02:12:32] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[02:16:03] *** Quits: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net) (Connection reset by peer)
[02:16:33] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[02:18:03] *** Quits: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net) (Connection reset by peer)
[02:22:06] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[02:22:06] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/6mbWOw
[02:22:06] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[02:24:19] *** Quits: tikue (tkuehn@moz-F4812C6E.hsd1.fl.comcast.net) (Quit: tikue)
[02:24:31] <sfackler> any idea how to get around this: http://sprunge.us/BAYX ? I thought those resolve bugs got fixed. Source: http://sprunge.us/MfHJ
[02:24:56] <sfackler> running on master as of ~yesterday
[02:25:56] *** Quits: kimundi (kimundi@moz-BF1F3A15.dip0.t-ipconnect.de) (Ping timeout)
[02:28:54] *** Parts: pdurbin (pdurbin@moz-1AC4867B.greptilian.com) (WeeChat 0.4.0)
[02:28:56] *** Quits: rusti (rusti@moz-61B073BC.cpe.net.cable.rogers.com) (Ping timeout)
[02:29:11] *** Joins: kimundi (kimundi@moz-2DCB16B8.dip0.t-ipconnect.de)
[02:30:38] *** Quits: mark_edward (quassel@21027BAA.520D6B7D.BF46A673.IP) (Ping timeout)
[02:31:16] *** kimundi is now known as zz_kimundi
[02:32:37] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[02:32:37] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/qkRWDg
[02:32:37] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[02:32:40] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[02:32:40] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/yEeFPA
[02:32:40] <ghrust> 13rust/06auto 1465cf75a 15Ben Blum: Fix select deschedule environment race for real this time, in light of task killing.
[02:32:40] <ghrust> 13rust/06auto 14557ff04 15bors: auto merge of #8565 : bblum/rust/select-bugfix, r=brson...
[02:32:40] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[02:37:00] <cmr> update on twir: I'll finish it as soon as I'm finished this series of doctor who
[02:37:43] <sfackler> actually, is it possible to use std::rt::io::extensions::WriterByteConversions at all?
[02:44:34] <bjz> hmm, any idea about this error: https://gist.github.com/bjz/5549eeeb3dd461d47d1f
[02:45:57] <bjz> I tried separating out 'match seen.find(&enm.ident) {', but that didn't work
[02:46:11] <sfackler> you can't modify seen while you have an inner reference
[02:46:22] <bjz> what do you mean?
[02:46:43] <sfackler> seen_opt contains a reference to something inside of seen
[02:46:43] <Eridius> bjz: `seen_opt` is borrowing `seen`. You need to get rid of `seen_opt` fist
[02:46:49] <bjz> ohh
[02:46:52] <bjz> how?
[02:47:21] <bjz> I just tried .clone(), but that didn't work
[02:47:38] <bjz> probs because it copies the lifetime
[02:48:32] <Eridius> bjz: something like this: https://gist.github.com/kballard/cd572952b29218fd7e9a
[02:49:08] <sfackler> you can also probably use HashMap::mangle
[02:49:13] <Eridius> quite possibly]
[02:49:19] <SiegeLord> Hmm... accessing private stuff from other crates gives a linker error... is this a known bug?
[02:49:42] <sfackler> yeah
[02:49:55] <aatch> bjz, try just using a standard if with if seen_opt.is_none() { ... } else { ... }
[02:50:03] <bjz> yeah I got it: https://gist.github.com/bjz/5549eeeb3dd461d47d1f#file-write_enum_fixed-rs
[02:50:10] <bjz> aatch: ok, might try that
[02:50:16] <sfackler> https://github.com/mozilla/rust/issues/8505
[02:50:24] <bjz> aatch: might be cleaner
[02:50:33] <aatch> I'm not sure if it'll work exactly like that.
[02:50:43] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[02:51:44] <bjz> aatch: did you see that issue?
[02:51:49] <aatch> bjz, I did
[02:51:54] <aatch> I also approved it.
[02:52:52] *** Quits: boredomist (user@moz-63CF9F31.res-cmts.sesp.ptd.net) (Ping timeout)
[02:53:37] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[02:53:37] *** ChanServ sets mode: +o brson
[02:54:25] <bjz> aatch: awesome!
[02:57:52] <bjz> hehe lol
[02:57:53] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[02:57:55] <bjz> generator.rs:129:51: 129:60 error: cannot borrow `seen` as mutable more than once at a time
[02:57:55] <bjz> generator.rs:129                 self.write_enum(ns.namespace, def, &mut seen);
[02:57:55] <bjz>                                                                     ^~~~~~~~~
[02:57:55] <bjz> generator.rs:129:51: 129:60 note: second borrow of `seen` as mutable occurs here
[02:57:55] <bjz> generator.rs:129                 self.write_enum(ns.namespace, def, &mut seen);
[02:57:56] <bjz>                                                                     ^~~~~~~~~
[02:58:12] <strcat> bjz: is that in a closure?
[02:58:17] <bjz> was trying: fn write_enum<'a>(&self, ns: &'a str, enm: &'a Enum, seen: &'a mut HashMap<&'a str, &'a str>) {
[02:58:46] <strcat> or a loop I guess
[02:59:24] <bjz> strcat: https://gist.github.com/bjz/4f0ae05380239b56fd57
[02:59:50] <bjz> pretty horrible code I must say
[03:00:17] <bjz> I will just copy
[03:00:37] <bjz> *clone
[03:00:38] <aatch> bjz, code-generating code is generally pretty ugly.
[03:00:53] <bjz> instead of trying to ref
[03:00:57] <bjz> aatch: heh
[03:01:35] <aatch> You should see the dataobject generation code I wrote for work. The generated code is nicer than the generating code.
[03:02:46] <bjz> I should really be using scripting lang for this
[03:03:38] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[03:04:17] *** Quits: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net) (Client exited)
[03:10:15] *** Quits: Diamond (dick@moz-C01E1CD1.ks.ks.cox.net) (Ping timeout)
[03:10:24] <jeaye> bjz: Updated https://github.com/bjz/glfw-rs/pull/24 with the new runtime.
[03:12:29] <bjz> jeaye: https://github.com/bjz/glfw-rs/pull/24/files#r5834086
[03:12:51] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[03:16:53] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[03:16:53] *** ChanServ sets mode: +o dherman
[03:18:24] <jeaye> Does from_buf_raw copy?
[03:18:31] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[03:18:57] <jeaye> I've a *Foo and I want to wrap it in a vec for a safer interface but not copy anything.
[03:19:21] <jeaye> Just point the vec there.
[03:20:32] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[03:20:34] <jeaye> ah, it does
[03:25:52] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[03:31:07] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[03:33:56] *** Joins: tikue (tkuehn@moz-F4812C6E.hsd1.fl.comcast.net)
[03:36:44] *** Quits: KindOne (KindOne@moz-CCEAAAF.dynamic.ip.windstream.net) (Ping timeout)
[03:40:39] *** Quits: mibitzi_ (mibitzi@659DAD1F.60DF3A09.8395810B.IP) (Ping timeout)
[03:40:41] *** Joins: KindOne (KindOne@moz-F45181B8.dynamic.ip.windstream.net)
[03:42:29] *** Joins: mibitzi_ (mibitzi@659DAD1F.60DF3A09.8395810B.IP)
[03:42:35] <bjz> jeaye: done?
[03:42:59] <jeaye> bjz: yeah
[03:43:33] <jeaye> Been working on getting q3 working with the latest runtime, sorry. That PR was updated though
[03:43:38] <bjz> awesome! merged
[03:43:41] <jeaye> cheers
[03:43:49] <jeaye> Where did IteratorUtils go?
[03:44:05] <bjz> jeaye: replaced with default methods I think
[03:44:13] <bjz> jeaye: no need to import it now
[03:44:18] <jeaye> badass
[03:44:25] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[03:44:29] <bjz> jeaye: I almost have the loader generator done
[03:44:53] <bjz> nmatsakis has a new patch but it breaks on ARM
[03:45:02] <bjz> hopefully soon... :(
[03:45:40] <sfackler> woah, that's weird
[03:46:13] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[03:46:29] <sfackler> std::rt::io::extensions::WriterByteConversions ends up being implemented for std::io::Writer instead of std::rt::io::Writer
[03:46:36] * sfackler shakes fist at prelude
[03:47:35] *** Quits: mihneadb (mihneadb@moz-BE33DA21.fw1.sfo1.mozilla.net) (Input/output error)
[03:48:06] <jeaye> bjz: Let me know. :D
[03:49:37] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[03:50:30] <Luqman> bjz: i think he found the arm problem
[03:51:21] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[03:51:33] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[03:52:25] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:53:05] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:53:14] <bjz> Luqman: nice!
[03:56:22] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[03:56:23] *** ChanServ sets mode: +o dherman
[03:58:47] *** Quits: kevincantu (kevincantu@moz-244ED9FD.hsd1.ca.comcast.net) (Quit: kevincantu)
[03:59:44] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[04:02:12] *** Joins: nsf (nsf@moz-EEF3238A.convex.ru)
[04:06:19] <jeaye> Awww, ICE with debug-info on the new runtime.
[04:07:04] <jeaye> Other than that (and the 21 files I had to change), it's working well. :D
[04:07:26] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[04:09:40] *** Joins: mihneadb (mihneadb@moz-329F29A3.lightspeed.sntcca.sbcglobal.net)
[04:12:54] <cmr> jeaye: yeah, mw has a PR in the queue for it
[04:12:58] * cmr bumps the priority.
[04:13:28] <cmr> hm, maybe it already landed :\
[04:13:43] <cmr> oh that was a different pR
[04:13:48] <cmr> he hasn't sent that one yet.
[04:14:47] <jeaye> mw?
[04:15:01] <cmr> michaelwoerister, the gsoc student working on debuginfo
[04:15:07] * jeaye guessed Morrowind
[04:15:11] <jeaye> ah
[04:15:35] <jeaye> I remember him.
[04:17:44] *** Quits: sawrubh (uid6719@moz-5F4AA75A.irccloud.com) (Ping timeout)
[04:17:45] *** Quits: gazoombo (uid6629@moz-E77DEB21.irccloud.com) (Ping timeout)
[04:17:49] *** Quits: ggherdov_ (uid11402@moz-E77DEB21.irccloud.com) (Ping timeout)
[04:17:51] *** Quits: wilfred (uid159@moz-5F4AA75A.irccloud.com) (Ping timeout)
[04:18:02] *** Quits: geomyidae__ (uid214@moz-E77DEB21.irccloud.com) (Ping timeout)
[04:18:18] *** Joins: recrack (Mibbit@B4104EBB.3CC170B1.1E14B209.IP)
[04:18:20] *** Quits: Aetherspawn_BNC (uid6924@moz-31ABA2C0.irccloud.com) (Ping timeout)
[04:18:21] *** Quits: sankha93 (uid12218@moz-31ABA2C0.irccloud.com) (Ping timeout)
[04:25:59] *** Quits: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net) (Ping timeout)
[04:26:05] *** Quits: rovar_ (rovar@moz-203658CB.nycmny.fios.verizon.net) (Ping timeout)
[04:26:26] *** Joins: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net)
[04:26:34] *** Joins: rovar_ (rovar@moz-203658CB.nycmny.fios.verizon.net)
[04:28:25] *** Joins: rovar__ (rovar@moz-203658CB.nycmny.fios.verizon.net)
[04:28:59] *** Quits: rovar_ (rovar@moz-203658CB.nycmny.fios.verizon.net) (Ping timeout)
[04:29:05] *** Quits: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net) (Ping timeout)
[04:29:18] *** Joins: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net)
[04:30:46] <carleastlund> Hah.  Aaaand, another assertion failed.  Counter = 4!
[04:31:55] *** Joins: Aetherspawn_BNC (uid6924@moz-31ABA2C0.irccloud.com)
[04:33:16] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Quit: Konversation terminated!)
[04:34:38] *** Joins: cdidd (cdidd@moz-E6E00BBD.broadband.corbina.ru)
[04:36:43] *** Quits: pcdummy (quassel@moz-CF4CA865.page4me.ch) (Client exited)
[04:38:03] *** Joins: pcdummy (pcdummy@moz-CF4CA865.page4me.ch)
[04:42:00] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[04:42:00] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/yEeFPA
[04:42:00] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[04:42:12] *** Joins: Ralith (ralith@114DA04D.CD83ED0A.BCDF04A6.IP)
[04:42:46] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Connection reset by peer)
[04:43:35] <Eridius> strcat: any objection to me adding Sub<> bounds onto Range (to implement size_hint)?
[04:44:17] <strcat> Eridius: that's fine
[04:44:51] <Eridius> ok. I'm going to have a PR soon that adds new size_hints to recent iterators, and fixes up at least one existing one to use checked_add on the upper bound instead of saturating_add
[04:45:14] <strcat> Eridius: might want to wait until RangeInclusive lands
[04:45:57] <Eridius> strcat: would be nice to get that too, but your PR is stale :P
[04:45:57] <cmr> https://github.com/mozilla/rust/pull/8596 !!!
[04:45:59] <cmr> Hoho!
[04:46:03] <cmr> I can't wait to feature that on TWiR
[04:46:05] <cmr> that's huge
[04:46:13] <strcat> Eridius: well, fixed now
[04:46:18] <Eridius> heh
[04:46:20] <strcat> er
[04:46:21] <strcat> I broke it
[04:46:49] *** Joins: kevincantu (kevincantu@moz-244ED9FD.hsd1.ca.comcast.net)
[04:47:45] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[04:47:45] <ghrust> 01[13rust01] 15thestinger 04force-pushed 06try from 14ca7c7ba to 14ebfe63c: 02http://git.io/k471pw
[04:47:45] <ghrust> 13rust/06try 14efabb5d 15Daniel Micay: container: inline contains_key default method
[04:47:45] <ghrust> 13rust/06try 14bb0c967 15Daniel Micay: iterator: add a `range_inclusive` function...
[04:47:46] <ghrust> 13rust/06try 144fb2e13 15Daniel Micay: rm obsolete integer to_str{,_radix} free functions
[04:47:48] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[04:48:01] <Eridius> what's try?
[04:48:21] <strcat> buildbot builds it on the try builders
[04:48:31] * strcat can't compile locally atm
[04:48:41] <strcat> a game is using all my ram ;p
[04:48:47] <Eridius> heh, what game?
[04:49:17] <strcat> europa universalis 4 + 200 firefox tabs and another build ;p
[04:49:20] <Eridius> lol
[04:49:28] <cmr> eu4 is great, I'm glad they released for linux
[04:49:41] <strcat> cmr: well ck2 is native on linux too
[04:49:49] <strcat> that was their port of the engine
[04:50:14] <strcat> just need another victoria expansion to get native linux for that too ;p
[04:52:00] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[04:52:00] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/jgE2Dw
[04:52:00] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[04:52:01] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[04:52:02] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/efTXYw
[04:52:02] <ghrust> 13rust/06auto 148b80922 15Steven Fackler: quote_*! macros take an ExtCtx...
[04:52:02] <ghrust> 13rust/06auto 14c178b52 15bors: auto merge of #8556 : sfackler/rust/quote, r=alexcrichton...
[04:52:02] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[04:53:26] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[04:55:15] *** Joins: jaen (jaen@moz-F081AD11.play-internet.pl)
[04:57:23] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[04:57:39] <Luqman> bjz: finally got my stuff working with sdl \o/ 
[04:57:48] <Eridius> strcat: oh damn, implementing size_hint on Range requires some way of converting the elements to uint (or more accurately, converting the results of subtraction to uint)
[04:57:51] <Luqman> https://gist.github.com/luqmana/6264106 http://i.imgur.com/9Kda25J.jpg
[04:58:25] *** Joins: alisdair (textual@1697D94C.7742FB18.FBC8476D.IP)
[04:59:18] <cmr> Anyone have new or updated projects they'd like featured in TWiR?
[04:59:40] <olsonjeffery> cmr: did you see that d3pcap project?
[04:59:44] <cmr> olsonjeffery: I did!
[04:59:46] <cmr> Very cool
[04:59:48] <olsonjeffery> mentions a "quarter-assed websockets server"
[04:59:50] <olsonjeffery> im intrigued
[04:59:58] <olsonjeffery> i wonder if its built atop ChrisMorgan's efforts
[05:00:09] <olsonjeffery> or if it's built from raw tcp
[05:00:15] <Eridius> rusti: (-2i).to_uint()
[05:00:19] -rusti- 18446744073709551614
[05:00:22] <cmr> I wonder where that places the websocket server I hacked together for a project once...
[05:00:32] <sfackler> cmr: https://github.com/sfackler/rust-postgres as a decently high-level wrapper around libpq
[05:00:34] <cmr> it didn't even parse HTTP, it just looked for a certain combination of headers
[05:00:39] <cmr> sfackler: Awesome, thanks!
[05:01:14] <Eridius> strcat: should I just restrict range to <T: NumCast, Sub<A, T>> (i.e. subtraction yields something that implements NumCast), or ditch size_hint? Having size_hint on range seems potentially very useful
[05:01:42] <Eridius> too bad there's no UintConvertible as that would be a better bound than NumCast
[05:02:46] <strcat> Eridius: no not num cast
[05:02:49] <strcat> it needs to work with bigints
[05:03:45] *** Joins: Jesin (Jessin_@moz-5654D37.washdc.fios.verizon.net)
[05:04:11] <Eridius> strcat: so what do you suggest?
[05:04:21] <Eridius> also, IntConvertible doesn't actually seem to be implemented anywhere..
[05:04:35] <Luqman> cmr: I have something that I finally got working: https://gist.github.com/luqmana/6264106
[05:04:54] <cmr> Luqman: can you slap a readme or comment on that bad boy?
[05:05:02] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[05:05:05] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[05:05:17] <Luqman> cmr: i can give you a screenshot http://i.imgur.com/9Kda25J.jpg
[05:05:30] <cmr> Luqman: yeah but what's it /do/?
[05:05:46] <strcat> Eridius: dunno ;p
[05:05:52] <Luqman> cmr: show your psp's display on your screen
[05:05:53] <strcat> numbers are a mess still
[05:06:16] <cmr> Ok, that is very cool
[05:06:52] <Eridius> strcat: yeah :/ the most general thing I need is a way to subtract two values, and convert the result to a uint (where the conversion represents how many One::one() values you'd have to add to the result to ge the original value back)
[05:07:06] <Eridius> or more usefully, convert it to an Option<uint>
[05:07:34] <Eridius> perhaps there should be a trait specifically for this. ToUint or somesuch
[05:07:40] <Luqman> cmr: well a third of what you need. of the other 2 parts, one you could also write in rust but the last part would be the hardest considering it runs on the device itself..
[05:11:10] <bjz> Luqman: yay!
[05:11:13] <bjz> Luqman: gw
[05:13:22] <carleastlund> Hmm, derived Clone implementations don't work the way I expect.  Is this a bug or am I just misunderstanding: https://gist.github.com/carl-eastlund/6265900
[05:13:36] <cmr> carleastlund: misunderstanding
[05:13:45] <cmr> to Clone a struct, every field also needs to be clonable.
[05:13:56] <cmr> so you need `struct Box<T: Clone>`
[05:13:58] <carleastlund> cmr: the commented-out version, which does clone the field, works fine.
[05:14:13] <carleastlund> The field has type @T, and @T is always cloneable.
[05:14:20] <cmr> oh hm, good point
[05:14:25] <cmr> I don't know why that'd be.
[05:14:33] <cmr> rustc --pretty expanded to see the dervied implementation?
[05:14:39] <carleastlund> I think the derived clone method is too eager to clone the contents of @ pointers.
[05:14:45] <Eridius> perhaps a bug in deriving? Maybe it checks for Clone on the type params inappropriately?
[05:15:22] *** Quits: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP) (Client exited)
[05:16:55] <carleastlund> cmr: expanded here -- https://gist.github.com/carl-eastlund/6265928
[05:17:21] <cmr> it's calling clone on the &@T, maybe that has something to do with it
[05:17:36] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[05:17:52] <Eridius> so the derived impl does require <T: Clone>
[05:17:53] <carleastlund> I don't know that that's the issue, I think the "rev __self_0_0" is the issue.  Presumably that's dereferencing the pointer, which it shouldn't be doing.
[05:18:01] <Eridius> carleastlund: line 28 is the problem
[05:18:12] <Eridius> it only implemented it for T: Clone
[05:18:18] <cmr> no, ref adds a layer of dereference
[05:18:31] <sfackler> uh, what the hell?
[05:18:33] <sfackler> error: failed to find an implementation of trait std::rt::io::Writer for &mut std::rt::io::Writer<no-bounds>
[05:18:35] <cmr> erm, of indirection
[05:18:35] <carleastlund> cmr: even in a pattern?
[05:18:41] <cmr> carleastlund: especially in patterns
[05:18:46] <cmr> that's the only place it's valid :p
[05:18:56] <carleastlund> Okay, I just dunno what "ref" is then.
[05:19:09] <sfackler> are &mut trait objects still broken?
[05:19:14] <cmr> ref simply adds a layer of indirection, taking the T and yielding a reference to it: &T
[05:19:15] <carleastlund> Okay, so it looks like it's just overconstraining the implementation, then.
[05:19:38] <cmr> &__self_0_0 dereferences
[05:19:53] *** Quits: Jesin (Jessin_@moz-5654D37.washdc.fios.verizon.net) (Ping timeout)
[05:20:02] <cmr> (ie, you're destructuring the contents of the borrowed pointer)
[05:20:22] <Eridius> according to the doc comment on libsyntax::ext::deriving::generic, all derived traits automatically give that trait as bounds on any type parameters
[05:20:42] <Eridius> *given
[05:20:42] <bjz> yay! the gl loader is done! https://github.com/bjz/gl-rs/blob/master/gl.rs
[05:20:50] <cmr> sfackler: no, that's actually an intended feature
[05:20:54] <bjz> well, the static mut one
[05:20:59] <cmr> sfackler: trait objects don't implement their respective traits.
[05:21:08] <bjz> just awaiting the extern fn fix
[05:21:41] <cmr> bjz: \o/
[05:21:52] <bjz> cmr: it could be improved
[05:22:12] <bjz> cmr: and I can't test it yet
[05:22:25] <carleastlund> Thanks for the info, Eridius and cmr.  Think this is fixable for the future, or is this just a case where I should always expect to have to write clone manually?
[05:22:28] <sfackler> cmr: why wouldn't they?
[05:22:33] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Ping timeout)
[05:22:37] <cmr> sfackler: because they can't be.
[05:22:44] <cmr> sfackler: imagine a method `fn foo() -> Self`
[05:22:46] <bjz> cmr: but it compiles up to the point where it expects *u8s, not extern "C" fns
[05:23:09] <cmr> sfackler: for a trait object, you don't know what Self is
[05:23:22] <sfackler> hmm, yeah
[05:23:27] <cmr> (there are other problems too, but I don't quite understand them)
[05:23:38] <Eridius> carleastlund: I'm not sure if this is fixable. deriving seems to work at the syntactic level, but what you're asking for is for it to only add constraints on the type parameters when needed. I don't know if it can determine which type params need constraining at this point
[05:23:44] <sfackler> it causes sad times with the Writer/Reader utility traits though
[05:24:06] <cmr> sfackler: yeah, just a bug in the libraries: the trait objects should implement the trait whenever possible.
[05:24:07] <sfackler> I guess they should be moved to default methods, but that makes the trait declaration pretty gross
[05:25:20] *** Joins: Jesin (Jessin_@moz-5654D37.washdc.fios.verizon.net)
[05:25:22] <carleastlund> Eridius: pretty much what I expected.  It's just so tempting to want to fix it somehow -- to tell "deriving" that "I want exactly what you give me, but without T : Clone"â€¦ but there are probably a million variations on that, and no clear way to start tacking them all on to the deriving mechanism.
[05:25:48] <cmr> rusti: let x = @5; x.clone()
[05:25:49] -rusti- @5
[05:25:57] <cmr> carleastlund: I think it's a bug
[05:26:23] <cmr> rusti: fn foo<T>(x: @T) -> @T { x.clone() } foo(@5u)
[05:26:24] -rusti- @5
[05:26:28] *** Joins: SingingBoyo (brandon@4DF3381A.51F4D838.4F048BDC.IP)
[05:26:32] <cmr> rusti: fn foo<T: Clone>(x: @T) -> @T { x.clone() } foo(@5u)
[05:26:33] -rusti- @5
[05:26:42] <aatch> managed boxes are cloneable.
[05:26:48] <Eridius> cmr: it's certainly unexpected behavior, but it's perfectly consistent with the documentation on deriving::generic
[05:26:51] <aatch> clone is a shallow copy
[05:26:57] <olsonjeffery> anyone know what a good, cross-desktop library is for notifications in x.org?
[05:27:01] <aatch> so that behaviour is expected.
[05:27:03] <cmr> olsonjeffery: libnotify
[05:27:07] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[05:27:23] <Eridius> to "fix" this, deriving would have to be able to test if all fields of the struct are cloneable, and if not, which type parameters need to be constrained to make the field cloneable, and I doubt that it has the capability to do any of that
[05:27:25] <cmr> aatch: the unexpected behavior is that a struct<T> { x: T } can't derive clone.
[05:27:33] <cmr> Eridius: it doesn't
[05:27:38] <cmr> but why isn't @T considered clonable?
[05:27:43] <cmr> @T is always clonable
[05:28:00] <cmr> rusti: struct Foo; fn foo<T: Clone>(x: @T) -> @T { x.clone() } foo(@Foo)
[05:28:01] -rusti- <anon>:5:65: 5:68 error: failed to find an implementation of trait std::clone::Clone for main::Foo
[05:28:01] -rusti- <anon>:5          struct Foo; fn foo<T: Clone>(x: @T) -> @T { x.clone() } foo(@Foo)
[05:28:01] -rusti-                                                                           ^~~
[05:28:01] -rusti- application terminated with error code 101
[05:28:12] <cmr> ^ minimal testcase, I think
[05:28:26] <aatch> cmr, nope.
[05:28:30] *** Joins: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com)
[05:28:30] <cmr> rusti: struct Foo; let x = @Foo; x.clone()
[05:28:31] -rusti- @{}
[05:28:38] <aatch> you are bounding T on clone.
[05:28:57] <aatch> just because you are then asking for @T is irrelevant
[05:29:03] <cmr> ah yes that makes sense
[05:29:21] <olsonjeffery> cmr: i think im gonna write a rust wrapper that runs make check-stage1-std and notifies when the build is done. the pomodoro isn't doing it.
[05:29:35] <olsonjeffery> could probably do it w/ a bash script
[05:29:45] <olsonjeffery> there's a cli client
[05:30:37] <aatch> I do agree that the deriving for that isn't brilliant though...
[05:31:06] <carleastlund> Eridius: actually, now I think of it, it should be possible to fix this.  Rather than making everything constrained with : Clone, it should be possible to only constrain type parameters that occur outside @ and other cloneable type constructors.  Anything that doesn't occur, or only occurs under things like @, doesn't need to be constrained.  At least for Clone.
[05:31:38] <carleastlund> Whether this is particularly desirable or a high priority is another matter, but from my end of things that's someone else's problem.  :)
[05:31:46] *** Quits: nsf (nsf@moz-EEF3238A.convex.ru) (Quit: WeeChat 0.4.1)
[05:31:53] <aatch> carleastlund, That is pretty much the fix I was thinking of.
[05:32:21] <carleastlund> Probably any "deriving" mechanism that's smart enough to write code, can be smart enough to figure out what constraints it really needs.
[05:32:38] <aatch> I'm not sure if there are any other major cases, and @T can be detected at a syntax level
[05:32:43] <sfackler> cmr: it'd be nice if we had derivings for the trivial trait object implementations of their traits
[05:32:59] *** Quits: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net) (Ping timeout)
[05:33:01] <cmr> sfackler: there's an issue open for it
[05:33:03] * cmr looks
[05:33:05] *** Quits: rovar__ (rovar@moz-203658CB.nycmny.fios.verizon.net) (Ping timeout)
[05:33:15] <sfackler> oh, cool
[05:33:20] *** Joins: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net)
[05:33:22] <cmr> https://github.com/mozilla/rust/issues/8353
[05:33:24] <carleastlund> What would be really neat is if there were a way to implement new "deriving" traits as macros.
[05:33:26] *** Joins: rovar_ (rovar@moz-203658CB.nycmny.fios.verizon.net)
[05:33:51] <aatch> carleastlund, that's not strictly true. Since deriving is a syntax-level thing. It's only supposed to be used to reduce boilerplate
[05:33:55] <cmr> carleastlund: well they basically are macros.
[05:34:01] <cmr> procedural macros, that is
[05:34:05] <Eridius> strcat: I updated the PR to pass `make tidy`
[05:34:13] <carleastlund> cmr: Right, but users can't write them, currently.
[05:34:15] <cmr> just hung off an attribute rather than an explicit invocation.
[05:34:21] <cmr> right
[05:34:43] <aatch> there will always be cases where deriving doesn't have enough information to generate the code you want.
[05:34:50] <carleastlund> Certainly.
[05:37:43] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[05:38:27] <carleastlund> Is this an appropriate thing to write up as an "issue" so I get notified if anyone moves on it, or should I reserve that system for bugs?
[05:39:02] *** Joins: steven_is_false (user@C5B76363.1FF1EBF8.1ECA502.IP)
[05:39:39] <Eridius> carleastlund: I don't think this can be fixed syntactically
[05:39:42] *** Quits: kevincantu (kevincantu@moz-244ED9FD.hsd1.ca.comcast.net) (Quit: kevincantu)
[05:39:51] <steven_is_false> Hi. So what do you guys think about Bloom (at http://www.bloom-lang.net/ ?)
[05:40:00] <Eridius> just think, what happens when (if) @T is replaced with Gc<T>? How would deriving know then that Gc<T> doesn't require T: Clone in order to implement Clone?
[05:40:03] *** Quits: vk (chatzilla@moz-389FEE13.hsd1.ca.comcast.net) (Ping timeout)
[05:40:22] *** Joins: kevincantu (kevincantu@moz-244ED9FD.hsd1.ca.comcast.net)
[05:40:40] <carleastlund> Eridius: a syntactic fix doesn't have to be comprehensive.  I'd be happy if it just dropped Clone if @ was literally present in the type definition.
[05:41:05] <bjz> steven_is_false: never heard of it. looks interesting though
[05:41:14] <Eridius> carleastlund: you're asking for a simplistic rule that will make it more unpredictable how it behaves, that doesn't guarantee correctness, and that cannot possibly be enforced once expected changes happen to the language
[05:41:26] <steven_is_false> bjz: It really confuses me.
[05:41:35] <steven_is_false> That's a good thing.
[05:43:10] *** Joins: mark_edward (quassel@21027BAA.520D6B7D.BF46A673.IP)
[05:43:38] <carleastlund> Eridius: I think it does guarantee correctness, cloning @ is already implemented safely; I don't know what you mean by "possibly be enforced", I haven't proposed anything to "enforce"; and you're probably right about unpredictability.  I'm unsurprised that a 5 minute, top-of-the-head solution isn't a killer bullet.
[05:43:44] <cmr> steven_is_false: its research looks very interesting
[05:44:10] <Eridius> carleastlund: you said if @ was present in the type definition. struct Foo<T> { a: @T, b: T } meets that rule and yet requires Clone on T
[05:44:11] <aatch> Eridius, I think what we want is a rule that that says that we don't bound params that are only used as type params in the definition.
[05:44:32] <steven_is_false> cmr: Unfortunately, I'm really terrible at reading research papers.
[05:44:34] <Eridius> aatch: in what way is T only used as a type param in @T?
[05:44:37] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[05:44:59] <aatch> Eridius, well it's pretty easy to think of the point types as Pointer<T>
[05:45:03] <Eridius> the correct solution is to only bound those type params that require bounds in order to make all field types implement Clone. But that cannot possibly be done at the syntactic level
[05:45:05] <aatch> pointer types*
[05:45:17] <carleastlund> Eridius: I said "present" in terms of detection of things like Gc<T>.  I did not mean to back off from my initial process of checking everything outside of @T.  Of course if T is both outside and inside @, it still needs to be Cloneable.
[05:45:18] <mark_edward> sully: hello
[05:45:20] <Eridius> aatch: Foo<T> may or may not require T: Clone in order to implement Clone itself
[05:45:23] <steven_is_false> Eridius: We could push the problem to the user.
[05:45:29] <carleastlund> So I meant to be more conservative, not less.
[05:45:34] <Eridius> steven_is_false: we already have. They can implement it by hand if they want it
[05:45:40] <steven_is_false> Eridius: That's true.
[05:45:54] <aatch> Eridius, hmm, good point. Didn't think of that.
[05:47:19] <carleastlund> Eridius: the correct solution is to implement clone correctly and precisely.  But that can't be done at the syntactic level.  What can be done at the syntactic level?  A conservative approximation.  Which is what you already have.  What's being proposed here is simply different approximations.
[05:47:52] <Eridius> carleastlund: what we already have is an extremely simple rule that is applied to every derived trait. The proposal is a more complicated rule that's still too simple to actually be correct, and will only apply to Clone
[05:47:56] <aatch> carleastlund, the problem is that there are planned changes that make your approximation obsolete.
[05:48:04] *** Parts: steven_is_false (user@C5B76363.1FF1EBF8.1ECA502.IP) (ERC Version 5.3 (IRC client for Emacs))
[05:48:05] <Eridius> basically, it just makes deriving more unpredictable, while only "fixing" an extremely limited case
[05:48:13] <Eridius> and the planned changes will break even that limited fix
[05:48:49] <carleastlund> More unpredictable: granted, fine.  Too simple to be correct: I still think my (initial) proposal was plenty correct.  Planned changes: obviously I know nothing about them.
[05:49:52] <cmr> http://cmr.github.io/blog/2013/08/19/this-week-in-rust/
[05:49:54] <carleastlund> Anyway, thanks for the discussion, but I think we're all in agreement now that this isn't going to be fixed.  I'm happy to implement my own Clone.  :)
[05:50:14] <Eridius> carleastlund: I apologize if I came off too dismissive btw. Discussion is always a good thing
[05:50:42] <Eridius> cmr: "QUadtrees"
[05:50:47] <carleastlund> No, no, it's just hard to discuss something this complex over IRC.  Both sides come out as brief declarative lists of issues with the other side's proposals.
[05:51:27] *** Quits: jaen (jaen@moz-F081AD11.play-internet.pl) (Ping timeout)
[05:51:31] <carleastlund> So which part of the laundry list I'm looking at is going to invalidate what we were talking about?
[05:51:44] <cmr> carleastlund: removing @T from the language
[05:51:51] <Eridius> cmr: also, the number of PRs might be low because bors broke for a little while (queue got large enough that it hit API rate limits)
[05:52:07] <cmr> and make smart pointers expressable
[05:52:30] <cmr> (making the same semantics that @T already has available for all library types)
[05:52:37] <cmr> (pointerwise)
[05:52:42] <carleastlund> cmr: er, where is that on the page?
[05:52:43] <cmr> Eridius: thanks, fixed (the typo)
[05:52:48] <cmr> carleastlund: which pag?
[05:52:54] <Eridius> cmr: "ifmt! [...[ has been finished" <- it has? the linked PR says "Finish portions of `fmt!`"
[05:53:01] <carleastlund> the one you linked
[05:53:10] <Eridius> s/[...[/[...]/
[05:53:36] <Eridius> note: ifmt may very well be done. I haven't been paying a lot of attention. But my impression was there was still work to be done on it
[05:54:43] *** Quits: kevincantu (kevincantu@moz-244ED9FD.hsd1.ca.comcast.net) (Quit: kevincantu)
[05:55:16] <Eridius> cmr: got another breaking change for ya: yield has been reserved as a keyword, task::yield() was renamed to task::deschedule()
[05:55:25] *** Joins: kevincantu (kevincantu@moz-244ED9FD.hsd1.ca.comcast.net)
[05:55:30] <Eridius> cmr: https://github.com/mozilla/rust/pull/8560
[05:56:15] <Eridius> cmr: also, `.to_c_str()` now raises a condition if the string has an interior null byte (#8532)
[05:57:04] <Eridius> carleastlund: this week in rust isn't proposed changes, it's an overview of what was changed in the last week. cmr linked it because he just published it
[05:57:13] <cmr> Eridius: https://github.com/mozilla/rust/pull/8560 landed today
[05:57:16] <carleastlund> Aha :)
[05:57:18] <cmr> it will be included in next week's twir
[05:57:23] <Eridius> cmr: oh, when do you make the cutoff?
[05:57:27] <cmr> saturday
[05:57:46] <cmr> ...usually saturday morning
[05:57:53] <Eridius> ah. well, .to_c_str() change might be worth documenting
[05:57:55] <cmr> but it was saturday evening this week
[05:57:59] <cmr> Yes, it is, thank you.
[05:58:05] <Eridius> naturally, I'm only pushing for this because I have nothing else in this edition of TWiR ;)
[05:58:11] <cmr> That's ok :)
[05:58:32] <carleastlund> I'm curious about this "removing @" ideaâ€¦ is it written up anywhere I can look at, or do I just need to wait until it gets implemented and pushed?
[05:58:45] <cmr> carleastlund: http://pcwalton.github.io/blog/2013/06/02/removing-garbage-collection-from-the-rust-language/
[05:59:20] <carleastlund> cmr, thanks!
[06:01:04] <cmr> Eridius: cstr change pushed
[06:01:11] <cmr> And only one typo this week, I'm getting good!
[06:02:35] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[06:04:26] <Eridius> cmr: "Qadtrees" :)
[06:04:30] <cmr> ...bah
[06:04:33] <cmr> too late
[06:04:41] <cmr> (as in it's too late for me to be conscious)
[06:06:16] <Eridius> I'm also not seeing c_str. Caching issue?
[06:06:25] <cmr> likely
[06:06:31] <cmr> github pages isn't always the fastest to update
[06:06:40] * Eridius has never tried using github pages
[06:06:42] <strcat> it's s3
[06:06:45] <Eridius> ah
[06:06:48] *** Quits: Jesin (Jessin_@moz-5654D37.washdc.fios.verizon.net) (Quit: Leaving)
[06:06:52] <strcat> it's really terribly slow to update the caches
[06:07:00] <cmr> strcat: gh pages is?
[06:07:11] <cmr> (on s3, I mean)
[06:07:24] *** Quits: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[06:07:42] <strcat> cmr: well, s3 is slow to update them so I guess if gh pages always uses it - it is too
[06:07:44] <strcat> ;]
[06:08:50] <strcat> I think you have to version the files properly
[06:09:02] <strcat> or it will cache them for 24h
[06:09:17] <strcat> as in every update has to bump it
[06:11:08] <Eridius> oh phew, the assertion on running compiletest isn't my fault. It happens on master too
[06:11:12] <Eridius> (for certain values of "oh phew")
[06:12:08] <cmr> If anyone's curious, I get about 750 unique pageviews in the 3 days after a TWiR is published, so that's a rough estimate of the size of the community closely following Rust
[06:12:32] *** Joins: fabiand (fabiand@moz-A13A8369.adsl.alicedsl.de)
[06:13:40] <Eridius> I'm going out on a limb and guessing that brson/rust/test-waitpid-workaround has reintroduced the fd limit issue on OS X, this time outside of the scheduler tests (where we have the fix)
[06:14:03] <Eridius> yep. bumping fd limit fixes it
[06:14:25] <strcat> because it makes more threads
[06:16:14] <Eridius> yep
[06:16:20] * Eridius files #8608 about it
[06:17:08] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[06:17:30] *** Joins: wilfred (uid159@moz-5F4AA75A.irccloud.com)
[06:17:30] *** Joins: gazoombo (uid6629@moz-E77DEB21.irccloud.com)
[06:17:47] *** Joins: ggherdov_ (uid11402@moz-E77DEB21.irccloud.com)
[06:18:01] *** Quits: quasisphere (btw@DC685DC2.94302614.1D0D91FF.IP) (Ping timeout)
[06:18:31] *** Quits: tedh (tedh@moz-D8911C58.public.wayport.net) (Ping timeout)
[06:18:47] <Eridius> yay TWiR updated its cache
[06:21:07] *** Joins: sankha93 (uid12218@moz-31ABA2C0.irccloud.com)
[06:21:54] *** Joins: geomyidae__ (uid214@moz-E77DEB21.irccloud.com)
[06:34:26] *** Joins: z0w0 (zack@moz-7E6DC3A.lnse2.woo.bigpond.net.au)
[06:36:28] <bjz> cmr: updated the usage information: https://github.com/bjz/gl-rs#usage
[06:36:29] <bjz> :)
[06:37:53] <strcat> http://www.boost.org/doc/libs/1_54_0/libs/iterator/doc/counting_iterator.html this is really amusing
[06:38:30] <bjz> why?
[06:38:55] <strcat> all it does is take a type and wrap it with an operator* implementation returning itself
[06:39:05] <bjz> :P
[06:39:32] <strcat> so it takes 'int' and spits out something that's the same, but has *i returning i
[06:39:36] <strcat> and then... it's an iterator
[06:39:44] <strcat> because of C++'s silly iteration protocol ;p
[06:40:10] *** Joins: sawrubh (uid6719@moz-5F4AA75A.irccloud.com)
[06:41:26] <jeaye> bjz: I don't like the idea of wrapping every GL call in 'unsafe' :(
[06:41:35] * jeaye makes a lot of GL calls
[06:41:39] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Client exited)
[06:41:45] <bjz> jeaye: :(
[06:42:00] <jeaye> This is what I liked about rust-opengles; it provides a safe interface
[06:42:01] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[06:42:27] <bjz> jeaye: the issue is it relies on mutable state
[06:43:11] <bjz> jeaye: I could have safe wrapper functions that call the static muts though :/
[06:43:26] *** Joins: sebcrozet (sebcrozet@moz-C27D92D8.w193-252.abo.wanadoo.fr)
[06:43:47] <bjz> I guess if it fails by default then that is safe?
[06:43:47] <jeaye> Can't you just put the 'unsafe' in the function and not have it be outside the function?
[06:43:57] <bjz> jeaye: they are atatic muts
[06:44:03] <bjz> *static muts
[06:44:13] <tikue> hey can someone give me an example of the new formatter?
[06:44:20] <strcat> jeaye: maybe it wasn't actually safe and was just written wrong though ;p
[06:44:33] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[06:44:34] <bjz> rusti: static mut X: uint = 1; 1
[06:44:35] -rusti- 1
[06:44:41] <tikue> rusti: println(ifmt!("{} potato {} potato", "one", 2));
[06:44:42] -rusti- "one" potato 2 potato
[06:44:42] -rusti- ()
[06:44:42] <bjz> wat
[06:44:52] <heftig> how good of a gl wrapper is cogl?
[06:44:53] <jeaye> strcat: Could very well be. :P
[06:45:15] <myname> looks a bot like pythons formatter
[06:45:20] <myname> bit
[06:45:23] <tikue> hm 
[06:45:24] <bjz> rusti: static mut X: uint = 1; fn f() -> uint { 1 } f()
[06:45:25] -rusti- 1
[06:45:29] <tikue> i don't like that "one" is in quotes
[06:45:29] <bjz> ??
[06:45:31] <tikue> is that purposeful
[06:45:44] <jeaye> rusti: static mut X: uint = 1; fn f() -> uint { 1 } f()
[06:45:45] -rusti- 1
[06:45:45] <bjz> I thought that would blab an error
[06:45:49] <jeaye> rusti: static mut X: uint = 1; fn f() -> uint { X } f()
[06:45:50] -rusti- <anon>:5:50: 5:51 error: use of mutable static requires unsafe function or block
[06:45:50] -rusti- <anon>:5          static mut X: uint = 1; fn f() -> uint { X } f()
[06:45:50] -rusti-                                                            ^
[06:45:50] -rusti- error: aborting due to previous error
[06:45:50] -rusti- application terminated with error code 101
[06:45:55] <tikue> rusti: println(ifmt!("{:s} potato {} potato", "one", 2));
[06:45:55] -rusti- one potato 2 potato
[06:45:56] -rusti- ()
[06:45:58] <tikue> ah
[06:46:02] <jeaye> bjz: You weren't using X
[06:46:04] <tikue> a bit annoying
[06:46:05] <bjz> ojh
[06:46:06] <bjz> haha
[06:46:07] <bjz> fff
[06:46:28] <jeaye> rusti: static mut X: uint = 1; fn f() -> uint { unsafe { X } } f()
[06:46:29] -rusti- 1
[06:46:29] <tikue> still, very nice, love it overall
[06:46:32] <jeaye> bjz: See ^
[06:46:34] <bjz> jeaye: yeah, I'm guessing folks could write safe wrappers on top of gl-rs
[06:46:35] <jeaye> Just put it inside
[06:46:45] <tikue> is ifmt! going to become fmt! eventually
[06:46:48] <bjz> jeaye: yep
[06:46:49] *** Quits: mark_edward (quassel@21027BAA.520D6B7D.BF46A673.IP) (Ping timeout)
[06:46:53] <tikue> and be used in printfln and the like?
[06:46:59] <bjz> rusti: static mut X: uint = 1; X
[06:47:00] -rusti- <anon>:5:33: 5:34 error: use of mutable static requires unsafe function or block
[06:47:00] -rusti- <anon>:5          static mut X: uint = 1; X
[06:47:00] -rusti-                                           ^
[06:47:00] -rusti- error: aborting due to previous error
[06:47:01] -rusti- application terminated with error code 101
[06:47:09] <jeaye> bjz: I think gl-rs should do that by default.
[06:47:38] <tikue> rusti: printfln("{} potato {} potatoes", "one", 2);
[06:47:38] -rusti- <anon>:5:9: 5:17 error: unresolved name `printfln`.
[06:47:38] -rusti- <anon>:5          printfln("{} potato {} potatoes", "one", 2);
[06:47:38] -rusti-                   ^~~~~~~~
[06:47:39] -rusti- error: aborting due to previous error
[06:47:39] -rusti- application terminated with error code 101
[06:47:44] <tikue> rusti: printfln!("{} potato {} potatoes", "one", 2);
[06:47:45] -rusti- <std-macros>:229:20: 229:36 error: too many arguments to fmt!. found 3, expected 1
[06:47:45] -rusti- <std-macros>:229             println(fmt!($($arg),+))
[06:47:45] -rusti-                                      ^~~~~~~~~~~~~~~~
[06:47:46] -rusti- application terminated with error code 101
[06:47:48] <jeaye> There's no need to say unsafe { gl::Viewport(0, 0, 600, 480) }; it's silly.
[06:48:03] <bjz> jeaye: yep, agreed
[06:48:18] <jeaye> mmk
[06:48:26] <jeaye> Otherwise, looking forward to it.
[06:48:28] *** Joins: nawfel (Mibbit@B57B4DED.327E5EAB.DFAB1F33.IP)
[06:48:44] <bjz> jeaye: and it wont segfault if it's not loaded, because it's auto assigned a fail! if it isn't
[06:48:45] <jeaye> Should be a tedious project, porting q3. :P
[06:48:52] <jeaye> bjz: right
[06:48:57] <jeaye> So it is safe.
[06:49:00] <bjz> mm
[06:49:27] <tikue> rusti: "{}".format("test")
[06:49:28] -rusti- <anon>:5:9: 6:5 error: type `&'static str` does not implement any method in scope named `format`
[06:49:28] -rusti- <anon>:5          "{}".format("test")
[06:49:28] -rusti- <anon>:6     };
[06:49:28] -rusti- error: aborting due to previous error
[06:49:28] -rusti- application terminated with error code 101
[06:49:29] <bjz> jeaye: what about ones with pointers in them though?
[06:49:38] <tikue> rusti: "{}".fmt("test")
[06:49:38] -rusti- <anon>:5:9: 6:5 error: type `&'static str` does not implement any method in scope named `fmt`
[06:49:38] -rusti- <anon>:5          "{}".fmt("test")
[06:49:38] -rusti- <anon>:6     };
[06:49:39] -rusti- error: aborting due to previous error
[06:49:39] -rusti- application terminated with error code 101
[06:49:58] <tikue> rusti: ifmt!("{}", "test")
[06:49:59] -rusti- ~"\"test\""
[06:50:01] <jeaye> bjz: Same thing. In the actual 'unsafe' code, I'm not dereferencing them, so I shouldn't have to write it.
[06:50:20] <jeaye> bjz: In fact, you shouldn't have to derference anything. Just pass the pointers on to GL
[06:50:40] <strcat> still unsafe
[06:50:46] *** Joins: quasisphere (btw@DC685DC2.94302614.1D0D91FF.IP)
[06:50:48] <tikue> rusti: ifmt!("{one} potato {two} potato", one="one", two=2)
[06:50:49] -rusti- ~"\"one\" potato 2 potato"
[06:50:55] <strcat> you can create arbitrary pointers in safe code, and pointers can become dangling
[06:51:08] <tikue> rusti: ifmt!("{one:s} potato {two} potato", one="one", two=2)
[06:51:08] <strcat> 99% of FFI functions taking a pointer argument need to be unsafe
[06:51:09] -rusti- ~"one potato 2 potato"
[06:51:30] <strcat> unless you can tidying wrap things up with the state in a struct with a destructor and manage to use borrows
[06:51:36] <strcat> tidily*
[06:51:37] <jeaye> tikue: Wow, that's robust.
[06:51:52] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[06:51:55] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Client exited)
[06:52:06] <tikue> jeaye: yeah cool stuff. good work alexcrichton
[06:52:51] <bjz> strcat: but returning a pointer is ok, because you're not doing anything with it
[06:53:04] <jeaye> strcat: Are you saying that we should be writing `unsafe { gl::Viewport(0, 0, w, h) }` instead of just `gl::Viewport(0, 0, w, h)`?
[06:53:09] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[06:53:12] <bjz> jeaye: no
[06:53:41] <tikue> rusti: ifmt!("{one:s} potato {1} potato", one="one", 2)
[06:53:41] <bjz> jeaye: I'm thinking in the loader I will detect if the function takes a pointer
[06:53:42] -rusti- <anon>:5:55: 5:56 error: expected ident, positional arguments cannot follow named arguments
[06:53:42] -rusti- <anon>:5          ifmt!("{one:s} potato {1} potato", one="one", 2)
[06:53:42] -rusti-                                                                 ^
[06:53:42] -rusti- error: aborting due to previous error
[06:53:42] -rusti- application terminated with error code 101
[06:53:56] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[06:53:58] <strcat> jeaye: just saying that passing along raw pointers to other functions isn't safe
[06:54:02] <tikue> rusti: ifmt!("{0:s} potato {two} potato", "one", two=2)
[06:54:02] -rusti- ~"one potato 2 potato"
[06:54:04] <strcat> receiving one is safe
[06:54:48] <tikue> i think it'd be nice if rust supported named arguments to functions similar to how the new ifmt does it
[06:55:15] <jeaye> Similar to how struct initialization is, too.
[06:55:46] <tikue> yes
[06:56:08] <tikue> conversely it'd be nice if you could leave that off with structs if you wanted, a la pattern matching
[06:56:37] <tikue> rusti: struct Foo { a: uint, b: uint } let foo = Foo { a: 0, b: 1}; let Foo { a, b } = foo; (a, b)
[06:56:38] -rusti- (0, 1)
[06:57:00] <tikue> rusti: struct Foo { a: uint, b: uint} let foo = Foo { 0, 1 }; foo
[06:57:00] -rusti- <anon>:5:54: 5:55 error: expected `;` but found `{`
[06:57:00] -rusti- <anon>:5          struct Foo { a: uint, b: uint} let foo = Foo { 0, 1 }; foo
[06:57:00] -rusti-                                                                ^
[06:57:01] -rusti- application terminated with error code 101
[06:57:09] <nawfel> hello, rustc goes in infinite loop when compiling this http://miburl.com/SHE25y 
[06:57:21] <jeaye> bjz: I look forward to it, mate. Thanks for the hard work.
[06:57:24] *** Quits: jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net) (Quit: zzz)
[06:57:29] <tikue> nawfel: that link doesn't work for me
[06:57:35] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[06:58:07] <nawfel> https://docs.google.com/file/d/0B9nStCiu3GXxMkxMSm1YSWFraHM/edit?usp=sharing
[06:58:09] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Connection reset by peer)
[06:58:53] <nawfel> here is what i was doing https://docs.google.com/file/d/0B9nStCiu3GXxdzhsMEgtdE54NW8/edit?usp=sharing
[06:59:49] <tikue> rusti: struct Foo { a: uint, b: uint } let foo = Foo { a: 0, b: 1}; ifmt!("{foo.a}", foo=foo)
[06:59:49] -rusti- <anon>:5:76: 5:85 error: unterminated format string
[06:59:50] -rusti- <anon>:5          struct Foo { a: uint, b: uint } let foo = Foo { a: 0, b: 1}; ifmt!("{foo.a}", foo=foo)
[06:59:50] -rusti-                                                                                      ^~~~~~~~~
[06:59:50] -rusti- error: aborting due to previous error
[06:59:50] -rusti- application terminated with error code 101
[07:00:08] <tikue> rusti: struct Foo { a: uint, b: uint } let foo = Foo { a: 0, b: 1}; ifmt!("{foo}", foo=foo)
[07:00:09] -rusti- ~"{a: 0, b: 1}"
[07:00:10] <nawfel> http://blogs.msdn.com/b/ericlippert/archive/2008/02/12/immutability-in-c-part-eleven-a-working-double-ended-queue.aspx
[07:00:15] <tikue> rusti: struct Foo { a: uint, b: uint } let foo = Foo { a: 0, b: 1}; ifmt!("{foo.a}", foo=foo)
[07:00:16] -rusti- <anon>:5:76: 5:85 error: unterminated format string
[07:00:16] -rusti- <anon>:5          struct Foo { a: uint, b: uint } let foo = Foo { a: 0, b: 1}; ifmt!("{foo.a}", foo=foo)
[07:00:16] -rusti-                                                                                      ^~~~~~~~~
[07:00:16] -rusti- error: aborting due to previous error
[07:00:17] -rusti- application terminated with error code 101
[07:00:25] <tikue> it'd be nice if you could do that ^ :P
[07:00:36] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[07:00:57] <nawfel> the problem is Rust does not support polymorphic recursion http://en.wikipedia.org/wiki/Polymorphic_recursion
[07:01:57] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[07:02:41] <nawfel> rustc must give an error instead of looping forever
[07:07:10] *** Joins: glennsl (textual@moz-5D7B804F.getinternet.no)
[07:07:13] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[07:08:52] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[07:09:52] *** flaper87|afk is now known as flaper87
[07:13:46] *** Quits: kevincantu (kevincantu@moz-244ED9FD.hsd1.ca.comcast.net) (Ping timeout)
[07:19:55] *** Joins: Ms2ger (Ms2ger@59A8FC80.80FA5708.187A1082.IP)
[07:22:07] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[07:22:07] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/efTXYw
[07:22:07] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[07:25:57] *** Quits: ross (ross@moz-8A84103E.br.br.cox.net) (Quit: )
[07:31:30] *** Joins: jaen (jaen@moz-38103FCB.neoplus.adsl.tpnet.pl)
[07:32:05] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[07:32:05] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Y08tCQ
[07:32:05] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[07:32:06] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[07:32:06] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/aQ1gIg
[07:32:06] <ghrust> 13rust/06auto 14066ca17 15toddaaro: an attempt at a singleton pausible idle callback for each scheduler. suffers from nondeterministic deadlock and also pending scheduler messages on scheduler shutdown.
[07:32:06] <ghrust> 13rust/06auto 14bd382ee 15Brian Anderson: std::rt: Touch up idle logic
[07:32:08] <ghrust> 13rust/06auto 1488d8baa 15Brian Anderson: std::rt: Fix a race in UvRemoteCallback's dtor that misses callbacks...
[07:32:10] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[07:32:15] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[07:32:43] *** Quits: mihneadb (mihneadb@moz-329F29A3.lightspeed.sntcca.sbcglobal.net) (Input/output error)
[07:33:53] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[07:38:37] *** Joins: lmandel (lmandel@moz-9CE00FC0.holiday-inn-express.mozilla.hq)
[07:39:53] <nawfel> https://github.com/mozilla/rust/issues/8613
[07:40:00] <nawfel> hello ?
[07:41:19] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[07:41:50] *** Quits: cdidd (cdidd@moz-E6E00BBD.broadband.corbina.ru) (Input/output error)
[07:44:02] *** Joins: cdidd (cdidd@moz-7D7D898D.broadband.corbina.ru)
[07:44:58] *** Quits: nawfel (Mibbit@B57B4DED.327E5EAB.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[07:46:27] *** Joins: fyolnish (fyolnish@moz-BE2BAE5B.miinet.jp)
[07:49:18] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Client exited)
[07:49:47] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[07:50:34] <flaper87> bblum: you around?
[07:51:27] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[07:59:44] *** Quits: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP) (Connection reset by peer)
[08:00:39] *** Quits: thesnowdog (doug@9842E8BA.8E46834.6F17036B.IP) (Connection reset by peer)
[08:00:54] *** Joins: thesnowdog (doug@9842E8BA.8E46834.6F17036B.IP)
[08:02:04] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[08:02:04] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14da04c0a to 14c178b52: 02http://git.io/N3iJvQ
[08:02:04] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[08:02:06] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[08:02:06] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/0OxmHA
[08:02:06] <ghrust> 13rust/06auto 140dceabd 15Daniel Micay: Revert "Turn off jemalloc"...
[08:02:06] <ghrust> 13rust/06auto 14c934f75 15bors: auto merge of #8584 : thestinger/rust/jemalloc, r=brson...
[08:02:07] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[08:03:19] *** Joins: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP)
[08:06:37] *** Joins: true_droid (true_droid@moz-123FD9B8.beck.volia.net)
[08:07:22] *** Quits: thesnowdog (doug@9842E8BA.8E46834.6F17036B.IP) (Connection reset by peer)
[08:16:23] *** Joins: nawfel (Mibbit@B57B4DED.327E5EAB.DFAB1F33.IP)
[08:16:59] *** Quits: nawfel (Mibbit@B57B4DED.327E5EAB.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[08:18:24] *** Quits: robarnold (rob@BD56354E.DB510C09.6E370BFC.IP) (Ping timeout)
[08:18:35] *** Joins: thesnowdog (doug@9842E8BA.8E46834.6F17036B.IP)
[08:19:42] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[08:20:21] *** Quits: SingingBoyo (brandon@4DF3381A.51F4D838.4F048BDC.IP) (Ping timeout)
[08:20:41] *** Joins: SingingBoyo (brandon@4DF3381A.51F4D838.4F048BDC.IP)
[08:22:30] *** Joins: maik (maik___@moz-85245553.dip0.t-ipconnect.de)
[08:25:32] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[08:29:49] <engla> acrichto: I appreciate your comments on the char iterator PR
[08:30:08] <engla> now splitting into two structs for iterators is just part of the change, and they could be merged again
[08:31:13] *** Joins: CarpNet (ac@moz-FD24B77.sohonet.co.uk)
[08:31:32] <Ms2ger> #if defined(__linux__) || defined(__APPLE__) || defined(__FreeBSD__) || defined(__WIN32__)
[08:31:48] * Ms2ger wonders what else is supported
[08:32:07] <acrichto> engla: ?
[08:32:30] <acrichto> engla: I thought they couldn't be merged b/c &fn isn't cloneable
[08:32:44] <maik> Ms2ger, arm
[08:33:00] <maik> well no os
[08:33:01] <Ms2ger> Ah, of course
[08:33:04] <maik> but android
[08:33:14] <engla> yes, cloning chariterator would have to be solved later if they are merged
[08:34:15] <tikue> how hard would it be to extend ifmt! to be able to access fields and index into indexable containers?
[08:34:40] <tikue> e.g. ifmt!("{v[0]} and {v[1]}", v=my_vec)
[08:35:12] <acrichto> engla: oh yeah that's fine, the split works for now
[08:35:27] <acrichto> tikue: not trivial
[08:35:42] <acrichto> tikue: but in theory that could be plausible
[08:36:01] <tikue> it'd be nice if only to reach feature parity with python
[08:36:32] <acrichto> tikue: could you open an issue about it? It'd probably be a good idea to see what others think before trying to implemented
[08:36:35] <acrichto> implement it*
[08:36:44] <acrichto> it's totally backwards-compatible though so it shouldn't be too invasive
[08:38:10] <tikue> yeah true
[08:42:07] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[08:42:07] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/Ph3qWA
[08:42:07] <ghrust> 13rust/06auto 141092744 15Alex Crichton: Implement `{:s}` for ~str and @str as well
[08:42:07] <ghrust> 13rust/06auto 1422c7bbf 15Alex Crichton: Delegate `{}` to Default instead of Poly...
[08:42:08] <ghrust> 13rust/06auto 143e4f40e 15bors: auto merge of #8564 : alexcrichton/rust/ifmt+++, r=graydon...
[08:42:10] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[08:43:42] <dbaupp> rusti: let _: @'static int fn() = || {};
[08:43:43] -rusti- ()
[08:43:49] <dbaupp> wtf^ ???
[08:44:05] <Eridius> o_O
[08:44:28] <dbaupp> rusti: let _: @'static random_word fn() = || {};
[08:44:29] -rusti- ()
[08:44:33] <engla> nice
[08:44:34] <Eridius> lol
[08:45:02] <dbaupp> cmr: I don't think you should mention @'static as a thing, given ^
[08:46:07] <tikue> acrichto: https://github.com/mozilla/rust/issues/8614
[08:46:25] <SingingBoyo> Am I the only one really confused by how the compiler could see that as valid?
[08:46:46] <dbaupp> SingingBoyo: nope
[08:46:58] <tikue> rusti: let a: @'static bogus fn() = || {};
[08:46:59] -rusti- <anon>:5:13: 5:14 warning: unused variable: `a` [-W unused-variable (default)]
[08:46:59] -rusti- <anon>:5          let a: @'static bogus fn() = || {};
[08:46:59] -rusti-                       ^
[08:46:59] -rusti- ()
[08:47:04] <tikue> lol
[08:47:09] <dbaupp> rusti: let _: @'a random_word fn() = || {};
[08:47:09] -rusti- <anon>:5:20: 5:31 error: Illegal lifetime 'a: named region `&'a ` not in scope here
[08:47:09] -rusti- <anon>:5          let _: @'a random_word fn() = || {};
[08:47:10] -rusti-                              ^~~~~~~~~~~
[08:47:10] -rusti- error: aborting due to previous error
[08:47:10] -rusti- application terminated with error code 101
[08:47:18] <dbaupp> it's actually parsing the 'static as a lifetime too ^
[08:47:53] <dbaupp> rusti: let _: @'static int = @1;
[08:47:53] -rusti- <anon>:5:29: 5:30 error: expected `fn`, found `=`
[08:47:53] -rusti- <anon>:5          let _: @'static int = @1;
[08:47:53] -rusti-                                       ^
[08:47:53] -rusti- application terminated with error code 101
[08:47:58] <dbaupp> and it only works with closures
[08:49:30] <dbaupp> rusti: fn foo<'a>() -> @'a whatever fn() { || {} } foo()
[08:49:37] *** Quits: tikue (tkuehn@moz-F4812C6E.hsd1.fl.comcast.net) (Quit: tikue)
[08:49:46] <dbaupp> rusti: fn foo<'a>() -> @'a whatever fn() { || {println("hi")} } foo()()
[08:49:47] -rusti- hi
[08:49:47] -rusti- ()
[08:57:29] <dbaupp> rusti: let _: @'static + fn();
[08:57:30] -rusti- ()
[08:57:37] <dbaupp> (https://github.com/mozilla/rust/issues/8615)
[08:58:53] *** Joins: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP)
[09:04:34] *** Quits: flowsnake (flowsnake@moz-1918C33E.aztw.cable.virginmedia.com) (Ping timeout)
[09:06:41] *** Joins: nsf (nsf@moz-EEF3238A.convex.ru)
[09:08:02] *** Joins: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk)
[09:08:15] *** Joins: flowsnake (flowsnake@moz-1918C33E.aztw.cable.virginmedia.com)
[09:08:31] <dbaupp> does anyone have a windows set up with which they can test https://github.com/mozilla/rust/issues/6316?
[09:08:53] <dbaupp> (`./configure --build-triple=i686-w64-mingw32`, I guess)
[09:11:32] * klutzy goes to download i686-w64-mingw32
[09:12:03] <klutzy> mingw names are really confusing
[09:15:30] *** Parts: true_droid (true_droid@moz-123FD9B8.beck.volia.net) (Leaving...)
[09:16:33] *** Quits: recrack (Mibbit@B4104EBB.3CC170B1.1E14B209.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[09:22:10] *** Joins: nawfel (Mibbit@B57B4DED.327E5EAB.DFAB1F33.IP)
[09:22:32] <nawfel> hello ? https://github.com/mozilla/rust/issues/8613
[09:23:15] <klutzy> dbaupp: seems like there is no such build-triple. maybe he was with some local patch
[09:24:47] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[09:25:26] *** Quits: alisdair (textual@1697D94C.7742FB18.FBC8476D.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[09:26:27] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[09:27:14] *** Quits: rovar_ (rovar@moz-203658CB.nycmny.fios.verizon.net) (Connection reset by peer)
[09:27:24] *** Joins: rovar_ (rovar@moz-203658CB.nycmny.fios.verizon.net)
[09:27:55] *** Joins: alisdair (textual@1697D94C.7742FB18.FBC8476D.IP)
[09:27:57] *** Quits: alisdair (textual@1697D94C.7742FB18.FBC8476D.IP) (Quit: alisdair)
[09:28:08] *** Quits: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net) (Connection reset by peer)
[09:28:19] *** Joins: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net)
[09:28:20] *** Joins: nano (nano@moz-74CAD1CA.superkabel.de)
[09:29:08] *** Quits: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net) (Connection reset by peer)
[09:29:19] *** Joins: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net)
[09:29:22] *** Quits: maik (maik___@moz-85245553.dip0.t-ipconnect.de) (Ping timeout)
[09:30:08] *** Quits: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net) (Connection reset by peer)
[09:30:19] *** Joins: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net)
[09:36:43] <SingingBoyo> is there a (mostly) up-to-date set of instructions/files to get rust syntax highlighting in vim?
[09:38:28] <cyndis> cp -R rust/src/etc/vim ~/.vim
[09:38:43] *** Quits: nawfel (Mibbit@B57B4DED.327E5EAB.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[09:38:49] <klutzy> I use https://github.com/wting/rust.vim with pathogen
[09:39:32] * flaper87 is using wting/rust.vim w/ vundle
[09:42:41] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[09:43:21] *** Quits: carleastlund (cce@moz-C8071335.c3-0.smr-ubr1.sbo-smr.ma.cable.rcn.com) (Quit: carleastlund)
[09:44:44] * SingingBoyo doesn't use vim for anything other then rust and needs to install lots of stuff
[09:46:00] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[09:46:06] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Client exited)
[09:46:50] *** zz_kimundi is now known as kimundi
[09:49:03] *** Quits: sebcrozet (sebcrozet@moz-C27D92D8.w193-252.abo.wanadoo.fr) (Ping timeout)
[09:49:07] *** Joins: sebcrozet (sebcrozet@moz-F96421F3.w80-13.abo.wanadoo.fr)
[09:51:53] *** Joins: nawfel (Mibbit@B57B4DED.327E5EAB.DFAB1F33.IP)
[09:52:03] *** Quits: fyolnish (fyolnish@moz-BE2BAE5B.miinet.jp) (Client exited)
[09:52:40] *** Quits: nawfel (Mibbit@B57B4DED.327E5EAB.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[09:53:44] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[09:53:47] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Client exited)
[10:01:30] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[10:01:48] *** Joins: maik (maik___@moz-16B95898.dip0.t-ipconnect.de)
[10:04:33] *** Quits: aatch (aatch@moz-B437F499.pocketrent.com) (Ping timeout)
[10:04:43] *** Quits: m_kato (m_kato@moz-C286AD9A.bitcat.net) (Quit: Leaving...)
[10:05:29] *** Joins: Palmik (palmik@moz-CC484FDD.tmcz.cz)
[10:09:58] *** Quits: maik (maik___@moz-16B95898.dip0.t-ipconnect.de) (Ping timeout)
[10:11:27] *** Joins: maik (maik___@moz-15C2F42E.dip0.t-ipconnect.de)
[10:12:05] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[10:13:07] *** Quits: maik (maik___@moz-15C2F42E.dip0.t-ipconnect.de) (Ping timeout)
[10:13:28] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[10:14:00] *** Quits: SingingBoyo (brandon@4DF3381A.51F4D838.4F048BDC.IP) (Ping timeout)
[10:16:16] *** Joins: maik (maik___@moz-56CBE7B9.dip0.t-ipconnect.de)
[10:25:07] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[10:26:47] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[10:27:43] *** Quits: maik (maik___@moz-56CBE7B9.dip0.t-ipconnect.de) (Ping timeout)
[10:31:47] <SimonSapin> Yurume: ping
[10:33:15] *** Joins: richard|s (mindginati@moz-268511E5.dsl.dyn.ihug.co.nz)
[10:33:18] *** Quits: richard|s (mindginati@moz-268511E5.dsl.dyn.ihug.co.nz) (Quit: richard|s)
[10:33:51] <dbaupp> klutzy: thanks; how confusing
[10:37:54] *** kimundi is now known as zz_kimundi
[10:38:45] *** zz_kimundi is now known as kimundi
[10:41:14] <klutzy> dbaupp: i686-w64-mingw32 is from mingw-w64 project (thus w64), and it's 32-bit (thus mingw32). it's funky
[10:41:44] <dbaupp> klutzy: ah, I see
[10:41:45] <klutzy> dbaupp: I found http://lrn.no-ip.info/other/rust-mingw-w64-build-patches/0001-add-mingw-w64-platform.all.patch but I don't know who made it
[10:42:22] <dbaupp> ah! maybe that's it, but it's not in the mainline, so that 3-month-old issue is closeable
[10:43:21] <klutzy> I agree
[10:44:10] <dbaupp> klutzy: (thanks for your help :) )
[10:44:24] <klutzy> :D
[10:48:14] *** Joins: maik (maik___@moz-B0F3393.dip0.t-ipconnect.de)
[10:49:03] <klutzy> oops, my exaplanation on triple is wrong. it's 32-bit so "i686". mingw32 is just an universal name for mingw family :-$
[10:49:49] <dbaupp> heh! they're lying to us!
[10:52:05] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[10:52:05] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Ph3qWA
[10:52:05] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[10:54:42] *** Joins: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP)
[11:00:26] *** kimundi is now known as zz_kimundi
[11:00:27] <dbaupp> cmr: "... PlayStation Portable. (*screnshot*)" btw
[11:02:06] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[11:02:06] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/qKAWvw
[11:02:06] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[11:02:09] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[11:02:09] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/BpFReQ
[11:02:09] <ghrust> 13rust/06auto 14eed6c57 15Tim Chevalier: testsuite: Tests for #6458. Closes #6458
[11:02:09] <ghrust> 13rust/06auto 146ca5dbc 15Tim Chevalier: std/extra: changing XXX to FIXME; cleanup...
[11:02:09] <ghrust> 13rust/06auto 1406def66 15Tim Chevalier: extra: change alloc to take &mut self, as per XXX comment
[11:02:11] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[11:04:32] <pnkfelix> cmr: ping
[11:06:50] <dbaupp> pnkfelix: thanks for your work on the visitors :)
[11:07:00] <nmatsakis> pnkfelix: ping
[11:07:10] * dbaupp had a tool using ast::visit that was forced to use @mut; now it isn't.
[11:07:16] <pnkfelix> dbaupp: no prob, its been something I've been trying to put to bed for months.
[11:07:18] <pnkfelix> nmatsakis: pong
[11:07:29] <nmatsakis> pnkfelix: do you hvae outstanding visitor PRs?
[11:07:39] <pnkfelix> nmatsakis: no I'm waiting for the one that graydon R+'ed to land.
[11:07:43] <nmatsakis> ok. 
[11:07:59] <pnkfelix> nmatsakis: (there was a bit of an accidental PR war between pcwalton and myself.)
[11:08:15] <pnkfelix> nmatsakis: That's what I get for making it so easy to port to the new interface.  :)
[11:08:18] <nmatsakis> I saw that, a bit surprising since I believe you advertised out that you were working on this fairly clearly...
[11:08:27] <dbaupp> pnkfelix: (is there a reason it isn't p=1?)
[11:08:29] <nmatsakis> ...but I guess he didn't notice.
[11:08:56] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Quit: Leaving)
[11:08:57] <pnkfelix> dbaupp: I don't know.  I trust graydon considered it.
[11:09:21] <pnkfelix> nmatsakis: he probably just got into a flow, no big whoop.
[11:10:08] <nmatsakis> pnkfelix: I'd say these patches could qualify for upper priority -- they seem conflict prone
[11:10:40] <pnkfelix> nmatsakis: Okay.  I'll see if I can up the priority, I think I've seen graydon do it by just adding a new comment to the commit in question.
[11:11:13] <nmatsakis> pnkfelix: I just added a comment, not sure how bors handles it. We can always delete graydon's comment :)
[11:11:24] <nmatsakis> pnkfelix: or rather, you can
[11:11:57] <dbaupp> iirc, I've seen an extra `p=1` comment work fine
[11:11:59] <pnkfelix> nmatsakis: ah, okay.  I don't mind you taking care of it, I was just now trying to remind myself whether lower numbers or higher numbers take precedence in the priority ordering.  :)
[11:13:20] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[11:13:46] <nmatsakis> pnkfelix: ok. of course I just gave MY pr p=10 :_
[11:20:47] *** Joins: Florob (Florob@moz-39532932.de)
[11:22:28] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[11:25:28] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[11:27:08] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[11:32:06] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[11:32:06] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d1fa1a8 to 143e4f40e: 02http://git.io/N3iJvQ
[11:32:06] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[11:32:07] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[11:32:07] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/Z-NfuQ
[11:32:07] <ghrust> 13rust/06auto 14303f650 15Niko Matsakis: Issue #3678: Remove wrappers and call foreign functions directly
[11:32:07] <ghrust> 13rust/06auto 140479d94 15Niko Matsakis: Add externfn macro and correctly label fixed_stack_segments
[11:32:07] <ghrust> 13rust/06auto 1481a7816 15bors: auto merge of #8535 : nikomatsakis/rust/issue-3678-wrappers-be-gone-2, r=graydon...
[11:32:09] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[11:33:05] <maik> is this possible? https://gist.github.com/MaikKlein/6268153
[11:33:55] <dbaupp> maik: "without destroying the old one" means leaving v2 unchanged?
[11:34:28] <maik> dbaupp, no I want to move the values out of v2
[11:34:44] <dbaupp> oh, then what does that quote mean?
[11:34:46] <maik> so v2= ~[1,2]
[11:35:14] <maik> quote?
[11:35:21] <dbaupp> oh... do you mean don't consume v2, so it's still useable afterwards?
[11:35:29] <dbaupp> (the "without destroying the old one")
[11:35:37] <maik> yes
[11:35:51] <dbaupp> I think you're looking for v3.push(v2.pop()); :
[11:36:22] <dbaupp> rusti: let mut v2 = ~[1,2,3,4]; let mut v3 = ~[]; v3.push(v2.pop()); v3.push(v2.pop()); (v2,v3)
[11:36:22] -rusti- (~[1, 2], ~[4, 3])
[11:36:27] <maik> but I can't write this with an iterator?
[11:36:28] <dbaupp> oh... oops.
[11:36:34] <dbaupp> maik: not easily
[11:37:00] <maik> lets say I have [1,2,3,4,5,6,7,8] and I want to move all elements that are x % 2 == 0 or sth
[11:37:12] <maik> :/
[11:37:20] <myname> you may consider filtering
[11:37:27] <myname> there was something a few days ago
[11:37:30] <myname> let me check
[11:37:47] <dbaupp> maik: you can just make a new vector
[11:38:38] <dbaupp> rusti: let v = ~[1,2,3,4,5,6,7,8]; let mut v2 = ~[]; let mut v3 = ~[]; for x in v.consume_iter() { if x % 2 == 0 { v2.push(x) } else { v3.push(x) } } (v2, v3)
[11:38:43] -rusti- line longer than 150 columns, pastebinned 5 lines of output: http://ix.io/7oO
[11:38:44] *** Joins: saneyuki (Mibbit@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[11:38:54] <dbaupp> rusti: let v = ~[1,2,3,4,5,6,7,8]; let mut v2 = ~[]; let mut v3 = ~[]; for x in v.move_iter() { if x % 2 == 0 { v2.push(x) } else { v3.push(x) } } (v2, v3)
[11:38:55] -rusti- (~[2, 4, 6, 8], ~[1, 3, 5, 7])
[11:39:00] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[11:39:04] <engla> there is a method called partition
[11:39:43] <dbaupp> rusti: let v = ~[1,2,3,4,5,6,7,8]; v.partition(|&x| x % 2 == 0)
[11:39:44] -rusti- (~[2, 4, 6, 8], ~[1, 3, 5, 7])
[11:39:51] <maik> ahh
[11:40:10] <maik> that is exactly what I want
[11:40:25] <maik> thanks
[11:41:12] <maik> rusti: let v = ~[1,2,3,4,5,6,7,8]; v.partition(|&x| x % 2 == 0); v
[11:41:15] -rusti- pastebinned 8 lines of output: http://ix.io/7oP
[11:41:25] <maik> ok nice and it moves
[11:43:25] *** Quits: sebcrozet (sebcrozet@moz-F96421F3.w80-13.abo.wanadoo.fr) (Client exited)
[11:45:48] *** Joins: sebcrozet (sebcrozet@moz-2517AE39.w80-13.abo.wanadoo.fr)
[11:55:44] <maik> rusti: let v = ~[1,2,3,4,5]; ifmt!("%?",v)
[11:55:44] -rusti- <anon>:5:42: 5:43 error: argument never used
[11:55:44] -rusti- <anon>:5          let v = ~[1,2,3,4,5]; ifmt!("%?",v)
[11:55:44] -rusti-                                                    ^
[11:55:45] -rusti- error: aborting due to previous error
[11:55:45] -rusti- application terminated with error code 101
[11:56:24] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[11:57:21] <dbaupp> rusti: let v = ~[1,2,3,4,5]; ifmt!("{:?}",v)
[11:57:22] -rusti- <anon>:5:37: 5:43 error: unterminated format string
[11:57:22] -rusti- <anon>:5          let v = ~[1,2,3,4,5]; ifmt!("{:?}",v)
[11:57:22] -rusti-                                               ^~~~~~
[11:57:22] -rusti- error: aborting due to previous error
[11:57:23] -rusti- application terminated with error code 101
[11:57:28] <dbaupp> rusti: let v = ~[1,2,3,4,5]; ifmt!("{:}",v)
[11:57:28] <bjz> rusti: fn x() {} mod x {} x()
[11:57:29] -rusti- ~"~[1, 2, 3, 4, 5]"
[11:57:29] -rusti- ()
[11:57:33] <bjz> rusti: fn x() {} mod x {} x()
[11:57:34] -rusti- ()
[11:57:42] <dbaupp> maik: ^ ifmt uses {}, not %
[11:58:03] <maik> dbaupp, ahh , thanks
[11:58:26] <dbaupp> maik: (also, the default formatter for {} is currently %?, but this is due to change.)
[11:59:00] <bjz> to what?
[11:59:14] <dbaupp> a new ToStr-like trait
[11:59:23] <bjz> coolies
[11:59:25] <dbaupp> sec
[11:59:29] *** Quits: nano (nano@moz-74CAD1CA.superkabel.de) (Connection reset by peer)
[11:59:42] <dbaupp> hm, maybe that's landed
[12:00:03] <dbaupp> ah, yes it has, https://github.com/mozilla/rust/pull/8564
[12:00:16] <dbaupp> in fact, it was the most recent landing :P
[12:00:54] *** Quits: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net) (Connection reset by peer)
[12:01:08] *** Quits: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net) (Connection reset by peer)
[12:01:19] *** Joins: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net)
[12:01:57] <bjz> nice!
[12:02:57] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[12:04:20] <maik> :)
[12:04:37] <dbaupp> gah!
[12:04:54] * dbaupp somehow make-cleaned llvm :(
[12:05:45] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[12:06:16] *** Quits: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com) (Client exited)
[12:06:57] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[12:07:34] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[12:09:33] * maik hopes that https://github.com/mozilla/rust/pull/8535 goes finally though
[12:10:01] <engla> is there a way to rename IterBytes?
[12:10:12] <engla> the problem is it's derived everywhere I think
[12:11:07] *** Quits: Liothen (liothen@moz-80EF0CD7.spkn.qwest.net) (Quit: Textual IRC Client: www.textualapp.com)
[12:11:11] <dbaupp> engla: yes, it should be possible: add the new name/a transitionary name to deriving; snapshot, convert everything to the new name, delete old name.
[12:12:15] <engla> ok
[12:12:34] <engla> I think the trait wants to move into std::hash at the same time
[12:13:13] <dbaupp> can probably just throw in a reexport in std::to_bytes and remove that after a second snap
[12:13:35] <dbaupp> (well, might not need the second snap.)
[12:14:20] <dbaupp> what are you renaming it to?
[12:14:52] <engla> don't know, but it needs to be renamed
[12:15:08] <engla> I think it's been decided it's a trait for feeding into a hash function, and only that
[12:15:52] <dbaupp> https://github.com/mozilla/rust/issues/8038 right?
[12:15:57] <engla> yes
[12:16:07] <engla> I had the PR land that includes vector length in the hash
[12:16:16] <dbaupp> oh, nice!
[12:16:21] <engla> so &[u8].to_bytes() is not the identity function anymore
[12:16:27] * dbaupp likes it when security wholes get closed.
[12:16:29] <dbaupp> *holes
[12:16:36] <engla> is it a security hole?
[12:16:59] <dbaupp> well, depends if a DoS counts as a security hole or not.
[12:17:06] <engla> aha yeah
[12:17:28] <dbaupp> (since you can use it to make hashmaps with O(n) performance.)
[12:17:31] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[12:17:57] *** Joins: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP)
[12:17:58] *** Quits: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP) (Z:lined (Open Proxy found on your host. Please visit www.blitzed.org/proxy?ip=115.68.131.49 for more information.))
[12:18:53] <maik> bjz, how is your registry reader going?
[12:20:07] <bjz> maik: nigh on done
[12:20:25] <maik> bjz, nice!
[12:20:26] *** Quits: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net) (Connection reset by peer)
[12:21:53] <bjz> maik: I just need to fix it so that only functions that take pointers are unsafe
[12:22:09] <bjz> maik: https://github.com/bjz/gl-rs#usage
[12:22:20] <dbaupp> it appears android has passed! http://buildbot.rust-lang.org/builders/auto-linux-64-x-android/builds/171
[12:22:22] <maik> bjz, lets hope this comes though http://buildbot.rust-lang.org/bors/bors.html
[12:23:31] *** Joins: mark_edward (quassel@21027BAA.520D6B7D.BF46A673.IP)
[12:23:42] <maik> bjz, hm do we always have to use "unsafe"?
[12:24:29] *** Joins: miloshadzic (miloshadzi@5E9C7FE4.FA4D0618.449B8A48.IP)
[12:24:34] <bjz> maik: that's what I mean
[12:25:07] <bjz> maik: atm it uses static muts directly which means you need 'unsafe'
[12:25:20] <maik> bjz, ah ok
[12:25:52] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[12:26:00] <bjz> maik: I will add inlined wrapper functions that are only marked unsafe if they take pointers
[12:26:10] <maik> bjz, I really like the fail instead of segfault, I had so many segfaults in c++ with opengl, that was really a pain in the ***
[12:26:50] <bjz> maik: I expect folks will create safe wrappers for gl-rs - this is just the foundation
[12:26:59] <dbaupp> is there someone on windows who can test https://github.com/mozilla/rust/issues/6315 for me? (I guess the output of `make clean; make -n VERBOSE=1 check-stage0-std` will show if libuv is being compiled with -O2 or not.)
[12:27:12] <dbaupp> klutzy: are you still around? ^
[12:27:18] <bjz> maik: but jeaye is right when he says that `unsafe { gl::Viewport(0, 0, 600, 480) };` is a little silly
[12:27:32] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[12:27:37] <klutzy> dbaupp: hoi!
[12:27:57] <bjz> maik: and yes, the failing fns are due to my annoyance with seg faults
[12:29:01] <maik> bjz, nice I am so excited to finally use opengl in rust
[12:29:18] <bjz> maik: not yet, still awaiting the patch
[12:29:51] <dbaupp> klutzy: could you run those 2 commands? :)
[12:30:05] <maik> bjz, the android build has already passed
[12:30:10] <bjz> !!
[12:30:24] <dbaupp> bjz: 4 builds left: http://buildbot.rust-lang.org/waterfall?branch=auto&refresh=15
[12:30:25] <klutzy> dbaupp: yep. I ran ../configure first and it takes 2 minutes or more :p
[12:30:40] <bjz> :O
[12:30:44] * dbaupp can't count
[12:31:15] <maik> :D
[12:31:22] <dbaupp> (wait, I can... strange, I must've been looking at 2 different versions.)
[12:31:31] <dbaupp> klutzy: ok
[12:33:22] *** Joins: bytewise (bytewise@moz-4A801D04.unitymediagroup.de)
[12:34:24] <maik> http://buildbot.rust-lang.org/waterfall?branch=auto&refresh=15 is confusing
[12:34:38] *** Joins: maxli (maxli@13F2CEC5.7672369.D8E68FF6.IP)
[12:36:44] <klutzy> dbaupp: http://pastebin.com/7tNSpy9N
[12:37:13] <klutzy> seems like `make check-stage0-std` requires llvm build, so I did different one :o
[12:37:37] *** zz_kimundi is now known as kimundi
[12:38:00] <dbaupp> aha, that looks fine
[12:38:26] <dbaupp> you didn't run ./configure with --disable-cxx-optimize, did you?
[12:38:48] <maik> bjz, http://buildbot.rust-lang.org/builders/auto-linux-32-opt is though!
[12:38:53] <klutzy> ah, just `../configure`ed. going to retry!
[12:39:24] <dbaupp> klutzy: no, that's good! --disable-cxx-optimize *not* what I want.
[12:39:40] *** Quits: mark_edward (quassel@21027BAA.520D6B7D.BF46A673.IP) (Ping timeout)
[12:39:43] <klutzy> aha I see
[12:40:33] * bjz races to add the safe/unsafe functionality
[12:40:33] <bjz> :P
[12:41:12] <maik> :D
[12:41:31] <klutzy> dbaupp: there's an interesting comment in mk/rt.mk: "FIXME: For some reason libuv's makefiles can't figure out the correct definition of CC on the mingw I'm using, so we are explicitly using gcc. Also, we have to list environment variables first on windows... mysterious"
[12:42:08] *** Joins: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net)
[12:42:58] <klutzy> looks like some options are disappeared away at libuv, including CC and optimization ones
[12:44:39] <klutzy> I also remember I had to treat libuv separately for mingw-w64 work last week
[12:45:28] <klutzy> I set w64 cross compiler but libuv used default w32 gcc, so it failed at linking with other win64 .o files
[12:45:33] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[12:46:48] *** Joins: alex-abreu (alex@moz-7421D6C9.mc.videotron.ca)
[12:46:52] <dbaupp> klutzy: yeah, it looks like all the flags just disappear (compared with my computer, x86_64-linux-unknown-gnu) :(
[12:47:08] <dbaupp> (you are klutzy on github, right?)
[12:47:17] <klutzy> yes, i'm klutzy :)
[12:47:28] *** Joins: Blub\w (wry@moz-222222AB.vps.tuwien.ac.at)
[12:48:41] <dbaupp> klutzy: comparison of the two: https://github.com/mozilla/rust/issues/6315#issuecomment-22869149
[12:48:49] * dbaupp edits it to have nicer line breaks
[12:52:31] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[12:52:54] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[12:53:05] *** Quits: metasyntax (tvenable@moz-63D9B3D.med-web.com) (Quit: Leaving)
[12:54:34] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[12:58:10] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[12:59:00] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[12:59:12] <bjz> maik: two left! http://buildbot.rust-lang.org/waterfall?branch=auto&refresh=15
[13:02:35] <klutzy> dbaupp: at src/libuv/config-mingw.mk: "CFLAGS=$(CPPFLAGS) -g --std=gnu89 -D_WIN32_WINNT=0x0600"
[13:02:52] <klutzy> libuv has two config .mk files, and they looks radically different :(
[13:03:05] <dbaupp> klutzy: :(
[13:04:21] <dbaupp> klutzy: ah, it looks like changing "CFLAGS=..." to "CFLAGS += ..." might help?
[13:04:49] <klutzy> dbaupp: maybe. time to try :)
[13:08:16] <klutzy> dbaupp: no changes :'( don't know why so far
[13:09:16] <dbaupp> :(
[13:09:43] <maik> bjz, interested in writing a high level opengl wrapper like OGLplus?
[13:10:07] <bjz> maik: last one! http://buildbot.rust-lang.org/waterfall?branch=auto&refresh=15
[13:10:14] <bjz> maik: possibly
[13:10:25] <bjz> maik: I will need one eventually
[13:10:46] <bjz> I thought there was somebody working on one though
[13:11:31] *** Joins: tgummerer (tgummerer@B864C03E.A5F114BE.8465EFE9.IP)
[13:11:32] <dbaupp> klutzy: feel free to keep working on it, but if you stop, could just add a brief note about the things you found to that issue (e.g. the dramatic difference between the .mk files, etc.)
[13:11:50] <flaper87> bjz: I think there is. I found a project for OpenGL on GH
[13:11:54] <klutzy> ok :D
[13:11:57] <flaper87> I don't remember the name, though
[13:13:16] <maik> I also started a scene graph a while ago but I stopped because I run into segfaults https://github.com/MaikKlein/RustSceneGraph/blob/master/src/examples/example.rs
[13:13:21] <maik> gonna update it soon
[13:14:32] *** Joins: nawfel (Mibbit@B57B4DED.327E5EAB.DFAB1F33.IP)
[13:15:27] *** Quits: z0w0 (zack@moz-7E6DC3A.lnse2.woo.bigpond.net.au) (Client exited)
[13:16:39] *** Quits: nawfel (Mibbit@B57B4DED.327E5EAB.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[13:17:24] *** Quits: Palmik (palmik@moz-CC484FDD.tmcz.cz) (Ping timeout)
[13:18:24] <maik> flaper87, do you have experience with concurrency?
[13:21:08] *** Joins: saml (sam@moz-14C16814.cst.lightpath.net)
[13:23:37] * nmatsakis holds breath
[13:23:42] <nmatsakis> bjz: btw the arm issue is fixed
[13:23:57] <bjz> nmatsakis: I know, it's awesome!
[13:24:15] <nmatsakis> bjz: ok, I "overheard" you mention there was still an arm issue while I was away
[13:24:29] <bjz> yeah, we're cheering on bors
[13:24:47] <bjz> ~6 min!
[13:24:51] <bjz> :O
[13:24:58] <maik> :D
[13:25:02] <maik> \o/
[13:25:06] <bjz> http://buildbot.rust-lang.org/waterfall?branch=auto&refresh=15
[13:26:13] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[13:26:32] <maik> 2mins :p
[13:27:41] <maik> done
[13:27:41] <maik> !
[13:27:54] <maik> \o/
[13:27:58] * bjz feints
[13:28:04] <bjz> *thud*
[13:28:27] <maik> :D
[13:28:45] *** Quits: saneyuki (Mibbit@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Quit: http://www.mibbit.com ajax IRC Client)
[13:31:06] * dbaupp thinks it would be amazingly unfortunate if bors has decided to crash now
[13:31:59] <bjz> D:
[13:32:14] <bjz> don't even think it!
[13:32:54] <maik> https://github.com/mozilla/rust/pull/8535
[13:33:19] <maik> how long until it is merged?
[13:33:59] <bjz> no idea
[13:35:28] <dbaupp> maik: patience! :P
[13:35:54] *** Quits: rfw (rfw@moz-C65A114.rfw.name) (Ping timeout)
[13:37:15] *** Quits: robn (robn@moz-76B0302C.static.internode.on.net) (Quit: Coyote finally caught me)
[13:37:20] *** Joins: robn (robn@moz-76B0302C.static.internode.on.net)
[13:39:11] *** Joins: rfw (rfw@moz-C65A114.rfw.name)
[13:40:03] <nmatsakis> did graydon lower the bors check frequency
[13:41:00] * bjz fights the urge to press that lovely big green button
[13:41:17] <pnkfelix> nmatsakis: yes
[13:41:28] <pnkfelix> nmatsakis: I think.  He sent an email about it violating the github API rate
[13:42:05] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[13:42:05] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Z-NfuQ
[13:42:05] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[13:42:14] <maik> !
[13:42:23] <maik> done
[13:42:25] * nmatsakis feels a sense of closure.
[13:42:34] <nmatsakis> ok, that's over. on to the next horrible gaping bug.
[13:42:47] <maik> nmatsakis, <3
[13:42:49] <pnkfelix> nmatsakis: surely you could have come up with a closure <~> extern fn pun
[13:42:57] <bjz> yyyyeahayyyyyyhasd;f;dsfkja;dslf
[13:42:59] * nmatsakis feels ashamed he didn't think of that
[13:43:11] <bjz> :P
[13:43:28] <dbaupp> nmatsakis: quick! comment on the PR with one before pnkfelix does
[13:43:31] <nmatsakis> pnkfelix: I've always been a lousy punner
[13:43:52] <nmatsakis> despite the fact that my family and friends seem to hold the "art" in high esteem
[13:44:00] <pnkfelix> nmatsakis: that's okay, it probably means you have a good sense of humor.
[13:47:06] <nmatsakis> I seem to recall reading that one of the ancient Greek philosophers had a classification of jokes, and puns were in the bottom-feeder category, but I can't find anything about this on the internet right now
[13:47:29] * pnkfelix enjoys leveraging English parse ambiguities mostly.  I always meant to try to find the formal name for that kind of "pun"
[13:48:05] <Ms2ger> "bad communication"
[13:48:08] <nmatsakis> "garden path" sentence?
[13:48:15] <nmatsakis> it's often called that on language log anyway :)
[13:48:38] <nmatsakis> though usually these are not intentional
[13:49:04] * nmatsakis -> off to library, be back soon
[13:49:23] * bjz compiles rustc
[13:49:48] *** Joins: Sergio965 (sergiobz@moz-BB21156B.dynamic.csail.mit.edu)
[13:51:31] *** Joins: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP)
[13:52:04] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[13:52:05] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/4Melhw
[13:52:05] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[13:52:07] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[13:52:07] <ghrust> 01[13rust01] 15bors pushed 9 new commits to 06auto: 02http://git.io/Y9F4Pw
[13:52:07] <ghrust> 13rust/06auto 144127c67 15Felix S. Klock II: Ported check_const from oldvisit to <V:Visitor> trait API.
[13:52:07] <ghrust> 13rust/06auto 143563411 15Felix S. Klock II: Ported check_loop from oldvisit to <V:Visit> trait API.
[13:52:08] <ghrust> 13rust/06auto 1454ee3d0 15Felix S. Klock II: Port check_match from oldvisit to <V:Visitor> trait API.
[13:52:10] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[13:52:45] *** Quits: cdidd (cdidd@moz-7D7D898D.broadband.corbina.ru) (Input/output error)
[13:55:22] <dbaupp> nmatsakis: https://github.com/mozilla/rust/pull/8535/files#L18R593 ... I guess that sentence has an end?
[13:56:05] *** Joins: metasyntax (tvenable@moz-63D9B3D.med-web.com)
[13:58:44] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[13:59:00] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[13:59:32] *** Quits: miloshadzic (miloshadzi@5E9C7FE4.FA4D0618.449B8A48.IP) (Ping timeout)
[14:02:58] *** Joins: carleastlund (cce@moz-C8071335.c3-0.smr-ubr1.sbo-smr.ma.cable.rcn.com)
[14:05:25] *** Joins: Palmik (palmik@moz-CC484FDD.tmcz.cz)
[14:06:16] *** Joins: dave1629 (dave@moz-17578A1A.hsd1.va.comcast.net)
[14:07:56] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Client exited)
[14:12:18] <clonejo> cmr: Is your introduction on memory management not done yet? Because it seems chopped off.
[14:13:24] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[14:14:15] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[14:17:11] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[14:17:40] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[14:18:19] *** Quits: dave1629 (dave@moz-17578A1A.hsd1.va.comcast.net) (Quit: dave1629)
[14:18:55] *** Joins: dave1629 (dave@moz-17578A1A.hsd1.va.comcast.net)
[14:19:06] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Client exited)
[14:19:31] *** Joins: cdidd (cdidd@moz-F91A9E76.broadband.corbina.ru)
[14:20:18] *** Quits: maxli (maxli@13F2CEC5.7672369.D8E68FF6.IP) (Ping timeout)
[14:20:27] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[14:20:35] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[14:20:50] *** Joins: maxli (maxli@13F2CEC5.7672369.D8E68FF6.IP)
[14:24:18] <bjz> hum
[14:24:45] <nmatsakis> dbaupp: uh, good point. I think I got so dismayed trying to figure out how to describe what that spagetti interface was i gave up
[14:24:54] <nmatsakis> dbaupp: I really want to take some time to refactor that fn
[14:25:23] <bjz> ../gl.rs:10740:148: 10740:153 error: mismatched types: expected `storage::FnPtr<extern "C" fn(u32, u32, u32, u32, u32, u32) -> std::libc::types::common::c95::c_void>` but found `storage::FnPtr<*u8>` (expected extern fn but found *-ptr)
[14:25:23] <bjz> ../gl.rs:10740     pub static mut WriteMaskEXT: FnPtr<extern "C" fn(res: GLuint, in_: GLuint, outX: GLenum, outY: GLenum, outZ: GLenum, outW: GLenum) -> c_void> = FnPtr { f: super::failing::WriteMaskEXT, is_loaded: false };
[14:25:57] <nmatsakis> bjz: are you trying to pass an extern fn declared in Rust?
[14:26:04] <bjz> ya
[14:26:10] <nmatsakis> bjz: we still need another PR to change the types of those from *u8 to extern "C" fn,
[14:26:12] <bjz> extern "C" fn
[14:26:15] <bjz> ohh
[14:26:17] <nmatsakis> bjz: however for the time being you CAN transmute them
[14:26:22] <nmatsakis> bjz: I think that should work just fine
[14:26:30] <bjz> can't do that statically though :(
[14:26:40] <nmatsakis> bjz: true, I can do that PR now, should be relatively easy
[14:26:56] <nmatsakis> bjz: I think that's bsaically the last step to truly put #3678 to bed
[14:27:02] <bjz> sorry
[14:27:09] <nmatsakis> :(
[14:27:22] <nmatsakis> I decided to draw the line somewhere so as to land the hard stuff :)
[14:27:28] *** Quits: dave1629 (dave@moz-17578A1A.hsd1.va.comcast.net) (Quit: dave1629)
[14:27:29] <bjz> almost done! yeah, for sure
[14:27:42] <bjz> makes sense
[14:28:02] <bjz> didn't know there was another thing to do that's all
[14:32:44] <Yurume> SimonSapin, did you ping me?
[14:33:09] <bjz> nmatsakis: how would I convert these to the new form? https://github.com/bjz/glfw-rs/blob/master/src/ffi.rs#L77
[14:33:27] <bjz> ./src/glfw.rs:939:38: 939:62 error: invoking non-Rust fn in fn without #[fixed_stack_segment] [-D cstack (default)]
[14:33:28] <bjz> ./src/glfw.rs:939         unsafe { str::raw::from_c_str(ffi::glfwGetJoystickName(joy)) }
[14:33:46] <nmatsakis> bjz: I suggest you don't convert them, you just add #[fixed_stack_segment]; #[inline(never)]; to the callers
[14:33:53] <bjz> ok
[14:33:54] <nmatsakis> if that's convenient
[14:34:05] <bjz> makes sense
[14:34:14] <bjz> why inline(never)?
[14:34:23] <nmatsakis> (this is explained in the FFI tutorial btw)
[14:34:26] *** Joins: boredomist (user@moz-63CF9F31.res-cmts.sesp.ptd.net)
[14:34:36] <nmatsakis> the reasoning is that #[fixed_stack_segment] requests a large stack frame
[14:34:39] <nmatsakis> if that fn is inlined,
[14:34:47] <nmatsakis> this will cause the caller to request a large stack frmae
[14:34:50] <nmatsakis> this is not necessarily bad
[14:35:33] *** Quits: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP) (Ping timeout)
[14:35:58] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[14:36:12] <nmatsakis> but if you carry it to the logical conclusion,
[14:36:21] <nmatsakis> you're not getting any benefits from segmented stacks
[14:37:41] <Ms2ger> nmatsakis, you seem to have missed something at the end of https://github.com/mozilla/rust/compare/3e4f40ec5aee...81a78161b535#L18R586 ?
[14:37:53] *** Joins: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP)
[14:38:18] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Client exited)
[14:39:51] <nmatsakis> Ms2ger: yes, this was pointed out -- thanks
[14:40:17] <Ms2ger> Excellent :)
[14:40:22] * Ms2ger goes back to lurking
[14:45:40] *** Joins: ofeldt (ofeldt@moz-A8AD1F0B.dip0.t-ipconnect.de)
[14:45:54] <bjz> nmatsakis: does externfn! do "C" by default?
[14:46:25] *** Quits: ofeldt- (ofeldt@moz-F34E29B7.dip0.t-ipconnect.de) (Ping timeout)
[14:47:07] <bjz> nmatsakis: would this work? externfn!(#[link_name="glGetIntegerv"] pub fn GetIntegerv(pname: GLenum, params: *GLint))
[14:47:18] <bjz> nmatsakis: it's just for an example
[14:47:23] *** Quits: pcdummy (pcdummy@moz-CF4CA865.page4me.ch) (Connection reset by peer)
[14:47:48] *** Quits: jaen (jaen@moz-38103FCB.neoplus.adsl.tpnet.pl) (Ping timeout)
[14:48:38] <bjz> hmm, doesn't seem to
[14:50:37] *** Joins: pcdummy (pcdummy@moz-CF4CA865.page4me.ch)
[14:53:09] <nmatsakis> bjz: that should work, lose the `pub`
[14:53:23] <nmatsakis> bjz: externfn!(#[link_name="..."] fn ...)
[14:53:29] <bjz> nah it didn't seem to
[14:53:36] <nmatsakis> it...really should
[14:53:55] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[14:53:55] <bjz> something to do with a syntax ambiguity
[14:54:02] <nmatsakis> externfn! will likely need some work, it's more a POC, but nonetheless, that ought to work
[14:54:05] <nmatsakis> hmm
[14:54:07] <bjz> I just wrapped it separately
[14:54:11] <nmatsakis> ok, you can easily enough produce a tweaked macro then
[14:54:35] <nmatsakis> the macro parser is so darn persnickety
[14:54:48] <nmatsakis> we should make the change pauls suggested to favor nonterminals first
[14:55:10] <nmatsakis> that would address that error and every other one that I personally have enountered,
[14:55:14] <nmatsakis> even though it's a hacky fix
[14:57:18] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[14:58:46] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[15:00:02] *** Joins: jaen (jaen@moz-DD4FD0E1.play-internet.pl)
[15:02:07] *** Joins: nano (nano@moz-74CAD1CA.superkabel.de)
[15:02:09] <klutzy> dbaupp: https://github.com/mozilla/rust/issues/6315#issuecomment-22869149
[15:02:33] *** Joins: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP)
[15:02:41] <klutzy> and I found I don't know anything of makefile :p
[15:03:37] *** Joins: mschifer (Adium@moz-42254FB1.hfc.comcastbusiness.net)
[15:07:15] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Client exited)
[15:07:25] <nmatsakis> bjz: let me know what other issues you run into
[15:07:28] <nmatsakis> (obviously)
[15:07:35] *** Joins: huseby (huseby@moz-4E8C421A.husebyhome.com)
[15:07:36] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[15:07:39] *** Joins: orshem (orshem@C5E06B1E.A5B6B765.E3D28531.IP)
[15:07:49] <bjz> nmatsakis: converted glfw-rs and sax-rs
[15:08:10] *** Joins: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com)
[15:08:43] *** Quits: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP) (Quit: dave1629)
[15:08:50] <bjz> nmatsakis: seems to be going ok
[15:08:55] <nmatsakis> random idea: what would people think about (T1, T2) -> T3 as the closure syntax,
[15:09:07] <nmatsakis> and fn(T1, T2) -> T3 as the "bare function" syntax
[15:09:16] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[15:09:17] <nmatsakis> extern "C" fn(T1, T2) -> T3 with explicit ABI
[15:09:38] <nmatsakis> I have to write up a blog post about the new extern stuff
[15:10:30] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[15:10:32] <nmatsakis> bjz: I have most of the changes to make `extern fn` be typed `extern "C" fn` vs `*u8`, just have to update the libraries...
[15:10:38] <nmatsakis> bjz: oh, and deal with stage0--doh
[15:10:49] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[15:11:54] <engla> (T1, T2) -> T3     can that work without any keyword before the "tuple"?
[15:12:18] <bjz_> nmatsakis: so you mean: let f: fn(int, int) = (x, y) { x + y };
[15:12:43] <bjz_> nmatsakis: or: let f: fn(int, int) = fn(x, y) { x + y };
[15:14:22] <engla> by syntax, you mean how to denote the type of a closure right?
[15:14:24] <pnkfelix> nmatsakis: I assume I should just keep marking the mechanical visitor rewrites as r+.  Would you mind looking over the last commit in the series from step 5, the one for lint.rs ?
[15:14:26] *** Quits: tgummerer (tgummerer@B864C03E.A5F114BE.8465EFE9.IP) (Ping timeout)
[15:14:44] <pnkfelix> nmatsakis: I'd like feedback on whether the approach is sane.
[15:15:32] <nmatsakis> pnkfelix: ok. yes, I think you can just "r+, mechanical rewrite" the intermediates, or "r=nmatsakis" (I did read them over)
[15:15:47] <nmatsakis> engla: yes I think it could work with no keyword, I don't believe there is an ambiguity
[15:16:10] <nmatsakis> bjz_: I am referring just to the *type* syntax
[15:16:17] <bjz_> oh ok
[15:16:25] <nmatsakis> bjz_: in that regard, perhaps |T1, T2| -> T3 would be bestb
[15:16:32] <nmatsakis> to echo the expression syntax
[15:16:46] <nmatsakis> pnkfelix: I will take a look at the last step again, I did read it briefly before
[15:17:32] <bjz_> nmatsakis: that might make more sense
[15:18:05] <nmatsakis> yeah, I like that
[15:18:08] <pnkfelix> nmatsakis: okay, if you looked at it briefly then it probably doesn't require too much inspection.  (I did put these things through `make check` and double-checked that they all seem to work still.  Certainly things broke during earlier iterations, so I am pretty trusting of `make check` for the linting.)
[15:18:19] <engla> nmatsakis: it's valid today to write  &fn(A) -> &fn(B, C) -> (D, E)  for a closure that returns a closure that returns a tuple. (A) -> (B, C) -> (D, E)  for the same, is that too ok?
[15:18:20] <maik> bjz_, does it work?
[15:18:30] <bjz_> maik: not yet
[15:18:44] <nmatsakis> engla: that'd be fine, thoug I am now leaning towrads |A| -> |B,C| -> (D,E)
[15:19:07] <nmatsakis> I do want to propose some change, but this all presumes we can move towards the closure model I proposed where you only have one kind of closure
[15:19:11] * Ms2ger wants |A| -> {B,C} -> (D,E)
[15:19:16] * Ms2ger ducks
[15:19:23] <bjz_> nmatsakis: why do we use the pipes?
[15:20:16] <nmatsakis> bjz_: partly Ruby/Smalltalk tradition, but also it's not ambiguous when parsing
[15:20:19] *** Quits: KindOne (KindOne@moz-F45181B8.dynamic.ip.windstream.net) (Ping timeout)
[15:20:28] <nmatsakis> bjz_: vs say `(a, b) { ... }`
[15:20:34] <bjz_> nmatsakis: ok, just curious
[15:20:36] <fabiand> hey
[15:20:41] <bjz_> yeah, that makes sense
[15:20:42] <fabiand> is there somewhere the source for rusti?
[15:20:50] <fabiand> or - for this bot here and how it's isolated?
[15:21:31] <pnkfelix> (A) -> (B,C) -> (D,E) seems ambiguous to me, in terms of whether the returned closure takes a single tuple argument, or a pair of arguments
[15:21:53] <nmatsakis> pnkfelix: huh?
[15:22:01] <pnkfelix> maybe that's what nmatsakis was referring to in terms of ambiguity
[15:22:07] <nmatsakis> I don't see any ambiguity at all,
[15:22:12] <bjz_> pnkfelix: I don't either
[15:22:18] <Ms2ger> (A) -> ((B,C)) -> (D,E)?
[15:22:20] <nmatsakis> but I think you are thinking of a Haskell/curried notation?
[15:22:26] <pnkfelix> no, not currying
[15:22:28] <pnkfelix> I mean
[15:22:30] <nmatsakis> oh, I see
[15:22:35] <nmatsakis> I was assuming () were mandatory
[15:22:38] <pnkfelix> ah
[15:22:48] <nmatsakis> but I prefer `|` for that reason
[15:22:56] <nmatsakis> and because it mimics expr form
[15:23:26] *** Joins: KindOne (KindOne@moz-F45181B8.dynamic.ip.windstream.net)
[15:23:30] <pnkfelix> but you're right, the () are already mandatory, and we could keep it that way
[15:24:33] <maik> http://static.rust-lang.org/doc/std/task.html#function-yield this doesn't work anymore because it is a reserved keyword, what is the replacement?
[15:25:12] *** Quits: bytewise (bytewise@moz-4A801D04.unitymediagroup.de) (Ping timeout)
[15:25:22] <engla> maik: deschedule, I think
[15:25:40] <bjz_> rusti: ifmt!("\{\}")
[15:25:41] -rusti- <anon>:5:14: 5:15 error: unknown string escape: 123
[15:25:41] -rusti- <anon>:5          ifmt!("\{\}")
[15:25:41] -rusti-                        ^
[15:25:41] -rusti- application terminated with error code 101
[15:25:47] <bjz_> rusti: ifmt!("{}")
[15:25:47] -rusti- <anon>:5:15: 5:19 error: invalid reference to argument `0` (there are 0 arguments)
[15:25:47] -rusti- <anon>:5          ifmt!("{}")
[15:25:47] -rusti-                         ^~~~
[15:25:47] -rusti- error: aborting due to previous error
[15:25:48] -rusti- application terminated with error code 101
[15:25:52] <bjz_> rusti: ifmt!("\\{\\}")
[15:25:53] -rusti- ~"{}"
[15:26:18] <maik> engla, thanks
[15:28:49] *** Quits: KindOne (KindOne@moz-F45181B8.dynamic.ip.windstream.net) (Ping timeout)
[15:29:06] *** Joins: tedh (tedh@moz-D8911C58.public.wayport.net)
[15:30:20] <jld> So, um, the test suite seems to be parallel again, but it might be a little *too* parallel at the moment.
[15:30:46] *** Joins: KindOne (KindOne@moz-F45181B8.dynamic.ip.windstream.net)
[15:30:58] *** Joins: miloshadzic (miloshadzi@5E9C7FE4.FA4D0618.449B8A48.IP)
[15:30:58] *** Quits: lmandel (lmandel@moz-9CE00FC0.holiday-inn-express.mozilla.hq) (Quit: lmandel)
[15:34:23] <maik> bjz_, do you need help to fix it?
[15:34:48] <bjz_> maik: no, I can't do anything from my end
[15:34:59] <maik> bjz_, oh :/
[15:35:01] <bjz_> maik: it will be fixed soon though
[15:35:20] <bjz_> maik: the hard part is over
[15:35:21] *** Quits: LimeBurst (me@247D1419.D73964AC.27A8748.IP) (Ping timeout)
[15:35:29] <maik> *soon*? :D
[15:35:33] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[15:35:35] <bjz_> maik: :P
[15:35:58] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[15:36:49] *** Joins: maxli1 (maxli@13F2CEC5.7672369.D8E68FF6.IP)
[15:36:55] *** Quits: maxli (maxli@13F2CEC5.7672369.D8E68FF6.IP) (Connection reset by peer)
[15:37:32] <maik> bjz_, is someone already working on it?
[15:37:50] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[15:38:03] <bjz_> maik: of course
[15:38:03] <bjz_> nmatsakis says it shouldn't be too hard
[15:38:18] <bjz_> the main issue was to get the big part over
[15:38:32] <bjz_> it will be in the scrollback ^
[15:39:30] <toddaaro> is there someone who can help me debug a compiler infinite loop?
[15:39:43] <toddaaro> it stills seems impossible to compile rust on the IU network
[15:39:46] <bjz_> maik: https://botbot.me/mozilla/rust/msg/5293887/
[15:39:48] *** Joins: LimeBurst (me@247D1419.D73964AC.27A8748.IP)
[15:40:53] <erickt> nmatsakis: ping
[15:41:18] <nmatsakis> erickt: pong
[15:41:37] <erickt> nmatsakis: good morning! I was wondering if you had a moment to look at https://github.com/mozilla/rust/issues/8579
[15:42:13] <nmatsakis> that's a dup
[15:42:17] *** Joins: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP)
[15:42:23] <nmatsakis> but yes, it's a known limitation -- 
[15:42:38] <erickt> nmatsakis: I thought it might have been, but I couldn't find the dup
[15:42:43] <maik> bjz_, thanks
[15:42:59] <nmatsakis> erickt: cleaning up all that code is high on my list of next steps,
[15:43:06] <nmatsakis> erickt: but your summary in the bug report sounds roughly right,
[15:43:11] <nmatsakis> erickt: I'd have to dive into the code a bit to say more
[15:43:26] <erickt> nmatsakis: ok thanks :)
[15:43:55] <erickt> nmatsakis: I'll try to take a swing at it tonight to see if there's a simple solution to it
[15:43:57] *** Quits: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP) (Ping timeout)
[15:43:58] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[15:43:59] *** Quits: Florob (Florob@moz-39532932.de) (Client exited)
[15:44:17] <nmatsakis> erickt: I can't find the dup either atm
[15:44:23] <nmatsakis> but I know there is one :)
[15:44:30] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[15:45:12] *** Joins: jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net)
[15:46:10] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[15:46:56] <erickt> I gotta say though that working with generic functions that have a reference to a enum that owns a region gets really noisy :(
[15:49:24] <bjz_> aye
[15:49:36] * erickt wonders if the hypothetical yield syntax could help hide the ugliness of complex iterators
[15:50:15] <engla> isn't that the very reason for having yield syntax
[15:50:52] <erickt> engla: err, I mean the ugliness of the types of complex iterators
[15:53:01] *** Joins: tgummerer (tgummerer@51D3B54.FEF996EA.EA6FEF3D.IP)
[15:53:08] <SimonSapin> Yurume: yes. About encoding error handling: do you think it is useful to expose at all the current versions of feed() and flush() if there are versions of those with error traps?
[15:53:29] <SimonSapin> Also, Iâ€™d like to find a way to unify things with the spec
[15:53:38] <erickt> engla: for example, while writing `[1,2,3].iter().map(|x| x.to_str())` is simple to write, the type of that value is `iterator::<'a, int, ~str, vec::VecIterator<'a, int>>`
[15:53:44] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[15:53:44] *** ChanServ sets mode: +o dherman
[15:54:21] <erickt> engla: oops, it's even longer: iterator::Map<'a, int, ~str, vec::VecIterator<'a, int>>`
[15:54:26] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[15:54:58] <olsonjeffery> ah. to be valgrind clean.
[15:54:59] <Yurume> SimonSapin, the current feed/flush() API is a (slight) superset of error traps. for example, stopping the decoder at the error position without failure is impossible in error traps.
[15:55:24] *** Quits: [o__o] (~o__o@moz-24EBFAC7.me) (Input/output error)
[15:55:28] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[15:55:28] <SimonSapin> Yurume: yes, but is it useful at all?
[15:55:28] *** Joins: [o__o] (~o__o@moz-24EBFAC7.me)
[15:56:12] <Yurume> SimonSapin, I'm not sure, the above example is actually the only use case I'm aware of.
[15:56:55] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[15:57:50] *** AutomatedTester is now known as AutomatedTester|AFK
[15:57:51] <Yurume> SimonSapin, by the way, is there any benefit with the error traps in feed/flush()?
[15:58:44] <SimonSapin> Yurume: Servo will typically use Replace error handling with incremental decoding
[15:58:54] <Yurume> the decoder still must be able to handle sequences spanning multiple inputs
[15:59:06] <SimonSapin> yes
[15:59:20] *** Joins: maxli (maxli@13F2CEC5.7672369.D8E68FF6.IP)
[15:59:25] *** Quits: maxli1 (maxli@13F2CEC5.7672369.D8E68FF6.IP) (Connection reset by peer)
[15:59:51] <SimonSapin> any reason it couldnâ€™t?
[16:00:12] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[16:00:27] <Yurume> no, I meant that having error traps doesn't make the decoder easy to write
[16:00:52] *** Quits: jaen (jaen@moz-DD4FD0E1.play-internet.pl) (Ping timeout)
[16:00:54] <Yurume> from the design perspective: if we can directly give CodecError to error traps then do we still need to give error traps to feed/flush?
[16:01:58] *** Joins: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com)
[16:02:07] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[16:02:07] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Y9F4Pw
[16:02:07] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[16:02:09] <SimonSapin> Iâ€™m not sure how much API is needed for traps
[16:02:10] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[16:04:54] *** Joins: lmandel (lmandel@moz-BBE3ABD.mv.mozilla.com)
[16:05:50] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[16:06:34] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[16:07:26] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Client exited)
[16:09:15] *** Joins: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl)
[16:09:24] *** Quits: Blub\w (wry@moz-222222AB.vps.tuwien.ac.at) (Ping timeout)
[16:09:38] *** Quits: mschifer (Adium@moz-42254FB1.hfc.comcastbusiness.net) (Quit: Leaving.)
[16:10:17] *** Quits: miloshadzic (miloshadzi@5E9C7FE4.FA4D0618.449B8A48.IP) (Ping timeout)
[16:10:20] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[16:10:35] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[16:11:28] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[16:12:08] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[16:12:08] <ghrust> 01[13rust01] 15bors pushed 9 new commits to 06auto: 02http://git.io/ADgLpA
[16:12:08] <ghrust> 13rust/06auto 143ac6334 15Felix S. Klock II: port resolve.rs from oldvisit to <V:Visitor> trait.
[16:12:08] <ghrust> 13rust/06auto 14ac58250 15Felix S. Klock II: Ported trans/base.rs from oldvisit to <V:Visitor> trait API.
[16:12:08] <ghrust> 13rust/06auto 149290721 15Felix S. Klock II: Ported liveness.rs from oldvisit to <V:Visitor> trait API.
[16:12:10] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[16:12:21] *** Quits: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com) (Quit: jeff)
[16:12:31] *** Joins: mihneadb (mihneadb@moz-BBE3ABD.mv.mozilla.com)
[16:14:21] <erickt> nmatsakis: did you ever make any progress on your associated items proposal? I wonder if that would also help clear up a lot of the ugliness of iterator types
[16:14:44] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[16:15:16] <nmatsakis> erickt: no progress has been made on that, I think we're still even unclear on the precise syntax we might wind up using and if/when we would implement it. I guess it's currently slated as post 1.0-ish but there is some uncertainty
[16:15:28] *** Joins: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP)
[16:15:40] <bjz_> rusti: pub mod a { pub struct A; impl A { pub fn a() {} } } a::A::a()
[16:15:41] -rusti- ()
[16:15:46] <bjz_> :/
[16:16:28] <bjz_> rusti: pub use a::A; pub mod a { pub struct A; impl A { pub fn a() {} } } A::a()
[16:16:32] -rusti- pastebinned 8 lines of output: http://ix.io/7p5
[16:16:39] * nmatsakis wonders what bjz is trying to demonstrate here
[16:17:02] <nmatsakis> oh
[16:17:09] <bjz_> nmatsakis: https://gist.github.com/bjz/bff546a60aa56cbb9c8d
[16:17:22] <erickt> nmatsakis: ok. I was pretty happy with the one you had in the blog :)
[16:17:56] <bjz_> nmatsakis: apologies for the macro ugliness :(
[16:17:57] <nmatsakis> erickt: well, I had a couple :)
[16:18:08] <nmatsakis> erickt: not sure which one you were referring to...
[16:18:23] <bjz_> rusti: pub use self::a::A; pub mod a { pub struct A; impl A { pub fn a() {} } } A::a()
[16:18:25] -rusti- pastebinned 8 lines of output: http://ix.io/7p6
[16:19:03] <bjz_> rusti: use a::A; pub mod a { pub struct A; impl A { pub fn a() {} } } A::a()
[16:19:05] -rusti- pastebinned 8 lines of output: http://ix.io/7p7
[16:19:13] *** Quits: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP) (Quit: dave1629)
[16:19:25] <bjz_> rusti: use self::a::A; pub mod a { pub struct A; impl A { pub fn a() {} } } A::a()
[16:19:27] -rusti- pastebinned 8 lines of output: http://ix.io/7p8
[16:19:42] <bjz_> is that not possible?
[16:19:47] <bjz_> :/
[16:19:52] <bjz_> that is very weird
[16:20:08] <erickt> nmatsakis: oh I forgot you did.
[16:20:39] <nmatsakis> bjz_: sounds like a bug to me...
[16:21:06] <bjz_> nmatsakis: do you think my rusti tests are related?
[16:21:28] <erickt> nmatsakis: I was referring to this syntax: https://gist.github.com/nikomatsakis/5314896
[16:22:40] <nmatsakis> erickt: I...think that is still my preference, but pcwalton is very opposed.
[16:22:51] *** dherman is now known as dherman-breakfast
[16:22:53] <bjz_> I liked that one...
[16:22:56] <bjz_> :P
[16:23:01] <nmatsakis> erickt: admittedly it introduces some complications into the compiler etc, and if you think about it hard, it's subtle, but I think 99% of the time it would just do what you want
[16:23:12] <nmatsakis> it might be that I should do a POC
[16:23:19] <nmatsakis> I am hoping to spend some time on trait resolution 
[16:23:20] <bjz_> POC?
[16:23:23] <nmatsakis> "proof of concept"
[16:23:27] <bjz_> ah
[16:24:14] <nmatsakis> bjz_: ok, so, I have a branch that chanes the type of extern fns, but it...somehow crashes :( have to see why THAT is
[16:24:20] <nmatsakis> probably something dumb
[16:24:41] *** Joins: Blub\w (wry@7410D7DF.69B8A607.613A4659.IP)
[16:24:42] <erickt> nmatsakis: would it make sense to add declaring an associated lifetime?
[16:24:48] <bjz_> nmatsakis: one of the things that concerns me is that FromStr::from_str-isms are becoming prevalent
[16:25:56] <bjz_> nmatsakis: cool, np
[16:26:20] <bjz_> nmatsakis: it's not super urgent, but it would be nice to have
[16:26:33] * bjz_ is excited about doing some opengl
[16:27:59] <bjz_> erickt: so are you saying you could do: Vec3::ZERO?
[16:28:32] *** Joins: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP)
[16:32:10] *** Quits: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP) (Quit: dave1629)
[16:33:11] *** Joins: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP)
[16:33:35] *** Quits: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP) (Quit: dave1629)
[16:33:39] *** Joins: echristo (echristo@moz-1892C634.hsd1.ca.comcast.net)
[16:34:49] *** Joins: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP)
[16:35:35] *** Quits: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP) (Quit: dave1629)
[16:36:12] *** Joins: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP)
[16:37:05] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[16:37:05] *** Quits: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk) (Client exited)
[16:39:26] *** Quits: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP) (Quit: dave1629)
[16:39:26] <erickt> bjz_: yeah, I think associated items would allow for that
[16:40:14] <bjz_> erickt: that's what my preference was, but I think there was opposition
[16:40:32] * erickt scoffs at the opposition
[16:40:35] <erickt> :)
[16:40:38] <bjz_> :)
[16:41:45] *** Joins: squiddy (squiddy@moz-FC1DD794.adsl.alicedsl.de)
[16:42:07] <bjz_> erickt: there are complexities when you have more complex types in there
[16:42:30] *** Joins: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca)
[16:42:33] <bjz_> like what about ~Foo<A>?
[16:42:42] <erickt> stupid real world complexities ruining what is perfectly simple in my imagination
[16:42:51] <bjz_> yeah :P
[16:43:32] <bjz_> in my imagination it would be (~Foo<A>)::X, but that's super complex when you start to think about it
[16:43:45] <Thiez> the new runtime/io stuff is very nice, rustray is getting faster again :)
[16:43:57] <cmr> Thiez: nice!
[16:45:53] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[16:46:00] <Thiez> so, should this work:
[16:46:03] <Thiez> rusti: struct S<T>{x: T} impl<int> S<int>{ fn foo()->int {0} } impl<uint> S<uint>{ fn foo()->int {1} }
[16:46:05] -rusti- pastebinned 8 lines of output: http://ix.io/7pb
[16:46:35] *** Quits: mihneadb (mihneadb@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[16:46:47] *** Joins: mihneadb (mihneadb@moz-BBE3ABD.mv.mozilla.com)
[16:48:15] <bjz_> erickt: I think the idea was to keep paths simpler (no expression trees and chances of adding bugs to the compiler)
[16:48:40] *** Quits: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl) (Client exited)
[16:48:51] <bjz_> erickt: see: https://github.com/mozilla/rust/issues/6894
[16:48:52] <cmr> Thiez: no, it shouldn't
[16:48:59] <maik> Thiez, I think you need a trait for that
[16:49:02] <cmr> Thiez: just impl S<int>, I think
[16:50:07] <bjz_> erickt: I wasn't very level headed in that thread, be warned :P
[16:50:18] <maik> rusti: struct S<T>{x: T} impl S<int>{ fn foo()->int {0} } impl S<uint>{ fn foo()->int {1} }
[16:50:20] -rusti- pastebinned 8 lines of output: http://ix.io/7pc
[16:51:38] *** Quits: dherman-breakfast (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman-breakfast)
[16:52:19] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[16:53:45] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[16:53:45] *** ChanServ sets mode: +o dherman
[16:55:27] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[16:55:42] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[16:55:57] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[16:56:17] *** Quits: CarpNet (ac@moz-FD24B77.sohonet.co.uk) (Quit: Leaving)
[16:56:25] <SimonSapin> Yurume: Re https://github.com/lifthrasiir/rust-encoding/issues/3 : at least for Servo API convenience is not a good enough reason to deviate behavior from the spec. (Although the spec may have bugs, which should be fixed.) Also, Iâ€™m not convinced that remaining1/2 is actually necessary
[16:56:47] <toddaaro> hm, is graydon around?
[16:56:55] <cmr> toddaaro: not yet, no
[16:56:56] <toddaaro> or is it some sort of Canadian holiday again
[16:57:29] <Ms2ger> SimonSapin, what do browsers do? :)
[16:57:31] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[16:57:35] <SimonSapin> In your EA B0 7F example, the spec yields U+FFFD U+007F.
[16:58:21] <Ms2ger> (Not mine)
[16:58:46] <Yurume> SimonSapin, yes, if we don't have error traps things are simple. but we have them.
[16:59:24] <SimonSapin> Yurume: whatâ€™s are the requirements for traps?
[16:59:25] *** Joins: azakai (alon@moz-BBE3ABD.mv.mozilla.com)
[16:59:53] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[17:00:11] *** Quits: echristo (echristo@moz-1892C634.hsd1.ca.comcast.net) (Quit: echristo)
[17:00:28] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[17:00:36] <SimonSapin> Ms2ger: No interop :( data:text/plain;charset=utf8,%EA%B0%33
[17:00:42] <clonejo> cmr: Is your introduction on memory management not done yet? Because it seems chopped off.
[17:00:52] *** Joins: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP)
[17:00:59] <Yurume> SimonSapin, for traps, an ability to reference the error range without a copy; for decoder API, also an ability to reference the unprocessed portion of the input to refed.
[17:01:02] <Ms2ger> SimonSapin, I guess then you ping annevk :)
[17:01:02] <Yurume> refeed*
[17:01:07] <cmr> clonejo: it is not
[17:01:12] <cmr> clonejo: I accidentally published it
[17:01:24] <SimonSapin> Ms2ger: yes, Yurumeâ€™s example in https://github.com/lifthrasiir/rust-encoding/issues/3
[17:01:26] <cmr> If you refresh the page you should see a note at the top
[17:01:43] <Yurume> what Encoding.{decode,encode} does is hiding the latter.
[17:01:58] *** Quits: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP) (Quit: dave1629)
[17:02:03] <clonejo> cmr: okay. Pretty nice to have all the ideas on memory management in one place
[17:02:04] *** Joins: echristo (echristo@moz-1892C634.hsd1.ca.comcast.net)
[17:03:17] <Yurume> so, yes, remaining1/2 is an artifact of the current design and not an inherent issue of traps. so if we can support traps without needing to refer `remaining` it would be best.
[17:03:46] *** Quits: echristo (echristo@moz-1892C634.hsd1.ca.comcast.net) (Ping timeout)
[17:03:57] <SimonSapin> Yurume: would that work for feed/flush with traps?
[17:04:05] *** Joins: echristo (echristo@60A74940.D6CCE4AE.77834EAA.IP)
[17:05:17] *** Joins: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP)
[17:05:22] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[17:05:54] *** Quits: Blub\w (wry@7410D7DF.69B8A607.613A4659.IP) (Ping timeout)
[17:06:06] *** Joins: Blub\w (wry@7410D7DF.69B8A607.613A4659.IP)
[17:06:56] <Yurume> SimonSapin, worth experimenting it. I originally thought that feed with direct traps will make the decoder more verbose without many benefits, but it seems to have much more far-reaching consequence.
[17:07:21] <Yurume> traps then would need to have `output` parameter as well
[17:07:29] *** Joins: graydon (Adium@A5087023.2354C43D.D8E68FF6.IP)
[17:07:29] *** ChanServ sets mode: +qo graydon graydon
[17:08:05] <cmr> toddaaro: ^ there he is
[17:08:21] <SimonSapin> Yurume: Iâ€™m less worried about copying a few bytes on errors
[17:08:45] *** Quits: StarLight (StarLight@moz-744D4E3D.dynamic.avangarddsl.ru) (Ping timeout)
[17:09:00] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[17:09:01] *** ChanServ sets mode: +o brson
[17:09:19] <SimonSapin> and the idea is to have the verbosity once and for all in rust-encoding, so that users donâ€™t have to deal with it
[17:09:40] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[17:10:54] *** Quits: mihneadb (mihneadb@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[17:11:30] <Yurume> SimonSapin, traps are not functions, in fact function-based traps have a different set of parameters than the full `{En,De}coderTrap` interface.
[17:11:31] <brson> toddaaro: this needs some fixes https://github.com/mozilla/rust/pull/8566
[17:11:40] *** Quits: Blub\w (wry@7410D7DF.69B8A607.613A4659.IP) (Ping timeout)
[17:11:49] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:11:56] *** Joins: Blub\w (wry@7410D7DF.69B8A607.613A4659.IP)
[17:12:05] <Yurume> what I'm talking about is mostly about `{En,De}codertrap` interface.
[17:12:21] *** Joins: mihneadb (mihneadb@moz-BBE3ABD.mv.mozilla.com)
[17:12:40] <Yurume> SimonSapin, I will go to sleep soon, and I think I don't have much spare time to develop rust-encoding in this week, but I'll experiment with it soon.
[17:12:40] *** Joins: Kruppe (user@moz-4DDA8AB8.uwaterloo.ca)
[17:13:15] *** Joins: StarLight (StarLight@moz-637E2651.dynamic.avangarddsl.ru)
[17:13:31] *** Quits: Blub\w (wry@7410D7DF.69B8A607.613A4659.IP) (Quit: ...)
[17:13:39] <SimonSapin> Yurume: I could do the actual development, but Iâ€™d like your thoughts about what to do
[17:14:36] *** Joins: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com)
[17:14:47] <Yurume> merging traps to feed/flush interface seems to be a way to go, so be bold about that :)
[17:14:58] *** Quits: fabiand (fabiand@moz-A13A8369.adsl.alicedsl.de) (Quit: Verlassend)
[17:15:14] <sully> oh, ha
[17:15:39] <sully> just found the bug that I introduced that caused my PR from last wednesday to fail
[17:15:57] <SimonSapin> Yurume: I wonder if the actual encoding implementations should keep the current API, and trap handling be an adapter thatâ€™s only implemented once
[17:16:31] <Yurume> by default methods, for example?
[17:16:33] <sully> while adding some stuff, I discovered that one of the things that we were trying to cache
[17:16:36] *** Quits: echristo (echristo@60A74940.D6CCE4AE.77834EAA.IP) (Ping timeout)
[17:16:40] <sully> we weren't actually ever populating the cache for
[17:16:44] <sully> so while I was there, I fixed it
[17:16:53] <SimonSapin> or another trait, like .encode() and .decode()
[17:17:06] <Yurume> i.e. moving a portion of Encoding.{de,en}code to {De,En}coder.feed_with_trap etc.
[17:17:08] <Yurume> yeah
[17:17:18] <Yurume> fine with that
[17:17:35] <kmc> what are the semantics of the syntax "let x;" (with no initialization)? the compiler will check statically that there's an assignment before each use?
[17:17:45] <Yurume> but it would make no difference w.r.t. synchronizing error ranges with the spec
[17:17:48] <cmr> kmc: yes
[17:18:01] <kmc> rust doesn't have any default initialization a la C++, right?
[17:18:07] <cmr> yes
[17:18:23] <Yurume> since it would need a (big) change on `CodecError` which feed/flush currently returns.
[17:18:37] *** Joins: bytewise (bytewise@moz-4A801D04.unitymediagroup.de)
[17:19:17] <SimonSapin> Yurume: yes. Iâ€™d also like to sync with the spec but unsure about how to do that
[17:19:28] *** Joins: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:21:48] <graydon> brson: mind if I land a patch to remove any/all remaining uses of "more threads to fix parallelism" when we sniff being-on-valgrind?
[17:22:16] <graydon> cmr: ping
[17:22:32] <cmr> graydon: pong
[17:22:46] <brson> graydon: no
[17:23:21] <graydon> cmr: did you poke at metrics at all? and/or are you intending to soon? (sounds like you're starting uni lately? wouldn't want to steal time from that)
[17:23:30] <graydon> brson: no you don't mind, or no don't do it?
[17:24:06] <jld> graydon: re-r?(#8546)
[17:24:10] <brson> graydon: i don't mind
[17:24:24] <cmr> graydon: I did, and I plan on doing it more. I was trying to figure out how exactly count_insn and its supporting infrastructure worked
[17:24:39] <cmr> (I also added a counter, but that's easymode stuff)
[17:25:49] <graydon> cmr: I think the main thing is a framework for registering metrics in TLS. can you split that bit off and send a PR so I can do some of the actual metric implementations in parallel with you?
[17:25:59] <cmr> graydon: sure!
[17:26:02] <cmr> I'll do that today
[17:26:04] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[17:26:04] *** ChanServ sets mode: +o dherman
[17:26:08] <graydon> thanks :)
[17:27:31] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[17:27:32] <maik> ah that reminds me of a question, is it possible to write sth like this let distance = 1000km ?
[17:27:50] <maik> to make my own postfix types?
[17:27:54] <cmr> maik: no
[17:28:06] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[17:28:17] <maik> :(
[17:28:56] <maik> uh
[17:29:39] <maik> rusti: type meter = uint; let distance = 1000:meters
[17:29:39] -rusti- <anon>:5:47: 5:48 error: expected `;` but found `:`
[17:29:40] -rusti- <anon>:5          type meter = uint; let distance = 1000:meters
[17:29:40] -rusti-                                                         ^
[17:29:40] -rusti- application terminated with error code 101
[17:29:53] <maik> rusti: type meter = uint; let distance : meters = 1000;
[17:29:53] -rusti- <anon>:5:43: 5:49 error: use of undeclared type name `meters`
[17:29:53] -rusti- <anon>:5          type meter = uint; let distance : meters = 1000;
[17:29:54] -rusti-                                                     ^~~~~~
[17:29:54] -rusti- error: aborting due to previous error
[17:29:54] -rusti- application terminated with error code 101
[17:29:59] <maik> rusti: type meter = uint; let distance : meter = 1000;
[17:29:59] -rusti- <anon>:5:32: 5:40 warning: unused variable: `distance` [-W unused-variable (default)]
[17:30:00] -rusti- <anon>:5          type meter = uint; let distance : meter = 1000;
[17:30:00] -rusti-                                          ^~~~~~~~
[17:30:00] -rusti- ()
[17:30:00] <toddaaro> graydon: you around? I have an infinite loop in rustc to debug
[17:30:05] *** Joins: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net)
[17:30:06] *** Joins: Guest (textual@34641662.FB4DE631.66C78B76.IP)
[17:30:24] <graydon> toddaaro: yes
[17:30:25] <graydon> what's up?
[17:30:26] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[17:30:35] <cmr> maik: typedefs aren't suitable, you'd want to use a newtype or something so the type system can catch mismatched unit errors
[17:30:38] <toddaaro> graydon: I've tried three machines with two user accounts, something about the Indiana University network makes rustc infinite loop at 100% cpu
[17:30:43] <toddaaro> graydon: when doing make check
[17:30:51] <toddaaro> and I have no idea how to debug this
[17:30:51] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Client exited)
[17:30:53] <graydon> toddaaro: which step?
[17:30:55] <cmr> maik: I don't think it's possible to have something as nice as F#'s system
[17:30:55] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[17:31:17] <toddaaro> the last thing it prints is...
[17:31:21] <graydon> it would help if you were able to narrow it down from "make check" to something more local. that tries to exercise every feature of every subsystem in our repository :)
[17:31:45] <toddaaro> a cp on stage2/lib/librustllvm.so
[17:32:05] *** Joins: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl)
[17:32:08] <graydon> first, run with RUST_THREADS=1 and do not pass any -j parameters to make check.
[17:32:11] <graydon> also run with VERBOES=1
[17:32:15] <graydon> VERBOSE=1
[17:32:34] <toddaaro> ok, what is that command that logs console?
[17:32:36] <graydon> this should reduce the possibility that you're seeing-the-wrong-thing due to log line interleaving
[17:32:48] <graydon> logs console?
[17:34:32] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[17:34:33] <toddaaro> ah, script
[17:34:39] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[17:34:40] <toddaaro> I'll have script dumps shortly
[17:34:58] <toddaaro> just a toggle that duplicates all console activity to a text file
[17:36:34] *** Joins: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net)
[17:37:11] <cmr> graydon: can you drop my weekly triage load to 15?
[17:38:53] <graydon> cmr: of course
[17:38:55] <toddaaro> hm, this is awkward
[17:39:04] <toddaaro> I can't figure out how to get the paste from terminal into firefox
[17:39:15] *** Joins: bent (chatzilla@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:39:19] <toddaaro> can't even get xclip to do it
[17:39:40] <sigma> dump it to file?
[17:39:41] <toddaaro> I might have to postpone this until I come in and have access to a mouse with middle click
[17:39:58] <toddaaro> sigma: I have it as a text file, I just can't get it into a paste buffer shared by firefox
[17:40:14] <sigma> can firefox not open text files? I havn't checked in a while
[17:40:49] <toddaaro> ah, so I can open it in firefox and use the menu copy
[17:40:51] <toddaaro> good idea
[17:41:00] <cmr> I don't know about xclip but with xsel it's just xsel -ib < file, then contrl-v as usual
[17:41:08] *** Quits: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net) (Connection reset by peer)
[17:41:19] *** Joins: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net)
[17:41:46] <toddaaro> graydon: pastebin.mozilla.com/2884089
[17:42:13] *** Quits: rovar_ (rovar@moz-203658CB.nycmny.fios.verizon.net) (No route to host)
[17:42:20] *** Joins: rovar_ (rovar@moz-203658CB.nycmny.fios.verizon.net)
[17:42:25] *** Joins: rovar__ (rovar@moz-203658CB.nycmny.fios.verizon.net)
[17:42:27] <Sergio965> Where is the Rust calling convention outlined?
[17:42:30] <toddaaro> graydon: hung for ~3m at that stage, no allocation going on that I can see
[17:42:37] <cmr> Sergio965: nowhere afaik
[17:42:41] *** Joins: Earnestly (earnest@B0BDF733.8FDE20A.5411983D.IP)
[17:42:45] <toddaaro> graydon: s/stage/spot damn vocabulary overlaop
[17:42:46] <olsonjeffery> graydon: ping
[17:42:47] <Sergio965> What is it?
[17:42:49] <cmr> Sergio965: we use llvm's cc
[17:42:53] <graydon> olsonjeffery: pong
[17:42:59] <cmr> or, ccc, iirc
[17:43:00] *** Quits: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net) (Ping timeout)
[17:43:27] <graydon> toddaaro: assuming you mean pastebin.mozilla.org?
[17:43:32] <Sergio965> Arguments on the stack in reverse order?
[17:43:36] <olsonjeffery> graydon: good news: file io is coming along great (but not done).. most of the low-level stuff is done, gotta wire it up to play nice w/ newrt etc.. but the hard work is done.. want to have a PR soon soon soon
[17:43:41] <toddaaro> graydon: oh, yea
[17:43:48] <olsonjeffery> bad news: a bunch of consts from fcntl.h are missing from libc::os::posix88
[17:43:57] <olsonjeffery> need those for args to open(2)
[17:44:02] <olsonjeffery> some are there
[17:44:03] <toddaaro> I type the urls as I can't figure out copy paste in that direction
[17:44:05] <olsonjeffery> enough to get 0600
[17:44:18] <toddaaro> I'm making another now with a make clean first so you have configure output
[17:44:38] <cmr> rusti: std::u8::from_str("1000")
[17:44:39] -rusti- Some(232)
[17:44:40] <graydon> toddaaro: ok. next step is to either attach to it with gdb and see what it's doing or run perf top and see what it's doing
[17:44:50] <graydon> olsonjeffery: which consts?
[17:44:55] <graydon> olsonjeffery: also \o/
[17:45:05] <olsonjeffery> O_**GRP and O_**OTH
[17:45:09] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[17:45:18] <olsonjeffery> so not S_IRGRP, i even
[17:45:23] <olsonjeffery> S_**GRP etc
[17:45:28] <olsonjeffery> so i can't get 0644
[17:45:33] <olsonjeffery> when creating a new file
[17:45:35] <graydon> I see
[17:45:42] <olsonjeffery> not a blocker
[17:45:46] <olsonjeffery> but definitely something we want to sort out soon
[17:45:49] <olsonjeffery> i can do 0600
[17:45:56] <olsonjeffery> i take it those consts are generated
[17:46:30] <graydon> somewhat. I think they've been done manually for the most recent additions.
[17:46:36] * olsonjeffery nods.
[17:46:45] *** Quits: maik (maik___@moz-B0F3393.dip0.t-ipconnect.de) (Ping timeout)
[17:46:47] <graydon> there is a helper over in src/etc/libc.c
[17:46:49] <olsonjeffery> i had zero luck finding the fcntl.h that actually holds the consts on my ubuntu install
[17:46:50] <toddaaro> graydon: pastebin.mozilla.org/2884101 is another machine, printed something slightly different
[17:47:01] <toddaaro> graydon: ok, what should I do in gdb to produce useful output?
[17:47:03] <graydon> that I was _going_ to use for such extractions, more commonly. but it hasn't been used as much as I wanted.
[17:47:25] <toddaaro> script should capture the full gdb session, so no need to deal with output piping
[17:47:49] <graydon> toddaaro: gdb --pid=<pid-of-your-spinning-rustc>
[17:48:05] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[17:48:25] <graydon> toddaaro: then just "back" to get a backtrace, and if it's the wrong thread then "thread 1" and "back", "thread 2" "back", etc. etc. until you find one that's clearly not blocked in a simple kernel sleep
[17:49:24] *** Quits: nielsle (nielsle@moz-5CE8ECCD.boa.fiberby.dk) (Quit: Ex-Chat)
[17:49:31] *** Joins: nielsle (nielsle@moz-5CE8ECCD.boa.fiberby.dk)
[17:50:01] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[17:50:06] *** Joins: fyolnish (fyolnish@moz-90CA7366.uqwimax.jp)
[17:50:16] <graydon> olsonjeffery: sorry, which _exact_ constants are you missing? no asterisks, the actual names of them. some are not portable, some are.
[17:50:58] <toddaaro> graydon: looks like one is stuck in an sse2 memset
[17:51:01] <toddaaro> graydon: posting now
[17:51:03] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[17:52:28] <toddaaro> graydon: pastebin.mozilla.org/2884115 for gdb
[17:53:09] <toddaaro> graydon: pastebin.mozilla.org/2884116 for configure output
[17:53:23] <graydon> olsonjeffery: oh yeah, I remember now. win32 has no definition for those since it doesn't have a group concept that maps directly to posix groups. so their emulation doesn't support that bit.
[17:53:47] <olsonjeffery> graydon: in order to reach a minimal amount of useful expressivity for new file permissions, we need (and are missing): S_IRGRP, S_IWGRP, S_IXGRP, S_IROTH, S_IWOTH, S_IXOTH are the most important
[17:53:55] *** Joins: mschifer1 (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:53:56] *** Quits: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[17:54:04] <olsonjeffery> graydon: hm. i wonder if libuv just drops those on the floor, then?
[17:54:16] <graydon> olsonjeffery: I am not sure what to do about it. I included the intersection of all platforms' posix interfaces there. I'm a little curious why you're calling open(2) at all though .. aren't you going through uv?
[17:54:36] <olsonjeffery> i believe uv.h says "we take unix flags for all uv_fs_open calls and translate to platform aprop. behind the scenes" or somesuch
[17:54:51] <olsonjeffery> uv_fs_open takes open(2) format flags and mode
[17:55:07] * olsonjeffery looks for citation
[17:55:09] <graydon> toddaaro: switch to the thread in question and get a backtrace. interrupting it in the middle of a memset isn't terribly informative.
[17:55:37] <graydon> interesting. weird. ok. hmm.
[17:55:46] <graydon> 1 sec, lemme see if the values themselves are posix-spec.
[17:56:01] <toddaaro> ha, I found a mailing list thread on gcc optimizing memset into an infinite loop
[17:56:58] <toddaaro> cygwin.com/ml/libc-alpha/2013-07/msg00304.html
[17:57:00] <graydon> also stop and restart it multiple times, you don't know for sure that it's sitting in memset, just that it was in memset when you stopped it
[17:57:20] <toddaaro> I did so twice in the first paste, have done it a few more times in another and always memset
[17:57:39] <graydon> backtrace?
[17:58:01] <toddaaro> it should be in the paste
[17:58:18] <toddaaro> it is a bit messy
[17:58:20] <graydon> oh I see, I skimmed to bottom
[17:58:46] <graydon> it's possible. which libc version do you have?
[17:58:59] <toddaaro> what is the way to tell?
[17:59:02] <olsonjeffery> graydon: this was in the uvbook (in the Filesystem chapster): "flags and mode are standard Unix flags. libuv takes care of converting to the appropriate Windows flags."
[17:59:14] <cmr> toddaaro: asking the package manager
[17:59:15] <olsonjeffery> so, yeah. curious what they do there.
[17:59:17] <graydon> "Standard unix flags", nice
[17:59:19] *** Quits: Kruppe (user@moz-4DDA8AB8.uwaterloo.ca) (Client exited)
[17:59:31] <graydon> let's look at their sources, shall we?
[17:59:49] <graydon> I mean, most of the things I see for interfacing with windows defines those _symbols_ as 0
[17:59:50] *** Joins: Kruppe (user@moz-4DDA8AB8.uwaterloo.ca)
[17:59:53] <graydon> but that won't get you what you want
[18:00:11] <graydon> if you want to actually convey the presence-of-that-permission-bit to libuv and have it convert it to something more meaningful
[18:00:16] <toddaaro> glibc is 2.12, gcc is 4.4.7-3 redhat
[18:00:23] <graydon> I assume uv is not calling the posix-emulation _open()-on-win32
[18:00:36] <graydon> toddaaro: I don't know
[18:00:44] <graydon> toddaaro: which version of rhel?
[18:00:48] *** Quits: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[18:00:55] <graydon> we can try bringing up a VM and checking there
[18:01:04] <graydon> (we should really have RHEL in the test cluster)
[18:01:54] <toddaaro> graydon: looks like RHEL 6.4 Santiago
[18:02:14] <graydon> olsonjeffery: https://github.com/joyent/libuv/blob/master/src/win/fs.c#L390 appears uv ignores those flags on windows?
[18:02:18] *** Quits: dave1629 (dave@CE6B7FA6.87CA334A.DDE5D3F6.IP) (Quit: dave1629)
[18:04:49] <toddaaro> graydon: I can also put in a support ticket for this if you think it would help
[18:05:14] <toddaaro> graydon: the main thing seems to be reproducing it, so perhaps we wait until after a RHEL vm tries
[18:05:29] <graydon> toddaaro: sure. sec.
[18:06:02] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Ping timeout)
[18:06:36] <olsonjeffery> graydon: looks that way. ill follow-up in #libuv.
[18:07:30] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[18:07:35] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[18:07:53] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[18:08:05] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[18:09:42] <graydon> olsonjeffery: it looks like even S_IRWXU and such are not "really" defined on win32, mingw just threw them in as defines to _S_IREAD | _S_IWRITE | S_IEXEC and such, the non-user/group/other permission bits that are supported.
[18:10:12] <graydon> olsonjeffery: I think if you want the symbolic constants for group and other you may as well add them set to 0. and maybe add a comment explaining the not-very-accurate mapping going on there.
[18:10:21] <graydon> olsonjeffery: it seems like what others do. :((
[18:11:40] <graydon> toddaaro: 32bit or 64bit?
[18:12:54] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[18:13:09] <olsonjeffery> graydon: is it safe to assume that the consts are matching on all unix platforms?
[18:13:16] <olsonjeffery> or do i need to dig up the headers for each..
[18:13:16] <toddaaro> graydon: 64 I believe
[18:13:36] <toddaaro> graydon: yep, 64
[18:14:03] <graydon> olsonjeffery: for the existing ones, I sniffed them on the platforms using src/etc/libc.c
[18:14:15] <graydon> toddaaro: launching vm
[18:16:54] *** Joins: maik (maik___@moz-B0F3393.dip0.t-ipconnect.de)
[18:17:44] <toddaaro> graydon: cool, I put up something on the issue tracker, #8621
[18:18:13] <maik> bjz_, is there an open issue that I can follow?
[18:19:18] <cmr> graydon: https://github.com/cmr/rust/blob/metrics/src/libextra/metrics.rs do you think that's an OK interface? I don't really like it, and the use of Either seems ugly
[18:19:34] <bjz_> maik: not that I know of
[18:19:53] <toddaaro> graydon: do you need anything from me in the next ~30m or so? seems like a nice pause to use to walk in
[18:20:07] <graydon> toddaaro: no, that's fine. I'll try to reproduce.
[18:20:09] <cmr> (it's also broken: can't have a method and associated function with the same name)
[18:20:10] <toddaaro> graydon: k
[18:20:13] <strcat> rusti: let mut xs = ~[1, 2, 3, 4]; for i in range(0, 100) { xs.push(i) } xs.capacity()
[18:20:13] -rusti- 128
[18:20:33] <bjz_> maik: nikko says he's working on it - a weird bug is making it crash
[18:20:52] <graydon> cmr: it's not really clear to me that the hierarchy has to literally manifest in terms of a tree data structure rather than a flat map that has hierarchical names. I guess there's a little data compression in the names this way, but it seems like it might not pay for itself?
[18:21:11] *** Joins: SingingBoyo (brandon@4DF3381A.51F4D838.4F048BDC.IP)
[18:21:23] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[18:21:55] <maik> bjz_, :(
[18:21:59] <bjz_> maik: https://botbot.me/mozilla/rust/msg/5296891/
[18:22:03] <cmr> graydon: I used a tree because I think having to standardize and parse a string format to get the structured information is gross
[18:22:41] <cmr> it does complicate API usage significantly, though
[18:22:43] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[18:22:43] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/ADgLpA
[18:22:43] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[18:23:27] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[18:24:18] <graydon> cmr: I guess. I was thinking it might be possible to associate metrics with the crate module-path they're in up to a point. just to make finding and naming them easier.
[18:25:55] <cmr> graydon: by what magic can you get the module path to use it?
[18:25:57] <cmr> that would be really nice
[18:26:39] <olsonjeffery> w/w 2
[18:27:03] <graydon> cmr: I guess that won't really work perfectly given the inexact match between that hierarchy and various other things you want to report, but it might help some. I'm sorta half considering this an experiment in growing such machinery so we have pieces lying around to reimplement log() with
[18:27:45] <kmc> any idea why module gfx::render_task would end up at servo::render_task in the crate log map as printed by RUST_LOG=?
[18:27:51] *** Joins: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP)
[18:28:00] <kmc> should I open a bug for this?
[18:28:28] *** Joins: nawfel (Mibbit@47CE1F3E.3872BE20.DFAB1F33.IP)
[18:29:36] <sully> acrichto: hey, you were pinging me about some bugs last week while I was out of town
[18:30:57] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[18:31:18] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Client exited)
[18:31:47] *** Joins: robertknight (robertknig@moz-731801B5.range86-144.btcentralplus.com)
[18:31:58] <acrichto> sully: I think so yeah, it was mainly things I saw related to traits I just wrote cc @msullivan, nothing major
[18:32:09] <graydon> cmr: I believe module_path!() gives you your module path
[18:32:16] <cmr> rusti: module_path!()
[18:32:17] -rusti- ""
[18:32:22] <graydon> cmr: though not as a static string
[18:32:25] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[18:32:25] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/24WaCg
[18:32:25] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[18:32:30] <graydon> it's a ~""
[18:32:31] <sully> ok, I can probably take a look at them, but don't know if I'll have time to fix
[18:32:36] <cmr> rusti: mod foo { fn foo() -> ~str { module_path!() } } foo::foo()
[18:32:37] -rusti- <anon>:5:57: 5:65 error: unresolved name `foo::foo`.
[18:32:37] -rusti- <anon>:5          mod foo { fn foo() -> ~str { module_path!() } } foo::foo()
[18:32:37] -rusti-                                                                   ^~~~~~~~
[18:32:37] -rusti- error: aborting due to previous error
[18:32:38] -rusti- application terminated with error code 101
[18:32:45] <graydon> or .. wait, no .. it's a literal
[18:32:47] <sully> due to various complications, I never really managed to dive into work on &traits
[18:32:53] <sully> and wound up doing some other things
[18:33:02] <cmr> rusti: pub mod foo { pub fn foo() -> ~str { module_path!() } } foo::foo()
[18:33:03] -rusti- <anon>:5:46: 5:62 error: mismatched types: expected `~str` but found `&'static str` (str storage differs: expected ~ but found &'static )
[18:33:03] -rusti- <anon>:5          pub mod foo { pub fn foo() -> ~str { module_path!() } } foo::foo()
[18:33:03] -rusti-                                                        ^~~~~~~~~~~~~~~~
[18:33:03] -rusti- error: aborting due to previous error
[18:33:04] -rusti- application terminated with error code 101
[18:33:05] <sully> fixing some match bugs, making objects work better with superclasses
[18:33:08] <acrichto> sully: yeah that's fine, I just figured I'd let you know, don't feel obliged or anything :)
[18:33:12] <cmr> rusti: pub mod foo { pub fn foo() -> &'static str { module_path!() } } foo::foo()
[18:33:12] -rusti- "foo"
[18:33:14] <graydon> rusti: mod foo { println(mofule_path!()) }
[18:33:14] -rusti- <anon>:5:19: 5:26 error: expected item but found `println`
[18:33:14] -rusti- <anon>:5          mod foo { println(mofule_path!()) }
[18:33:14] -rusti-                             ^~~~~~~
[18:33:15] -rusti- application terminated with error code 101
[18:33:18] <cmr> ok cool
[18:34:30] *** Quits: nawfel (Mibbit@47CE1F3E.3872BE20.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[18:34:36] <lkuper> sully: currently watching your default methods talk
[18:34:54] <sully> it's not that good of a talk, unfortunately
[18:35:11] <lkuper> heh.  the first few slides look like a repeat from last year
[18:35:13] <sully> or rather, the good part is basically recycled from my previous rust talks, and is very general
[18:35:23] * Ms2ger wonders if bblum will give an intern presentation next year that includes slide 4 of this year's
[18:35:24] <sully> I guess the rationale and examples behind default methods is ok
[18:35:34] <bblum> Ms2ger: That was my plan.
[18:35:44] <lkuper> sully: so far the only thing in the talk that's new to me is your facial hair style
[18:35:47] <strcat> sully: almost all of the iterator adaptors are default methods now :)
[18:35:57] <sully> but then I start talking about what was wrong and how I fixed it, and I couldn't figure out how to make that interesting
[18:36:01] <sully> lkuper: haha, yeah.
[18:36:05] *** Joins: miloshadzic (miloshadzi@5E9C7FE4.FA4D0618.449B8A48.IP)
[18:36:05] <strcat> in fact it probably makes sense to override `skip` for vectors
[18:36:25] *** Joins: nawfel (Mibbit@47CE1F3E.3872BE20.DFAB1F33.IP)
[18:36:56] <miloshadzic> what's the deal with this error? "invoking non-Rust fn in fn without #[fixed_stack_segment] [-D cstack (default)]"
[18:37:07] <graydon> cmr: so I thought something like a static MetricsGroup struct that one can declare with metrics_group!(foo) that expands to a group module_path!() + ".foo" and hands out sub-metrics prefixed by that name?
[18:37:10] *** Joins: vosen (vosen@moz-266BA656.icpnet.pl)
[18:37:19] *** Joins: robarnold (rob@BD56354E.DB510C09.6E370BFC.IP)
[18:37:40] <cmr> graydon: sounds good to me!
[18:37:46] <cmr> I think I'm going to drop the traits
[18:37:50] *** Quits: nawfel (Mibbit@47CE1F3E.3872BE20.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[18:37:59] <cmr> It's what go does but I don't think it makes much sense in rust, and complicates things a lot.
[18:38:05] <Sergio965> So it looks like every Rust functions takes in the address of a type descriptor.
[18:38:08] <Sergio965> Where can I read about this?
[18:38:14] <Sergio965> function*
[18:38:15] <strcat> Sergio965: it's obsolete cruft
[18:38:27] <strcat> it's the env pointer
[18:38:27] <graydon> cmr: though worth noting that most of these schemes (including things we'd report to) appear to like paths separated only by dots, not ::, so we should probably map the path to "." in the index.
[18:38:28] <Sergio965> Is that something that's gone in 0.8?
[18:38:35] <strcat> Sergio965: no but it's obsolete unused cruft
[18:38:36] <nmatsakis> strcat: not...obviously obsolete to me? 
[18:38:38] <strcat> it shouldn't be output
[18:38:39] <nmatsakis> it is used
[18:38:43] <strcat> nmatsakis: for closures?
[18:38:48] <nmatsakis> I presume you are referring to the environment?
[18:38:50] <nmatsakis> yes, for closures
[18:38:51] <strcat> it outputs it for non-closures
[18:38:56] <nmatsakis> yes
[18:38:56] <nmatsakis> and that is necessary
[18:39:04] <nmatsakis> if you want to be able to cheaply convert a non-closure to a closure
[18:39:05] <nmatsakis> (which we do)
[18:39:22] <nmatsakis> (rather, which we currently support)
[18:39:38] <nmatsakis> it should ohwever be the last argument
[18:39:43] <nmatsakis> in which case it becomes unnecessary, I gues
[18:39:46] <Sergio965> The first argument, right?
[18:39:52] <nmatsakis> it is currently the first arhument
[18:39:54] <nmatsakis> the environment
[18:40:01] <strcat> nmatsakis: with cdecl that's true, but I think with fastcc you can't necessarily ignore args
[18:40:02] <nmatsakis> it's not a type descriptor
[18:40:02] <Sergio965> Oh, you're saying it should be.
[18:40:12] <strcat> nmatsakis: fastcc doesn't support varargs
[18:40:18] <nmatsakis> strcat: so, I would keep the argument, but it's less imp't if it's the final one
[18:40:18] <strcat> hm
[18:40:24] <sfackler> miloshadzic: https://github.com/mozilla/rust/pull/8535
[18:40:36] <nmatsakis> strcat: that is, it is less likely to take up valuable argument passing registers etc
[18:40:52] <nmatsakis> strcat: alternatively, we could not permit converting from an arbitrary extern "Rust" fn to a closure
[18:40:57] <Ms2ger> Hmm, does rust have varargs?
[18:40:58] <strcat> nmatsakis: well, it probably depends on the calling convention
[18:41:07] <nmatsakis> strcat: "in all known calling conventions" then
[18:41:13] <lkuper> wow, this talk has multiple camera angles!  sophisticated!
[18:41:15] <cmr> nmatsakis: couldn't we emit stubs for using non-closures as closures?
[18:41:45] <nmatsakis> cmr: you can only do that if you are not calling an extern "Rust" fn by ptr,
[18:41:50] <nmatsakis> cmr: well, I guess you can have a single adapter,
[18:41:57] <nmatsakis> cmr: and pass the Rust fn as the "environment"
[18:42:04] <sfackler> Ms2ger: only via macros
[18:42:06] <Sergio965> Well, I'm glad I sparked up a conversation.
[18:42:06] <Sergio965> :)
[18:42:10] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[18:42:10] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/24WaCg
[18:42:10] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[18:42:10] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[18:42:10] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/kI6q0Q
[18:42:10] <ghrust> 13rust/06auto 146a451e4 15Alex Crichton: Upgrade llvm to current HEAD...
[18:42:10] <ghrust> 13rust/06auto 14d41ae5c 15Alex Crichton: Fix LLVM compilation issues and use the new attrs...
[18:42:11] <ghrust> 13rust/06auto 14fdc3fba 15bors: auto merge of #8328 : alexcrichton/rust/llvm-head, r=brson...
[18:42:13] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[18:42:26] <Sergio965> I just thought it was a bit odd and wasn't sure what the "hidden" first parameter was.
[18:42:28] <nmatsakis> cmr: (and of course if the expression references a known fn item, we can do better, by emitting two copies of that fn item)
[18:42:42] <Ms2ger> sfackler, ah. Is there interest in adding it?
[18:42:51] <nmatsakis> strcat: anyway, I think we can do better than what we do today in a variety of ways, but it's not complete cruft is my point :)
[18:42:53] <strcat> does LLVM's trampoline support require an executable stack?
[18:43:02] <strcat> I guess so
[18:43:04] <strcat> and we don't want that
[18:43:06] <Ms2ger> (That's one of the things C++ really isn't good at)
[18:43:21] <joelteon> i had a trampoline once
[18:43:26] <strcat> nmatsakis: I'm curious how std::function works in C++ without an executable heap
[18:43:35] *** Quits: maik (maik___@moz-B0F3393.dip0.t-ipconnect.de) (Ping timeout)
[18:43:36] <nmatsakis> Ms2ger: we may at least want to add it to the FFI...
[18:43:43] * strcat investigates
[18:44:37] <strcat> meh apparently it uses type erasure
[18:44:37] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[18:44:44] *** Quits: pcdummy (pcdummy@moz-CF4CA865.page4me.ch) (Ping timeout)
[18:44:49] <strcat> so it's a layer of indirection
[18:44:57] <sfackler> Ms2ger: dunno, but i've never found that foo(bar, baz, boz) is way better than foo(bar, [baz, boz])
[18:45:02] *** Joins: pcdummy (pcdummy@moz-CF4CA865.page4me.ch)
[18:45:32] <Ms2ger> Fair enough
[18:46:49] <miloshadzic> sfackler, thnx
[18:47:31] <strcat> nmatsakis: evil memory protection ruins everything :)
[18:48:16] <strcat> anyway this sounds awful
[18:48:19] <strcat> 'Note that the size and the alignment are target-specific - LLVM currently provides no portable way of determining them, so a front-end that generates this intrinsic needs to have some target-specific knowledge.'
[18:48:28] *** Quits: mihneadb (mihneadb@moz-BBE3ABD.mv.mozilla.com) (Input/output error)
[18:48:32] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[18:50:14] <nmatsakis> strcat: probably what we ought to do is to (1) move environment to last parameter; (2) for every fn item that is directly cast to a closure, generate a wrapper that takes a dummary parameter and calls the main one; (3) for those cases where a generic extern "Rust" fn is cast to a closure, use the fn ptr as the "environment" and generate "per-argument-types" wrappers that call the fn ptr found in the env 
[18:50:41] <nmatsakis> strcat: in this way, we'd avoid the extra argument and double dispatch in the vast majority of cases
[18:51:05] <cmr> but makes the generated code double in size?
[18:51:10] <nmatsakis> no
[18:51:11] <cmr> (for functions used as closures)
[18:51:19] *** Joins: josh (josh@moz-150E453B.tmodns.net)
[18:51:21] <nmatsakis> the wrapper fn would just call the original
[18:51:22] *** Quits: josh (josh@moz-150E453B.tmodns.net) (Quit: josh)
[18:51:39] <nmatsakis> so you'd generate foo(a,b,env) { return foo(a,b) }
[18:51:48] <nmatsakis> but this all assumes it's worth the trouble to avoid the exta arg in the 1st place
[18:51:55] <nmatsakis> I could believe it inhibits some optimizations or *something*
[18:51:58] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[18:52:11] <strcat> nmatsakis: I'm somewhat fond of what C++ does: every closure is a unique dynamically sized type, and if you want to pass them as a non-generic param you have to box them
[18:52:39] <strcat> so small functions taking closures can just do monomorphization with a generic function-like param
[18:52:46] <nmatsakis> yes, that's an interesting idea
[18:52:46] <lkuper> sully: do you have some writeup explaining what was wrong with method lookup before (i.e. if you had a default method that called a default method)?  I'm curious
[18:53:26] <sully> lkuper: it was really silly
[18:53:32] <sully> lkuper: there was a function for like
[18:53:43] <sully> lkuper: "lookup_function_by_name" and "lookup_function_by_name_or_default"
[18:53:56] <sully> lkuper: and we called the first one instead of the second most of the time
[18:53:57] <lkuper> heh, I remember that
[18:54:09] <sully> lkuper: now, there was no reason to *ever* call the first one instead of the second
[18:54:10] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[18:54:10] *** ChanServ sets mode: +o tjc
[18:54:25] <sully> lkuper: so I ditched it, and made it always do the default lookup
[18:54:58] <sully> lkuper: but the implementation of that was a bit silly; it would look through the ast definition of the impl for the method, then if it couldn't find it, look at a table containing the default methods used for each impl
[18:55:02] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[18:55:23] <sully> lkuper: I wound up making there be a table of all of the methods in an impl, provided or not
[18:55:26] <sully> lkuper: and always using that
[18:56:09] <lkuper> sully: that sounds reasonable!
[18:56:33] <sully> I did a lot of ragerefactoring of the data structures for the trait system and how they interacted with default methods
[18:56:41] <sully> there is still at least one table that I hate that still exists, though
[18:57:05] <flaper87> bblum: ping
[18:57:36] <bblum> flaper87: pong
[18:57:58] <bblum> flaper87: sorry i missed your ping last night; it was after midnight for me
[18:58:08] <lkuper> sully: for the cross-crate default method stuff, did you have to change how crate metadata worked?
[18:58:16] *** Quits: robertknight (robertknig@moz-731801B5.range86-144.btcentralplus.com) (Ping timeout)
[18:58:16] <flaper87> bblum: no worries, I thought so! That was more a hopeless ping :P
[18:58:24] <sully> lkuper: yeah.
[18:58:27] <lkuper> sully: *shudder*
[18:58:31] <toddaaro> graydon: vm do anything interesting yet?
[18:58:32] *** Quits: Houm (Houm@moz-25669AA8.fbx.proxad.net) (Ping timeout)
[18:58:37] <graydon> toddaaro: no, building
[18:58:41] <sully> lkuper: I tried to get away without it, but it didn't fly
[18:59:22] <flaper87> bblum: so, still related to yda's code. Once I changed the allow_kill assert w/ if + fail, it is now failing in another place (I think it's in the collect_failure) call on another assert: self.unkillable == 0
[18:59:30] <lkuper> sully: I'm really happy that default methods now work :)  thanks for bravely wading in
[18:59:45] <sully> lkuper: :)
[18:59:48] <cmr> sully: (mind ragerefactoring all of metadata now? :D)
[18:59:57] <sully> I feel like one of my biggest strengths as a programmer is fearlessness :P
[19:00:03] <flaper87> bblum: https://github.com/mozilla/rust/blob/master/src/libstd/rt/kill.rs#L488
[19:00:09] <sully> I'm still afraid of metadata though.
[19:00:23] *** Quits: mmmonk (mmmonk@moz-F145F0FF.xlshosting.net) (Quit: "")
[19:00:25] <sully> cmr: I did do some cleanup of metadata
[19:00:28] <bblum> flaper87: hm, ok, that assertion is checking to make sure that when a task has finished running all of its user code and is about to exit, that the unkillable counter is "back where it should be"
[19:00:28] <lkuper> sully: I think huge messes attract you
[19:00:28] <sully> cmr: not a lot, but
[19:00:51] <bblum> flaper87: my hunch is that means that when the task begins unwinding, somewhere the counters are not readjusted properly in the 'finally' blocks
[19:01:07] <nmatsakis> cmr: I had a branch that ported ty_encode/ty_decode to use #[deriving(Serializable)]....
[19:01:13] <nmatsakis> hopelessly bitrotted now, but it wasn't that hard to do
[19:01:17] <nmatsakis> I'm inclined to give it another try at some point
[19:01:18] *** Quits: huseby (huseby@moz-4E8C421A.husebyhome.com) (Quit: Leaving)
[19:01:22] <nmatsakis> granted that's only 50% of metadata
[19:01:41] <flaper87> bblum: right, the finally block should be called before collect_failure
[19:01:46] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[19:02:07] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[19:02:07] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14fdc3fba to 142246d56: 02http://git.io/N3iJvQ
[19:02:07] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[19:02:09] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[19:02:09] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/2oi9Fg
[19:02:09] <ghrust> 13rust/06auto 149bc3324 15Florian Zeitz: Add Unicode decomposition mappings to std::unicode
[19:02:09] <ghrust> 13rust/06auto 140cc772c 15Florian Zeitz: Add canonical combining class to std::unicode
[19:02:09] <ghrust> 13rust/06auto 14ce1ea30 15Florian Zeitz: Add support for performing NFD and NFKD on strings
[19:02:11] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[19:02:35] <flaper87> rekillable's finally block does call inhibit_kill, though
[19:02:38] <bblum> flaper87: try changing the assertion to actually print out what the mistaken value is, so we can get a better sense of which "direction" it's failing to readjust
[19:03:16] *** Quits: Sergio965 (sergiobz@moz-BB21156B.dynamic.csail.mit.edu) (Ping timeout)
[19:03:36] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[19:03:55] <Eridius> I didn't know you could put attributes inside a function (instad of just before)
[19:03:55] <bblum> haha yess my trait superkind metadata hack worked, and i don't actually have to change metadata stuff to properly fix it
[19:04:05] <toddaaro> r+ again someone? github.com/mozilla/rust/pull/8566
[19:04:14] <toddaaro> I was defeated by make tidy :/
[19:04:18] *** Joins: huseby (huseby@moz-4E8C421A.husebyhome.com)
[19:04:34] <nmatsakis> Eridius: I'm probably the only one who loves that feature. But I made heavy use of it since I felt like #[fixed_stack_segment]; is an impl detail and hence belongs with the body of the fn
[19:04:54] <ecr> why make? why would you wait until after doing the whole build process to tell me about clock skew? WHY!?
[19:04:59] <Eridius> nmatsakis: I suppose that makes sense. Do you consider #[inline(never)] an impl detail too?
[19:05:02] *** Quits: lmandel (lmandel@moz-BBE3ABD.mv.mozilla.com) (Quit: lmandel)
[19:05:07] * ecr flips table
[19:05:27] <sigma> just make being it's usual helpful self
[19:05:39] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[19:05:42] <nmatsakis> Eridius: I do
[19:06:02] <tjc> toddaaro: r+'ed
[19:06:15] <Eridius> nmatsakis: I take it #[inline(never)] is used because inlining something with #[fixed_stack_segment] is problematic? Maybe it should be implied by #[fixed_stack_segment]?
[19:06:21] *** Joins: mmmonk (mmmonk@moz-F145F0FF.xlshosting.net)
[19:06:44] <ecr> on the bright side of things, I'm going to start rebasing the thread-safe IO branch today. hopefully I can get that in soon.
[19:06:45] <Eridius> alternatively, maybe a function with #[fixed_stack_segment] should only be allowed to inline if its caller also has #[fixed_stack_segment], or something
[19:06:46] <nmatsakis> Eridius: I considered that, it's ... not quite that simple, in that I think one might want inlining. Ideally you'd only inline a fixed_stack_segment callee into a fixed_stack_segment caller
[19:07:45] <toddaaro> tjc: thanks
[19:07:57] <nmatsakis> Eridius: I thnk that'd be something pcwalton would be best equipped to do, since the integration of fixed_stack_sgement into LLVM was his doing,
[19:08:03] <toddaaro> I need to script my clean-whitespace script into my commit command
[19:08:05] <Eridius> ah
[19:08:27] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[19:08:41] *** Joins: lmandel (lmandel@moz-BBE3ABD.mv.mozilla.com)
[19:08:56] <nmatsakis> Eridius: in general I think the fixed_stack_Segment interface could probably use refinement, but that building on morestack seems like the correct way to handle the request for more stack spcae
[19:12:31] <strcat> nmatsakis: https://github.com/mozilla/rust/issues/8622 I guess it would really be about making DSTs movable
[19:12:58] <toddaaro> brson: I'm going to work on the async callback deduplication today, hopefully I'll have a PR by this evening
[19:13:09] *** Joins: eholk (eholk@moz-EA69C7A5.wavecable.com)
[19:13:15] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[19:13:30] <toddaaro> brson: it should be easy, and it will eliminate allocation on sleeper list pushing + homed task sending
[19:14:18] <nmatsakis> strcat: https://github.com/mozilla/rust/issues/8622#issuecomment-22896896
[19:14:27] <toddaaro> if the build infinite loop is worked out I can also start running benches on a 24 core machine
[19:14:40] <strcat> nmatsakis: ah, wasn't aware of that change to the plans
[19:15:52] <flaper87> bblum: it's 1
[19:16:09] <flaper87> bblum: which makes sense if the finally block is called before the collect_failure
[19:16:47] <bblum> flaper87: this is the test case i posted?
[19:18:05] <flaper87> bblum: correct
[19:18:51] <flaper87> bblum: according to: https://github.com/mozilla/rust/blob/master/src/libstd/rt/task.rs#L260
[19:18:53] <bblum> flaper87: try adding print statements to allow_kill and inhibit_kill to get a trace of what's happening
[19:19:14] <flaper87> the collect_failure is called after the finally block. (IIUC)
[19:19:17] <flaper87> bblum: will do
[19:19:26] <bblum> e.g., "error!("allow_kill: old value of unkillable = %u", self.unkillable);"
[19:19:43] <bblum> collect failure is called after all finally blocks
[19:20:10] <flaper87> bblum: doesn't that answer the question of why unkillable is 1 ?
[19:20:22] <flaper87> rekillable's finally calls inhibit_kill which increases the counter
[19:20:36] <SingingBoyo> have ~Traits been fixed?  looking through an old project I have a bunch of @Traits sitting around, wondering if I can get rid of them.
[19:20:40] <flaper87> then collect_failure is called with unkillable == 1
[19:20:51] <strcat> SingingBoyo: yes I think nmatsakis fixed the remaining known issues
[19:20:53] <strcat> most of them anyway
[19:21:12] <graydon> toddaaro: which stage?
[19:21:16] <bblum> flaper87: ...and there ought to be a surrounding unkillable block, which has its own finally which will call allow_kill which will decrease it back to zero
[19:21:26] <bblum> flaper87: you have to consider the entire program :P
[19:21:37] <strcat> &Trait probably still has the lifetime issues
[19:21:43] <toddaaro> graydon: for the infinite loop?
[19:21:48] <flaper87> bblum: ahhhh wait, you said *all* blcoks, not each one of them
[19:21:50] <graydon> toddaaro: yes
[19:21:51] <toddaaro> graydon: it seems to happen on stage0
[19:21:51] <flaper87> (facepalm) 
[19:21:53] <flaper87> :D
[19:22:15] <graydon> toddaaro: yeah, this VM is happy to build through stage2. not quite done yet but it's not ilooping
[19:22:20] <bblum> nmatsakis: ping
[19:22:22] <toddaaro> graydon: graydon hmm
[19:22:35] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Ping timeout)
[19:22:44] <toddaaro> graydon: when I ran make check it did seem to get kinda far and not iloop near stage0
[19:22:45] <nmatsakis> bblum: pong (I was just about to ping you)
[19:23:04] <graydon> toddaaro: ah lemme try make check specifically, not just make
[19:23:17] *** Joins: Sergio965 (sergiobz@C09894A.4A349BD6.3A99D594.IP)
[19:23:17] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[19:23:24] <nmatsakis> bblum: in specific, I was wondering why #8562 seemed to have the same commits twice
[19:24:26] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[19:24:31] <bblum> nmatsakis: you caught it in a auto-refresh as i was rebasing
[19:24:38] <bblum> if you refresh it should only show the latest
[19:24:43] <bblum> i added a cross-crate test case
[19:24:59] <nmatsakis> ok
[19:25:00] <bblum> nmatsakis: anyway, my ping is that #8562 is ready to go :P
[19:25:03] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[19:25:32] <nmatsakis> bblum: ok, reading now :)
[19:25:39] <bblum> thanks!
[19:25:39] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[19:25:47] *** Quits: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net) (Input/output error)
[19:25:56] *** Joins: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP)
[19:26:14] <nmatsakis> does anyone know the status of debug support? I recall there is someone working on it (Google SoC?) but not the name of that person :)
[19:26:19] <tjc> brson: ping
[19:26:46] <cmr> nmatsakis: michaelwoerister
[19:27:18] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[19:27:18] <nmatsakis> cmr: that's the IRC nick?
[19:27:27] <cmr> irc nick is mw, but he's infrequently online
[19:27:35] <nmatsakis> ok, thanks
[19:27:43] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[19:28:31] <strcat> nmatsakis: I'm pretty sure it's quite mature now and even handles (all?) enum layouts
[19:28:33] <toddaaro> graydon: ok, if you can't reproduce on the VM I'll start up a soic help ticket. Will keep you on the thread and point it towards the issue tracker issue to start.
[19:28:41] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Ping timeout)
[19:28:42] <nmatsakis> strcat: nifty. Can't wait.
[19:28:43] <cmr> mature, but not robust.
[19:28:46] *** Joins: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net)
[19:28:54] <cmr> he's been doing lots of great work though
[19:28:58] <strcat> I usually find gdb more frustrating than staring at asm so I haven't tried it out
[19:29:09] <toddaaro> graydon: it would be *really* nice if you could just get a soic login to reproduce there, but I'm almost certain that is impossible
[19:29:23] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Ping timeout)
[19:30:05] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[19:30:30] <graydon> toddaaro: yeah, it's churning through make check here on a 6.4 rhel machine, no problem
[19:30:39] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[19:30:40] <tjc> cmr: I see you commented on https://github.com/mozilla/rust/issues/2774 -- can you explain to me what the issue is? It seems no longer relevant to me, but maybe I don't understand
[19:30:50] <strcat> graydon: https://github.com/mozilla/rust/pull/8582 r? added a comment with rationale on why it's useful
[19:30:52] <strcat> although
[19:30:58] <tjc> (an yes, I don't know what it means even though it's assigned to meâ€¦ :P)
[19:31:04] <strcat> if we had function for turning an element into an iterator with that element
[19:31:30] <strcat> you could just .chain(range(start, stop.clone()), to_iterator(stop))
[19:31:37] <engla> strcat: option iterator
[19:31:54] <strcat> true, Some(element).move_iter()
[19:31:54] <engla> rusti: Some(1).move_iter()
[19:31:55] -rusti- {opt: Some(1)}
[19:32:06] <graydon> strcat: which old range functions?
[19:32:17] <strcat> graydon: uint::range_step/uint::range_step_inclusive
[19:32:17] <cmr> tjc: in a few minutes, busy atm
[19:32:21] *** Quits: eholk (eholk@moz-EA69C7A5.wavecable.com) (Quit: eholk)
[19:32:22] <graydon> strcat: ah
[19:32:24] <tjc> cmr: no hurry
[19:32:24] <strcat> graydon: well, they're generated from macros for every int module
[19:32:44] <strcat> writing a generic range_step that's correct in all cases is tricky
[19:33:00] <strcat> that's actually why I added those checked overflow intrinsics/traits
[19:33:06] <strcat> needed a sane way of writing range_step ;p
[19:33:08] <graydon> r+ then, take your word for it
[19:33:19] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[19:34:44] <strcat> rusti: range(0, 10).chain(Some(5).move_iter())
[19:34:45] -rusti- {a: {state: 0, stop: 10, one: 1}, b: {opt: Some(5)}, flag: false}
[19:34:54] <strcat> rusti: range(0, 10).chain(Some(10).move_iter()).to_owned_vec()
[19:34:55] -rusti- ~[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
[19:35:47] <strcat> rusti: range(0, 10).chain(Some(10).move_iter()).clone()
[19:35:48] -rusti- <anon>:5:9: 6:5 error: failed to find an implementation of trait std::clone::Clone for std::option::OptionIterator<int>
[19:35:48] -rusti- <anon>:5          range(0, 10).chain(Some(10).move_iter()).clone()
[19:35:48] -rusti- <anon>:6     };
[19:35:48] -rusti- application terminated with error code 101
[19:36:12] <engla> :-| that's an oversight
[19:36:24] <strcat> graydon: going to add 1 more commit adding Clone to OptionIterator
[19:36:27] <olsonjeffery> so i ended up writing a notify-send wrapper that runs when a build is complete to notify me. i suppose its my fault for having such a short attention span. but who wants to stare at a build for ~8-9 minutes?
[19:36:33] <strcat> just derived
[19:36:43] <brson> toddaaro: ok
[19:36:46] <tjc> olsonjeffery: Ooh, can you share your code?
[19:36:47] <brson> tjc: pong
[19:36:50] <tjc> I also have no attention span
[19:37:00] <tjc> brson: I was looking at https://github.com/mozilla/rust/issues/2774
[19:37:04] <tjc> and trying to remember what it was about
[19:37:25] *** Joins: valenting (Thunderbir@8758046C.84D5EFD5.FB866788.IP)
[19:37:47] <olsonjeffery> tjc: this is for ubuntu...
[19:37:56] <olsonjeffery> put this in a script in ~/bin and chmod +x'd it: `notify-send 'BUILD COMPLETE' 'go see!' --icon=dialog-information --urgency=critical`
[19:38:09] <strcat> I'll look into how range_step compiles vs. chain + option's move_iter later and replace the implementation if it's fine
[19:38:10] <olsonjeffery> and then did `make check-blah-blah;build-done-notifier`
[19:38:11] <tjc> olsonjeffery: ah, never mind, I use a Mac
[19:38:13] <brson> tjc: I guess that it puts parens around `(do foo { })`
[19:38:25] <tjc> I'm sure OS X has something like that but I don't know what it is
[19:38:27] <brson> this is another reminder that I should document issues better
[19:38:29] <olsonjeffery> tjc: i would say find a growl client?
[19:38:33] <bblum> http://cdn.memegenerator.net/instances/400x/37243800.jpg
[19:38:34] <tjc> brson: ah, ok. I don't think it does that anymore, but I'll double check
[19:38:35] *** Quits: nsf (nsf@moz-EEF3238A.convex.ru) (Quit: WeeChat 0.4.1)
[19:38:39] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Client exited)
[19:38:40] <cmr> tjc: do foo { ... } is turned into (do foo { ... }) by the pretty printer
[19:38:50] <strcat> range_step vs range_step_inclusive is not as easy as that
[19:39:05] <olsonjeffery> tjc: it seems you can use the `growl` cmd from the terminal
[19:39:16] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[19:39:26] *** Quits: Ms2ger (Ms2ger@59A8FC80.80FA5708.187A1082.IP) (Quit: nn)
[19:40:28] <strcat> olsonjeffery: I think growl is third party though?
[19:40:37] * strcat shrugs
[19:40:41] <olsonjeffery> growl is the defacto notifier lib for osx
[19:41:02] <tjc> cmr: I don't think the pretty printer does that anymore -- can you point to where it does?
[19:41:10] <Eridius> OS X has built-in notifications now
[19:41:17] <cmr> tjc: the tests mentioned by the issue do
[19:41:19] <Eridius> not sure if there's a way to fire one from the CLI though
[19:41:23] <strcat> olsonjeffery: not free as in beer :P
[19:41:24] <cmr> I don't know if they're actually run anymore..
[19:41:40] <strcat> or freedom
[19:41:49] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[19:41:51] <jack> tjc, Eridius, olsonjeffery: http://osxdaily.com/2012/08/03/send-an-alert-to-notification-center-from-the-command-line-in-os-x/
[19:42:02] <olsonjeffery> https://github.com/alloy/terminal-notifier
[19:42:20] <Eridius> jack: cute
[19:42:21] <strcat> reminds me that I was going to try writing dbus bindings for rust
[19:42:21] <olsonjeffery> anyways. filed under "marginal productivity improvements"
[19:42:22] <tjc> jack: cool, thanks
[19:42:23] <tjc> heh
[19:42:31] <strcat> dbus has the most ridiculous API I've ever seen though
[19:42:44] <strcat> you manually specify variant types as strings
[19:42:50] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[19:42:50] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1461d7aa5 to 142246d56: 02http://git.io/N3iJvQ
[19:42:50] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[19:42:53] <jack> i often run builds in Emacs, and since I IRC in emacs too, i can see the mode line update. that helps quite a bit too.
[19:42:55] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[19:42:55] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/nWMZPA
[19:42:55] <ghrust> 13rust/06auto 14b244911 15Daniel Micay: num: implement CheckedDiv
[19:42:55] <ghrust> 13rust/06auto 144bdceb9 15bors: auto merge of #8459 : thestinger/rust/checked, r=graydon
[19:42:55] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[19:43:03] <cmr> strcat: you don't like stringly typed interfaces? :p
[19:43:27] <bblum> stringly
[19:43:30] <strcat> recursive data structures with string "type signatures" are not fun
[19:43:32] *** Quits: b (b@moz-55CA322E.org) (Ping timeout)
[19:43:36] <strcat> well not even recursive
[19:43:39] <strcat> just a few layers deep
[19:43:49] *** Joins: b (b@moz-55CA322E.org)
[19:43:54] *** Joins: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com)
[19:43:58] <strcat> but you can make them recursive because "v" is a generic variant
[19:44:12] <strcat> ssasa(sv)
[19:44:18] <tjc> cmr: looks like the pretty printer doesn't add any parens in those two cases. I think when I added expr_paren, I got rid of all the cases where the pp inserts parens
[19:44:21] <strcat> well, (ssasa(sv))
[19:44:35] <strcat> is a function taking 'string, string, [string], [(string, variant)]'
[19:44:45] *** Joins: sankha94 (Instantbir@7061CD01.D6BD0D91.22D41759.IP)
[19:44:47] <strcat> most are about that complicated or worse
[19:45:00] <strcat> takes ~50 lines to unpack them in C
[19:45:18] <ecr> looks like JVM method sigs
[19:45:21] *** sankha94 is now known as sankha93_
[19:45:24] *** Quits: Sergio965 (sergiobz@C09894A.4A349BD6.3A99D594.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[19:45:56] <strcat> until systemd exposes a C interface for cgroups, you're going to have to use dbus for them now :(
[19:46:38] <strcat> the systemd API is actually really nice, but you have to go through horrible dbus to get to it
[19:46:41] * strcat sighs
[19:46:45] <SingingBoyo> Is there a math module for things like max/min/abs etc?
[19:46:58] <SingingBoyo> guessing I'm just missing something obvious but I can't find it
[19:47:03] <cmr> std::num
[19:47:16] <cmr> rusti: (-5i).abs()
[19:47:18] -rusti- 5
[19:47:26] <cmr> rusti: 5.min(&2)
[19:47:29] -rusti- pastebinned 35 lines of output: http://ix.io/7pn
[19:47:35] <engla> that reminds me, std::cmp:max and std::num::max are basically the same
[19:47:37] <cmr> rusti: 5i.min(&2)
[19:47:38] -rusti- 2
[19:48:16] <strcat> ecr: http://dbus.freedesktop.org/doc/api/html/ also, look at this wonderful endorsement of itself
[19:48:22] <strcat> "If you use this low-level API directly, you're signing up for some pain."
[19:48:50] <strcat> the alternative is depending on qt/gtk
[19:48:59] <strcat> and it's not much better
[19:49:03] <brson> i just accepted the tuesday rust meeting, after 2 years
[19:49:13] <tjc> haha
[19:49:19] <tjc> I don't think I ever accepted the Tuesday rust meeting
[19:49:20] <tjc> into my heart
[19:49:26] <brson> lol
[19:49:43] * strcat starts on rust-dbus :P
[19:50:14] <ecr> strcat: I've always wanted to put "Abandon all hope ye who enter here" at the top of a module doc somewhere.
[19:50:44] <cmr> std::reflect would be a good candidate for that
[19:50:44] <toddaaro> ecr: the segmented stack code will likely end up an ideal spot
[19:50:50] <toddaaro> ohh that too
[19:51:03] <cmr> *that* is an arcane hunk of code
[19:51:39] <strcat> one day I'll figure out how to make it understand the top-level @ type
[19:51:40] <ecr> I was thinking the runtime as a whole
[19:51:53] <strcat> rusti: (@mut 5, 5)
[19:51:54] -rusti- (@mut 5, 5)
[19:51:59] <strcat> rusti: @mut 5
[19:52:00] -rusti- @5
[19:52:01] <strcat> whyyy
[19:52:09] <nmatsakis> bblum: this PR isn't intended to be the final word, right? 
[19:52:21] <nmatsakis> strcat: mutability info is erased at runtime
[19:52:29] <nmatsakis> strcat: well, ok, that's not true :) we have the type descriptor
[19:52:34] <bblum> nmatsakis: nope, there's still "capabilities" (as shown in the initial description); this is the "restrictions"
[19:52:45] <nmatsakis> bblum: ok cool
[19:52:52] <strcat> nmatsakis: afaik it walks it via the tydesc though
[19:52:54] <strcat> visit glue
[19:53:03] <nmatsakis> yes I know, it has the info it needs
[19:53:05] <nmatsakis> I take it back
[19:53:10] <strcat> nmatsakis: the issue is that the top-level type isn't a managed box, it's an opaque box
[19:53:14] <strcat> but... I don't understand why
[19:53:23] * strcat doesn't know why we even have opaque boxes as a thing
[19:53:31] *** Joins: mihneadb (mihneadb@moz-BBE3ABD.mv.mozilla.com)
[19:53:37] *** Quits: mihneadb (mihneadb@moz-BBE3ABD.mv.mozilla.com) (Input/output error)
[19:53:38] <tjc> bblum: is there anything left to do on https://github.com/mozilla/rust/issues/4292 ? I see the constructors have now been changed
[19:53:40] <toddaaro> strcat: what is an opaque box?
[19:53:43] *** Joins: mihneadb (mihneadb@moz-BBE3ABD.mv.mozilla.com)
[19:53:58] <strcat> toddaaro: @mut and @ both become opaque boxes if they are a top-level node
[19:54:06] <strcat> something to do with monomorphization
[19:54:11] <toddaaro> ok, something I'm never going to learn about
[19:54:12] <nmatsakis> strcat: I wonder that sometimes. =) I am not sure it serves a real role
[19:54:14] <strcat> I have no more understanding of it than that
[19:54:21] <toddaaro> I think if I type the @ character this summer I'll be disappeared
[19:54:56] *** Quits: nano (nano@moz-74CAD1CA.superkabel.de) (Connection reset by peer)
[19:55:08] <strcat> rusti: struct Foo { x: @mut int } Foo { x: @mut 5 }
[19:55:09] -rusti- {x: @mut 5}
[19:55:17] <bblum> tjc: likely not; just look at libextra/arc.rs and use your judgement
[19:55:18] <strcat> rusti: struct Foo<T> { x: @mut T } Foo { x: @mut 5 }
[19:55:19] -rusti- {x: @mut 5}
[19:55:22] *** Joins: echristo (echristo@DCF57675.D6CCE4AE.77834EAA.IP)
[19:55:38] <strcat> so.... it's only top-level types in generic functions I guess
[19:55:42] <nmatsakis> bblum: r+ (with minor comments on https://github.com/bblum/rust/commit/638250510282d0e707f4b22e6ae0324ab5f355ec#commitcomment-3893279 that can be addressed later)
[19:55:47] <tjc> bblum: OK, thanks
[19:56:03] <bblum> nmatsakis: will do, thank you
[19:56:10] *** Quits: miloshadzic (miloshadzi@5E9C7FE4.FA4D0618.449B8A48.IP) (Quit: Textual IRC Client: www.textualapp.com)
[19:56:40] <strcat> nmatsakis: maybe I should try deleting that code to see what happens
[19:57:06] <nmatsakis> strcat: usually a good way to figure out what role something serves
[19:59:17] *** Joins: Sergio965 (sergiobz@moz-8D70E596.wireless.csail.mit.edu)
[19:59:53] <myname> are there by chance any plans on implementing something haskellish in terms of "a function with n parameters is really just a function with 1 parameter that returns a function with n-1 parameters"?
[20:00:20] <tjc> myname: that's called "currying", and no, there aren't any plans for that
[20:00:32] <toddaaro> can I make a macro that expands into a return, and have the return "return" from the right place?
[20:00:34] <tjc> myname: we used to have a "bind" construct that was actually a generalization of currying, but it got removed
[20:00:44] <myname> why that?
[20:00:57] <toddaaro> want to have a wrapper that does stuff before returning, but I can't exactly put it in a function
[20:01:05] <tjc> I don't remember why bind got removed, but in general, currying requires effort to implement efficiently
[20:01:09] * toddaaro longs for return return;
[20:01:11] <strcat> oh wow this is going to be a huge pain
[20:01:12] <tjc> and it's not particularly idiomatic for systems programmers
[20:01:14] <pauls> toddaaro: `return <expr>` is a statement, so yes. (macros can be statements, items, or expressions)
[20:01:17] <strcat> it has to be integrated into rust's event loop
[20:01:23] <cmr> myname: you can use closures to do it.
[20:01:25] <strcat> well, "has to"
[20:01:26] <toddaaro> pauls: cool
[20:01:48] <myname> cmr: well yes, i may do that on my own functions
[20:02:21] <cmr> (and I don't see why you would, I've never quite understood the utility of currying)
[20:02:34] <tjc> cmr: it's more useful in a lazy language, IMO
[20:02:43] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[20:03:05] <myname> good point
[20:03:06] <strcat> brson: do you think it will be possible to use rust's event loop for something like dbus? it hands you sockets to watch
[20:03:13] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[20:03:25] <strcat> just file descriptors
[20:03:43] <flaper87> bblum: http://pastebin.mozilla.org/2884621 Looks like unkillable's allow_kill hasn't been called when collect_failure is called
[20:04:23] *** Joins: int3_ (int3_@moz-15FB2963.hfc.comcastbusiness.net)
[20:04:23] *** Joins: BitPuffin_ (quassel@moz-8370D1B9.bredband.comhem.se)
[20:04:26] <brson> strcat: probably, yes
[20:04:38] <bblum> flaper87: can you figure out why?
[20:04:42] <cmr> graydon: after https://github.com/mozilla/rust/pull/8596 lands could you experiment with using a full make check on windows buildbots? I'm interested to see how slow it actually is, and whether it's slower than valgrind (if not, it seems to make sense to enable it, wouldn't slow down cycle time)
[20:05:02] <kmc> if I have enum Foo { Bar(int), Baz(~str) } is there a generic way to get something like an enum representing just which constructor was used, e.g. enum FooClass { BarClass, BazClass }
[20:05:15] <graydon> cmr: possibly. not top of list right now, but I saw it and am considering it.
[20:05:17] <flaper87> bblum: sure, just wanted to keep you updated. I'll gdb that thing
[20:05:20] <graydon> top of list right now is fighting cycle time.
[20:05:22] <bblum> good :)
[20:05:31] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[20:05:44] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Ping timeout)
[20:05:55] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[20:06:06] <cmr> The biggest win for the testsuite is going to be a metadata rework, I'm pretty sure
[20:06:11] <brson> where is the weekly status update site?
[20:06:27] <nmatsakis> brson: http://benjamin.smedbergs.us/weekly-updates.fcgi/
[20:06:33] <brson> thanks
[20:07:19] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[20:07:32] *** Joins: jgilbert (jgilbert@moz-7B0110AD.mv.mozilla.com)
[20:07:37] <SingingBoyo> if you have Trait A and Struct B and C implement A, is it possible to pattern match on a ~A to get back to B or C?  Or should I be using an enum?
[20:08:17] <cmr> SingingBoyo: you should be using an enum
[20:08:37] <cmr> Destructuring the contents of a trait object would be interesting, but I don't know if there's enough informatino at runtime to do that
[20:08:41] <tjc> SingingBoyo: No, because you might be using a library that could give you a ~A whose concrete type is some other type D or E that's defined in that library
[20:08:54] <cmr> tjc: right, so you'd need a _ case
[20:08:59] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Ping timeout)
[20:09:03] <cmr> I think the generated code would just boil down to an enum
[20:09:11] <tjc> cmr: I think it wouldn't be very useful; the whole point of using trait objects is that you only care that the elements in some data structure implement some trait
[20:09:12] <strcat> a slower enum ;p
[20:09:15] *** Quits: jgilbert (jgilbert@moz-7B0110AD.mv.mozilla.com) (Ping timeout)
[20:09:17] <cmr> (since the match can never be exhaustive)
[20:09:20] *** Quits: Palmik (palmik@moz-CC484FDD.tmcz.cz) (Quit: Lost terminal)
[20:09:20] <tjc> if you cared about something else, you should use an enum (like you suggested :-)
[20:09:44] <SingingBoyo> I think my problem is I think of traits like scala traits which are basically java interfaces
[20:10:01] <nmatsakis> (it might someday be useful to permit downcasting from traits)
[20:10:04] <olsonjeffery> getting this in one module, but not another: error: type `&'static str` does not implement any method in scope named `as_bytes`
[20:10:07] *** Joins: vadimcn (chatzilla@A2267643.76F9E272.DA40C4B3.IP)
[20:10:07] <olsonjeffery> all things being equal..
[20:10:12] <toddaaro> self call optimization is working right now? correct?
[20:10:13] <olsonjeffery> the values are declared identically in both cases..
[20:10:18] <strcat> toddaaro: yes
[20:10:21] <strcat> sibling call optimization
[20:10:25] <toddaaro> strcat: awesome, thanks for the confirmation
[20:10:28] *** Joins: jgilbert (jgilbert@moz-7B0110AD.mv.mozilla.com)
[20:10:29] <strcat> as long as the signatures of all the mutually recursive functions are the same
[20:10:31] <nmatsakis> olsonjeffery: did you import the relevant trait? though that sounds like a prelude trait
[20:10:44] <olsonjeffery> yeah. also doing use str;
[20:10:45] <ecr> strcat: it's possible to mix libuv and other event loops. the libuv has a section on it. not sure how much reworking would be involved though.
[20:10:46] <kmc> that kind of pattern matching would be a bit like dynamic_cast
[20:11:02] <cmr> SingingBoyo: traits objects are very similar to java interfaces, but you can't cast it around
[20:11:03] <toddaaro> strcat: it works in the case where I call f g d i d w d e z and then a new f right?
[20:11:08] <toddaaro> so peak stack would be to z
[20:11:09] <strcat> ecr: dbus itself doesn't actually have an event loop, qt/glib provide that for it
[20:11:22] <strcat> so it's designed to be integrated into arbitrary ones
[20:11:33] <ecr> hm
[20:11:41] <strcat> ecr: http://dbus.freedesktop.org/doc/api/html/group__DBusWatch.html it has this
[20:11:47] <ecr> it just gives you sockets (unix domain sockets I assume) right?
[20:11:54] <strcat> yeah
[20:12:04] <ecr> let me think about that
[20:12:37] <olsonjeffery> nmatsakis: so importing the trait worked, thanks. still weird that it's doing that.
[20:12:38] <strcat> in fact I think you actually register your handlers with dbus itself and the event loop only has to notify the dbus library of events
[20:12:48] <strcat> so that seems pretty feasible
[20:12:54] <SingingBoyo> yeah.  gotta use enums for 'casting' via pattern matching... so now I have to figure out modularization when I'm going to have at least 7 enum types with conversion to/from json... blah.
[20:13:19] <strcat> toddaaro: it should work, yeah
[20:13:24] <cmr> SingingBoyo: you shouldn't be using trait objects if you care about the concrete representation
[20:13:59] <strcat> toddaaro: when they have different signatures, it requires using fastcc as the calling convention + the tailcailopt switch and doesn't work on all archs, or even cross-library
[20:13:59] <ecr> strcat: I think you'd do something like this: http://nikhilm.github.io/uvbook/utilities.html#external-i-o-with-polling
[20:14:15] <cmr> Trait objects are "I care about this interface and nothing else"
[20:14:36] <strcat> toddaaro: there's a fun LLVM bug where it will optimize out an infinite loop if the loop is done with recursion
[20:14:50] * strcat always runs into it while testing stuff like this
[20:15:23] <SingingBoyo> cmr:  yeah, so I've discovered.  well, now I know.
[20:15:28] <toddaaro> strcat: this reminds me of the story about the program that will halt if fermat triples are real
[20:15:40] <toddaaro> strcat: it halts immediately because the compiler didn't view nontermination as an effect
[20:15:46] <strcat> toddaaro: C++11 explicitly allows optimizing out infinite loops
[20:15:51] <strcat> neither gcc/clang does it (yet)
[20:15:58] <strcat> (no-op infinite loops)
[20:16:06] <toddaaro> that is kinda trolling for the newbies
[20:16:09] <strcat> and it's the main reason why signed int overflow is undef in C
[20:16:21] <strcat> because they know any loop incrementing a signed int must terminate
[20:16:29] <ecr> brson: I'm going to start rebasing the homing IO branch against master. We'll see how it goes.
[20:16:44] <olsonjeffery> ecr: uh oh.
[20:16:47] <strcat> toddaaro: well, the C signed int rules are great trolling :P
[20:16:48] * olsonjeffery races to make PR
[20:16:49] <olsonjeffery> heh
[20:16:50] <kmc> the GHC runtime will detect some infinite loops and raise an exception :)
[20:16:54] <strcat> toddaaro: once compilers get smarter
[20:17:02] <sfackler> strcat: there is a specific exception for no-op infinite loops with a constant expression as the test iirc
[20:17:24] <ecr> olsonjeffery: is this file IO or async IO?
[20:17:30] <olsonjeffery> ecr: the former
[20:17:45] <olsonjeffery> and i doubt ill have a PR immediately :)
[20:17:56] <olsonjeffery> but im pretty close.. tidying uvio stuff, then on to rt::io::file
[20:18:07] <olsonjeffery> going from the bottom up
[20:18:13] <strcat> toddaaro: like, 'bool is_odd(int x) { x + INT_MAX; return x & 1; }' is allowed to always return 'false'
[20:18:23] <strcat> well
[20:18:26] <strcat> bad example
[20:18:28] <strcat> ;p
[20:18:35] <strcat> abs(x) + INT_MAX
[20:18:50] <strcat> but abs(x) is already undefined on INT_MIN anyway
[20:18:54] *** Quits: SingingBoyo (brandon@4DF3381A.51F4D838.4F048BDC.IP) (Input/output error)
[20:18:58] <strcat> so many holes to fall into
[20:19:12] <ecr> olsonjeffery: it shouldn't be too hard to deal with then. basically: every IO handle at the uvio level needs to keep a SchedHandle to the eventloop it was created on. You implement the HomingIO trait, which just requires an accessor to that handle, and then you wrap all your IO actions in this default method on HomingIO that takes care of moving you to the right scheduler.
[20:19:34] <strcat> rusti: int::min_value / -1
[20:19:35] -rusti- pastebinned 11 lines of output: http://ix.io/7pr
[20:19:44] <strcat> rusti: std::int::min_value / -1
[20:19:44] -rusti- -9223372036854775808
[20:19:48] <strcat> still need to fix that
[20:20:03] <engla> int add(int x) { x + 1 }  well this is UB if x is INT_MAX
[20:20:03] <ecr> olsonjeffery: I'm not sure if it's really going to work for async stuff though, but I have an idea of how to do that too.
[20:20:07] <olsonjeffery> ecr: oh, wow. good times.
[20:20:10] * olsonjeffery races faster ;)
[20:20:20] <olsonjeffery> ecr: we pretty much decided to punt on async, for now
[20:20:24] <olsonjeffery> concentrate on good sync io
[20:20:24] <engla> oh forgot return :-)
[20:20:26] <strcat> engla: yep, but it means the compiler can do a lot of inference from there
[20:20:34] <olsonjeffery> if you must have async.. just do it in a future, i guess
[20:20:44] <ecr> olsonjeffery: makes sense.
[20:21:03] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[20:21:09] <strcat> engla: since add(x) can now be treated as a guarantee that x is not INT_MAX
[20:21:13] <bblum> do for loops typecheck as bool these days
[20:21:32] <strcat> y = add(x); if (x == INT_MAX) { this can be considered a dead branch }
[20:21:34] <engla> right, so this seemingly simple function can ruin your otherwise safe program
[20:21:38] <ecr> I have this idea about using libuv async to tell the proper scheduler to do the IO action which would fill the future on the calling thread.
[20:21:44] <strcat> bblum: for loops desugar in the parser to loop {}
[20:21:58] <olsonjeffery> brson: it occured to that, because of the impl details of the libuv scheduler, we should pretty much have the functionality of C# 5.0's async/await stuff in a library via future::spawn
[20:22:14] <strcat> bblum: they don't exist in librustc anymore :)
[20:22:22] <ecr> IO would be so much simpler if we could actually move handles between event loops.
[20:22:27] <bblum> strcat: oh nice
[20:22:37] <bblum> strcat: i take it that means they check as unit then
[20:22:45] <strcat> bblum: yeah
[20:23:03] <brson> olsonjeffery: that is my understanding as well
[20:23:03] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[20:23:26] *** Quits: int3_ (int3_@moz-15FB2963.hfc.comcastbusiness.net) (Client exited)
[20:23:27] <olsonjeffery> brson: im gonna do a presentation at Seattl Code Camp in late septermber in Redmond
[20:23:33] <olsonjeffery> im gonna throw that in for laughs.
[20:23:47] <olsonjeffery> disclaimer: .net is my day job, heh.
[20:24:23] <kmc> http://osrc.dfm.io/bors  "bors is a high caliber Rust expert (one of the top 1% most active Rust users) who spends a lot of time commenting on your commits between pushes... It seemsâ€”from their activity streamsâ€”that bors and graydon are probably friends or at least virtual friends. With this in mind, it's worth noting that graydon is less of a pusher."
[20:24:28] <ecr> olsonjeffery: when in september? I may be in town (I go to UW).
[20:24:41] <olsonjeffery> ecr: http://seattle.codecamp.us
[20:24:50] <brson> we could possibly do await more efficiently by cutting out the tasks, and going directly from the event callback into the waiting task, but i don't think the performance will be better enough to be worth it
[20:25:02] * olsonjeffery nods
[20:25:39] <brson> at least not yet
[20:25:47] <ecr> olsonjeffery: hm, I may be in town for that.
[20:25:56] <olsonjeffery> yeah. would be interesting to prototype/measure the differences.
[20:26:08] <olsonjeffery> ecr: well if you are, i could use the moral support :)
[20:26:15] <olsonjeffery> my talk is on there.
[20:26:29] *** Quits: Kruppe (user@moz-4DDA8AB8.uwaterloo.ca) (Ping timeout)
[20:26:32] *** Quits: BitPuffin_ (quassel@moz-8370D1B9.bredband.comhem.se) (Ping timeout)
[20:28:47] *** Quits: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP) (Ping timeout)
[20:29:57] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Client exited)
[20:33:17] <bblum> kmc: With this in mind, it's worth noting that graydon is less foul mouthed.
[20:33:38] <brson> olsonjeffery: that's cool that you're going to be presenting rust!
[20:35:44] <Sergio965> So uh, procedural macros in 0.8?
[20:35:50] <Sergio965> :D
[20:35:56] <cmr> Sergio965: nobody is working on it.
[20:36:09] <cmr> and I don't think it is anyone's plans
[20:36:17] <cmr> so if you want them you're going to have to add them :)
[20:36:29] <cmr> dbaupp has previously added a prototype of it
[20:36:46] <pauls> cmr: really?
[20:36:54] <pauls> dbaupp: I'd be interested to look at this!
[20:37:11] <cmr> https://github.com/mozilla/rust/pull/6735
[20:38:01] *** Quits: StarLight (StarLight@moz-637E2651.dynamic.avangarddsl.ru) (Ping timeout)
[20:38:33] *** Quits: olsonjeffery (pf@B8927AE1.CFEFA148.239A1A9E.IP) (Ping timeout)
[20:38:33] *** Joins: StarLight (StarLight@moz-637E2651.dynamic.avangarddsl.ru)
[20:39:24] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[20:40:08] <Sergio965> cmr: I would if I had the time for it.
[20:41:10] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[20:41:26] <bblum> nmatsakis: ok, the final word was actually really easy to implement compared to the last word
[20:41:30] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[20:41:47] * nmatsakis tries to decrypt this comment from bblum 
[20:41:51] <nmatsakis> huh?
[20:41:51] <nmatsakis> :)
[20:41:55] *** Joins: olsonjeffery (pf@B8927AE1.CFEFA148.239A1A9E.IP)
[20:42:08] <olsonjeffery> brson: yeah, my greatest fear is that the audience will be full of assembly plumbers who spend the whole time schooling me.
[20:42:15] <olsonjeffery> although more likely c# devs asking "why should i care?"
[20:42:30] <bblum> nmatsakis: implementing the new capability is a simple matter of modifying type_contents whereas implementing the restrictions was scattered all over the place
[20:42:41] <nmatsakis> bblum: I see. Yes, that makes sense.
[20:42:43] <bblum> oops
[20:42:47] <bblum> i meant "compared to the first word"
[20:42:59] <bblum> the last word and the final word are, of course, the same, unles you're talking about cocktails
[20:43:33] <Sergio965> C# and Java are the devil's languages.
[20:43:51] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:43:53] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[20:44:17] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[20:44:17] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[20:44:54] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[20:45:04] <strcat> nmatsakis: oh, so it really just does this to reduce code size
[20:45:10] <strcat> but it seems really wrong to me
[20:45:12] <strcat> ;p
[20:45:17] <Sergio965> I just realized that in Rust, Structs and Enums are automatically types.
[20:45:53] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[20:45:59] <Sergio965> Like, struct MyThing { } can be used as let x = MyThing { â€¦ } and let x: MyThing;.
[20:46:01] <strcat> rusti: (&5 as *int)
[20:46:02] -rusti- 140296262930656
[20:46:58] *** Quits: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net) (Quit: msingle)
[20:47:24] <strcat> rusti: fn foo<T>(x: @mut T, y: T) { *x = y }
[20:47:25] -rusti- ()
[20:47:41] *** Joins: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com)
[20:47:41] *** ChanServ sets mode: +o pcwalton
[20:47:52] <strcat> rusti: fn foo<T>(x: @mut T, y: T) { *x = y } let x = @mut 5; let _lock = &*x; foo(x, 6)
[20:47:53] -rusti- task <unnamed> failed at 'borrowed', <anon>:5
[20:47:53] -rusti- application terminated with error code 101
[20:50:36] <strcat> oh anyway that doesn't matter
[20:53:34] <strcat> rusti: trait Foo { fn foo(self) -> int; } impl Foo for @mut int { fn foo(self) -> int { *self } } impl Foo for @int { fn foo(self) -> int { *self } } fn foo<T: Foo>(x: T) -> int { x.foo() } foo(@5)
[20:53:36] -rusti- line longer than 150 columns, pastebinned 3 lines of output: http://ix.io/7ps
[20:53:46] <strcat> well that wasn't supposed to break yet
[20:55:30] *** Quits: maxli (maxli@13F2CEC5.7672369.D8E68FF6.IP) (Quit: Leaving.)
[20:55:31] *** Quits: tgummerer (tgummerer@51D3B54.FEF996EA.EA6FEF3D.IP) (Ping timeout)
[20:56:57] <strcat> by-value self bug
[20:57:18] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[20:57:20] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:58:07] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[20:58:07] *** ChanServ sets mode: +o brson
[20:58:23] *** Joins: robertknight (robertknig@moz-731801B5.range86-144.btcentralplus.com)
[21:00:31] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[21:01:14] <cmr> Is there any way to split a &str into two slices by an index?
[21:01:20] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[21:01:39] <strcat> pcwalton: do you know why monomorphization normalizes types before trans? like @/@mut -> opaque box, * ptrs to ints
[21:01:59] <strcat> it doesn't *seem* to be about reducing code size because it still generates multiple functions
[21:02:27] <kimundi> cmr: not sure, but it's an oneliner
[21:02:46] <pcwalton> reducing code size i guess
[21:02:48] <pcwalton> i'm not sure
[21:03:00] <cmr> kimundi: I don't think it is? It'd require two borrows, which would need to be unsafe because the type system doesn't know they are disjoint
[21:03:19] <kimundi> cmr: Ah, you mean MUTABLE slices
[21:03:25] *** Quits: Sergio965 (sergiobz@moz-8D70E596.wireless.csail.mit.edu) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[21:03:29] <kimundi> cmr: actually, for that there is one
[21:03:32] <strcat> pcwalton: it still makes multiple fns, because otherwise you'd get bugs due to an impl on @mut being different than @
[21:03:36] <cmr> Oh wait right, you can have multiple immutable borrows
[21:03:36] <strcat> hm
[21:03:38] <kimundi> just don't know what it'S called
[21:03:41] <cmr> I don't mean mutable slices, just confused :P
[21:03:50] <cmr> ok so this is easy, nevermind
[21:03:52] <kimundi> he, all right
[21:03:52] <pcwalton> strcat: hmm odd
[21:03:56] <strcat> maybe it only works in combination with type_use
[21:04:30] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[21:05:25] *** Quits: jgilbert (jgilbert@moz-7B0110AD.mv.mozilla.com) (Ping timeout)
[21:05:58] *** Joins: Florob (Florob@moz-39532932.de)
[21:06:40] <carleastlund> the "rusti" repl appears to be parsing the command name ($0 if this were a shell script) instead of my input.  Anyone else seen this behavior?
[21:07:45] <cmr> carleastlund: no
[21:08:45] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[21:10:57] <Florob> Can someone tell me what happened	with <https://github.com/mozilla/rust/pull/8445>? That looks like failure unrelated to the actual PR
[21:12:30] <strcat> rusti: std::int::min_value * -1
[21:12:30] -rusti- -9223372036854775808
[21:12:36] <strcat> rusti: std::int::min_value.checked_add(&-1)
[21:12:37] -rusti- None
[21:12:43] <strcat> rusti: std::int::min_value.checked_mul(&-1)
[21:12:44] -rusti- None
[21:13:24] <acrichto> Florob: it's got "@bors: retry" now from cmr, so you should be good
[21:13:51] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[21:14:36] <Florob> acrichto, yes, just saw that. Just after I asked apparently
[21:14:47] <cmr> yes.
[21:14:58] <sully> pnkfelix: ping
[21:15:13] <Florob> cmr, thank you
[21:15:17] <cmr> np
[21:15:38] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[21:15:59] <bblum> nmatsakis: do you want me to wait for the current r+ to go through or should i append to the existing pull request; this second half is basically done
[21:16:16] <pnkfelix> sully: pong
[21:17:06] <nmatsakis> bblum: might as well append I guess
[21:17:36] <bblum> nmatsakis: updated
[21:18:02] <cmr> Guh, no find_equiv_mut?
[21:18:20] <bblum> nmatsakis: note how super-simple the "Add more capabilities" commit is
[21:18:46] <cmr> Polymorphic mutability would be really handy, though I don't know if it'd make sense.
[21:18:59] <sully> pnkfelix: did you ever take a look at the two silly default method related bugs you filed
[21:20:25] <cmr> I suppose insert_or_update_with is suitable
[21:20:42] *** Joins: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com)
[21:20:57] <cmr> no, not really
[21:21:07] <cmr> Any opposition to me adding it?
[21:21:42] <ecr> cmr: if I remember right polymorphic mutability is unsound
[21:21:59] <ecr> nmatsakis would know
[21:22:11] <strcat> cmr: hashmap has too many methods, need to figure out a better paradigm for doing this
[21:22:25] <strcat> there's going to be a combinatorial explosion of methods
[21:22:34] <cmr> yeah, there is.
[21:22:36] <nmatsakis> cmr: ecr: I don't know what you mean by "polymorphic mutability" in this case?
[21:23:10] <cmr> nmatsakis: write a method that can return either &T or &mut T, according to the caller
[21:23:28] <nmatsakis> Ah. Yes, that would be handy. Tricky though.
[21:23:45] *** Joins: veddan (viktor@moz-C79BC80B.csbnet.se)
[21:23:48] <nmatsakis> well, not that tricky. but we'd need to extend the type system with a new kind of mutability qualifier
[21:24:11] *** Quits: sankha93_ (Instantbir@7061CD01.D6BD0D91.22D41759.IP) (Quit: Gone to save the world!)
[21:24:35] <cmr> I think it'd be fine for the limited subset of cases where your method obeys both the mutable and immutable borrow rules, extending it beyond that would be very complex and prone to weird compiler errors (I think)
[21:25:15] <cmr> It'd cut out the whole foo/foo_mut pattern though
[21:26:05] <veddan> is there anything like std:fill for vecs?
[21:26:22] <cmr> veddan: what is std::fill?
[21:26:22] <strcat> for u8 vectors there's set_memory
[21:26:36] <strcat> there isn't an iterator adaptor for doing it
[21:26:55] <strcat> rusti: let mut xs = [0, ..20]; for x in xs.mut_iter() { *x = 5 } xs
[21:26:56] -rusti- [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5]
[21:27:09] <strcat> you could write one
[21:27:28] <cmr> for iterators isn't it just map?
[21:27:36] <strcat> it's in-place
[21:27:49] <strcat> C++ calls map std::transform
[21:27:56] <cmr> map_ref_mut :P
[21:28:04] <strcat> but map won't actually do anything
[21:28:06] <strcat> it's lazy
[21:28:12] <cmr> ah yes, good point
[21:28:24] <cmr> I've often wanted an iterator adaptor when I only care about the side effects of an iterator pipeline
[21:28:36] <cmr> "run until exhaustion"
[21:28:37] <pnkfelix> sully: no not yet, sorry
[21:28:38] <strcat> we could have in-place reverse (on double-ended iterators), fill, and eventually sort on random-access iterators
[21:28:45] <sully> ok, I will just take them, then
[21:28:47] <strcat> cmr: well, .len() or .count()
[21:28:51] <strcat> or .fold()
[21:28:53] <strcat> any of those ;p
[21:28:56] *** Joins: sp3d (a@moz-6F12212B.fidnet.com)
[21:29:02] <pnkfelix> sully: I know I assigned them to myself, but then tying up the visit work took longer than I expected.
[21:29:14] <strcat> rusti: range(0, 3).peek(|_| println("foo"))
[21:29:14] -rusti- <anon>:5:9: 6:5 error: type `std::iterator::Range<int>` does not implement any method in scope named `peek`
[21:29:15] -rusti- <anon>:5          range(0, 3).peek(|_| println("foo"))
[21:29:15] -rusti- <anon>:6     };
[21:29:15] -rusti- error: aborting due to previous error
[21:29:15] -rusti- application terminated with error code 101
[21:29:21] <strcat> rusti: range(0, 3).inspectr(|_| println("foo"))
[21:29:21] -rusti- <anon>:5:9: 6:5 error: type `std::iterator::Range<int>` does not implement any method in scope named `inspectr`
[21:29:21] -rusti- <anon>:5          range(0, 3).inspectr(|_| println("foo"))
[21:29:21] -rusti- <anon>:6     };
[21:29:22] -rusti- error: aborting due to previous error
[21:29:24] -rusti- application terminated with error code 101
[21:29:25] <strcat> ugh
[21:29:28] <strcat> rusti: range(0, 3).inspect(|_| println("foo"))
[21:29:29] -rusti- {iter: {state: 0, stop: 3, one: 1}, f: }
[21:29:32] <strcat> rusti: range(0, 3).inspect(|_| println("foo")).len()
[21:29:33] -rusti- foo
[21:29:33] -rusti- foo
[21:29:33] -rusti- foo
[21:29:34] -rusti- 3
[21:29:39] <graydon> brson: in compiletest, do we ever look at stdout of a subprocess, or only ever stderr?
[21:29:47] <graydon> brson: (or do we merge them?)
[21:30:06] <veddan> strcat: thanks, not having fill is just a minor inconvenience really
[21:30:07] *** Quits: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com) (Quit: jeff)
[21:30:33] <SiegeLord> I was thinking about a variable mutability thing... but I couldn't see a good way to deal with storing such pointers
[21:30:37] <graydon> ah looks like we do. grum.
[21:30:39] <SiegeLord> I didn't think that hard about it, granted
[21:30:39] <strcat> rusti: fn fill<A, T: Iterator<&mut A>>(iter: T) {}
[21:30:39] -rusti- <anon>:5:32: 5:38 error: Illegal anonymous lifetime: anonymous lifetimes are not permitted here
[21:30:39] -rusti- <anon>:5          fn fill<A, T: Iterator<&mut A>>(iter: T) {}
[21:30:39] -rusti-                                          ^~~~~~
[21:30:40] -rusti- error: aborting due to previous error
[21:30:40] -rusti- application terminated with error code 101
[21:30:51] <strcat> rusti: fn fill<'r, A, T: Iterator<&'r mut A>>(iter: T) {}
[21:30:51] -rusti- <anon>:5:40: 5:43 error: Illegal lifetime 'r: only 'self is allowed as part of a type declaration
[21:30:51] -rusti- <anon>:5          fn fill<'r, A, T: Iterator<&'r mut A>>(iter: T) {}
[21:30:51] -rusti-                                                  ^~~
[21:30:51] -rusti- error: aborting due to previous error
[21:30:51] -rusti- application terminated with error code 101
[21:30:52] <sully> pnkfelix: hm, so, the ICE is interesting, since it is sort of an accident that you can leave off the name of an argument in a default method specification
[21:30:54] <strcat> oh right this problem
[21:30:56] *** Quits: igl (igl@moz-A5E03FDE.adsl.alicedsl.de) (Ping timeout)
[21:31:01] <strcat> nmatsakis: I hate that issue ^ ;p
[21:31:02] <nrc> nmatsakis: I think pcwalton mentioned you were thinking of adding variant generics to Rust, is that correct?
[21:31:07] <sully> pnkfelix: because you can't for regular function definitions
[21:31:07] <graydon> forking 2 threads per subprocess to read output of them is really unfortunate
[21:31:09] <strcat> nmatsakis: forces you to make static methods
[21:31:12] <strcat> to refer to 'self
[21:31:13] <sully> pnkfelix: so like, it probably shouldn't parse at all
[21:31:22] <pnkfelix> sully: I'd personally have no problem with requiring the parameter name there
[21:31:28] <sully> yeah
[21:31:33] <pnkfelix> sully: Just needs to be a proper error
[21:31:39] *** Joins: igl (igl@moz-52A8F9AD.adsl.alicedsl.de)
[21:31:43] <bblum> nmatsakis: i updated https://github.com/mozilla/rust/pull/8562
[21:31:45] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[21:31:46] <pnkfelix> sully: Maybe its time to dust off that "use conditions in rustc" bug
[21:32:20] <sully> hm.....
[21:32:36] <sully> this is annoying for annoying reasons.
[21:32:37] <pnkfelix> sully: (I'm half-joking, that's probably more of a distraction than is worthwhile for this bug)
[21:32:55] <sully> argh.
[21:33:19] <sully> so, the issue here is that when you write down function *types*
[21:33:36] <sully> you are allowed to leave off variable names, and not allowed to write down patterns
[21:33:39] *** Quits: bent (chatzilla@moz-BE33DA21.fw1.sfo1.mozilla.net) (Ping timeout)
[21:34:25] <sully> and when you write function *definitions*, you can't leave off variable names, but can write patterns
[21:34:45] <sully> except for default methods, traits are a list of essentially function types
[21:34:52] *** Quits: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[21:34:58] *** Quits: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP) (Client exited)
[21:35:10] <sully> but default methods are actually functio n bn bodies...
[21:35:15] <sully> except the prelude is parsed by function type parsing code
[21:35:23] <sully> furthermore, you can't really tell in advance which you want...
[21:35:25] <sully> hm...
[21:35:34] <strcat> cmr: veddan: http://ix.io/7pv an implementation of it
[21:35:44] <strcat> could do in-place reverse like that too
[21:35:47] <pnkfelix> sully: can default methods use pattern-bindings for their parameters too then?
[21:36:11] <pnkfelix> sully: or is it following the fn-type rule, and just throwing on an optional body?
[21:36:40] *** Quits: Yurumechan (23f9939a@B2F514.E4420F21.EEF52F3A.IP) (Ping timeout)
[21:37:04] <pnkfelix> sully: (I'm talking about the behavior we are striving for, not what is currently implemented)
[21:37:29] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[21:38:56] <sully> I think that probably they should be able to have pattern bindings
[21:39:52] <pnkfelix> sully: okay.  I'm actually not sure if supporting that will break LL(1)
[21:40:22] <sully> yeah, there may be parser problems
[21:40:23] <pnkfelix> sully: [or LL(k), really.  but I haven't thought about it too carefully.]
[21:41:09] <toddaaro> brson: new runtime error: "macro undefined: 'externfn!(fn rust_dbg_lock_create() -> *libc::c_void)
[21:41:17] <toddaaro> brson: this appeared out of nowhere and I haven't changed that file
[21:41:44] <strcat> I guess I'll add these to std::iterator
[21:42:02] * strcat doesn't think `fill` is worth it though
[21:42:09] <toddaaro> anyone else see this error before?
[21:42:13] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[21:42:17] <toddaaro> it literally appeared out of nowhere for no apparent reason
[21:43:20] <ecr> yes, what is this 'externfn!' and where is it?
[21:43:42] *** kimundi is now known as zz_kimundi
[21:44:48] *** Joins: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com)
[21:45:09] *** Joins: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net)
[21:45:09] *** ChanServ sets mode: +o dherman
[21:45:18] <kmc> how do I iterate over the elements of a vector, by reference?
[21:45:28] <strcat> kmc: for x in xs.iter() { }
[21:45:30] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[21:46:00] <toddaaro> ok, it looks like stage0 is broken on master again?
[21:46:02] <strcat> kmc: http://static.rust-lang.org/doc/tutorial-container.html#iterators here
[21:46:19] <Eridius> ecr: externfn! is defined in the macro prelude (the blob that's imported at the top of each crate, by libsyntax)
[21:46:21] <toddaaro> there is a module called "mod macro_hack" in a few files that redefines this externfn! for cfg(stage0)
[21:46:30] <kmc> oh, I was misreading the types
[21:46:33] <toddaaro> and stage0 does not compile for either of us
[21:46:36] <ecr> Eridius: thanks, just ran across that myself
[21:46:42] <kmc> VecIterator<'self, T> implements Iterator<&'self T>
[21:46:48] <strcat> kmc: yeah it's a bit weird
[21:46:51] <strcat> ;]
[21:47:05] *** Joins: aatch (aatch@moz-B437F499.pocketrent.com)
[21:47:06] <kmc> it makes sense though
[21:47:08] <strcat> kmc: move_iter is by-value (only for ~[T] though)
[21:47:48] <strcat> ugh what
[21:47:51] <toddaaro> nmatsakis: ping
[21:48:01] <toddaaro> nmatsakis: it seems you have modified externfn recently
[21:48:12] <toddaaro> nmatsakis: and it appears to be broken now
[21:48:18] *** Quits: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net) (Input/output error)
[21:48:22] <strcat> graydon: the doc builder is broken again :(
[21:48:32] <graydon> strcat: yeah, I know
[21:48:57] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[21:49:07] <carleastlund> Just updated sources and rebuilt; the REPL is still giving syntax errors about its own command line name rather than my input.  This is on Mac, in case that matters.  Very bizarre.  :/
[21:49:37] <pnkfelix> carleastlund: I see the same, I think.
[21:49:44] <carleastlund> Heya Felix.  :)
[21:50:09] <pnkfelix> carleastlund: yo yo.  What are you doing here, don't you know we can't prove any theorems in our type system?  ;)
[21:50:42] <strcat> graydon: could an auto bot just be assigned to building docs on successful builds?
[21:50:51] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[21:50:51] <strcat> s/building/uploading/
[21:50:55] <carleastlund> pnkfelix: What do you think I am, some kind of Haskell coder?
[21:51:01] <graydon> strcat: possible, yes. other stuff ahead of this on the list presently.
[21:51:08] <graydon> on my list anyways :(
[21:51:29] <toddaaro> graydon: can we rebase niko's commit out of the history?
[21:51:33] <strcat> toddaaro: yeah it looks like externfn was added recently
[21:51:42] <strcat> toddaaro: it just requires a snapshot
[21:51:47] <toddaaro> fuuuuu
[21:51:54] <pnkfelix> carleastlund: Sorry, terminological breakdown, I've forgotten how to talk about ACL2.  :)
[21:51:55] <toddaaro> I am blocked until this is fixed
[21:51:56] <graydon> toddaaro: rebase it out of the history? define what you mean?
[21:52:05] <strcat> toddaaro: well, it's easy enough to do a snapshot for this
[21:52:20] <toddaaro> strcat: I guess, but I'm sort of unable to work until it finishes
[21:52:21] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[21:52:21] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/nWMZPA
[21:52:21] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[21:52:44] <toddaaro> so maybe if I just rebase it back out of my branches I can continue
[21:52:46] <strcat> toddaaro: copy the stage2 compiler over top of the snapshot one maybe
[21:53:07] <carleastlund> pnkfelix: meh, I'm more of a Racketeer who happened to pass on Racket tech to ACL2, than an ACL2er at heart.
[21:53:11] <toddaaro> strcat: hm, I'd have to build a new branch to build a compiler as I don't have a functional runtime in this branch
[21:53:16] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[21:53:17] <toddaaro> strcat: but I guess that could work?
[21:53:20] *** Joins: Yurumechan (23f9939a@B2F514.E4420F21.EEF52F3A.IP)
[21:53:22] <strcat> toddaaro: yeah I think it would
[21:53:29] <strcat> but ofc you wouldn't be able to land anything on master yet
[21:53:38] <toddaaro> ok, so if I rebase niko's commit out and then rebase it back into the same spot later
[21:53:43] <strcat> toddaaro: I often do weird stuff like that, and fudging mtimes to avoid rebuilds
[21:53:46] <strcat> ;p
[21:53:46] <toddaaro> the refs would still be different ruining the world right?
[21:54:03] <strcat> toddaaro: yeah, just revert it
[21:54:10] <pnkfelix> strcat: is there not some configure or Make setting to tell things to use a local snapshot instead?
[21:54:12] <strcat> and then rebase out the revert before it lands
[21:54:27] <pnkfelix> (maybe that would be a bad idea)
[21:54:28] <strcat> pnkfelix: I think so but honestly I find it easier to duct tape things together than learn make targets
[21:54:33] <toddaaro> strcat: is revert different from rebase?
[21:54:39] <pnkfelix> strcat: fair enough.
[21:54:41] <strcat> toddaaro: yes, revert does the revert in a commit
[21:54:51] <strcat> so you'll have a revert commit you can then remove
[21:55:07] <strcat> once a snapshot is done
[21:55:18] *** Joins: bent (chatzilla@moz-BE33DA21.fw1.sfo1.mozilla.net)
[21:55:35] <strcat> if you rebase, your branch won't align with master anymore and it will be hell when you try to pull --rebase
[21:55:39] <strcat> (and it won't merge)
[21:55:41] <toddaaro> ah cool
[21:55:44] <toddaaro> I'll man git revert
[21:57:03] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[21:57:24] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[21:57:33] <toddaaro> ok, so what exactly made it so master is borked from this commit?
[21:57:52] <strcat> toddaaro: the compiler injects certain macros
[21:58:12] <strcat> so I guess the commits (or set of commits) added a macro + started using it
[21:58:17] <flaper87> how does the #[should_fail] annotation works? Does it catch any failure?
[21:58:35] <bblum> it means the root task of the test case is run as a task::try task
[21:58:37] <strcat> toddaaro: I don't know how it'd bootstrap though
[21:58:42] <bblum> and the result is asserted to be err
[21:58:43] <strcat> but obviously it does :)
[21:58:51] <strcat> flaper87: it requires that the test fail
[21:58:54] <toddaaro> hm
[21:59:33] <toddaaro> so do we need some sort of snapshot lock to protect stage0 when these changes happen?
[22:01:19] <strcat> toddaaro: well it still has to bootstrap itself
[22:01:47] <pnkfelix> toddaaro, strcat: You may want to look at the â€”local-rust flag to configure.
[22:01:57] <toddaaro> strcat: it needs to do "something", but having stage0 just stop working randomly without warning is frustrating
[22:02:09] *** Quits: rovar_ (rovar@moz-203658CB.nycmny.fios.verizon.net) (Connection reset by peer)
[22:02:09] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[22:02:10] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/WfEDig
[22:02:10] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[22:02:11] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[22:02:11] <ghrust> 01[13rust01] 15bors pushed 9 new commits to 06auto: 02http://git.io/d9hYtw
[22:02:11] <ghrust> 13rust/06auto 14e8d2141 15Felix S. Klock II: port util/common.rs from oldvisit to <V:Visitor> trait API.
[22:02:11] <ghrust> 13rust/06auto 14e524781 15Felix S. Klock II: Ported coherence.rs from oldvisit to <V:Visitor> trait API.
[22:02:12] <ghrust> 13rust/06auto 1478dd07b 15Felix S. Klock II: Ported rusti::utils from oldvisit to <V:Visitor> trait API.
[22:02:13] <sully> pnkfelix: haha, so. I just looked at the parsing code, and found the following comment
[22:02:14] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[22:02:20] <sully>                 // This is somewhat dubious; We don't want to allow argument
[22:02:21] <sully>                 // names to be left off if there is a definition...
[22:02:23] *** Joins: rovar_ (rovar@moz-203658CB.nycmny.fios.verizon.net)
[22:02:25] *** Joins: Liothen (liothen@moz-80EF0CD7.spkn.qwest.net)
[22:02:25] <sully> left by me, a year ago.
[22:02:45] <graydon> sully: just saw your talk. can I send you a cake?
[22:02:52] <graydon> like .. every day, for a year?
[22:03:02] <graydon> mailing address at CMU acceptable
[22:03:18] *** Quits: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP) (Quit: victorporof)
[22:03:43] *** Quits: sebcrozet (sebcrozet@moz-2517AE39.w80-13.abo.wanadoo.fr) (Ping timeout)
[22:03:51] <strcat> wow I broke libstd in a weird way
[22:04:14] <strcat> http://ix.io/7pz :s
[22:04:40] *** Quits: Yurumechan (23f9939a@B2F514.E4420F21.EEF52F3A.IP) (Ping timeout)
[22:05:38] <strcat> from doing 'use util::swap' in iterator.rs
[22:05:45] <sully> graydon: haha
[22:05:45] *** Quits: Guest (textual@34641662.FB4DE631.66C78B76.IP) (Quit: Textual IRC Client: www.textualapp.com)
[22:06:03] <sully> I didn't think my talk this year was that gret; all of the new content was pretty dry
[22:06:17] <sully> well, I guess my discussion about what default methods are and why they are useful was all right
[22:06:59] <strcat> and now my old friend, that generic impl resolve bug
[22:07:09] <graydon> sully: not the talk per se, just the endless technical-debt-repayment involved
[22:07:41] <sully> yeah, there was quite a bit of that :P
[22:07:58] <sully> I really enjoyed my work this summer
[22:08:48] <sully> more than most of what I did last summer, I think, except for designing and shoehorning in static typeclass methods
[22:09:04] <bblum> "// Writing a test for the identity function. How did it come to this?" haha i forgot about that
[22:10:54] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[22:11:20] <graydon> brson: r? on https://github.com/mozilla/rust/pull/8500 -- just existing reviewed stuff + new change to disable extra-threads on V (final changeset)
[22:11:45] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[22:12:08] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[22:12:34] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[22:13:40] *** Joins: Yurumechan (23f9939a@B2F514.E4420F21.EEF52F3A.IP)
[22:15:02] *** Quits: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: dherman)
[22:15:20] *** Quits: Yurumechan (23f9939a@B2F514.E4420F21.EEF52F3A.IP) (Ping timeout)
[22:15:27] <strcat> ugh, that explains a lot - I forgot to add the container tutorial to the tests.mk file
[22:15:40] * strcat wondered how it was able to be broken
[22:17:09] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[22:18:49] *** Joins: Yurumechan (23f9939a@B2F514.E4420F21.EEF52F3A.IP)
[22:19:21] <toddaaro> huh
[22:19:23] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[22:19:25] <toddaaro> ok so I did the revert
[22:19:29] <toddaaro> but it disappeared my code
[22:19:37] <toddaaro> it had me do a commit first
[22:19:43] <toddaaro> then it did the revert
[22:19:46] <toddaaro> but my commit is not there
[22:20:12] <strcat> toddaaro: you did 'git revert HEAD' right?
[22:20:19] <toddaaro> ?
[22:20:19] <toddaaro> no
[22:20:25] <toddaaro> I reverted only niko's commits
[22:20:31] <toddaaro> my other stuff is still on top of them
[22:20:35] <toddaaro> just the recent commit is gone
[22:20:52] <toddaaro> the one it forced upon me before the revert would work
[22:20:57] <strcat> toddaaro: revert leaves the old commits in place, it just makes a commit undoing them
[22:21:20] <toddaaro> I don't have a commit for my wip and I don't have a revert commit
[22:21:29] <toddaaro> it is just not in the log and the files are not showing the changes
[22:21:47] <strcat> toddaaro: well, look in 'git reflog' - no matter what you do it's all still there
[22:21:59] <strcat> unless you clear the reflog ;p
[22:22:09] <toddaaro> ok, how do I move it from reflog to my branch?
[22:22:35] <strcat> git checkout an id from the reflog, and then check that out as a named branch (maybe there's a shorter way)
[22:22:54] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Quit: WeeChat 0.4.1)
[22:23:06] <strcat> toddaaro: maybe revert found a commit conflict? try git revert --continue
[22:23:10] <strcat> before you do something else
[22:23:24] <strcat> I have the git branch in my prompt to let me know about this
[22:23:34] <strcat> tells me when I'm in a weird rebase mode
[22:23:51] <toddaaro> wasn't in that, mine shows branch in the prompt which makes it pretty clear
[22:23:57] <toddaaro> that reflog checkout seems to have worked though, thanks!
[22:24:56] <toddaaro> hm, I think I know what happened
[22:25:03] *** Quits: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com) (Quit: Scriptor)
[22:25:10] <toddaaro> I did the wip commit inside a failed revert attempt, which errored because I had pending changes
[22:25:17] <toddaaro> and then I did --abort
[22:25:24] <toddaaro> which probably evaporated the commit to the reflog
[22:26:01] <strcat> <3 reflog
[22:26:06] <strcat> yay persistent data structures ;p
[22:26:23] <strcat> and a really, really delayed gc cycle
[22:26:37] <toddaaro> can you remove the ability to clean the reflog from a git binary?
[22:27:00] <strcat> toddaaro: it's really hard to actually clean it ;p
[22:27:08] <toddaaro> cool
[22:27:11] <strcat> it expires after a certain number of days
[22:27:15] <toddaaro> bleh
[22:27:20] <strcat> you can modify the dates
[22:27:21] <toddaaro> I want that to be infinity
[22:27:26] <engla> config is not enough?
[22:27:28] <strcat> it's something like 30 days for dead branches and 90 for live branches
[22:27:29] <toddaaro> I'll have to look around for this
[22:27:38] *** Quits: a__ (a__@moz-250D9B4.nycmny.fios.verizon.net) (Client exited)
[22:27:51] <strcat> toddaaro: man git-gc
[22:27:51] <toddaaro> the idea that text files need to be cleaned up when I have a 512GB SSD is bonkers
[22:28:00] <strcat> you can set it to never expire
[22:28:07] <toddaaro> ah!
[22:28:15] <toddaaro> "git config --global gc.auto 0"
[22:28:17] <toddaaro> thanks
[22:28:25] <strcat> toddaaro: well you probably still want gc to run
[22:28:37] *** Joins: a__ (a__@moz-250D9B4.nycmny.fios.verizon.net)
[22:28:37] <strcat> gc packs free objects into compressed packs
[22:28:43] *** Quits: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[22:28:45] *** Joins: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net)
[22:28:45] *** ChanServ sets mode: +o dherman
[22:28:45] <strcat> otherwise each commit will have a copy of each blob
[22:28:51] <toddaaro> oh
[22:28:52] <strcat> no deltas
[22:28:56] <toddaaro> I'll have to do research at some point
[22:28:58] <engla> just look at the reflog variables in git help config
[22:29:31] <engla> but from your initial question it sounded like you wanted to recompile git with the reflog cleaning removed
[22:29:44] *** Joins: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com)
[22:29:44] <strcat> toddaaro: in that man page they're listed under CONFIGURATION
[22:29:57] <strcat> gc.reflogExpire defaults to 90, and gc.reflogExpireUnreachable defaults to 30
[22:30:14] <strcat> so you probably just want to set both to Never
[22:31:31] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[22:31:46] <strcat> s/Never/never/
[22:32:00] <graydon> hm. jemalloc in rust disagrees with jemalloc in android?
[22:32:17] <strcat> graydon: ?
[22:32:33] <strcat> I think it was working on android before
[22:32:36] <graydon> strcat: https://github.com/mozilla/rust/pull/8584 bounced
[22:32:42] <graydon> apparently type signature differs
[22:32:48] *** Quits: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net) (Ping timeout)
[22:33:12] *** Quits: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[22:33:23] <strcat> weird
[22:33:35] <strcat> wait so android actually uses jemalloc now?
[22:33:54] * strcat is confused
[22:34:22] <flaper87> bblum: btw, why did you annotate your test example with should_fail?
[22:34:31] <strcat> gcc errors pre-4.8 are so ridiculously useless
[22:34:39] <flaper87> bblum: sorry, i've been doing other things and just got back to this issue
[22:34:55] *** Quits: squiddy (squiddy@moz-FC1DD794.adsl.alicedsl.de) (Input/output error)
[22:34:59] <bblum> flaper87: because the main test task should get killed by its child, and fail by linked failure
[22:35:23] <mihneadb> hey
[22:35:24] <mihneadb> http://pastebin.mozilla.org/2885180
[22:35:29] <mihneadb> got this while building rust on os x
[22:35:40] <mihneadb> is there something wrong with my setup or is this a known issue?
[22:35:41] <strcat> graydon: the problem is that the header from android is being included at all
[22:35:44] <strcat> malloc.h
[22:35:51] <strcat> hm
[22:35:55] <jeaye> I looping through some states and updating them (they're in a vector); one of the states may hit a condition where it wants to push a couple more states on the stack, but that causes a dynamic borrow error, since I'm currently looping through the same stack. Is there a way around this other than deferring the push onto the stack until after I'm done looping?
[22:35:56] <mihneadb> I did move my folder
[22:36:00] <mihneadb> maybe I need to reclone or something
[22:36:00] <strcat> but I guess you can't stop that
[22:36:02] <mihneadb> yeah I ll do that
[22:36:03] *** Quits: robertknight (robertknig@moz-731801B5.range86-144.btcentralplus.com) (Ping timeout)
[22:37:43] <strcat> graydon: what's the signature of malloc_usable_size in that android file?
[22:37:55] *** Joins: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com)
[22:38:00] <graydon> beats me. I can unpack an android ndk to check. sec
[22:38:06] <jeaye> It seems reasonable, since I shouldn't be invalidating any iterators. (Well, I know that in C++ this would work just fine :P) Can I use @mut "unsafely" and have it not borrow check?
[22:38:30] <Luqman> strcat: extern size_t malloc_usable_size(void*);
[22:38:30] <strcat> it's not just about it invalidating an iterator
[22:38:30] <pnkfelix> mihneadb: FYI, from looking at that, I'd guess something corrupted your src/llvm dir.  But the build process will recreate that on demand if it doesn't exist.
[22:38:48] <mihneadb> pnkfelix: that's whay I thought
[22:38:49] <mihneadb> I m recloning
[22:38:55] <strcat> Luqman: that's the signature of jemalloc's one though
[22:39:00] <strcat> the android one must be different?
[22:39:00] <mihneadb> thanks
[22:39:10] <Luqman> strcat: that's what I see in the android one
[22:39:21] <strcat> ugh confounding errors
[22:39:34] <strcat> oh
[22:39:40] <strcat> jemalloc uses 'const void *'
[22:41:32] <strcat> graydon: http://www.canonware.com/pipermail/jemalloc-discuss/2012-October/000466.html
[22:41:37] <engla> strcat: reverse_() is nice, it should work on the dlist as well right? Anyway, I think it's not an "adaptor" since it doesn't modify/create a new iterator
[22:41:53] <strcat> engla: true
[22:42:17] <graydon> strcat: so we should add const for us, or remove it on android?
[22:42:18] <graydon> or ..
[22:42:21] *** Quits: bent (chatzilla@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: ChatZilla 0.9.90.1-rdmsoft [XULRunner 22.0/20130619132145])
[22:42:39] <ecr> what happened to as_c_str?
[22:42:53] *** Joins: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net)
[22:43:08] <strcat> graydon: need to undef JEMALLOC_USABLE_SIZE_CONST on android
[22:43:08] *** Quits: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net) (Connection reset by peer)
[22:43:16] <strcat> like it does for linux
[22:43:17] <olsonjeffery> ecr: to_c_str()
[22:43:34] <ecr> olsonjeffery: thx
[22:43:48] <strcat> graydon: sec
[22:43:58] <ecr> hm. looks like with_c_str is the equivalent of as_c_str
[22:44:15] <strcat> graydon: android isn't even in this configure.ac separate from linux :s
[22:44:50] * strcat is officially confused
[22:45:21] <olsonjeffery> was part of the null-terminated-string purge iirc?
[22:46:29] *** Joins: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com)
[22:46:35] *** Joins: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net)
[22:46:35] <ecr> I vaguely remember that that happened. Somehow there were some uses of as_c_str leftover in the runtime.
[22:46:55] <graydon> olsonjeffery: yes. a new wrapper type was introduced that checks the C-string-ness conditions before producing a *c_char from a &str
[22:48:08] <strcat> github didn't send me the usual emails for that PR
[22:48:23] *** Joins: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net)
[22:49:12] *** Quits: Earnestly (earnest@B0BDF733.8FDE20A.5411983D.IP) (Ping timeout)
[22:49:23] *** Joins: Earnestly (earnest@B0BDF733.8FDE20A.5411983D.IP)
[22:50:23] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Connection reset by peer)
[22:50:23] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Connection reset by peer)
[22:50:31] <Luqman> strcat: that is weird. it does seem like we have that patch in our jemalloc
[22:50:35] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:50:55] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:51:09] <strcat> rusti: 2
[22:51:13] -rusti- 2
[22:51:30] *** Quits: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl) (Ping timeout)
[22:53:35] <graydon> are you using ndk r8d or r9? I just grabbed r9 and there's no sign of jemalloc. looks like it's dlmalloc.
[22:53:56] <cmr> we're using a stack jemalloc afaik
[22:53:58] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[22:54:09] *** Quits: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: dherman)
[22:54:32] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[22:55:00] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[22:55:45] <mihneadb> cmr: hey, I found a bug. This https://www.refheap.com/17771 gives the port Some(~"800")
[22:55:51] <strcat> graydon: look in that malloc.h file
[22:55:59] <strcat> graydon: what's the signature of malloc_usable_size?
[22:56:03] <mihneadb> cmr: I want to fix it. Do I open an issue and then a pull req? or just a pull req right away?
[22:56:08] <graydon> strcat: I did. it is dlmalloc.
[22:56:18] <cmr> mihneadb: just a pull req.
[22:56:23] <mihneadb> cmr: ok, thanks
[22:56:32] <strcat> graydon: yeah but all that matters is the signature
[22:56:46] <graydon> extern size_t malloc_usable_size(const void*);
[22:56:50] <strcat> graydon: ah that's the issue
[22:56:51] <graydon> just that, eh?
[22:57:07] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[22:57:10] <strcat> graydon: we need to add android to that case statement in configure.ac and not remove `const` like it does for linux
[22:57:13] <strcat> I'll do that
[22:57:15] <carleastlund> Is there something like "map" for owned vectors?  Construct a new vector from the old one, consuming the original elements as you transform them?
[22:57:34] <cmr> carleastlund: v.consume_iter.map
[22:57:35] <strcat> carleastlund: .move_iter().map(|x| x)
[22:57:39] <cmr> ah right renamed
[22:57:44] *** Joins: RMF (RMF@moz-BE8171F5.dsl.telepac.pt)
[22:57:52] <graydon> strcat: configure.ac in jemalloc?
[22:57:57] <strcat> graydon: yeah
[22:57:59] <carleastlund> Ah, the iterator can be mapped!  Thanks, cmr and strcat.
[22:57:59] <strcat> rusti: let xs = ~[1, 2, 3]; xs.move_iter().map(|x| x + 1).fold(0, |a, b| a + b)
[22:57:59] <Luqman> strcat: weird, in my android ndk the signature _doesn't_ have const
[22:58:00] -rusti- 9
[22:58:12] <graydon> strcat: ok
[22:58:18] <mihneadb> rusti: let x = ~"hello"; x.slice(0, 2)
[22:58:19] <strcat> carleastlund: yeah, iterators have something like 20 algorithms as methods
[22:58:24] -rusti- pastebinned 16 lines of output: http://ix.io/7pD
[22:58:29] <strcat> any, all, map, filter, chain, zip, etc.
[22:58:32] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[22:58:33] *** ChanServ sets mode: +o brson
[22:58:43] <mihneadb> rusti: let x = "hello"; x.slice(0, 2)
[22:58:44] -rusti- "he"
[22:59:02] <mihneadb> rusti: let x = ~"hello"; x.slice(0, 2); x
[22:59:03] -rusti- ~"hello"
[22:59:30] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[22:59:35] <flaper87> bblum: weird thing is that, the same code out of tests seems to work as expected http://pastebin.mozilla.org/2885200
[22:59:47] <graydon> strcat: a version otherwise identical to the *-*-linux* case?
[23:00:07] <carleastlund> strcat, er, wait -- that looks like it produces an iterator, but not a vector.  Should I be programming based on iterators rather than vectors?  Or do I have to make an iterator, map over it, then turn it back into a vector?
[23:00:24] <engla> acrichto: I'd like to create yet more iterator structs for str .... so that strings can be split from the back end as well
[23:00:31] <cmr> carleastlund: you should use iterators wherever possible, but there's .to_owned_vec()
[23:00:35] <strcat> carleastlund: make an iterator, map, and turn it back to a vector
[23:00:42] <strcat> eventually, the first step will be unnecessary
[23:00:50] <strcat> map will be available on every container as a default method
[23:01:05] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[23:01:27] <strcat> graydon: sec my git repo broke
[23:01:30] <strcat> error: object file .git/objects/db/24d3fd1c426ecd029f9fca9e7b84eb56b288e9 is empty
[23:01:31] <strcat> :s
[23:01:41] <Eridius> r? https://github.com/mozilla/rust/pull/8627 (fixes rusti, which has been broken for almost a week)
[23:02:02] <Eridius> actually "almost a week" might be wrong, not sure when the commit was merged in
[23:02:11] <graydon> strcat: I think I have such a change here. https://gist.github.com/graydon/a154aaa2144b4fe9e751 like so?
[23:02:22] <strcat> graydon: yeah
[23:02:27] <strcat> should work
[23:02:30] <doomlord> will for ..in <containter> always need the .iter() to get an iterator ... (its ok, just wondering)
[23:02:46] <graydon> Eridius: are there not rusti tests? do they not catch that?
[23:02:48] <Eridius> ok yeah, broken for 4 days. fun
[23:02:55] <Eridius> graydon: I have no idea. Never looked at rusti before
[23:03:03] <Eridius> only fixed this because someone mentioned it was broken earlier in this channel
[23:03:10] <tjc> I vaguely remember that the rusti tests got disabled...
[23:03:11] <strcat> doomlord: no, it could be made unnecessary by an Iterable trait
[23:03:18] *** Quits: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[23:03:18] <strcat> fatal: Could not parse object 'HEAD'.
[23:03:20] <strcat> :|
[23:03:23] <cmr> graydon: the tests are disabled because rusti is broken on windows
[23:03:27] <tjc> yes -- https://github.com/mozilla/rust/issues/7541
[23:03:34] <cmr> I think it's an llvm bug, acrichto would know the details
[23:03:42] *** Joins: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com)
[23:03:45] <graydon> cmr: (a) do we know why it's broken on windows (b) did we try disabling it on just windows, not everywhere?
[23:04:08] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[23:04:19] <strcat> http://ix.io/7pE uhhh, yeah.
[23:04:26] <strcat> that's what I get for playing with rebase in weird ways
[23:04:38] <strcat> and doing force ;p
[23:05:11] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[23:05:11] *** ChanServ sets mode: +o brson
[23:05:23] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[23:05:38] <Eridius> strcat: huh. nothing you do with the porcelain commands should be able to cause that
[23:06:14] <strcat> Eridius: even if you ctrl-c a command?
[23:06:15] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[23:06:30] <strcat> I doubt they do everything with a transaction
[23:06:36] <Eridius> strcat: even then. git's object database is garbage-collected, and you typically can't update a ref to point at an object that doesn't exist
[23:06:54] <cmr> graydon: no idea, on both accounts.
[23:07:10] <strcat> Eridius: well I'm doing surgery on .git now so all hope of those guarantees is lost :)
[23:07:33] <Eridius> hah
[23:07:55] <strcat> warning: reflog of 'refs/heads/container' references pruned commits
[23:07:58] <strcat> warning: reflog of 'HEAD' references pruned commits
[23:08:00] <strcat> well
[23:08:02] <strcat> it's "fixed"
[23:08:04] <Eridius> hah
[23:08:11] <strcat> I don't know how to remove a commit from the reflog
[23:08:20] <strcat> I just deleted a few objects/heads
[23:08:21] <Eridius> well you could just expire the reflog entirely
[23:08:30] <strcat> or edit it manually
[23:08:33] <bblum> flaper87: ok, can i see the test case that you're using to make it go?
[23:08:57] <graydon> strcat: fresh doc build running
[23:08:59] <Eridius> git reflog --expire=now HEAD` will blow away HEAD's reflog
[23:09:04] <strcat> graydon: :)
[23:09:13] <strcat> uh oh
[23:09:19] <strcat> Eridius: I broke it more though, too late
[23:09:23] <Eridius> haha
[23:09:34] <strcat> fixed again
[23:09:37] <strcat> I broke the remotes
[23:09:43] *** Quits: robarnold (rob@BD56354E.DB510C09.6E370BFC.IP) (Ping timeout)
[23:10:06] <flaper87> bblum: this what I used to run it as a separte program http://pastebin.mozilla.org/2885255
[23:10:14] <strcat> Eridius: it's "fixed" now, I broke the reflog
[23:10:17] <flaper87> is fails by linked failure
[23:10:19] <strcat> afaik it's all fine now
[23:10:20] <flaper87> which should be correct
[23:10:37] <strcat> Eridius: I successfully removed the top of the reflog ;p
[23:10:41] <Eridius> hehe
[23:10:43] <bblum> flaper87: ok, what does it look like as a nonseparatetest case
[23:10:46] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[23:11:00] * strcat runs git fsck
[23:11:06] <Eridius> I was just about to suggest that
[23:11:07] <strcat> success!
[23:11:11] <Eridius> \o/
[23:11:29] <strcat> Eridius: I'm pretty sure it's from me ctrl-c'ing part of a rebase
[23:11:39] <strcat> ended up with empty objects, and a dangling ref
[23:11:41] <Eridius> that shouldn't be possible
[23:11:47] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[23:11:54] *** Joins: tikue (tkuehn@1021DD2F.1E1F6C0.AF6F698.IP)
[23:11:56] <strcat> well it was stupid to ctrl-c it anyway
[23:11:57] <Eridius> git-rebase doesn't destroy objects, it only creates new ones, and it only updates refs after it's created the object (because it can't do them in the other order)
[23:11:59] <strcat> I meant to ctrl-c make
[23:12:10] <strcat> Eridius: *shrug*
[23:12:18] *** Joins: eschweic1 (Adium@moz-BBE3ABD.mv.mozilla.com)
[23:12:21] *** Quits: vosen (vosen@moz-266BA656.icpnet.pl) (Quit: Leaving)
[23:12:23] <Eridius> only thing I can think of is if it does a non-atomic update to the reflog, or somesuch, but I would be surprised
[23:12:24] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[23:12:30] <Eridius> since ^C is not uncommon to perform
[23:13:12] <flaper87> bblum: http://pastebin.mozilla.org/2885319
[23:14:14] <bblum> flaper87: oh, hm, if there is the task try inside, then the should_fail attribute should be absent
[23:14:51] <flaper87> mmh, thought so, that's why I asked before. Cool, I'll get rid of that
[23:14:51] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[23:15:12] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[23:15:12] *** ChanServ sets mode: +o brson
[23:15:56] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[23:20:22] <carleastlund> What did I do wrong?  I can't make ".map" work: https://gist.github.com/carl-eastlund/6275344
[23:20:38] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[23:22:05] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[23:23:35] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[23:23:42] <engla> either your version is too old or default methods don't resolve on ~Trait
[23:24:15] *** Quits: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net) (Ping timeout)
[23:24:52] <graydon> brson: r? https://github.com/mozilla/rust/pull/8500
[23:25:07] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[23:25:17] <graydon> (or strcat -- it just turns off over-threading on V, should speed up that host)
[23:25:23] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[23:25:34] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[23:25:54] *** Joins: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net)
[23:25:54] *** ChanServ sets mode: +o dherman
[23:26:08] *** Joins: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net)
[23:26:38] *** Quits: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: dherman)
[23:27:23] <flaper87> bblum: I pushed what I've got in case you want to take a look at it: https://github.com/FlaPer87/rust/commit/908a3bc0ef0713ed23fe7aa258919f74b07507a7
[23:27:51] <carleastlund> engla: I rebuilt today, so sounds like the latter.
[23:29:42] <bblum> flaper87: ok looks correct to me
[23:30:20] <ecr> brson: successfully rebased the homing IO against master. Running one more `make check' to be sure everything's alright before submitting a PR.
[23:32:31] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Connection reset by peer)
[23:32:39] <ecr> graydon: once this lands we should have thread-safe TCP, UDP, and timers. it's pretty easy to apply to anything that's blocking so when olsonjeffery's file IO lands it can just be wrapped up and be thread-safe too.
[23:33:04] *** Quits: donri (dag@moz-9BB61102.tbcn.telia.com) (Client exited)
[23:33:06] <graydon> strcat: docs updated.
[23:33:11] <graydon> ecr: excellent!
[23:33:21] *** Joins: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net)
[23:33:22] *** ChanServ sets mode: +o dherman
[23:33:44] <flaper87> bblum: but that's the code failing http://pastebin.mozilla.org/2885390
[23:34:17] <flaper87> I'm about to go to bed now, I'll take a look at that tomorrow
[23:34:55] <flaper87> bblum: fyi, I'm running tests with make check-stage1-std TESTNAME=rekillable
[23:34:59] <graydon> tjc: refreshed tutorial, r? https://github.com/mozilla/rust/pull/8563
[23:35:32] <tjc> graydon: cool, I'll take a look
[23:36:28] *** Quits: ofeldt (ofeldt@moz-A8AD1F0B.dip0.t-ipconnect.de) (Ping timeout)
[23:36:49] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[23:37:39] <jeaye> I looping through some states and updating them (they're in a vector); one of the states may hit a condition where it wants to push a couple more states on the stack, but that causes a dynamic borrow error, since I'm currently looping through the same stack. Is there a way around this other than deferring the push onto the stack until after I'm done looping?
[23:38:36] <bblum> flaper87: ok, you're running 3 tests there, so maybe you can narrow it down to which one of the 3 is responsible for the assertion failing
[23:38:54] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[23:38:54] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[23:39:44] <flaper87> bblum: yeah, did that but I think the 3 of them are failing. I think I found something that might be an issue
[23:40:04] <graydon> tjc: revised
[23:41:23] <flaper87> bblum: basically, we're not crashing the rt anymore, instead we're failing and letting the task unwind happen. However, I think we should decrease the unkillable counter by 1 before failing. If we don't the counter will be out of sync.
[23:41:32] <flaper87> does that sound right to you?
[23:42:11] <bblum> flaper87: that does not sound right - the implementations of unkillable() and rekillable() should be responsible for always incrementing/decrementing in a matching pair
[23:42:15] <flaper87> I promise to dig more into the rt and how it works. :)
[23:42:26] <bblum> flaper87: if you find yourself having to do it somewhere else, that means they themselves are broken somehow
[23:42:31] <bblum> take a look at the implementations in task/mod.rs
[23:43:13] <graydon> fyi for anyone who wanted to look at bors, I've made the repository public now: https://github.com/graydon/bors
[23:43:14] <flaper87> bblum: What I mean is it should be done before this fail: https://github.com/FlaPer87/rust/blob/908a3bc0ef0713ed23fe7aa258919f74b07507a7/src/libstd/rt/kill.rs#L567
[23:43:15] <ecr> jeaye: I don't think so. It's impossible to modify a container (adding or removing elements; you can mutate an element if you're using an iterator that gives you a mutable ref) while iterating through it.
[23:43:24] *** Quits: glennsl (textual@moz-5D7B804F.getinternet.no) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[23:43:34] <bblum> flaper87: oh hmmm
[23:43:48] <bblum> flaper87: oh i see what the deal is, yes
[23:43:52] <flaper87> :D
[23:43:57] <bblum> you are right about that
[23:44:11] <bblum> because the inhibit_kill in the finally block of rekillable will go off regardless
[23:44:14] <flaper87> (I'm running tests now, it's compiling)
[23:44:19] <flaper87> bblum: yup
[23:44:27] <bblum> good insight
[23:44:55] * flaper87 just earned 0.1 points
[23:45:01] <bblum> i'd say 1.1 points
[23:45:05] <flaper87> w00t
[23:45:15] <bblum> that is basically the same issue as the above comment in inhibit_kill, which says, "// May fail, hence must happen *after* incrementing the counter"
[23:45:20] *** Quits: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: dherman)
[23:45:25] <bblum> which i left there after debugging basically the same thing in unkillable :P
[23:45:49] <toddaaro> does anyone know how to turn off filename-display in gdb?
[23:45:54] <flaper87> awesome, that fixed it :D
[23:46:01] <bblum> flaper87: btw, maybe change the failure message to something more informative, like "cannot enter rekillable() block without a surrounding unkillable()"
[23:46:02] <flaper87> 2 passed, 1 ignored
[23:46:03] <toddaaro> I can't find any info on it, except that you can use relative/basename/absolute as settings
[23:46:06] <toddaaro> but I want it gone
[23:46:18] <flaper87> bblum: will do
[23:46:34] <bblum> thanks
[23:46:43] <bblum> flaper87: why is one ignored?
[23:47:18] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Connection reset by peer)
[23:47:19] <flaper87> bblum: linked failure. I'll change that w/ a should_fail
[23:47:30] *** Joins: jfbk (textual@moz-EEA9CFB3.nyc.res.rr.com)
[23:47:43] *** Joins: bnicholson (bnicholson@moz-BBE3ABD.mv.mozilla.com)
[23:47:46] <flaper87> bblum: that's the old one
[23:47:49] <bblum> greaet
[23:47:50] <bblum> *grat
[23:47:52] <bblum> *great
[23:47:58] *** Quits: bnicholson (bnicholson@moz-BBE3ABD.mv.mozilla.com) (Input/output error)
[23:48:09] *** Quits: orshem (orshem@C5E06B1E.A5B6B765.E3D28531.IP) (Quit: Leaving)
[23:48:19] <toddaaro> I guess that setting doesn't even do anything anyway
[23:48:34] <toddaaro> my goal is to not have ~80% of the words on my backtraces be idential filenames
[23:48:48] <ecr> toddaaro: I don't think you can get rid of it. Using basename should minimize it though
[23:48:53] *** Joins: bnicholson (bnicholson@moz-BBE3ABD.mv.mozilla.com)
[23:48:56] <bblum> i always postprocess my gdb traces with sed
[23:48:58] <bblum> and grep
[23:49:02] <bblum> to make them readable >_>
[23:49:03] *** Quits: bnicholson (bnicholson@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[23:49:04] <ecr> that would work too
[23:49:05] <toddaaro> ecr: I tried, the setting was ignored and it did full path
[23:49:13] <toddaaro> bblum: inside the gdb console?
[23:49:28] <bblum> no
[23:49:30] <bblum> i nvim
[23:49:32] <bblum> in vim
[23:50:04] <mihneadb> is there a quick make target that only recompiles libextra?
[23:50:27] <flaper87> bblum: vim++
[23:52:16] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[23:52:50] <nmatsakis> toddaaro: regarding externfn -- I created it, but...what is the problem?
[23:52:51] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[23:52:58] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[23:53:11] <dbaupp> mihneadb: either compiling manually with, or `make check-stage2-extra NO_REBUILD=1`
[23:53:21] <dbaupp> *with a prebuilt rustc
[23:53:22] <nmatsakis> toddaaro: it's just a macro that you can define locally yourself if you prefer, I already did that in a few places
[23:53:24] <toddaaro> nmatsakis: make check-stage0-std doesn't compile, crashes with an error about externfn! undefined
[23:53:28] <nmatsakis> toddaaro: just search for #[cfg(stage0)]
[23:53:46] <mihneadb> dbaupp: thanks
[23:53:52] <nmatsakis> oh, yes, of course. :) I don't know why you runtime guys think you should be able to run make check-stage0-std ;)
[23:54:10] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[23:54:16] <nmatsakis> in any case, you can just add the macro wherever you need it?
[23:54:31] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[23:54:35] <toddaaro> so it needs to be defined in mod macro_hack in each place?
[23:54:40] <dbaupp> cmr, pauls: my procedural macros POC was fairly bad; to do it properly essentially requires moving rustc::metadata to libsyntax
[23:54:56] *** Joins: ofeldt (ofeldt@moz-1BA89DD9.dip0.t-ipconnect.de)
[23:55:09] <nmatsakis> toddaaro: yeah, I used the mod just so I had something I could hang the #[cfg] off of
[23:55:24] <toddaaro> nmatsakis: what exactly is the stage0 issue?
[23:55:39] <nmatsakis> toddaaro: it's just that I added the externfn! macro to the standard set of macros
[23:55:44] <nmatsakis> toddaaro: but it's not in the stage0 compiler
[23:55:51] <nmatsakis> toddaaro: since those are rather lamely hard-coded in
[23:56:06] <nmatsakis> toddaaro: another option is just to change the code to not use the macro,
[23:56:11] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Ping timeout)
[23:56:18] <nmatsakis> toddaaro: and instead add #[fixed_stack_segment] by hand to the callers of the extern fns in question
[23:57:19] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[23:57:57] *** Quits: huseby (huseby@moz-4E8C421A.husebyhome.com) (Ping timeout)
[23:58:16] *** Quits: tikue (tkuehn@1021DD2F.1E1F6C0.AF6F698.IP) (Quit: tikue)
[23:59:50] *** Quits: eschweic1 (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
