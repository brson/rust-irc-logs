[00:10:11] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[00:33:50] *** Quits: nrc (nrc@3496663E.C1499D0.396E4C6D.IP) (Ping timeout)
[00:45:55] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[01:58:05] *** kimundi is now known as zz_kimundi
[02:35:49] *** Quits: zz_kimundi (kimundi@moz-6BC42CE5.dip0.t-ipconnect.de) (Ping timeout)
[02:39:20] *** Joins: zz_kimundi (kimundi@moz-F7EA7A97.dip0.t-ipconnect.de)
[02:39:21] *** zz_kimundi is now known as kimundi
[03:01:56] *** Joins: jdm (jdm@37A83DB4.49EECAFD.30BE9F17.IP)
[03:41:07] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[03:45:00] *** Joins: jeaye (Jeaye@moz-34FEF2BB.hsd1.ca.comcast.net)
[03:45:54] <jeaye> What're rustc's plans for concurrent compilation?
[03:46:50] <jeaye> It would seem, in this day 'n' age, a newly coming compiler should be focusing on concurrency (just like a browser).
[03:48:32] <jeaye> Yet the Rust build seems to only benefit from additional jobs in the LLVM section of things (admittedly, C++ compilation is much easier to break up).
[03:48:56] *** Quits: StarLight (StarLight@moz-6C822096.dynamic.avangarddsl.ru) (Ping timeout)
[03:52:15] <SiegeLord> Are there parallel C++ compilers in existence?
[03:52:58] *** Joins: StarLight (StarLight@moz-4A9C441D.dynamic.avangarddsl.ru)
[03:53:02] <SiegeLord> Anyway, I think somebody was talking about creating a dependency graph of items... if such a thing were to exist, then it could be possible to parallelize through it
[03:53:46] <aatch> jeaye, as somebody that has investigated this, a major issue is that it is difficult to split the work due to the data structures involved.
[03:54:30] <jeaye> SiegeLord: Well, individual translation units can be compiled in parallel.
[03:54:47] <aatch> It should, in theory, be possible to build LLVM modules in parallel, then link them together on the other side.
[03:54:57] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[03:55:01] <SiegeLord> jeaye: They can be in Rust too ;)
[03:55:12] <jeaye> SiegeLord: Not the same.
[03:55:13] <SiegeLord> It just happens that Rust has very large units
[03:55:22] <jeaye> Exactly.
[03:55:53] <jeaye> That's an interesting way of thinking about it... and it makes the problem seem more reasonable to have.
[03:55:59] <jeaye> But it's still a nasty problem. :|
[03:56:07] <aatch> but you need all the type definitions, function prototypes etc for each independent module.
[03:58:49] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[03:58:50] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:59:36] <SiegeLord> Hence my original question... I don't know of a C++ compiler that compiles single objects in parallel
[03:59:56] <SiegeLord> This seems like a very nontrivial and novel problem for Rust to solve
[04:00:29] <aatch> SiegeLord, to be fair, that has a lot to do with it not being worth it. Also C++ compilers do semantic analysis *inline* with parsing.
[04:01:37] <aatch> There's a lot of behaviour that C++ compilers have that make it difficult to parallel compile.
[04:02:14] <SiegeLord> I wouldn't say difficult... I'd say inefficient
[04:03:20] <aatch> SiegeLord, at any rate, you don't actually need a strict dependency graph for parallel compilation, just for incremental compilation.
[04:05:25] <aatch> It would probably be enough to know what modules use what declarations.
[04:06:05] <benh> rust compilation units are crates, not modules, right?
[04:06:12] <benh> like, all of rustc is one compilation unit?
[04:06:18] <SiegeLord> Yep
[04:06:25] <aatch> Anyway, one of the hardest bits is that the AST is full of `@`, which means you need to copy a lot of the AST in order to pass it to another task.
[04:10:19] <benh> Does the AST get mutated past the expansion of syntax extension and purging of #[cfg]-hidden items?
[04:10:50] <aatch> benh, not as far as I know.
[04:15:40] <benh> I'm somewhat distraught by how tricky it is to remove the '@'s 
[04:16:17] <aatch> benh, it's difficult because it changes the design.
[04:16:24] <benh> so many internally mutable fields and vaguely tricky borrow checker cases
[04:16:42] <tikue_> benh, that's how i feel about servo too :P 
[04:16:49] * tikue_ will eventually find time to fix some of that
[04:55:42] *** Quits: jdm (jdm@37A83DB4.49EECAFD.30BE9F17.IP) (Ping timeout)
[05:05:31] *** Quits: aatch (James@moz-B437F499.pocketrent.com) (Quit: Leaving)
[05:09:57] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[05:32:33] <jeaye> SiegeLord: Rust has it worse, since it's burdened with larger-than-normal translation units, which is moving further from the ideal.
[05:32:59] <jeaye> Makes code easier to write, but more difficult to compile.
[05:33:04] <jeaye> (quickly)
[05:33:53] <SiegeLord> Yeah, Rust sort of designed itself into a corner
[05:33:54] <jeaye> So it's not the same problem, really. Rust doesn't have the luxury of small (or even many) translation units.
[05:34:00] <jeaye> SiegeLord: Agreed.
[05:43:55] *** Quits: jeaye (Jeaye@moz-34FEF2BB.hsd1.ca.comcast.net) (Quit: zzz)
[06:04:53] <dbaupp> cmr: pong
[06:29:23] <cmr> dbaupp: I was going to ask if you did timestamp, but then I did it.
[06:29:37] <cmr> it still has a bit of a bug in that it will always build one commit, even if it's older than the timestamp.
[06:29:40] <cmr> I opened a PR
[06:30:28] <dbaupp> sorry, I fell asleep without doing it :(
[06:30:39] * dbaupp was/is tired
[06:31:01] <dbaupp> I'll look over it and (presumably) merge it in 5 minutes or so
[06:38:26] <dbaupp> cmr: merged (the README needs updating too, but I'll do that now)
[06:42:06] <cmr> Ok
[06:42:38] <cmr> I was going to figure out why it was always building a single commit but then a 6 person game of 0ad sprang up and I've been doing that for the past 3.5 hours :P
[06:45:15] <dbaupp> <3 0ad
[06:45:33] * dbaupp takes that excuse to be acceptable :P
[06:46:24] <cmr> We only stopped because we were out of trees..
[06:47:09] <dbaupp> haha
[06:47:28] <cmr> We're going to try and pool resources and improve the game.
[06:47:41] <cmr> Pathfinding needs work and it *really needs* some parallelism.
[06:47:45] <dbaupp> I take it that includes "rewrite in Rust"
[06:47:49] <dbaupp> :P
[06:47:58] <cmr> Hah!
[06:48:20] <dbaupp> Rust is easily the lowest hanging fruit for improving any/every program!!!!1!
[06:58:48] *** flaper87|afk is now known as flaper87
[07:23:50] *** Quits: Eridius (kevin@moz-533B0DB4.us) (Ping timeout)
[07:23:58] *** Joins: Eridius (kevin@moz-533B0DB4.us)
[07:34:53] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[07:48:56] *** Quits: tikue_ (tikue_star@677636C4.F3E8A984.689607DE.IP) (Ping timeout)
[08:01:55] *** flaper87 is now known as flaper87|afk
[08:25:46] *** flaper87|afk is now known as flaper87
[08:46:52] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[09:16:54] *** kimundi is now known as zz_kimundi
[09:22:15] *** zz_kimundi is now known as kimundi
[09:52:27] <dbaupp> Example of a bug with struct-like enums: https://github.com/mozilla/rust/issues/8351 (possibly soon to be fixed though: https://github.com/mozilla/rust/pull/9747)
[09:52:43] <dbaupp> acrichto, Eridius: ^ were you looking for an example of such a bug?
[10:04:50] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[10:07:01] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[10:08:58] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Client exited)
[10:09:01] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[10:09:46] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[10:18:49] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[10:30:30] *** flaper87 is now known as flaper87|afk
[10:58:15] *** kimundi is now known as zz_kimundi
[11:00:47] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[11:00:51] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[11:12:14] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[11:14:50] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[11:24:10] *** flaper87|afk is now known as flaper87
[11:42:28] *** Joins: jdm (jdm@514D186.F3BBB17D.144F44FA.IP)
[11:52:21] *** jdm is now known as jdm|f00d
[12:30:07] *** jdm|f00d is now known as jdm
[12:31:42] *** zz_kimundi is now known as kimundi
[12:31:56] *** flaper87 is now known as flaper87|afk
[12:40:45] *** kimundi is now known as zz_kimundi
[12:45:47] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[12:56:52] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[13:07:11] *** zz_kimundi is now known as kimundi
[13:15:46] *** flaper87|afk is now known as flaper87
[13:49:18] *** kimundi is now known as zz_kimundi
[13:52:10] *** zz_kimundi is now known as kimundi
[14:05:15] *** flaper87 is now known as flaper87|afk
[14:36:39] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[14:43:03] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[14:45:33] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[15:09:49] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[15:19:38] *** flaper87|afk is now known as flaper87
[15:35:29] *** Joins: nrc (nrc@moz-3576D163.cable.virginmedia.com)
[15:40:01] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[15:40:42] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[16:00:04] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[16:00:07] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[16:06:21] *** flaper87 is now known as flaper87|afk
[16:10:11] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[16:10:36] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[16:10:51] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[16:14:34] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[16:16:05] *** flaper87|afk is now known as flaper87
[16:17:03] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[16:35:26] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[16:37:36] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[16:47:56] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[17:02:53] *** kimundi is now known as zz_kimundi
[17:18:27] *** flaper87 is now known as flaper87|afk
[17:21:22] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[17:25:42] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[18:08:59] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[18:12:39] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[18:24:55] *** Joins: tikue_ (tikue_star@moz-FEADCD38.hsd1.pa.comcast.net)
[18:29:22] *** zz_kimundi is now known as kimundi
[18:37:47] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[18:37:49] *** Joins: strcat1 (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[18:37:55] *** strcat1 is now known as strcat
[18:46:07] *** Quits: jdm (jdm@514D186.F3BBB17D.144F44FA.IP) (Quit: Lost terminal)
[18:47:01] *** flaper87|afk is now known as flaper87
[19:07:36] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[19:20:18] *** Quits: tikue_ (tikue_star@moz-FEADCD38.hsd1.pa.comcast.net) (Ping timeout)
[20:04:17] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[20:07:05] *** Joins: tikue_ (tikue_star@622E05CA.1564D2D3.689607DE.IP)
[20:20:02] <cmr> https://gist.github.com/cmr/362b70ef188d5b8b4878
[20:20:10] <cmr> Can everyone please look that over and suggest corrections?
[20:25:14] *** Quits: tikue_ (tikue_star@622E05CA.1564D2D3.689607DE.IP) (Ping timeout)
[20:37:55] *** Joins: tikue_ (tikue_star@80E31A8C.E6CB677E.689607DE.IP)
[20:38:16] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Input/output error)
[20:41:46] <acrichto> dbaupp: ping
[20:45:04] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[20:47:07] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[20:51:07] <cmr> acrichto: strcat: can you look over that gist?
[20:51:20] *** kimundi is now known as zz_kimundi
[20:53:10] <strcat> cmr: I would leave out the mention of map vs. transform
[20:53:21] <strcat> since that was caused by a yet to be fixed bug
[20:53:25] <strcat> and still applies for reverse_
[20:54:08] <cmr> Ok.
[20:54:41] <acrichto> cmr: looking
[20:54:51] <strcat> cmr: you can also just say that they vectorize in most/all cases where C/C++ indexing/iterators do
[20:55:20] *** zz_kimundi is now known as kimundi
[20:55:30] <acrichto> haha I keep thinking std::run needs a rewrite
[20:55:37] <cmr> Heh
[20:55:50] <cmr> I like it :p
[20:56:53] <acrichto> it may be worth mentioning that the memory regressions should be fixed now
[20:57:00] <strcat> some
[20:57:29] <cmr> "...although memory usage regressed significantly. It is now mostly fixed in master."
[20:57:32] <acrichto> the only one I know of right now is @Ty => ~Ty
[20:57:58] <acrichto> I suppose the const_eval pass was mostly just a realization than a fix of a regression
[20:58:01] <cmr> acrichto: was that sentence not satisfactory?
[20:58:22] * acrichto definitely learned how to read in elementary school
[20:58:48] <acrichto> you may want to elaborate a bit more in the section about "Is Rust Ready"
[20:58:54] <acrichto> but other than that looks good to me
[21:01:11] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[21:02:23] *** flaper87 is now known as flaper87|afk
[21:11:02] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[21:15:59] <cmr> acrichto: https://github.com/mozilla/rust/pull/9735 unused import ;(
[21:16:43] <acrichto> cmr: yeah I need to run make check more often, I also wanted to run it by pcwalton though to make sure all the resolve changes were sane
[21:17:05] <cmr> Speaking of, why isn't pcwalton in this channel.
[21:20:07] <acrichto> I feel like we should turn on warnings in stage0 at this point
[21:20:21] <acrichto> we haven't seen a false positive in ages
[21:20:25] <acrichto> and this keeps biting me
[21:20:33] <cmr> +1
[21:22:05] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[21:27:27] *** Quits: nrc (nrc@moz-3576D163.cable.virginmedia.com) (Ping timeout)
[21:27:30] <cmr> acrichto: strcat: is https://gist.github.com/cmr/362b70ef188d5b8b4878 better?
[21:27:49] <strcat> cmr: yes
[21:28:30] <acrichto> cmr: lgtm
[21:28:35] *** kimundi is now known as zz_kimundi
[21:32:07] *** Joins: aatch (James@moz-B437F499.pocketrent.com)
[21:41:01] *** Joins: pauls (pauls@9205DEB4.9B5854D0.10894A1E.IP)
[21:44:52] *** Quits: tikue_ (tikue_star@80E31A8C.E6CB677E.689607DE.IP) (Ping timeout)
[22:00:01] <strcat> acrichto: https://github.com/mozilla/rust/pull/9751 r?
[22:00:37] <strcat> haven't actually fixed it yet... but that code is 100% dead
[22:01:09] <strcat> either the cleanup code is broken in general, or in the special case of unsafe_no_drop_flag
[22:05:01] <acrichto> strcat: I'm confused why that code is dead, if we always run destructors on locals regardless of whether they were moved out of or not, isn't this necessary?
[22:05:17] <strcat> take glue is never used on a move
[22:05:24] <strcat> it was wrong to put this here
[22:05:42] <strcat> I told aatch to do it because I didn't know the zeroing was already done elsewhere
[22:05:43] <acrichto> what is take glue used for?
[22:05:59] <strcat> non-moves
[22:06:07] <strcat> it's for @ refcounting, basicall
[22:06:09] <strcat> y
[22:06:15] <strcat> it shouldn't exist
[22:06:29] <acrichto> oh so basically this is impossible b/c you can't non-move a move of a struct with a dtor?
[22:06:33] <strcat> acrichto: yes
[22:06:55] <strcat> acrichto: I could add an extra test case for this but I think it's well covered already
[22:07:08] <acrichto> that should just never get past typeck
[22:08:22] <strcat> acrichto: sadly something about cleanups + unsafe_no_drop_flag is broken, and I just happened to find this dead code on the way
[22:08:44] <strcat> if I can't narrow it down I'm going to send a PR removing unsafe_no_drop_flag temporarily
[22:08:59] <strcat> because it's blocking landing small structs as immediate which is a bigger optimization anyway
[22:09:07] <acrichto> I'm ok with that
[22:09:13] <acrichto> sad that this regressed :(
[22:09:19] <strcat> it didn't regress
[22:09:36] <strcat> it's just that structs are never immediate atm so they hit a different code path
[22:09:47] <acrichto> ah I see
[22:09:51] <strcat> non-immediate -> we always zero the whole object through the reference
[22:09:56] <strcat> immediate -> complex cleanup handling
[22:10:15] <strcat> because immediate means in an LLVM virtual register directly, and that means you can't write to it
[22:10:40] <acrichto> isn't this optimization not possible then?
[22:10:45] <strcat> it is possible
[22:10:51] <strcat> cleanup handling just seems broken
[22:11:02] <acrichto> let a = immediate_struct_with_dtor(); if some_condition() { move_struct(a); }
[22:11:06] <acrichto> how do you codegen that?
[22:12:52] <strcat> it's up to us to figure that out in the frontend
[22:13:00] <strcat> and make proper IR
[22:13:12] <acrichto> but isn't that going into the realm of https://github.com/mozilla/rust/issues/5016 ?
[22:13:14] <strcat> and we try, but there's a problem with it
[22:13:18] <strcat> acrichto: no
[22:13:26] <strcat> this is an existing problem with an existing solution
[22:13:40] <acrichto> the solution is that it's in memory and the destructors sees if the drop flag is 0, right?
[22:13:43] <strcat> it just doesn't work in some edge case, causing the UnsafeArc destructor to be called twice if it's immediate
[22:14:02] <strcat> acrichto: the drop flag isn't really the issue
[22:14:17] <acrichto> doesn't the drop flag prevent the destructor from running twice?
[22:14:35] <strcat> acrichto: we have a broken way of handling this 
[22:14:42] <strcat> the destructor currently turns off the drop flag
[22:14:48] <strcat> acrichto: it is broken *right now*
[22:14:55] <strcat> not just by making structs immediate
[22:15:08] <strcat> newtype structs have been immediate for a while (months?)
[22:15:24] <acrichto> hmm, let me test something
[22:15:37] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[22:15:40] <acrichto> struct A(int) is immediate?
[22:15:45] <strcat> yes
[22:16:13] <strcat> acrichto: make UnsafeArc in unstable/sync.rs a newtype struct and I think compilation will die in stage2 libstd
[22:17:12] <acrichto> do you have code existing that breaks?
[22:17:20] <acrichto> a smaller example that is
[22:17:28] <strcat> not yet
[22:17:30] <strcat> ;p
[22:18:15] <acrichto> oh god our ir is bad
[22:18:30] <strcat> looking at the IR for cleanups?
[22:18:31] <strcat> it's terrible
[22:18:33] <acrichto> yeah
[22:18:46] <strcat> it puts duplicate IR for the return and the cleanup
[22:18:52] <strcat> and LLVM doesn't optimize it away
[22:19:00] <strcat> acrichto: http://ix.io/8na my attempt at finding it
[22:19:06] <strcat> failed to find the issue
[22:19:21] <acrichto> oh
[22:19:33] <acrichto> struct A(int); isn't immediate with a destructor
[22:19:36] <acrichto> b/c of the drop flag?
[22:19:40] <strcat> acrichto: because the drop flag makes it 2 words
[22:19:42] <strcat> ;]
[22:19:52] <acrichto> got it
[22:20:07] <acrichto> https://gist.github.com/alexcrichton/6875994
[22:20:13] <acrichto> the destructor runs twice
[22:20:21] <strcat> it's supposed to
[22:20:27] <strcat> but it's supposed to be zeroed the 2nd time
[22:20:38] <strcat> (it should be, it's only a rare case where this breaks)
[22:20:54] <strcat> the problem is that in some edge case, UnsafeArc *isn't* being zeroed
[22:21:01] <strcat> so the destructor is called a second time with a non-zero ptr
[22:21:08] <acrichto> oh hm yeah it's 0
[22:21:12] <acrichto> on the second one
[22:21:15] <strcat> yeah
[22:21:25] <strcat> that's what unsafe_no_drop_flag does
[22:21:31] <acrichto> I'm curious how that works...
[22:21:34] <acrichto> if it's an immediate
[22:21:34] <strcat> it exposes you to the zeroing directly
[22:21:39] <strcat> acrichto: cleanups ;p
[22:21:46] <strcat> it has to work for ~
[22:21:51] <strcat> acrichto: oh anyway it's broken
[22:21:58] <acrichto> but this is an immediate, so you can't say %n = 0
[22:22:01] <strcat> there's something in the drop glue that stores 0
[22:22:05] <acrichto> do we insert extra phi nodes or something?
[22:22:05] <strcat> hiding real bugs
[22:22:17] <strcat> acrichto: we go back and change stuff, yeah
[22:22:23] <strcat> look in common.rs
[22:22:26] <acrichto> oh locals are in alloca's aren't they
[22:22:27] <strcat> trans/common.rs
[22:22:29] <strcat> for cleanup
[22:23:11] <acrichto> oh nvmd we're not doing SSA at all, only allocas so I just don't know what I'm talking about
[22:23:40] <strcat> acrichto: anyway the drop glue stores 0 to the drop flag :(
[22:23:42] <strcat> which is wrong
[22:23:49] <strcat> but I think it's hiding real issues
[22:23:58] <strcat> was probably added at some point to "fix" a problem
[22:24:20] <acrichto> where *should* the drop flag get zero'd?
[22:24:41] <strcat> either we need to zero on moves, or handle it entirely via static analysis
[22:24:55] <strcat> we currently try to do the 1st
[22:25:08] <strcat> but apparently we don't do it right and added a store in the destructor glue as a workaround :s
[22:25:27] <acrichto> yeah that makes sense
[22:25:50] <strcat> acrichto: https://github.com/mozilla/rust/blob/master/src/librustc/middle/trans/glue.rs#L426 this is wrong
[22:26:02] <strcat> going to try removing it
[22:27:01] <acrichto> I tentatively agree
[22:27:20] <acrichto> although I imagine that any case I'm not thinking of is probably in a test somewhere
[22:27:25] <strcat> cmr: fwiw, I really don't think you should say people are hitting walls with the type system
[22:28:22] <strcat> I don't think it's true
[22:28:43] *** zz_kimundi is now known as kimundi
[22:29:22] <strcat> the only things missing that I can think of are frills like specifying lifetimes without borrowed pointers (but that can be worked around)
[22:29:58] <strcat> some people want optional parameters, keyword parameters, overloading, etc. but it's not necessary or universally wanted
[22:30:04] <strcat> and won't happen ;p
[22:30:18] <strcat> (for 1.0 at least, but I don't see it ever happening)
[22:37:14] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[22:37:58] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[22:42:17] <SiegeLord> It'd be nice if the people hitting issues wrote up a blog post about it...
[22:42:33] <SiegeLord> Or a mailing list letter
[22:42:35] <strcat> or a bug
[22:52:48] <strcat> acrichto: https://github.com/mozilla/rust/pull/9751 r? added the other thing
[22:53:18] <strcat> still not all the way through run-pass but I don't expect any problems
[22:53:26] *** Joins: tikue_ (tikue_star@80E31A8C.E6CB677E.689607DE.IP)
[22:53:30] <acrichto> strcat: that seems a bit more disturbing... where else is the drop flag zero'd?
[22:53:56] <strcat> acrichto: why is it disturbing?
[22:54:10] <strcat> the drop glue can't be responsible for zeroing because we have moves
[22:54:27] <acrichto> that seems like a very crucial part to dropping things and there's no tests one way or the other?
[22:54:28] <strcat> foo(x /* move */); /* must be zeroed */
[22:54:43] <acrichto> does moving currently zero things out?
[22:54:45] <strcat> yes
[22:54:47] <strcat> it has to
[22:54:51] <strcat> nothing would work if it didn't
[22:55:06] <acrichto> yeah I suppose
[22:55:10] <strcat> if foo zeroes the ptr, it doesn't matter, it's only zeroed in foo
[22:55:29] *** Quits: tikue_ (tikue_star@80E31A8C.E6CB677E.689607DE.IP) (Ping timeout)
[22:55:54] <strcat> there's a lot more weird cruft like this
[22:56:02] <strcat> our glue is very cargo-cult-y
[22:56:15] * strcat shrugs
[22:56:21] <strcat> very frustrating that I can't find the real issue ;p
[23:27:00] *** Joins: tikue_ (tikue_star@80E31A8C.E6CB677E.689607DE.IP)
[23:44:49] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[23:53:16] <benh> So, about those raw string literals...
[23:56:01] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[23:56:01] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14734b24b to 148eb28bb: 02http://git.io/N3iJvQ
[23:56:01] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[23:56:37] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[23:56:37] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14e2d41f2 to 148eb28bb: 02http://git.io/N3iJvQ
[23:56:37] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[23:56:39] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[23:56:39] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/w0HGOg
[23:56:39] <ghrust> 13rust/06auto 14a9fb88d 15Daniel Micay: rm special case for ty_struct from take glue...
[23:56:39] <ghrust> 13rust/06auto 14f56cf16 15Daniel Micay: stop zeroing the drop flag in drop glue...
[23:56:39] <ghrust> 13rust/06auto 14b17dc4a 15bors: auto merge of #9751 : thestinger/rust/immediate, r=alexcrichton...
[23:56:41] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[23:59:40] *** kimundi is now known as zz_kimundi
