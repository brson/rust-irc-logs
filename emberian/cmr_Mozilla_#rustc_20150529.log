[00:19:02] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[00:53:44] *** Joins: blank_na1e (blank_name@moz-pah0nm.mi.frontiernet.net)
[00:56:26] *** Quits: blank_name (blank_name@moz-f80.i34.36.50.IP) (Ping timeout: 121 seconds)
[01:02:08] *** kimundi is now known as zz_kimundi
[01:07:14] *** Quits: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com) (Ping timeout: 121 seconds)
[01:14:52] *** Joins: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com)
[01:14:52] *** ChanServ sets mode: +qo acrichto acrichto
[02:08:08] *** Joins: c74d3 (c74d3a4ebb6@moz-rhs0n6.mggc.hibn.4404.2002.IP)
[02:09:26] *** Quits: c74d (c74d3a4ebb6@moz-0ersgu.oc.cox.net) (Ping timeout: 121 seconds)
[02:09:45] *** c74d3 is now known as c74d
[02:14:49] *** Joins: Tuba (Tobba@moz-o13d22.bredband.telia.com)
[02:17:09] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[02:20:03] *** Tuba is now known as Tobba
[02:53:33] *** Quits: zz_kimundi (kimundi@moz-ch362e.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:56:06] *** Joins: zz_kimundi (kimundi@moz-68riih.dip0.t-ipconnect.de)
[02:56:08] *** zz_kimundi is now known as kimundi
[03:16:23] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[05:13:44] *** Joins: c74d3 (c74d3a4ebb6@moz-0ersgu.oc.cox.net)
[05:14:46] *** Quits: c74d (c74d3a4ebb6@moz-rhs0n6.mggc.hibn.4404.2002.IP) (Ping timeout: 121 seconds)
[05:15:22] *** c74d3 is now known as c74d
[06:42:42] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[07:25:00] *** Joins: Tobba (Tobba@moz-6oh.7ki.21.217.IP)
[07:33:41] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[08:03:18] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Connection closed)
[08:04:22] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[08:31:48] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[08:36:11] *** kimundi is now known as zz_kimundi
[08:52:34] *** Joins: laumann (thomas@moz-gqpfnm.science.ku.dk)
[09:12:31] *** zz_kimundi is now known as kimundi
[09:48:34] *** kimundi is now known as zz_kimundi
[09:56:57] *** zz_kimundi is now known as kimundi
[10:52:44] *** kimundi is now known as zz_kimundi
[11:47:25] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[12:19:05] *** Quits: Tobba (Tobba@moz-6oh.7ki.21.217.IP) (Ping timeout: 121 seconds)
[13:05:21] <doener> acrichto: what's the state on the llvm updatE?
[13:25:43] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[13:49:47] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[14:20:33] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[14:29:35] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[15:25:20] *** Joins: killercup (killercup@moz-723bo4.dip0.t-ipconnect.de)
[15:40:39] *** Quits: laumann (thomas@moz-gqpfnm.science.ku.dk) (Ping timeout: 121 seconds)
[15:41:52] *** Joins: laumann (thomas@moz-gqpfnm.science.ku.dk)
[15:43:16] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[15:52:17] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[15:56:30] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[15:59:54] *** Quits: [o__o] ([o__o]@moz-4s2t5k.compute-1.amazonaws.com) (A TLS packet with unexpected length was received.)
[16:02:11] *** Joins: [o__o] ([o__o]@moz-4s2t5k.compute-1.amazonaws.com)
[16:06:50] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[16:11:04] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[16:21:23] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[16:24:21] <acrichto> doener: stalled still :(
[16:24:33] <acrichto> doener: rebased yesterday but to no avail, same bug basically
[16:25:01] <doener> acrichto: which one? I don't recall
[16:25:39] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[16:26:19] <acrichto> doener: it just segfaults when building stage2 libcore
[16:26:25] <acrichto> e.g. the first compiler built with the new LLVM just insta-segfaults
[16:27:01] <acrichto> doener: https://gist.github.com/alexcrichton/3ecbc8f2ab8b25296c7f
[16:35:00] <doener> acrichto: the llvm branch on your github repo is uptodate?
[16:35:45] <acrichto> doener: yeah
[16:35:56] <acrichto> doener: https://github.com/alexcrichton/rust/tree/update-llvm is the WIP branch
[16:36:00] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[16:36:26] <acrichto> so far there was a change that I haven't updated yet, the NoFramePointerElim option moved or went away but I figured it'd be more helpful to get it building first :P
[16:38:53] <doener> acrichto: the referenced llvm commit is not in the repo
[16:39:58] <acrichto> doener: argh forgot to push the branch, now it should work
[16:40:05] <acrichto> push the rust branch that is
[16:40:14] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[16:41:07] <doener> acrichto: still nothing
[16:41:33] <doener> oh, missed the last line
[16:41:48] <doener> acrichto: yeah, works now
[16:43:54] <acrichto> \o/
[16:47:33] *** Quits: laumann (thomas@moz-gqpfnm.science.ku.dk) (Ping timeout: 121 seconds)
[16:49:34] *** Joins: laumann (thomas@moz-1f0.hq0.225.130.IP)
[16:50:33] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[16:54:48] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[16:56:13] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[17:00:26] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[17:10:03] <doener> acrichto: oh, interesting... it's writing through a dropped pointer
[17:10:46] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[17:15:01] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[17:25:22] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[17:29:34] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[17:39:55] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[17:40:47] *** Quits: laumann (thomas@moz-1f0.hq0.225.130.IP) (Ping timeout: 121 seconds)
[17:42:22] *** Quits: Luqman (laden@moz-bjmiqc.csclub.uwaterloo.ca) (Ping timeout: 121 seconds)
[17:44:08] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[17:48:49] *** Joins: laumann (thomas@moz-1f0.hq0.225.130.IP)
[17:52:06] *** Joins: Luqman (laden@moz-bjmiqc.csclub.uwaterloo.ca)
[17:54:29] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[17:58:43] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[18:01:58] *** Joins: Rym (y@moz-h2o.mso.205.31.IP)
[18:09:57] *** Quits: laumann (thomas@moz-1f0.hq0.225.130.IP) (Ping timeout: 121 seconds)
[18:10:09] *** Joins: laumann (thomas@moz-1f0.hq0.225.130.IP)
[18:17:42] *** Quits: laumann (thomas@moz-1f0.hq0.225.130.IP) (Ping timeout: 121 seconds)
[18:17:47] *** Joins: laumann (thomas@moz-1f0.hq0.225.130.IP)
[18:27:15] *** Quits: killercup (killercup@moz-723bo4.dip0.t-ipconnect.de) (Quit: Bye)
[18:36:57] <pnkfelix> nmatsakis: so, okay, I hacked the move_val_init intrinsic to trans directly into the dest
[18:37:20] <pnkfelix> nmatsakis: and that seems to successively avoid generating the temporary on the stack when you use that intrinsic directly
[18:37:31] <pnkfelix> nmatsakis: however, calling `ptr::write` still does the alloca.  :(
[18:38:24] *** Quits: laumann (thomas@moz-1f0.hq0.225.130.IP) (Quit: leaving)
[18:39:31] <pnkfelix> nmatsakis: `ptr::write` is already marked `#[inline]`; I suspect changing it to `inline(always)` won't help.  Do you know if there's some other relevant attribute we should be tagging `ptr::write` with?  (Or should I consider changing the box expansion to expand into `move_val_init` directly instead of having it call `ptr::write` ?
[18:49:39] <nmatsakis> pnkfelix: d'oh!
[18:50:20] <nmatsakis> pnkfelix: seems like calling move_val_init directly is ok
[18:57:39] *** Quits: Rym (y@moz-h2o.mso.205.31.IP) (Ping timeout: 121 seconds)
[19:15:36] <pnkfelix> nmatsakis: (I am basing my statements on inspecting `-O --emit=llvm-ir` ... I should also double-check the generated asm via `-O --emit=asm`)
[19:16:15] <pnkfelix> nmatsakis: also, it seems like it would be nice to figure out how to make `ptr::write` avoid the alloca just in terms of its other call-sites.  But, that need not block box, which has already been blocked for so long.  :)
[19:16:40] <nmatsakis> pnkfelix: yes to both; we do need to schedule some time to talk through the inference issues
[19:17:14] <pnkfelix> oh right.  yeah, lets try to address that next week.
[19:17:46] <pnkfelix> I'm just happy that I figured this `move_val_init` thing out; it was not a big change to trans.  I hope to have a PR up either tonight or tomorrow
[19:18:46] <nmatsakis> cool
[19:24:17] <doener> pnkfelix: what's that ptr::write/alloca thing about?
[19:25:22] <pnkfelix> It's for placement-new / box protocol
[19:26:19] <doener> ah
[19:32:29] <pnkfelix> basically the reason I delayed landing gh22086
[19:32:39] <pnkfelix> (hmm, no rust bot?)
[19:32:57] <pnkfelix> is because I discovered that the codegen for the protocol was not good enough
[19:33:01] <cmr> pnkfelix: I haven't been able to figure out how to enable the github plugin on [o__o]
[19:33:21] <pnkfelix> cmr: what happened to the old bot?
[19:33:29] <pnkfelix> doener: and the most obvious problem I saw with the codegen
[19:33:30] <cmr> What old bot?
[19:33:52] <pnkfelix> doener: was that it made an intermediate spot on the stack
[19:34:15] <pnkfelix> doener: for `<big-expr>` when doing `ptr::write(place, <big-expr>)`
[19:34:31] <pnkfelix> doener: e.g. `ptr::write(place, [value; 1000])`
[19:34:50] <pnkfelix> cmr: there was/is a bot that would emit a link to the PR/issue when one writes gh<issue-num>
[19:35:15] <pnkfelix> cmr: but I didn't see it react when I wrote gh22086 above
[19:35:24] <pnkfelix> oh oh!,  i'm in #rustc
[19:35:39] <cmr> pnkfelix: Yes, [o__o] is the bot that does that.
[19:35:50] <cmr> Oh, I see the confusion now.
[19:36:26] <pnkfelix> cmr: okay, so do we just need to tell `[o_o]` to do stuff in this channel too?
[19:36:41] <cmr> pnkfelix: I believe so, but I am not sure how.
[19:36:46] <cmr> [o__o]: plugins
[19:36:49] <cmr> [o__o]: help
[19:36:49] <[o__o]> Available plugins: logger, ping, last_seen, help, bangmotivate (https://botbot.me/mozilla/rustc/help/)
[19:36:51] <cmr> there's the list.
[19:37:00] <cmr> And in #rust-internals it has the "github" plugin
[19:37:29] <pnkfelix> I see
[19:38:10] <pnkfelix> cmr: how do you enable the other plugins?
[19:38:18] <cmr> pnkfelix: I do not know.
[19:44:12] <pnkfelix> nmatsakis: clearly we need to make our own inlining pass to solve this `ptr::write` thing.  ;)
[19:44:30] <nmatsakis> pnkfelix: it's sort of surprising
[19:44:35] <nmatsakis> that LLVM won't optimize it
[19:44:42] <nmatsakis> but also helps motivate the need for `in`
[19:44:43] <nmatsakis> ;)
[19:44:51] <pnkfelix> let me look at the generated asm before I make further accusations
[19:44:54] <nmatsakis> if it won't get optimized here
[19:44:59] <nmatsakis> it seems clear tha tit wouldn't get optimized
[19:45:02] <nmatsakis> when there's a malloc in between
[19:51:50] <pnkfelix> okay, asm shows the alloca as well
[19:55:44] <pnkfelix> For those who want to see it all: here the diff to rustc, the demo.rs, and the output .ll and .s : https://gist.github.com/pnkfelix/504fe7eaf108ad0d057e
[20:02:16] <nmatsakis> that's a lot of output :)
[20:02:32] <pnkfelix> nmatsakis: yeah, search for the string 'demo_'
[20:03:11] <pnkfelix> nmatsakis: e.g. demo_four is the "no-op" version, that shows what its like to alloc and then do nothing with it
[20:03:25] <pnkfelix> nmatsakis: while `demo_omega` is the so-called "ideal" that we are striving towards: true bux
[20:03:27] <pnkfelix> *box
[20:03:46] <pnkfelix> both of those are relatively short functions
[20:03:54] *** Joins: sigma (sigma@moz-k1ghg8.range109-153.btcentralplus.com)
[20:04:02] <nmatsakis> I see
[20:04:32] <pnkfelix> the alloca sticks out like a sore thumb on `demo_five`
[20:04:54] <pnkfelix> in the .ll file, its the first line: `  %0 = alloca [10000 x i8], align 1`
[20:05:12] <nmatsakis> yes
[20:05:15] <nmatsakis> demo_six/demo_omega look good
[20:05:39] <nmatsakis> which is I guess to be expected
[20:06:10] <pnkfelix> right.  But demo_six didn't look good before that rustc.diff
[20:06:25] <nmatsakis> c
[20:06:41] <pnkfelix> nmatsakis: by the way, I am thinking that this all may lead also to us needing to avoid the `let val = <expr>; unsafe { ... }` intermediate `val`
[20:06:58] <nmatsakis> what?
[20:07:07] <nmatsakis> "this all may lead also to us needing to avoid"?
[20:07:14] <nmatsakis> oh
[20:07:20] <nmatsakis> I had trouble parsing that at first
[20:07:21] <nmatsakis> but now I see
[20:07:21] <pnkfelix> we've been assuming that LLVM woul optimize
[20:07:24] <nmatsakis> yes
[20:07:26] <pnkfelix> but I'm now thinking
[20:07:30] <nmatsakis> sure
[20:07:35] <nmatsakis> it doesn't seem very good at that
[20:07:37] <pnkfelix> I should maybe starting thinking about putting in a macro
[20:07:42] <pnkfelix> `safe!(<expr>)`
[20:07:49] * nmatsakis sighs
[20:07:56] <pnkfelix> that is supported primitively by the compiler
[20:08:09] <pnkfelix> and inserts a safe block around <expr>`
[20:08:25] <pnkfelix> nmatsakis: we knew it might come to this, didn't we?  :)
[20:08:30] <nmatsakis> y
[20:08:38] <pnkfelix> another option
[20:08:44] <pnkfelix> would be safety hygiene
[20:08:56] <pnkfelix> but that would probably be a breaking change
[20:09:18] <pnkfelix> well, it would definitely be a breaking change
[20:09:29] <pnkfelix> Do you think people would want it?
[20:09:44] <pnkfelix> (I am assuming you know what I mean by "safety hygiene"
[20:10:16] <nmatsakis> I know what you mean
[20:10:19] <nmatsakis> and I don't know
[20:10:22] <nmatsakis> I certainly want it :)
[20:10:37] <pnkfelix> maybe put that on the docket for macros 2.0
[20:10:40] <nmatsakis> I guess macros could opt in for it
[20:10:49] <nmatsakis> but yes, it's certainly one of the kinds of things that one would want to fix
[20:10:59] <nmatsakis> along with other kinds of "extended hygiene"
[20:11:13] <nmatsakis> e.g., method resolution (traits in scope)
[20:11:21] <nmatsakis> item references
[21:07:04] *** Joins: Rym (y@moz-c2u.sd4.38.217.IP)
[21:39:55] *** Quits: sigma (sigma@moz-k1ghg8.range109-153.btcentralplus.com) (Ping timeout: 121 seconds)
[23:07:29] *** Quits: Rym (y@moz-c2u.sd4.38.217.IP) (Connection closed)
[23:07:50] *** Joins: Rym (y@moz-c2u.sd4.38.217.IP)
