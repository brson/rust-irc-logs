[00:00:18] <bjz> acrichto: gotta head out now
[00:00:28] <bjz> I'll fix those things when I get back
[00:00:29] <acrichto> bjz: sorry for the back and forth so much :(
[00:00:40] <acrichto> bjz: but otherwise r=me
[00:00:41] <bjz> also have to fix up the Integer PR
[00:00:47] <bjz> oh no, it's fine
[00:00:55] <bjz> mode some good improvements
[00:01:05] <bjz> *made
[00:01:26] <bjz> design critiques are very useful
[00:03:28] *** kimundi is now known as zz_kimundi
[00:16:51] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[00:16:51] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/oFxWgA
[00:16:51] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[00:21:50] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[00:21:50] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/gr_QuA
[00:21:50] <ghrust> 13rust/06auto 1434ffe3c 15Corey Richardson: rustc: support dumping the AST as JSON...
[00:21:50] <ghrust> 13rust/06auto 14879e8aa 15bors: auto merge of #12387 : cmr/rust/ast-json, r=alexcrichton...
[00:21:51] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[00:47:58] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[00:47:58] *** ChanServ sets mode: +o tjc
[00:56:03] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[00:58:53] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[01:00:00] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[01:00:14] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[01:02:41] *** Quits: eibwen (kvirc@moz-4A816755.dip0.t-ipconnect.de) (Ping timeout)
[01:19:11] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[01:29:51] <ChrisMorgan> Am I correct in thinking that the block type only gets used in for, if, else, else if, loop, while and fn?
[01:30:37] <ChrisMorgan> And thus, in a macro_rules macro there is no way to genuinely use a block as an expr, `if true $block` being insufficient because it only allows the block to result in ()?
[01:31:49] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[01:31:49] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/gr_QuA
[01:31:49] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[01:32:04] <sfackler> ChrisMorgan: I'd just use an $expr and do if true { $e }
[01:32:17] <sfackler> since blocks can be exprs
[01:32:29] <ChrisMorgan> sfackler: the macro *must* take a block.
[01:32:51] <ChrisMorgan> And I don't *want* the `if true` bit, that's just so that I can *use* the block.
[01:33:15] <sfackler> ah
[01:33:26] * ChrisMorgan is preparing a demonstration of the Result-based Iterator that he's about to propose
[01:34:20] * ChrisMorgan thinks something is needed so that you can use a block where an expr is wanted
[01:35:54] * ChrisMorgan gives up and uses expr instead of block â˜¹
[01:36:49] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[01:36:49] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/U1kJIw
[01:36:49] <ghrust> 13rust/06auto 148e6d50e 15Alex Crichton: Roll std::run into std::io::process...
[01:36:49] <ghrust> 13rust/06auto 144d299a3 15bors: auto merge of #12380 : alexcrichton/rust/run-rewrite, r=brson...
[01:36:49] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[01:36:51] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[01:36:51] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/VkD14Q
[01:36:51] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[01:37:05] <SiegeLord> Always need to copy that little smidge at the end of your messages to see if you're frowning or smiling :P
[01:38:48] <brson> acrichto: r? https://github.com/mozilla/rust/pull/12311
[01:39:20] <ChrisMorgan> SiegeLord: what, your IRC client doesn't render â˜º and â˜¹ correctly?
[01:39:25] *** Joins: erickt (Adium@moz-BDF423C7.hfc.comcastbusiness.net)
[01:39:40] <SiegeLord> They are about the size of an 'o'
[01:39:56] <SiegeLord> So I see the circle, two eyes and something under the eyes
[01:40:04] <SiegeLord> I suppose if I used a larger font...
[01:40:12] <ChrisMorgan> Ah. Bad font, bad font.
[01:40:19] <ChrisMorgan> Monospaced font?
[01:40:34] <SiegeLord> If I use a 40pt font, it looks ok XD
[01:41:01] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[01:41:22] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[01:41:22] *** ChanServ sets mode: +o tjc
[01:41:31] <SiegeLord> The font is Courier New, but who knows what replacement font is used for those characters
[01:42:51] * ChrisMorgan sighs at how poorly stock standard Unicode is supported in 2014
[01:43:11] * ChrisMorgan sighs at how poor monospaced fonts tend to be about Unicode support
[01:43:27] * ChrisMorgan sighs at people still using Comic Sans or Courier New ;-)
[01:43:53] <SiegeLord> Courier New is pretty :P
[01:45:50] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Quit: Leaving...)
[01:45:56] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[01:46:18] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[01:46:45] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[01:46:45] <ghrust> [13rust] 15bors 04force-pushed 06auto from 144d299a3 to 14879e8aa: 02http://git.io/N3iJvQ
[01:46:45] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[01:46:47] *** Joins: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP)
[01:46:47] <ghrust> [13rust] 15bors pushed 5 new commits to 06auto: 02http://git.io/JZIrrg
[01:46:47] <ghrust> 13rust/06auto 145d1b0cf 15Brian Anderson: std: Move intrinsics to std::intrinsics....
[01:46:47] <ghrust> 13rust/06auto 14af23904 15Brian Anderson: std: Move raw to std::raw...
[01:46:47] <ghrust> 13rust/06auto 1448ad4a3 15Brian Anderson: std: Remove unstable::lang...
[01:46:49] *** Parts: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP) ()
[01:47:22] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[01:47:49] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[01:47:49] *** ChanServ sets mode: +o tjc
[01:49:07] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[01:50:39] <brson> is bors a male or female?
[01:51:26] <cmr> it's a he according to wikipedia.
[01:51:30] <pnkfelix> acrichto: ping
[01:51:53] <pnkfelix> or actually, maybe anyone familiar with libnative can answer this question
[01:51:59] <brson> cmr: so he is
[01:52:08] <brson> i just called him a her on the issue tracker
[01:52:24] <tjc> well, the character that bors is based on is male
[01:52:30] <cmr> right
[01:52:31] <tjc> bors can be any gender people want bors to be :-)
[01:52:36] <acrichto> pnkfelix: pong
[01:53:41] <pnkfelix> acrichto: in an effort to better understand our embedding story
[01:53:54] * ChrisMorgan has always been partial to "it"
[01:53:56] <pnkfelix> acrichto: I've been playing with trying to load crates from other languages
[01:54:18] <ChrisMorgan> Or decide that "bors" is the pronoun for bors. :P
[01:54:29] <pnkfelix> acrichto: e.g. calling `native::start` with various callbacks
[01:55:28] <pnkfelix> acrichto: I guess my first question is: If I do `native::start(0, [], failing_proc)`
[01:55:41] <pnkfelix> acrichto: and then later I attempt to do `native::start` again in that same process
[01:55:57] <acrichto> oh dear, native::start twice probably ends badly
[01:56:01] <pnkfelix> acrichto: would you expect that to succeed, or fail?  Or currently indeterminate
[01:56:11] <pnkfelix> acrichto: okay I'll accept that answer.  :)
[01:56:13] <acrichto> I would recommend native::run() if you're doing it twice
[01:56:18] <acrichto> native::start the first time
[01:56:22] <acrichto> native::run each time afterwards
[01:56:33] <pnkfelix> acrichto: so the fail won't bring down the whole runtime?
[01:56:41] <acrichto> nah just the task
[01:56:46] <acrichto> as long as you're in a task
[01:56:46] <pnkfelix> acrichto: okay
[01:57:12] <pnkfelix> acrichto: but the native::start, that will create an independent task for the proc I give it?
[01:57:20] <pnkfelix> acrichto: or should I first call native::start with a no-op proc
[01:57:37] <pnkfelix> acrichto: and wait to pass failing_proc to a separate native::run invocation?
[01:59:00] <pnkfelix> acrichto: (the docs for `native::start` and `native::run` do not make these dstinctions clear, though I did assume from the code itself that something like this might be the case.)
[01:59:11] <acrichto> a no-op proc could possibly work, most people don't use native::run
[01:59:15] <acrichto> I would just avoid native::start twice
[01:59:18] <acrichto> well hm, no
[01:59:23] <acrichto> I'm not sure that this works at all
[01:59:35] <acrichto> native::start or basically runtime initialization should only happen once
[02:00:16] <pnkfelix> acrichto: what global state is being kept between the two calls that causes them to fail?
[02:00:39] <pnkfelix> acrichto: e.g. I was naively assuming that the second call to `native::start` would just initialize things freshly
[02:01:01] <acrichto> runtime has globals here and there
[02:01:09] <acrichto> I think things are torn down
[02:01:10] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[02:01:25] <acrichto> we could get something like this working, but it's generally not a recommended way to enter/exit the runtime
[02:01:28] <pnkfelix> acrichto: okay.  I will play with using `run` instead for the multiple calls
[02:01:40] <pnkfelix> acrichto: well maybe that's the important question
[02:01:44] <acrichto> we sadly don't have a great story for entering/exiting the runtime a lot
[02:01:47] *** Joins: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP)
[02:01:47] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14fdc4592 to 14879e8aa: 02http://git.io/N3iJvQ
[02:01:47] *** Parts: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP) ()
[02:01:50] *** Joins: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP)
[02:01:50] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/DbNg1Q
[02:01:50] <ghrust> 13rust/06auto 14cb3a419 15Eduard Bopp: libnum: Make RandBigInt trait public...
[02:01:50] <ghrust> 13rust/06auto 14ab362d7 15bors: auto merge of #12392 : aepsil0n/rust/fix/pub_randbigint, r=huonw...
[02:01:51] *** Parts: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP) ()
[02:02:14] <pnkfelix> acrichto: my actual gaol here is to be able to hook into the rustc crate from a Racket environmnet
[02:02:45] <pnkfelix> acrichto: but since rustc likes to react to problems by `fail!`ing
[02:02:55] <pnkfelix> acrichto: I need to deal with that shutting down the task
[02:03:09] <pnkfelix> acrichto: but that's okay, you already told me to use `run` alone, I will try that
[02:03:28] <pnkfelix> acrichto: My second question
[02:03:37] <pnkfelix> acrichto: Do you know much about the stack unwinding code?
[02:03:42] <acrichto> I do indeed
[02:04:07] <pnkfelix> acrichto: I've been trying to understand where things go wrong for me
[02:04:09] <ChrisMorgan> acrichto: people are clamouring for early exit and often jumping for libc::exit(). That's a bad idea, right? I think we need an official answer on the matter, my guess being a function which will cause normal unwinding of all tasks and *then* call exit.
[02:05:09] <acrichto> ChrisMorgan: libc::exit() is a bad idea because it doesn't run destructors (generally cleans up resources), but injecting failure is something that's not currently that feasible for tasks
[02:05:19] <acrichto> you can't just request that a task fails if it's blocked in libc::read
[02:05:30] * ChrisMorgan was afraid of that
[02:05:33] <pnkfelix> acrichto: When a task fails, does it know before unwinding what the stack extent is of the stack itself?  And if so, does it attempt to verify that the stack is well-formed before unrolling?
[02:05:49] <pnkfelix> acrichto: I ask because I am not seeing a destructor being invoked
[02:06:01] <acrichto> pnkfelix: it unwinds through libunwind, so as long as the stack isn't corrupted up to the "catch frame" it should unwind naturally
[02:06:14] <ChrisMorgan> Your explanation of why libc::exit() is a bad idea is exactly what I've explained in a couple of places, but it keeps on springing up in more places â˜¹
[02:06:33] <pnkfelix> acrichto: but if there is any frame that is corrupted, all bets are off?
[02:06:49] <acrichto> pnkfelix: although libunwind uses dwarf information to unwind the stack so it may not be getting the dwarf info somewhow
[02:06:52] <pnkfelix> acrichto: or is it reasonable to expect that all destructors up to the corrupted frame will getrun ?
[02:06:58] <acrichto> yeah stack corruption means everything goes home
[02:07:07] <acrichto> it probably means that nothing gets run
[02:07:13] <pnkfelix> acrichto: Hmm.  okay.
[02:07:38] <pnkfelix> acrichto: In this case, I'm interpreting "stack corruption" as including "non-standard stack layout"
[02:07:59] <pnkfelix> acrichto: though that may be an overly pessimistic interpretation, since we'll presumably have to deal with that for IonMonkey...
[02:08:09] <acrichto> pnkfelix: if it's striaght rust to rust it should be fine, but C/C++ in the middle of rust could mess with it
[02:08:20] <pnkfelix> acrichto: in this case, its Racket JIT frames, I think.
[02:08:35] <pnkfelix> acrichto: although I hadn't considered that there might be "just" C++ in the middle too
[02:08:46] <acrichto> we generally have undefined behavior if you're unwinding across something other than rust
[02:09:07] <pnkfelix> acrichto: yeah that's sort of what I expected, but I don't know what to do to deal with it
[02:09:21] <pnkfelix> acrichto: create fresh tasks at the FFI boundaries?
[02:09:39] <acrichto> that's the current solution (which is bad), but I hope to get around to designing a better solution
[02:09:58] <acrichto> entering in/out of of FFI is currently not a great story
[02:10:04] <acrichto> you basically have to allocate a Task everywhere
[02:10:20] <pnkfelix> acrichto: well, it may be bad, but at least it is *something*.  Do you have proof-of-concept example for any language sitting around anywhere?
[02:10:30] <acrichto> hmm..
[02:10:31] <acrichto> wycats: ping
[02:10:32] <pnkfelix> acrichto: if not, I'll keep trying to hack up my own
[02:10:50] <acrichto> wycats has done a bunch of work in this area, not sure if he's got code available to look at though
[02:15:47] <wycats> I have code
[02:15:55] <wycats> Currently on my phone though
[02:16:19] <wycats> You should look at the ffi_fn! Macro I wrote for skylight
[02:16:20] <pnkfelix> wycats: No rust.  I'm about to hit the sack anyway.
[02:16:31] <pnkfelix> wycats: sed -e s/No rust/No rush/
[02:16:56] <ChrisMorgan> pnkfelix: needs to be quoted, surely.
[02:19:28] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[02:19:30] <pnkfelix> wycats: which github repo in https://github.com/wycats should I be looking in?  Don't see skylight there
[02:20:27] <pnkfelix> wycats: (well, you are on phone anyway.)
[02:20:45] <pnkfelix> wycats: (if you can send a ptr to my email @mozilla, I'd appreciate it)
[02:21:09] <cmr> wycats: https://gist.github.com/wycats/8703114
[02:21:21] <cmr> erm
[02:21:23] <cmr> pnkfelix: https://gist.github.com/wycats/8703114
[02:21:43] <wycats> pnkfelix: I wouldn't mind chatting tomorrow
[02:21:55] <wycats> Maybe we can start getting some into core
[02:22:19] <pnkfelix> wycats: k, maybe tomorrow.
[02:22:21] *** Quits: sunfish (chatzilla@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[02:24:16] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[02:24:16] *** ChanServ sets mode: +o tjc
[02:32:45] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: Textual IRC Client: www.textualapp.com)
[02:36:24] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[02:36:24] *** ChanServ sets mode: +o tjc
[02:46:23] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[02:49:45] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[02:52:25] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Ping timeout)
[02:55:46] *** Quits: ggherdov_ (sid11402@moz-E77DEB21.irccloud.com) (Ping timeout)
[02:55:46] *** Quits: angdev (uid7041@moz-E77DEB21.irccloud.com) (Ping timeout)
[02:56:49] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[02:56:49] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14ab362d7 to 14879e8aa: 02http://git.io/N3iJvQ
[02:56:49] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[02:56:49] *** Joins: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP)
[02:56:50] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/iGQGvg
[02:56:50] <ghrust> 13rust/06auto 1433923f4 15Patrick Walton: librustc: Remove unique vector patterns from the language....
[02:56:50] <ghrust> 13rust/06auto 1425aeaf1 15bors: auto merge of #12244 : pcwalton/rust/deuniquevectorpatterns, r=pcwalton...
[02:56:50] *** Parts: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP) ()
[02:57:12] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[02:57:53] *** Joins: ggherdov_ (sid11402@moz-E77DEB21.irccloud.com)
[02:58:25] *** Quits: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com) (Quit: pcwalton)
[02:58:58] *** Joins: angdev (uid7041@moz-E77DEB21.irccloud.com)
[03:00:48] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[03:15:21] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[03:17:54] *** Joins: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net)
[03:37:33] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[03:41:11] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[03:43:56] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[03:46:56] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[03:46:56] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/HysTWg
[03:46:56] <ghrust> 13rust/06auto 14cb3a419 15Eduard Bopp: libnum: Make RandBigInt trait public...
[03:46:56] <ghrust> 13rust/06auto 14cfb7f16 15bors: auto merge of #12392 : aepsil0n/rust/fix/pub_randbigint, r=huonw...
[03:46:56] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[03:46:57] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[03:46:57] <ghrust> [13rust] 15bors 04force-pushed 06auto from 1425aeaf1 to 14879e8aa: 02http://git.io/N3iJvQ
[03:46:57] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[03:49:52] *** Quits: zz_kimundi (kimundi@moz-73713BC5.dip0.t-ipconnect.de) (Ping timeout)
[03:53:36] *** Joins: zz_kimundi (kimundi@moz-767272DB.dip0.t-ipconnect.de)
[03:53:37] *** zz_kimundi is now known as kimundi
[03:56:08] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[04:01:02] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[04:01:02] *** ChanServ sets mode: +o tjc
[04:07:26] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[04:12:20] *** Quits: arrdem (arrdem@moz-2E1DB1F9.ece.utexas.edu) (Ping timeout)
[04:12:29] *** Joins: arrdem (arrdem@moz-2E1DB1F9.ece.utexas.edu)
[04:12:49] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[04:13:00] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[04:13:01] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[04:13:01] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[04:13:48] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[04:13:50] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[04:17:31] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[04:18:31] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[04:18:47] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[04:20:18] *** Joins: andrew-__ (andrew-d_w@moz-5A92CAFF.dsl.static.sonic.net)
[04:20:32] *** Quits: andrew-__ (andrew-d_w@moz-5A92CAFF.dsl.static.sonic.net) (Input/output error)
[04:21:18] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Ping timeout)
[04:38:56] <nrc> hmm
[04:39:33] <nrc> if `trait B : A`
[04:40:01] <nrc> I though `~B` is a subtype of `~A`, but it appears not to be
[04:40:12] <nrc> *thought
[04:40:20] <nrc> so trait inheritance does not give subtyping?
[04:41:09] <strcat> not yet, it should
[04:41:12] <cmr> rusti: trait A {} trait B : A {} impl A for int {} impl B for int {} let x: ~B = ~42i as ~B; x as ~A
[04:41:16] -rusti- <anon>:10:95: 10:102 error: can only cast an ~-pointer to a ~-object, not a trait main::B
[04:41:16] -rusti- <anon>:10         trait A {} trait B : A {} impl A for int {} impl B for int {} let x: ~B = ~42i as ~B; x as ~A
[04:41:16] -rusti-                                                                                                         ^~~~~~~
[04:41:17] -rusti- error: aborting due to previous error
[04:41:18] -rusti- application terminated with error code 101
[04:41:53] *** Joins: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP)
[04:41:53] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14cfb7f16 to 14879e8aa: 02http://git.io/N3iJvQ
[04:41:53] *** Parts: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP) ()
[04:41:54] *** Joins: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP)
[04:41:54] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/V5GhZA
[04:41:54] <ghrust> 13rust/06auto 14dcee327 15Huon Wilson: rustc: remove some unnecessary `transmute`s....
[04:41:54] <ghrust> 13rust/06auto 14801f8f6 15bors: auto merge of #12394 : huonw/rust/transmute--, r=pnkfelix...
[04:41:54] *** Parts: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP) ()
[04:42:37] <cmr> nrc: iirc the only subtyping is in lifetimes
[04:43:06] <nrc> oh
[04:43:35] <nrc> I was sure trait objects gave subtyping, possibly only with `as`
[04:43:45] <nrc> how was I so wrong?
[04:44:44] <erickt> acrichto: ping
[04:45:06] <acrichto> erickt: pong
[04:45:30] <erickt> updated https://github.com/mozilla/rust/pull/11863 to swap StreamState with Writer, among other things
[04:45:49] <erickt> I also removed the ability to hash floats, which may or may not be a good idea :)
[04:46:02] <acrichto> cool, I'll take a look
[04:46:31] <nrc> so impls give subtyping, but trait inheritance does not?
[04:46:47] <cmr> where do impls create subtypes?
[04:46:53] <erickt> acrichto: brson and I were talking about it last night. he pointed out since floats don't implement TotalOrd they might not be storable in a HashMap, or something
[04:47:09] <cmr> X<'a> <: Y<'b> iff 'a <= 'b, but I don't think there are any other situations...
[04:47:12] <erickt> acrichto: I don't quite recall his argument
[04:47:16] <nrc> heh, I found "Note: Trait inheritance does not actually work with objects yet" in the tutorial, I must ahve missed that on first reading
[04:47:48] <acrichto> erickt: yeah we have some weirdness with floats and ord/totalord whatnot now
[04:48:15] <nrc> cmr: 'impl A for B {...}` then A <; B. no?
[04:48:15] <erickt> acrichto: although I don't see hashmap.rs make any reference to TotalOrd...
[04:48:22] <strcat> erickt: it's okay to be able to hash floats
[04:48:30] <strcat> erickt: HashMap is supposed to use TotalEq
[04:48:32] <strcat> it's buggy
[04:48:39] <strcat> anyway it's a complete mess.
[04:48:51] <cmr> nrc: not really, since B isn't a type.
[04:49:02] <erickt> strcat: do you mean it's okay to not support hashing floats?
[04:49:12] <nrc> cmr: ~A <: ~B 
[04:49:15] <nrc> ?
[04:49:16] <strcat> erickt: no, I mean it's okay to implement hashing for floats
[04:49:26] <cmr> nrc: pointers-to-A are *coercible* to pointers-to-B, but I'm not sure if that implies subtyping
[04:49:28] <cmr> ?
[04:49:30] <cmr> it might.
[04:49:30] <strcat> erickt: the Eq/TotalEq thing isn't relevant to whether they can be hashed
[04:49:33] <cmr> They didn't use to coerce.
[04:49:40] <cmr> but they still exhibited the same behavior via as
[04:50:01] <erickt> strcat: the trouble we're running into is that the old hashing lib has a special case to hash 0.0 and -0.0 to the same value
[04:50:01] <strcat> erickt: https://github.com/mozilla/rust/issues/10320 that's about changing how it's done
[04:50:29] <strcat> erickt: 0.0 and -0.0 don't need to hash to the same value
[04:50:46] <nrc> cmr: I will experiment...
[04:50:46] <strcat> erickt: there's already an open bug about HashMap not using TotalEq even though it's supposed to
[04:50:54] <cmr> nrc: report back :)
[04:51:06] <strcat> erickt: you can implement hashing for floats, and you don't need to special-case 0.0 and -0.0
[04:51:14] <strcat> erickt: it's not something hashing has to deal with
[04:51:16] <erickt> strcat: with my new framework, if we want to use a `Writer` value as the thing we hash against, it'd require copy-pasting code to get 0.0 and -0.0's hash to equal
[04:51:27] <strcat> erickt: they don't have to be equal
[04:51:31] <erickt> strcat: that was the other option :)
[04:51:39] <strcat> erickt: HashMap not using TotalEq is a known bug already
[04:51:41] <strcat> with an issue open
[04:52:15] <erickt> thanks for the issue reference. I'll cc it into mine
[04:52:32] <strcat> erickt: https://github.com/mozilla/rust/issues/5283
[04:52:35] <strcat> erickt: the TotalEq one
[04:52:39] <nrc> cmr: no coercion needed
[04:53:04] <nrc> trait A {}
[04:53:05] <nrc> struct B;
[04:53:06] <nrc> impl A for B {}
[04:53:08] <strcat> the issue I linked above is about changing Eq/Ord to mean total ordering, and making the built-in comparison operators on floats use the IEEE754 total ordering
[04:53:08] <nrc> fn test0(x: ~B) {
[04:53:09] <nrc>     let y: ~A = x;
[04:53:11] <nrc> }
[04:53:19] <strcat> but regardless of whether that happens, HashMap *has* to use TotalEq
[04:53:29] <cmr> nrc: right, that didn't used to be valid. That is coercion?
[04:53:39] <cmr> you used to need `x as ~A`
[04:54:23] <nrc> I seem to remember the need for `as` disappearing
[04:54:34] <cmr> it did.
[04:54:37] <cmr> that's what I'm saying
[04:54:47] <cmr> there is coercion now, instead of requiring explicit casting.
[04:55:40] <acrichto> erickt: this looks aweosme
[04:55:42] <acrichto> awesome*
[04:55:44] <erickt> woot
[04:56:09] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[04:58:01] <nrc> why does a struct object not get a Send bound?
[04:58:17] <acrichto> nrc: some component of the type isn't Send
[04:58:25] <acrichto> we need to give better errors on that :(
[04:58:34] <nrc> acrichto: the struct is empty
[04:58:57] <acrichto> nrc: that's disturbing!
[04:59:18] <nrc> "kind bounds can only be used on trait types"
[04:59:22] <nrc> I am confused
[04:59:51] <strcat> nrc: an empty struct is Send
[05:00:33] <acrichto> nrc: code?
[05:00:43] <strcat> something is only non-Send if it contains a type marked with the NoSend marker 
[05:01:58] <nrc> `struct B; n test(x: ~S<~B>) {...}` a type error about `x` gives the type `~S<~B>:Send`
[05:02:05] <nrc> s/n/fn
[05:02:15] <strcat> what is S?
[05:02:29] <nrc> trait S<T> {...}
[05:02:47] <strcat> the type parameter to the trait is unrelated to it being Send or not
[05:02:58] <nrc> With trait A, I get ~S<~A:Send>:Send
[05:03:17] <acrichto> nrc: oh trait objects have a :Send bound by default
[05:03:22] <nrc> I wonder why the A is send but A is not
[05:03:35] <strcat> nrc: the struct is Send, only trait objects and closures have kind bounds
[05:04:09] <strcat> if rust knows actual type, kind bounds wouldn't add information
[05:04:12] <nrc> strcat: so it 'is' `Send` but does not ahve the `Send` bound?
[05:04:28] <strcat> nrc: there is no such thing as a bound on things that aren't trait objects or closures
[05:04:44] <strcat> if rust knows the actual type, it knows which traits it implements without bounds
[05:06:04] <nrc> hmm
[05:06:14] <acrichto> erickt: curious about what you think: https://github.com/mozilla/rust/pull/11863#issuecomment-35589693
[05:06:22] <erickt> acrichto: what do you think we should call the value that's threaded through all the `.hash()` methods? a `hasher`? `state`? If we rename `HasherFactory` back to `Hasher`, it might be odd calling that argument `hasher`
[05:06:34] <strcat> nrc: the only reason bounds exist for closures and trait objects is because the types contained inside are unknown
[05:06:35] <acrichto> erickt: state
[05:06:39] <erickt> ok
[05:06:51] <strcat> nrc: so it provides a way to restrict the contained types to those satisfying those kinds, without knowing what they are
[05:07:11] <nrc> it seems to be our system of having distinct subtyping, coercion, and subsumption but making these look kind of the same via sugar is pretty nasty
[05:07:17] <nrc> s/be/me
[05:07:41] <strcat> trait objects and closures as nasty as implemented
[05:07:49] <erickt> acrichto: we could do that. Did you see my explanation of why I removed it in here? https://github.com/mozilla/rust/pull/11863#issuecomment-35589632 
[05:08:11] <acrichto> erickt: it sounded like you removed it b/c it wasn't possible in this framework?
[05:08:16] <strcat> I don't think trait bounds should be a thing
[05:08:34] <nrc> So a trait type T with bound B is really an existential with two upper bounds - the trait and the bound
[05:08:50] <strcat> trait bounds are redundant because you can say...
[05:08:57] <strcat> Foo: Send
[05:08:59] <strcat> but you can also say...
[05:09:10] <erickt> acrichto: It's possible. I thought about your solution, copy-pasting, removing this special case, and removing floats :)
[05:09:16] <strcat> trait Bar: Foo + Send {} impl<T: Foo + Send> Bar for T {}
[05:09:38] <strcat> it's odd to have the special-cased syntax for kinds, rather than a general purpose sugar for that
[05:10:03] <strcat> because we already have the functionality required to do it without the sugar, but the sugar only works for Send/Freeze/Sized instead of everything
[05:10:03] <acrichto> erickt: oh I didn't realize f32 had no hashing at all, shouldn't it stay in some form or another for #[deriving(Hash)] ?
[05:10:12] * nrc would support a more general sugar
[05:10:25] <strcat> nrc: closures are a mess though
[05:10:31] <nrc> the succinctness of the first vs the second makes me glad we ahve _something_
[05:10:42] <erickt> acrichto: I think though that if we still want to hash floats, I'm leaning towards removing the special case. there is a reason why -0.0 exists, so it probably should have a different hash value
[05:10:50] <strcat> nrc: well, we have something for Send/Freeze but not other traits
[05:11:05] <acrichto> erickt: shipipt
[05:11:08] <acrichto> shipit*
[05:11:11] <erickt> :)
[05:11:13] <strcat> so essentially, a special case was hard-wired into the language because a library needed it
[05:11:28] <strcat> rather than a general purpose feature
[05:11:48] <erickt> strcat: do you remember the library?
[05:12:11] <nrc> acrichto, strcat: thanks for the help! Got to pop out now, biab
[05:12:15] <strcat> the bounds exist for a library implementation of concurrency to use
[05:12:22] *** nrc is now known as nrc|afk
[05:12:29] *** Quits: Sharp (Sharp@moz-3301C7AB.static-ip.telepacific.net) (Quit: Sharp)
[05:12:30] <strcat> that's really the only thing you would use either a Send or Freeze bound for
[05:12:55] <strcat> it's an ugly part of the language, but that's how trait objects and closures are as a whole
[05:13:30] <strcat> needing to make impls for ~Trait, &mut Trait, etc. is also incredibly painful
[05:13:37] <strcat> maybe DST will fix that, dunno
[05:13:57] <strcat> atm you can't use trait objects with generic functions
[05:14:01] <strcat> so they're not orthogonal at all
[05:14:33] <strcat> you use either generics or trait objects, unless the library went through the trouble of doing impls for &Trait, &mut Trait and ~Trait
[05:14:45] <strcat> which would be implemented for nearly every trait...
[05:19:01] *** Quits: new_one (new_one@75512748.6D46D672.B3C0173E.IP) (Quit: leaving)
[05:20:40] <erickt> acrichto: i wasn't quite sure what to do about hashing a pointer. I'm not crazy about .write_ptr because there are so many different ways we could do it
[05:20:57] <acrichto> erickt: why not just have the hash impl call write_uint?
[05:20:59] <erickt> acrichto: maybe I should rename it to `.write_le_ptr()`
[05:21:03] <erickt> acrichto: or that
[05:21:12] <erickt> I think I'll do that for now
[05:21:24] <acrichto> k
[05:22:45] <erickt> acrichto: what do you think about setting `#[allow(default_type_param_usage)]` by default?
[05:23:06] <acrichto> erickt: by default for clients?
[05:23:09] <erickt> yeah
[05:23:20] <cmr> I'm against that for as long as there's a gate for default typarams.
[05:23:31] <acrichto> it rqeuires a feature gate
[05:23:32] <erickt> i don't want to fold it into this PR, but we've got the gate for declaring default type params, that might be enough
[05:23:35] <acrichto> so I don't think we should do it
[05:23:53] <acrichto> substituting a default type parameter is also gated
[05:24:43] *** Joins: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net)
[05:26:38] *** Quits: Diamond (dick@moz-80556682.ks.ks.cox.net) (Ping timeout)
[05:26:39] <cmr> erickt: the idea is that anything not using the gate will continue to work seamlessly if the feature is removed...
[05:27:01] *** Joins: Diamond (dick@moz-80556682.ks.ks.cox.net)
[05:28:01] <acrichto> erickt: re the doctest, why isn't it possible to remove #[allow(default_type_param_usage)] ?
[05:28:14] <acrichto> I would hope that you don't need the attribute to 'impl Hash' ?
[05:29:20] <erickt> acrichto: I would like that too, but the default_type_param_usage lint is set to deny by default
[05:29:38] <acrichto> erickt: can't you do "impl Hash" though?
[05:29:41] <acrichto> with no type parameters
[05:29:58] <acrichto> if you use the defaults it shouldn't trigger the gate
[05:33:16] <erickt> acrichto: oh, you're right. fixing
[05:37:48] <erickt> acrichto: I pushed up I think all the fixes
[05:38:20] <acrichto> impl Hash<S> for Person
[05:38:26] <acrichto> impl Hash for Person <- ?
[05:38:46] <erickt> oops :)
[05:39:22] <erickt> acrichto: fixed :)
[05:40:18] <acrichto>  // NB: raw-pointer IterBytes does _not_ dereference
[05:40:20] <acrichto> haha
[05:40:27] <erickt> ugh
[05:40:48] <erickt> death by papercut
[05:40:48] <acrichto> no worries
[05:40:53] <acrichto> don't even bother
[05:40:56] <erickt> hehe
[05:41:07] <erickt> well I need to squash anyway, I'll make sure to include that
[05:42:01] *** Joins: edwardw (edwardw@E6E87FA7.354F6412.B9C6B12A.IP)
[05:42:39] *** Joins: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP)
[05:43:12] <erickt> acrichto: I need to head to bed now, assuming it looks good, my `make check` succeeds, and you give me a r=acrichto, I'll squash all this down in the morning so there's just one commit that adds this new module
[05:43:15] <erickt> ack!
[05:43:27] <acrichto> erickt: this looks fantastic
[05:43:33] <acrichto> erickt: I'm going to write up some minor comments
[05:43:38] <acrichto> everything here on out can be addressed in a follow up
[05:45:05] <erickt> woot. btw, just pushed up some of those typo fixes
[05:45:18] <erickt> just because
[05:45:26] *** Quits: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP) (Ping timeout)
[05:45:34] <erickt> thanks for all the help with this!
[05:45:40] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[05:45:40] *** ChanServ sets mode: +o tjc
[05:45:45] <erickt> and I can't wait to wash my hands of all this mess!
[05:45:50] <acrichto> erickt: and thank you for all this!
[05:46:16] <erickt> :) gnight!
[05:46:31] *** nrc|afk is now known as nrc
[05:46:52] <acrichto> night!
[05:50:19] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Ping timeout)
[05:51:54] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[05:51:54] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/V5GhZA
[05:51:54] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[05:54:55] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[05:54:55] *** ChanServ sets mode: +ao pcwalton pcwalton
[05:56:55] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[05:56:55] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/p-aARw
[05:56:55] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[05:56:56] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[05:56:56] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/7GFg9Q
[05:56:56] <ghrust> 13rust/06auto 1433923f4 15Patrick Walton: librustc: Remove unique vector patterns from the language....
[05:56:56] <ghrust> 13rust/06auto 140cc8ba0 15bors: auto merge of #12244 : pcwalton/rust/deuniquevectorpatterns, r=pcwalton...
[05:56:56] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[05:59:22] <cmr> pcwalton: does that remove matching against slices too?
[05:59:30] <pcwalton> no
[05:59:33] <cmr> ok.
[06:09:32] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[06:11:46] *** Joins: lpy (lpy@7360AA58.F09091A8.1348A864.IP)
[06:18:38] *** Joins: cmr (moznet@moz-EC676DFE.members.linode.com)
[06:25:14] *** Quits: edwardw (edwardw@E6E87FA7.354F6412.B9C6B12A.IP) (Input/output error)
[06:25:56] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Ping timeout)
[06:27:35] *** Joins: zimbabao (rajaram@47769425.AE842F9B.81C3DAA1.IP)
[06:29:57] *** Joins: edwardw_ (edwardw@ECB36E22.A26CCAD9.99A56FDE.IP)
[06:31:00] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[06:33:09] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[06:37:53] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[06:43:43] *** Joins: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP)
[06:46:51] *** Joins: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro)
[06:51:50] *** Quits: erickt (Adium@moz-BDF423C7.hfc.comcastbusiness.net) (Quit: Leaving.)
[06:53:53] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[06:53:53] *** ChanServ sets mode: +o tjc
[06:54:52] <edwardw_> Some comments talks about "MBE macro". What is it?
[06:55:08] *** edwardw_ is now known as edwardw
[06:55:28] <edwardw> s/talks/talk
[06:56:09] *** Quits: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP) (Client exited)
[06:56:56] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[07:01:23] *** Joins: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP)
[07:02:06] <nrc> can lifetime parameters have bounds?
[07:02:12] <sfackler> edwardw: macro by example, another name for macro_rules! defined macros
[07:02:26] <eddyb> nrc: nope
[07:02:34] <edwardw> sfackler: gotcha
[07:03:19] <eddyb> but <'a, 'b :< 'a> might work just as well with <'a>
[07:04:08] <nrc> so, subtyping is covariant wrt some relation on lifetimes, what is that relation, and how is it expressed?
[07:04:23] <eddyb> nrc: read the borrowck doc or ask nmatsakis
[07:04:55] <eddyb> there's also some nice comments on the variance marker types
[07:05:02] <eddyb> (std::marker if I'm not wrong)
[07:05:44] * nrc searches for docs and comments
[07:05:46] <nrc> thanks!
[07:05:52] *** Joins: bjz (bjz@moz-38D46E1C.perm.iinet.net.au)
[07:06:25] <eddyb> nrc: if you happen to spend time with nmatsakis IRL, I highly suggest having a whiteboard around :P
[07:06:56] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[07:06:56] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/7GFg9Q
[07:06:56] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[07:07:33] <eddyb> other information sources may be more cryptic. anyways
[07:11:02] <eddyb> nrc: earlier, I was speaking from experience, that you can "group together" different lifetimes, as the shortest one out of all of them
[07:11:52] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[07:11:52] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/OCgvkg
[07:11:52] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[07:12:41] <eddyb> but I don't know if you're just having lifetime troubles, trying to build a contraption, rendering lifetimes for DXR or something else
[07:15:45] <nrc> eddyb: oh, nothing so practical :-p trying to come up with test cases where we actually use lieftime-variant subtyping
[07:19:49] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[07:19:58] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[07:21:50] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[07:21:50] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14e3badaf to 140cc8ba0: 02http://git.io/N3iJvQ
[07:21:50] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[07:21:54] *** Joins: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP)
[07:21:54] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/0fzMhA
[07:21:54] <ghrust> 13rust/06auto 14cb3a419 15Eduard Bopp: libnum: Make RandBigInt trait public...
[07:21:54] <ghrust> 13rust/06auto 14b5e3573 15bors: auto merge of #12392 : aepsil0n/rust/fix/pub_randbigint, r=huonw...
[07:21:55] *** Parts: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP) ()
[07:23:48] <eddyb> apparently chrome uses 500MB without any pages open :(
[07:24:14] <eddyb> well, there's AdBlock being stupid
[07:26:32] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[07:32:27] *** Quits: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net) (Ping timeout)
[07:34:04] *** Joins: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net)
[07:36:10] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[07:47:00] *** flaper87|afk is now known as flaper87
[07:53:00] *** Joins: andrew-d_w (andrew-d_w@moz-17320F4E.hsd1.ca.comcast.net)
[07:53:06] *** Quits: andrew-d_w (andrew-d_w@moz-17320F4E.hsd1.ca.comcast.net) (Input/output error)
[07:53:30] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[07:57:49] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[07:59:59] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Input/output error)
[08:00:25] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[08:02:30] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[08:03:01] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[08:04:04] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[08:04:19] *** Joins: Zr40 (zr40@EE4BB9F5.926C319A.BE2F4011.IP)
[08:04:30] *** Quits: edwardw (edwardw@ECB36E22.A26CCAD9.99A56FDE.IP) (Quit: Leaving...)
[08:05:27] <ChrisMorgan> eddyb: cool people use Firefox. Especially cool people on irc.mozilla.org. ;-)
[08:07:22] <eddyb> yay, IrrefutablePatternBindingMode is gone
[08:07:26] <Yurume> chrome really fails to manage its memory efficiently on middle- or low-end machines
[08:07:37] <strcat> chromium --single-process, then ;p
[08:07:53] <Yurume> what, were there such flag? :o
[08:07:53] <eddyb> strcat: I've never heard that tip before... does it really work better?
[08:08:00] <Yurume> s*
[08:08:08] <strcat> Yurume: http://www.chromium.org/developers/design-documents/process-models
[08:08:13] <strcat> sure, you pick the process model
[08:08:41] <Yurume> strcat: I didn't know the model is customizable, I'll try that latter :p
[08:08:52] <eddyb> though I'd have to switch on the fan at maximum speed again to prevent the laptop from reaching 90Â° in a couple seconds
[08:09:07] <eddyb> this is molten chrome :P
[08:09:24] <eddyb> (that is, if I want to restart chrome again)
[08:09:40] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[08:09:43] <strcat> by default there's a process per extension, process per site instance, etc.
[08:10:13] <strcat> anyway I switched away from ffx recently...
[08:11:47] <eddyb> chrome was our savior, many winters ago. now it's yet another stumbling giant
[08:12:21] <strcat> well it uses a lot of memory due to the sandboxing model
[08:12:31] <eddyb> I didn't actually realize that
[08:12:48] <eddyb> ok, let's give it a try
[08:13:02] <strcat> each site instance is in a process with namespaces + seccomp
[08:13:12] * eddyb does killall -KILL chrome
[08:13:20] <strcat> so are extensions (they have granular permissions)
[08:13:38] <strcat> and flash + the pdf plugin are just nacl applications...
[08:13:45] <strcat> they have no privs beyond a normal site
[08:14:25] <strcat> no other browser actually *sandboxes* flash, they just run it out-of-process (well, opera does since opera is chrome now ;\)
[08:14:36] <eddyb> ooops, and this is why I don't start GUI apps from the console :(
[08:14:39] <strcat> eddyb: look at all the processes though.
[08:15:19] <eddyb> crap. yeah. I lost all my tabs again
[08:15:32] <strcat> lol
[08:15:44] <strcat> do you not have it set to save sessions? ;s
[08:15:56] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[08:15:59] * eddyb abuses "chrome closed unexpectedly, press this button to restore"
[08:16:20] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[08:16:43] <eddyb> if you dismiss it by accident (or press ^C like me), there's no way to get it back
[08:17:26] <pcmattman> if only something like dmenu existed ;)
[08:17:38] <eddyb> and there's no way to close multiple chrome windows at once so they all come back
[08:17:51] <eddyb> (with the normal session saving)
[08:18:02] <strcat> pcmattman: well, dmenu with a script to make it use desktop files
[08:18:06] <strcat> dmenu_run is a pain.
[08:18:15] <pcmattman> mm
[08:18:48] * pcmattman will confess dmenu is somewhat integrated with his wm, meta-d <type what you want><enter>
[08:19:06] * strcat uses super+p
[08:19:15] <eddyb> dmenu for what?
[08:19:33] <strcat> but browsers and terminals are bound to other keys so...
[08:19:39] <strcat> I rarely use it
[08:19:48] <eddyb> anyways, my tabs mostly consisted of chrashed github tabs with issues and whatnot
[08:19:53] <strcat> just for something like gimp or wireshark
[08:20:05] <eddyb> what is dmenu, even?
[08:20:16] <strcat> a launcher
[08:20:29] <strcat> well
[08:20:31] <strcat> a 'menu'
[08:20:34] <eddyb> strcat: --single-process is... not working
[08:20:34] <strcat> you can use it for anything
[08:20:53] <strcat> eddyb: hm?
[08:20:56] <eddyb> doesn't sound... relevant :P
[08:20:58] <strcat> eddyb: maybe it's only in chromium and not chrome
[08:21:03] <pcmattman> I mentioned it because eddyb mentioned chrome was running from a command line, there's definitely better ways to run things that don't involve clicking icons and such :)
[08:21:05] <eddyb> great X_X
[08:21:21] <eddyb> pcmattman: ah, Alt+F2 in kde4
[08:21:22] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[08:21:59] <eddyb> it wasn't a completely bad idea to use a console, just not the one I'm using for development >_>
[08:22:08] <eddyb> [437:473:0220/101508:ERROR:proxy_service_factory.cc(105)] Cannot use V8 Proxy resolver in single process mode.
[08:22:18] <strcat> sounds fine, who needs that anyway?
[08:22:24] <strcat> ;p
[08:22:49] <eddyb> and there was one of those warning bars that --single-process is not officially supported and security could be compromised etc.
[08:22:53] <strcat> eddyb: use --process-per-site then
[08:23:04] <eddyb> but I still see 10 processes
[08:23:12] <eddyb> strcat: isn't that the opposite?
[08:23:18] <strcat> eddyb: the default is per site *instance*
[08:23:31] <eddyb> ohh?
[08:23:36] <strcat> so if you have the same site in 20 tabs, you have 20 processes
[08:23:58] <strcat> with process per site, you have 1 for any # of tabs for the same site
[08:24:07] <eddyb> hmpf
[08:24:20] <eddyb> there's only one process for all the new tabs I open
[08:24:37] <strcat> eddyb: with which model? single process?
[08:24:39] <eddyb> I wonder why extensions and imo.im are separate though
[08:24:44] <eddyb> strcat: yeah
[08:24:47] <strcat> eddyb: I guess extensions remain sandboxed
[08:24:49] <strcat> *shrug*
[08:25:12] <eddyb> the issue now is that I can't kill tabs
[08:25:42] <eddyb> but I have facebook, imo and a bunch of github tabs open and I'm up to only 1.6GB
[08:26:13] <eddyb> I would've expected 2GB by now. 1.7GB is the maximum I can have without making rustc swap while compiling rustc
[08:26:20] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:26:20] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:26:22] <eddyb> strcat: thanks, it seems to be working better :D
[08:26:29] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:26:32] * pcmattman notes complaining about memory usage when having a Facebook tab open is a little intersting :P
[08:26:38] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:26:42] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[08:26:46] <eddyb> pcmattman: most of the time AdBlock uses more
[08:27:16] <eddyb> though I used to kill Facebook frequently
[08:30:04] <strcat> adblock plus uses a ton of memory in both chromium and firefox ;s
[08:30:19] <eddyb> this is AdBlock for Chrome, not ABP
[08:30:22] <strcat> although in chromium you can actually see it's ABP doing it since it's in an enormous process
[08:30:24] <strcat> eddyb: ah
[08:30:58] <strcat> it uses something like 80MiB in ffx and 110MiB in chromium ;s
[08:31:10] <eddyb> 143MB right now in AdBlock
[08:31:38] <strcat> eddyb: switch to ABP then ;p
[08:31:42] <strcat> same filters anyway...
[08:31:50] <eddyb> I've heard that one is doing something shady
[08:32:01] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[08:32:01] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/0fzMhA
[08:32:01] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[08:32:06] <strcat> eddyb: there's a checkbox for choosing if you want 'acceptable ads' shown
[08:32:12] <strcat> it's an exception filter
[08:32:15] <strcat> can turn it off
[08:32:17] * strcat shrugs
[08:32:26] <strcat> I don't care either way
[08:32:37] <eddyb> anyways, the behavior suggests v8's GC is being lazy
[08:32:44] *** Quits: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net) (Ping timeout)
[08:32:45] <strcat> eddyb: ABP makes the filters you consume with adblock anyway
[08:32:46] <strcat> ;p
[08:33:00] *** Quits: Axord (xord@moz-C0D5F15A.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[08:33:18] <strcat> easylist/easyprivacy are ABP projects (and fanboy's list became part of them, which was the other major list)
[08:35:40] <strcat> I don't really understand why something like RES manages to use 12MiB while ABP uses 120MiB
[08:36:03] <strcat> javascript probably doubles the memory usage for the filter strings... + boxing overhead everywhere
[08:36:09] <strcat> stupid UCS2 ;\
[08:36:53] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[08:36:53] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/8HlSiA
[08:36:53] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[08:36:54] *** Joins: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP)
[08:36:54] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/v-Z5CA
[08:36:54] <ghrust> 13rust/06auto 149347096 15Alex Crichton: Fix getting/setting huge env vars on windows...
[08:36:54] <ghrust> 13rust/06auto 14f76628d 15bors: auto merge of #12396 : alexcrichton/rust/windows-env-var, r=huonw...
[08:36:54] *** Parts: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP) ()
[08:36:59] <Yurume> it is at least not UCS4...
[08:37:10] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[08:37:20] <strcat> Yurume: UCS4 would be less broken though :)
[08:37:31] <strcat> as it is, JS doesn't really support unicode
[08:37:33] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[08:38:00] <strcat> it should *really* be UTF-8 though....
[08:38:01] <Yurume> strcat: in that sense, Java does not support Unicode as well ;)
[08:38:15] <strcat> Yurume: well, the standard string types have poor support for it
[08:38:21] <strcat> but there are plenty of good libraries for it
[08:38:29] <strcat> can't say that about unicode in js
[08:38:45] <Yurume> I think the proper way to put that is that they have the minimal Unicode support
[08:38:55] <strcat> Yurume: well, none
[08:39:01] <strcat> they don't have a type enforcing that it contains valid unicode
[08:39:10] <strcat> they don't have the basic unicode algorithms
[08:39:19] * strcat shrugs
[08:39:19] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[08:39:41] <strcat> I guess you can use a typed array of bytes and build a UTF-8 wrapper around it...
[08:39:42] <Yurume> are the basic Unicode algorithms mandatory?
[08:39:42] *** Joins: Axord (xord@moz-C0D5F15A.lsanca.dsl-w.verizon.net)
[08:39:50] <eddyb> https://github.com/vhf/free-programming-books/blob/master/free-programming-books.md#rust we need more books on here
[08:40:02] <eddyb> strcat: in JS?
[08:40:03] <Yurume> afaik they weren't, but I really should consult the Unicode book again
[08:42:18] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:42:30] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:42:53] <strcat> Yurume: well nothing in it is 'mandatory'
[08:43:05] <strcat> but it's certainly useful to be able to make stuff lower/upper case or sort strings
[08:43:28] <strcat> eddyb: yes
[08:43:46] <strcat> eddyb: it's really sad seeing massive CSS/html/json/xml strings in firefox's about:memory
[08:44:06] <strcat> and they're UCS2 so it's 2x the mem usage it should be
[08:44:48] <eddyb> you can't really switch to UTF-8 because JS doesn't have a notion of iterating strings :(
[08:44:52] <Yurume> strcat: looking at the standard, it explicitly permits the partial support for such algorithms, e.g. toLowerCase() can only translate A-Z to a-z and nothing else.
[08:45:14] <strcat> Yurume: doesn't mean it's useful or sane
[08:45:20] <Yurume> I cannot say that "useful", but certainly it is "minimal".
[08:45:24] <Yurume> yeah
[08:45:28] <strcat> C says #include <foo> is implementation defined
[08:45:42] <Yurume> infinitesimally better than nothing :)
[08:45:44] <strcat> since it doesn't specify anything about header files and include dirs
[08:45:52] <strcat> but it'd be insane to not implement it that way
[08:45:54] <strcat> ;p
[08:47:45] <strcat> eddyb: if you want a lightweight browser, use one of the vanilla webkit ones ;p
[08:48:35] <eddyb> well, I can have a lot more thing open in chrome and still be able to compile rustc, so that's nice :D
[08:48:39] <strcat> http://portix.bitbucket.org/dwb/ http://www.qupzilla.com/ [...]
[08:48:42] <eddyb> *things
[08:49:01] <strcat> both of those even have built-in adblock ;p
[08:49:48] <strcat> I pretty much switched to chromium because I can't tolerate the obsolete NPAPI flash ;s
[08:50:15] <strcat> + paranoia (woo, sandboxing)
[08:52:05] *** Quits: bjz (bjz@moz-38D46E1C.perm.iinet.net.au) (Ping timeout)
[08:52:49] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[08:56:41] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[09:09:20] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[09:21:07] *** Joins: bjz (bjz@moz-38D46E1C.perm.iinet.net.au)
[09:24:20] *** Quits: bjz (bjz@moz-38D46E1C.perm.iinet.net.au) (Ping timeout)
[09:34:44] *** Joins: eibwen (kvirc@moz-544A7ACB.dip0.t-ipconnect.de)
[09:35:26] *** Joins: gimpf (gimpf@moz-78FAE2E6.adsl.highway.telekom.at)
[09:35:56] *** Quits: gimpf (gimpf@moz-78FAE2E6.adsl.highway.telekom.at) (Quit: Leaving.)
[09:36:29] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Client exited)
[09:46:41] *** Joins: bjz (bjz@moz-38D46E1C.perm.iinet.net.au)
[09:46:56] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[09:46:57] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/v-Z5CA
[09:46:57] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[09:48:08] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[09:51:58] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[09:51:59] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/xpG_pg
[09:51:59] <ghrust> 13rust/06auto 1453b9d1a 15Liigo Zhuang: move extra::test to libtest
[09:51:59] <ghrust> 13rust/06auto 1425ba057 15bors: auto merge of #12343 : liigo/rust/move-extra-test-to-libtest, r=alexcrichton...
[09:51:59] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[09:52:01] *** Joins: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP)
[09:52:01] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/hACH6Q
[09:52:01] *** Parts: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP) ()
[09:57:45] *** Quits: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP) (Ping timeout)
[10:05:25] *** Joins: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net)
[10:17:07] *** Quits: blank_name (blank_name@973FA96D.E6D3F868.537E532E.IP) (Ping timeout)
[10:17:48] *** Joins: blank_name (blank_name@973FA96D.E6D3F868.537E532E.IP)
[10:35:20] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[10:45:20] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[10:45:41] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[10:47:23] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[10:48:04] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[10:52:23] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[10:53:32] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Connection reset by peer)
[10:54:32] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[10:55:28] <eddyb> it's a bit annoying that let x; is translated as let x = init();
[10:57:21] <huon> really?
[10:57:52] <eddyb> it is required for types that drop, but not really for anything else
[10:58:14] <huon> oh, so it is
[10:58:19] <eddyb> so if you assign later, LLVM has to dead-store eliminate a memset with 0
[10:58:21] <huon> with opts it disappears though
[10:58:35] *** Joins: doener (bs@moz-AA189A5A.unitymedia.biz)
[10:58:57] <eddyb> I'll only leave it in for types that drop, where cleanup can occur without a value having been assigned
[10:59:09] <eddyb> or some other such shenanigans
[10:59:40] <eddyb> (one of these days I'll just give up and implement proper support for move semantics instead of this circus)
[10:59:51] *** Quits: zimbabao (rajaram@47769425.AE842F9B.81C3DAA1.IP) (Ping timeout)
[11:01:17] <eddyb> rusti: let x: ~int; 4
[11:01:19] -rusti- <anon>:10:13: 10:14 warning: unused variable: `x`, #[warn(unused_variable)] on by default
[11:01:19] -rusti- <anon>:10         let x: ~int; 4
[11:01:19] -rusti-                       ^
[11:01:19] -rusti- 4
[11:01:30] <huon> I believe niko may have a branch for avoiding zeroing
[11:01:41] <eddyb> how old is it?
[11:01:54] <eddyb> I presume it does some complicated analysis
[11:02:33] <eddyb> (that code above translates to let x: ~int = init(); if x != 0 {free(x);})
[11:03:11] <eddyb> huon: what I'm working on now is moving more things to SSA slots
[11:03:34] <eddyb> I'm curious whether something like Some(0u8) will produce better IR
[11:05:20] *** Quits: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net) (Quit: Sharp)
[11:06:55] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[11:06:55] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/xpG_pg
[11:06:55] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[11:08:14] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[11:11:49] *** Joins: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP)
[11:11:49] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/ODaUxw
[11:11:49] *** Parts: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP) ()
[11:11:51] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[11:11:51] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/-ZCNmw
[11:11:51] <ghrust> 13rust/06auto 14765a4e9 15Alex Crichton: Fix sending/try_recv on channels off the runtime...
[11:11:51] <ghrust> 13rust/06auto 1447b0527 15bors: auto merge of #12397 : alexcrichton/rust/send-off-the-runtime, r=brson...
[11:11:51] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[11:16:24] <huon> eddyb: I don't think it's particularly old
[11:16:26] <huon> just WIP
[11:31:25] *** Quits: bjz (bjz@moz-38D46E1C.perm.iinet.net.au) (Ping timeout)
[11:33:48] *** Joins: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net)
[11:35:24] *** Quits: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net) (Quit: Sharp)
[11:47:14] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Input/output error)
[11:47:41] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[11:49:25] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[11:49:49] <eddyb> "error: unresolved name `ByVal`. Did you mean `val`?"
[11:49:55] <eddyb> why can't it suggest ByValue?
[11:53:11] <ChrisMorgan> I presume its Levenshtein distance calculation is done in a case insensitive manner. That's probably a mistake.
[11:53:58] <huon> it only looks at local variables
[11:54:28] <eddyb> of course it does...
[11:55:02] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[11:56:24] <nmatsakis> larsberg: so I got a chance to look more closely at that match issue you were asking about -- I would expect that introducing the temporary addresses the problem, and that `match *foo { Some(ref x)` and `match foo { &Some(ref x)` are equivalent,
[11:56:33] <nmatsakis> larsberg: if you find that this is NOT the case, I am interetsed,
[11:57:11] <nmatsakis> larsberg: but if the problem is the *temporary*, that is indeeed #3511 and I resent the "work around borrowck" comment, that was just borrowck enforcing trans's crazy rules ;)
[11:58:10] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[11:58:13] <larsberg> nmatsakis: I apologize for raising your ire with those comments - they're more there because I'm hoping that when we do the Rust upgrade I'll be able to easily find and remove them all :-)
[11:58:15] <eddyb> "error: failed to find an implementation of trait std::clone::Clone for middle::trans::datum::Expr"
[11:58:26] <nmatsakis> larsberg: (no worries, I was joking)
[11:58:42] <eddyb> nmatsakis: this code worked before (when it was using Datum<Lvalue>)
[11:58:58] <nmatsakis> eddyb: that's because you can't clone a datum
[11:59:03] <nmatsakis> eddyb: in particular, not a Datum<Rvalue>
[11:59:28] <nmatsakis> it's sort of by design
[11:59:30] <eddyb> ah, that explains it
[11:59:38] <larsberg> nmatsakis: the only problem I've had with the temporary is when I needed it to live exactly long enough for the match. e.g., so I wanted: `match *{let tmp = x.borrow().field.borrow(); tmp.get()} { Some(ref x) => ... borrows field again ...`
[11:59:43] <nmatsakis> eddyb: because that would imply you are using the rvalue more than once
[11:59:50] <eddyb> I am :)
[11:59:55] <larsberg> but that's like putting a block where no block should go
[11:59:56] <eddyb> but only for immediate Pods
[12:00:25] <eddyb> wait, I forgot to check for immutability, too. oops
[12:00:50] <nmatsakis> larsberg: so with the new rules,
[12:01:00] <nmatsakis> larsberg: you should be able to do "let v = x.borrow().field.borrow().get();
[12:01:07] <nmatsakis> larsberg: match *v { ... }
[12:01:14] <nmatsakis> larsberg: and the borrows should expire after the let
[12:01:27] <larsberg> nmatsakis: that sounds great!
[12:02:16] <nmatsakis> eddyb: I think in such cases I usually had a helper method that checked those conditions and converted to a ValueRef or something like that;
[12:02:44] <eddyb> yeah, well, I'm doing the opposite
[12:03:11] <eddyb> using Datum<Expr> and storing only some safe cases as Rvalues, everything else as Lvalues
[12:03:14] <nmatsakis> eddyb: or perhaps have a method on Datum<Expr> that returns a clone but after checking the conditions (with an assert)
[12:03:24] <eddyb> I was just thinking of that :)
[12:03:40] <nmatsakis> ok. I'd rather not just implement clone with no asserts.
[12:03:41] <eddyb> will need it whenever Datum stops being Pod :P
[12:04:05] <nmatsakis> (why would Datum stop being pod?)
[12:04:23] <eddyb> to enforce linearity, I would presume
[12:04:54] <eddyb> maybe even handle rvalue cleanup when disposed
[12:05:05] <nmatsakis> eddyb: it's ... intentionally the way it is. that is, datum is pod, but Rvalue is linear.
[12:05:12] <nmatsakis> hence Datum<Rvalue> is linear,
[12:05:15] <nmatsakis> bu Datum<Lvalue> is not
[12:05:31] <eddyb> ahh, so I need that already
[12:05:32] <nmatsakis> precisely for the reasons you mentioned
[12:05:49] <eddyb> I guess I'm not hitting that error because I still have type errors
[12:07:22] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[12:11:35] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[12:11:56] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[12:13:37] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[12:19:31] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[12:22:15] *** Joins: zimbabao (rajaram@777E2631.7C2E7D44.D2D1FAF0.IP)
[12:26:50] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[12:26:50] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/-ZCNmw
[12:26:50] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[12:30:28] <huon> r? https://github.com/mozilla/rust/pull/12419
[12:31:50] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[12:31:50] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/YXjSOA
[12:31:50] <ghrust> 13rust/06auto 1435c6e22 15Alex Crichton: Tweak how preference factors into linkage...
[12:31:51] <ghrust> 13rust/06auto 14882c25f 15bors: auto merge of #12398 : alexcrichton/rust/rlibs-and-dylibs-2, r=cmr...
[12:31:51] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[12:31:52] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[12:31:52] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/Y-Go7A
[12:31:52] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[12:33:15] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[12:33:54] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[12:37:59] *** Quits: mawuli (mawuli@moz-5ADAB167.com.gh) (Client exited)
[12:41:46] <huon> pnkfelix: ping
[12:44:10] *** Quits: zimbabao (rajaram@777E2631.7C2E7D44.D2D1FAF0.IP) (Ping timeout)
[12:46:05] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[12:51:37] *** Joins: doomlord_ (servitor@moz-9B2006BF.range109-151.btcentralplus.com)
[12:52:16] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Connection reset by peer)
[12:52:40] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[12:54:27] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[12:59:35] *** Joins: erickt (Adium@moz-BDF423C7.hfc.comcastbusiness.net)
[13:07:54] <pnkfelix> huon: pong
[13:08:28] <pnkfelix> what timing, I'm trying to figure out how to use your commit->PR script to find the PR for 60bc76fb78d22
[13:08:46] <pnkfelix> i must be doing something wrong here
[13:09:11] <huon> pnkfelix: `which-pr 60bc76fb78d22`?
[13:09:23] <pnkfelix> huon: I was trying to run the command directly
[13:09:30] <pnkfelix> i.e. I didn't actually make the script
[13:09:32] <huon> pnkfelix: (I resolved my ping)
[13:09:34] <huon> pnkfelix: oh, ok
[13:09:49] <huon> I don't really know how the git stuff works... just copied it off SO ;P
[13:09:54] <pnkfelix> huon: anyway, I just figured it out, I was mistakenly leaving out the `^` when I plugged in the value for `^$1`
[13:10:02] <huon> ah
[13:11:09] *** Joins: pczarn (Mibbit@moz-69A55FA.izacom.pl)
[13:11:37] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[13:13:30] <pnkfelix> huon: also, I realized a big mistake I had made with the BDW branch
[13:13:52] <pnkfelix> huon: i wasn't attempting to compensate for libgreen's user-space threading
[13:15:28] <pnkfelix> huon: so BDW was tracking stack extents internally for each pthread.  Which led to it conservatively thinking that a given thread had a stack extent [min, max) where min is the minimum for all tasks' stack bases that have malloc'ed on this thread, and likewise for max. 
[13:15:58] <pnkfelix> huon: (This ended up meaning that the conversative stack scan attempted to scan memory that hadn't actually been allocated.)  I'm playing with fixes for this now.
[13:16:09] <huon> pnkfelix: oh! that's rather bad
[13:17:15] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[13:18:06] <pnkfelix> huon: yeah.  I spent a little while looking at discussion amongst BDW developers about how a client should deal with user-space threading
[13:18:30] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[13:18:33] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[13:18:50] <pnkfelix> huon: but I didn't see an obvious answer.  Anyway, I ended up just putting in a hack of a function to let the Rust runtime mutate the stack-base that BDW associates with a pthread
[13:18:51] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[13:19:24] <pnkfelix> huon: so then the Rust scheduler can keep the (stack base of the) stack extent up to date.
[13:19:39] *** Joins: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP)
[13:20:33] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[13:21:39] <huon> pnkfelix: sounds like a reasonable fix
[13:22:44] <pnkfelix> huon: Yeah.  I've pushed that to a new branch: https://github.com/pnkfelix/rust/tree/bdw-bootstrapped-fixups-rebasing-2014feb20
[13:22:55] <pnkfelix> huon: so now it breaks elsewhere during the build.  :)
[13:24:50] <huon> pnkfelix: that breaks it? (or some other change)
[13:24:57] <huon> (because that seems simple enough...)
[13:25:11] <pnkfelix> huon: Well, I cannot tell whether it is getting further than it was before
[13:25:17] <pnkfelix> huon: it breaks in a different way now
[13:25:43] <pnkfelix> huon: So it could be that its now missing some roots that were accidentally getting scanned before
[13:26:06] <pnkfelix> huon: or it could be that I'm just getting further, uncovering a different latent bug in the strategy
[13:26:23] <huon> ah :( (good luck debugging it)
[13:26:37] * huon -> bed
[13:26:41] <pnkfelix> huon: I'm still working on other stuff in parallel.  At some point I assume the effort expended to support BDW will make it not worthwhile
[13:26:46] <pnkfelix> huon: ah, okay.  G'night
[13:41:51] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[13:41:51] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/YXjSOA
[13:41:51] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[13:46:49] *** Joins: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP)
[13:46:49] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/v861bQ
[13:46:49] *** Parts: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP) ()
[13:46:50] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[13:46:50] <ghrust> [13rust] 15bors pushed 5 new commits to 06auto: 02http://git.io/AH_Otw
[13:46:50] <ghrust> 13rust/06auto 145f9e32a 15Michael Woerister: debuginfo: Add support for simd types
[13:46:50] <ghrust> 13rust/06auto 143ce04dc 15Michael Woerister: debuginfo: Move test case from run-pass to debug-info directory so it does not interfere with RUSTFLAGS=-g
[13:46:51] <ghrust> 13rust/06auto 146656e5c 15Michael Woerister: debuginfo: Fix a RUSTFLAGS incompatibility in test runner.
[13:46:53] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[13:56:20] *** Quits: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP) (Quit: Leaving)
[14:07:27] *** Joins: edwardw (edwardw@96E7298D.3E260003.B9C6B12A.IP)
[14:07:58] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[14:24:13] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[14:27:24] *** Quits: erickt (Adium@moz-BDF423C7.hfc.comcastbusiness.net) (Quit: Leaving.)
[14:30:31] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Input/output error)
[14:30:54] *** Quits: lpy (lpy@7360AA58.F09091A8.1348A864.IP) (Ping timeout)
[14:36:15] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[14:36:32] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[14:38:11] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[14:51:36] *** Joins: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net)
[14:53:30] *** Quits: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net) (Quit: Sharp)
[14:56:50] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[14:56:50] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/AH_Otw
[14:56:50] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[14:58:11] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Connection reset by peer)
[14:58:16] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[15:00:08] <flaper87> according to meetup, 14 people will attend today... we'll see
[15:01:40] *** Joins: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net)
[15:01:51] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[15:01:51] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/iyNg0g
[15:01:51] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[15:06:50] *** Joins: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP)
[15:06:50] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/iyNg0g
[15:06:50] *** Parts: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP) ()
[15:06:50] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[15:06:50] <ghrust> [13rust] 15bors pushed 4 new commits to 06auto: 02http://git.io/YhqDVw
[15:06:50] <ghrust> 13rust/06auto 141ca1ff2 15Eduard Burtescu: Don't recurse twice into ExprParen in vtable checking.
[15:06:50] <ghrust> 13rust/06auto 14efef078 15Eduard Burtescu: Replaced method_map_entry with method_origin and cleaned up vtable checking a bit.
[15:06:51] <ghrust> 13rust/06auto 14efaa1ea 15Eduard Burtescu: Resolve the vtables for method calls to generic Drop impls with trait bounds.
[15:06:53] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[15:07:14] <eddyb> sweet :D
[15:07:31] <eddyb> it shouldn't break anything
[15:29:30] *** Joins: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP)
[15:30:38] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[15:31:39] *** Joins: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net)
[15:34:55] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[15:36:08] *** Joins: lpy (lpy@12172131.F09091A8.1348A864.IP)
[15:36:31] *** Quits: Kxepal (Miranda@moz-ECC1F51A.pppoe.mtu-net.ru) (Ping timeout)
[15:38:01] *** Joins: Kxepal (Miranda@moz-D1BCA7F1.pppoe.mtu-net.ru)
[15:43:28] *** Quits: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net) (Quit: Sharp)
[15:48:58] *** Quits: bytbox (s@moz-AA99B23F.washdc.fios.verizon.net) (Input/output error)
[15:51:25] <eddyb> cmr: news on benching?
[15:52:14] <cmr> eddyb: oh, no, sorry. let me just re-bench the most recent 500
[15:52:19] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[15:52:32] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[15:52:36] <eddyb> should've told you to do so yesterday :/
[15:53:32] <eddyb> wow
[15:53:52] <eddyb> cmr: I got really lucky with my #4252 fix
[15:54:08] <eddyb> the only thing I tested was the test for it :P
[15:55:30] <cmr> eddyb: bencher kicked off.
[15:55:46] <eddyb> choo choo
[15:55:55] *** flaper87 is now known as flaper87|afk
[15:55:59] <cmr> yuup
[15:56:44] <eddyb> huon mentioned he's made refreshing easier, so ping him whenever it gets anywhere interesting
[15:57:03] <cmr> looks like it's rebuilding llvm, so that's exciting.
[15:57:17] <cmr> that's probably why recent builds have been taking so long.
[15:57:39] <cmr> (I need to periodically update the workspace that is copied for building, so that it has a fresh llvm)
[15:57:46] <Yurume> x-post: can `std::io::Buffer::fill` be used to populate the partially read buffer? (i.e. consume has been called but it hasn't consumed the whole buffer yet)
[15:57:49] <Yurume> and is `fill` guaranteed to return a non-empty buffer eventually (while it can sometimes return an empty buffer)?
[15:58:05] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[15:58:13] <cmr> Yurume: I think so, but I'm not sure.
[15:58:15] <Yurume> well, #rust is sometimes noisy enough that I have to cross-post questions to other channels :)
[15:58:31] <cmr> Yurume: fill certainly isn't guaranteed to return a non-empty buffer though. EOF.
[15:59:03] <Yurume> the rationale of the second question is that the documentation says "it is not an error to return a 0-length buffer".
[15:59:47] <Yurume> for the first question, I actually found that at least BufferedReader won't fill the buffer unless it has been totally consumed, but not sure if this is intentional.
[15:59:59] *** Quits: Zr40 (zr40@EE4BB9F5.926C319A.BE2F4011.IP) (Quit: leaving)
[16:00:56] <Yurume> context: I'm writing a new JSON parser (or to be exact, CSON, but it can be made into JSON only) and I want to optimize for tight loops
[16:01:50] <eddyb> almost there....
[16:02:01] <eddyb> strcat isn't around (again)
[16:02:47] <Yurume> in some cases it is desirable that the parser only consumes the portion of the buffer that is correct UTF-8 (it is not a streaming parser but it tries to be similar)
[16:03:38] <Yurume> so that the parser can a partially decode but a valid UTF-8 string (i.e. &'r str) to the caller.
[16:03:45] <Yurume> partially read*
[16:03:59] <Yurume> well, I forgot some words, but anyway
[16:04:25] *** Quits: edwardw (edwardw@96E7298D.3E260003.B9C6B12A.IP) (Ping timeout)
[16:04:48] <Yurume> I'm also trying to implement an in-situ (non-destructuring) parser, but for now I'm using Buffers first in order to test the initial implementation.
[16:08:14] *** Joins: edwardw_ (edwardw@FE274C20.C036752E.F5B522C5.IP)
[16:11:24] *** edwardw_ is now known as edwardw
[16:12:12] <eddyb> any second now...
[16:12:27] <eddyb> <3 green
[16:16:43] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[16:16:45] *** Joins: aepsil0n (eduard@moz-15CB80F2.hsi8.kabel-badenwuerttemberg.de)
[16:16:46] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[16:16:46] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/YhqDVw
[16:16:46] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[16:21:39] *** Joins: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net)
[16:21:46] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[16:21:46] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/0MtuFQ
[16:21:46] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[16:21:46] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[16:21:46] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/pARmWQ
[16:21:46] <ghrust> 13rust/06auto 144ad5751 15kud1ing: adjust to currently used style
[16:21:46] <ghrust> 13rust/06auto 141366e04 15bors: auto merge of #12405 : kud1ing/rust/backticks, r=huonw
[16:21:47] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[16:23:57] <eddyb> gaah
[16:24:26] <eddyb> nmatsakis: how do I get the CleanupId of a function?
[16:24:49] <eddyb> well, no, a node ID that can resolve to a suitable CleanupId
[16:24:56] <eddyb> this is such a mess :/
[16:34:37] *** Joins: andrew-d_w (andrew-d_w@moz-5A92CAFF.dsl.static.sonic.net)
[16:35:29] *** Quits: andrew-d_w (andrew-d_w@moz-5A92CAFF.dsl.static.sonic.net) (Input/output error)
[16:35:40] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[16:49:33] *** Joins: andrew-__ (andrew-d_w@moz-5A92CAFF.dsl.static.sonic.net)
[16:50:41] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Ping timeout)
[16:52:49] *** Quits: andrew-__ (andrew-d_w@moz-5A92CAFF.dsl.static.sonic.net) (Connection reset by peer)
[16:53:08] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[17:07:01] <eddyb> libstd seems to compile \o/
[17:07:23] <eddyb> doener: I have no idea what we do for ByVal aggregates, but it doesn't break
[17:07:23] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[17:07:24] *** ChanServ sets mode: +qo brson brson
[17:09:03] <doener> eddyb: what doesn't break?
[17:09:09] * doener hasn't paid attention
[17:09:24] <eddyb> let's see if rpass works
[17:09:33] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[17:09:35] <eddyb> doener: I'll post some before/after IR
[17:10:17] <eddyb> I hope we don't do anything stupid, like create a thousand temporarily allocas just to use GEPi
[17:12:34] <eddyb> doener: this now produces "ret void" with no optimizations: pub fn foo(x: u8) {let a = x; let b = x; let c = x;}
[17:13:11] <doener> nice
[17:13:34] <doener> x is implicitly copyable, right?
[17:13:41] <eddyb> and this to add/mul/sub/ret void pub fn foo(x: u8) {let a = x + 1; let b = x * 2; let c = x - a;}
[17:13:47] <eddyb> doener: yeah
[17:15:05] <eddyb> this is probably what happens for each int addition that goes through the Add::add impl: pub fn add(x: &int, y: &int) -> int {*x + *y}
[17:15:16] <eddyb> now it's only load/load/add/ret
[17:16:00] <cmr> what was it before?
[17:16:08] <eddyb> previously: two allocas, two stores, 4 loads an add and a ret
[17:16:17] <cmr> fun
[17:16:51] <eddyb> I guess I can use Add::add for ints as an example
[17:17:41] <eddyb> oh dear this is horrible
[17:18:02] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[17:19:10] <eddyb> cmr: having a &T argument meant an initial store and a load for each use
[17:19:35] *** Quits: lpy (lpy@12172131.F09091A8.1348A864.IP) (Client exited)
[17:19:56] <eddyb> making pointers doubly indirected in many situations, which is just eww
[17:20:26] <Sharp> Haha, guys
[17:20:34] <Sharp> Oops, wrong channel.
[17:22:08] <eddyb> cmr, doener: if only trans::adt knew how to create aggregates instead of producing a set of stores
[17:22:48] <eddyb> (x, y) could just be { %x, %y }
[17:24:15] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[17:25:54] *** Quits: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net) (Ping timeout)
[17:26:15] <eddyb> 997MB while in LLVM
[17:26:29] <cmr> whaaaaat
[17:26:36] <cmr> have you brought us under a gig!?!?
[17:26:48] <eddyb> cmr: not the trans peak
[17:26:59] <eddyb> looks like 1020MB on the graph
[17:27:23] <eddyb> I was hoping for more, TBH
[17:28:00] <eddyb> cmr: 221s => 211s in LLVM module passes
[17:28:06] *** Quits: edwardw (edwardw@FE274C20.C036752E.F5B522C5.IP) (Quit: Leaving...)
[17:28:20] <eddyb> (that's including possible variance)
[17:28:54] <nmatsakis> eddyb: CleanupId of a function?
[17:29:03] <eddyb> nmatsakis: nevermind I found something suitable
[17:29:06] <nmatsakis> ok
[17:29:17] <eddyb> there's no cleanup to be performed anyway, just needed a valid ScopeId
[17:29:26] <eddyb> I doubt we even emit insertvalue/extractvalue so there's probably a lot of inefficiencies that counteract the benefits of my change
[17:29:56] <eddyb> but it's trimming down on IR, so that's good
[17:30:44] <eddyb> cmr: o_O it drop further?
[17:30:53] <eddyb> *drops
[17:30:55] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[17:30:55] *** ChanServ sets mode: +ao dherman dherman
[17:30:57] <eddyb> 985MB during linking
[17:31:19] <eddyb> nmatsakis: I've heard you have a branch where you avoid zeroing out lvalues when moving from them
[17:31:51] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[17:31:51] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/pARmWQ
[17:31:51] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[17:31:54] *** Joins: edwardw (Mibbit@655F78EA.BF27AFA4.B9C6B12A.IP)
[17:31:59] *** Joins: aepsil0n1 (eduard@moz-15CB80F2.hsi8.kabel-badenwuerttemberg.de)
[17:31:59] *** Quits: aepsil0n (eduard@moz-15CB80F2.hsi8.kabel-badenwuerttemberg.de) (Connection reset by peer)
[17:32:20] <cmr> eddyb: nice job :)
[17:33:03] <nmatsakis> eddyb: no, there is no branch, but we're working towards that yes
[17:33:04] <nmatsakis> pnkfelix: ping
[17:33:18] <nmatsakis> eddyb: there are some prereqs to resolve first, one of which pnkfelix is hacking on:)
[17:33:38] <eddyb> nmatsakis: am I correct in assuming it would be reusing information from move analysis?
[17:33:39] *** Quits: aepsil0n1 (eduard@moz-15CB80F2.hsi8.kabel-badenwuerttemberg.de) (Ping timeout)
[17:34:29] <nmatsakis> eddyb: depending on what you mean by "move analysis", yes
[17:36:26] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[17:36:26] *** ChanServ sets mode: +ao pcwalton pcwalton
[17:36:50] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[17:36:50] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/B611jw
[17:36:50] <ghrust> 13rust/06auto 147bb498b 15Alex Crichton: Mass rename if_ok! to try!...
[17:36:50] <ghrust> 13rust/06auto 1470fedfd 15bors: auto merge of #12401 : alexcrichton/rust/if-ok-2-try, r=brson...
[17:36:51] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[17:37:54] <eddyb> come on github, not 404s...
[17:39:25] <eddyb> https://github.com/mozilla/rust/pull/12422 nice to see there is a demand for the bounded drop fix
[17:40:00] <eddyb> cmr, doener, nmatsakis, huon: https://github.com/mozilla/rust/pull/12424
[17:40:19] <eddyb> (nice number, btw)
[17:40:32] <eddyb> cmr: you can graph it if you want
[17:40:44] <cmr> not stopping the train for your PR, sorry.
[17:40:55] <eddyb> ah, if that's blocking, don't worry
[17:41:22] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[17:41:44] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[17:41:44] <ghrust> [13rust] 15alexcrichton merged 06master into 06snap-stage3: 02http://git.io/6tsCRQ
[17:41:44] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[17:42:34] <eddyb> acrichto: ^^ that's including the #4252 fix, right?
[17:43:17] <acrichto> eddyb: indeed
[17:43:24] <eddyb> sweet stuff :D
[17:45:07] <eddyb> lol, I just noticed my most recent PR still has a negative diff >_>
[17:50:19] *** Joins: aepsil0n (eduard@moz-13747D88.mullvad.net)
[17:54:28] * edwardw is deep in the macro expansion rabbit hole
[17:55:23] <acrichto> brson: r? https://github.com/mozilla/rust/pull/11603
[17:55:39] *** Joins: tedh (tedh@moz-6F8EC49.central.biz.rr.com)
[17:58:15] <brson> i think E-tedius is unnecessary
[17:59:01] <brson> i don't see anybody thinking 'is there any tedius work i can do today?'
[18:01:07] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Quit: Leaving)
[18:02:00] <doener> is there a reason (except for "nobody bothered to implement it yet") that we don't emit "nocapture" attributes for function parameters?
[18:02:32] <eddyb> what does nocapture mean?
[18:03:14] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Connection reset by peer)
[18:04:10] <doener> eddyb: that the function keeps no copy of the pointer that outlives it
[18:04:16] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[18:04:24] <doener> eddyb: http://www.reddit.com/r/rust/comments/1yedk1/hitting_the_recursion_depth_in_rust/
[18:04:36] <eddyb> hmpf
[18:04:53] <eddyb> doener: I think you need some kind of analysis for that
[18:06:29] <doener> eddyb: sure, I just wonder if there may be some more reasons, like function signatures not sufficient to capure that yet (and a library upgrade might break your code because the function suddenly does capture the pointer...)
[18:10:08] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Connection reset by peer)
[18:10:19] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[18:11:11] *** Quits: aepsil0n (eduard@moz-13747D88.mullvad.net) (Ping timeout)
[18:12:28] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[18:18:01] <doener> eddyb: ah, there is a llvm pass that tries to add nocapture, I guess the callbacks used in the given example break it there
[18:26:42] *** Quits: doener (bs@moz-AA189A5A.unitymedia.biz) (Quit: leaving)
[18:28:10] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[18:28:38] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[18:28:38] *** ChanServ sets mode: +ao dherman dherman
[18:31:03] *** Joins: aepsil0n (eduard@moz-15CB80F2.hsi8.kabel-badenwuerttemberg.de)
[18:32:13] *** Parts: edwardw (Mibbit@655F78EA.BF27AFA4.B9C6B12A.IP) ()
[18:33:10] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[18:36:52] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[18:36:52] <ghrust> [13rust] 15bors 04force-pushed 06auto from 1470fedfd to 141366e04: 02http://git.io/N3iJvQ
[18:36:52] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[18:38:11] *** Joins: sunfish (chatzilla@moz-BBE3ABD.mv.mozilla.com)
[18:44:50] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Ping timeout)
[18:48:52] *** Joins: bytbox (s@moz-AA99B23F.washdc.fios.verizon.net)
[18:49:01] *** Quits: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net) (Ping timeout)
[18:54:02] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[18:54:24] <pnkfelix> acrichto: 
[18:54:27] <pnkfelix> acrichto: ping
[18:55:31] <acrichto> pnkfelix: try me again in about 45 minutes
[18:55:34] <pnkfelix> acrichto: np
[18:58:46] *** Joins: doener (doener@moz-C68F600D.unity-media.net)
[19:00:53] *** Quits: pczarn (Mibbit@moz-69A55FA.izacom.pl) (Quit: http://www.mibbit.com ajax IRC Client)
[19:01:45] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[19:01:45] *** ChanServ sets mode: +qo brson brson
[19:41:23] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Input/output error)
[19:56:54] *** Joins: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP)
[19:56:54] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/aOrFtw
[19:56:54] *** Parts: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP) ()
[20:01:51] *** Joins: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP)
[20:01:51] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/kVF6ZA
[20:01:51] <ghrust> 13rust/06auto 141a1ee0f 15Alex Crichton: Re-work loading crates with nicer errors...
[20:01:51] <ghrust> 13rust/06auto 1424cf469 15bors: auto merge of #12164 : alexcrichton/rust/rlibs-and-dylibs, r=cmr...
[20:01:51] *** Parts: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP) ()
[20:01:53] *** Joins: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP)
[20:01:53] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/pXMMcQ
[20:01:53] *** Parts: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP) ()
[20:05:15] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[20:06:10] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[20:06:10] *** ChanServ sets mode: +o tjc
[20:07:51] *** Quits: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net) (Ping timeout)
[20:08:07] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[20:08:07] *** ChanServ sets mode: +o tjc
[20:09:24] *** Quits: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net) (Connection reset by peer)
[20:09:32] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[20:09:32] *** ChanServ sets mode: +o tjc
[20:09:54] <acrichto> pnkfelix: I am back
[20:10:09] <pnkfelix> acrichto: okay great
[20:10:32] <pnkfelix> acrichto: So I'm still attempting to integrate the Boehm GC with the Rust runtime
[20:10:42] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[20:10:58] <pnkfelix> acrichto: My latest "oh duh" moment was that since libgreen does M:N user-space threading
[20:11:26] <pnkfelix> acrichto: the Boehm strategy for having each pthread_t track its own stack boundaries (both the cold end and the hot end) fails
[20:11:52] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[20:11:52] <ghrust> [13rust] 15bors 04force-pushed 06auto from 1424cf469 to 146532d2f: 02http://git.io/N3iJvQ
[20:11:52] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[20:11:53] *** Joins: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP)
[20:11:53] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/NQm_sw
[20:11:53] <ghrust> 13rust/06auto 14c8cda68 15Alex Crichton: Roll std::run into std::io::process...
[20:11:53] <ghrust> 13rust/06auto 143a0c022 15bors: auto merge of #12380 : alexcrichton/rust/run-rewrite, r=brson...
[20:11:54] *** Parts: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP) ()
[20:12:15] <pnkfelix> acrichto: This may be easy to fix from our end.  My current idea is to expose a way for a thread to tell the Boehm GC "my stackbase is now 0xfoobar"
[20:12:37] <pnkfelix> acrichto: since its really only the cold end of each pthread's stack that I'm concerned about knowing precisely
[20:12:55] <acrichto> you can do that today with some Task apis
[20:12:58] <acrichto> (get the bounds of the stack)
[20:13:08] <pnkfelix> acrichto: Yes, for many of the stacks that is the case
[20:13:13] <pnkfelix> acrichto: So i've gotten pretty far
[20:13:14] <pnkfelix> but
[20:13:40] <pnkfelix> acrichto: but the problem is that, I think for the main task alone
[20:13:46] <pnkfelix> acrichto: it thinks that its stackbase is 0x0
[20:14:03] <acrichto> the scheduler thread does not know its stack bounds currently yeah
[20:14:07] <acrichto> the scheduler threads*
[20:14:12] <acrichto> we could modify that, however
[20:14:18] <pnkfelix> acrichto: that was what I was wondering about
[20:14:18] <acrichto> they're just pthread threads
[20:14:54] <pnkfelix> acrichto: So, 1. Its solely the scheduler threads that have empty Coroutine s then?
[20:15:21] <acrichto> I think there's the one other "super initial" task
[20:15:26] <acrichto> the one that the OS main thread is
[20:15:30] <acrichto> but that one  never does any GC allocations
[20:15:48] <pnkfelix> acrichto: yeah, so it might not matter from the viewpoint of Boehm
[20:16:18] <pnkfelix> acrichto: So, I have been thinking about different strategies for trying to add precise stackbase knowledge to the tasks in quesiton
[20:17:17] <pnkfelix> acrichto: Boehm's code has a lot of different OS dependent implementations of GC_get_stack_base, which initializes its argument struct with the address of the stack base
[20:17:44] <pnkfelix> acrichto: but there is also the option of just recording the stack base at the very first frame
[20:18:06] <pnkfelix> acrichto: I was wondering if you had any insight or preference between these two options
[20:18:40] <acrichto> learning about the stack bounds involves hitting TLS at least once
[20:18:47] <acrichto> which isn't slow, but also isn't the fastest thing ever
[20:19:00] <acrichto> it'd be nice that when a GC was triggered that you then learned about the stack bounds
[20:19:08] <acrichto> but only then do you really need to know the stack bounds
[20:19:09] <pnkfelix> acrichto: Well, my thinking is that you'd only do this when you create one of these Coroutines
[20:19:13] <pnkfelix> acrichto: not on every GC
[20:19:34] <acrichto> doesn't context switching mean that you need to re-inform the GC about the stack bounds?
[20:19:37] <pnkfelix> acrichto: You'd rather delay the determination of the stack bounds?
[20:19:49] <acrichto> with a context switch I figured you'd have no choice
[20:19:49] <pnkfelix> acrichto: Yes, I do need to do that.  I've already put that into my code.
[20:19:57] <pnkfelix> acrichto: e.g. see here: https://github.com/pnkfelix/rust/commit/4951c0a3f29221b6abd3dbd435fe5c516a74bf2e#diff-d09b5808c05cb523d29510fac0e566e6L130
[20:20:21] <pnkfelix> acrichto: the idea is that I'm telling the GC forcefully on a context switch that the stack base has changed
[20:20:32] <pnkfelix> acrichto: the problem I'm trying to solve now is that this information isn't always there
[20:20:36] <acrichto> I'd be a little wary of adding more code on the context switching path
[20:20:44] <acrichto> also because it'd be nice if libgreen didn't depend on the gc library
[20:20:46] <eddyb> nmatsakis: it's not mentioned in the commit message (sorry?), but it is in the comment in bind_local: my changes (as always) have no effect with debuginfo turned on
[20:20:57] <pnkfelix> acrichto: yeah, I agree, it would be nice
[20:21:02] <acrichto> pnkfelix: if you only did this on a GC then you also wouldn't need to worry about the scheduler tasks
[20:21:12] <acrichto> pnkfelix: it's safe to assume that the scheduler tasks never gc allocate things
[20:21:25] <acrichto> they're completely controlled by libgreen, so we can verify that there is no gc done
[20:21:25] <eddyb> nmatsakis: and without changing debuginfo code, you couldn't use anything other than allocas without causing an ICE *anyway*
[20:21:25] <nmatsakis> eddyb: sorry, I thought as I wrote that comment that you probably made it conditional on debuginfo being disabled
[20:21:30] <pnkfelix> acrichto: I guess my mindset was
[20:21:40] <pnkfelix> acrichto: I do not want to have to muck more with the internals of BDW than necessary
[20:22:01] <acrichto> pnkfelix: oh this would need modifications?
[20:22:07] <pnkfelix> acrichto: So I was trying to avoid e.g. adding an extra entry point into the GC where we feed it our notion of the what the set of stacks are
[20:22:08] <nmatsakis> eddyb: is cmr going to produce some kind of measurements of the impact of your change?
[20:22:20] <nmatsakis> eddyb: (I saw some chatter earlier but didn't follow)
[20:22:30] <cmr> nmatsakis: no, the bencher is busy reproducing some other things, I don't want to stop it.
[20:22:32] <pnkfelix> acrichto: Right now, I believe, the BDW GC does not have built-in support for user-space threading
[20:22:40] <acrichto> pnkfelix: you may want to try just telling boehm about the stack bounds on every gc allocations, I don't think it'll be that much of a perf hit
[20:22:52] <eddyb> nmatsakis: I'm okay with #2, it would certainly make some operations simpler. and yes, we'll get some numbers, but not today
[20:23:07] <eddyb> I guess I could dump no-opt.bc myself and compare the size
[20:23:21] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[20:23:31] <pnkfelix> acrichto: okay.  That actually sounds semi-plausible
[20:23:50] <pnkfelix> acrichto: so, fine, looking again at https://github.com/pnkfelix/rust/commit/4951c0a3f29221b6abd3dbd435fe5c516a74bf2e#diff-d09b5808c05cb523d29510fac0e566e6L130
[20:23:50] <cmr> it should be done in ~59 hours.
[20:24:13] <pnkfelix> acrichto: lets assume I revise the code so that it does not call `bdwgc::mutate_my_stack_base` eagerly upon the scheduler's context switch
[20:24:24] <eddyb> nmatsakis: it looks like 2% less out of the rustc compile time (doesn't seem like much, but that's 10s here) and something like 20-30MB less
[20:24:25] <pnkfelix> acrichto: but instead I delay that call until the next call into the bdw allocator
[20:24:30] <cmr> eddyb: all the scripts I use are on github, https://github.com/cmr/rust-bench
[20:24:33] <pnkfelix> acrichto: I still have my original problem
[20:25:07] <nmatsakis> cmr: k
[20:25:10] <acrichto> pnkfelix: how so?
[20:25:20] <pnkfelix> acrichto: which is that the stack_base that I get from calling stack.start()
[20:25:23] <pnkfelix> acrichto: is sometimes 0
[20:25:32] <eddyb> nmatsakis: I still have to look some more at the generated IR, I suspect a category of cases produce the same amount of IR, or even worse, because we tend to create allocas and store to them for a lot of operations on temporaries
[20:25:42] <acrichto> pnkfelix: it won't be if you do it on gc allocations, a stack base of 0 means you're on a scheduler thread, and those never do GC allocations
[20:25:44] <pnkfelix> acrichto: oh wait, your claim is that should never happen?
[20:25:48] <pnkfelix> acrichto: hmm
[20:25:52] <pnkfelix> Okay.  I will give that a shot then
[20:25:53] <nmatsakis> eddyb: ok.
[20:25:55] <acrichto> pnkfelix: if it does do that, that's bad lol
[20:26:09] <cmr> eddyb: run `mem-bench.py rustc ... > data_baseline.json; mem-bench.py rustc2 .... > data_patch.json; plot_data.py data_baseline.json data_patch.json parent/master -d your_branch_name -t "Graph Title"`
[20:26:17] <acrichto> pnkfelix: https://github.com/mozilla/rust/blob/master/src/libstd/rt/task.rs#L287-L293
[20:26:19] <cmr> spits out a rustc.json
[20:26:24] <eddyb> hmm
[20:26:24] <acrichto> pnkfelix: (works for generic tasks)
[20:26:43] <pnkfelix> acrichto: also, there was something else about this
[20:26:44] <cmr> erm, rustc.png
[20:26:49] <pnkfelix> acrichto: the (lo, hi) format for the result
[20:27:15] <pnkfelix> acrichto: from what I've seen in the code thus far, `lo` is the stackbase (the "cold" end of the stack
[20:27:26] <pnkfelix> acrichto: and `hi` is the stack-tip (the "hot" end of the stack)
[20:27:35] <cmr> also needs a cgcreate -t cmr -a cmr -g cpuacct,memory:rustbench
[20:27:45] <pnkfelix> acrichto: I cannot remember off-hand if it actually corresponds numerically to lo < hi as well
[20:28:06] <acrichto> pnkfelix: it should, it's set up as lo == lowest address of the stack and hi == highest address of the stack
[20:28:12] <cmr> eddyb: using your username instead of cmr, obviously.
[20:28:21] <pnkfelix> acrichto: but not all architecturs grow the stack in that direction
[20:28:59] <acrichto> pnkfelix: lol, well all the architectures that we work grow the stack in that direction :), but they're just high/low addresses, they don't indicate where the stack is grown from/to
[20:29:11] <eddyb> nmatsakis: I know strcat was complaining about the arithmetic op traits on integers being slow without opts, my changes reduce the IR for those significantly, which coupled with #[inline(always)] should be trivial to optimize into the direct operations
[20:29:12] <pnkfelix> acrichto: that's my problem then
[20:29:26] <pnkfelix> acrichto: Some API's might solely care about the numerical property `lo < hi`
[20:29:45] <pnkfelix> acrichto: but other clients (like me) care far more about knowing which number corresponds to the stack base
[20:29:53] <pnkfelix> acrichto: versus the tip
[20:30:00] <acrichto> pnkfelix: oh, well the stack_bounds() function will basically always return it such that lo < hi
[20:30:21] <pnkfelix> acrichto: Okay.  In the future we may need an alternative entry point that returns (cold, hot).
[20:30:31] <acrichto> that could also work
[20:30:37] <pnkfelix> acrichto: its that, or a bunch of conditional code in a bunch of places asking which direction the stack grows in
[20:31:12] <eddyb> nmatsakis: about the Deref stuff, do you have a mechanism in mind for choosing between ImmDeref and MutDeref?
[20:31:16] <acrichto> I think it's safe to assume you grow the stack down for now
[20:31:22] <pnkfelix> acrichto: but for now, I guess, the stack grows in one direction on all of the architectures we support...
[20:31:31] <pnkfelix> acrichto: I'm a little surprised by that, but perhaps I should not be.
[20:31:35] <eddyb> I guess Rc will only implement ImmDeref, so I can experiment with just that
[20:32:18] <pnkfelix> acrichto: (well, that, or maybe our existing clients truly do only care about `lo <= hi`, and the cold/hot distinction is irrelevant.)
[20:32:53] <pnkfelix> acrichto: Okay, I will go try to hack in the change to delay the stack-bounds updates to when the bdw allocator itself gets invoked
[20:32:56] <pnkfelix> acrichto: thanks
[20:33:02] <acrichto> pnkfelix: np
[20:33:38] *** Quits: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP) (Quit: Leaving)
[20:35:25] <cmr> eddyb: oh and I should warn you that it uses like 3x memory to record the data, because python.
[20:35:46] <eddyb> I only have 3GB total
[20:35:56] <eddyb> can use 1.7GB if I'm lucky/careful
[20:36:34] <eddyb> the only way that would work is if swapping the python heap is efficient
[20:36:45] <eddyb> i.e. it doesn't read after writing
[20:36:58] <eddyb> s/efficient/used efficiently
[20:37:23] <eddyb> well, no, the sentence still doesn't make sense. but you get the idea
[20:37:49] <eddyb> cmr: can you tell how many commits/PRs you've rebenched?
[20:38:10] <eddyb> might be worth bugging huon so we can see some progress
[20:38:33] <cmr> 32 or 33
[20:38:37] <cmr> not really.
[20:38:51] <cmr> maybe in 2 days.
[20:41:12] *** Joins: new_one (new_one@F2527D37.1DF5627.B3C0173E.IP)
[20:41:58] <nmatsakis> eddyb: I figured we'd start with the easy case, where it's evident from the syntax, but the general case is going to be complex; I think we hvae no choice but to start with ImmDeref and then potentially patch it up later
[20:42:58] <nmatsakis> eddyb: (also, as you say, most types will only support ImmDeref, so just getting that working is already a lot)
[20:47:35] <eddyb> patching sounds better than recursively branching (and I don't know enough about inference to even guess the possibility of the latter)
[20:48:48] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[20:50:24] *** Quits: wycats (sid79@moz-5F4AA75A.irccloud.com) (Ping timeout)
[20:50:39] *** Joins: wycats (sid79@moz-5F4AA75A.irccloud.com)
[20:55:08] <eddyb> nmatsakis: excuse my ignorance, but did you post any new information in the past week?
[21:00:17] <nmatsakis> eddyb: I have not 
[21:01:37] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[21:05:19] *** Parts: aepsil0n (eduard@moz-15CB80F2.hsi8.kabel-badenwuerttemberg.de) ()
[21:06:46] *** Quits: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro) (Ping timeout)
[21:06:55] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[21:06:55] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/EdDTlw
[21:06:55] <ghrust> 13rust/06auto 14b3673f5 15Alex Crichton: Re-work loading crates with nicer errors...
[21:06:55] <ghrust> 13rust/06auto 14946b169 15bors: auto merge of #12164 : alexcrichton/rust/rlibs-and-dylibs, r=cmr...
[21:06:56] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[21:13:51] *** Quits: japaric (japaric@8465B6C3.31BF4ADA.BFC118EE.IP) (Ping timeout)
[21:16:59] *** Joins: japaric (japaric@5A3C0563.4F37C8B4.BFC118EE.IP)
[21:24:36] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Connection reset by peer)
[21:24:54] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[21:25:02] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[21:25:05] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[21:30:24] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[21:42:48] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[21:43:28] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[21:43:28] *** ChanServ sets mode: +ao dherman dherman
[21:44:29] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[21:53:57] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[21:54:55] *** Quits: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net) (Ping timeout)
[21:55:38] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: rcirc on GNU Emacs 24.3.1)
[21:56:27] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[21:56:37] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[21:57:06] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[21:58:57] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:01:53] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[22:01:53] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/_VKkpw
[22:01:53] <ghrust> 13rust/06auto 14f7668cf 15mr.Shu: Changed NonCamelCaseTypes lint to warn by default...
[22:01:53] <ghrust> 13rust/06auto 148153db5 15bors: auto merge of #12290 : mrshu/rust/lint-warn-by-default, r=alexcrichton...
[22:01:54] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[22:01:57] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[22:01:57] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14946b169 to 146532d2f: 02http://git.io/N3iJvQ
[22:01:57] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[22:10:22] *** kimundi is now known as zz_kimundi
[22:16:15] <acrichto> brson: is a bsd license compatible with our license?
[22:16:39] <strcat> if it's 2-clause or 3-clause
[22:17:00] <strcat> the one with the advertising clause is GPL incompatible and shouldn't be used
[22:17:11] <acrichto> https://github.com/mirrors/gcc/blob/master/libbacktrace/internal.h
[22:17:11] <strcat> (adds a restriction we don't have atm)
[22:17:16] <acrichto> which one is that?
[22:18:01] <strcat> acrichto: 3-clause
[22:18:03] <strcat> it's fine
[22:18:19] <strcat> just have to leave the copyright header
[22:18:37] <acrichto> mk
[22:26:52] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[22:26:52] <ghrust> [13rust] 15bors 04force-pushed 06auto from 148153db5 to 146532d2f: 02http://git.io/N3iJvQ
[22:26:52] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[22:38:10] *** Joins: jdm (jdm@CC0122E6.8F96AEA7.2D179A7D.IP)
[22:43:18] *** Quits: mrmonday (mrmonday@moz-C7DC1A73.lin.openzula.org) (Ping timeout)
[22:52:02] *** Joins: mrmonday (mrmonday@moz-C7DC1A73.lin.openzula.org)
[22:59:56] <brson> acrichto: wonder if maybe we can have a small library work week at some point
[23:00:06] <brson> also, our landing rate seems to be almost maxed
[23:00:16] <brson> it's not going to get much better than 14 per day
[23:00:33] <acrichto> that'd be interesting yeah
[23:01:08] <acrichto> I can see where it would be really helpful for getting the ball rolling on some libraries
[23:01:13] <acrichto> and making serious progress on stabilization
[23:01:50] <acrichto> I do agree on the landing rate though
[23:01:56] <acrichto> we're not getting any faster with bors
[23:02:03] <brson> r/rust has >3000 subscribers now
[23:03:12] <acrichto> \o/
[23:07:09] <steveklabnik> niiiice
[23:07:16] <steveklabnik> OVER THREE THOOUUUUUSAAAAND
[23:07:21] <steveklabnik> doesn't have _quite_ the same ring to it
[23:08:16] *** Quits: doomlord_ (servitor@moz-9B2006BF.range109-151.btcentralplus.com) (Quit: Leaving)
[23:12:44] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[23:16:37] *** Quits: eibwen (kvirc@moz-544A7ACB.dip0.t-ipconnect.de) (Ping timeout)
[23:21:47] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[23:21:48] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14160110f to 146532d2f: 02http://git.io/N3iJvQ
[23:21:48] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[23:21:48] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[23:21:48] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/Rf8kGA
[23:21:48] <ghrust> 13rust/06auto 144ff2317 15Alex Crichton: Re-work loading crates with nicer errors...
[23:21:48] <ghrust> 13rust/06auto 148b76893 15bors: auto merge of #12164 : alexcrichton/rust/rlibs-and-dylibs, r=cmr...
[23:21:49] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[23:24:20] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[23:24:41] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[23:27:00] <strcat> fatal: reference is not a tree: 800b56fe6af21ffd8e56aee8cf12dd758f5bbdf1
[23:27:01] <strcat> Unable to checkout '800b56fe6af21ffd8e56aee8cf12dd758f5bbdf1' in submodule path 'src/libuv'
[23:27:03] <strcat> weird
[23:30:37] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[23:30:37] <ghrust> [13rust] 15alexcrichton 04force-pushed 06try from 14e15ce24 to 147c98d8e: 02http://git.io/k471pw
[23:30:37] <ghrust> 13rust/06try 147c98d8e 15Alex Crichton: Roll std::run into std::io::process...
[23:30:37] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[23:31:48] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[23:39:07] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Input/output error)
[23:44:55] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[23:51:17] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Ping timeout)
[23:52:23] *** Quits: doener (doener@moz-C68F600D.unity-media.net) (Quit: leaving)
[23:57:21] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[23:58:17] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Input/output error)
[23:59:59] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
