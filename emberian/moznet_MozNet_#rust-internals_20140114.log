[00:35:39] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Client exited)
[00:36:00] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[00:37:42] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Ping timeout)
[00:38:26] <bjz> would it be possible to do something like this? https://gist.github.com/bjz/8410878
[00:38:35] <bjz> it's a bit crazy
[00:39:36] <bjz> it would reduce the primitive types down to `#[lang="bit"] pub struct bit;`
[00:40:23] <bjz> llvm! is hypothetical
[00:40:39] <ChrisMorgan> bjz: those numbers don't make much sense. Is that deliberate?
[00:40:58] <bjz> oh wait
[00:41:09] <bjz> I have the sizes wrong for the structs
[00:41:12] <bjz> just a sec..
[00:41:15] <dbaupp> bjz: did you forget the size of a byte? :P
[00:41:20] <bjz> -_-
[00:41:23] <ChrisMorgan> (Four bits per byte, eight bytes per u8/u16/u32, sixteen bytes per u64â€¦)
[00:41:27] <bjz> yep
[00:41:37] * bjz is silly
[00:44:01] <bjz> fixed -_-
[00:44:02] <bjz> :P
[00:44:28] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[00:44:48] <bjz> oh wait still wrong
[00:44:57] * bjz is tired
[00:45:25] <dbaupp> bjz: makes sense that'd you'd be tired... given how late it is. :P
[00:45:37] <bjz> dbaupp: was up all night
[00:46:00] * bjz has trouble sleeping
[00:50:06] <bjz> ok, hopefully that should fix it: https://gist.github.com/bjz/8410878
[00:50:39] <bjz> sorry, just a crazy idea
[00:51:29] <dbaupp> bjz: it's solve documentation problems
[00:51:32] <dbaupp> *id't
[00:51:36] <dbaupp> *it'd
[00:51:37] <dbaupp> bah!
[00:52:03] * bjz likes a small, extensible language
[00:52:28] <dbaupp> bjz: send it to the mailing list or something?
[00:52:38] <bjz> is it worthy you think?
[00:52:52] <cmr> I think it could be.
[00:53:17] <bjz> ok, I shall then
[00:54:39] <cmr> Although add a #[repr(u8)] to it
[00:54:45] <cmr> because otherwise that's just dirty
[00:55:00] <bjz> oh yes
[00:55:28] <dbaupp> bool would preferably have a #[repr(i1)] too
[00:55:40] <cmr> that repr doesn't exist
[00:55:45] <bjz> I wonder if it should be: repr=8
[00:55:49] <bjz> #[repr=8]
[00:56:16] <cmr> we have repr(C) too though
[00:56:28] <dbaupp> cmr: I know it doesn't exist
[00:56:37] <dbaupp> doesn't mean it can't be added
[00:56:40] <cmr> sure
[00:57:03] <bjz> what should the subject of the email be?
[00:57:25] *** Joins: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP)
[00:57:27] *** Quits: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP) (Connection reset by peer)
[00:57:34] <bjz> "implement base types as a library"
[00:57:40] <bjz> "implement primitive types as a library"
[00:58:47] <dbaupp> bjz: it would be good to mention https://github.com/mozilla/rust/pull/11409 and...
[00:59:41] <ChrisMorgan> "#[cfg(target_word_size = "32")] pub struct intptr([byte, ..4]);"â€”is that correct? Word size and pointer size are different things.
[01:00:02] <cmr> ChrisMorgan: as target_word_size is currently defined, yes.
[01:00:03] <bjz> hm
[01:00:19] <dbaupp> bjz: and https://github.com/mozilla/rust/issues/10114
[01:00:27] <ChrisMorgan> OK. Wasn't sure whether it was incorrect or badly named. Badly named is probably the better option :-)
[01:00:43] <dbaupp> bjz: (even just "this would simplify #11409 and #10114" is enough, I think)
[01:00:52] <cmr> the attribute is probably incorrect for corner cases too :)
[01:01:00] <cmr> although we don't formally support x32 etc.
[01:01:01] <dbaupp> ChrisMorgan: I think the problem there is target_word_size is misnamed
[01:01:03] <cmr> so it's probably fine.
[01:01:08] <dbaupp> should be target_pointer_size
[01:01:17] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[01:07:04] <bjz> cmr dbaupp : https://gist.github.com/bjz/8410878
[01:08:14] <bjz> tbh I'm not sure
[01:08:26] <dbaupp> bjz: looks fine
[01:08:37] <bjz> ok I'll just throw it out there
[01:09:27] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[01:10:05] <klutzy> is this intended? https://github.com/mozilla/rust/commit/46905c04f56a2cf344f06d13bb430580d66f4e44#diff-6c935683e58519298406621438da62f6L62
[01:10:19] <bjz> dbaupp: hah, I wonder if byte could be: struct byte([bool,..8])
[01:10:19] <brson> acrichto: were the various bind_error tests added recently? they seem to be failing on android where i didn't think we had any std errors before
[01:10:24] <klutzy> rustc currently injects `extern mod std = "std";`, not `extern mod std = "std#0.9";`
[01:10:25] <brson> maybe the native impls were added
[01:10:32] <acrichto> brson: I un-ignored them recently
[01:10:34] <brson> oh, both green and native are failing
[01:10:34] <dbaupp> bjz: probably not
[01:10:41] <acrichto> brson: they were ignored when I first found them
[01:10:44] <dbaupp> bjz: (bool has to be stored as a u8)
[01:10:56] <bjz> ok
[01:10:57] <brson> acrichto: ok, i'll look into them a little and then just reignore them on android if i have to
[01:10:57] <acrichto> klutzy: yes, it makes snapshots possible
[01:11:04] <acrichto> brson: cool
[01:11:42] <klutzy> acrichto: hmm, my rustpkg patch fails due to the change, because rustpkg tried to find libstd-64b22b00-0.0.so
[01:11:53] <acrichto> klutzy: that's unfortuntae :(
[01:11:57] <bjz> dbaupp: could `struct f32([byte, ..4])` be: `#[repr=32] struct f32;`
[01:12:23] <klutzy> acrichto: maybe rustpkg needs some system version info somewhere
[01:14:10] <bjz> dbaupp: that might be a more solid bottom turtle
[01:14:58] *** Quits: gwty (gwtypc@3D97BDC1.C4000CA7.137C914F.IP) (Ping timeout)
[01:15:02] *** Quits: gwty_ (gwtypc@3D97BDC1.C4000CA7.137C914F.IP) (Ping timeout)
[01:15:07] <acrichto> brson: I also discovered that the old oneshots did not drop the data on the queue when the oneshot was deallocated, but the streams may have actually deallocated stuff (haven't looked too hard into how they work
[01:15:21] <dbaupp> brson: probably
[01:15:26] <dbaupp> *bjz
[01:15:28] <dbaupp> (sorry brson)
[01:15:49] <brson> klutzy acrichto: maybe we can make rustc inject a specific version of std but add a flag that we use in stage0 to turn it off
[01:15:57] <dbaupp> bjz: it could also just be #[lang="f32"] struct f32;
[01:16:00] * dbaupp shrugs
[01:16:00] <brson> it does seem like rustc *should* request a specifc version
[01:16:08] <acrichto> brson: the stage3 compiler could just not inject
[01:17:01] <brson> acrichto: we would have to make everything that rustc depends on link to std explicitly
[01:17:20] <brson> i imagine at this point we're pretty dependent on prelude injection?
[01:17:30] <brson> though we didn't used to inject std
[01:17:45] <acrichto> brson: ? stage2 would build stage3, injecting the right version, but stage3 (the snapshot compiler) wouldn't do injection
[01:18:56] <brson> acrichto: but when the snapshot compiler builds stage0 it's going to need to build all the crates without injection. that means none of them can rely on injection
[01:19:02] <brson> in any stage
[01:19:13] <acrichto> brson: oh by no injection I mean no injection with a version
[01:19:15] <acrichto> sry
[01:19:26] <brson> oh, ok. sure
[01:19:27] <acrichto> so stage3 doesn't inject a specific version, just "any libstd"
[01:19:35] <brson> that would work
[01:20:14] <bjz> dbaupp: ok, sent the RFC
[01:20:54] <bjz> dbaupp: I dunno, it's weird - sometimes rust-dev doesn't display my messages though
[01:21:40] <bjz> dbaupp: I can reply to threads, but not make them
[01:21:41] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[01:21:57] <dbaupp> bjz: :(
[01:22:15] <dbaupp> bjz: I assume brson has access to ML controls, ask him?
[01:22:17] <bjz> brson: is there a chance I could be blocked from rust-dev?
[01:22:20] <bjz> :P
[01:22:52] <ChrisMorgan> bjz: "OK, there you go, you're now blocked"
[01:23:00] <bjz> :D
[01:23:13] <bjz> your idea is too insane
[01:23:15] <brson> i also thought you were asking to be forcably restrained from the mailing list
[01:23:20] <bjz> says the ML
[01:23:24] <bjz> hahaha
[01:23:28] <bjz> woops
[01:25:04] <brson> bjz: i don't see anything in the moderator queue
[01:25:06] <cmr> A friend of mine who just discovered rust's first bit of code: let thereBe = if item == "first day" { light } else { nothing };
[01:25:50] <bjz> brson: it's rust-dev@mozilla.org right?
[01:25:54] <dbaupp> bjz: ... are you sending things to the correct email?
[01:26:00] <cmr> bjz: no, not even close
[01:26:00] <dbaupp> heh
[01:26:13] <bjz> :/
[01:26:24] <cmr> wait
[01:26:26] <klutzy> cmr: Some(light) and None!
[01:26:26] <cmr> I'm wrong on that one.
[01:26:35] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[01:26:35] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/TX7lJg
[01:26:35] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[01:26:36] <bjz> cmr: what is it then?
[01:26:42] <cmr> bjz: mah bad
[01:26:45] <cmr> I was thinking of the url
[01:29:03] <dbaupp> woo, less @ in the language!
[01:29:13] <pcwalton> it landed?
[01:29:14] <pcwalton> finally
[01:30:28] <bjz> dbaupp: ok, it arrived on the ML!
[01:30:49] <dbaupp> bjz: you have a voice!
[01:30:56] <bjz> *few*
[01:31:05] <bjz> now for everyone to shoot it down
[01:31:20] * bjz really shouldn't post to the ML tired
[01:31:56] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[01:31:56] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/lc_iHQ
[01:31:56] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[01:31:57] <bjz> acrichto: can you come to #rust-gamedev?
[01:37:19] <acrichto> oh man I just used util::swap and I *didn't* need util::replace
[01:38:56] <ChrisMorgan> cmr: I wouldn't describe Rust as pre-alpha; I'd describe it as alpha.
[01:39:33] <cmr> eh
[01:40:00] <cmr> probably yeah
[01:40:08] <cmr> brson: which is it, bdft?
[01:42:02] <dbaupp> cmr: 't'?
[01:42:10] <cmr> term :P
[01:42:15] <ChrisMorgan> themoment
[01:42:18] <cmr> not life, just until we decide to eject him
[01:42:41] <dbaupp> mutiny!
[01:42:46] <ChrisMorgan> Two Django BDFLs just resignedâ€¦ BDFL doesn't seem to mean much nowadays â˜¹
[01:43:03] <dbaupp> (that said, brson's doing a very good job :) no need for mutiny)
[01:43:16] <cmr> (agree)
[01:43:32] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[01:43:53] <ChrisMorgan> cmr: Rust 0.9 release announcement: "As usual, version 0.9 should be considered an alpha release, suitable for early adopters and language enthusiasts."
[01:44:02] <cmr> that settles it, then.
[01:44:05] <cmr> mah bad
[01:44:29] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[01:46:32] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[01:55:07] <Luqman> pcwalton: r? https://github.com/mozilla/rust/pull/11525
[01:55:11] <bjz> dbaupp: oh wait, it didn't pop up on the ML
[01:55:22] <bjz> I was looking at my sent messages
[01:55:31] * bjz might just make an issue
[01:55:43] <pcwalton> Luqman: r+
[01:55:43] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[01:57:02] <Luqman> thanks!
[01:57:58] <bjz> https://github.com/mozilla/rust/issues/11526
[01:59:00] <bjz> dbaupp: ^
[02:06:44] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[02:06:44] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14f61d831 to 14ab66f76: 02http://git.io/N3iJvQ
[02:06:44] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[02:06:45] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[02:06:45] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/8C8LQw
[02:06:45] <ghrust> 13rust/06auto 140201028 15Alex Crichton: dox: Write a guide to the rust runtime
[02:06:45] <ghrust> 13rust/06auto 1411a11d1 15bors: auto merge of #11501 : alexcrichton/rust/dox, r=brson...
[02:06:45] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[02:23:42] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[02:27:36] *** Quits: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[02:27:47] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Client exited)
[02:28:07] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[02:29:53] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Ping timeout)
[02:32:41] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[02:50:39] <brson> acrichto: re my channel proposal. if we just used bounded channels with the default bound being like 4k and made send by default fail, it would be equivalent of what I proposed, at the cost of allocating a 4k ringbuffer
[02:51:03] <brson> i'm wondering if we can just combine everything
[02:51:16] <acrichto> it's not just cost though, it's semantics on send?
[02:51:24] <acrichto> SyncChan doesn't fail when the bound is reached
[02:51:29] <acrichto> AsyncChan would fail
[02:51:52] <brson> well, I was thinking there would be another send_block method or something
[02:52:00] <acrichto> hmm...
[02:52:02] <brson> seperating the Sync and Async semantics is probably best though
[02:52:12] <brson> *separating by type
[02:52:23] <cmr> why 4k
[02:52:30] <cmr> why not, say, 128
[02:52:32] <acrichto> brson: well it hasn't worked out so hot in the past
[02:52:34] <cmr> or something arbitrary but small.
[02:53:03] <brson> cmr: idk, why not 256?
[02:53:10] <cmr> idk either
[02:53:12] <acrichto> brson: we'd still have a unified port type most likely, so perhaps we should merge everything?
[02:53:17] <cmr> 4096 seems large, though.
[02:53:48] <brson> cmr: my inclination was to pick something that was pretty big but is unlikely to exhaust memory when full
[02:53:49] *** Quits: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[02:54:50] <acrichto> brson: it may not be a bad plan to just add send_sync instead of a whole new type
[02:55:07] <acrichto> but I'm not sure if we could conflate the implementaitons like that
[02:55:10] <brson> acrichto: but can that work with the mpsp unbounded queue?
[02:55:12] <acrichto> they're all kinda fundamentally different
[02:55:16] <acrichto> yeah
[02:55:21] <acrichto> perhaps not
[02:55:40] <brson> we could just say send_sync fails when you are using an unbounded channel
[02:55:52] <acrichto> sounds bad
[02:56:00] <acrichto> that's like saying "timers don't work on native mode"
[02:56:11] <brson> maybe send_sync always succeeds
[02:56:14] <brson> which it does
[02:56:18] <brson> the channels unbounded
[02:56:28] <acrichto> send_sync fails when the other half drops though
[02:56:45] <brson> sure, but so does send. that's not a problem
[02:57:10] <acrichto> so you think we could get send_sync to work?
[02:57:12] <acrichto> with just a Chan
[02:57:39] <brson> i ... think it just defers to synd_async  for async channels
[02:57:41] <brson> am i missing something?
[02:58:05] <acrichto> but then it's not synchronous?
[02:58:46] <brson> sync channels are only synchronous when they hit the bound, and unbounded channels don't have a bound
[02:59:14] <acrichto> hm, I think I'm conflating ideas here
[02:59:21] <acrichto> so what does Chan::new() give me?
[02:59:52] <brson> if we're talking about combining everything. then Chan::new() probably gives you a bounded channel
[03:00:24] <acrichto> so we're basically trashing everything we currently have?
[03:00:27] <brson> with a low bound
[03:00:37] <brson> acrichto: no. when you say Chan::unbounded() you get what we currently have
[03:00:53] <brson> There are bounds of 0, everything else, and infinity
[03:01:02] <brson> and they are all distinct cases with different impl
[03:01:11] <acrichto> but all of them support send_sync
[03:01:20] <acrichto> oh wait hm
[03:01:23] <acrichto> I see
[03:01:25] <brson> yes, and fail when you hit the bound
[03:01:30] <brson> sorry
[03:01:30] <brson> no
[03:01:33] <brson> send_async fails
[03:01:52] <acrichto> so all of today's queues are the "infinity" case
[03:01:55] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[03:01:55] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/5ZxwzQ
[03:01:55] <ghrust> 13rust/06auto 1417f984c 15Luqman Aden: librustc: Don't allow use after move of implicitly coerced object. Fixes #11481.
[03:01:55] <ghrust> 13rust/06auto 14d42e758 15Luqman Aden: librustc: Don't translate an expr twice when implicitly coercing to a trait object. Fixes #11197.
[03:01:56] <brson> yes
[03:01:56] <ghrust> 13rust/06auto 14b11c3e3 15bors: auto merge of #11525 : luqmana/rust/trait-coercions, r=pcwalton...
[03:01:58] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[03:02:03] <acrichto> that's an interesting idea
[03:02:19] <brson> I still don't know if I like combining them
[03:02:41] <acrichto> it kinda makes sense
[03:02:53] <acrichto> you have two orthogonal decisions, bound size and sync/async
[03:03:02] <acrichto> sync waits for the bound to become smaller, async fails when it hits the bound
[03:03:27] <acrichto> hm then we don't have send_async and send_Sync
[03:03:30] <acrichto> we only have on send()
[03:03:41] <acrichto> or wait no
[03:03:47] <acrichto> you need to decide behavior when you hit the bound
[03:05:51] <brson> i wonder if i should follow up immediately with this alternate proposal. should probably wait to see what people think of the first
[03:06:30] <acrichto> we'd still have two decisions to make
[03:06:40] <acrichto> there are two "blessed modes" -- Chan::new() and send()
[03:06:46] <acrichto> what are their semantics?
[03:07:10] <brson> i like the semantics i've outlined as the default - small bound + failure
[03:07:31] <acrichto> so send == send_async
[03:07:35] <brson> yeah
[03:07:55] <brson> i feel like failure is better than deadlock
[03:07:56] <acrichto> I kinda like having just one type
[03:08:32] <acrichto> I'll sleep on this, but I think I really like this
[03:08:32] <brson> picking an arbitrary bound that small though seems wrong to me
[03:08:37] <brson> for some reason
[03:08:45] <brson> i was thinking an arbitrary bound that is pretty big
[03:08:55] <acrichto> that implies an unbounded channel though
[03:08:56] <brson> but a big arbitrary bound isn't appropriate for a ringbuffer
[03:08:58] <brson> right
[03:09:23] <acrichto> why can't the "big bound" be like 100K?
[03:10:00] <brson> with this combined proposal it couldn't support blocking send
[03:10:13] <acrichto> the default chan
[03:10:30] <brson> if the channels aren't combined then it could be 100k
[03:11:43] <acrichto> I'm a little afraid of having send and send_sync
[03:12:20] <acrichto> which is appropriate for my usgae?
[03:14:16] <brson> yeah
[03:14:54] <acrichto> let's see what people on the mailing list say
[03:16:25] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[03:16:52] *** Quits: zz_kimundi (kimundi@moz-B9792FFA.dip0.t-ipconnect.de) (Ping timeout)
[03:18:37] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Client exited)
[03:19:08] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[03:20:34] *** Joins: zz_kimundi (kimundi@moz-5CD33A8E.dip0.t-ipconnect.de)
[03:20:37] *** zz_kimundi is now known as kimundi
[03:20:48] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Ping timeout)
[03:21:20] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[03:21:20] *** ChanServ sets mode: +ao dherman dherman
[03:23:53] *** Joins: erickt2 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[03:23:59] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Connection reset by peer)
[03:29:11] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[03:29:14] *** Quits: erickt2 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Connection reset by peer)
[03:33:00] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[03:37:51] *** Quits: blank_name (blank_name@29F64526.16360A46.537E532E.IP) (Ping timeout)
[03:38:31] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[03:40:12] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Ping timeout)
[03:43:57] *** Quits: limeburst (me@247D1419.D73964AC.27A8748.IP) (Ping timeout)
[03:57:46] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[04:06:28] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[04:06:53] *** Joins: blank_name (blank_name@A6C6321C.964BADD.93A5C78C.IP)
[04:07:20] *** Joins: pcwalton (pcwalton@moz-F758DCCF.snfc.ca.megapath.net)
[04:07:20] *** ChanServ sets mode: +ao pcwalton pcwalton
[04:11:22] *** Quits: pcwalton (pcwalton@moz-F758DCCF.snfc.ca.megapath.net) (Quit: pcwalton)
[04:15:21] *** nrc is now known as nrc|afk
[04:16:55] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[04:16:55] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/5ZxwzQ
[04:16:55] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[04:17:00] <Luqman> yay! it's been a while since i had something land on the first try :D
[04:21:59] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[04:22:00] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/9ovMBw
[04:22:00] <ghrust> 13rust/06auto 1468fed4b 15Florian Hahn: Replace C types with Rust types in libstd, closes #7313
[04:22:00] <ghrust> 13rust/06auto 147f8ce0b 15bors: auto merge of #10943 : fhahn/rust/issue-7313-replace-c-types, r=brson...
[04:22:00] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[04:23:23] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[04:28:15] <sfackler> Luqman: now fix https://github.com/mozilla/rust/issues/11205 !
[04:28:37] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[04:33:40] <Luqman> sfackler: yes, that's one of the next things i want to tackle
[04:34:11] <sfackler> sweet
[04:34:30] <Luqman> i have a vague idea that i hope will work once i can codify it :P
[04:34:33] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[04:38:14] *** Joins: limeburst (me@247D1419.D73964AC.27A8748.IP)
[04:41:18] *** nrc|afk is now known as nrc
[04:49:31] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[04:54:37] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[04:54:37] *** ChanServ sets mode: +ao pcwalton pcwalton
[05:00:58] *** Joins: gwty (gwtypc@C045AC61.3E0F208F.137C914F.IP)
[05:01:15] *** Joins: gwty_ (gwtypc@C045AC61.3E0F208F.137C914F.IP)
[05:01:21] *** Quits: gwty_ (gwtypc@C045AC61.3E0F208F.137C914F.IP) (Connection reset by peer)
[05:18:48] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[05:19:11] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[05:24:03] <sfackler> acrichto: pcwalton: what's the status on 11151 (external macros)? It seems like it was given the go-ahead at the meeting last week, but I'm not sure what the next steps are
[05:26:26] <pcwalton> sfackler: is it ready? I can r+ it.
[05:27:01] <sfackler> there are still the build issues that make the tests failure-prone at stage1
[05:27:11] <pcwalton> ok, if that is fixed then I will r+ it
[05:27:15] <pcwalton> we decided it was good
[05:27:18] <sfackler> cool
[05:28:17] <sfackler> do you know how hard it would be to add a second kind of auxilliary file to the compile tests that link against stage n-1 libfoo?
[05:29:44] <dbaupp> sfackler: "make the tests failure prone at stage1" ... i.e. make check-stage1? would it be fixed by a snapshot?
[05:30:00] * ChrisMorgan rejoices and is exceeding glad
[05:30:20] <sfackler> dbaupp: the issue is that if anything changes in rustc enough to make name mangling change, the dlopen of the external crate will fail since it's version of libsyntax has different symbol names
[05:30:32] <sfackler> the safer thing to do is to link to the same version of libsyntax that rustc itself uses
[05:31:42] <dbaupp> sfackler: oh, you're dlopening?
[05:32:09] <sfackler> yeah, that's the only way to load non-macro_rules macros
[05:32:12] <sfackler> (I think)
[05:32:45] <sfackler> macro_rules macros are just yanked out of the metadata
[05:33:56] <dbaupp> can't you extract the appropriate function to call from the metadata?
[05:34:04] <dbaupp> oh, wait. that's not necessarily a callable object
[05:34:38] <dbaupp> you could (and can?) extract the name of the function from the metadata, but not the actual binary function.
[05:34:45] * dbaupp is on the same page now
[05:34:46] <sfackler> right
[05:34:52] <sfackler> but the bigger issue isn't that
[05:35:02] <dbaupp> oh/
[05:35:02] <dbaupp> ?
[05:35:12] <sfackler> it's that rustc has a libsyntax loaded, and the macro crate has a dynamic dependency on libsyntax
[05:35:31] <sfackler> but if the version that's loaded has different name mangling, the loader returns an error
[05:35:39] <sfackler> since it can't dynamically link the symbols together
[05:35:56] <dbaupp> ah
[05:36:11] <dbaupp> what happens if rustc (or the macro crate) is statically linked?
[05:36:33] <sfackler> no idea
[05:36:47] <dbaupp> the snapshots are statically linked, fwiw.
[05:37:25] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[05:37:36] <sfackler> that'll only cause a problem running stage0 tests though, right? which are already super broken
[05:37:42] <sfackler> unless they got fixed
[05:37:48] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[05:38:01] <dbaupp> won't it need to load the macros to compile libstd?
[05:38:19] <sfackler> it depends on how that's set up
[05:38:40] <sfackler> I think pcwalton has a plan to switch over to a two phase process that may work better
[05:38:53] <pcwalton> I don't have any plan
[05:38:56] <pcwalton> acrichto and brson may
[05:39:54] <sfackler> oh, someone was talking a week or so ago about making macro_rules macros generate code for procedural macros that would be compiled first and then dynamically linked in to compile the rest of the crate
[05:46:09] <sfackler> dbaupp: this is the kind of error you run into at runtime: undefined symbol: _ZN3ext4base38SyntaxExpanderTTTrait$SyntaxExpanderTT6expand21h44db5894356fded76gay9v0.10.preE
[05:47:53] <dbaupp> sfackler: ah, nice and comprehensible :P
[05:50:10] *** Quits: gwty (gwtypc@C045AC61.3E0F208F.137C914F.IP) (Ping timeout)
[05:51:38] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[05:51:38] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 147f8ce0b to 14b11c3e3: 02http://git.io/N3iJvQ
[05:51:38] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[05:51:39] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[05:51:39] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/FDxi9w
[05:51:39] <ghrust> 13rust/06auto 14279366a 15Brian Anderson: mk: Make TESTNAME and VERBOSE work with android. Closes #10957
[05:51:39] <ghrust> 13rust/06auto 14062b0fd 15Brian Anderson: std: Ignore bind error tests on android. #11530
[05:51:40] <ghrust> 13rust/06auto 149008931 15bors: auto merge of #11531 : brson/rust/yetmoreandroidfixes, r=alexcrichton
[05:51:42] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[05:56:53] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[05:58:37] *** Quits: dbaupp (Thunderbir@DF3B07E7.D5A1DCF.37681C44.IP) (Ping timeout)
[06:00:01] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[06:02:32] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[06:02:56] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[06:08:25] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[06:26:20] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[06:26:20] *** ChanServ sets mode: +o tjc
[06:31:51] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[06:45:31] *** Joins: glaebhoerl (glaebhoerl@moz-3590251D.kabelnet.hu)
[06:47:05] <sfackler> uh, is there any reason that if I run strace -e open rustc blah.rs I wouldn't see open called on blah.rs?
[06:47:11] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[06:50:23] <sfackler> ah, I wasn't following to other threads
[06:54:07] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[06:56:52] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[06:57:18] *** Joins: dbaupp (Thunderbir@moz-6002BAEA.lns20.syd6.internode.on.net)
[06:58:39] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[07:00:24] *** Quits: acrichto (acrichto@moz-B63D64BD.res.cmu.edu) (Ping timeout)
[07:01:22] *** Joins: acrichto (acrichto@moz-B63D64BD.res.cmu.edu)
[07:01:22] *** ChanServ sets mode: +o acrichto
[07:01:50] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[07:01:50] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/FDxi9w
[07:01:50] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[07:09:45] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[07:13:11] <sfackler> acrichto: ping
[07:14:50] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[07:15:02] <acrichto> sfackler: pong
[07:15:43] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[07:15:56] <sfackler> so I'm trying to figure out how to get the external macro stuff testable at stage1, and i'm running into some snapshot issues
[07:16:21] <sfackler> the safest thing to do seems to be to compile the macro crate with the stage0 compiler at stage1
[07:16:34] <sfackler> but it's statically linked now, so it links against the stage1 libsyntax
[07:16:53] <sfackler> which right now fails because of the mass expr -> Expr etc rename
[07:17:27] <sfackler> would it make any sense to a) distribute a dynamically linked snapshot again
[07:17:41] <sfackler> or b) add an option to disable certain compiletest tests at stage1
[07:17:41] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: Textual IRC Client: www.textualapp.com)
[07:17:47] <sfackler> or something else?
[07:18:22] <sfackler> just compiling the external macro crate with the stage1 compiler runs into a dynamic linker error when rustc tries to dlopen it
[07:18:36] <sfackler> I think because name mangling changed
[07:18:38] <acrichto> sounds like we should distribute a dynamically linked snapshot again
[07:18:47] <acrichto> we're gonna want it anyway eventually
[07:19:06] <sfackler> why'd we switch to a static one? I vaguely remember you doing that at some point
[07:19:28] <acrichto> for more leet points
[07:19:34] <sfackler> haha
[07:19:34] <acrichto> no fundamental reason
[07:19:45] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[07:19:46] *** Quits: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net) (Quit: Sharp)
[07:20:10] <sfackler> cool
[07:20:49] <sfackler> I'm not totally sure how the dynamic linker would handle it, but external syntax extension support may prohibit rustc from being statically linked in general
[07:21:30] <acrichto> yeah
[07:23:15] <sfackler> I think once we have dynamically linked snapshots again, all that'll be required to get it working is to be able to tell compiletest to build a thing with the previous stage's rustc
[07:23:49] <strcat> well, it's compiling
[07:24:01] <strcat> at the very least it will work at stage0
[07:25:16] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[07:26:41] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[07:26:41] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/1_zT0Q
[07:26:41] <ghrust> 13rust/06auto 14289ba10 15Alex Crichton: dox: Write a guide to the rust runtime
[07:26:41] <ghrust> 13rust/06auto 1477eedda 15bors: auto merge of #11501 : alexcrichton/rust/dox, r=brson...
[07:26:41] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[07:26:43] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[07:26:43] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/uRw0ig
[07:26:43] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[07:29:14] <strcat> acrichto: I actually talked to pnkfelix about headers - the current way doesn't work
[07:29:51] <acrichto> strcat: then the way forward is to get him to approve a PR to remove headers, not complaining that things don't work
[07:30:14] <strcat> if a unique pointer has an & in it, it would need to have gc metadata
[07:30:22] <strcat> if the gc was moving
[07:31:00] <strcat> and if it's not, then it's not necessary at all
[07:31:22] <strcat> because it's not enough anyway
[07:33:58] <strcat> the tracing has to be aware of the length
[07:44:07] * jld dusts off an attempt at fixing the `Option<extern fn()>` thing and makes check.
[07:45:57] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Ping timeout)
[07:46:24] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[07:46:52] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Quit: Leaving...)
[07:52:19] <Eridius> hrm, `make install` is complaining about multiple matching rust libraries when there aren't any
[07:56:30] <Eridius> oh huh, when did we get a rustlib folder?
[07:57:26] <Eridius> and why are we duplicating 5 libraries into /usr/local/lib that exist in rustlib?
[07:58:05] <strcat> the ones in /usr/local/lib are from the previous stage
[07:58:28] <strcat> you can symlink the ones in /usr/local/lib to the ones in the target dir matching the host - it works, as the ABI doesn't change between those atm
[07:58:42] <strcat> someone could add a stage marker breaking that, but it works now ;p
[07:58:59] <strcat> Eridius: rustlib contains the libs it uses to compile binaries for $TARGET
[07:59:02] <strcat> so in general it needs them
[08:36:39] *** flaper87|afk is now known as flaper87
[08:36:48] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[08:36:48] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/1_zT0Q
[08:36:48] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[08:39:29] *** Joins: gwty (gwtypc@C045AC61.3E0F208F.137C914F.IP)
[08:43:02] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[09:00:10] <eddyb> I hope I wrote that wrapper generator right... the FunctionContext stuff in trans should be rewritten IMHO
[09:08:25] *** Joins: sigma (sigma@moz-9EAC972C.range86-184.btcentralplus.com)
[09:19:40] <eddyb> Ret(bcx, Call(bcx, bare_fn, llargs, [])); // close enough?
[09:24:04] *** Quits: gwty (gwtypc@C045AC61.3E0F208F.137C914F.IP) (Connection reset by peer)
[09:26:43] *** Joins: gwty (gwtypc@3911E085.895DD04D.E6FB80A5.IP)
[09:32:33] *** Quits: sigma (sigma@moz-9EAC972C.range86-184.btcentralplus.com) (Client exited)
[09:35:04] *** Joins: sigma (sigma@moz-9EAC972C.range86-184.btcentralplus.com)
[09:40:58] *** Quits: gwty (gwtypc@3911E085.895DD04D.E6FB80A5.IP) (Client exited)
[09:41:40] *** Joins: gwty (gwtypc@3911E085.895DD04D.E6FB80A5.IP)
[09:43:50] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[09:43:54] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[09:44:01] *** Joins: rca (rcatolino@moz-1D2195F3.adsl.proxad.net)
[09:54:09] <Yurume> I'm planning to make a tongue-in-cheek periodic table of Rust types like this: http://cosmic.mearie.org/tmp/20140114-rusttypes.png (not intended for distribution, just an experiment)
[09:54:55] <Yurume> is my understanding of the matrix correct or not? is there a missing piece? (well, I know that *T and *mut T are missing, but other than that...)
[10:01:08] <eddyb> Found return instr that returns non-void in Function of void return type!
[10:01:30] <eddyb> oh come on, do I need to really handle that case specially?
[10:02:08] <eddyb> Yurume: str is [u8]
[10:02:40] <Yurume> a bare str?
[10:02:58] <eddyb> Yurume: it has all the DST properties
[10:03:10] <Yurume> or are you suggesting to merge the 3rd and 4th rows?
[10:03:34] <pnkfelix> eddyb: what about the UTF-8 format constraint on str?
[10:03:35] <eddyb> not really. just that either str will be an unsized type, or it will disappear completely
[10:03:50] <Yurume> ah, so DST will allow a bare `str` as an unsized type, got it.
[10:04:04] <eddyb> pnkfelix: that's library-enforced :P
[10:04:10] <Yurume> how about generic bounds?
[10:04:23] <eddyb> Yurume: where?
[10:04:42] <Yurume> I feel a bit guilty on keeping all generic pointers in the first row
[10:04:57] <eddyb> (I'd also use |..A| -> R for closures, but that's just me)
[10:05:05] <Yurume> as &Trait and ~Trait implies different bounds
[10:05:24] <eddyb> s/generic/trait object
[10:05:31] <eddyb> only Any is truly "generic"
[10:05:45] <Yurume> I'm not sure about terminology, but yeah.
[10:05:51] <Yurume> I was*
[10:06:05] <eddyb> Yurume: also, stylistically, it would be nice to have antialiasing for the text
[10:06:26] <Yurume> eddyb: it is in the design phase, I'd like to make an SVG version for that.
[10:06:30] *** Quits: acrichto (acrichto@moz-B63D64BD.res.cmu.edu) (Ping timeout)
[10:06:40] <Yurume> (since Google Drawing is not for everything)
[10:06:41] <eddyb> if I were you, I'd just write it in HTML - I could easily fix it up if it were a jsfiddle
[10:06:51] *** flaper87 is now known as flaper87|afk
[10:06:51] <eddyb> ah, SVG is cool with me
[10:07:17] <Yurume> I'm also considering d3.js in the case that the interactivity is needed
[10:07:46] <Yurume> (never used that before, is d3.js suitable for that?)
[10:09:21] <eddyb> Yurume: the last row feels a bit weird... it keeps the old &fn/~fn distinction. the Fn trait should solve that issue, though, not much you can do about it until then
[10:11:13] <eddyb> oh, 'r - is that for "region"? I thought that terminology was outdated, the compiler still uses it in places because it's a lot of refactoring work to do
[10:11:15] <eddyb> define internal i64 @"_$x7cint$x7c$x20.$GT$$x20int.$x27static$x2bSend$x2bFreeze$x2bSized::from_bare::h0a41faf008e3b59aac"({ i64, %tydesc*, i8*, i8*, i8 }*, i64) unnamed_addr {
[10:11:31] <Yurume> or 'a? :)
[10:11:38] <eddyb> 'a is fine
[10:11:46] <strcat> I prefer A, B, C, D for type parameters and 'a, 'b, 'c for lifetimes now
[10:11:52] * strcat is broken of his T, U, V and 'r habits
[10:11:53] *** Joins: acrichto (acrichto@moz-B63D64BD.res.cmu.edu)
[10:11:53] *** ChanServ sets mode: +o acrichto
[10:12:06] <eddyb> T is still cool if you only have one type param
[10:12:08] <Yurume> I want to mark those lifetime/type variables differently from other text
[10:12:22] <eddyb> if you have 2, it's already too far
[10:12:23] <strcat> eddyb: meh, A!
[10:12:40] <pnkfelix> for a diagram like this, which could e.g. appear in a slide in a presentation
[10:12:40] <eddyb> strcat: so, you like that function definition above?
[10:12:49] <strcat> hm?
[10:12:52] <pnkfelix> there is a benefit to choosing letters that have distinct names
[10:13:02] <eddyb> it's a wraper for fn(int) -> int as |int| -> int
[10:13:07] <pnkfelix> i.e. that you do not have say "lowercase 'a', uppercase 'A'"
[10:13:25] <pnkfelix> (just a peep from the peanut gallery)
[10:13:48] <strcat> pnkfelix: A, B, C, 'z, 'y, 'x ? ;p
[10:13:54] *** flaper87|afk is now known as flaper87
[10:14:22] <eddyb> 'l would be nice if it would be obvious that it's lowercase L
[10:14:26] <Yurume> ugh, are there named lifetime parameters in the bare function type?
[10:14:32] <pnkfelix> strcat: sure, plenty of subranges to choose from.  Plus there's always 'Î”
[10:14:39] <pnkfelix> (j/k)
[10:14:40] <eddyb> Yurume: nope
[10:14:56] <Yurume> or is a part of proposals?
[10:15:00] <strcat> pnkfelix: did you see https://github.com/mozilla/rust/pull/11535 ? I don't think it will make tracing harder... don't want to get in the way though
[10:15:02] <Yurume> i.e. http://smallcultfollowing.com/babysteps/blog/2013/10/10/fn-types-in-rust/
[10:15:09] <eddyb> pnkfelix: 'Î»
[10:15:14] <eddyb> Yurume: that's old
[10:15:17] *** Joins: jensnockert (jensnocker@moz-33279404.customers.ownit.se)
[10:15:20] <strcat> afaik those headers need to go regardless of whether gc needs headers
[10:15:24] <Yurume> okay
[10:15:35] <eddyb> 'L defies the naming rules, I feel like
[10:15:51] <Yurume> I don't know what issue is about Fn types though...
[10:16:02] <Yurume> #10124?
[10:16:16] <Yurume> (i.e. varadic generics RFC)
[10:16:52] <pnkfelix> strcat: Yeah.  I might want to keep the type_desc, but the ref_count/prev/next can all go.  And we can always put the type_desc back later if desired.
[10:17:12] <strcat> pnkfelix: might want it at a negative index though
[10:17:15] <pnkfelix> strcat: and I suspect that if we do add any header, it would probably go at a negative offset
[10:17:18] <strcat> yeah
[10:17:36] <strcat> and you mentioned that it might be necessary for ones with borrowed ptrs
[10:17:38] <eddyb> strcat: that closure wrapper for a bare fn can be inlined by LLVM :D
[10:17:41] <strcat> and this is all just owns_managed
[10:17:44] <strcat> not reaches managed
[10:18:02] <strcat> eddyb: hm?
[10:18:10] <pnkfelix> strcat: (but I suspect we're going to have to put info into a separate table anyway, to support interior pointers that we find conservatively on the stack, which means that headers may be unnecessary anyway.  Not sure yet.)
[10:18:44] <pnkfelix> (table, trie, whatever; I just mean some metadata allocator structure)
[10:18:48] <eddyb> strcat: each bare fn type has a closure wrapper that forwards its arguments to a function pointer stored in the env
[10:19:00] <strcat> pnkfelix: well, I like the idea of it being separate to keep gc away from my unique pointers ;p
[10:19:17] <strcat> eddyb: ah, you implemented that?
[10:19:17] <eddyb> fn as || becomes (fn, closure_from_bare_fn_wrapper)
[10:19:22] <eddyb> strcat: yupp :D
[10:19:26] <strcat> nice
[10:19:49] <pnkfelix> strcat: I don't know if we can avoid putting gc-stuff into the allocation/free code paths for ~T/~[T]/etc
[10:19:52] <strcat> eddyb: land it asap plx ;p
[10:20:03] <pnkfelix> strcat: but the record structure itself can probably be blind to the GC.
[10:20:17] <Yurume> eddyb: if I read correctly the issue, Fn<U, ..T> is much more like a C++ functor interface and not a (type of) built-in type (which would have impls for Fn though), isn't it?
[10:20:17] <strcat> pnkfelix: well, I just want trait objects and so on to not need tydescs
[10:20:24] <strcat> pnkfelix: so side tables make me happy
[10:20:46] <strcat> I don't really care if when using the stdlib you still have side tables without using gc ;p
[10:20:53] <strcat> as long as it can be avoided
[10:20:56] <Yurume> then I don't see a problem with the oldy &fn()/~fn() distinction, since it exists and it will continue to exist
[10:21:08] <eddyb> Yurume: nope
[10:21:30] <Yurume> or is the distinction slated for removal?
[10:21:41] <strcat> Yurume: there is only |A| -> B and proc in terms of closures
[10:21:59] <strcat> borrowed stack closures and single-execution owned heap closures
[10:22:01] <eddyb> it's the other way around, closures and procs are anonymous types implementing Fn and being cast to &Fn/~Fn
[10:22:08] <eddyb> or ~OnceFn for proc
[10:22:14] <strcat> hm
[10:22:27] <eddyb> we just don't have the Fn trait yet, it's compiler magic right now
[10:22:27] <strcat> eddyb: would OnceFn just do call by-value?
[10:22:29] <Yurume> eddyb: so wouldn't there be a built-in syntax for closures and procs then?
[10:22:43] <eddyb> Yurume: it would be sugar for the Fn trait(s)
[10:22:45] <strcat> eddyb: so... technically if you captured non-linear things only you could call it more than once ;p
[10:22:49] <Yurume> aha
[10:22:54] <Yurume> got it, now it makes sense.
[10:23:13] <Yurume> then the matrix would need *two* rows in place of the final row
[10:23:20] <strcat> Yurume: eventually, closure syntax should make a uniquely typed unboxed closure
[10:23:26] <strcat> able to coerce to proc/||
[10:23:39] <strcat> and the uniquely typed closure would also impl Fn
[10:23:43] <eddyb> well, proc/&||
[10:23:44] <strcat> so it's forwards compatibility thing
[10:24:10] <strcat> ugh
[10:24:18] <strcat> it's so stupid that make uses guile now
[10:24:20] <strcat> ;p
[10:24:58] <strcat> how can we make a crappy build tool better? totally needs an embedded lisp + boehm gc
[10:25:23] <eddyb> if we make |..Args| -> Ret sugar for Fn<..Args, Ret> and implement the "hidden generics by using a trait type" RFC, you can keep some of the current code
[10:25:36] <eddyb> but 'a || would become &'a ||
[10:26:41] <sigma> I tend to think of make as a compile target at this point
[10:27:09] <Yurume> eddyb: how about bare functions? will they be kept?
[10:27:22] <eddyb> Yurume: yes, they're just function pointers
[10:27:27] <eddyb> you need them for FFI
[10:28:00] <Yurume> and no possibility (hah) for bare once functions, right?
[10:28:14] <eddyb> why on earth would you have a bare once function?
[10:28:19] <eddyb> just think about it
[10:28:34] <Yurume> yeah, I don't think so, but just in the case.
[10:28:42] <Yurume> (since I'm filling the matrix...)
[10:31:01] <eddyb> strcat: I just realized that what I just wrote will be replaced by impl<..Args, Ret> Fn<..Args, Ret> for fn(..Args) -> Ret {fn call(&self, ..args: Args) -> Ret {(*self)(..args)}}
[10:39:06] <kimundi> eddyb: Well, there are many ways how the transition could look like: 'a |..A| -> T could also just become sugar for &'a mut Fn<..A, T>
[10:39:26] <eddyb> kimundi: hackier than the other way
[10:39:53] <kimundi> Maybe, I haven't rally compared them
[10:39:58] <kimundi> really*
[10:41:00] <Yurume> eddyb: I have a revised version of the matrix: http://cosmic.mearie.org/tmp/20140114-rusttypes2.png how about this?
[10:41:49] <eddyb> oooh, I like this one
[10:42:14] <Yurume> and I forgot to fill the rightmost-bottommost cell to black, ha
[10:42:35] <kimundi> Much better than the first one, me like :)
[10:42:55] <eddyb> Yurume: you don't need to put the return type first, that's not a limitation in the variadic generics RFC
[10:43:13] <eddyb> <..Args, Ret> will be just as valid as <Ret, ..Args>
[10:43:23] <Yurume> I was following the RFC convention, yeah
[10:44:00] <Yurume> given that this one seems to look good, I'll make a page with this design
[10:44:12] <Yurume> (and I'll need a description for each rows and columns)
[10:44:19] * Yurume afk
[10:44:20] <eddyb> Yurume: I'd put the primitive types (or at least the sized ones) above Trait
[10:44:42] <kimundi> (Hm, interestingly, I think with DST and a library defined str type, you could actually create &mut str without problem - you'd just not have any functions that uses that type)
[10:45:00] <Yurume> eddyb: in the Korean Rust channel it was suggested that Trait should go below the vectors and strings
[10:45:18] <kimundi> yeah, primitive, vec, str, trait seems like a better order
[10:45:30] <Yurume> okay, I'll apply it :)
[10:45:35] <Yurume> I'm running out of time...
[10:47:04] *** Joins: c-a (c-a@moz-57C82A9.a163.priv.bahnhof.se)
[10:51:51] <eddyb> cmr: I might need you to time my changes, too much local variance to estimate impact
[10:52:17] <eddyb>   time: 1.615 s llvm function passes
[10:52:22] <eddyb> libstd is compiling :D
[10:53:05] <dbaupp> Yurume: fwiw, "planned" might be better to be "maybe" (or something), I don't think the core-team has agreed on them completely yet
[10:53:16] <dbaupp> (not that it matters that much
[10:53:17] <dbaupp> )
[10:53:49] <eddyb> and libextra compiles, which means I didn't break cross-crate stuff
[10:54:08] <eddyb> acrichto: haha, librustuv has two more unused muts
[10:54:24] <eddyb> mut ~self, that is
[10:54:46] <eddyb> oh noes that will require recompiling the compiler. bleah
[10:59:07] <eddyb> strcat, dbaupp: can I remove ExprSelf pls?
[10:59:20] * strcat shrugs
[10:59:22] <eddyb> it requires an annoying hack in resolve
[10:59:57] <eddyb> ExprPath on the other hand, should just work
[11:00:25] <eddyb> is there no other one around that I can ask for a decision?
[11:04:24] <dbaupp> nmatsakis may be around?
[11:06:53] <eddyb> this early? I somehow doubt it
[11:09:06] *** Quits: jensnockert (jensnocker@moz-33279404.customers.ownit.se) (Input/output error)
[11:09:56] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[11:10:59] <pnkfelix> eddyb: he's often awake by now, but he may also still be recovering from jet lag.
[11:11:23] <eddyb> pnkfelix: oh, hmm, where is he then?
[11:11:42] <pnkfelix> eddyb: east coast of USA, but he often gets up before 5am.
[11:12:09] <eddyb> oooh, that explains it. like it wasn't hard enough to guess just for US in general :P
[11:12:16] <eddyb> pnkfelix: thanks, I'll keep that in mind
[11:12:40] * dbaupp thought he must've been in Europe, based on when he appeared in IRC
[11:12:55] <dbaupp> clearly I haven't been paying enough attention
[11:13:54] <pnkfelix> dbaupp: its not like we discuss our locations all that often.  Your inference wasn't far off.
[11:14:55] <dbaupp> true enough
[11:15:05] <dbaupp> for all I know, you're all on the moon
[11:15:09] <eddyb> just an ocean in between :P
[11:15:33] <eddyb> dbaupp: ISS would screw any timezone guesses
[11:16:21] *** flaper87 is now known as flaper87|afk
[11:16:35] <eddyb> but you could figure it out from the lag
[11:17:16] <dbaupp> apparently it's only a second to the ISS
[11:17:40] <pnkfelix> dbaupp: weird, your boehm-rs/ffi.rs doesn't have the on_heap_resize family (callback typedef, setter, getter).  Did you remove it by hand?
[11:17:51] <pnkfelix> dbaupp: I've never used rust-bindgen, so maybe its some artifact of that
[11:17:58] <eddyb> talk about lag, I have <5ms ping on freenode. because the server is just a hundred miles away. guess at what cost does it come?
[11:18:02] <pnkfelix> dbaupp: (or maybe your gc.h didn't have it?)
[11:18:18] <eddyb> the server itself lags a little and then it drops from time to time
[11:25:49] <dbaupp> pnkfelix: I'd guess my gc.h doesn't have it
[11:26:10] <pnkfelix> dbaupp: hmm.  Do you know where you got your bdwgc from?  (Or what version it is?)
[11:26:20] <dbaupp> pnkfelix: debian unstable repos
[11:26:23] <dbaupp> let me check
[11:26:27] *** flaper87|afk is now known as flaper87
[11:26:31] <pnkfelix> dbaupp: Ah.  Okay.  I grabbed mine from github.
[11:27:10] <dbaupp> pnkfelix: 7.2
[11:27:39] <pnkfelix> okay, I've got 7.4.0
[11:27:39] <dbaupp> ah, I've got the github source too, and that's 7.5
[11:27:54] <pnkfelix> dbaupp: hmm.  Why do I only see 7.4.0 for mine
[11:28:00] <dbaupp> weird
[11:28:08] <pnkfelix> dbaupp: Where are you getting the version info?  I was looking in ChangeLog ?
[11:28:22] <eddyb> dbaupp: too late now, ExprSelf is gone just like DefSelf
[11:28:24] <dbaupp> Oh, I looked in include/gc_version.h
[11:28:28] <eddyb> bye bye
[11:28:31] <dbaupp> (I'm at b746e637bf21f652b078b822e969e783075450f9 fwiw)
[11:28:38] <dbaupp> I guess 7.5 is the dev version
[11:28:44] <pnkfelix> dbaupp: Okay, mine is 7.5.0 too
[11:29:24] <pnkfelix> dbaupp: yeah, I'm working on a fork of b746e637bf too
[11:30:21] <pnkfelix> dbaupp: (all I've done is put in a commit of the autoconf generated stuff, e.g. configure, because it was painful for me to figure out how to run autotools properly, let alone integrate automatically running autotools into our build system.)
[11:34:23] <dbaupp> pnkfelix: yeah, we don't need another build system dependency just yet
[11:34:40] <dbaupp> back in a tick
[11:34:41] *** Quits: dbaupp (Thunderbir@moz-6002BAEA.lns20.syd6.internode.on.net) (Quit: dbaupp)
[11:38:04] *** Joins: dbaupp (Thunderbir@moz-6002BAEA.lns20.syd6.internode.on.net)
[11:45:10] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[11:45:28] <pnkfelix> dbaupp: BTW, on the load_factor discussion we had yesterday
[11:45:37] <pnkfelix> dbaupp: the analogous thing in BDW is discussed in gc.h
[11:45:55] <pnkfelix> dbaupp: in the comments above the getter/setter for free_space_divisor
[11:46:09] <eddyb> I can't remove the wrapper for extern "C" fn's :( 
[11:47:39] <dbaupp> pnkfelix: having a look now
[11:47:51] <eddyb> unless... I make trans::base capable of handling both calling conventions when building a function, then call extern "C" Rust fn's just like extern "C" fn pointers
[11:49:00] <dbaupp> pnkfelix: ah, so they're limited to a maximum of L = 2
[11:49:12] <dbaupp> (assuming I'm understanding this correctly)
[11:49:51] <dbaupp> eddyb: that sounds like a pretty sensible solution :) (in fact, I'm slightly surprised we're not already doing that... unless the env pointer was screwing things up for us.)
[11:50:25] <pnkfelix> dbaupp: ... N is twice number of traced bytes
[11:50:30] <pnkfelix> dbaupp: so I think its a max of L = 3
[11:51:11] <dbaupp> pnkfelix: oh, yes
[11:51:14] <pnkfelix> dbaupp: (well, N is twice number of traced bytes plus other stuff)
[11:51:26] <eddyb> dbaupp: right, the ABI is enough info to allow calling the Rust-with-C-cconv fn from Rust - and coercing to a closure could be denied when ABI != "Rust"
[11:51:44] <pnkfelix> dbaupp: but yes, I think you are correct that this API an upper bound on L.  Then again, 3 is a pretty large value for L.
[11:52:05] <pnkfelix> sed -e s/this API an/this API forces an/
[11:52:55] <dbaupp> pnkfelix: ok, thanks for confirming
[11:52:59] *** Quits: rca (rcatolino@moz-1D2195F3.adsl.proxad.net) (Ping timeout)
[11:53:22] <pnkfelix> dbaupp: Thanks for pointing that out, I hadn't noticed it when I first skimmed that comment.
[11:54:19] <pnkfelix> dbaupp: (anyway, I mostly just wanted to point out the different ways that people describe this concept, for better or for worse.  I find the hash-table analogy personally interesting, but I don't know if others find it useful.)
[12:00:41] <dbaupp> pnkfelix: did you happen to look at https://github.com/mozilla/rust/pull/11535 ?
[12:01:01] <pnkfelix> yeah, strcat pointed me at it earlier.
[12:01:31] <pnkfelix> dbaupp: we discussed it.  I don't have any problem with it.  If we need to put TypeDesc back in later for the GC, I would probably put it at a negative offset anyway.
[12:01:41] <pnkfelix> dbaupp: I'll put a note saying so on the PR
[12:11:20] *** Joins: rca (rcatolino@moz-1D2195F3.adsl.proxad.net)
[12:11:24] <eddyb> nmatsakis: any thoughts about moving vtable generation from typeck to trans?
[12:12:11] <eddyb> I have a bad feeling that some information is truly missing. substitutions for an impl<A, B> Drop for Foo<A, B, int> may not be obvious in trans
[12:25:33] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Client exited)
[12:25:54] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[12:27:40] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Ping timeout)
[12:32:31] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[12:32:54] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[12:33:40] <kimundi> Yurume: It would be interesting to see that pointer/mutability periodic table as it would look like in C or C++ - mostly with * everywhere, but with annotation about which invariants the programmer needs to keep in his head
[12:33:54] *** Quits: gwty (gwtypc@3911E085.895DD04D.E6FB80A5.IP) (Ping timeout)
[12:35:18] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[12:35:53] *** Joins: gwty (gwtypc@C24C93D9.918BC1CC.137C914F.IP)
[12:36:39] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[12:37:02] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[12:42:14] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[12:44:48] *** kimundi is now known as zz_kimundi
[12:46:51] *** Quits: rca (rcatolino@moz-1D2195F3.adsl.proxad.net) (Ping timeout)
[12:54:41] *** Joins: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net)
[12:56:20] *** Quits: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net) (Quit: Sharp)
[12:56:31] <eddyb> dbaupp: closing two issues - not the extern "C" one, it would take even more time
[12:57:23] *** Joins: rca (rcatolino@moz-1D2195F3.adsl.proxad.net)
[12:57:42] <dbaupp> eddyb: <3
[12:58:04] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[13:01:38] <eddyb> time to figure out why some tests are failing. that will take a few more hours. and my mom is going to be annoyed again that I'm working all day
[13:11:08] <eddyb> compile-fail are all passing (impl/trait method mismatch now counts self as a parameter)
[13:11:26] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[13:14:00] <dbaupp> pnkfelix: I've implemented a collection policy based on inverse load ratio, and it seems to have fixed the quadratic behaviour.
[13:14:13] <pnkfelix> dbaupp: great, cool.
[13:15:02] <pnkfelix> dbaupp: by the way, it seems like your ffi.rs for boehm-rs is missing the functions under the THREAD_SAFE preprocessor flag.  (Unless those were only added after 7.2...)
[13:15:33] <dbaupp> pnkfelix: maybe I didn't pass the THREAD_SAFE flag to rust-bindgen
[13:15:44] <dbaupp> I can't remember (that seems likely)
[13:16:13] <pnkfelix> dbaupp: (I'm using my own rewrite anyway, but I've been cribbing from your ffi.rs to save myself some time)
[13:20:06] <eddyb> hahahaha
[13:20:18] <eddyb> so guess what side-effect a zero env ptr had?
[13:20:48] <eddyb> bypassing proc drop_glue
[13:21:37] <eddyb> now it's trying to free my bare_fn (which is the env)
[13:23:22] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Input/output error)
[13:25:15] <eddyb> is there an equivalent to 'static || for procs?
[13:29:29] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[13:36:21] *** zz_kimundi is now known as kimundi
[13:40:04] *** Quits: gwty (gwtypc@C24C93D9.918BC1CC.137C914F.IP) (Ping timeout)
[13:41:20] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[13:41:59] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Input/output error)
[13:51:28] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[13:53:52] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[14:01:42] *** Quits: flaper87 (flaper87@moz-107AD163.redhat.com) (Quit: Bye!)
[14:03:59] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[14:19:10] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[14:23:04] *** Joins: quibbit (Mibbit@moz-B818A6C0.pool.mediaways.net)
[14:25:32] <nmatsakis> eddyb: why do you want to remove ExprSelf? I can't say I'm in favor of that (I am also not in favor of moving vtable resolution out of typeck, seeing as it is fallible)
[14:25:48] <nmatsakis> well I may be in favor of removing ExprSelf, potentially?
[14:26:03] <nmatsakis> by the way, I've almost finishing rebasing over your changes.
[14:26:08] <eddyb> nmatsakis: I already did it. it required special handling in resolve for no reason
[14:26:31] <nmatsakis> well, there *is* reason
[14:26:40] <eddyb> don't tell me it's about ribs
[14:27:05] <nmatsakis> no no, I just mean, there is a reason it's a keyword, and, generally speaking, keywords corresponds to distinct AST forms.
[14:27:16] *** Joins: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net)
[14:27:17] <nmatsakis> but I guess it's fine to use a special identifier and ExprPath
[14:27:26] <nmatsakis> probably works out cleaner
[14:27:33] <nmatsakis> (which I guess is your point)
[14:27:34] <eddyb> you still can't use it anywhere you couldn't before
[14:28:10] <nmatsakis> right
[14:28:49] <eddyb> I have only a handful of failures, most of them being bare fn -> proc coercions trying to free the bare fn (or something like that)
[14:29:02] <nmatsakis> what are you trying to do?
[14:29:33] <eddyb> I hope I can easily create a fake heap-allocated env containing the function pointer for bare fn -> proc coercion (if we want to keep that)
[14:29:42] <eddyb> nmatsakis: I removed the env argument
[14:29:53] <nmatsakis> I was afraid you were going to say that
[14:29:55] *** Joins: flaper87|afk (flaper87@moz-107AD163.redhat.com)
[14:29:55] <nmatsakis> -1
[14:30:11] <nmatsakis> as I've commented time and time again in that issue...
[14:30:48] <eddyb> the only reason it's there in the first place is coercion... and the only other solution I've heard is moving it to the end of the argument list, which smells of UB to me
[14:30:50] <nmatsakis> well, I should say this: -1 until I understand how you resolved the various problems it raises...
[14:30:56] <nmatsakis> coercion is a very good reason
[14:31:08] <nmatsakis> and precisely the reaosn I don't want to remove it
[14:31:20] <eddyb> I'm generating a wrapper calling the env pointer, for closures
[14:31:20] <nmatsakis> what does "UB" mean?
[14:31:24] <eddyb> undefined behavior
[14:31:37] <nmatsakis> why would it be UB?
[14:31:55] <nmatsakis> we'd still pass NULL, it'd just be at the end of the parameter list.
[14:31:59] <eddyb> calling a function with an extra argument on the end
[14:32:34] <nmatsakis> a wrapper doesn't permit coercion from a bare fn pointer
[14:32:34] <eddyb> nmatsakis: my solution for closures is equivalent to a future impl<..Args, Ret> Fn<..Args, Ret> for fn(..Args) -> Ret {fn call(&self, ..args: Args) -> Ret {(*self)(..args)}} that would live in the library
[14:32:44] <nmatsakis> without an extra layer of indirection
[14:32:58] <nmatsakis> or runtime code generation
[14:33:04] *** flaper87|afk is now known as flaper87
[14:33:21] <eddyb> nmatsakis: a wrapper for each closure type, that is
[14:33:38] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[14:33:42] <eddyb> if LLVM can inline the closure call, it will remove the indirection
[14:33:44] <nmatsakis> right, that's the extra layer of indirection
[14:34:23] <eddyb> if not, the cost is that of a jump
[14:34:36] <nmatsakis> right, an indirect jump
[14:35:06] <nmatsakis> I ... perhaps over-reacted earlier in saying -1 straight out -- 
[14:35:10] <eddyb> neglible when you lose all the benefits from inlining the closure in the first place
[14:35:11] <nmatsakis> I know that passing an extra argument is not zero cost either
[14:35:20] <nmatsakis> but it's more than just a change to trans,
[14:35:24] <nmatsakis> I think it affects the model of the language,
[14:35:40] <nmatsakis> I don't agree that the cost of a virtual call is negligible
[14:35:44] <eddyb> and LLVM spends time optimizing out the extra argument for every function
[14:35:52] <nmatsakis> particularly because that trampoline is a megamorphic cal site
[14:35:53] <eddyb> nmatsakis: if it's virtual, you're doing something wrong anyway
[14:35:57] <nmatsakis> no, you're not.
[14:36:01] <nmatsakis> you're calling a function by pointer.
[14:36:06] <nmatsakis> it's not exactly unusual
[14:36:47] <nmatsakis> I guess the question is: what gain do we get by removing the extra arg vs moving it to the end?
[14:36:59] <nmatsakis> also, I wonder what the precise rules are with respect to UB and extra arguments 
[14:37:18] <nmatsakis> presumably it is undefined unless one writes `...`
[14:37:40] <eddyb> cleanliness, maybe remove some time spent in LLVM
[14:37:47] <nmatsakis> I don't think llvm will optimize away an argument
[14:37:55] <eddyb> it tries
[14:38:15] <nmatsakis> I guess if the function is not visible to the oustide world?
[14:38:17] <eddyb> (for internal functions, at --opt-level=3, I've seen it happen)
[14:38:20] <nmatsakis> ok
[14:38:39] <nmatsakis> the argument I would find most persuasive is that it enables LLVM to do other, more complex optimizations, like TCO or something
[14:38:42] <eddyb> keep in mind that it's the same code (well, more compact because I can) as the one generated by the above implementation of the bare fn -> closure coercion
[14:38:57] <nmatsakis> what's the same code?
[14:39:05] <eddyb> the wrappers I generate
[14:39:27] <nmatsakis> well, the point is that when you call the closure, you call a wrapper that turns around and does another call
[14:39:39] <nmatsakis> vs today, where you do only one virtual call
[14:40:12] <eddyb> nmatsakis: and it enables us to get rid of the ridiculous wrappers for extern "C" (though dbaupp pointed out that those could live without the env ptr anyway, if you forbid coercing them to a closure)
[14:40:13] <nmatsakis> I guess I'd be tempted to remove the coercion from bare fn to closure if we're not going to have the env argument
[14:40:36] <nmatsakis> eddyb: I ... don't care about those wrappers, in particular, but I think we can get rid of them in other ways.
[14:40:48] <nmatsakis> as dbaupp said
[14:40:55] <nmatsakis> they are there mainly for current convenience
[14:41:34] <nmatsakis> eddyb: it's a tough call. I see the argument, and it'd be nice to have the "Rust ABI" map that much closer to straight-up C
[14:42:02] <nmatsakis> I feel like some empirical evidence might be in order
[14:42:12] <nmatsakis> but it's hard to decide what to measure :/
[14:42:26] <nmatsakis> ok, got the #3511 branch building again. horray.
[14:43:06] <eddyb> I'm tempted to remove bare fn -> proc coercion, because it requires more machinery than a regular closure (as I've said, now it tries to free the environment, which is a pointer to a function)
[14:44:01] <eddyb> nmatsakis: well, I have a branch which bootstraps modulo freeing procs coerced from bare fns, if you want me to do anything with it
[14:44:11] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[14:45:12] <nmatsakis> eddyb: Sorry, I don't want to shoot you down, and it sounds like good work. I'm just not sure if removing the env argument is the right thing; seems like it needs some more discussion.
[14:45:29] <eddyb> this week's meeting?
[14:45:36] <nmatsakis> yeah, I can bring it up today
[14:45:43] <nmatsakis> see what the temperature of the room is
[14:45:56] <nmatsakis> I'd like to try and figure out if there is a way to test the cost of each thing --
[14:45:59] <nmatsakis> in that regard,
[14:46:02] <nmatsakis> having a functional branch is probably pretty helpful
[14:46:11] <nmatsakis> if we can decide what to benchmark :)
[14:46:18] <eddyb> this is what I get for working based on non-core-devs' opinions
[14:47:19] <nmatsakis> eddyb: I will say this... Generally speaking, removing magic is often the right thing, so maybe this is another case of it. Though I think as magic goes this is kind of borderline.
[14:47:43] <nmatsakis> by magic I guess I mean: usually if we hew close to C, we're happier in the end.
[14:47:55] <nmatsakis> that seems to be the "pro" argument :)
[14:48:15] <nmatsakis> eddyb: is your branch pushed to github?
[14:48:20] <eddyb> nmatsakis: btw, we found something yesterday which might allow us to dead-store-eliminate entire heap-using tests (and now I'm curious about my zero_1kb vector benchmarks) - mostly missing LLVM attributes and not-the-expected-types for malloc/free
[14:48:28] <eddyb> one sec, committing right now
[14:48:49] <nmatsakis> eddyb: nice
[14:49:43] <nmatsakis> eddyb: at first I thought your changes were going to be a big pain for my branch, but in the end it wasn't that big a deal to merge them. I've changed Datum somewhat, but I think it wound up combining well with your changes
[14:49:55] <eddyb> :D
[14:49:59] <nmatsakis> in particular you now distinguish Datum<Lvalue> (by ref, has cleanups) vs Datum<Rvalue> (by value or by ref, no cleanups)
[14:50:13] <nmatsakis> (and Datum<Expr>, which is either  an lvalue or an rvalue)
[14:50:27] <nmatsakis> the vairous things like lllocals and so on
[14:50:33] <nmatsakis> are therefore maps to Datum<Lvalue>
[14:50:36] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Client exited)
[14:50:46] <eddyb> I've taken a peek at that branch, it has stronger enforcing of datum kinds - did you update trans::_match, btw?
[14:50:54] <nmatsakis> yes, mostly,
[14:50:57] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[14:51:02] <nmatsakis> though I didn't go so far as to use a Datum rather than a VAlueRef,
[14:51:02] <eddyb> I made it use datums in a couple places, but nothing else
[14:51:04] <nmatsakis> though I'd like to
[14:51:12] <nmatsakis> yeah, I started to finish that,
[14:51:17] <nmatsakis> but then I realized I was getting far afield
[14:51:28] <nmatsakis> so I just left it mostly as it was
[14:51:39] <nmatsakis> this branch is sprawling enough as is
[14:52:04] <nmatsakis> but it's a nice example, actually, of where distinguishg Datum<Lvalue> is kind of helpful, because the memory management rules there are kind of non-obvious
[14:52:37] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Ping timeout)
[14:54:25] <eddyb> nmatsakis: https://github.com/eddyb/rust/commit/b41cd43acdb1487cb2eb262320645b5e6f9f8519
[14:54:47] <eddyb> wait, did I remove that much code?
[14:55:27] <eddyb> (heh, I forgot I need to take out the part where I remove @ref patterns - possibly predating @T coercing to &T)
[14:56:06] <nmatsakis> eddyb: one thing I wanted to mention, for maximal future-proof-ness, it'd be good if a method and a "fn that takes self as first argument" were the same at runtime...
[14:56:23] <nmatsakis> ...is that true on your branch?
[14:56:25] <eddyb> yupp, that's what I did
[14:56:44] *** Quits: quibbit (Mibbit@moz-B818A6C0.pool.mediaways.net) (Quit: http://www.mibbit.com ajax IRC Client)
[14:56:57] <nmatsakis> cool
[14:57:02] <eddyb> using a method as a bare function is just a matter of allowing it in resolve, I think
[14:57:09] <eddyb> nmatsakis: I also touched typeck, but I didn't combine type checking of self and regular arguments (for method calls, that is), that would require more refactoring
[14:57:37] <nmatsakis> that's great
[14:58:15] <eddyb> that's what I wanted to say... I can't take out the removal of the env param - because methods would have an env param before their self argument
[14:58:30] <eddyb> it would take even more code to support that crazy situation
[14:59:19] <eddyb> nmatsakis: this is how resolve behaves after the removal of ExprSelf https://github.com/eddyb/rust/commit/b41cd43acdb1487cb2eb262320645b5e6f9f8519#diff-03f15b3f57360d85e6f7b4551d0ccd11R1
[15:01:10] <nmatsakis> eddyb: I expected methods to have an env parameter before self (well, I'd prefer as the last argument, but either way to have both env and self)
[15:01:18] <nmatsakis> presuming that is that we don't just remove env pointer
[15:02:06] <eddyb> btw, I won't submit a PR before https://github.com/mozilla/rust/pull/11485 is merged, I based my self/env/etc branch on top of it
[15:05:07] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[15:05:49] <bstrie> haha, did we still have a little bit of ~mut lying around?
[15:06:46] <eddyb> bstrie: we still do have @mut DST and ~mut DST
[15:07:26] <eddyb> I guess not ~mut str
[15:07:43] <eddyb> (because vstore/trait_store don't contain mutability in the &mut DST cases, the DST ptr type does)
[15:12:18] <eddyb> nmatsakis: had a couple missing things in the last commit, keep this handy (rather than a direct commit link) https://github.com/eddyb/rust/tree/env-et-self-no-more
[15:18:47] <eddyb> nmatsakis: removing the bare fn -> proc coercion would mean no magic left for me to implement, and I think it's not really used at all (apart from the failing tests) - I'll attempt now to compile stage2 rustc, to test that (and maybe see if there's any obvious impact on the compile times)
[15:20:08] *** kimundi is now known as zz_kimundi
[15:20:22] *** Joins: gwty (gwtypc@C24C93D9.918BC1CC.137C914F.IP)
[15:21:02] <eddyb> it would be nice if const_bare_fn -> closure would be optimized, or if it would be the only allowed case (but I doubt that's feasible)
[15:24:31] <eddyb> (I think kimundi and I were discussing 'static || yesterday and how it didn't need the environment pointer)
[15:28:40] <eddyb> nmatsakis: I can't tell for sure, but it looks like a local record :D
[15:34:18] <eddyb> now, enough trans for me, let's start a different branch and fix those perf issues noticed yesterday
[15:38:14] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[15:40:00] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[15:42:59] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[15:44:58] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[15:49:14] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[15:56:10] *** Quits: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca) (Quit: canhtak)
[15:58:45] <eddyb> ouch, functions returning procs weren't marked with noalias
[15:59:13] <eddyb> well, ~str too, but I'm not sure what impact *that* has
[16:01:59] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Input/output error)
[16:16:51] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[16:16:51] *** ChanServ sets mode: +ao dherman dherman
[16:20:08] *** Quits: Kxepal (Miranda@moz-2D7B8971.pppoe.mtu-net.ru) (Ping timeout)
[16:20:16] <eddyb> with @mut gone, what is the state of https://github.com/mozilla/rust/issues/6785?
[16:21:52] <eddyb> hmm, marking ~Trait as non-alias might have been a bad idea
[16:33:28] *** Joins: LLD (Mibbit@moz-CFB96525.cnrs-imn.fr)
[16:34:59] *** Parts: LLD (Mibbit@moz-CFB96525.cnrs-imn.fr) ()
[16:35:14] *** Joins: Kxepal (Miranda@moz-C762CEEA.pppoe.mtu-net.ru)
[16:39:45] <Yurume> eddyb, http://cosmic.mearie.org/tmp/periodic-table-of-rust-types
[16:40:02] <Yurume> just for testing.
[16:41:02] <eddyb> bstrie: check that out ^^ :D
[16:41:29] <bstrie> hahaha
[16:41:29] <eddyb> Yurume: why have you settled for T... and not ..T? (I'm biased on the latter, just asking)
[16:41:31] <bstrie> noooooo
[16:41:39] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[16:41:40] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/WByw-w
[16:41:40] <ghrust> 13rust/06auto 149a45c9d 15b1nd: Completed patch searching for rust docs...
[16:41:40] <ghrust> 13rust/06auto 149dbbfb8 15bors: auto merge of #11438 : b1nd/rust/rust-doc, r=alexcrichton...
[16:41:40] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[16:41:42] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[16:41:42] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/6JS7Yg
[16:41:42] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[16:41:55] *** Quits: Kxepal (Miranda@moz-C762CEEA.pppoe.mtu-net.ru) (Connection reset by peer)
[16:41:59] <eddyb> Yurume: atomic.... might not be the best word
[16:42:08] <Yurume> eddyb, not yet settled, I've just used an &hellip;
[16:42:30] *** Joins: Kxepal (Miranda@moz-C762CEEA.pppoe.mtu-net.ru)
[16:42:42] <Yurume> the "atomic types" cell was originally "primitive types", but enums and structs are primitive, you know.
[16:42:50] <Yurume> is there a better term?
[16:42:53] <bstrie> as neat as this table is, I feel like it's the sort of thing that just makes rust feel forbidding
[16:42:59] <eddyb> unboxed?
[16:43:49] <eddyb> Yurume: the bare column is okay, just have the enumeration under T
[16:43:59] <eddyb> as in, "bare" expresses the right thing
[16:44:17] <Yurume> good idea
[16:45:02] <eddyb> maybe "simple" for the row
[16:45:03] <bstrie> I feel like this is only useful for someone who already knows the language
[16:45:10] <bstrie> someone who is just learning will just recoil in terror
[16:45:12] <Yurume> bstrie, I think so
[16:45:29] <eddyb> heey, I have an idea
[16:45:31] <Yurume> that is a sort of... a reference material.
[16:45:36] <bstrie> well that's fine then
[16:45:41] <bstrie> just don't post it to reddit :P
[16:46:01] <Yurume> ;)
[16:46:01] <eddyb> Yurume: checkboxes to disable things like lifetimes, proposed/impossible cells, etc.
[16:46:10] <Yurume> eddyb, I'm going to add them
[16:46:19] <Yurume> for now it is a static page
[16:46:25] <eddyb> and then post it to reddit (checkboxes disabled by default). all that sweet karma :D
[16:46:43] <Yurume> isn't that still too much?
[16:47:26] <eddyb> Yurume: also toggle kind bounds - which you've missed on closures, btw
[16:47:49] <Yurume> ah, right. was it 'r:K |..T| -> U?
[16:48:05] <eddyb> |..T|:K -> U, I think
[16:50:15] *** Quits: glaebhoerl (glaebhoerl@moz-3590251D.kabelnet.hu) (Ping timeout)
[16:50:21] *** Joins: doener (doener@moz-C68F600D.unity-media.net)
[16:52:36] *** Quits: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net) (Quit: Sharp)
[16:53:06] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[16:55:19] *** zz_kimundi is now known as kimundi
[16:58:47] <pnkfelix> bstrie: sounds analogous to the Periodic Table of the Elements in chemistry
[16:58:57] <pnkfelix> bstrie: (in that it looks intimidating to something learning)
[16:59:13] <pnkfelix> bstrie: (but is a very useful tool)
[16:59:39] <bstrie> pnkfelix: I'm not so sure that it's useful for learning, many of those combinations are rather esoteric
[17:00:02] <pnkfelix> bstrie: sorry, I meant "useful tool" for *practitioners(*
[17:00:10] <bstrie> oh ok
[17:00:24] *** Joins: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net)
[17:00:31] <bstrie> indeed, once you already know all the definitions for the labels of each column and row
[17:00:38] <bstrie> but not before
[17:01:17] <Yurume> colored lifetimes, bounds and return types in the different color.
[17:01:43] <Yurume> bstrie, I was thinking of providing a detailed description for each row and column below
[17:02:04] *** Quits: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net) (Quit: Sharp)
[17:02:59] <bstrie> Yurume: sounds good
[17:03:23] <bstrie> Yurume: I think it would also be useful to figure out which of these will be commonly encountered and used, even if that seems subjective
[17:03:35] <eddyb> acrichto: I can't reproduce our catch from yesterday, in the snapshot...
[17:04:12] <Yurume> bstrie, or providing an example of each case?
[17:04:32] <acrichto> eddyb: which was that again?
[17:04:38] <Yurume> I'm not sure how to expand the current table in the helpful manner
[17:04:42] <Yurume> expand or adjust*
[17:04:48] <eddyb> acrichto: duplicated code after an abort call
[17:05:07] <acrichto> eddyb: duplicated code? I thought we just weren't seeing good optimization around it
[17:05:31] <eddyb> acrichto: it was storing to the allocated pointer right after abort
[17:05:58] <acrichto> weird, I should probably follow these things more closely
[17:06:38] <eddyb> oh, well, I'll have a lamer example :))
[17:07:47] <doener> eddyb: ah, you already did the noreturn fix :-) Got distracted yesterday...
[17:08:17] <eddyb> doener: what was your test case?
[17:08:25] <eddyb> I want to show code running after abort, if I can :D
[17:08:31] <doener> eddyb: let x = ~3; assert_eq!(*x, 3);
[17:08:35] *** Joins: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net)
[17:08:45] *** Joins: canhtak (canhtak@moz-4B5B3414.wl.t.ulaval.ca)
[17:09:11] <doener> https://github.com/mozilla/rust/pull/11539 -- that's the void* type fix.
[17:10:53] <eddyb> acrichto: r? https://github.com/mozilla/rust/pull/11538
[17:12:47] <acrichto> eddyb: you're just shuffling around things to execute more code for more cases, right?
[17:13:06] <eddyb> acrichto: and adding noalias for ~str (instead of just ~[T])
[17:13:22] <acrichto> what's up with ~Trait?
[17:14:02] <eddyb> if you pass a ~Trait, you either pass a (*vtable, ~T) or a pointer to such a tuple, I don't think noalias can work there
[17:14:30] <acrichto> seems odd to have a FIXME pointing at the PR?
[17:14:31] <eddyb> TBAA should, but we don't have that yet
[17:15:07] <eddyb> acrichto: heh, you've caught me, it's not the first time I do this. I was too lazy to open another issue. wait, nvm, maybe there's one for TBAA
[17:15:48] <acrichto> eddyb: instead of passing the output ty::t and making dummy ones, why not use Option<ty::t> ?
[17:16:27] <eddyb> acrichto: because of one place which is very dirty type-wise?
[17:16:55] <eddyb> technically, I could rewrite all that intrinsic madness, but it would be a waste of time IMO
[17:16:58] <acrichto> I guess I should read more closesly
[17:18:00] <eddyb> gotta love this https://github.com/mozilla/rust/issues/6750#issuecomment-21495587
[17:18:18] <eddyb> (I'm guilty of it as well, in traceur-compiler and even in rust)
[17:19:01] <eddyb> doener: wait, what, it works even with abort there?
[17:19:09] <eddyb> \o/
[17:19:35] *** Quits: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net) (Quit: Sharp)
[17:19:35] <eddyb> doener: can you test ~[0u8, ..1024]?
[17:19:58] <eddyb> imagine starting to get 0ms in benchmarks :P
[17:20:48] <eddyb> (I know how to prevent such an optimization, fwiw. #[inline(never)] fn keep_vec_alive<T>(_: &[T]){}
[17:20:49] <eddyb> )
[17:21:46] <doener> eddyb: just "ret void" as well
[17:22:34] <eddyb> doener: can you run check-stage1-std TESTNAME=zero_1kb and post the results?
[17:23:09] <doener> sure
[17:28:59] *** Joins: glaebhoerl (glaebhoerl@3391DE98.E9231B2.A0179ACD.IP)
[17:30:13] <doener> eddyb: https://gist.github.com/dotdash/8422229 
[17:30:43] <eddyb> doener: hahahaha
[17:30:47] <eddyb> doener: put that on the PR
[17:31:29] <eddyb> it's pretty much b.iter(||{});
[17:31:41] *** Joins: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net)
[17:32:34] * doener can't judge those numbers and is waiting for the "before" numbers
[17:33:26] <eddyb> doener: only zero_1kb_loop_set is doing anything at all. don't trust me? make a new benchmark with b.iter(||{}) and run it, it should give you around 70ns
[17:35:49] <eddyb> doener: wait, what? that's very interesting
[17:35:52] <doener> eddyb: three of those weren't doing anything before either
[17:36:15] <eddyb> so ~[0u8, ..1024] was optimized before your change?
[17:36:21] <eddyb> that doesn't seem... right
[17:36:48] <eddyb> (from_elem is probably the biggest gain here anyway)
[17:37:39] <doener> eddyb: at least in the .ll file, there was malloc/memset/free for ~[0u8, ..1024]
[17:37:52] <eddyb> before or after?
[17:38:02] <doener> before. Afterwards it's just "ret void"
[17:38:25] <acrichto> doener: out of curiosity, could you do #[repr(u8)] enum void {}
[17:38:39] <eddyb> yeah, I was curious about that, too, yesterday
[17:39:04] <eddyb> are benchmarks compiled with --opt-level=3? if 70ms is not the empty benchmark baselines, something weird is going on
[17:39:48] *** Joins: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP)
[17:39:58] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[17:40:29] <doener> acrichto: will try
[17:41:23] <acrichto> doener: foo.rs:2:1: 2:12 error: unsupported representation for zero-variant enum
[17:41:27] <acrichto> foo.rs:2 enum foo {}
[17:41:30] <acrichto> I don't think it works :(
[17:41:37] <acrichto> not out of the box at least
[17:41:57] <eddyb> make a single static variant that is private - if humanly possible
[17:42:14] <eddyb> or struct c_void {priv foo: u8}
[17:42:16] <eddyb> s/humanly/
[17:42:24] <acrichto> error: unsupported representation for univariant enum
[17:42:52] <doener> eddyb: the tests don't get compiled with LTO
[17:43:09] <doener> eddyb: extracted the benchmarks and built with LTO I get 0ns/iter
[17:43:14] <acrichto> doener: "pub enum c_void { priv var1, priv var2 }"
[17:43:18] <acrichto> #[repr(u8)]
[17:43:19] <doener> except for 1kb_loop_set, which is unchanged
[17:43:21] <acrichto> that should work
[17:43:43] <eddyb> doener: okay, replace the previous values with those, with a mention of the LTO
[17:43:44] <acrichto> doener: https://gist.github.com/8422451 that's optimized to an empty 'fn main'
[17:44:40] <eddyb> haha
[17:47:02] <doener> acrichto: is the enum represented as i8?
[17:47:38] <eddyb> doener: i1 if we could
[17:47:56] <acrichto> doener: it looks like it, although I'm not seeing the typedef in the IR
[17:47:58] <eddyb> #[repr(u8)] would force it for sure
[17:48:15] <acrichto> declare i8* @malloc(i64) unnamed_addr
[17:48:18] <acrichto> declare void @free(i8*) unnamed_addr
[17:48:28] <acrichto> but yeah #[repr(u8)] guarantees a compile error if it can't be u8
[17:48:42] <doener> ok, will adjust the code after dinner
[17:48:55] <acrichto> doener: thanks for finding this!
[17:48:57] <eddyb> acrichto: what about mine?
[17:49:55] <acrichto> eddyb: still reading
[17:50:03] <acrichto> eddyb: but of course thanks for finding that as well :P
[17:50:07] <eddyb> if we can get these two merged today, that will be cool. hmm, should we inline exchange_malloc/free? I mean, to not rely on LTO to get dead store elimination
[17:50:31] <acrichto> wouldn't we have to change llvm for that?
[17:50:38] <acrichto> b/c it recognizes the exact symbols of malloc and free, right?
[17:50:47] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[17:50:49] <eddyb> acrichto: why? it's just #[inline] on those two rust functions
[17:51:04] <acrichto> oh hm, good point
[17:51:26] <eddyb> from_elem has bad performance because of a missing #[inline] on the dtor of Finallyalizer
[17:51:32] <eddyb> *had
[17:51:46] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[17:51:46] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/WByw-w
[17:51:46] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[17:51:56] <doener> acrichto: my pleasure. Glad that there was something "easy" to get back into rust work :-)
[17:52:24] <doener> and thanks for the help analyzing this to both of you :-)
[17:52:58] <eddyb> I'm amazed it was this simple and that we don't have to remove the abort, I love tricks like this :D
[17:55:55] <eddyb> doener: now I want to see ~"foo" + ~"bar" being optimized into a ~"foobar"
[17:56:23] <eddyb> and then we can make std::fmt generic and consteval format!
[17:56:40] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[17:56:40] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/NLD9NA
[17:56:40] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[17:56:41] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[17:56:41] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/WCnBjA
[17:56:41] <ghrust> 13rust/06auto 147297157 15OGINO Masanori: Update .po and strip down untranslated entries....
[17:56:41] <ghrust> 13rust/06auto 141ba61b9 15OGINO Masanori: Add notes for translators....
[17:56:41] <ghrust> 13rust/06auto 14006d169 15OGINO Masanori: Note that translation workflow is WIP now....
[17:56:43] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[17:56:56] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[17:56:56] *** ChanServ sets mode: +qo brson brson
[17:57:02] <sfackler> acrichto: I ran into some weird behavior with the snapshot trying to figure out how to get the test stuff set up last night
[17:57:17] <doener> eddyb: I want those 1kb_loop_set tests to be as fast in the libstd test suite as they are when they're put in their own file
[17:57:45] <sfackler> the macro crate aux file uses quote_expr! to generate the output, and understandably, it still uses the old names for ast stuff
[17:58:06] <sfackler> which means it fails to compile since it'll be linking against the libsyntax that has the new names
[17:58:21] <sfackler> but librustc uses the quasiquoter so I'm not totally sure how that compiles right now
[17:58:46] <eddyb> sfackler: ouch
[17:58:57] <acrichto> this is problems with dlopen, though, right?
[17:59:01] <acrichto> not the quasiquoter
[17:59:05] <sfackler> no, this is a compile time problem
[17:59:16] <eddyb> I had only one problem, tt_tok, for which I wrote a wrapper that is to be removed next snapshot
[17:59:29] <acrichto> the quasiquoter just becomes a large ast, right?
[17:59:30] <eddyb> doener: for that we need to inline the lang items, see my mention of exchange_malloc/free above
[17:59:39] <sfackler> the snapshot compiler still uses ty_i for example but the stage0 libsyntax now uses TyI
[17:59:49] <eddyb> does it?
[17:59:50] <doener> eddyb: I'm talking about times without LTO
[17:59:55] <sfackler> maybe the librustc use just never ran into it
[18:00:02] <doener> eddyb: just putting the code into its own file makes it faster
[18:00:04] <acrichto> hm that's terrifying
[18:00:05] <eddyb> doener: LTO only inlines things we didn't mark with #[inline]
[18:00:23] <eddyb> doener: did I forger to rename all the stuff in the quasiquoter?
[18:00:29] <eddyb> err, sfackler ^^
[18:00:49] <eddyb> or is it just a bootstrapping issue?
[18:00:51] <sfackler> no, it's all named properly, it's just that the snapshot hasn't been updated since your thing
[18:00:56] <sfackler> yeah, it's a bootstrapping issue
[18:01:11] <eddyb> at least it's not my fault :)
[18:01:11] <sfackler> it makes sense that my thing doesn't build, I just can't figure out how librustc builds
[18:01:26] <eddyb> sfackler: it doesn't use a lot of that stuff
[18:02:00] <sfackler> the only place I know of is in the env! extension definition
[18:02:03] <eddyb> the only renamed item it used was tt_tok, for which I've (like I mentioned already) wrote a wrapper
[18:02:07] <sfackler> but maybe none of the ast it generates gets renamed
[18:02:25] <sfackler> cool
[18:02:42] <eddyb> you can write wrappers if you want to force it to bootstrap
[18:03:05] <sfackler> I'll probably just write the ast myself for the test
[18:03:07] <eddyb> static ty_i: Ty_ = TyI; for example
[18:03:15] <sfackler> oh, yeah, that's a good idea
[18:03:33] <sfackler> thanks
[18:03:37] <eddyb> and mark it with // NOTE remove next snapshot or whatever that comment is
[18:03:42] <sfackler> yeah
[18:03:52] <acrichto> sfackler: sry in a meeting will be back in a bit
[18:03:55] <sfackler> np
[18:04:03] <sfackler> I think I figured out what was going on
[18:04:06] <eddyb> *the* meeting?
[18:13:27] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[18:13:46] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Client exited)
[18:14:08] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[18:15:50] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Ping timeout)
[18:21:32] <Yurume> okay, I have a working toggleable interface :)
[18:22:10] <eddyb> Yurume: box karma
[18:22:21] <eddyb> actually, loop {...}
[18:22:41] <Yurume> not yet, needs a real design and some descriptions
[18:22:49] <Yurume> but looks pretty good for me
[18:23:49] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[18:24:01] * Yurume goes sleep
[18:28:05] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[18:28:05] *** ChanServ sets mode: +ao dherman dherman
[18:28:48] <bstrie> Yurume: looks much better now
[18:39:29] *** Joins: rca_ (rcatolino@moz-9F9D4FC8.adsl.proxad.net)
[18:40:50] *** Quits: rca (rcatolino@moz-1D2195F3.adsl.proxad.net) (Ping timeout)
[18:59:54] <nmatsakis> acrichto: so one thing semi-related to that PR....
[19:00:35] <nmatsakis> acrichto: I was thinking that when we add support for Higher-Kinded Types, we'll prob want some kind of struct names that are equivalent to things like `Arr<T> == [T]` and `Ref<'a, T> == &'a T`
[19:01:01] <nmatsakis> acrichto: in particular because, as part of HKT, you want to be able to refer to something like `Arr` which is then a kind of "type function" of kind Type => Type
[19:01:09] <nmatsakis> and it's just not entirely obvious what syntax to use for that otherwise
[19:01:19] <acrichto> nmatsakis: yeah that makes sense
[19:01:29] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[19:01:29] <nmatsakis> anyway, obviously if we did that, we could hang some of the docs from there
[19:01:30] <acrichto> with DST, could we do "impl str { ... }" ?
[19:01:38] <nmatsakis> yes
[19:01:43] <SiegeLord> acrichto: What about the case when crate A extends a type from crate B. Will crate A have a section for crate B's types?
[19:01:50] <acrichto> that should solve it for strings then
[19:02:07] <acrichto> SiegeLord: that's not really possible because crate A knows nothinga bout crate B
[19:04:51] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[19:04:51] *** ChanServ sets mode: +qo brson brson
[19:05:34] <SiegeLord> acrichto: What do you mean?
[19:06:04] <acrichto> SiegeLord: oh wait sorry I read that backwards, right now the answer is no, but in theory rustdoc could do fancy things
[19:06:05] <SiegeLord> I do get a documentation entry for B's type implementing A's trait in A's documentation
[19:06:29] <SiegeLord> I think it's a very related issue to the built-in types
[19:06:53] <SiegeLord> In both cases the types come from outside the crate that is being documented
[19:07:04] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[19:07:05] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/WCnBjA
[19:07:05] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[19:08:16] <SiegeLord> And it's not clear to me how that PR fixes the case when a non-std crate extends built-in types
[19:08:31] <SiegeLord> (unless I misunderstand it)
[19:11:12] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[19:11:54] <doener> acrichto: can you have another peek at https://github.com/mozilla/rust/pull/11539 ? I'll be off soon
[19:12:16] *** Joins: msm (Mibbit@moz-2202AB44.hsd1.ga.comcast.net)
[19:12:27] <acrichto> doener: amazing! r+
[19:12:32] <doener> thanks!
[19:13:09] <acrichto> SiegeLord: my PR wouldn't fix this case
[19:14:38] *** Quits: doener (doener@moz-C68F600D.unity-media.net) (Quit: leaving)
[19:14:38] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[19:14:38] *** ChanServ sets mode: +qo brson brson
[19:16:32] <SiegeLord> Although if the two crate problem got fixed, then this issue would be resolved too. The non-std will just have a section (or w/e the implementation) for types originating from libstd
[19:16:39] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[19:16:39] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/oKKHvw
[19:16:39] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[19:16:40] <SiegeLord> (which would be those dummy structs)
[19:16:41] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[19:16:41] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/YGwFWg
[19:16:41] <ghrust> 13rust/06auto 145902263 15BjÃ¶rn Steinbrink: Fix the representation of C void pointers in LLVM IR...
[19:16:41] <ghrust> 13rust/06auto 14b77a7e7 15bors: auto merge of #11539 : dotdash/rust/void_type_fixup, r=alexcrichton...
[19:16:41] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[19:26:00] *** Quits: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net) (Quit: Sharp)
[19:31:59] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[19:31:59] *** ChanServ sets mode: +ao pcwalton pcwalton
[19:32:56] <nmatsakis> grr. My branch is... so close to working. But it somehow does a double free (I think) if the macro parser fails.
[19:33:00] <nmatsakis> very obscure.
[19:33:27] <nmatsakis> so trying to compile `fail!(@)` causes a segfault ~50% of the time :)
[19:35:32] <bstrie> Yurume: http://www.reddit.com/r/rust/comments/1v7hqb/the_periodic_table_of_rust_types/cephdir
[19:36:07] <bstrie> nmatsakis: that's a feature! figure out a way to leverage that to implement an rng for macros
[19:36:40] *** Joins: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net)
[19:36:59] *** Quits: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net) (Quit: Sharp)
[19:37:23] <nmatsakis> bstrie: yep. just install a sigsegv handler and you're good to go.
[19:37:38] <bstrie> compile-time random number generation
[19:37:40] <bstrie> living the dream
[19:44:16] <eddyb> acrichto: thanks for the r+ :D
[19:44:28] <acrichto> eddyb: thank you for the patch!
[19:44:43] <acrichto> I'm not 100% comfortable with trans, but it all looks good to me
[19:45:27] <eddyb> you're... welcome, I guess. same for nmatsakis thanking the community in his talk :)
[19:48:03] <acrichto> the community is why rust is so awesome!
[19:48:59] <eddyb> I have patches waiting for 3 different features now, I think
[19:50:08] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Input/output error)
[19:50:10] <eddyb> hmm, what would stop me from jumping on a plane then taking a chair next to nmatsakis and working full time on Rust/Servo?
[19:50:36] <eddyb> but let's not get ahead of myself, I don't have time for dreams, I have too many things to do
[19:50:43] <nmatsakis> eddyb: btw we gotta discuss env pointers 
[19:51:00] <eddyb> now? I gotta run to the store
[19:51:04] <nmatsakis> ideally not now
[19:51:08] <nmatsakis> since I got some other stuff to do too 
[19:51:09] *** Joins: bytewise (bytewise@moz-175CA5D5.adsl.alicedsl.de)
[19:51:18] <nmatsakis> but at some point :)
[19:51:41] <eddyb> sure, same with variadics - I hope the default type params one gets sorted in the meeting
[19:51:42] <nmatsakis> I'm reviewing your PR #11485 atm actually
[19:51:58] <eddyb> nmatsakis: those documentation changes?
[19:58:15] *** Joins: geoffhill (geoffhill@moz-738DC0DB.org)
[19:59:29] <eddyb> nmatsakis: thanks for r+, I've commented on the mut ~self matter
[19:59:40] <eddyb> (before your second comment, actually)
[19:59:58] <eddyb> laggy github autoupdate, I presume
[20:01:38] *** Quits: glaebhoerl (glaebhoerl@3391DE98.E9231B2.A0179ACD.IP) (Ping timeout)
[20:26:39] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[20:26:39] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/YGwFWg
[20:26:39] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[20:28:23] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[20:30:43] <eddyb> cool. but I still don't think my patch will merge first try, that's my luck
[20:32:11] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[20:32:11] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/xfK4Jw
[20:32:11] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[20:32:13] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[20:32:13] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/d0IoMA
[20:32:13] <ghrust> 13rust/06auto 14509fc92 15Eduard Burtescu: Removed remnants of `@mut` and `~mut` from comments and the type system.
[20:32:13] <ghrust> 13rust/06auto 149075025 15bors: auto merge of #11485 : eddyb/rust/sweep-old-rust, r=nikomatsakis
[20:32:13] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[20:32:45] <eddyb> riiight, PR number order
[20:34:03] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[20:34:18] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[20:37:06] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[20:50:59] <olsonjeffery> acrichto: i see you're working on the "channel upgrade" .. is this in line w/ brson's proposal? and if so, how soon will it land?
[20:51:17] <olsonjeffery> im in the middle of writing a blog post that includes some messaging and curious how disruptive it'll be..
[20:51:28] <olsonjeffery> maybe i should change topics to just network IO or something.
[20:51:51] <olsonjeffery> i want to do serialization. so messaging or network IO are the natural ways to bookend the topic.
[20:59:08] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Quit: Konversation terminated!)
[20:59:19] *** Joins: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP)
[21:00:43] <acrichto> olsonjeffery: I've got it all written up right now and working, it's probably going to wait until the mutex patch goes in first though
[21:04:15] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[21:06:39] *** Joins: Sharp (Sharp@moz-EEC85237.hsd1.ca.comcast.net)
[21:11:18] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[21:11:18] *** ChanServ sets mode: +ao dherman dherman
[21:14:21] *** Quits: eddyb (eddy@EDE07015.D51DAF03.FB866788.IP) (Ping timeout)
[21:22:18] <bjz> Do you thing BitCount and Bitwise could be merged into Bits?
[21:23:32] <bjz> dbaupp: ^
[21:24:54] <acrichto> pcwalton: ping
[21:25:01] <pcwalton> acrichto: pong
[21:25:10] <acrichto> pcwalton: you ok with removing headers from ~@T?
[21:25:15] <acrichto> the headers on the ~ allocation
[21:25:28] <acrichto> https://github.com/mozilla/rust/pull/11535
[21:25:52] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[21:25:52] *** ChanServ sets mode: +o tjc
[21:26:02] <pcwalton> I am fine with it if it works! we will need to of course use a side table
[21:26:06] <pcwalton> when we have a GC
[21:26:09] <pcwalton> but a high performance GC uses that anyway
[21:26:24] <acrichto> yeah sounds like "any hypothetical GC" needs to deal with this anyway
[21:26:43] <acrichto> strcat: good catch on the borrow_offset
[21:26:49] <strcat> pcwalton: headers at negative offsets could work too and wouldn't require horrible stuff like this, but we can't change the representation of Vec<T> in the library without static if
[21:27:06] <pcwalton> yeah, but headers are a non starter for a high performance GC anyway
[21:27:24] <strcat> it worked before I removed borrow_offset... we'll see if it works now
[21:27:26] <acrichto> strcat: looking over the PR, r=me with an update to unstable::raw (you don't have to use it everywhere just yet)
[21:27:38] <acrichto> also thanks for doing this!
[21:27:57] <strcat> was easy since I wrote all of those code paths ;p
[21:28:13] * strcat wishes we'd just removed them from the start
[21:28:50] <pnkfelix> pcwalton: It depends on the GC design.  Headers make perfect sense in some GC's.
[21:28:58] <pcwalton> ah, ok
[21:29:07] <pcwalton> well, I think that probably the GC can store them at a negative offset
[21:29:52] <pnkfelix> pcwalton: Yes, definitely.  And we will almost certainly need side-tables for some stuff (e.g. interior ptrs), since I don't want to block on full stack+heap precision.
[21:30:07] <strcat> acrichto: or land Vec<T> ;p
[21:30:08] *** Quits: msm (Mibbit@moz-2202AB44.hsd1.ga.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[21:32:26] <acrichto> strcat: hopefully DST will manifest soon and we can think hard about that
[21:32:54] <strcat> acrichto: well
[21:33:01] <strcat> I rewrote the ring buffer and priority queue based on it
[21:33:05] <strcat> ring buffer is many times faster now
[21:33:13] <strcat> could submit those to libstd using a hidden Vec<T>
[21:33:32] <acrichto> not sure if we want to maintain two vector implementations though...
[21:33:41] <strcat> acrichto: it's simple though
[21:33:52] <strcat> acrichto: https://github.com/thestinger/rust-core/blob/master/core/vec.rs same slices
[21:33:55] <acrichto> just like chans used to be simple :(
[21:33:55] <strcat> and 99% is on slices
[21:34:24] <strcat> also fixes some overflow bugs...
[21:34:39] <strcat> 7x faster push ;p
[21:34:50] <strcat> far better than std::vector in C++
[21:34:56] <strcat> atm we are about the same
[21:35:06] <strcat> well slower than libc++
[21:35:09] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[21:35:47] <strcat> grow should probably be updated to use copy_nonoverlapping_memory too https://github.com/thestinger/rust-core/blob/master/core/deque.rs#L172
[21:35:49] <strcat> haven't checked
[21:37:51] <strcat> acrichto: https://github.com/mozilla/rust/pull/11535 r?
[21:37:55] <strcat> oh wait
[21:38:04] <strcat> it failed :(
[21:38:10] <strcat> it relied on auto-coercion to a slice for repr
[21:39:59] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[21:40:31] <strcat> acrichto: ok it's good now
[21:41:19] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[21:42:06] <acrichto> strcat: r+
[21:44:34] <strcat> also need to write vectors to handle custom alignment to support SIMD values inside
[21:45:24] <strcat> er
[21:45:27] <strcat> s/custom/large/
[21:45:34] *** Quits: c-a (c-a@moz-57C82A9.a163.priv.bahnhof.se) (Quit: Ex-Chat)
[21:46:31] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[21:46:31] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/d0IoMA
[21:46:31] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[21:49:31] <strcat> it bitrotted already
[21:51:35] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[21:51:35] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/L24DCA
[21:51:35] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[21:51:36] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[21:51:36] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/5O2ikg
[21:51:36] <ghrust> 13rust/06auto 148e2027a 15Eduard Burtescu: Add noalias and noreturn attributes in more cases.
[21:51:36] <ghrust> 13rust/06auto 14faa0b5a 15bors: auto merge of #11538 : eddyb/rust/llvm-attributes, r=alexcrichton
[21:51:38] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[21:53:21] <olsonjeffery> acrichto: how disruptive is it, API-wise? and what do you think about an upgradable shared Port ala shared chan?
[21:54:01] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Client exited)
[21:54:07] <acrichto> olsonjeffery: this is a consolidation in terms of the API because you no longer have to choose between chan and shared chan
[21:54:17] <acrichto> shared ports would be super hard with the implementation that we currently have
[21:54:18] <strcat> https://github.com/mozilla/rust/pull/11535#issuecomment-32308367 haven't seen this before
[21:54:25] <strcat> it thinks I commented on something before it existed
[21:54:50] * strcat spelled acrichto's name wrong
[21:55:01] <acrichto> my name is always spelled wrong :(
[21:55:08] <acrichto> turns out "r=foobar" will work though
[21:55:10] <strcat> needs more ts
[21:55:22] <acrichto> bors just moves the characters arounds
[21:56:20] <strcat> acrichto: well looking through git log, I have only spelled your name wrong twice before!
[21:56:22] <strcat> ;p
[21:56:31] <acrichto> hehe
[21:56:39] <strcat> which seems to be both times I wrote it
[21:57:02] <acrichto> git log --oneline | grep 'alexc' | grep -v alexcrichton
[21:57:07] <acrichto> :(
[21:57:30] <strcat> ;]
[21:59:13] <acrichto> oh man 5d07a70 just became my favorite commit
[21:59:44] <bjz> yeah?
[22:00:07] <acrichto> 5d07a70 Add Alex Crichton to AUTHORS
[22:00:17] <acrichto> :P
[22:00:23] <bjz> HAH
[22:00:45] <strcat> list of people bors plans to spare when he becomes self-aware
[22:01:11] <strcat> U-NOV2010\eugals
[22:01:13] <strcat> um
[22:01:20] <strcat> I didn't know U-NOV2010\eugals contributed to rust
[22:01:45] *** Quits: geoffhill (geoffhill@moz-738DC0DB.org) (Ping timeout)
[22:01:52] <acrichto> #9332
[22:01:57] <acrichto> https://github.com/mozilla/rust/pull/9332
[22:02:14] <strcat> huh
[22:02:51] <strcat> I guess their git config is messed up ;p
[22:09:59] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[22:19:36] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[22:29:14] *** Quits: rca_ (rcatolino@moz-9F9D4FC8.adsl.proxad.net) (Ping timeout)
[22:38:09] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[22:43:32] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[22:44:26] *** Quits: Kxepal (Miranda@moz-C762CEEA.pppoe.mtu-net.ru) (Quit: Kxepal)
[22:44:49] *** Joins: Kxepal (Miranda@moz-C762CEEA.pppoe.mtu-net.ru)
[22:45:48] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[22:45:49] *** Joins: jdm (jdm@CC0122E6.8F96AEA7.2D179A7D.IP)
[22:45:52] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Ping timeout)
[22:57:20] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Client exited)
[23:06:46] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[23:06:46] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/5O2ikg
[23:06:46] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[23:07:39] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[23:08:04] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[23:09:25] <bjz> dbaupp: ping
[23:11:31] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[23:11:31] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/GZVpRQ
[23:11:31] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[23:11:32] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[23:11:32] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/mIIKsg
[23:11:32] <ghrust> 13rust/06auto 14a599d89 15Derek Guenther: Renamed LIBDIR_RELATIVE to CFG_LIBDIR_RELATIVE
[23:11:32] <ghrust> 13rust/06auto 14dd8b011 15bors: auto merge of #11521 : dguenther/rust/hide_libdir_relative, r=alexcrichton...
[23:11:32] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[23:12:54] <dbaupp> bjz: pong
[23:13:24] <bjz> dbaupp: could Bitwise and BitCount be merged?
[23:14:13] <dbaupp> bjz: um
[23:14:17] * dbaupp checks to see what they are
[23:14:36] <dbaupp> I guess so
[23:16:31] <bjz> dbaupp: I was thinking just call it "Bits"
[23:16:46] <dbaupp> sounds good
[23:17:58] <bjz> dbaupp: `/// A type that is represented as a series of bits.`
[23:18:27] <dbaupp> every type is a series of bits :P
[23:18:34] <bjz> yea :/
[23:18:45] <bjz> I need a better doc comment
[23:19:10] <bjz> dbaupp: ideas?
[23:20:03] * dbaupp thinks
[23:23:23] <dbaupp> bjz: not really sure
[23:23:43] <dbaupp> adding a 'just' in there might make it slightly clearer "as just a series of bits"
[23:23:45] * dbaupp shrugs
[23:26:39] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[23:26:39] *** ChanServ sets mode: +qo brson brson
[23:28:28] <bjz> dbaupp: `BinaryNum`?
[23:28:58] <bjz> no
[23:28:58] <bjz> hmm
[23:32:16] <bjz> `Bitwise`: `/// functions and operations that work numbers with a binary representation`
[23:32:41] <bjz> They would make sense for fixed-point numbers right?
[23:32:48] <aatch> bjz, try "fixed" binary representation.
[23:33:53] <bjz> yeah that's better
[23:33:56] <aatch> Since presumably it just applys to anything where any sequence of n bits is also a valid number?
[23:33:58] *** Joins: lkuper (lkuper@moz-6881CCA2.dhcp-bl.indiana.edu)
[23:34:01] <aatch> applies*
[23:34:14] <bjz> yep, I think so
[23:34:39] <bjz> aatch: would they also be bounded?
[23:36:05] <aatch> I assume so. It's probably not worth over-thinking it too much, though. Personally I only ever use unsigned integers for bitwise operations, but I'm paranoid about that stuff...
[23:36:17] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[23:36:21] <bjz> yep
[23:38:17] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[23:38:34] <aatch> Especially since people will normally just bound on the operations they need, since things like BitAnd make sense for things other than numbers anyway.
[23:43:31] *** Quits: lkuper (lkuper@moz-6881CCA2.dhcp-bl.indiana.edu) (Quit: lkuper)
[23:44:35] *** Joins: lkuper (lkuper@moz-6881CCA2.dhcp-bl.indiana.edu)
[23:44:38] <jdm> riddle me this: why isn't the handwritten Encodable implementation in https://gist.github.com/jdm/8428198 ever called?
[23:44:43] *** Quits: lkuper (lkuper@moz-6881CCA2.dhcp-bl.indiana.edu) (Quit: lkuper)
[23:46:34] <strcat> acrichto: https://github.com/mozilla/rust/pull/11535 one more commit here
[23:46:56] <strcat> was going to remove std::managed completely but some tests actually use that refcount function...
[23:47:11] <strcat> and extra::list uses the Eq impl :{
[23:47:29] <acrichto> 14 deletions!
[23:47:47] <acrichto> seems like std::managed should get merged to std::gc for now
[23:48:05] <acrichto> we should remove std::borrowck
[23:48:15] <acrichto> oh nvmd
[23:48:24] <acrichto> std::borrow should be a privat emodule
[23:48:25] <strcat> acrichto: hmm actually this needs to be stage-gated...
[23:48:29] * strcat sighs
[23:48:38] <strcat> will just do it later
[23:48:40] <acrichto> r=me
[23:49:01] <strcat> I'll snapshot when it lands
[23:49:08] <strcat> and then submit this
[23:49:12] <acrichto> strcat: want me to open an issue about it or you got it?
[23:49:21] <strcat> I'll do it don't worry ;]
[23:49:23] *** Joins: doomlord_ (servitor@moz-CA917A47.range86-184.btcentralplus.com)
[23:49:54] <acrichto> kk
[23:51:12] *** Joins: deens (deens@moz-A47475CE.hsd1.ca.comcast.net)
[23:52:36] *** Joins: matthewbot (user@moz-C6814817.ga.at.cox.net)
[23:53:15] *** Quits: deens (deens@moz-A47475CE.hsd1.ca.comcast.net) (Ping timeout)
[23:53:33] <jdm> erickt: can I solicit your thoughts on https://gist.github.com/jdm/8428198 and the lack of a success message?
