[00:01:15] <Thad> Anyways.... back to this damn Cygwin build out for the Rust community...
[00:01:44] <Thad> Just so I can get help from my Ericsson co-workers who only use Windows. :)
[00:01:47] *** Joins: devbug (quassel@moz-E1DE087C.bchsia.telus.net)
[00:03:28] <Sodel_the_V> Is it possible to declare a trait object that must implement more than one trait?
[00:04:13] <strcat> there's trait inheritance
[00:04:17] <strcat> trait A: B {}
[00:04:23] <strcat> anything that implements A has to implement B
[00:04:25] <strcat> so
[00:04:39] <strcat> fn foo<T: A>(x: &T) {}
[00:04:49] <strcat> T is an object implementing both A and B
[00:05:08] <strcat> the same thing applies to trait objects but... no idea how well that works right now ;p
[00:06:16] <Sodel_the_V> Ah, I thought that's what that trait syntax meant. That doesn't seem to be working for me. pastebin.mozilla.org/2347675
[00:06:40] <Thad> Any volunteers to help me (in a screen sharing session) to figure out my Clang /include issues that I mentioned in list mail ???
[00:06:41] *** Joins: btipling (btipling@moz-BEC82197.dsl.dynamic.sonic.net)
[00:07:03] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[00:07:06] <strcat> Sodel_the_V: bar<T: MyT>(x: T) {}
[00:07:14] *** Joins: samuelgiles (samuelgile@moz-20BB4834.haye.cable.virginmedia.com)
[00:08:13] <strcat> T is the type implementing the list of traits after :
[00:08:26] <strcat> you can use traits as objects too - but not by-value
[00:09:19] <Sodel_the_V> Kind of indirect, but that works, thanks.
[00:09:42] <Sodel_the_V> (And yeah, I learned that trai objects don't work by value earlier today, the hard way. :P )
[00:09:45] *** Quits: ahsanulhaque (Adium@moz-C1904CC7.banglalionwimax.com) (Ping timeout)
[00:09:48] <Sodel_the_V> trait*
[00:09:50] *** Quits: fzzzy (donovan@moz-DC14F12B.us-west-2.compute.amazonaws.com) (Quit: ZNC - http://znc.in)
[00:10:05] <strcat> fn bar<T: Trait>(x: &T) {}
[00:10:13] <strcat> fn bar(x: &Trait) {}
[00:10:25] *** Quits: btipling (btipling@moz-BEC82197.dsl.dynamic.sonic.net) (Quit: Computer has gone to sleep.)
[00:10:26] <strcat> both of those will work but the second is dynamic dispatch from a trait object
[00:10:27] <brson> Thad: I'm don't know how to help with your cygwin problem. That bug you turned up recently about how clang locates the standard c++ headers seemed like a good lead though. Did that not help?
[00:10:34] <strcat> in the first one, T is the type implementing the trait
[00:10:58] *** Quits: acrichto_ (acrichto@moz-FE112B96.res.cmu.edu) (Input/output error)
[00:11:27] <Sodel_the_V> strcat: Clear explanation of the difference, thanks. :) It's trait objects I'm trying to use.
[00:12:18] <strcat> pcwalton: I think leaving out the C comparison doesn't lose anything
[00:12:24] <pcwalton> ok
[00:12:29] <strcat> just going to expand the idiomatic part with clearer comments
[00:12:32] <Sodel_the_V> I must be doing something really dense, because trait inheritance still doesn't seem to be working. http://pastebin.mozilla.org/2347686
[00:12:49] *** Quits: thou (thou@moz-D1EE62D4.sumnetsol.com) (Input/output error)
[00:12:54] <Thad> brson: yes and know... I now know where to look... but I have many limit.h files to choose from various /include paths... I thought that Clang / LLVM platform.mk would take care of helping locate... doesn't seem so... at least not in the Cygwin case...   I'd like to eliminate source compiling Clang LLVM if I can for Cygwin users.  So that's the environment I have up right now to look at with me.
[00:13:39] <Sodel_the_V> (That is, trait inheritance + trait objects)
[00:13:47] *** Joins: acrichto (acrichto@moz-FE112B96.res.cmu.edu)
[00:14:15] <Thad> brson: I know I know... everyone's time here is extremely limited... perhaps someone with just some basic Linux Unix expertise might go a long way in helping me out.... volunteers ???
[00:15:19] *** Joins: btipling (btipling@moz-BEC82197.dsl.dynamic.sonic.net)
[00:16:10] *** Quits: mschifer1 (Adium@2557E599.66715431.D25A875A.IP) (Quit: Leaving.)
[00:16:32] <tjc> Sodel_the_V: I'm not surprised if it doesn't work; trait inheritance still has some rough edges
[00:17:36] <tjc> Sodel_the_V: strangely enough, there doesn't already seem to be an existing bug along these lines, so please file an issue
[00:18:02] *** Joins: judder (maradukewa@DABDEEA3.F2C0D0AC.78E362FE.IP)
[00:18:26] <Sodel_the_V> tjc: Fair enough. Compiler bugs I can live with; PEBKAC is more irksome. I will indeed file an issue.
[00:18:29] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[00:18:33] <tjc> thanks!
[00:20:22] *** Quits: engla (engla@moz-E4A8CEF5.customer.cdi.no) (Ping timeout)
[00:22:33] *** Quits: btipling (btipling@moz-BEC82197.dsl.dynamic.sonic.net) (Quit: Computer has gone to sleep.)
[00:24:07] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Quit: Computer has gone to sleep.)
[00:26:35] *** Quits: azita (Azita@2557E599.66715431.D25A875A.IP) (Quit: azita)
[00:27:50] *** Quits: acrichto (acrichto@moz-FE112B96.res.cmu.edu) (Ping timeout)
[00:31:20] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[00:32:58] *** Joins: eholk (eholk@moz-D5BE5964.hsd1.in.comcast.net)
[00:36:47] <Thad> brson: I've opened the LLVM channel and I'm asking in there...maybe they can help solve the mystery and get me on track.
[00:37:15] <brson> Thad: The only thing I know to do is to replicate the feature test that LLVM's configure script is performing and try to understand why it doesn't work. I don't believe that I have any specific knowledge that would make me understand what's broken better than anyone else.
[00:37:54] <Thad> brson: I know guy.  thanks.  I'll get it going.
[00:39:02] *** Joins: z0w0 (zack@moz-FFC12EAF.lnse1.cha.bigpond.net.au)
[00:40:11] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[00:41:38] *** Joins: btipling (btipling@moz-BEC82197.dsl.dynamic.sonic.net)
[00:41:53] *** Quits: bnicholson (bnicholson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[00:42:52] *** Quits: btipling (btipling@moz-BEC82197.dsl.dynamic.sonic.net) (Quit: Computer has gone to sleep.)
[00:45:10] <Sodel_the_V> Well, I'm off. Thanks for all the help! :)
[00:45:11] *** Quits: Sodel_the_V (user@moz-853663E1.va.shawcable.net) (Quit: Time for books!)
[00:46:04] <tjc> good evening!
[00:46:42] <Jeaye> o/
[00:47:09] <strcat> pcwalton: should I just explain stack allocation as working based on scopes too?
[00:47:19] <pcwalton> sure, if you'd like.
[00:48:46] *** Joins: btipling (btipling@moz-BEC82197.dsl.dynamic.sonic.net)
[00:49:36] <strcat> pcwalton: http://ix.io/5lK
[00:50:00] <pcwalton> I would say something like
[00:50:17] *** Quits: vosen (vosen@moz-266BA656.icpnet.pl) (Connection reset by peer)
[00:50:38] *** Quits: btipling (btipling@moz-BEC82197.dsl.dynamic.sonic.net) (Quit: Computer has gone to sleep.)
[00:51:31] <pcwalton> "Destructors are central to Rust. A *destructor* is a special function that the compiler associates with a value and automatically runs when a value goes out of scope." (simple example here)
[00:51:51] <strcat> pcwalton: well I don't really want to say 'scope'
[00:52:00] <pcwalton> is no longer accessible
[00:52:13] <pcwalton> A common reason for a value no longer being accessible is that it goes out of scope:
[00:52:30] <strcat> ah right that's a better way to explain it
[00:52:37] <strcat> anyway not going to mention @ for a while
[00:52:38] *** Quits: lkuper (lkuper@moz-D6AAFF3.cs.indiana.edu) (Ping timeout)
[00:52:48] <pcwalton> and then say something like
[00:53:49] <pcwalton> The unique smart pointer `~` has a built-in destructor that destroys the memory that it points to.
[00:54:01] *** Quits: eholk (eholk@moz-D5BE5964.hsd1.in.comcast.net) (Quit: eholk)
[00:54:04] <pcwalton> You can also write your own destructors. For example, you may want to write a destructor that closes a file:
[00:57:45] *** Joins: sonwow (sonwow@5AB4884B.FCC4549.14D5B978.IP)
[00:59:44] <Thad> sweet bbq ribs... this is cool way to find your libstdc++ headers...  'gcc -v -x c++ /dev/null -fsyntax-only'  which will get the path for you and other things.
[01:02:06] *** Quits: seth (seth@moz-BE33DA21.fw1.sfo1.mozilla.net) (Input/output error)
[01:02:38] <jld> Today I learned about the optional "stack chunk limit" in the original ARM Procedure Call Standard.  Which seems like it'd be useful for segmented stacks.
[01:02:43] <erickt> pcwalton: in trans, do you know what the first two values are to a function? Is the first value the return value pointer, and the second the environment?
[01:02:45] <Thad> so it _appears_ that gcc 4.7.2 and undergarments are in ... /usr/lib/gcc/i686-pc-cygwin/4.7.2/   including the c++ header files under /usr/lib/gcc/i686-pc-cygwin/4.7.2/include/c++
[01:02:55] <pcwalton> erickt: yup
[01:02:58] *** Joins: seth (seth@moz-BE33DA21.fw1.sfo1.mozilla.net)
[01:03:24] <erickt> did your patch that allows small values to be returned through `ret` land yet?
[01:03:28] <pcwalton> yes
[01:03:35] *** Joins: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net)
[01:03:37] <pcwalton> but it didn't eliminate retptrs
[01:03:45] <erickt> gotcha
[01:04:45] *** Quits: MrFahrenheit (RageOfThou@moz-CF7139ED.dynamic.telemach.ba) (Ping timeout)
[01:07:37] *** Joins: fzzzy (Donovan@moz-40919DA0.us-west-2.compute.amazonaws.com)
[01:07:54] <Thad> Further on Cygwin !  ... I'm past the limits.h and standard C++ headers, but now another complaint is shown ...help ?   http://pastebin.mozilla.org/2347844
[01:08:46] *** Quits: sonwow (sonwow@5AB4884B.FCC4549.14D5B978.IP) (Quit: leaving)
[01:08:57] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[01:09:17] <strcat> pcwalton: showing an implementation of a destructor is probably best left to the ffi tutorial
[01:09:28] <pcwalton> that's fine.
[01:09:54] *** Joins: sonwow (sonwow@5AB4884B.FCC4549.14D5B978.IP)
[01:11:30] <sonwow> brson: I saw your commit about making conditions public, however is it possible to use conditions from another crate?
[01:13:24] *** Joins: jfredett (jfredett@moz-C01C350.bstnma.fios.verizon.net)
[01:15:01] <brson> Thad: yay!
[01:15:08] <brson> sonwow: I ... don't know. Is it not?
[01:15:14] <Thad> brson: lol
[01:17:15] <sonwow> brson: There is an ICE. (https://github.com/mozilla/rust/issues/5446)
[01:17:31] <erickt> nmatsakis: ping
[01:17:45] <jld> Apparently software stack limit checking isn't one of the APCS options that ARM obsoleted.  So... why did we need to reinvent that wheel with TLS?  I wonder.
[01:20:42] <Thad> what does ICE mean ?
[01:20:47] <jld> Internal Compiler Error.
[01:21:45] <Thad> jld: cool thanks... just added that to the ISO thesaurus. 
[01:22:04] <Thad> International Standards Organization.
[01:23:57] *** Joins: wuwei`lab (wuwei@1A513F49.818D7924.FAA9ED67.IP)
[01:26:11] *** Parts: judder (maradukewa@DABDEEA3.F2C0D0AC.78E362FE.IP) ()
[01:28:27] <nmatsakis> erickt: pong
[01:28:57] <erickt> where did you say was the code that took a self value and automatically added or removed regions?
[01:29:00] <erickt> in trans?
[01:29:35] <nmatsakis> erickt: you're referring to the adjusments table, I think?
[01:29:40] <nmatsakis> erickt: the table is in the tcx
[01:29:41] <erickt> ah right
[01:29:44] <erickt> thanks :)
[01:29:56] <nmatsakis> erickt: the code that generates code based on  it is in trans/expr.rs
[01:30:18] <nmatsakis> erickt: basically when you invoke something like expr::trans_to_datum or expr::trans_into
[01:30:23] <nmatsakis> erickt: the adjustments are applied
[01:30:49] <nmatsakis> erickt: see expr::trans_to_datum in particular
[01:31:23] *** Quits: jgilbert (jgilbert@2557E599.66715431.D25A875A.IP) (Ping timeout)
[01:32:29] *** Quits: sp3d (a@moz-17CB39F1.fidnet.com) (Ping timeout)
[01:34:17] *** Quits: wuwei`lab (wuwei@1A513F49.818D7924.FAA9ED67.IP) (Input/output error)
[01:34:44] *** Joins: wuwei`lab (wuwei@1A513F49.818D7924.FAA9ED67.IP)
[01:36:02] <nmatsakis> erickt: did you find it?
[01:36:10] <erickt> yeah
[01:36:18] <nmatsakis> lemme know if you have any questions
[01:37:31] <erickt> although I now don't think it helps my immediate problem. I need to figure out how to properly translate `&self` into a pointer
[01:37:43] <erickt> for the argument type
[01:38:43] <erickt> I suppose could just match if that argument is sty_region/sty_box/sty_uniq and add a pointer when I'm making that argument
[01:44:15] *** Quits: Sorella (queen@B12A78F5.BA14766C.95C8B7C6.IP) (Ping timeout)
[01:45:56] *** Quits: wuwei`lab (wuwei@1A513F49.818D7924.FAA9ED67.IP) (Input/output error)
[01:48:33] *** Joins: wuwei`lab (wuwei@1A513F49.818D7924.FAA9ED67.IP)
[01:50:25] *** Joins: acrichto (acrichto@moz-FE112B96.res.cmu.edu)
[01:53:24] *** Quits: acrichto (acrichto@moz-FE112B96.res.cmu.edu) (Quit: leaving)
[01:53:30] *** Joins: acrichto (acrichto@moz-FE112B96.res.cmu.edu)
[01:57:24] *** Joins: burntsushi (burntsushi@moz-27A1B1D8.dhcp.oxfr.ma.charter.com)
[01:59:08] <nmatsakis> erickt: you're talking about when you declare the functions? yes, you can do that, however
[01:59:17] <nmatsakis> erickt: you could also look at the transformed_self_ty in the ty::method
[01:59:59] <nmatsakis> erickt: call ty::method(tcx, def_id) and it will give you the method type
[02:00:12] <erickt> neat
[02:00:13] <nmatsakis> erickt: from which you can extract the transformed self-type
[02:00:16] <pcwalton> nmatsakis: can you elaborate on the leak that requires &fn to be by-ref mode
[02:00:18] <nmatsakis> erickt: you'll hvae to substitute the type parameters
[02:00:28] <nmatsakis> pcwalton: I belivee that leak is fixed
[02:00:34] <pcwalton> I believe otherwise :)
[02:00:46] <nmatsakis> pcwalton: there may be another...it had to do with subtyping
[02:00:56] <nmatsakis> you would pass a ~fn in as a "move of ownership"
[02:01:01] <nmatsakis> then the callee would not free it
[02:01:06] <nmatsakis> because it only saw it as type &fn
[02:01:10] <nmatsakis> but ~fn is no longre a subtype of &fn
[02:01:14] <pcwalton> this may be back
[02:01:20] <nmatsakis> hmm ok
[02:01:37] <nmatsakis> pcwalton: going to bed, but it should be that this is not considered a move
[02:02:01] <aatch> Hey, somebody retry https://github.com/mozilla/rust/pull/5646 ?
[02:02:14] <nmatsakis> pcwalton: also, since you were asking, new borrowck is building rustc now, I still have to push through tests
[02:02:20] <pcwalton> great
[02:02:36] <nmatsakis> (though I dropped support for nested method calls, those will come in a follow up patch)
[02:02:37] *** Quits: fzzzy (Donovan@moz-40919DA0.us-west-2.compute.amazonaws.com) (Ping timeout)
[02:03:23] <nmatsakis> pcwalton: anyway, right, using a ~fn where &fn is expected should be a borrow, not a move, but I don't think I ever deeply validated that :)
[02:03:48] *** Quits: diegoyam (quassel@FF9B1514.A4EC3D18.3A1EC144.IP) (Ping timeout)
[02:03:56] *** Quits: diegoyam_ (quassel@FF9B1514.A4EC3D18.3A1EC144.IP) (Ping timeout)
[02:04:02] *** Joins: snadon (chatzilla@moz-EFE8FD29.mc.videotron.ca)
[02:04:34] <nmatsakis> pcwalton: maybe there is some code in trans that is zeroing it out because it is not considering the adjustments...
[02:04:53] <nmatsakis> pcwalton: ...that is, it sees that the type of the expr is ~fn (linear), but the *adjusted type* would be &fn (non-linear)
[02:04:58] <nmatsakis> but I feel like that would cause tons of problems
[02:05:17] <pcwalton> current theory: ~fn() to &fn() borrowing is just busted.
[02:05:25] <nmatsakis> possible
[02:05:41] <pcwalton> I have been at this bug for over 24h now :)
[02:06:00] <nmatsakis> well feel free to push a branch + test somewhere, I can look at in the morning
[02:06:35] <nmatsakis> ttyl
[02:07:15] <pcwalton> ok, have a good evening
[02:09:31] *** Joins: eholk (eholk@moz-D5BE5964.hsd1.in.comcast.net)
[02:09:55] <brson> aatch: done
[02:10:04] <aatch> brson, thanks
[02:10:06] *** Quits: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP) (Quit: Places to go, people to annoy)
[02:10:57] *** Joins: fzzzy (Donovan@moz-40919DA0.us-west-2.compute.amazonaws.com)
[02:11:37] <aatch> I think that you did it when bors was having a hissy fit the first time.
[02:12:14] *** Quits: EXetoC (ex@moz-2DBEB1E4.customer.t3.se) (Quit: WeeChat 0.4.0)
[02:12:39] *** Joins: diegoyam (quassel@FF9B1514.A4EC3D18.3A1EC144.IP)
[02:13:23] *** Quits: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP) (Quit: pcwalton)
[02:15:53] *** Quits: fzzzy (Donovan@moz-40919DA0.us-west-2.compute.amazonaws.com) (Ping timeout)
[02:16:20] <Thad> Anyone know how to get around the error of SSE4A instruction set not enabled ... in Clang target of i686-w64-mingw32 ?  I'm on Intel i7 and apparently the SSE4A is only for AMD chips ?
[02:17:58] <aatch> Thad, that sounds like an llvm issue
[02:18:29] <Thad> aatch: of course.... but ... is it an issue ?  
[02:19:51] <strcat> Thad: https://github.com/mozilla/rust/pull/6070 I guess that's better
[02:20:05] <aatch> well the lack of an instruction set version shouldn't be an issue
[02:20:11] <aatch> Seems a little silly.
[02:22:22] <Thad> strcat: ...hmm.. going out of scope... yeah, still have a problem with that phrase... define "what does it mean to go out of scope"
[02:23:09] <strcat> Thad: lexical scoping needs to be explained earlier in the tutorial so I think it's fine to use it there
[02:23:11] *** Quits: brson (brson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[02:23:12] <Thad> strcat: it can't find it again ?  it loses it's identity within the heap and so will be purged out of the memory heap ?
[02:23:27] *** Joins: fzzzy (Donovan@moz-40919DA0.us-west-2.compute.amazonaws.com)
[02:23:45] <Thad> strcat: ah, OK.  just make sure to explain the identity crisis that might happen ... so I've heard.
[02:24:24] <Thad> strcat: is it "heap memory" ... or "memory heap"  ??
[02:24:42] *** Quits: graydon (graydon@3853DDD.39EEDBB3.D758B1AA.IP) (Quit: Leaving.)
[02:25:14] <strcat> heap memory - I considered calling it dynamically allocated memory but it's not really accurate
[02:25:16] <strcat> since stacks grow..
[02:25:30] <strcat> dunno what else to call it
[02:26:04] <Thad> what does www.computer.org call it ???
[02:27:00] <strcat> dunno
[02:27:07] <strcat> it's only heap memory from a language's point of view
[02:27:13] <aatch> The general terms are heap and stack to most programmers that know about it.
[02:27:34] <strcat> from a hardware POV it's all the same memory
[02:27:42] <Thad> strcat: probably should be "memory - heap allocation" ...   your allocating the heap , within the memory space, no ?
[02:27:54] <aatch> So they could be explained then given the name.
[02:28:54] <aatch> But it might be worthwhile to have a "Rust introduction for dynamic language users"
[02:30:12] <strcat> I'm not sure explaining it by pulling out sys::size_of and showing the indirection would help anything
[02:30:16] *** Quits: Axord (xord@moz-C3CCF156.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[02:31:01] <aatch> Which would explain the details of stack and heap allocation, what the difference is, what each one means and what they are used for. Along with anything else that dynamic language users might miss.
[02:31:33] <strcat> the tutorial explains why ~ is needed
[02:32:10] <strcat> maybe I should use size_of to demonstrate...
[02:32:13] <strcat> https://github.com/thestinger/rust/blob/9fef99f79cb1cd13983a21772e998ecbda30447b/doc/tutorial.md#owned-boxes
[02:32:47] <aatch> Yeah, but to a C/C++ programmer, stack and heap are basic concepts. To somebody from python and ruby, they are meaningless (or just data structures)
[02:33:54] <strcat> it can be explained in the tutorial, I just don't feel like writing it myself ;p
[02:34:34] <Thad> strcat: I would just explain it with the basic FILO data structure ... to explain the simple concept of a Stack.   Even use a .png or .gif with new residents moving onto a street and needing an mailbox for delivery.  That worked for me at one time.
[02:36:43] <z0w0> is there any way to expand a parsed crate into how it would resolve?
[02:36:55] <z0w0> like, net_tcp would become net::tcp 
[02:37:23] <z0w0> i am trying to make rustdoc print out submodule contents
[02:38:21] <strcat> z0w0: I don't think you need to do that
[02:38:30] <strcat> net_tcp is just re-exported in a module called net
[02:38:52] <strcat> don't both show up in the docs?
[02:41:11] <z0w0> well i kinda want it to only show up under net
[02:41:29] <strcat> Thad: python has a call stack too and it doesn't seem like they explain it anywhere
[02:42:02] <strcat> the intro to exceptions just refers to tracebacks and a call stack
[02:42:08] <Thad> strcat: I'd didn't know that existed.
[02:42:54] *** Joins: btipling (btipling@moz-BEC82197.dsl.dynamic.sonic.net)
[02:43:18] <Thad> strcat: there's a few nice tidbits that you could probably pull from this video / slideshow , which is linked to by some favorable professors it appears, even.
[02:43:27] <Thad> strcat: http://www.youtube.com/watch?v=wlJJgjdgvYE
[02:44:18] *** Quits: doomlord (doomlod@moz-92EDFF3A.range31-52.btcentralplus.com) (Ping timeout)
[02:44:48] *** Quits: btipling (btipling@moz-BEC82197.dsl.dynamic.sonic.net) (Quit: Computer has gone to sleep.)
[02:45:44] *** Joins: doomlord (doomlod@moz-92EDFF3A.range31-52.btcentralplus.com)
[02:54:43] *** Quits: snadon (chatzilla@moz-EFE8FD29.mc.videotron.ca) (Ping timeout)
[02:56:47] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[02:57:14] *** Quits: zz_kimundi (kimundi@moz-84D59F59.dip0.t-ipconnect.de) (Ping timeout)
[02:59:51] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[03:00:24] *** Joins: zz_kimundi (kimundi@moz-7DB9097C.dip0.t-ipconnect.de)
[03:00:44] *** zz_kimundi is now known as kimundi
[03:01:32] *** Quits: devbug (quassel@moz-E1DE087C.bchsia.telus.net) (Ping timeout)
[03:03:57] *** Joins: snadon (chatzilla@moz-EFE8FD29.mc.videotron.ca)
[03:06:51] *** Joins: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP)
[03:10:00] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[03:10:06] *** Joins: devbug (quassel@moz-E1DE087C.bchsia.telus.net)
[03:10:18] *** Quits: Jesse (jruderman@2557E599.66715431.D25A875A.IP) (Quit: Jesse)
[03:10:44] *** Quits: samuelgiles (samuelgile@moz-20BB4834.haye.cable.virginmedia.com) (Quit: This computer has gone to sleep)
[03:11:15] *** Joins: brson (brson@moz-6A295265.hsd1.ca.comcast.net)
[03:11:15] *** ChanServ sets mode: +o brson
[03:11:53] *** Quits: brson (brson@moz-6A295265.hsd1.ca.comcast.net) (Quit: leaving)
[03:12:39] *** Joins: brson (brson@E9CDE21E.991753BB.CA4D1600.IP)
[03:12:39] *** ChanServ sets mode: +o brson
[03:13:43] *** Quits: FrozenCow (FrozenCow@moz-9DF5D010.dynamic.upc.nl) (Client exited)
[03:14:06] <aatch> Ok, sorting out committer agreement stuff. Should I still open a repository request "issue" on mozilla.org?
[03:15:43] *** Joins: Sodel-the-V (user@moz-853663E1.va.shawcable.net)
[03:15:49] <bstrie> anyone who knows emacs want to review a short patch for rust-mode? https://github.com/mozilla/rust/pull/6066
[03:16:36] <bstrie> don't need to be a committer, just tell me if it looks good and I can approve it
[03:16:47] <Sodel-the-V> bstrie: I'm an emacs guy. I'll have a look. :)
[03:17:14] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[03:17:14] <Sodel-the-V> bstrie: Errant space between the colon and "group"
[03:18:17] <Sodel-the-V> Otherwise, it looks fine to me!
[03:20:28] <SiegeLord> I wonder how easy it is to add proper Rust support to Geany...
[03:20:51] <SiegeLord> I hacked together a highlighter file using the C parser, but it barfs at the lifetime syntax
[03:24:18] *** Quits: posco (oscarboyki@692ED873.5999CED5.71743E61.IP) (Quit: posco)
[03:24:50] * aatch should really attack the vim stuff at some point.
[03:25:34] *** Quits: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP) (Quit: Leaving)
[03:27:48] <doomlord> thinking about IDE class browsers, do rust traits potentially map onto support for interfaces in oo languages
[03:28:59] <Sodel-the-V> doomlord: By my understanding, interfaces are probably the closest analog, yeah.
[03:31:21] <bstrie> Sodel-the-V: does that errant space change the meaning at all?
[03:31:48] <bstrie> ah I see
[03:31:51] <bstrie> comments were made
[03:32:32] <snowmantw> hello, I found that if I use `--disable-optimize` to make rustc, it will find no `libcore-*.so` and raised an `ran out of stack` error.
[03:32:43] <snowmantw> I'm in incoming branch
[03:32:59] *** Joins: catpigger (catpig@moz-DE1B6BDB.dip0.t-ipconnect.de)
[03:33:14] <snowmantw> but without the option everything is OK
[03:33:31] <Sodel-the-V> bstrie: I'm pretty sure the meaning changes, yeah. It's the difference between a the keyvowrd ":group" and... something else. :P
[03:33:38] <Sodel-the-V> keyword*
[03:33:44] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[03:34:00] *** Quits: catpig (catpig@moz-10EA25F9.dip0.t-ipconnect.de) (Ping timeout)
[03:34:44] <Sodel-the-V> Ugh, my grammar/typing there was scandalous.
[03:34:45] *** Joins: Jesse (jruderman@2557E599.66715431.D25A875A.IP)
[03:39:17] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[03:42:58] *** Quits: seth (seth@moz-BE33DA21.fw1.sfo1.mozilla.net) (Input/output error)
[03:43:56] <Sodel-the-V> bstrie: (The "something else" turns out to be two symbols: ":" and "group", which is bad.)
[03:52:56] *** Quits: Jesin (Jessin_@moz-60120A2E.cc.lehigh.edu) (Ping timeout)
[03:56:00] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.0)
[03:56:04] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:58:16] *** Joins: dbaupp (Thunderbir@moz-53CF57B9.lns20.syd6.internode.on.net)
[03:58:33] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.0)
[04:03:01] *** Quits: joshua_ (joshua@moz-45967CBE.emarhavil.com) (Ping timeout)
[04:05:08] *** Quits: Jesse (jruderman@2557E599.66715431.D25A875A.IP) (Quit: Jesse)
[04:07:05] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[04:09:17] *** Joins: Jesse (jruderman@2557E599.66715431.D25A875A.IP)
[04:14:01] *** Quits: Thad (chatzilla@moz-C35F90AE.tx.res.rr.com) (Quit: ChatZilla 0.9.90 [Firefox 21.0/20130416200523])
[04:22:40] *** Quits: Jesse (jruderman@2557E599.66715431.D25A875A.IP) (Quit: Jesse)
[04:29:09] *** Quits: catpigger (catpig@moz-DE1B6BDB.dip0.t-ipconnect.de) (Quit: Verlassend)
[04:29:49] *** Quits: eholk (eholk@moz-D5BE5964.hsd1.in.comcast.net) (Quit: eholk)
[04:32:23] *** Quits: Ralith (ralith@114DA04D.CD83ED0A.BCDF04A6.IP) (Ping timeout)
[04:32:26] *** Joins: Ralith (ralith@114DA04D.CD83ED0A.BCDF04A6.IP)
[04:33:10] *** Quits: jfredett (jfredett@moz-C01C350.bstnma.fios.verizon.net) (Ping timeout)
[04:33:49] *** Quits: Benvie_ (Thunderbir@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: Benvie_)
[04:33:53] *** Joins: Benvie1 (Thunderbir@moz-BE33DA21.fw1.sfo1.mozilla.net)
[04:33:56] *** Joins: btipling (btipling@moz-5413CFA4.hsd1.ca.comcast.net)
[04:34:09] *** Quits: doomlord (doomlod@moz-92EDFF3A.range31-52.btcentralplus.com) (Quit: Leaving)
[04:41:23] *** Joins: engla (engla@moz-E4A8CEF5.customer.cdi.no)
[04:44:06] *** Quits: engla (engla@moz-E4A8CEF5.customer.cdi.no) (Ping timeout)
[04:48:54] *** Quits: sonwow (sonwow@5AB4884B.FCC4549.14D5B978.IP) (Quit: leaving)
[04:49:39] *** Joins: sonwow (sonwow@5AB4884B.FCC4549.14D5B978.IP)
[04:53:25] *** Joins: seth (seth@moz-D840E602.dsl.static.sonic.net)
[04:55:31] *** Quits: seth (seth@moz-D840E602.dsl.static.sonic.net) (Ping timeout)
[04:57:39] *** Quits: klapaucius (klapaucius@272B8F8B.5692770D.BB41F968.IP) (Quit: klapaucius)
[05:01:37] *** Quits: int3_ (int3_@moz-2242076.subnet-248.amherst.edu) (Client exited)
[05:04:54] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[05:07:23] *** Quits: snadon (chatzilla@moz-EFE8FD29.mc.videotron.ca) (Quit: ChatZilla 0.9.90 [Firefox 21.0/20130423212553])
[05:09:03] *** Quits: guitsaru (guitsaru@A8985A22.5DF68D0E.4C2245EF.IP) (Client exited)
[05:11:23] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[05:17:14] *** Quits: snowmantw (Mibbit@moz-69896760.cs.nccu.edu.tw) (Quit: http://www.mibbit.com ajax IRC Client)
[05:20:54] *** Quits: blitter (blitter@moz-48397EA8.dyn.centurytel.net) (Ping timeout)
[05:23:12] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[05:24:02] *** Joins: guitsaru (guitsaru@moz-35937D86.hsd1.ca.comcast.net)
[05:24:55] *** Joins: guitsaru_ (guitsaru@moz-35937D86.hsd1.ca.comcast.net)
[05:24:55] *** Quits: guitsaru (guitsaru@moz-35937D86.hsd1.ca.comcast.net) (Connection reset by peer)
[05:25:20] *** Quits: guitsaru_ (guitsaru@moz-35937D86.hsd1.ca.comcast.net) (Client exited)
[05:25:51] *** Joins: Guest_ (textual@moz-EBE9F394.bchsia.telus.net)
[05:26:42] *** Joins: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl)
[05:27:10] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Quit: Computer has gone to sleep.)
[05:29:18] <dbaupp> is it possible to disable bounds checking?
[05:33:09] *** Joins: int3_ (int3_@moz-2242076.subnet-248.amherst.edu)
[05:34:52] *** Quits: nattofriends (tsutsumi@moz-4CEEC7AA.warosu.org) (Ping timeout)
[05:35:07] *** Quits: sully (sully@moz-ECFB7516.moroso.emarhavil.com) (Ping timeout)
[05:35:18] *** Quits: tupshin (quassel@moz-3512E62E.c3-0.nyr-ubr1.nyr.ny.cable.rcn.com) (Ping timeout)
[05:35:19] *** Joins: sully (sully@moz-ECFB7516.moroso.emarhavil.com)
[05:35:23] *** Joins: tupshin (quassel@moz-3512E62E.c3-0.nyr-ubr1.nyr.ny.cable.rcn.com)
[05:35:53] *** Joins: nattofriends (tsutsumi@moz-4CEEC7AA.warosu.org)
[05:37:04] *** Joins: flipcoder (flipcoder@moz-EE3A28B2.dhcp.rvsd.ca.charter.com)
[05:38:11] <brson> dbaupp: not yet
[05:43:59] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[05:44:25] <dbaupp> brson: thanks, unsafe pointers it is!
[05:47:59] *** Quits: btipling (btipling@moz-5413CFA4.hsd1.ca.comcast.net) (Quit: Computer has gone to sleep.)
[05:48:08] *** Quits: SiegeLord (sl@moz-56D7E78.bstnma.fios.verizon.net) (Quit: It's a joke. It's all a joke.)
[05:48:47] <kemurphy> hey, so i'm having some trouble with task pools
[05:49:56] <kemurphy> i have a graph structure (which i've sadly had to make much dumber to be considered "Owned"), and i want to spawn a bunch of tasks in the task pool that operate on this graph
[05:49:59] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[05:51:19] *** Quits: int3_ (int3_@moz-2242076.subnet-248.amherst.edu) (Client exited)
[05:52:01] <brson> kemurphy: what's the trouble you are having?
[05:52:19] <kemurphy> i can't get the graph into the owned closure for the task pool
[05:52:38] <kemurphy> i've tried it a few different ways
[05:53:41] <brson> kemurphy: what is the error you see?
[05:53:49] <kemurphy> is there a way to work with shared immutable state from the tasks in the pool or do i have to clone it for each task in the pool?
[05:53:52] <kemurphy> brson: one sec
[05:54:08] <kemurphy> movies.rs:142:12: 142:17 error: illegal by-move capture of captured outer variable in a heap closure
[05:54:09] <kemurphy> movies.rs:142             graph.clone()
[05:54:28] <kemurphy>                           ^~~~~
[05:55:12] <brson> kemurphy: there is a type called std::arc::ARC for sharing immutable state
[05:55:39] <kemurphy> brson: okay, thanks, i'll play with that i guess
[05:55:41] <brson> kemurphy: you have multiple closures, and `graph` is getting 'stuck' in the outer closure
[05:56:00] <brson> because you can't move captured variables out of closures yet
[05:56:22] <brson> what you can do as a workaround is use core::cell::Cell
[05:56:38] <brson> outside the outer closure put your graph in the cell
[05:56:48] <kemurphy> brson: right, that's what i figured was going on, but i didn't understand why i couldn't just clone a new one and move it into the inner closure
[05:57:01] <kemurphy> brson: ah, so that's what Cell is for :)
[05:57:04] <brson> oh, yeah you have a clonable type, that should work
[05:57:14] <brson> a few clones should do it, you are right
[05:57:14] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[05:57:14] *** ChanServ sets mode: +o dherman
[05:57:41] <kemurphy> yeah that wasn't working either
[05:58:13] <brson> can I see the code that didn't work?
[05:58:22] <brson> well, the code that generated that error
[05:58:50] <kemurphy> should i pastebin it or is it okay to paste about 7 lines
[05:59:14] <kemurphy> (for all i know i'm just doing it wrong anyway)
[06:00:21] <brson> pastebin please
[06:00:23] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[06:00:27] <kemurphy> brson: http://pastebin.mozilla.org/2348586
[06:02:20] <kemurphy> it failed with a similar error
[06:03:53] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[06:04:20] *** Joins: Erik (Erik@moz-252DBA2.hsd1.co.comcast.net)
[06:05:31] <kimundi> brson: how would i test that fmt! fail works correctly?
[06:06:23] <kimundi> run fail with error pattern the expected output?
[06:06:29] <brson> kemurphy: on line 3 is `graph` captured in a closure? does it need to be cloned?
[06:06:58] <brson> kimundi: yes, I think that is appropriate
[06:07:49] <kemurphy> brson: i don't think so? it's just a local in the enclosing function
[06:08:24] <kemurphy> brson: it is used above those lines in things like "for graph.roots.each |root| { ... }"
[06:10:28] <kemurphy> brson: line 3 was just to freeze it
[06:13:12] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Connection reset by peer)
[06:15:21] *** Joins: int3_ (int3_@moz-2242076.subnet-248.amherst.edu)
[06:15:31] <kemurphy> brson: okay, so the thing with Cell compiled but...
[06:15:37] <brson> kemurphy: based on that code, assuming `clone` is an implementation of `Clone`, I would expect that to work
[06:15:47] <kemurphy> brson: rust: task failed at 'assertion failed: i == len(u)', /build/src/rust-0.6/src/libcore/vec.rs:1290
[06:16:08] <kemurphy> brson: yeah, i would have thought so too. oh well i guess
[06:17:07] *** Quits: int3_ (int3_@moz-2242076.subnet-248.amherst.edu) (Ping timeout)
[06:18:21] <brson> kemurphy: you can get a backtrace in gdb by breaking on rust_task_fail
[06:18:59] <kemurphy> also, is there a way i can make a struct with borrowed pointers (annotated with 'self) considered Owned so i can throw it in an ARC
[06:19:19] <kemurphy> it would be Nice(tm) to not have to clone this graph over and over since it's kinda heavy
[06:20:24] <brson> kemurphy: besides &'static pointers I don't think there's a way to do that, no
[06:20:48] <Jeaye> 82
[06:21:00] <Jeaye> sorry
[06:21:12] <kemurphy> well, i guess i can throw the dumb version in an ARC instead of cloning it
[06:21:25] *** Joins: mib_fc1q83 (Mibbit@114D185A.768F3452.D48822CC.IP)
[06:21:40] *** Quits: mib_fc1q83 (Mibbit@114D185A.768F3452.D48822CC.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[06:23:09] *** Joins: joshua_ (joshua@moz-45967CBE.emarhavil.com)
[06:23:46] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[06:23:58] *** Joins: KindOne (KindOne@moz-A7230136.dynamic.ip.windstream.net)
[06:26:26] *** Joins: int3_ (int3_@moz-2242076.subnet-248.amherst.edu)
[06:31:00] *** Joins: guitsaru (guitsaru@moz-35937D86.hsd1.ca.comcast.net)
[06:31:15] *** Quits: mibitzi (mibitzi@87CAE982.60DF3A09.8395810B.IP) (Ping timeout)
[06:31:50] *** Quits: KindOne (KindOne@moz-A7230136.dynamic.ip.windstream.net) (Client exited)
[06:31:54] <kemurphy> brson: i can't get the ARC version to compile :/
[06:33:16] <kemurphy> brson: ah, never mind, got it
[06:33:39] *** Quits: TD-Linux (TD-Linux@E338EB99.2B4F0AE0.A0A36CCE.IP) (Ping timeout)
[06:37:04] *** Joins: TD-Linux (TD-Linux@E338EB99.2B4F0AE0.A0A36CCE.IP)
[06:39:52] <kemurphy> brson: oh, ignore that vec.rs error, i was being dumb elsewhere
[06:39:57] *** Quits: guitsaru (guitsaru@moz-35937D86.hsd1.ca.comcast.net) (Client exited)
[06:40:50] *** Joins: SimonSapin (simon@moz-C4A83ED9.net-89-2-126.rev.numericable.fr)
[06:42:26] <bjz> brson: https://github.com/mozilla/rust/pull/6071
[06:45:30] <bjz> brson: I converted num over to use `///` so sorry if that clutters the commit
[06:45:48] <bjz> should probably state that in the message
[06:46:05] *** Joins: berak (chatzilla@4A94EB28.5291F4C0.16E13E53.IP)
[06:53:26] *** Joins: pyrac (pyrac@24973E72.81445FE4.1B3E68DA.IP)
[06:53:30] *** Parts: berak (chatzilla@4A94EB28.5291F4C0.16E13E53.IP) ()
[06:56:24] *** Joins: fabiand (fabiand@moz-4563135B.adsl.alicedsl.de)
[06:56:34] *** Quits: devbug (quassel@moz-E1DE087C.bchsia.telus.net) (Client exited)
[06:59:51] *** Joins: cdidd (cdidd@moz-1D7DA2DB.broadband.corbina.ru)
[07:02:12] *** Quits: jesse98 (jjones@6251EDC2.15651213.B46B86FA.IP) (Ping timeout)
[07:04:06] *** Joins: webber46 (webber46@moz-AC14FDEA.se)
[07:08:00] <bjz> brson: woops, just a sec
[07:08:22] *** Joins: jesse98 (jjones@6251EDC2.15651213.B46B86FA.IP)
[07:12:31] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[07:16:03] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[07:16:31] *** kimundi is now known as zz_kimundi
[07:17:05] <brson> bjz: thanks! I'll give it a detailed read tomorrow
[07:17:18] <bjz> sure
[07:17:25] <bjz> just pushing a test fix
[07:19:53] <bjz> brson: is it possible to just check one test in run-pass?
[07:20:09] <bjz> atm I'm doing make check fast
[07:20:21] *** Quits: z0w0 (zack@moz-FFC12EAF.lnse1.cha.bigpond.net.au) (Quit: Leaving.)
[07:22:09] *** Joins: guitsaru (guitsaru@moz-35937D86.hsd1.ca.comcast.net)
[07:23:37] <dbaupp> bjz: make check-stage2-rpass TESTNAME=foo
[07:24:24] <dbaupp> https://github.com/mozilla/rust/wiki/Note-testsuite
[07:27:20] <bjz> brson: ok fixed
[07:27:27] <bjz> dbaupp: cheers for that
[07:28:31] <pepijndevos> Can rust be used with emscripten? :D it does use LLVM, right?
[07:29:00] <cmr> I don't know all the details of emscripten but rustc has --emit-llvm
[07:29:23] <cmr> Going to have to build the runtime with emscripten too I think
[07:30:49] *** Quits: guitsaru (guitsaru@moz-35937D86.hsd1.ca.comcast.net) (Client exited)
[07:31:36] *** Quits: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net) (Quit: zzzZZZzzz)
[07:31:38] <dbaupp> pepijndevos: https://github.com/mozilla/rust/issues/2235 
[07:32:01] <dbaupp> (and https://github.com/Yoric/Mozilla-Student-Projects/issues/33)
[07:32:21] *** Joins: guitsaru (guitsaru@moz-35937D86.hsd1.ca.comcast.net)
[07:35:08] *** zz_kimundi is now known as kimundi
[07:36:11] <cmr> "#[deriving(Eq)]" What does that mean?
[07:36:31] <cmr> (Saw it at ast.rs L29)
[07:36:57] <heftig> automatically derives methods to implement the Eq trait, I think
[07:38:23] <heftig> so I believe it adds "eq" and "ne" using memcmp
[07:38:29] <bjz> so you don't need to write it wourself - which can be pretty boiler-plate heavy
[07:38:51] <cmr> Fancy
[07:39:28] *** Quits: int3_ (int3_@moz-2242076.subnet-248.amherst.edu) (Client exited)
[07:40:47] <dbaupp> cmr: there is also Clone (to get the "clone" method) and IterBytes (as well as Ord, TotalOrd and TotalEq for sufficiently new version of rust)
[07:41:50] *** Quits: brson (brson@E9CDE21E.991753BB.CA4D1600.IP) (Ping timeout)
[07:43:16] *** Joins: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP)
[07:44:20] *** Quits: Guest_ (textual@moz-EBE9F394.bchsia.telus.net) (Quit: Computer has gone to sleep.)
[07:49:03] *** Quits: pyrac (pyrac@24973E72.81445FE4.1B3E68DA.IP) (Quit: pyrac)
[07:53:08] *** Quits: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Ping timeout)
[07:56:40] *** Quits: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl) (Ping timeout)
[07:57:19] *** Joins: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl)
[07:59:01] *** Quits: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl) (Ping timeout)
[07:59:19] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[08:06:32] *** Joins: btipling (btipling@moz-5413CFA4.hsd1.ca.comcast.net)
[08:07:15] *** Quits: PeterSP (peter@moz-4DAF5777.bstnma.fios.verizon.net) (Ping timeout)
[08:08:38] *** Quits: Benvie (brandon@4EAF34EF.DD136097.D01D599A.IP) (Ping timeout)
[08:08:58] *** Quits: Sodel-the-V (user@moz-853663E1.va.shawcable.net) (Quit: Eviscerated by the wumpus)
[08:09:14] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[08:09:15] *** Joins: Benvie (brandon@4EAF34EF.DD136097.D01D599A.IP)
[08:12:38] *** Joins: PeterSP (peter@moz-4DAF5777.bstnma.fios.verizon.net)
[08:14:16] *** Quits: SimonSapin (simon@moz-C4A83ED9.net-89-2-126.rev.numericable.fr) (Ping timeout)
[08:16:38] *** Quits: jesse98 (jjones@6251EDC2.15651213.B46B86FA.IP) (Ping timeout)
[08:16:59] *** Joins: pyrac (pyrac@A9EC89DE.73C89388.AD05C589.IP)
[08:19:30] *** Joins: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl)
[08:19:59] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[08:21:40] *** Quits: Erik (Erik@moz-252DBA2.hsd1.co.comcast.net) (Ping timeout)
[08:22:16] *** Quits: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl) (Ping timeout)
[08:23:47] *** Joins: jesse98 (jjones@6251EDC2.15651213.B46B86FA.IP)
[08:25:53] *** Joins: Blub\w (wry@moz-E1F9A469.wireless.dyn.drei.com)
[08:27:20] *** Quits: [o__o] (~o__o@moz-24EBFAC7.me) (Input/output error)
[08:27:22] *** Joins: [o__o] (~o__o@moz-24EBFAC7.me)
[08:29:27] *** Joins: CarpNet (ac@moz-FD24B77.sohonet.co.uk)
[08:29:37] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[08:33:53] *** Joins: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu)
[08:35:53] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[08:39:14] *** Quits: sonwow (sonwow@5AB4884B.FCC4549.14D5B978.IP) (Quit: leaving)
[08:45:24] <kemurphy> is there a way to call map on a mutable slice?
[08:45:33] *** Joins: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl)
[08:48:12] *** Joins: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net)
[08:49:13] *** Quits: wilsonk|2 (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[08:51:06] *** Joins: spider-mario (spidermari@moz-EE4B8A09.rev.sfr.net)
[08:54:08] <dbaupp> rusti: let a = &mut [1,2]; a.map(|&x| x + 1)
[08:54:10] <rusti> more than 5 lines of output, pastebinned: http://sprunge.us/LSbF
[08:54:30] <dbaupp> rusti: let a = &mut [1,2]; (*&a).map(|&x| x + 1)
[08:54:32] <rusti> more than 5 lines of output, pastebinned: http://sprunge.us/WNZN
[08:54:41] <dbaupp> rusti: let a = &mut [1,2]; (&*a).map(|&x| x + 1)
[08:54:43] <rusti> more than 5 lines of output, pastebinned: http://sprunge.us/ZQLP
[08:55:07] *** Joins: SimonSapin (simon@moz-58CD503D.fbx.proxad.net)
[08:55:16] <kemurphy> it seems that &'self mut [T] is lacking an implementation of BaseIter
[08:55:25] *** Quits: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl) (Ping timeout)
[08:55:49] <dbaupp> kemurphy: looks like it
[08:58:13] *** Joins: mib_f87sap (Mibbit@664D6B6F.8A98565E.4D3C4D72.IP)
[09:01:33] *** Quits: hmax (hmax@moz-15514FA1.yandex.net) (Connection timed out)
[09:01:48] *** Joins: hmax (hmax@moz-15514FA1.yandex.net)
[09:03:37] *** Quits: flipcoder (flipcoder@moz-EE3A28B2.dhcp.rvsd.ca.charter.com) (Quit: Leaving)
[09:05:06] *** Joins: lucian (lucian@moz-D82F7974.zone16.bethere.co.uk)
[09:05:06] *** Quits: btipling (btipling@moz-5413CFA4.hsd1.ca.comcast.net) (Quit: Computer has gone to sleep.)
[09:05:32] *** Joins: lucian_ (lucian@6B2B4644.4304AE1E.CE5E78F6.IP)
[09:07:00] *** Quits: lucian (lucian@moz-D82F7974.zone16.bethere.co.uk) (Ping timeout)
[09:09:56] *** Joins: KindOne (KindOne@moz-A7230136.dynamic.ip.windstream.net)
[09:10:26] *** Quits: mib_f87sap (Mibbit@664D6B6F.8A98565E.4D3C4D72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[09:14:45] *** Joins: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk)
[09:18:07] <nmatsakis> kemurphy: once the patch I'm working on lands, map will work
[09:18:23] <nmatsakis> kemurphy: as well as the existing iter
[09:18:29] <kemurphy> nmatsakis: ah, woo :)
[09:18:36] <kemurphy> nmatsakis: but for now, http://pastebin.mozilla.org/2349122 :P
[09:18:41] <nmatsakis> kemurphy: they ... should work today? hard to say, existing check is buggy.
[09:19:05] <nmatsakis> kemurphy: yes, that works.
[09:19:15] *** Quits: KindOne (KindOne@moz-A7230136.dynamic.ip.windstream.net) (Connection reset by peer)
[09:19:30] *** Joins: bheylin (bheylin@moz-3D24C757.static.chello.nl)
[09:19:54] <kemurphy> nmatsakis: map on the mutable vec didn't work for me, it errors out with "immutable alias to mutable data" or somesuch
[09:19:59] <nmatsakis> kemurphy: testing patch now... so I hope to have it landed this week.
[09:20:06] <nmatsakis> yes, that error message is incorrect.
[09:20:14] <kemurphy> nmatsakis: oh, also this is 0.6, not git
[09:20:23] <nmatsakis> ah, it may work somewhat better in git? not sure.
[09:20:27] <nmatsakis> I don't think so though
[09:20:30] <kemurphy> ah okay
[09:20:33] *** Joins: KindOne (KindOne@moz-A7230136.dynamic.ip.windstream.net)
[09:20:39] <kemurphy> well either way, good to know there's a patch incoming :)
[09:20:41] <nmatsakis> kemurphy: nah I think you'd get the same error
[09:21:08] <nmatsakis> kemurphy: basically the whole idea of having &mut be the *only mutable pointer* to the data it points at is that you should be able to "freeze" it as you like
[09:21:27] <nmatsakis> kemurphy: iteration is a kind of freezing, since taking pointers into the vector while you are mutating it would be unsafe
[09:22:11] <kemurphy> right, yeah idk, would const apply here?
[09:22:12] <nmatsakis> anyway, the current code is kind of half-way between the older system and the newer system, so it sometimes reports errors when it shouldn't
[09:22:21] <kemurphy> ah i see
[09:23:07] <kemurphy> oh, welp, that workaround just made all my tasks get killed
[09:23:12] <kemurphy> m(
[09:23:17] *** kimundi is now known as zz_kimundi
[09:27:15] *** Joins: libertas (libertas@23139B67.8ECC0B56.593B3862.IP)
[09:27:42] <cmr> Is https://github.com/cmr/rust/commit/b085b51357769acb68f6ba10d30df5a98e04c418 a good idea?
[09:28:40] <nmatsakis> kemurphy: ? what error
[09:29:21] <kemurphy> "killed" it says
[09:29:30] <kemurphy> no other useful info
[09:29:49] <kemurphy> (that computation is happening in the worker threads of a large thread pool)
[09:32:26] <kemurphy> nmatsakis: oh, hm, my tasks are still being killed when i took it back out, so i must've accidentally changed something else
[09:35:11] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[09:36:12] <bjz> nmatsakis: what is this? https://github.com/mozilla/rust/blob/master/src/libcore/num/f32.rs#L640
[09:36:40] <kemurphy> nmatsakis: oh, i missed a line in the error output: max called on empty iterator
[09:36:49] <bjz> nmatsakis: is it vestigual legacy cruft?
[09:36:59] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[09:38:01] <bjz> nmatsakis: some files seem to have it, others don't
[09:38:12] *** Joins: novabyte (Adium@moz-95B1B3A2.hari.cable.virginmedia.com)
[09:38:27] *** Quits: novabyte (Adium@moz-95B1B3A2.hari.cable.virginmedia.com) (Quit: Leaving.)
[09:38:50] <cmr> Those look like emacs variables
[09:39:37] <bjz> cmr: what's it doing in code? we don't all use emacs
[09:39:46] <cmr> bjz: beats me
[09:39:52] <bjz> :S
[09:40:46] <nmatsakis> bjz: yes
[09:40:47] * bjz 's delete finger twitches impatiently
[09:40:55] <nmatsakis> bjz: basically vestigial
[09:41:00] <bjz> delete?
[09:41:04] <nmatsakis> bjz: at some point all the files had it, but we removed it from most of them
[09:41:13] <nmatsakis> yes, delete if you like.
[09:41:45] <bjz> do you think it'd pollute my commit to much to delete them all?
[09:41:58] <bjz> or just do the num ones?
[09:42:06] <bjz> (I mean my pull req)
[09:44:45] *** zz_kimundi is now known as kimundi
[09:45:38] <bjz> nmatsakis: I found 82 files with them :P
[09:52:52] <cyndis> when i spawn a task with task::spawn and the parent task dies, shouldn't the child task too die?
[09:54:13] <nmatsakis> bjz: I'd put that in a distinct pull req
[09:54:14] <nmatsakis> :)
[09:54:29] <bjz>  nmatsakis: sure
[09:55:05] <cyndis> i have a task looping stdin().read_line() and i think it's stopping my application from ever quitting
[09:55:06] <nmatsakis> bjz: I think the only person who might care if they are there or not is graydon, but he didn't object too hard when I removed the others ;)
[09:55:14] *** Joins: echristo (echristo@D0D26911.648B0C34.5EFB9497.IP)
[09:55:20] <nmatsakis> cyndis: it depends on how you spawn the tasks I think?
[09:55:33] <nmatsakis> cyndis: also, using stdin::read_line probably blocks the task, I think that still uses the ANSI C primitives
[09:55:39] <cyndis> ah, ok
[09:55:41] <nmatsakis> cyndis: which are not well-integrated into our scheduler
[09:55:42] <nmatsakis> (ongoing work)
[09:55:54] <cyndis> i thought the current IO was already using the scheduler :)
[09:56:03] <cyndis> or libuv or whatever
[09:56:09] <nmatsakis> I think not, but I'm not 100% sure
[09:56:18] *** Joins: RagingDave (RagingDave@moz-2754F937.pools.arcor-ip.net)
[09:56:26] <nmatsakis> stdin appears to just be a FILE*
[09:57:35] <nmatsakis> cyndis: ^
[09:57:37] <cyndis> yes, then this behaviour is understandable.. though it means that there's pretty much nothing i can do at the moment
[09:58:19] <nmatsakis> cmr: regarding that import suggestion, I didn't quite understand what error it was attempting to fix
[09:58:52] <nmatsakis> cmr: but given how many problems "use f::*" can cause with the current algorithm, and the fact that many people frown on its use, I doubt we'd want to be suggesting it to people
[10:01:11] <dbaupp> nmatsakis: I'm meeting those problems now... is there a known workaround?
[10:07:34] *** Quits: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu) (Client exited)
[10:09:04] *** Quits: pyrac (pyrac@A9EC89DE.73C89388.AD05C589.IP) (Quit: pyrac)
[10:09:45] *** Joins: jdm (jdm@941349F4.F58C7D4D.F945DA.IP)
[10:14:52] *** Quits: guitsaru (guitsaru@moz-35937D86.hsd1.ca.comcast.net) (Client exited)
[10:15:41] *** Joins: synapsos (Mibbit@640C6C8D.C434660A.DAB1EB3B.IP)
[10:16:02] *** kimundi is now known as zz_kimundi
[10:19:19] <nmatsakis> dbaupp: for what, sorry?
[10:19:31] <nmatsakis> dbaupp: the error messages related to &mut?
[10:21:23] <dbaupp> nmatsakis: the `use foo::*` stuff
[10:22:50] *** Joins: judder (maradukewa@DABDEEA3.F2C0D0AC.78E362FE.IP)
[10:24:39] <dbaupp> nmatsakis: https://gist.github.com/huonw/8073458d524e9889f83f
[10:25:09] *** zz_kimundi is now known as kimundi
[10:26:13] <dbaupp> it only works when given an explicit list instead of the *, and even then that is not properly pub'd... other crates can't see it.
[10:29:23] <aatch> dbaupp, I found that a lot in xcb
[10:29:53] <aatch> I wanted to emulate the original C and pub use the core protocol up a level
[10:30:19] <aatch> but I couldn't figure out a way that didn't involve adding several layers.
[10:30:30] <aatch> Which defeats the point somewhat...
[10:33:51] <aatch> Also, I found an odd syntax artifact in Ruby just now.
[10:34:06] <aatch> 1 ++++ 1 == 2
[10:34:19] <aatch> You can chain as many of the `+` together
[10:34:23] <aatch> as you want
[10:34:36] <dbaupp> It parses as 1 + (+ (+ (+1))) does it?
[10:34:46] <aatch> dbaupp, no idea
[10:34:57] <aatch> I just thought it was interesting
[10:35:08] <aatch> I tried to do `a++`
[10:35:14] <aatch> which doesn't exist
[10:35:31] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[10:35:31] <dbaupp> it's good(maybe?) that i'm not the only one with the use problem...
[10:36:31] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[10:36:43] <aatch> It seemed to me that it has issues with trying to resolve when two modules needed stuff from each other.
[10:37:12] <aatch> But only if one was "beneath" the other, and the child was defined in the parent
[10:37:17] <dbaupp> Well, that's what I've got here
[10:37:20] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[10:37:24] <dbaupp> so drat! :(
[10:37:35] <dbaupp> is there a bug for it?
[10:37:46] <aatch> if I moved the mod declarations up to the .rc file
[10:37:52] <aatch> dbaupp, I don't think so
[10:37:53] *** Joins: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu)
[10:42:06] <dbaupp> aatch: do you have a small test case?
[10:42:13] <aatch> dbaupp, just made one
[10:42:24] <aatch> I'll file the issue with it.
[10:42:32] <aatch> I'll just make sure it properly replicates it
[10:42:38] <aatch> Since it's only one file.
[10:43:17] *** Quits: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu) (Ping timeout)
[10:43:18] *** Joins: mibitzi (mibitzi@87CAE982.60DF3A09.8395810B.IP)
[10:47:08] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[10:50:28] *** Quits: KindOne (KindOne@moz-A7230136.dynamic.ip.windstream.net) (Quit: Wooo... More Windows Updates..)
[10:52:03] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[10:52:35] <aatch> dbaupp, hmm, seems like it's harder to replicate than I thought...
[10:53:45] *** Quits: Blub\w (wry@moz-E1F9A469.wireless.dyn.drei.com) (Quit: bbl)
[10:57:31] <dbaupp> aatch: :( I can't help, I only get it in core
[10:57:53] <aatch> I think I got it.
[10:58:35] <aatch> Nope.
[10:58:37] <aatch> Dammit.
[10:58:40] <dbaupp> :(
[10:59:16] <aatch> I keep thinking I have, then realizing that I missed a pub off something somewhere
[11:06:27] *** Joins: pyrac (pyrac@A9EC89DE.73C89388.AD05C589.IP)
[11:06:51] <aatch> Ok, I can't replicate it sorry.
[11:07:16] <aatch> It's likely require more moving parts than I thought.
[11:09:24] <cmr> nmatsakis: hi
[11:09:25] <dbaupp> aatch: hard bugs suck :(
[11:09:57] <cmr> nmatsakis: I had "use one;" in some code and it took me a while to figure out why it wasn't valid, and the error "unresolved import" meant nothing to me.
[11:10:26] *** Joins: vosen (vosen@moz-266BA656.icpnet.pl)
[11:10:47] <nmatsakis> cmr: certainly I agree that the error message could be improved...
[11:10:57] <aatch> I know that it would be nice if the compiler mentioned that it found a module with the right name, but it wasn't marked as "pub"
[11:11:35] *** Joins: jfredett (jfredett@moz-EDD670C9.mycingular.net)
[11:12:44] <cmr> Would suggesting foo::{...} be better?
[11:15:49] *** Quits: vosen (vosen@moz-266BA656.icpnet.pl) (Connection reset by peer)
[11:16:09] *** Joins: vosen (vosen@moz-266BA656.icpnet.pl)
[11:18:11] *** kimundi is now known as zz_kimundi
[11:20:55] *** jdm is now known as jdm|f00d
[11:26:32] *** Quits: heftig (heftig@moz-CDEAF13B.dip0.t-ipconnect.de) (Ping timeout)
[11:30:15] *** Quits: jfredett (jfredett@moz-EDD670C9.mycingular.net) (Ping timeout)
[11:30:38] *** zz_kimundi is now known as kimundi
[11:31:38] *** Joins: jfredett (jfredett@moz-EDD670C9.mycingular.net)
[11:32:31] *** Joins: heftig (heftig@moz-A6583D5B.dip0.t-ipconnect.de)
[11:34:03] *** Quits: mibitzi (mibitzi@87CAE982.60DF3A09.8395810B.IP) (Ping timeout)
[11:36:30] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[11:36:57] *** Joins: pnkfelix (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net)
[11:42:49] *** Quits: jfredett (jfredett@moz-EDD670C9.mycingular.net) (Ping timeout)
[11:43:26] *** Joins: jfredett (jfredett@moz-EDD670C9.mycingular.net)
[11:46:06] *** Joins: EXetoC (ex@moz-2DBEB1E4.customer.t3.se)
[11:49:23] *** Quits: libertas (libertas@23139B67.8ECC0B56.593B3862.IP) (Ping timeout)
[11:49:29] *** Joins: pnkfelix|rcirc (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net)
[11:50:45] *** Quits: jfredett (jfredett@moz-EDD670C9.mycingular.net) (Ping timeout)
[11:51:15] *** Quits: bheylin (bheylin@moz-3D24C757.static.chello.nl) (Connection reset by peer)
[11:53:15] *** Joins: bheylin (bheylin@moz-3D24C757.static.chello.nl)
[11:53:46] *** Joins: libertas (libertas@3CBD0449.418C4A1B.593B3862.IP)
[11:59:58] *** Joins: jfredett (jfredett@moz-EDD670C9.mycingular.net)
[12:03:54] *** Quits: jfredett (jfredett@moz-EDD670C9.mycingular.net) (Ping timeout)
[12:05:31] *** Quits: pnkfelix (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net) (Quit: Leaving.)
[12:07:11] *** Quits: pnkfelix|rcirc (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net) (Ping timeout)
[12:08:10] *** Joins: pnkfelix (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net)
[12:10:02] <pnkfelix> hmm. what's up with bors.
[12:15:14] *** Quits: spider-mario (spidermari@moz-EE4B8A09.rev.sfr.net) (Input/output error)
[12:16:30] *** Joins: mibitzi (mibitzi@87CAE982.60DF3A09.8395810B.IP)
[12:20:24] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[12:20:39] *** Joins: engla (engla@moz-E4A8CEF5.customer.cdi.no)
[12:21:05] *** Joins: igl1 (igl@moz-7D93B4FA.adsl.alicedsl.de)
[12:21:15] *** Quits: igl (igl@moz-85648950.adsl.alicedsl.de) (Ping timeout)
[12:26:30] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Quit: Computer has gone to sleep.)
[12:26:42] <kimundi> pnkfelix: The buildbots are probably borked again
[12:26:52] <kimundi> Or something
[12:27:00] <pnkfelix> wish I knew what to do about that.  :)
[12:27:28] <kimundi> something something manual restart of buildbot build
[12:30:23] *** Joins: jfredett (jfredett@moz-35CE0253.bstnma.east.verizon.net)
[12:30:24] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[12:31:39] *** jdm|f00d is now known as jdm
[12:34:09] *** bhearsum|afk is now known as bhearsum
[12:36:33] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[12:42:13] *** Quits: judder (maradukewa@DABDEEA3.F2C0D0AC.78E362FE.IP) (Client exited)
[12:42:16] *** Joins: judder (maradukewa@DABDEEA3.F2C0D0AC.78E362FE.IP)
[12:43:13] *** Quits: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP) (Connection reset by peer)
[12:57:53] *** Quits: _Vi (vi@527C345F.497AA854.B16B3BE6.IP) (Ping timeout)
[13:01:18] *** Quits: pcdummy (quassel@moz-CF4CA865.page4me.ch) (Ping timeout)
[13:01:45] *** Joins: pcdummy (quassel@moz-CF4CA865.page4me.ch)
[13:05:38] *** Quits: judder (maradukewa@DABDEEA3.F2C0D0AC.78E362FE.IP) (Ping timeout)
[13:07:24] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[13:23:48] <pnkfelix> pauls: ping
[13:27:23] <bstrie> pnkfelix: pang
[13:27:50] <pnkfelix> ?  DenotationOf(bstrie) == DenotationOf(pauls) ?
[13:28:13] <bstrie> pnkfelix: I take it you've never been privvy to a game of ping-pang-pong before
[13:28:20] <pnkfelix> nope
[13:28:36] *** Joins: Axord (xord@moz-C3CCF156.lsanca.dsl-w.verizon.net)
[13:28:53] *** Joins: _Vi (vi@527C345F.497AA854.B16B3BE6.IP)
[13:29:14] <bstrie> pnkfelix: it's essentially ping-pong, except halfway through the first serve some asshole just comes up with a paddle and smacks the ball across the room
[13:29:50] <bstrie> and then runs away giggling madly
[13:29:55] *** Quits: bstrie (ben@moz-D5A1D0F5.members.linode.com) (Quit: hehehehehehe)
[13:30:04] <cmr> lol
[13:33:04] *** Joins: not_bstrie (ben@moz-D5A1D0F5.members.linode.com)
[13:33:38] *** Joins: bent (chatzilla@F2D29657.F60B0462.67AC9B1.IP)
[13:34:14] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[13:36:34] *** Quits: Benvie (brandon@4EAF34EF.DD136097.D01D599A.IP) (Ping timeout)
[13:38:24] *** Joins: Benvie (brandon@4EAF34EF.DD136097.D01D599A.IP)
[13:38:57] *** Quits: pyrac (pyrac@A9EC89DE.73C89388.AD05C589.IP) (Ping timeout)
[13:48:12] *** Joins: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP)
[13:50:05] *** Quits: engla (engla@moz-E4A8CEF5.customer.cdi.no) (Ping timeout)
[13:54:01] *** Quits: DasIch (dasich@moz-756B08B1.clients.your-server.de) (Client exited)
[13:54:58] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[13:57:06] *** Joins: DasIch (dasich@moz-756B08B1.clients.your-server.de)
[13:57:29] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[14:04:19] <dbaupp> Is there anyone here with this problem? https://github.com/mozilla/rust/issues/6061
[14:05:18] <dbaupp> (I've got a possible fix... avoiding the calls into the rt... but I can't reproduce the original problem so I can't tell.)
[14:06:00] <dbaupp> I appreciate someone who could test for me...
[14:09:13] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[14:10:09] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[14:10:45] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[14:11:54] <not_bstrie> dbaupp: pnkfelix probably does, as he is the bug filer
[14:13:03] <pnkfelix> dbaupp: if you push your fix somewhere or otherwise send me a patch, I can look at it.
[14:13:45] <dbaupp> pnkfelix: https://github.com/mozilla/rust/pull/6073
[14:14:51] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[14:14:52] <dbaupp> It's the last commit, the first two are currently a separate pull request but are required for the tests to pass.
[14:16:02] <pnkfelix> dbaupp: so you're fixing the problem by replacing the C implementation with a Rust one?
[14:16:19] <pnkfelix> dbaupp: or no, sorry
[14:16:49] <dbaupp> pnkfelix: well, I started doing it a while ago because the C one was spending too much time doing stack changes
[14:17:05] <dbaupp> and it might have the happy consequence of fixing what I broke :)
[14:17:26] <strcat> dbaupp: but what if you turn off the stack switching with fast_ffi?
[14:18:09] <dbaupp> strcat: is that safe?
[14:18:24] <strcat> dbaupp: yes, as safe as a stack switch is ;p
[14:18:26] <pnkfelix> dbaupp: I'm probably going to first look at brson's suggestions that he posted to 6061
[14:18:52] <pauls> pnkfelix: pong
[14:19:15] <pnkfelix> pauls: I was pinging you to ask if the macro system had a way of expressing `?`, aka Maybe
[14:19:57] <pauls> pnkfelix: I don't understand... `Maybe` the type? `?` the ternary operator?
[14:20:05] <dbaupp> pnkfelix: ok
[14:20:11] <pnkfelix> pauls: Look here: https://github.com/brson/rust/commit/fe13b865192028645b50c17d2cb1a6d44481f338#commitcomment-3095021
[14:20:24] <pnkfelix> as in the regexp operator
[14:20:57] *** Joins: judder (maradukewa@DABDEEA3.F2C0D0AC.78E362FE.IP)
[14:21:00] *** Parts: judder (maradukewa@DABDEEA3.F2C0D0AC.78E362FE.IP) ()
[14:21:19] *** Joins: judder (maradukewa@DABDEEA3.F2C0D0AC.78E362FE.IP)
[14:21:22] *** Parts: judder (maradukewa@DABDEEA3.F2C0D0AC.78E362FE.IP) ()
[14:21:22] <pnkfelix> specifically this pseudo macro_rules pattern: $access:keyword(pub)?
[14:21:33] <pauls> pnkfelix: Ahhh.
[14:22:07] <pauls> Well, people have been using `$( $access:keyword )*` as a workaround.
[14:22:21] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[14:22:22] <pauls> However, it's somewhat confusing and accepts too much.
[14:22:27] <pnkfelix> i was just about to ask that
[14:22:49] <pauls> The "approved" way is to write two different clauses, one with the thing and one without it.
[14:23:04] <pnkfelix> accepts too much both in that it allows too many elements, and it also has a larger domain than just ("pub"|)
[14:23:25] <pnkfelix> yeah that was in the code snippet I wrote immediately above the one with $access
[14:23:48] <pnkfelix> but I figured I would note that this macro does not need to be that complicated if we extended the macro system accordingly
[14:24:07] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[14:24:39] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[14:25:33] <pauls> So, on the transcription side, your example is (from the point of view of Macro By Example) nonsensical, because it's asking it to transcribe a `keyword` that was matched zero times...
[14:25:49] *** Joins: lmandel (lmandel@F2D29657.F60B0462.67AC9B1.IP)
[14:25:58] <pnkfelix> in wouldn't be nonsensical in Scheme
[14:26:03] <pnkfelix> sed -e s/in/it/
[14:26:11] <pnkfelix> but I know what you are saying
[14:27:08] <pnkfelix> (I.e. how is transcribing a zero-matched "(keyword)?" any more nonsensical than transcribing a zero-matched "(keyword)*", right?)
[14:27:12] <pauls> I feel like the most natural solution is to have `access_kwd` as a new nonterminal, and have it accept `pub` and `` as possible values.
[14:27:35] *** Quits: webber46 (webber46@moz-AC14FDEA.se) (Quit: webber46)
[14:27:54] <pnkfelix> mm.  We have other contexts where syntax is optional
[14:28:05] <pnkfelix> e.g. type annotations are optional in some contexts
[14:28:07] <pauls> It probably could work with the parser as-is. If not, it'd be easy to write a `parse_access` that does the Right Thing (lookahead a token to see whether to parse it).
[14:28:31] <pnkfelix> and it might be nice to be able to write macros that properly carried through such annotations, if present, but didn't require that they be present)
[14:28:43] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[14:29:23] <pnkfelix> so the existence of another "optional syntax" scenario is a hint that this is potentially a more general problem than something to add a one-off nonterminal
[14:29:45] <pnkfelix> but, maybe I am wrong, and we just need to add the right set of new nonterminals that can potentially be epsilon
[14:30:20] <pnkfelix> (i.e.: access_kwd, type_ascription,  any others?  I'll go skim John's antlr grammar)
[14:31:18] <pnkfelix> okay, so following rust-antlr, I see: 
[14:31:26] <dbaupp> strcat: I'm building with fast_ffi on the rand functions
[14:31:26] <pnkfelix> visibility_kwd
[14:31:34] <pnkfelix> mutability_kwd
[14:31:48] <pnkfelix> ret_ty
[14:31:56] <strcat> dbaupp: :), just wanted to record the gist of the conversation there
[14:32:21] <strcat> anyway probably good to have it as native code
[14:32:22] <dbaupp> strcat: yep, sure
[14:32:23] <pnkfelix> ugh field_trailer  (that might be overkill)
[14:32:26] <strcat> instead of C
[14:33:02] <pauls> Hm. Well, adding `$( ... )?` to the ranks of `*` and `+` would be pretty safe. It should be, like, a five-line change.
[14:33:27] <pnkfelix> but will it be nonsense w.r.t. transcription?
[14:33:57] <pnkfelix> or can we sanely handle occurrences of its pattern binding in the template?
[14:34:26] <pauls> pnkfelix: it should be fine; it's follow the MBE rules, but it won't allow more than one rep.
[14:34:50] <pauls> You'd need to transcribe it underneath a `?`, just like you matched it.
[14:35:01] <pnkfelix> ah, that's interesting
[14:35:03] <pauls> (actually, using `*` would also be legal)
[14:35:21] <pnkfelix> okay you are right, that is a sane component to this that I overlooked.
[14:35:42] <pauls> It's... intuitive to me. I'm not sure that means that it's intuitive.
[14:35:47] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[14:36:06] <pnkfelix> If we can require it to be `?`, that might be nice
[14:36:57] <pnkfelix> and I assume all the same MBE-inspired constraints would apply.  i.e. it would be an error to do:
[14:37:28] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[14:37:38] <pauls> (Not easily; checking that the numbers match up is all dynamic. But I don't mind that too much.)
[14:37:43] <pnkfelix> ( { foo $a:id?   $b:id? } => ( bar a b )?   )
[14:37:46] <pnkfelix> would be an error
[14:38:17] <pnkfelix> or maybe its a dynamic error only
[14:38:31] <pnkfelix> (dynamically detecting when the numbers dont match, that is)
[14:38:34] <pauls> pnkfelix: sadly, due to the dynamic nature of the checks, that's only an error if `a` and `b` occur different numbers of times.
[14:38:43] <pnkfelix> pauls: that's fine with me.
[14:39:15] <pnkfelix> pauls: analogous to how I guess ( { foo $a:id* $b:id* } =>  ( bar a b )* )  is handled.
[14:39:24] <pauls> (and I don't want to drop the `$(...)` around the thing being `?`ed; we need a grouper, and I like having `$` be the only character that's "special" to the macro system.
[14:39:27] <pauls> pnkfelix: yeah.
[14:39:58] <pnkfelix> okay.  I'm sure I'm getting some of the details wrong in my rough sketches.
[14:40:04] <pnkfelix> but I think we're on the same page, cool.
[14:40:26] <dbaupp> strcat: `real	0m4.396s` (fast_ffi) vs `real	0m0.796s` (rust)
[14:41:09] <strcat> dbaupp: it builds the runtime code with optimization, right? ;p
[14:41:10] <dbaupp> strcat: http://ix.io/5m6/diff is that correct?
[14:41:19] <strcat> dbaupp: yeah
[14:41:31] <dbaupp> strcat: does it do that by default?
[14:41:58] <dbaupp> (It's a plain ./configure)
[14:42:05] *** Quits: Benvie (brandon@4EAF34EF.DD136097.D01D599A.IP) (Ping timeout)
[14:42:08] <strcat> sec
[14:42:16] *** Joins: pnkfelix|rcirc (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net)
[14:42:25] *** Joins: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com)
[14:42:31] *** Joins: Benvie (brandon@4EAF34EF.DD136097.D01D599A.IP)
[14:43:16] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[14:44:09] <strcat> it doesn't look like we build the runtime or libuv with optimization...
[14:44:10] *** Joins: FrozenCow (FrozenCow@moz-9DF5D010.dynamic.upc.nl)
[14:44:23] *** Joins: MrFahrenheit (RageOfThou@moz-CF7139ED.dynamic.telemach.ba)
[14:44:50] <cmr> What is the slow ffi and how does it differ from the fast ffi?
[14:45:02] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[14:45:17] <strcat> slow ffi will go away eventually afaik - it keeps a separate C stack and does a stack switch to it
[14:45:29] <strcat> fast_ffi is very new
[14:45:43] <cmr> ah
[14:45:51] <dbaupp> strcat: configure has "--disable-optimize-cxx           don't build optimized C++ code"
[14:46:13] <dbaupp> shouldn't that imply that it normally does optimize?
[14:46:31] <strcat> dbaupp: I don't see -O2 anywhereah platform.mk adds -O2
[14:46:37] <strcat> ugh
[14:46:54] <strcat> platform.mk adds -O2 * ;p
[14:47:10] <strcat> anyway dunno why it's so much slower then
[14:47:43] <cmr> Is rust generating valid code? heh
[14:47:54] <cmr> Not doing anything is a good way to win in performance ;)
[14:49:09] <dbaupp> cmr: it's actually generating worse code than the c/++ compilers do (no matter how hard i hit it with the "unsafe" hammer)
[14:49:09] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[14:49:26] <dbaupp> it's just the ffi that's slowing the C version down
[14:50:13] <dbaupp> strcat: running under perf http://ix.io/5m7
[14:50:44] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[14:50:53] <dbaupp> (that's the fast_ffi version)
[14:51:05] <dbaupp> and the pure rust one http://ix.io/5m8
[14:51:05] *** Quits: MrFahrenheit (RageOfThou@moz-CF7139ED.dynamic.telemach.ba) (Ping timeout)
[14:51:10] <strcat> dbaupp: what about with RUST_MIN_STACK=5000000
[14:51:25] <strcat> looks like it's just thrashing on a stack segment
[14:51:41] <pnkfelix> pauls: is it expected that this does not work: macro_rules! show (($e:expr) =>   io::println(fmt!("%?", $e))  )
[14:51:59] <pnkfelix> pauls: (but if I wrap the right-hand-side of the rule with {  } then it does work) ?
[14:53:22] <dbaupp> strcat: real    0m1.528s and http://ix.io/5m9
[14:53:41] <dbaupp> so much better
[14:54:05] <strcat> segmented stacks can hurt a lot :(
[14:56:06] <pauls> pnkfelix: yes.
[14:56:24] <strcat> dbaupp: maybe the rust port is just slow from bounds checking
[14:56:37] <pauls> The RHS has to be a token tree; it needs to be parseable without even knowing what it is.
[14:57:16] <pauls> In fact, the `{...}` or `(...)` are dropped, so it you want to expand to a block, you'll need an extra set of curlies.
[14:57:35] <pnkfelix> pauls: so the opening `{` provides sufficient context for the parser to turn that input into a token tree ?
[14:57:43] <dbaupp> strcat: I tried unsafe code, manipulating pointers and so on, but it didn't seem to help
[14:58:27] <strcat> dbaupp: well I mean just trying unsafe array access
[14:58:39] <strcat> but it probably won't help ;p
[14:58:50] <strcat> it's the type of bounds checks it can remove (since there are fixed-size arrays)
[14:59:25] <pnkfelix> pauls: The tutorial-macros.md claims that the right-ahnd side must be enclosed by delimiters, but the current parser allows for non-delimited right-hand-sides in some cases.  that's why I got curious
[14:59:26] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[14:59:50] <dbaupp> strcat: unsafe array access?
[15:00:03] <dbaupp> are there functions for it
[15:00:06] <dbaupp> ?
[15:00:26] <strcat> dbaupp: unsafe_get method
[15:01:28] <pnkfelix> pauls: (or maybe the counter-examples, i.e. examples of non-delimited RHS, are all trivial, e.g. single tokens...)
[15:01:34] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[15:03:03] *** Quits: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net) (Ping timeout)
[15:03:49] *** Joins: MrFahrenheit (RageOfThou@moz-CF7139ED.dynamic.telemach.ba)
[15:04:01] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[15:04:11] *** Joins: spider-mario (spidermari@moz-EE4B8A09.rev.sfr.net)
[15:04:13] *** Joins: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl)
[15:04:36] <pnkfelix> pauls: Or maybe I'm just wrong.  :)
[15:04:45] <pnkfelix> (not reading the code carefully enough)
[15:05:13] <dbaupp> strcat: didn't seem to help :(
[15:05:29] <pauls> pnkfelix: I bet it's the single-token case (though I ought to have specifically disallowed it)
[15:05:48] <pauls> (...and thought I had)
[15:06:29] <pauls> (...it might be good to forbid everything but `()` as delimiter, to prevent people from thinking that `{}` means that you automatically get a block.
[15:06:31] <pnkfelix> pauls: You might have.  I really might have just made a mistake.
[15:06:31] <pauls> )
[15:06:45] <pnkfelix> pauls: In any case, the error message could certainly be improved.
[15:06:48] *** Joins: Erik (Erik@moz-252DBA2.hsd1.co.comcast.net)
[15:07:33] <pnkfelix> pauls: "error: No rules expected the token: ::" is inferior to "error: right hand side of rule must be surrounded by matching delimiters."
[15:07:52] <pauls> pnkfelix: yeah.
[15:07:58] *** Joins: btipling (btipling@moz-5413CFA4.hsd1.ca.comcast.net)
[15:08:11] <pnkfelix> pauls: but lots of rustc's error messages could be improved.  :)
[15:10:35] <cmr> all of them, actually ;)
[15:11:17] *** Quits: victorporof (victorporo@966EF3BE.B89616B1.79933D60.IP) (Ping timeout)
[15:13:19] *** Joins: mye (mye@moz-E24F21AC.vpn.ipredator.se)
[15:13:22] <kimundi> pauls: Is it legal to invoke a macro wit {} ?
[15:13:24] *** Quits: mye (mye@moz-E24F21AC.vpn.ipredator.se) (Quit: mye)
[15:13:41] <kimundi> hm.. 
[15:13:48] <pauls> kimundi: I believe not.
[15:13:48] <kimundi> rusti: fail!{}
[15:13:49] <rusti> foo.rs:5:14: 5:15 error: expected ident, found `{`
[15:13:49] <rusti> foo.rs:5          fail!{}
[15:13:49] <rusti>                        ^
[15:13:54] <pauls> It went back and forth a few times.
[15:13:54] *** Joins: webber46 (webber46@moz-F6310FF0.lha.sgsnet.se)
[15:13:56] *** Quits: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl) (Ping timeout)
[15:14:41] <kimundi> pauls: So, {} is only allowed as part of the definition? Then it really should go I think :)
[15:14:54] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[15:17:21] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[15:17:42] *** Joins: wilmoore (wilmoore@moz-1248C037.mystrotv.com)
[15:19:27] <pauls> kimundi: yeah. 
[15:20:04] <not_bstrie> I think it should be possible to use either () or {} in the definition, but then it should require the same characters at the use site :)
[15:20:19] <not_bstrie> control flow with () is icky
[15:21:44] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[15:22:05] *** not_bstrie is now known as bstrie
[15:22:43] <pauls> bstrie: well, that just about covers all the options, doesn't it?
[15:23:27] *** bstrie is now known as maybe_bstrie
[15:23:34] <maybe_bstrie> pauls: I'd like to introduce you to the option type :)
[15:23:53] <pauls> maybe_bstrie: possibly hello
[15:25:25] *** Quits: hmax (hmax@moz-15514FA1.yandex.net) (Quit: ????? ? ?? ??? (xchat 2.4.5 ??? ??????))
[15:25:26] <maybe_bstrie> pauls: be glad that I didn't choose null_bstrie, or you'd have crashed the channel via that salutation
[15:25:46] <pauls> maybe_bstrie: you'd have been kicked by the typechecker.
[15:25:56] <maybe_bstrie> haha
[15:26:12] <maybe_bstrie> er, I mean, that might have been funny
[15:26:42] <pauls> Someday, maybe_bstrie will emerge from the monad.
[15:27:23] *** maybe_bstrie is now known as just_bstrie
[15:27:27] <just_bstrie> like a beautiful butterfly
[15:27:52] <just_bstrie> tbh, "Just foo" always reads like a disappointment
[15:28:02] <just_bstrie> like, "ooh what's in here? oh... it's just foo."
[15:28:14] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[15:28:28] <pauls> Your nick went from being a type to being a value. What sort of exotic IRC channel do you think you're in?
[15:29:06] <just_bstrie> I bet somewhere out there, there exists a language without a distinction between types and values
[15:29:14] <kimundi> pauls: Well at first it was an operator, so...
[15:29:30] *** Quits: Erik (Erik@moz-252DBA2.hsd1.co.comcast.net) (Ping timeout)
[15:29:56] <dbaupp> just_bstrie: dependently typed languages?
[15:30:10] <just_bstrie> is that what those are?
[15:30:31] <kimundi> just_bstrie: concatenative languages would fit the bill too, I think. Just functions.
[15:30:31] <pauls> Sort of, if I remember correctly.
[15:31:09] <pauls> In dependently-typed languages, types may depend on expressions, so you wind up with very specific, very informative types.
[15:31:10] <pnkfelix> just_bstrie: Pure Type Systems would also fit the bill.  http://en.wikipedia.org/wiki/Pure_type_system
[15:31:23] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[15:31:41] <pnkfelix> just_bstrie: (or rather, the ones that collapse the term/type distinction would fit the bill)
[15:33:39] <just_bstrie> ooh, "lambda cubes"
[15:34:36] <nmatsakis> pnkfelix: what about Rust :)
[15:34:47] *** Joins: victorporof (victorporo@60366CE7.67CDC207.79933D60.IP)
[15:35:02] <just_bstrie> I hope someday we manage to generalize lambda cubes to N-dimensions
[15:35:04] <pnkfelix> nmatsakis: I spent yesterday doing bug triage and looking at a build failure.
[15:35:34] <strcat> nmatsakis: is fixing write barriers on @mut part of your new borrow checker?
[15:35:41] <strcat> or is that a separate issue
[15:36:08] <pnkfelix> nmatsakis: namely this one: https://github.com/mozilla/rust/issues/6061
[15:36:26] <nmatsakis> strcat: yes and no, I figured I'd do that as a separate step---
[15:36:31] <nmatsakis> strcat: ---but I did some prelininary work on it
[15:36:38] <pnkfelix> nmatsakis: I've spent today acquainting myself with the conditions module
[15:36:40] <nmatsakis> strcat: also the new borrow checker gives static errors when it can see them
[15:36:51] <nmatsakis> strcat: so I found a bunch of code that would have been dynamic errors if they were working correctly :)
[15:37:43] <nmatsakis> pnkfelix: interesting (the build failure)
[15:38:13] <pnkfelix> nmatsakis: yeah, I keep meaning to look more at it
[15:41:50] <kimundi> nmatsakis: So it's dynamic failure just in cases where it's not statically known to fail? nice.
[15:41:53] <kimundi> ,
[15:42:18] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[15:42:31] <nmatsakis> kimundi: yes
[15:42:48] * strcat still thinks it's very easy to hit that dynamic failure
[15:42:50] <strcat> via clone
[15:43:09] <strcat> although you don't need to use any @mut...
[15:43:27] <nmatsakis> strcat: I am not sure what scenario you are referring to
[15:43:39] <strcat> nmatsakis: x = @mut 5; let y = x.clone()
[15:43:45] <strcat> somewhere later, x is borrowed
[15:43:53] <strcat> I'm sure the compiler does this a lot
[15:43:56] *** Joins: graham_king (graham_kin@moz-61791D81.vc.shawcable.net)
[15:44:21] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[15:44:40] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[15:45:07] <nmatsakis> strcat: borrowed as &T or as &mut T?
[15:45:19] <nmatsakis> strcat: and why do you think the compiler does this a lot?
[15:45:35] <nmatsakis> do we even call clone() that often?
[15:45:44] <strcat> nmatsakis: well it does it implicitly
[15:46:09] <nmatsakis> does what implicitly?
[15:46:13] <strcat> copies of @mut
[15:46:14] <nmatsakis> calls clone()?
[15:46:24] <strcat> well clone isn't needed to hit that
[15:46:30] <strcat> since it just does *self
[15:46:45] <nmatsakis> well, I guess we'll see
[15:46:46] <strcat> anyway maybe it's not nearly as big an issue as I imagine it to be ;p
[15:46:51] <nmatsakis> I hope not! :)
[15:46:53] <nmatsakis> I don't know.
[15:47:02] <nmatsakis> we'll know more when I get around to fixing that, might be interesting
[15:47:16] <nmatsakis> I really want to land new borrow ck rules right now, so focusing on that
[15:47:22] <nmatsakis> getting close, just patching up tests now
[15:47:37] <nmatsakis> just haven't had that much time to devote to it lately :/
[15:49:14] <strcat> hmm, I don't understand why removing the re-exports in core doesn't work
[15:49:16] <strcat> core.rc
[15:49:20] <strcat> since they're in prelude.rs too
[15:50:54] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Quit: Textual IRC Client: www.textualapp.com)
[15:52:17] *** Joins: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu)
[15:53:57] *** Quits: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu) (Client exited)
[15:56:14] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[15:56:54] *** Quits: echristo (echristo@D0D26911.648B0C34.5EFB9497.IP) (Quit: echristo)
[15:57:10] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[15:57:22] *** Joins: jclements (jclements@moz-8314C9B1.dsl.snlo01.pacbell.net)
[15:57:57] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[16:03:55] *** Quits: Benvie1 (Thunderbir@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: Benvie1)
[16:04:47] <pnkfelix> nmatsakis: would it really be a deal breaker to take pattern matching out of a fn parameters?  To me it doesn't seem ridiculous to say that the destructuring goes into the body of a function...
[16:05:09] <strcat> I use that all the time, at least in closures :(
[16:05:40] <nmatsakis> pnkfelix: it would definitely be a deal break to take them out of closures
[16:05:43] <pnkfelix> strcat: hmm, for closures,  yes I can see it being problematic there.
[16:05:48] <nmatsakis> pnkfelix: in named fns... maybe not
[16:06:00] <erickt> nmatsakis: good morning! Are you aware of any cases where `self` acts differently than just an argument named `self`? I'm starting to wonder if my life would be easier if I just made the trans instance method code act just like the static method code
[16:06:24] <nmatsakis> erickt: the whole goal is to make self exactly like any other argument
[16:06:43] <erickt> oh I know
[16:06:48] <nmatsakis> erickt: that said, the static method code is...generally super hacky.
[16:06:55] <nmatsakis> but maybe in this instance it might be something to emulate
[16:06:57] <nmatsakis> can't recall
[16:07:04] <erickt> okay :)
[16:07:17] <nmatsakis> (but hey, it works!)
[16:07:33] <erickt> I did get the method declaration and calling working, now I'm just hacking away at getting self to actually work inside a method
[16:07:38] *** Quits: synapsos (Mibbit@640C6C8D.C434660A.DAB1EB3B.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[16:07:49] <erickt> but there are a lot of moving widgets
[16:08:09] <nmatsakis> erickt: yes, I think we want self to act as much like "any other argument" as we can, and I mean both within trans and within the generated code
[16:08:46] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[16:08:48] *** Quits: fabiand (fabiand@moz-4563135B.adsl.alicedsl.de) (Quit: Verlassend)
[16:08:50] <nmatsakis> my feeling is that in general trans treats methods and impls as if they are special and different things, and they are really not, and it leads to tons of bugs
[16:09:20] <erickt> yeah I'm seeing that :)
[16:09:21] <nmatsakis> it's all basically just another way to invoke fns (except for objects, those are a bit Special and Different, what with the vtables and all)
[16:09:58] <erickt> and default methods
[16:10:11] *** Joins: engla (engla@moz-E4A8CEF5.customer.cdi.no)
[16:10:41] <erickt> I haven't quite figured out why some trans fns take a `Some(self)` for default methods, but for regular methods it's supposed to be `None`
[16:10:51] <strcat> git grep -l 'use core::prelude'
[16:10:58] * strcat sighs
[16:11:17] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[16:11:23] *** Joins: Benvie1 (Thunderbir@moz-BE33DA21.fw1.sfo1.mozilla.net)
[16:11:36] <nmatsakis> erickt: default methods are not special
[16:11:41] <nmatsakis> from my point of view
[16:12:01] <nmatsakis> erickt: that's just a monomorhized function, where the type parameter Self has a special assignment...
[16:12:43] <nmatsakis> erickt: anyway I think over time we will be able to get things to the point where trans doesn't care about any of those things except at the point where it picks the source AST and monomorphization parameters
[16:13:17] *** kimundi is now known as zz_kimundi
[16:13:45] <nmatsakis> erickt: I'm not sure what's up with that Some(self) thing either, I think it's just an artifact of historical process
[16:13:49] <nmatsakis> that nobody has fully ironed out
[16:13:55] *** Joins: fabiand (fabiand@moz-4563135B.adsl.alicedsl.de)
[16:13:58] <erickt> nmatsakis: I'm specifically talking about this comment about default methods: https://github.com/mozilla/rust/blob/master/src/librustc/middle/trans/common.rs#L305
[16:14:08] *** Joins: blitter (blitter@moz-48397EA8.dyn.centurytel.net)
[16:15:33] <nmatsakis> erickt: so if that comment reads correctly, then it says that `llself` is Some(_) for *all* methods, no?
[16:15:51] <nmatsakis> (presumably all non-static methods)
[16:16:18] <nmatsakis> erickt: but I kind of think that field should go away
[16:16:26] <nmatsakis> erickt: and instead the self value would be found in `llargs`
[16:16:59] <nmatsakis> erickt: I say this not having looked at how it's used in quite some time, of course
[16:18:00] *** Joins: jviereck (Adium@moz-96F3A391.dclient.hispeed.ch)
[16:18:05] <nmatsakis> erickt: though in an odd coincidence, the test failure I am looking at is leading me right to that point
[16:19:41] <erickt> nmatsakis: I've tried to get rid of it a couple times :)
[16:19:58] <erickt> I'm getting closer though
[16:20:30] <erickt> now it's the special self_def that I haven't figured out how to get rid of it yet
[16:20:48] <nmatsakis> erickt: why do you have to?
[16:21:02] <nmatsakis> erickt: the def_self() has an id that is basically like an argument, I think
[16:21:15] <nmatsakis> I mean it might be fine to get rid of it, but maybe it serves some role elsewhere, can't recall
[16:21:20] *** Quits: _Vi (vi@527C345F.497AA854.B16B3BE6.IP) (Ping timeout)
[16:22:02] <erickt> I thought I saw some code that used def_self and llself
[16:22:12] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[16:22:14] <erickt> I think I can get rid of it though
[16:23:39] *** Quits: dbaupp (Thunderbir@moz-53CF57B9.lns20.syd6.internode.on.net) (Ping timeout)
[16:25:47] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[16:26:09] *** Joins: FluffySauce (textual@moz-E5BC5F6F.sea.popcap.com)
[16:27:32] <nmatsakis> erickt: ok. I just mean that def_self is kind of harmless, ideally it could be treated just like def_arg 99% of the time
[16:27:40] <nmatsakis> erickt: of course, if it is 100%, it'd be great to remove it altogether
[16:28:14] <nmatsakis> does anyone know if pcwalton landed his mode removal?
[16:28:28] <erickt> I wanted to ask that same question :)
[16:28:49] <erickt> If he did, he didn't change trans
[16:29:05] <nmatsakis> erickt: I think not.
[16:29:13] <nmatsakis> I don't see anything in the log.
[16:31:02] <erickt> nmatsakis: here's the trans code where def_self is being treated specially: https://github.com/mozilla/rust/blob/master/src/librustc/middle/trans/expr.rs#L1064
[16:33:11] <nmatsakis> erickt: yeah, I was just looking at that code
[16:33:32] <nmatsakis> erickt: I am of the opinion that...
[16:33:46] <nmatsakis> erickt: most likely it could work the same way as def_arg there, if we put the llself into the llargs table
[16:33:58] <erickt> part of what I'm doing is putting `self` in `bcx.fcx.llargs`. I'm not sure if I'm monomorphizing llself properly yet
[16:34:10] <erickt> oh great :)
[16:34:22] *** Joins: bnicholson (bnicholson@moz-BE33DA21.fw1.sfo1.mozilla.net)
[16:34:36] <nmatsakis> erickt: the key thing is that the Self type should act like the other type parameters
[16:34:44] <nmatsakis> erickt: I don't think this is entirely true in trans right now
[16:35:04] <nmatsakis> erickt: but basically any place that we assemble a list of type parameter values, we should also assemble a value for Self (if any)
[16:35:21] <nmatsakis> erickt: I think if we are consistent about this, it will all fall out. that's what I did when refactoring the front-end code and it cleaned up a lot of stuff.
[16:35:41] <nmatsakis> does that make sense?
[16:36:00] <erickt> I think so. is there a special variant for the Self type?
[16:36:17] <nmatsakis> ty_self
[16:36:18] <nmatsakis> erickt: ^
[16:36:24] <nmatsakis> is that what you mean?
[16:36:34] <erickt> ah ok
[16:36:37] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[16:37:16] <erickt> yeah I think that makes sense
[16:37:22] <nmatsakis> erickt: so I think the last test in my borrowck patch is default-method-simple, which is failing for some reason I cannot fathom in that code you just sent me :)
[16:37:32] <pnkfelix> nmatsakis: by the way, has anyone mentioned that bors and/or buildbot appears to be down?
[16:37:34] <nmatsakis> erickt: (though I have not changed it, nor anything related to it, near as I can tell :)
[16:37:40] *** zz_kimundi is now known as kimundi
[16:37:41] <erickt> I hope pcwalton's patch lands soon. This code should make a little more sense when there aren't modes to consider
[16:37:45] <nmatsakis> pnkfelix: oh? I didn't know that, but I also don't know how to fix it
[16:37:50] <nmatsakis> erickt: yes, modes make everything more complex.
[16:38:03] * erickt shakes fist at modes
[16:38:28] *** Quits: engla (engla@moz-E4A8CEF5.customer.cdi.no) (Ping timeout)
[16:38:37] <nmatsakis> the other thing that causes me pain is the DoDerefArgs stuff, which should be recoded to use adjustments...
[16:38:45] <nmatsakis> oh well one thing at a time
[16:38:46] *** Joins: engla (engla@moz-E4A8CEF5.customer.cdi.no)
[16:38:47] <pnkfelix> nmatsakis: i noticed because tim r+'ed my backout to try to fix #6061 with p=50, and it never went through.  And now at this point huonw might have contributed a separate commit that might obsolete the need for the backout (not clear yet)
[16:39:36] <nmatsakis> pnkfelix: ok. so far as I know, bors is just running on graydon's desktop
[16:39:41] <nmatsakis> so not much we can do about it till he shows up
[16:39:49] <pnkfelix> nmatsakis: ha ha, I did not realize that
[16:40:15] <pnkfelix> nmatsakis: was assuming somehow that there was some crazy infrastructure behind it to match its amazingness
[16:40:16] *** Joins: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[16:40:17] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[16:41:40] <nmatsakis> pnkfelix: it must peg his cpu at 100% all the time :)
[16:41:45] <nmatsakis> (presumably he has other desktops)
[16:42:22] <strcat> nmatsakis: it can be fixed by forcing a build
[16:42:24] <strcat> it's buildbot's fault
[16:43:06] <strcat> or somehow getting bors to wake up... force pushing 0 commits to incoming?
[16:43:13] * strcat shrugs
[16:43:51] *** Joins: steven_is_false (quassel@moz-8A083175.bchsia.telus.net)
[16:44:31] <steven_is_false> Hi, how can one convert from &[T, ..N] to &[T]?
[16:46:04] <kimundi> steven_is_false: deref and borrow as slice
[16:46:45] <steven_is_false> rusti: (*&[0, ..4]).slice (0, 4)
[16:46:47] <rusti> more than 5 lines of output, pastebinned: http://sprunge.us/gcUX
[16:47:10] <steven_is_false> rusti: let x = [0, ..4]; x.slice (0, 4)
[16:47:11] <rusti> more than 5 lines of output, pastebinned: http://sprunge.us/EcfJ
[16:48:03] <kimundi> the slice method doesn,t work atm i think
[16:48:15] *** Joins: mschifer (Adium@2557E599.66715431.D25A875A.IP)
[16:48:18] <steven_is_false> kimundi: Thanks. It's a shame one can't do it without copying the data.
[16:48:31] <erickt> stephank: I thought we can automatically coerce &[T,..N] to &[T]
[16:48:44] <stephank> absolutely
[16:49:13] <kimundi> steven_is_false: you can
[16:49:18] <strcat> you can coerce any vector to &[T]
[16:49:26] <strcat> don't need to be a borrowed ptr to it already
[16:49:31] <strcat> doesn't*
[16:49:34] *** Joins: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl)
[16:49:47] <steven_is_false> Doh! I need to use as! Coercion isn't automatic right!
[16:50:10] <erickt> rusti: let x: [int, 3] = [1,2,3]; let y: &[T, .. 3] = x; let z: &[T] = y;
[16:50:10] <kimundi> steven_is_false: just not wit that method
[16:50:10] <kimundi> wrong
[16:50:12] <rusti> foo.rs:5:20: 5:21 error: expected `]` but found `,`
[16:50:12] <rusti> foo.rs:5          let x: [int, 3] = [1,2,3]; let y: &[T, .. 3] = x; let z: &[T] = y;
[16:50:12] <rusti>                              ^
[16:50:39] <steven_is_false> Okay, how can I cooerce the value?
[16:50:52] <kimundi> no coerce
[16:51:02] *** Quits: lmandel (lmandel@F2D29657.F60B0462.67AC9B1.IP) (Ping timeout)
[16:51:07] <erickt> steven_is_false: theoretically like ^ if ^ compiled :)
[16:51:30] <kimundi> just a borrow of the fixed sized vector
[16:51:58] <steven_is_false> Okay, how can I reinterpret my pointer to my fixed size array, as a pointer to an unknown sized array?
[16:51:58] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[16:52:13] <kimundi> im on my phone, would have typed an example already:-( 
[16:52:19] <erickt> rusti: let x:[int, .. 3] = [1,2,3]; let y: &[T, .. 3] = x; let z: &[T] = y;
[16:52:20] <rusti> foo.rs:5:14: 5:15 error: unknown start of token: 160
[16:52:20] <rusti> foo.rs:5          let x:[int, .. 3] = [1,2,3]; let y: &[T, .. 3] = x; let z: &[T] = y;
[16:52:20] <rusti>                        ^
[16:52:33] <erickt> rusti: do what I want
[16:52:34] <rusti> foo.rs:5:17: 5:18 error: expected `{` but found `I`
[16:52:34] <rusti> foo.rs:5          do what I want
[16:52:34] <rusti>                           ^
[16:52:43] *** Joins: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu)
[16:53:03] <steven_is_false> rusti: let x = [0, ..4]; let y : &[uint] = &x;
[16:53:05] <rusti> more than 5 lines of output, pastebinned: http://sprunge.us/bYYc
[16:53:22] <kimundi> steven_is_false: no reinterpret. just a borrow
[16:54:04] <strcat> you don't use &
[16:54:07] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[16:54:24] <steven_is_false> strcat: How do I do it?
[16:54:50] <strcat> rusti: let x = [0, ..4]; let y: &[int] = x;
[16:54:52] <rusti> foo.rs:5:31: 5:33 warning: unused variable: `y`
[16:54:52] <rusti> foo.rs:5          let x = [0, ..4]; let y: &[int] = x;
[16:54:52] <rusti>                                         ^~
[16:54:52] <rusti> note: in expansion of fmt!
[16:54:52] <rusti> foo.rs:4:12: 6:7 note: expansion site
[16:55:41] <strcat> vectors just coerce to slices
[16:55:50] <steven_is_false> strcat: Thank you. That's really strange.
[16:55:58] <strcat> slices aren't borrowed pointers
[16:56:11] <strcat> [int] isn't a type in the language
[16:56:25] <steven_is_false> strcat: Couldn't [int] be a type trait?
[16:56:49] <strcat> what do you mean?
[16:57:11] <steven_is_false> strcat: I know I made an reimplementation of arrays a while back. Let me link to the gist.
[16:57:41] <nmatsakis> erickt: this is confounding me. Near as I can tell, that code that you sent me (the stuff that handles def_self) is kind of...busted.
[16:57:53] <nmatsakis> erickt: but for some reason it seems to work ok in stage0 and breaks on my branch
[16:58:06] <nmatsakis> erickt: by busted I mean that it doesn't correctly substitute the type of Self
[16:58:10] <strcat> steven_is_false: dynamic arrays and fixed-size arrays on the stack are fundamentally different types
[16:58:37] <nmatsakis> erickt: in my branch, this means that Self somehow ends up being passed to type_of() and yields an exception, but on incoming it doesn't ... I just can't see why, though.
[16:58:51] <erickt> nmatsakis: how odd!
[16:59:38] *** Quits: SimonSapin (simon@moz-58CD503D.fbx.proxad.net) (Ping timeout)
[17:00:37] <steven_is_false> strcat: So here's the gist https://gist.github.com/sstewartgallus/5414180 . See how there is a List <T> trait? This trait generalizes over all the differently sized fixed sized arrays.
[17:01:45] <nmatsakis> erickt: it is odd.
[17:02:45] <steven_is_false> strcat: Obviously, getting, and setting for an array should not use virtual method calls but I think that semantically it is similar. Making indexing not require virtual calls would simply be a magical compiler optimization.
[17:03:22] <nmatsakis> erickt: ah, I figured out why my code is acting differently, at least....but your fix can't come soon enough :)
[17:03:22] <strcat> steven_is_false: ~[int], [int, ..5] and &[int] are just sugar
[17:03:44] <strcat> it's a special case in the syntax for a common use case
[17:04:03] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Quit: Computer has gone to sleep.)
[17:04:13] <strcat> ~ is sugar too
[17:04:19] <strcat> you can implement ~ as a library type
[17:04:23] <steven_is_false> strcat: Suppose we have dependant types. Then we'd have the following types, and traits that those would be sugar for.
[17:04:37] <steven_is_false> strcat: What about traits?
[17:04:49] <steven_is_false> strcat: Can one do Arc <Trait>?
[17:04:49] <strcat> it's syntactic sugar, not anything special semantically
[17:04:59] <strcat> you could make a Slice type, a DynamicVector type, etc.
[17:05:01] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[17:05:04] <strcat> doesn't need to be traits
[17:05:13] <steven_is_false> strcat: So here's what I mean.
[17:05:18] <strcat> let mut x = ~5; *x = 10;
[17:05:20] <strcat> could be
[17:05:29] <strcat> let mut x = Unique::new(5); *x.borrow_mut() = 10;
[17:05:44] <strcat> it only exists as syntax because it's a commonly used thing
[17:06:22] <steven_is_false> strcat:  Okay
[17:06:48] <steven_is_false> strcat: So you get what I mean by that arrays could be implemented with type traits, and types right?
[17:07:10] <strcat> yes you can implement them as plain old structs
[17:07:11] <steven_is_false> strcat: *If we had dependant types for parameterization over a size N
[17:07:26] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[17:07:45] <strcat> you don't need that, you just need an alloca intrinsic
[17:07:47] *** Quits: bent (chatzilla@F2D29657.F60B0462.67AC9B1.IP) (Quit: ChatZilla 0.9.90-rdmsoft [XULRunner 18.0.2/20130201065344])
[17:07:57] *** Joins: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:07:57] *** ChanServ sets mode: +o dherman
[17:08:06] <steven_is_false> strcat: For Array <T, N>
[17:08:26] <strcat> alloca(sys::size_of::<T> * n)
[17:08:49] <steven_is_false> strcat: That's of type ~[T] not ~[T, N] or [T, N]
[17:08:58] <steven_is_false> strcat: It's not type safe
[17:09:09] *** Joins: graydon (graydon@3853DDD.39EEDBB3.D758B1AA.IP)
[17:09:09] *** ChanServ sets mode: +qo graydon graydon
[17:09:10] *** Joins: lmandel (lmandel@F2D29657.F60B0462.67AC9B1.IP)
[17:09:41] <steven_is_false> * ~[T, ..N], or [T, ..N]
[17:09:41] <strcat> you just need associated consts to make that stuff
[17:09:47] *** Quits: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu) (Client exited)
[17:10:46] <steven_is_false> strcat: Yes you could use associated consts, in my gists I didn't even need that. Dependendant types just let me show the idea less verbosely.
[17:12:24] <graydon> I can't _believe_ we're discussing loop again
[17:12:35] <nmatsakis> graydon: :)
[17:13:38] *** Joins: pyrac (pyrac@moz-B72E3FAF.w109-222.abo.wanadoo.fr)
[17:13:45] <steven_is_false> strcat: Anyways, thanks for your help
[17:14:08] <steven_is_false> So, for the people who are doing 3d with Rust what did you use for your matrix math?
[17:14:21] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[17:15:28] <steven_is_false> strcat: Oh right! you wrote alloca. I was confused because I thought you meant malloc! alloca is much closer to what I meant.
[17:17:07] <steven_is_false> strcat: alloca is in Rust?
[17:17:14] <strcat> no but it could be
[17:17:32] <steven_is_false> strcat: With & types wouldn't alloca actually be safe?
[17:17:52] *** Joins: brson (brson@2557E599.66715431.D25A875A.IP)
[17:17:52] *** ChanServ sets mode: +o brson
[17:18:06] <strcat> steven_is_false: it can be safe, yes
[17:18:15] <strcat> just won't work in constants and won't have the syntactic sugar
[17:18:29] <steven_is_false> strcat: Also with segmented stacks there's no danger of blowing the stack
[17:18:46] <strcat> you mean without?
[17:19:08] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[17:19:37] <nmatsakis> strcat: steven_is_false: alloca is not really compatible with segmented stacks, at least the current impl
[17:19:37] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Broken pipe)
[17:19:38] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[17:19:41] <nmatsakis> (just fyi)
[17:19:59] <steven_is_false> nmatsakis: It can't be implemented on segmented stacks easily?
[17:20:41] <steven_is_false> nmatsakis: But if it was implemented it wouldn't blow up the stack on segmented stacks anyways because segmented stacks can grow.
[17:20:42] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[17:21:33] <nmatsakis> steven_is_false: the current impl relies on doing checks as you enter the function based on the max stack size, but yes I think one could conceivably create an integrated alloca
[17:22:18] <nmatsakis> steven_is_false: though I'm not sure why you would, something like std::arena seems like it will generally suffice
[17:22:24] *** Joins: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu)
[17:23:14] <steven_is_false> nmatsakis: sure
[17:23:38] *** Joins: thou (thou@moz-D1EE62D4.sumnetsol.com)
[17:23:46] <strcat> nmatsakis: well it's not needed as an intrinsic anyway
[17:24:00] *** Joins: azita (Azita@2557E599.66715431.D25A875A.IP)
[17:24:04] <strcat> if it was possible to do, [0, ..n] could just allow n to be non-constant
[17:25:05] <steven_is_false> strcat: Yes that would be a nice syntax for such a thing.
[17:25:13] <strcat> ofc I guess that totally wouldn't work in the current system
[17:25:25] <strcat> since each fixed-size array has a type has on the size
[17:25:57] <strcat> alloca could just return &mut [T] I guess
[17:27:28] <graydon> nmatsakis: what was this 'out of stack' crash I see people discussing in incoming changes?
[17:28:24] <nmatsakis> graydon: I am not sure, I haven't observed it, pnkfelix can tell you more
[17:28:32] <graydon> pnkfelix: you around?
[17:28:34] <pnkfelix> graydon: here
[17:28:46] <pnkfelix> graydon: I'm posting what results I gather in #6061
[17:28:53] <graydon> what happened, do you know? it looks like some weird feedback-thing in random number generation?
[17:28:57] <strcat> graydon: bors is stuck btw
[17:29:02] <graydon> :(
[17:29:04] <nmatsakis> erickt: the handling of Self and default methods is definitely very far from what I described to you ;)
[17:29:26] <erickt> haha
[17:29:28] <nmatsakis> erickt: I've been digging more into what we do now, it seems to be somewhat chaotic
[17:29:36] <erickt> you're telling me :)
[17:29:53] <nmatsakis> :)
[17:29:55] <pnkfelix> graydon: the only thing I know at the moment is that reverting the commits listed in #6061 (see e.g. tim's pull request in #6067 ) fixes the problem.
[17:30:12] <graydon> ok
[17:30:13] <pnkfelix> graydon: but obviously I'd like to understand more
[17:31:00] <pnkfelix> graydon: so I'm going to try to drill down into it now, since the suggestions I've seen on the thread have not borne fruit for me.  (But maybe I'm missing something about how I'm supposed to incorporate those suggestions, e.g. maybe I did the RUST_LOG wrong)
[17:31:02] *** kimundi is now known as zz_kimundi
[17:31:19] <graydon> ok
[17:31:32] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[17:31:42] <pnkfelix> graydon: right now I think fixing bors is higher priority.  :)
[17:31:55] <strcat> well, I guess buildbot again
[17:32:16] <graydon> looking at it again
[17:32:21] <nmatsakis> erickt: so...I'm trying to think how I can land my patch without just fixing all of default methods (particularly since you're actively modifying that code...)
[17:32:26] <pnkfelix> graydon: strcat: yes, strcat keeps pointing out that buildbot might be to blame, really I have no clue.
[17:32:33] <nmatsakis> erickt: I might just xfail-test the relevant tests, but I'd like to find some workaround :)
[17:32:56] <strcat> bors is innocent! ;p
[17:33:25] <erickt> okay. I'll look for your commit and see if I can get it to work
[17:33:49] <strcat> it does seem like libuv isn't built with optimization but maybe that's not a big issue
[17:33:50] *** Quits: jclements (jclements@moz-8314C9B1.dsl.snlo01.pacbell.net) (Quit: jclements)
[17:34:15] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[17:34:17] *** Quits: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP) (Quit: buildmaster reconfigured: bot disconnecting)
[17:34:25] *** Joins: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP)
[17:34:48] *** Quits: jviereck (Adium@moz-96F3A391.dclient.hispeed.ch) (Quit: Leaving.)
[17:35:08] *** Quits: Houm (Houm@moz-25669AA8.fbx.proxad.net) (Input/output error)
[17:35:38] <nmatsakis> erickt: it could be a bit, still have more tests to fix, though those are the last 2 run-pass tests
[17:35:55] <nmatsakis> erickt: but I kind of don't want to land something that flat-out breaks default methods...
[17:36:03] <nmatsakis> erickt: ...even if I feel I just exposed an existing bug
[17:36:06] <graydon> it did build the right rev this time. weird.
[17:36:08] *** Joins: guitsaru (guitsaru@moz-35937D86.hsd1.ca.comcast.net)
[17:36:12] <graydon> just won't report it?
[17:36:18] * graydon yells at buildbot
[17:37:19] *** zz_kimundi is now known as kimundi
[17:37:31] *** Quits: CarpNet (ac@moz-FD24B77.sohonet.co.uk) (Quit: Leaving)
[17:37:44] <LRN> graydon, a mingw-w64 developer told me that clang does not support sjlj, googling does nothing to disprove that claim. If rust has clang involved in EH in any way, sjlj is not a possibilitiy.
[17:38:18] <strcat> afaik it supports sjlj on OS X only
[17:38:40] <strcat> and dwarf on the *nix platforms (including OS X)
[17:39:16] *** Joins: dylukes (dylukes@moz-9EE43B5.wireless.pitt.edu)
[17:39:16] <strcat> LLVM definitely has windows exception handling code/tests though...
[17:39:27] <strcat> maybe it doesn't work
[17:39:37] <LRN> yes. Clang implements UsesSjLjExceptions() { return false; } though.
[17:40:26] <LRN> s/Uses/Use/
[17:41:05] <strcat> LRN: it definitely has sjlj on some platforms
[17:41:15] * LRN shrugs
[17:41:20] <strcat> looking at clang's code
[17:41:57] <LRN> Good thing about sjlj - it's easy to grep for it :0
[17:42:02] <strcat> it uses sjlj for darwin on arm
[17:42:07] <strcat> and freebsd on some variant of arm
[17:42:10] <strcat> and I guess nowhere else
[17:43:11] *** Quits: guitsaru (guitsaru@moz-35937D86.hsd1.ca.comcast.net) (Client exited)
[17:45:14] *** Quits: bnicholson (bnicholson@moz-BE33DA21.fw1.sfo1.mozilla.net) (Client exited)
[17:45:26] <nmatsakis> graydon: so...I'm seeing a segfault in cleanup::annihilate, any debugging tips? useful RUST_LOG settings?
[17:45:32] *** Joins: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP)
[17:45:32] *** ChanServ sets mode: +o pcwalton
[17:45:39] *** Joins: bnicholson (bnicholson@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:45:51] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[17:46:36] <graydon> not much. could be any pointer, could be any dtor
[17:46:59] <graydon> that runs at task-shutdown, walks the local allocations list and runs every box's drop glue
[17:47:02] *** Quits: lerc (quassel@121-74-236-56.telstraclear.net) (Ping timeout)
[17:47:32] *** Quits: dylukes (dylukes@moz-9EE43B5.wireless.pitt.edu) (Quit: Computer has gone to sleep.)
[17:47:36] <just_bstrie> pcwalton: you closed the issue inspired by https://github.com/mozilla/rust/issues/2778 , can that one be closed too?
[17:48:45] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[17:48:49] <pcwalton> I don't understand that
[17:48:51] <pcwalton> that issue
[17:49:09] *** Joins: KindOne (KindOne@moz-A7230136.dynamic.ip.windstream.net)
[17:49:23] <nmatsakis> graydon: ok, joy.
[17:49:31] <just_bstrie> pcwalton: I don't understand the other issue either, I figured you knew what you were doing when you closed it :)
[17:49:44] *** Joins: dylukes (dylukes@moz-9EE43B5.wireless.pitt.edu)
[17:49:50] *** Joins: Houm (Houm@moz-25669AA8.fbx.proxad.net)
[17:49:54] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[17:50:04] <kimundi> nmatsakis: Re alloca. I know of at least one place where that would be useful, fast generic number parsing without heap allocation. Needs either a dynamic size or assoziated constants.
[17:51:15] *** Quits: dylukes (dylukes@moz-9EE43B5.wireless.pitt.edu) (Quit: Computer has gone to sleep.)
[17:52:17] *** Joins: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net)
[17:53:08] *** Quits: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu) (Client exited)
[17:53:14] *** Joins: mzabaluev (mzabaluev@moz-F3BF265C.dhcp.inet.fi)
[17:54:04] *** Joins: guitsaru (guitsaru@A8985A22.5DF68D0E.4C2245EF.IP)
[17:54:47] <pcwalton> just_bstrie: oh, I don't remember closing it
[17:54:48] <pcwalton> but yeah
[17:54:52] <pcwalton> the same reasoning should apply.
[17:54:55] <pcwalton> closing
[17:55:48] *** Joins: guitsaru_ (guitsaru@A8985A22.5DF68D0E.4C2245EF.IP)
[17:55:49] *** Quits: guitsaru (guitsaru@A8985A22.5DF68D0E.4C2245EF.IP) (Connection reset by peer)
[17:56:23] <just_bstrie> graydon: triage bot is pretty brilliant, I've closed half the bugs assigned to me this week
[17:56:36] <graydon> really? that's good!
[17:56:48] *** Quits: lucian_ (lucian@6B2B4644.4304AE1E.CE5E78F6.IP) (Ping timeout)
[17:56:54] <strcat> heh, I couldn't do much for most of mine ;p
[17:56:55] <graydon> (I'm never sure the automated processes I'm trying to set up are not just more misery than they're worth)
[17:56:56] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[17:57:04] <pcwalton> yes, +1 on the triage bot.
[17:57:19] <just_bstrie> strcat: well I didn't have to *do* much, most of them were "this is fixed now! hooray!"
[17:57:25] <graydon> ok, cool
[17:57:26] <pcwalton> it helps a *lot* to avoid jwz's CADT criticism
[17:57:31] <graydon> :)
[17:57:41] <graydon> yeah, that always hit kinda close to home in my experience
[17:57:44] <pnkfelix> graydon: While we're delivering accolades: In case no one else says it, I was very impressed by the maturity milestone breakdown.
[17:58:06] <graydon> if we play our cards right we'll have done a full sweep through the bug backlog in ... 8 weeks, at the current rate
[17:58:17] <graham_king> Is it correct to say @ is similar to pointers in Go, and to what happens internally in Java and Python? (ignoring mutability and tasks)
[17:58:19] <graydon> at least a "someone looked at the bug, once, in recent memory" sort of sweep
[17:58:23] <mzabaluev> People bikeshedding integer division should better go research some useful concurrency monads for Haskell, or something.
[17:58:28] <strcat> I actually have ~6 bugs I reported against gnome that no one ever looked at ;p
[17:58:32] <pcwalton> graham_king: yup
[17:58:38] <graham_king> Thanks
[17:58:51] <strcat> best part is some have patches....
[17:59:24] <strcat> graydon: https://github.com/mozilla/rust/pull/6075 r?
[17:59:30] <strcat> oh
[17:59:31] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[17:59:33] <strcat> pcwalton: looked at it already
[17:59:36] <graydon> pnkfelix: thanks. I hope it helps answer questions about readiness in a less-arbitrary way
[17:59:36] <strcat> ;p
[17:59:43] <just_bstrie> graham_king: though don't try passing @ pointers between tasks
[18:00:04] <graham_king> just_bstrie: Yes, I mean ignoring tasks for now
[18:00:22] <just_bstrie> ah right, I don't read things that are in parentheses...
[18:00:31] <strcat> @[1, 2, 3] is like a python tuple, @mut [1, 2, 3] is like a python list
[18:00:31] <graham_king> :-)
[18:00:33] <just_bstrie> until someone points it out, I guess
[18:00:57] <graydon> grr. again, the failure is just that buildbot decided to build not-the-actual-merge-head
[18:01:00] <graydon> I wonder why it's doing that
[18:01:24] <pnkfelix> Do we have any kind of #[deriving(..)] magic that generates the impl T for @Foo assuming that there is already an impl T for Foo ?  (i.e. that does the self derefing?)
[18:01:26] <strcat> hmm, can't you use @mut T as a key in a hash table and then modify it somewhere else...
[18:01:37] <pnkfelix> (or is that a code-smell)
[18:01:38] <pcwalton> pnkfelix: no, but methods generally autoderef
[18:01:43] *** Joins: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu)
[18:01:54] <pnkfelix> pcwalton: that's not what I'm seeing for this RNG code
[18:02:03] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[18:02:14] <pcwalton> pnkfelix: they definitely do, I know that code :)
[18:02:19] <pcwalton> wrote a lot of it too
[18:02:26] <pnkfelix> then why do I have to write this:     linear_map_with_capacity_and_keys((*r).gen_u64(), (*r).gen_u64(),
[18:02:27] <pnkfelix>                                       initial_capacity)
[18:02:28] <pcwalton> they autoderef and then if that fails it autorefs
[18:02:34] <pcwalton> pnkfelix: you shouldn't have to
[18:03:03] <pnkfelix> <shrug>.  Then I guess the compiler has a bug.
[18:03:41] *** Quits: passcod (passcod@moz-5BCF5019.passcod.name) (Ping timeout)
[18:04:03] *** Quits: ziad (ziad@moz-5003F925.members.linode.com) (Ping timeout)
[18:04:05] *** Quits: FluffySauce (textual@moz-E5BC5F6F.sea.popcap.com) (Quit: Computer has gone to sleep.)
[18:04:15] *** Quits: saya (Mibbit@moz-90A5DA65.static.se.alltele.net) (Ping timeout)
[18:04:16] *** Quits: jld (jld@moz-B94C75AD.xlerb.net) (Ping timeout)
[18:04:32] *** Quits: cantsin (cantsin@moz-F99612CC.members.linode.com) (Ping timeout)
[18:04:36] *** Quits: olsonjeffery (pf@moz-9E9CF15C.members.linode.com) (Ping timeout)
[18:04:55] *** Quits: shachaf (shachaf@moz-F37E0395.members.linode.com) (Ping timeout)
[18:05:00] *** Quits: yardena (yardena@moz-A95F12B1.members.linode.com) (Ping timeout)
[18:05:12] *** Quits: BigEndian (hurp@moz-1B6DD81E.members.linode.com) (Ping timeout)
[18:05:36] *** Quits: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk) (Client exited)
[18:06:21] *** Quits: Eridius (kevin@moz-415A52F9.members.linode.com) (Ping timeout)
[18:07:57] *** Joins: Eridius (kevin@moz-415A52F9.members.linode.com)
[18:08:03] *** Joins: ziad (ziad@moz-5003F925.members.linode.com)
[18:08:04] *** Joins: olsonjeffery (pf@moz-9E9CF15C.members.linode.com)
[18:08:05] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[18:08:20] *** Joins: BigEndian (hurp@moz-1B6DD81E.members.linode.com)
[18:08:35] *** Quits: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: dherman)
[18:08:37] *** Joins: jld (jld@moz-B94C75AD.xlerb.net)
[18:08:39] *** Joins: passcod (passcod@moz-5BCF5019.passcod.name)
[18:08:45] <graydon> aha!
[18:08:47] <graydon> mergerequests?
[18:09:12] *** Joins: cantsin (cantsin@moz-F99612CC.members.linode.com)
[18:09:46] <pnkfelix> graydon: context?
[18:10:04] <graydon> I bet it's mergerequests that's causing buildbot to go sideways
[18:10:11] *** Quits: BigEndian (hurp@moz-1B6DD81E.members.linode.com) (Ping timeout)
[18:10:14] <graydon> see, it _is_ building something in almost every case
[18:10:24] <graydon> it's just frequently not building the merge rev that bors is looking for
[18:10:33] <graydon> but one of its nearby parents in the push
[18:10:38] <pnkfelix> oh. that's bad.
[18:10:41] <graydon> well
[18:10:46] <graydon> buildbot has a "mergerequests" facility
[18:10:50] <graydon> which is set to true on auto
[18:10:59] <graydon> the idea being that if 2 changes come in close together
[18:11:05] <graydon> it should coalesce them into a single build action
[18:11:19] <graydon> which is cool unless it happens to use logic that is ... say, not topologically-aware
[18:11:29] <graydon> thereby sometimes picking an earlier change rather than a later one
[18:11:31] <graydon> which I bet it's doing
[18:11:34] *** Quits: passcod (passcod@moz-5BCF5019.passcod.name) (Ping timeout)
[18:12:17] *** Quits: jld (jld@moz-B94C75AD.xlerb.net) (Ping timeout)
[18:12:18] <graydon> (if we didn't merge buildrequests, I believe it might wind up having ot build ... every sub-commit inside a pull, separately? I think. it would be bad, I think)
[18:12:42] <strcat> pcwalton: https://github.com/mozilla/rust/pull/6070 r? (tjc reviewed it before but I reworded a bit)
[18:12:48] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[18:13:24] <pnkfelix> graydon: I see, so you're not talking about it merging distinct branches
[18:13:41] <strcat> I don't really understand why github chooses to keep some comments as 'outdated diff' discussions but removes others.... oh well :P
[18:13:57] <strcat> seems like it keeps line comments but not commit ones
[18:15:09] *** Joins: passcod (passcod@moz-5BCF5019.passcod.name)
[18:15:37] *** Joins: jld (jld@moz-B94C75AD.xlerb.net)
[18:15:58] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[18:16:32] *** Joins: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net)
[18:16:32] *** ChanServ sets mode: +o dherman
[18:18:51] *** Joins: devbug (quassel@moz-E1DE087C.bchsia.telus.net)
[18:19:10] *** Joins: shachaf (shachaf@moz-F37E0395.members.linode.com)
[18:19:12] *** Joins: BigEndian (hurp@moz-1B6DD81E.members.linode.com)
[18:19:56] <graham_king> Is there an expression for Rust, like "Pythonic"?
[18:20:19] <graham_king> "That feels like a more _ way of doing it"
[18:20:22] <alexrp> strcat: it actually keeps the commit comments, but since the commit's hash has changed, they don't appear in the pull request
[18:20:39] <alexrp> strcat: but e.g. if you go to the commit's hash explicitly on github (github keeps it around for ~a while), they're there
[18:20:40] *** Quits: jld (jld@moz-B94C75AD.xlerb.net) (Ping timeout)
[18:20:46] <strcat> alexrp: yeah, but why does it manage to keep the line comments on the old commits?
[18:21:00] *** Joins: catpig (catpig@moz-DE1B6BDB.dip0.t-ipconnect.de)
[18:21:11] *** Quits: shachaf (shachaf@moz-F37E0395.members.linode.com) (Ping timeout)
[18:21:18] *** Quits: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl) (Ping timeout)
[18:21:27] *** Joins: gareth0 (gareth0@moz-288ECBB9.dynamic.dsl.as9105.com)
[18:21:33] *** Quits: gareth0 (gareth0@moz-288ECBB9.dynamic.dsl.as9105.com) (Quit: gareth0)
[18:22:39] <strcat> I guess they go away after 30 days since that's the default reflog expire time
[18:23:07] *** Quits: BigEndian (hurp@moz-1B6DD81E.members.linode.com) (Ping timeout)
[18:23:10] <alexrp> my guess would be that line comments are somehow linked into their whole pull request thing
[18:24:05] *** Joins: jld (jld@moz-B94C75AD.xlerb.net)
[18:24:14] *** Quits: passcod (passcod@moz-5BCF5019.passcod.name) (Quit: ZNC - http://znc.in)
[18:24:33] <doy> graham_king: i've heard people use "rustic"
[18:24:46] *** Joins: seth (seth@moz-D840E602.dsl.static.sonic.net)
[18:25:06] <just_bstrie> rustic is my favorite
[18:25:20] <Jeaye> Rustic is good.
[18:25:31] <graham_king> Nice, thanks
[18:25:35] *** Joins: passcod (passcod@moz-5BCF5019.passcod.name)
[18:26:39] *** Joins: BigEndian (hurp@moz-1B6DD81E.members.linode.com)
[18:27:25] *** Quits: passcod (passcod@moz-5BCF5019.passcod.name) (Ping timeout)
[18:27:31] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[18:27:51] *** kimundi is now known as zz_kimundi
[18:28:35] *** Quits: steven_is_false (quassel@moz-8A083175.bchsia.telus.net) (Ping timeout)
[18:29:45] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[18:30:25] *** Joins: steven_is_false (quassel@moz-8A083175.bchsia.telus.net)
[18:30:29] <just_bstrie> so that isaac-in-rust patch... would it make more sense to offer that as an external, runtimeless lib and then have rust rely on it via submodule?
[18:31:26] <just_bstrie> it would be neat to start offering rust libraries that are usable from any language with a C api
[18:31:47] <steven_is_false> Why not "rusty"?
[18:32:03] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[18:32:15] <pnkfelix> steven_is_false: I think "rusty" can have negative connotations.  "rustic" is at least neutral if not outright positive.
[18:32:27] *** Quits: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu) (Client exited)
[18:32:30] <pnkfelix> (or maybe "rustic" is a weasel word in some circles.)
[18:34:03] <just_bstrie> I like "rustic" because of the resemblance to "idiomatic"
[18:34:27] *** Joins: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu)
[18:34:42] <katis> so is it possible to call rust libraries from scripting languages like lua?
[18:35:05] <just_bstrie> katis: theoretically, yes, with some restrictions
[18:35:12] *** Joins: passcod (passcod@moz-5BCF5019.passcod.name)
[18:35:13] <just_bstrie> though there are bits that remain to be implemented
[18:35:13] <katis> i did a little test with luajit, but had no luck
[18:35:43] <just_bstrie> katis: I just embedded lua in rust rather than the other way around :P
[18:35:45] *** Quits: seth (seth@moz-D840E602.dsl.static.sonic.net) (Input/output error)
[18:35:59] <just_bstrie> katis: see http://brson.github.io/2013/03/10/embedding-rust-in-ruby/
[18:36:03] <steven_is_false> How far along is progress in runtime less Rust?
[18:36:15] <just_bstrie> I presume it's following the trajectory of the scheduler rewrite
[18:36:18] <katis> yeah, i just liked how simple the luajit -> C calling was
[18:36:28] <katis> just_bstrie: thanks
[18:36:41] *** Quits: fabiand (fabiand@moz-4563135B.adsl.alicedsl.de) (Quit: Verlassend)
[18:36:49] *** Quits: brson (brson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[18:36:58] *** Quits: passcod (passcod@moz-5BCF5019.passcod.name) (Ping timeout)
[18:37:09] <just_bstrie> katis: yeah, anything that can call into C should be able to call into rust code someday, assuming that code 1) exposes a C interface, and 2) doesn't use features that require a runtime (GC, tasks)
[18:38:19] <katis> just_bstrie: that's cool =)
[18:38:39] <just_bstrie> and by "that code" I mean "that rust code"
[18:38:47] *** Joins: lkuper (lkuper@moz-D6AAFF3.cs.indiana.edu)
[18:38:47] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[18:38:54] <just_bstrie> yeah, it's really one of the things I'm most excited about
[18:39:27] *** Quits: jld (jld@moz-B94C75AD.xlerb.net) (Ping timeout)
[18:39:27] *** Quits: BigEndian (hurp@moz-1B6DD81E.members.linode.com) (Ping timeout)
[18:39:35] <just_bstrie> the intended niche of Rust is for C++ folks who want something safter, *but* I think it has a really good chance to appeal to library authors who have so far been forced to implement everything in C for compatibility's sake
[18:39:44] <pnkfelix> giving up, I've been pretty useless on issue 6061 and now I have to go.  (Am already late for a dinner engagement.  :(  )
[18:39:45] *** Quits: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP) (Quit: pcwalton)
[18:39:50] <just_bstrie> I guess safter == safer + faster?
[18:40:15] <just_bstrie> wishful thinking that rust will be faster than c++ :)
[18:40:29] *** Joins: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP)
[18:40:29] *** ChanServ sets mode: +o pcwalton
[18:40:52] <strcat> just_bstrie: it won't appeal to library authors because of an ABI
[18:40:53] *** Quits: pnkfelix|rcirc (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net) (Input/output error)
[18:40:57] *** Quits: pnkfelix (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net) (Quit: Leaving.)
[18:41:17] <strcat> if you mean "over C++":
[18:41:23] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[18:41:30] *** Joins: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP)
[18:41:30] *** Quits: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP) (Z:lined (Open Proxy found on your host. Please visit www.blitzed.org/proxy?ip=115.68.131.49 for more information.))
[18:41:33] <just_bstrie> strcat: I meant over C
[18:41:54] <just_bstrie> though I am not a library author
[18:42:49] <tiffany> some people use C for more than just compatibility's sake
[18:43:00] <just_bstrie> I *have* seen people express interest in runtimeless rust solely because they've always written things in C so that they can be used from any language
[18:43:03] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[18:45:46] <Ralith> is support for compiling to a runtimeless library planned?
[18:46:22] <just_bstrie> Ralith: http://brson.github.io/2013/03/10/embedding-rust-in-ruby/ works today
[18:46:48] <Ralith> awesome
[18:46:57] <just_bstrie> afaik he's not creating a ruby-specific function in that post, you can call that from anything that can talk to C
[18:47:39] <Ralith> that should indeed be useful then
[18:48:29] *** Quits: RagingDave (RagingDave@moz-2754F937.pools.arcor-ip.net) (Ping timeout)
[18:48:38] <katis> just_bstrie: got luajit -> rust working based on that article, thanks a lot :)
[18:48:50] <just_bstrie> katis: oh man, really? that's awesome
[18:49:59] *** Joins: brson (brson@2557E599.66715431.D25A875A.IP)
[18:49:59] *** ChanServ sets mode: +o brson
[18:50:39] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[18:50:41] <katis> just_bstrie: http://pastebin.com/v0F2p0Zd
[18:50:58] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[18:51:34] <just_bstrie> brson: ^ rust being called from luajit, based on your blog post
[18:53:52] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[18:56:24] <just_bstrie> katis: though I hear that luajit does... something smart where it inlines foreign C code somehow? or something? probably doesn't do that with rust
[18:56:36] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[18:56:43] <just_bstrie> or maybe it does! it's all magic to me
[18:57:52] <katis> just_bstrie: i'm no expert and not sure what you mean, but see the ffi.cdef-function that takes a string that luajit parses and generates the C-bindings automagically
[18:58:17] *** Quits: pcdummy (quassel@moz-CF4CA865.page4me.ch) (Ping timeout)
[18:58:42] <katis> that ruby ffi-module seems to do the same i guess
[18:58:51] *** Joins: pcdummy (quassel@moz-CF4CA865.page4me.ch)
[18:59:48] *** Quits: FrozenCow (FrozenCow@moz-9DF5D010.dynamic.upc.nl) (Client exited)
[19:01:04] <just_bstrie> katis: are you using luajit 1 or 2?
[19:01:24] <katis> just_bstrie: 2.0.0
[19:01:41] <just_bstrie> that's so point-oh
[19:01:45] <katis> ubuntu 13.04 package
[19:02:28] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[19:02:28] <ghrust> 01[13rust01] 15bors merged 06auto into 06incoming: 02https://github.com/mozilla/rust/compare/0604468fd540...64412eca1039
[19:02:28] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[19:04:20] *** Quits: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: dherman)
[19:04:23] *** zz_kimundi is now known as kimundi
[19:05:28] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[19:05:28] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/L4I-dw
[19:05:28] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[19:05:30] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[19:05:30] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/XTROXQ
[19:05:30] <ghrust> 13rust/06auto 14394f0d4 15Tim Chevalier: Revert libcore: unify `gen_<type>` methods on `rand::RngUtil` into the generic `gen`....
[19:05:30] <ghrust> 13rust/06auto 14472ea0b 15Tim Chevalier: Revert "libcore: remove unnecessary deref"...
[19:05:30] <ghrust> 13rust/06auto 14d72ca65 15bors: auto merge of #6067 : catamorphism/rust/revert, r=catamorphism...
[19:05:32] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[19:06:11] *** Joins: jld (jld@moz-B94C75AD.xlerb.net)
[19:06:33] *** Quits: Benvie (brandon@4EAF34EF.DD136097.D01D599A.IP) (Ping timeout)
[19:07:35] *** Joins: Benvie (brandon@4EAF34EF.DD136097.D01D599A.IP)
[19:07:59] *** Quits: jld (jld@moz-B94C75AD.xlerb.net) (Ping timeout)
[19:08:16] *** Quits: steven_is_false (quassel@moz-8A083175.bchsia.telus.net) (Ping timeout)
[19:08:16] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[19:10:21] *** Joins: jld (jld@moz-B94C75AD.xlerb.net)
[19:11:04] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[19:11:19] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[19:12:06] *** Quits: jld (jld@moz-B94C75AD.xlerb.net) (Ping timeout)
[19:12:15] *** Joins: BigEndian (hurp@moz-1B6DD81E.members.linode.com)
[19:12:40] *** Joins: RagingDave (RagingDave@moz-555F8FB9.pools.arcor-ip.net)
[19:13:44] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[19:14:04] *** Quits: BigEndian (hurp@moz-1B6DD81E.members.linode.com) (Ping timeout)
[19:14:31] *** Quits: RagingDave (RagingDave@moz-555F8FB9.pools.arcor-ip.net) (Ping timeout)
[19:17:43] *** Joins: RagingDave (RagingDave@moz-68D29883.pools.arcor-ip.net)
[19:18:36] *** Quits: pyrac (pyrac@moz-B72E3FAF.w109-222.abo.wanadoo.fr) (Quit: pyrac)
[19:21:55] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[19:25:34] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[19:27:46] *** Quits: nielsle (nielsle@moz-5CE8ECCD.boa.fiberby.dk) (Ping timeout)
[19:28:48] *** Quits: RagingDave (RagingDave@moz-68D29883.pools.arcor-ip.net) (Quit: Ex-Chat)
[19:28:52] *** Joins: RagingDave (RagingDave@moz-68D29883.pools.arcor-ip.net)
[19:31:08] <brson> just_bstrie: cool!
[19:32:08] *** Joins: Sodel_the_V (user@moz-853663E1.va.shawcable.net)
[19:33:29] *** Joins: yardena (yardena@moz-A95F12B1.members.linode.com)
[19:33:54] *** Joins: jojo04 (chatzilla@moz-E702CB0B.dip0.t-ipconnect.de)
[19:34:24] *** Quits: jojo04 (chatzilla@moz-E702CB0B.dip0.t-ipconnect.de) (Client exited)
[19:35:00] <brson> just_bstrie: fwiw, with the new scheduler I'm pretty close to being able to provide the local heap, unwinding, logging, etc. for 'freestanding' code. it will require making one function call like `do with_local_context { ... }` to set up some thread-local state
[19:36:28] *** Quits: dforsyth (dforsyth@CAEA512.6E91F788.2CFD4520.IP) (Quit: leaving)
[19:36:37] *** Joins: dforsyth (dforsyth@AC76BBB4.5FDB5121.EE6E63A5.IP)
[19:36:57] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[19:37:13] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[19:38:48] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[19:39:37] <Seldaek> brson: hey, I'm the one that emailed you about helping out on IO, going through the docs you linked now, what's the prefered way to give feedback on that?
[19:40:18] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[19:41:54] *** Joins: mib_38dmo6 (Mibbit@6EAA75CA.B1D7CE02.DFAB1F33.IP)
[19:42:17] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[19:42:47] *** Quits: mib_38dmo6 (Mibbit@6EAA75CA.B1D7CE02.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[19:42:47] *** Joins: nielsle (nielsle@moz-5CE8ECCD.boa.fiberby.dk)
[19:43:12] *** Quits: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP) (Ping timeout)
[19:43:27] *** Joins: blaphmat (Mibbit@6EAA75CA.B1D7CE02.DFAB1F33.IP)
[19:45:20] *** Quits: blaphmat (Mibbit@6EAA75CA.B1D7CE02.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[19:46:52] *** Joins: dylukes (dylukes@moz-FE0F98E8.wireless.pitt.edu)
[19:48:40] *** Joins: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP)
[19:48:41] *** ChanServ sets mode: +o pcwalton
[19:49:18] *** Joins: dherman (dherman@moz-C03D0C61.vlan426.asr1.sfo1.gblx.net)
[19:49:18] *** ChanServ sets mode: +o dherman
[19:49:59] <friggle> just_bstrie: yes, luajit2 understands the native calling convention and can trace across function calls
[19:50:00] *** Quits: dylukes (dylukes@moz-FE0F98E8.wireless.pitt.edu) (Quit: Computer has gone to sleep.)
[19:50:18] <friggle> if you use the Lua C API then you pass a pointer to your luaL_State. This kills the JIT
[19:50:27] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[19:50:50] <friggle> the ruby ffi doesn't do the same thing, just the dynamic code generation bit
[19:51:04] <friggle> pypy,rpython are adopting the same thing though
[19:52:08] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[19:52:33] <brson> Seldaek: there's a thread on the mailing list called 'Update on I/O progress' where there is some discussion going on. that might be the best place at the moment
[19:54:30] *** Quits: pcdummy (quassel@moz-CF4CA865.page4me.ch) (Ping timeout)
[19:54:48] <Seldaek> brson: sounds fine yes thanks, will check it out
[19:57:25] *** Joins: dylukes (dylukes@moz-FE0F98E8.wireless.pitt.edu)
[19:58:13] *** Joins: bent (chatzilla@AC3C7CA.26735741.CA5B6332.IP)
[19:58:31] *** Joins: pcdummy (quassel@moz-CF4CA865.page4me.ch)
[19:58:48] <just_bstrie> friggle: so luajit2 has two mechanisms, one being a native tracing ffi and one being the standard lua C api?
[19:59:30] <erickt> pcwalton: did your de-mode-ification patch land yet?
[19:59:39] <pcwalton> erickt: testing now.
[19:59:43] <erickt> woot
[20:00:00] <strcat> pcwalton: is the plan to remove the old stack switch for FFI completely? I forget :)
[20:00:05] <pcwalton> yes
[20:00:24] <strcat> right now fast_ffi hits stack thrashing a lot
[20:00:35] <strcat> since it asks for a lot
[20:01:12] *** Quits: pcdummy (quassel@moz-CF4CA865.page4me.ch) (Ping timeout)
[20:01:42] <pcwalton> hoist it up with #[fixed_stack_segment]
[20:01:50] *** Quits: webber46 (webber46@moz-F6310FF0.lha.sgsnet.se) (Ping timeout)
[20:02:05] *** Quits: dylukes (dylukes@moz-FE0F98E8.wireless.pitt.edu) (Quit: Computer has gone to sleep.)
[20:02:17] <brson> i686 is definitely broken in stage1 because of the recent change to run_program that returns a struct
[20:02:50] <pcwalton> I don't see any way to get rid of the stack thrashing, short of just disabling segmented stacks.
[20:02:53] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[20:03:06] *** Quits: thou (thou@moz-D1EE62D4.sumnetsol.com) (Input/output error)
[20:03:09] <Seldaek> brson: awaiting list approval :)
[20:03:11] <brson> strcat: what do you mean by stack thrashing here?
[20:03:24] *** Joins: josh (josh@moz-98AA7282.nyc.res.rr.com)
[20:04:24] <strcat> brson: lots and lots of calls to upcall_new_stack and upcall_del_stack
[20:04:25] *** Joins: jviereck (Adium@moz-340574DC.dclient.hispeed.ch)
[20:04:57] *** Joins: pcdummy (quassel@moz-CF4CA865.page4me.ch)
[20:04:59] <strcat> fast_ffi + fixed_stack_segment > old ffi > fast_ffi on a few tests (like the map bench)
[20:05:21] <pcwalton> there's literally nothing I can do
[20:05:24] <brson> that's not true
[20:05:25] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[20:05:35] <pcwalton> we could cache the stack segment
[20:05:39] <pcwalton> but then we're dead on 32 bit
[20:05:46] <pcwalton> due to the scalability concern you mentioned
[20:05:46] <strcat> is there really no way to ask for less space? :(
[20:05:49] <brson> my preference is to be able to annotate function calls with the amount of stack required
[20:05:58] <pcwalton> can't do that due to LLVM attributes
[20:06:02] <brson> then all of core would be able to precisely say how much stack it needs
[20:06:03] <pcwalton> not enough space in LLVM attributes
[20:06:19] *** Joins: webber46 (webber46@moz-F6310FF0.lha.sgsnet.se)
[20:06:36] <brson> we can write some code for it!
[20:06:49] <pcwalton> where do we add the attribute?
[20:07:08] <brson> idk, it's an implementation detail
[20:07:39] <pcwalton> I don't know how to associate info with LLVM functions outside the attribute
[20:08:04] *** Quits: bent (chatzilla@AC3C7CA.26735741.CA5B6332.IP) (Quit: ChatZilla 0.9.90-rdmsoft [XULRunner 18.0.2/20130201065344])
[20:08:21] <pcwalton> let's just turn off stack switching on 64 bit.
[20:08:22] *** Quits: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu) (Client exited)
[20:09:27] <pcwalton> maybe we could add an intrinsic, but then we'd have to modify selection DAG, and fast isel, and add a machine instruction
[20:09:33] <pcwalton> and it would still be ugly
[20:12:14] <graydon> brson: re struct-return, I was afraid of that (mentioned in the pull req)  :(((
[20:12:31] <pcwalton> well, functions already have the "gc" intrinsic
[20:12:40] <graydon> I don't understand what is going on with fixed stack segments and the fast ffi
[20:12:43] <pcwalton> I guess I'll drop everything and redo it
[20:12:46] * pcwalton sighs
[20:12:56] <strcat> pcwalton: what exactly does it do right now?
[20:13:06] <pcwalton> get ready for another big LLVM upgrade
[20:13:19] <graydon> wait wait
[20:13:20] <brson> graydon: it should fix itself after a snapshot, but I may put in a workaround
[20:13:21] <pcwalton> "fixedstacksegment" is an attribute which requests a big stack
[20:13:33] <graydon> ok. and that's not the same as fast_ffi
[20:13:36] <strcat> pcwalton: I mean how does fast_ffi work right now?
[20:13:45] <pcwalton> it puts fixedstacksegment on the wrapper function.
[20:13:55] <strcat> I thought it was doing something like putting a huge array on the stack and using that as the C stack
[20:14:07] <pcwalton> no
[20:14:12] <pcwalton> it modifies LLVM to ask for a big stack segment.
[20:14:14] <nmatsakis> pcwalton: this flag propagates out to callers, right?
[20:14:17] <pcwalton> yes.
[20:14:19] <graydon> ok. and if a wrapper function has no fixedstacksegment attribute, what happens?
[20:14:22] <pcwalton> nmatsakis: no
[20:14:28] <pcwalton> it propagates out to inlined
[20:14:45] <pcwalton> the wrapper function always has a fixedstacksegment attribute
[20:14:52] <graydon> they all do?
[20:15:00] <pcwalton> if they're marked with fast_ffi, yes.
[20:15:07] <nmatsakis> pcwalton: ah. so fast_ffi basically means that the caller will request a big stack instead of the wrapper
[20:15:10] <graydon> right. if they're _not_ marked with fast_ffi, what happens?
[20:15:16] <pcwalton> then a stack switch happens
[20:15:19] <graydon> we get a stack-switch to the C stack, as before?
[20:15:19] <pcwalton> you jump to the c stack.
[20:15:24] <pcwalton> yes.
[20:15:25] <graydon> ok
[20:15:26] <strcat> would it be possible to just teach the stack switch to use an array then? without dealing with LLVM
[20:15:31] <brson> but that behavior should go away
[20:15:36] <brson> we shouldn't have two strategies here
[20:15:43] <nmatsakis> right
[20:15:45] <brson> we expect everything to be fast_ffi
[20:16:04] <pcwalton> the only reason I didn't rip out the old one is because of some annoying ABI issues
[20:16:04] <graydon> it seems to me that #[fast_ffi] should usually be happening a ways up on a call stack
[20:16:08] <graydon> any time there's a thrashing occurrence
[20:16:11] <pcwalton> yes
[20:16:17] <brson> no
[20:16:18] <graydon> we should just go a few levels up the stack and put it there too
[20:16:19] <graydon> right?
[20:16:23] <pcwalton> the attribute is actually #[fixed_stack_segment]
[20:16:26] <graydon> right, yeah.
[20:16:42] <nmatsakis> it seems like there is not really enough information to make an intelligent decision
[20:16:42] <graydon> it means "somewhere in the leaves of this function there will be a lot of FFI traffic"
[20:16:44] <nmatsakis> about where to do the stack switch
[20:17:01] <pcwalton> nmatsakis: maybe we could hack LLVM to try to infer this
[20:17:02] <nmatsakis> because you don't know what stack the C function will need
[20:17:03] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[20:17:16] <pcwalton> to try to automatically add #[fixed_stack_segment] intelligently or whatever
[20:17:19] <nmatsakis> but you want to guarantee that Fixed Segment Size - Rust Stack Size > C Requirement
[20:17:26] <nmatsakis> and ideally you'd move it as far up the call chain as you could
[20:17:32] <nmatsakis> and guarantee that inequality holds
[20:17:38] <strcat> could you just add task::shrink_to_fit() and make it not shrink by default?
[20:17:47] <strcat> it doesn't seem like most programs need the stack to shrink
[20:17:53] <strcat> they're going to get to the peak again in that task
[20:17:53] <nmatsakis> well, I guess what I wrote doesn't quite make sense
[20:17:57] <graydon> pcwalton: this all seems reasonable to me. what's going wrong with the plan?
[20:18:08] <pcwalton> strcat is complaining that the perf is worse if you don't use #[fixed_stack_segment]
[20:18:12] <graydon> yes
[20:18:24] <nmatsakis> because it's not propagating upwards
[20:18:25] <brson> how can perf be worse than the old stack switching?
[20:18:26] <graydon> isn't that kinda expected?
[20:18:27] <nmatsakis> basically
[20:18:29] <brson> there is strictly less code
[20:18:31] <nmatsakis> ?
[20:18:33] <graydon> oh, I see. worse-worse?
[20:18:40] <pcwalton> brson: I thought you said upcall_new_stack was worse?
[20:18:40] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[20:18:40] <graydon> are we bouncing off malloc a lot? not caching properly?
[20:19:02] <graydon> it seems like grabbing a cached big-stack-segment ought to be about as fast as switching to the C stack.
[20:19:04] <pcwalton> we have to be careful with cache or you hit the scalability problem on 32 bit that brson pointed out
[20:19:05] <brson> pcwalton: oh, that's a good point. there is more code, but there is no branch prediction miss
[20:19:07] <graydon> maybe faster. similar anyway.
[20:19:20] <brson> but there's no marshalling of arguments
[20:19:31] <pcwalton> yeah, maybe it should be faster actually
[20:19:38] <pcwalton> there may just be a bug?
[20:19:40] <strcat> brson: there's an example in https://github.com/mozilla/rust/pull/6073
[20:19:43] <nmatsakis> so, can I ask a basic question here? I feel like I'm a bit confused.
[20:19:45] <strcat> I looked into it more after that
[20:19:56] <nmatsakis> when you have the fixed_stack_segment attribute
[20:19:58] <nmatsakis> how much stack space do you request?
[20:20:03] <nmatsakis> some constant?
[20:20:07] <graydon> "lots"
[20:20:19] <nmatsakis> because in that case it certainly doesn't make sense to propagate to a caller, right?
[20:20:22] * strcat really doesn't think it should shrink by default ;p
[20:20:24] <graydon> like a couple mb or so. as much as you'd get from C, I thought.
[20:20:27] <nmatsakis> well, because we overallocate, maybe it does
[20:20:33] <nmatsakis> but ignoring that
[20:20:35] <nmatsakis> if I request 2MB
[20:20:40] <strcat> graydon: 2MiB right now
[20:20:45] <strcat> it was 1MiB but that broke rusti
[20:20:47] <nmatsakis> or rather, if my caller requests 2MB and then I request 2MB
[20:20:50] <pcwalton> (btw, 2MB is ridiculously huge)
[20:20:53] <nmatsakis> since my caller's stack size is not zero
[20:20:56] <pcwalton> it should be like 4K
[20:20:57] <nmatsakis> I am guaranteed to allocate, right?
[20:21:01] <pcwalton> or 64K
[20:21:03] <pcwalton> or something like that
[20:21:03] <graydon> wait wait
[20:21:05] <strcat> pcwalton: for some functions
[20:21:16] *** Joins: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu)
[20:21:18] *** Joins: jgilbert (jgilbert@2557E599.66715431.D25A875A.IP)
[20:21:32] <nmatsakis> so what i'm saying is that what we *really* want is to inflate the direct caller's request, and then propagate that backward in decreasing amounts
[20:21:38] <nmatsakis> or something like that?
[20:21:44] *** Joins: jensnockert (Jens@moz-37847AE1.customers.ownit.se)
[20:21:46] <pcwalton> no
[20:21:52] <pcwalton> that hits the scalability problen.
[20:21:54] <pcwalton> problem.
[20:21:59] <nmatsakis> what is the scalability problem exactly?
[20:22:11] <nmatsakis> oh, just that everybody calls a native fn at some point?
[20:22:16] <pcwalton> what brson is concerned about is that there may be 10 million tasks that all infrequently call a native function
[20:22:18] *** Quits: engla (engla@moz-E4A8CEF5.customer.cdi.no) (Ping timeout)
[20:22:32] <brson> they can't all hold on to a big stack
[20:22:35] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[20:22:55] <strcat> they're all going to end up with a big stack because all rust calls into C
[20:23:04] <nmatsakis> I see.
[20:23:19] <pcwalton> for 10_000_000.times { do spawn { loop { if rand() < 0.0001 { call_c(); } sleep(10ms); } } }
[20:23:27] <nmatsakis> nonetheless, if I manually tag a function with #[big_stack]
[20:23:43] <nmatsakis> it doesn't seem like that really works
[20:23:50] <nmatsakis> because it requests the same size as the callee
[20:24:01] <pcwalton> nmatsakis: it overallocates.
[20:24:04] <pcwalton> to avoid this problem
[20:24:07] <graydon> because the outer caller will ask for 2mb and then the innermost C call will also ask for 2mb _more_?
[20:24:13] <nmatsakis> graydon: yes.
[20:24:14] <pcwalton> it overallocates by 50% or so
[20:24:23] <graydon> and so we wind up allocating 3mb?
[20:24:25] <pcwalton> yes
[20:24:34] *** Joins: _Vi (vi@527C345F.497AA854.B16B3BE6.IP)
[20:24:46] <graydon> that seems kinda odd. but I guess it's a small number of moving parts, which is an argument in favor.
[20:24:55] *** Quits: lmandel (lmandel@F2D29657.F60B0462.67AC9B1.IP) (Quit: lmandel)
[20:25:11] <nmatsakis> it is definitely hack-y, but I guess it probably works out in practice.
[20:25:29] <pcwalton> well, it doesn't, because of the bad perf numbers in https://github.com/mozilla/rust/pull/6073
[20:25:33] <graydon> the benchmark numbers in https://github.com/mozilla/rust/pull/6073 suggest it's not working, though?
[20:25:42] <pcwalton> but I don't know why
[20:25:42] <graydon> so what's actually going on there?
[20:25:42] <nmatsakis> not necessarily due to any of the things we've talked about :)
[20:26:03] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[20:26:10] <graydon> oh
[20:26:18] <graydon> that's putting fast_ffi on the C part, not the outer frame
[20:26:28] <pcwalton> both were tested
[20:26:35] <graydon> huh
[20:26:41] <strcat> would be so much easier just to use 8MiB stacks and let it do the page-by-page lazy allocation :p
[20:26:42] <pcwalton> what we don't know is why putting fast_ffi on the C part is slower than the current FFI.
[20:26:50] <strcat> and add task::shrink_to_fit to swap in a fresh stack
[20:26:53] <pcwalton> strcat: yes, that's what I want to do on 64 bit.
[20:27:02] <brson> I'm going to start a snapshot to get past this i686 breakage
[20:27:13] <graydon> brson: that will fix it?
[20:27:15] <graydon> by all means then
[20:27:18] <pcwalton> I don't know how you can "shrink to fit" without moving
[20:27:20] <pcwalton> the stack
[20:27:22] <nmatsakis> pcwalton: graydon: what do you mean by "the C part"?
[20:27:26] *** Quits: jensnockert (Jens@moz-37847AE1.customers.ownit.se) (Ping timeout)
[20:27:30] <pcwalton> nmatsakis: the extern fn.
[20:27:50] <brson> graydon: yes, I think so. the problem only manifests when starting from the i686 snapshot compiler and our bots bootstrap off the x86 compiler before building i686
[20:27:53] <nmatsakis> vs the wrapper or the shim?
[20:28:12] *** Joins: jensnockert (Jens@moz-37847AE1.customers.ownit.se)
[20:28:17] <pcwalton> putting it on the extern fn has the compiler add the attribute to the wrapper;.
[20:28:19] <nmatsakis> I guess there is no shim 
[20:28:21] *** kimundi is now known as zz_kimundi
[20:28:24] <strcat> pcwalton: so it's really just about VM usage on 32-bit
[20:28:29] <pcwalton> yes
[20:28:30] <nmatsakis> pcwalton: if it inlines it, basically?
[20:28:31] <graydon> brson: ok
[20:28:32] <pcwalton> that's what it's about
[20:28:36] <brson> hopefully the snapshot bot doesn't valgrind
[20:28:43] <pcwalton> nmatsakis: don't know what you mean about inlining
[20:28:44] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[20:28:44] <ghrust> 01[13rust01] 15brson merged 06incoming into 06snap-stage3: 02http://git.io/xsjdmw
[20:28:44] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[20:28:46] <graydon> brson: it does
[20:28:50] <brson> damn!
[20:28:52] <nmatsakis> pcwalton: you said the flag is propagated on inlining.
[20:28:56] <pcwalton> nmatsakis: oh yes, it is
[20:28:59] <nmatsakis> pcwalton: I presumed that you meant LLVM inlining
[20:29:00] <pcwalton> I noinlined the wrapper fn
[20:29:18] <brson> ok, I'm also looking into suppressing cond
[20:29:20] <graydon> brson: you can stop the build manually. weren't we just going to suppress Cond everywhere?
[20:29:35] <brson> it doesn't look like you can just put Memcheck:Cond into a suppression
[20:29:38] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[20:29:45] <pcwalton> brson: you can have a stack of *
[20:29:48] <nmatsakis> pcwalton: so, by "C" part, you really mean "the wrapper we generate when you declare an extern "C" fn"?
[20:29:52] <pcwalton> yes
[20:29:54] <brson> pcwalton: thanks I'll try that
[20:29:55] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[20:29:56] <nmatsakis> pcwalton: I am just trying to be sure, there are many layers involved.
[20:30:16] <graydon> brson: I think you need *
[20:30:17] <graydon> yeah
[20:30:28] <pcwalton> so I could just hack up LLVM so that you can specify with precision how much stack a function wants
[20:30:33] <pcwalton> like the gc pseudo-attribute
[20:30:43] <pcwalton> this would probably make upstream unlikely to accept our patch
[20:30:46] <nmatsakis> have we discussed this at all with LLVM people?
[20:30:50] <pcwalton> nope
[20:31:05] <pcwalton> I don't even know if that will help though
[20:31:25] <nmatsakis> with respect to being accepted?
[20:31:31] <pcwalton> no, regarding performance
[20:32:01] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[20:32:34] <nmatsakis> pcwalton: ok. I was just thinking about upstreaming.
[20:32:48] * pcwalton is frustrated by all of this
[20:32:57] <graydon> pcwalton: do wait, what's .. do we know _why_ the perf in that report is so bad?
[20:33:02] <pcwalton> no, we don't know why.
[20:33:10] <pcwalton> I'm tempted to suggest we just say spawn *always* gives you a big stack unless you call spawn_small or whatever
[20:33:23] <graydon> let's figure that out then. we have tools and stuff.
[20:33:32] <graydon> it might be something real facepalm
[20:35:15] <strcat> so if you have 20k tasks and half are in a call to C - won't that require a bunch of big stacks?
[20:35:45] <pcwalton> yup
[20:36:00] <graydon> yes. C is not forgiving about that.
[20:36:00] <strcat> won't you mostly be in a call to C whenever you're doing I/O though? I don't really see the point
[20:36:11] <strcat> unless rust reinvents libc and libuv like Go
[20:36:15] <graydon> thankfully most I/O will be scheduled by throwing stuff at uv and then descheduling yourself
[20:36:36] *** Quits: brson (brson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[20:36:51] <strcat> graydon: ~5 is a call to C, or all the memcpy/memmove calls
[20:36:51] <graydon> it's not going to _reinvent_ uv. it's going to _use_ uv. that is what brson is doing.
[20:37:00] * pcwalton is tempted to agree with walter bright that segmented stacks just aren't worth it, to be honest
[20:37:15] <strcat> graydon: but I mean - doesn't it have to then call into C in each task?
[20:37:33] <strcat> scaling on 32-bit doesn't seem like something that matters in 2013, tbh
[20:37:35] <graydon> strcat: not simultaneously
[20:37:39] <strcat> all this worry about something no one will ever need
[20:37:56] <strcat> a browser doesn't need 500k tasks
[20:37:59] <strcat> only a server does
[20:38:06] *** Joins: overlfo (Mibbit@3534C9F1.416EDEF2.8A6CD32E.IP)
[20:39:06] <Seldaek> strcat: hopefully rust gets used for more than a browser though
[20:39:27] <pcwalton> anyway, I'm not suggesting we remove segmented stacks
[20:39:32] <pcwalton> just that big stack be the default
[20:39:58] <pcwalton> that way, the *specialized* use cases that need small stacks can get them
[20:40:07] <pcwalton> and the majority of use cases will use big stacks and get good C perf
[20:40:10] <pcwalton> C-call perf
[20:40:22] <graham_king> pcwalton: You said something yesterday that you don't think of of Rust as having three types of pointer, but rather, euh, something about smart pointers. Would you mind repeating that?
[20:40:25] *** Joins: brson (brson@2557E599.66715431.D25A875A.IP)
[20:40:25] *** ChanServ sets mode: +o brson
[20:40:27] <strcat> phones are going to be 64-bit soon, they're already at 1/2GiB of memory
[20:40:31] <pcwalton> yup
[20:40:35] <pcwalton> even phones will be 64 bit
[20:40:45] <pcwalton> it's happening soon
[20:40:53] <graydon> ok but _we do not know why this is slow_
[20:41:05] <graydon> come on, this is a ridiculous arc for a conversation to take
[20:41:27] *** Quits: jviereck (Adium@moz-340574DC.dclient.hispeed.ch) (Quit: Leaving.)
[20:41:58] <pcwalton> that's true, we should profile
[20:42:33] <graydon> sure, we should all be on 128 bit architectues too, but the fast_ffi thing _should_ not be bouncing off malloc or, what, quadrupling runtime of a small test.
[20:42:44] <graydon> it's clearly not working as intended
[20:43:19] <strcat> well even with RUST_MIN_STACK, calling into C is very slow
[20:43:26] <strcat> it's not just about the stack segments
[20:43:28] <graydon> right. that makes no sense.
[20:43:39] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[20:43:48] <graydon> it's not supposed to be even transitioning stacks in that case, right?
[20:43:59] <graydon> if you have a huge stack and call a fast_ffi call, there's no switch, right?
[20:44:46] *** Joins: devinus (devinus@DAEC7122.372FE49C.29F95E0F.IP)
[20:45:19] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[20:45:35] <pcwalton> wait, calling into C is slow with RUST_MIN_STACK?
[20:45:40] <pcwalton> I didn't see that
[20:45:49] <pcwalton> is it just because it's not inlined?
[20:45:54] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[20:46:04] <pcwalton> I guess I can profile
[20:46:18] <strcat> pcwalton: just call sqrt() 100000 times in rust vs C
[20:46:25] <strcat> 1000000 times ;p
[20:46:30] <pcwalton> that's because I didn't noinline probably
[20:46:33] <pcwalton> fine, I'll work on that
[20:46:49] <pcwalton> err, that's because I *did* noinline
[20:49:42] <pcwalton> graydon: it's not quadrupling the runtime
[20:49:47] <pcwalton> 3.279s -> 4.188s
[20:50:08] <strcat> pcwalton: well, compared to doing stack switches
[20:50:18] <strcat> pcwalton: http://ix.io/5mm
[20:50:21] <graydon> 0.7s in-rust => 4s calling-c
[20:50:24] <strcat>  20.66%  foo  librustrt.so        [.] upcall_new_stack                                                                    
[20:50:26] <strcat>  18.69%  foo  librustrt.so        [.] upcall_del_stack                                                                    
[20:50:28] <strcat>  16.21%  foo  librustrt.so        [.] rust_task::new_big_stack()                                                          
[20:50:32] <strcat> huh what are those gray boxes
[20:50:39] *** Joins: lerc (quassel@moz-B7C43FE2.telstraclear.net)
[20:50:39] <strcat> oh that's perf's scrollbar ;p
[20:50:59] <graydon> right. what's going on there? is that us fetching a cached big-stack?
[20:51:07] <pcwalton> yes
[20:51:09] <graydon> can you instrument the big-stack thing to see if it's getting a cache hit?
[20:51:14] <pcwalton> yeah, I can
[20:51:15] *** Benvie1 is now known as Benvie_
[20:52:20] * graydon actually needs to have real lunch
[20:52:22] <graydon> back in a while
[20:53:46] *** Quits: Benvie_ (Thunderbir@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: Benvie_)
[20:53:59] <strcat> it's very good if you set RUST_MIN_STACK for this simple example
[20:54:03] <strcat> RUST_MIN_STACK=5000000 ./foo  0.05s user 0.01s system 97% cpu 0.061 total
[20:54:05] <strcat> vs
[20:54:07] <strcat> ./a.out  0.05s user 0.00s system 97% cpu 0.051 total
[20:54:14] *** Quits: jfredett (jfredett@moz-35CE0253.bstnma.east.verizon.net) (Ping timeout)
[20:54:34] <pcwalton> yeah, that's what i've seen
[20:54:37] <pcwalton> for the shootout
[20:54:45] <pcwalton> the lack of inlining of the wrapper didn't really matter
[20:54:55] <pcwalton> I guess the slow path needs to be optimized to not be so slow
[20:55:34] <pcwalton> maybe we should hack LLVM and pass the fixedstacksegment attribute around more aggressively
[20:55:34] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[20:55:55] <pcwalton> although honestly I don't want to do that, I'd rather just remove small stacks
[20:56:55] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[20:56:59] *** Quits: mzabaluev (mzabaluev@moz-F3BF265C.dhcp.inet.fi) (Quit:    )
[20:58:38] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[20:59:35] <graham_king> I'm getting an entering building doc/rust.pdf, at the end of make. http://dpaste.de/OdAcu/
[21:00:00] <strcat> pcwalton: calling malloc is really slow
[21:00:07] <graham_king> I think it's this: ! LaTeX Error: File fancyvrb.sty not found
[21:00:07] <strcat> much slower than in C
[21:00:10] <graham_king> This is latest incoming
[21:00:20] <pcwalton> strcat: with big stack or small stack?
[21:00:27] *** Quits: dherman (dherman@moz-C03D0C61.vlan426.asr1.sfo1.gblx.net) (Quit: dherman)
[21:00:36] <strcat> it's 2x as slow as C with a big stack
[21:00:40] <pcwalton> probably because malloc has far fewer cycles than sqrt
[21:00:49] <pcwalton> so the lack of inlining doesn't amortize.
[21:00:57] <strcat> makes sense
[21:01:11] <cyndis> graham_king: that file would be a part of the latex distribution
[21:02:09] <strcat> have to sprinkle volatile everywhere or clang removes this stuff ;p
[21:03:46] *** Joins: dherman (dherman@moz-BE33DA21.fw1.sfo1.mozilla.net)
[21:03:46] *** ChanServ sets mode: +o dherman
[21:03:59] <graham_king> cyndis: Thanks! Ubuntu package texlive-latex-recommended did the trick
[21:04:30] <cyndis> np
[21:07:26] *** Joins: steven_is_false (quassel@1E3F14AE.29819A33.115CE8E4.IP)
[21:08:25] <steven_is_false> So I'm back on the channel after figuring out how to fix my internet connection. I was asking "What is everyone else who's using Rust using for their matrix math?"
[21:09:23] *** Joins: jld (jld@moz-B94C75AD.xlerb.net)
[21:10:08] *** Joins: engla (engla@moz-E4A8CEF5.customer.cdi.no)
[21:10:12] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[21:11:29] *** Joins: echristo (echristo@moz-95318683.virtual1.co.uk)
[21:11:38] *** Quits: josh (josh@moz-98AA7282.nyc.res.rr.com) (Quit: josh)
[21:11:52] <steven_is_false> I wonder Rust has some support for Complex numbers right (or is going to?) And complex numbers are simply a subset of the 2 by 2 matrices. Is there a way to implement matrices using complex numbers?
[21:11:57] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[21:12:33] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[21:13:26] *** Quits: azita (Azita@2557E599.66715431.D25A875A.IP) (Quit: azita)
[21:16:53] <steven_is_false> rusti: Cmplx { re: 0, im: 0 }
[21:16:54] <rusti> more than 5 lines of output, pastebinned: http://sprunge.us/Ejji
[21:17:13] <steven_is_false> rusti: std::complex::Cmplx { re: 0, im: 0 }
[21:17:14] <rusti> more than 5 lines of output, pastebinned: http://sprunge.us/JEXO
[21:17:33] <steven_is_false> rusti: use std::complex::*; Cmplx { re: 0, im: 0 }
[21:17:34] <rusti> more than 5 lines of output, pastebinned: http://sprunge.us/AFFM
[21:18:46] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[21:18:46] <ghrust> 01[13rust01] 15jbclements 04force-pushed 06try from 14cb88d0a to 145d605a7: 02http://git.io/k471pw
[21:18:46] <ghrust> 13rust/06try 14640c1a6 15John Clements: change stage1,stage2,stage2 into not(stage0)...
[21:18:46] <ghrust> 13rust/06try 1437766e2 15John Clements: refactoring mod.rs
[21:18:46] <ghrust> 13rust/06try 1414009ae 15John Clements: parser comments only
[21:18:46] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[21:19:35] <steven_is_false> So the complex number type is generally faster than just using a tuple right? Or is hardware support not implemented but will be?
[21:20:47] <strcat> steven_is_false: it could just call the c99 functions
[21:20:54] <strcat> it doesn't right now
[21:21:08] *** Quits: Sodel_the_V (user@moz-853663E1.va.shawcable.net) (Input/output error)
[21:21:31] <steven_is_false> strcat: Okay but it will be faster than a pure Rust implementation in the future.
[21:21:41] <strcat> probably
[21:21:42] <Ralith> steven_is_false: consumer hardware has no special support for complex numbers.
[21:21:58] <Ralith> anything you could do to optimize them, you could also do to optimize a tuple of the same size
[21:22:21] <steven_is_false> Ralith: oh okay.
[21:22:34] *** Joins: BigEndian (hurp@moz-1B6DD81E.members.linode.com)
[21:22:49] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[21:23:06] <Ralith> C defines a special calling convention for them, but that shouldn't matter to rust except at the interface to C
[21:24:25] <strcat> it can/does use vector instructions though
[21:24:36] *** Joins: Thad (chatzilla@moz-C35F90AE.tx.res.rr.com)
[21:25:15] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[21:25:20] <strcat> a + b is a.x + b.x and a.y + b.y in parallel
[21:25:22] <strcat> can use sse
[21:25:27] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[21:25:38] * strcat shrugs ;p
[21:26:33] *** Quits: jensnockert (Jens@moz-37847AE1.customers.ownit.se) (Quit: jensnockert)
[21:28:53] *** Joins: SiegeLord (sl@moz-56D7E78.bstnma.fios.verizon.net)
[21:30:08] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[21:30:18] *** Joins: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP)
[21:30:18] *** ChanServ sets mode: +o tjc
[21:30:36] <Ralith> strcat: and you can, of course, use SSE for any other supported operations on any other suitably structured data.
[21:32:51] *** Joins: jfredett (jfredett@moz-DB339AE7.mycingular.net)
[21:33:53] <steven_is_false> I wonder if Cmplx <Cmplx <T>> does the right thing? Or if one has to take a more complicated path.
[21:34:20] *** Quits: devinus (devinus@DAEC7122.372FE49C.29F95E0F.IP) (Quit: Textual IRC Client: www.textualapp.com)
[21:34:37] *** Quits: jfredett (jfredett@moz-DB339AE7.mycingular.net) (Ping timeout)
[21:35:09] <brson> tjc: are you or pnkfelix doing anything futher on that out-of-stack issue?
[21:36:34] *** Quits: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP) (Ping timeout)
[21:36:55] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[21:36:56] <steven_is_false> There's a popular really fast matrix library written in fortran out there. Does anyone remember it's name?
[21:37:22] <strcat> blas?
[21:37:30] <steven_is_false> strcat: That might be it.
[21:37:36] *** Joins: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP)
[21:37:36] *** ChanServ sets mode: +o tjc
[21:38:33] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[21:38:38] *** Quits: rntz_ (rntz@moz-C76A8D96.sp.cs.cmu.edu) (Input/output error)
[21:39:10] *** Joins: FrozenCow (FrozenCow@moz-9DF5D010.dynamic.upc.nl)
[21:39:16] <Ralith> steven_is_false: you should read the things I said
[21:39:53] *** Quits: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu) (Client exited)
[21:39:58] <steven_is_false> Ralith: I don't follow.
[21:40:26] *** Joins: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu)
[21:40:35] <Ralith> 14:21:51 < Ralith> steven_is_false: consumer hardware has no special support for complex numbers.
[21:40:38] <Ralith> 14:22:07 < Ralith> anything you could do to optimize them, you could also do to optimize a tuple of the same size
[21:40:53] <Ralith> thus, you should not be abusing complex numbers for things for which they were not built.
[21:41:45] *** Quits: bnicholson (bnicholson@moz-BE33DA21.fw1.sfo1.mozilla.net) (Ping timeout)
[21:42:05] <steven_is_false> Ralith: A! I'm probable going to just bind to an existing library. B! My reasoning was that complex numbers can be constructed as matrices as the form 
[21:42:12] *** Quits: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu) (Ping timeout)
[21:42:37] <steven_is_false> a[ 1, 0, 0, 1] + b[0, 1, 1, 0] so using complex numbers to implement matrices might be practical.
[21:42:43] <steven_is_false> C! It'd be funny.
[21:43:03] <Ralith> you should implement matrices with linked lists
[21:43:05] <Ralith> that'd be funny too
[21:49:31] <graham_king> Is there a way to find all the methods I can call on, say, an int. i.e. what all the traits have added?
[21:50:16] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[21:51:48] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[21:52:08] *** Joins: jfredett (jfredett@moz-6643F028.mycingular.net)
[21:54:58] *** Joins: Nawfel (Mibbit@6EAA75CA.B1D7CE02.DFAB1F33.IP)
[21:56:15] *** Joins: SimonSapin (simon@moz-C4A83ED9.net-89-2-126.rev.numericable.fr)
[21:57:33] *** Quits: saml (sam@moz-14C16814.cst.lightpath.net) (Quit: Leaving)
[21:58:58] *** Joins: jaen (jaen@moz-A81FFD2D.internetdsl.tpnet.pl)
[21:59:43] *** Joins: bnicholson (bnicholson@moz-BE33DA21.fw1.sfo1.mozilla.net)
[22:02:06] *** Quits: FrozenCow (FrozenCow@moz-9DF5D010.dynamic.upc.nl) (Client exited)
[22:02:20] *** Joins: rntz_ (rntz@moz-C76A8D96.sp.cs.cmu.edu)
[22:03:02] <graham_king> If anyone has the time, I'd love comments / corrections on blog post: http://www.darkcoding.net/software/rust-what-i-learnt-so-far/
[22:03:25] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[22:03:48] *** Quits: webber46 (webber46@moz-F6310FF0.lha.sgsnet.se) (Quit: webber46)
[22:05:47] <tjc> graham_king: reading it
[22:06:08] <tjc> graham_king: under "Ask your name", I think you meant to put "let x = 10;" instead of "x = 10;" after "here's some declarations:"
[22:06:14] <tjc> since x = 10; would be a statement rather than a declaration
[22:06:24] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[22:06:43] <tjc> "You use it for static strings too" is a bit confusing, a static string would be: let name = "Bob";
[22:06:49] <tjc> perhaps you mean string literals
[22:06:56] <doy> graham_king: using ~str for parameters where not necessary is a bit odd
[22:07:00] <pcwalton> brson: r? https://github.com/mozilla/rust/pull/6080
[22:07:02] *** Quits: RagingDave (RagingDave@moz-68D29883.pools.arcor-ip.net) (Quit: Ex-Chat)
[22:07:12] <graham_king> tjc: I do wantx x=10 it on a separate line, to show type inference. I'll fix the language though.
[22:07:25] <doy> fn ask_name(prompt: &str) -> ~str is probably more what you want
[22:07:29] <tjc> doy: I think it's fine to use ~str consistently as part of introducing the language w/o have to talk right away about several different string types
[22:07:35] <doy> i suppose
[22:07:52] <doy> it's just more likely to do unexpected things if you try to tweak the example at all
[22:08:00] <doy> which may be confusing
[22:08:02] <doy> but shrug
[22:08:07] <tjc> graham_king: reading on, "~ means only one place will ever point at that memory" is a bit misleading
[22:08:18] <tjc> since borrowed pointers mean that more than one place can point at the contents of a ~
[22:08:23] <graham_king> doy: Yes I was trying to stick with one pointer type at first
[22:08:49] <brson> tjc: are you or pnkfelix doing anything futher on that out-of-stack issue?
[22:09:10] <tjc> brson: I'm not, but I did push a commit to revert those patches...
[22:09:18] <doy> graham_king: it'd be useful to note that using %d, etc with fmt! is actually type-checked
[22:09:21] <doy> unlike printf in c
[22:09:22] <tjc> bors seems to be stuck (or the buildbot seems to be stuck), I'm not sure
[22:09:36] *** Joins: int3_ (int3_@moz-9420730E.subnet-248.amherst.edu)
[22:10:27] <strcat> tjc: pretty sure we just need to force the build bors wants
[22:10:29] <graham_king> tjc: Darn you're right about "one thing pointing". I'll re-write that bit
[22:10:30] <tjc> graham_king: it's a minor point, but we're planning on removing .rc files; everything will be an .rs
[22:10:47] <tjc> (wrt "Use an external module - sqlite3")
[22:11:26] *** Quits: jfredett (jfredett@moz-6643F028.mycingular.net) (Ping timeout)
[22:11:42] *** Quits: guitsaru_ (guitsaru@A8985A22.5DF68D0E.4C2245EF.IP) (Client exited)
[22:11:42] <tjc> graham_king: those were the only things that jumped out on me on a quick read. looks good! I think the more people who write introductory posts like this, the better, since different explanations will appeal to different people
[22:12:04] <graham_king> Thanks a lot tjc and doy! Updating now.
[22:12:32] <tjc> Does anyone know of a good way to download github issues for offline reading?
[22:12:35] <tjc> ghi doesn't seem to support it
[22:13:07] <brson> I'm going to raise the maximum stack size to 1GB
[22:13:12] <brson> from 8MB
[22:13:33] *** Quits: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP) (Quit: night)
[22:13:59] <strcat> brson: could you just rm it?
[22:14:19] <strcat> oom is no worse than sudden death ;p
[22:14:20] <pcwalton> it's still nice to detect infinite looping
[22:14:27] <brson> strcat: oom is awful!
[22:14:50] * strcat shrugs
[22:14:54] *** zz_kimundi is now known as kimundi
[22:14:58] <brson> the linux oom killer decides to kill your x session
[22:15:03] <brson> or other useful process
[22:15:09] <strcat> brson: it hasn't ever done that to me ;p
[22:15:37] <strcat> X is a long-running process so it has a really low score
[22:15:49] <brson> there's a good argument for not having a limit, but I've oom'd so many times while working on the runtime ...
[22:16:59] *** Joins: seth (seth@moz-BE33DA21.fw1.sfo1.mozilla.net)
[22:17:16] *** Joins: wilmoore_ (wilmoore@moz-7EE4D9D6.mystrotv.com)
[22:17:17] *** Quits: cdidd (cdidd@moz-1D7DA2DB.broadband.corbina.ru) (Ping timeout)
[22:17:24] <Seldaek> strcat: I've had oomkiller lock me out of servers in the past due to a rogue java server leaking memory :/
[22:17:34] <cantsin> hey guys! love rust. quick question, i was trying to make a closure that captures a mutable variable and couldn't. eventually ran into: 
[22:17:34] <cantsin> https://github.com/mozilla/rust/issues/4093 ... but the suggested fix, let x = ~mut ... seems to be deprecated.
[22:17:42] <cantsin> anything i can do to work around this?
[22:17:46] <strcat> Seldaek: how does it lock you out of the server? ;\
[22:17:53] <pcwalton> cantsin: try core::cell::Cell
[22:18:03] <cantsin> pcwalton: awesome, thanks :)
[22:18:10] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[22:18:10] *** Quits: wilmoore (wilmoore@moz-1248C037.mystrotv.com) (Ping timeout)
[22:18:11] <Seldaek> strcat: oomkiller decides to blast sshd 
[22:18:12] *** Joins: thou (thou@moz-D1EE62D4.sumnetsol.com)
[22:18:18] <strcat> Seldaek: it won't
[22:18:26] <Seldaek> oh it did..
[22:18:39] <Seldaek> maybe this is not happening anymore these days
[22:18:51] <strcat> well I'm wondering how you can misconfigure it to make it do that...
[22:18:52] <graham_king> doy: When you say the fmt params (%d etc) are type checked, you mean at compile time?
[22:19:04] <strcat> it's pretty impossible for ssh to have an oom score that's anything but tiny
[22:19:32] <doy> rusti: fmt!("%d", "foo")
[22:19:34] <tjc> graham_king: yes, fmt is a macro that expands into regular Rust code that uses a typed representation of the format string instead of a string literal...
[22:19:35] <rusti> more than 5 lines of output, pastebinned: http://sprunge.us/AdAI
[22:19:41] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[22:19:45] <doy> graham_king: ^^
[22:19:45] <tjc> and typechecking happens after macro expansion, so it's checked at compile time
[22:19:53] <tjc> this is also how Haskell and ML do printf
[22:20:08] <graham_king> Very nice
[22:20:15] <tjc> (though in ML it's built-in rather than using a more general macro system)
[22:20:25] <Seldaek> strcat: well it was a while back, I just remember having to hard reset the box to be able to go back in, then saw it wrecked havoc in the syslog
[22:21:23] <strcat> and hopefully you have sshd excluded from oom killing now? ;p
[22:21:48] <strcat> anyway it shouldn't do that
[22:22:28] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[22:23:47] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[22:24:17] <Seldaek> strcat: I stopped trusting openjdk is what I did:p
[22:24:31] <Seldaek> but yes I can imagine it's not the intended behavior
[22:24:54] *** Quits: dforsyth (dforsyth@AC76BBB4.5FDB5121.EE6E63A5.IP) (Quit: leaving)
[22:26:11] <strcat> rusti: fn foo() { do spawn { foo() } }; foo()
[22:26:27] <strcat> rusti: 1
[22:26:28] <rusti> 1
[22:26:31] <strcat> heh that just times out
[22:26:43] <strcat> rusti: fn foo() { let x = ~[1, 2, 3]; do spawn { foo() } }; foo()
[22:26:53] <strcat> rusti: 1
[22:26:55] <rusti> 1
[22:26:56] <strcat> stupid bot ;p
[22:27:09] <strcat> rusti: fn foo() { let x = ~[1, 2, 3]; loop { do spawn { foo() } } }; foo()
[22:27:12] <rusti> more than 5 lines of output, pastebinned: http://sprunge.us/QAHZ
[22:27:24] <strcat> rusti: fn foo() { let _x = ~[1, 2, 3]; loop { do spawn { foo() } } }; foo()
[22:27:31] <rusti> -bash: line 1:    16 Killed                  ./foo
[22:28:02] *** Joins: dforsyth (dforsyth@AC76BBB4.5FDB5121.EE6E63A5.IP)
[22:29:49] *** Quits: donri (dag@moz-9BB61102.tbcn.telia.com) (Quit: Leaving)
[22:30:31] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[22:30:33] *** Joins: Jesin (Jessin_@moz-1866A4CC.cc.lehigh.edu)
[22:30:33] *** Quits: Jesin (Jessin_@moz-1866A4CC.cc.lehigh.edu) (Quit: Leaving)
[22:33:27] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[22:34:33] *** Joins: passcod (passcod@moz-5BCF5019.passcod.name)
[22:37:27] <strcat> Seldaek: http://ix.io/5mt shows the order it will kill stuff
[22:37:32] <strcat> highest first
[22:39:12] <strcat> oom_score_adj makes it ignore a % of the process memory
[22:39:15] <strcat> -1000 means it will never kill it
[22:41:30] *** Quits: spider-mario (spidermari@moz-EE4B8A09.rev.sfr.net) (Input/output error)
[22:42:00] <strcat> it's possible really old kernels used VM instead of RSS + SWAP
[22:43:23] <steven_is_false> Ugh, The implementation of Add for complex numbers requires far too much on it's parameters.
[22:45:08] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[22:46:18] <bjz> bheylin: ping
[22:46:43] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[22:47:02] *** Quits: Nawfel (Mibbit@6EAA75CA.B1D7CE02.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:50:45] <graydon> grrrr buildbot!!!!
[22:51:16] <strcat> brson: it could write 1000 to /proc/self/oom_score_adj ;p
[22:51:27] <strcat> after going over a limit
[22:51:42] <graydon> I seriously don't know what to do about buildbot
[22:51:46] <graydon> it is going to keep doing this
[22:52:03] <tjc> why does buildbot get stuck?
[22:52:31] *** Quits: btipling (btipling@moz-5413CFA4.hsd1.ca.comcast.net) (Quit: Computer has gone to sleep.)
[22:52:35] <graydon> it builds the wrong rev
[22:52:51] <graydon> it builds the wrong rev
[22:53:03] <graydon> I just .. grr. I am furious at it. window-throw-through furious. everything else works.
[22:53:10] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[22:53:55] <tjc> that's the problem with software, you can't defenestrate it
[22:55:52] <brendanc> the git plugin is pretty dumb in my experience, but you could try using the master-side git step, I think it gets a bit more attention than the default slave-side one
[22:56:21] <steven_is_false> git defenestrate?
[22:56:46] *** bhearsum is now known as bhearsum|afk
[22:56:50] <cantsin> man, i would pay real money for git defenestrate
[22:57:06] <brendanc> git push :master
[22:57:58] <cantsin> with -f! but something like that, yea ;)
[22:58:20] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[22:59:24] *** Joins: dbaupp (Thunderbir@moz-53CF57B9.lns20.syd6.internode.on.net)
[22:59:54] <tjc> git defenestrate --hard
[23:00:04] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[23:00:09] *** Joins: dylukes (dylukes@moz-EB1BE0DD.oakland.resnet.pitt.edu)
[23:00:45] * strcat has a long alias to clear the reflog that could be called 'defenestrate' ;p
[23:02:02] *** Quits: mhi (mhi@moz-4814EA55.sanctioned.net) (Client exited)
[23:03:07] <brendanc> hard to tell just from looking at the buildbot page what's wrong
[23:03:49] <tjc> graydon: so the problem is that bors asks for revision A, buildbot builds revision B, and bors waits forever for something that buildbot never does?
[23:04:18] <graydon> yes
[23:04:30] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Client exited)
[23:04:35] <graydon> brendanc: bors pushes M=merge(A,B)
[23:04:39] <graydon> brendanc: buildbot builds A
[23:04:43] <just_bstrie> I feel like the "Demode everything" PR should have a higher priority :)
[23:04:45] <graydon> never M
[23:04:51] <tjc> this is obvious enough that there's probably a reason why bors doesn't do it but could it just retry the request to build A after a certain amount of time if there's no response?
[23:05:02] <graydon> bors does not request anything
[23:05:07] <graydon> it changes the auto branch
[23:05:08] <graydon> to point to M
[23:05:10] <graydon> buildbot never builds M
[23:05:15] <graydon> it builds A
[23:05:20] <tjc> oh; it's buildbot's job to poll the auto branch?
[23:05:21] <graydon> which is "close"
[23:05:22] <graydon> yes
[23:05:26] <graydon> but it's not M
[23:05:29] <tjc> ah ok
[23:05:31] <graydon> which is what bors pushed, and is waiting for
[23:06:17] <strcat> doesn't bors force-push after something fails?
[23:06:21] <strcat> back to the old commit
[23:06:36] <graydon> if something _fails_
[23:06:39] <graydon> it doesn't see failure though
[23:06:46] <graydon> it sees "huh, weird, buildbot sure is taking its time building M"
[23:06:48] <graydon> buildbot never builds M
[23:06:53] <Thad> graydon: why would it possibly build the wrong revision ?  how does it know what it built 5 minutes ago ?  does it build sequentially, one rev at a time ?
[23:06:55] <strcat> doesn't buildbot see the reset to the parent?
[23:07:09] <graydon> buildbot sees auto move from some-other-rev to M
[23:07:14] <graydon> M=merge(A,B)
[23:07:16] <graydon> it decides to build A
[23:07:21] <graydon> I have no idea why
[23:07:30] <strcat> well
[23:07:33] <graydon> A is not the tip
[23:07:37] <strcat> oh.
[23:07:42] *** Joins: pascal (pascal@moz-3A678551.pascalj.de)
[23:07:50] *** Joins: webber46 (webber46@moz-F6310FF0.lha.sgsnet.se)
[23:07:54] <graydon> M is. when buildbot schedules a change, it is looking at a git rev with M=merge(A,B) as the tip
[23:07:57] <graydon> of auto
[23:08:03] <graydon> if you do git ls-remote origin auto
[23:08:04] <graydon> you get M
[23:08:06] <graydon> not A
[23:08:09] <graydon> but buildbot built A
[23:08:14] <graydon> it does this regularly
[23:08:18] <graydon> about once every 24h
[23:08:20] <strcat> could we replace this doc/prep.js script with pandoc's code highlighting? that seems to mostly be what it does
[23:08:22] <graydon> sometimes once every 2h
[23:08:55] <brendanc> how is it polling?
[23:08:57] <Thad> graydon: do yo suspect a buildbot bug ?  what's it coded in ?
[23:10:00] *** Quits: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP) (Quit: Places to go, people to annoy)
[23:10:17] <graydon> python. maybe a bug, maybe me misconfiguring it.
[23:10:22] <Thad> merge (A,B) ... hmmm... merge (A with B(if you have it around...otherwise you just building A?)
[23:10:43] <brson> strcat: yes. I think I have an issue somewhere with my thoughts on what to do with prep.js
[23:10:46] <Thad> B is not around ?  it can't find B ... so the M ... really is just A
[23:10:55] <graydon> Thad: I can't understand what you're asking
[23:10:55] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[23:11:04] <brson> strcat: https://github.com/mozilla/rust/issues/3546
[23:11:17] *** Joins: igork (igork@moz-408E26BD.broadband.corbina.ru)
[23:11:18] <Thad> graydon: I'm helping you think through the problem.
[23:11:24] *** Joins: wilsonk|2 (kvirc@moz-39EFBFC2.cg.shawcable.net)
[23:12:00] <Thad> graydon: perhaps it is not deciding to build A directly... but is in fact merge (A + nothing for B) ?
[23:12:11] <Thad> B
[23:12:33] <brendanc> buildbot will normally build the latest thing it can find (on the branch it's watching), after waiting some small amount of time for more changes to arrive
[23:12:34] *** Quits: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[23:12:36] <graydon> no. a merge rev is a fresh rev in git.
[23:12:38] *** Joins: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP)
[23:12:38] *** ChanServ sets mode: +o tjc
[23:13:02] *** Quits: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com) (Quit: Scriptor)
[23:13:05] <brendanc> how is buildbot polling github?
[23:13:21] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[23:13:24] <graydon> brendanc: yeah. I have it configured with a gitpoller feeding changes into an anybranchscheduler on a 60 second treestabletimer
[23:14:24] <graydon> and from there, requests are fed to a builder with mergerequests=true
[23:14:26] <Thad> what if there are no changes for 20 minutes ?
[23:14:44] <graydon> Thad: no changes, no builds
[23:16:07] <graydon> http://buildbot.rust-lang.org/builders/auto-mac/builds/964
[23:16:10] <graydon> is a successful build
[23:16:15] <graydon> note the last change is a bors-written merge
[23:16:24] <graydon> http://buildbot.rust-lang.org/builders/auto-mac/builds/968
[23:16:26] <graydon> is an unsuccessful one
[23:16:33] <graydon> where buildbot decided to build one of the intermediate nodes
[23:16:36] <strcat> should just write a new buildbot ;p
[23:16:38] <graydon> not the merge that bors wrote after that
[23:18:11] <brendanc> one hack might be to install a change_filter to look for bors tags or something
[23:19:17] <graydon> was thinking I might do that; not sure what the effect would be
[23:19:36] <graydon> wouldn't that ... um ... show the wrong thing?
[23:19:45] <brendanc> ?
[23:19:53] <brendanc> I think the bad outcome is buildbot would build nothing at all
[23:21:09] <brendanc> I think it's probably the poller. I don't see the change on the left of the main waterfall
[23:21:10] <graydon> I mean, wouldn't it show (on its display) only bors change objects, not any of the others included in a group?
[23:21:12] <graydon> maybe it's ok
[23:21:24] <graydon> the main waterfall?
[23:21:26] <brendanc> the change filter would go on the scheduler
[23:21:34] <brendanc> http://buildbot.rust-lang.org/waterfall
[23:21:44] <graydon> yeah, I realize that. but it feeds filtered changes into the builder, no?
[23:21:49] *** Quits: victorporof (victorporo@60366CE7.67CDC207.79933D60.IP) (Quit: victorporof)
[23:21:57] <graydon> so if I had a change sequence say from tim, tim, tim, bors arrive
[23:22:06] <graydon> only the bors one would show up in the display, in the web ui
[23:22:11] <graydon> (not the end of the world?)
[23:22:33] <brendanc> no, I think it records all the changes the poller saw, it just doesn't schedule until the filter oks a change
[23:23:07] <graydon> hm. ok.
[23:23:17] <graydon> the filter_fn should return true if I want to accept the change?
[23:23:21] *** Parts: mrbkap (mrbkap@moz-C03D0C61.vlan426.asr1.sfo1.gblx.net) (Leaving)
[23:23:23] <pcwalton> graydon: r? https://github.com/mozilla/rust/pull/6084
[23:23:39] <graydon> brendanc: something like:  filter_fn=(lambda c: "bors" in c.who)
[23:23:40] <graydon> ?
[23:23:40] <brendanc> why are the changes on the left all on 'try' though?
[23:23:48] <graydon> brendanc: 'try' is a different branch
[23:24:04] <graydon> used for individuals running checks to see if their code works, interactively, not attempting a landing
[23:24:31] *** Quits: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP) (Quit: buildmaster reconfigured: bot disconnecting)
[23:24:38] *** Joins: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP)
[23:24:54] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[23:25:08] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[23:25:37] <brendanc> confused about why http://buildbot.rust-lang.org/changes/1401 is on 'try'
[23:25:49] <graydon> !
[23:25:57] <graydon> that smells like _bug_
[23:26:01] <graydon> nobody pushed that to try
[23:26:22] <graydon> *sigh* I need to upgrade buildbot on this machine
[23:26:40] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[23:27:14] <steven_is_false> Okay bye guys
[23:27:17] *** Quits: steven_is_false (quassel@1E3F14AE.29819A33.115CE8E4.IP) (Client exited)
[23:27:39] <Thad> building something now... http://buildbot.rust-lang.org/waterfall?branch=master&refresh=15
[23:27:53] <graydon> Thad: I know. I forced it.
[23:27:57] <brendanc> it's on 'try' in github too
[23:28:01] <Thad> graydon: oh, lol
[23:28:11] <graydon> brendanc: !
[23:28:28] <brendanc> https://github.com/mozilla/rust/commits/try don't know how to link but it's at the top of apr 25
[23:28:59] <graydon> wait wait
[23:29:36] <graydon> that's fine; bors merges do show up in the history
[23:29:48] <brendanc> if it's also on auto I wonder if something is filtering out changes that have already been seen regardless of what branch they were on
[23:30:17] *** Quits: lkuper (lkuper@moz-D6AAFF3.cs.indiana.edu) (Ping timeout)
[23:30:42] <brendanc> the thing that looks suspicious to me is the buildbot is only showing changes on the try branch
[23:30:59] <graydon> where is buildbot only showing changes?
[23:31:09] <graydon> I don't see that happening at all; it regularly shows changes on other branches
[23:31:19] <brendanc> left column of the waterfall
[23:31:44] <graydon> shows changes all over the waterfall
[23:32:16] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[23:32:22] <graydon> http://buildbot.rust-lang.org/waterfall I see changes in every column
[23:32:46] <brendanc> I'm talking about the leftmost column, with the header "changes"
[23:33:03] <brendanc> it should have every change discovered by a poller
[23:33:11] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[23:33:11] <brendanc> every change I click on is on the 'try' branch
[23:33:51] <Thad> http://buildbot.rust-lang.org/changes  <-- it's polling all the branches correctly it seems
[23:34:20] <brendanc> well, it has pollers. It's not clear any of them are doing anything but the try poller :)
[23:35:01] *** Quits: overlfo (Mibbit@3534C9F1.416EDEF2.8A6CD32E.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[23:35:08] <graydon> hmm
[23:35:14] <Thad> oh that's cool... you can wait and hover your mouse over the Grey colored Changes links on that left most column to get details.
[23:35:27] <brendanc> btw you should be able to configure GitPoller with 'branches' instead of having n gitpollers
[23:35:56] <graydon> rustbuild@rust1:~/bot/master/gitpoller-workdir-auto$ git status
[23:35:56] <graydon> # On branch auto
[23:35:56] <graydon> nothing to commit (working directory clean)
[23:35:57] <graydon> rustbuild@rust1:~/bot/master/gitpoller-workdir-auto$ git log -n 1 --oneline
[23:35:57] <graydon> d72ca65 auto merge of #6067 : catamorphism/rust/revert, r=catamorphism
[23:36:04] <graydon> looks like auto is tracking auto
[23:36:14] <graydon> brendanc: this is buildbot 0.8.5
[23:36:20] <graydon> I don't think it's new enough to know that
[23:36:31] <graydon> though I realize I should update it :((
[23:36:39] <brendanc> ah right
[23:36:44] <graydon> I have other stuff always on the go. kinda the lowest priority task. or has been.
[23:36:51] <graydon> since this is perpetually wedging, it's going up
[23:38:13] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[23:38:36] <graydon> the other problem is I had to hack up 0.8.5 to make it work with ec2 properly
[23:38:42] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[23:38:47] <graydon> and hack up the console display
[23:38:50] <brendanc> it still looks weird to me that the only changes on the waterfall are on try
[23:38:53] <graydon> and ... we have people depending on the live system
[23:39:02] <graydon> so updating means shutting down all development during the upgrade
[23:39:03] <Thad> graydon: yeah, you probably want to upgrade... issue -> http://trac.buildbot.net/ticket/2336
[23:39:57] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[23:41:07] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[23:41:47] <tjc> brson: re: that commit...
[23:42:01] <tjc> good point about the termination conditions, I thought checking for equality with "/" or "." was pretty sketchy
[23:42:06] *** Quits: vosen (vosen@moz-266BA656.icpnet.pl) (Quit: Leaving)
[23:42:13] <tjc> but I couldn't figure out if there was something in Path that says "is this directory a root directory?"
[23:42:16] <tjc> if you know what I mean
[23:43:25] <brson> tjc: me either. I read the path code for a few minutes before deciding to just say, "I don't know if this works"
[23:43:59] <brendanc> what's scheduler 'auto-sched' look like?
[23:44:00] <tjc> heh, well, I'm pretty sure you're right, it won't work on Windows
[23:44:07] <tjc> but I guess when the tests run it will tell me that for sure
[23:44:12] <tjc> anyway, I'll stare at the path code some more
[23:44:14] <tjc> gtg for now
[23:50:02] <brendanc> don't suppose the buildbot config is online somewhere?
[23:50:49] *** Quits: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP) (Ping timeout)
[23:50:58] *** Parts: graham_king (graham_kin@moz-61791D81.vc.shawcable.net) ()
[23:51:17] *** Joins: bent (chatzilla@FD70298F.80D059BC.C713DB88.IP)
[23:51:18] *** Quits: tjc (tjc@A5087023.2354C43D.D8E68FF6.IP) (Quit: Places to go, people to annoy)
[23:52:14] *** Quits: mschifer (Adium@2557E599.66715431.D25A875A.IP) (Quit: Leaving.)
[23:53:16] *** Joins: geomyidae_ (geomyidae@9FDA6BE2.37A86C23.448B98CC.IP)
[23:55:57] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[23:55:57] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d72ca65 to 1464412ec: 02http://git.io/N3iJvQ
[23:55:57] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[23:55:58] *** Joins: ghrust (ghrust@moz-4EF5B6E5.rs.github.com)
[23:55:58] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/gDM1SA
[23:55:58] <ghrust> 13rust/06auto 142c99e3d 15Brian Anderson: Suppress all 'cond' errors in valgrind. #5856
[23:55:58] <ghrust> 13rust/06auto 14b67a7b9 15bors: auto merge of #6077 : brson/rust/valgrind, r=brson
[23:55:59] *** Parts: ghrust (ghrust@moz-4EF5B6E5.rs.github.com) ()
[23:56:04] <pcwalton> yay, bors!
[23:56:16] *** Quits: dylukes (dylukes@moz-EB1BE0DD.oakland.resnet.pitt.edu) (Quit: Computer has gone to sleep.)
[23:56:44] *** Joins: steven_is_false (quassel@moz-9E02CE84.bchsia.telus.net)
[23:57:28] <steven_is_false> rusti: 4 / 4
[23:58:47] <strcat> steven_is_false: he's undergoing minor surgery ;p
[23:58:59] *** Quits: bnicholson (bnicholson@moz-BE33DA21.fw1.sfo1.mozilla.net) (Ping timeout)
[23:59:56] <steven_is_false> strcat: Okay. Can you help me then? I was just going to try out various division operations to see how division works. I seem to be having trouble implementing the Div trait in the latest incoming.
