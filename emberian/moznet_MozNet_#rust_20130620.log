[00:00:02] <aatch> Also, there are cases where Rust is as fast or faster than functionally-equivalent C or C++ code.
[00:00:12] <strcat> graydon: you can segfault Go with "safe" code
[00:00:12] <graydon> I think they're reasonably systems-language-y. we have our weird bits too.
[00:00:13] <strcat> ;p
[00:00:14] <Eridius> Go doesn't protect you from data races, but it tries to protect you from other memory issues
[00:00:20] <tiffany> earnestly: all of the cases I've seen, rust has been competitive with C/C++
[00:00:24] <graydon> strcat: I know
[00:00:28] <tiffany> the type system has no runtime cost
[00:00:30] <Earnestly> tiffany: Really?
[00:00:34] <xenocons> i uh
[00:00:41] <tiffany> and both rustc and clang use llvm
[00:00:45] <xenocons> i dont want to start a language war so i wont tlak about go and D
[00:00:46] <strcat> Eridius: it doesn't protect you though
[00:00:51] <Earnestly> tiffany: I would think the tpye system actually benefits optimization
[00:00:52] <strcat> I'm not saying data race == memory unsafe
[00:00:54] <Earnestly> s/type
[00:00:56] <tiffany> same
[00:00:58] *** Joins: brson (brson@2557E599.66715431.D25A875A.IP)
[00:00:58] *** ChanServ sets mode: +o brson
[00:01:00] <strcat> I'm saying heap corruption, segfaults, etc. == memory unsafe
[00:01:03] <Ralith> tiffany: llvm is not a magic bullet
[00:01:04] <strcat> and you can get them in Go
[00:01:15] <Earnestly> Ralith: But it's a silver dragon!
[00:01:17] <strcat> D has 'safe' though
[00:01:18] <Eridius> strcat: well, you're not supposed to get them
[00:01:19] <Ralith> you might as well say "they all use x86 object code"
[00:01:20] <tiffany> more things you can prove about a language with a good type system, and more things that are never compiled into code in the first place
[00:01:25] <xenocons> type verification DOES definetly assist optimization
[00:01:31] <strcat> Eridius: you are "supposed" to get them in that they aren't prevented
[00:01:32] <Ralith> tiffany: also not always true.
[00:01:32] <tiffany> but llvm IR does a bit of optimization, doesn't it ralith?
[00:01:37] <strcat> Eridius: not an implementation issue
[00:01:59] <Ralith> tiffany: llvm IR does not in and of itself confer optimization, no.
[00:01:59] <Eridius> aren't prevented in what sense? It does bounds checks and other such things to prevent you from running off the end of data structures
[00:02:03] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[00:02:22] <tiffany> er, not the IR itself, but when it's processed by llvm
[00:02:23] <aatch> A segfault in Rust, outside of `unsafe` is a bug in the language/compiler.
[00:02:26] <Earnestly> strcat: What it boils down to, my question, "Does safety come at the cost of speed or are they unrelated?" (I believe the latter)
[00:02:27] <strcat> Eridius: it doesn't prevent that in the presence of goroutines
[00:02:41] <Ralith> tiffany: optimal erasure is undecidable under intuitionistic type theory, for example.
[00:02:41] <strcat> maps and arrays aren't memory safe
[00:02:42] <steven_is_false> Why do values have to be borrowed by reference? Why can't they be borrowed by value?
[00:03:01] <aatch> steven_is_false, what does "borrowed by value" even mean?
[00:03:05] <jensnock_> steven_is_false: Wouldn't that be a copy?
[00:03:08] <strcat> Eridius: java is "memory safe" despite having data races
[00:03:17] <strcat> Eridius: you can get inconsistent views of objects, but you can't corrupt the heap or segfault
[00:03:19] <xenocons> stop talking so fast this is a really good conversation but i cant keep up
[00:03:25] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[00:03:38] <strcat> Eridius: Go allows memory corruption if data races happen with maps/arrays
[00:03:43] <seth> i'm at a loss here. how do i go about debugging this: error: cannot determine a type for this bounded type parameter: unconstrained type
[00:03:46] <Earnestly> xenocons: It's text damnit :P
[00:03:56] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[00:04:00] <seth> i really don't understand what rustc is getting at, from looking at the code
[00:04:00] <graydon> seth: first step is usually to paste code so we can see it :)
[00:04:07] <xenocons> Earnestly: the line between human interaction and irc was blurred long ago
[00:04:08] <seth> graydon: preparing paste now
[00:04:08] <xenocons> for me
[00:04:21] <aatch> seth, well it means it can't infer a type for it.
[00:04:22] <Earnestly> xenocons: I know what you mean heh
[00:05:28] *** Joins: MaikKlein (maik@moz-36D8270A.dip0.t-ipconnect.de)
[00:05:31] <seth> graydon, aatch: https://gist.github.com/sfowler/86f68731667a5ef2a37b
[00:05:52] <seth> aatch: so i got that far, but i don't really understand what the problem is
[00:06:04] <seth> (the error's at the top of the paste)
[00:06:46] <aatch> seth, btw, would be nice if you changed the line number
[00:06:51] *** Quits: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP) (Quit: pcwalton)
[00:07:04] <aatch> I found it though
[00:07:16] <seth> aatch: ah, sorry. it's line 51
[00:07:47] <aatch> seth, what happens if you drop the `return` and the trailing `;`?
[00:08:38] <seth> aatch: no difference, alas
[00:08:53] <strcat> graydon: well... I find the reasoning to justify maps/arrays being unsafe is the same used by C++ programmers
[00:08:54] *** Joins: Axord (xord@moz-C3CCF156.lsanca.dsl-w.verizon.net)
[00:09:07] <strcat> 'It is important to note that these races do not make the current implementations any less secure than they already are. The races allow clever programmers to subvert Go's memory safety, but a less clever programmer can still use the aptly-named package unsafe.'
[00:09:11] <strcat> "write correct code"
[00:09:19] <strcat> they could make it safe in the spec
[00:09:19] *** Joins: Benvie_ (brandon@5FD20F9A.53D07D95.EFF8B7BF.IP)
[00:09:21] <strcat> but it'd be slower
[00:10:09] <aatch> seth, odd, looks like you may have hit a type inference bug.
[00:10:18] <strcat> by that logic C and C++ are safe languages
[00:10:22] *** Joins: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP)
[00:10:23] *** ChanServ sets mode: +o pcwalton
[00:10:34] <seth> aatch: oh no! haha
[00:10:45] <xenocons> seth: more like 'oh yes!'
[00:10:46] <xenocons> hehe
[00:10:49] <aatch> try doing `let val : Option<V> = self.find(key)`
[00:10:51] <Earnestly> strcat: Can they be? Assuming flawless programming
[00:10:59] <strcat> Earnestly: sure
[00:11:07] *** Joins: ssbr (ssbr@44926E86.7F606153.14AA5DDE.IP)
[00:11:09] <xenocons> Earnestly: check out JPL C
[00:11:22] <xenocons> id say that is as safe as practicality permits 
[00:11:57] <strcat> assuming you write bug-free software, C is memory safe
[00:12:02] <aatch> In C/C++ undefined behaviour is considered invalid, thus a program that exhibits such behaviour is a flaw.
[00:12:11] *** Quits: brendan (brendaneic@moz-EBA77DDE.sub-70-197-10.myvzw.com) (Ping timeout)
[00:12:16] <engla> seth: sometimes I think rustc gives you those errors if you have another error.. your type doesn't match, find returns a Option<V>, blk takes a K
[00:12:20] <aatch> As far as I know, anything that invalidates memory safety is undefined.
[00:12:34] <engla> hm no, I'm confused.. it's too late ignore me please
[00:12:37] * engla slaps self
[00:12:43] <xenocons> aatch: solar burps? 
[00:12:49] <strcat> aatch: so then I guess no one writes software in C/C++ ;]
[00:13:09] <aatch> strcat, nobody writes _valid_ software in C/C++ :D
[00:13:11] <jensnock_> strcat: I think that statement might be technically correct.
[00:13:11] <Earnestly> Obviously very hard to do. Now, since you said, relating Go's maps and arrays being slower at the cost of safety, can we get much greater saftey against not-so-flawless programmers at a very marginal cost in perfomance?
[00:13:14] <seth> aatch: doesn't work =( the exact same error occurs on the line with the "let"
[00:13:18] <Earnestly> strcat: *
[00:13:29] <seth> engla: you had me going there for a second =)
[00:13:33] <aatch> seth, well then it's probably not an inference bug
[00:14:27] <seth> aatch: one thing i did recently before i started hitting this error was add the Q type parameter everywhere
[00:14:35] <seth> aatch: am i doing something wrong there?
[00:14:41] <xenocons> C teaches you that you can still do things incorrectly and be successful, this is an important concept? :)
[00:15:00] <xenocons> i find this a painful concept tbh
[00:15:07] <seth> aatch: i wanted to just parameterize find_equiv but it turns out this can't work because i need different constraints for different impls of Cache
[00:15:07] <xenocons> i dont think my ego will accept it
[00:15:18] <seth> (or at least i didn't know how to make it work. the compiler didn't like it)
[00:15:19] <strcat> xenocons: until the compiler updates and your binary is now broken
[00:15:26] <strcat> or someone exploits something
[00:15:42] <xenocons> heh
[00:15:51] <Earnestly> xenocons: It sort of goes back to an old quote about UNIX: "UNIX was not designed to stop its users from doing stupid things, as that would also stop them from doing clever things." ‚Äî Doug Gwyn
[00:15:55] <strcat> valid compiler optimizations introduced in updates can expose security holes
[00:15:59] <strcat> (and they do)
[00:16:04] <xenocons> Earnestly: nice quote
[00:16:12] <xenocons> strcat: yes
[00:16:12] <strcat> that's why they have -fno-strict-aliasing -fno-aggressive-loop-optimizations etc
[00:16:24] <strcat> they are valid optimizations
[00:16:39] <aatch> seth, you can define find_equiv as `fn find_equiv<E:Equiv<K>>(&mut self, key: E) -> V`
[00:16:55] <xenocons> i just want to write code
[00:16:57] <aatch> so you are only parameterizing the method.
[00:16:58] <xenocons> and have fun
[00:16:59] <seth> aatch: nah, i can't!
[00:17:02] <seth> aatch: i had that before
[00:17:30] <aatch> I'm guess it choked on the 'K'?
[00:17:48] <Earnestly> xenocons: Not so much like Mel huh? :p
[00:17:54] <seth> aatch: but if i want to have find_equiv in the Cache trait, then that approach doesn't work, because I need E to have a Hash trait for the HashCache impl
[00:17:57] <xenocons> haha, while (y+++++x) { } //valid C?
[00:18:07] <seth> aatch: possibly the dependency between the type variables doesn't go over too well
[00:18:26] *** Quits: k00mi (koomi@moz-DA4B95B4.pools.arcor-ip.net) (Ping timeout)
[00:18:47] <strcat> xenocons: sure
[00:18:56] <strcat> char c = 3["foobar"];
[00:18:57] <strcat> valid C
[00:19:02] <xenocons> heh
[00:19:05] <xenocons> fun
[00:19:09] <aatch> actually, xenocons it's not
[00:19:12] <aatch> it wont parse
[00:19:20] <strcat> well with whitespace then ;p
[00:19:33] <xenocons> heh
[00:19:42] <xenocons> while (y-->0) { }
[00:19:42] <aatch> since its ((y++)++) + x
[00:20:03] <aatch> (y++) returns an rvalue and you can't use '++' on an rvalue
[00:20:21] <strcat> aatch: isn't that just in C++?
[00:20:22] <Earnestly> xenocons: y+++++x isn't valid
[00:20:36] <aatch> strcat, I'm pretty it's valid C++ in some cases.
[00:20:38] <xenocons> y++ + ++x should be though right?
[00:20:54] <aatch> if (y++) returns a value with a defined ++ operator
[00:21:12] <Earnestly> Yes
[00:21:14] *** Quits: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP) (Connection reset by peer)
[00:21:25] <aatch> because fuck consistent operators, amirite?
[00:21:29] <Earnestly> xenocons: And it's actually quite fun to run :D
[00:21:50] <strcat> aatch: I've never understood why * is defined as a no-op on functions
[00:21:58] <strcat> like (********************strcmp)("foo", "bar")
[00:22:05] <aatch> strcat, haha
[00:22:16] <aatch> that is insane.
[00:22:38] <Earnestly> C becomes fun when you add trigraphs into the mix
[00:22:50] <Earnestly> Nothing like a nice bit of easy obfuscation
[00:22:50] <strcat> aatch: the array thing is insane too but at least it makes a bit of sense (sugar for pointer arith)
[00:23:08] <aatch> Maybe it's to accomodate macro usage?
[00:23:20] <Earnestly> No, it's just how pointers/arrays work
[00:23:26] <strcat> so, gcc doesn't implement the c99 [static 10] bounds check thing
[00:23:40] <xenocons> does that static 1 trick work for c89?
[00:23:45] <cmr> no
[00:23:49] <xenocons> pity
[00:24:02] <xenocons> guess my NOTNUL macro is still useful for c89 heh
[00:24:09] <xenocons> s/my/microsofts that i stole
[00:25:06] <Earnestly> aatch: E.g. x[3] is just suger for *(x + 3), and that means *(3 + x) is the same which means 3[x] is the same. Basically
[00:25:07] *** Quits: mleise (marco@moz-3468AB5B.pools.arcor-ip.net) (Ping timeout)
[00:25:36] <aatch> Earnestly, I was talking about the unary-* operator on functions
[00:25:43] <Earnestly> Oh sorry
[00:26:04] * xenocons excited for rust doc rewrite
[00:26:12] <Earnestly> xenocons: Will be nice I agree
[00:26:19] <strcat> '
[00:26:21] <strcat>     The deÔ¨Ånition of the subscript operator [] is that E1[E2] is identical to (*((E1)+(E2))).
[00:26:21] <SiegeLord> I still am not 100% sure what's wrong with it :P
[00:26:34] *** Quits: MaikKlein (maik@moz-36D8270A.dip0.t-ipconnect.de) (Ping timeout)
[00:26:41] <xenocons> infact 3 things im looking forward to: io rewrite, rust doc, and dbaupp confession of love to /trans
[00:27:01] <dbaupp> what?
[00:27:04] <aatch> SiegeLord, with the change to most things being in methods, the contents would be nice.
[00:27:18] <pcwalton> strcat: I like the Ô¨Å ligature in there
[00:27:19] <SiegeLord> I only see 3 bugs dealing with it
[00:27:20] <aatch> contents could be better rather.
[00:27:24] <pcwalton> copying from a PDF perhaps? :)
[00:27:29] <strcat> pcwalton: silly pdf.js :(
[00:27:32] <SiegeLord> aatch: That doesn't need a rewrite, I think
[00:27:56] <SiegeLord> I don't know, naturally
[00:28:03] <xenocons> dbaupp: trans as in librustc/middle/trans ;p
[00:28:15] <xenocons> (the place you warned me against looking at)
[00:28:21] <cmr> SiegeLord: the code is nasty
[00:28:32] <xenocons> oh yeh, and a robust REPL
[00:28:33] <strcat> pcwalton: better than when I get hex stuff
[00:28:37] <dbaupp> xenocons: ooh, haha
[00:28:51] <strcat> rusti: "i'm robust"
[00:28:54] -rusti- "i\'m robust"
[00:29:02] <cmr> Earnestly: xenocons: add the features you want to https://github.com/mozilla/rust/wiki/Bikeshed-rustdoc
[00:29:14] <strcat> rusti: None /* but not really */
[00:29:15] -rusti- <anon>:9:8: 10:5 error: cannot determine a type for this local variable: unconstrained type
[00:29:15] -rusti- <anon>:9     let r = {  None /* but not really */
[00:29:15] -rusti- <anon>:10     }; // to make line comments work
[00:29:15] -rusti- error: aborting due to previous error
[00:29:15] -rusti- application terminated with error code 101
[00:29:18] <xenocons> cmr: theyre there already :&)
[00:29:22] <strcat> oh that doesn't die anymore
[00:29:29] <strcat> rusti: fmt!("%?", None)
[00:29:31] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/dKTH
[00:29:42] <dbaupp> cmr: did you talk to strcat about jemalloc vs not?
[00:29:47] <xenocons> rusti: [].head()
[00:29:48] -rusti- <anon>:9:15: 9:17 error: internal compiler error: borrow-vec associated with bad sty: &ty_err
[00:29:48] -rusti- <anon>:9     let r = {  [].head()
[00:29:49] -rusti-                         ^~
[00:29:49] -rusti- application terminated with error code 101
[00:29:50] <cmr> xenocons: what are? the features you want in rustdoc? why do you care about the rewrite then? :p
[00:29:53] <cmr> dbaupp: no, I forgot
[00:30:14] <dbaupp> strcat: http://www.ug.it.usyd.edu.au/~hwil7821/rust-bench/ vs http://www.ug.it.usyd.edu.au/~hwil7821/rust-bench/noje.html
[00:30:16] <aatch> That reminds me, I should write that "call to action for trans" for the mailing list.
[00:30:31] <dbaupp> strcat: jemalloc seems to make rust use more memory/churn more... is this expected?
[00:30:35] <xenocons> cmr: ah, i just wanted to go to the rust documentation and feel like i can make my way around it, and learn stuff, rather than go there and get confused and ending up looking at rust src
[00:30:35] <SiegeLord> cmr: Well, if it's bug free who cares if it's nasty... is the motivation to make it nicer to add backends(frontends) to it?
[00:30:43] <strcat> dbaupp: churn?
[00:30:43] <cmr> SiegeLord: it's not bugfree though
[00:30:58] <strcat> dbaupp: it uses more memory in the short term in exchange for much, much less fragmentation/usage in the long-term
[00:30:59] <dbaupp> strcat: go up and down a lot
[00:31:27] <xenocons> rusti: ~[[].head()].head()
[00:31:28] -rusti- <anon>:10:10: 10:21 error: internal compiler error: borrow-vec associated with bad sty: &ty_err
[00:31:28] -rusti- <anon>:10          ~[[].head()].head()
[00:31:28] -rusti-                     ^~~~~~~~~~~
[00:31:29] -rusti- application terminated with error code 101
[00:31:35] <strcat> dbaupp: glibc is using sbrk so the performance pattern is different than mmap'ed pools
[00:32:01] <cmr> strcat: My question was if the memcg was including madvise-free'd memory in the usage
[00:32:01] <dbaupp> strcat: well, those graphs show using jemalloc gives a peak of 100MB, and without it, the peak is more like 90
[00:32:26] <strcat> cmr: if the OS hasn't bothered to let go of it yet due to memory pressure, then maybe
[00:32:43] <strcat> dbaupp: look at it for librustc instead
[00:33:04] <strcat> short-running program just shows you how eager it is to allocate
[00:33:14] *** Quits: hjr3 (hradtke@374E545A.3A8E9B0C.F9D9C60E.IP) (Quit: My MacBook has gone to sleep. ZZZzzz‚Ä¶)
[00:33:25] <strcat> it's expected that tcmalloc/jemalloc use more RES in the short-term than glibc
[00:33:30] *** Quits: seth (seth@2557E599.66715431.D25A875A.IP) (Ping timeout)
[00:33:39] *** Quits: azita (Azita@2557E599.66715431.D25A875A.IP) (Quit: azita)
[00:33:43] <dbaupp> cmr: can you measure those ones? (I still haven't got cgroups set up properly it seems :( )
[00:33:54] <aatch> Hmm, I think there may be something up with our usage/implementation of fork
[00:34:12] <aatch> given that spike during linking.
[00:34:14] *** Joins: k00mi (koomi@moz-BE75DEBE.pools.arcor-ip.net)
[00:34:18] <cmr> dbaupp: I can in a half hour
[00:34:22] *** kimundi is now known as zz_kimundi
[00:34:26] <strcat> aatch: linkers use a ton of memory
[00:34:39] <strcat> if we were actually using linker optimizations it would use more ;p
[00:34:44] <aatch> strcat, true.
[00:34:56] <aatch> Though we don't really need link-time optimization.
[00:35:11] <aatch> since we don't have individual object files.
[00:35:13] <strcat> aatch: linker optimizations aren't LTO
[00:35:23] <aatch> strcat, oh?
[00:35:24] <strcat> they're just optimizations to the symbol lookup tables
[00:35:27] <strcat> -Wl,-O1
[00:35:28] <xenocons> hrm
[00:35:43] <aatch> Ahh, like sorting it, etc?
[00:35:43] <SiegeLord> Hmm, I guess librustdoc isn't that big
[00:35:46] <strcat> we have long symbol names so it's important for large programs
[00:35:46] <xenocons> rusti: fn x() -> ~str { ~"" }; x()
[00:35:47] -rusti- ~""
[00:35:50] <strcat> aatch: well they use hash tables
[00:35:57] <xenocons> whats the point of 'clobbers'??
[00:36:01] <strcat> aatch: they always sort it, but they don't put a lot of effort into making a good hash table by default
[00:36:12] <xenocons> oops s/??/?
[00:36:17] <strcat> well, --sort-common exists too
[00:36:22] <aatch> xenocons, context?
[00:36:22] <strcat> but I think that just changes how they sort
[00:36:34] <xenocons> aatch: https://github.com/mozilla/rust/blob/master/src/librustc/middle/trans/asm.rs:152
[00:36:57] <strcat> aatch: I tried enabling the -O1 optimization before but it doesn't exist for OS X's linker so it failed
[00:37:05] <strcat> I guess it'd be fine to hardcode it to off on OS X :\
[00:37:05] <xenocons> (i realise im looking at potentially evil stuff, just bored and clicking around)
[00:37:18] <aatch> xenocons, ah, lets the compiler know what registers the asm code modifies
[00:37:36] <aatch> otherwise the compiler is free to assume what the contents are.
[00:37:41] <xenocons> interesting heh
[00:38:05] <dbaupp> (clobbers seem to not work at all. :( )
[00:38:31] <strcat> ) -> Result<Option<~str>, ~str> {
[00:38:33] <strcat> ew
[00:38:54] <strcat>     if pandoc.is_some() {
[00:38:56] <strcat>         result::Ok(pandoc)
[00:38:58] <strcat>     } else {
[00:39:00] <strcat>         result::Err(~"couldn't find pandoc")
[00:39:02] * strcat cries
[00:39:06] <xenocons> aha
[00:39:11] <Luqman> dbaupp: :( they should afaik
[00:39:13] <strcat> I guess it probably ended up that way after refactoring
[00:39:14] <Luqman> got an example?
[00:39:18] *** Joins: seth (seth@2557E599.66715431.D25A875A.IP)
[00:39:34] <cmr> dbaupp: https://github.com/mozilla/rust/blob/master/src/librustc/middle/trans/asm.rs#L93 seems like it handles it fine...
[00:39:47] <dbaupp> Luqman: any code using them, essentially (I've rarely been able to get asm! to work at all for anything other than the most basic code)
[00:40:07] <xenocons> looking at closure.rs has been enlightening
[00:40:26] *** Parts: ecr (ereed@2557E599.66715431.D25A875A.IP) ()
[00:40:39] <strcat> cmr: try running the actual core-map benchmark in your test thing
[00:40:47] <strcat> with/without jemalloc
[00:40:56] <cmr> strcat: dbaupp already has that data, he just isn't graphing it
[00:40:59] <xenocons> did someone grep "copy " and insert /* bad */ or something
[00:41:14] <xenocons> guessing copy is to work around some issue
[00:41:53] <dbaupp> rusti: asm!("cpuid" : : : "%rax", "%rbx", "%rcx", "%rdx")
[00:41:54] -rusti- <anon>:10:9: 11:5 error: use of inline assembly requires unsafe function or block
[00:41:54] -rusti- <anon>:10          asm!("cpuid" : : : "%rax", "%rbx", "%rcx", "%rdx")
[00:41:54] -rusti- <anon>:11     }; // to make line comments work
[00:41:54] -rusti- error: aborting due to previous error
[00:41:54] -rusti- application terminated with error code 101
[00:42:05] <dbaupp> rusti: unsafe { asm!("cpuid" : : : "%rax", "%rbx", "%rcx", "%rdx") }
[00:42:07] -rusti- ()
[00:42:18] <aatch> xenocons, mostly it where a copy isn't /technically/ needed but there is/was no way around it.
[00:42:27] <aatch> Many of the cases aren't actually try anymore.
[00:42:31] <dbaupp> Luqman: that ^ segfaults for me
[00:42:48] <aatch> s/try/true
[00:45:46] *** Joins: mdz8292 (mitch@moz-CF8BEBEF.dia.static.qwest.net)
[00:46:53] <xenocons> aatch: ah right
[00:48:00] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[00:49:05] *** Quits: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Ping timeout)
[00:49:15] *** Joins: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[00:52:19] *** Joins: Aetherspawn (Aetherspaw@moz-8811D9F0.static.tpgi.com.au)
[00:52:41] <Aetherspawn> Tree still closed :C
[00:52:52] <nmatsakis> pcwalton: sigh, I rebase the extern fn patch; it fails on linux now. grr. hopefully something simple.
[00:53:04] <aatch> Aetherspawn, hopefully not for much longer
[00:53:16] <Luqman> dbaupp: try without the % in the clobbers. then it passes the same thing to llvm as clang
[00:53:53] <strcat> nmatsakis: and my vec pull is going to break everything ;p
[00:53:59] * strcat sighs
[00:54:01] <cmr> dbaupp: alright you want compiling librustc with stage0 compiler, with adn without jemalloc?
[00:54:38] <pcwalton> nmatsakis: bleh
[00:54:53] <nmatsakis> strcat: I was thinking, if we planned to transition `for` to something with external iterators, I guess the way to do it might be to make `advance` a no-op
[00:55:15] <strcat> nmatsakis: it'd be easy to sed them all away though
[00:55:33] <nmatsakis> strcat: don't forget about phase 0
[00:55:36] <nmatsakis> strcat: stage0 :)
[00:55:38] <strcat> nmatsakis: oh right
[00:55:59] <strcat> well I guess it can just do fn advance(self) -> T { self } ? ;p
[00:56:16] *** Quits: bent (chatzilla@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: ChatZilla 0.9.90-rdmsoft [XULRunner 18.0.2/20130201065344])
[00:56:18] <dbaupp> Luqman: oh, that seems to be the problem.. thanks :)
[00:56:18] <cmr> graydon: do you plan on keeping all these auto builders around? it takes *forever*
[00:56:29] <dbaupp> cmr: not stage0
[00:56:53] <cmr> dbaupp: stage0 is the compiler built with the snapshot, *not* stage0?
[00:57:06] <dbaupp> cmr: preferably stage2, but stage1 would be fine
[00:57:07] <dbaupp> cmr: oh
[00:57:32] <dbaupp> cmr: well, it'd be better to be the one that is built by the one built by the snapshot
[00:57:51] <Luqman> dbaupp: ya, there's a bunch of formatting things that clang does before it passes it on to llvm
[00:57:59] <dbaupp> cmr: (since the snapshot creates a slower rustc than the current ones do)
[00:58:08] *** Quits: EXetoC (ex@moz-2DBEB1E4.customer.t3.se) (Quit: WeeChat 0.4.1)
[00:58:28] <cmr> dbaupp: ok
[00:58:32] * dbaupp thinks Luqman should document asm! ;)
[00:58:42] <eschweic> fn a() -> ~[int] { ~[1, 2, 3] } a()
[00:58:54] <eschweic> rusti: fn a() -> ~[int] { ~[1, 2, 3] } a()
[00:58:57] -rusti- ~[1, 2, 3]
[00:59:08] <eschweic> rusti: fn a() -> &[int] { &[1, 2, 3] } a()
[00:59:10] -rusti- &[0, 0, 0]
[00:59:38] <Luqman> dbaupp: https://github.com/mozilla/rust/wiki/Doc-detailed-release-notes#inline-assembly
[00:59:41] <Luqman> ;)
[00:59:41] <dbaupp> eschweic: that's strange
[00:59:52] <cmr> What's strange about it?
[01:00:15] <dbaupp> Luqman: hehe, thanks... why's it not in the manual/the source code?
[01:00:21] <strcat> the 2nd one shouldn't compile
[01:00:25] <strcat> it's invalid
[01:00:27] *** Quits: graydon (graydon@3853DDD.39EEDBB3.D758B1AA.IP) (Quit: Leaving.)
[01:00:28] <cmr> Oh
[01:00:34] <cmr> Needs explicit &'static?
[01:00:36] <dbaupp> rusti: fn a() -> &'static [int] { &'static [1, 2, 3] } a()
[01:00:38] -rusti- &[0, 0, 0]
[01:00:43] <dbaupp> huh
[01:00:46] <eschweic> yeah that's what I thought
[01:00:56] <aatch> That's almost certainly related to the wierd static slice bug from a while back
[01:01:07] <dbaupp> aatch: the one with structs?
[01:01:09] <aatch> rusti: fn a() -> &'static [int] { [1, 2, 3] } a()
[01:01:11] -rusti- <anon>:10:36: 10:45 error: mismatched types: expected `&'static [int]` but found `[<VI2>, .. 3]` ([] storage differs: expected &'static  but found 3)
[01:01:11] -rusti- <anon>:10          fn a() -> &'static [int] { [1, 2, 3] } a()
[01:01:11] -rusti-                                               ^~~~~~~~~
[01:01:11] -rusti- error: aborting due to previous error
[01:01:11] -rusti- application terminated with error code 101
[01:01:12] <strcat> yeah but the example without a lifetime shouldn't have compiled
[01:01:13] <strcat> afaik
[01:01:29] <aatch> rusti: fn a() -> &'static [int] { &'static ([1, 2, 3]) } a()
[01:01:30] -rusti- <anon>:10:36: 10:58 error: mismatched types: expected `&'static [int]` but found `&[<VI2>, .. 3]` (expected vector but found &-ptr)
[01:01:30] -rusti- <anon>:10          fn a() -> &'static [int] { &'static ([1, 2, 3]) } a()
[01:01:30] -rusti-                                               ^~~~~~~~~~~~~~~~~~~~~~
[01:01:30] -rusti- error: aborting due to previous error
[01:01:31] -rusti- application terminated with error code 101
[01:01:33] <dbaupp> rusti: fn a() -> &int { &1 } a()
[01:01:34] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/ggbL
[01:01:44] <dbaupp> rusti: fn a() -> &int { &'static 1 } a()
[01:01:45] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/bPNa
[01:01:56] <dbaupp> rusti: fn a() -> &'static int { &'static 1 } a()
[01:01:58] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/HFjC
[01:02:12] <aatch> bahaha
[01:02:17] <cmr> brson: if auto is green are you making a snapshot? :)
[01:02:46] <aatch> I guess it makes sense though
[01:02:58] <aatch> just because you /say/ 'static doesn't mean it is.
[01:03:12] <aatch> It's still stored on the stack in that case.
[01:03:29] <strcat> so slices are very buggy? ;p
[01:03:34] <dbaupp> rusti: fn a() -> &'static int { static x:int = 1; &x } a()
[01:03:35] -rusti- &1
[01:03:50] <dbaupp> rusti: fn a() -> &int { static x:int = 1; &x } a()
[01:03:51] -rusti- &1
[01:03:57] <aatch> strcat, yeah, they interact weirdly with autoborrowing/autoderef rules.
[01:04:39] <brson> cmr: yeah. we can probably start a snapshot now. auto is probably going to be green once it cycles
[01:05:13] <aatch> brson, I'd be willing to help with that.
[01:05:30] <Luqman> brson: should remove drop as a keyword before doing a snapshot
[01:05:44] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[01:05:44] <ghrust> 01[13rust01] 15brson merged 06auto into 06snap-stage3: 02http://git.io/3qgrow
[01:05:44] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[01:05:46] * cmr didn't even know drop was a keyword
[01:05:53] <seth> why oh why is the default behavior of pattern matching to move
[01:06:02] <seth> i'm learning to just write "ref" everytime now
[01:06:03] <Luqman> cmr: use to be the old way of doing destructors
[01:06:13] <strcat> seth: it's the default behaviour for everything
[01:06:15] <aatch> seth, because the default for /everything/ is move
[01:06:19] <brson> aatch: ok, keep an eye on the snapshot bots
[01:06:21] <aatch> or at least, it should be.
[01:06:22] <strcat> passing parameters, assignment, etc.
[01:06:48] <seth> i find that mind boggling, honestly
[01:06:55] <brson> aatch: do you know how to do a snap?
[01:06:56] <seth> i mean for pattern matching specifically
[01:07:03] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[01:07:03] <aatch> brson, more-or-less
[01:07:15] <strcat> seth: why?
[01:07:16] <seth> i understand the consistency here. maybe it's just that i'm too used to haskell. but it is very strange to me
[01:07:27] <strcat> haskell doesn't do either
[01:07:33] <aatch> I can also read the wiki
[01:07:39] <aatch> even if it is a little wrong.
[01:07:40] <strcat> it does shallow copies
[01:07:47] <strcat> moves are shallow copies
[01:07:54] <brson> Luqman: if this snap goes through then we'll have to wait for the next for drop
[01:07:59] <aatch> Oh! brson I have a feeling that the snap bots might fail
[01:08:19] *** Quits: Aetherspawn (Aetherspaw@moz-8811D9F0.static.tpgi.com.au) (Connection reset by peer)
[01:08:24] <brson> aatch: why?
[01:08:38] <aatch> I think I encountered an issue a while back when I was seeing how to make a snapshot because of the std/core/extra changes
[01:08:39] <brson> auto is green
[01:08:44] * brson dance
[01:09:06] <aatch> rust-buildbot: dance
[01:09:07] <rust-buildbot> <(^.^<)
[01:09:08] <rust-buildbot> <(^.^)>
[01:09:09] <rust-buildbot> (>^.^)>
[01:09:09] <rust-buildbot> (7^.^)7
[01:09:11] <rust-buildbot> (>^.^<)
[01:09:18] <seth> it's very strange to me that pattern matching, by itself, would take any user-observable action at all (barring view patterns and the like)
[01:09:38] <seth> i'll stop going on about it =)
[01:09:39] <aatch> seth, it's because you can bind to variables
[01:10:00] <seth> aatch: i get that, i just want ref to be the default
[01:10:25] <seth> i feel like i almost always want that
[01:10:37] <strcat> you really want indirection by default?
[01:10:47] <brson> aatch: yeah, this may be a tricky snapshot because of the naming change. do you want to look into it?
[01:10:51] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[01:10:57] <seth> (in fairness, being a newb to the language, my preferences are probably not those of a more experienced rust user)
[01:11:00] <strcat> most of the ones I've written already have a borrowed pointers
[01:11:03] <aatch> brson, yeah, I remember it wasn't hard to fix.
[01:11:05] <strcat> Option<&T>
[01:11:12] *** Joins: Aetherspawn (Aetherspaw@moz-8811D9F0.static.tpgi.com.au)
[01:11:15] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[01:11:18] <strcat> definitely don't want ref with that
[01:11:27] <strcat> then you have & &T
[01:11:53] <seth> strcat: i'm at the moment writing generic code, so i just have a T
[01:12:17] <brson> looks like we won't be able to open the tree until tomorrow since graydon is away
[01:12:23] <cmr> brson: a weekly snapshot policy would be really nice... as would master being green all the time. also I want a pony
[01:13:12] <aatch> Gold-plated toilets for everyone!
[01:13:17] <brson> Luqman: do you have the drop patch ready? it looks like the snap may take some work
[01:13:17] <seth> strcat: if the user gives me a T& i guess i will take an extra indirection (which i'd hope the compiler would elide in common cases) but i don't know how to safely write generic code that pattern matches without ref
[01:13:57] <Luqman> brson: i have one to just remove the keyword
[01:14:07] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[01:14:10] <brson> Luqman: ok, let's merge it
[01:16:26] <aatch> brson, should I build from auto, master, or snap-stage3
[01:16:30] *** Quits: seth (seth@2557E599.66715431.D25A875A.IP) (Input/output error)
[01:16:56] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[01:17:23] <Luqman> brson: https://github.com/luqmana/rust/tree/no-drop-keyword
[01:19:25] <dbaupp> cmr: http://www.ug.it.usyd.edu.au/~hwil7821/rust-bench/programs.html
[01:19:41] *** Joins: vk (chatzilla@F92596F.2DEF7520.EF7679FA.IP)
[01:19:50] <brson> aatch: master, though all three branches are the same right now
[01:19:58] <cmr> jemalloc is slower for core-map, that's weird
[01:20:12] <strcat> not for me
[01:20:15] <cmr> although the jemalloc and no-jemmaloc is af ew commits apart, it was during the tree was on fire
[01:20:20] *** Quits: carllerche (carllerche@moz-BF6CB667.hsd1.ca.comcast.net) (Quit: carllerche)
[01:20:35] *** Quits: eschweic (Adium@2557E599.66715431.D25A875A.IP) (Quit: Leaving.)
[01:21:08] <strcat> look at the mem difference for core-set
[01:21:23] <strcat> dbaupp: oh
[01:21:28] <strcat> dbaupp: you need to pass a # of elements
[01:21:36] <strcat> ./core-map 100000
[01:21:48] <strcat> it's not actually doing anything useful by default
[01:21:51] <cmr> I set RUST_BENCH env var, doesn't that set it already?
[01:21:53] <dbaupp> strcat: (this is data cmr collected)
[01:22:08] <strcat> cmr: no
[01:22:13] <cmr> strcat: it should, it's what the rest of them do :p
[01:22:20] <dbaupp> cmr: not for core-set, it seems
[01:22:22] <strcat> cmr: what do they read from it?
[01:22:26] <strcat> it's not a # of iterations
[01:22:29] <strcat> it's a # of elements
[01:22:47] <cmr> strcat: nothing, they just check if it's set and set suitable defaults for a good benchmark 
[01:22:53] <aatch> brson, ok, I also merged Luqman's commit in locally
[01:23:01] <strcat> cmr: *shrug* ;p
[01:23:01] <cmr> SiegeLord: I'm writing a longer email but I'm doing the benchmark stuff right now
[01:23:11] <cmr> SiegeLord: (re rustdoc)
[01:23:31] <strcat> cmr: none of those look like good benchmarks
[01:23:32] <SiegeLord> Huh
[01:23:34] <strcat> they're not even a second
[01:23:43] <SiegeLord> I don't even see my email :x
[01:23:56] <strcat> they aren't benchmarking anything ;\
[01:23:58] <dbaupp> cmr: yeah, 0.005s for a "benchmark"
[01:24:09] <cmr> someone should go fix that ;p
[01:24:13] <brson> aatch: ok, can you push that to master if it builds?
[01:24:23] <Luqman> aatch: er, you might to hold off on it
[01:24:40] <aatch> Luqman, ok?
[01:25:29] <dbaupp> cmr: there are 23 .rs files in test/bench mentioning RUST_BENCH, but 35 in total
[01:26:21] <BitPuffin> does rust have partial function applications?
[01:26:25] <cmr> BitPuffin: no
[01:26:43] <BitPuffin> dawie
[01:26:47] <strcat> you can do |x| f(x, 2) but there isn't sugar for it
[01:27:27] <BitPuffin> what does |x| do?
[01:27:34] <cmr> closure snytax
[01:27:59] <aatch> Luqman, what's the issue?
[01:28:20] <strcat> rusti: fn foo(x: int, y: int) -> int { x + y } let bar = |x| foo(x, 1); bar(2)
[01:28:23] -rusti- 3
[01:28:31] <BitPuffin> hmm
[01:28:36] <BitPuffin> I guess I'll get to that
[01:28:39] <brson> lol, 'stage1' is a reserved keyword
[01:28:42] <BitPuffin> currently going through Haskell
[01:28:54] <BitPuffin> does prepare me better for Rust it seems like
[01:28:57] <cmr> dbaupp: http://octayn.net/data.tar.xz
[01:29:03] <BitPuffin> with the pattern matching etc
[01:29:03] <Luqman> aatch: brson lol, yes. lesson: run make first :P
[01:29:04] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[01:29:12] <dbaupp> cmr: on it! :)
[01:29:14] <cmr> compiling librustc with stage1 compiler
[01:29:15] <strcat> rusti: stage1
[01:29:16] -rusti- <anon>:10:9: 10:15 error: unresolved name `stage1`.
[01:29:16] -rusti- <anon>:10          stage1
[01:29:16] -rusti-                    ^~~~~~
[01:29:16] -rusti- error: aborting due to previous error
[01:29:16] -rusti- application terminated with error code 101
[01:29:29] <strcat> rusti: let stage1 = 1;
[01:29:30] -rusti- ()
[01:29:33] <strcat> brson: hm?
[01:29:35] <brson> strcat: only in luqman's branch
[01:29:38] <strcat> oh :)
[01:29:51] <aatch> Luqman, I'm guessing you just fixed that?
[01:30:14] <Luqman> aatch: fixing :P
[01:30:27] <aatch> since I don't see it in the diff...
[01:30:42] <brson> what do i do about "warning: Dynamic freeze scope artifically extended (see Issue #6248)"
[01:30:47] <brson> that's a scary warning
[01:30:50] <BitPuffin> goodnight!
[01:30:55] <strcat> brson: wrap it in {}, if you don't want it extended
[01:30:58] <strcat> it will still warn ;\
[01:31:08] <aatch> brson, you can sometimes refactor it out.
[01:31:21] <aatch> brson, there's only a few that I know of.
[01:31:21] <strcat> dynamic freezes are scary overall
[01:32:22] <strcat> rusti: let x = @mut Some(5); let z; { let y = &*x; z = y }
[01:32:24] -rusti- ()
[01:32:58] *** Quits: BitPuffin (quassel@moz-5C0452AB.cust.tele2.se) (Ping timeout)
[01:33:06] <strcat> rusti: let x = @mut Some(5); let z; { let y = &*x; z = y } *x = None
[01:33:08] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/UHgT
[01:33:27] <strcat> rusti: let x = @mut Some(5); let z: &const Option<int>; { let y = &*x; z = y } *x = None
[01:33:27] <dbaupp> cmr: http://www.ug.it.usyd.edu.au/~hwil7821/rust-bench/rustc.png
[01:33:28] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/YJLU
[01:33:52] <strcat> rusti: let x = @mut Some(5); let z: &const Option<int>; { let y = &*x; }; *x = None
[01:33:53] -rusti- ()
[01:33:55] <dbaupp> cmr: is the no jemalloc build using the snapshot?
[01:33:58] <cmr> dbaupp: no
[01:34:08] <dbaupp> cmr: ok
[01:34:15] <cmr> mem-bench.py x86_64-unknown-linux-gnu/stage2/bin/rustc --cfg stage2 -O -Z no-debug-borrows --target=x86_64-unknown-linux-gnu -o x86_64-unknown-linux-gnu/stage2/lib/rustc/x86_64-unknown-linux-gnu/lib/librustc.so /home/cmr/hacking/rust/src/librustc/rustc.rc  > data-noje.json
[01:34:29] <cmr> and LD_PRELOAD=/usr/lib/libjemalloc.so mem-bench.py x86_64-unknown-linux-gnu/stage2/bin/rustc --cfg stage2 -O -Z no-debug-borrows --target=x86_64-unknown-linux-gnu -o x86_64-unknown-linux-gnu/stage2/lib/rustc/x86_64-unknown-linux-gnu/lib/librustc.so /home/cmr/hacking/rust/src/librustc/rustc.rc > data-je.json
[01:35:21] <dbaupp> cmr: ah, right, cool!
[01:35:38] <Luqman> aatch: ok, should be fixed. just making sure now
[01:35:41] <strcat> rusti: let x = @mut Some(5); let z: &const Option<int>; { let y = &const *x; z = y } *x = None
[01:35:42] -rusti- rust: task failed at 'borrowed', <anon>:10
[01:35:42] -rusti- rust: domain main @0xd171b0 root task failed
[01:35:42] -rusti- application terminated with error code 101
[01:36:17] <aatch> brson, I'm fixing the warning in middle/ty.rs now, I'll push it along with Luqman's patch.
[01:36:18] <brson> cmr: so in those graphs our benchmarks are like twice as fast and use half the memory with jemalloc?
[01:36:28] <strcat> brson: they're not really the benchmarks
[01:36:28] <cmr> brson: yes
[01:36:35] <strcat> brson: look at the total time
[01:36:41] <strcat> need to actually pass them higher values
[01:36:44] <cmr> yeah, the benchmarks aren't great
[01:36:53] <strcat> well core-map is fine, it just needs an arg
[01:37:12] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[01:37:28] <strcat> don't know if the others take params
[01:37:56] <dbaupp> strcat: I guess graph-500bfs is fine too
[01:38:28] <dbaupp> (maybe)
[01:38:41] <cmr> all of the benchmarks do things, but what they're not doing enough of it.
[01:38:45] <sully> oh, you can't copy out of patterns anymore?
[01:39:00] <dbaupp> cmr: it looks like RUST_BENCH isn't being set correctly
[01:39:10] <strcat> core-map doesn't do anything with RUST_BENCH
[01:39:12] *** Quits: goffrie (goffrie@moz-9153684F.dsl.ncf.ca) (Ping timeout)
[01:39:13] <dbaupp> cmr: since core-map.rs doesn't actually pay attention to RUST_BENCH
[01:39:14] *** Joins: goffrie (goffrie@moz-9153684F.dsl.ncf.ca)
[01:39:22] *** Quits: cstrahan (cstrahan@moz-4C7E5789.hsd1.dc.comcast.net) (Quit: leaving)
[01:39:26] *** Joins: cstrahan (cstrahan@moz-4C7E5789.hsd1.dc.comcast.net)
[01:39:28] <cmr> oh my
[01:39:31] <cmr> dbaupp: you're right!
[01:39:35] <cmr> I don't actually set RUST_BENCH anymore
[01:39:45] <cmr> Must have lost it in the refactor
[01:40:55] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[01:41:08] <sully> so, what is the right way to copy out of a pattern match, now?
[01:41:18] <sully> do a ref binding and write "copy *x"?
[01:41:22] <strcat> sully: x.clone() ;p
[01:41:28] <strcat> copy is deprecated
[01:43:52] *** Quits: RMF (RMF@7CB4432F.59969257.8D19547B.IP) (Ping timeout)
[01:44:13] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[01:44:15] *** Quits: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Connection reset by peer)
[01:45:50] *** Joins: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[01:46:31] *** Joins: Voomer (Voomer@moz-E97E8EB7.br.br.cox.net)
[01:47:49] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[01:52:08] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[01:52:14] <cmr> it's really obnoxious that k-nucleotide waits for input on stdin by default
[01:52:37] *** Quits: mdz8292 (mitch@moz-CF8BEBEF.dia.static.qwest.net) (Ping timeout)
[01:54:59] <cmr> SiegeLord: reply sent
[01:55:54] <cmr> http://www.asciiflow.com is a wonderful tool
[01:55:57] <bblum> oops, guess i'll need a snapshot for this after all
[01:56:58] <aatch> bblum, good timing
[01:57:08] <bblum> what, a snapshot is coming?
[01:57:11] <brson> cmr: that's brilliant
[01:57:16] <aatch> I'm working on it now :D
[01:57:32] <bblum> aatch: well... if you beat one of my currently open PRs, then that will be bad timing
[01:57:34] <brson> aatch: please make sure you push luqman's commit to master. we don't want to snapshot commits that are not upstream
[01:57:38] <bblum> since i need a snapshot after that PR
[01:57:59] <aatch> brson, I will, just making sure that and my warning fix builds
[01:59:39] <cmr> dbaupp: http://octayn.net/data-benches.json.xz
[01:59:46] <cmr> that's actually a tarball
[01:59:49] <cmr> dbaupp: http://octayn.net/data-benches.json.tar.xz
[02:00:01] <aatch> bblum, in that case, yes, bad timing.
[02:00:19] <cmr> moved
[02:00:54] <bblum> hmm
[02:00:59] <bblum> &'static doesn't fulfill owned, huh
[02:01:17] <dbaupp> cmr: it's not a tarball!
[02:01:27] <dbaupp> $ file data-benches.json.tar 
[02:01:27] <dbaupp> data-benches.json.tar: ASCII text, with very long lines, with no line terminators
[02:02:11] <cmr> tar is such a silly program, I should find a replacement for it sometime
[02:02:42] <aatch> Luqman, I just got this: error: `stage2` is a reserved keyword
[02:03:06] <dbaupp> cmr: is that with jemalloc?
[02:03:14] <cmr> dbaupp: I have no idea what it is
[02:03:19] <dbaupp> cmr: D:
[02:03:27] <cmr> updated data-benches.json.tar.xz
[02:03:31] <cmr> should actually be a tarball :p
[02:03:39] *** Quits: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP) (Quit: pcwalton)
[02:03:44] <dbaupp> cmr: heh
[02:04:01] <dbaupp> cmr: nope
[02:04:11] <Luqman> aatch: with which stage?
[02:04:20] <aatch> stage2
[02:04:36] <cmr> OHhhhhh dammit
[02:04:47] <cmr> dbaupp: updated again
[02:05:11] <Luqman> aatch: what's the hash of the commit?
[02:05:11] <dbaupp> cmr: there we go
[02:05:18] <bblum> how can i get a &'self str from a ~str
[02:05:27] <bblum> & and * don't seem to hel
[02:05:28] <bblum> p
[02:05:32] <aatch> Luqman, you didn't stage is_reserved_keyword
[02:05:34] <strcat> bblum: just coerce it
[02:05:43] <strcat> let s: &str = string;
[02:05:46] <aatch> bblum, let x : &str = ~"abc";
[02:05:48] <bblum> oic
[02:06:49] <dbaupp> bblum: string.as_slice()
[02:07:01] *** Quits: zz_kimundi (kimundi@moz-DD3E166.dip0.t-ipconnect.de) (Ping timeout)
[02:07:33] <Luqman> aatch: bleh, cfg'd that off too now
[02:07:41] <aatch> Luqman, I just fixed it locally.
[02:07:54] <dbaupp> cmr: err, they're still all really short?
[02:08:11] <Luqman> aatch: that works too
[02:08:28] <aatch> Easier than dealing with rebased commits etc.
[02:08:56] <cmr> dbaupp: are they longer?
[02:09:18] <dbaupp> cmr: slightly
[02:09:25] <dbaupp> cmr: but most are still under 0.1s
[02:10:34] <cmr> dbaupp: is graph500 slower?
[02:10:50] *** Joins: zz_kimundi (kimundi@moz-364FCCA6.dip0.t-ipconnect.de)
[02:10:55] <cmr> it should be significantly slower
[02:11:09] *** zz_kimundi is now known as kimundi
[02:11:10] <dbaupp> cmr: yeah, like 20% slower
[02:11:14] <dbaupp> cmr: so not much
[02:11:16] <cmr> that's not right
[02:11:48] <cmr> I guess plumbum doesn't inherit the environment?
[02:11:50] * cmr tests
[02:12:49] <cmr> aha
[02:13:50] <cmr> dbaupp: this is going to take a while I think
[02:14:00] <dbaupp> cmr: ok
[02:15:32] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[02:16:41] <aatch> Hurrah, seems to be building all the way through.
[02:17:11] *** Quits: a__ (a__@moz-250D9B4.nycmny.fios.verizon.net) (Ping timeout)
[02:18:08] *** Joins: RMF (RMF@moz-8C13D5A2.dsl.telepac.pt)
[02:21:57] <cmr> I guess me/someone will have to go through and tune these benchmarks to be more benchmark-y when RUST_BENCH is set
[02:22:13] <cmr> quite a few of them don't handle it at all or barely do anything extra
[02:23:43] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[02:23:43] <ghrust> 01[13rust01] 15Aatch pushed 2 new commits to 06master: 02http://git.io/T36Dnw
[02:23:43] <ghrust> 13rust/06master 14dfe4c2c 15James Miller: Fix dynamic freeze warning
[02:23:43] <ghrust> 13rust/06master 14e9c3894 15Luqman Aden: libsyntax: Remove `drop` as a keyword.
[02:23:44] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[02:23:57] *** Quits: james4k (james@moz-726FE3EE.com) (Quit: WeeChat 0.3.8)
[02:24:22] <aatch> brson, should I push to snap-stage3?
[02:24:37] <strcat> aatch: that doesn't seem like a good way to fix it ;\
[02:24:42] <strcat> the warning is about a compiler bug but it's fine
[02:25:14] <cmr> except task-perf-linked-failure
[02:25:16] <cmr> that one
[02:25:21] <cmr> 810G VIRT
[02:25:25] <cmr> eating all my memory
[02:25:34] <cmr> swapping like nothing else
[02:25:43] <cmr> I might just kill this one...
[02:25:58] <cmr> brson: whose brilliant idea was that? :p
[02:26:57] <strcat> aatch: the extended borrow will just be to the end of the scope
[02:27:00] <strcat> the same as it is now
[02:27:19] <aatch> strcat, eh. it's functionally the same.
[02:27:27] <strcat> aatch: 2 lookups now, 1 before
[02:27:39] <aatch> 2?
[02:27:41] <cmr> task-perf-one-million also no fun
[02:27:55] <strcat> aatch: it used find_or_insert_with
[02:28:04] <strcat> aatch: now it uses find_copy and then insert - 2 lookups
[02:28:11] <brson> cmr: feel free to xfail any benchmarks that are not behaving properly. there's a bug causing tasks to chew up lots of stack
[02:28:57] <aatch> strcat, anyway, this is a cache, so that extra lookup is a tiny fraction of the time for generated the data it's caching
[02:29:05] <strcat> yes but it's not a proper thing to do
[02:29:14] <strcat> you're just replacing 1 lookup with 2 lookups without a reason ;\
[02:29:23] <strcat> and it's longer
[02:29:40] <aatch> It's like 4 lines longer.
[02:30:07] <strcat> I just don't see why you'd want to do that
[02:30:17] <strcat> there are about to be 200 of those warnings from iterators, it's a compiler bug
[02:30:46] <aatch> strcat, then fix the bug?
[02:31:02] <aatch> anyway, brson, push to snap-stage3?
[02:31:21] <strcat> aatch: it doesn't make sense to make the code work harder because the dynamic borrow is being extended to the same scope
[02:32:02] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[02:32:02] *** Quits: int3_ (int3_@43CB6079.66715431.D25A875A.IP) (Client exited)
[02:32:30] <strcat> it's not warning about a problem in the code
[02:32:42] <strcat> it's just saying "the dynamic borrow *may* be longer than you expect here"
[02:32:47] <strcat> because of a compiler issue
[02:32:54] <aatch> strcat, I know. but it's a simple case, and it's not like we can turn it off.
[02:33:03] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Ping timeout)
[02:33:28] <strcat> aatch: but why make the code worse because of a false positive warning that's going to be fixed? ;\
[02:33:45] <bblum> come on rustc get over yourself. Trait:Owned totally fulfills owned
[02:34:36] <strcat> I'm about to introduce a hundred of those warnings from porting to external iterators - the dynamic borrow is the same scope as before, it's just a false positive
[02:34:38] <bblum> btw, do ~Traits not work yet for some reason?
[02:34:42] <bblum> i hear they are segfaulty
[02:34:48] <cmr> bblum: very buggy
[02:34:59] <bblum> :<
[02:35:35] <brson> aatch, strcat: let's not argue about this silly thing please. aatch cat you revert that commit and proceed with the snap?
[02:36:15] <dbaupp> bblum: there was a big fix recently, I think
[02:36:35] <dbaupp> actually, wait, that's not merged yet
[02:37:04] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[02:37:04] <ghrust> 01[13rust01] 15Aatch 04force-pushed 06master from 14e9c3894 to 1473c1839: 02http://git.io/V2xBBQ
[02:37:04] <ghrust> 13rust/06master 1473c1839 15Luqman Aden: libsyntax: Remove `drop` as a keyword.
[02:37:04] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[02:37:34] <aatch> so brson, thats a yes on pushing to snap-stage3?
[02:37:43] <brson> aatch: yes
[02:37:52] * strcat is sorry for being grumpy about it - I've been dealing with that terrible warning/bug for a while
[02:37:52] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[02:37:52] <ghrust> 01[13rust01] 15Aatch merged 06master into 06snap-stage3: 02http://git.io/Y0uPnw
[02:37:52] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[02:38:19] *** Quits: Aetherspawn (Aetherspaw@moz-8811D9F0.static.tpgi.com.au) (Connection reset by peer)
[02:38:21] <strcat> the "solution" is another scope and then it still warns
[02:38:35] <bblum> force-push to master
[02:38:37] <bblum> there's a new one
[02:39:01] <cmr> dbaupp: so I made an oopsie and some of the crates will have duplicate results runs in the json: you should take only the last one present. is this a problem?
[02:39:05] *** Joins: Aetherspawn (Aetherspaw@moz-8811D9F0.static.tpgi.com.au)
[02:39:35] <aatch> bblum, tree's closed and unless anybody had the misfortune of pulling from master in those 10 minutes, I don't think it hurt anyone
[02:40:05] <dbaupp> cmr: I can grep out the lines if I need to
[02:40:13] <strcat> one day we should really make a new history with all the accidentally binaries rebased out ;\
[02:40:43] <strcat> accidentally committed*
[02:40:57] <strcat> I guess bors could bail on binaries being committed
[02:41:16] *** Quits: cstrahan (cstrahan@moz-4C7E5789.hsd1.dc.comcast.net) (Ping timeout)
[02:41:19] <cmr> or reviewers could do a better job reviewing? :p
[02:42:04] <strcat> cmr: we let in lots of whitespace errors highlighted in the diffs too...
[02:42:20] <cmr> strcat: we shouldn't, make tidy bails on those
[02:42:22] <strcat> git diff $(git hash-object -t tree /dev/null) HEAD --check
[02:42:24] <strcat> cmr: nope
[02:42:28] <strcat> cmr: only checks src/
[02:42:33] <strcat> well
[02:42:36] <strcat> and not certain files
[02:42:51] <strcat> it doesn't check the tests, or rustllvm, and maybe not the runtime stuff
[02:43:04] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[02:43:10] <strcat> and it doesn't check for trailing newlines, no newline at the end of a file
[02:43:17] <dbaupp> there's a whole pile of junk in jemalloc
[02:43:28] <strcat> dbaupp: it's ignored in gitattributes though
[02:43:37] <strcat> src/rt/jemalloc/**/* -whitespace
[02:43:49] <dbaupp> ah, right
[02:44:50] <dbaupp> \o/ isrustfastyet copes with the new buildbot targets
[02:45:07] <cmr> dbaupp: http://octayn.net/data-benches.tar.xz
[02:45:13] *** Quits: bytbox (s@moz-D83E9B31.wireless.umd.edu) (Ping timeout)
[02:45:19] <aatch> strcat, for the expanded freeze issue, does it actually warn about the exact same scope?
[02:45:33] <strcat> aatch: well it warns when it would expand the scope to the outer scope
[02:45:42] <strcat> but even if the outer scope is just a block around the single expr
[02:45:44] <strcat> it still warns
[02:45:52] <strcat> so you can't silence it afaik
[02:46:22] *** Joins: Nisstyre (wes@moz-FD86289.netflash.net)
[02:46:25] <aatch> I'm guessing you have "expr" vs "block"?
[02:47:14] *** Quits: k00mi (koomi@moz-BE75DEBE.pools.arcor-ip.net) (Ping timeout)
[02:47:29] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[02:47:34] <strcat> aatch: well if foo.iter().advance triggers it, it will yell no matter where you put it
[02:48:01] <strcat> maybe the warning isn't working as intended
[02:48:12] <brson> cmr: I'll write up my thoughts about we should do differently in rustdoc 2 for the mailing list, but I'm not sure if I'll get it done tonight.
[02:48:14] <aatch> strcat, yeah, but the two notes say "should be expression xx, but is block zz"
[02:48:26] <aatch> right?
[02:48:28] <cmr> brson: ok
[02:48:31] <strcat> aatch: yeah but the expression can be the whole block
[02:48:32] *** Quits: brson (brson@2557E599.66715431.D25A875A.IP) (Quit: leaving)
[02:48:34] <strcat> { foo() }
[02:48:36] <strcat> will still warn
[02:48:54] <aatch> strcat, ok, that makes it hard to do a sanity fix.
[02:49:08] <strcat> aatch: in the example you fixed, it's extending it to the block
[02:49:14] <strcat> but the expression is the only thing in the block already
[02:49:23] <strcat> anyway I hate that warning :(
[02:49:30] *** Joins: bytbox (s@moz-2E27684C.student.umd.edu)
[02:49:31] <strcat> hopefully niko fixes the bug soon
[02:49:40] <cmr> we really need like 3 more nikos :p
[02:50:29] *** Joins: seth (seth@moz-D840E602.dsl.static.sonic.net)
[02:50:47] <aatch> Hah! looking at the bug, it's because of trans cleanups!
[02:50:53] <aatch> OF COURSE IT IS
[02:51:05] <seth> argh. so am i right in thinking that you cannot impl traits for &T?
[02:51:16] <seth> meaning i cannot impl Equiv<T> for &T?
[02:51:19] <strcat> aatch: because the cleanups are at the end of the whole block instead of during say...
[02:51:19] <aatch> seth, should be able to.
[02:51:21] <strcat> let _ = x?
[02:51:23] <aatch> you need a lifetime.
[02:51:45] <aatch> impl<'self, T> Equiv<T> for &'self T { ... }
[02:51:49] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[02:51:52] <strcat> anyway I was going to add 'contains' to IteratorUtil but it made 200 of those warnings
[02:51:54] <strcat> gave up
[02:52:01] <seth> aatch: hmm, cool. let me give it a try. thanks
[02:52:01] <strcat> it's fine but it's just so annoying
[02:52:19] <aatch> Ok, hit the snapshot.py bug
[02:52:26] *** Joins: jedestep (jedestep@moz-DA1D61AB.natpool.nyu.edu)
[02:53:03] <bblum> heh, wow, ~Trait really is broken
[02:53:11] <bblum> any attempt to dynamic dispatch on it hits llvm asserts
[02:54:35] <strcat> bblum: can get it to work sometimes
[02:54:54] <strcat> rusti: let t = (1, 2); let (ref x, ref y) = t;
[02:54:58] -rusti- ()
[02:55:02] <strcat> rusti: let t = (1, 2); let (ref x, ref y) = t; x
[02:55:03] -rusti- line longer than 150 columns, pastebinned: http://sprunge.us/PBhc
[02:55:16] <strcat> rusti: let t = (1, 2); let (ref x, ref y) = t; fmt!("%?", x)
[02:55:17] -rusti- line longer than 150 columns, pastebinned: http://sprunge.us/IFEi
[02:55:18] <dbaupp> bblum: https://github.com/mozilla/rust/pull/7214
[02:55:30] *** Joins: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net)
[02:55:41] <dbaupp> strcat: let + ref is broked
[02:55:53] <bblum> strcat: not with dispatch...?
[02:55:57] <strcat> dbaupp: let + anything is borked :D
[02:56:29] <bblum> rusti: trait Foo { fn foo(self); } impl <T> Foo for T { fn foo(self) { } } (~() as ~Foo).foo();
[02:56:30] -rusti- ()
[02:56:36] <bblum> hm
[02:56:56] <strcat> rusti: struct Foo { x: int } impl Drop for Foo { fn finalize(&self) { println("drop") } let a = Foo { x: 5 };
[02:56:57] -rusti- <anon>:13:0: 13:1 error: file ended with unbalanced delimiters
[02:56:57] -rusti- <anon>:13 }
[02:56:57] -rusti-           ^
[02:56:57] -rusti- application terminated with error code 101
[02:57:02] <strcat> rusti: struct Foo { x: int } impl Drop for Foo { fn finalize(&self) { println("drop") } } let a = Foo { x: 5 };
[02:57:03] -rusti- drop
[02:57:03] -rusti- ()
[02:57:13] <bblum> rusti: trait Foo { fn foo(self); } impl <T> Foo for T { fn foo(self) { } } fn x(y: ~Foo) { y.foo(); } x(~() as ~Foo);
[02:57:14] -rusti- ()
[02:57:15] <strcat> rusti: struct Foo { x: int } impl Drop for Foo { fn finalize(&self) { println("drop") } } let a = Foo { x: 5 }; let &oops = &a;
[02:57:16] -rusti- drop
[02:57:16] -rusti- drop
[02:57:16] -rusti- ()
[02:57:18] <strcat> :D
[02:57:35] <bblum> haha that's a big oops
[02:57:41] <dbaupp> strcat: that bus is pretty good
[02:57:45] <dbaupp> *bug
[02:58:16] <bblum> oh, nice 4-bug pull request
[02:58:18] <strcat> rusti: struct Foo { x: int } impl Drop for Foo { fn finalize(&self) { println("drop") } } let a = @Foo { x: 5 }; let @oops = a;
[02:58:18] -rusti- drop
[02:58:19] -rusti- drop
[02:58:19] -rusti- ()
[02:58:26] <strcat> yay let patterns
[02:58:37] *** Quits: rajul (quassel@A2DDF553.812B5995.2051BA92.IP) (Client exited)
[02:59:05] <strcat> rusti: struct Foo { x: int } impl Drop for Foo { fn finalize(&self) { println("drop") } } let a = Foo { x: 5 }; let oops = match &a { &a => a };
[02:59:07] -rusti- line longer than 150 columns, pastebinned: http://sprunge.us/SaJU
[02:59:13] <jld> rusti: struct Foo { x: ~int } impl Drop for Foo { fn finalize(&self) { println("drop") } } let a = Foo { x: ~5 }; let &oops = &a;
[02:59:14] -rusti- drop
[02:59:15] -rusti- drop
[02:59:15] -rusti- ()
[02:59:21] <strcat> rusti: struct Foo { x: int } impl Drop for Foo { fn finalize(&self) { println("drop") } } let a = Foo { x: 5 }; let oops = match @a { @a => a };
[02:59:22] -rusti- line longer than 150 columns, pastebinned: http://sprunge.us/ESUY
[02:59:38] <strcat> jld: it's fun, lets you 'copy' things in a generic function that aren't Copy, etc.
[02:59:42] <strcat> terrible bug.
[02:59:51] *** Joins: a__ (a__@moz-250D9B4.nycmny.fios.verizon.net)
[03:01:03] <aatch> Waaaah! I have to rebuild from scratch because of a stupid error...
[03:01:19] *** Joins: sw17ch (sw17ch@moz-675AFBCF.hsd1.mi.comcast.net)
[03:02:07] <jld> rusti: use std::cast; struct Foo { x: ~int } impl Drop for Foo { fn finalize(&self) { println(fmt!("drop %x", unsafe{cast::transmute_copy(&self.x)})) } } let a = Foo { x: ~5 }; let &oops = &a;
[03:02:09] -rusti- drop 7f43c4200930
[03:02:09] -rusti- drop 7f43c4200900
[03:02:09] -rusti- ()
[03:02:18] *** Quits: vk (chatzilla@F92596F.2DEF7520.EF7679FA.IP) (Quit: ChatZilla 0.9.90 [Firefox 22.0/20130617145905])
[03:02:40] <dbaupp> cmr: the data appears to be corrupted, or something http://www.ug.it.usyd.edu.au/~hwil7821/rust-bench/programs.html
[03:02:52] *** Joins: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com)
[03:03:15] <dbaupp> cmr: anyway I've got to concentrate on other things now
[03:03:58] <strcat> jld: I think ~int might zero itself in drop too ;
[03:03:59] <strcat> ;\
[03:04:20] <cmr> dbaupp: and I've got to sleep. good night
[03:04:33] <dbaupp> night
[03:07:03] *** Quits: sp3d (a@moz-49806493.dhcp.stls.mo.charter.com) (Ping timeout)
[03:07:31] <jld> ...I guess I can't get the magical copy to go into infinite recursion, can I.
[03:08:10] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Quit: Computer has gone to sleep.)
[03:12:01] *** Quits: a__ (a__@moz-250D9B4.nycmny.fios.verizon.net) (Client exited)
[03:12:31] *** Quits: roo (Mibbit@moz-75C9FCEA.dynamic.ip.windstream.net) (Quit: http://www.mibbit.com ajax IRC Client)
[03:13:14] *** Joins: a__ (a__@moz-250D9B4.nycmny.fios.verizon.net)
[03:16:16] <aatch> surprisingly few cfg'd out items in libstd
[03:16:50] <jld> strcat: And, yes, ~pointers (and @pointers?) were zeroed on drop, the last time I had cause to stare at disassembly of drop glue.
[03:21:40] *** Joins: sankha93 (Instantbir@1CE89D2.BC703A9E.8B6C1D65.IP)
[03:28:53] *** Joins: lkuper_ (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[03:29:20] <seth> sigh.
[03:29:34] <seth> i just can't get find_equiv to work
[03:30:26] <dbaupp> seth: what're the errors?
[03:30:56] <seth> error: cannot determine a type for this bounded type parameter: unconstrained type
[03:31:20] <seth> https://gist.github.com/sfowler/4aa4bdcd5fd6dc508363
[03:31:33] <seth> so there's my code. i'm trying to call find_equiv for LRUCache
[03:31:40] <strcat> rusti: let mut xs = std::hashmap::HashMap::new(); xs.insert(~"foo", "bar"); fmt!("%?", xs.find_equiv(&"foo"))
[03:31:41] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/FWcA
[03:31:45] <strcat> oh
[03:31:48] <strcat> rusti: let mut xs = std::hashmap::HashMap::new(); xs.insert(~"foo", "bar"); fmt!("%?", xs.find_equiv(&("foo")))
[03:31:49] -rusti- ~"Some(&\"bar\")"
[03:31:59] <seth> the callsite looks like: let item : Option<@FontGroup> = self.group_cache.find_equiv(style); 
[03:32:03] <strcat> why does &"foo" make a slice when "foo" is already a slice?
[03:32:04] <Aetherspawn_BNC> Honestly un-rig that shit to broadcast globally
[03:32:13] <Aetherspawn_BNC> it keeps pinging my phone and making all my IRC's beeps
[03:32:23] <seth> group_cache is of type LRUCache<SpecifiedFontStyle, @FontGroup>,
[03:32:27] <strcat> Aetherspawn_BNC: huh?
[03:32:28] <dbaupp> Aetherspawn_BNC: that means your client is incorrect
[03:32:44] <dbaupp> strcat: rusti's notify'ing
[03:32:51] -strcat- this is just supposed to not be automatically responded to
[03:33:03] <Aetherspawn_BNC> Hrnng, it might be incorrect.
[03:33:12] <seth> i have spent hours trying to fix this problem and have rearranged the code in many different ways =(
[03:34:03] <dbaupp> seth: doesn't position take fn(&A) -> bool ?
[03:34:19] <strcat> dbaupp: the iterator one takes a closure
[03:34:22] <strcat> dunno about the others
[03:34:29] <dbaupp> seth: but you've got fn(&A) -> Option<&@FontGroup>
[03:34:39] <strcat> dbaupp: https://github.com/mozilla/rust/pull/7213/files ;p
[03:34:57] <strcat> just started... really
[03:35:01] <strcat> so much left
[03:35:08] <dbaupp> strcat: yeah, `fn(&A) -> bool` is a closure?
[03:35:21] <aatch> heh, that's like 3-4 changes per file
[03:35:21] <seth> dbaupp: i don't see what you mean..
[03:35:24] <strcat> dbaupp: oh I though you meant the whole signature, I'm silly
[03:35:44] <dbaupp> seth: line 138 of that gist
[03:36:07] <seth> dbaupp: position is getting passed |&(k, _)| key.equiv(&k)
[03:36:07] <dbaupp> seth: you're calling ~[].position with a closure that return Some
[03:36:22] <seth> dbaupp: nah, that whole thing is inside a match expression
[03:36:32] <dbaupp> seth: yeah doesn't look like it
[03:36:41] * strcat just removed ~[].position
[03:36:46] *** Quits: Aetherspawn (Aetherspaw@moz-8811D9F0.static.tpgi.com.au) (Quit: Leaving)
[03:36:48] <dbaupp> seth: self.entries.position(|&(k, _)| key.equiv(&k))
[03:37:03] <dbaupp> seth: maybe it sould be `self.entries.position(|&(k, _)| key.equiv(&k).is_some())`
[03:37:10] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[03:37:16] <aatch> nmatsakis, ping
[03:37:19] <dbaupp> waiittt, .equiv isn't find_equiv
[03:37:27] <seth> you're saying equiv returns an option??
[03:37:44] <seth> yeah.. that part is OK
[03:37:47] <dbaupp> is .equiv even a method?
[03:37:57] <seth> this code compiles
[03:38:04] *** Quits: jedestep (jedestep@moz-DA1D61AB.natpool.nyu.edu) (Quit: jedestep)
[03:38:04] <seth> it's in a different crate from the caller that gives me the problem
[03:38:13] <seth> the problem is not that easy =)
[03:38:16] <strcat> rusti: ~"foo".equiv(&("foo"))
[03:38:17] -rusti- ~true
[03:38:24] <sully> woo
[03:38:26] <strcat> rusti: (~"foo").equiv(&("foo"))
[03:38:27] -rusti- true
[03:38:28] <sully> have this test working: https://gist.github.com/msullivan/5820128
[03:38:40] <dbaupp> seth: does it work with find_equiv?
[03:38:49] <dbaupp> (rather than .equiv)
[03:39:00] <dbaupp> wait
[03:39:04] <dbaupp> I'm really confused
[03:39:10] <dbaupp> (doesn't matter.)
[03:39:11] <strcat> sully: if you can get 'fn size_hint(&self) -> Option<uint> { None }' on std::iterator::Iterator to work, I'll be so happy ;p
[03:39:15] <seth> dbaupp: i'm the one writing find_equiv in this case, alas
[03:39:20] <strcat> looks like it will
[03:39:22] <seth> dbaupp: and apparently doing a very bad job of it
[03:39:23] <strcat> based on that working
[03:39:39] <dbaupp> seth: yup, I've now read the code properly... and everything I just said is wrong
[03:39:46] *** Joins: jedestep (jedestep@moz-7D1551F6.natpool.nyu.edu)
[03:40:25] <dbaupp> seth: what's K in the other crate?
[03:40:34] <sully> strcat: yeah, I think I got that working earlier
[03:40:40] <sully> strcat: in a pending pull request
[03:40:52] <strcat> if only bors was alive
[03:40:57] <seth> dbaupp: "SpecifiedFontStyle". it's a struct, the only trait it has is Eq.
[03:41:04] <aatch> I'm so close to a new snapshot
[03:41:15] <aatch> Except, I have a segfault...
[03:41:22] <dbaupp> seth: what things are Equiv'alent to it?
[03:41:40] <dbaupp> (are you calling .find_equiv in this other trait?)
[03:41:49] <seth> dbaupp: &SpecifiedFontStyle is the only thing
[03:41:55] <seth> (and that's what i'm trying to pass to find_equiv)
[03:42:28] <seth> here's my (probably wrong) implementation for Equiv: https://gist.github.com/sfowler/6666b0d83e21d2adb301
[03:42:33] <sully> I think that there are currently tons of problems with interactions with supertraits
[03:42:55] <sully> and default static typeclass methods probably don't work at all but hopefully won't be too bad
[03:43:06] <dbaupp> seth: what happens if you swap it to be `Equiv<&'self FontStyle> for FontStyle`?
[03:43:21] <sully> and I suspect that nothing will work at all if the actual *trait* has trait bounds on it
[03:43:31] <sully> but I haven't written the test for that yet or thought too hard about fixing it
[03:43:44] <seth> dbaupp: breakage. i tried that, alas. indeed, the standard library implementations of Equiv all have the same form as my implementation here
[03:43:55] <dbaupp> seth: hm yeah...
[03:44:08] <dbaupp> seth: do you really need Equiv for this though?
[03:44:27] *** Quits: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Connection reset by peer)
[03:44:27] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[03:44:55] <dbaupp> seth: can't you just pass a FontStyle by-ref to .find?
[03:45:07] <seth> dbaupp: i'm not sure how else to solve the problem without either (a) copying a SpecifiedFontStyle whenever i do a lookup (bad as its a decently big object) or (b) switching all the cache stuff back to using explicit borrowed pointers, which was causing me other problems, but maybe they're lesser problems
[03:45:38] <dbaupp> seth: hm, yeah, I have a feeling using explicit borrowed pointers will be easier/more idiomatic
[03:45:39] <seth> dbaupp: if by-ref you mean use a borrowed pointer, no, not the way the Cache trait is currently defined
[03:45:47] <dbaupp> seth: ah, right
[03:46:03] <strcat> seth: if you don't *need* ownership the parameter should be by-borrowed-pointer on a generic fn
[03:46:13] *** Joins: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[03:46:23] <strcat> or you're forcing a copy/move, and not all types are copyable
[03:46:39] <seth> strcat: heh, so you may remember we talked about this the other day
[03:46:43] <strcat> I don't think find_equiv will work for &T and T
[03:46:58] * strcat half remembers
[03:46:58] <seth> find_equiv's entire point is &T and T, afaik
[03:47:03] <strcat> seth: no
[03:47:11] <seth> or maybe ~T and T
[03:47:15] <strcat> nope
[03:47:28] <dbaupp> seth: [&~@]str
[03:47:28] <strcat> the entire point is looking up with &str for ~str keys, instead of &~str
[03:47:33] <strcat> the problem only exists for str/vec
[03:48:03] *** Quits: sw17ch (sw17ch@moz-675AFBCF.hsd1.mi.comcast.net) (Quit: sw17ch)
[03:48:12] <strcat> since there's almost no reason you'd use ~T as a key
[03:49:07] <seth> makes sense
[03:49:18] <seth> but why can't it work for &T and T?
[03:50:17] <seth> (now that you say that, i see that str's implementation of Equiv appears to be for ~str and &str.. i misread it before)
[03:51:23] <dbaupp> seth: wait, is std::hashmap::HashMap in scope in the other crate?
[03:51:28] *** Quits: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net) (Client exited)
[03:51:52] <seth> dbaupp: yeah, it is
[03:52:10] <dbaupp> seth: that's possibly the problem: https://github.com/mozilla/rust/issues/5898
[03:52:25] <dbaupp> since it also defines a .find_equiv method
[03:52:42] <dbaupp> (and rust really doesn't like methods with the same name at the moment :( )
[03:53:23] <seth> dbaupp: oh dear.. that is good to know
[03:53:28] <seth> dbaupp: that does indeed look like it could be it
[03:53:43] <seth> dbaupp: i'm probably making this worse by defining multiple incompatible methods named find_equiv on different types in scope
[03:53:45] <dbaupp> strcat: more 5898!
[03:53:55] <dbaupp> seth: that's possibly true
[03:54:01] <aatch> bblum, I need your help!
[03:54:19] *** Quits: lmandel (lmandel@556E85CD.E855F8D7.412CF160.IP) (Quit: lmandel)
[03:54:24] <strcat> dbaupp: nothing uses traits so we get these terrible issues ;[
[03:54:34] <strcat> unfixed
[03:54:42] <dbaupp> rusti: struct A; struct B; impl A { fn x(&self) {} } impl B { fn x(&self) {} } A.x(); b.x();
[03:54:42] *** Quits: Earnestly (earnest@6A917A59.5E1FD793.39C00A7A.IP) (Ping timeout)
[03:54:43] -rusti- <anon>:10:88: 10:89 error: unresolved name `b`.
[03:54:43] -rusti- <anon>:10          struct A; struct B; impl A { fn x(&self) {} } impl B { fn x(&self) {} } A.x(); b.x();
[03:54:43] -rusti-                                                                                                   ^
[03:54:43] -rusti- error: aborting due to previous error
[03:54:43] -rusti- application terminated with error code 101
[03:54:53] <dbaupp> rusti: struct A; struct B; impl A { fn x(&self) {} } impl B { fn x(&self) {} } A.x(); B.x();
[03:54:54] -rusti- ()
[03:54:57] <seth> dbaupp: ok. thanks. you've convinced me that there is no hope of making this work right now, which is good, because then i can go ahead and back these changes out
[03:55:26] <dbaupp> rusti: struct B; trait Foo { fn x(&self); } impl B { fn x(&self) {} } B.x();
[03:55:27] -rusti- ()
[03:55:34] <acrichto> aatch: if you're making the snapshot, you'll probably have to change https://github.com/mozilla/rust/blob/master/src/etc/snapshot.py#L29 and friends (I noticed freebsd failed there)
[03:55:36] <seth> dbaupp: (not that i didn't want it to work but i am happy to be able to take action one way or another instead of banging my head against the wall)
[03:55:45] <aatch> acrichto, I have fixed it locally
[03:55:52] <dbaupp> rusti: struct B; trait Foo { fn x(&self); } impl Foo for uint { fn x(&self) {} } impl B { fn x(&self) {} } B.x();
[03:55:53] -rusti- ()
[03:55:53] <acrichto> aatch: ah, excellent
[03:56:14] <aatch> Unfortunately, the snapshot doesn't seem to build a working compiler...
[03:56:28] <dbaupp> seth: :)
[03:57:02] <dbaupp> strcat: people are slowly using traits more
[03:57:24] <mcpherrin> i/9
[03:57:27] <mcpherrin> oops
[03:57:34] <dbaupp> strcat: (although, I guess that's mainly because we're forcing it upon them, heh.)
[03:58:30] *** Quits: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP) (Quit: carllerche)
[03:59:05] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[03:59:05] <ghrust> 01[13rust01] 15Aatch pushed 1 new commit to 06master: 02http://git.io/FEwi9g
[03:59:05] <ghrust> 13rust/06master 14433c865 15James Miller: Fix update snapshot script for rename
[03:59:05] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[03:59:22] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[03:59:32] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[03:59:38] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[03:59:38] <ghrust> 01[13rust01] 15Aatch merged 06master into 06snap-stage3: 02http://git.io/KEvaZw
[03:59:38] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[03:59:52] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[04:01:50] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: WeeChat 0.4.1)
[04:02:10] *** Quits: jedestep (jedestep@moz-7D1551F6.natpool.nyu.edu) (Quit: jedestep)
[04:04:13] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[04:05:20] *** Joins: brson (brson@DA348D07.AD1E507F.3688B332.IP)
[04:05:20] *** ChanServ sets mode: +o brson
[04:06:53] *** Quits: Nisstyre (wes@moz-FD86289.netflash.net) (Ping timeout)
[04:11:25] <aatch> brson, it might be some mistake on my part, but I seem to be getting an error with the stage1 compiler using the new snapshot. It immediately segfaults trying to spawn the task during startup.
[04:14:15] *** Quits: jensnock_ (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[04:14:52] <brson> aatch: I would guess this is related to the abi change for functions that don't take an environment. rt currently has some conditional compilation related to this in stage0
[04:15:24] <aatch> https://gist.github.com/Aatch/5820259
[04:16:22] *** Joins: Ralith_ (ralith@moz-50F3C77.vc.shawcable.net)
[04:16:43] *** Quits: Ralith (ralith@moz-50F3C77.vc.shawcable.net) (Connection reset by peer)
[04:17:09] <aatch> brson, context.rs?
[04:17:24] <aatch> No wait, this would be old rt
[04:18:28] <brson> aatch: in src/rt
[04:18:28] <aatch> brson, so I should take out all the #ifdef _RUST_STAGE0 stuff?
[04:18:33] <brson> yes
[04:18:56] <aatch> Oh thank god
[04:19:24] <aatch> Ok, lets try now.
[04:20:14] *** Joins: pyrac (pyrac@moz-DAB0A516.w109-222.abo.wanadoo.fr)
[04:21:06] <aatch> brson, can you get snap3-linux to stop and skip '73c1839579a6'?
[04:22:07] <brson> i can try
[04:22:50] <brson> i just used this page http://buildbot.rust-lang.org/builders
[04:22:52] <aatch> otherwise it'll be like midnight for me before I can push the changes for the new snapshot to auto (I assume thats the idea for this)
[04:23:17] <brson> aatch: you can request the build you want there. the u/p is rust/rust. and the branch and revision fields need to be filled
[04:23:52] <aatch> brson, cool. thanks
[04:24:46] <brson> aatch: when you get the new snapshot done, don't push it to master directly. let's do a pull request with a high priority r+ and let bors integrate it
[04:24:57] <brson> there's too great a risk of more breakage
[04:25:28] <aatch> brson, Not push it to auto myself?
[04:26:40] <brson> aatch: oh. yeah that's fine
[04:27:21] *** Joins: Nisstyre (wes@moz-FD86289.netflash.net)
[04:27:36] <bblum> aatch: what is it
[04:27:36] <aatch> Means we don't have to wait for graydon to turn bors back on.
[04:27:44] <aatch> bblum, too late. Fixed it :D
[04:27:58] <aatch> ABI changes that I didn't know about, caused a segfault
[04:28:06] <bblum> i see
[04:28:13] *** Joins: infynyxx_ (infynyxx@moz-E95B370B.nyc.res.rr.com)
[04:28:23] *** Quits: pyrac (pyrac@moz-DAB0A516.w109-222.abo.wanadoo.fr) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: sankha93 (Instantbir@1CE89D2.BC703A9E.8B6C1D65.IP) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: RMF (RMF@moz-8C13D5A2.dsl.telepac.pt) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: kimundi (kimundi@moz-364FCCA6.dip0.t-ipconnect.de) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: dbaupp (Thunderbir@moz-73E90475.lns20.syd6.internode.on.net) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: kini (kini@moz-92AA953A.members.linode.com) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: tedh (tedh@moz-CE9B2F5A.cinci.res.rr.com) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: sk (sk@61A494B3.BA40E8A.AAC02D62.IP) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: igl (igl@moz-5AE08D12.adsl.alicedsl.de) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: IRCMonkey56359 (heftig@moz-E9626940.dip0.t-ipconnect.de) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: cscottnet_away (cscott@moz-2577C94A.net) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: cr (anonymous@moz-BD0F2442.dip0.t-ipconnect.de) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: CarpNet (ac@moz-FD24B77.sohonet.co.uk) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: dsirenko (mitra@8E712A0.54C21BA0.9F317420.IP) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: robarnold (rob@BD56354E.DB510C09.6E370BFC.IP) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: wuwei (wuwei@1A513F49.818D7924.FAA9ED67.IP) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: jeltz (andreas@moz-7C6B0B72.tn.glocalnet.net) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: Aetherspawn_BNC (uid6924@moz-A588D045.irccloud.com) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: gazoombo (uid6629@moz-C944F5EC.irccloud.com) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: geomyidae__ (uid214@moz-C944F5EC.irccloud.com) (sand.mozilla.org gravel.mozilla.org)
[04:28:23] *** Quits: Boreeas (Boreeas@moz-F35C832D.boreeas.net) (sand.mozilla.org gravel.mozilla.org)
[04:28:47] <aatch> The segfault was in the task spawner, so I thought you might have an idea where to start.
[04:29:12] <bblum> good thing i was too late; i don't have a clue about ABI concerns
[04:30:03] <aatch> also, at the time you and nmatsakis were the only people online that I thought might have some idea.
[04:30:42] <bblum> aatch: what time zone are you in
[04:30:54] <aatch> +1200
[04:31:10] *** Joins: wuwei (wuwei@1A513F49.818D7924.FAA9ED67.IP)
[04:31:10] *** Joins: sankha93 (Instantbir@1CE89D2.BC703A9E.8B6C1D65.IP)
[04:31:10] *** Joins: kimundi (kimundi@moz-364FCCA6.dip0.t-ipconnect.de)
[04:31:10] *** Joins: IRCMonkey56359 (heftig@moz-E9626940.dip0.t-ipconnect.de)
[04:31:10] *** Joins: tedh (tedh@moz-CE9B2F5A.cinci.res.rr.com)
[04:31:10] *** Joins: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com)
[04:31:10] *** Joins: RMF (RMF@moz-8C13D5A2.dsl.telepac.pt)
[04:31:10] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[04:31:10] *** Joins: dbaupp (Thunderbir@moz-73E90475.lns20.syd6.internode.on.net)
[04:31:10] *** Joins: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk)
[04:31:10] *** Joins: kini (kini@moz-92AA953A.members.linode.com)
[04:31:10] *** Joins: sk (sk@61A494B3.BA40E8A.AAC02D62.IP)
[04:31:10] *** Joins: igl (igl@moz-5AE08D12.adsl.alicedsl.de)
[04:31:10] *** Joins: cscottnet_away (cscott@moz-2577C94A.net)
[04:31:10] *** Joins: Aetherspawn_BNC (uid6924@moz-A588D045.irccloud.com)
[04:31:10] *** Joins: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP)
[04:31:10] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[04:31:10] *** Joins: jeltz (andreas@moz-7C6B0B72.tn.glocalnet.net)
[04:31:10] *** Joins: dsirenko (mitra@8E712A0.54C21BA0.9F317420.IP)
[04:31:10] *** Joins: robarnold (rob@BD56354E.DB510C09.6E370BFC.IP)
[04:31:10] *** Joins: gazoombo (uid6629@moz-C944F5EC.irccloud.com)
[04:31:10] *** Joins: geomyidae__ (uid214@moz-C944F5EC.irccloud.com)
[04:31:17] <aatch> So it's a thursday afternoon here.
[04:31:18] *** Joins: CarpNet (ac@moz-FD24B77.sohonet.co.uk)
[04:31:35] *** Joins: cstrahan (cstrahan@moz-F976BC85.hsd1.va.comcast.net)
[04:31:37] <bblum> NZ?
[04:31:43] <aatch> bblum, correct
[04:32:02] <bblum> i ask because niko is not likely to be online at this hour
[04:32:09] <bblum> it being 0030 EST
[04:32:12] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[04:32:56] <aatch> bblum, eh, it says he's online. It also /doesn't/ say he's away
[04:32:58] *** Joins: Boreeas (Boreeas@moz-F35C832D.boreeas.net)
[04:33:04] <aatch> which it normally does
[04:33:34] <bblum> as a user of irssi and screen i have grown to totally ignore away statuses and just guess
[04:34:29] *** Quits: cstrahan (cstrahan@moz-F976BC85.hsd1.va.comcast.net) (Ping timeout)
[04:34:38] <dbaupp> is there a reason master-mac is failing, but auto-mac-* isn't?
[04:35:11] *** Joins: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net)
[04:35:37] *** Quits: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net) (Client exited)
[04:35:50] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[04:37:50] <aatch> dbaupp, differing configurations? Only thing I can think of.
[04:37:58] *** Quits: infynyxx_ (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[04:38:45] <aatch> In other news. I have a snapshot!
[04:38:58] *** cscottnet_away is now known as cscottnet
[04:39:29] <dbaupp> aatch: !
[04:39:54] <aatch> suprisingly few cfg(stage0)s to deal with.
[04:40:36] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[04:46:04] <aatch> man, using the snapshot is much nicer. It's soo much faster.
[04:46:11] *** Quits: tikue (tkuehn@2557E599.66715431.D25A875A.IP) (Quit: tikue)
[04:46:15] *** Quits: sankha93 (Instantbir@1CE89D2.BC703A9E.8B6C1D65.IP) (Ping timeout)
[04:47:27] <aatch> atleast it is when it's not swapping like hell
[04:48:29] <dbaupp> aatch: the old snapshot was slow, and the stage1 rustc it built was slow... now everything will be fast!
[04:48:41] <mcpherrin> 7
[04:48:47] <aatch> mcpherrin, 4
[04:49:41] <mcpherrin> aatch: 19!
[04:49:43] <aatch> Well the compiler itself has had a performance upgrade, and the code it produces is better than the current snapshot.
[04:51:05] <dbaupp> yep.. looking forward to it
[04:51:26] <aatch> Now I'm waiting for the bots to cycle so I can push to auto.
[04:51:47] <aatch> then there will be a second marker on the new set of points for isrustfastyet!
[04:52:07] <dbaupp> ;D
[04:52:09] <bblum> do want this snapshot
[04:52:22] <bblum> aatch, what difficulty did you finally overcome
[04:52:26] *** Ralith_ is now known as Ralith
[04:53:31] <aatch> bblum, pretty much just that ABI change, and some changes needed to be made to the snapshot python script
[04:53:52] *** Joins: rubber-duck (rubber-duc@moz-46024B72.dsl.iskon.hr)
[04:54:02] <bblum> aatch: the abi change is the thing we've been sitting on for like 2 weeks?
[04:54:26] <aatch> I dunno, the thing relating to environment parameters
[04:55:07] <aatch> 1 snapshot down
[04:55:08] <brson> aatch: excited to experience this fast compiler!
[04:55:08] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[04:56:01] <aatch> There were actually very few cfg'd off changes. Which is a good sign.
[04:56:17] <aatch> I think about 20 in the entire codebase
[04:56:51] <dbaupp> aatch: is util-snap3 meant to be building? (or am i reading http://buildbot.rust-lang.org/console?branch=snap-stage3&refresh=15 wrong?)
[04:57:05] <aatch> dbaupp, it is building.
[04:57:11] <aatch> it's just being weird.
[04:57:28] <dbaupp> cool
[04:57:32] <aatch> because I forced a build
[04:59:15] <aatch> Ugh, dynamic borrow error
[04:59:22] *** Quits: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Connection reset by peer)
[05:00:03] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[05:00:20] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[05:00:52] <strcat> aatch: weird, wouldn't that have already happened in stage1/stage2?
[05:00:52] *** Joins: ysuzuki (ysuzuki@moz-A563888C.ics.keio.ac.jp)
[05:01:22] <aatch> strcat, nah, this is from me changing places that say "Workaround error in stage0"
[05:03:32] <aatch> bblum, btw, there's no reason why we couldn't have a snapshot fairly soon after your PR.
[05:05:07] <bblum> yeah
[05:05:23] <bblum> i expect several people will want the same thing
[05:05:55] *** Joins: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP)
[05:06:05] *** Quits: Diamond (dick@moz-625C0DAF.ks.ok.cox.net) (Ping timeout)
[05:06:38] <aatch> it's just that this one is the first in over a month
[05:06:44] <aatch> and it's been a busy month...
[05:07:16] <bblum> yeah
[05:07:36] <aatch> I mean, we don't normally have to close the tree for "maintenance"
[05:07:43] <bblum> trufax
[05:08:01] <bblum> if it sounded like i meant the shapshot should hold off until my PR, i definitely didn't mean that :P
[05:08:13] *** Joins: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com)
[05:08:23] <aatch> bblum, I know. That's why I'm not putting it off :D
[05:08:29] <bblum> ;)
[05:10:45] <aatch> strcat, would I right in thinking that `for vec.iter().advance...` is faster than `let len = vec.len(); for uint::range(0, len)...`?
[05:11:08] <dbaupp> aatch: yes
[05:11:25] <dbaupp> (assuming you're indexing the vector in the loop)
[05:11:32] <aatch> dbaupp, correct
[05:11:38] <bblum> presumably because of bounds checks?
[05:11:44] <dbaupp> yep
[05:11:59] <dbaupp> the vec iterators all use * pointers for speed
[05:12:28] <aatch> cool, well there were a few places written like the latter because of borrow-check errors.
[05:12:37] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[05:12:54] <dbaupp> (fwiw, the last snapshot was on the 20th of may, and there have been 260 pull requests/611 commits since then)
[05:13:18] <aatch> dbaupp, 20th? the snapshots file says 17th
[05:13:50] <aatch> dbaupp, also, remember that one of those pull requests was core->std std->extra
[05:13:59] <dbaupp> aatch: oh, ... the last snapshot was merged in 2e6cda254a2acdcd60efb62a27f69c7702b8f71
[05:14:40] <dbaupp> (which says may 20. not that it matters, heh :) )
[05:14:51] <strcat> aatch: yeah using .iter() just does 1 pointer bump + 1 pointer cmp for each iteration
[05:15:22] <aatch> Cool. I might hunt down other places doing it, that don't have nice messages...
[05:15:24] <strcat> using [idx] will usually end up compiling to an add and 2 compares
[05:15:34] <strcat> sometimes it hoists out the check
[05:16:09] *** Joins: pyrac (pyrac@moz-DAB0A516.w109-222.abo.wanadoo.fr)
[05:20:04] <aatch> Oh yeah, snap-bsd is almost done.
[05:22:18] <aatch> 2 down, 2 to go
[05:22:41] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Quit: Konversation terminated!)
[05:23:11] <brson> oh man, does bsd even work?
[05:23:36] <brson> oh, it does! that's a pleasant surprise
[05:23:38] <aatch> brson, it built
[05:23:40] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[05:24:16] <aatch> Halfway there!
[05:24:29] <brson> so many green builds. i'm so happy
[05:25:18] <aatch> linux is on testing, so mac can't be far behind
[05:31:27] <aatch> brson, it seems that it is possible to do `let main: extern "Rust" fn() = transmute(main)` now btw
[05:32:54] *** Joins: Aetherspawn (Aetherspaw@moz-8811D9F0.static.tpgi.com.au)
[05:37:37] *** Quits: CarpNet (ac@moz-FD24B77.sohonet.co.uk) (Ping timeout)
[05:37:37] *** Quits: pyrac (pyrac@moz-DAB0A516.w109-222.abo.wanadoo.fr) (Ping timeout)
[05:37:49] *** Quits: kimundi (kimundi@moz-364FCCA6.dip0.t-ipconnect.de) (Ping timeout)
[05:37:49] *** Quits: IRCMonkey56359 (heftig@moz-E9626940.dip0.t-ipconnect.de) (Ping timeout)
[05:37:59] *** Quits: wuwei (wuwei@1A513F49.818D7924.FAA9ED67.IP) (Ping timeout)
[05:37:59] *** Quits: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP) (Ping timeout)
[05:38:00] *** Quits: zootm (calum@moz-DCC1F9C3.sgyl.cable.virginmedia.com) (Ping timeout)
[05:38:13] *** Joins: zz_kimundi (kimundi@moz-364FCCA6.dip0.t-ipconnect.de)
[05:38:24] *** Joins: pyrac (pyrac@moz-DAB0A516.w109-222.abo.wanadoo.fr)
[05:38:26] *** Joins: IRCMonkey56359 (heftig@moz-E9626940.dip0.t-ipconnect.de)
[05:38:35] *** zz_kimundi is now known as kimundi
[05:38:41] *** Joins: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP)
[05:39:33] *** Joins: zootm (calum@moz-DCC1F9C3.sgyl.cable.virginmedia.com)
[05:40:04] *** Joins: MaikKlein (maik@moz-36D8270A.dip0.t-ipconnect.de)
[05:40:28] *** Joins: CarpNet (ac@moz-FD24B77.sohonet.co.uk)
[05:44:31] <yichoi> #7128 r?
[05:44:35] <bblum> aatch: why wouldn't it be possible to do that without a transmute
[05:44:46] *** Quits: ysuzuki (ysuzuki@moz-A563888C.ics.keio.ac.jp) (Ping timeout)
[05:44:52] <aatch> bblum, in that case, main is *u8 I think.
[05:45:13] <aatch> I dunno, I'm just going by what pcwalton put in zero.rs
[05:47:24] *** Joins: ysuzuki (ysuzuki@moz-3830D141.st.keio.ac.jp)
[05:49:15] <dbaupp> aatch: http://buildbot.rust-lang.org/builders/snap3-mac/builds/320
[05:49:27] <aatch> ARGH
[05:50:00] <aatch> brson, any ideas ^
[05:50:21] <dbaupp> "rust: task failed at 'lookup_item: id not found: 510464', /Users/rustbuild/src/rust-buildbot/slave/snap3-mac/build/src/librustc/metadata/decoder.rs:86"
[05:50:42] <dbaupp> that's normally the error when a rustc is trying to load a crate compiled by a different rustc, isn't it?
[05:50:48] <aatch> Why metadata, why?!
[05:50:55] *** Quits: pyrac (pyrac@moz-DAB0A516.w109-222.abo.wanadoo.fr) (Quit: pyrac)
[05:53:13] *** Joins: wuwei (wuwei@1A513F49.818D7924.FAA9ED67.IP)
[05:55:09] <aatch> The worst part is that all the other snaps need to be re-done
[05:55:34] *** Quits: lkuper_ (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Ping timeout)
[05:55:43] <brson> cmr: I didn't make any progress on rustdoc tonight. I'm sorry, but I'll try again to get my thoughts down tomorrow
[05:56:07] <dbaupp> aatch: master-linux fails with the same error
[05:56:17] <dbaupp> aatch: so I guess that snapshot'll fail too anyway
[05:56:48] *** Quits: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP) (Quit: carllerche)
[05:57:19] <brson> aatch: aw, that sucks
[05:57:42] <brson> aatch: let's ignore the test and try again
[05:57:51] *** Joins: Blei (philipp@moz-96D25F7A.cust.bluewin.ch)
[05:58:16] <aatch> it's in rustpkg by the looks of it.
[05:58:50] <brson> it may be because of that problem with LD_PRELOAD errors being written to stderr under valgrind
[05:58:50] *** Joins: pyrac (pyrac@moz-DAB0A516.w109-222.abo.wanadoo.fr)
[05:59:12] *** Quits: paulproteus (quassel@rose.makesad.us) (Ping timeout)
[05:59:21] <aatch> brson, nah, it gets an error about metadata
[06:00:06] *** Joins: paulproteus (quassel@moz-E86A3B42.makesad.us)
[06:00:08] <brson> aatch: oh, maybe we're talking about different things. I was looking at dbaupp's snapshot log
[06:00:37] <dbaupp> brson: the error message seems to be 'lookup_item: id not found: 510464 ...'
[06:00:46] <dbaupp> (i.e. rustc ICE-ing)
[06:01:20] <brson> dbaupp: do you have a link? the log I'm looking at doesn't say that
[06:01:27] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[06:01:56] <dbaupp> brson: this one http://buildbot.rust-lang.org/builders/snap3-mac/builds/320/steps/test/logs/stdio ?
[06:01:56] <aatch> brson, search for 'test_all ... FAILED'
[06:02:50] <aatch> Hmm, there's a fixme on that test
[06:02:56] <brson> rustpkg tests could chill out a bit
[06:03:03] <aatch> saying that it can't be run in parallel.
[06:03:21] <aatch> Oh, I guess that's something different
[06:03:43] <aatch> brson, just add #[ignore]?
[06:03:46] <brson> yeah I see the error now
[06:03:56] <acrichto> I remember seeing that error awhile ago and it was supposed to be fixed by https://github.com/mozilla/rust/pull/6733
[06:03:59] <brson> aatch: yeah and open an issue and ping @catamorphism
[06:04:14] <acrichto> I guess it wasn't :(
[06:04:30] <dbaupp> it's pretty strange it doesn't happen on auto?
[06:04:44] <aatch> rustpkg tests don't run on auto I think
[06:05:57] <acrichto> they do, just not on the *-all bots
[06:07:25] *** Quits: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net) (Ping timeout)
[06:07:47] <aatch> acrichto, so it only fails on multi-host builds?
[06:08:04] <acrichto> that's what it looks like yeah
[06:08:15] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[06:08:18] *** Joins: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net)
[06:09:54] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[06:09:54] <ghrust> 01[13rust01] 15Aatch pushed 1 new commit to 06snap-stage3: 02http://git.io/w3DWRQ
[06:09:54] <ghrust> 13rust/06snap-stage3 1482ba030 15James Miller: Ignore rustpkg tests
[06:09:54] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[06:10:21] <acrichto> aatch: I may have an idea as to the problem, but I'll open a pull request later if I'm right
[06:10:48] *** Joins: nano (nano@moz-972880B.superkabel.de)
[06:11:22] *** Quits: pyrac (pyrac@moz-DAB0A516.w109-222.abo.wanadoo.fr) (Quit: pyrac)
[06:12:43] <brson> aatch: please push that to master too
[06:12:51] <aatch> brson, sure
[06:12:56] <aatch> jsut sorting out the bots
[06:13:01] <brson> ok
[06:13:43] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[06:13:43] <ghrust> 01[13rust01] 15Aatch merged 06snap-stage3 into 06master: 02http://git.io/l0QdNQ
[06:13:43] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[06:16:52] *** aatch is now known as aatch|gone
[06:18:02] <brson> aatch|gone: thanks
[06:18:07] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[06:18:57] *** aatch|gone is now known as aatch
[06:19:02] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[06:19:37] <aatch> Ok... missed my bus, so I might as well wait for github to come back
[06:22:01] *** Quits: devbug (quassel@moz-E1DE087C.bchsia.telus.net) (Ping timeout)
[06:23:22] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[06:26:46] *** Joins: robert (robertknig@moz-C34822AC.range86-166.btcentralplus.com)
[06:30:17] *** Joins: sankha93 (Instantbir@2B8F41EF.58985164.8B6C1D65.IP)
[06:30:42] *** Quits: nano (nano@moz-972880B.superkabel.de) (Connection reset by peer)
[06:31:11] *** Quits: MaikKlein (maik@moz-36D8270A.dip0.t-ipconnect.de) (Ping timeout)
[06:31:51] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[06:31:51] <ghrust> 01[13rust01] 15brson merged 06master into 06auto: 02http://git.io/6Wes3g
[06:31:51] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[06:32:52] <aatch> heh, forgot about auto
[06:35:11] <aatch> Ok, now I'm actually going home. I demand a snapshot!
[06:35:59] *** aatch is now known as aatch|gone
[06:36:11] <aatch|gone> I'll be back later (on a different machine)
[06:36:14] *** Quits: rubber-duck (rubber-duc@moz-46024B72.dsl.iskon.hr) (Input/output error)
[06:41:18] *** Quits: anri (solancile@moz-A1CFFAE5.hsd1.wa.comcast.net) (Quit: anri)
[06:45:33] *** Joins: berak (chatzilla@601BF408.4742BCFA.1A5CC7E5.IP)
[06:46:09] *** Parts: berak (chatzilla@601BF408.4742BCFA.1A5CC7E5.IP) ()
[06:46:29] *** Quits: robert (robertknig@moz-C34822AC.range86-166.btcentralplus.com) (Ping timeout)
[06:55:32] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[06:57:59] *** Quits: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net) (Quit: Don't tell them I was here...)
[06:58:38] *** Joins: pyrac (pyrac@EDE6BD92.73C89388.AD05C589.IP)
[07:04:48] *** Joins: SimonSapin (simon@moz-73287A57.zone9.bethere.co.uk)
[07:07:26] *** Quits: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzz‚Ä¶)
[07:08:07] *** Joins: victorporof (victorporo@70DEDDA.9004F55.9B1E38F4.IP)
[07:17:11] *** Joins: doener (doener@moz-121949B3.unitymediagroup.de)
[07:17:27] *** Joins: rubber-duck (rubber-duc@moz-FBA1D66E.dsl.iskon.hr)
[07:18:09] *** Joins: ysuzuki_ (ysuzuki@moz-3830D141.st.keio.ac.jp)
[07:18:10] *** Quits: ysuzuki (ysuzuki@moz-3830D141.st.keio.ac.jp) (No route to host)
[07:18:11] *** Quits: ysuzuki_ (ysuzuki@moz-3830D141.st.keio.ac.jp) (Client exited)
[07:18:56] *** Joins: hansjorg (hansjorg@moz-EECB5F79.static.cust.telenor.com)
[07:30:32] *** Joins: Diamond (dick@moz-C01E1CD1.ks.ks.cox.net)
[07:34:42] *** Joins: aatch (aatch@moz-2BB0AC01.cable.telstraclear.net)
[07:35:36] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[07:36:28] <pyrac> hi there ! I have an ICE rust: task failed at 'assertion failed: !bcx.ccx().maps.moves_map.contains(&arg_expr.id)', /Users/saut/Dropbox/DevStuff/Rust/rust/src/librustc/middle/trans/callee.rs:811 than I cannot understand
[07:36:57] <dbaupp> aatch: the buildbots are being really slow! there are two mac builders... one's doing 7 builds the other is doing 0 :/
[07:37:28] <aatch> dbaupp, ugh
[07:38:15] <dbaupp> pyrac: that bug is annoying... there's a few issues open with the same message, but none of them mention any work-arounds :( (you could look at them to try to narrow down the problme code though)
[07:38:58] *** Joins: MaikKlein (maik@moz-3D64CF73.uni-koblenz.de)
[07:39:02] <pyrac> dbaupp: ok thanks I'll investigate !
[07:41:32] <aatch> dbaupp, at least the linux snap is on it's own slave
[07:42:07] *** Joins: ysuzuki (ysuzuki@moz-A563888C.ics.keio.ac.jp)
[07:44:03] <aatch> brson, mind if I cancel the auto builds on the mac slave? It'll all get tested in master+snap-stage3 anyway
[07:45:00] *** Joins: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net)
[07:45:13] *** Quits: MaikKlein (maik@moz-3D64CF73.uni-koblenz.de) (Ping timeout)
[07:46:00] *** Quits: wilsonk|2 (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[07:46:44] <brson> aatch: that's fine
[07:53:49] <aatch> If I disappear suddenly, my house has been picked up by the wind and I'm on my to Oz
[07:55:06] <dbaupp> aatch: planning on migrating to the mainland? :p
[07:56:46] <aatch> dbaupp, I was thinking more of the Wizard of Oz
[07:57:05] <dbaupp> hehe
[07:58:43] <brson> 0.7 had 47 new authors
[07:59:01] <aatch> why would I want to move to Australia, it's full of... uhh... Australians...
[07:59:12] <dbaupp> brson: woah!
[07:59:33] <dbaupp> aatch: yep, that's a pretty good reason to come over here
[08:00:04] <aatch> dbaupp, true, it's hard to get a good shot from across the Tasman :P
[08:00:52] <dbaupp> haha :'(
[08:01:51] <aatch> Heh, I got confused for a moment. I fixed all the warnings in the libraries (except librustc) and was confused at the lack of output
[08:02:09] *** Joins: mleise (marco@moz-3468AB5B.pools.arcor-ip.net)
[08:02:21] <aatch> the mac bot has finally started testing.
[08:02:49] <aatch> it was only 55mins slower than the linux build...
[08:03:40] <dbaupp> put them back! how else will we know the compiler isn't slacking off??
[08:04:08] <aatch> dbaupp, watch your memory usage slowly, but surely, climb?
[08:05:37] *** Joins: true_droid (Adium@moz-123FD9B8.beck.volia.net)
[08:07:59] *** Quits: SimonSapin (simon@moz-73287A57.zone9.bethere.co.uk) (Ping timeout)
[08:10:39] <aatch> ok, so now the only rustc compiler warning you see is one artificially extended freeze scope
[08:12:06] <Blei> hmm, are you doing a snapshot?
[08:12:39] <aatch> Blei, I am
[08:12:59] <Blei> aatch: great!
[08:13:05] <aatch> Currently waiting on the buildbots
[08:13:50] <Blei> slightly bad timing on my part, i'll soon have a patch that would benefit from a snapshot (removing the intrinsic module)
[08:14:13] <Blei> but there will always be a next snapshot
[08:14:57] <aatch> Blei, yeah. bblum hit a "can't continue that work without another snapshot"
[08:17:12] <aatch> looks like auto is still all green (minus the purple from me cancelling 4 of the 7 builds that were running on a single poor buildslave)
[08:21:31] <aatch> I might see how much work it is to try and have a snapshot per week or so
[08:21:49] *** Joins: fabiand (fabiand@647162F9.C4D4A1E0.1A5CC7E5.IP)
[08:21:55] <doener> aatch: so my warning is the last one left? I feel special now ;-)
[08:22:15] *** Quits: brson (brson@DA348D07.AD1E507F.3688B332.IP) (Ping timeout)
[08:22:17] <aatch> doener, yes. I did take it out, but strcat made me put it back in.
[08:24:34] <dbaupp> aatch: the linux snap is possibly doing its thing where it sits doing nothing for an hour :(
[08:25:39] <aatch> dbaupp, doubt it, I'm pretty sure it's doing the test suite twice.
[08:25:57] *** Joins: vmx (vmx@moz-95B7C46F.pools.arcor-ip.net)
[08:26:09] <aatch> once for x86_64, another for i686
[08:26:09] <dbaupp> sure? because the stdio looks like it's halted in the middle of stdtest, which is where master appears to stop too
[08:26:53] <dbaupp> hopefully :)
[08:27:08] <aatch> dbaupp, ugh, looks like you're right.
[08:27:47] <dbaupp> :(
[08:27:56] <aatch> dbaupp, this only occasionally?
[08:28:22] <dbaupp> ?
[08:28:26] <aatch> like, if i restart the build, will it probably go through?
[08:29:17] <dbaupp> no idea... but from a random sample of 3 of master builds, it looks like they go through (and fail for other reasons)
[08:29:24] <dbaupp> so maybe?
[08:29:34] *** Joins: Palmik (palmik@moz-5CA3F354.pks.muni.cz)
[08:32:18] <aatch> dbaupp, yeah, looks the bot stopped altogether
[08:32:26] *** Joins: ac_dc (ac@moz-FD24B77.sohonet.co.uk)
[08:32:44] <aatch> "Last heard from: about 8 minutes ago"
[08:33:10] *** Joins: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP)
[08:33:17] *** Quits: ac_dc (ac@moz-FD24B77.sohonet.co.uk) (Quit: Leaving)
[08:34:11] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[08:34:11] <dbaupp> aatch: are you looking at http://buildbot.rust-lang.org/buildslaves ?
[08:34:29] <aatch> dbaupp, yeah. and I just realized I was looking at the wrong line
[08:34:38] *** Quits: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP) (Connection reset by peer)
[08:35:00] <dbaupp> aatch: oh, in any case, which ever one you were looking at has reconnected
[08:35:07] *** Joins: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP)
[08:35:16] <dbaupp> (since they're all ~1 minute ago)
[08:39:11] <Blei> does compiling libstd with --test link to an existing libstd.so?
[08:40:13] <aatch> Blei, yes
[08:40:28] <dbaupp> Blei: I think it does, `#[cfg(test)] extern mod realstd(name = "std")`
[08:40:31] *** Quits: fabiand (fabiand@647162F9.C4D4A1E0.1A5CC7E5.IP) (Ping timeout)
[08:40:49] <Blei> aatch, dbaupp: thanks. more cfgs it is.
[08:46:04] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[08:46:23] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[08:46:33] *** Quits: vmx (vmx@moz-95B7C46F.pools.arcor-ip.net) (Quit: Leaving)
[08:46:59] <aatch> dbaupp, ok, there was definitely something up with the linux snap builds
[08:46:59] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[08:47:34] <dbaupp> aatch: restarted?
[08:47:41] <aatch> Ahh. the mac make-snap-stage3 step failed
[08:48:18] <dbaupp> didn't you fix that?
[08:48:51] <aatch> dbaupp, yep, I missed a single line
[08:48:56] <dbaupp> :(
[08:49:31] <dbaupp> and the whole process starts again...
[08:49:41] *** Joins: fabiand (fabiand@647162F9.C4D4A1E0.1A5CC7E5.IP)
[08:50:13] <aatch> dbaupp, fortunately bsd and windows are relatively fast and I was gonna have to wait for linux anyway...
[08:50:34] <dbaupp> heh, glass half-full
[08:50:49] * aatch is being an optimist
[08:51:00] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[08:51:05] *** Quits: fabiand (fabiand@647162F9.C4D4A1E0.1A5CC7E5.IP) (Connection reset by peer)
[08:51:23] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[08:51:23] <ghrust> 01[13rust01] 15Aatch pushed 1 new commit to 06master: 02http://git.io/tjcM-A
[08:51:23] <ghrust> 13rust/06master 147375e94 15James Miller: core -> extra for mac
[08:51:23] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[08:51:23] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[08:51:40] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[08:51:40] <ghrust> 01[13rust01] 15Aatch merged 06master into 06snap-stage3: 02http://git.io/9Eecaw
[08:51:40] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[08:51:49] *** Quits: xenocons (otk@moz-C675529E.members.linode.com) (Ping timeout)
[08:52:32] <kimundi> oouh, a snapshot is being prepared?
[08:52:41] <aatch> kimundi, trying!
[08:52:55] <kimundi> So the tree is green?
[08:52:58] <aatch> keep running into stupid problems
[08:53:01] <aatch> kimundi, yep
[08:53:04] <dbaupp> kimundi: http://buildbot.rust-lang.org/console?refresh=15
[08:53:05] <kimundi> nice
[08:53:07] <dbaupp> kimundi: very green
[08:53:33] <dbaupp> (the purple is aatch making things go faster...)
[08:53:56] <aatch> 2 mac slaves, 1 with 7 builds, another with none...
[08:54:30] <dbaupp> why's it do that??
[08:54:44] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[08:55:02] <aatch> dbaupp, probably one of the slaves went down
[08:55:14] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[08:55:57] *** Joins: SimonSapin (simon@88F51059.F3BBB17D.144F44FA.IP)
[08:58:03] *** Joins: fabiand (fabiand@647162F9.C4D4A1E0.1A5CC7E5.IP)
[08:59:20] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[09:00:10] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[09:02:12] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[09:03:02] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[09:03:56] <aatch> auto's almost green (other than the purple...)
[09:05:07] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[09:05:44] *** Joins: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk)
[09:05:44] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[09:07:24] *** Joins: pnkfelix (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net)
[09:08:04] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[09:09:08] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[09:09:19] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[09:11:24] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[09:12:24] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[09:13:39] *** Joins: snearch (snearch@moz-89D19BC2.pool.mediaways.net)
[09:15:09] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[09:16:12] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[09:19:19] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[09:20:05] *** Quits: fabiand (fabiand@647162F9.C4D4A1E0.1A5CC7E5.IP) (Quit: Verlassend)
[09:20:09] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[09:20:22] <nmatsakis> aatch: pong
[09:21:16] <aatch> nmatsakis, bit late... I was having some trouble with the snapshot stuff. all sorted now though, heh.
[09:21:36] <nmatsakis> aatch: ok, sorry :)
[09:21:58] <aatch> nmatsakis, it's fine.
[09:22:23] <aatch> We almost have a snapshot!
[09:22:31] <nmatsakis> aatch: what was the problem? I saw someting about segfaults in task spawning? I ask because I'm encountering some problems with my rebased patch, maybe related?
[09:22:54] <aatch> nmatsakis, nah, it was the ABI changes for functions that don't take an environment
[09:23:05] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[09:23:13] <nmatsakis> aatch: that is very likely related...
[09:23:20] <nmatsakis> aatch: what did you fix?
[09:23:32] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[09:23:33] <nmatsakis> aatch: I didn't see a commit that looked related to that?
[09:23:39] <aatch> nmatsakis, I just got rid of the #ifdef _RUST_STAGE0
[09:23:48] <aatch> and it's only local atm.
[09:23:58] <nmatsakis> aatch: ah, ok...
[09:24:03] <nmatsakis> aatch: maybe not my problem then :)
[09:24:11] <aatch> nmatsakis, probably not, lol
[09:25:58] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[09:26:19] *** Joins: pnkfelix|rcirc (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net)
[09:26:23] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[09:28:53] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[09:28:58] *** kimundi is now known as zz_kimundi
[09:29:54] <pyrac> dbaupp: https://github.com/mozilla/rust/issues/6609 seems fixed by replacing the += operator.
[09:29:54] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[09:31:24] *** Joins: z0w0 (zack@FDF4EF6A.2CA5CD8.5F93A189.IP)
[09:31:48] <dbaupp> pyrac: nice debugging :)
[09:32:28] <pyrac> dbaupp: to be honest it was mentioned in the other issues :) (and it also fixes my own code)
[09:33:14] <dbaupp> heh, don't tell me that ;P
[09:33:36] *** Joins: vmx (vmx@moz-95B7C46F.pools.arcor-ip.net)
[09:34:07] <pyrac> dbaupp: I'd like to help fix the issue but it is probably well above my abilities !
[09:34:53] <dbaupp> yeah, I have that problem too... I meet a bug, but then I have no idea where to start :(
[09:34:56] <indutny> morning guys
[09:34:56] *** Quits: vmx (vmx@moz-95B7C46F.pools.arcor-ip.net) (Quit: Leaving)
[09:35:00] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[09:35:01] <indutny> just discovered extra::arena
[09:35:41] <indutny> but sadly its still not what I need :P
[09:35:44] <dbaupp> pyrac: (if that bug is just a problem with +=, the it'll probably be fixed if/when we get overloaded operator-assignments)
[09:35:49] <indutny> gotta write my own thing eventually
[09:36:07] <pyrac> dbaupp: great news ! 
[09:37:11] *** zz_kimundi is now known as kimundi
[09:37:53] *** Joins: vmx (vmx@moz-95B7C46F.pools.arcor-ip.net)
[09:38:19] <indutny> also, will you guys accept patch adding mmap/munmap to rust's libc?
[09:38:53] <dbaupp> indutny: i'm sure it would be accepted
[09:39:04] <indutny> kewl
[09:39:06] <indutny> thanks
[09:39:44] <dbaupp> aatch: ping
[09:39:49] <aatch> dbaupp, pong
[09:40:38] <dbaupp> aatch: 3 of the 4 issues linked in https://github.com/mozilla/rust/issues/6609 can be closed as duplicates of it (all except #6000)
[09:41:01] <aatch> dbaupp, on it
[09:41:25] <dbaupp> (if you're interested, the common vein is += / *= )
[09:42:16] <dbaupp> aatch: also, https://github.com/mozilla/rust/issues/6699
[09:42:23] <aatch> dbaupp, doesn't surprise me.
[09:42:28] <aatch> dbaupp, another dupe?
[09:42:33] <dbaupp> yeah
[09:45:03] *** Joins: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl)
[09:45:39] <aatch> What the hell is going on with the bots.
[09:45:44] <indutny> hm...
[09:45:46] <indutny> just noticed
[09:45:50] <indutny> mmap/munmap is not really a libc
[09:45:52] <indutny> :(
[09:46:17] <indutny> should I place them in os.rs instead?
[09:48:03] <dbaupp> indutny: probably
[09:48:22] <dbaupp> aatch: has linux crashed again?
[09:48:31] <aatch> dbaupp, dunno
[09:48:47] <aatch> doesn't look like it
[09:49:02] <dbaupp> aatch: oh, then what's the confusion? :S
[09:49:21] <aatch> dbaupp, nothing. I misread a line
[09:49:22] *** Joins: k00mi (koomi@moz-BE75DEBE.pools.arcor-ip.net)
[09:49:32] <dbaupp> oh, heh
[09:58:23] <aatch> FUCK
[09:58:32] <aatch> debug-info tests are still broken
[09:59:14] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[10:00:58] *** Joins: EXetoC (ex@moz-2DBEB1E4.customer.t3.se)
[10:04:45] *** Joins: maxli (maxli@C03F2759.C70D537E.2FA4EA88.IP)
[10:05:48] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[10:05:48] <ghrust> 01[13rust01] 15Aatch pushed 1 new commit to 06master: 02http://git.io/tNVmaw
[10:05:48] <ghrust> 13rust/06master 14f5036c2 15James Miller: xfail box-related debug-info tests r=snapshot
[10:05:48] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[10:05:59] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[10:05:59] <ghrust> 01[13rust01] 15Aatch merged 06master into 06snap-stage3: 02http://git.io/JyeJzA
[10:05:59] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[10:07:37] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[10:10:07] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[10:10:32] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[10:12:15] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[10:12:28] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Ping timeout)
[10:16:03] *** Joins: vosen (vosen@moz-266BA656.icpnet.pl)
[10:17:08] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[10:18:46] *** Joins: cdidd (cdidd@moz-2AAEE3C7.broadband.corbina.ru)
[10:19:35] <rubber-duck> man googling stuff about rust is something else "rust kinds" -> "Rust (fungus)"
[10:22:08] *** Quits: maxli (maxli@C03F2759.C70D537E.2FA4EA88.IP) (Quit: Leaving.)
[10:25:04] *** Quits: pyrac (pyrac@EDE6BD92.73C89388.AD05C589.IP) (Quit: pyrac)
[10:33:44] *** Quits: sk (sk@61A494B3.BA40E8A.AAC02D62.IP) (Input/output error)
[10:34:14] <aatch> one down, 3 to go.
[10:35:36] <dbaupp> aatch: http://buildbot.rust-lang.org/builders/snap3-linux/builds/470/steps/test/logs/stdio ?
[10:35:44] <dbaupp> failures:
[10:35:45] <dbaupp>     run::tests::test_inherit_env
[10:36:55] <aatch> dbaupp, ?? That was fixed...
[10:37:02] <aatch> I think the buildbot is lying
[10:37:48] <dbaupp> aatch: it's not #[ignore]'d... is it supposed to be?
[10:38:07] <aatch> It's /supposed/ to be fixed
[10:38:18] <dbaupp> oh :S
[10:39:15] <doener> yay, void instead of {} in the LLVM IR makes compiling librustc another 9% faster, and gives more opportunities for tail calls :-)
[10:39:44] <aatch> doener, woo!
[10:40:12] <dbaupp> doener: :D
[10:40:24] <doener> building librustc went from 2:30 to 2:01 in the last week
[10:40:36] <doener> well, for me at least
[10:40:40] <dbaupp> including this latest fix?
[10:40:45] <doener> yes
[10:40:57] * dbaupp wants isrustfastyet to be working again
[10:41:22] <doener> the open PR takes it to 2:12, this one (not yet PR ready) to 2:01
[10:41:58] <dbaupp> does it have similar effects on the other crates?
[10:42:13] <doener> didn't measure that yet
[10:45:27] <Blei> doener: this is awesome! please continue doing 10% decreases per patch until we're down to 1s
[10:46:30] *** Joins: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP)
[10:46:30] <ghrust> 01[13rust01] 15Aatch pushed 1 new commit to 06master: 02http://git.io/_e2INg
[10:46:30] <ghrust> 13rust/06master 143acdbfd 15James Miller: ignore inherited environment test under valgrind r=snapshot
[10:46:30] *** Parts: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP) ()
[10:46:47] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[10:46:47] <ghrust> 01[13rust01] 15Aatch merged 06master into 06snap-stage3: 02http://git.io/NlGK6g
[10:46:47] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[10:49:40] <aatch> I will get this snapshot working!
[10:50:02] <doener> dbaupp: yup, same gain for libsyntax
[10:50:04] *** Quits: fran (fran@79AF8722.E2041B94.8ACE28DB.IP) (Quit: Leaving)
[10:50:08] *** Joins: xenocons (otk@moz-C675529E.members.linode.com)
[10:50:13] <dbaupp> doener: awesome!
[10:50:28] *** Quits: vosen (vosen@moz-266BA656.icpnet.pl) (Connection reset by peer)
[10:52:15] *** Joins: maxli (maxli@C03F2759.C70D537E.2FA4EA88.IP)
[10:53:12] <xenocons> does main have a return type of ! by default
[10:53:30] <aatch> xenocons, nope, ()
[10:53:43] <xenocons> hm k
[10:53:49] <dbaupp> xenocons: I think anything other than -> () is an error
[10:54:06] <aatch> doener, so is a () return type now treated as void?
[10:54:19] <doener> yup
[10:54:27] <xenocons> whats the usual way of doing if args.len() != 2 { exit(EXIT_FAILURE) }
[10:54:43] <xenocons> i see this 'fail' function
[10:55:39] <xenocons> or potentially not, google has for some reason indexed dl.rust-lang.org/doc/0.3
[10:55:40] <xenocons> heh
[10:56:52] <xenocons> alright, cheating args.len() != 2 { return (); }
[10:57:01] <xenocons> seems to work for now
[10:57:18] <dbaupp> doener: does `fn foo() {} let x = foo();` still work?
[10:57:29] <dbaupp> xenocons: fail!() works
[10:57:34] <xenocons> ah
[10:57:37] <xenocons> macroized
[10:58:07] <dbaupp> xenocons: everything is a subtype of !, so you can use things that return ! in place of any type
[10:58:18] <dbaupp> e.g. fn foo() -> int { fail!() } is perfectly legal
[10:58:24] *** Quits: maxli (maxli@C03F2759.C70D537E.2FA4EA88.IP) (Ping timeout)
[10:58:27] <xenocons> ah cool
[10:58:58] <xenocons> guessing fail!(fmt!("error in %s,"somefunc")); is the indented use?
[10:58:59] <xenocons> intended*
[10:59:15] <xenocons> kinda like fprintf stderr "error in %s" x
[11:00:01] <dbaupp> rusti: fail!("error: %s", "my string")
[11:00:01] *** Joins: mindginative (mindginati@moz-90AB6445.dyn.cust.vf.net.nz)
[11:00:02] <aatch> xenocons, you don't need fmt there.
[11:00:02] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/jeac
[11:00:19] <xenocons> even better
[11:00:24] <dbaupp> rusti: if true {fail!("error: %s", "my string")} else {1i}
[11:00:24] *** mindginative is now known as rix
[11:00:25] -rusti- rust: task failed at 'error: my string', <anon>:10
[11:00:25] -rusti- rust: domain main @0x20741b0 root task failed
[11:00:25] -rusti- application terminated with error code 101
[11:00:59] <xenocons> slowly learning more rust as im like 'oh yeh i want to take user args' heh
[11:01:26] <xenocons> i like this os::args() function
[11:01:28] <xenocons> think thats neat
[11:01:50] <xenocons> much better than argc argv
[11:01:54] <doener> dbaupp: works, produces slightly better unoptimized code, no difference in the optimzed code
[11:02:16] <doener> (asm code, that is)
[11:02:25] <dbaupp> doener: so it doesn't leave x uninitialised or whatever
[11:02:32] <dbaupp> (not that that makes sense for () ...)
[11:02:42] <xenocons> :) linux, i can do ./rustprogram `which somebinary` hehe
[11:03:08] <dbaupp> xenocons: it's nice... if you should just ignore the fact that os::args is actually broken
[11:03:20] <xenocons> it is? works for me so far
[11:03:27] <dbaupp> yeah, with utf8
[11:03:34] <xenocons> ah
[11:03:37] <xenocons> because of \0?
[11:03:44] <dbaupp> there can be arguments that aren't valid utf8, and that'll crash your program
[11:03:50] <xenocons> oh
[11:03:53] *** Joins: orshem (orshem@3545E24A.588A166C.E3D28531.IP)
[11:04:12] <dbaupp> rustc `echo -e '\xff'`
[11:04:16] <dbaupp> (try that)
[11:04:19] <xenocons> my program is mostly for my own self inflicted pain
[11:04:34] <xenocons> yeah task failed assertion
[11:04:42] <xenocons> but its not like its corrupting memory or anything ;p
[11:04:48] <dbaupp> xenocons: yeah, you'll probably not meet it in practice... but it's incorrect :/
[11:05:08] <xenocons> yeah that makes sense
[11:05:18] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[11:05:24] <dbaupp> (you can do the same with filenames and os::list_dir)
[11:05:39] <dbaupp> (and os::env)
[11:05:41] <cmr> aatch: how goes the snapshot work?
[11:05:48] <dbaupp> cmr: heh
[11:05:50] <aatch> cmr, getting there
[11:05:52] <xenocons> dbaupp: why is it hard to work out if a string is utf8 or not?
[11:05:59] <dbaupp> xenocons: it's not
[11:06:07] <dbaupp> xenocons: it's correctly working out that it *isn't* utf8
[11:06:24] <xenocons> hm
[11:06:28] <dbaupp> the problem is that non-utf8 arguments/environments/filenames are perfectly valid
[11:06:36] <xenocons> right
[11:06:39] <dbaupp> and rust literally *cannot* handle them at the moment
[11:06:45] <dbaupp> (ignoring unsafe code)
[11:08:02] <xenocons> could be fun, utf8 can aparently use 1 to 4 bytes, utf16 uses 2 to 4
[11:08:12] *** Joins: sk (sk@1335CD0E.81A8C295.D066974A.IP)
[11:08:50] <xenocons> so linux is a utf8 system? heh
[11:08:56] <cmr> Usually
[11:09:12] <cmr> You can change the encoding with the locale but it'd probably break things and why would you want to?
[11:09:25] <xenocons> windows i guess is utf16 for a large part
[11:09:35] *** Joins: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com)
[11:09:53] <xenocons> but windows seems to switch between multiple encodings
[11:10:03] <dbaupp> aatch: rust's amazon-s3 is probably filling up with windows and bsd snapshots :P
[11:11:07] <aatch> dbaupp, heh
[11:11:43] * dbaupp wonders if we could use snapshots as a fix to telling people to build master
[11:11:58] <dbaupp> (especially since building on windows is so annoying)
[11:12:18] <kimundi> we just need nightly bualds
[11:12:24] <kimundi> err, builds
[11:13:02] <aatch> bualds
[11:13:07] <aatch> BUALDS
[11:13:11] <xenocons> heh
[11:13:11] <dbaupp> kimundi: we could invent bualds, and have them every night
[11:13:14] *** Joins: fabiand (fabiand@moz-B2D3FDD0.adsl.alicedsl.de)
[11:13:39] *** Quits: n0vember (n0vember@moz-690FFF9D.org) (Ping timeout)
[11:14:25] <kimundi> aatch: Hey, the two keys are like right next to each other on my layout :P
[11:15:16] <aatch> there are now 4 windows snapshots
[11:15:56] <dbaupp> heh
[11:16:21] <dbaupp> there are 4 platforms, so that should be perfect!
[11:17:00] *** Joins: n0vember (n0vember@moz-690FFF9D.org)
[11:17:49] *** Joins: hoelzro (hoelzro@moz-937642A5.ro)
[11:19:18] <hoelzro> how can one do foreign interop with functions taking a char **? I have a ~[~str], and all I can think of is some unholy invocation of str::as_c_str or manual malloc + copying + free, but I'm wondering if there's a better way in the std library
[11:22:53] <aatch> hoelzro, you'll have to make a vector of pointers
[11:23:18] <hoelzro> so I basically have to do the allocation/freeing by hand?
[11:23:20] <hoelzro> if so, that's fine
[11:23:28] <hoelzro> it's a neat exercise for playing with Rust =)
[11:23:28] <aatch> hoelzro, no, you can map.
[11:23:32] <doener> dbaupp: not more uninitialised than before at least
[11:24:17] <dbaupp> hoelzro: you'll have to be very careful about keeping the original ~[~str] vector around for long enough
[11:24:20] <hoelzro> oh, I see
[11:24:28] <hoelzro> well, I'd implement a block function for it
[11:24:32] <doener> dbaupp: foo() had: "%1 = alloca {}; %3 = load {}* %1; ret {} %3" and that return went into x
[11:24:45] <hoelzro> something like do_with_char_aa(strs, block)
[11:24:51] <doener> dbaupp: now x is just "alloca {}" without any sotre
[11:24:58] <doener> s/sotre/store/
[11:25:21] <doener> dbaupp: in the end, that looks equivalently uninitialised to me
[11:25:30] <doener> just with less hops in between
[11:25:32] <dbaupp> hoelzro: but you can probably use `v.map(|s| str::as_c_str(|ptr| ptr))` and then convert the resulting ~[*c_char] to a **c_char
[11:25:50] <hoelzro> interesting
[11:25:56] <dbaupp> doener: oh, I see
[11:26:07] <dbaupp> doener: is {}* LLVM's empty struct?
[11:26:30] <aatch> rusti: let a = ~[~"a", ~"b", ~"c"]; let b = a.map(|s| s.as_c_str(|p| p)); println(fmt!("%?", b))
[11:26:31] -rusti- ~[(0x7f7974200990 as *()), (0x7f79742009d0 as *()), (0x7f7974200a10 as *())]
[11:26:31] -rusti- ()
[11:26:47] <doener> {} is, {}* is a pointer to it (i.e. to the space allocated by the "alloca {}")
[11:26:57] <dbaupp> hoelzro: that is quite dangerous, since as_c_str is not designed to return the *c_char, but there is probably no other way
[11:27:17] <dbaupp> doener: I see
[11:27:22] <hoelzro> right, that's why I avoided it
[11:27:45] <dbaupp> hoelzro: it'll be safer/equally unsafe as any other way, I think
[11:27:53] *** Joins: jensnock_ (jensnocker@moz-8BE55278.customer.t3.se)
[11:28:13] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Ping timeout)
[11:28:26] <cmr> rusti: use std::cast::transmute; use uvr = std::vec::UnboxedVecRepr; let a = ~[~"a", ~"b", ~"c"]; let b = a.map(|s| s.as_c_str(|p| p)); let c: ~uvr = transmute(b); println(fmt!("%?", c.data))
[11:28:27] -rusti- line longer than 150 columns, pastebinned: http://sprunge.us/UDNE
[11:28:36] <doener> dbaupp: since there aren't that many values for the unit type, I guess this doesn't really matter, but I'm not sure if this IR might actually be invalid. But my patch doesn't make it worse AFAICT
[11:28:44] <cmr> rusti: use std::cast::transmute; use uvr = std::vec::UnboxedVecRepr; let a = ~[~"a", ~"b", ~"c"]; let b = a.map(|s| s.as_c_str(|p| p)); unsafe { let c: ~uvr = transmute(b); println(fmt!("%?", c.data)) }
[11:28:45] -rusti- 144
[11:28:45] -rusti- ()
[11:28:58] <hoelzro> does the rust FFI have to link against shared objects? or can I tell rustc to link an arbitrary .o file with my crate?
[11:29:10] <cmr> hoelzro: arbitrary .o
[11:29:25] <dbaupp> doener: presumably () could actually be left entirely uninitialised, since the value (should) never actually have to be examined
[11:29:30] <hoelzro> I'm guessing there's an attribute or something?
[11:29:33] *** Joins: pyrac (pyrac@moz-C4B13AD4.math.u-bordeaux1.fr)
[11:30:02] <dbaupp> hoelzro: `#[link_name="foo"] extern { ... }`, I think
[11:30:10] <hoelzro> neat
[11:30:20] <dbaupp> (I'm not sure of the exact syntax
[11:30:21] <dbaupp> )
[11:32:12] <Blei> hoelzro: actually, #[nolink] extern { .. }, and then link to the .o manually
[11:32:23] <hoelzro> ok
[11:32:30] <Blei> #[link_name=".."] still looks for an .so
[11:32:53] <aatch> Or neither or those and put the name of the .o in the `--link-args`
[11:33:00] *** Joins: cr (anonymous@moz-E5EE6022.dip0.t-ipconnect.de)
[11:33:41] <Blei> ah, right. nolink isn't required on non-mod externs
[11:33:58] <Blei> actually non-mod externs are dead right now, or am i misremembering?
[11:34:08] <Blei> *non-non-mod externs
[11:34:15] <rubber-duck> "struct Foo { box : ~float }"  => "type { { i64, %tydesc*, i8*, i8*, double } addrspace(1)* }" - what's the i64 and i8*, i8* used for ?
[11:34:20] <aatch> Blei, I have no idea what you are talking about.
[11:34:33] <Blei> sorry XD
[11:35:03] <Blei> i mean `extern mod foo { <extern functions> }`
[11:35:12] <dbaupp> rubber-duck: I believe they are part of the runtime header that @ and ~ get
[11:35:31] <dbaupp> rubber-duck: it's a bug that ~ pointers that don't contain @ get the header
[11:35:32] <rubber-duck> dbaupp, but what's stored in it :)
[11:35:41] <dbaupp> rubber-duck: oh, not sure
[11:35:58] <cmr> Yes, that is the ~ box
[11:36:02] <cmr> Nothing is stored in it for ~ afaik
[11:36:21] <cmr> 32 bytes of wasted space
[11:36:24] <rubber-duck> xD
[11:36:49] <rubber-duck> what's it used for in @ boxes ?
[11:36:53] <aatch> Ok, so it's {refcount, typedesc, "previous", "next", value}
[11:36:55] <dbaupp> struct rust_opaque_box {
[11:36:56] <dbaupp>     ref_cnt_t ref_count;
[11:36:56] <dbaupp>     type_desc *td;
[11:36:56] <dbaupp>     rust_opaque_box *prev;
[11:36:56] <dbaupp>     rust_opaque_box *next;
[11:36:56] <dbaupp> };
[11:37:04] <dbaupp> (from the runtime code)
[11:37:16] <rubber-duck> oh thanks
[11:37:31] <aatch> previous and next are old and unused.
[11:37:39] <rubber-duck> should have searched myself -.- still trying to find my way around the code
[11:37:51] <cmr> rubber-duck: nah don't worry about it
[11:38:01] <aatch> rubber-duck, don't worry. I only know because I've spent a ton of time hacking around trans.
[11:38:09] <cmr> aatch: typedesc is vtable? or other metadata?
[11:39:08] <aatch> cmr, tydesc is {int, int, glue, glue, glue, glue, ptr, ptr}
[11:39:08] *** Quits: jyyou (jyyou@moz-47B052FA.cs.nctu.edu.tw) (Connection reset by peer)
[11:39:14] <rubber-duck> I was just looking if the compiler generates any sort of metadata from structs that would let you generate GC type info from LLVM IR types 
[11:39:16] <cmr> delicious
[11:39:24] <dbaupp> aatch: that's infinitely informative
[11:39:28] <aatch> heh
[11:39:39] <Blei> {size, alignment, take_glue, drop_glue, free_glue, visit_glue, shape_stuff, shape_stuff}
[11:39:50] <Blei> not sure what that shape_stuff is all about
[11:39:53] <cmr> so much glue
[11:39:56] <aatch> Dammit, Blei got there first
[11:40:07] <aatch> Blei, I think the shape stuff is legacy
[11:40:22] <Blei> nice, more free bytes
[11:40:23] <cmr> it's a testament to the llvm optimizers that rust code isn't even worse than it already is
[11:40:25] <dbaupp>     const uint8_t *unused;
[11:40:25] <dbaupp>     const uint8_t *unused2;
[11:40:25] <dbaupp> };
[11:40:43] <dbaupp> (from the end of type_desc in rt/rust_type.h)
[11:41:05] <dbaupp> (can't these things be removed?)
[11:41:06] *** Joins: wilfred (uid159@moz-C944F5EC.irccloud.com)
[11:41:13] <cmr> maybe they can be
[11:41:26] <aatch> dbaupp, yep, you just need to find every place that assumes they are there.
[11:41:35] <dbaupp> aatch: ah right
[11:41:36] <doener> dbaupp: I think I saw some places where pointers to () are used
[11:41:36] <dbaupp> :(
[11:41:55] <aatch> same with the box headers
[11:42:04] <dbaupp> doener: isn't that just rust's "equivalent" of `void*`?
[11:42:09] <cmr> strcat almost tracked down why the box headers were used iirc
[11:42:16] <cmr> he came to the conclusion that it's messy down there :p
[11:43:21] *** Joins: BitPuffin (quassel@moz-EDA2C5C0.cust.tele2.se)
[11:43:28] <aatch> I wrote down some thoughts regarding the state of trans, http://aatch.github.io/blog/2013/06/19/paying-technical-debt-in-rustc/
[11:44:02] *** Joins: jyyou (jyyou@moz-47B052FA.cs.nctu.edu.tw)
[11:44:55] <dbaupp> aatch: have you submitted to reddit yet? ;P
[11:45:03] <cmr> " but this more like deliberately punching a hole in your roof so the birds can still get in."
[11:45:05] <cmr> nice :p
[11:46:12] <rubber-duck> aatch, "Poor naming and documentation" - I find ty::t a totally reasonable naming convention :P
[11:46:14] <aatch> cmr, I take pride in my writing. Though I haven't gotten the hang of writing about technical stuff yet.
[11:46:29] <cmr> aatch: DIdn't pcwalton say *40%* is refcount bumping?
[11:46:36] <cmr> I could be confusing that with a different number though
[11:46:44] <aatch> cmr, 40% is glue
[11:46:47] <cmr> ah
[11:49:25] <aatch> I still cringe every time I see the register_fn* chain
[11:49:49] <indutny> whoa
[11:49:55] <indutny> almost finished that mman thingy :P
[11:51:55] <Blei> ok, imma remove the shape stuff
[11:52:05] <cmr> Blei: good luck
[11:52:09] <Blei> (fits in neatly with my latest pull request)
[11:53:18] *** Quits: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP) (Ping timeout)
[11:53:46] *** Joins: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP)
[11:54:22] *** Joins: Earnestly (earnest@6A917A59.5E1FD793.39C00A7A.IP)
[11:57:40] <dbaupp> aatch: we have another bsd snap!
[11:58:01] <aatch> dbaupp, we do. And both other bots are in testing.
[11:58:14] * dbaupp hopes it works this time
[11:58:30] <aatch> you an me both dbaupp 
[11:59:20] <aatch> What I'm hoping is that we can re-open the tree tomorrow.
[11:59:46] *** Joins: cstrahan (cstrahan@D7A0783.55566752.925B99D5.IP)
[11:59:56] <dbaupp> that'd be very nice
[12:00:23] <dbaupp> (especially with the 39 pull requests :S ... so many merge conflicts!)
[12:00:49] <aatch> yeah, one of those is mine...
[12:01:06] <aatch> pretty broad change to trans
[12:01:16] <aatch> so it'll conflict like mad
[12:01:21] <dbaupp> heh :D
[12:01:36] *** kimundi is now known as zz_kimundi
[12:01:38] <dbaupp> (also, the mac snapper is also building a master build)
[12:06:20] *** Quits: true_droid (Adium@moz-123FD9B8.beck.volia.net) (Quit: Leaving.)
[12:11:07] *** Quits: eevee (eevee@moz-A643AA65.evrt.wa.frontiernet.net) (Ping timeout)
[12:12:04] <cmr> aatch: pcwalton seemed perfectly ok with closing the tree to help you get that one through earlier
[12:14:40] <aatch> cmr, he did? It's just a refactoring.
[12:14:57] *** Quits: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com) (Ping timeout)
[12:15:09] <dbaupp> aatch: "just"? it's a pretty big/useful refactoring
[12:15:19] <cmr> aatch: he said it would make his life less painful :p
[12:15:22] *** Joins: eevee (eevee@moz-A643AA65.evrt.wa.frontiernet.net)
[12:15:28] *** Joins: msingle (Thunderbir@moz-726D4BBF.tmodns.net)
[12:15:44] <dbaupp> aatch: the linux snap is possible stalled again D:
[12:18:42] <aatch> dbaupp, I don't think so.
[12:18:52] <dbaupp> oh, good
[12:19:33] <aatch> Argh
[12:19:45] <dbaupp> wait, are you sure? every time I've looked at the stdio for the last 5 minutes it's ended on "test u16::generat"
[12:20:45] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[12:20:51] <dbaupp> aatch: (isn't it `// xfail-test`?)
[12:21:09] <aatch> Probably...
[12:21:23] <aatch> knowing my luck at the moment.
[12:21:27] <dbaupp> 5th time lucky?
[12:24:06] *** Joins: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP)
[12:26:00] *** Quits: msingle (Thunderbir@moz-726D4BBF.tmodns.net) (Connection reset by peer)
[12:28:25] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[12:28:25] <ghrust> 01[13rust01] 15Aatch pushed 1 new commit to 06master: 02http://git.io/csP-qQ
[12:28:25] <ghrust> 13rust/06master 146759ce4 15James Miller: _Actually_ xfail debuginfo tests
[12:28:25] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[12:28:35] *** Joins: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP)
[12:28:35] <ghrust> 01[13rust01] 15Aatch merged 06master into 06snap-stage3: 02http://git.io/__BEuw
[12:28:35] *** Parts: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP) ()
[12:28:36] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[12:28:57] * dbaupp hopes it works *this* time
[12:30:26] <bstrie> come onnnn new snapshot
[12:31:19] *** Joins: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net)
[12:32:58] <aatch> I am determined to have a new snapshot!
[12:33:20] *** Quits: cdidd (cdidd@moz-2AAEE3C7.broadband.corbina.ru) (Input/output error)
[12:34:40] *** Joins: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net)
[12:34:43] <doener> dbaupp: hm, maybe we were talking of different things. I meant that the alloca must be kept, so the address can be taken at all
[12:35:28] <dbaupp> doener: oh, I see... yes, I think we were :)
[12:37:01] *** Quits: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net) (Client exited)
[12:41:14] *** Quits: cstrahan (cstrahan@D7A0783.55566752.925B99D5.IP) (Ping timeout)
[12:43:41] *** zz_kimundi is now known as kimundi
[12:43:46] <Blei> huh, well, that was painless
[12:45:04] <cmr> Blei: are you telling me you just shaved 16 bytes off of every rust type?
[12:45:25] <dbaupp> cmr: isn't it just 16 bytes of every type_desc?
[12:45:37] <cmr> dbaupp: doesn't every type have a type_desc?
[12:46:00] <dbaupp> cmr: well, yeah, but each value of a given type presumably points to the same type_desc
[12:46:14] <cmr> dbaupp: right, so 16 bytes off of every type
[12:46:14] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[12:46:15] <dbaupp> (so the savings aren't that big.)
[12:46:24] <Blei> yes, total success
[12:46:31] <dbaupp> Blei: make check passes?
[12:47:00] <aatch> and it's "only" types that need boxes
[12:47:14] <Blei> dbaupp: yes
[12:47:24] <dbaupp> Blei: awesome
[12:47:30] <cmr> Blei: is the change in a git tree somewhere yet?
[12:47:51] * dbaupp wonders if it'll break on other architectures
[12:47:53] *** Quits: pyrac (pyrac@moz-C4B13AD4.math.u-bordeaux1.fr) (Quit: pyrac)
[12:48:09] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[12:48:40] <Blei> It's now part of my latest PR
[12:48:48] <Blei> github is down, else i'd link it XD
[12:48:50] <cmr> which is...
[12:48:52] <cmr> it is?
[12:48:59] <Blei> it doesn't load here
[12:49:04] <cmr> working fine for me
[12:49:20] <Blei> huh
[12:49:22] <cmr> Blei: the intrinsic overhaul?
[12:49:24] <aatch> status.github.com says it's fine
[12:49:30] <Blei> ah, there it is
[12:49:40] <Blei> https://github.com/Blei/rust/commit/4391a7e8e8ece72a3349a1f78f124da669a80ec5
[12:49:58] *** Joins: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com)
[12:51:06] *** Quits: sankha93 (Instantbir@2B8F41EF.58985164.8B6C1D65.IP) (Quit: Instantbird 1.4 -- http://www.instantbird.com)
[12:52:22] <Blei> ok, on to the box headers
[12:52:29] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[12:53:08] <dbaupp> aatch: almost got a 6th windows snap ;D
[12:53:15] <aatch> My cat is really not a fan of this storm
[12:53:44] <dbaupp> :( (your house is still in NZ though, right?)
[12:54:53] <aatch> Yes, I'm hoping that it stays on the hill though
[12:55:07] <rubber-duck> "out: @@io::Writer"... @_@
[12:55:12] <engla> do you have big storms in NZ?
[12:55:28] <cmr> rubber-duck: it's best not to look too hard at io code
[12:55:33] <cmr> I suggest a heavy squint
[12:55:35] <dbaupp> aatch: lots of rain? (does wellington get flooded?)
[12:55:38] <aatch> The wind was so bad at one point I noticed when the house /stopped/ shaking.
[12:56:10] <dbaupp> rubber-duck: io's getting rewritten (slowly) so that'll eventually actually look normal.
[12:56:12] <rubber-duck> cmr, it's in libsyntax prettyprinter
[12:56:12] <aatch> dbaupp, engla, not often, but we occasionally get the tail-ends of tropical cyclones.
[12:56:47] <aatch> And wellington is all hills and on the coast, so not much flooding at all
[12:57:08] <dbaupp> aatch: yeah that what I thought
[12:57:52] <rubber-duck> dbaupp, you're saying that's required to get io to work :O ?
[12:58:13] <dbaupp> rubber-duck: basically...
[12:58:23] <aatch> I mean, when I say my house is on the side of a hill, I'm not kidding
[12:58:42] <dbaupp> rubber-duck: (I'm not sure the two layers are necessary, but I guess there's is a good reason for that)
[12:58:58] <dbaupp> aatch: is a landslide a real concern? :S
[13:00:07] <aatch> dbaupp, probably not in terms of my house getting a new address, but there's normally a closed road or two each time there's heavy rain.
[13:04:48] <aatch> dbaupp, oh, and I just remembered that some houses /did/ start sliding down the hill after some bad weather recently
[13:06:31] <cmr> dbaupp: can I have a copy of the code you use to generate the memory comparison graphs? I feel bad shoving all the data for you to deal with
[13:07:11] <dbaupp> cmr: there's one here http://www.ug.it.usyd.edu.au/~hwil7821/rust-bench/plots.R
[13:09:11] <dbaupp> cmr: and another http://www.ug.it.usyd.edu.au/~hwil7821/rust-bench/plots-benches.R
[13:09:13] <cmr> Like the graphs on http://www.ug.it.usyd.edu.au/~hwil7821/rust-bench/programs.html I mean
[13:09:20] <cmr> yeah that looks right
[13:09:22] <dbaupp> cmr: (the first is for rustc, the second is for that one)
[13:09:46] <dbaupp> you'll need R and the ggplot2 package
[13:10:13] *** Joins: sw17ch (sw17ch@moz-39D8564F.wndsny.tds.net)
[13:10:33] <dbaupp> aatch: I'm sure that's reassuring... ;P
[13:11:38] *** Quits: bytbox (s@moz-2E27684C.student.umd.edu) (Ping timeout)
[13:11:40] <aatch> dbaupp, we currently have 140km winds outside.
[13:11:52] <dbaupp> o_O
[13:13:26] <dbaupp> "Winds should gradually ease Friday morning and below severe gale by afternoon."
[13:13:27] <rubber-duck> aatch, got a kite handy ?
[13:13:42] <dbaupp> aatch: you'll be inside for a while, I guess
[13:14:02] <aatch> I may take friday off
[13:15:58] *** Joins: bytbox (s@moz-D83E9B31.wireless.umd.edu)
[13:16:54] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[13:19:02] *** Quits: sw17ch (sw17ch@moz-39D8564F.wndsny.tds.net) (Ping timeout)
[13:20:00] *** Joins: sw17ch (sw17ch@moz-DA3743.hfc.comcastbusiness.net)
[13:20:13] *** Joins: trapni (trapni@moz-6A0EA166.dawanda.com)
[13:20:44] *** Quits: wuwei (wuwei@1A513F49.818D7924.FAA9ED67.IP) (Connection reset by peer)
[13:21:34] *** Quits: BitPuffin (quassel@moz-EDA2C5C0.cust.tele2.se) (Ping timeout)
[13:25:14] <cmr> dbaupp: I get:
[13:25:15] <cmr> > for (i in 1:length(data)) draw.plot(data[[i]], data.noje[[i]], T)
[13:25:17] <cmr> Error in d1$crate : $ operator is invalid for atomic vectors
[13:26:25] *** Quits: rix (mindginati@moz-90AB6445.dyn.cust.vf.net.nz) (Quit: zzZZZ)
[13:27:21] <dbaupp> hm
[13:27:23] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[13:27:45] <cmr> I'm using R 3.0.0
[13:27:50] <dbaupp> oh, you need to make the json a proper json
[13:27:59] <dbaupp> i.e. make it a vector of objects
[13:28:02] <cmr> oh, right
[13:28:18] *** Joins: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP)
[13:28:21] <dbaupp> (I just used sed)
[13:29:01] <cmr> mind sharing your incantation?
[13:29:50] *** Joins: sankha93 (Instantbir@F0F19A20.F36055FE.8B6C1D65.IP)
[13:29:55] <dbaupp> um, sed -i 'command' *.json, where command = 's/$/,/' then '1s/^/[/' then '$s/,$/]/'
[13:30:04] <dbaupp> so I ran it 3 times
[13:30:12] <dbaupp> (i'm sure there's a neater way...)
[13:32:55] *** Joins: pyrac (pyrac@moz-C4B13AD4.math.u-bordeaux1.fr)
[13:33:37] <cmr> dbaupp: http://octayn.net/data-benches.tar.xz
[13:33:43] <cmr> Interestnig results
[13:33:48] <cmr> jemalloc isn't a clear win I don't think
[13:35:32] <cmr> the few cases where it exhibits much worse performance are worth investigating
[13:35:49] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[13:37:38] <dbaupp> yeah. (although, jemalloc was much better compared to the windows malloc than compared to the linux malloc)
[13:37:44] <cmr> yeah
[13:37:55] *** Joins: Sodel_the_V (user@moz-853663E1.va.shawcable.net)
[13:39:54] <cmr> no way
[13:39:56] <cmr> this can't be
[13:40:38] <cmr> Blei: your intrinsic overhaul cuts rustc compile time by a third
[13:40:56] <dbaupp> cmr: o_O
[13:40:58] <cmr> I don't think this is right though....
[13:41:06] <Blei> cmr: whu? 
[13:41:18] <Blei> i don't think that's possible, i didn't change that much
[13:41:32] <dbaupp> cmr: can you bisect the changeset?
[13:41:35] <cmr> http://octayn.net/rustc.png
[13:41:47] <cmr> mem-bench.py x86_64-unknown-linux-gnu/stage2/bin/rustc --cfg stage2 -O -Z no-debug-borrows --target=x86_64-unknown-linux-gnu -o x86_64-unknown-linux-gnu/stage2/lib/rustc/x86_64-unknown-linux-gnu/lib/librustc.so /home/cmr/hacking/rust/src/librustc/rustc.rc > /tmp/overhaul.json
[13:41:55] <cmr> git checkout 7375e94
[13:41:58] <cmr> make
[13:42:00] <nmatsakis> who did the jemalloc integration?
[13:42:06] <cmr> mem-bench.py x86_64-unknown-linux-gnu/stage2/bin/rustc --cfg stage2 -O -Z no-debug-borrows --target=x86_64-unknown-linux-gnu -o x86_64-unknown-linux-gnu/stage2/lib/rustc/x86_64-unknown-linux-gnu/lib/librustc.so /home/cmr/hacking/rust/src/librustc/rustc.rc > /tmp/pre-overhaul.json
[13:42:12] <cmr> nmatsakis: mostly strcat]
[13:42:21] <nmatsakis> ok.
[13:42:21] <cmr> I fixed it for windows
[13:42:21] <dbaupp> cmr: are you sure? that looks very similar to http://www.ug.it.usyd.edu.au/~hwil7821/rust-bench/rustc.png
[13:42:25] *** Joins: Azdle (Azdle@moz-B334B496.hfc.comcastbusiness.net)
[13:42:46] <cmr> dbaupp: that's why I don't think it's right
[13:42:49] <dbaupp> cmr: (in fact, ignoring image sizes, it's identical.)
[13:43:41] *** kimundi is now known as zz_kimundi
[13:43:44] <dbaupp> aatch: linux snap got through std \o/
[13:43:45] *** Quits: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net) (Ping timeout)
[13:44:08] *** Joins: Sergio965 (textual@moz-EFF068BB.dyn.mit.edu)
[13:44:52] <aatch> dbaupp, hurrah!
[13:46:28] *** Joins: lmandel (lmandel@F2D29657.F60B0462.67AC9B1.IP)
[13:48:12] <Sodel_the_V> nmatsakis: ping
[13:48:54] <cmr> dbaupp: if I modify the mem-bench.py script to only take a snapshot of the mrmoy usage every 0.01 seconds or something less than as fast as possible  it could probably be enabled on the buildbots
[13:49:14] <dbaupp> cmr: not a problem with me
[13:49:48] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[13:50:00] *** Quits: sankha93 (Instantbir@F0F19A20.F36055FE.8B6C1D65.IP) (Ping timeout)
[13:50:05] <nmatsakis> Sodel_the_V: hey! I was just thinking about your branch yesterday.
[13:50:18] <dbaupp> cmr: (although, it would be most useful measuring each crate in each stage individually, rather than the build as a whole)
[13:50:20] <nmatsakis> Sodel_the_V: thinking I ought to dust it off and see if I could trace down that LLVM problem...
[13:50:40] *** Quits: snearch (snearch@moz-89D19BC2.pool.mediaways.net) (Quit: Verlassend)
[13:50:49] <cmr> dbaupp: sure, that should be easy.
[13:51:14] <dbaupp> cmr: good! that'd actually be amazing ;D
[13:51:26] <Sodel_the_V> nmatsakis: Hey, sorry it took me so long to check in with you again. Would it be helpful if I rebased to the current master, to stave off the bit-rot?
[13:52:48] <nmatsakis> Sodel_the_V: always a good start
[13:53:11] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[13:54:00] <Sodel_the_V> nmatsakis: I'll let you know when I succeed, or if I get stuck, then :P
[13:54:11] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[13:54:18] <nmatsakis> Sodel_the_V: ok, i'm hoping to spend some time on rust today (which I haven't done for a while), so it'd be a good day for me to take a look
[13:54:20] *** Quits: trapni (trapni@moz-6A0EA166.dawanda.com) (Quit: Leaving)
[13:54:49] <Sodel_the_V> nmatsakis: Ah, good! Yeah, other distractions pile up.
[13:55:06] <aatch> nmatsakis, good timing with the new snapshot imminent
[13:55:32] *** Joins: johnmurray (jmurray@moz-299FF8FF.fw.nyc2.appnexus.com)
[13:56:47] *** Joins: jezi22 (Mibbit@342CB9.9E63A991.74DEF76E.IP)
[13:57:18] <jezi22> what projects have you done using rust?
[13:58:14] <doener> is there an ETA for bors reactivation?
[13:58:28] <cmr> doener: brson was hoping to reopen the tree today iirc
[13:58:33] <aatch> doener, new snapshot I think
[13:58:36] *** Quits: johnmurray (jmurray@moz-299FF8FF.fw.nyc2.appnexus.com) (Quit: johnmurray)
[13:58:43] <aatch> So hopefully soon
[13:59:25] <cmr> linux snap is in stdtest :D
[13:59:40] <dbaupp> (x64 stdtest)
[13:59:43] <cmr> mac snap is just about done
[13:59:53] <cmr> oh right cross compiles...
[14:00:01] *** Joins: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net)
[14:00:09] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[14:00:17] <dbaupp> cmr: it runs i686 and x64 tests... so it's possible only 1/2 way through :(
[14:00:20] <jezi22> brson?
[14:00:22] *** Joins: mib_jvbz0l (Mibbit@BBE7C46A.B4F11D08.8612FA94.IP)
[14:00:23] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[14:00:27] <jezi22> snap?
[14:00:39] <cmr> jezi22: brson is a core dev
[14:00:41] <cmr> snap == snapshot
[14:00:59] <jezi22> snapshot of what?
[14:01:11] <cmr> the rust compiler, used for bootstrapping
[14:01:18] <cmr> http://en.wikipedia.org/wiki/Bootstrapping_%28compilers%29
[14:01:26] <jezi22> ohh.. i got interested in rust because i want to learn a much lower programming like C
[14:01:34] <jezi22> well im not a pro programmer.
[14:02:40] <cmr> jezi22: rust can certainly help with that. what languages are you familiar with?
[14:02:45] *** Quits: mleise (marco@moz-3468AB5B.pools.arcor-ip.net) (Quit: Leaving.)
[14:04:14] <jezi22> mostly dynamic languages like python, ruby, javascript. a little java, c and c++
[14:04:30] <cmr> http://www.rustforrubyists.com/book/index.html is a good start :)
[14:04:55] <jezi22> cmr: are you a contributor for rust?
[14:04:59] <cmr> jezi22: yes
[14:05:43] <jezi22> cool. what language do you use?
[14:06:37] <cmr> I get paid to sling python and occasional C. I know lua and javascript well, as well as some c++. a bit of java, a handful of c#
[14:06:45] <jezi22> so rust is written in rust. O_O
[14:06:50] <cmr> Rust is written in rust, yes.
[14:07:01] <jezi22> well how do they do that? im pretty confused. lol
[14:07:04] *** Joins: nano (nano@moz-972880B.superkabel.de)
[14:07:15] <cmr> jezi22: the first rust compiler was written in a different language, ocaml
[14:07:25] <aatch> jezi22, by using a pre-compiled snapshot
[14:07:33] <cmr> eventually the language was mature enough that they could write a rust compiler in rust, and compiled it with the ocaml compiler
[14:07:46] <cmr> from there it's an incremental process of building a new compiler with the previous snapshots
[14:07:53] <nmatsakis> I think that execution took something like 1.5 hours? 
[14:07:59] *** Joins: tgt_ (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[14:08:06] <nmatsakis> apparently the old o'caml compiler made our current one look very fast indeed
[14:08:14] <nmatsakis> I wans't around then though
[14:08:19] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Connection reset by peer)
[14:08:28] <jezi22> what do you mean by pre compiled snapshots?
[14:08:52] <nmatsakis> Sodel_the_V: btw, warning, there have been various changes in trans that may conflict with what you did...
[14:08:55] *** Quits: z0w0 (zack@FDF4EF6A.2CA5CD8.5F93A189.IP) (Client exited)
[14:09:00] <nmatsakis> Sodel_the_V: but I guess you'll find out :)
[14:09:01] <samebchase> compiled versions of the compiler in various stages of development
[14:09:21] <nmatsakis> jezi22: we run the compiler we have on the new sources, yielding a new compiler.
[14:09:23] <aatch> I'm currently working on creating a snapshot of the current state of development.
[14:09:23] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[14:09:39] <nmatsakis> jezi22: basically the same as how gcc is written in C
[14:09:59] <nmatsakis> jezi22: javac in Java
[14:10:02] <nmatsakis> jezi22: and so on
[14:10:05] <aatch> This mostly consists of me playing games while waiting for the bots to either work, or fail
[14:10:18] <jezi22> so you make a compiler from another language then make a compiler through that compiler?
[14:10:25] <dbaupp> aatch: we appear to have got through linux's x64 stdtest...
[14:10:45] <cmr> jezi22: yup. it's called bootstrapping or self-hosting
[14:10:46] <aatch> dbaupp, brilliant!
[14:10:56] <nmatsakis> jezi22: yes, in the beginning you must use another language until your compiler works well enough that you can rewrite it from scratch
[14:11:17] <nmatsakis> jezi22: it is a bit mind-bending
[14:11:23] <cmr> a lot mindbending
[14:11:24] <aatch> it's not the easiest process in the world, but well worth it.
[14:11:51] <aatch> compilers are a very good test of a language. Especially a systems language
[14:11:53] <jezi22> but at least i now understand the concept. awesome.
[14:12:04] <nmatsakis> if you think that's mind-bending, check out something like Jikes RVM or Maxime...
[14:12:07] <Sodel_the_V> nmatsakis: Yes, I'm running into a few of those changes. The seems to be blessedly few. :)
[14:12:21] <aatch> Sodel_the_V, sorry :D
[14:12:36] <dbaupp> I recall a story of someone writing a compiler in its target language, and the compiling it by hand to machine code to get the first real compiler. (I'm possibly not remembering correctly though.)
[14:12:53] * Sodel_the_V forgives aatch
[14:12:59] <cmr> dbaupp: is a story like that http://homepage.ntlworld.com/edmund.grimley-evans/bcompiler.html
[14:13:08] <cmr> dbaupp: also how the first assemblers and so on were written
[14:13:44] *** Joins: true_droid (Adium@moz-123FD9B8.beck.volia.net)
[14:13:47] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[14:14:45] <nmatsakis> I always thought this would be a good computer science course
[14:14:54] <nmatsakis> though now I think it might be going about things a bit backwards
[14:15:29] <nmatsakis> still I would have liked it as an undergrad; ideally start by designing your own CPU in a FPGA, write the assembler, then port GCC or something 
[14:15:44] <nmatsakis> might take a year or two out of the curriculum though :)
[14:16:24] <Sergio965> Why FPGA?
[14:16:51] <jezi22> cmr: that's a cool link
[14:17:20] <nmatsakis> Sergio965: well, you gotta save time somewhere. I actually assembled a CPU out of PALs and so on at one point, it ... is tedious.
[14:17:50] <nmatsakis> and then somebody trips over your breadboard and pulls out the wires. back to square one.
[14:18:03] <nmatsakis> or whatever those boards are called :)
[14:18:18] * nmatsakis whiles away the hours waiting for these tests to run
[14:18:32] <Sergio965> Well, you could do it all as software. That's what we did in my architecture course. We started by creating simple gates out of MOSFETs and eventually wrote a CPU and an OS for it.
[14:19:05] <nmatsakis> Ah, that's true. I just wanted to have actual hardware for some reason.
[14:19:32] <cmr> My current pet sideproject is a simple 16-bit CPU with virtual memory
[14:19:54] <Sergio965> Yeah, I can see that. The course I took used to do that. They'd hand out breadboards and a bunch of transistors to students and let them be on their way.
[14:19:55] <Sodel_the_V> nmatsakis: I'm the same way. This has lead to some poor fiscal decisions. (I bought a PDP-11 once. :P )
[14:20:15] <nmatsakis> Sodel_the_V: neat
[14:20:16] <Sergio965> cmr: Like, with an MMU?
[14:20:29] <aatch> Ok, we have 3 of 4 snaps done
[14:20:38] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[14:21:46] <cmr> Sergio965: my convoluted arhitecture would take a bit long to explain but basically what I have now is a table that calls into the OS for every virtual load/store... not great, but I'm just dicking around. I've yet to start uni.
[14:21:51] *** Joins: berak (chatzilla@BBC4925A.3A27401E.16E13E53.IP)
[14:22:23] <Sergio965> Ah I see, interesting. You're a high school student?
[14:22:33] <cmr> Graduated from high school last week :)
[14:22:51] *** Quits: tgt_ (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Ping timeout)
[14:23:05] <Sergio965> That's awesome! Congrats. It's fantastic you're thinking about this stuff. I just graduated (from university) two weeks back. :)
[14:23:06] <cmr> aatch: mac snap passed
[14:23:11] <jezi22> cmr: i want to do things like you are doing.. where is a good place to start?
[14:23:19] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[14:23:28] <Sergio965> jezi22: Check out http://www.nand2tetris.org/
[14:23:30] <cmr> jezi22: http://www.nand2tetris.org/
[14:23:34] <Sergio965> I win.
[14:23:37] <cmr> The book "Code" by Charles Petzold is also a good one
[14:23:39] <dbaupp> lol
[14:23:42] <SimonSapin> what‚Äôs the way to use stuff from "sibling" or "parent" modules?
[14:23:44] <cmr> As is... let me find it
[14:23:46] *** Joins: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com)
[14:23:57] <dbaupp> SimonSapin: parent = super::
[14:24:08] <cmr> "Computer Architecture (second edition)", by Caxton C. Foster
[14:24:10] <aatch> Sergio965, congrats, here is your prize
[14:24:17] * Sergio965 celebrates.
[14:24:19] <dbaupp> SimonSapin: sibling = super::sibling::...
[14:24:39] <cmr> jezi22: I'd recommend reading Code first.
[14:25:04] * aatch hands Sergio965 a commemorative plate with the words "Best Scones 1996" on them
[14:25:06] *** Parts: berak (chatzilla@BBC4925A.3A27401E.16E13E53.IP) ()
[14:25:10] <Sergio965> Quick question: I believe I'd heard that Rust was planning/planned to do away with some of the pointer types. Is this still the case?
[14:25:40] <dbaupp> Sergio965: move them to be implemented in the standard library
[14:25:40] <cmr> jezi22: but.. it takes lots of time and lots of reading and lots of experimenting. I've been constantly learning for a few years now :)
[14:26:04] <dbaupp> Sergio965: I don't think that plan has been discarded
[14:26:07] <Sergio965> dbaupp: How so? Is there a place I can read about the changes?
[14:26:08] *** Joins: lkuper_ (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[14:26:17] <Sergio965> (or planned changes)
[14:26:20] <SimonSapin> dbaupp: Thanks. Is that documented?
[14:26:28] <jezi22> cmr: i have all time. im not rushing. ahaha. i just enjoy things 
[14:26:36] <dbaupp> SimonSapin: don't know, sorry
[14:26:37] <jezi22> at least im not being fossilized
[14:26:45] <aatch> I've been programming for almost 8 years now. Learning constantly.
[14:26:52] <Sergio965> jezi22: I believe there's also a course on Coursera.
[14:26:56] <dbaupp> Sergio965: http://pcwalton.github.io/blog/2013/06/02/removing-garbage-collection-from-the-rust-language/
[14:27:07] <dbaupp> Sergio965: discussion http://www.reddit.com/r/rust/comments/1fkhe6/removing_garbage_collection_from_the_rust_language/
[14:27:51] <jezi22> aatch: when did you start being really good at it?
[14:28:24] <aatch> jezi22, hasn't happened yet
[14:28:28] <Sergio965> aatch: Same. 9 years, 4 professionally.
[14:28:40] <aatch> it keeps moving away
[14:28:47] <Sergio965> dbaupp: Fantastic. Thanks for the links.
[14:29:08] <cmr> jezi22: it's "the more you learn the less you know" type thing
[14:29:15] *** Joins: dylukes (dylukes@moz-B5418F79.hsd1.pa.comcast.net)
[14:29:20] *** Joins: Guest (textual@BBE7C46A.B4F11D08.8612FA94.IP)
[14:29:40] <aatch> it's the whole unknown unknowns vs known unknowns
[14:30:26] <aatch> as you learn, you end up converting those unknown unknowns to known unknowns faster than you convert the known unknowns to knowledge
[14:30:35] <Sergio965> Rust uses two heaps? :|
[14:30:47] <Sergio965> I read the entire manual and never realized that.
[14:30:50] <cmr> Sergio965: no, not really.
[14:30:51] *** Joins: BitPuffin (quassel@moz-EE58E41F.cust.tele2.se)
[14:31:10] <Sergio965> From http://pcwalton.github.io/blog/2013/06/02/removing-garbage-collection-from-the-rust-language/, "There are two heaps, not just one, so beginners are confused as to which one to allocate into."
[14:31:26] <cmr> and it all comes from the same malloc so it's one literal heap
[14:31:36] <aatch> 2 _logical_ heaps
[14:31:42] *** Quits: jensnock_ (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[14:31:54] <Sergio965> Of course, logical, but still. Segmented stacks I can get behind, but two heaps?
[14:31:59] <Sergio965> :)
[14:32:33] <cmr> Sergio965: there's a task-local heap for everything that isn't Owned (or Send, I think. can never remember), and an "exchange heap" for things that are owned and can be sent across task boundaries
[14:32:49] <cmr> I think
[14:32:56] <cmr> It's confusing and not really well-defined
[14:32:58] <Sergio965> Ah, yeah. I do recall reading something akin to that.
[14:33:36] *** Quits: ysuzuki (ysuzuki@moz-A563888C.ics.keio.ac.jp) (Client exited)
[14:33:46] <Sodel_the_V> nmatsakis: Well, looks like I get the same LLVM error, so I guess I didn't screw up the rebase (too badly)
[14:33:54] *** Quits: Sergio965 (textual@moz-EFF068BB.dyn.mit.edu) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[14:34:12] *** Quits: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP) (Client exited)
[14:34:18] <Sodel_the_V> nmatsakis: Pushed to my github
[14:35:00] <dbaupp> aatch: I have a horrible feeling that linux snap has stalled again
[14:35:05] * dbaupp is impatient
[14:35:26] *** Joins: MaikKlein (maik@moz-36D8270A.dip0.t-ipconnect.de)
[14:35:30] <cmr> dbaupp: I thought I just saw it move
[14:35:50] <dbaupp> cmr: I hope so!
[14:37:01] <dbaupp> cmr, aatch: false alarm, I saw it move too :)
[14:37:01] <cmr> yeah it did
[14:37:10] <nmatsakis> Sodel_the_V: ok, great!
[14:37:14] <aatch> dbaupp, heh
[14:37:18] * dbaupp is too impatient
[14:37:19] <nmatsakis> Sodel_the_V: remind me what your github/branch-name is
[14:37:58] <Sodel_the_V> nmatsakis: Sodel-the-Vociferous/dralston-5762-dev
[14:37:59] <cmr> dbaupp: it is almost done, too. it already did i686
[14:38:12] * dbaupp is excited
[14:38:38] * aatch is glad he already did the work for the post-snapshot stuff
[14:39:40] *** Quits: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com) (Connection reset by peer)
[14:39:50] <dbaupp> aatch: you've got a decent excuse for skipping work tomorrow too
[14:40:06] <dbaupp> program finished with exit code 0
[14:40:07] <dbaupp> elapsedTime=4595.444076
[14:40:08] <dbaupp> \o/
[14:40:19] <aatch> LINUX TESTED!!!!!11
[14:40:28] <aatch> GRAGRWAGWGJPWHJAW!!!!!
[14:40:36] <cmr> that elapsed time can't be right?
[14:40:42] <cmr> oh wait
[14:40:47] <cmr> 76 minutes, not 76 hours :p
[14:41:00] <aatch> cmr, no, I've been sitting here for 3 days
[14:41:12] <dbaupp> aatch: it's only taken 10 hours of nursing the buildbot... but you did it!
[14:41:17] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[14:41:31] *** Joins: Guest_ (textual@moz-BB21156B.dynamic.csail.mit.edu)
[14:42:18] <dbaupp> "Build successful"
[14:43:20] *** Joins: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com)
[14:46:17] *** Joins: cdidd (cdidd@moz-B9F3D175.broadband.corbina.ru)
[14:46:34] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Ping timeout)
[14:46:47] <nmatsakis> woohoo.
[14:46:53] <SimonSapin> I‚Äôm porting code to rust 0.6+something (the version used in Servo), and for basically every for loop I get error: expected `for` closure to return `bool`, but found `()`. What am I missing?
[14:46:55] <aatch> Ok, snapshots file updated, now to make sure it builds and stuff
[14:47:14] <cmr> SimonSapin: http://smallcultfollowing.com/babysteps/blog/2013/01/16/revised-for-loop-protocol/
[14:47:33] <SimonSapin> thanks cmr
[14:48:22] *** cscottnet is now known as cscott
[14:49:11] <aatch> It's downloading!
[14:49:20] *** Quits: Sodel_the_V (user@moz-853663E1.va.shawcable.net) (Quit: Restarting emacs...)
[14:49:43] *** Joins: Sodel_the_V (user@moz-853663E1.va.shawcable.net)
[14:50:25] <SimonSapin> cmr: did that land between 0.6 and the version used in Servo?
[14:50:54] <dbaupp> SimonSapin: what hash does servo use?
[14:50:54] <cmr> SimonSapin: which commit is servo using?
[14:51:05] <cmr> if it's anything in the past few months, yes.
[14:51:17] <SimonSapin> 1b883365bc0813f5775c8207e414b7973e947a76, May 13
[14:51:25] <cmr> I think it did
[14:51:40] <nmatsakis> Sodel_the_V: building now
[14:51:40] <SimonSapin> Ok, I should probably not use the online docs
[14:51:48] <aatch> Heh, that's earlier than the previous snapshot
[14:52:21] <cmr> SimonSapin: yes, it does have the new for protocol
[14:52:24] *** Quits: MaikKlein (maik@moz-36D8270A.dip0.t-ipconnect.de) (Ping timeout)
[14:52:41] <Sodel_the_V> nmatsakis: Alrighty!
[14:54:41] <indutny> prepare for a big patch guys :)
[14:54:50] <indutny> I just finished picking headers from various platforms
[14:55:00] <indutny> for that mmap/sysconf thing
[14:55:11] <cmr> what mmap/sysconf thing?
[14:55:20] <indutny> constants for libc.rs
[14:55:20] <aatch> indutny, define "big"
[14:55:25] <cmr> oh
[14:55:31] <indutny> and bindings
[14:55:53] <indutny> aatch: 1 file changed, 482 insertions(+), 2 deletions(-)
[14:56:31] <indutny> a lot of constants, obviously
[14:56:35] <indutny> for 3 platforms
[14:57:36] *** Quits: BitPuffin (quassel@moz-EE58E41F.cust.tele2.se) (Ping timeout)
[14:58:11] *** Quits: Guest_ (textual@moz-BB21156B.dynamic.csail.mit.edu) (Ping timeout)
[14:58:30] *** Joins: ksev (DrunkenPan@745B767B.989A61DC.CA5B6332.IP)
[14:58:39] <aatch> in about 15 minutes, master should be completely green
[14:58:52] *** Joins: ysuzuki (ysuzuki@moz-A563888C.ics.keio.ac.jp)
[14:59:33] *** Joins: BitPuffin (quassel@moz-EE58E41F.cust.tele2.se)
[14:59:34] <dbaupp> everything'll be green!
[14:59:39] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[14:59:51] <indutny> btw
[14:59:54] <aatch> green is my new favorite color
[14:59:56] <indutny> any chance to get this stuff in master?
[15:00:06] <indutny> its quite feature neutral
[15:00:13] <aatch> indutny, you'll have to submit a PR
[15:00:21] <indutny> well, that was obvious
[15:00:23] <indutny> but thanks
[15:00:30] <cmr> and once the tests pass, it will be in master :0
[15:00:30] <dbaupp> (and then it goes straight into master, if it passes the tests)
[15:00:31] <aatch> it'll get in master then
[15:00:32] <cmr> * :)
[15:00:56] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[15:01:14] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[15:02:02] <aatch> Here goes nothing
[15:02:04] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[15:02:04] <ghrust> 01[13rust01] 15Aatch pushed 6 new commits to 06auto: 02http://git.io/1aG7RQ
[15:02:04] <ghrust> 13rust/06auto 143bc4d1a 15James Miller: Remove all #[cfg(stage0)]-protected code...
[15:02:04] <ghrust> 13rust/06auto 140702e53 15James Miller: libstd: cleanup warnings
[15:02:04] <ghrust> 13rust/06auto 14b6ecf60 15James Miller: libsyntax: cleanup warnings
[15:02:06] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[15:02:23] *** Joins: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP)
[15:02:47] <dbaupp> would someone like to close https://github.com/mozilla/rust/issues/7256?
[15:03:01] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[15:03:49] <bstrie> dbaupp: I'm presuming that macports isn't updated nightly?
[15:03:59] <dbaupp> bstrie: ?
[15:04:04] <bstrie> dbaupp: re that bug
[15:04:11] <bstrie> I just want to make sure it's not something mac-specific
[15:04:37] <dbaupp> bstrie: oh yeah... no idea
[15:04:50] <dbaupp> (I'm on linux x86-64)
[15:04:55] <bstrie> I also get a weird feeling when I close bugs without adding test cases to the test suite
[15:05:03] <cmr> So add a test case :)
[15:05:09] <bstrie> the tree is closed!
[15:05:13] <cmr> open a PR!
[15:05:32] <aatch> The tree should be open soon!
[15:05:50] <bstrie> cmr: I'm at work, I can't work on the compiler until I get home :P all I can do is dick around on irc!
[15:06:28] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[15:06:36] <indutny> aatch: https://github.com/mozilla/rust/pull/7257
[15:06:39] <indutny> dbaupp: ^
[15:07:00] <indutny> not sure how you're going to check it
[15:07:20] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[15:07:28] <indutny> oops wait
[15:07:31] <indutny> its incomplete
[15:07:36] <indutny> forgot madvise and mincore for mac
[15:07:46] <aatch> indutny, mind expanding on your request description while you're at it?
[15:08:09] <indutny> ah no
[15:08:11] <indutny> its there
[15:08:14] <indutny> patch is ok
[15:08:20] <indutny> aatch: I'm creating JIT compiler :)
[15:08:21] <indutny> that's it
[15:08:36] <indutny> and I need to be able to allocate executable memory on POSIX systems
[15:08:43] <indutny> and non-executable
[15:09:01] <indutny> and need _SC_PAGESIZE to figure out how much memory I should allocate
[15:09:06] <dbaupp> bstrie: adding a test now
[15:09:07] <aatch> indutny, that's fine, but just a single line description isn't very good for a historical record
[15:09:34] <indutny> well, it just puts what should be in this file :)
[15:09:44] <indutny> should I describe my personal feelings about it too?
[15:10:12] <indutny> I agree to amend messages, but please tell me what do you want to be there
[15:10:29] *** Quits: paulproteus (quassel@rose.makesad.us) (Ping timeout)
[15:11:06] *** Joins: paulproteus (quassel@moz-E86A3B42.makesad.us)
[15:11:47] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[15:11:51] <dbaupp> bstrie: https://github.com/mozilla/rust/pull/7258 r?
[15:12:14] <aatch> indutny, more like a quick explanation of where you got the values and names. Brief reason why it should be added in general ("Because it's part of POSIX" is perfectly valid). Anything you may have left you out
[15:12:20] <aatch> only needs to be a few sentences
[15:12:26] <indutny> ok
[15:12:27] <bstrie> dbaupp: do r+s even work right now? I thought bors was turned off...
[15:12:42] <cmr> bstrie: bors goes through them all when he wakes up
[15:12:45] <dbaupp> bstrie: I think it'll pick them up when it comes back on
[15:13:09] <bstrie> dbaupp: r+ then, thanks
[15:13:56] <bstrie> at some point I think it might be useful (if tedious) to go through the list of closed bugs and make sure they all have test cases
[15:14:05] <aatch> come on master-linux
[15:14:18] <aatch> you're almost there
[15:14:32] <dbaupp> aatch: why do you need to wait?
[15:15:06] *** Quits: Nisstyre (wes@moz-FD86289.netflash.net) (Quit: Leaving)
[15:15:17] <indutny> dbaupp: force pushed https://github.com/mozilla/rust/pull/7257 r?
[15:15:18] <aatch> dbaupp, I have a feeling that it won't start auto until it's done.
[15:15:31] <dbaupp> indutny: (I'm not a reviewer :) )
[15:15:53] <indutny> oh :)
[15:15:57] <indutny> aatch: you're 
[15:15:57] <indutny> :)
[15:15:59] <indutny> right?
[15:16:15] <indutny> aatch: https://github.com/mozilla/rust/pull/7257 r?
[15:16:20] <cmr> The various buildbot configurations all run on the same box... will this heavily skew the timings for isrustfastyet? Do the different configs run in parallel?
[15:17:13] <aatch> cmr, not all on the same box, but yes, they do run in parallel, and often on the same bot
[15:17:16] <dbaupp> cmr: yes and probably
[15:17:31] <cmr> aatch: well, each os is one box I think?
[15:17:51] <dbaupp> cmr: (buildbot was deciding to put all 7 mac builds on one of the two mac builders before. :( )
[15:17:55] <aatch> cmr, nah, theres a few
[15:18:13] <dbaupp> cmr: http://buildbot.rust-lang.org/buildslaves
[15:18:14] <cmr> well, that's good at least
[15:18:15] <aatch> Oh yeah, there is builtbot's crappy scheduling...
[15:21:12] <cmr> On the plus side, issue churn is -7 right now
[15:22:24] <dbaupp> cmr: the PR churn must be +large
[15:22:32] <cmr> +29
[15:22:38] <dbaupp> heh
[15:23:34] *** Quits: dylukes (dylukes@moz-B5418F79.hsd1.pa.comcast.net) (Quit: ["Textual IRC Client: www.textualapp.com"])
[15:24:27] *** Joins: infynyxx_ (infynyxx@moz-E95B370B.nyc.res.rr.com)
[15:24:32] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Ping timeout)
[15:24:34] <sw17ch> FWIW, i've been impressed with the project management on Rust. Seems like it's well run.
[15:24:53] <sw17ch> and by Project Management, i mean it seems like there's a good orderly way to get things done
[15:24:59] <sw17ch> and it's well thought out
[15:25:25] <cmr> dbaupp: code churn is +48186 :(
[15:25:37] <dbaupp> cmr: lines?
[15:25:38] *** Joins: ramige (ramige@moz-28AD658E.dynamic.ip.windstream.net)
[15:25:44] <cmr> yeah
[15:25:51] <dbaupp> that seems ridiculously large
[15:26:01] <cmr> it does
[15:26:07] <dbaupp> sw17ch: bors seems to have a lot to do with it
[15:26:11] <cmr> hm, maybe the incoming merge?
[15:26:13] *** Quits: infynyxx_ (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[15:26:24] <dbaupp> cmr: yeah, probably
[15:26:27] *** Parts: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net) ()
[15:27:07] <cmr> https://github.com/mozilla/rust/pull/7202 oh, I didn't realize that had landed
[15:27:11] *** Joins: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net)
[15:27:17] * cmr enjoys writing twir
[15:27:48] *** Quits: BitPuffin (quassel@moz-EE58E41F.cust.tele2.se) (Ping timeout)
[15:28:02] <dbaupp> cmr: you can celebrate the tree being really green
[15:28:42] <cmr> and a snapshot, after over a month!
[15:28:56] <bstrie> is it done????
[15:29:10] <aatch> bstrie, just waiting for auto to spin up
[15:29:10] <dbaupp> bstrie: yup!
[15:29:27] <bstrie> so it's not in master yet?
[15:29:28] <cmr> aatch: I think linux master is stalled, it hasn't moved for quite some time
[15:29:39] <dbaupp> bstrie: yeah, it's not in master
[15:30:05] <dbaupp> (you can build auto to get it, if you're really keen)
[15:30:05] <aatch> bstrie, not yet.
[15:30:28] <bstrie> sw17ch: we spent a long time doing things messily, so we know what not to do when it comes to project management :)
[15:30:39] <bstrie> sw17ch: coincidentally, this is also our approach to language design
[15:30:58] *** Joins: eholk (eholk@moz-E48ECCE9.uconnect.utah.edu)
[15:30:59] <dbaupp> bstrie: a random walk in the project management/language design space?
[15:31:10] <sw17ch> bstrie: while reading the tutorial, i kept thinking "wow, i could have guessed this was implemented this way based on how previous features were written. the forethought that went into Rust is pretty obvious"
[15:31:24] <bstrie> do something -> realize it is wrong -> replace thing with new solution -> GOTO 1
[15:31:59] <bstrie> sw17ch: can you give an example?
[15:32:00] <sw17ch> bstrie: (i was also overcome with a realization that other people know my pain when it comes to systems programming and that was a relief)
[15:32:06] <sw17ch> sure, let me dig one up
[15:33:34] <sw17ch> bstrie, when i read this --> http://static.rust-lang.org/doc/0.6/tutorial.html#boxes
[15:33:47] <sw17ch> it outlines "here's how we do indirection"
[15:33:55] <sw17ch> "oh, and there are several flavors of indirection"
[15:34:00] <cmr> Blei: http://octayn.net/rustc.png
[15:34:02] <sw17ch> and having suffered some of these problems
[15:34:03] <cmr> dbaupp: ^
[15:34:11] <sw17ch> when i got to the headings ...
[15:34:13] <cmr> Blei: Much better :)
[15:34:19] <Blei> cmr: that makes much more sense
[15:34:31] <dbaupp> cmr: it's slightly faster!
[15:34:34] <Blei> but i'm still a little disappointed XD
[15:34:39] <cmr> It also cut off a few MB of memory
[15:34:55] <cmr> ...in some places :p
[15:35:00] *** Quits: ramige (ramige@moz-28AD658E.dynamic.ip.windstream.net) (Quit: Leaving)
[15:35:01] <sw17ch> "Move semantics", "Borrowed pointers", and "Closures", i was pretty easily able to guess how they would work
[15:35:06] <dbaupp> cmr: https://github.com/mozilla/rust/pull/7237
[15:35:15] <sw17ch> just knowing that they existed (because without having semantics around indirection, you can't have those things)
[15:35:30] <bstrie> sw17ch: I'm glad to hear it, what languages are you familiar with?
[15:35:42] <cmr> dbaupp: want me to bench that one?
[15:35:52] <dbaupp> cmr: it'd be interesting :)
[15:36:19] <sw17ch> bstrie, Haskell, C, Ruby, Python, C#, JavaScript, etc
[15:36:40] <sw17ch> and having attempted to implement some Rust-like features my self in toy languages
[15:37:31] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[15:37:36] <cmr> sw17ch: yes. the reason I was initially strongly attracted to rust is that I'd done thought experiments about how to make a lowlevel safe language, and rust neatly matched it
[15:37:46] <sw17ch> i'm familiar with how hard nailing some of those bits are. particularly closures and passing around references in a safe way that doesn't introduce unpredictable runtime problems.
[15:37:50] *** Quits: Guest (textual@BBE7C46A.B4F11D08.8612FA94.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[15:38:10] *** Quits: Blei (philipp@moz-96D25F7A.cust.bluewin.ch) (Quit: WeeChat 0.4.1)
[15:38:27] <sw17ch> I'm not sure how true this is, but it seems that with Rust you can get a pretty good idea of what your GC passes will look like. At least, a much better perspective than you'd get in single-heap languages.
[15:38:44] <cmr> sw17ch: also GC optional!
[15:38:47] <sw17ch> YES
[15:39:20] <sw17ch> Unless I understand this incorrectly, it seems that there's not really a GC penalty for Owned pointers (except that you have to free them all)
[15:39:38] <dbaupp> aatch: master is taking a bloody long time :/
[15:39:40] <sw17ch> There's no ambiguity about *when* they should be freed, so it's not particularly GC intensive (if one can even really call it GC)
[15:39:43] <cmr> sw17ch: they aren't even GC'd
[15:39:47] *** Quits: pyrac (pyrac@moz-C4B13AD4.math.u-bordeaux1.fr) (Quit: pyrac)
[15:39:47] <aatch> dbaupp, it may have stalled
[15:39:49] <sw17ch> good, that was my guess
[15:39:49] <cmr> the GC doesn't see them
[15:40:02] <cmr> sw17ch: it's just a malloc/free pair
[15:40:09] <sw17ch> marvelous
[15:40:16] <sw17ch> automatic bracketing
[15:40:36] <dbaupp> sw17ch: in theory (not sure if this actually happens) a program that doesn't mention @ could even avoid having the GC code linked in
[15:40:37] <sw17ch> yeah, just that little introduction to the language informed me that he people designing Rust knew what they were doing at least part of the time ;)
[15:40:38] <cmr> and axctually I think it's optimized to a stack allocation if it isn't moved out, not sure.
[15:40:56] <dbaupp> cmr: only if LLVM does it
[15:40:58] <sw17ch> dbaupp: i would be *really* interested in making that something I could guarantee from the outside
[15:41:20] <aatch> dbaupp, so that means it doesn't, because of some codegen bugs.
[15:41:40] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[15:41:45] <dbaupp> sw17ch: I believe there is a no_gc lint or something
[15:41:59] <dbaupp> sw17ch: and so #[forbid(gc)]; would disallow it
[15:42:07] <cmr> It'd be a nice win if the compiler could do stack allocation when it can prove that a ~-ptr isn't moved out or to a different task.
[15:42:10] <sw17ch> hah, now I just need an arm target and a way to run on top of FreeRTOS
[15:42:12] <aatch> dbaupp, there is, there is one for specifically @-ptrs and one for all heap allocations
[15:42:22] <cmr> sw17ch: there is an arm target.
[15:42:36] <dbaupp> (that only works for android, atm, I believe)
[15:42:38] <aatch> cmr, kinda. it's android
[15:42:42] <cmr> ah
[15:43:00] <aatch> but we can target anything that LLVM can, in theory.
[15:43:06] <sw17ch> yeah, and i'm guessing my ARM is a little too small at the moment as well
[15:43:28] *** Joins: mleise (marco@moz-3468AB5B.pools.arcor-ip.net)
[15:43:28] <sw17ch> http://www.st.com/web/en/catalog/mmc/FM141/SC1169/SS1577
[15:43:41] <sw17ch> But Rust seems like a great language to run on small micros.
[15:44:15] <bstrie> sw17ch: you can cross-compile for arm
[15:44:18] <sw17ch> Or, i should say, it's semantics don't appear to preclude running on small systems.
[15:44:33] <dbaupp> bstrie: android-only
[15:44:52] <bstrie> I thought android was a subset of arm :P
[15:45:30] <cmr> The rt would probably need to be ported
[15:46:19] <dbaupp> the rt need to hurry up and be pure-rust! :P
[15:46:49] <sw17ch> dbaupp: you guys are guessing my next questions.
[15:47:06] <sw17ch> which was going to be "is the RT all Rust or still a lot of C?"
[15:47:07] <dbaupp> sw17ch: heh :)
[15:47:12] <cmr> it's c++
[15:47:14] <sw17ch> the followup being "does it have hard dependencies on OS services?"
[15:47:21] <dbaupp> sw17ch: have you seen zero.rs and rustboot?
[15:47:25] *** Quits: bytbox (s@moz-D83E9B31.wireless.umd.edu) (Ping timeout)
[15:47:28] <sw17ch> I saw zero.rs, but not rustboot
[15:47:40] <dbaupp> https://github.com/charliesome/rustboot
[15:47:44] <aatch> so I killed the master-linux because I think it stalled and the buildbots didn't seem to notice the new commits
[15:47:44] <sw17ch> (zero.rs hit twitter or something and that's why I started looking at Rust in the first place)
[15:47:55] <nmatsakis> aatch: do you know, did we kill the address space stuff?
[15:48:12] <cmr> https://github.com/jmgrosen/shorai/ too
[15:48:20] <aatch> nmatsakis, I don't think it's actually gone yet.
[15:48:23] <sw17ch> \o/
[15:48:34] <aatch> but I have a refactoring PR that kills it.
[15:48:37] <dbaupp> sw17ch: oh, that's neat!
[15:48:39] <nmatsakis> aatch: ok, it...appears to be, but there are still a few helpers floating around 
[15:48:46] <nmatsakis> aatch: making it unclear to me
[15:48:53] <aatch> nmatsakis, that seems likely.
[15:49:24] <nmatsakis> aatch: still I don't see any code that actually sets an address space, the only thing I see is non_gc_box_cast, but it's hardly called
[15:50:06] <nmatsakis> aatch: anyway, thanks.
[15:50:09] <cmr> nmatsakis: btw do you have any thoughts/ideas for rustdoc 2.0?
[15:50:22] <aatch> nmatsakis, do you still have the addressgen thunk?
[15:50:55] *** Joins: bytbox (s@moz-D83E9B31.wireless.umd.edu)
[15:51:05] <sw17ch> Would something like rustboot still support the full runtime?
[15:51:13] <nmatsakis> cmr: not really, except that I would like live search, I hate browsing. I wind up using etags instead for most things.
[15:51:26] <cmr> nmatsakis: live search being?
[15:51:29] <dbaupp> sw17ch: only to the extent zero.rs, I think
[15:51:39] <nmatsakis> aatch: don't think so, I don't know what that is actually.
[15:51:50] <nmatsakis> cmr: meaning some kind of text field in the html that I can type info to filter what is being displayed
[15:51:54] <nmatsakis> cmr: presumably using JS or something
[15:51:59] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[15:52:00] <cmr> nmatsakis: ah. yes, I plan to have that be possible.
[15:52:28] <dbaupp> cmr: I had an idea: for conditional compilation, collect all the options and have a list of check boxes to enable or disable certain combinations
[15:52:32] <nmatsakis> cmr: as soon as you complete your work, I'm sure I'll come up with plenty of incompatible suggestions :)
[15:52:53] <dbaupp> cmr: (by default, show them all, with functions/modules with the same name merged)
[15:52:54] <nmatsakis> ugh. conditional compilation.
[15:53:09] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[15:53:15] <aatch> nmatsakis, it's at the top of common.rs, if you don't have it, or the addrspace type alias, then the major set of address space code is gone.
[15:53:55] <dbaupp> sw17ch: I don't think so
[15:54:28] <sw17ch> My assumption would be things like threads/tasks would need additional lifting
[15:54:31] <dbaupp> sw17ch: although, I guess it does to the extent that zero.rs does
[15:54:43] <dbaupp> yeah, presumably
[15:55:07] <nmatsakis> aatch: that's still there
[15:55:18] <nmatsakis> aatch: unclear to me how widely it is used though
[15:56:01] <nmatsakis> aatch: well, I think address spaces are gone to the extent that I care about it, a PR to mop up the remnants would be most welcome to be sure.
[15:56:17] <aatch> nmatsakis, not very. you should be able to kill it. Anything that uses it can probably be killed too. Of the stuff that can't, you can replace it with 0
[15:56:37] <nmatsakis> aatch: I guess we'll see if I get into trouble just pretending we're not using them :)
[15:56:55] <aatch> nmatsakis, lol, fair enough.
[15:57:08] <indutny> aatch: so...
[15:57:14] <indutny> mind reviewing my patch?
[15:57:19] <indutny> please
[15:57:20] <indutny> https://github.com/mozilla/rust/pull/7257
[15:57:36] <aatch> indutny, I will later. Right now I'm going to sleep
[15:57:40] <indutny> ah
[15:57:41] <indutny> kewl
[15:57:42] <indutny> thank you
[15:58:01] <aatch> It's 4am here and I've just managed to get a snapshot going on auto
[15:58:02] <dbaupp> aatch: not waiting for auto?
[15:58:16] <aatch> dbaupp, not for it to finish
[15:58:27] <aatch> it's started, which is the major thing.
[15:58:33] <dbaupp> :( you won't get to celebrate!
[15:58:39] <dbaupp> ;P
[15:58:42] *** Joins: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[15:58:48] <aatch> dbaupp, I wouldn't be able to celebrate either way
[15:59:03] *** Joins: tiffnya (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[15:59:05] *** Quits: tiffnya (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Input/output error)
[15:59:19] <aatch> Well, at least I fulfilled my weekly "get in twir" requirement, I hope.
[15:59:29] <bstrie> aatch: that makes it sound like you're trapped in a room that's rapidly filling with water
[15:59:34] <cmr> aatch: but your trans refactor already fulfilled that :p
[15:59:53] *** Joins: vosen (vosen@moz-266BA656.icpnet.pl)
[16:00:19] *** Quits: sk (sk@1335CD0E.81A8C295.D066974A.IP) (Quit: Leaving)
[16:00:27] <dbaupp> bstrie: he is trapped in a city being battered by a huge storm
[16:00:35] <bstrie> ah I see
[16:00:54] <aatch> feels like an earthquake.
[16:00:56] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[16:01:13] <nmatsakis> aatch: not to far, it turns out :)
[16:01:17] <bstrie> aatch: if you don't make it out alive, I'll be sure to mention your name in the 0.7 release notes
[16:01:31] *** aatch is now known as aatch|illsnapshotyou
[16:01:40] <dbaupp> bstrie: maybe even the 0.8 ones?
[16:01:54] <bstrie> dbaupp: ...we'll see
[16:02:03] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[16:02:07] <bstrie> let's not get greedy
[16:02:17] *** Quits: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Input/output error)
[16:02:23] *** Joins: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[16:02:25] <erickt> indutny: partial review of #7257: why int instead of c_int?
[16:02:34] <indutny> oh
[16:02:37] <indutny> that must be mistake
[16:02:43] <indutny> where?
[16:02:49] *** Quits: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk) (Client exited)
[16:02:53] <indutny> oflag
[16:02:54] <indutny> I see
[16:02:58] <erickt> yeah
[16:03:00] <erickt> https://github.com/mozilla/rust/pull/7257/files#L0R1089
[16:03:21] <indutny> force pushed :)
[16:03:22] <indutny> thanks
[16:03:48] <cmr> doener: uh oh.
[16:03:58] <doener> cmr: ?
[16:04:22] <cmr> doener: your no-scratch  patch made the rust build almost a minute longer here
[16:04:33] <cmr> at least, compared to master... but there shouldn't be much of a difference there
[16:04:35] <cmr> graph uploading
[16:04:45] <doener> that's... weird?
[16:05:03] <cmr> http://octayn.net/no_scratch.png
[16:05:40] <erickt> indutny: I don't see the change :( Specifically I'm talking about all your flags should be c_int instead of int.
[16:05:51] <indutny> aaah
[16:05:55] <indutny> well
[16:05:59] <indutny> I'm using the same thing as everyone else
[16:06:13] <cmr> indutny: everything else is probably wrong then too
[16:06:20] <doener> cmr: hm, maybe the version I pushed is before the inline(always) => inline change?
[16:06:20] <erickt> cmr +1
[16:06:33] *** Quits: ysuzuki (ysuzuki@moz-A563888C.ics.keio.ac.jp) (Client exited)
[16:06:38] <cmr> doener: that might be it. want me to rebase onto master locally?
[16:07:02] <erickt> indutny: I got to run though
[16:07:34] <erickt> indutny: oh and we allow lines longer than 80 chars too :)
[16:07:39] <doener> cmr: I'm preparing a new PR that also has the nil => void change as a second commit and running timings as well. But it won't hurt ;-)
[16:07:39] <nmatsakis> Sodel_the_V: ok, fixed that problem
[16:07:49] <nmatsakis> Sodel_the_V: have to see how far the build gets now :)
[16:08:31] <cmr> nmatsakis: what do you do when you're not doing rust, btw?
[16:08:41] <nmatsakis> cmr: mostly parallel javascript atm
[16:09:19] *** Joins: mr_boo (Mibbit@E97053A0.79E85125.DFAB1F33.IP)
[16:09:21] <cmr> nmatsakis: ah, I imagine that contributed a lot to your concurrency post?
[16:10:30] <nmatsakis> cmr: there are strong similarities...but I've been vaguely planning that extension for a while, though the details have changed a lot since the early versions...
[16:10:45] <doener> cmr: I just hope that I didn't make the same mistake when I initially measured the results.
[16:10:49] <nmatsakis> cmr: the original design included 'readonly' types like found in D. I'm happier with what we have now though.
[16:11:19] <nmatsakis> cmr: in those days we didn't have inherited mutablity nor the borrow checker :)
[16:11:23] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[16:11:35] <cmr> nmatsakis: primitive days indeed ;)
[16:11:37] *** Joins: Guest (textual@moz-BB21156B.dynamic.csail.mit.edu)
[16:12:11] <SiegeLord> Can you access @ allocations from different tasks?
[16:12:11] <doener> cmr: hm, no, the inline change is actually in there
[16:12:20] <cmr> SiegeLord: nope
[16:12:54] <cmr> SiegeLord: well, actually, Id on't know that. Cell or Arc sth might allow it.
[16:12:54] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[16:13:07] <nmatsakis> SiegeLord: no.
[16:13:15] <SiegeLord> k, just doing a sanity check
[16:13:21] <sw17ch> So, @ is a task-local heap, right?
[16:13:22] *** Joins: BitPuffin (quassel@moz-436FA51.cust.tele2.se)
[16:13:23] <SiegeLord> Task-local GC sort of mandates that
[16:13:31] <sw17ch> But ~ is something that is owned and can be 'given' to another task.
[16:13:49] <dbaupp> sw17ch: if it contains owned data, yes
[16:13:56] <cmr> sw17ch: not all ~ are sendable. the value could contain non-sendable things
[16:14:08] <dbaupp> sw17ch: e.g. ~@int can't be sesnt to other tasks
[16:14:11] <dbaupp> *sent
[16:14:12] <Guest> What exactly are LLVM intrinsics?
[16:14:16] *** Guest is now known as Sergio965
[16:14:32] <sw17ch> Is that property checked at compile time?
[16:14:35] <dbaupp> Sergio965: these things http://llvm.org/docs/LangRef.html
[16:14:38] <cmr> sw17ch: yes
[16:14:40] <dbaupp> sw17ch: yep
[16:14:43] <sw17ch> hurray!
[16:15:06] <dbaupp> Sergio965: there are features/functions that LLVM knows about (i.e. the basic things like addition and multiplication)
[16:15:13] <dbaupp> (and reading from memory)
[16:15:17] <cmr> also http://llvm.org/docs/LangRef.html#intrinsic-functions
[16:16:05] *** Quits: nano (nano@moz-972880B.superkabel.de) (Connection reset by peer)
[16:16:09] <Sergio965> Are they automatically compiled in by LLVM? IE, if you use an intrinsic function, you don't have to actually write it since LLVM compiles it in?
[16:16:28] <cmr> Sergio965: yes
[16:16:56] <cmr> stuff like simd and memset and memcpy are intrinsics, and llvm can do optimizations with them because it knows their exact semantics
[16:17:22] <dbaupp> Sergio965: yes, the compiler has to know about them though (it's got a big list of intrinsics hard-coded.)
[16:17:34] <Sergio965> Are the LLVM implementations OS-agnostic?
[16:17:47] <doener> cmr: I don't actually see any difference anymore.
[16:18:00] <cmr> doener: still building off of master rebase
[16:18:03] <doener> cmr: at least not for libsyntax, build librustc now. I wonder how I messed that up
[16:18:04] <dbaupp> Sergio965: LLVM runs on many OSs, is that what you mean?
[16:18:24] <dbaupp> doener: oh? so no speed gain? :(
[16:18:25] <doener> or whether the cleanups I did after the measurement broke it
[16:18:34] <doener> dbaupp: the nil => void still shows a gain
[16:18:42] <doener> dbaupp: just not the func args one
[16:19:00] <Sergio965> dbaupp: No. I mean: Do the instrinsic function implementations make use of OS dependent features? For example, does memset (or whatever) make use of some system call?
[16:19:10] <cmr> Sergio965: it can.
[16:19:13] <cmr> Sergio965: up to llvm.
[16:19:16] <dbaupp> Sergio965: I'm sure some of them do
[16:19:24] <cmr> memset for example uses sse where possible
[16:19:47] <Sergio965> SSE has nothing to do with the OS, though. SSE is an Intel extension.
[16:19:54] <Sergio965> Unless we're talking about different things.
[16:20:06] <cmr> well OS is part of the llvm target
[16:20:11] <cmr> as is architecture
[16:20:13] <dbaupp> Sergio965: some of them become libc calls
[16:20:34] *** Joins: Guest (textual@BBE7C46A.B4F11D08.8612FA94.IP)
[16:20:35] <Sergio965> Hmm, I see. Interesting. Thanks for the info!
[16:20:49] *** Joins: Blei (philipp@moz-96D25F7A.cust.bluewin.ch)
[16:21:41] *** Quits: pnkfelix|rcirc (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net) (Quit: rcirc on GNU Emacs 24.2.1)
[16:22:26] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[16:22:33] <Sergio965> What's the current status on moving GC and some of the different pointers to the standard library? Is that something being worked on currently?
[16:22:47] <cmr> Sergio965: still being discussed
[16:22:50] <Sergio965> (as apposed to a proposal being considered)
[16:22:52] <Sergio965> I see.
[16:22:57] <Sergio965> What's the general opiniion?
[16:23:03] *** Quits: Guest (textual@BBE7C46A.B4F11D08.8612FA94.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[16:23:10] <cmr> Good idea, exact semantics and syntax disagreed upon
[16:23:19] <cmr> Still exploring problem space
[16:23:20] <bstrie> Sergio965: that the move into the library is desirable, but we need more machinery to make user-defined pointers really work
[16:23:22] <Sergio965> As always. :P
[16:23:37] <cmr> Sergio965: http://cmr.github.io/blog/2013/06/15/this-week-in-rust/
[16:23:57] <Sergio965> Wonderful.
[16:24:05] <Sergio965> You guys are awesome.
[16:24:19] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[16:24:20] *** Quits: pnkfelix (pnkfelix@moz-801E009D.vlan502.asr1.cdg2.gblx.net) (Quit: Leaving.)
[16:24:38] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Quit: Computer has gone to sleep.)
[16:24:51] <doener> cmr: I guess I know what might have caused the wrong results. I think I run that before I fixed the case where the datum wants to be passed by reference. So that avoided too many copies. That only caused visible errors when building stage3 or running the test suite
[16:25:11] *** Joins: graydon (graydon@3853DDD.39EEDBB3.D758B1AA.IP)
[16:25:11] *** ChanServ sets mode: +qo graydon graydon
[16:25:42] <cmr> doener: I rebased onto master and it's all better now
[16:25:44] <cmr> uploading
[16:26:09] <cmr> http://octayn.net/no_scratch.png updated
[16:26:17] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[16:26:19] <cmr> the commit in the legend is wrong now...
[16:26:21] *** Quits: mr_boo (Mibbit@E97053A0.79E85125.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[16:26:38] <cmr> but it's just a rebase ontop of 7375e94
[16:27:04] <doener> ok, that's what I see here, too
[16:27:38] *** Joins: Guest (textual@BBE7C46A.B4F11D08.8612FA94.IP)
[16:28:03] <cmr> graydon: snapshot is currently building :)
[16:28:11] *** Joins: doomlord_ (walter@moz-6651F8D4.range86-145.btcentralplus.com)
[16:28:14] <dbaupp> *currently testing
[16:28:17] <cmr> as in already made and testing the stage0 removals
[16:28:36] *** Joins: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP)
[16:28:40] <cmr> passed win so I'm going to guess it'll be fine
[16:28:49] <Sergio965> Are there any Rust meetups in Boston?
[16:28:53] <graydon> cmr: impossible!
[16:29:38] <graydon> what happened to master and auto? fixed?
[16:29:41] <cmr> yup
[16:29:48] <dbaupp> graydon: aatch has been nursing the buildbots for half the day... and it appears to work
[16:29:52] <nmatsakis> Sergio965: I'm in Boston, but no meetups yet
[16:29:59] <nmatsakis> Sergio965: we could try and organize one sometime
[16:30:25] <Sergio965> nmatsakis: I'd be up for it. I imagine a lot of the guys in my lab would be interesting in coming.
[16:30:27] <cmr> I'm not too far (~2 hr) from Boston, I might be able to make one
[16:30:28] <dbaupp> graydon: it required #[ignore]-ing some rustpkg tests, and some debug-info ones
[16:30:39] <doener> cmr: new PR with the other change that should actually reduce compile times. https://github.com/mozilla/rust/pull/7259 -- would you be so nice to measure that one as well?
[16:30:45] <graydon> dbaupp: huh. never figured out what was going on with the rustpkg tests eh?
[16:30:45] <graydon> ok
[16:30:47] <cmr> doener: sure thing
[16:30:52] <doener> thanks!
[16:31:22] <dbaupp> graydon: nope... i think aatch just opened an issue and pinged tjc
[16:31:29] <graydon> thanks anyways! wonderful work
[16:32:17] <dbaupp> all down to aatch... he stayed up until 4am in a huge storm to get it going!
[16:32:25] * doy would come to a boston rust meetup
[16:32:31] <cmr> graydon: I'd like to try and get my mem-bench.py runner integrated into the linux auto builds if you'd be up for that. it would be nice to have more detailed performance comparisons.
[16:33:25] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[16:33:26] <graydon> I would be into it, yes. I want .. well, there are some steps. I would like two independent things.
[16:33:27] * dbaupp thinks it would be most useful with guarantees about not sharing a buildslave
[16:33:49] <nmatsakis> doener Sergio965 cmr : let's try to organize one then. I'm in the midst of a move, maybe in a bit, once I've settled in :)
[16:33:57] <graydon> one is for workspaces to have builds report back various scalars as measured properties of the build
[16:33:59] <nmatsakis> er, doy^
[16:34:09] <graydon> properties in the buildbot sense. so they're easily graphed by outside scripts etc.
[16:34:24] <graydon> the other is for workspaces to ratchet their 'make check' against regression on those numbers.
[16:34:27] *** Joins: bent (chatzilla@moz-BE33DA21.fw1.sfo1.mozilla.net)
[16:34:33] *** Joins: mblbruce (Mibbit@23B5A3DB.50E2AA7.7BEC212D.IP)
[16:34:36] <cmr> what is a workspace?
[16:34:48] <graydon> that is, first build records numbers if they're not present, subsequent builds fail make check if the numbers are worse
[16:34:53] <cmr> also, what constitutes a notable regression?
[16:34:56] <graydon> like the build directory of a checkout of our tree
[16:35:07] <doy> nmatsakis: works for me, i'm also in the middle of a move(:
[16:35:18] <graydon> so that we don't have to wait for buildbots to tell us we are hacking on a change that is a perf regression
[16:35:35] <graydon> (triage time, anyone who's interested)
[16:35:53] <graydon> oh wait, it's 10 today?
[16:36:08] <graydon> grr I would have gone into office. oh well, my fault for not checking calendar.
[16:36:23] <Sergio965> nmatsakis: Definitely. 
[16:36:58] <graydon> cmr: defining "notable regression" is indeed the hard part.
[16:36:58] <cmr> graydon: I don't really know a lot about the build system or buildbots, so...
[16:37:33] <graydon> cmr: the easiest thing (which I've been working on) is a json file full of "counter": number pairs
[16:37:50] <graydon> cmr: and if you fail-to-report one it's a warning (and is recorded anew)
[16:37:59] <graydon> if you report one better, it records the improvement
[16:38:04] <graydon> if you report one worse, it fails
[16:38:13] <graydon> worse-by-some-delta
[16:38:21] <graydon> so then it's a question of tuning the windows, I guess :(
[16:38:49] <graydon> this will only work for things where the perf can be reduced to a scalar, not (say) a complicated multi-modal distribution
[16:39:18] <mblbruce> Is there anything special about the word "once" in rust (0.6)? I failed to build a crate file that made use of a once.rs with "mod once;" (like in the 0.6 tutorial) but rustc complained about finding "once" in ident position. I couldn't find it in the list of keywords.
[16:39:19] *** Quits: cowboyd (cowboyd@1D8844A7.1B729417.CEE440B6.IP) (Client exited)
[16:40:11] <graydon> mblbruce: yes, it's a reserved word
[16:40:29] <graydon> (for functions-that-can-only-execute-once, but we're not sure if we're going to do that)
[16:40:52] <mblbruce> graydon: I see. Thanks!
[16:41:11] *** Joins: eschweic (Adium@2557E599.66715431.D25A875A.IP)
[16:41:26] <bblum> just call your thing "twice"
[16:41:29] *** Joins: pyrac (pyrac@moz-DAB0A516.w109-222.abo.wanadoo.fr)
[16:42:06] <SimonSapin> How can I work around "cannot borrow `*self` as mutable more than once at at a time"?
[16:42:28] *** Quits: Guest (textual@BBE7C46A.B4F11D08.8612FA94.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[16:42:29] <mblbruce> bblum: ... And there's the perfect solution. I'll get right on it. ;o)
[16:42:40] <nmatsakis> SimonSapin: typically what you have to do is divide up your data 
[16:42:47] <nmatsakis> SimonSapin: but it depends on the case :)
[16:42:52] <nmatsakis> SimonSapin: can you gist the code in question?
[16:42:59] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[16:43:55] <SimonSapin> nmatsakis: https://github.com/SimonSapin/rust-cssparser/blob/master/tree.rs#L154
[16:44:21] <SimonSapin> I‚Äôm porting this from Rust 0.5 (I think)
[16:45:00] <nmatsakis> SimonSapin: where is the error message reported exactly? that looks strange, because self is an immutable pointer,
[16:45:02] <SimonSapin> because fields can not be mutable anymore I have to make the whole Parser mutable everywhere
[16:45:11] *** Joins: sk (sk@61A494B3.BA40E8A.AAC02D62.IP)
[16:45:20] <nmatsakis> SimonSapin: I see, so this is not the exact source.
[16:45:36] <SimonSapin> I can push my current source if that helps
[16:46:01] <nmatsakis> SimonSapin: go ahead, I think I have a suggestion for this case.
[16:46:46] <SimonSapin> https://github.com/SimonSapin/rust-cssparser/blob/WIP/tree.rs#L158
[16:46:52] <nmatsakis> SimonSapin: in the each_token() fn, you can have it pass `self` back to the closure. the problem is that `&mut` values are tracked closely by the compiler, so it considers `each_token` to have claimed `self,
[16:46:58] <nmatsakis> SimonSapin: and hence disallows you from loaning it out again.
[16:47:20] <SimonSapin> I understand that
[16:47:48] <SimonSapin> although I believe the compiler is stricter than it needs to be
[16:47:54] <nmatsakis> SimonSapin: but what you can do is `for self.each_token |token, this| { primitives.push(consume_primitive(this, token,)); }
[16:48:34] <SimonSapin> ah, I see
[16:48:38] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[16:48:45] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[16:48:53] <nmatsakis> SimonSapin: in general the *best* thing to do, though,
[16:49:00] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[16:49:02] <nmatsakis> SimonSapin: is to divide up your state so that you don't always invoke methods on `self`
[16:49:03] *** Parts: mblbruce (Mibbit@23B5A3DB.50E2AA7.7BEC212D.IP) ()
[16:49:05] <nmatsakis> e.g., something like:
[16:49:13] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[16:49:15] <Sodel_the_V> nmatsakis: Great! (Sorry for the delay!)
[16:49:24] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[16:49:26] <nmatsakis> for self.token_handler.each_token |token| { primitives.push(consume_primitive(self.consuming_state, token)) }
[16:49:39] <nmatsakis> SimonSapin: ^ in this case, each_token claims self.token_handler, and consume_pritmitive claims self.consuming_state,
[16:49:43] <nmatsakis> SimonSapin: and the compiler is happy. 
[16:49:49] <SimonSapin> I see
[16:49:51] <nmatsakis> SimonSapin: but sometimes it's tricky to divide up the state like that
[16:49:59] <nmatsakis> SimonSapin: though if you can it does lead to clearer code, better encapsulated
[16:50:12] *** Quits: dbaupp (Thunderbir@moz-73E90475.lns20.syd6.internode.on.net) (Ping timeout)
[16:50:23] <nmatsakis> Sodel_the_V: currently I am sorting through compilation errors that result because I fixed some bugs in the method handling in that patch I submitted to you a while back
[16:50:31] *** Joins: anri (solancile@moz-A1CFFAE5.hsd1.wa.comcast.net)
[16:50:34] <SimonSapin> I‚Äôll  do the "this" trick now to get tests running again, do the ton of refactoring that needs to happen anyway, and then revisit
[16:50:36] <SimonSapin> thanks
[16:50:56] *** Joins: azita (Azita@2557E599.66715431.D25A875A.IP)
[16:51:00] <nmatsakis> SimonSapin: yeah, it's best if you keep that constraint in mind when designing in the first place,
[16:51:03] <nmatsakis> SimonSapin: as always it's hard to refactor :/
[16:51:22] <SimonSapin> well, that constraint did not exist in the language when I first wrote this :)
[16:51:50] <nmatsakis> SimonSapin: aye, there's the rub :)
[16:52:27] <nmatsakis> SimonSapin: tell me about it, we're still working on adjusting the compiler to better fit the new rules  :)
[16:53:46] <SimonSapin> "aborting due to 74 previous errors"
[16:53:47] <SimonSapin> hum
[16:54:04] <SimonSapin> that‚Äôs about one every 10 line of code
[16:55:39] *** Quits: orshem (orshem@3545E24A.588A166C.E3D28531.IP) (Quit: Leaving)
[16:55:39] *** Joins: mschifer (Adium@2557E599.66715431.D25A875A.IP)
[16:55:59] <cmr> doener: http://octayn.net/ir.png
[16:56:05] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[16:57:44] <doener> cmr: hm, looks like the gain is a little less than what I saw here. But at least it didn't turn out to be slower again :-)
[16:58:45] *** Joins: tjc (tjc@6902864.17C2F9C.163DC5C6.IP)
[16:58:45] *** ChanServ sets mode: +o tjc
[16:59:08] <cmr> it's interesting that basically the only speed improvement is from faster llvm passes
[16:59:50] <cmr> tjc: nice slides! how did the talk go?
[17:00:10] <tjc> cmr: Thanks! The talk went OK, it seemed slightly under-attended but it was at the same time as four other really good talks :-)
[17:00:20] <tjc> got a fair amount of questions, and only one annoying question ;-)
[17:00:27] <cmr> heh
[17:00:31] <cmr> what was the annoying one?
[17:00:39] <tjc> a guy asked whether we had IDE support yet, I said no
[17:00:53] <cmr> ah
[17:00:54] <tjc> and then he kind of hemmed and hawed about "really, no IDE support?!" as in "what kind of language wouldn't have an Eclipse plugin"
[17:01:10] <tjc> but then I said we had an emacs mode and he was a bit pacified (I don't consider emacs an IDE :-D)
[17:01:13] <nmatsakis> tjc: you should have said "yes, there is an emacs mode" :)
[17:01:19] <nmatsakis> oh, yo did :)
[17:01:27] <tjc> nmatsakis: I didn't want to say that at first because I didn't want to get laughed at for implying emacs was an IDE :-)
[17:01:28] <doener> the trans pass that creates the extra intructions only takes <5% of the total time, so there's no much to gain. IIRC I saw about 5% saved there, which is about 0.25% overall
[17:01:37] <nmatsakis> tjc: I know, I know.
[17:02:31] <cmr> tjc: might the questions and slides inform a new iteration of the rust tutorial? :)
[17:02:40] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[17:03:10] <tjc> cmr: possibly; especially once the recording is up and I can listen to the questions, sine I never remember them afterwards (too pumped up when I'm in giving-a-talk mode to have any long-term memory :-)
[17:03:28] <cmr> heh
[17:03:59] *** Joins: cowboyd (cowboyd@moz-1BD02A1E.sw.biz.rr.com)
[17:04:35] <cmr> graydon: is the current state of auto builders temporary? it really takes *forever* for things to go through
[17:06:05] *** Quits: Earnestly (earnest@6A917A59.5E1FD793.39C00A7A.IP) (Ping timeout)
[17:08:12] <graydon> cmr: we will work on trying to speed them up
[17:08:29] <graydon> but I would prefer not to get back to a state where auto is advancing away from tests-that-need-to-pass-for-a-snapshot
[17:08:36] <graydon> (or for "stability" in some meaningful sense)
[17:09:32] <cmr> right, I agree, but two+ hours for a merge is a bit much.
[17:10:03] <graydon> suggestions welcome!
[17:10:08] <graydon> (triage meeting starting)
[17:10:17] <bstrie> ETA: 6886s :(
[17:11:01] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[17:11:21] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Quit: Leaving)
[17:11:44] <bstrie> graydon: I think there was already a need for some kind of mechanism to avoid running the tests for things such as the .vimrc getting updated
[17:12:12] <bstrie> graydon: perhaps we need to batch small PRs into larger ones before they go to auto
[17:12:29] *** Quits: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP) (Quit: carllerche)
[17:12:41] *** Joins: nano (nano@moz-972880B.superkabel.de)
[17:13:26] *** Joins: lkuper (lkuper@66AE1C4.B4544612.EA8B5958.IP)
[17:13:30] *** Joins: hjr3 (hradtke@374E545A.3A8E9B0C.F9D9C60E.IP)
[17:14:10] <bstrie> graydon: perhaps there could be a branch called "minor", and when a reviewer gives an approval with "r+ minor" it just gets shoved onto the minor branch with no tests, and then the minor branch gets merged in to master the usual way once per day
[17:14:21] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[17:14:30] *** Joins: brson (brson@2557E599.66715431.D25A875A.IP)
[17:14:30] *** ChanServ sets mode: +o brson
[17:14:34] <Blei> batching patches!
[17:15:09] <cmr> bstrie: or the next normal PR
[17:15:28] *** Joins: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP)
[17:15:28] *** ChanServ sets mode: +o pcwalton
[17:15:45] <bstrie> graydon: this would *especially* help for things like updating documentation, since that's an easy target for new users and since we're going to need a lot of it
[17:16:07] *** Joins: Earnestly (earnest@6A917A59.5E1FD793.39C00A7A.IP)
[17:16:29] <cmr> or, tackling it the other way around, maybe larger/more risky PRs get r+ major, which gets a more thorough batch of testing?
[17:16:58] <bstrie> cmr: I'm a little wary of just tacking on to any arbitrary pull request, since it's not infeasible that someone could "r+ minor" a pull that breaks something terribly
[17:17:13] <cmr> bstrie: yeah, that's true
[17:17:40] *** Quits: Earnestly (earnest@6A917A59.5E1FD793.39C00A7A.IP) (Quit: WeeChat 0.4.2-dev)
[17:17:43] *** Joins: Earnestly (earnest@6A917A59.5E1FD793.39C00A7A.IP)
[17:17:45] <cmr> Also closing the tree as soon as master gets red instead of much later would help.
[17:17:48] <Blei> on the other hand, having a bach of 20 patches fail and having to figure out which one is the problem sounds very frustrating
[17:17:49] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[17:18:07] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[17:18:17] <bstrie> cmr: the problem with "r+ major" is that every pr needs to get run against the full battery of bots eventually, and if you give something "r+ major" there's no guarantee that it's *that* change instead of some previous changed that caused a failure
[17:18:54] <bstrie> Blei: true, but if they're all minor it shouldn't be too hard to pin down the failure, even if there are 20 of them. it will definitely require discretion
[17:19:02] <Blei> and r+ major still blocks all the following r+ minor patches, but that's probably a small problem
[17:19:10] *** Joins: jviereck (Adium@moz-93A5D87E.ethz.ch)
[17:19:18] <cmr> bstrie: the way I'd have it is every merge into master gets a full battery of tests, but not every merge into auto does.
[17:19:36] <cmr> and a slow master wouldn't be blocking changes piling up
[17:19:40] <Blei> cmr: i.e. back to the master/auto split ;)
[17:19:53] <cmr> Blei: right :(
[17:19:53] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[17:20:01] <cmr> Blei: but if the tree closed when master went red, it'd avoid that
[17:20:19] <Blei> true
[17:20:35] <bstrie> cmr: as I said, the worst-case scenario there is that you run a full test and it turns out that some previous change caused the failure without getting tested, it's a pain to track down
[17:21:33] <cmr> bstrie: but with this that wouldn't happen (everything gets a full battery when it hits master, some things get a full battery before they hit master)
[17:21:46] <cmr> Alternatively r+ major could block on everything waiting in master for a full battery to be tested.
[17:23:03] <cmr> mostly r+ major would be codegen/rt changes
[17:26:24] *** Quits: igl (igl@moz-5AE08D12.adsl.alicedsl.de) (Ping timeout)
[17:28:19] *** Joins: igl (igl@moz-7FB18263.adsl.alicedsl.de)
[17:28:44] *** Joins: ecr (ereed@2557E599.66715431.D25A875A.IP)
[17:29:15] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[17:29:43] <bstrie> cmr: so would you do all development against auto?
[17:30:26] <cmr> no?
[17:31:29] *** Quits: vmx (vmx@moz-95B7C46F.pools.arcor-ip.net) (Quit: Leaving)
[17:31:40] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[17:31:55] <bstrie> cmr: so how often would you merge auto into master?
[17:32:25] *** Quits: Excureo (c@moz-DE8C33F1.static.yakm.wa.charter.com) (Input/output error)
[17:33:31] <cmr> bstrie: as fast as possible (whenever the basic battery of tests passes (which should probably be more thorough than the previous auto battery, but much less than the current))
[17:33:59] <cmr> r+ major would require all pending full-battery tests on master to be completed before testing it
[17:34:14] <cmr> and if any fail, bors shuts down, closing the tree
[17:34:51] *** Quits: CarpNet (ac@moz-FD24B77.sohonet.co.uk) (Quit: Leaving)
[17:34:59] <bstrie> cmr: so you mean we only run the tests *after* it lands on master?
[17:35:21] <cmr> bstrie: no, only the full battery of tests (valgrind, cross builds, opt, no-opt) is run on master
[17:35:34] <bstrie> what do you mean "run on master"
[17:35:35] *** Quits: pyrac (pyrac@moz-DAB0A516.w109-222.abo.wanadoo.fr) (Quit: pyrac)
[17:35:56] <cmr> merges into master would be run on all of those bot configs
[17:36:57] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[17:37:41] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[17:39:30] <bstrie> cmr: walk me through the lifecycle of a pull request, because I'm still not getting it
[17:39:38] <cmr> Ok.
[17:39:43] <cmr> Sec...
[17:41:36] <cmr> Alright
[17:41:43] <cmr> So PR 1 gets r+
[17:41:50] <cmr> It gets added to bors' queue.
[17:41:55] <cmr> Same with PR 2-6
[17:42:01] <cmr> but PR 6 has r+ major
[17:42:44] *** Joins: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net)
[17:42:53] <cmr> bors pops off PR 1, merges it into auto, and the auto buildbots (which are the full testsuite on win/mac/lin) do their thing. when all pass, it gets merged into master
[17:42:59] <cmr> bors pops off PR 2, merges it into auto
[17:43:30] <cmr> meanwhile, the master buildbots (which are full testsuite on win/mac/lin/bsd with valgrind, opt/no-opt, and cross builds) get to work on PR 1
[17:43:39] <cmr> PR 2 passes auto, merged into master
[17:43:44] <cmr> PR 3 passes auto, merged into master
[17:43:51] <cmr> master PR 1 passes, it gets to work on PR 2
[17:44:16] <cmr> bors gets to PR 6, sees that it is r+ major, and waits until all pending PRs (1-5) on master have passed
[17:44:27] <cmr> If they do not pass, the tree is closed, PR 6 never gets run
[17:45:03] <cmr> If they do pass, PR 6 goes to  auto-full branch and gets tested with the same buildbot configs as master
[17:45:08] *** Quits: ksev (DrunkenPan@745B767B.989A61DC.CA5B6332.IP) (Ping timeout)
[17:45:37] *** Quits: Aetherspawn (Aetherspaw@moz-8811D9F0.static.tpgi.com.au) (Quit: Leaving)
[17:45:40] <cmr> normal r+ do not wait for the pending master PRs to pass, but if bors sees that master is ever red, he stops, effectively closing the tree until master is green again
[17:45:46] <cmr> I think that's everything
[17:45:48] <cmr> bstrie: make sense?
[17:46:38] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Quit: eatkinson)
[17:47:07] <brendanc> if you've got a bunch of pending pull requests you could maybe run them all in parallel on auto-nnn branches, then merge the ones that pass together into auto for the next run?
[17:47:46] <cmr> brendanc: ehh that could cause difficult-to-debug interactions. also, we don't have enough buildbots
[17:47:50] *** Quits: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com) (Quit: bye bye)
[17:47:56] <cmr> (currently, not sure if that could change)
[17:48:12] <brendanc> yeah if the octopus failed you'd have to bisect or just fall back to serial
[17:48:41] <brendanc> number of buildbots doesn't necessarily matter, but cores and RAM maybe does :)
[17:49:27] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[17:49:54] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[17:50:40] <cmr> bstrie: this would probably want another branch, "green", which tracks the latest merge into master that passed
[17:51:20] <cmr> green would be behind auto frequently, but I imagine it'd catch up during nights/weekends
[17:51:35] *** Quits: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP) (Input/output error)
[17:51:38] <sully> hm, do we know when the tree is going to open again?
[17:51:52] <cmr> sully: http://buildbot.rust-lang.org/console?refresh=15
[17:51:56] <cmr> hopefully when auto turns green
[17:52:04] <cmr> (which also marks the release of a new snapshot!)
[17:52:25] <bstrie> cmr: I'm still not sure that this idea is buying us anything... right now, at 2 hours per cycle, it would take us 12 hours to land 6 pull requests. with the scheme above, it still takes 12 hours to land six pull requests, except the first five requests land in 2.5 hours rather than 10
[17:52:38] *** Quits: eschweic (Adium@2557E599.66715431.D25A875A.IP) (Quit: Leaving.)
[17:53:28] <cmr> bstrie: maybe not, just an idea I had
[17:53:50] *** Quits: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk) (Connection reset by peer)
[17:54:05] <brendanc> my parallelization scheme would land 6 pull requests in 4 hours if you had enough cores :)
[17:54:11] *** Quits: BitPuffin (quassel@moz-436FA51.cust.tele2.se) (Connection reset by peer)
[17:54:17] <cmr> brendanc: only in the best case
[17:54:25] <Blei> maybe: when merging r+minor prs into master, except of running the full tests for each pr, only run the full test on the latest pr
[17:54:32] *** Joins: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk)
[17:54:36] <Blei> this might buy some time
[17:54:36] <bstrie> the worse-is-better rule might just be "run normal builds as usual, and then run the mega super build once per day on master, and close the tree if it fails"
[17:54:37] *** Joins: BitPuffin (quassel@moz-53415F0F.cust.tele2.se)
[17:54:39] <brendanc> yes, only if all 6 were landable
[17:54:56] *** Quits: Sodel_the_V (user@moz-853663E1.va.shawcable.net) (Quit: Eaten by a grue)
[17:55:13] <cmr> bstrie: yeah, that'd be fine for me
[17:55:22] <Blei> sounds reasonable
[17:55:53] <cmr> bstrie: we might be able to have nightly snapshots with that too!
[17:56:05] *** Joins: Sodel_the_V (user@moz-853663E1.va.shawcable.net)
[17:56:09] <cmr> think of how wonderful it would be to only have to stage crufty stuff for a day!
[17:56:14] <cmr> rather than 1+ months..
[17:57:27] <bstrie> cmr: there could be a compromise here
[17:57:54] *** zz_kimundi is now known as kimundi
[17:58:20] *** Quits: BitPuffin (quassel@moz-53415F0F.cust.tele2.se) (Ping timeout)
[17:58:37] <bstrie> cmr: in your scenario above, pr 1 lands, starts the megatest, then 2 and 3 land, then megatest 1 finishes, then it starts the megatest for 2. instead it could start a megatest just for the most recent pull, and if it fails we've narrowed it down to 2 possibilities
[17:58:43] <Sodel_the_V> nmatsakis: Apologies for my huge delays when responding. Unexpected work stuff was distracting me. I should be more present for the rest of the day, if you need anything from me.
[17:59:05] <Blei> bstrie: that's what i was suggesting :) if somewhat less well formulated
[17:59:47] <cmr> bstrie: that's also reasonable
[17:59:52] <cmr> bstrie: master won't be super behind, either
[18:00:06] <bstrie> Blei: yes, it was a compromise between yours and his
[18:00:12] <nmatsakis> Sodel_the_V: ok, I've got the code working now, I think, but there is a problem involving cyclic method invocation that I'm not sure how bes tto resolve, letting it sit for a sec :)
[18:01:14] <Sodel_the_V> nmatsakis: Great! Fair enough. :)
[18:01:43] <bstrie> cmr Blei: we could *also* have my idea of having a minor test branch, where all the pulls get batched there for merging once a day
[18:02:00] <cmr> bstrie: but if that fails... pita
[18:02:22] <sully> argh something pollutes the build directory again.
[18:02:25] <bstrie> cmr: right, you'd have to be smart about using it. mostly for stuff like /etc/ changes and documentation
[18:02:27] * sully twitches
[18:02:30] <cmr> right
[18:02:42] <bstrie> the sort of stuff that you'd tag as a "minor edit" on wikipedia :PP
[18:02:51] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[18:02:51] <bstrie> too many tongues there
[18:02:55] <bblum> no new snapshot, huh?
[18:03:04] <cmr> bblum: it's almost done tests
[18:03:10] <bstrie> bblum: ETA: 1003s
[18:03:22] <cmr> just waiting for {mac,lin}-all-opt
[18:03:28] *** Quits: tjc (tjc@6902864.17C2F9C.163DC5C6.IP) (Quit: zzzzzzzzzz)
[18:04:13] <bblum> ok, nice
[18:04:43] *** Joins: eschweic (Adium@2557E599.66715431.D25A875A.IP)
[18:04:51] *** toddaaro is now known as qenko
[18:05:03] *** qenko is now known as toddaaro
[18:05:17] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[18:05:34] <cmr> bstrie: the ideal solution will have us working on code rather than waiting all day for stupid auto to pass tests :p
[18:06:32] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[18:07:13] <bstrie> cmr: the other thing with your plan is that currently it's the autobots that are set up to do the megabuild, and the masterbots do the littlebuild
[18:07:20] <bstrie> rather than the other way around
[18:07:45] <steven_is_false> I'm curious, a functional way of creating a compile time lookup table would be fn lookup_table(key : &str) -> uint { match key { "foo" => 0, "bar" => 1, "car" => 2, etc.. but it sounds like that approach wouldn't work for https://github.com/mozilla/rust/issues/4864 . In practise, what would the performance problems of the match approach be?
[18:08:07] <cmr> steven_is_false: linear lookup time
[18:08:20] <steven_is_false> cmr: It really compiles that badly?
[18:08:20] <cmr> well, I don't know what that optimizes into, actually
[18:08:28] <SiegeLord> That's an implementational detail though, right?
[18:08:49] <hoelzro> I wrote a function for creating a **libc::c_char from a [&str], I realize it's probably pretty bad, but could I get some critiquing? https://gist.github.com/hoelzro/5825097
[18:10:23] <steven_is_false> cmr: Is there any reason it shouldn't be optimized into a hash table (other than that it is not implemented yet?)
[18:10:42] <cmr> steven_is_false: I don't see why it couldn't be
[18:10:54] <doener> all green :-)
[18:11:35] <bstrie> still waiting on the merge into master...
[18:11:37] *** Quits: Sergio965 (textual@moz-BB21156B.dynamic.csail.mit.edu) (Quit: Textual IRC Client: www.textualapp.com)
[18:11:49] *** Joins: tjc (tjc@6902864.17C2F9C.163DC5C6.IP)
[18:11:49] *** ChanServ sets mode: +o tjc
[18:11:54] <steven_is_false> strcat is the thestinger right? He probable already considered that approach, and knows why it wouldn't work well. I should ask him if he knows a reason why that approach wouldn't work.
[18:11:58] <bstrie> hoelzro: it actually looks good, I like that you're using vector destructuring
[18:12:12] <cmr> hoelzro: I don't think that the recursion is efficient
[18:12:21] <brson> aatch|illsnapshotyou: thanks for the snapshot
[18:12:28] <cmr> hoelzro: as in, optimized well
[18:12:35] *** Quits: IRCMonkey56359 (heftig@moz-E9626940.dip0.t-ipconnect.de) (Ping timeout)
[18:13:16] <cmr> hoelzro: why not just iterate over the ary?
[18:15:05] <bblum> should i prohibit a @once fn from being constructed, or should i prohibit it from being called?
[18:15:17] <bblum> (or from being copied??)
[18:15:23] <cmr> bblum: if you can't call it, why allow construction?
[18:15:50] <bblum> for completeness of theory
[18:16:31] <bblum> i guess currently the compiler "accidentally" prevents it from being copied
[18:17:00] *** Quits: txdv (quassel@966F3542.3BA477DA.14C26596.IP) (Ping timeout)
[18:18:10] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[18:18:33] <hoelzro> cmr: it's not, I'm sure, but I wanted to leverage str::as_c_str
[18:18:57] <cmr> fff rusti is gone again
[18:19:06] *** Joins: txdv (quassel@966F3542.3BA477DA.14C26596.IP)
[18:20:15] <cmr> hoelzro:  ~[~"a", ~"b", ~"c"].map(|x| x.as_c_str(|cs| cs))
[18:20:23] *** Joins: devbug (quassel@moz-E1DE087C.bchsia.telus.net)
[18:20:51] <hoelzro> I was recommended that earlier (by you, maybe?), but letting the c string escape the block seems...unclean, somehow?
[18:21:04] <doener> cmr: as_c_str might create a ~str, which would disappear too early
[18:21:07] *** Joins: BitPuffin (quassel@moz-53415F0F.cust.tele2.se)
[18:21:21] <doener> i.e. the borrow checker should complain about that
[18:21:36] <cmr> hm
[18:21:40] *** Joins: Jesin (Jessin_@moz-157A63DD.cc.lehigh.edu)
[18:21:51] <doener> doesn't do that in rusti though
[18:21:52] <doener> hm
[18:21:54] <bblum> any codegen weenies around? If I create a stack closure with no captured environment, will there be an environment packet at all?
[18:22:07] <pcwalton> bblum: probably
[18:22:11] <cmr> Don't you already have that problem though, since you *store* the raw_str from as_c_str locally?
[18:23:18] <hoelzro> true, but I only reference the new pointers from within callback
[18:23:25] <doener> cmr: doesn't the recursion mean that the calls are all nested?
[18:23:31] <hoelzro> which are nested in the recursive calls
[18:23:33] <doener> cmr: so the regions nest as well
[18:23:35] <cmr> doener: oh right
[18:23:38] <bblum> pcwalton: thx
[18:23:41] <cmr> I didn't catch that
[18:24:30] <cmr> hoelzro: well, the only suggestion I have then is ptrs.push(foo), rather than vec::push :)
[18:24:31] <doener> oh, d'oh, the c_str is a * pointer, which isn't region checked, right?
[18:24:37] <cmr> doener: nope
[18:24:38] <hoelzro> oh, ok!
[18:24:55] <doener> hoelzro: and maybe vec::with_capacity() to avoid reallocs
[18:25:04] <cmr> ah, yep
[18:25:10] <hoelzro> oh, I wasn't aware of that!
[18:25:29] <brson> can we turn bors back on now?
[18:25:42] *** Joins: spider-mario (spidermari@moz-2F72F6FF.dsl.quantic-telecom.net)
[18:25:43] <cmr> brson: merge auto into master first, but I don't see why not
[18:26:22] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[18:26:22] <ghrust> 01[13rust01] 15brson merged 06auto into 06master: 02http://git.io/tiw8VA
[18:26:22] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[18:26:31] <cmr> And we have a snapshot
[18:26:34] <cmr> \o/
[18:26:37] <bblum> snapshoot!
[18:26:41] *** brson changes topic to 'http://www.rust-lang.org¬†| logs at https://botbot.me/mozilla/rust/ and http://irclog.gr/#browse/irc.mozilla.org/rust'
[18:26:54] <brson> graydon: please activate the bors
[18:26:59] <bblum> now somebody approve my PR please ;)
[18:27:07] <cmr> bstrie: I like your compromise (super mega build on latest PR) best of all the proposals
[18:27:19] <cmr> bstrie: seems to be the easiest while still avoiding long-term breakage
[18:27:27] <cmr> and retaining short-term agility
[18:27:53] <graydon> brson: on the current set of auto builders? +/- any?
[18:28:37] <pcwalton> a snapshot?!
[18:28:40] <pcwalton> holy cow
[18:29:25] <brson> graydon: yes, all
[18:30:21] *** Joins: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP)
[18:30:21] *** Joins: IRCMonkey56359 (heftig@moz-1D217FC8.dip0.t-ipconnect.de)
[18:30:44] <doener> cmr: for (~[~"aaaa".slice(1,2), ~"bbbb".slice(1,2), ~"cccc".slice(1,2)].map(|x| x.as_c_str(|cs| cs))).each() |y| { println(unsafe { std::str::raw::from_c_str(*y) }) }
[18:30:54] <doener> prints "c" three times, because the intermediate ~str gets lost
[18:30:56] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[18:31:00] <bblum> nmatsakis: what's the purpose of the check_imm_free_var() check in ~fn and @fn environments?
[18:31:21] *** Joins: sp3d (a@moz-49806493.dhcp.stls.mo.charter.com)
[18:31:28] <doener> (might print anything, really, but "c"s are what I get right now)
[18:32:08] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[18:32:41] *** Quits: fabiand (fabiand@moz-B2D3FDD0.adsl.alicedsl.de) (Quit: Verlassend)
[18:33:42] <graydon> bors re-activated
[18:33:50] <bstrie> graydon: we hashed out a proposal above on how to reduce cycle time. basically you'd turn the current master bots into the auto bots and vice versa, do a test cycle on the auto bots for each PR (~30 mins), and push to master immediately when each one finishes. then on master we run the full suite of buildbots continuously, always on just the most recent commit (~2 hrs). if master ever turns red, the tree automatically closes. the idea is that this
[18:34:11] <Eridius> bstrie: you cut off at "the idea is that this"
[18:34:38] <bstrie> ... lets us keep the old, er, "rapid" development speed while also assuring that when things go bad we only have to sift through ~4 prs
[18:35:18] <Eridius> pfft, lets just bring back incoming
[18:35:19] <doener> could someone point me to the place where "self" gets added to the args passed in a method call? I'm apparently too blind to find that
[18:35:20] <Eridius> </troll>
[18:35:22] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Quit: eatkinson)
[18:35:41] <graydon> bstrie: that's what we were doing before
[18:35:50] <graydon> bstrie: except nobody closed the tree when master went red
[18:35:52] <graydon> they stopped looking
[18:35:58] <graydon> and then after a couple days
[18:35:59] <graydon> someone would notice
[18:36:05] <graydon> and we'd say "huh, well, someone will mop it up"
[18:36:05] <cmr> graydon: also master wasn't as thorough
[18:36:07] <bstrie> graydon: ah I had no idea
[18:36:09] <graydon> and then it'd be 2 weeks later
[18:36:11] <graydon> etc. etc.
[18:36:12] *** Quits: tjc (tjc@6902864.17C2F9C.163DC5C6.IP) (Quit: zzzzzzzzzz)
[18:36:17] <cmr> graydon: Well the idea is that bors stops when master turns red, automatically
[18:36:40] *** Quits: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk) (Connection reset by peer)
[18:37:02] *** Joins: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk)
[18:37:03] <nmatsakis> bblum: it has no soundness purpose, the idea was that if you copied a mutable variable, and then changed the mutable variable in the containing environment, it might surprise people.
[18:37:10] <brson> i would like to see how this new set up works. we have not even tried it for one day yet
[18:37:10] <nmatsakis> bblum: similar to how Java requires that only final variables be captured
[18:37:24] <nmatsakis> bblum: unclear if this is a good rule though
[18:37:24] <bblum> nmatsakis: ah, i see
[18:37:30] <brson> as long as the commit rate reaches a steady state and doesn't fall infinitely behind we will get by
[18:37:33] <graydon> yeah, I'd like to see how the backlog fares and whether we can just get cycle time low enough to not make a big issue of it
[18:37:48] *** Joins: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP)
[18:37:48] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/-ocdZg
[18:37:48] *** Parts: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP) ()
[18:37:51] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[18:37:51] <sully> hm, weird; I am trying to clean up the build directory pollution, and when I run make check-stage1-rustpkg, it seems to hang...
[18:37:51] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/7KmnAA
[18:37:51] <ghrust> 13rust/06auto 144efb17f 15Young-il Choi: mk: tests.mk simplify the method to clean arm testing directory
[18:37:51] <ghrust> 13rust/06auto 149e618cf 15Young-il Choi: etc: modify adb_run_wrapper.sh to avoid 'expr' unrecognization at some android devices
[18:37:51] <ghrust> 13rust/06auto 14f7ee7d0 15Young-il Choi: etc: add TEST_EXEC_ENV for run-pass to adb_run_wrapper.sh
[18:37:53] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[18:38:12] <nmatsakis> doener: you mean in trans?
[18:38:17] <bstrie> graydon: I still think a "minor" branch would be a good idea, I always feel bad when I r+ .vimrc changes...
[18:38:29] <bstrie> and now I'll feel 4x as bad
[18:38:38] <doener> nmatsakis: yes. Apparently it's already in args when trans_method_call is invoked
[18:38:39] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[18:38:42] <Blei> doener: trans::meth::trans_self_arg?
[18:38:52] <brson> we can also throw more hardware at it
[18:38:52] <Eridius> now that bors is open again, can I get a new r+ on https://github.com/mozilla/rust/pull/7210 since I had strcat pull his?
[18:39:07] <nmatsakis> doener: erickt was doing laudable work to kind of normalize the treatment of self, but I think it's not progressed recently, unfortunately.
[18:39:13] *** Joins: igl1 (igl@moz-A1A13B61.adsl.alicedsl.de)
[18:39:15] <graydon> part of the difficulty is that the way bors operates, if it sees "broken" then it assumes that it was "not broken" one-step-previously, and blames the cset it's trying to integrate
[18:39:27] <graydon> which means if the tree-itself is ever intrinsically broken
[18:39:33] <graydon> it blames _everything_ in its queue
[18:39:44] <nmatsakis> graydon: it is not clear to me that this is bad, though it could be labeled more accurately
[18:40:00] *** Quits: igl (igl@moz-7FB18263.adsl.alicedsl.de) (Ping timeout)
[18:40:03] <nmatsakis> graydon: I guess it could just stop processing the queue, is what you mean?
[18:40:05] <graydon> purging the queue and marking everything queued up as bad is bad behavior
[18:40:13] <graydon> it would have to inhibit its operation when there's breakage, yeah
[18:40:15] <nmatsakis> ok, I thought you meant it should land things anyhow
[18:40:17] <graydon> which is the plan others outlined here
[18:40:25] <graydon> so that would be a change to the way it works
[18:40:42] <graydon> let's call that plan B and see if we can get it going ok without that change
[18:41:38] <cmr> The current stack of approved PRs is going to take ~40-45 hours to process
[18:42:21] *** Quits: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP) (Ping timeout)
[18:42:32] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[18:42:50] <sully> and check-stage2-rustpkg... fails
[18:42:51] <sully> hm.
[18:43:06] <bblum> i,i control flow graph disable optimize
[18:43:06] <bstrie> the other problem is that even if the rate of pull requests levels out, that's not necessarily a sign that you're cycling fast enough. a project with tons of PRs gives off an air of neglect and makes people not want to bother contributing
[18:43:30] <doener> Blei: ah, yeah, via the closure passed to trans_call_inner. 
[18:43:41] <doener> Blei: thanks, wouldn't have looked there at all
[18:44:01] <graydon> cmr: yes. this to me is an argument (like so many recent concerns) for us to focus on cycle time and codegen, not disable the robot further
[18:44:02] <Blei> doener: i found it by accident the other day
[18:44:32] <graydon> cmr: it is imo completely unreasonable that an all-opt build on a modern i7 machine would take 2h. 
[18:44:38] <graydon> yet it does
[18:44:39] *** Joins: ksev (DrunkenPan@745B767B.989A61DC.CA5B6332.IP)
[18:44:45] <cmr> yeah
[18:44:55] *** Joins: roo (Mibbit@moz-69544D4C.dynamic.ip.windstream.net)
[18:45:03] <graydon> the all-opt (that is: cross) build is running slower than -valgrind-
[18:45:08] <graydon> that suggests to me that it's paging or something
[18:45:38] <bblum> wow, there sure are a thousand times more @fn()s used in librustc than anywhere else
[18:45:42] *** Quits: IRCMonkey56359 (heftig@moz-1D217FC8.dip0.t-ipconnect.de) (Ping timeout)
[18:45:43] <cmr> on the plus side
[18:45:45] <cmr> http://huonw.github.io/isrustfastyet/
[18:46:00] <cmr> the snapshot is a nice win, compile time wise
[18:46:05] <doener> yay
[18:46:27] <graydon> good
[18:46:35] *** Joins: IRCMonkey56359 (heftig@moz-1D217FC8.dip0.t-ipconnect.de)
[18:46:40] <graydon> also possibly worth noting: the mac3 slave was the slowest in that cycle
[18:46:51] <graydon> and it's currently permitted to run ... either 4 or 8 jobs concurrently
[18:46:53] <cmr> graydon: I think reviewers should prioritize (p=100 or whatever) performance/trans PRs
[18:46:57] <graydon> which may explain why it was paging
[18:47:03] <graydon> cmr: I agree
[18:47:15] *** Joins: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP)
[18:48:37] <graydon> I have just lowered the max number of concurrent jobs on those slaves
[18:48:38] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[18:49:00] <graydon> this may cause breakage if the jobs move to lightly-used slaves that haven't been updated in a while
[18:49:00] <brson> graydon: somebody was mentioning last night that the mac bots were not being load balanced properly - one of the machines was doing all the builds
[18:49:18] <graydon> brson: currently all build assignments are done sequentially up to the max load, yes
[18:49:42] <graydon> brson: that is intentional. I did it for reproducibility and to keep builds on owned hardware before going to ec2
[18:49:54] <graydon> I can change that, though. and bring on more ec2 bots.
[18:49:57] *** Quits: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP) (Ping timeout)
[18:49:59] <graydon> at least for the non-mac builds
[18:50:33] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[18:50:41] <brson> graydon: how would you feel about adding more minis?
[18:50:49] <graydon> brson: thrilled
[18:50:52] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[18:50:56] <brson> ok, I'll order some
[18:51:05] <graydon> 2 more should do, I think?
[18:51:19] <brson> yeah
[18:51:29] * bblum find lib* | grep rs$ | xargs sed -i 's/@fn(/@fn:'"'"'static(/g'
[18:51:31] <bblum> delicious sed.
[18:51:41] <bblum> i especially like the '"'"'
[18:52:07] *** bent is now known as bent|lunch
[18:52:13] <doener> nmatsakis: regarding your nit on the function call IR improvement, do you think it's ok to keep that match for now, instead of using datum.to_value_llval? I have no clue why the boolean special case causes a build failure there.
[18:52:42] <bstrie> brson: scratch that, get one of these instead: https://www.apple.com/mac-pro/
[18:52:55] <cmr> graydon: I'm just about done setting up a script that will compare a PR I tell it to to master and comment with a benchmark of librustc copmiling
[18:53:10] <cmr> automagically instead of me doing it all :p
[18:53:14] <graydon> neat
[18:54:22] <doener> cmr: that would be awesome. I really appreciate that you uncovered the non-gain in my PR earlier today. Having that done automatically would be great
[18:54:39] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[18:55:02] <cmr> yeah. it's really nonsensical to be doing compiler work without regular, comprehensive benchmarks. that's what I want to work towards.
[18:55:19] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[18:56:24] <cmr> bstrie: that actually looks *really*, *really* nice. nice enough that I want one, and I've always built my own boxes.
[18:56:32] <graydon> brson: I can also bring mac1 and mac2 back into the cluster
[18:56:54] <graydon> they are 2.4ghz core 2 duos with 8gb
[18:56:58] <graydon> mountain lion I think
[18:57:00] <graydon> er
[18:57:04] <graydon> no, snow leopard
[18:57:05] <graydon> old
[18:57:08] *** Joins: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP)
[18:57:10] <graydon> I get the cat names confused
[18:57:21] *** Joins: tikue (tkuehn@2557E599.66715431.D25A875A.IP)
[18:57:57] <nmatsakis> doener: wait, what build failure?
[18:57:58] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[18:58:22] <graydon> what's our memory peak on a mac presently?
[18:58:25] <doener> nmatsakis: see my reply here https://github.com/mozilla/rust/pull/7237
[18:58:29] <graydon> is it enough that I should take the mins down to 1 build per?
[18:58:51] <Jeaye> I thought the memory peak was about 2.5GB
[18:59:13] <graydon> yeah. so that ought to be ok doing 2 builds on an 8gb machine
[18:59:22] <brson> graydon: yeah, we can try. those bots were pretty slow but it might be better than overloading the two fast ones. maybe assign them the single-target builds
[18:59:24] <cmr> It should be back down to ~1.5GB
[18:59:25] <graydon> but not 4, and certainly not 8
[18:59:30] <nmatsakis> doener: egads. Yes, you can keep it how it is, I can imagine the kind of failrue that's occurring
[18:59:51] <nmatsakis> doener: right now the treatment of unreachable code in trans is quite "dutch-boy-sticking-finger-in-a-dyke-esque"
[18:59:53] <brson> the new minis will have 16GB
[19:00:04] <graydon> and 8 cores?
[19:00:11] <doener> nmatsakis: heh :-)
[19:00:18] <nmatsakis> er, dike.
[19:00:25] <rpearl> different
[19:00:35] <brson> graydon: no, only 4
[19:00:38] <graydon> 4 core / 8ht I guess
[19:00:41] <graydon> right-o
[19:00:56] <cmr> Is there any way with ghi to list *only* pull requests?
[19:01:21] *** Quits: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP) (Ping timeout)
[19:01:42] <graydon> probably not, but it's pretty easy to script github with non-ghi tools
[19:01:55] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[19:01:57] <cmr> yeah but it'd be convenient to just do ghi list --pulls :p
[19:02:25] <bstrie> cmr: you'll have to submit a pull request to ghi... but they'll never be able to see it!
[19:02:58] <graydon> I'm most fond of https://github.com/michaelliao/githubpy
[19:03:05] <graydon> that's the one bors uses
[19:03:16] <cmr> graydon: nice, I'll definitely use that
[19:03:21] <cmr> better than just using requests
[19:03:32] *** Quits: eschweic (Adium@2557E599.66715431.D25A875A.IP) (Quit: Leaving.)
[19:03:39] <cmr> single file modules <3
[19:03:46] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[19:03:53] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[19:03:57] <graydon> I think I fiddled it a little bit to make it do something a little different in the authentication phase and didn't send a PR back. sec.
[19:04:16] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[19:04:55] <graydon> ah right
[19:05:02] <graydon> timeouts and support for PATCH
[19:05:24] * pcwalton is doing an extreme amount of metadata yak shaving
[19:05:31] <pcwalton> current task: killing get_impls_for_mod
[19:06:28] <nmatsakis> woohoo! irrefutable patterns branch passes test and builds rustc 
[19:06:36] * graydon sends PR
[19:06:36] <pcwalton> \o/
[19:06:42] <graydon> yay nmatsakis
[19:06:53] <nmatsakis> now I just have to clean it up a bit :)
[19:06:56] <pcwalton> any improvement in cycle time?
[19:07:06] <pcwalton> sometimes trans improvements do that
[19:07:13] <nmatsakis> I don't know, haven't measured.
[19:08:05] <cmr> I will measure for you if you push the branch :)
[19:08:18] <graydon> cmr: https://github.com/michaelliao/githubpy/pull/3 if you want to grab the minor changes I made
[19:08:21] <pcwalton> this is mostly to fix known segfaults, right?
[19:08:24] <nmatsakis> cmr: will do, I'm more afraid it might slow things down...
[19:08:35] <cmr> graydon: ok, thanks
[19:08:40] <nmatsakis> pcwalton: yes, but also it makes things like "let (ref x, ref y) = ..." work
[19:08:45] *** Joins: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP)
[19:08:46] <pcwalton> right
[19:08:47] <pcwalton> cool
[19:08:48] <nmatsakis> pcwalton: or |&(ref x, ref y)| and so forth
[19:09:17] *** Quits: Jesin (Jessin_@moz-157A63DD.cc.lehigh.edu) (Ping timeout)
[19:09:26] <graydon> one point worth mentioning
[19:09:33] <graydon> currently we do 'make clean' before make on the auto branch
[19:09:42] <graydon> because dependencies yuk yuk
[19:09:49] <graydon> we do not need to do that, though
[19:09:55] <nmatsakis> cmr: it's ref-bindings-in-irret-patterns in nikomatsakis repo
[19:10:09] <cmr> nmatsakis: ok.
[19:10:10] <graydon> in which case it is possible that the minor changes that concern people (eg. change-one-test, change-one-line-in-docs) can cycle faster
[19:10:14] *** Quits: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP) (Ping timeout)
[19:10:18] <cmr> nmatsakis: is it rebased against current master?
[19:10:27] <nmatsakis> cmr: not 100%, let me do that
[19:10:42] <nmatsakis> cmr: I rebased it this morning but there may have been commits since then
[19:10:52] *** Joins: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP)
[19:11:01] <nmatsakis> cmr: ok, rebased, hopefully it still builds :)
[19:14:15] *** Quits: lkuper (lkuper@66AE1C4.B4544612.EA8B5958.IP) (Ping timeout)
[19:15:07] *** Quits: ksev (DrunkenPan@745B767B.989A61DC.CA5B6332.IP) (Ping timeout)
[19:15:08] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Ping timeout)
[19:16:56] <graydon> huh. I wonder why bors is reporting changes as discussing when they're actually stale
[19:17:25] <Blei> btw. what's the definition of stale?
[19:17:35] <cmr> Blei: can't be merged
[19:17:38] <cmr> ie, conflicts
[19:17:42] <Blei> oh
[19:17:53] <Blei> brb, rebasing
[19:18:04] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[19:18:22] *** Quits: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP) (Ping timeout)
[19:19:00] <doener> graydon: how often does it update the state?
[19:19:11] <graydon> every 3 minutes
[19:21:51] * pcwalton sighs, andrei bashing rust on reddit again
[19:22:25] <SiegeLord> D makes you so productive, you can bash other languages with the saved time!
[19:22:31] <doener> pcwalton: in the comments on the phoronix article?
[19:22:35] <pcwalton> yeah
[19:25:18] <pcwalton> I replied, hopefully not too rude http://www.reddit.com/r/programming/comments/1gpyor/phoronix_d_language_still_showing_promise/camv686
[19:25:39] <brson> we should invite him to give a research talk
[19:27:07] <doener> pcwalton: if my memory serves me well, that's even more polite than your replies in the previous discussion (not to say that they were necessarily impolite)
[19:30:04] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Quit: eatkinson)
[19:30:07] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[19:30:24] <cmr> "I do plan on trying out the language in a real project once 1.0 is released. Until then, I don't have an opioinion on Rust." A good position, but also slightly ominous
[19:30:27] <cmr> Better get 1.0 right :)
[19:30:49] * pcwalton shrugs, it's a reasonable position
[19:30:56] <bstrie> cmr: or just asymptotically approach 1.0
[19:30:57] *** bent|lunch is now known as bent
[19:30:59] <pcwalton> people will get annoyed with stuff when 1.0 is released
[19:31:01] <cmr> heh
[19:31:13] <pcwalton> it's unavoidabler
[19:31:21] *** Quits: flu_ (flu@1B44C715.B5AB1363.2E11A1C0.IP) (Ping timeout)
[19:31:21] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[19:31:23] <pcwalton> the best we can do is to try to fix as much of the pain as we can :)
[19:31:23] <bstrie> version 0.9, version 0.9 and a half, version 0.9 and three quarters...
[19:31:41] <SiegeLord> It's slightly dangerous... if you're really looking into an alternative, it pays to try to influence it while it's pre-1.0
[19:31:43] <pcwalton> in particular we should go through all the annoying error messages
[19:31:53] *** Joins: lkuper (lkuper@3F3D6782.FFCF2A3B.51B6877.IP)
[19:31:58] <bstrie> pcwalton: do you think that you can get DST, closure reform, and GC-in-a-library done by 0.8? you'll really be pushing it otherwise...
[19:32:15] <cmr> bstrie: pushing what?
[19:32:19] <bstrie> the release date
[19:32:31] <cmr> When is the 1.0 release date tentatively planned for?
[19:32:32] <bstrie> which is ostensibly 11:59 on dec 31
[19:32:40] <cmr> When I asked graydon he said "when it's ready"
[19:32:50] <pcwalton> bstrie: I think so, yes. I mean, it's not a hard and fast date
[19:32:56] <bstrie> ok
[19:33:13] <graydon> we decided that we did not have enough insight into the bug database to be sure
[19:33:26] <graydon> so we started a structured weekly triage system whereby we are sorting them into maturity levels
[19:33:29] <bstrie> I'd much rather release when it's done then rush things out, but I understand you have pressure to start getting this into production :)
[19:33:36] *** Joins: eschweic (Adium@2557E599.66715431.D25A875A.IP)
[19:33:51] <graydon> "this bug not-being-fixed means we'll be breaking backwards compatibility" being the most-significant milestone in many of our minds, I think
[19:33:52] <cmr> I'd much rather see a solid 1.0 than a half-assed 1.0 that's going to be a major pain point.
[19:33:59] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[19:34:10] <bstrie> right, a half-assed 1.0 will kill the language
[19:34:17] <cmr> even if it's 6 months plus later..
[19:34:20] *** Quits: bytbox (s@moz-D83E9B31.wireless.umd.edu) (Ping timeout)
[19:34:29] <graydon> I expect 1.0 will be at-or-around that milestone closing out. but it might be after. I doubt it'd be before, since 1.0 is a future promise in the semantic-versioning sense
[19:34:31] <bstrie> aiui a half-assed stdlib basically killed D 1.0
[19:34:40] *** Joins: flu_ (flu@1B44C715.B5AB1363.2E11A1C0.IP)
[19:35:28] <cmr> graydon: Will 1.0 also imply ABI stability?
[19:35:30] <graydon> I would encourage everyone interested in this topic to look over https://github.com/mozilla/rust/issues/milestones and, if you have time, try participating in triage and nomination (if you like I can add you to the weekly triage-helpers list)
[19:35:35] <graydon> cmr: I do not think so
[19:35:36] *** Quits: seth (seth@moz-D840E602.dsl.static.sonic.net) (Input/output error)
[19:35:43] <cmr> graydon: I'd like to be added to that list
[19:35:50] <cmr> I've been following the traige for a few weeks now
[19:35:55] <graydon> sure
[19:36:03] <SiegeLord> D1 was killed by Andrei and nothing else in particular
[19:36:14] <pcwalton> well, Go 1.0 was pretty embarrassing in its runtime
[19:36:25] <pcwalton> (no offense to them. our runtime is embarrassing)
[19:36:31] <pcwalton> but its standard library was quite good and the tooling was too
[19:36:33] <cmr> SiegeLord: did my reply on the ML statisfactorily answer your questions?
[19:36:40] <pcwalton> but it still took off
[19:36:51] <hoelzro> I'm trying to write bindings for ptrace on Linux; for now I'm going to write the enum values by hand, but for future reference, what's the best way to handle #defines/enums/etc in C header flies?
[19:37:00] <cmr> hoelzro: rust-bindgen
[19:37:06] <hoelzro> cmr: thank you
[19:37:10] <SiegeLord> cmr: Not really, I'm waiting for more comments first
[19:37:14] <Blei> hoelzro: mind, defines don't work
[19:37:16] <cmr> hoelzro: it doesn't do #defines well though
[19:37:24] <hoelzro> I see
[19:37:26] <bstrie> pcwalton: poor speed is excusable at 1.0 in a language not aimed at systems programmers. bad apis aren't ever excusable :)
[19:37:33] <Blei> but the rest works quite well
[19:37:38] <Blei> even unions
[19:37:57] <SiegeLord> I don't even know how the first step will work, as an .rs file is not the unit of compillation unless its a crate
[19:38:22] <nmatsakis> is bors alive?
[19:38:26] <cmr> SiegeLord: all it does is parse, it doesn't need any semantics
[19:38:33] <cmr> nmatsakis: yes
[19:38:38] *** Quits: nano (nano@moz-972880B.superkabel.de) (Connection reset by peer)
[19:38:49] <bstrie> nmatsakis: yes, but unless you do p=100 you'll be waiting two days to land anything
[19:38:55] <SiegeLord> cmr: You need some semantics for references, no?
[19:39:08] * nmatsakis contemplates abusing his powers
[19:39:09] <cmr> SiegeLord: what do you mean by references?
[19:39:21] *** Quits: BitPuffin (quassel@moz-53415F0F.cust.tele2.se) (Connection reset by peer)
[19:39:33] <bstrie> nmatsakis: the go-ahead has been given to freely p=100 anything that improves cycle time
[19:39:33] <SiegeLord> Well, you have foo(a : Foo). I'd like a link going from Foo to its definition
[19:39:39] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[19:39:43] *** Quits: eschweic (Adium@2557E599.66715431.D25A875A.IP) (Ping timeout)
[19:39:57] <cmr> SiegeLord: that would happen in the last stage
[19:40:10] <SiegeLord> But how would it know without doing some semantic analysis?
[19:40:22] <SiegeLord> You need to resolve the symbol at least
[19:40:26] *** Joins: Guest_ (textual@moz-EFF068BB.dyn.mit.edu)
[19:40:33] <nmatsakis> bstrie: I can't say whether my patch does that or not, I wouldn't necessarily expect it too
[19:40:34] *** Joins: BitPuffin (quassel@moz-85111813.cust.tele2.se)
[19:40:38] <graydon> cmr: you might not be waiting that long; it's quite possible that by reducing the per-builder load, the next cycle after this will improve in speed
[19:40:47] <nmatsakis> bblum: is it the case that stage0 cannot parse fn:Owned right now?
[19:40:52] <graydon> cmr: they were all running on one machine, that's OK CPU-wise but not memory-wise
[19:41:12] <graydon> I brought it down to 2 builds per machine, which means the next cycle will spread out more
[19:41:22] <graydon> (assuming it doesn't fail. if it does, please let me know so I can turn off bors!)
[19:41:37] <cmr> SiegeLord: you're right, I didn't consider all the complexities of name resolution
[19:41:48] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[19:41:53] <nmatsakis> graydon: what are the two builds that are done in parallel?
[19:41:56] <cmr> SiegeLord: I still think that quite a lot can be accomplished without dealing with the entire crate as a unit though
[19:42:17] *** Quits: jviereck (Adium@moz-93A5D87E.ethz.ch) (Quit: Leaving.)
[19:42:32] <graydon> nmatsakis: see the variety of builds on auto now?
[19:42:35] <cmr> SiegeLord: I'm not sure how possible it is to hook into resolve though... will need to research more.
[19:42:40] <nmatsakis> graydon: oh, I see, those are not done serially.
[19:42:47] <cmr> SiegeLord: I'll add that to the feature list, it's important that the architecture not squelch that
[19:42:48] <bblum> nmatsakis: no, your change to do that got in before the snapshot
[19:42:50] <graydon> {32,64}-{opt,no-opt} as well as a cross and a valgrind variant
[19:42:57] <bblum> however stage0 cannot parse [~@&]Trait:Owned
[19:43:20] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[19:43:28] <nmatsakis> bblum: sure, but we could probably remove the implicit ~fn bounds
[19:43:37] <nmatsakis> bblum: though I'm not sure if it matters, given that plan is to remove
[19:43:45] <bblum> nmatsakis: yes, i just made a commit this morning to do it
[19:43:48] <cmr> SiegeLord: does "every symbol should be able to be linked to its documentation (eg, types, methods, functions)" summarize it accurately?
[19:43:55] <nmatsakis> bblum: ah, ok, cool.
[19:44:07] <SiegeLord> cmr: Sure
[19:44:08] <bblum> nmatsakis: i have a design question about it, btw, which is still relevant when they turn into traits
[19:44:14] <pcwalton> holy cow, libextra finally bootstrapped
[19:44:22] <pcwalton> with each_path rewritten and get_impls_for_mod removed
[19:44:29] <cmr> SiegeLord: (I really need feedback, I'm no expert)
[19:44:53] <nmatsakis> bblum: ok
[19:45:05] <SiegeLord> cmr: The only real problem I personally have is this text "Implementation of Foo for Bar where <useless stuff>"
[19:45:23] <SiegeLord> But I guess that's a backend thing
[19:45:25] <cmr> SiegeLord: Why are the trait bounds useless?
[19:45:26] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[19:45:41] <cmr> They're pretty necessary to understand it
[19:45:43] <SiegeLord> It's the wording that's horrible
[19:46:00] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[19:46:07] <SiegeLord> It creates an alternate syntax for the impl which is harder to understand
[19:46:17] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[19:46:40] <SiegeLord> It probably made sence when the only thing after "where" was T : Trait
[19:46:43] <SiegeLord> *sense
[19:47:01] <SiegeLord> But now it's (often) "where <'self>"
[19:47:13] <SiegeLord> How do you even read that sentence
[19:47:17] <cmr> ah, yeah
[19:47:48] *** Joins: ezkl (ezkl@moz-6733ED12.zoominternet.net)
[19:47:55] *** Quits: lkuper (lkuper@3F3D6782.FFCF2A3B.51B6877.IP) (Ping timeout)
[19:48:21] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[19:48:26] *** Joins: eschweic (Adium@2557E599.66715431.D25A875A.IP)
[19:48:27] <SiegeLord> Actually probably changing where to given would placate me... it's not a big deal I think :P
[19:48:46] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[19:48:55] *** Quits: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl) (Quit: Leaving)
[19:49:10] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[19:51:02] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[19:52:29] <pcwalton> oh great
[19:52:35] <pcwalton> now that we handle reexports properly I get paths like
[19:52:35] <pcwalton> syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax
[19:52:35] <pcwalton> ::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::build::syntax::ext::quote::rt::keywords::Priv
[19:52:46] <doener> woha
[19:52:57] <cmr> that can't be healthy
[19:54:16] *** Joins: brendan (brendaneic@moz-81D85F1B.public.wayport.net)
[19:55:47] *** Joins: bytbox (s@moz-D83E9B31.wireless.umd.edu)
[19:58:45] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[19:59:18] *** Quits: brendan (brendaneic@moz-81D85F1B.public.wayport.net) (Quit: brendan)
[19:59:45] *** Joins: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com)
[19:59:47] *** Parts: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com) ()
[20:00:07] <bblum> pcwalton: i remember that from last summer
[20:01:04] <graydon> whoops
[20:01:25] <graydon> pcwalton: you are removing each_path? :)))
[20:02:55] <hoelzro> ugh
[20:03:02] *** Quits: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com) (Ping timeout)
[20:03:08] <hoelzro> retraining myself to do name: type instead of type name is tough.
[20:03:33] <cmr> hoelzro: my biggest problem (coming mainly from python) is always forgetting return type :p
[20:03:47] <cmr> since it's at the end, easy to forget...
[20:03:51] <hoelzro> =)
[20:04:20] <doener> I usually mess that one when "self" is involved
[20:04:37] <doener> having one thing without a type annonation confuses my fingers
[20:05:02] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[20:05:09] <doener> s/mess that one/mess that up/
[20:05:10] <Blei> also *int vs int*
[20:05:16] <Blei> only happens with raw pointers though
[20:05:49] <cmr> Blei: well the only correct style is type *name, so that hasn't been a problem for me :p
[20:06:41] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Ping timeout)
[20:08:25] *** Joins: ksev (DrunkenPan@745B767B.989A61DC.CA5B6332.IP)
[20:10:33] *** Quits: sw17ch (sw17ch@moz-DA3743.hfc.comcastbusiness.net) (Quit: sw17ch)
[20:12:20] <hoelzro> is there a way to tell rustc to try unassigned return values as an error?
[20:12:39] <cmr> hoelzro: what do you mean?
[20:12:44] <hoelzro> ex.
[20:13:03] <hoelzro> if I have fn myfunc() -> Result<int, int>
[20:13:06] <hoelzro> to indicate error
[20:13:12] <hoelzro> and I just call myfunc()
[20:13:17] <hoelzro> I could be silently suppressing an error
[20:13:22] <cmr> Ah
[20:13:27] <Eridius> you'd also be silently suppressing the return value
[20:13:56] <cmr> hoelzro: I don't think so, but that'd probably be a nice lint pass to have
[20:14:18] <hoelzro> Eridius: true
[20:14:27] <hoelzro> ok, bad example; let's say it returns a boolean
[20:14:30] <Eridius> now I'm envisioning some sort of CheckedResult type with a Drop trait that asserts that you actually checked if it was an error
[20:14:50] <Eridius> (using maybe a @mut field or something)
[20:14:54] <hoelzro> interesting
[20:15:11] <Eridius> but I don't know if that would really be very useful, and it would be a runtime check instead of a compile-time one
[20:15:29] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[20:15:54] <bstrie> hoelzro: a lint pass would be good for that
[20:16:40] <Blei> hoelzro: https://github.com/mozilla/rust/issues/2974
[20:17:24] <Sodel_the_V> nmatsakis: FIY, I'm renaming the branch on my end to 5762-dev. It's a bit disingenuous for it to be named after me. :P (I guess I'm now bikeshedding branch names!)
[20:17:53] <nmatsakis> Sodel_the_V: I was going to say, I may adopt your branch a bit. I still have to think over best fix to this problem I encountered. 
[20:18:39] <Sodel_the_V> nmatsakis: No worries. I saw your post on technical debt, and there's a lot of cruft to work around.
[20:18:40] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Quit: eatkinson)
[20:19:14] <cmr> Sodel_the_V: that was on aatch's blog. unless you mean a different post
[20:19:28] <Sodel_the_V> cmr, nmatsakis: Derp
[20:19:46] *** Quits: ezkl (ezkl@moz-6733ED12.zoominternet.net) (Ping timeout)
[20:19:47] <Sodel_the_V> The uniform site themes really do a number on me. :P
[20:19:57] <cmr> heh
[20:19:59] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[20:20:50] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: WeeChat 0.4.1)
[20:21:10] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[20:21:27] *** Joins: dylukes (dylukes@moz-E4DF3FED.pitbpa.fios.verizon.net)
[20:21:35] *** Quits: tikue (tkuehn@2557E599.66715431.D25A875A.IP) (Quit: tikue)
[20:21:45] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[20:21:57] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[20:26:22] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[20:29:48] *** Joins: seth (seth@moz-BE33DA21.fw1.sfo1.mozilla.net)
[20:30:21] <jedestep> I heard talk about some reexporting woes earlier. reexports were not working?
[20:30:24] *** Joins: SiegeLord (siege@moz-CAF07B4C.hsd1.ma.comcast.net)
[20:30:52] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[20:31:18] *** Quits: azita (Azita@2557E599.66715431.D25A875A.IP) (Ping timeout)
[20:31:31] *** Quits: cdidd (cdidd@moz-B9F3D175.broadband.corbina.ru) (Ping timeout)
[20:31:54] *** Joins: cdidd (cdidd@moz-A994150B.broadband.corbina.ru)
[20:32:13] *** Joins: lkuper (lkuper@F7922891.D3FA0837.51B6877.IP)
[20:34:09] <hoelzro> I'm trying to pass in a struct to a C routine, but &registers as *libc::c_void isn't working
[20:34:20] <hoelzro> I get the following error: mismatched types: expected `*core::libc::types::common::c95::c_void` but found `&ptrace::user_regs`
[20:34:32] <cmr> hoelzro: there's no implicit conversion
[20:34:45] <cmr> hoelzro: do a std::cast::transmute
[20:34:56] <hoelzro> hmm
[20:35:01] <hoelzro> why doesn't as work here?
[20:35:33] <cmr> as is only for numerics and trait objects afaik
[20:35:40] <cmr> there's a proposal to extend it
[20:35:43] <hoelzro> ohhh
[20:35:44] <hoelzro> I see
[20:35:48] <hoelzro> thanks for the tip
[20:35:50] <cmr> https://github.com/mozilla/rust/issues/7080
[20:36:21] <kimundi> hoelzro: It basically only exists as an operator for constexpr.
[20:36:26] <hoelzro> I see
[20:36:28] <Blei> i thought it worked for casting pointers
[20:36:46] <cmr> rusti: &5 as *()
[20:36:46] <kimundi> Blei: But not pointer and type
[20:36:47] -rusti- <anon>:10:9: 10:11 error: mismatched types: expected `*()` but found `&<VI0>` (expected () but found integral variable)
[20:36:47] -rusti- <anon>:10          &5 as *()
[20:36:47] -rusti-                    ^~
[20:36:47] -rusti- error: aborting due to previous error
[20:36:47] -rusti- application terminated with error code 101
[20:37:02] <kimundi> rusti: &5 as *int
[20:37:03] -rusti- 36687776
[20:37:20] *** Quits: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP) (Ping timeout)
[20:37:39] <kimundi> so, &T -> *T works, but not &T -> *U
[20:37:48] <Blei> ah, i see
[20:37:51] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[20:38:33] <Blei> hmm, not quite
[20:38:37] <Blei> rusti: let a: *int = std::ptr::null(); let b = a as *float; b
[20:38:37] -rusti- 0
[20:38:53] <Blei> (&5 as *int) as *float
[20:39:02] <Blei> rusti: (&5 as *int) as *float
[20:39:03] -rusti- 24022944
[20:39:12] <cmr> rusti: *((&5 as *int) as *float)
[20:39:13] -rusti- <anon>:10:9: 11:5 error: dereference of unsafe pointer requires unsafe function or block
[20:39:13] -rusti- <anon>:10          *((&5 as *int) as *float)
[20:39:13] -rusti- <anon>:11     }; // to make line comments work
[20:39:13] -rusti- error: aborting due to previous error
[20:39:13] -rusti- application terminated with error code 101
[20:39:22] <cmr> Ah, that's why it's not unsafe
[20:39:35] <cmr> I think casting to unsafe pointer should be unsafe.
[20:39:45] <Blei> why?
[20:40:03] <cmr> rusti: (&5 as *int) as &int
[20:40:04] -rusti- <anon>:10:9: 10:29 error: non-scalar cast: `*int` as `&int`
[20:40:04] -rusti- <anon>:10          (&5 as *int) as &int
[20:40:05] -rusti-                    ^~~~~~~~~~~~~~~~~~~~
[20:40:05] -rusti- error: aborting due to previous error
[20:40:05] -rusti- application terminated with error code 101
[20:40:07] <cmr> hm
[20:40:10] <cmr> maybe not
[20:40:22] <strcat> cmr: * isn't different than uint
[20:40:24] <cmr> The usage will always be unsafe, so actually creating it isn't really a problem
[20:40:36] <strcat> you can convert either * or uint to & or use them to unsafely access memory
[20:40:38] <strcat> unsafe array indexing
[20:41:27] *** Joins: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP)
[20:42:18] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Quit: Textual IRC Client: www.textualapp.com)
[20:42:24] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[20:42:33] <hoelzro> what's the syntax for destructuring a struct, again?
[20:42:49] <hoelzro> UserRegs { orig_rax: value, ... } => ...?
[20:42:59] <hoelzro> (assuming I only care about the orig_rax field)
[20:43:02] <ecr> I think that's right
[20:43:05] <doener> , *
[20:43:11] <doener> i.e. * instead of ...
[20:43:52] <hoelzro> ah
[20:43:59] <hoelzro> no dice =/
[20:44:04] *** Quits: RMF (RMF@moz-8C13D5A2.dsl.telepac.pt) (Client exited)
[20:44:10] <hoelzro> UserRegs { orig_rax: 59, * } is what I have now
[20:44:17] <bblum> _ not *
[20:44:24] <doener> was it * for enums?
[20:44:28] <hoelzro> that was my next guess =)
[20:44:33] <bblum> i think * is only for enums
[20:44:40] *** Joins: azita (Azita@2557E599.66715431.D25A875A.IP)
[20:44:44] <doener> ok, so i confused those
[20:44:47] <bblum> variant_with_many_fields(*)
[20:44:57] <cmr> I don't think so
[20:45:02] <bblum> so you don't have to variant_with_many_fields(_, _, _, _, _, _)
[20:45:11] <hoelzro> hmm
[20:45:17] <bblum> i think * in structs would be more principled
[20:45:20] <hoelzro> what if it's a Some(~UserRegs)?
[20:45:20] <cmr> rusti: let x = Some(5u); match x { Some(*) => 1, None => 2}
[20:45:21] -rusti- 1
[20:45:24] <cmr> or amybe yes
[20:45:32] <cmr> I feel like I remember that not working...
[20:45:37] <hoelzro> Some(UserRegs { orig_rax: 59, _ }) doesn't cut it =/
[20:45:42] *** Joins: RMF (RMF@moz-8C13D5A2.dsl.telepac.pt)
[20:46:40] <strcat> bblum: I have a bug open about it
[20:46:42] <strcat> sec
[20:46:46] <bblum> strcat: oh good
[20:46:53] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[20:47:03] <graydon> ok, sorry everyone, bors was a little confused about the new builders but it did not perturb any of the actual builds to correct, just meant the status wasn't updating
[20:47:08] <graydon> it's fixed now, status should be live / accurate again
[20:47:24] <graydon> (and it did not require restarting any builds)
[20:47:47] <strcat> bblum: https://github.com/mozilla/rust/issues/5830
[20:48:29] *** Quits: eschweic (Adium@2557E599.66715431.D25A875A.IP) (Quit: Leaving.)
[20:48:42] <cmr> graydon: the doc buildbot needs to be updated.
[20:48:44] <cmr> http://buildbot.rust-lang.org/builders/doc/builds/163/steps/compile/logs/stdio
[20:48:59] <cmr> I think...
[20:49:19] <graydon> that's probably going to re-emerge a few times as buildslaves that have been offline for a while come back into service
[20:49:23] <graydon> (with load-spreading)
[20:49:30] <strcat> bblum: in some places _ ignores one field, in others it ignores the rest
[20:49:35] <strcat> and * doesn't work everywhere :s
[20:49:41] *** Joins: pyrac (pyrac@moz-DAB0A516.w109-222.abo.wanadoo.fr)
[20:49:48] <graydon> huh, weird. it was on linux1.
[20:50:03] <graydon> I'll try to reset it
[20:50:21] <strcat> oh no need to rebase my vector pull again
[20:50:23] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[20:50:48] <bblum> strcat: excellent bug
[20:51:17] *** Joins: eschweic (Adium@2557E599.66715431.D25A875A.IP)
[20:51:50] <cmr> strcat: are you surprised? :p
[20:51:53] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[20:51:59] <strcat> graydon: https://github.com/mozilla/rust/pull/7213 r?
[20:52:12] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[20:52:27] <strcat> oh wait
[20:52:36] *** Joins: eschweic1 (Adium@2557E599.66715431.D25A875A.IP)
[20:52:45] <strcat> huh, why isn't it mergeable
[20:52:58] *** Quits: eschweic (Adium@2557E599.66715431.D25A875A.IP) (Connection reset by peer)
[20:53:01] <strcat> % git pull --rebase https://github.com/mozilla/rust.git
[20:53:02] <strcat> From https://github.com/mozilla/rust
[20:53:04] <strcat>  * branch            HEAD       -> FETCH_HEAD
[20:53:06] <strcat> Current branch iterator is up to date.
[20:53:08] <strcat> :\
[20:53:17] * strcat will try re-opening
[20:54:30] <strcat> graydon: https://github.com/mozilla/rust/pull/7263 r? (I broke github, apparently ;p)
[20:54:34] <bblum> didn't we used to have an A-kinds tag
[20:54:49] <bstrie> bblum: there was some tag cleanup a while ago
[20:54:56] <cmr> I love PRs that delete more code than they remove
[20:55:03] <cmr> erm...
[20:55:06] <cmr> remove more than they add
[20:55:09] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[20:55:54] <graydon> strcat: I know .advance() is supposed to be part of the for protocol (someday)
[20:56:00] <graydon> but is .iter().enumerate()? 
[20:56:08] <graydon> seems pretty chatty
[20:56:18] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[20:56:26] <Eridius> maybe make enumerate() a default method of Iterable?
[20:56:30] <cmr> once we have default methods it should just be for foo.enumerate() |i, e| { ... } yeah?
[20:56:34] <graydon> ok
[20:56:39] <graydon> I hope so! :)
[20:56:40] <strcat> cmr: yes, if we figure out how to make Iterable
[20:56:55] *** Quits: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP) (Quit: carllerche)
[20:56:59] <bstrie> foo.enumerate |(i, e)| { ... }
[20:57:00] <graydon> maybe talk to sully about how close we are to getting the necessary support in default methods
[20:57:13] <bstrie> default methods
[20:57:15] <strcat> graydon: there are going to be a lot of method conflicts from default methods on Iterable, like Iterable::map vs Option::map
[20:57:17] *** Quits: hjr3 (hradtke@374E545A.3A8E9B0C.F9D9C60E.IP) (Quit: My MacBook has gone to sleep. ZZZzzz‚Ä¶)
[20:57:20] <graydon> but r+ otherwise. assuming you're willing to go back and rewrite all these when it can be done?
[20:57:22] <bstrie> will feel so good to tie up that loose end
[20:57:27] <strcat> graydon: yep
[20:57:42] <cmr> strcat: that'sa  resolve bug right?
[20:57:51] *** Joins: hjr3 (hradtke@374E545A.3A8E9B0C.F9D9C60E.IP)
[20:57:53] <strcat> graydon: the hard part is the initial migration since it involves borrowck workarounds in places and we have dozens of eachi/map/fold methods ;p
[20:57:57] <bstrie> though I still don't see how default methods would turn `foo.iter().enumerate()` into `foo.enumerate()`
[20:57:59] <strcat> removing .advance would just be a sed
[20:58:14] <strcat> bstrie: because vectors would be Iterable
[20:58:23] <bstrie> why do we need default methods for that?
[20:58:24] <strcat> and Iterable could provide the forward-iteration-based IteratorUtil methods
[20:58:35] <strcat> because in some cases you need to override them
[20:58:41] <bstrie> ok
[20:58:45] <strcat> you don't want 'find' being O(n) on a map
[20:59:07] <bstrie> sounds good :)
[20:59:17] <strcat> or 'len'
[20:59:23] <cmr> strcat: I really like how the iterator work has turned out, it's... pretty much ideal (after the bugs are fixed)
[20:59:41] *** Joins: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com)
[20:59:57] *** Quits: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[21:00:04] <bstrie> strcat: how much unsafe code do iterators use?
[21:00:09] <strcat> bstrie: none
[21:00:13] <bstrie> that's really cool
[21:00:16] <strcat> the vector iterators use unsafe code but they don't have to
[21:00:36] <strcat> they just use it to reduce an add + a sub to 1 add
[21:00:39] <Eridius> is anyone planning on fixing the method resolve bug anytime soon?
[21:00:44] *** Joins: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net)
[21:00:58] <bstrie> I don't think it's on anyone's plate
[21:01:00] <strcat> if slices were (ptr, ptr_to_end), slices could be the iterators ;p
[21:04:05] *** Quits: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net) (Quit: msingle)
[21:04:22] *** Quits: Azdle (Azdle@moz-B334B496.hfc.comcastbusiness.net) (Quit: Leaving)
[21:04:35] <doener> Eridius: which one is that?
[21:05:04] *** Joins: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP)
[21:05:45] *** Quits: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com) (Ping timeout)
[21:06:05] <Eridius> doener: what, the PR? It's the new methods on vec
[21:06:19] <doener> Eridius: the method resolve bug
[21:06:39] <Eridius> oh, it's the one that prevents us from calling .transform .map
[21:06:42] <Eridius> I don't know what the issue is
[21:07:32] *** Joins: tjc (tjc@moz-24060A8E.firstunitarianportland.org)
[21:07:33] *** ChanServ sets mode: +o tjc
[21:08:19] <strcat> and .len_, .position_, .find_, .take_, .chain_ ;p
[21:08:26] <strcat> there are FIXMEs in there
[21:10:09] *** Quits: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[21:10:44] *** Quits: Guest_ (textual@moz-EFF068BB.dyn.mit.edu) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[21:11:32] <doener> 5898 / 3429
[21:12:27] *** Quits: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP) (Ping timeout)
[21:12:44] <engla> the container traits need to be updated for iterators
[21:13:39] <strcat> everything does
[21:13:47] <strcat> I spent hours on updating vec and it's hardly done ;p
[21:13:58] <strcat> mostly waiting for rustc to finish compiling
[21:14:41] <strcat> pretty annoying to make 350 individual 1-line fixes that you need a compile to find
[21:14:54] *** Joins: nzi (Mibbit@85E88890.17E38A0A.259C0349.IP)
[21:15:06] *** Joins: rusty_iron (Mibbit@moz-3D556E4B.amazon.com)
[21:15:09] <Eridius> sure would be nice if rustc could parallelize the compile
[21:15:17] <rusty_iron> Hey all, I have a quick question
[21:15:37] <Eridius> rusty_iron: ok
[21:16:21] *** Joins: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP)
[21:16:33] *** Quits: BitPuffin (quassel@moz-85111813.cust.tele2.se) (Connection reset by peer)
[21:16:55] *** Joins: BitPuffin (quassel@moz-1A23F58.cust.tele2.se)
[21:17:15] <rusty_iron> I've been learning Rust in my free time and one of the things that has come up often is that say I have a trait T and a struct A already defined. If that trait has a function that has been implemented for A. Is there anyway that function would be used on a new struct say struct B without having to redefine it?
[21:17:20] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[21:17:32] <rusty_iron> could be used*
[21:17:44] <rusty_iron> and by used I mean implmented
[21:17:49] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[21:17:49] <cmr> rusty_iron: not right now, but default methods will allow that
[21:17:52] <cmr> (I believe)
[21:17:57] <strcat> you can make generic impls
[21:18:02] <strcat> I don't really understand the question though
[21:18:18] *** Joins: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net)
[21:18:19] *** Quits: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net) (Quit: wilsonk-laptop)
[21:18:23] *** Joins: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net)
[21:18:28] <strcat> https://github.com/mozilla/rust/blob/master/src/libstd/iterator.rs good examples of generic impls in there
[21:18:33] <Jeaye> strcat: He's asking if something is impld for Foo, can it be reused for Bar if the two only share a trait.
[21:18:36] <rusty_iron> Well I hate to use Java as an example, but take an abstract class, often there will be an object and you want all things that inherit from it to have the same function.
[21:18:53] <Jeaye> To which the answer is no.
[21:18:57] <strcat> rusty_iron: look at std::iterator, maybe it answers your question
[21:19:05] <strcat> you don't solve things the same way in rust but you don't need code duplication either
[21:19:18] *** Joins: MaikKlein (maik@moz-280FF4C6.dip0.t-ipconnect.de)
[21:19:37] <rusty_iron> strcat: Right, that's pretty obvious that things need to be solved differently. However reusing a function seems like a pretty common use case..
[21:19:48] <strcat> rusty_iron: okay, and you can reuse functions in rust
[21:20:03] <Eridius> rusty_iron: if you have a trait that defines a set of methods, and you want more methods that can be called on every value of that trait that only uses the trait's methods, you can do what IteratorUtil and RngUtil do
[21:20:04] <strcat> just not necessarily in the exact same way
[21:20:14] <Eridius> which is define a trait with those methods, and then implement that trait on all T: Foo where Foo is your trait
[21:20:15] <strcat> Eridius: there are also OrdIterator, etc.
[21:20:15] *** Joins: Guest_ (textual@moz-BB21156B.dynamic.csail.mit.edu)
[21:20:19] <Eridius> strcat: sure
[21:20:21] *** Guest_ is now known as Sergio965
[21:20:21] <rusty_iron> Re-using a function that is implemented using impl Trait for Struct {}
[21:20:21] <strcat> that are implemented on subsets of Iterator
[21:20:27] <Sergio965> Beep boop.
[21:20:42] <strcat> rusty_iron: you're asking "can I do X like Java"
[21:20:44] <strcat> the answer is no
[21:20:47] <Eridius> trait Foo { fn foo(); } trait FooUtil { fn uses_foo(); } impl<T:Foo> FooUtil for T { ... }
[21:20:55] <BitPuffin> actually the answer is most likely yes
[21:20:55] <strcat> can you avoid code duplication of functions? yes. but not like that
[21:21:07] <BitPuffin> oh
[21:21:08] <BitPuffin> like
[21:21:10] <BitPuffin> not in
[21:21:13] <BitPuffin> sorryh
[21:21:25] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[21:21:28] <rusty_iron> strcat: Right. Using JAva was just an example, but as far as I can tell it's implemented in Go as well. I could have used any language for that matter.
[21:21:36] *** Quits: Blei (philipp@moz-96D25F7A.cust.bluewin.ch) (Quit: WeeChat 0.4.1)
[21:21:58] <strcat> rusty_iron: no, you don't reuse code that way in Go
[21:22:10] <Eridius> rusty_iron: well in Go, if you embed one struct in another, you can call methods on the outer struct but the methods only see the inner one
[21:22:27] <rusty_iron> Eridius: Ahh, gotcha
[21:22:49] <rusty_iron> Eridius: I saw a small example of that and just assumed that was how it worked. That was a mistake on my part then.
[21:23:11] <cmr> rusty_iron: http://lwn.net/Articles/548560/ is pretty informative btw
[21:23:13] <rusty_iron> Eridius: But yeah, I realize half of the problem is just my ignorance of knowing the right way to implement things in Rust, but I'm working on it.
[21:23:20] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[21:23:23] <strcat> cmr: doesn't talk about default methods or generic impls though
[21:23:26] <Eridius> rusty_iron: I think you should provide a practical example of a problem you're trying to solve
[21:23:30] <strcat> so it's missing most of the code reuse story
[21:24:05] <strcat> rusty_iron: all I can say is look at Iterator, it's an example of generic impls and also of a useful trait for type bounds
[21:24:08] *** Quits: cowboyd (cowboyd@moz-1BD02A1E.sw.biz.rr.com) (Client exited)
[21:24:10] <rusty_iron> Eridius: Okay, I'll throw it up into a pastebin or something and let you guys take a look.
[21:24:13] <rusty_iron> strcat: K, I'll take a look.
[21:24:18] <strcat> an iterator only has to implement one method ("next")
[21:24:25] <strcat> and it gets a dozen adaptor methods for free
[21:24:34] <strcat> if the type it yields is Ord, it gets min/max for free too
[21:24:51] <strcat> if the type it yields is Add, it gets a sum method, if it's Mul, it gets a product method
[21:25:02] <Eridius> rand is another example. A random number generator only has to implment one method (also called "next") from the Rng trait, and it gets a bunch of methods for free
[21:25:06] *** Quits: victorporof (victorporo@70DEDDA.9004F55.9B1E38F4.IP) (Quit: victorporof)
[21:25:13] <strcat> and any code using iterators can be implemented with Iterator type bounds
[21:25:16] <strcat> and will work with any iterator
[21:25:20] *** Quits: ksev (DrunkenPan@745B767B.989A61DC.CA5B6332.IP) (Ping timeout)
[21:26:01] <strcat> fn foo<A, T: Iterator<A>>(x: &mut T) -> A { ... }
[21:26:19] <engla> if we'd have the new I/O traits they would be simple too
[21:28:21] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[21:28:21] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/7KmnAA
[21:28:21] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[21:28:23] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[21:29:17] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[21:29:25] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[21:29:43] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[21:29:53] <cmr> graydon: 2 hours, 50 minutes
[21:30:02] <rusty_iron> Okay strcat and Eridius, I have a code example
[21:30:05] <bblum> graydon: brson: pcwalton: tjc: https://github.com/mozilla/rust/issues/7264
[21:30:09] <bblum> please discus
[21:30:27] <cmr> bblum: WLOG?
[21:30:33] <tjc> bblum: Heh, I forgot I was still logged in to irc :-) No time today but I'll look at it tomorrow
[21:30:35] <rusty_iron> The example is terrible but the idea is there: http://pastebin.com/8E7kQqN7
[21:30:37] <tjc> cmr: without loss of generality
[21:30:40] <bblum> cmr: without loss of general fantasy
[21:30:45] <tjc> heh
[21:30:46] <tjc> or that
[21:30:48] *** Quits: tjc (tjc@moz-24060A8E.firstunitarianportland.org) (Quit: Places to go, people to annoy)
[21:31:19] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[21:31:20] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/RPs6kw
[21:31:20] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[21:31:20] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[21:31:20] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/eCei4A
[21:31:20] <ghrust> 13rust/06auto 141e68bab 15Bj√∂rn Steinbrink: Avoid unnecessary scratch datums for by-copy function arguments...
[21:31:20] <ghrust> 13rust/06auto 1454106f6 15Bj√∂rn Steinbrink: Avoid pointless allocas for "nil" return values...
[21:31:20] <ghrust> 13rust/06auto 1433c081c 15bors: auto merge of #7259 : dotdash/rust/ir_improvement, r=graydon...
[21:31:22] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[21:31:29] *** Quits: Ralith (ralith@moz-50F3C77.vc.shawcable.net) (Ping timeout)
[21:31:36] <Eridius> rusty_iron: in that case your Square struct is actually wrong. It should just have "side_length", because it can't have differeing width/height and still be a square
[21:31:45] <Eridius> which means that area() has to be implemented separately anyway
[21:31:49] *** Joins: H4199 (chatzilla@moz-64E556D3.austin.res.rr.com)
[21:31:50] <bblum> toddaaro: https://github.com/mozilla/rust/issues/7264
[21:31:58] *** Quits: spider-mario (spidermari@moz-2F72F6FF.dsl.quantic-telecom.net) (Input/output error)
[21:32:28] *** Quits: brson (brson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[21:32:46] *** Quits: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP) (Ping timeout)
[21:32:59] *** Joins: brson (brson@2557E599.66715431.D25A875A.IP)
[21:32:59] *** ChanServ sets mode: +o brson
[21:33:00] <rusty_iron> Eridius: Right, I said the idea is poor but just imagine it had to change for some reason
[21:33:34] <Eridius> rusty_iron: well in that particular case I'd still say that area shoudl be implemented separately, because any other shapes are not going to be able to re-use the same calculation
[21:33:40] <Eridius> Trapezoid certainly can't do width*height
[21:33:43] <Eridius> Circle can't either
[21:33:44] <Eridius> etc.
[21:34:07] <rusty_iron> What if they weren't shapes and the function could be used across multiple structs though? I couldn't think of a better example
[21:34:10] <roo> struct types of the form 'struct MyInt(int);' are not actually tagged are they?
[21:34:19] <cmr> roo: no
[21:34:45] <Eridius> rusty_iron: in the pathological case you could have a trait WidthHeight { fn width() -> uint; fn height() -> uint; } and implement this for both of your shapes there
[21:35:13] *** Joins: monk (monk@moz-99849335.compsoc.warwick.ac.uk)
[21:35:17] <Eridius> then you can have trait ShapeUtils { fn area() -> uint; } impl<T: WidthHeight> ShapeUtils for T { fn area(&self) { self.width * self.height } }
[21:35:41] *** Quits: SimonSapin (simon@88F51059.F3BBB17D.144F44FA.IP) (Ping timeout)
[21:36:07] <pcwalton> "This reduces compile times by about 10%." !!
[21:36:08] <pcwalton> whoa
[21:36:30] <Eridius> :O
[21:36:40] <rusty_iron> Eridius: Ohhh, Okay. I kind of see that now.
[21:37:04] <rusty_iron> Eridius: I dind't know you could do the impl<generic stuff here>, I must have missed that in the tutorial
[21:37:13] *** Joins: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP)
[21:37:18] <cmr> rusty_iron: it may not have been in the tutorial
[21:37:32] *** Joins: SimonSapin (simon@514D186.F3BBB17D.144F44FA.IP)
[21:38:06] <rusty_iron> cmr: I just checked and it was, but it was one of the examples that I didn't understand very well.
[21:38:14] <cmr> ah
[21:38:14] <rusty_iron> Section 16.2 for the Trunk
[21:38:27] *** Joins: mblbruce (mblbruce@moz-D00392B8.fagotten.org)
[21:38:47] <monk> quick question, "let mut ns = [1i,2i,3i]; for ns.each_mut |n| { ... }" get told that `[int * 3]` does not implement any method in scope named `each_mut`, but "for vec::each_mut(ns) |n| { ... }" form works fine... is this expected behaviour?
[21:38:49] *** Joins: vertexclique (vertexcliq@2A4DD1A8.B0B9525A.34FB0D7A.IP)
[21:39:05] <rusty_iron> That's exactly what I was loking for Eridius, that makes a lot more sense now.
[21:39:09] *** Parts: vertexclique (vertexcliq@2A4DD1A8.B0B9525A.34FB0D7A.IP) ()
[21:39:11] <strcat> monk: each_mut was removed
[21:39:22] <strcat> the free function is gone now too
[21:39:41] *** Quits: vosen (vosen@moz-266BA656.icpnet.pl) (Quit: Leaving)
[21:39:50] <monk> ahh okay, sorry just getting started!
[21:40:19] <strcat> rusti: let mut xs = [0, ..20]; for xs.mut_iter().take_(10).advance |x| { *x = 5 }; xs
[21:40:19] -rusti- [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
[21:40:39] <monk> strcat: great, thanks
[21:40:50] <doy> strcat: what do the trailing underscores indicate?
[21:40:55] <cmr> doy: nothing
[21:40:56] <rusty_iron> Alright, thanks everyone for answering my questions. Especially Eridius and strcat 
[21:41:00] <strcat> doy: workaround for a method resolve bug
[21:41:04] <doy> ah, okay
[21:41:28] *** Quits: rusty_iron (Mibbit@moz-3D556E4B.amazon.com) (Quit: http://www.mibbit.com ajax IRC Client)
[21:42:41] *** Quits: steven_is_false (user@moz-144077DE.bchsia.telus.net) (Client exited)
[21:43:08] *** Joins: tikue (tkuehn@2557E599.66715431.D25A875A.IP)
[21:43:20] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[21:43:20] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/wsLKng
[21:43:20] <ghrust> 13rust/06auto 14217b0ea 15Michael Sullivan: Get cross crate default methods working....
[21:43:20] <ghrust> 13rust/06auto 14296f81c 15bors: auto merge of #7203 : msullivan/rust/default-methods, r=nikomatsakis...
[21:43:20] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[21:43:23] *** Quits: lmandel (lmandel@F2D29657.F60B0462.67AC9B1.IP) (Quit: lmandel)
[21:43:31] <pcwalton> look at all of this great stuff landing
[21:43:49] *** Quits: eschweic1 (Adium@2557E599.66715431.D25A875A.IP) (Quit: Leaving.)
[21:44:03] <cmr> pcwalton: doener's patch didn't actually land though...
[21:44:21] <doener> hm, 32bit build failed
[21:44:33] <doener> cmr: did you test with 64bit or 32bit?
[21:44:58] <pcwalton> attempting to land :)
[21:45:14] *** Quits: lkuper (lkuper@F7922891.D3FA0837.51B6877.IP) (Ping timeout)
[21:46:40] *** Quits: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP) (Ping timeout)
[21:47:45] *** Joins: eschweic (Adium@2557E599.66715431.D25A875A.IP)
[21:48:49] *** Joins: alisdair (textual@E1CEBB1A.D061F0C9.AA6AEE7B.IP)
[21:48:56] *** Quits: alisdair (textual@E1CEBB1A.D061F0C9.AA6AEE7B.IP) (Client exited)
[21:49:58] *** Joins: alisdair (textual@E1CEBB1A.D061F0C9.AA6AEE7B.IP)
[21:51:40] *** Quits: SimonSapin (simon@514D186.F3BBB17D.144F44FA.IP) (Ping timeout)
[21:52:42] *** Quits: sk (sk@61A494B3.BA40E8A.AAC02D62.IP) (Quit: Leaving)
[21:54:39] *** Quits: alisdair (textual@E1CEBB1A.D061F0C9.AA6AEE7B.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[21:55:25] <bjz_> 8o
[21:55:30] <bjz_> "Michael Sullivan: Get cross crate default methods working"
[21:56:03] <Jeaye> :)
[21:56:28] <sully> yeah, I think some of these claims should be taken with a grain of salt, though
[21:56:38] <sully> I have a patch that claimed to get them working with generics
[21:56:52] <bjz_> hah
[21:56:54] <sully> and this latest patch fixes some more generics bugs I found
[21:57:05] <sully> and I am currently working on fixing... more generics bugs
[21:57:07] <Jeaye> Progress! 
[21:59:06] <bjz_> sully: I'm sure lmath will break it
[21:59:13] <bjz_> :D
[21:59:55] *** Joins: SiegeLordEx (siege@moz-CAF07B4C.hsd1.ma.comcast.net)
[22:00:41] *** Quits: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com) (Ping timeout)
[22:01:03] <monk> are there many contributions to the rust codebase from outside mozilla?
[22:01:18] <pcwalton> lots
[22:01:26] *** Quits: saml (sam@moz-14C16814.cst.lightpath.net) (Quit: Leaving)
[22:01:34] <monk> great :D
[22:01:56] <brson> there were 47 new contributors in 0.7
[22:02:05] <brson> so far
[22:02:22] *** Quits: SiegeLordEx (siege@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: Leaving)
[22:02:35] <graydon> at this point I think we are getting more from outside than inside
[22:02:40] <brson> probably
[22:02:41] <graydon> (guessing, but ..)
[22:03:03] *** Quits: Palmik (palmik@moz-5CA3F354.pks.muni.cz) (Quit: Lost terminal)
[22:03:06] <graydon> it feels like during this release cycle the balance might have finally shifted over. it's been shifting for a while.
[22:03:12] <monk> wow, how people find the time is beyond me!
[22:03:35] <monk> though I suppose lots of small contributions add up.
[22:03:58] <graydon> find/make. I suspect each person's story differs. but I do not know. I would be curious about time-spent and motives.
[22:04:07] <graydon> other communities I've been in sometimes run developer surveys
[22:04:19] <graydon> maybe we should do one :)
[22:04:40] *** Quits: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP) (Quit: ChatZilla 0.9.90 [Firefox 23.0a2/20130620004019])
[22:04:54] *** Joins: wilsonk|2 (kvirc@moz-39EFBFC2.cg.shawcable.net)
[22:04:55] *** Quits: dylukes (dylukes@moz-E4DF3FED.pitbpa.fios.verizon.net) (Quit: Computer has gone to sleep.)
[22:05:02] *** Quits: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[22:05:20] <graydon> I wonder, also, if I should try to wire up buildbot so that the first auto failure cancels the other jobs on that rev. I believe it has mechanisms to permit this.
[22:05:36] <graydon> pro: frees up machines. con: means you might miss 2 distinct errors on different machines.
[22:05:46] <strcat> we should submit rust support for ohcount so ohloh actually works
[22:05:55] <strcat> but..... the github upstream for ohcount seems dead ;\
[22:06:10] <graydon> like, there are 6 builds running right now that are clearly useless
[22:06:14] <strcat> it thinks rust is 50k lines of C/C++
[22:06:16] <graydon> haha
[22:06:18] <strcat> and nothing else 
[22:06:21] <graydon> VERY AWESOME C++
[22:06:55] <strcat> anyway ohloh is a bit weird
[22:06:57] *** Quits: donri (dag@moz-9BB61102.tbcn.telia.com) (Client exited)
[22:06:59] <strcat> ' with decreasing Y-O-Y commits '
[22:07:07] <strcat>  8535 Commits Up +1227 (16%) from previous 12 months
[22:07:42] <cmr> doener: 64bit of course
[22:07:45] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Client exited)
[22:07:50] <cmr> doener: I dont' recognize 32bits existence
[22:07:56] <doener> heh
[22:08:07] <doener> guess I'll have to whip up a 32bit vm tomorrow
[22:08:12] <strcat> so we have decreasing year-on-year commits.... but there are 16% more commits in the past year?
[22:08:47] *** Joins: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP)
[22:08:52] <doener> would be cool if the build bot log had the failure message and/or backtrace
[22:10:00] *** Joins: BitPuffin_ (quassel@moz-6A143E91.cust.tele2.se)
[22:10:07] *** Quits: BitPuffin (quassel@moz-1A23F58.cust.tele2.se) (Ping timeout)
[22:11:20] *** Joins: dylukes (dylukes@moz-E4DF3FED.pitbpa.fios.verizon.net)
[22:13:10] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Quit: eatkinson)
[22:13:13] <brson> doener: a 32-bit vm isn't necessary to test a 32-bit. which bot failed for you? you can probably reduce it on a 64-bit system
[22:13:27] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[22:13:27] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14296f81c to 14f348465: 02http://git.io/N3iJvQ
[22:13:27] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[22:13:28] <cmr> Right, you should be able to cross-compile, yeah?
[22:13:30] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[22:13:30] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/TTHmxA
[22:13:30] <ghrust> 13rust/06auto 14c1b1091 15Kevin Ballard: Support printf formats in terminfo strings...
[22:13:30] <ghrust> 13rust/06auto 1478fe9f6 15bors: auto merge of #7161 : kballard/rust/terminfo-parm-format, r=thestinger...
[22:13:30] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[22:13:33] <cmr> That's what the bots do I thought
[22:13:55] <sully> oh, hm.
[22:14:07] <strcat> stupid windows :(
[22:14:16] <doener> brson: all 32bit bots ICE'd
[22:14:21] <sully> so, right now, traits can have type parameters that have trait bounds on them
[22:14:52] *** Joins: tgt (tgt@moz-D59EE478.aztw.cable.virginmedia.com)
[22:14:55] <strcat> oh, really? didn't know we already had that
[22:15:14] <strcat> rusti: trait Iterable<A, T: Iterator<A>> { }
[22:15:15] -rusti- ()
[22:15:19] <cmr> sully: wait, isn't that HKT?
[22:15:22] <brson> doener: the quickest way to reproduce will be with `../configure --build-triple=i686-unknown-linux-gnu`. That will just do a pure 32-bit build, even on a 64-bit os. On linux you may need to install some extra compiler packages
[22:15:36] <brson> doener: if you're on mac then i686-apple-darwin
[22:15:50] <sully> cmr: no, not really
[22:16:03] <sully> it is a form of multiparameter type classes
[22:16:12] <sully> but, so, the traits can have bounded params
[22:16:13] <sully> but
[22:16:16] <sully> the bounds are never checked
[22:16:23] <strcat> huh.
[22:16:30] <sully> so, uh. whoops.
[22:16:43] <strcat> so.... do they actually work?
[22:16:50] <sully> I mean, you can write them
[22:17:04] <strcat> sully: I mean in the example above, if a method returns T - is T assumed to implement Iterator?
[22:17:11] <strcat> or does it just not do anything
[22:17:18] <sully> hm, I am not sure.
[22:17:34] * strcat needs that working for an Iterable trait and some other things
[22:19:16] <engla> strcat: I think this is what you need for Iterable https://github.com/mozilla/rust/issues/5033
[22:19:30] <strcat> engla: no, don't need that
[22:19:32] <strcat> it would just be convenient
[22:19:41] <cmr> nmatsakis: Sorry it took so long. Running the benchmark for the irrefut patterns thing now
[22:19:42] <engla> hm ok
[22:20:02] *** Quits: sankha93 (Instantbir@403EB97.7C989436.8B6C1D65.IP) (Ping timeout)
[22:20:07] <strcat> impl<A> Iterable<A, VecIterator<A>> for ~[A] {}
[22:20:29] <strcat> with trait Iterable<A, T: Iterator<A>> { fn iter(&self) -> T } I guess
[22:20:39] <strcat> I guess it probably needs a lifetime thrown in too
[22:20:44] *** Quits: MaikKlein (maik@moz-280FF4C6.dip0.t-ipconnect.de) (Ping timeout)
[22:23:00] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[22:24:44] <graydon> brendanc: ping
[22:24:50] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[22:24:54] <brendanc> graydon: synack
[22:25:09] *** Quits: rubber-duck (rubber-duc@moz-FBA1D66E.dsl.iskon.hr) (Ping timeout)
[22:25:13] <graydon> brendanc: I'm interested in maybe cancelling "all other builds running on this change" when one of the builds fails. do you know if that's possible / easy?
[22:25:19] *** Quits: true_droid (Adium@moz-123FD9B8.beck.volia.net) (Quit: Leaving.)
[22:25:38] <graydon> I can't see much obvious in the manual
[22:26:18] <brendanc> yeah, I don't know how to do that offhand. let me see...
[22:27:32] <brendanc> probably not terrible to make a buildstep to do that
[22:27:57] *** Quits: lkuper_ (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Ping timeout)
[22:28:50] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[22:30:40] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[22:31:44] <brendanc> looks like it'd involve subclassing buildbot.process.buildstep with a thing that walks the master looking for running builds and interrupting them
[22:32:31] <brendanc> could maybe take a stab at it tomorrow or so, I'd guess it's like 30ish lines
[22:32:45] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[22:33:14] <graydon> how would it work?
[22:33:39] <graydon> like .. before advancing from one buildstep to the next, it would possibly give up?
[22:33:49] <graydon> the problem here is that some of the buildsteps are 1h long :(
[22:33:53] <graydon> I want to interrupt them
[22:34:56] <brendanc> you'd add a step at the end of the build that runs only on failure, and goes and finds running builds and interrupts them. build.interrupt() should work the same as doing it from the web
[22:37:34] <sully> oh, ugh.
[22:37:38] <sully> some of my tests failed
[22:37:50] <sully> oh, just on windows
[22:37:59] <sully> and something with the cross crate test?
[22:37:59] <strcat> graydon: hm, http://buildbot.rust-lang.org/grid?branch=auto&refresh=15 looks like it isn't doing 3 of the builds it was supposed to
[22:38:01] <sully> it couldn't build it
[22:38:04] <sully> ugh.
[22:38:20] <strcat> for the latest
[22:38:49] <graydon> brendanc: that sounds more useful
[22:38:49] <sully> do aux tests not work on windows, or something?
[22:39:58] <graydon> strcat: those builds are queued, the slaves are overloaded
[22:40:02] <strcat> graydon: ah
[22:40:07] <sully> does anybody have any idea what could cause http://buildbot.rust-lang.org/builders/auto-win-32-nopt/builds/11/steps/test/logs/stdio?
[22:40:13] <graydon> (this is why I was asking brendanc about cancelling builds when one of them fails)
[22:40:13] *** Quits: roo (Mibbit@moz-69544D4C.dynamic.ip.windstream.net) (Quit: http://www.mibbit.com ajax IRC Client)
[22:40:16] <strcat> if I leave the buildbot page open, it eventually dies from internal errors after a refresh ;\
[22:40:20] *** Joins: rubber-duck (rubber-duc@moz-80125B69.dsl.iskon.hr)
[22:40:29] <graydon> yeah, I know. I've never figured that out. I think it's just racing against db updates
[22:40:48] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[22:40:52] <graydon> sully: you can't name files 'aux' on windows
[22:40:54] <graydon> sully: really
[22:41:05] <graydon> though, hm..
[22:41:07] <sully> like, you can't put aux in the name?
[22:41:10] <graydon> looks like you're not
[22:41:14] <strcat> graydon: could you just teach bors to send the cancels?
[22:41:23] <graydon> I'm not sure. I though it could be in the name, just not the whole name
[22:41:41] <graydon> sully: I don't know. check how the other aux builds are configured for windows?
[22:42:03] <graydon> strcat: bors, eh. maybe. I'd prefer buildbot did it itself. bors currently has no authority on buildbot.
[22:42:03] <strcat> you definitely can't have a file called aux
[22:42:07] <strcat> and probably not aux.ext
[22:42:17] <graydon> yeah, but "trait_default_method_xc_aux" ?
[22:42:27] <strcat> dunno, that should probably work though...
[22:42:32] <sully> oh, no
[22:42:33] <graydon> yeah, I would think so
[22:42:41] <sully> aux just doesn't work with fast
[22:42:47] <sully> needs to be xfail-rast
[22:42:49] <sully> xfail-fast
[22:43:55] <sully> ok, argh
[22:44:50] <sully> ok, I have updated that pull request with the test that failed xfailed
[22:45:00] <graydon> k
[22:45:02] <graydon> r=me
[22:45:03] <sully> can I trigger bors to look at it again, or does someone eles have to, or what?
[22:45:07] <graydon> if that's the only change
[22:45:45] <graydon> you have review status. put "r=graydon p=50" in the final commit in the change.
[22:45:49] <graydon> (as a comment)
[22:46:57] *** Quits: RMF (RMF@moz-8C13D5A2.dsl.telepac.pt) (Ping timeout)
[22:47:14] <sully> ok, so, edit the commit message to have that?
[22:47:21] <cmr> no, comment on github
[22:47:38] <strcat> on the commit
[22:47:49] <strcat> (comment on the commit)*
[22:48:07] <sully> ok, done
[22:48:10] <sully> thanks
[22:49:08] <strcat> graydon: and buildbot is unbelievably slow too ;p
[22:49:34] <bblum> graydon: btw, did you see my idea about default trait bounds
[22:49:38] * strcat is surprised no one has gotten frustrated enough to write a better alternative
[22:49:55] <sully> oh, what is the idea about default trait bounds?
[22:50:01] <graydon> bblum: don't think so
[22:50:08] <bblum> graydon: https://github.com/mozilla/rust/issues/7264
[22:50:29] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Quit: jedestep)
[22:50:32] <graydon> strcat: I think it's a very unforgiving space to code in. some people argue to me that we should be using jenkins.
[22:50:40] <graydon> I don't know much else that is fighting and holding up in this space.
[22:50:50] <Eridius> what does STALE in bors's queue mean?
[22:51:13] <strcat> well it doesn't seem like it'd be that hard to throw together something better for the subset we need
[22:51:15] <cmr> Eridius: merge conflict
[22:51:34] *** Quits: mib_jvbz0l (Mibbit@BBE7C46A.B4F11D08.8612FA94.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:52:04] <graydon> strcat: I did before. it was a serious time sink. I would not recommend it.
[22:52:22] <brendanc> the rust buildbot seems particularly slow
[22:52:24] <graydon> we moved to buildbot to get away from that. there are just too many pleasantries that "someone else coding it" takes care of
[22:52:53] <cmr> Like being able to blame someone else for the bugs!
[22:52:54] <brendanc> possibly sqlite is overmatched
[22:53:02] <graydon> brendanc: any idea where I'd look? maybe IO performance?
[22:53:09] <strcat> graydon: can you set sqlite to WAL mode?
[22:53:16] <graydon> if I knew how
[22:53:31] <strcat> graydon: sqlite3 db_file.sqlite
[22:53:33] <strcat> and
[22:53:37] <strcat> pragma journal_mode=wal;
[22:53:40] <graydon> while it's open and working?
[22:53:48] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[22:54:13] <graydon> (how do I check the current journal mode?)
[22:54:17] <strcat> graydon: should be fine afaik, the only thing that's hard is turning *off* WAL ;p
[22:54:22] <strcat> graydon: pragma journal_mode;
[22:54:24] <strcat> I think
[22:54:26] <strcat> graydon: https://www.sqlite.org/wal.html
[22:54:33] <graydon> it's currently in 'delete' mode
[22:54:35] <strcat> regular journal makes writes block reads
[22:54:35] <graydon> is that slow?
[22:54:48] <strcat> graydon: well it's not really slow, but it blocks
[22:54:53] <strcat> and gives EBUSY after 5 secs
[22:54:53] <graydon> ok
[22:54:56] <graydon> I'll try
[22:55:11] <strcat> WAL has ever so slightly lower throughput but is much more concurrent
[22:55:13] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Textual IRC Client: www.textualapp.com)
[22:55:30] <graydon> doesn't seem to change
[22:55:37] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[22:55:37] <strcat> hm
[22:55:43] <graydon> sqlite> pragma journal_mode;
[22:55:43] <graydon> delete
[22:55:43] <graydon> sqlite> pragma journal_mode=wal;
[22:55:44] <graydon> delete
[22:55:53] <cmr> heh
[22:56:09] <brendanc> I'm sorry dave, I can't let you do that.
[22:56:11] * strcat wonders why it's failing
[22:56:17] <strcat> graydon: what's the sqlite version?
[22:56:20] <strcat> wal is post 3.7
[22:56:23] <graydon> 3.6.22
[22:56:25] <strcat> ah
[22:56:58] <graydon> this is ubuntu 10.04.1 LTS on a VM
[22:57:05] <graydon> so you can picture the IO not being ideal
[22:57:12] <Eridius> if I fix the merge conflicts, do I need to get my PR's re-reviewed?
[22:57:29] <cmr> Eridius: yes, but usually it's just a simple r+
[22:57:36] <Eridius> ok I just rebased https://github.com/mozilla/rust/pull/7216 on top of master
[22:57:37] <strcat> graydon: yep, I'm used to having the latest stable versions of things
[22:57:48] <strcat> I have a debian stable server and it aggravates me to no end
[22:57:55] <brendanc> how large is the db file out of curiosity?
[22:58:02] <Eridius> cmr: is this why the r+ goes on the commit? so any pushes will remove it?
[22:58:11] <graydon> brendanc: 2.9mb presently
[22:58:16] <graydon> Eridius: yes
[22:58:22] <brendanc> well that's not bad
[22:58:40] *** Joins: reyre_ (reyre@moz-9002CDDA.cpe.net.cable.rogers.com)
[22:58:45] <strcat> graydon: https://launchpad.net/~travis-ci/+archive/sqlite3 ?
[22:59:10] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[22:59:12] * strcat doesn't know if that'd work on ubuntu 10.04 anyway
[22:59:26] <graydon> if only I had admin permission on this machine :)
[22:59:29] <graydon> maybe I do, hmm...
[22:59:40] <graydon> oh yay, I do
[22:59:45] *** Quits: SiegeLord (siege@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[23:00:15] <graydon> I'm happy to upgrade from source if it can be done without too much misery on the buildbot code
[23:00:50] <mblbruce> I'm trying to understand crates/the module system and am trying to distill the simplest possible example of a bin crate with main.rc containing a main() calling the fn bar() in foo.rs. I'm starting to feel pretty stupid after trying every imaginable (though obviously not since it doesn't work yet) permutation of pub, mod and/or use. Neither the tutorial (which does have some partial examples but no complete multiple-file single-crate ones) nor 
[23:00:51] <mblbruce> looking in core/std have cleared up my foggy mind. Is there a minimal example some kind soul could point me to?
[23:00:53] <strcat> graydon: well buildbot is probably just using python's built-in sqlite support (it links against it)
[23:01:11] <graydon> IOW if I make a new /usr/lib/libsqlite3.so.0 and restart buildbot, think it'll work?
[23:01:17] <strcat> graydon: probably
[23:01:25] <strcat> and sqlite thankfully has a totally stable ABI
[23:01:28] <graydon> I'll copy the old one aside :)
[23:01:31] <graydon> yeah, they are pretty damn stable
[23:01:44] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[23:01:50] <Eridius> ok I updated my 2 PR's. strcat, you had previously reviewed my vec-stuff one, right? https://github.com/mozilla/rust/pull/7210
[23:02:11] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[23:02:19] <strcat> Eridius: yep, sec
[23:02:22] <cmr> mblbruce: https://gist.github.com/cmr/5827532
[23:02:23] <Eridius> although actually, since we just snapshotted, I may not need the #[cfg(not(stage0))] anymore
[23:02:37] <Eridius> strcat: I'm going to check on that first
[23:02:51] <strcat> Eridius: ah right
[23:02:59] * strcat will r+ after
[23:03:44] <steven_is_false> The instructions on the Wiki for Windows say that Rust needs a <4.6 g++ compiler. Is this still true?
[23:03:46] <mblbruce> cmr: Thanks a lot
[23:03:51] <strcat> std::ptr is nice and clean now :)
[23:04:09] <cmr> mblbruce: modules were really confusing to me too
[23:04:15] <bblum> "unreachable pattern"? excuse me, rustc?
[23:04:34] <cmr> nmatsakis: Your irrefut pattern branch doesn't build
[23:04:34] <strcat> bblum: it wants longer arms
[23:04:39] <bblum> strcat: ahhhh.
[23:04:44] <cmr> nmatsakis: specifically, you broke librustpkg
[23:04:48] <Eridius> aww crud, I have to rebuild llvm
[23:04:51] *** Quits: doener (doener@moz-121949B3.unitymediagroup.de) (Ping timeout)
[23:04:57] <cmr> nmatsakis: or, librustpkg was already broken :)
[23:05:00] <strcat> putting all the nice patterns on the highest shelf is cruel :(
[23:05:03] <cmr> /home/cmr/hacking/rust/src/librustpkg/package_source.rs:207:25: 207:31 error: cannot move out of dereference of & pointer
[23:05:06] <cmr> /home/cmr/hacking/rust/src/librustpkg/package_source.rs:207         for crates.each |&crate| {
[23:05:08] <cmr>                                                                                      ^~~~~~
[23:05:10] <cmr> nmatsakis: and so on
[23:05:17] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[23:05:24] <strcat> heh, each
[23:05:33] <strcat> removing that is going to be so painful
[23:05:36] *** Quits: smvv (smvv@moz-A397289C.xlshosting.net) (Ping timeout)
[23:05:45] *** Quits: prudhvi (prudhvi@moz-154A460A.supr.io) (Ping timeout)
[23:05:47] *** Joins: prudhvi (prudhvi@moz-154A460A.supr.io)
[23:05:49] *** Quits: pcdummy (quassel@moz-CF4CA865.page4me.ch) (Ping timeout)
[23:05:50] *** Joins: pcdummy (quassel@moz-CF4CA865.page4me.ch)
[23:05:57] *** Quits: DasIch (dasich@moz-5EDA591.de) (Ping timeout)
[23:05:59] *** Joins: DasIch (dasich@moz-5EDA591.de)
[23:06:25] *** Quits: dylukes (dylukes@moz-E4DF3FED.pitbpa.fios.verizon.net) (Quit: Computer has gone to sleep.)
[23:06:31] *** Quits: Thiez (thiez@moz-BF669398.student.utwente.nl) (Ping timeout)
[23:07:24] <Eridius> strcat: did zip change names?
[23:07:31] <strcat> no
[23:07:40] <Eridius> error: type `vec::VecMutIterator/&<'a>` does not implement any method in scope named `zip`
[23:07:55] <Eridius> is IteratorUtil not being pulled in by default? That should be in prelude now
[23:07:57] <bblum> rusti: match None => { Lots(*) => {}, _ => {} }
[23:07:58] -rusti- <anon>:10:20: 10:22 error: expected `{` but found `=>`
[23:07:58] -rusti- <anon>:10          match None => { Lots(*) => {}, _ => {} }
[23:07:58] -rusti-                               ^~
[23:07:58] -rusti- application terminated with error code 101
[23:07:58] <cmr> Eridius: something is wrong there, that's pre-0.6 syntax...
[23:08:01] <bblum> err
[23:08:01] *** Joins: smvv (smvv@moz-A397289C.xlshosting.net)
[23:08:05] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[23:08:07] <bblum> rusti: match None { Lots(*) => {}, _ => {} }
[23:08:07] -rusti- <anon>:10:22: 10:26 error: unresolved enum variant, struct or const
[23:08:07] -rusti- <anon>:10          match None { Lots(*) => {}, _ => {} }
[23:08:07] -rusti-                                 ^~~~
[23:08:08] -rusti- error: aborting due to previous error
[23:08:08] -rusti- application terminated with error code 101
[23:08:12] <bblum> hmm
[23:08:22] <engla> cmr: that's what error messages look like still
[23:08:24] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[23:08:31] <cmr> engla: why!?
[23:08:48] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: WeeChat 0.4.1)
[23:08:54] <strcat> rusti: let mut xs = [1, 2, 3]; let ys = ["foo", "bar"]; for xs.mut_iter().zip(ys.iter()).advance { }
[23:08:56] *** Quits: cr (anonymous@moz-E5EE6022.dip0.t-ipconnect.de) (Ping timeout)
[23:08:56] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/ZEcR
[23:09:01] *** Joins: roo (Mibbit@moz-DE5F47DB.dynamic.ip.windstream.net)
[23:09:13] <strcat> rusti: let mut xs = [1, 2, 3]; let ys = ["foo", "bar"]; for xs.mut_iter().zip(ys.iter()).advance |(x, y)| { }
[23:09:14] -rusti- ()
[23:09:15] <cmr>  fmt!("type `%s` does not implement any method in scope \
[23:09:16] <engla> I don't know
[23:09:17] <cmr>        named `%s`",
[23:09:17] <bblum> rusti: enum Maybe<T> { Nothing, Just(T), } match Nothing { Lots(*) => {}, _ => {} }
[23:09:17] -rusti- <anon>:10:61: 10:65 error: unresolved enum variant, struct or const
[23:09:17] -rusti- <anon>:10          enum Maybe<T> { Nothing, Just(T), } match Nothing { Lots(*) => {}, _ => {} }
[23:09:17] -rusti-                                                                        ^~~~
[23:09:18] -rusti- error: aborting due to previous error
[23:09:18] -rusti- application terminated with error code 101
[23:09:18] *** concrete.mozilla.org sets mode: +M 
[23:09:19] <cmr>       actual,
[23:09:20] <strcat> Eridius: seems to work
[23:09:21] <graydon> libtool? _libtool_?
[23:09:21] <cmr>       fcx.ccx.tcx.sess.str_of(method_name))
[23:09:23] <cmr> On the plus side, that should be easy to fix?
[23:09:29] * graydon starts losing it
[23:09:34] <Eridius> strcat: does the snapshot not have IteratorUtil in the prelude? It's brand new!
[23:09:38] * strcat hates libtool and linker scripts ;p
[23:09:39] <cmr> I'm afraid to touch the typeck code though....
[23:09:45] <strcat> Eridius: dunno
[23:09:48] *** Joins: Thiez (thiez@moz-BF669398.student.utwente.nl)
[23:09:55] *** Quits: rubber-duck (rubber-duc@moz-80125B69.dsl.iskon.hr) (Quit: Leaving)
[23:10:04] *** Joins: Thad (chatzilla@moz-C35F90AE.tx.res.rr.com)
[23:10:20] <strcat> Eridius: where is the error happening?
[23:10:24] <strcat> prelude isn't in scope in libstd
[23:10:39] <Eridius> strcat: it's in libstd, but this code used to compile
[23:10:51] <Eridius> explicitly using iterator::IteratorUtil fixes it
[23:10:57] <strcat> maybe it had an import of that before
[23:11:22] <Eridius> strcat: doesn't look like it. I just asked github to show me how the file looked at the current revision in the PR
[23:11:48] <bblum> ah, i've got it
[23:11:57] <Eridius> strcat: ok I updated the PR. I verified that libstd now builds in stage0
[23:12:04] <cmr> rusti: trait Foo { fn bar(&mut self); } struct Bar { a: uint } impl Foo for Bar { fn bar(&mut self) { self.a } } let x: &Foo = Bar { a: 6}; x.asdf()
[23:12:05] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/BUMW
[23:12:15] <bblum> rusti: match Some(()) { Lots => {}, _ => {} }
[23:12:16] -rusti- <anon>:10:38: 10:39 error: unreachable pattern
[23:12:16] -rusti- <anon>:10          match Some(()) { Lots => {}, _ => {} }
[23:12:16] -rusti-                                                 ^
[23:12:16] -rusti- error: aborting due to previous error
[23:12:16] -rusti- application terminated with error code 101
[23:12:21] <bblum> ^ is this known?
[23:12:31] <bblum> ("unreachable pattern")
[23:12:38] <Eridius> bblum: looks correct to me. Lots is being treated as a variable
[23:12:44] <Eridius> match Some(()) { a => {}, _ => {} }
[23:12:46] <Eridius> same thing
[23:12:48] <bblum> ohhh.
[23:12:53] <bblum> i feel dumb :P
[23:12:56] <cmr> Can someone help me reproduce that 
[23:13:02] <cmr> Can someone help me reproduce that error: type `vec::VecMutIterator/&<'a>` does not implement any method in scope named `zip` error?
[23:13:05] <cmr> oops
[23:13:08] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[23:13:18] <cmr> silly enter key, not knowing when I want it to be rpessed..
[23:13:24] <Eridius> cmr: just build PR 7210 in stage0 after ripping out the `use iterator::IteratorUtil`
[23:13:59] *** Joins: cr (anonymous@moz-32725F28.dip0.t-ipconnect.de)
[23:14:18] *** concrete.mozilla.org sets mode: -M 
[23:14:19] <Eridius> strcat: anyway https://github.com/mozilla/rust/pull/7210 is good now
[23:14:22] *** Quits: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP) (Quit: buildmaster reconfigured: bot disconnecting)
[23:14:40] <Eridius> strcat: I think you r+'d before I pushed
[23:14:56] <strcat> r+'ed
[23:14:58] <bblum> Eridius: i suppose i should thank it then; i had "match sigil { BorrowedSigil => ... }" when it should have been ast::BorrowedSigil
[23:15:03] <Eridius> strcat: ty
[23:15:05] *** Joins: dylukes (dylukes@moz-E4DF3FED.pitbpa.fios.verizon.net)
[23:15:16] <Eridius> bblum: rustc always knows best
[23:15:24] <bblum> rustc sometimes knows best.
[23:15:28] * strcat wishes we enforced case like haskell
[23:15:33] *** Joins: SiegeLord (siege@moz-CAF07B4C.hsd1.ma.comcast.net)
[23:16:06] *** Joins: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP)
[23:16:33] *** Quits: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP) (Quit: buildmaster reconfigured: bot disconnecting)
[23:16:40] *** Joins: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP)
[23:17:59] <cmr> Sigh/// there are 5 different ty_to_str
[23:18:03] <cmr> which one is being used!
[23:18:35] <graydon> buildbot sqlite upgraded to wal mode. no performance change that I can see. still lots of dead time.
[23:19:02] <strcat> graydon: maybe it's just the http server?
[23:19:17] <graydon> maybe. it is being proxied through 2 different HTTP servers.
[23:19:24] <graydon> (I could not really control this)
[23:19:42] <strcat> does buildbot use the horrible default python server?
[23:19:55] <mblbruce> cmr: In your example, in order to call fn bar() from main(), it must be qualified with its module(?) name, i.e. foo::bar(). I'm having some trouble bringing the foo.rs contents directly into the main.rc scope. I tried "use foo;" and "use foo::*;" immediately following "mod foo;", but rustc disapproves and says that "`use` and `extern mod` declarations must precede items". Any thoughts?
[23:19:59] <strcat> it's not *this* bad though
[23:20:06] <strcat> it does fall down with 5 concurrent connections ;p
[23:20:19] <brendanc> buildbot's on twisted
[23:20:24] <strcat> hrm
[23:20:41] <strcat> well perhaps they aren't using twisted right :)
[23:20:45] <strcat> they can still make it block
[23:21:22] <cmr> mblbruce: https://gist.github.com/cmr/5827532
[23:21:24] <strcat> sqlite operations will still block the whole stack
[23:21:35] <brendanc> db operations are farmed off to threads
[23:21:50] * strcat shrugs
[23:21:59] <graydon> when watch the twistd.log I see a lot of these:
[23:22:06] <graydon> 2013-06-20 16:19:47-0700 [HTTPChannel,88,127.0.0.1] Loading builder dist-linux's build 147 from on-disk pickle
[23:22:06] <graydon> 2013-06-20 16:19:47-0700 [HTTPChannel,88,127.0.0.1] Loading builder dist-linux's build 146 from on-disk pickle
[23:22:06] <graydon> 2013-06-20 16:19:47-0700 [HTTPChannel,88,127.0.0.1] Loading builder dist-linux's build 145 from on-disk pick
[23:22:10] <graydon> etc.
[23:22:11] <graydon> like a lot
[23:22:19] <cmr> mblbruce: it's a bit counterintuitive to have a `use foo::*` before the `mod foo`, but that's how it is
[23:22:41] <strcat> graydon: pickling is just python's built-in serialization, doesn't really seem like it'd be that bad (unless they are huge?)
[23:22:54] * strcat hates pickle though - it can execute code on unpickling :|
[23:23:03] *** Quits: mixi (mixi@moz-DBD8904A.org) (Ping timeout)
[23:23:17] *** Joins: mixi (mixi@moz-DBD8904A.org)
[23:23:32] <graydon> yeah
[23:23:38] <brendanc> possibly it's bors crawling old builds?
[23:23:44] <cmr> brson: Does your huge IO pull actually build and pass tests (at least on amd64 linux?)
[23:24:03] <cmr> brson: I'd like to run my benchmark script on it :)
[23:24:34] *** Joins: Ralith (ralith@moz-50F3C77.vc.shawcable.net)
[23:24:40] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[23:24:54] <mblbruce> cmr: Ok. Thanks - again. Promise me you'll stop me when you feel that your quota of answering newbie questions is filled for the day...
[23:25:23] <cmr> mblbruce: it's never filled!
[23:25:31] <cmr> mblbruce: just don't ask the same question twice :p
[23:26:18] <mblbruce> cmr: Great! I'll try not to‚Ä¶ =o)
[23:26:22] *** Quits: KindOne (KindOne@E313C970.A337191.EC6A1518.IP) (Ping timeout)
[23:26:27] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[23:26:33] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[23:27:43] *** Joins: KindOne (KindOne@E313C970.A337191.EC6A1518.IP)
[23:28:31] <brendanc> graydon: I just looked at the bb config you last sent me. you have c['buildCacheSize'] = 15 which looks rather small
[23:28:41] <brendanc> I'd imagine that's the cause of the picle loads
[23:28:44] <brendanc> pickle
[23:29:13] <Eridius> is there any easy way to just build stage1 librustllvm.dylib and nothing else?
[23:29:15] *** Quits: a__ (a__@moz-250D9B4.nycmny.fios.verizon.net) (Client exited)
[23:29:32] <strcat> use the compiler and build it ;p
[23:29:40] <cmr> Eridius: make -j5 and stop when you see it's done :p
[23:29:44] <Eridius> bah
[23:29:48] <Eridius> I'm trying to fix this to link against libstdc++
[23:30:15] <Luqman> Eridius: do VERBOSE=1 make  and find the command used to build librustllvm
[23:30:16] *** Joins: a__ (a__@moz-250D9B4.nycmny.fios.verizon.net)
[23:30:28] <Eridius> Luqman: ah
[23:31:20] <graydon> brendanc: ok. what should I set it to, 100 or so? I think I lowered those numbers to keep out-of-control log growth and such down.
[23:31:35] <graydon> 1000? I have an extra couple gb of memory on the VM now
[23:31:49] <cmr> brson: running the bench on your io-upstream branch, fingers crossed
[23:32:00] <brendanc> buildCacheSize is the pickle cache, I don't think it's related to log growth
[23:32:13] <brendanc> dunno really, but I'd probably go up 10x to start
[23:32:55] *** Quits: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP) (Quit: Leaving.)
[23:34:19] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[23:34:48] <brendanc> should be big enough to display the whole waterfall
[23:35:31] <mblbruce> cmr: My understanding is that it is possible for the crate .rc file to contain arbitrary code and may use the contents of .rs files that are also in the crate, but those .rs files may not use the contents of the .rc file. Is this correct? Because rustc claims that it fails to open main.rs, when by my line "mod main;" in foo.rs I actually would like it to open main.rc.
[23:36:08] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[23:36:13] <brendanc> graydon: you also have c['caches']['Builds'] = 500 # formerly c['buildCacheSize']
[23:36:22] <brendanc> but I don't see a mention of that one in the manual
[23:36:31] <graydon> I copied these from .. some old manual page
[23:36:32] <brendanc> for 0.8.5
[23:36:34] <graydon> ok
[23:36:50] <cmr> mblbruce: .rc files are deprecated, in that they're treated identically to .rs files, so you should use the .rs extension. Anyway, you don't need to use `mod main`, you can use the contents directly (you can do `use super::foo` to import from it)
[23:36:59] <graydon> I have bumped the caches and it seems much faster
[23:37:03] <graydon> maybe I should bump them more
[23:37:04] <cmr> mblbruce: not sure about exact details though... I'm still kinda shaky on it myself
[23:37:10] <bblum> woot
[23:37:18] <bblum> my change to rustc found an unsoundness in the stdlib
[23:37:21] <brendanc> just see how many pickle loads you get after steady state :)
[23:37:33] *** Quits: eholk (eholk@moz-E48ECCE9.uconnect.utah.edu) (Quit: eholk)
[23:38:23] <mblbruce> cmr: Is that true for 0.6 as well (which I'm currently using)?
[23:38:31] <cmr> mblbruce: I'm pretty sure
[23:38:38] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[23:39:39] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[23:41:12] <mblbruce> cmr: So: 1) The crate directives (link, crate_type, etc) can be placed in any .rs file and 2) the contents of any .rs file in the same crate can be accessed even without "mod <file>" by using "<file>::<func>"?
[23:41:50] <cmr> mblbruce: 1) Yes, 2) You need `mod file` somewhere, it's the only way the file gets loaded.
[23:41:57] <cmr> mblbruce: like I said though... not sure of the exact details
[23:42:56] <mblbruce> cmr: Right, that was going to be my follow-up question, namely how rustc would know which .rs files to include in the crate if there were no "mod <file>" statements.
[23:43:01] *** Quits: azita (Azita@2557E599.66715431.D25A875A.IP) (Quit: azita)
[23:44:41] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[23:47:13] *** Quits: nzi (Mibbit@85E88890.17E38A0A.259C0349.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[23:47:48] *** Quits: dylukes (dylukes@moz-E4DF3FED.pitbpa.fios.verizon.net) (Quit: Computer has gone to sleep.)
[23:48:02] *** Quits: Scriptor (historium@moz-E06F46F0.corp.bitshelter.com) (Quit: Scriptor)
[23:48:13] <mblbruce> cmr: Hmm, I seem to have hit an internal compiler error with my playing around with modules. Is this the point where I go build the master branch and try the code on that?
[23:48:21] <cmr> mblbruce: yup.
[23:48:22] <graydon> bblum: 'static as a bound really confuses me
[23:48:23] <graydon> on @fn say
[23:48:27] <graydon> what's that about?
[23:48:39] <bblum> graydon: 'static is what the implicit bound on @fns/@Traits is today
[23:48:51] <bblum> (well, not on @Traits yet, but that's a soundness bug)
[23:48:52] <cmr> mblbruce: I have a bunch of fixes related to `use` and `mod` errors in master, bad error messages that I ran into when trying to figure out the module system via exploration, so that should help you too.
[23:48:56] <graydon> doesn't @fn take a copy of its environment / possibly-own-@-boxes?
[23:49:05] *** aatch|illsnapshotyou is now known as aatch
[23:49:09] <aatch> SNAPSHOT!
[23:49:13] <graydon> :)
[23:49:17] <bblum> graydon: sure, but if you have a &T, you can't capture that, or else you forget the lifetime
[23:49:44] <graydon> ok. I guess I don't know what the bounds say then. or why 'static there but not on (say) ~fn
[23:50:10] <bblum> graydon: it is on ~fn but Owned is a subkind of 'static, so Owned implies 'static
[23:50:24] *** Quits: ssbr (ssbr@44926E86.7F606153.14AA5DDE.IP) (Client exited)
[23:50:41] *** Quits: Sergio965 (textual@moz-BB21156B.dynamic.csail.mit.edu) (Ping timeout)
[23:50:48] <bblum> graydon: for a real-world security vulnerability, consider this function https://github.com/mozilla/rust/blob/master/src/libstd/io.rs#L1086
[23:51:12] <bblum> well, soundness vulnerability at least. probably couldn't implement coerce with it.
[23:51:51] <mblbruce> cmr: Nice, I'll try that then. Is master always kept in working order, or is it allowed to break?
[23:52:09] <cmr> mblbruce: the goal is for it always to be working... doesn't always happen. it's fine right now.
[23:52:16] <strcat> mblbruce: pulls only land if they pass all the tests on all the tested architectures
[23:52:20] <graydon> bblum: I don't get the example
[23:52:56] <bblum> graydon: the lifetime of the slice is lost in the @Reader argument, so the caller can keep the @Reader around longer than the slice lives
[23:53:22] *** Joins: dylukes (dylukes@moz-E4DF3FED.pitbpa.fios.verizon.net)
[23:53:35] *** Quits: pyrac (pyrac@moz-DAB0A516.w109-222.abo.wanadoo.fr) (Quit: pyrac)
[23:53:50] *** Quits: tikue (tkuehn@2557E599.66715431.D25A875A.IP) (Quit: tikue)
[23:54:10] <mblbruce> cmr, strcat: Sounds good. I'll go warm up the old CPU then.
[23:55:16] <graydon> bblum: right, got it
[23:55:22] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[23:57:12] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[23:57:30] *** Quits: mschifer (Adium@2557E599.66715431.D25A875A.IP) (Quit: Leaving.)
[23:58:53] <aatch> this may be the sleep deprivation talking, but I am inordinately happy that the tree is open again
