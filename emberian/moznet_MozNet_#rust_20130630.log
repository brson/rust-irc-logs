[00:00:25] <thiez> perhaps we could disable that atomic counter unless rustc is compiled with some 'debug-owned-ptrs' cfg?
[00:01:30] <strcat> thiez: I don't think it's useful
[00:01:38] <strcat> valgrind is better, it catches any leak - not just from the ~ allocator
[00:01:41] <thiez> then let's kill it :)
[00:01:46] <strcat> sure
[00:01:49] <aatch> thiez, well ideally we'd just have a regular old malloc for ~ and a GC-routed allocation for @
[00:01:55] <thiez> what else is hidden in that header?
[00:02:00] <strcat> thiez: useless crap
[00:02:02] <strcat> ~fn uses it though
[00:02:05] <aatch> thiez, the counter isn't in the header.
[00:02:10] <aatch> just fyi
[00:02:18] <strcat> thiez: some stupid code reads ~ headers to determine if they are managed or not
[00:02:27] <strcat> since ~ containing @ is managed
[00:02:32] <strcat> it should all be at compile-time but it's not
[00:02:49] <steven_is_false> Hi! Could someone help me with my refactoring in extra::arc, git@github.com:sstewartgallus/rust.git ? It's not done yet but before I can experiment with some extra stuff I'm getting freezes from blocking when using conditions.
[00:03:22] <thiez> I'd be tempted to have a look at that code if not for the fact that I've looked at trans before and suspect it would be as painful as last time :p
[00:03:38] <strcat> anyway I'm ripping out that counter
[00:03:43] <strcat> will see what it gains us
[00:03:46] <steven_is_false> Oops, I screwed up the link. It's https://github.com/sstewartgallus/rust , and the refactor_arc branch.
[00:03:49] <aatch> strcat, so closures use the header. Anything else?
[00:03:56] <strcat> aatch: dunno
[00:03:56] <aatch> (that shouldn't)
[00:03:58] <strcat> maybe traits
[00:04:02] <strcat> aatch: nothing should use it
[00:04:25] <strcat> I can write a unique pointer without a header, so I don't see why ~ should be using it
[00:04:29] <MaikKlein> haha my rustray output looks super weird :)
[00:04:38] <strcat> especially if it doesn't contain @
[00:04:39] <thiez> MaikKlein: how so?
[00:05:04] <thiez> it should generate a picture of a cow (assuming you got the default model file)
[00:05:40] <thiez> an ugly yellow cow on a pink-and-grey floor under an omnious yellow sky :p
[00:05:55] <steven_is_false> Well okay, I'm going to take a break now.
[00:05:57] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[00:06:18] *** Joins: weirdo (Mibbit@moz-7A0CB455.glbb.ne.jp)
[00:06:21] <MaikKlein> thiez, well I have huge borders in my pic ^.^
[00:07:00] <MaikKlein> ok well maybe
[00:07:03] <thiez> MaikKlein: those shouldn't be there, it's not because your picture-viewing application inserts those?
[00:07:05] <MaikKlein> my viewer is just buggy
[00:07:32] <cmr> http://rustlog.octayn.net/post/54216808377/status-update, good night
[00:07:54] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[00:08:07] <MaikKlein> where can I upload ppm?
[00:08:10] *** Quits: brson (brson@2557E599.66715431.D25A875A.IP) (Quit: leaving)
[00:09:30] <thiez> MaikKlein: I have no idea.
[00:09:45] <strcat>     * stop using an atomic counter, this has a significant cost and
[00:09:46] <strcat>       valgrind will already catch these leaks
[00:09:48] <strcat>     * remove the extra layer of function calls
[00:09:50] <strcat>     * remove the assert of non-null in free, freeing null is well defined
[00:09:52] <strcat>       but throwing a failure from free will not be
[00:09:54] <strcat> that's a start.
[00:09:56] <strcat> I could stop initializing part of the headers
[00:10:02] <strcat> I think that'll make undef reads though :[
[00:10:04] <strcat> when it copies
[00:10:37] <thiez> you work fast
[00:10:42] <strcat> well they are trivial changes
[00:10:49] <thiez> if you know where to make them
[00:10:51] <strcat> the hard part is changing trans
[00:12:02] <thiez> I found trans rather confusing, especially the obsession with variable-names of 4 characters or less, most of which seem to imply some connection with 'context'
[00:12:28] <thiez> 'cx.fcx.ctxt' or something along those lines ;)
[00:12:36] *** Quits: weirdo (Mibbit@moz-7A0CB455.glbb.ne.jp) (Quit: http://www.mibbit.com ajax IRC Client)
[00:12:39] <aatch> thiez, yeah... you just learn.
[00:13:00] <aatch> you probably saw bcx.ctx().fcx a lot
[00:13:08] <doener> fcx, bcx, fcx are fine, just cx is annoying, because that seems to mean a different thing every time I see it
[00:13:16] <aatch> doener, yeah...
[00:13:30] <thiez> you just mentioned fcx twice
[00:13:43] <thiez> intentional?
[00:13:52] <doener> no, the second one should be tcx
[00:14:09] <doener> though, there's a fctxt type in both trans and ast IIRC :-/
[00:14:14] <mnemotic> thiez: it's funny, you see, because these names don't provide any context
[00:14:25] <doener> or fn_ctxt, or whatever the typename is
[00:14:36] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[00:14:49] <aatch> function context, block context and type context, respectively
[00:14:51] <thiez> this is usually the point where I crawl under my table and start crying :p
[00:15:30] <thiez> a proper autocomplete would make these magical structs half as painful
[00:15:51] <MaikKlein> :)
[00:16:16] <mnemotic> all the autocomplete you ever need is M-/ :D
[00:16:25] <thiez> what does that do?
[00:16:32] *** Quits: vittorioromeo (quassel@moz-804BA27C.retail.telecomitalia.it) (Input/output error)
[00:17:37] <doener> I usually prefer short names. The initial learning is a bit harder, but I cringe just thinking about seeing block_context.crate_context().type_context()
[00:17:39] <mnemotic> it's the key combination for (dumb) symbol completion in Emacs
[00:17:55] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[00:18:20] <thiez> doener: that makes sense, it would be less of a problem if the struct definitions and the methods/functions were well documented
[00:18:39] <MaikKlein> bc.cc.tc(); haha
[00:18:54] <aatch> thiez, it would be less of a problem if trans was laid out sanely.
[00:19:15] <thiez> right now it's very hard to start working on the compiler code because you have to learn a dozen things just to get started, and on most of them there is no information to be found :)
[00:19:24] <strcat> [exchange 085574f] simplify the exchange allocator
[00:19:24] <aatch> thiez, yep.
[00:19:26] <strcat>  4 files changed, 85 insertions(+), 174 deletions(-)
[00:19:28] <strcat> ;p
[00:19:35] <thiez> go strcat
[00:19:42] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[00:19:43] <doener> MaikKlein: that's too ambiguous. I think "cx" for context is about right, though ctx would also be fine with me
[00:19:44] <thiez> now go forth and benchmark :D
[00:19:48] <strcat> anyway removing the headers is too hard
[00:20:00] <aatch> strcat, yeah, I was just looking at that..
[00:20:50] <doener> strcat: too much opaque boxes all over the place?
[00:21:01] <strcat> doener: yes it's hardcoded in too many places
[00:21:30] <strcat> I honestly think it would be easier to write a new unique pointer with some terrible symbol like ? and then migrate back to ~ ;\
[00:21:38] *** Joins: jpochyla (jpochyla@moz-8D99AE5D.broadband18.iol.cz)
[00:21:48] <strcat> writing a unique ptr is easy
[00:21:53] <strcat> dealing with the existing code is a HUGE pain
[00:21:55] * doener will some day get his usage of much/many fixed up
[00:22:22] <thiez> rewrite trans and fix everything :p
[00:22:33] <aatch> thiez, it's occurred to me.
[00:22:39] <aatch> but it's just so big.
[00:22:59] <aatch> Though that's a big part of the problem.
[00:23:03] <aatch> it really shouldn't be
[00:23:05] <thiez> perhaps it could be smaller
[00:23:20] <aatch> codegen should actually be relatively simple.
[00:23:34] *** Quits: jpochyla (jpochyla@moz-8D99AE5D.broadband18.iol.cz) (Ping timeout)
[00:24:12] <MaikKlein> what is correct, many atoms or much atoms?
[00:24:24] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[00:24:27] <aatch> MaikKlein, 'many'
[00:24:29] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[00:24:44] <MaikKlein> so you also say there is many sand?
[00:25:03] <aatch> MaikKlein, no, but I also don't say 'sands'
[00:25:38] <aatch> rule of thumb, if it can be pluralized, use many, otherwise, much.
[00:25:54] <thiez> sand is like rice
[00:26:03] <MaikKlein> oh I thought I use many if it is countable
[00:26:13] <doener> same thing
[00:26:17] <aatch> MaikKlein, yeah
[00:26:29] <MaikKlein> ????
[00:26:38] <MaikKlein> ok I say many atoms but not many sands?
[00:26:41] <MaikKlein> sand*
[00:26:42] <aatch> 'sand' is actually the the word for many grains of sand
[00:26:43] <MaikKlein> ah
[00:26:51] <MaikKlein> hm
[00:26:56] <mnemotic> aka collective noun
[00:27:04] <strcat> ~ is so bad atm :[
[00:27:23] <strcat> VALGRIND_COMPILE takes so damn long
[00:27:24] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Quit: Leaving)
[00:27:29] <MaikKlein> from now on I just speak in rust
[00:27:32] <doener> MaikKlein: it's like "viel Sand" vs. "viele Sandk√∂rner" in German
[00:28:04] *** Quits: Palmik (palmik@moz-CC484FDD.tmcz.cz) (Quit: Lost terminal)
[00:28:05] <MaikKlein> doener, ah k
[00:28:15] <strcat> thiez: https://github.com/thestinger/rust/commit/42720d284affe3d8cecefda36e06d31b4450a3c5 anyway pretty trivial
[00:28:49] <aatch> 'much' is also used more as an adverb, 'I didn't like that much'
[00:29:05] <strcat> now if only ~fn wasn't so stupid
[00:29:08] <thiez> strcat: are you going to submit a PR for that?
[00:29:10] *** Joins: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca)
[00:29:18] <thiez> or is it just a proof-of-concept
[00:29:19] <strcat> thiez: yes but first I want to make another attempt at killing the header
[00:29:25] <strcat> this part is simple, it can land as-is
[00:29:47] *** Quits: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk) (Quit: leaving)
[00:30:05] <thiez> it's nice how much code can just disappear with these changes
[00:30:17] <thiez> +44 -134 is always good news :D
[00:30:24] <engla> nice strcat. since the life of ~ is know statically, it really should be slimmer
[00:30:35] <strcat> engla: it should be malloc/free
[00:30:36] <engla> the header
[00:30:38] <strcat> it shouldn't have a header
[00:30:40] <strcat> at all
[00:30:46] <strcat> you can write a replacement without one
[00:30:49] <engla> yeah. does that work with fail as well?
[00:30:57] <strcat> engla: yes it works fine with fail
[00:30:58] <aatch> why wouldn't it?
[00:31:01] <strcat> destructors work fine
[00:31:15] <strcat> the implementation of ~ is embarrassing ;\
[00:31:34] <strcat> exchange heap not empty on exit
[00:31:37] <strcat> -3 dangling allocations
[00:31:39] <engla> just asking aatch 
[00:31:39] <strcat> heh
[00:31:41] <strcat> just going to remove that check
[00:32:06] *** Joins: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk)
[00:33:08] *** Quits: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP) (Quit: carllerche)
[00:33:19] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[00:34:33] <strcat> afaict that means we were hiding 3 memory leaks anyway
[00:34:48] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[00:34:51] <aatch> strcat, wouldn't surprise me...
[00:34:59] <strcat> which makes sense, I see an 8 byte leak from valgrind for all rust programs
[00:35:31] *** Quits: eholk (eholk@moz-9AB4D52F.hsd1.ut.comcast.net) (Quit: eholk)
[00:36:09] <thiez> can't be a ~ box then
[00:36:24] <thiez> could the leak be in the runtime?
[00:36:30] <strcat> right but the C++ part of the exchange allocator doesn't necessarily allocate ~ boxes
[00:36:49] <strcat> thiez: it is
[00:36:53] <thiez> we should really get rid of that C++ stuff :D
[00:37:14] <strcat> sure, but right now I want to make ~ slightly less slow
[00:37:31] *** Quits: roo (jesse.rudo@moz-FAF2828A.dynamic.ip.windstream.net) (Ping timeout)
[00:39:10] *** Quits: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de) (Ping timeout)
[00:39:36] *** Joins: brson (brson@2557E599.66715431.D25A875A.IP)
[00:39:36] *** ChanServ sets mode: +o brson
[00:39:38] <thiez> I feel slightly less bad for having used malloc in rust now
[00:40:03] <bjz> mark_edward: ping
[00:41:02] <thiez> is anyone working on crosscompiling to ARM (especially for the raspi)?
[00:42:01] *** Joins: jyeo (user@moz-FEFE526F.cpe.net.cable.rogers.com)
[00:42:02] *** Quits: mindginative (mindginati@moz-90AB6445.dyn.cust.vf.net.nz) (Quit: zzZZZ)
[00:42:14] <Luqman> thiez: i was successful with getting rust to work on an arm board with debian and there was a pull sometime ago to add arm linux as a target
[00:43:38] <thiez> Luqman: what is the correct invocation to get rustc to crosscompile for arm? I couldn't find a list of supported cpu-manufacturer-kernel[-os] combinations
[00:43:44] <strcat> thiez: http://ix.io/6qj here you go
[00:43:45] *** Quits: jyeo (user@moz-FEFE526F.cpe.net.cable.rogers.com) (Ping timeout)
[00:43:48] <strcat> a safe, proper unique ptr ;p
[00:43:49] <strcat> oh wait
[00:43:52] <strcat> sec
[00:43:58] <strcat> lemme make it 8-byte instead of 8-byte + 8-byte drop flag
[00:44:22] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Quit: jmgrosen)
[00:44:28] <engla> nice
[00:45:06] <aatch> yeah, adding a single attribute #[unsafe_no_drop_flag] was pretty good.
[00:45:17] <thiez> strcat: but it doesn't drop T, does it?
[00:45:24] <strcat> thiez: it does
[00:45:24] <Luqman> thiez: arm-linux-gnueabihf
[00:45:26] <aatch> thiez, it does
[00:45:28] <strcat> that's what ptr::replace_ptr accomplishes
[00:45:32] <thiez> ah, nice
[00:45:38] <strcat> thiez: http://ix.io/6qk here, fixed
[00:45:39] <thiez> well then this is pretty awesome :p
[00:45:41] <strcat> thiez: that makes it 8-byte
[00:45:54] <Luqman> thiez: you can see all the supported platforms in mk/platform.mk
[00:45:56] <strcat> thiez: so that's perfect, all it's missing is sugar for borrows/deref
[00:46:03] <strcat> have to do
[00:46:09] <strcat> *x.borrow_mut() = 10
[00:46:10] <thiez> Luqman: awesome, I'll have a look
[00:46:22] <strcat> anyway it's memory safe and as fast as a ptr + malloc/free
[00:46:32] <thiez> strcat: perhaps we can make ~ a library type in preparation of making @ a library type ;)
[00:46:35] <strcat> ~T not containing @ should be exactly like that
[00:46:57] <aatch> thiez, well having a Pointer trait would be nice.
[00:47:04] <thiez> it would be
[00:47:10] <aatch> then Unique would be a lang item, implementing it.
[00:47:14] <thiez> and a #[lang(Unique)]
[00:47:28] <aatch> thiez, well, #[lang="unique"], but yes
[00:47:56] <thiez> I wonder how hard that would be to implement
[00:48:27] <aatch> thiez, not sure, it's the borrowing and de-refing in the trait that's the hard bit.
[00:48:29] <thiez> probably not that bad if it weren't for the current ~-stuff
[00:48:45] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[00:48:47] * strcat needs to steal a buildbot
[00:48:55] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[00:48:55] <ghrust> 01[13rust01] 15thestinger created 06exchange (+1 new commit): 02http://git.io/Bhdtqw
[00:48:55] <ghrust> 13rust/06exchange 1463cda3d 15Daniel Micay: simplify the exchange allocator...
[00:48:55] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[00:49:10] <thiez> strcat: yes, those things can build so fast compared to my silly vm :(
[00:49:18] <strcat> well I can build faster but...
[00:49:30] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[00:49:41] <thiez> not that nice to have your machine building constantly if you plan to use it
[00:49:52] * strcat doesn't want to watch something else build
[00:49:55] <strcat> already have one going
[00:50:03] <strcat> so that'd be not doing anything else ;p
[00:50:37] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[00:50:46] *** Joins: samx (sami@moz-369757A0.pp.htv.fi)
[00:51:23] *** Quits: samx (sami@moz-369757A0.pp.htv.fi) (Quit: This computer has gone to sleep)
[00:52:05] <strcat> anyway lets see if those silly prev/next ptrs are ever used
[00:52:18] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[00:52:33] <aatch> strcat, not in ~
[00:52:41] <strcat> s/used/read/
[00:52:49] <strcat> as in will it be valgrind clean
[00:52:50] <doener> only in the annihilator IIRC
[00:53:23] <strcat> brson: you around?
[00:54:25] <strcat> oh you are :)
[00:56:03] *** Joins: vk (chatzilla@F92596F.2DEF7520.EF7679FA.IP)
[00:57:14] <strcat> brson: the assert in the free call will mean LLVM won't optimize away moves
[00:58:00] <aatch> strcat, has #[mutable] been renamed yet?
[00:58:04] <strcat> it has to be able to see a raw free call on free(nullptr) for the isFreeCall optimizations to kick in
[00:58:11] <strcat> aatch: yes
[00:58:11] *** Joins: hjr3 (hradtke@54B05067.8A23C5CC.BCAEBB33.IP)
[00:58:30] <strcat> and doesn't assert! fail?
[00:59:17] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[00:59:22] <doener> strcat: doesn't it already optimize away the whole drop glue because of the 0 check?
[00:59:41] *** Joins: tziki (tom@5C41A1B9.BACDF5FB.BFD1ABFD.IP)
[00:59:43] <strcat> doener: no because of undef behaviour
[00:59:55] <strcat> but there shouldn't be a zero check
[01:00:14] <strcat> unless T has a destructor
[01:00:36] <strcat> it doesn't like our transmutes
[01:01:07] <aatch> strcat, I think that change you made goes towards fixing that though.
[01:01:19] <strcat> aatch: well transmute is still broken
[01:01:32] <doener> strcat: https://gist.github.com/dotdash/2dfd8c6a401eed99a7a0 -- drop optimized away in main
[01:02:23] <strcat> doener: yes, except for ~int it shouldn't have that check
[01:02:23] <aatch> strcat, yeah, but I think that it will at least stop it complaining about it in exchange_free
[01:02:28] <strcat> so it won't be optimized away
[01:02:42] <brson> strcat: I don't know what you mean by 'raw free call'
[01:02:42] <strcat> doener: there is a check in global_heap::free
[01:02:53] <strcat> brson: the call to the actual free function
[01:03:24] <strcat> brson: http://llvm.org/docs/doxygen/html/MemoryBuiltins_8cpp_source.html#l00308 LLVM special cases it
[01:03:41] <strcat> atm there are multiple layers
[01:03:50] <brson> strcat: why does removing a null pointer check make this into a 'raw free call'?
[01:04:13] *** Quits: tziki (tom@5C41A1B9.BACDF5FB.BFD1ABFD.IP) (Quit: Leaving)
[01:04:23] *** Joins: etw (john@moz-B2936CAB.nyc.res.rr.com)
[01:04:38] <doener> strcat: same thing with ~5, free is optimized away
[01:04:48] <doener> the whole drop glue is gone from main
[01:04:49] <strcat> doener: yes, *now*, because we have 3 layers of null checks
[01:05:12] <strcat> one in drop glue, one in global_heap::free, one in free itself
[01:05:20] <strcat> it sees the drop glue one
[01:05:38] <strcat> and I'm going to stop emitting that except for types with destructors
[01:06:11] <strcat> so the assert in global_heap::free will start failing
[01:07:33] <strcat> brson: I want unique pointers for types not containing @ to be identical to http://ix.io/6qk - no headers, compatible with FFI, etc.
[01:07:56] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[01:08:01] *** Joins: Thad (chatzilla@moz-C35F90AE.tx.res.rr.com)
[01:08:17] <strcat> if a C function returns a malloc'ed thing, you should just be able to transmute it to ~T
[01:08:39] <strcat> rather than having a weird header + offset
[01:08:55] <brson> strcat: does that have anything to do with the null pointer check in free?
[01:09:35] <strcat> brson: well it should just be in one place, ideally
[01:09:49] <strcat> brson: the exchange_free lang item also has a comment saying it really shouldn't fail
[01:10:17] <brson> strcat: so there are null pointer checks in the drop glue and you want to move those into malloc itself?
[01:10:28] <strcat> brson: well actual free is defined on null as a no-op
[01:10:34] <strcat> in the C standard
[01:10:42] <brson> i know that
[01:10:48] <strcat> but types with destructors still need the null check in glue
[01:11:21] <strcat> brson: I could just move the check from the glue into free itself and remove the compiler's knowledge of dropping exchange allocs ;\
[01:11:22] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[01:11:30] <strcat> (free as in exchange_free and local_free)
[01:13:23] <strcat> brson: it's just a pain that it compiles to 'if x.is_not_null() { if x.is_null() { fail!() } free(x) } and free has a check itself
[01:14:55] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[01:15:35] <strcat> treemap is 3x slower with ~T than malloc/free directly :(
[01:15:57] <brson> strcat: not because of the null checks, surely. are you planning to remove the check from the drop glue?
[01:16:34] <strcat> brson: for types without destructors, yes
[01:16:41] *** Quits: feduser (feduser@EA67B848.BC74D.799BF54A.IP) (Ping timeout)
[01:16:50] <strcat> most calls to free are free(null) atm
[01:16:55] *** Joins: bytbox (s@moz-D4F26CEB.hsd1.md.comcast.net)
[01:17:15] <strcat> and when niko's changes land, LLVM will see the actual free it knows about instead of our wrappers
[01:17:39] <brson> strcat: there will always need to be a  non-inlinable wrapper around free
[01:17:47] <strcat> brson: why?
[01:17:59] <brson> because it has to switch stacks
[01:18:09] <strcat> brson: but we're switching away from that
[01:18:24] <brson> no, were just changing the mechanism
[01:19:17] <brson> in fast_ffi there's still a wrapper function that indicates to __morestack that we must be running on a large stack segment, and that wrapper can't be inlined or else the large-stack-segment requirement is then propagated to the outer function
[01:19:27] <brson> and if that happens then all tasks will effectively be running on big stacks
[01:19:56] <strcat> brson: but not once https://github.com/mozilla/rust/pull/6661 lands afaik
[01:20:16] <strcat> in the IR right now there's just a thin wrapper around free
[01:20:24] <strcat> LLVM asks for the stack size increase itself
[01:20:35] <Thad> brson: Is there ANY notes at all on how to attempt to cross compile build x86_64-w64-mingw32 Rust Build ??  I have my MinGW64 toolchain in place now but get error about CPU you selected does not support x86_64 instructions set: : http://pastebin.mozilla.org/2578484
[01:21:29] <brson> strcat: I'll give it a look, but if that's the case it's wrong
[01:21:29] <Thad> brson: I know you told me once to build 32 bit Rust successfully stage 0 then use that somehow...
[01:21:49] *** Quits: bytbox (s@moz-D4F26CEB.hsd1.md.comcast.net) (Ping timeout)
[01:22:16] <strcat> brson: http://ix.io/6qm is the IR from http://ix.io/6qn
[01:23:15] <strcat> brson: it puts attributes #0 = { fixedstacksegment noinline nounwind }
[01:23:19] <strcat> on the free wrapper
[01:23:25] <strcat> it could put it on the actual free call and avoid the wrapper
[01:23:57] <strcat> afaik that's what niko's changes do among other things
[01:24:37] *** Joins: z0w0 (zack@moz-730D2B29.lnse3.woo.bigpond.net.au)
[01:24:46] <strcat> heh we still output .rc in the actual IR
[01:24:53] <steven_is_false> bblum: ping?
[01:25:03] *** Joins: tupshin (quassel@moz-E7B03838.c3-0.nyr-ubr1.nyr.ny.cable.rcn.com)
[01:26:48] *** Joins: bytbox (s@moz-D4F26CEB.hsd1.md.comcast.net)
[01:28:11] <acrichto> r? https://github.com/mozilla/rust/pull/7409
[01:29:55] <brson> strcat: I left a comment on niko's pull
[01:30:23] *** Quits: vk (chatzilla@F92596F.2DEF7520.EF7679FA.IP) (Ping timeout)
[01:30:28] * strcat thinks there are 3 things using the header
[01:31:03] <strcat> ~fn reads/writes the tydesc, duplicate copies the tydesc, and *something* reads that stupid -1 vs -2 field
[01:31:10] <strcat> related to the annihilator
[01:31:23] * strcat doesn't know what to do about ~fn ;(
[01:31:35] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[01:31:49] <doener> strcat: something == vec::reserve
[01:32:04] <strcat> doener: I don't think vec reserve uses this exchange alloc though
[01:32:04] *** Quits: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP) (Quit: carllerche)
[01:32:09] <strcat> this is just for ~
[01:32:14] <strcat> the C++ one is used for vectors too, I guess
[01:32:32] <aatch> strcat, ~-containing-@ is on the local heap though
[01:32:39] <strcat> aatch: yep but that's not exchange alloc
[01:32:53] <strcat> it knows to call local_alloc
[01:33:08] <strcat> anyway this is just to stop initializing the header
[01:33:15] <strcat> actually removing it is another project ;p
[01:33:25] <thiez> strcat: why would ~fn write to the tydesc?
[01:33:33] <strcat> thiez: it stores the size of what it captures
[01:33:39] <strcat> it's evil
[01:33:54] <strcat> don't know what to do about it
[01:34:00] <strcat> split exchange_alloc and unique_alloc? :\
[01:34:00] <thiez> when does it actually need that size?
[01:34:05] <aatch> and silly, because it's known at compile time
[01:34:07] <strcat> thiez: dunno but it reads it and dies
[01:34:21] <doener> strcat: doesn't the normal ~ path generate a call to "exchange_malloc", which calls global_heap::malloc?
[01:34:45] <strcat> doener: if the ~ doesn't have TypeContents containing TC_MANAGED
[01:34:52] *** Quits: bytbox (s@moz-D4F26CEB.hsd1.md.comcast.net) (Ping timeout)
[01:35:18] <strcat> if it does it will use local_alloc
[01:35:28] *** Joins: vk (chatzilla@66D44E2E.B568D26C.93B001FA.IP)
[01:35:34] <strcat> local_malloc*
[01:36:16] <brson> Thad: to do a cross-compile you'll want to configure with `--target-triples=i686-pc-mingw32,x86_64-w64-mingw32`
[01:36:17] <doener> oh wait, you didn't mean ~ vs. ~ containing @, but ~ vs. ~[]
[01:36:31] <brson> Thad: mk/platform.mk will need a bunch of defines for the new triple
[01:36:32] <doener> I totally misinterpreted that "this is just for ~"
[01:36:32] *** Joins: feduser (feduser@1A2C4FEE.D610364D.799BF54A.IP)
[01:36:33] <strcat> doener: yeah, I don't think ~[] ever uses rt::global_heap
[01:36:35] <strcat> ah
[01:36:55] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[01:36:55] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/6nfRiA
[01:36:55] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[01:37:18] *** Quits: hjr3 (hradtke@54B05067.8A23C5CC.BCAEBB33.IP) (Quit: Textual IRC Client: www.textualapp.com)
[01:37:24] <brson> strcat: why doesn't ~[] use global_heap? where does it go instead?
[01:37:33] <strcat> brson: pretty sure we still do that all from C++ :(
[01:37:41] <brson> strcat: oh, ok
[01:37:41] <strcat> so it uses the C++ exchange allocator
[01:37:58] <strcat> it could easily be rewritten, but we need a realloc in global_heap
[01:38:06] <brson> wait, I'm not sure how
[01:38:13] <brson> my branch does have realloc
[01:38:35] <brson> what call does the compiler emit to allocate ~[]? surely not something to C++
[01:38:51] <brson> std::vec does still use the C++ runtime occasionally
[01:38:55] <brson> for allocating
[01:39:00] <strcat> brson: ah
[01:39:04] <strcat> brson: not sure then.
[01:39:11] <strcat> I know there's that old tvec stuff in the compiler
[01:39:26] *** Joins: hjr3 (hradtke@54B05067.8A23C5CC.BCAEBB33.IP)
[01:39:57] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[01:39:58] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/9OyC_g
[01:39:58] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[01:40:12] <doener> brson: alloc is via exchange_malloc/malloc lang items, realloc is via C++
[01:40:32] <brson> doener: ok, that squares with my beliefs
[01:40:44] <Thad> brson: ok, I did both of those already.
[01:41:00] <strcat> brson: and ~[@T] correctly uses local_alloc, right?
[01:41:01] <brson> and my branch doesn't actually rewrite exchange realloc in Rust, I was thinking local realloc
[01:41:02] <strcat> doener: *
[01:41:37] <doener> strcat: right, std::unstable::lang::local_alloc is the malloc lang item
[01:41:48] <strcat> doener: I think I'll add std::unstable::intrinsics::is_managed to replace that check
[01:42:01] <strcat> I wonder what graydon is doing about it though
[01:42:04] <strcat> in the gc branch
[01:42:35] <brson> strcat: looks like it, yes
[01:42:56] *** Joins: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP)
[01:42:56] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/9OyC_g
[01:42:56] *** Parts: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP) ()
[01:42:57] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[01:42:57] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/wTO3qw
[01:42:57] <ghrust> 13rust/06auto 147971202 15Philipp Br√ºschweiler: ctags: add macros
[01:42:57] <ghrust> 13rust/06auto 14a2227f9 15Philipp Br√ºschweiler: librustc: don't skip ahead when computing register types of SSEFloatVectors...
[01:42:57] <ghrust> 13rust/06auto 143017343 15bors: auto merge of #7457 : Blei/rust/fix-ffi-floats, r=cmr...
[01:42:59] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[01:43:11] <doener> strcat: nothing, apparently. https://github.com/graydon/rust/blob/gc/src/libstd/vec.rs#L78
[01:43:32] <brson> Thad: what does VERBOSE=1 say? something must be wrong with the makefile since it's erroring during the i686 build, not the x86_64
[01:43:40] <Thad> brson: do I have to have my i686-pc-mingw32 version of Rust already BUILT to cross-compile with that --target-builds line ?
[01:43:41] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[01:44:09] <strcat> brson: would having the allocator written in rust be a lot better?
[01:44:10] <Thad> brson: (i'm checking on the VERBOSE=1 now)
[01:44:15] <brson> Thad: no, it should build i686-pc-mingw32 first, then the 64-bit after
[01:44:18] <strcat> I wonder how hard it would be to translate jemalloc
[01:44:23] <strcat> seems like it could just be automated
[01:44:30] <Thad> brson: AH, cool, first then second
[01:44:46] <strcat> now that we have atomics
[01:45:20] * strcat wonders how hard translating libclang's AST to unsafe rust would be ;p
[01:45:35] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[01:46:00] <Thad> brson: I (btw) do get some popup errors for conftest.exe during the configure... but I just click on both of them OK and it completed the configure.
[01:46:02] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[01:46:22] <SiegeLord> I know it isn't working now... but can it in principle possible to infer which enum variant you mean when you have to identical ones?
[01:46:30] <Thad> brson: now just "make VERBOSE=1" ??
[01:46:56] <aatch> SiegeLord, so if you have enum Foo { Var }; and enum Bar { Var }, it knows which Var?
[01:46:56] <SiegeLord> Like you had two enums, enum A { V } and enum B { V }. I'd like let a : A = V; to work
[01:47:14] <aatch> SiegeLord, in principle, yes.
[01:47:20] <SiegeLord> And equivalently when you match a { V => ... }
[01:48:03] <strcat> brson: I don't really understand why LLVM would bubble up that attribute
[01:48:12] <strcat> is it intended?
[01:48:38] <Thad> brson: ok... somethings weird... throws the same CPU does not support x86-64 instruction set.. http://pastebin.mozilla.org/2578484
[01:48:41] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[01:49:12] <cmr> Thad: are you working on a x64 windows port?
[01:49:16] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[01:49:20] <Thad> cmr: yeap
[01:49:22] <cmr> fantastic!
[01:49:25] <Thad> lol
[01:49:35] <Thad> toolchain in place and WORKING !
[01:49:45] <Thad> but Rust Build is ... blah
[01:49:59] <cmr> now all you need to do is port to MSVC and you'll be a windows hero :P
[01:50:22] * cmr goes back to ped
[01:50:32] <Thad> save that for someone who has USED MSVC in the last 8 years... (not I)
[01:50:49] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Ping timeout)
[01:50:51] <Jeaye> Blegh
[01:51:00] <SiegeLord> I wish it just worked with any MinGW version
[01:51:10] <brson> strcat: writing malloc in rust would be a cool exercise and would allow some allocations to be done without jumping to a big stack. very risky though. jemalloc is already highly tuned. we could instead try to compile it with split stacks
[01:51:15] <SiegeLord> I don't like rust disrupting my non-Rust MinGW work
[01:51:15] *** Quits: hjr3 (hradtke@54B05067.8A23C5CC.BCAEBB33.IP) (Quit: My MacBook has gone to sleep. ZZZzzz‚Ä¶)
[01:51:17] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[01:51:47] <Thad> SiegeLord: we'll work on that later ... I feel the pain also at times.
[01:51:49] <strcat> brson: well I mean just porting jemalloc to rust mechnically
[01:51:50] <Jeaye> Rust is so gloriously easy to install on Linux. <3
[01:52:11] <brson> Thad: that's the same pastebin link
[01:52:19] <brson> no new output
[01:52:20] <Thad> it's the EXACT same output
[01:52:20] <strcat> brson: mmap would still be a call to C though since we don't have all the magic to do syscalls
[01:52:37] <strcat> but syscalls don't use stack so I'd hope that glibc doesn't use much for the mmap wrapper
[01:52:46] <brson> we would probably want to write the syscall directly if we're going through all that trouble to avoid the C stack switch
[01:52:56] <aatch> strcat, what magic is needed for the syscalls?
[01:53:03] <strcat> aatch: on modern linux you have to find the vd.so
[01:53:11] <brson> yeah, maybe the mmap call could be in the red zone
[01:53:14] *** Joins: hjr3 (hradtke@54B05067.8A23C5CC.BCAEBB33.IP)
[01:53:22] <strcat> aatch: https://en.wikipedia.org/wiki/VDSO
[01:53:41] <Thad> brson: Call me stupid... your right.. here's the NEW error trace: http://pastebin.mozilla.org/2578579
[01:53:59] <strcat> aatch: it's just some magical virtual shared object
[01:54:07] <strcat> if you actually do the syscall yourself it'll be slow
[01:54:46] <aatch> strcat, got a more relevant link?
[01:54:56] <strcat> aatch: uh. maybe lwn about how gettimeofday works now
[01:54:58] <strcat> sec
[01:55:32] <strcat> aatch: https://lwn.net/Articles/446528/
[01:55:51] <strcat> ' To address that concern, the kernel allows the page containing the current time to be mapped read-only into user space; that page also contains a fast gettimeofday() implementation.'
[01:55:59] <strcat> anyway stuff like that is why you don't want to do it yourself
[01:56:06] <brson> Thad: the command line looks write to me. does it work in the non-cross-compile scenario? maybe the toolchain you have available is x86_64 only?
[01:56:44] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[01:57:03] <Thad> brson: hmm, I thought it said multilib... which means both... how to make super sure ?
[01:57:19] <aatch> strcat, cool, I've been looking for a project that isn't painfully boring or incredibly difficult.
[01:57:51] <strcat> aatch: well if you teach rust to make calls through vdso, that's a long way to not needing libc so much
[01:57:55] <strcat> but need other platforms too ;p
[01:57:57] <mark_edward> bjz:  ping
[01:58:23] <bjz> mark_edward: you need to do finalize -> drop
[01:58:32] <bjz> mark_edward: in rust_curl
[01:58:53] *** Quits: hjr3 (hradtke@54B05067.8A23C5CC.BCAEBB33.IP) (Quit: My MacBook has gone to sleep. ZZZzzz‚Ä¶)
[01:59:33] <brson> Thad: does it work if you don't add the x86_64 target triple? I suspect it does not
[01:59:45] <strcat> brson: are we actually supposed to fail!() on OOM? doesn't it allocate?
[01:59:52] <Thad> just try i686 ?  k
[02:00:07] <strcat> seems like it'd infinite loop or something
[02:00:12] <mnemotic> what is the meaning of the single-quote in this: `type Pair<'self> = (int,&'self str);`? i skimmed the manual but got no hits
[02:01:43] <Thad> brson: ah, there's a different gcc for x86_64 ... check out this screencapture of the mingw64 folder on my system : https://docs.google.com/file/d/0B533WzlrxWraSzhvNWNBbEJVem8/edit?usp=sharing
[02:02:26] <engla> mnemotic: 'self is a lifetime parameter.
[02:03:58] <brson> strcat: no, we should abort on OOM
[02:04:05] <engla> mnemotic: section 8 and 9, http://static.rust-lang.org/doc/tutorial-borrowed-ptr.html
[02:04:23] <strcat> brson: atm it uses fail! or assert!
[02:04:32] <brson> strcat: would be nice to fail gracefully, but we haven't done the diligence to make it work
[02:04:49] <strcat> brson: doesn't that mean making destructors not allocate too?
[02:05:06] <mark_edward> bjz: thanks, i'll get on it
[02:05:15] <strcat> and they could trigger an alloc through a stack segment alloc
[02:05:22] <brson> strcat: well, if fail! fails then it fails catastrophically - I assume *something* happens to make the process abort when we OOM
[02:05:40] <brson> but you're right we should be more careful about which fail macro we use
[02:05:47] <strcat> brson: well on linux we get killed, but on windows it seems like it could keep looping
[02:05:48] <brson> rtassert! and rtabort! would be appropriate there
[02:06:23] <strcat> ah, rtassert is a thing?
[02:06:32] <mnemotic> engla: cheers! i'll read through that
[02:07:19] <brson> strcat: there are a few runtime macros in std::macros that don't try to unwind
[02:07:54] <brson> in master it's just abort!, not rtabort!
[02:08:43] <strcat> hrm I think I have to use libc::abort because that allocates too
[02:09:22] <strcat> but maybe we don't even have non-allocating printing atm.
[02:09:33] <mark_edward> bjz:  done
[02:09:56] <brson> strcat: then you probably need your own #[rust_stack] binding to abort
[02:11:08] <brson> Thad: i don't have permission to view that doc, but it sounds like the different gcc binaries could be specified in mk/plattform.mk
[02:13:48] <SiegeLord> The "variable does not need to be mutable warning" has prevented like 5 bugs in my code
[02:13:52] <SiegeLord> Rust is awesome
[02:14:11] <Thad> brson: sorry, the link works now for the screenshot
[02:14:29] *** Joins: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de)
[02:15:25] <etw> is there a way to include all modules in a path, .e.g: instead of mod m1; mod m2; mod m3; do something like mod m*; ?
[02:16:57] <brson> still don't have a working prerelease tarball
[02:17:27] <brson> Thad: what binary does `g++` alias to?
[02:17:53] <brson> Thad: maybe you can reproduce that failing build command and figure out what extra args gcc wants to do a 32-bit build
[02:18:15] <Thad> brson: yeah, its the figuring out that's throwing me off
[02:18:35] *** Quits: illissius (illissius@moz-19397A63.catv.broadband.hu) (Quit: )
[02:18:55] <brson> Thad: can you link the toolchain you are using?
[02:19:10] <Thad> brson: dunno how
[02:19:41] <steven_is_false> Dangit! I can't experiment with --opt-level=3 on Rust because rust doesn't accept both -O, and --opt-level=3!
[02:20:11] <doener> steven_is_false: what would be the point? -O means --opt-level=2
[02:20:15] <Thad> I'm using the mingw-builds from sourceforge ...  I copied it's extracted folder to C:\mingw64
[02:20:22] *** Quits: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de) (Client exited)
[02:20:30] <steven_is_false> doener: A makefile, so the default options can be overridden.
[02:20:43] <brson> Thad: you said you were using a multi-arch mingw toolchain. can you post an http link?
[02:21:04] <strcat> mingw-w64 ?
[02:21:05] <steven_is_false> For example, in a makefile rule one might do rustc $(DEFAULT_OPTIONS) $(USER_OPTIONS)
[02:21:16] <steven_is_false> or something along those lines
[02:21:42] <strcat> brson: http://mingw-w64.sourceforge.net/download.php#automated-builds
[02:22:01] <strcat> dunno if those are cross-arch-compilers
[02:22:04] <Thad> here's the one that I am NOT using.... http://www.drangon.org/mingw/
[02:22:10] <doener> steven_is_false: use flags to control which opt level you get. With rustc, you'd currently use "make CFG_DISABLE_OPTIMIZE=1 RUSTFLAGS=--opt-level=3" (yeah, that looks a bit weird ;-))
[02:22:27] <Thad> Here's the one I AM using... http://www.drangon.org/mingw/
[02:22:30] *** Quits: Nisstyre (wes@moz-FD86289.netflash.net) (Quit: Leaving)
[02:22:40] <steven_is_false> doener: I tried that and it doesn't work.
[02:23:05] <steven_is_false> Oh I see what you mean.
[02:23:06] <Thad> strcat: NO... that's not one that you really should use I found out for Win7 64 systems.
[02:23:16] <strcat> Thad: really?
[02:23:21] <steven_is_false> Yeah that'd work. Thanks. It's still arguable a bug though.
[02:23:24] <strcat> afaik mingw-w64 is very well maintained
[02:23:33] <Thad> strcat: do you SEE anything that can RUN on Windows in there ?
[02:23:40] *** Joins: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de)
[02:23:54] <MaikKlein> was there a very recent module change?
[02:23:54] <strcat> Thad: yes
[02:24:20] <strcat> Mingw-builds provides native toolchains for Windows. Builds are based on trunk version of the mingw-w64 runtime. It has an online installer.
[02:24:27] <Thad> brson: blasted... here's the one I am using now:  http://sourceforge.net/projects/mingwbuilds/
[02:24:34] <doener> steven_is_false: yeah, somthing like "make OPT_LEVEL=whatever" would probably be better
[02:24:34] <strcat> Thad: yeah that's mingw-w64
[02:24:40] <Thad> strcat: brson: sorry for the confusion... 
[02:25:02] <brson> open milestone issues have gone down in the last two weeks https://docs.google.com/a/mozilla.com/spreadsheet/ccc?key=0AlWBWplsaTZvdEExUmtpXzdQa01hbjJPRjY2LVZrLVE#gid=1
[02:25:03] <Thad> mingwbuilds is the one I am using.... I was not sure about drangon...
[02:25:27] *** Joins: roo (jesse.rudo@moz-FAF2828A.dynamic.ip.windstream.net)
[02:25:43] <Thad> strcat: yeah, but it's a .exe install version that extracts to a folder.  EASY for Windows users to just drag and drop to C:\ drive
[02:26:07] <strcat> Thad: it's listed on the automated builds page
[02:26:13] <strcat> seems to be the official builds
[02:26:20] <Thad> I then only had to modify and add an "export ... " to my MinGW bash /etc/profile file.
[02:26:37] <Thad> strcat: which one can work on Win7 64bit ?
[02:27:04] <brson> Thad: does this gcc support the -m32 flag?
[02:27:54] <Thad> brson: hmm... it says it does looking through the output of the ./configure
[02:28:14] <strcat> brson: could the snapshots just come with clang? and use that
[02:28:26] <strcat> I guess you still need mingw for windows though
[02:28:31] *** Joins: jyeo (user@moz-FEFE526F.cpe.net.cable.rogers.com)
[02:28:34] <brson> Thad: try reproducing the failing build command but adding -m32
[02:28:41] <strcat> for libstdc++, bash, make
[02:29:28] <Thad> brson: on the configure command ?  or the make ?
[02:30:23] * strcat hates how verbose adding an intrinsic is
[02:30:37] <brson> Thad: do a `make VERBOSE=1`, copy the gcc command that's failing and add -m32. `make CFLAGS=-m32` might work as well
[02:30:47] <brson> `make CFLAGS=-m32 VERBOSE=1`
[02:30:49] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[02:30:51] <brson> or CXXFLAGS
[02:31:32] <brson> cmr: thanks for twir4. some stuff there I missed
[02:31:41] <Thad> strcat: yeah, your link is a special download page that the MinGW-w64 project guys setup... has a bit of instructions... which then take you to the same download... on Windows it chooses the mingw-builds-install.exe to download with a Green Button automatically.
[02:31:46] * strcat just realized what twir stands for
[02:32:02] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[02:33:20] <MaikKlein> ok mhh
[02:33:41] <MaikKlein> it seems module is broken with extern mod foo
[02:34:11] <Thad> brson: ok... all 3 variations... same output...  http://pastebin.mozilla.org/2578672
[02:36:49] *** Joins: jyeo_ (uid12229@moz-A539DB7D.hillingdon.irccloud.com)
[02:37:22] <mark_edward> I'm so glad you guys went with lower case true and false, as well as "bool"
[02:37:36] <mark_edward> i hate Python True/False and Java boolean
[02:38:15] <strcat> it would be True/False if it was done today with the current naming conventions ;p
[02:38:21] <Thad> brson: I have my modified platform.mk as well... could that cause the problem ? https://docs.google.com/document/d/1OLn2QMwxG5_EDag2YmKfzOqFxgFI9fxq80fbs71X00M/edit
[02:39:04] *** Quits: jyeo (user@moz-FEFE526F.cpe.net.cable.rogers.com) (Input/output error)
[02:39:08] <strcat> doener: anyway I have contains_managed now so... lets see if that works
[02:39:10] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[02:39:10] *** jyeo_ is now known as jyeo
[02:39:22] <Thad> brson: I added the x86_64-w64-mingw32 section...
[02:39:26] * strcat makes sure he added it to type_use and the check thing
[02:39:31] *** Quits: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de) (Ping timeout)
[02:42:38] <strcat> uh
[02:42:51] <strcat> doener: the reserve_shared and reserve_shared_actual naming is... weird.
[02:43:31] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[02:43:31] <ghrust> 01[13rust01] 15thestinger 04force-pushed 06exchange from 1463cda3d to 1472f295d: 02http://git.io/eHgq9A
[02:43:31] <ghrust> 13rust/06exchange 14561a7c1 15Daniel Micay: simplify the exchange allocator...
[02:43:31] <ghrust> 13rust/06exchange 146c6cfd0 15Daniel Micay: add a contains_managed intrinsic
[02:43:31] <ghrust> 13rust/06exchange 1472f295d 15Daniel Micay: vec: use contains_managed instead of box header
[02:43:33] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[02:44:15] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[02:44:19] <brson> Thad: the gcc commands in your pastes do not contain -m32 - the CFLAGS did not propagate through the makefiles
[02:44:30] <brson> a bug in the makefiles
[02:44:40] <Thad> brson:  YES ! ... good to know
[02:45:06] <Thad> did you scan my issue I filed today ?
[02:45:36] <brson> Thad: your platform.mk changes look ok. I don't think they're coming in to play at this stage of compilation. the bulid will need to get through the i686 build first
[02:45:49] <brson> Thad: no, I haven't seen your new issue
[02:45:51] <Thad> brson: good to know again...
[02:46:34] <Thad> brson: https://github.com/mozilla/rust/issues/7491  <-- that's the other weird one.
[02:47:01] <strcat> ugh ~fn is evil
[02:47:30] * strcat doesn't understand that code at all :|
[02:48:24] <strcat> / do.  Hopefully should this ever become an issue we'll have monomorphized
[02:48:25] <strcat> / and type descriptors will all be a bad dream.
[02:48:26] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[02:48:27] <strcat> heh
[02:48:33] <strcat> I guess this predates monomorphizing?
[02:48:35] * strcat sighs
[02:49:00] <strcat> perhaps I should just give ~fn #[lang = "terrible_old_exchange_alloc"] ;[
[02:50:45] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[02:50:50] <strcat> I like how we have a malloc_raw in trans/base.rs that actually calls exchange_alloc or local_malloc
[02:51:21] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[02:51:21] <ghrust> 01[13rust01] 15brson merged 06master into 06dist-snap: 02http://git.io/DnPPKw
[02:51:21] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[02:52:00] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[02:52:00] <ghrust> 01[13rust01] 15thestinger 04force-pushed 06exchange from 1472f295d to 14b500850: 02http://git.io/eHgq9A
[02:52:00] <ghrust> 13rust/06exchange 14b500850 15Daniel Micay: vec: use contains_managed instead of box header
[02:52:00] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[02:53:32] *** Joins: kimundi_ (kimundi@moz-E9BB74CC.dip0.t-ipconnect.de)
[02:53:35] *** Quits: kimundi (kimundi@moz-32D3BEA7.dip0.t-ipconnect.de) (Ping timeout)
[02:53:35] *** kimundi_ is now known as kimundi
[02:54:53] *** Quits: dwrensha (chatzilla@moz-DE44EA45.hsd1.pa.comcast.net) (Ping timeout)
[02:57:06] <brson> Thad: I think i see what's wrong with that issue. I'll put some comments in the bug
[02:57:21] <roo> where/how does rustc get the default lib paths? I am specifically interested in how it figures out the system lib paths (/lib/ /usr/lib, etc).
[02:57:30] <strcat> roo: it uses gcc to link
[02:57:33] *** Quits: mnemotic (niko@8FFD1BD2.9D81E74C.53DF0002.IP) (Ping timeout)
[02:57:37] <Thad> brson: k
[02:57:39] <strcat> and gcc calls ld
[02:58:07] <strcat> and that uses hardcoded paths (/lib if the distro still hasn't done the usr merge, /usr/lib and /etc/ld.so.conf + /etc/ld.so.conf.d/)
[02:58:20] <strcat> can drop a file in /etc/ld.so.conf.d/
[02:58:24] <strcat> with another path
[03:00:03] <strcat> or set LD_LIBRARY_PATH
[03:00:05] *** Joins: whitglint (Mibbit@moz-4DBD374F.hinet-ip.hinet.net)
[03:02:34] <roo> alright. I was expecting it to look in /usr/local/lib as well, probably shouldn't expect it, or its a mingw thing
[03:02:37] <Ralith> what always struck me as weird is how /usr/local/lib/ often wasn't in those defaults
[03:02:47] <Ralith> roo: mingw paths are all kinds of screwy
[03:02:53] <roo> yes :(
[03:03:18] *** Parts: whitglint (Mibbit@moz-4DBD374F.hinet-ip.hinet.net) ()
[03:04:06] <strcat> roo: you also need to run ldconfig when you add a new library
[03:04:13] <strcat> it uses a cache
[03:04:52] <Thad> brson: got the note... thanks.
[03:07:22] <brson> bbl
[03:07:23] *** Quits: brson (brson@2557E599.66715431.D25A875A.IP) (Quit: leaving)
[03:07:26] <Thad> k
[03:10:44] *** Joins: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP)
[03:10:44] <ghrust> 01[13rust01] 15thestinger pushed 1 new commit to 06exchange: 02http://git.io/ikUu1g
[03:10:44] <ghrust> 13rust/06exchange 143f5c1b0 15Daniel Micay: stop initializing ref_count in exchange_alloc
[03:10:44] *** Parts: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP) ()
[03:11:03] * strcat crosses fingers
[03:16:05] <vk> I'm seeing an error ('pthreadGC2.dll is missing') when attempting to run Rust from the cmd.exe on Windows, has anyone else seen this?
[03:17:03] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[03:17:20] <aatch> Yay, snapshot finished compiling.
[03:20:42] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[03:21:00] <strcat> nooooooooooooo
[03:21:18] <strcat> that didn't work
[03:21:28] <strcat> ==10061== 56,388 (80 direct, 56,308 indirect) bytes in 2 blocks are definitely lost in loss record 84 of 87
[03:21:36] *** Joins: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP)
[03:21:54] <strcat> oh
[03:22:04] <strcat> I forgot to use cfg(not(stage0))
[03:22:05] * strcat is silly
[03:22:37] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[03:22:37] <ghrust> 01[13rust01] 15thestinger 04force-pushed 06exchange from 143f5c1b0 to 14678312e: 02http://git.io/eHgq9A
[03:22:37] <ghrust> 13rust/06exchange 14678312e 15Daniel Micay: stop initializing ref_count in exchange_alloc
[03:22:37] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[03:23:43] *** Quits: steven_is_false (user@moz-144077DE.bchsia.telus.net) (Ping timeout)
[03:23:51] *** Joins: Aetherspawn (Aetherspaw@moz-8811D9F0.static.tpgi.com.au)
[03:24:56] <strcat> aatch: need to solve ~fn :(
[03:25:07] <strcat> and then the whole header can be uninit
[03:25:17] <strcat> and that means all we need to do is update offsets in 1000 places :D
[03:25:24] <aatch> strcat, yay?
[03:25:44] <Thad> strcat: can you help me again with setting that damn https in my git ?  forgot the simple command to change from git: to https:
[03:25:58] <strcat> Thad: I just edit .git/config
[03:26:07] <strcat> can't be bothered to learn commands :D
[03:26:11] <doener> strcat: while you're at it, are you gonna fixup with_cacacity to only alloc once instead of twice? If not, I'll put that on my list for tomorrow
[03:26:13] <kini> do you `make clean` every time you want to update your rust build?
[03:26:21] <doener> err, with_capacity
[03:26:39] <Thad> strcat: what a novel idea... thanks !
[03:26:52] <strcat> kini: no, just make
[03:26:57] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[03:27:11] <strcat> shouldn't ever need make clean or even make clean-llvm anymore
[03:27:25] <kini> earlier I had a problem with the build (something about "crates") and was told to run `make clean`
[03:27:41] <strcat> kini: well it has issues when the version is bumped
[03:27:49] <strcat> 0.6 -> 0.7-pre would break the current build sys
[03:27:53] <strcat> but that's not frequent
[03:27:59] <kini> ah, I see
[03:28:00] <strcat> it's a bug though
[03:28:09] <kini> I don't know if I crossed a version bump - I've just been on master
[03:28:27] <strcat> kini: also when crate deps change, it breaks too
[03:28:41] <strcat> core -> std, std -> extra renaming
[03:28:43] <strcat> would have broken it
[03:29:04] <strcat> because the filenames of the .so files have the hash + version and it's too stupid to remove them
[03:29:13] <strcat> so it ends up with ambiguous libs when it tries to link
[03:29:31] <strcat> hash is based on metadata, including deps
[03:29:44] <strcat> and I guess the name...
[03:31:39] *** Joins: kendle (Mibbit@6A61B38D.32E1C8FD.5A11BC7D.IP)
[03:32:13] <strcat> doener: not initializing ref_count seems to work so far.
[03:32:23] <doener> strcat: nice
[03:32:25] <strcat> tydesc is the hard/final one
[03:32:34] <strcat> but I think I know both places that read it so...
[03:32:56] <strcat> unless traits secretly read it
[03:33:10] <doener> drop for ~Traits via opaque box is probably one
[03:33:10] <aatch> strcat, I don't think so.
[03:33:24] <strcat> doener: it should be in the vtable, but maybe it isn't
[03:33:33] <aatch> strcat, it's definately in the vtable.
[03:33:42] <aatch> though whether it uses it....
[03:33:44] <strcat> well, it should read it from the vtable then if it doesn't :)
[03:33:50] <strcat> valgrind will know
[03:34:04] <strcat> it'll give me 100000000 invalid read errors before crashing again
[03:34:18] * strcat has tried this a few times ;p
[03:34:20] <doener> ah, yeah ~Trait does that, it's just @Trait that doesn't
[03:34:28] <strcat> doener: ah good
[03:34:33] <strcat> don't know why they're different but...
[03:34:35] <strcat> ;p
[03:35:14] <strcat> so anyway, ~fn is my current nightmare
[03:35:23] <strcat> I really think I'll have to add another allocator for it
[03:35:41] <strcat> src/librustc/middle/trans/closure.rs 
[03:35:53] <strcat> look at all that tydesc usage
[03:35:55] <strcat> D:
[03:36:15] <doener> Thad: if it's a firewall issue (i.e. you always have to replace git:// by https://) you could use the "insteadOf" config
[03:36:19] <doener> Thad: git config --global url.https://github.com.insteadOf git://github.com
[03:37:08] <strcat>         // Load the size from the type descr found in the cbox
[03:37:16] <strcat> curse you ~fn
[03:38:12] <strcat> aatch: it's because it doesn't know how big ~fn is at compile-time
[03:38:16] <strcat> because the captures are part of the alloc
[03:38:27] <Thad> doener: strcat: omg... github for windows is quite... Awesome.
[03:38:39] <strcat> but anyway I don't have an easy solution beyond rewriting ~fn pretty much completely
[03:38:59] <strcat> or ofc, making it use another allocator
[03:39:27] <aatch> strcat, how does it not know the size of the captures at compile time?
[03:39:34] <strcat> aatch: because you can pass ~fn around
[03:39:40] <strcat> aatch: this is the take glue
[03:39:41] <doener> github for steam-loader you mean? ;-)
[03:39:53] <aatch> strcat, oh right.
[03:39:58] <strcat> bblum: is ~fn actually copyable right now?
[03:40:08] <strcat> I know you plan on having : Clone
[03:40:10] *** Quits: eevee (eevee@moz-58058235.evrt.wa.frontiernet.net) (Connection reset by peer)
[03:41:08] <strcat>                 let closure_ty = ty::mk_opaque_closure_ptr(tcx, sigil);
[03:41:22] <strcat> aatch: I know where it gets created/copied/freed so...
[03:41:44] <strcat> #[lang = "uniq_heap_closure_alloc"] is what I have to do :(
[03:42:06] <Thad> doener: push says I need to use https .. .will git push does
[03:42:19] *** Joins: eevee (eevee@moz-58058235.evrt.wa.frontiernet.net)
[03:42:26] *** Quits: kendle (Mibbit@6A61B38D.32E1C8FD.5A11BC7D.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[03:42:39] <Thad> http://pastebin.mozilla.org/2578871
[03:42:50] <doener> Thad: ah yeah, push over git:// is not usually allowed, due to the lack of authentication
[03:43:05] <Thad> help?
[03:43:15] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[03:43:19] <strcat> doener: well it works with ssh keys
[03:43:34] * strcat uses git:// everywhere
[03:43:43] <doener> strcat: that's git@... then
[03:43:47] <strcat> doener: ah right
[03:43:52] <strcat> git:// is the read-only one, forgot
[03:43:55] <doener> 05:33:58 <doener> Thad: git config --global url.https://github.com.insteadOf git://github.com
[03:44:00] <doener> Thad: just run that
[03:44:11] <Thad> trying...
[03:44:41] <doener> Thad: git will automatically replace "git://github.com" urls with "https://github.com" urls then, without you having to do anything ever again ;-)
[03:45:28] <doener> and since https has become "smart" a few years ago, there's no real downside to it
[03:45:44] <doener> git-over-http(s) that is
[03:45:56] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[03:45:56] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/wTO3qw
[03:45:56] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[03:46:05] <Thad> do I want default matching or default simple ?  it has warning about Git 2.0 switching behavior
[03:46:21] <strcat> matching or simple
[03:46:27] <strcat> either is fine
[03:46:34] <strcat> just not the old terrible way that clobbered stuff
[03:46:52] <doener> the old default is "matching"
[03:47:08] <Thad> 403 error ... unable to access
[03:47:19] <strcat> doener: heh, really? I seem to remember it doing stupid stuff
[03:47:57] <strcat> ah simple is just to force you to use -u to make a branch upstream
[03:48:01] <doener> strcat: matching is "push all branches that exists on both ends", has been the default since like forever. There were many flamewars about it
[03:48:55] <doener> Thad: hrm, that's... interesting?
[03:49:00] <strcat> go bors
[03:49:02] <Thad> it asked for Username and Password... for https://github.com
[03:49:07] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[03:49:07] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/7EFu4w
[03:49:07] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[03:49:13] <strcat> queue almost cleared, thanks to all the ones that failed ;p
[03:49:23] <doener> Thad: that's expected, 
[03:49:28] <doener> for https
[03:49:45] *** Quits: threecreepio (jdp@moz-DB2D70E9.cust.bredbandsbolaget.se) (Quit: threecreepio)
[03:49:58] <strcat> doener: https://github.com/mozilla/rust/blob/678312eebac72f0f9cb0d6f821f2aa13d32df57f/src/libstd/rt/global_heap.rs#L69 at least it's down to this.
[03:50:18] <strcat> anyway that works
[03:50:27] <strcat> time to kill tydesc :)
[03:50:32] <doener> Thad: if you want public key auth via ssh try: git config --global url.git@github.com.pushInsteadOf git://github.com
[03:50:48] <strcat> oh trans is still initializing the header on copies too
[03:50:49] * strcat kills that first
[03:51:04] <Thad> doener: I just want to push a simple change.
[03:52:20] <doener> Thad: ok, let me check your config... do you have push access to mozilla/rust?
[03:52:50] <Thad> wait... I think I got GitHub for Windows working and syncing my changes now...
[03:53:13] <Thad> doener: I don't know
[03:53:33] <strcat> wtf
[03:53:38] <strcat> I don't even understand why it does this
[03:53:52] <strcat> malloc_unique(bcx, body_datum.ty);
[03:53:56] <strcat> it allocates a new box....
[03:53:58] <strcat> and then...
[03:54:02] <strcat>     // Copy the type descriptor
[03:54:04] <strcat>     let src_tydesc_ptr = GEPi(bcx, src_box,
[03:54:06] <strcat>                               [0u, back::abi::box_field_tydesc]);
[03:54:08] <strcat> [and so one]
[03:54:10] <strcat> why ? :\
[03:54:14] <Thad> (well...it says it's syncing...and the progress bar moved halfway and now stuck)
[03:54:18] <strcat> it already copies the body
[03:54:22] * strcat will just try removing this
[03:54:26] <strcat> ah wait
[03:54:34] <strcat> this is probably a hack for stupid ~fn too
[03:54:36] * strcat sighs
[03:54:42] <strcat> since it dynamically stores crap in there
[03:55:32] <doener> what does ~fn have to do with th tydesc?
[03:55:57] <strcat> doener: it shoves how big the allocation is into the tydesc :|
[03:56:10] <strcat> doener: based on what it captured
[03:56:10] <doener> ?!
[03:56:14] <strcat> doener: it's really awful
[03:56:23] <strcat> doener: look at src/librustc/middle/trans/closure.rs
[03:56:36] * doener doesn't want to
[03:56:41] <strcat> doener: line 515
[03:57:00] <strcat> one of the scariest things in rust
[03:57:03] <strcat> ;p
[03:57:27] <strcat>         // Take the (deeply cloned) type descriptor
[03:57:36] <strcat> doener: it might even describe all the types it captures...
[03:57:43] *** Quits: vk (chatzilla@66D44E2E.B568D26C.93B001FA.IP) (Ping timeout)
[03:57:52] <strcat> dynamically though.
[03:57:55] <strcat> this isn't static :(
[03:58:12] <strcat> so yeah I think it's hopeless and it needs an allocator to itself
[03:58:36] <Thad> doener: I get the requested URL returned error: 403 while accessing https://github.com/mozilla/rust.git/info/refs?service=git-receive-pack  FATAL: HTTP request failed
[03:59:00] <Thad> ...when trying to push and previously using the insteadOf
[04:00:06] <SiegeLord> What's up with the <V16> etc
[04:00:08] <engla> strcat: is closure reform not touching this too?
[04:00:13] <strcat> engla: don't know
[04:00:20] <engla> I mean, it was mentioned ~fn might not even be needed
[04:00:27] <strcat> oh yes please
[04:00:29] <strcat> please die ~fn
[04:00:31] <strcat> ;p
[04:00:35] <SiegeLord> "mismatched types: expected `float` but found `<VI6>` (expected float but found integral variable)"
[04:00:45] <SiegeLord> I mean, it says 5 words down that it's "integral"
[04:00:47] <strcat> engla: I want the headers removed ASAP though ;p
[04:01:06] <engla> I like your strategy, rip it out and see what happens
[04:01:13] <strcat> need a name for the new allocator
[04:01:33] <strcat> closure_exchange_alloc? :\
[04:02:26] <doener> Thad: hm, your config looks weird. The "upstream" remote doesn't even have a url. Try: git remote origin set-url git@github.com:thatguidry/rust.git; git remote upstream set-url git://github.com/mozilla/rust.git
[04:02:40] <kini> <strcat> because the filenames of the .so files have the hash + version and it's too stupid to remove them
[04:02:40] <kini> ah, I remember the 0install guy's blog post mentioned something about this
[04:02:51] <doener> Thad: s/that/thad/ in the first url
[04:03:15] <strcat> kini: they're supposed to have them, the issue is that the makefiles don't rm the old ones
[04:03:30] <strcat> rust itself has a really old crufty build system
[04:04:08] <strcat> doener: maybe I can just special-case closures as-is
[04:04:19] <strcat> meh no
[04:04:37] <strcat> well
[04:04:43] <Thad> doener: I think that's the old command
[04:04:43] <strcat> exchange_malloc could check the td at runtime
[04:04:47] <strcat> and only store it if it's a closure...
[04:04:50] <strcat> but that's stupid
[04:05:42] <kini> strcat: oh, he updated the post to give rust 5/5 instead of 2/5 under "shared libraries" after a rust dev explained it to him
[04:06:19] <strcat> kini: btw the reason it takes so long to spawn a process is that the process spawning is currently very, very stupid and does 1024 close calls
[04:06:34] <strcat> it's a library issue
[04:06:38] <kini> "In addition, symbols get a hash which includes their type signature (so incompatible changes become link-time errors) and the library hash (so you don‚Äôt get symbol name conflicts between libraries)."
[04:06:38] <kini> wow that's awesome
[04:07:49] <doener> Thad: old command == what you were originally looking for? Yeah, I jumped to conclusions when I just saw the git:// vs. https:// question, since the current remote url is not just using the wrong protocol, but also to the wrong repo, set-url is the right thing
[04:08:12] <Thad> doener: ok
[04:10:50] <Thad> doener: unknown command upstream
[04:11:38] <doener> Thad: sorry, messed up the arg order, switch "set-url" and upstream/origin
[04:11:46] <Thad> doener: over my shoulder ? https://join.me/175-760-480
[04:13:22] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[04:13:22] <ghrust> 01[13rust01] 15thestinger 04force-pushed 06exchange from 14678312e to 14b92fc58: 02http://git.io/eHgq9A
[04:13:22] <ghrust> 13rust/06exchange 14b92fc58 15Daniel Micay: stop initializing ref_count in exchange_alloc...
[04:13:22] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[04:15:54] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[04:15:54] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14211c8d7 to 143017343: 02http://git.io/N3iJvQ
[04:15:54] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[04:15:55] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[04:15:56] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/LCL4fQ
[04:15:56] <ghrust> 13rust/06auto 14647b4a6 15Jordi Boggiano: Optimize str::each_split_within when it is called with large limits
[04:15:56] <ghrust> 13rust/06auto 14c6b0d4f 15bors: auto merge of #7475 : Seldaek/rust/fixsplit, r=cmr...
[04:15:56] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[04:17:09] <doener> Thad: ok, push should do now
[04:17:31] <Thad> to master ?
[04:18:07] <Eridius> cmr: kerning on your blog is a bit odd. "churn" looks like "chum"
[04:18:20] <doener> Thad: if you want that. It should go to your repo.
[04:18:35] <Thad> denied...
[04:20:21] <doener> the redrawing on join.me is just crazy
[04:21:02] <Thad> better ?
[04:21:21] <doener> yeah
[04:21:51] <ion> eridius: a.k.a. keming
[04:22:39] <Thad> doener: hmm... do I have a rust repo on github ??
[04:23:07] <Thad> doener: or need one ?
[04:23:42] <doener> Thad: I assumed that you're Thad Guidry, is that wrong?
[04:23:55] <Thad> nope that's me
[04:24:09] <doener> then you have a rust repo there
[04:24:13] <Thad> k
[04:24:17] <Thad> next ?
[04:24:31] <doener> keyboard input doesn't want to go through join.me
[04:24:45] <doener> run: git remote set-url origin https://github.com/thadguidry/rust.git
[04:25:25] <strcat> doener: oh and it also reads the td param for alignment
[04:25:26] <strcat> which seems silly
[04:25:44] <strcat> malloc already allocates memory aligned for any possible type in C so...
[04:26:44] <doener> Thad: not mozilla, thadguidry
[04:27:36] <doener> Thad: better, now push should ask for user/pass, and work
[04:28:16] <Thad> doener: I'm like 3 months behind I think...
[04:28:23] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[04:28:34] <aatch> urg...
[04:28:48] <aatch> stupid impenetrable LLVM error.
[04:28:51] <jmgrosen> ack, i really do need to know linear algebra for this 3d stuff >.<
[04:28:58] <aatch> "error: couldn't allocate output register for constraint 'a'"
[04:29:02] <Thad> doener: after that then what ?
[04:29:12] <aatch> anybody familiar with the inline asm stuff?
[04:29:29] <doener> Thad: things should show up in your github ui, so you can file a PR
[04:29:37] <Thad> ah
[04:30:06] <doener> Thad: though I have to call it quits now. 6:30am, and maybe I had a beer too much to be giving support ;-)
[04:31:57] *** Quits: doener (doener@moz-121949B3.unitymediagroup.de) (Quit: leaving)
[04:32:57] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[04:33:15] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[04:33:15] <ghrust> 01[13rust01] 15thestinger pushed 1 new commit to 06exchange: 02http://git.io/MMiHlA
[04:33:16] <ghrust> 13rust/06exchange 141fad3d6 15Daniel Micay: managed: rm RC_EXCHANGE_UNIQUE constant...
[04:33:16] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[04:33:54] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[04:33:55] <ghrust> 01[13rust01] 15thestinger 04force-pushed 06exchange from 141fad3d6 to 14ab62547: 02http://git.io/eHgq9A
[04:33:55] <ghrust> 13rust/06exchange 14ab62547 15Daniel Micay: managed: rm RC_EXCHANGE_UNIQUE constant...
[04:33:55] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[04:35:48] <acrichto> r? https://github.com/mozilla/rust/pull/7465 
[04:35:57] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[04:35:57] <ghrust> 01[13rust01] 15thestinger 04deleted 06exchange at 14ab62547: 02http://git.io/SiqnsA
[04:35:57] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[04:36:27] <strcat> acrichto: sec
[04:38:29] <strcat> acrichto: could you replace the #[inline(always)] with #[inline]?
[04:38:47] <strcat> acrichto: we're generally not using it anymore because LLVM will already take inlinehint as a very strong hint
[04:38:57] <acrichto> strcat: hmm... ok
[04:39:12] <acrichto> strcat: is there a reason it still exists?
[04:39:25] <acrichto> also just updated
[04:39:40] <strcat> acrichto: well it's the same as __attribute__((alwaysinline)) with clang/gcc
[04:39:45] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[04:39:52] <strcat> sometimes you might want a function to never have an address I guess.
[04:40:08] <strcat> but since our codegen is really bad before optimization, inline(always) really makes -O0 slow
[04:40:19] <strcat> even just passing around pointers makes it go crazy
[04:41:01] <strcat> acrichto: r+
[04:41:15] <acrichto> strcat: thanks!
[04:41:42] <acrichto> the thing that made it fail was I forgot base 2 representations are longer than base 10...
[04:47:22] <jmgrosen> help?
[04:47:30] <jmgrosen>  /Users/john/Projects/q3/src/gl/camera.rs:193:6: 193:51 error: binary operation - cannot be applied to type `math::vec3::vecf::Vec3f`
[04:47:40] <jmgrosen>  /Users/john/Projects/q3/src/gl/camera.rs:193     { self.position -= right * self.move_speed * dt; }
[04:47:48] <jmgrosen> ‚Ä¶what does that mean?
[04:49:05] <aatch> Hmm, does somebody have a simple example of asm! usage?
[04:49:07] <Eridius> jmgrosen: sounds like math::vec3::vecf::Vec3f doesn't implement the - operator
[04:49:29] <strcat> aatch: https://github.com/mozilla/rust/pull/7495 stupid type descriptor :(
[04:49:50] <Eridius> jmgrosen: specifically, it doesn't implement the std::ops::Sub trait
[04:49:53] <jmgrosen> Eridius: it has a impl Sub
[04:49:59] <Eridius> you sure?
[04:50:06] <jmgrosen> definitely
[04:50:26] <Eridius> and that implementation is in scope?
[04:50:41] <jmgrosen> i think so, it's not my codebase
[04:50:42] <jmgrosen> i'll check
[04:51:02] <Luqman> aatch: there are a few simple examples in the 0.6 section https://github.com/mozilla/rust/wiki/Doc-detailed-release-notes
[04:51:08] *** Quits: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com) (Client exited)
[04:52:39] <aatch> Luqman, thanks
[04:53:00] <strcat> [exchange 1144364] stop copying the tydesc in unique box take glue
[04:53:03] <strcat>  2 files changed, 4 insertions(+), 9 deletions(-)
[04:53:04] * strcat tries
[04:53:09] <strcat> ~fn implements copies itself
[04:53:25] <jmgrosen> Eridius: is there something wrong with this code? https://gist.github.com/jmgrosen/5893895
[04:53:29] *** Parts: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) ()
[04:53:36] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[04:53:37] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[04:53:41] <jmgrosen> Eridius: it doesn't compile
[04:53:48] <jmgrosen> Eridius: pretty much the same error
[04:55:03] <Eridius> jmgrosen: weird, using foo1 = foo1 - foo2 works
[04:55:12] <jmgrosen> Eridius: yeah, that's the really strange part
[04:55:20] <jmgrosen> Eridius: compiler bug?
[04:55:20] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[04:55:27] <Eridius> jmgrosen: I'm guessing someone's trying to make -= not actually use Sub but instead be a different implementation, but the compiler gives a misleading error message
[04:56:50] <jmgrosen> Eridius: as in, there's a BSub that has a fn bsub(&mut self, rhs: &T) ?
[04:56:59] <aatch> Eridius, jmgrosen, I suggest not using op=, since it will break in current builds of the compiler
[04:57:14] <aatch> as it has been temporarily removed pending it being made sane.
[04:57:21] <jmgrosen> aatch: aw :/ i was trying to get Q^3 to work, but ok
[04:57:29] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[04:57:35] <jmgrosen> i suppose i can go and replace all of the instances of it
[04:58:04] <aatch> jmgrosen, yeah, sorry
[04:58:31] <aatch> but when it comes back, it'll work properly. And probably have overloading as an actual assignment operator.
[04:59:13] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[05:01:52] *** Quits: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP) (Connection reset by peer)
[05:05:32] <Thad> how do I ignore warnings treated as errors ?  do I remove the -Wall and -Werror ???
[05:05:39] <strcat> aatch: removing the header won't be as hard as I thought.
[05:05:46] <strcat> ~fn conveniently implements all the glue itself
[05:05:49] *** Joins: brendan (brendaneic@moz-501C2190.sub-70-211-65.myvzw.com)
[05:05:53] <strcat> it *never* uses the ~ take/drop glue
[05:05:55] <strcat> :D
[05:06:06] <strcat> so I can actually just drop in another lang item allocator
[05:06:57] <strcat> aatch: https://github.com/thestinger/rust/commit/1144364182f4b21bfb244dbee7165f17da5ccf7d seems to work \o/
[05:07:04] <strcat> so close.
[05:07:37] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[05:08:39] <aatch> strcat, woo
[05:14:52] *** Quits: Thad (chatzilla@moz-C35F90AE.tx.res.rr.com) (Quit: ChatZilla 0.9.90 [Firefox 23.0/20130625125232])
[05:15:21] *** Quits: Sorella (queen@B12A78F5.BA14766C.95C8B7C6.IP) (Quit: (quit))
[05:15:30] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Quit: Leaving)
[05:23:58] *** Joins: hjr3 (hradtke@54B05067.8A23C5CC.BCAEBB33.IP)
[05:26:22] *** Quits: hjr3 (hradtke@54B05067.8A23C5CC.BCAEBB33.IP) (Quit: My MacBook has gone to sleep. ZZZzzz‚Ä¶)
[05:26:53] *** Joins: brson (brson@E9CDE21E.991753BB.CA4D1600.IP)
[05:26:53] *** ChanServ sets mode: +o brson
[05:27:13] <aatch> YEAH! Syscalls up in this bitch!
[05:27:31] * aatch is incredibly happy about this.
[05:28:01] <strcat> aatch: you got the vdso thing working?
[05:28:30] <aatch> strcat, not sure. But modern 64-bit processors have a syscall _instruction_
[05:28:41] <strcat> aatch: ah that's not the modern fast way
[05:28:46] <aatch> I have no idea if it goes through vdso though.
[05:28:46] <strcat> on linux
[05:29:02] <aatch> since I can't find out _anything_ about how to use it properly.
[05:29:11] <strcat> aatch: probably have to copy glibc ;p
[05:29:20] <aatch> strcat, have you _read_ glibc?
[05:29:22] <strcat> I don't think alternate C libraries (other than eglibc) do it properly
[05:29:36] <strcat> uclibc doesn't even have a working fallocate :|
[05:29:57] <aatch> strcat, musl doesn't, since that where I copied this from.
[05:30:04] <strcat> aatch: yeah I know, they do it the slow way :(
[05:30:35] <strcat> they care about static linking purity more than speed (the linker finds the vdso for you, even if you don't link to anything)
[05:32:09] <strcat> aatch: vdso is just a shared object available in every binary afaict
[05:32:25] <strcat> at 0xffffffffff600000 and ending at 0xffffffffff601000 ;p
[05:32:47] <strcat> on x86_64
[05:33:25] <aatch> strcat, that's the vsyscall page.
[05:33:26] <strcat> aatch: https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/Documentation/vDSO/parse_vdso.c?id=v3.8
[05:33:58] <strcat> aatch: and https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/Documentation/vDSO/vdso_test.c?id=v3.8
[05:34:08] <aatch> strcat, huh, I guess I just have to man up and read the kernel source
[05:34:30] <strcat> aatch: it's well documented ;p
[05:34:36] <strcat> in their own special way
[05:34:55] <strcat> a working userland program is a nice way to document it
[05:35:44] <strcat> aatch: anyway it shows calling gettimeofday that way
[05:36:18] <aatch> strcat, fair enough.
[05:36:46] * strcat doesn't know if OSes other than linux have something like this
[05:37:18] <strcat> but avoiding a context switch to get the time, and so on is awesome
[05:38:00] <strcat> Go does syscalls properly with the vdso, just checked
[05:38:02] <aatch> strcat, I'm ok with making something that falls back to libc or something on other platforms.
[05:38:13] <strcat> so that's another place to look
[05:38:53] <strcat> aatch: I'm not sure if it exposes all the syscalls or only the ones that are optimized that way.
[05:39:22] <aatch> It would be nice to have some of the more common+basic routines not go through the FFI.
[05:39:50] <aatch> strcat, well I could implement an in-rust set of syscall* fns
[05:40:14] <strcat> aatch: well Go does this to avoid needing stack switches except for external libraries
[05:40:30] <strcat> ofc we'd have to actually port/implement an allocator and a bunch of other code to do that
[05:40:55] <strcat> aatch: https://codereview.appspot.com/6826072/#ps2001 ;p
[05:41:19] <aatch> strcat, nice speed up!
[05:41:28] <strcat> yep, compared to doing it with syscall
[05:41:57] <aatch> I wonder what speed up we'd get just moving to syscalls...
[05:41:58] <strcat> aatch: oh
[05:41:59] <strcat> hm
[05:42:04] <strcat> aatch: I think this is going from vsyscall -> vdso
[05:42:10] <strcat> - MOVQ $0xffffffffff600000, AX
[05:42:12] <strcat> + MOVQ runtime¬∑__vdso_gettimeofday_sym(SB), AX
[05:42:37] <strcat> so the speedup from manually issuing the instruction might be more
[05:43:00] <strcat> aatch: well it wouldn't be that hard to implement our own stdio replacement
[05:43:02] <strcat> on linux
[05:43:22] <strcat> problem: we're probably going to be using libuv for most stuff
[05:44:20] <aatch> strcat, true, but we do need a scheduler-free alternative to most of this anyway.
[05:45:52] <strcat> lol
[05:45:57] <strcat> stack closures... have a header.
[05:46:28] <strcat> aatch: that's where 0x12345678 comes from
[05:46:41] <strcat> refcount of a stack closure :|
[05:46:43] <aatch> strcat, yeah, already figured that out.
[05:47:04] <strcat> I think all I need to do is teach malloc_raw to use a closure allocator for ~fn
[05:47:12] <strcat> and I can stop initializing the header completely
[05:47:15] <strcat> then remove it
[05:47:29] <strcat> someone else can fix closures :p
[05:47:56] <strcat> ugh
[05:48:28] <strcat> lets see what explodes if I just remove it first
[05:49:45] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[05:49:45] <ghrust> 01[13rust01] 15thestinger 04force-pushed 06try from 14eb53d6e to 141144364: 02http://git.io/k471pw
[05:49:45] <ghrust> 13rust/06try 14561a7c1 15Daniel Micay: simplify the exchange allocator...
[05:49:45] <ghrust> 13rust/06try 146c6cfd0 15Daniel Micay: add a contains_managed intrinsic
[05:49:45] <ghrust> 13rust/06try 14b500850 15Daniel Micay: vec: use contains_managed instead of box header
[05:49:47] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[05:54:13] <strcat> aatch: oh
[05:54:19] <strcat> aatch: ~fn clobbers the tydesc anyway
[05:54:26] <aatch> bahaha
[05:54:55] * strcat sighs
[05:55:40] <strcat> aatch: oh nvm I'm wrong.
[05:55:44] <strcat>     // compute the type of the closure
[05:55:47] <strcat>     let cdata_ty = mk_closure_tys(tcx, bound_values);
[05:55:48] <strcat>     // allocate closure in the heap
[05:55:50] <strcat>     let Result {bcx: bcx, val: llbox} = allocate_cbox(bcx, sigil, cdata_ty);
[05:55:59] <strcat> but anyway I can make it use another temporary allocator
[05:56:36] <strcat> aatch: it clobbers it on copies
[05:56:46] <strcat> weird
[05:57:12] <strcat> anyway this stuff makes me sad ;p
[05:57:22] <strcat> way too much of a dynamic mess
[05:58:06] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[05:58:08] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/LCL4fQ
[05:58:08] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[05:58:41] <Luqman> man, i feel Thad's pain in trying to get 64bit windows working :(
[05:59:24] <strcat> Luqman: I think I'd prefer that to watch VALGRIND_COMPILE=1 compiles to fail and yell at me for an invalid read of size 8
[05:59:27] <strcat> ;p
[05:59:30] <strcat> watching*
[05:59:48] <strcat> err, that sentence was just wrong
[06:00:10] <aatch> strcat, ok, so I did test between calling the write syscall and the libc syscall:
[06:00:25] <aatch>    c_print ... bench: 487 ns/iter (+/- 0)
[06:00:41] <aatch>    sys_print ... bench: 85 ns/iter (+/- 0)
[06:00:44] <strcat> aatch: nice
[06:00:57] <strcat> aatch: now try gettimeofday vs. the vdso :)
[06:00:57] <aatch> that's printing out ""
[06:00:57] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[06:00:57] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/KCpf1w
[06:00:57] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[06:00:59] *** Joins: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP)
[06:00:59] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/wO8OuQ
[06:00:59] <ghrust> 13rust/06auto 1471d14e5 15Alex Crichton: Change char::escape_{default,unicode} to take callbacks instead of allocating...
[06:00:59] <ghrust> 13rust/06auto 1494ff77a 15Alex Crichton: Specialize to_str_common for floats/integers in strconv...
[06:01:00] <ghrust> 13rust/06auto 14df71e20 15bors: auto merge of #7465 : alexcrichton/rust/issue-4432, r=thestinger...
[06:01:02] *** Parts: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP) ()
[06:01:10] <aatch> 1 thing at a time lol.
[06:01:12] <Luqman> strcat: scroll down to the 4th gray block http://www.gaia-gis.it/spatialite-3.0.0-BETA/mingw64_how_to.html
[06:01:20] <Luqman> aatch: using asm! ?
[06:01:26] <aatch> Luqman, yep
[06:01:39] <aatch> Though this impl only works on x86_64
[06:01:47] <aatch> since it uses the syscall instruction.
[06:02:12] <Luqman> what, no int 0x80 :P
[06:02:26] <strcat> Luqman: neither is the modern way anyway ;p
[06:03:00] <strcat> Luqman: the linux kernel gives you magical virtual shared object and implements stuff like gettimeofday without a context switch to kernelspace
[06:03:13] <strcat> aatch: try glibc's getpid vs the syscall ;p
[06:03:17] <Luqman> linux-vdso.so right?
[06:03:21] <strcat> Luqman: yep
[06:03:28] <strcat> aatch: glibc caches it in a global
[06:03:53] <strcat> (it's why we can't have nice things like pid namespacing without fork)
[06:04:36] <aatch> Ok, so piping to /dev/null, I get 287ns vs 96ns
[06:04:45] <strcat> aatch: is this with #[fast_ffi] btw?
[06:04:45] <aatch> so I'm guessing that's stack switching.
[06:04:56] <aatch> no, to be fair.
[06:06:48] *** Quits: brendan (brendaneic@moz-501C2190.sub-70-211-65.myvzw.com) (Quit: brendan)
[06:07:08] *** Quits: Dk (Sohbet@736BC8D4.26C0A60B.C687B15D.IP) (Quit: )
[06:08:44] <aatch> strcat, ok, so pretty much no difference with fast_ffi
[06:08:57] <strcat> aatch: with RUST_MIN_STACK=5000000 ;p
[06:09:05] *** Joins: pyrac (pyrac@moz-3A4AC930.w90-55.abo.wanadoo.fr)
[06:09:31] <aatch> it makes the FFI call about 50ns faster
[06:10:13] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[06:10:26] <aatch> so still more than twice the time as a straight sys call.
[06:10:52] <strcat> aatch: now try getpid or gettimeofday :)
[06:12:00] <strcat> ugh
[06:12:03] <strcat> why must lang items have an index
[06:14:45] <strcat> [exchange 5ec02e1] switch ~fn to a transitional allocator
[06:14:47] <strcat>  3 files changed, 88 insertions(+), 64 deletions(-)
[06:14:49] * strcat sighs
[06:15:08] <strcat> now if this works, I can remove the header and get 10000 segfaults to fix
[06:16:02] <strcat> ughhhh
[06:16:27] <aatch> heh, so the libc version, with #[fast_ffi] is signficantly faster.
[06:16:35] <strcat> aatch: of which?
[06:16:36] <aatch> of getpid
[06:16:42] <strcat> getpid it cheats by caching :)
[06:16:53] *** Joins: Sodel_the_V (user@moz-853663E1.va.shawcable.net)
[06:17:00] <strcat> gettimeofday it uses the vdso, so that should be faster - but maybe not if the FFI cost outweighs that cost
[06:17:12] <strcat> aatch: getpid should represent the cost of FFI
[06:17:19] <strcat> because it's 1 read of an int...
[06:18:38] *** Quits: Sodel_the_V (user@moz-853663E1.va.shawcable.net) (Input/output error)
[06:18:46] *** Joins: Sodel_the_V (user@moz-853663E1.va.shawcable.net)
[06:19:13] <aatch> strcat, LLVM is probably doing something with it though, since it's faster even without fast_ffi
[06:19:36] <strcat> aatch: maybe
[06:20:57] <aatch> Ok, if I copy glibc's cheat and cache it, the in-rust version wins again.
[06:21:11] <strcat> aatch: gettimeofday! ;p
[06:21:32] <aatch> unless I optimize, in which case I get a segfault.
[06:21:40] <strcat> :D
[06:21:48] <strcat> aatch: static mut?
[06:22:01] <aatch> strcat, yep.
[06:22:36] <strcat> alright I added my crappy closure allocator
[06:23:16] <strcat> switch ~fn to a transitional allocator
[06:23:18] <strcat> it can still use exchange_free
[06:23:20] <strcat> the exchange_malloc header is now completely unused
[06:23:23] <strcat> will it compile, is the question
[06:24:55] <strcat> compile_and_link: x86_64-unknown-linux-gnu/stage2/test/stdtest-x86_64-unknown-linux-gnu
[06:24:56] <strcat> error: duplicate entry for `exchange_malloc`
[06:24:58] <strcat> error: duplicate entry for `exchange_free`
[06:25:00] <strcat> ;[
[06:25:25] <strcat> does... stage0 not work on lang items?
[06:25:29] <strcat> cfg(stage0)
[06:26:19] *** Joins: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com)
[06:32:51] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Quit: jmgrosen)
[06:33:19] <strcat> nooo it breaks
[06:34:27] <strcat> rust: task failed at 'index out of bounds: the len is 41 but the index is 41', /home/strcat/projects/rust/src/librustc/middle/lang_items.rs:378
[06:34:29] <strcat> oh
[06:36:15] *** Joins: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP)
[06:36:36] <aatch> strcat, almost there?
[06:36:43] <strcat> aatch: yeah I forgot to make the lang item array bigger
[06:37:06] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[06:37:06] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14df71e20 to 14c6b0d4f: 02http://git.io/N3iJvQ
[06:37:07] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[06:37:49] <strcat> aatch: http://ix.io/6qr this is what I have now
[06:38:02] <strcat> maybe I don't need to define the old lang item?
[06:38:12] <bblum> strcat: ~fn:Copy() should be copyable
[06:38:13] <strcat> the compiler can compile the new one
[06:38:20] <strcat> bblum: yeah I just made ~fn a new allocator
[06:38:25] <strcat> because it's evil and uses the header
[06:38:30] <bblum> a new 'allocator'?
[06:38:39] <strcat> bblum: I'm removing the header on exchange allocs
[06:38:50] <strcat> so ~fn gets closure_exchange_malloc all to itself until it's fixed
[06:39:04] <strcat> it actually uses the tydesc.
[06:39:29] <strcat> uses it to store how big it is
[06:42:20] <aatch> strcat, so I'm thinking of adding a syscall interface to std::os, though probably under std::os::linux
[06:42:53] <aatch> with `syscall` for x86_64 and `int 0x80` for x86
[06:43:48] <strcat> bblum: ~ managed to aggravate me to the point where I finally felt like fixing it ;p
[06:43:57] * strcat won't accept treemap being 3x slower than C++
[06:44:33] <strcat> not quite there yet....
[06:44:35] *** Joins: brendan (brendaneic@moz-501C2190.sub-70-211-65.myvzw.com)
[06:44:41] <strcat> but at least nothing reads/writes to the header now
[06:45:09] <strcat> ~[], ~fn and ~T take glue were the culprits
[06:47:03] *** Quits: calatalee (Mibbit@moz-72830A1C.nyc.res.rr.com) (Quit: http://www.mibbit.com ajax IRC Client)
[06:47:14] <strcat> meh I broke it again
[06:49:15] *** Joins: pudgetta (Mibbit@moz-7A0CB455.glbb.ne.jp)
[06:49:30] *** Joins: SimonSapin (simon@moz-D0C2F181.zone2.bethere.co.uk)
[06:49:47] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[06:50:04] <steven_is_false> Milestone 0.7 Due in 13 minutes
[06:50:20] <steven_is_false> I bet it's going to be delayed though probable.
[06:50:34] <strcat> I think there's more glue using the tydesc for traits or something
[06:52:52] <strcat> what the hell is a ty_opaque_box. a trait?
[06:53:17] <aatch> strcat, it's a normal box, but with an *i8 in it.
[06:53:24] <aatch> it shouldn't exist.
[06:53:28] <strcat> huuuuh
[06:53:30] <strcat> but it's used?
[06:53:44] <aatch> strcat, well things create it, if that's what you mean
[06:54:10] * strcat really wants to know what's still reading the tydesc
[06:54:35] <strcat> maybe I should commit the ~fn allocator first and *then* try removing it
[06:55:15] *** Quits: feduser (feduser@1A2C4FEE.D610364D.799BF54A.IP) (Ping timeout)
[06:56:18] <strcat> :[
[06:57:26] <Luqman> ty_opaque_box is used when self is stuffed into the environment slot
[06:57:47] <strcat> I really suspect ~Trait here
[06:58:11] *** Joins: vk (chatzilla@moz-389FEE13.hsd1.ca.comcast.net)
[06:59:29] <strcat> ah, found it.
[06:59:30] <Luqman> middle/ty.rs: ty_opaque_box, // used by monomorphizer to represent any @ box
[06:59:46] <strcat> Luqman: that's fine
[06:59:50] <strcat> libstd/cleanup.rs seems to be the cause
[06:59:55] <strcat> oh nvm
[06:59:59] <strcat> that can't be it.
[07:00:04] * strcat looks harder
[07:00:32] <strcat> one of these evil glue emitters could be doing it :(
[07:00:35] * aatch forgot that he was working on a snapshot.
[07:01:43] <vk> How might one fix this error: "LLVM ERROR: Incompatible object format!"? Getting this while trying rusti with revision df39932 (on Windows 7).
[07:02:05] <Luqman> aatch: lol got caught up with the syscall stuff?
[07:02:14] <aatch> Luqman, yeah, was interesting...
[07:03:13] <aatch> Also, I was practically done, I was just cleaning up warnings.
[07:03:26] * strcat hates tydescs
[07:03:48] *** Quits: Sodel_the_V (user@moz-853663E1.va.shawcable.net) (Quit: Eaten by a grue)
[07:05:45] <Luqman> vk: no idea. just tried and got the same error on win8
[07:06:06] <vk> Luqman: Yay, it's not just me!
[07:07:05] <Luqman> so yea, seems to be an issue on windows. linux & mac work fine
[07:07:25] <vk> Yay windows.
[07:07:50] <strcat> aatch: did you start building it already?
[07:07:59] <vk> Are your running Rust from the MinGW shell, or powershell by chance?
[07:08:23] <aatch> strcat, the snapshot? It was finished ages ago.
[07:08:29] <strcat> aatch: heh
[07:08:45] <Luqman> vk: mingw
[07:08:48] <aatch> I just got sidetracked while getting the codebase to build with it.
[07:09:19] <Luqman> sigh, "version `GLIBC_2.14' not found" these suck
[07:09:31] <vk> Have you tried running it from powershell or cmd.exe? I've been trying that and encountered a problem in doing so.
[07:09:51] <vk> Just figured out a solution, curious if it's happening on other windows systems or just mine.
[07:10:43] *** Joins: feduser (feduser@1A2C4FEE.D610364D.799BF54A.IP)
[07:11:44] <aatch> strcat, one spanner in the works regarding using vdso, need the auxv, which comes after the environment in the initial process stack.
[07:11:53] <Luqman> vk: from a quick look it doesn't seem to work in powershell
[07:12:24] <vk> Luqman: woot, appreciate the confirmation. 
[07:13:27] <Luqman> vk: no worries. you just happened to have asked the day i build rust in windows :P
[07:14:01] <vk> Luqman: lucky day :D
[07:15:20] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[07:15:56] *** aatch is now known as aatch|food
[07:19:12] <aatch|food> https://github.com/mozilla/rust/pull/7501
[07:19:51] <vk> Luqman: https://github.com/mozilla/rust/issues/7500 fix there if interested.
[07:20:57] <Luqman> aatch|food: r+
[07:21:08] <Luqman> bah, strcat beat me :P
[07:21:27] <strcat> aatch|food: you could cherry-pick https://github.com/mozilla/rust/pull/7492
[07:22:17] <strcat> heh
[07:22:23] <strcat> I thought librustc was taking ages to compile
[07:22:27] <strcat> turns out I accidentally scrolled up a bit
[07:23:23] <strcat> rusti: 2
[07:23:26] -rusti- 2
[07:23:27] <strcat> rusti: 2 + 2
[07:23:28] -rusti- 4
[07:23:30] <strcat> rusti: 2 + 2 + 2
[07:23:31] -rusti- 6
[07:23:34] <strcat> rusti: 2 + 2 + 2 + 2 + 2 + 2
[07:23:34] -rusti- 12
[07:23:37] <strcat> rusti: 2 + 2 + 2 + 2 + 2 + 2 +
[07:23:37] -rusti- <anon>:10:4: 10:5 error: unexpected token: `}`
[07:23:37] -rusti- <anon>:10     };
[07:23:37] -rusti-               ^
[07:23:38] -rusti- application terminated with error code 101
[07:23:42] <strcat> rusti: 2 + 2 + 2 + 2 + 2 + 2 ++
[07:23:43] -rusti- <anon>:9:32: 9:33 error: unexpected token: `+`
[07:23:43] -rusti- <anon>:9          2 + 2 + 2 + 2 + 2 + 2 ++
[07:23:43] -rusti-                                          ^
[07:23:43] *** concrete.mozilla.org sets mode: +M 
[07:23:43] -rusti- application terminated with error code 101
[07:24:21] <Luqman> vk: cool! thanks for figuring that out. i shall boot up my vm to test it out
[07:25:57] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[07:25:59] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[07:26:02] <strcat> heh
[07:26:04] <strcat> stupud +M
[07:26:14] <strcat> stupid*
[07:28:27] <Luqman> vk: hmm, i also had to copy libgcc_s_dw2-1.dll and libstdc++-6.dll as well
[07:28:46] *** concrete.mozilla.org sets mode: -M 
[07:29:29] <acrichto> oh dear it looks like there's some libuv asserts getting triggered occasionally
[07:29:45] <strcat> acrichto: well that doesn't sound too bad because brson rewrote all of that anyway ;p
[07:29:54] <strcat> so we'll have new bugs!
[07:30:01] <acrichto> well it's preventing things from landing
[07:30:04] <strcat> the old bugs were boring
[07:30:05] <strcat> acrichto: oh
[07:30:21] <acrichto> https://github.com/mozilla/rust/pull/7468 was stopped by it I believe
[07:30:30] <acrichto> and so was https://github.com/mozilla/rust/pull/7465
[07:30:45] <vk> Luqman: have you tried compiling a file? that throws a bunch of ld.exe errors.
[07:32:03] *** Quits: pudgetta (Mibbit@moz-7A0CB455.glbb.ne.jp) (Quit: http://www.mibbit.com ajax IRC Client)
[07:32:48] <Luqman> vk: in powershell?
[07:33:11] <acrichto> strcat: would you mind '@bors: retry' on those?
[07:33:12] <vk> Luqman: let me check in mingw, should be the same thing
[07:33:28] <vk> Luqman: I'll copy the error onto your issue.
[07:33:45] <strcat> acrichto: done
[07:33:51] <acrichto> strcat: thanks
[07:34:05] <acrichto> I'll file a bug if either of them passes
[07:35:16] <vk> Luqman: yea, nevermind. It's in powershell. Looks like in powershell it's referencing the wrong version of perl. bah.
[07:35:47] <acrichto> aatch|food: can you change mk/target.mk:22 according to the note above it for the new snapshot?
[07:35:59] <acrichto> :21*
[07:36:57] <Luqman> vk: it seems like going through powershell is much more annoying. when trying to run a binary compiled by rustc it'll complain about not being able to find rustrt.dll
[07:38:31] <vk> Luqman: Sigh. yay windows.
[07:40:27] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[07:41:18] *** Quits: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzz‚Ä¶)
[07:41:19] <strcat> wooooooooooooooo
[07:41:21] <strcat> I got it working
[07:41:28] <strcat> exchange alloc header is now never initialized
[07:42:11] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[07:42:11] <ghrust> 01[13rust01] 15thestinger 04force-pushed 06try from 1496043fe to 14aea8ab7: 02http://git.io/k471pw
[07:42:11] <ghrust> 13rust/06try 14aea8ab7 15Daniel Micay: add a closure_exchange_malloc lang item...
[07:42:11] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[07:43:40] <strcat> now there's the final problem of libstd not building anymore...
[07:43:52] <strcat> libstd's test harness*
[07:45:01] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Ping timeout)
[07:45:18] *** Quits: kini (kini@8CE7D24D:6948BCE:9B80811F:IP) (Ping timeout)
[07:46:18] *** Joins: kini (kini@8CE7D24D:6948BCE:9B80811F:IP)
[07:46:46] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[07:47:24] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[07:47:33] *** Quits: victorporof (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP) (Quit: victorporof)
[07:50:53] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[07:50:53] <ghrust> 01[13rust01] 15thestinger 04force-pushed 06try from 14aea8ab7 to 1470e7bce: 02http://git.io/k471pw
[07:50:53] <ghrust> 13rust/06try 14b883d6a 15Daniel Micay: simplify the exchange allocator...
[07:50:53] <ghrust> 13rust/06try 14b914162 15Daniel Micay: add a contains_managed intrinsic
[07:50:53] <ghrust> 13rust/06try 14350a5c0 15Daniel Micay: vec: use contains_managed instead of box header
[07:50:56] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[07:52:58] *** Quits: Earnestly (earnest@2A2BF8F5.321FA5E6.BFD1ABFD.IP) (Ping timeout)
[07:53:07] <strcat> aatch|food: so close!
[07:53:24] <strcat> but anyway I accomplished this part
[07:53:27] <strcat> 'With these changes, exchange allocator headers are never initialized, read or written to. Removing the header will now just involve updating the code in trans using an offset to only do it if the type contained is managed.'
[07:53:43] <strcat> don't really feel like updating all the offsets yet.
[07:54:59] *** Joins: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP)
[07:55:21] *** Joins: bytbox (s@moz-D4F26CEB.hsd1.md.comcast.net)
[08:02:27] *** Joins: Sindwiller (quassel@moz-743130B2.dynamic.hispeed.ch)
[08:04:18] *** Joins: mib_e8eddr (Mibbit@moz-7A0CB455.glbb.ne.jp)
[08:04:45] *** Quits: vk (chatzilla@moz-389FEE13.hsd1.ca.comcast.net) (Quit: ChatZilla 0.9.90 [Firefox 23.0/20130625125232])
[08:06:27] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[08:09:32] *** Quits: roo (jesse.rudo@moz-FAF2828A.dynamic.ip.windstream.net) (Ping timeout)
[08:16:27] *** Joins: true_droid (Adium@moz-123FD9B8.beck.volia.net)
[08:19:05] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[08:19:05] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/onms1g
[08:19:05] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[08:21:59] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[08:21:59] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/eKb9NQ
[08:21:59] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[08:22:02] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[08:22:02] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/IGQo3w
[08:22:02] <ghrust> 13rust/06auto 141662bd3 15Corey Richardson: Great renaming: propagate throughout the rest of the codebase
[08:22:02] <ghrust> 13rust/06auto 1495d22a3 15Corey Richardson: Fix merge fallout
[08:22:02] <ghrust> 13rust/06auto 1471b1c6a 15Corey Richardson: Warning cleanup
[08:22:03] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[08:23:38] *** Quits: mib_e8eddr (Mibbit@moz-7A0CB455.glbb.ne.jp) (Quit: http://www.mibbit.com ajax IRC Client)
[08:26:01] *** Quits: bytbox (s@moz-D4F26CEB.hsd1.md.comcast.net) (Ping timeout)
[08:26:02] *** Joins: Blei (philipp@moz-650B9C6A.cust.bluewin.ch)
[08:27:00] *** Joins: victorporof (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP)
[08:28:49] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[08:33:40] *** Joins: mindginative (mindginati@moz-90AB6445.dyn.cust.vf.net.nz)
[08:33:59] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[08:36:08] *** Quits: bjz (brendanzab@moz-E17AB2AB.lnse2.cha.bigpond.net.au) (Quit: Leaving...)
[08:37:06] *** Joins: bjz (brendanzab@moz-E17AB2AB.lnse2.cha.bigpond.net.au)
[08:37:30] *** Quits: brendan (brendaneic@moz-501C2190.sub-70-211-65.myvzw.com) (Quit: brendan)
[08:40:11] *** Joins: spider-mario (spidermari@moz-B8FA2FF4.rev.sfr.net)
[08:41:45] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[08:41:58] *** Quits: spider-mario (spidermari@moz-B8FA2FF4.rev.sfr.net) (Ping timeout)
[08:42:05] *** Quits: steven_is_false (user@moz-144077DE.bchsia.telus.net) (Client exited)
[08:42:33] *** Joins: spider-mario (spidermari@moz-B8FA2FF4.rev.sfr.net)
[08:42:37] *** Joins: Ms2ger (Ms2ger@moz-BE6F806B.adsl-dyn.isp.belgacom.be)
[08:47:03] *** Joins: xLII (xLII@4BED3CB3.F5F53E8A.2D6DB75E.IP)
[08:48:39] *** Joins: n00b6502 (kwr5y54@moz-6651F8D4.range86-145.btcentralplus.com)
[08:52:31] *** Quits: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net) (Ping timeout)
[08:52:36] *** Joins: eternaleye (eternaleye@moz-76321711.hsd1.wa.comcast.net)
[08:59:46] *** Quits: xLII (xLII@4BED3CB3.F5F53E8A.2D6DB75E.IP) (Ping timeout)
[09:00:11] *** Joins: xLII (xLII@4BED3CB3.F5F53E8A.2D6DB75E.IP)
[09:00:23] *** Joins: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de)
[09:01:57] *** Quits: xLII (xLII@4BED3CB3.F5F53E8A.2D6DB75E.IP) (Ping timeout)
[09:05:59] *** aatch|food is now known as aatch
[09:06:15] *** Joins: jpochyla (jpochyla@moz-8D99AE5D.broadband18.iol.cz)
[09:07:18] *** Quits: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de) (Ping timeout)
[09:13:14] *** Joins: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl)
[09:14:17] *** Quits: brson (brson@E9CDE21E.991753BB.CA4D1600.IP) (Ping timeout)
[09:21:37] *** Quits: pyrac (pyrac@moz-3A4AC930.w90-55.abo.wanadoo.fr) (Quit: pyrac)
[09:23:12] *** Joins: pyrac (pyrac@moz-3A4AC930.w90-55.abo.wanadoo.fr)
[09:24:12] *** Quits: mindginative (mindginati@moz-90AB6445.dyn.cust.vf.net.nz) (Quit: zzZZZ)
[09:29:15] <aatch> Hurray! I can get to the auxv bit on the stack
[09:29:57] *** Joins: illissius (illissius@moz-19397A63.catv.broadband.hu)
[09:33:49] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[09:34:11] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[09:34:29] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[09:35:59] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[09:36:52] *** Quits: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP) (Connection reset by peer)
[09:37:21] <Blei> fascinating, i never knew about auxv
[09:37:40] <aatch> Blei, neither did I until I started looking into this vDSO stuff
[09:39:00] <Blei> what? there's 3 arguments to main? i never knew that either?
[09:39:08] <Blei> err, scratch that last ?
[09:39:53] <aatch> Looks like I'll need a little runtime support if I want to use it properly though.
[09:39:53] *** Quits: illissius (illissius@moz-19397A63.catv.broadband.hu) (Quit: )
[09:40:16] <aatch> since I'll need to at least grab a reference to it before it drops off the edge of the world.
[09:40:26] *** Joins: threecreepio (jdp@moz-DB2D70E9.cust.bredbandsbolaget.se)
[09:41:46] <Blei> hmm, how do the libc functions access them? they don't have access to the main arguments either
[09:41:56] <Blei> oh, they do, of course
[09:42:03] <Blei> they call main() after all
[09:42:46] <aatch> Yeah. not all functions would be called using the vDSO though.
[09:43:22] *** Quits: pyrac (pyrac@moz-3A4AC930.w90-55.abo.wanadoo.fr) (Quit: pyrac)
[09:44:37] <aatch> At any rate, I might make a syscall[0-6] set of functions for Linux.
[09:45:00] *** Joins: mnemotic (niko@8FFD1BD2.9D81E74C.53DF0002.IP)
[09:46:20] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Quit: Leaving.)
[09:46:47] *** Joins: mindginative (mindginati@moz-90AB6445.dyn.cust.vf.net.nz)
[09:47:30] <Blei> aatch: http://stackoverflow.com/a/11954930
[09:47:55] <Blei> fun
[09:48:52] *** Quits: ross (ross@moz-8A84103E.br.br.cox.net) (Quit: )
[09:49:14] <aatch> Blei, yeah, I saw that. I honestly think that grabbing a reference to it and stashing it somewhere is the best option.
[09:49:27] <aatch> Since it's static and immutable anyway.
[09:52:27] *** Joins: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de)
[09:53:23] <aatch> Blei, not all syscalls would run through it anyway.
[09:53:31] <aatch> Blei, this is what you'd use: https://gist.github.com/Aatch/5894562
[09:55:00] <Blei> ah, right, we have inline asm! does it work reliably?
[09:55:20] <aatch> Blei, yep, I re-implemented write pretty effectively.
[09:55:46] <Blei> cool stuff
[09:56:21] *** Quits: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de) (Ping timeout)
[09:56:35] <aatch> Unfortunately the format is quite different to gcc/clang's inline asm.
[09:56:42] *** Joins: Palmik (palmik@moz-CC484FDD.tmcz.cz)
[09:57:02] <Blei> how so? it looks quite similar at first glance
[09:57:24] <aatch> Ok, "quite different" isn't true.
[09:57:30] <aatch> More like "just different enough"
[09:57:38] <aatch> The actual asm is the same.
[09:57:52] <aatch> but the constraints format is different.
[09:57:53] *** Joins: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de)
[09:58:16] <aatch> so where I have `=ra`, in C, you'd have `=a`.
[09:58:59] <aatch> the `r` says that it's a register constraint, the `a` constrains it to the 'a' register.
[09:59:00] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[09:59:54] *** Quits: jpochyla (jpochyla@moz-8D99AE5D.broadband18.iol.cz) (Ping timeout)
[10:01:29] *** Joins: dbaupp (Thunderbir@moz-EAB436DB.lns20.syd6.internode.on.net)
[10:01:45] *** Joins: jpochyla (jpochyla@moz-8D99AE5D.broadband18.iol.cz)
[10:03:23] *** Quits: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net) (Max SendQ exceeded)
[10:03:28] *** Quits: jpochyla (jpochyla@moz-8D99AE5D.broadband18.iol.cz) (Ping timeout)
[10:03:37] <aatch> Anybody interested in writing an allocator in pure Rust?
[10:03:49] *** Joins: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net)
[10:03:55] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[10:05:00] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[10:05:19] *** Quits: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net) (Max SendQ exceeded)
[10:05:43] *** Joins: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net)
[10:06:10] *** Quits: aatch (aatch@moz-2BB0AC01.cable.telstraclear.net) (Client exited)
[10:06:23] *** Joins: Earnestly (earnest@2A2BF8F5.321FA5E6.BFD1ABFD.IP)
[10:10:07] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[10:10:07] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/IGQo3w
[10:10:07] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[10:13:00] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[10:13:00] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/mccs6Q
[10:13:00] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[10:16:40] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[10:16:41] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/mccs6Q
[10:16:41] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[10:16:45] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[10:16:45] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Aw3DsA
[10:16:45] <ghrust> 13rust/06auto 140a3f6bc 15Young-il Choi: mk: clean-llvm for cross-compile
[10:16:45] <ghrust> 13rust/06auto 144a0308f 15bors: auto merge of #7492 : yichoi/rust/fix_cleanllvm, r=luqmana...
[10:16:45] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[10:19:56] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[10:22:19] *** Quits: true_droid (Adium@moz-123FD9B8.beck.volia.net) (Quit: Leaving.)
[10:33:33] *** Parts: mnemotic (niko@8FFD1BD2.9D81E74C.53DF0002.IP) ()
[10:40:41] <cmr> Eridius: It looks fine to me! Otherwise I wouldn't be using this theme.
[10:40:48] <cmr> Eridius: It looks fine to me! Otherwise I wouldn't be using this theme.
[10:43:34] *** Joins: mnemotic (niko@8FFD1BD2.9D81E74C.53DF0002.IP)
[10:44:23] <Seldaek> fire alarm ringing for an hour now, it's rip your ears out sunday!
[10:45:00] *** Quits: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de) (Ping timeout)
[10:58:20] <cmr> those are the best sundays!
[10:58:54] *** Joins: nano (nano@moz-972880B.superkabel.de)
[10:59:31] *** Joins: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com)
[11:02:03] *** Quits: threecreepio (jdp@moz-DB2D70E9.cust.bredbandsbolaget.se) (Quit: threecreepio)
[11:06:29] *** Joins: threecreepio (jdp@moz-DB2D70E9.cust.bredbandsbolaget.se)
[11:06:32] *** Quits: busylizzy (lisa@FC306F0C:BF233E95:2EB9049C:IP) (Ping timeout)
[11:07:28] *** Joins: busylizzy (lisa@FC306F0C:BF233E95:2EB9049C:IP)
[11:09:42] <dbaupp> wow... the queue is essentially empty
[11:11:55] *** Joins: jpochyla (jpochyla@moz-8D99AE5D.broadband18.iol.cz)
[11:13:23] *** Quits: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net) (Max SendQ exceeded)
[11:13:42] *** Quits: jpochyla (jpochyla@moz-8D99AE5D.broadband18.iol.cz) (Ping timeout)
[11:13:55] *** Joins: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net)
[11:14:14] *** Joins: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de)
[11:14:57] *** Joins: wilsonk|2 (kvirc@moz-39EFBFC2.cg.shawcable.net)
[11:15:15] *** Quits: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[11:16:52] <MaikKlein> so i guess 0.7 will be delayed?
[11:17:35] <cmr> brson might cut it today, but probably.
[11:17:55] <dbaupp> why?
[11:18:25] <cmr> because no one is around to cut the release :p
[11:18:56] <dbaupp> heh
[11:21:04] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[11:25:10] <MaikKlein> seems like the current master doesn't build
[11:26:23] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Ping timeout)
[11:26:37] <MaikKlein> hm or I just messed sth up
[11:26:45] <dbaupp> MaikKlein: they build on the buildbot... http://buildbot.rust-lang.org/console?refresh=15
[11:27:47] <cmr> yichoi: ping
[11:30:25] <dbaupp> did someone fiddle with LLVM recently? (I seem to be rebuilding it)
[11:30:44] <cmr> I think graydon's llvm-clean patch thingy went through
[11:31:03] <cmr> so it might have been that?
[11:31:06] <dbaupp> hm?
[11:32:12] <dbaupp> cmr: this https://github.com/mozilla/rust/pull/7442 right?
[11:32:21] <cmr> yeah I was just looking for it
[11:33:55] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[11:34:23] *** Quits: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net) (Max SendQ exceeded)
[11:34:52] *** Joins: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net)
[11:38:17] <mark_edward> who is this bors guy? He seems like such a workaholic
[11:38:31] <cmr> our robotic overlord.
[11:38:37] <cmr> en.wikipedia.org/wiki/The_Last_of_the_Masters#The_last_government
[11:39:03] <mark_edward> oh... it's a bot...
[11:39:12] * mark_edward facepalms
[11:39:16] <cmr> :p
[11:40:06] <mark_edward> btw, when do you guys sleep? I'm not pointing fingers, i clearly don't have the best record in that regard, but this is one of the most active channels i've been in
[11:40:16] <mark_edward> and that includes big ones
[11:40:21] <MaikKlein> damnit what was the git cmd again to force a local repo update? So that every local files are in sync with the current master?
[11:40:23] <cmr> everyone is in different time zones
[11:40:37] <cmr> MaikKlein: `git pull`?
[11:40:52] <MaikKlein> cmr, seems I have so local changes that are still there
[11:41:02] <cmr> oh I see what you mean
[11:41:17] <cmr> `git checkout HEAD -- .` folloed by... `git clean -xf`
[11:42:25] <dbaupp> mark_edward: well, I'm in australia (there are a few of us in this part of the world... bjz, aatch) so we fill up the channel in the american night (and the europeans too); and I guess the americans talk a lot during their day.
[11:42:59] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[11:42:59] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 144a0308f to 146fcd8bf: 02http://git.io/N3iJvQ
[11:42:59] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[11:43:02] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[11:43:02] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/i7BVWg
[11:43:02] <ghrust> 13rust/06auto 1441f11d6 15Jeaye: rust.vim: Links previously unused rustFuncCall...
[11:43:02] <ghrust> 13rust/06auto 142b3569a 15bors: auto merge of #7374 : Jeaye/rust/func_highlight, r=cmr...
[11:43:02] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[11:43:30] <mark_edward> dbaupp: ah, that makes sense. Rust is truly an international project then.
[11:43:45] <mark_edward> dbaupp: i assume you are working on the Australian localization efforts?
[11:44:03] <dbaupp> the localisation efforts, yeah ;P
[11:44:06] <MaikKlein> i am pretty sure most rustiers don't even sleep
[11:44:12] <cmr> rusties :p
[11:44:20] <MaikKlein> :D
[11:44:46] <mark_edward> lol. i wanna be a rusty. gotta make a commit to Rust before it hits 1.0...
[11:45:00] <cmr> mark_edward: it's ridiculously easy
[11:45:06] <cmr> just look for something that's undocumented :p
[11:45:29] <dbaupp> (that means, open any file in std and extra)
[11:45:52] <mark_edward> true. i wanna make some meaningful code contribution too. but i haven't taken my compilers class yet, and you guys are talking stuff way over my head all the time
[11:45:52] <cmr> mark_edward: http://cmr.github.io/blog/2013/06/23/how-i-got-started-with-rust/
[11:46:10] <mark_edward> i'd love to fix the trait inheritance problem, but that sounds big
[11:46:13] <mark_edward> thanks cmr!
[11:46:30] <cmr> I'm writing the next part today, so stay tuned :p
[11:46:38] <MaikKlein> haha yeah I was reading though the A-easy tag,but nothing really seemed easy
[11:46:40] <dbaupp> mark_edward: does work in the libraries count as "meaningful" for you?
[11:46:41] <MaikKlein> :(
[11:46:52] <mark_edward> yupyupyup
[11:47:04] <cmr> MaikKlein: well, pick one and ask for help! :)
[11:47:10] <MaikKlein> :D
[11:47:14] <dbaupp> mark_edward: maybe https://github.com/mozilla/rust/issues/7366 :)
[11:47:17] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[11:47:32] <MaikKlein> I still don't fully understand resolve
[11:47:39] <mark_edward> thanks !
[11:47:43] <MaikKlein> only like 20% or so
[11:47:47] * mark_edward gasps
[11:47:50] <cmr> 20% is a significant amount of rust
[11:47:53] <mark_edward> maybe i could to do this!
[11:47:55] <cmr> *resolve
[11:48:10] <cmr> I barely understand the ~2% that I've touched :p
[11:48:16] *** Quits: feduser (feduser@1A2C4FEE.D610364D.799BF54A.IP) (Ping timeout)
[11:48:40] <MaikKlein> ok maybe it's 20% of 2%
[11:48:49] <dbaupp> mark_edward: I
[11:48:53] <MaikKlein> haha
[11:49:01] <MaikKlein> there is just too much code
[11:49:02] <MaikKlein> :(
[11:49:05] <dbaupp> mark_edward: 'm looking forward to r+'ing your first patch :)
[11:49:12] <MaikKlein> how awesome is http://pcottle.github.io/learnGitBranching/?demo
[11:49:19] <MaikKlein> gotta learn git now
[11:49:19] * mark_edward explodes with excitement
[11:49:21] <cmr> pretty awesome
[11:49:32] <cmr> there's also...
[11:50:05] * dbaupp is on the edge of his seat
[11:50:14] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[11:50:30] <cmr> http://try.github.io
[11:50:46] <MaikKlein> that I already now
[11:50:54] <MaikKlein> or 
[11:50:58] <MaikKlein> y
[11:51:29] <cmr> hm, that learn git branching thing is hugely improved from when it was first released
[11:51:31] * cmr tries it
[11:52:22] <MaikKlein> the demo is like 500% too fast for me
[11:52:51] *** Joins: dwrensha (chatzilla@moz-DE44EA45.hsd1.pa.comcast.net)
[11:53:05] <dbaupp> MaikKlein: just do it 5 times, and then it'll be perfect :P
[11:54:12] <MaikKlein> :D
[11:56:37] <cyndis> git add -p and git rebase -i are the most awesome things ever
[11:56:56] <dbaupp> cyndis: Rust is pretty good too :P
[11:57:09] <cyndis> heh, yes :p
[11:58:07] <dbaupp> (that said, rebase -i makes by pull requests look wonderful and neat... not like they started, heh)
[11:58:16] <cyndis> :)
[11:58:34] <cmr> There used to be an *awesome* flowchart, all about how to fix commits and stuff, anyone remember what it was?
[11:59:11] <cyndis> what i do is edit stuff, git add -p; git rebase -i + fixup
[11:59:19] *** Joins: Sorella (queen@B12A78F5.BA14766C.95C8B7C6.IP)
[11:59:29] <cyndis> which sadly (I feel) isn't shown in that git demo
[12:01:22] <bjz> mark_edward: I haven't touched much to do with the compiler, just std
[12:01:34] <bjz> mark_edward: and that's fine
[12:01:55] <bjz> mark_edward: the compiler is way over my head
[12:02:01] *** Quits: z0w0 (zack@moz-730D2B29.lnse3.woo.bigpond.net.au) (Client exited)
[12:02:06] <mark_edward> i understand the feeling!
[12:02:22] <mark_edward> btw, did my curl_wrapper end up being useful?
[12:02:40] <bjz> mark_edward: yup, but I'm getting a seg fault atm
[12:02:57] *** Quits: mark_edward (quassel@moz-4A9A2F15.dynamic.utc.edu) (Quit: http://quassel-irc.org - Chat comfortably. Anywhere.)
[12:03:07] <bjz> byebye
[12:03:09] *** Joins: mark_edward (quassel@moz-4A9A2F15.dynamic.utc.edu)
[12:03:14] <mark_edward> :-( where/how? what exactly are you doing
[12:03:56] <bjz> probably my own fault, just haven't narrowed it down
[12:04:46] <bjz> mark_edward: easy_setopt should probably be unsafe
[12:05:35] <mark_edward> yes.. the whole Curl struct should be basically... I can't figure out how to make it completely safe.
[12:06:33] <bjz> mark_edward: it would be nice if it was easier to use a writer with it. atm I set a @Writer in local storage an use it in the write_fn
[12:07:03] <bjz> but it's tricky with the writer functions in io returning @Writers
[12:07:33] <mark_edward> you want to essentially make a request and have the writer write all received data?
[12:08:06] <cmr> MaikKlein: if you're interested in resolve, https://github.com/mozilla/rust/issues/7379 is a good one. The first step is writing tests for every class of resolve error :)
[12:08:11] <bjz> well, that's my use, but the issue is that might be a too restictive api
[12:08:13] <dbaupp> cmr: https://github.com/mozilla/rust/pull/7487 (could I convince you to give me a p=1? :) )
[12:08:22] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[12:08:23] <bjz> mark_edward: when  get it working, I'll show you
[12:08:30] <mark_edward> ok, cool
[12:08:58] <mark_edward> did i tell you that you win free lifetime support for awesome feedback?
[12:09:05] <mark_edward> :P
[12:09:37] <dbaupp> cmr: thanks
[12:09:40] <cmr> np
[12:10:03] <dbaupp> cmr: it was a long TWiR this week!
[12:10:09] <cmr> dbaupp: yes it was!
[12:10:12] <dbaupp> (yay speedy development!)
[12:10:14] <cmr> tons of good PRs
[12:10:35] <cmr> I like that breaking changes was short this week :)
[12:10:40] *** Joins: zakora (NC@moz-8EAF945F.fbx.proxad.net)
[12:10:45] <bjz> mark_edward: heh :D
[12:11:32] <bjz> mark_edward: btw, why is it `CURLE_OK` not `CURL_OK`? Is that weirdness on the curl lib end?
[12:11:54] <dbaupp> bjz: CURLE[rror]_OK?
[12:12:09] <bjz> OH
[12:12:15] <mark_edward> yup, that's directly copy-pasted
[12:12:22] <bjz> weird underscoring
[12:12:26] <mark_edward> http://curl.haxx.se/libcurl/c/libcurl-errors.html
[12:12:30] <bjz> mark_edward: yeh, thought so
[12:12:52] <bjz> mark_edward: also, the examples probably shouldn't be in the root module
[12:13:28] <mark_edward> ok, i'll put them in an examples folder. althought here aren't enough to warran separate files (yet?)
[12:13:33] <bjz> the lib should be `curl` with `code` and `opt` as sub modules
[12:14:38] <bjz> mark_edward: I mean, they shouldn't even be built with the lib
[12:14:47] <mark_edward> oh, right
[12:14:49] <bjz> mark_edward: they should be separate programs
[12:14:57] <mark_edward> gotcha
[12:15:00] <bjz> if tht makes sense
[12:15:22] <bjz> it's odd doing rust_curl::curl
[12:15:50] <bjz> should be something like curl::get
[12:16:26] <bjz> also, why does the simple curl::get include a header?
[12:16:38] <bjz> what was your reasoning?
[12:17:23] *** Quits: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Ping timeout)
[12:17:51] <mark_edward> that one might want that, btu now i get that that doesn't belong... when calling that you really just want the body of the response, right?
[12:18:54] <mark_edward> cmr: is there still the no macros in enums rule?
[12:19:14] <bjz> mark_edward: aye
[12:19:30] <mark_edward> cool, well i can fix that quickly
[12:20:49] *** Parts: Blei (philipp@moz-650B9C6A.cust.bluewin.ch) (WeeChat 0.4.1)
[12:21:01] <cmr> mark_edward: I didn't know that was a rule
[12:21:12] <cmr> don't quite understand what you mean though
[12:21:45] <dbaupp> mark_edward: enums can only be items (e.g. where a `fn` or `struct` could go) or expressions (e.g. where you can write `1 + 1`), anywhere else is an error
[12:22:37] <cmr> mark_edward: another *super awesome* thing you could do that's fairly easy is write benchmarks
[12:23:04] <cmr> nothing fancy like on the computer language benchmark game, but simple things that stress a single part of codegen
[12:23:18] <mark_edward> cmr: i'll give you what i'm trying to dod in a minute. and i'd be very willing to do that!
[12:23:24] <cmr> so like constructing a struct in a loop, allocating a ~foo in a loop, etc.
[12:23:56] <dbaupp> (if you do end up doing that, using #[bench]'d be neat https://github.com/mozilla/rust/wiki/Doc-unit-testing#benchmarking)
[12:24:06] <cmr> mhm
[12:24:22] <cmr> and also being able to tweak various knobs using environment variables
[12:24:27] <cmr> (like iteration count etc)
[12:24:34] <dbaupp> (that said, anything is better than nothing)
[12:24:55] <dbaupp> cmr: #[bench] tunes the iteration could until it gets a "certain" estimate of the runtime
[12:25:16] <mark_edward> cool. also, would this be somewhere in the rust repo, or a separate one?
[12:25:23] <cmr> mark_edward: in src/test/bench
[12:25:24] <dbaupp> cmr: (i.e. it does statistics and so on, and then runs more/fewer iterations depending how constant the runs are.)
[12:25:29] <cmr> (of rust)
[12:25:44] <cmr> dbaupp: oh, fancy!
[12:26:38] * cmr goes off to setup the benchbox
[12:26:48] <mark_edward> oh ok! that sounds cool
[12:27:10] *** Joins: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP)
[12:30:12] <mark_edward> cmr: here is the problem im having https://gist.github.com/MarkJr94/5894971
[12:30:56] <mark_edward> ignore the mistake at lines 399 and 129 and 20
[12:32:16] <mark_edward> leftovers from c code... and the compiler oesnt even get there
[12:33:43] *** Quits: Aetherspawn (Aetherspaw@moz-8811D9F0.static.tpgi.com.au) (Ping timeout)
[12:34:31] <dbaupp> mark_edward: https://gist.github.com/huonw/320824690a7939096c30
[12:34:55] <dbaupp> mark_edward: (untested, but that technique works)
[12:35:24] <mark_edward> you are god amongst men. thank you, i hated passing in plain ints. brings back all those old C problems
[12:35:35] <mark_edward> is there any way to cast an int to an i32?
[12:35:45] *** Quits: mindginative (mindginati@moz-90AB6445.dyn.cust.vf.net.nz) (Quit: brb)
[12:35:50] <mark_edward> the underlying C api neds 32bit ints
[12:36:37] <MaikKlein> rusti: 5i32
[12:36:41] -rusti- 5
[12:36:51] <dbaupp> rusti: 1i as i32
[12:36:52] -rusti- 1
[12:38:00] *** Quits: zakora (NC@moz-8EAF945F.fbx.proxad.net) (Quit: Textual IRC Client: www.textualapp.com)
[12:38:54] <mark_edward> cool
[12:42:53] <mnemotic> i'd like to take a stab at https://github.com/mozilla/rust/issues/7422
[12:42:57] <mark_edward> dbaupp: now i'm getting:curl/opt.rs:27:21: 27:22 error: expected ident, found `1`
[12:42:57] <mark_edward> curl/opt.rs:27   FILE, OBJECTPOINT, 1;
[12:42:57] <mark_edward>                                     ^
[12:43:31] <dbaupp> mark_edward: what's the macro you're using? (My one?)
[12:43:36] <mark_edward> yup
[12:43:57] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[12:45:39] <dbaupp> mark_edward: `implOpt! { FILE, OBJECTPOINT, 1; URL, OBJECTPOINT, 2 }` works for me
[12:45:56] <mark_edward> hmmm
[12:46:04] <mnemotic> mmm, or maybe https://github.com/mozilla/rust/issues/6314
[12:46:55] <mnemotic> since that would touch code for 7422 anyways
[12:47:14] <mnemotic> any words of wisdom before I embarrass myself? :)
[12:47:21] <mark_edward> now getting an unexpected end of macro invocation error
[12:47:30] *** Joins: kabsy (kabsy@36AD3947.8FD7ABBF.44CE36B8.IP)
[12:47:43] *** Parts: kabsy (kabsy@36AD3947.8FD7ABBF.44CE36B8.IP) ()
[12:47:46] <dbaupp> mark_edward: don't need a trailing ;
[12:47:53] <mark_edward> thanks
[12:47:53] <dbaupp> (in fact, need to not have a trailing ;)
[12:47:57] <cmr> mnemotic: "good luck" :p
[12:48:25] <mnemotic> whelp... hold the beer and stand aside! :D
[12:50:48] <cmr> I found a more powerful box to run the benches on. has two dual-core 1.6GHz xeons (http://ark.intel.com/products/27214/Intel-Xeon-Processor-5110-4M-Cache-1_60-GHz-1066-MHz-FSB) and 8GB of memory
[12:51:06] <dbaupp> cmr: (you missed compiletest in the great renaming :) nice work on that, btw)
[12:51:17] <dbaupp> cmr: it magically fell out of the sky?
[12:51:19] <cmr> dbaupp: I very purposefully did not do those tests :p
[12:51:34] <dbaupp> cmr: I mean the actual test runner, src/compiletest
[12:51:37] <cmr> oh
[12:51:43] <cmr> oops!
[12:51:45] <dbaupp> I'm doing it now :)
[12:52:27] <cmr> dbaupp: It's a server I stood up at my old high school.. serves video for the school a/v club, but completely idle during the summer.
[12:52:36] <cmr> forgot it existed :p
[12:52:49] <dbaupp> that's definitely cheating :P
[12:52:53] <cmr> yup! heh
[12:53:17] <mark_edward> dbaupp: thansk for all the help!
[12:53:17] <cmr> a good interim box though, until I get a real one or mozilla sets one up
[12:53:29] <dbaupp> mark_edward: it works? :)
[12:53:42] <dbaupp> *worsk :P
[12:53:43] <mark_edward> yup! one last question, two enum varints cna't have the same value, right?
[12:53:45] *** Joins: illissius (illissius@moz-19397A63.catv.broadband.hu)
[12:53:51] <dbaupp> I believe so
[12:54:01] <cmr> rusti: enum Foo {C = 5, D = 6}
[12:54:02] -rusti- ()
[12:54:05] <cmr> rusti: enum Foo {C = 5, D = 5}
[12:54:07] -rusti- <anon>:9:26: 9:31 error: discriminator value already exists
[12:54:07] -rusti- <anon>:9          enum Foo {C = 5, D = 5}
[12:54:07] -rusti-                                    ^~~~~
[12:54:07] -rusti- error: aborting due to previous error
[12:54:07] -rusti- application terminated with error code 101
[12:54:21] <dbaupp> cmr: yeah, are you going to make the raw json data publically accessible?
[12:54:28] <cmr> dbaupp: yup
[12:54:37] <dbaupp> good good :)
[12:54:52] *** Parts: mnemotic (niko@8FFD1BD2.9D81E74C.53DF0002.IP) ()
[12:55:49] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[12:57:05] <mark_edward> ruediger: enum { C = 5, D = C}
[12:57:08] <mark_edward> oops
[12:57:14] <mark_edward> rusti: enum { C = 5, D = C}
[12:57:14] -rusti- <anon>:9:14: 9:15 error: expected ident, found `{`
[12:57:16] -rusti- <anon>:9          enum { C = 5, D = C}
[12:57:16] -rusti-                        ^
[12:57:16] -rusti- application terminated with error code 101
[12:57:22] <mark_edward> rusti: enum stuff { C = 5, D = C}
[12:57:23] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/RiJM
[12:57:53] <mark_edward> darn tab-completion
[12:58:51] *** Joins: judder (maradukewa@5B9E91E7.2C8A8E2E.78E362FE.IP)
[12:59:09] *** Quits: Sindwiller (quassel@moz-743130B2.dynamic.hispeed.ch) (Connection reset by peer)
[12:59:15] *** Joins: Sindwiller (quassel@moz-743130B2.dynamic.hispeed.ch)
[12:59:29] <dbaupp> rusti: enum stuff { C = 5, D = C + 1}
[12:59:29] -rusti- <anon>:9:33: 9:38 error: Bad operands for binary
[12:59:30] -rusti- <anon>:9          enum stuff { C = 5, D = C + 1}
[12:59:30] -rusti-                                           ^~~~~
[12:59:30] -rusti- application terminated with error code 101
[12:59:38] <MaikKlein> rusti: enum tada { alpha = 'a', beta = 'b'}
[12:59:40] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/DVPB
[12:59:40] <dbaupp> rusti: enum stuff { C = 5, D = C as uint + 1}
[12:59:41] -rusti- error: internal compiler error: node_id_to_type: no type for node `expr C as uint (id=16)`
[12:59:41] -rusti- application terminated with error code 101
[12:59:49] <dbaupp> \o/
[13:00:00] <dbaupp> mark_edward: I think it's not going to work as an enum :(
[13:01:06] <mark_edward> i got it. the aliases are only needed in a few places, and are not really needed at all. if my user (bjz) complains, i'll change it back
[13:01:18] <mark_edward> btw, can you specailize on type parameters?
[13:02:16] <bjz> mark_edward: the so called 'c-style enums' are going to be phased out I thinkl
[13:02:20] <bjz> *think
[13:02:26] <cmr> they are?
[13:02:31] <mark_edward> bjz: what do you mean?
[13:02:52] <mark_edward> and did you see the second question oh wise rusties?
[13:03:23] <bjz> mark_edward: in favour of statics, with newtype structs. It'll be macrofied
[13:03:29] <bjz> but don't quote me
[13:03:31] <MaikKlein> is it possible that sublime and github have different code formats? my code is always vandalized by github https://github.com/MaikKlein/RustSceneGraph/blob/master/src/examples/example.rs :(
[13:03:34] <cmr> what do you mean specialize on type parameters? overloading?
[13:03:47] <cmr> MaikKlein: you're using tabs
[13:03:50] <cmr> use spaces
[13:03:55] <mark_edward> do you know of template specialization in C++?
[13:03:57] *** Joins: doener (doener@moz-121949B3.unitymediagroup.de)
[13:04:04] <cmr> no I don't know c++ that well :(
[13:04:12] <mark_edward> ok hold on
[13:04:40] <MaikKlein> cmr, so you are saying I should hit 4 times space instead of one time tab :( ?
[13:04:50] <engla> no specializations possible, it doesn't allow trait impl types to overlap
[13:04:50] <cmr> MaikKlein: no, it's a setting somewhere in sublime I'm sure
[13:04:52] <doener> have your editor expand the tabs
[13:05:01] <MaikKlein> ah
[13:05:17] <dbaupp> mark_edward: I think that feature is (slightly) under discussion at the moment
[13:05:29] <MaikKlein> "translate_tabs_to_spaces": false,
[13:05:30] <MaikKlein> y
[13:05:34] <mark_edward> cmr:  see here for C++ example https://github.com/MarkJr94/argparser/blob/master/OptParser.hpp#L92-L101 and https://github.com/MarkJr94/argparser/blob/master/OptParser.hpp#L209-L223
[13:05:51] <dbaupp> mark_edward: https://github.com/mozilla/rust/issues/7059
[13:05:58] <mark_edward> ah ok, thanks for the link
[13:06:45] <mark_edward> i think it's really great. let's you optimize for certain corner cases and stuff. i know it's used like that in the C++ standard library a lot, like in the generic sort algorithm
[13:07:56] <dbaupp> yeah, I sort-of want it for performance reasons, but it makes the type system a little stranger
[13:08:38] <mark_edward> how so?
[13:08:44] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[13:08:45] <mark_edward> cmr: did the example help at all?
[13:09:10] <cmr> mark_edward: kinda! to me it looks like it's just traits with default methods though :\
[13:09:17] <dbaupp> because it means that things get inconsistent/don't resolve properly (depending how specialisation is implemented)
[13:09:40] <dbaupp> cmr: sort of, but more flexible
[13:10:08] <dbaupp> mark_edward: e.g. "specialise foo for (T, int); specialise foo for (int, T); foo(int, int)"
[13:10:16] <doener> the example is using two different generic versions. Would specialization for concrete types be easier?
[13:10:18] <dbaupp> (which specialisation of foo is used?)
[13:10:44] <doener> ah, counter-example given before question posed :-)
[13:11:00] <mark_edward> dbaupp: ah i see... in that case i'd pick the first declared
[13:11:08] *** Quits: igl1 (igl@moz-25A8A85C.adsl.alicedsl.de) (Ping timeout)
[13:11:15] <mark_edward> or encountered by the compiler, however you want to say it
[13:11:17] <dbaupp> doener: I read your mind :P
[13:11:26] <doener> poor dbaupp 
[13:12:01] *** Joins: igl (igl@moz-84B72F4E.adsl.alicedsl.de)
[13:12:38] <dbaupp> bjz: was it you who had a proposal about resolution order of specialised functions?
[13:12:51] <dbaupp> mark_edward: one proposal was to disallow overlapping specialisations like that
[13:13:12] <bjz> dbaupp: yep
[13:13:25] <dbaupp> (i.e. impose a partial order on them, and only allow sub/super-specialisations, not "equal"-specialisations)
[13:13:35] <dbaupp> bjz: link? :) (I can't find it in my history...)
[13:13:48] *** Quits: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de) (Ping timeout)
[13:14:05] <bjz> https://gist.github.com/bjz/5855557
[13:14:06] *** Joins: sw17ch (sw17ch@moz-39D8564F.wndsny.tds.net)
[13:14:17] <bjz> not to be taken too seriously
[13:14:36] <bjz> would need more thought
[13:15:00] <cmr> Codename: OITRTA (one impl to rule them all)
[13:15:17] <dbaupp> cmr: not enough INH...A
[13:15:21] <cmr> heh
[13:15:55] <dbaupp> (well, INHTP...A)
[13:21:17] <mark_edward> bjz: btw i'm following you're advice and making easy_setopt unsafe
[13:21:26] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[13:27:52] <mark_edward> bjz: changes pushed.
[13:28:16] <mark_edward> i'll get to the examples issue soon. after that i'll see about the namespace issue
[13:29:11] <dbaupp> cmr: fwiw, I don't think C++ allows unicode identifiers
[13:29:22] <cmr> dbaupp: ah
[13:32:21] <cmr> I see http://stackoverflow.com/a/12693346/1419479
[13:32:29] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[13:33:35] <cmr> and http://stackoverflow.com/questions/5676978/unicode-identifiers-and-source-code-in-c0x
[13:34:48] <dbaupp> cmr: g++ -fextended-identifiers doesn't seem to mangle (e.g.) \u0100 at all
[13:36:58] <mark_edward> hm
[13:37:03] <bjz> mark_edward: awesome
[13:37:04] <cmr> interesting, maybe it's just a problem with the android toolchain then?
[13:37:31] <dbaupp> yeah it is
[13:37:39] <dbaupp> (at least, that's what caused this)
[13:38:43] <mark_edward> bjz: my tests don't work for ow, i didn't add the unsafe thing to that. but i didn't change anything besides the enum thing and the unsafeblocks, so it's no biggy for now. i'll fix it now
[13:41:47] *** Quits: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk) (NickServ (GHOST command used by Amanieu_))
[13:42:01] *** Joins: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk)
[13:42:47] <mark_edward> fixed
[13:42:49] *** Joins: pyrac (pyrac@moz-3A4AC930.w90-55.abo.wanadoo.fr)
[13:46:02] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[13:46:02] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/i7BVWg
[13:46:02] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[13:49:08] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[13:49:08] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/kpKBhg
[13:49:08] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[13:49:08] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[13:49:09] <ghrust> 01[13rust01] 15bors pushed 10 new commits to 06auto: 02http://git.io/cNAgpA
[13:49:09] <ghrust> 13rust/06auto 145d46bcc 15Huon Wilson: Remove vec::{rfind, rfind_between, find_between}, replaced by slices and iterator adapators.
[13:49:09] <ghrust> 13rust/06auto 1445940ed 15Huon Wilson: Remove vec::[r]position_between, replaced by slices & iterators.
[13:49:10] <ghrust> 13rust/06auto 14a890c2c 15Huon Wilson: Convert vec::{rposition, rposition_elem, position_elem, contains} to methods.
[13:49:11] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[13:51:10] * dbaupp crosses his fingers
[13:51:34] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[13:54:16] *** Joins: mnemotic (niko@8FFD1BD2.9D81E74C.53DF0002.IP)
[13:56:45] *** Quits: threecreepio (jdp@moz-DB2D70E9.cust.bredbandsbolaget.se) (Quit: threecreepio)
[13:56:59] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Ping timeout)
[13:58:06] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[13:59:13] *** Quits: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk) (Ping timeout)
[13:59:59] <cmr> dbaupp: data should automatically land in http://hnn.mrsd.org/~cmr/
[14:00:15] <cmr> it will have subdirectories with the commit the data is from
[14:02:18] <dbaupp> awesome!
[14:02:22] <dbaupp> would it be possible to have a "latest" (with a single hash) or "history" file (with hashes in order of date, i.e. most recent at the bottom)?
[14:02:33] <cmr> sure
[14:02:41] <cmr> well
[14:02:47] <cmr> hm
[14:02:49] <dbaupp> (the latter would be preferable)
[14:03:05] <dbaupp> even just `echo $hash >> history` would work
[14:03:28] <cmr> yeah, ok
[14:03:36] <cmr> I was thinking "it might not be in chronologiacl order"
[14:03:44] <cmr> but I won't be using this box for PR benching anyway
[14:04:30] <dbaupp> (you may want to put each hash into subdirectories based on the first letter, to avoid the top-level directory getting huge, depending how many benchs you're planning on doing)
[14:04:33] <dbaupp> what do you mean?
[14:05:35] <cmr> if I benched commits out of order. my script is very dumb, basically just a shell script that does ../configure; make clean; make -j4; mem-bench.py ... > ~/benches/$hash/mem.json; time ... > ~/benches/$hash/time.txt;
[14:06:37] <dbaupp> ah, right
[14:06:54] <cmr> But I won't be benching them out of order, so it's fine
[14:06:59] <dbaupp> this would mostly be so that a script can just hit the history file to check for new benches
[14:07:06] <cmr> right
[14:07:27] *** Joins: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com)
[14:07:28] <dbaupp> (so the chronology doesn't actually matter.)
[14:10:36] *** Joins: samx (sami@moz-369757A0.pp.htv.fi)
[14:12:12] *** Quits: Earnestly (earnest@2A2BF8F5.321FA5E6.BFD1ABFD.IP) (Ping timeout)
[14:13:09] <cmr> I wonder if I could convince graydon to set up a web hook for me so I don't have to poll the repo
[14:15:01] *** Quits: Sindwiller (quassel@moz-743130B2.dynamic.hispeed.ch) (Client exited)
[14:23:06] *** Quits: victorporof (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP) (Quit: victorporof)
[14:26:18] *** Joins: victorporof (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP)
[14:32:48] *** Quits: pyrac (pyrac@moz-3A4AC930.w90-55.abo.wanadoo.fr) (Quit: pyrac)
[14:53:00] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[15:01:47] *** Joins: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca)
[15:02:59] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[15:03:55] *** Joins: threecreepio (jdp@moz-DB2D70E9.cust.bredbandsbolaget.se)
[15:04:41] *** Joins: bytbox (s@moz-D4F26CEB.hsd1.md.comcast.net)
[15:10:52] <etw> having a bit of trouble with this error: "error: loan of dereference of mutable & pointer as mutable conflicts with prior loan", just trying to iterate over a vec inside a &mut struct param
[15:12:03] *** Joins: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de)
[15:13:26] *** Quits: itdaniher (it@moz-C885C25B.mit.edu) (Ping timeout)
[15:16:03] <etw> how can I prevent the immutable loan when doing something like "for struct.items.each |&item|" ?
[15:16:48] *** Joins: itdaniher (it@moz-C885C25B.mit.edu)
[15:18:38] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Quit: Leaving)
[15:18:57] *** Quits: dbaupp (Thunderbir@moz-EAB436DB.lns20.syd6.internode.on.net) (Ping timeout)
[15:19:03] <Seldaek> etw: not sure but you could try |&mut item|
[15:20:59] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[15:21:12] <etw> hmm, "error: found `mut` in ident position", I also tried let &mut items = struct.items;, same error
[15:23:50] <etw> hmm ok, nut &instruction appears to be the correct syntax, but doesn't affect the borrowing 
[15:24:11] <cmr> etw: can you pastebin all of your code?
[15:25:19] <doomlord> is there something for making a c header for rust extern "C" functions / structs
[15:25:36] <cmr> doomlord: the inverse of rust-bindgen? not that I know of
[15:25:46] <doomlord> yes exactly that i think
[15:25:58] <etw> http://pastebin.com/mVjsP84j
[15:26:18] <doomlord> i wonder how hard this would be to put together - perhaps rolling trait-objects too
[15:26:32] <cmr> etw: there is no ~mut
[15:26:38] <cmr> etw: are you using rust 0.6?
[15:26:52] <engla> there is no .each either anymore
[15:26:59] <etw> cmr: yes
[15:27:49] <etw> engla: what's the current way to iterate over a vec? I'm having trouble finding docs
[15:28:10] <cmr> for foo.iter().advance |x| { ... }
[15:28:22] <engla> there is a new tutorial, link: http://static.rust-lang.org/doc/tutorial-container.html
[15:28:27] *** Joins: pyrac (pyrac@moz-3A4AC930.w90-55.abo.wanadoo.fr)
[15:29:45] <etw> ok I was getting some confusing errors when I tried that which lead me in the wrong direction
[15:30:08] *** Joins: Sindwiller (quassel@moz-743130B2.dynamic.hispeed.ch)
[15:30:43] <engla> etw: |&instruction|   this syntax here doesn't denote that instruction is a borrowed pointer
[15:31:00] <engla> it's a pattern match, so it matches a borrowed pointer and dereferences it
[15:31:10] <engla> let &x = &3; x
[15:31:14] <engla> will be 3
[15:31:37] <engla> rusti: let &x = &3; x
[15:31:38] -rusti- 3
[15:36:13] <etw> this is the error that's confusing me: "~[T] does not implement any method in scope named `iter`"
[15:36:32] <engla> you need rust from master (development version) for that
[15:37:15] <etw> oh, uh, so 0.6 doesn't have each or iter() ?
[15:37:24] <engla> it has each, not iter
[15:38:08] <engla> anyway it is very old, 0.7 is coming soon
[15:39:13] <etw> I've built rust locally, might start using it then
[15:40:24] *** Joins: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP)
[15:40:55] <Seldaek> anyone knows Palmer Cox's irc or github handle?
[15:42:00] *** Joins: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com)
[15:42:17] *** Joins: dormiens (dormiens@2F2DB458.B767B9B7.2675F9C0.IP)
[15:42:30] <doener> Seldaek: git logs suggest that it's DaGenix on github
[15:45:33] *** Joins: dualhbridge (dad@5033F981.CB6B16F2.1EF4A660.IP)
[15:48:31] *** Quits: threecreepio (jdp@moz-DB2D70E9.cust.bredbandsbolaget.se) (Quit: threecreepio)
[15:50:08] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Connection reset by peer)
[15:50:47] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[15:52:47] <Seldaek> doener: thanks, the commits I saw weren't linked to his github account
[15:53:19] <doener> Seldaek: I looked up the merge commit by bors, which mentions the repo the commits are coming from
[15:53:25] <doener> for merge in $(git rev-list --merges HEAD); do if test "$(git show -s --pretty=%an $merge^2)" == "Palmer Cox"; then git show -s $merge; break; fi; done
[15:54:06] <Seldaek> oh alright nice
[15:55:21] *** Quits: samx (sami@moz-369757A0.pp.htv.fi) (Quit: This computer has gone to sleep)
[16:01:26] *** Joins: lolskater (Durmush@25203FEC.2881111B.1D5753B8.IP)
[16:01:35] <etw> the current errors on borrowing are a little better, nice
[16:03:06] *** Joins: threecreepio (jdp@moz-DB2D70E9.cust.bredbandsbolaget.se)
[16:03:26] <MaikKlein> btw what purpose does the buildbot have? is it to test if commits compile?
[16:03:50] <MaikKlein> and to see if the tests are passing?
[16:03:56] <cmr> yes
[16:04:05] <cmr> automatic integration tests
[16:04:18] <cmr> if the tests don't pass, the PR doesn't get merged
[16:04:34] <MaikKlein> k
[16:04:44] <MaikKlein> but we don't have access to the output?
[16:04:48] <MaikKlein> like the binaries
[16:04:56] <cmr> not the build artefacts, no
[16:05:23] *** Quits: dualhbridge (dad@5033F981.CB6B16F2.1EF4A660.IP) (Ping timeout)
[16:05:51] *** Joins: frogmella (Mibbit@moz-72830A1C.nyc.res.rr.com)
[16:09:40] *** Quits: bytbox (s@moz-D4F26CEB.hsd1.md.comcast.net) (Ping timeout)
[16:14:08] *** Joins: dualhbridge (dad@5033F981.CB6B16F2.1EF4A660.IP)
[16:14:37] *** Parts: dualhbridge (dad@5033F981.CB6B16F2.1EF4A660.IP) ()
[16:19:17] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[16:19:17] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 142ea0989 to 142b3569a: 02http://git.io/N3iJvQ
[16:19:17] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[16:19:18] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[16:19:18] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/_itzkg
[16:19:18] <ghrust> 13rust/06auto 14b3e73df 15Daniel Micay: add a closure_exchange_malloc lang item...
[16:19:18] <ghrust> 13rust/06auto 1441f25cb 15bors: auto merge of #7495 : thestinger/rust/exchange, r=cmr...
[16:19:20] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[16:19:58] <MaikKlein> hm
[16:20:05] <MaikKlein> what was the trait for get a + b
[16:20:10] <cmr> Add?
[16:20:11] <MaikKlein> <T: Add> ?
[16:20:33] <MaikKlein> ah right it needs arguments
[16:22:10] <mnemotic> after working with emacs I have trouble with text navigation and input in all **other** applications
[16:22:16] <mnemotic> thanks rms
[16:22:54] <doener> luckily (for me) you get the most important vim bindings in most applications I use
[16:23:17] <MaikKlein> is a += b also in Add?
[16:23:28] <cmr> No, a += b is 1. broken, 2. not a trait anymore
[16:23:43] <MaikKlein> ah that's why I get all those errors in lmath
[16:23:44] <cmr> To be fixed and added in later
[16:25:14] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[16:25:16] <acrichto> r? https://github.com/mozilla/rust/pull/7465
[16:26:35] <acrichto> cmr: thanks
[16:26:37] <cmr> np
[16:27:55] *** Quits: sw17ch (sw17ch@moz-39D8564F.wndsny.tds.net) (Quit: sw17ch)
[16:32:42] *** Quits: lolskater (Durmush@25203FEC.2881111B.1D5753B8.IP) (Quit: )
[16:34:24] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[16:34:24] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1441f25cb to 142b3569a: 02http://git.io/N3iJvQ
[16:34:24] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[16:34:57] *** Joins: gareth0 (gareth0@moz-6B5865FE.dynamic.dsl.as9105.com)
[16:37:15] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[16:37:58] *** Joins: Earnestly (earnest@2A2BF8F5.321FA5E6.BFD1ABFD.IP)
[16:38:39] <MaikKlein> anyone an idea where I would add the lifetime? https://github.com/bjz/lmath-rs/blob/master/src/dim_macros.rs#L218
[16:38:43] <MaikKlein> .all(|&x| x) is making problems
[16:39:55] *** Joins: bytbox (s@moz-D4F26CEB.hsd1.md.comcast.net)
[16:43:59] <engla> I don't like this change to let mut:
[16:44:02] <engla> rusti: let f = || (~[1], ~[2]); let mut (a,b) = f();
[16:44:03] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/VLTG
[16:45:24] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[16:45:50] <engla> MaikKlein: what happens if you store the result of .zip in a variable?
[16:46:50] <MaikKlein> engla, same error, even if I clone the result :(
[16:47:37] <engla> what's the error?
[16:48:40] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[16:48:47] <MaikKlein> src/dim_macros.rs:218:16: 218:68 error: borrowed value does not live long enough
[16:48:47] <MaikKlein> src/dim_macros.rs:218                 self.zip(other, |a, b| a.approx_eq_eps(b, epsilon)).iter().all(|&x| x)
[16:48:47] <MaikKlein>                                       ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[16:49:50] <MaikKlein> could it be possible that the macro makes problems?
[16:50:11] *** Quits: Earnestly (earnest@2A2BF8F5.321FA5E6.BFD1ABFD.IP) (Ping timeout)
[16:50:37] <engla> such things can happen
[16:50:44] <sp3d> MaikKlein: try expanding and compiling separately, then?
[16:50:48] <engla> but it's probably simpler
[16:51:15] <engla> I've had code that compiled fine expanded but not in macro form
[16:52:17] <MaikKlein> sp3d, bjz's lib uses macros everywhere it would be a huge rewrite
[16:52:41] <engla> you can test it by letting rustc --pretty   output the expanded form
[16:53:02] <engla> but I'll look at your code again
[16:53:03] <sp3d> ^
[16:53:05] <engla> not that I'm very good
[16:53:08] *** Joins: jpochyla (jpochyla@moz-8D99AE5D.broadband18.iol.cz)
[16:53:25] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[16:55:05] <doomlord> talking to someone a question came up, what would rust do in the event of running out of memory (allocation failing) - and could you write code that queries remaining memory
[16:55:19] <sp3d> afaik the task fails
[16:56:29] <mnemotic> rocks fall, everyone dies
[16:56:50] <MaikKlein> poetic
[16:57:10] <sp3d> o, the embarrassment!
[16:57:11] <acrichto> doomlord: frequently it's currently an assertion that malloc succeeds: https://github.com/mozilla/rust/blob/master/src/libstd/rt/global_heap.rs#L25
[16:57:28] <MaikKlein> bjz, I sent you a small PR
[16:58:34] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[17:03:16] <enix> hi, i'm getting what I think is a bogus compiler error with a function returning a tuple. Is this something I should open an issue for or is there something about Rust i'm unaware of: https://gist.github.com/DaGenix/5895932
[17:04:05] <cmr> that does seem to be a bogus error
[17:04:05] *** Quits: bytbox (s@moz-D4F26CEB.hsd1.md.comcast.net) (Broken pipe)
[17:04:31] <mnemotic> try `let (X0, X1) = test();`
[17:04:48] <cmr> you can rebind as mut later with "let mut X0 = X0;"
[17:05:38] <enix> let (X0, X1) = test(); works, but in my case i need the values to be mutable
[17:06:00] <enix> ok, cool, i'll rebind them as mutable to work around my problem for now
[17:06:16] <enix> and open up an issue since it seems like the compiler shouldn't be complaining
[17:06:18] <enix> thanks!
[17:10:46] <Seldaek> I'm trying to add an iter() method to EnumSet but I can't figure out what to set as return type here: https://gist.github.com/Seldaek/f7e850ea9c416fe748e1#file-enum_set-rs-L24
[17:11:00] <Seldaek> (disclaimer:this may be completely idiotic)
[17:11:24] <cmr> uh... ew.
[17:11:29] <Seldaek> also I'm not sure how to call vec::from_iterator, but I imagine the way I'm doing it is awful
[17:11:38] <cmr> yeah, it is :p
[17:11:40] <Seldaek> vec::from_iterator didn't resolve though
[17:11:44] <Seldaek> so I tried something else :)
[17:11:59] <cmr> it's not a function, it's a method, you're calling it correctly but what you're doing is gross
[17:12:12] <Seldaek> haha
[17:12:24] <Seldaek> well yeah I had a feeling, but I'm kinda lost here
[17:13:53] *** Quits: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de) (Ping timeout)
[17:13:56] <cmr> what you want to do is have some sort of struct EnumSetIterator or somesuch which keeps track of the state of the iterator
[17:14:06] <cmr> and the .iter() method would construct one of those and return it
[17:14:35] <Seldaek> yeah I tried that but got lost and thought of this dirty hack instead 
[17:14:43] <Seldaek> guess I'll try again
[17:15:01] <engla> Seldaek: from_iterator should be used via IteratorUtil::collect()
[17:15:25] <cmr> You're basically gioing to wnat to turn the variables in the each method into struct fields, and have the next method of the Iterator return 'e' instead of calling f(e)
[17:15:48] <cmr> impl<E: Clike> Iterator<E> for EnumSetIterator { .... }
[17:15:50] <cmr> I think
[17:16:20] <Seldaek> yup that's what I figured, but so you'd say when creating the EnumSetIterator you give pass it self.bits?
[17:16:30] <Seldaek> I'm not sure how rust iterators typically behave if they're modified while iterating
[17:16:43] <cmr> you can't modify an iterator while you're iterating :)
[17:16:44] <Seldaek> but in this case it's hard to keep it working if we don't copy the bits when starting to iterate
[17:16:49] <Seldaek> ok
[17:16:49] <engla> statically prevented Seldaek via &mut borrows
[17:17:15] <Seldaek> well thanks, I'll probably be back in 3min :p
[17:17:18] <cmr> heh :)
[17:17:43] <engla> the iterator holding a &mut ref to the container is basically like holding the writer lock
[17:17:51] <Seldaek> do you generally put all structs on top of the file then all impls or rather struct/impls struct/impls
[17:18:01] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Quit: jmgrosen)
[17:18:03] <cmr> struct/impls struct/impls, personally
[17:18:09] <Seldaek> ok
[17:18:17] <cmr> not sure that there's a style guide thing about that yet
[17:18:32] <cmr> makes sense to me though, locality of reference
[17:21:07] <Seldaek> ah another conceptual problem I had was how to handle the size_hint of the iterator 
[17:21:40] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[17:21:44] <Seldaek> I mean I suck at bitwise stuff and wonder how to find how many elements there are in the bits var
[17:21:54] <Seldaek> I'm sure there is a smart way
[17:22:50] <engla> Seldaek: that operation is called popcount
[17:23:54] <kimundi> engla, enix: afaik 'let mut (...) = ...' is being dissallowed to pave the way for making 'mut' part of the pattern, instead of part of the 'let'. So ultimatly you will be able to write 'let (a, mut b, mut c) = foo()'
[17:24:06] <engla> oh great
[17:24:33] <engla> Yeah I was disgruntled  let (mut a, b) =  ..  wasn't accepted
[17:24:42] <Seldaek> engla: I concur, but not sure what to do with that? it's not in rust is it?
[17:25:27] <engla> I don't think it is Seldaek. Just giving you a keyword you can look up if you want to find smart algorithms for it.
[17:25:48] <Seldaek> yup ok just checking :)
[17:25:54] *** Quits: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl) (Client exited)
[17:26:10] *** Joins: vk (chatzilla@moz-389FEE13.hsd1.ca.comcast.net)
[17:26:12] <Seldaek> but thanks, I forgot the term
[17:26:18] *** Joins: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl)
[17:29:20] <engla> Seldaek: possibly ctpop64 and friends are popcount functions in rust
[17:29:26] <engla> in std::unstable::intrinsics
[17:30:00] <engla> yeah it should be
[17:30:24] <Seldaek> yup that looks good
[17:30:53] <Seldaek> do I have to check the arch or is uint always 64 in rust?
[17:31:21] <engla> uint is size_t so either 32 or 64-bit depending on platform
[17:31:45] <cmr> u64 is always 64bit
[17:31:57] <cmr> uint is however big it needs to be to hold a pointer for that platform
[17:31:57] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[17:33:38] *** Joins: cp (cp@moz-993078EE.plus.com)
[17:33:50] <Seldaek> but the bits in EnumSet is a uint, so is something like (bits as u64).population_count() feasible? And if yes would it blow up on 32bit systems?
[17:36:05] <Seldaek> ah nvm it seems BitCount is implemented on uint too
[17:36:19] <Seldaek> so just bits.population_count() should do
[17:36:36] <engla> oh useful
[17:36:37] <Seldaek> still interested to know if my question above is insanity or not though
[17:36:58] <cmr> it would probably work
[17:37:01] <engla> I grepped for popcount and popcnt but not for population_count or ctpop :)
[17:37:41] *** Quits: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzz‚Ä¶)
[17:38:39] *** Joins: ross (ross@moz-8A84103E.br.br.cox.net)
[17:40:39] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[17:41:20] <Seldaek> iterators can only be consumed once right? the basic Iterator one at least
[17:41:39] <cmr> yes
[17:44:43] <engla> most of them should be simple to .clone()
[17:44:51] <engla> as in cheap to clone
[17:49:33] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[17:53:06] <Seldaek> ok, compile error now with this: https://gist.github.com/Seldaek/f7e850ea9c416fe748e1
[17:53:41] <Seldaek> I solved a bunch but this one is slightly beyond me
[17:54:07] <engla> Seldaek: you probably want the iterator to have a borrowed pointer to the enum set?
[17:54:20] <engla> as written, it has a copy, then you need to copy/clone
[17:54:25] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[17:54:42] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Ping timeout)
[17:55:44] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[17:57:14] <Seldaek> engla: not sure what that'd translate to in code
[17:57:15] *** Quits: vk (chatzilla@moz-389FEE13.hsd1.ca.comcast.net) (Quit: ChatZilla 0.9.90 [Firefox 23.0/20130625125232])
[17:57:26] <Seldaek> engla: but I could also just pass self.bits to the new function?
[17:57:32] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[17:57:51] <Seldaek> or is that evil because the EnumSet could be modified before the iterator is used then?
[17:58:01] <cmr> not possible
[17:58:22] <cmr> well, not possible when you hold a borrowed pointer to something
[17:58:44] <Seldaek> mh ok
[17:59:12] *** Quits: jyeo (uid12229@moz-A539DB7D.hillingdon.irccloud.com) (Ping timeout)
[17:59:25] *** Joins: jyeo (uid12229@moz-C944F5EC.irccloud.com)
[17:59:27] <engla> Seldaek: just be clear in the docs that the iterator has a copy
[18:00:09] <engla> Seldaek: the code problem is like the error message says: you pass in  &set: EnumSet<E>)
[18:00:20] <engla> but the field has type set: EnumSet<E>
[18:00:33] <Seldaek> ah, so it should just be &set in the struct?
[18:00:47] <engla> if you want to hold a reference
[18:00:49] <engla> else you copy
[18:01:52] <engla> hm your code is very complicated
[18:02:10] <engla> just initialize your iterator value when it's created (Probably in EnumSet::iter)
[18:03:12] <Seldaek> yes I'm working on cleaning up the rest now :)
[18:03:53] <engla> you don't need the set field if you already have all the bits copied if I understand correctly
[18:05:08] <Seldaek> yup that's gone
[18:06:09] *** Quits: cp (cp@moz-993078EE.plus.com) (Ping timeout)
[18:06:13] *** Quits: threecreepio (jdp@moz-DB2D70E9.cust.bredbandsbolaget.se) (Quit: threecreepio)
[18:13:02] *** Joins: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de)
[18:13:45] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[18:14:47] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[18:18:55] <MaikKlein> how big is the overhead of c FFI? 
[18:19:15] <MaikKlein> because I might want to port a c networking lib to rust
[18:19:25] <Seldaek> engla: ok you can see the final diff there https://github.com/mozilla/rust/pull/7474/files#L2R8 - I hope I didn't mess up the next() logic, but at least it compiles, thanks
[18:21:14] <cmr> MaikKlein: it isn't so bad when you use the #[fast_ffi] attribute
[18:21:31] <cmr> still lots of room for improvement
[18:21:53] <MaikKlein> i want to port http://enet.bespin.org/Features.html soon
[18:22:04] <cmr> Seldaek: if the tests pass, you're golden :)
[18:22:18] *** Joins: jensnock_ (jensnocker@moz-8BE55278.customer.t3.se)
[18:22:31] <Seldaek> cmr: which tests? :p
[18:22:37] <cmr> Seldaek: all of them.
[18:22:40] <cmr> `make check`
[18:22:58] <Seldaek> yeah I'm kidding but I mean I didn't write new tests for the iterator so I guess it wouldn't break the test suite anyway
[18:23:14] <cmr> eh? https://github.com/mozilla/rust/pull/7474/files#L2L205
[18:23:31] <Seldaek> oh yeah
[18:23:35] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Ping timeout)
[18:23:36] <Seldaek> I guess that implicitly tests it 
[18:23:49] <Seldaek> nevermind me 
[18:23:54] <cmr> did you run the test suite?
[18:23:59] <cmr> at the very least run `make tidy`
[18:24:08] <cmr> catches formatting mistakes
[18:24:18] <Seldaek> well, it failed the compilation at some point 
[18:24:24] <cmr> well that's not good
[18:24:29] <Seldaek> but I don't see why 
[18:24:40] <Seldaek> src/driver/driver.rs:29:0: 29:32 error: multiple matching crates for `rustc`
[18:24:43] <Seldaek> I didn't touch this
[18:24:47] <cmr> ah, do a `make clean` first
[18:24:55] <cmr> someone really needs to fix that, it's a big pain point
[18:25:04] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[18:25:23] *** Joins: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP)
[18:25:23] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/PZWtsw
[18:25:23] *** Parts: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP) ()
[18:26:26] <MaikKlein> HM
[18:26:38] <MaikKlein> remote tasks are not planed yet right? 
[18:26:51] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[18:26:59] *** Quits: pyrac (pyrac@moz-3A4AC930.w90-55.abo.wanadoo.fr) (Quit: pyrac)
[18:27:12] <cmr> MaikKlein: I don't know, you'd have to ask brson. but... there's nothing preventing them, they fit perfectly into the task design
[18:27:35] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[18:28:08] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[18:28:08] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Qak7rQ
[18:28:08] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[18:28:10] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[18:28:10] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/0_PiTg
[18:28:10] <ghrust> 13rust/06auto 147bcde87 15jihyun: Fixes #7377
[18:28:10] <ghrust> 13rust/06auto 148409bf7 15bors: auto merge of #7443 : yjh0502/rust/fix_field_dup, r=huonw...
[18:28:10] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[18:28:13] <strcat> dammit
[18:28:21] <strcat> my exchange allocation stuff works on linux but not OS X
[18:28:24] <strcat> ;\
[18:28:27] <MaikKlein> :x
[18:28:41] *** Quits: dforsyth (dforsyth@A677A619.1C765EF.EE6E63A5.IP) (Ping timeout)
[18:28:42] * strcat tries windows
[18:28:59] <cmr> It'd be really nice if apple allowed usage of OS X in VMs
[18:29:01] *** Joins: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP)
[18:29:01] <ghrust> 01[13rust01] 15thestinger 04force-pushed 06try from 1470e7bce to 14b3e73df: 02http://git.io/k471pw
[18:29:01] <ghrust> 13rust/06try 14b3e73df 15Daniel Micay: add a closure_exchange_malloc lang item...
[18:29:01] *** Parts: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP) ()
[18:29:12] <MaikKlein> haha
[18:29:20] <MaikKlein> will never happen
[18:30:30] <Seldaek> cmr: eh after a make clean I now get make: *** No rule to make target `rt/x86_64-unknown-linux-gnu/stage0/arch/x86_64/_context.o', needed by `rt/x86_64-unknown-linux-gnu/stage0/librustrt.so'.  Stop.
[18:30:39] <MaikKlein> do ./configure again
[18:30:56] <MaikKlein> at least this always works for me
[18:31:12] <Seldaek> hm ok, I *also* suck at compiling it seems :)
[18:31:15] <Seldaek> thanks, let's try
[18:31:59] *** Joins: dforsyth (dforsyth@A677A619.1C765EF.EE6E63A5.IP)
[18:32:04] <strcat> I can't test on mac because we don't have a free mac buildbot
[18:32:05] <strcat> ;\
[18:32:16] <cmr> steal one of the auto builders
[18:32:30] <strcat> cmr: can't
[18:32:37] <strcat> we don't have a free mac buildbot
[18:32:39] <strcat> unless I block auto
[18:32:44] <strcat> and bors will keep trying
[18:32:49] <strcat> so I'll have to make PRs fail to merge
[18:32:51] <cmr> geh
[18:35:01] <strcat> what the hell would OS X be doing that linux doesn't?
[18:35:05] *** Joins: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com)
[18:35:26] <Seldaek> damn, ./configure didn't help, still that same error
[18:35:43] <strcat> does it do stages differently?
[18:39:55] <strcat> grea
[18:39:56] <strcat> t
[18:40:02] <strcat> a problem I can't debug ;\
[18:40:30] <strcat> I guess I'll make mac osx use a different allocator that'll still have headers
[18:40:38] <strcat> I have *no way* to debug this
[18:42:11] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[18:43:19] <strcat> stupid osx
[18:43:51] <strcat> is there OS specific trans code or something? ;\
[18:44:12] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[18:44:45] <MaikKlein> why do I always have to giggle when I see meth.rs ....
[18:45:02] <MaikKlein> what is wrong with me
[18:45:16] <mnemotic> okay, newbie question: i need to make changes to std, but before i can do that, i need to change rustc
[18:45:58] <mnemotic> am i right in thinking that i have to change rustc compile it, and then use it to compile a changed std?
[18:47:26] <mnemotic> does that make sense? :S
[18:47:27] <strcat> mnemotic: why do you have to change rustc first?
[18:48:41] <doener> MaikKlein: meth.rs not even once
[18:48:54] <strcat> doener: what OS are you on?
[18:48:58] <doener> linux
[18:49:02] <strcat> dammit ;p
[18:51:14] <mnemotic> strcat: maybe i don't, here's the story: i'm working on intrinsics (#6314); i see that how they are typed is checked  in typeck/check/mod.rs
[18:51:19] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Quit: Leaving)
[18:51:45] <strcat> mnemotic: to add an intrinsic you just need #[cfg(not(stage0))] on what you add/change in libstd
[18:52:03] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[18:52:16] <strcat> mnemotic: https://github.com/thestinger/rust/commit/b91416214ed0e24b780dec8608a122b6b3a943f5 adding one
[18:52:27] <strcat> mnemotic: https://github.com/thestinger/rust/commit/350a5c0b722038a3743058a7a824cfa6ac7094da making a new version of a fn using it
[18:52:46] *** Joins: pyrac (pyrac@moz-3A4AC930.w90-55.abo.wanadoo.fr)
[18:53:51] <mnemotic> strcat: i'll try that, thanks!
[18:55:23] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[18:57:13] *** Quits: BizarreCake (BizarreCak@32C9829A.151E84E7.561471F8.IP) (Quit: Leaving)
[18:57:51] *** Quits: prudhvi (prudhvi@moz-154A460A.supr.io) (Ping timeout)
[18:59:01] *** Joins: MileyandLaura (Mibbit@moz-7E532EDE.catv.broadband.hu)
[18:59:09] <MileyandLaura> Hello :)
[18:59:29] <kimundi> hi
[18:59:56] *** Joins: Earnestly (earnest@2A2BF8F5.321FA5E6.BFD1ABFD.IP)
[19:00:30] <strcat> passes on windows
[19:00:32] <strcat> passes on linux
[19:00:37] <strcat> fails building on os x ;\
[19:01:01] <strcat> yay segfault that I can't possibly debug without a mac
[19:01:07] *** Parts: MileyandLaura (Mibbit@moz-7E532EDE.catv.broadband.hu) ()
[19:01:19] <kimundi> strcat: Just go steal an osx system somewhere :P
[19:01:23] <strcat> somewhere
[19:01:31] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[19:01:34] <strcat> http://buildbot.rust-lang.org/builders/auto-win-32-nopt/builds/187
[19:01:43] <strcat> ;\
[19:01:51] <strcat> and I ran it on the linux bot with valgrind - totally clean
[19:02:39] <doener> you didn't change allocation sizes anyway, did you? So why would it segfault?
[19:02:57] *** Joins: prudhvi (prudhvi@moz-154A460A.supr.io)
[19:03:02] <strcat> doener: because something on OS X is still using the header
[19:03:10] <strcat> and it's no longer initialized
[19:03:40] <doener> that would have to be the prev or next pointer then?
[19:03:54] <strcat> doener: or the ref_count or tydesc
[19:04:12] <strcat> vectors were the only thing using ref_count, and I fixed that with a contains_managed intrinsic
[19:04:25] <strcat> ~fn was using the tydesc so I gave it a temporary allocator lang item all to itself
[19:04:37] <strcat> works on both windows/linux, valgrind clean in linux
[19:04:44] <strcat> ;\
[19:05:20] <doener> I can't imagine how the ref_count would cause that. But yeah, tydesc also has pointer, that's true
[19:05:27] <doener> pointers even
[19:07:48] <strcat> anyway it's so close to working ;[
[19:08:01] <strcat> once this lands I can start on fixing the offsets to remove the header
[19:10:49] <steven_is_false> Why is the following code wrong? fn foo<'r, T>(x: &'r T, f: &'r fn(&'r T)) -> &'r fn() { || f(x) }
[19:11:09] <steven_is_false> rusti: fn foo<'r, T>(x: &'r T, f: &'r fn(&'r T)) -> &'r fn() { || f(x) }; "works"
[19:11:11] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/ZWRi
[19:11:44] <strcat> doener: the tydesc is actually there when it's building stage0
[19:11:54] *** Quits: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de) (Ping timeout)
[19:11:57] <strcat> err
[19:12:00] <strcat> when it's building stage1*
[19:12:04] <strcat> doener: because I had to remove that in a #[cfg(not(stage0))] lang item
[19:12:11] <strcat> so it's prev/next or ref_count causing this
[19:12:52] <steven_is_false> rusti: fn foo<'r, T>(x: &'r T, f: extern fn(&'r T)) -> &'r fn() { || f(x) }
[19:12:53] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/BViR
[19:14:02] <steven_is_false> rusti: fn foo<'r, T>(x: &'r T, f: extern fn(&'r T)) -> ~fn: 'r() { || f(x) }
[19:14:03] -rusti- <anon>:9:62: 9:64 error: `'static` is the only permissible region bound here
[19:14:03] -rusti- <anon>:9          fn foo<'r, T>(x: &'r T, f: extern fn(&'r T)) -> ~fn: 'r() { || f(x) }
[19:14:03] -rusti-                                                                        ^~
[19:14:03] -rusti- error: aborting due to previous error
[19:14:03] -rusti- application terminated with error code 101
[19:14:29] <steven_is_false> ^ Is that what I actually mean?
[19:15:24] <strcat> that the only one allowed as a bound is 'static
[19:15:45] <steven_is_false> I'm confused
[19:15:58] <strcat> the only region allowed as a bound in types is 'static
[19:16:11] <strcat> you can't use 'r in a type bound
[19:18:12] <steven_is_false> Yeah, the compiler told me that
[19:18:36] <strcat> so what are you confused about?
[19:18:48] <strcat> it's not yet possible to do that
[19:19:08] <steven_is_false> strcat: Okay, but if it was possible would be that what I wanted?
[19:19:17] <strcat> don't know what you want
[19:19:35] <strcat> just that what you're actually doing isn't going to work for likely a long time
[19:19:59] <steven_is_false> Well, I want a function similar to fn foo<'r, T>(x: &'r T, f: extern fn(&'r T)) -> &'r { || f(x) }
[19:20:24] <steven_is_false> I meant &'r fn() { || f(x) }
[19:21:07] *** Joins: samx (sami@moz-369757A0.pp.htv.fi)
[19:23:52] *** Quits: samx (sami@moz-369757A0.pp.htv.fi) (Quit: This computer has gone to sleep)
[19:24:02] <engla> hm
[19:24:24] <steven_is_false> Crap, I can't work around this using traits either.
[19:24:39] <engla> knowing the details is hard
[19:24:49] <engla> of closures. it's a bit in flux too
[19:26:50] <steven_is_false> Oh well. It can wait a bit.
[19:27:17] *** Quits: pyrac (pyrac@moz-3A4AC930.w90-55.abo.wanadoo.fr) (Quit: pyrac)
[19:27:31] *** Joins: echristo (echristo@moz-1892C634.hsd1.ca.comcast.net)
[19:31:21] <strcat> acrichto: you around?
[19:31:53] <strcat> wtf bors
[19:31:57] <strcat> why did you cancel my try build
[19:31:59] <strcat> >.<
[19:32:39] <strcat> doener: figured it out
[19:32:42] <strcat> Assertion failed: (box->td != NULL), function free, file /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-opt-vg/build/src/rt/boxed_region.cpp, line 75.
[19:33:24] <strcat> I don't know why boxed_region::free is called on an exchange alloc
[19:33:28] <strcat> but anyway
[19:33:32] <strcat> this is caused by ref_count
[19:33:34] <strcat> but *only* on OS X
[19:33:45] *** Joins: roo (jesse.rudo@moz-FAF2828A.dynamic.ip.windstream.net)
[19:35:42] <doener> strcat: probably "bad luck" that there's -2 in the allocated memory on OSX, no?
[19:35:50] *** Quits: Jesin (Jessin_@moz-3AD6F09F.res.lehigh.edu) (Input/output error)
[19:35:51] <strcat> doener: no
[19:35:55] <strcat> doener: nothing should be reading it
[19:36:06] <strcat> doener: valgrind would tell me
[19:36:13] <doener> ah, right
[19:36:17] * doener needs more coffee
[19:36:24] <strcat> doener: http://buildbot.rust-lang.org/builders/auto-mac-64-opt-vg/builds/167/steps/compile/logs/stdio
[19:36:28] <strcat> this is on a valgrind bot
[19:36:48] <strcat> maybe we have so many suppress things
[19:36:51] <strcat> that we can't get any real output
[19:37:42] <doener> hm, you also get that error when there's a double free
[19:37:46] <strcat> doener: maybe vectors call this
[19:38:00] <strcat> that would now break for ~[] without @
[19:41:27] *** Quits: steven_is_false (user@moz-144077DE.bchsia.telus.net) (Client exited)
[19:41:34] * strcat really can't figure this out
[19:41:39] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[19:41:44] <strcat> I'm not changing the allocators for @ or ~ containing @
[19:42:01] <strcat> this is an existing bug somewhere that I'm exposing
[19:42:18] <strcat> something is freeing an exchange alloc with boxed_region
[19:42:51] <doener> but why only on OSX?
[19:42:59] <strcat> the runtime has per-OS stuff
[19:43:45] <doener> couldn't seem to find anything interesting when I looked for APPLE and OSX
[19:44:42] <doomlord> someone posted something about a version of rust minus runtime ?
[19:45:02] *** Quits: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzz‚Ä¶)
[19:45:18] <doener> doomlord: https://github.com/pcwalton/zero.rs this?
[19:45:45] <doomlord> that rings a bell
[19:46:13] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[19:46:50] <doomlord> >>"Garbage collection, tasks, and failure will not work. "  -- fine by me - there's still enough other useful featuers, and would allow using rust as a c replacement
[19:46:54] <doomlord> (i think ?)
[19:47:12] <strcat> no standard library
[19:47:29] <doomlord> he says the standard library woudl need to be split into the subset that can run with this minimal setup ... i agree that would be productive
[19:47:38] <engla> you should use strcat's unique pointer thing with zero.rs
[19:47:45] <engla> I guess destructors still work?
[19:47:52] <strcat> regular unique pointers work
[19:47:56] <engla> oh
[19:47:58] <strcat> they just have useless headers
[19:48:00] <strcat> as always
[19:48:11] *** Joins: pyrac (pyrac@moz-3A4AC930.w90-55.abo.wanadoo.fr)
[19:48:21] <engla> if you change it, it's awesome
[19:48:21] <doomlord> I failed to get rust onto iOS, i could try again with this zero thing... but i dont have a working mac at the minute.. backburner..
[19:48:36] <mcpherrin> You could make something ala C's "newlib" where you have a seperate minimal embedded standard library
[19:48:58] <mcpherrin> Seems like a suboptimal solution, though.
[19:49:36] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[19:49:40] <strcat> doener: don't understand
[19:49:41] <strcat> ;\
[19:50:05] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[19:50:17] <strcat> doener: but anyway something is using ref_count and something not triggering valgrind
[19:51:29] <strcat> doener: is ~ *inside* @ special?
[19:52:48] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[19:53:15] <doener> not that I would know
[19:53:56] <cmr> why would it trigger only on mac though, if that were the case?
[19:58:15] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[19:58:15] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 148409bf7 to 141790400: 02http://git.io/N3iJvQ
[19:58:15] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[19:58:17] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[19:58:17] <ghrust> 01[13rust01] 15bors pushed 1 new commit to 06auto: 02http://git.io/kLE1uQ
[19:58:17] <ghrust> 13rust/06auto 14c22dbdc 15bors: auto merge of #7495 : thestinger/rust/exchange, r=cmr...
[19:58:17] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[19:58:50] *** Joins: samx (sami@moz-369757A0.pp.htv.fi)
[20:00:14] *** Joins: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de)
[20:06:20] *** Joins: zslayton (Mibbit@moz-14AA87A9.nyc.res.rr.com)
[20:11:22] *** Quits: Ms2ger (Ms2ger@moz-BE6F806B.adsl-dyn.isp.belgacom.be) (Quit: nn)
[20:11:27] <strcat> doener: http://buildbot.rust-lang.org/builders/auto-mac-32-opt/builds/170/steps/compile/logs/stdio look where it failed this time
[20:11:44] <strcat> ;\
[20:12:09] *** Joins: brson (brson@2557E599.66715431.D25A875A.IP)
[20:12:09] *** ChanServ sets mode: +o brson
[20:13:17] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[20:13:17] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14c22dbdc to 141790400: 02http://git.io/N3iJvQ
[20:13:17] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[20:13:18] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[20:13:18] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/BPr9wQ
[20:13:18] <ghrust> 13rust/06auto 145a02812 15Young-il Choi: librustc: back::link::sanitize support esacpe_utf8
[20:13:18] <ghrust> 13rust/06auto 148d08ea2 15bors: auto merge of #7488 : yichoi/rust/sanitize_utf8, r=huonw...
[20:13:18] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[20:13:55] <doener> o...k...?!
[20:14:17] <MaikKlein> Jeaye, ping
[20:15:25] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[20:15:25] <ghrust> 01[13rust01] 15brson pushed 1 new commit to 06master: 02http://git.io/eqx1Kw
[20:15:25] <ghrust> 13rust/06master 14ca835f4 15Brian Anderson: rustpkg: Ignore a test that's failing on the dist-snap bot
[20:15:25] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[20:15:39] <strcat> brson: \o
[20:16:06] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[20:16:06] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Mthnbw
[20:16:06] <ghrust> 13rust/06auto 145a02812 15Young-il Choi: librustc: back::link::sanitize support esacpe_utf8
[20:16:06] <ghrust> 13rust/06auto 14d6ba47e 15bors: auto merge of #7488 : yichoi/rust/sanitize_utf8, r=huonw...
[20:16:06] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[20:16:08] *** Joins: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP)
[20:16:08] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 148d08ea2 to 14ca835f4: 02http://git.io/N3iJvQ
[20:16:08] *** Parts: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP) ()
[20:18:08] *** Joins: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP)
[20:18:08] <ghrust> 01[13rust01] 15brson merged 06master into 06dist-snap: 02http://git.io/VCSkmg
[20:18:08] *** Parts: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP) ()
[20:18:11] <MaikKlein> does anyone know a bit .sh?
[20:18:29] <cmr> MaikKlein: sure, what's your question?
[20:18:41] <MaikKlein> https://github.com/Jeaye/q3/blob/master/configure#L15
[20:18:47] <MaikKlein> if I execute this I get
[20:18:57] <MaikKlein> ./configure: Syntax error: "(" unexpected
[20:19:21] <MaikKlein> seems weird to me
[20:19:58] <brson> strcat: hi
[20:19:59] <cmr> MaikKlein: run it with bash, instead of /bin/sh
[20:20:01] <MaikKlein> "./configure: 15: ./configure: Syntax error: "(" unexpected"
[20:20:20] <strcat> brson: running into really strange problems from not initializing ref_count in the exchange allocator :(, but only on OS X
[20:20:31] <cmr> And bitch at Jeaye for using non-posix shell features and the /bin/sh shebang
[20:20:32] <cmr> :p
[20:20:37] * strcat thinks we are freeing exchange allocations with the local allocator + box region stuff somewhere
[20:21:22] <MaikKlein> cmr, thanks, didn't even know about bash
[20:21:40] <cmr> MaikKlein: you're probably using it right now; echo $SHELL
[20:23:00] <mnemotic> MaikKlein: drop the `function` part and you should be fine
[20:24:08] <strcat> brson: ah nvm I have a fairly good idea why...
[20:24:18] * strcat is silly ;[
[20:24:29] <strcat> but maybe I'm wrong
[20:25:16] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[20:25:16] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d6ba47e to 14ca835f4: 02http://git.io/N3iJvQ
[20:25:16] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[20:25:18] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[20:25:18] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/dQmHIw
[20:25:18] <ghrust> 13rust/06auto 140a3f6bc 15Young-il Choi: mk: clean-llvm for cross-compile
[20:25:18] <ghrust> 13rust/06auto 142cbec0d 15bors: auto merge of #7492 : yichoi/rust/fix_cleanllvm, r=luqmana...
[20:25:19] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[20:25:37] <strcat> doener: I messed up the cfg(stage0) stuff
[20:26:02] <strcat> brson: we're suppressing too much from valgrind :(
[20:26:03] <MaikKlein> mnemotic, u are right, thanks
[20:26:20] <strcat> I screwed up something obvious it should have caught
[20:26:27] <cmr> acrichto: it seems you broke the tree
[20:27:00] <cmr> http://buildbot.rust-lang.org/builders/auto-linux-64-nopt/builds/194/steps/compile/logs/stdio typical error
[20:27:44] <strcat> hm?
[20:28:02] <cmr> Started dying after https://github.com/mozilla/rust/commit/179040033545beac0e8f4aea8bbbf2e08469dc7a
[20:28:14] <cmr> I have no idea why the build would pass but break things afterwards though
[20:28:38] <strcat> brson: https://github.com/thestinger/rust/blob/4a29d6eb3f20c2b7a05bb9c9c2f964da606e39ca/src/libstd/rt/global_heap.rs#L65 have exchange_malloc down to that though :)
[20:28:41] * strcat thinks it will work now
[20:28:51] <MaikKlein> brson, what do you think about remote tasks?
[20:29:01] <strcat> I forgot that my vector reserve fix happens in stage1
[20:29:03] *** Joins: BitPuffin (quassel@moz-49828767.cust.tele2.se)
[20:29:03] <cmr> acrichto: https://github.com/mozilla/rust/commit/179040033545beac0e8f4aea8bbbf2e08469dc7a#L1R204
[20:29:18] <strcat> oh it probably shouldn't use assert! there
[20:29:27] <strcat> well maybe it doesn't matter
[20:29:51] <strcat> cmr: how did it get merged if it's broken? ;\
[20:30:04] <cmr> strcat: good freakin' question! :P
[20:30:24] <doener> strcat: removed the ref_count setter too early?
[20:30:32] <strcat> doener: yep!
[20:30:42] <strcat> doener: valgrind should have noticed
[20:30:44] <strcat> we suppress too much
[20:30:55] <brson> MaikKlein: tasks that are not in the same process are out of scope of the standard library, but I would like to have an actor crate that does cool things like that
[20:31:10] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[20:31:13] *** Joins: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP)
[20:31:13] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 142cbec0d to 14ca835f4: 02http://git.io/N3iJvQ
[20:31:13] *** Parts: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP) ()
[20:31:13] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[20:31:13] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/wg4Fdg
[20:31:13] <ghrust> 13rust/06auto 14408eef0 15Daniel Micay: stop initializing ref_count in exchange_alloc...
[20:31:13] <ghrust> 13rust/06auto 147f3752c 15Daniel Micay: managed: rm RC_EXCHANGE_UNIQUE constant...
[20:31:14] <ghrust> 13rust/06auto 1445e2582 15Daniel Micay: stop copying the tydesc in unique box take glue...
[20:31:16] <strcat> brson: I think we need to roll back the latest merge to master
[20:31:16] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[20:31:20] <strcat> brson: bors did something bad
[20:31:29] <strcat> ugh
[20:31:30] <cmr> naughty, naughty bors
[20:31:35] * strcat doesn't understand why it broke
[20:31:48] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[20:31:50] <strcat> cmr: what's the merge that broke it?
[20:31:59] <cmr> http://dp2retina.rozsnyo.com/
[20:32:01] <cmr> erm
[20:32:05] <cmr> https://github.com/mozilla/rust/commit/179040033545beac0e8f4aea8bbbf2e08469dc7a
[20:32:51] <strcat> we should figure out why bors merged it ;\
[20:33:33] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[20:34:21] <cmr> Oh it probably just needs to be staged
[20:34:37] <cmr> wait that doesn't make sense
[20:34:44] <cmr> this is very strange
[20:35:04] <MaikKlein> cmr, do I use bash as a cmd in the terminal like "bash make"?
[20:35:08] <strcat> I don't know how to revert a merge
[20:35:13] <cmr> MaikKlein: no
[20:35:21] <cmr> MaikKlein: though you can do that I think
[20:35:23] *** Quits: spider-mario (spidermari@moz-B8FA2FF4.rev.sfr.net) (Connection reset by peer)
[20:35:31] <doener> strcat: git revert -p1 $commit
[20:35:34] <brson> strcat: what's broken?
[20:35:37] <btipling> takes quite a bit to compile the compiler 
[20:35:40] <btipling> hrm
[20:35:41] <strcat> brson: bors merged a broken PR
[20:35:42] <doener> strcat: sorry, -m1 not -p1
[20:35:46] <strcat> brson: 179040033545beac0e8f4aea8bbbf2e08469dc7a
[20:35:48] <MaikKlein> cmr, because it can't execute make :( , ok then I go an search for it
[20:35:50] <strcat> doener: ah
[20:36:02] <strcat> brson: doesn't really make sense
[20:36:04] <brson> strcat: what is broken?
[20:36:05] <cmr> MaikKlein: you could symlink /bin/sh to /bin/bash or whever it is
[20:36:09] <cmr> bstrie: the tree
[20:36:13] <cmr> erm, brson
[20:36:16] *** Quits: dwrensha (chatzilla@moz-DE44EA45.hsd1.pa.comcast.net) (Ping timeout)
[20:36:30] <cmr> it is red, http://buildbot.rust-lang.org/builders/auto-linux-64-nopt/builds/194/steps/compile/logs/stdio is a log of a broken build
[20:36:34] <strcat> /home/rustbuild/src/rust-buildbot/slave/auto-linux-64-nopt/build/src/librustc/back/link.rs:663:27: 663:51 error: this function takes 2 parameters but 1 parameter was supplied
[20:36:36] <strcat> /home/rustbuild/src/rust-buildbot/slave/auto-linux-64-nopt/build/src/librustc/back/link.rs:663                 let tstr = char::escape_unicode(c);
[20:37:06] <strcat> bors really needs a pause switch
[20:37:40] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[20:37:44] *** Quits: samx (sami@moz-369757A0.pp.htv.fi) (Quit: This computer has gone to sleep)
[20:37:46] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Input/output error)
[20:39:28] <strcat> cmr: can you temporarily remove your two r+ comments?
[20:39:32] <strcat> on the pulls in the queue
[20:39:32] *** Joins: dwrensha (chatzilla@moz-DE44EA45.hsd1.pa.comcast.net)
[20:39:34] <cmr> sure
[20:40:05] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[20:40:10] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[20:40:10] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/SFExbQ
[20:40:10] <ghrust> 13rust/06auto 14208eb0f 15Alex Crichton: Implement `map_mut` on the Option type...
[20:40:10] <ghrust> 13rust/06auto 14d234add 15bors: auto merge of #7497 : alexcrichton/rust/issue-7394, r=cmr
[20:40:11] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[20:40:17] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[20:40:20] <btipling> is bors a bot?
[20:40:22] <cmr> heh, mistimed
[20:40:23] <cmr> btipling: yes
[20:40:23] <strcat> I guess I can just fix the librustc issue manually
[20:40:42] <strcat> I think bors did the merge wrong or something
[20:40:48] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[20:40:49] <strcat> it didn't advance auto to master
[20:41:04] * strcat shrugs
[20:41:10] <strcat> cmr: does it fail for you locally?
[20:41:35] <cmr> strcat: no, oodly enough
[20:41:38] <cmr> *oddly
[20:41:50] <brson> cmr: I don't see that line on master
[20:41:51] <strcat> well that's weird
[20:42:05] <cmr> maybe it's just bors that's messed up
[20:42:12] <strcat> cmr: s/bors/buildbot/
[20:42:19] <strcat> it's building for me locally
[20:42:50] <cmr> btw, I'm benching every successful bors merge, data is at http://hnn.mrsd.org/~cmr/ subdir'd by commit
[20:43:11] <strcat> brson: do you have the ability to restart buildbot?
[20:43:13] <cmr> mem.json is from memory benching, time.txt is runninb /usr/bin/time on a separate run
[20:43:45] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[20:43:47] * strcat will try another
[20:44:46] <steven_is_false> Hi! I'm adding RAII abilities to the Semaphore implementation in extra::sync, and I was wondering what a good name for the type to be returned from the access method would be.
[20:44:52] <brson> strcat: possibly
[20:45:13] * strcat doesn't really understand what's going wrong
[20:45:44] *** Joins: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP)
[20:45:44] <ghrust> 01[13rust01] 15thestinger 04force-pushed 06auto from 14d234add to 14ca835f4: 02http://git.io/N3iJvQ
[20:45:44] *** Parts: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP) ()
[20:45:58] <brson> strcat: what evidence do you see that there's a problem?
[20:46:19] <strcat> brson: builds failing ;p
[20:46:19] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[20:46:19] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/VFw7Ng
[20:46:19] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[20:46:20] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[20:46:20] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/qy4YVg
[20:46:20] <ghrust> 13rust/06auto 14408eef0 15Daniel Micay: stop initializing ref_count in exchange_alloc...
[20:46:20] <ghrust> 13rust/06auto 147f3752c 15Daniel Micay: managed: rm RC_EXCHANGE_UNIQUE constant...
[20:46:21] <ghrust> 13rust/06auto 1445e2582 15Daniel Micay: stop copying the tydesc in unique box take glue...
[20:46:23] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[20:46:24] <strcat> brson: master-linux failed
[20:46:39] <Seldaek> cmr: sorry what was the way to run only the tests for one file again?
[20:46:43] <brson> master-linux failed because of a timeout
[20:46:45] <Seldaek> the whole suite takes so long :/
[20:46:48] <strcat> brson: oh nvm
[20:46:57] <strcat> brson: it was just some auto builds that did
[20:47:06] <strcat> I think it might be okay now
[20:47:08] *** Quits: Sindwiller (quassel@moz-743130B2.dynamic.hispeed.ch) (Client exited)
[20:47:17] <strcat> auto was somehow not synced with master
[20:47:35] <zslayton> If I have a generic trait (pub trait MyTrait <T : Num>) and I implement it with something like (impl <'self> MyTrait <float> for &'self [float]), how would I write a function "do_stuff" that expects an item that impls MyTrait as a parameter?
[20:47:39] <cmr> Seldaek: erm, make check TESTNAME=foo
[20:47:47] <cmr> Seldaek: but, you need to be running extratest don't you?
[20:47:53] <cmr> Seldaek: there's no way to do that afaik
[20:48:01] <Seldaek> cmr: I'm not sure what extratest is
[20:48:28] <strcat> http://buildbot.rust-lang.org/builders/auto-mac-all-opt/builds/175/steps/configure/logs/stdio that one failed for a separate reason
[20:48:35] <btipling> hrm rust has a repl
[20:48:38] <btipling> that's cool
[20:48:43] <strcat> not a very good one yet
[20:48:47] <btipling> but why does it take so long to compile though
[20:48:55] <strcat> btipling: because it's a self-hosting compiler
[20:49:00] <btipling> ah that's nice
[20:49:01] <strcat> it needs to build itself 3 times
[20:49:05] <strcat> + it builds LLVM first
[20:49:06] <cmr> and you also probably needed to build LLVm
[20:49:09] <cmr> which takes forever
[20:49:20] <btipling> hrm I'm on mac os x
[20:49:25] <btipling> not sure what it may have been missing
[20:49:34] <cmr> rust has its own fork of llvm
[20:49:39] <btipling> oh I see
[20:50:04] <mnemotic> zslayton: `fn fuzz<T: MyTrait>(x: T)`
[20:50:04] <btipling> it's still building cpp files
[20:50:10] <btipling> so I imagine I have some time to go
[20:50:14] <cmr> yeah
[20:50:16] <cmr> you do :p
[20:50:21] <btipling> :(
[20:50:27] <cmr> btipling: run make -j4 or however many cores your cpu has
[20:50:28] <zslayton> mnemotic: I don't have to parameterize the trait in the type signature?
[20:50:30] <btipling> will I need to do this for every new release?
[20:50:30] *** Joins: samx (sami@moz-369757A0.pp.htv.fi)
[20:50:39] <cmr> no, llvm only needs to be built once
[20:50:48] <cmr> and when it gets updated
[20:50:53] <cmr> which is hopefully shortly after 0.7 is cut
[20:50:55] <cmr> so yes :p
[20:51:00] <strcat> it takes 15-20 mins to build rust
[20:51:07] <strcat> and whatever it takes to build LLVM too
[20:51:08] <btipling> ah
[20:51:15] <strcat> yeah stage takes 5-6 mins
[20:51:21] <zslayton> mnemotic: Something like fn fuzz<T : MyTrait<float>>(x:T) ?
[20:51:30] <strcat> unless you don't have enough memory and it's swapping
[20:51:30] *** Quits: pyrac (pyrac@moz-3A4AC930.w90-55.abo.wanadoo.fr) (Quit: pyrac)
[20:51:36] <zslayton> mnemotic: I guess that would defeat the purpose of generics. 
[20:51:40] <doomlord> what was the problem with anonymous structs, i beleive the language had them but they had to be removed
[20:51:53] <zslayton> mnemotic: I must be seeing weirdness from something else I've done. Thanks for the help!
[20:52:32] <cmr> doomlord: well they were records back then iirc, and they got heavily transformed. I would very much like anonymous structs
[20:52:48] <doomlord> ah glad i'm not the only one who sees the utility
[20:53:01] <doomlord> IMO it is better to not name something than to name it badly
[20:53:21] <doomlord> but i think there was some very specific problem they caused
[20:53:24] <MaikKlein> brson, are actors very different from tasks?
[20:53:24] <cmr> or when it doesn't need a name, and you jusrt want to group some fields in a struct with a namespace
[20:53:38] <doomlord> having 1:1 with JSON would be amazing.
[20:54:07] <doomlord> well maybe i'm overplaying that.. but it would be really nice
[20:54:08] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Quit: Konversation terminated!)
[20:54:28] <doomlord> right sometimes you can name the fields but you can't think of a name for the ensemble
[20:54:45] <doomlord> i see rust can do the inverse... a named tuple :)
[20:54:50] <steven_is_false> What does the --disable-shared-std option do? Does it build std as a static library?
[20:54:53] *** Quits: gareth0 (gareth0@moz-6B5865FE.dynamic.dsl.as9105.com) (Client exited)
[20:55:19] <dcolish> is the only way to `use` from other mods via a crate?
[20:55:43] <mark_edward> does dereference a & reference in the arguments of a closure create a copy?
[20:55:50] <dcolish> i'm trying to use mods in the same directory without building a crate, but its not coming together like i expected
[20:56:01] <cmr> dcolish: no. you can have relative imports like `use super::foo;`, 
[20:56:35] <cmr> dcolish: well all paths (except super:: and self::) are from the top of the crate, so maybe you're missing a layer or two of path component?
[20:56:52] <engla> and ::
[20:57:05] <dcolish> hmm
[20:57:07] <cmr> like if you have foo/bar.rs, and you want to use it from foo/baz.rs, (and foo is a module), you'd `use foo::bar` or `use super::bar`
[20:57:09] <brson> MaikKlein: I see tasks as building blocks for actors. Actors typically have failure/recovery strategies, mailboxes that can be filtered by a subset of message types, remoting, possibly other features. I don't want to bake that much policy into std (at least until we're sure that the design is right)
[20:57:12] <dcolish> i dont have a .rc file yet
[20:57:12] <cmr> engla: :: isn't allowed in imports
[20:57:34] <MaikKlein> brson, ah okay
[20:57:36] <engla> hm ok
[20:57:37] <dcolish> all these files are at the top level
[20:57:45] <mark_edward> can anyone help pls?
[20:57:46] <MaikKlein> dcolish, try pub mod filename
[20:58:02] <Jeaye> MaikKlein: pong
[20:58:15] <Jeaye> That's been fixed. Thanks for letting me know.
[20:58:31] <cmr> dcolish: whatever file you `rustc $file` is the root of the crate, you don't need an `.rc` file (and they're deprecated for plain `.rs` files)
[20:58:42] *** Joins: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com)
[20:58:45] <mark_edward> cmr: do you know?
[20:59:01] <cmr> mark_edward: i do not, I know very little rust actually :)j
[20:59:13] <cmr> bah, *:)
[20:59:28] <mark_edward> don't you hack on the compiler?
[20:59:32] <strcat> brson: http://buildbot.rust-lang.org/builders/auto-mac-64-opt-vg/builds/174/steps/configure/logs/stdio I guess this is a different issue
[20:59:34] <mark_edward> brson: do you know?
[20:59:49] <mark_edward> i bet srtcat knows!
[20:59:52] <doener> rusti: let mut i = 5u; (|mut &x: &mut uint| x = 10)(&mut i); println(i.to_str());
[20:59:55] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/GdKL
[21:00:07] <doener> mark_edward: looks like a copy
[21:00:19] <strcat> mark_edward: patterns are destructuring
[21:00:24] <strcat> ~x in a pattern derefs a ~
[21:00:25] <MaikKlein> Jeaye, I couldn't execute your ./configure file because it is non posix or w/e, I could execute it like bash ./configure but I can't use the make file for some reason :(. 
[21:00:28] <strcat> &x in a pattern derefs a &
[21:00:29] <dcolish> here's what i'm getting https://gist.github.com/dcolish/5896851
[21:00:41] <strcat> rusti: let x = ~5; let ~y = x; y
[21:00:41] -rusti- 5
[21:00:47] <strcat> rusti: let x = &5; let &y = x; y
[21:00:48] -rusti- 5
[21:01:01] <strcat> rusti: let x = (&5, 2); let (&y, z) = x; (y, z)
[21:01:01] -rusti- (5, 2)
[21:01:05] <cmr> dcolish: you need to put the uses before the 'pub mod's
[21:01:30] <dcolish> hmm, interesting
[21:01:46] <dcolish> i guess those are items?
[21:03:34] <dcolish> ok so `pub mod` works instead of use
[21:03:44] <Jeaye> MaikKlein: I've updated the configure script to require bash. What goes wrong with the makefile?
[21:04:01] <Jeaye> MaikKlein: Also, what OS?
[21:04:01] <MaikKlein> Jeaye, /bin/sh: 1: Syntax error: "(" unexpected
[21:04:09] <MaikKlein> Jeaye, I am on linux, ubuntu
[21:04:33] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[21:04:33] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 145da5673 to 14ca835f4: 02http://git.io/N3iJvQ
[21:04:33] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[21:04:35] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[21:04:35] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/4xX3LA
[21:04:35] <ghrust> 13rust/06auto 14408eef0 15Daniel Micay: stop initializing ref_count in exchange_alloc...
[21:04:35] <ghrust> 13rust/06auto 147f3752c 15Daniel Micay: managed: rm RC_EXCHANGE_UNIQUE constant...
[21:04:36] <ghrust> 13rust/06auto 1445e2582 15Daniel Micay: stop copying the tydesc in unique box take glue...
[21:04:38] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[21:05:08] <brson> strcat: probably a corrupted workspace. i deleted it
[21:05:35] <Jeaye> MaikKlein: You can try pulling and reconfiguring. 
[21:05:48] <brson> dereferencing & in the closure argument does not create a copy
[21:06:09] * strcat forgets if niko's fix for let bindings landed
[21:06:22] <doener> I don't think it did
[21:06:29] <doener> no, failed
[21:06:34] <strcat> heh
[21:06:51] <doener> of all things, it failed because of a merge conflict :-/
[21:06:55] <strcat> doener: anyway if this passes, I'll try actually removing the headers :)
[21:07:08] <strcat> shouldn't be too hard...
[21:07:15] <strcat> it should fail noisily if an offset isn't updated
[21:07:22] <brson> bjz: is Orderable temporary until those methods can be sunk into Ord?
[21:07:47] <brson> bjz: just trying to interpret the comment there
[21:07:50] <btipling> still compiling, about 40 minutes so far I think
[21:07:54] * strcat really wants inlining default methods to be fixed cross-crate
[21:07:59] <strcat> it's so close to working
[21:08:51] <btipling> I think it takes less time compile chromium :P
[21:09:01] <strcat> brson: http://buildbot.rust-lang.org/builders/auto-mac-64-opt/builds/177/steps/configure/logs/stdio strangely, still failing
[21:09:02] <btipling> to*
[21:09:06] *** Quits: Palmik (palmik@moz-CC484FDD.tmcz.cz) (Quit: Lost terminal)
[21:09:32] <strcat> different buildslave?
[21:09:34] * strcat checks
[21:10:08] <brson> same slave, different workspace
[21:10:20] <strcat> ah
[21:10:43] <strcat> brson: the early interrupts when another one fails might be causing this
[21:10:58] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[21:11:00] <strcat> brson: http://buildbot.rust-lang.org/builders/auto-mac-64-nopt/builds/176 this one refuses to stop
[21:11:25] <brson> ok I deleted that one too
[21:12:24] <roo> btipling: the whole build process from start to finish takes about 4 hours on my machine. But you aren't just building the rust compiler
[21:12:51] <strcat> 4 hours? ;0
[21:12:52] <engla> oi that's a long wait roo 
[21:13:10] <cmr> roo: how much memory do you have?
[21:13:12] <roo> well, my internet connection sucks, so a lot of that is spent in configuration syncing submodules
[21:13:25] <cmr> it must *really* suck for it to be that long
[21:13:32] <strcat> roo: ah, I wouldn't really call the ./configure part of the build though
[21:13:41] <cmr> unless you're counting actually downloading LLVM as part of that
[21:13:52] *** Joins: geomyidae (geomyidae@DD6F7E3A.21468E9A.30200F38.IP)
[21:14:13] <strcat> brson: http://buildbot.rust-lang.org/builders/doc/builds/238/steps/compile/logs/stdio the doc builder also needs a clean
[21:14:15] <geomyidae> who is/was working on the new io stuff?
[21:14:16] <strcat> keeps failing
[21:14:20] <strcat> geomyidae: brson 
[21:14:36] *** Quits: kini (kini@8CE7D24D:6948BCE:9B80811F:IP) (Ping timeout)
[21:14:45] <strcat> not sure how it can have a duplicate libsyntax
[21:14:48] <strcat> I thought make clean took care of that
[21:15:03] *** Quits: steven_is_false (user@moz-144077DE.bchsia.telus.net) (Ping timeout)
[21:15:22] *** Joins: kini (kini@8CE7D24D:6948BCE:9B80811F:IP)
[21:16:04] *** Joins: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP)
[21:16:04] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 147b0b722 to 14ca835f4: 02http://git.io/N3iJvQ
[21:16:04] *** Parts: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP) ()
[21:16:08] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[21:16:08] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/SmQmuA
[21:16:08] <ghrust> 13rust/06auto 14408eef0 15Daniel Micay: stop initializing ref_count in exchange_alloc...
[21:16:08] <ghrust> 13rust/06auto 147f3752c 15Daniel Micay: managed: rm RC_EXCHANGE_UNIQUE constant...
[21:16:08] <ghrust> 13rust/06auto 1445e2582 15Daniel Micay: stop copying the tydesc in unique box take glue...
[21:16:10] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[21:17:24] <brson> strcat: I don't have access to that machine
[21:17:48] <strcat> brson: ah not a big deal anyway
[21:19:33] <geomyidae> brson, is your latest io work in your io branch?
[21:20:51] <strcat> brson: http://buildbot.rust-lang.org/builders/auto-mac-all-opt/builds/179/steps/configure/logs/stdio meh, another! :(
[21:20:56] <btipling> roo: wow
[21:20:58] <btipling> 4 hours
[21:21:02] <btipling> hrm
[21:21:06] <btipling> maybe rust isn't for me just yet :P
[21:21:18] <cmr> btipling: it should take under an hour, the first build
[21:21:26] <strcat> brson: maybe I should just force an LLVM clean on all of them ;\
[21:21:54] <cmr> btipling: and once you have a compiler... you don't need to do anything, and updates only take ~13-20 minutes
[21:21:56] <btipling> currenly on compile_and_link: x86_64-apple-darwin/stage2/lib/rustc/x86_64-apple-darwin/lib/librustc.dylib
[21:22:01] <cmr> you're almost done
[21:22:01] <btipling> ah
[21:22:05] <btipling> cool
[21:22:20] <btipling> was going to maybe cancel if it was going to be another 3 hours
[21:22:21] <btipling> :P
[21:22:35] <btipling> it's getting close to an hour though
[21:22:41] <cmr> Compiling is a prime opportunity to cook or play video games
[21:22:46] <strcat> should be time to build LLVM + 15-20 mins
[21:22:48] <btipling> on a 2012 macbook pro retina using just make
[21:22:51] <strcat> if you have 3GiB or more memory
[21:23:03] <cmr> btipling: next time use make -j4
[21:23:06] <cmr> should go faster
[21:23:11] <cmr> slightly..
[21:23:11] <btipling> yes will do that
[21:23:18] <cmr> roughly 4x faster for llvm
[21:23:19] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[21:23:33] <strcat> cmr: chrt -b 0 make -h 24 ;p
[21:23:36] <strcat> cmr: chrt -b 0 make -j 24 ;p
[21:23:39] * roo is on windows if that comes into play at all
[21:23:49] <strcat> roo: yes windows is slow
[21:23:49] <cmr> roo: yeah windows builds are awful
[21:23:52] <strcat> very slow at spawning processes
[21:23:58] <strcat> and compiling each LLVM file spawns a process
[21:24:01] <roo> figured
[21:24:30] <strcat> well more than one
[21:24:33] <strcat> I guess make spawns sh
[21:24:35] <strcat> and sh spawns gcc
[21:25:43] <btipling> it's done yay
[21:25:46] <brson> geomyidae: yes, my io branch always contains the latest scheduler and io code
[21:25:50] *** Quits: BitPuffin (quassel@moz-49828767.cust.tele2.se) (Ping timeout)
[21:25:54] <btipling> "cfg: no pandoc found, omitting library doc build"
[21:25:55] <btipling> hrm
[21:25:59] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[21:26:01] <cmr> btipling: don't worry about it
[21:26:23] <btipling> https://gist.github.com/btipling/e00fc6d833d680f494b3
[21:26:35] <btipling> missing a couple of things
[21:26:49] <cmr> it's only for the docs, doesn't really matter
[21:26:53] <strcat> you're just missing pandoc so you can't use rustdoc
[21:26:53] <strcat> so it skipped building docs
[21:26:58] <btipling> is there good vim support for rust?
[21:27:01] * btipling googles
[21:27:05] <cmr> btipling: decent, etc/vim
[21:27:12] <strcat> yes
[21:27:14] <cmr> or, src/etc/vim
[21:27:18] <btipling> oh nice
[21:27:21] <strcat> except there's no autocompletion daemon/library so you can't have semantic autocomplete in any editor
[21:27:39] <btipling> that's fine
[21:28:14] *** Joins: MaikKlein1 (maik@moz-5A27DA0F.dip0.t-ipconnect.de)
[21:28:15] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[21:28:16] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/K3Dagg
[21:28:16] <ghrust> 13rust/06auto 14408eef0 15Daniel Micay: stop initializing ref_count in exchange_alloc...
[21:28:16] <ghrust> 13rust/06auto 147f3752c 15Daniel Micay: managed: rm RC_EXCHANGE_UNIQUE constant...
[21:28:16] <ghrust> 13rust/06auto 1445e2582 15Daniel Micay: stop copying the tydesc in unique box take glue...
[21:28:18] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[21:29:17] *** Quits: MaikKlein (maik@moz-B7E461DC.dip0.t-ipconnect.de) (Ping timeout)
[21:31:38] <btipling> I get "warning: no debug symbols in executable (-arch x86_64)" when I compile the hello world example
[21:31:46] <strcat> harmless
[21:32:02] <btipling> ok, is there something I can do to eliminate that warning?
[21:32:19] <btipling> or just not worry about it?
[21:32:21] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[21:32:25] <cmr> don't worry about it
[21:32:33] <cmr> rustc -Z debug-info might squelch it
[21:32:52] <btipling> thanks
[21:33:01] <btipling> compiled and ran ok though so yay
[21:33:51] *** Quits: samx (sami@moz-369757A0.pp.htv.fi) (Quit: This computer has gone to sleep)
[21:34:30] *** Joins: Jesin (Jessin_@moz-3AD6F09F.res.lehigh.edu)
[21:36:50] <brson> bjz: I tried to do justice to std::num in the release notes: https://github.com/mozilla/rust/wiki/Doc-detailed-release-notes
[21:36:54] <brson> bjz: feel free to edit
[21:37:11] <strcat> brson: http://buildbot.rust-lang.org/builders/auto-mac-all-opt/builds/180 can you clear this one too?
[21:37:24] *** Quits: mnemotic (niko@8FFD1BD2.9D81E74C.53DF0002.IP) (Ping timeout)
[21:37:27] * strcat wonders what went so horribly wrong :|
[21:37:45] *** Joins: mnemotic (niko@8FFD1BD2.9D81E74C.53DF0002.IP)
[21:39:48] <brson> strcat: done
[21:40:08] * strcat tries again
[21:41:25] *** Joins: mib_st079g (Mibbit@moz-DCB4B4F9.nycm.ny.dynamic.megapath.net)
[21:42:19] <mib_st079g> hi, should be quick question but looks like vector concatenation with + no longer works? what is recommended instead?
[21:42:47] <strcat> mib_st079g: it does afaik
[21:42:56] <strcat> the in-place operators like += are temporarily removed
[21:43:04] <strcat> because they were broken and need to be reimplemented
[21:43:10] <cmr> rusti: let x = ~[1u, 2, 3]; let y = ~[3u, 4, 5]; x + y
[21:43:12] -rusti- ~[1, 2, 3, 3, 4, 5]
[21:43:18] <mib_st079g> aaah it was +=
[21:43:20] <cmr> heh, fail at counting
[21:43:20] <mib_st079g> thanks a lot!
[21:43:25] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[21:43:25] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14ce70fb8 to 14ca835f4: 02http://git.io/N3iJvQ
[21:43:25] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[21:43:25] <mib_st079g> will += come back?
[21:43:27] <strcat> brson: I think we're missing that in the release notes
[21:43:28] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[21:43:28] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/qwmEWw
[21:43:28] <ghrust> 13rust/06auto 14408eef0 15Daniel Micay: stop initializing ref_count in exchange_alloc...
[21:43:28] <ghrust> 13rust/06auto 147f3752c 15Daniel Micay: managed: rm RC_EXCHANGE_UNIQUE constant...
[21:43:28] <ghrust> 13rust/06auto 1445e2582 15Daniel Micay: stop copying the tydesc in unique box take glue...
[21:43:28] <strcat> mib_st079g: yes
[21:43:30] <cmr> mib_st079g: yes
[21:43:30] <brson> for which types were the compound operators removed?
[21:43:30] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[21:43:33] <strcat> brson: all of them
[21:43:34] <mib_st079g> great
[21:43:34] <cmr> brson: all of them
[21:43:37] <mib_st079g> thanks so much!
[21:43:39] <cmr> strcat: stop beating me :P
[21:43:46] <strcat> brson: pcwalton removed them so we can do it properly with in-place traits
[21:43:46] <brson> even ints, etc?
[21:43:49] <strcat> brson: yeah
[21:43:52] <brson> like += doesn't exist?
[21:43:52] <strcat> brson: they were broken for ints too
[21:43:59] <strcat> brson: I think it parses
[21:44:04] <cmr> rusti: let x = 5; x += 5; x
[21:44:05] <engla> it seems to work for ints
[21:44:06] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/efZW
[21:44:09] <strcat> engla: not really
[21:44:12] <cmr> rusti: let mut x = 5; x += 5; x
[21:44:12] <engla> forgot mut
[21:44:13] -rusti- 10
[21:44:15] <btipling> is it recommended to specify which ints or do people just generally just use 'int' or 'uint' ?
[21:44:21] <strcat> brson: hrmm
[21:44:23] <cmr> btipling: depends on the usage
[21:44:25] <strcat> maybe it still works for primitives... ?
[21:44:28] <cmr> btipling: frequently you just use int or uint.
[21:44:31] <strcat> just not via Add
[21:44:43] <btipling> hrm
[21:44:49] <strcat> rusti: fn foo<T: Add<T, T>>(a: T, b: T) -> T { a + b } 
[21:44:50] -rusti- ()
[21:44:54] <strcat> rusti: fn foo<T: Add<T, T>>(a: T, b: T) -> T { a + b } foo(1, 2)
[21:44:54] -rusti- 3
[21:44:56] <brson> ok, I'm going to take a final pass at the relnotes
[21:45:01] <engla> it would break a lot more code if += was gone for primitives
[21:45:06] <strcat> rusti: fn foo<T: Add<T, T>>(mut a: T, b: T) -> T { a += b; a } foo(1, 2)
[21:45:07] -rusti- <anon>:9:53: 9:59 error: binary operation + cannot be applied to type `T`
[21:45:07] -rusti- <anon>:9          fn foo<T: Add<T, T>>(mut a: T, b: T) -> T { a += b; a } foo(1, 2)
[21:45:07] -rusti-                                                               ^~~~~~
[21:45:07] -rusti- error: aborting due to previous error
[21:45:07] -rusti- application terminated with error code 101
[21:45:15] <strcat> brson: ah it's just not associated with Add anymore
[21:45:19] <strcat> makes sense
[21:45:55] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[21:46:03] *** Joins: steven_is_false (user@4728DAC8.6ECAE21.F39A8AA1.IP)
[21:46:13] <Seldaek> strcat: do you have a WIP somewhere of the rustdoc changes?
[21:46:21] <cmr> Seldaek: you mean me?
[21:46:22] <strcat> Seldaek: hm?
[21:46:28] <cmr> Seldaek: https://github.com/mozilla/rust/wiki/Bikeshed-rustdoc
[21:46:33] <strcat> rusti: let x = @mut 5; *x += 2; x
[21:46:34] -rusti- @7
[21:46:39] <Seldaek> yeah I mean code that matches that document :)
[21:46:48] <Seldaek> and sorry for mixing up who I meant to address
[21:46:51] <strcat> rusti: let x = @mut 5; *x += 2; *x += 3; x
[21:46:52] -rusti- @10
[21:46:54] <cmr> Seldaek: Not yet, I'm working on cleaning up libsyntax.
[21:47:05] <cmr> Seldaek: I post daily updates at http://rustlog.octayn.net/
[21:47:06] <strcat> oh I think pcwalton fixed that issue
[21:47:19] * strcat is pretty sure that used to trigger a dynamic freeze error
[21:48:10] *** Quits: indirect (indirect_m@moz-770AB053.hsd1.ca.comcast.net) (Ping timeout)
[21:48:22] <Seldaek> cmr: ok, I gotta say the linking to source would be very nice; That's something I miss a lot that go docs are pretty good at, especially given the amount of undocumented functions it'd be very useful at this point
[21:49:08] <steven_is_false> I get how @, and @mut currently behave. How did @const behave?
[21:49:08] *** Joins: indirect (indirect_m@moz-770AB053.hsd1.ca.comcast.net)
[21:49:10] <cmr> Seldaek: I have an increasingly more solid vision of rustdoc, which is good. It's going to be a lot less flexible than I had initially hoped though, which is fine.
[21:49:22] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[21:49:31] <MaikKlein1> i would definitely like to see methods in docs, I mean at the top
[21:49:36] <cmr> steven_is_false: if it actually exists, it's "read-only through this reference, but there can be other mutable references"
[21:50:08] <steven_is_false> cmr: Cool but I'm just wondering if it has the same problems as @mut with respect to dynamic errors.
[21:50:32] <cmr> steven_is_false: I wouldn't think so, it doesn't need any guarantees at all.
[21:50:32] <MaikKlein1> like Struct Foo, Methods { print , bar , fortytwo }
[21:50:37] <Seldaek> cmr: alright, well when you get a bit further if time allow I'll try to help with html output at least, I should be more useful there than messing up libstd :)
[21:50:53] <steven_is_false> cmr: Well that's good then.
[21:51:04] <cmr> Seldaek: Wonderful! If you can help with CSS styling too that'd be supergreat :)
[21:51:16] <cmr> Seldaek: I have an html mockup somewhere... let me find it
[21:51:26] <cmr> Ah, http://octayn.net/rdoc-proto/
[21:51:48] <Seldaek> cmr: yeah I can definitely help there without requiring babysitting on irc :p
[21:51:57] <MaikKlein1> cmr,  nice
[21:52:05] <cmr> Whipped it up while waiting for my sister to be finished with a doctor appointment, so... not great or anything
[21:52:22] <MaikKlein1> cmr,  maybe I can help you soon too
[21:53:01] <Seldaek> an important thing would be to have search capability as well
[21:53:07] <cmr> Seldaek: was also considering Sphinx (restructured text) output.
[21:53:17] <cmr> yes
[21:53:21] <Seldaek> yeah, sphinx is nice and flexible, but the syntax is a bit PITA
[21:53:44] <MaikKlein1> it would also be useful to search for description
[21:53:53] <Seldaek> more powerful than markdown but for the uninitiated really not straightforward
[21:53:55] <cmr> http://erldocs.com/ and http://docs.sencha.com/extjs/4.2.1/#!/api are my main sources of inspiration
[21:53:58] <brson> should we count 'changes' in the relnotes as commits or non-merge commits? I think since bors came online the numbers have been inflated.
[21:54:11] <cmr> brson: non-merge probably
[21:54:25] *** Joins: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk)
[21:54:25] *** Quits: victorporof (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP) (Quit: victorporof)
[21:54:44] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Ping timeout)
[21:54:59] <MaikKlein1> cmr, you could also look at http://qt-project.org/doc/qt-5.0/qtdoc/modules.html
[21:55:55] <cmr> MaikKlein1: nice, thanks
[21:56:14] <Seldaek> cmr: IMO a good idea as well (but that requires a bit of infrastructure) is a comment system like you have on the php or mysql docs, so you can comment on any function with gotchas or whatever. The low barrier for entry means more people share stuff than if they had to make a proper doc edit
[21:56:36] <cmr> Seldaek: or like the various w3 working group drafts
[21:56:40] <strcat> brson: http://buildbot.rust-lang.org/builders/auto-mac-64-opt/builds/180 heh, another one
[21:57:13] <Seldaek> cmr: that means though that you  need a dedicated page per function, which IMO isn't so bad anyway, these 3km long doc pages aren't so usable
[21:57:17] *** Quits: nano (nano@moz-972880B.superkabel.de) (Connection reset by peer)
[21:57:32] <cmr> Seldaek: Why would it need a page per function?
[21:57:41] <cmr> I imagine little boxes in the margins a la google docs
[21:57:42] <strcat> search is easy to add
[21:57:46] <strcat> use sqlite's FTS
[21:57:51] <strcat> ;p
[21:58:03] <Seldaek> cmr: that won't scale much 
[21:58:08] <Seldaek> in term of UI
[21:58:18] <doener> seems like llvm is getting rebuilt ever other make run now
[21:58:25] <strcat> it can do AND/OR searches of tokens and token prefixes
[21:58:45] <strcat> and NOT
[21:58:48] <doener> just had an ICE, re-ran make with RUST_LOG set and it's rebuilding llvm :-/
[21:58:50] <bstrie> whoawhoawhoa
[21:58:50] <cmr> strcat: sure, let me just compile sqlite with emscripten...
[21:58:56] <bstrie> the bors queue is clear
[21:59:01] <bstrie> is the tree closed for 0.7?
[21:59:06] <cmr> bstrie: because bors exploded and killed every open PR
[21:59:10] <bstrie> oh, haha
[21:59:16] <strcat> cmr: oh I thought you meant the docs generated for the site
[21:59:30] <strcat> bstrie: no
[21:59:37] <strcat> buildbot broke
[21:59:46] <strcat> seems every workspace on mac4 was messed up
[21:59:56] <dwrensha> I have a n00b question about traits and borrowing. Can anyone help? Please see https://gist.github.com/dwrensha/3477245367ed3a9fd2bf
[22:00:08] <brson> strcat: deleted
[22:00:30] * strcat crosses fingers
[22:01:16] <strcat> dwrensha: you probably don't want to use trait objects + regions
[22:01:25] <strcat> just use generic type parameters
[22:01:32] *** Joins: tikue (tkuehn@moz-A7CDB794.dia.static.qwest.net)
[22:01:32] <Seldaek> cmr, strcat: for search really installing solr or elasticsearch isn't so hard and it's worth it IMO
[22:01:34] <dwrensha> because of compiler bugs / incompleteness?
[22:01:47] <strcat> dwrensha: and semantic issues that aren't thought out
[22:01:54] <strcat> trait objects aren't really very usable yet
[22:02:03] <strcat> generic type parameters and type bounds work fine
[22:02:14] <engla> they are usable for some things
[22:02:16] * strcat thinks ~Trait is still unsound too :|
[22:02:17] <dwrensha> what do you mean by 'type bounds'?
[22:02:19] <cmr> Seldaek: Can those operatedirectly on HTML?
[22:02:43] <tikue> strcat: I've successfully used @Trait but not ~Trait
[22:02:55] <engla> dwrensha: I don't know how the lifetime parameters interact, but that might be the problem?  'self and 'a in that trait
[22:02:55] <MaikKlein1> foo<T: Send + Clone> is a trait bound
[22:03:06] *** Quits: frogmella (Mibbit@moz-72830A1C.nyc.res.rr.com) (Quit: http://www.mibbit.com ajax IRC Client)
[22:03:08] <Seldaek> cmr: you mean index html pages? not really, although if the html output is machine readable enough you could write a js script that extracts this stuff and pushes json into elasticsearch very easily
[22:03:30] <cmr> Seldaek: Ok, I planned on JSON output from rustdoc anyway
[22:03:36] <Seldaek> cmr: but if you can output the raw data while rendering the html and then index with that it's definitely easier
[22:04:03] *** Quits: SimonSapin (simon@moz-D0C2F181.zone2.bethere.co.uk) (Ping timeout)
[22:04:15] *** Joins: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[22:04:27] <cmr> Though honestly I'd rather use XML, much better fit for the workload. But XML is almost a taboo these days it seems.
[22:04:27] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[22:04:27] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1462f281e to 14ca835f4: 02http://git.io/N3iJvQ
[22:04:27] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[22:04:29] *** Joins: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP)
[22:04:29] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/zO8OJA
[22:04:29] <ghrust> 13rust/06auto 14408eef0 15Daniel Micay: stop initializing ref_count in exchange_alloc...
[22:04:29] <ghrust> 13rust/06auto 147f3752c 15Daniel Micay: managed: rm RC_EXCHANGE_UNIQUE constant...
[22:04:29] <ghrust> 13rust/06auto 1445e2582 15Daniel Micay: stop copying the tydesc in unique box take glue...
[22:04:31] *** Parts: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP) ()
[22:05:22] <Seldaek> cmr: yeah.. they should release a new XML spec that only has elements and attributes, rip the rest out it's too dangerous
[22:05:23] <MaikKlein1> cmr, have you already begun with some method resolving?
[22:05:43] <MaikKlein1> cmr, or any resolving at all :) ?
[22:05:56] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Ping timeout)
[22:06:24] <cmr> MaikKlein1: no, but I'm going to cheat and run rustc's resolve directly on the whole crate, dump the AST + resolve information, and go from there (exact details tba :p)
[22:06:43] *** Quits: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl) (Ping timeout)
[22:06:52] <MaikKlein1> cmr, hahaha that's what I wanted to do too
[22:07:11] <MaikKlein1> cmr, well I dunno about ast yet
[22:07:24] *** Quits: bjz (brendanzab@moz-E17AB2AB.lnse2.cha.bigpond.net.au) (Quit: Leaving...)
[22:07:25] <MaikKlein1> think ast is just syntax
[22:08:14] <dwrensha> my goal here was to define a function like `fn foo<A : T, 'a>( inner: &'a inner<'a>) -> Outer<'a> { ...}`
[22:08:22] *** Joins: bjz (brendanzab@moz-E17AB2AB.lnse2.cha.bigpond.net.au)
[22:08:23] <dwrensha> so you're telling me to try some other approach?
[22:09:12] <MaikKlein1> bjz, I sent you a micro PR
[22:09:27] <zslayton> My compiler is telling me that: (let mut t : float = data.sum();) moves the variable 'data'. Am I just doing something wrong? I'd like to run another of data's methods but am not able to without using 'copy'.
[22:09:48] <btipling> I'm going to try and make a prime number sieve and see how that performs
[22:10:07] <btipling> for my first program, see how it compares to go maybe
[22:10:20] <engla> zslayton: it depends on how the self argument looks for that method
[22:10:24] <cmr> btipling: send a PR adding it to src/test/bench :)
[22:10:35] <engla> zslayton: probably  self and not &self for sum
[22:10:41] <btipling> :)
[22:11:07] <zslayton> engla: You're right -- it's self, not &self.
[22:11:22] <zslayton> engla: Time to do some reading to appreciate the difference.
[22:11:44] <cmr> zslayton: short story is that "self" is a by-value move and "&self" is a pointer to the object
[22:12:05] <brson> what's the best way to add rust support to ack? I've been using my own out of date fork for a couple years now
[22:12:26] <cmr> brson: I've been using ag (the silver searcher) with no problems
[22:12:57] <zslayton> cmr: Interesting. I borrowed this method from the stats.rs file in libextra -- I guess no one's needed to run more than one stats method on a vector in the past.
[22:13:24] <cmr> zslayton: or it's just plain broke and nobody noticed because nobody uses it
[22:13:27] <engla> ag is great
[22:14:15] <zslayton> cmr: Also possible!
[22:14:24] <engla> those methods are very easy to fix zslayton, they all use iterators
[22:14:45] <engla> just change self to &self in sum.
[22:15:48] <brson> cmr: ag supports rust natively?
[22:15:57] <zslayton> engla: On it, thanks!
[22:16:17] <cmr> brson: well what does ack do to support a language? ag searches rust code just fine...
[22:16:38] <brson> cmr: ack requires explicity support fo programming language extensions
[22:16:46] <brson> so it doesn't search rust by default
[22:17:06] <cmr> brson: then yes, ag supports rust natively
[22:17:24] <cmr> I didn't know if they added some sort of fancy symbol searching or something :)
[22:18:24] <engla> ag is faster
[22:18:51] *** Quits: steven_is_false (user@4728DAC8.6ECAE21.F39A8AA1.IP) (Ping timeout)
[22:19:56] <doener> I still prefer git's grep
[22:20:07] <cmr> I've been using git grep more and ag less too
[22:20:43] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[22:20:46] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[22:21:03] <doener> OT: can ag/ack do something like "git grep -e foo --or -e bar --all-match"? I couldn't figure out how to do that
[22:21:52] <cmr> doener: use a regex, 'foo|bar'
[22:22:03] <doener> cmr: that only works if both are on the same line
[22:22:07] <sp3d> brson: ack 2.0 searches unfamiliar files by default IIRC
[22:22:15] <doener> cmr: the git grep one only requires that both are found in the same file
[22:22:48] <doener> cmr: err, wrong, yours finds files with either, the git one requires the file to contain both, but possibly on different lines
[22:22:56] <cmr> doener: ah
[22:22:58] <sp3d> "When no selectors are specified, ack 1.x only searches through files that it can map to a file type. ack 2.x, by constrast, will search through every regular, non-binary file that is not explicitly ignored via --ignore-file or --ignore-dir."
[22:23:28] <cmr> doener: no, ag can't do that
[22:24:32] *** Joins: victorporof (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP)
[22:25:50] <cmr> http://cmr.github.io/blog/2013/06/30/structure-and-organisation-of-rustc/
[22:26:45] <MaikKlein1> hm what does this mean? "error: cannot capture variable of type `&BaseActor<T>`, which does not fulfill `Send`, in a bounded closure"
[22:26:55] <MaikKlein1> what are the requirements of Send?
[22:28:09] <engla> no borrowed pointers
[22:28:15] <cmr> or @
[22:28:36] <engla> old name of Send is Owned
[22:28:38] <MaikKlein1> ah ok
[22:28:43] <MaikKlein1> I just had &self
[22:29:16] <MaikKlein1> hm
[22:30:03] <MaikKlein1> if I do 
[22:30:04] <MaikKlein1>  do spawn {
[22:30:04] <MaikKlein1>            let value = self.port.recv();
[22:30:04] <MaikKlein1>            println(fmt!("%?",value));
[22:30:04] <MaikKlein1>         }
[22:30:11] <MaikKlein1> is self now move to a new task?
[22:30:18] <MaikKlein1> has moved*
[22:30:22] *** Quits: brson (brson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[22:30:26] *** Joins: brson (brson@6A848D32.C1B840DD.76F66111.IP)
[22:30:26] *** ChanServ sets mode: +o brson
[22:30:27] <cmr> no, you can't move into closures right now.
[22:30:45] <MaikKlein1> ok
[22:30:57] *** Quits: victorporof (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP) (Ping timeout)
[22:31:07] *** Joins: squiggy (Mibbit@moz-D7F31788.hsd1.mi.comcast.net)
[22:32:12] <engla> bblum merged the ~once fn()  where you can use move sanely
[22:32:21] <strcat> rusti: 2 + 2
[22:32:21] -rusti- 4
[22:32:22] <engla> but it's behind a -Z option and not enabled by default
[22:32:59] *** Quits: donri (dag@moz-9BB61102.tbcn.telia.com) (Client exited)
[22:33:13] <squiggy> rusti: let x = "  dog  ";
[22:33:13] -rusti- <anon>:9:13: 9:14 warning: unused variable: `x` [-W unused-variable (default)]
[22:33:13] -rusti- <anon>:9          let x = "  dog  ";
[22:33:14] -rusti-                       ^
[22:33:14] -rusti- ()
[22:33:30] <squiggy> rusti: let x = "  dog  ";
[22:33:31] -rusti- <anon>:9:13: 9:14 warning: unused variable: `x` [-W unused-variable (default)]
[22:33:31] -rusti- <anon>:9          let x = "  dog  ";
[22:33:31] -rusti-                       ^
[22:33:31] -rusti- ()
[22:33:35] *** Parts: judder (maradukewa@5B9E91E7.2C8A8E2E.78E362FE.IP) ()
[22:34:02] <engla> squiggy: you can privmsg with /query rusti
[22:34:22] <strcat> or use http://strcat.zapto.org:8000/
[22:34:33] <engla> ooh
[22:35:42] <brson> finally got a prerelease tarball
[22:35:43] <Ralith> @hoogle [a] -> (a -> IO (Maybe b)) -> Maybe b
[22:35:47] <Ralith> oops, wrong channel
[22:36:13] <brson> http://static.rust-lang.org.s3.amazonaws.com/dist/rust-0.7-pre.tar.gz
[22:36:24] <brson> http://static.rust-lang.org.s3.amazonaws.com/dist/rust-0.7-pre-install.exe
[22:36:41] <strcat> brson: has a weird s3 error
[22:36:49] <mnemotic> i'll bring out the hard stuff ;)
[22:37:12] <brson> strcat: I don't see it
[22:37:25] <strcat> brson: The bucket you are attempting to access must be addressed using the specified endpoint. Please send all future requests to this endpoint.
[22:37:47] <mnemotic> no issues here
[22:38:05] <brson> strcat: does this work http://static.rust-lang.org/dist/rust-0.7-pre.tar.gz
[22:38:12] <strcat> brson: yes
[22:38:23] <squiggy> I've got a question about this line of code
[22:38:25] *** Joins: dualhbridge1 (dad@moz-52F34B8.sub-70-192-10.myvzw.com)
[22:38:33] <brson> ok. I'm going to smoke test this, then bump the version number and test a rc
[22:38:46] <squiggy> let mut x = "  dog  "; x = x.trim(); println(x);
[22:39:13] <squiggy> this won't compile on my computer but it works with rusti
[22:39:27] <mnemotic> `let mut x = ~" dog "`
[22:40:53] <squiggy> i get a type mismatch where x.trim() returns &str but x needs ~str
[22:42:26] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Connection reset by peer)
[22:42:37] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:42:46] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[22:42:57] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:43:20] *** kimundi is now known as zz_kimundi
[22:43:28] *** Quits: brson (brson@6A848D32.C1B840DD.76F66111.IP) (Ping timeout)
[22:43:47] <strcat> rusti: 2
[22:43:50] -rusti- 2
[22:43:53] <strcat> rusti: 2
[22:43:53] -rusti- 2
[22:44:04] <engla> squiggy: use trim().to_owned()
[22:45:20] <engla> but you shouldn't need a ~str for println
[22:45:49] *** Quits: kini (kini@8CE7D24D:6948BCE:9B80811F:IP) (Ping timeout)
[22:46:36] *** Joins: kini (kini@8CE7D24D:6948BCE:9B80811F:IP)
[22:47:04] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[22:47:59] <doener> squiggy: the problem is that the type for x is fixed, you can't just assign something of a different type to it. You can declare a new x though. let x = ~"  dog ""; let x = x.trim() println(x);
[22:48:10] *** Joins: brson (brson@6A848D32.C1B840DD.76F66111.IP)
[22:48:10] *** ChanServ sets mode: +o brson
[22:48:23] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[22:48:24] *** Quits: kini (kini@8CE7D24D:6948BCE:9B80811F:IP) (Ping timeout)
[22:48:48] <squiggy> i understand the type mismatch
[22:49:05] <squiggy> doener: i just dont get why my first attempt didnt work
[22:49:08] *** Joins: kini (kini@8CE7D24D:6948BCE:9B80811F:IP)
[22:50:15] <doener> squiggy: wait, the one without ~ didn't work for you? With which version of the compiler is that?
[22:50:16] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[22:50:56] <squiggy> doener: let mut x = "  dog  "; x = x.trim(); println(x); // gives "error: assigning to mutable local variable prohibited due to outstanding loan"
[22:50:59] *** Quits: kini (kini@8CE7D24D:6948BCE:9B80811F:IP) (Ping timeout)
[22:50:59] *** Quits: jpochyla (jpochyla@moz-8D99AE5D.broadband18.iol.cz) (Ping timeout)
[22:51:41] <squiggy> im using a version of rustc that i got off the language website yesterday
[22:52:01] *** Joins: kini (kini@8CE7D24D:6948BCE:9B80811F:IP)
[22:52:08] <doener> squiggy: that's probably 0.6 then, which has the old borrow checker, which probably couldn't handle that
[22:52:14] *** Quits: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk) (Connection reset by peer)
[22:52:21] <MaikKlein1> does anyone know how I can make line 50-53 to not consume itself? https://gist.github.com/MaikKlein/5897314
[22:52:27] <doener> squiggy: try the 0.7-pre release that brson linked
[22:52:53] <squiggy> doener: thanks i'll try that
[22:53:00] *** Quits: brson (brson@6A848D32.C1B840DD.76F66111.IP) (Ping timeout)
[22:53:13] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[22:53:15] *** Joins: Amanieu (amanieu@moz-D5D10CA8.halls.manchester.ac.uk)
[22:53:42] <jmgrosen> hey, how can i use macros across files?
[22:54:07] *** Quits: dualhbridge1 (dad@moz-52F34B8.sub-70-192-10.myvzw.com) (Ping timeout)
[22:56:24] *** Joins: brson (brson@2557E599.66715431.D25A875A.IP)
[22:56:25] *** ChanServ sets mode: +o brson
[22:58:39] <jmgrosen> nvm, i figured it out
[23:03:21] *** Joins: cubic_ (cubic@moz-FE5AD6C7.mc.videotron.ca)
[23:03:39] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Ping timeout)
[23:04:09] *** Quits: dwrensha (chatzilla@moz-DE44EA45.hsd1.pa.comcast.net) (Ping timeout)
[23:05:29] <strcat> brson: the one it thinks is stuck is blocking auto ;p
[23:05:43] <strcat> I guess it'll just have to finish a mac build before starting the last
[23:06:24] *** Quits: mib_st079g (Mibbit@moz-DCB4B4F9.nycm.ny.dynamic.megapath.net) (Quit: http://www.mibbit.com ajax IRC Client)
[23:06:25] *** Joins: RMF (RMF@moz-ED65DEAC.dsl.telepac.pt)
[23:06:47] *** Quits: kini (kini@8CE7D24D:6948BCE:9B80811F:IP) (Ping timeout)
[23:07:57] <strcat> MaikKlein1: don't take self by-value
[23:08:03] *** Joins: kini (kini@8CE7D24D:6948BCE:9B80811F:IP)
[23:08:10] <strcat> by-value is a move if it (or anything it owns) has a destructor
[23:08:26] <steven_is_false> rusti: std::util::NonCopyable
[23:08:26] -rusti- <anon>:9:9: 9:31 error: unresolved name `std::util::NonCopyable`.
[23:08:26] -rusti- <anon>:9          std::util::NonCopyable
[23:08:26] -rusti-                   ^~~~~~~~~~~~~~~~~~~~~~
[23:08:26] -rusti- error: aborting due to previous error
[23:08:27] -rusti- application terminated with error code 101
[23:08:43] <steven_is_false> rusti: std::util; util::NonCopyable
[23:08:44] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/ZCie
[23:08:48] <strcat> rusti: let x = std::util::NonCopyable; x
[23:08:48] -rusti- <anon>:9:17: 9:39 error: unresolved name `std::util::NonCopyable`.
[23:08:49] -rusti- <anon>:9          let x = std::util::NonCopyable; x
[23:08:49] -rusti-                           ^~~~~~~~~~~~~~~~~~~~~~
[23:08:49] -rusti- error: aborting due to previous error
[23:08:49] -rusti- application terminated with error code 101
[23:09:10] <steven_is_false> rusti: use std::util; util::NonCopyable
[23:09:11] -rusti- <anon>:9:24: 9:41 error: unresolved name `util::NonCopyable`.
[23:09:11] -rusti- <anon>:9          use std::util; util::NonCopyable
[23:09:11] -rusti-                                  ^~~~~~~~~~~~~~~~~
[23:09:11] -rusti- error: aborting due to previous error
[23:09:11] -rusti- application terminated with error code 101
[23:09:13] <strcat> steven_is_false: looks like a bug
[23:09:26] <strcat> unit structs aren't properly made public
[23:09:31] <strcat> cross-crate
[23:09:50] <steven_is_false> Seems like it.
[23:09:51] <strcat> rusti: let x: Option<std::util::NonCopyable> = None; x
[23:09:51] -rusti- None
[23:10:04] <strcat> the type is made visible but not the type constructor
[23:10:13] <engla> MaikKlein1: the port needs to be moved into the closure to spawn. You need a plan how to handle the port value
[23:11:37] <cmr> I have https://github.com/mozilla/rust/issues/7435 open about tuple/unit struct constructors
[23:11:37] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[23:11:44] *** mnemotic is now known as zzz_mnemotic
[23:12:05] <steven_is_false> strcat: Issue filed: https://github.com/mozilla/rust/issues/7514
[23:12:46] *** Quits: kini (kini@8CE7D24D:6948BCE:9B80811F:IP) (Ping timeout)
[23:13:21] <steven_is_false> cmr: Thanks.
[23:13:33] *** Joins: kini (kini@8CE7D24D:6948BCE:9B80811F:IP)
[23:15:13] *** Quits: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP) (Quit: night)
[23:15:20] *** Quits: kini (kini@8CE7D24D:6948BCE:9B80811F:IP) (Ping timeout)
[23:16:24] *** Quits: MaikKlein1 (maik@moz-5A27DA0F.dip0.t-ipconnect.de) (Ping timeout)
[23:16:25] *** Joins: kini (kini@8CE7D24D:6948BCE:9B80811F:IP)
[23:27:03] *** Joins: dwrensha (chatzilla@moz-DE44EA45.hsd1.pa.comcast.net)
[23:27:59] *** Quits: n00b6502 (kwr5y54@moz-6651F8D4.range86-145.btcentralplus.com) (Ping timeout)
[23:28:17] *** Quits: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com) (Ping timeout)
[23:29:38] *** Joins: victorporof (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP)
[23:31:34] *** Quits: victorporof (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP) (Ping timeout)
[23:33:04] *** Joins: aatch (aatch@31200FE3:ADAA592:416E6388:IP)
[23:33:57] *** Joins: Houm (Houm@CEBDB141:FB5FB975:C1FCFA8A:IP)
[23:34:07] *** Joins: bytbox (s@moz-D4F26CEB.hsd1.md.comcast.net)
[23:34:25] *** Quits: tikue (tkuehn@moz-A7CDB794.dia.static.qwest.net) (Quit: tikue)
[23:35:01] *** Quits: squiggy (Mibbit@moz-D7F31788.hsd1.mi.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[23:35:28] <aatch> Morning all o/
[23:35:35] <doener> hey aatch 
[23:35:38] <brson> hi aatch
[23:35:44] *** zzz_mnemotic is now known as mnemotic
[23:35:54] <strcat> aatch: ~ headers almost dead
[23:35:55] <strcat> *almost*
[23:36:18] <doener> hm, a rust pre-release _and_ a  linux kernel release, two birthday gifts already :-)
[23:36:48] <strcat> 3.10?
[23:36:53] <doener> yup
[23:37:14] <aatch> doener, your birthday today?
[23:37:24] <doener> at least in my timezone
[23:37:41] <aatch> doener, cool. It's my birthday tomorrow!
[23:37:41] <doener> July 1st
[23:37:59] <doener> hey, birthday neighbors!
[23:39:49] <aatch> doener, yeah, though in our respective timelines, they'll overlap, since it's already almost midday here now July 1st.
[23:40:13] <jmgrosen> what's the most idiomatic way for representing an extern pointer that you then define methods on?
[23:40:41] <aatch> jmgrosen, normally a wrapper struct
[23:41:09] <jmgrosen> aatch: struct Foo {raw: *c_foo} ?
[23:41:20] <aatch> jmgrosen, yep.
[23:41:22] <strcat> jmgrosen: is it an opaque type?
[23:41:32] <jmgrosen> strcat: yeah
[23:41:54] <strcat> jmgrosen: well for the c_foo part you want an enum with no variant
[23:41:55] <aatch> oh right, then you can use a unit struct + transmute
[23:41:59] <strcat> enum Opaque {}
[23:42:04] <strcat> and then
[23:42:34] <mnemotic> aatch: hi, re: atomic intrinsics; i think i've figured out what changes to make
[23:42:40] <aatch> mnemotic, ok.
[23:43:19] <mnemotic> aatch: do you have a moment to take a look at some early changes and tell me if i'm moving in the right direction?
[23:43:26] <aatch> mnemotic, sure thing
[23:43:33] <mnemotic> https://gist.github.com/mnemotic/f7543766ccb97db8a081
[23:44:46] <aatch> yep looks fine to me.
[23:46:01] <jmgrosen> strcat: and then...
[23:46:33] <strcat> jmgrosen: well if it doesn't have a destructor, you could just use *Opaque
[23:46:35] <strcat> if it does
[23:46:51] *** Joins: dbaupp (Thunderbir@moz-EAB436DB.lns20.syd6.internode.on.net)
[23:46:55] <strcat> you probably want 'pub struct Foo { priv ptr: *Opaque }'
[23:47:17] <strcat> the point of the enum is that you can never actually make one (since it has no variants) so it represents an opaque type of unknown size
[23:47:25] <mnemotic> aatch: thanks! it's quite a relief to hear :)
[23:47:43] <jmgrosen> strcat: ok, thanks!
[23:47:56] <strcat> jmgrosen: although I guess you have to wrap *Opaque anyway to make it safe
[23:47:56] <mnemotic> aaand the tests for intrinsics fail because i, of course, didn't rewrite them :D
[23:48:10] <aatch> mnemotic, yeah, it's not too complicated a change, just a little tedious because you have to stage everything off.
[23:48:50] * aatch will deal with that at the weekend with a new snapshot
[23:49:06] <mnemotic> aatch: it's somewhere for me to start, and that's great in itself :)
[23:49:34] *** Quits: Jesin (Jessin_@moz-3AD6F09F.res.lehigh.edu) (Quit: Leaving)
[23:49:49] <aatch> mnemotic, I figured that's why you asked to do it (more experienced contributors just do it :P)
[23:50:00] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[23:50:24] <mnemotic> aatch: i'm green and it shows :)
[23:50:59] *** Quits: bjz (brendanzab@moz-E17AB2AB.lnse2.cha.bigpond.net.au) (Quit: Leaving...)
[23:51:04] <strcat> doener: heh, I can't believe I screwed up that ref_count thing >.<
[23:51:08] * strcat had it right before
[23:51:10] <aatch> mnemotic, hence why I suggested picking up the rest of the atomics work, since it just consists of adding to what's already there.
[23:51:26] <strcat> I rebased to clean it up and accidentally screwed up a merge
[23:51:57] *** Joins: bjz (brendanzab@moz-E17AB2AB.lnse2.cha.bigpond.net.au)
[23:52:16] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[23:52:27] <bjz> mark_edward: hoy
[23:53:15] <mnemotic> aatch: and i'm fairly certain that i'll do it too :)
[23:53:35] <mnemotic> now; off to bed with me before it's time to wake up :S
[23:53:47] <aatch> mnemotic, heh, fair enough.
[23:53:49] <dbaupp> strcat: is '@bors: retry' working at all at the moment?
[23:53:57] <strcat> dbaupp: yes
[23:54:03] <strcat> dbaupp: http://buildbot.rust-lang.org/console?branch=auto&refresh=15
[23:54:08] *** mnemotic is now known as zzz_mnemotic
[23:54:09] <strcat> dbaupp: I *actually* had to retry that 10 times
[23:54:17] <strcat> because a bunch of bots were broken and brson had to clear them
[23:54:25] <doener> strcat: well, I managed to convince myself that the removal is actually fine and just made sure that the stage0 function is equal to the new one for ~fn
[23:54:32] <dbaupp> strcat: yeah, I saw all your retries... hence the question
[23:54:50] <strcat> doener: it's the vector code that reads ref_count
[23:54:57] <doener> strcat: I guess I wouldn't even have checked that again
[23:55:00] <strcat> and the vector code needs an intrinsic I added to not use it
[23:55:10] <strcat> contains_managed::<T>()
[23:55:14] *** Joins: Jesin (Jessin_@moz-3AD6F09F.res.lehigh.edu)
[23:55:23] <doener> strcat: I know (now), the above is just what I did while searching for the bug
[23:55:27] <strcat> ah
[23:55:41] <strcat> silly ~fn >.<
[23:55:57] <bjz> hash_map! macro: https://gist.github.com/bjz/821a6d00b2ef6d5450e7
[23:55:57] *** Quits: zzz_mnemotic (niko@8FFD1BD2.9D81E74C.53DF0002.IP) (Ping timeout)
[23:56:13] *** Quits: doener (doener@moz-121949B3.unitymediagroup.de) (Quit: 3.10 here I come...)
[23:56:16] <engla> it's nice
[23:56:25] *** Joins: tikue (tkuehn@moz-A7CDB794.dia.static.qwest.net)
[23:56:34] <aatch> bjz, cute
[23:56:35] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[23:56:39] <engla> you also solved the optional trailing comma, that's nice
[23:57:04] <bjz> any ideas?
[23:57:34] *** Joins: mib_0som4e (Mibbit@moz-43C591CF.nycmny.east.verizon.net)
[23:57:41] <engla> isn't it possible for that variable name (map) to cause trouble in some situations?
[23:57:42] <bjz> wish there was a way of doing macroed methods
[23:57:44] <engla> I'm a bit unsure
[23:58:08] <bjz> engla: its within a scope
[23:58:20] *** Quits: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP) (Quit: yichoi)
[23:58:22] <bjz> engla: note the second {}
[23:58:32] <engla> yeah. I'm sure we can find a way to break it 
[23:58:47] <tedh> is mac-all-opt stuck?  says its still compiling and time is not going down
[23:59:05] <engla> bjz: try  enum X { map } 
[23:59:08] <engla> before 
[23:59:09] *** Joins: jpochyla (jpochyla@moz-8D99AE5D.broadband18.iol.cz)
[23:59:16] <bjz> engla: updated to make the second scope more obvious
[23:59:18] *** Quits: dwrensha (chatzilla@moz-DE44EA45.hsd1.pa.comcast.net) (Ping timeout)
[23:59:20] <bjz> engla: sure
[23:59:25] <dbaupp> bjz: the convention seems to be using `__map` for macro internal names (fwiw)
[23:59:37] *** Quits: roo (jesse.rudo@moz-FAF2828A.dynamic.ip.windstream.net) (Ping timeout)
[23:59:45] <bjz> ahh yep
[23:59:51] <engla> a variant will turn the let into a pattern match
