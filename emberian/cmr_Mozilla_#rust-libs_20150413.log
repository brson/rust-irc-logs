[00:39:40] *** Joins: brson (brson@moz-jjc.abh.232.109.IP)
[00:39:40] *** ChanServ sets mode: +qo brson brson
[01:23:27] *** Quits: c74d3 (c74d3a4ebb6@moz-0ersgu.oc.cox.net) (Ping timeout: 121 seconds)
[01:24:50] *** Joins: c74d (c74d3a4ebb6@moz-lm47dn.mggc.hibn.4404.2002.IP)
[01:49:51] *** kimundi is now known as zz_kimundi
[01:59:41] *** Quits: brson (brson@moz-jjc.abh.232.109.IP) (Ping timeout: 121 seconds)
[02:02:55] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[02:02:55] *** ChanServ sets mode: +qo brson brson
[02:07:22] *** nrc|afk is now known as nrc
[02:14:46] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[02:21:50] *** Joins: annodomini (lambda@moz-qgii5v.ma.comcast.net)
[02:38:45] *** Quits: zz_kimundi (kimundi@moz-3l9nrq.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:40:21] <klutzy> is there a way to get errno other than std::io::last_os_error().raw_os_error()?
[02:40:51] <klutzy> I'm not sure if last_os_error() is meant to be used outside of io
[02:41:20] *** Joins: zz_kimundi (kimundi@moz-cie3b9.dip0.t-ipconnect.de)
[02:41:22] *** zz_kimundi is now known as kimundi
[02:41:23] <klutzy> (I'm wrapping extern `mmap` function)
[02:44:18] *** Joins: brson (brson@moz-vvt35d.tmodns.net)
[02:44:18] *** ChanServ sets mode: +qo brson brson
[02:45:02] *** Quits: brson (brson@moz-vvt35d.tmodns.net) (Quit: leaving)
[02:58:16] *** Quits: annodomini (lambda@moz-qgii5v.ma.comcast.net) (Ping timeout: 121 seconds)
[05:30:28] *** Joins: c74d3 (c74d3a4ebb6@moz-0ersgu.oc.cox.net)
[05:30:59] *** Quits: c74d (c74d3a4ebb6@moz-lm47dn.mggc.hibn.4404.2002.IP) (Ping timeout: 121 seconds)
[08:08:46] *** Joins: p1start (p1start@moz-nftjhe.org)
[08:53:36] *** Joins: simukis (nagisa@moz-pol184.mif.vu.lt)
[09:01:43] *** Quits: simukis (nagisa@moz-pol184.mif.vu.lt) (Ping timeout: 121 seconds)
[10:43:34] *** Quits: nrc (nrc@moz-4bhi2i.xtra.co.nz) (Connection closed)
[10:44:19] *** Joins: nrc (nrc@moz-4bhi2i.xtra.co.nz)
[10:44:20] *** ChanServ sets mode: +qo nrc nrc
[10:49:05] *** Quits: nrc (nrc@moz-4bhi2i.xtra.co.nz) (Ping timeout: 121 seconds)
[11:06:01] *** Joins: simukis (nagisa@moz-pol184.mif.vu.lt)
[11:31:25] *** kimundi is now known as zz_kimundi
[11:56:59] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[12:07:12] *** Joins: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP)
[12:07:12] *** ChanServ sets mode: +o pnkfelix
[12:09:07] *** zz_kimundi is now known as kimundi
[12:27:03] *** kimundi is now known as zz_kimundi
[12:31:54] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[12:33:42] *** Quits: simukis (nagisa@moz-pol184.mif.vu.lt) (Ping timeout: 121 seconds)
[13:38:21] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[13:38:48] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Connection closed)
[13:54:41] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[15:19:31] *** Joins: simukis1 (nagisa@moz-8t068g.static.zebra.lt)
[15:19:35] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Connection closed)
[15:44:08] <aturon> klutzy: that should always be equivalent to getting errno, and is fine for use when binding your own IO APIs
[15:55:19] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[15:55:19] *** ChanServ sets mode: +qo brson brson
[16:38:26] *** Joins: sigma (sigma@moz-ohog4c.range86-135.btcentralplus.com)
[16:49:09] *** Joins: arielb1 (Ariel@moz-lcu.ri7.19.46.IP)
[16:56:01] *** zz_kimundi is now known as kimundi
[17:02:33] *** Joins: nrc (nrc@moz-4bhi2i.xtra.co.nz)
[17:02:33] *** ChanServ sets mode: +qo nrc nrc
[17:03:27] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[17:03:35] *** Quits: flaper87 (flaper87@moz-fnn.1e9.132.209.IP) (Ping timeout: 121 seconds)
[17:04:51] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[17:07:29] *** Quits: nrc (nrc@moz-4bhi2i.xtra.co.nz) (Ping timeout: 121 seconds)
[17:12:31] *** Joins: flaper87 (flaper87@moz-fnn.1e9.132.209.IP)
[17:20:45] *** Quits: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP) (Quit: rcirc on GNU Emacs 24.3.92.1)
[18:18:40] *** Quits: simukis1 (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[18:21:34] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[18:38:42] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[19:02:40] *** Quits: flaper87 (flaper87@moz-fnn.1e9.132.209.IP) (Ping timeout: 121 seconds)
[19:05:18] *** Joins: sigma1 (sigma@moz-ohog4c.range86-135.btcentralplus.com)
[19:05:26] *** Quits: sigma (sigma@moz-ohog4c.range86-135.btcentralplus.com) (Connection closed)
[19:09:28] <nmatsakis> aturon: sometimes I wish we had (a) persistent collections and (b) "monotonic" collections (that you could only grow, and which never relocate) -- I guess I can make a cargo library for those.
[19:09:35] <nmatsakis> might be a fun exercise.
[19:09:55] <nmatsakis> the advantage of (b) being that you can "insert" with &Foo 
[19:11:10] <aturon> nmatsakis: i agree on both counts, but of course given LVars you won't be surprised by that :)
[19:11:15] <nmatsakis> :)
[19:11:32] <aturon> nmatsakis: we should talk together with Gankro about what to prioritize over this summer (while he's here in SF)
[19:11:38] <nmatsakis> yeah
[19:12:19] *** Joins: sigma (sigma@moz-ohog4c.range86-135.btcentralplus.com)
[19:12:38] *** Quits: sigma1 (sigma@moz-ohog4c.range86-135.btcentralplus.com) (Connection closed)
[19:13:13] <Gankro> nmatsakis: why never relocate?
[19:14:04] <Gankro> Or did you mean reallocate?
[19:15:29] <nmatsakis> Gankro: I mean relocate
[19:15:35] <nmatsakis> because I would want that
[19:15:47] <nmatsakis> fn get(&self, key: &K) -> &V
[19:15:48] <nmatsakis> still holds
[19:15:53] <nmatsakis> and if you relocate,
[19:16:02] <nmatsakis> then you have to ensure that you don't mutate while the borrow is outstanding
[19:16:13] <nmatsakis> but if you never relocate, you don
[19:16:18] <nmatsakis> you can allow insertions
[19:16:43] <nmatsakis> I'm not sure if there's been research into this kind of collection; I guess that a lot of the persistent designs would be relevant
[19:16:47] <Gankro> nmatsakis: I was under the impression had no way to prevent moves?
[19:16:59] <nmatsakis> gankro: I don't understand
[19:17:12] <Gankro> Wait what do you mean by relocate?
[19:17:17] <nmatsakis> Gankro: realloc
[19:17:46] <Gankro> And that's different from reallocate...?
[19:18:23] *** Quits: sigma (sigma@moz-ohog4c.range86-135.btcentralplus.com) (Ping timeout: 121 seconds)
[19:18:31] <reem> nmatsakis Gankro: you can do this today by boxing the values
[19:18:50] <nmatsakis> Gankro: er, sorry, no it's not :)
[19:18:52] <reem> e.g. a wrapper around HashMap<K, Box<V>> can yield &Vs across insertions, if you don’t allow overriding a value by inserting the same key
[19:18:58] <Gankro> nmatsakis: Ah ok :)
[19:18:58] <nmatsakis> Gankro: I guess I misread what you wrote earlier
[19:19:54] <Gankro> nmatsakis: Presumably you're thinking non-sync?
[19:20:09] <Gankro> Or do you want this thing for threading?
[19:20:59] <nmatsakis> Gankro: I was debating about that in my head just now :) but I think non-sync.
[19:21:08] <nmatsakis> Gankro: obviously making it sync is another level of complexity
[19:21:20] <nmatsakis> Gankro: I'm not really sure if this is a great idea
[19:21:33] <nmatsakis> Gankro: but it seems like something that would be helpful, certainly the compiler would like it :)
[19:21:50] <nmatsakis> I imagine we'd have to experiment to figure out how to make this efficient --
[19:21:56] <nmatsakis> though I imagine that separating out the "value" store
[19:22:02] <nmatsakis> (and maybe even the key store)
[19:22:05] <nmatsakis> could go a long way
[19:22:12] <nmatsakis> kind of like the boxing reem suggested
[19:22:22] <nmatsakis> but into a side array or something to amortize alloc costs
[19:22:23] <Gankro> nmatsakis: Seems like linked-array-list (BList) works fine for this by just disabling everything that removes are insertes not-at-the-end
[19:22:43] <nmatsakis> perhaps. I was thinking that if you didn't store key/value inline,
[19:23:00] <nmatsakis> then you can maybe use regular hashmap algorithms, or at least persistent collection style ones
[19:23:17] <Gankro> "hashmap algorithms"?
[19:23:19] <nmatsakis> but yes a btree like thing was what I was thinking of at first
[19:23:41] <Gankro> nmatsakis: I was just thinking of lists, not maps
[19:23:43] <nmatsakis> Gankro: well, e.g., the robinhood hashmap algorithm we use for HashMap
[19:23:45] <Gankro> maps... hmm...
[19:23:49] <nmatsakis> oh, maps are more interesting.
[19:23:53] <nmatsakis> lists are the easy case ;)
[19:24:15] <nmatsakis> point is, you can reallocate freely if the data structure is internal and not exposed
[19:24:39] <nmatsakis> and if it just stores indices into (monotonic...) vectors
[19:24:39] <reem> This code from hyper seems relevant, especially PtrMapCell https://github.com/hyperium/hyper/blob/master/src/header/internals/cell.rs
[19:25:22] <Gankro> nmatsakis: I'm not sure the extra complexity is worth not just using a RefCell?
[19:27:50] <nmatsakis> Gankro: I'm not sure either. As I said, would be an interesting experment to try and see how well it winds up working. Another interesting dimension is iteration, which I hadn't really thought about before. 
[19:28:07] <seanmonstar> specifically, PtrMapCell allows for safe borrowing of a &V, and mutating other values, as long as the other values arent the same &V that's borrowed
[19:28:07] <Gankro> nmatsakis: elaborate?
[19:28:09] <nmatsakis> that is, you couldn't prevent "iterator invalidation", so you have to just define a semantics -- like, iterates over what was in it at the time you started iterating I guess
[19:28:24] <nmatsakis> reem: (yes, looks relrevant)
[19:28:56] <nmatsakis> anyway, I sort of like that RefCell panics if you try to insert while iterating, since it makes me think about what I expect to happen :)
[19:29:06] <nmatsakis> (vs silently doing something well-defined)
[19:29:56] <Gankro> nmatsakis: Is there something the compiler specifically wants for this sort of thing?
[19:31:26] <nmatsakis> Gankro: not sure what you mean, but the compiler uses a lot of hashmaps that grow but never shrink. Some of that can go away after rearchitecting, but I think it's a common use case nonetheless 
[19:31:36] *** Joins: nrc (nrc@moz-4bhi2i.xtra.co.nz)
[19:31:36] *** ChanServ sets mode: +qo nrc nrc
[19:31:56] <nmatsakis> the probelm with RefCell is mostly that it is kind of anti-abstraction
[19:32:09] <nmatsakis> ideally you bubble it up to the top-level, but if you have a struct that contains refcells,
[19:32:13] <nmatsakis> er, refcell maps,
[19:32:20] <nmatsakis> you can't return references into those maps
[19:32:28] <nmatsakis> you have to return cloned values, or else take closures, or else &Ref<>
[19:32:38] <nmatsakis> not a big deal really but just kind of a minor irritant
[19:33:45] <Gankro> nmatsakis: Vec<(Key, Val)> seems ideal for small grow-only maps
[19:33:57] <Gankro> (or something isomorphic)
[19:33:58] <nmatsakis> yes, small ones :)
[19:34:17] <Gankro> nmatsakis: How big do the maps get?
[19:34:22] <nmatsakis> very big :)
[19:34:25] <Gankro> dang
[19:34:27] <nmatsakis> but I think the compiler really ough tto be switching
[19:34:31] <nmatsakis> to store data per fn
[19:34:46] <nmatsakis> in which case maps would be smaller, and maybe we can get rid of most of them
[19:35:27] <Gankro> nmatsakis: Hmm... I wonder if an unbalanced BST would do well...
[19:35:38] <reem> nmatsakis: This is the exact problem we solved with PtrMapCell in hyper, the implementation is a lot safer and more natural with Rc, but you can’t return &T, so the whole design leaks implementation details like crazy.
[19:35:41] <Gankro> Presumably names are basically randomly distributed
[19:36:18] <seanmonstar> i didnt want to return Ref<&T>
[19:36:41] <seanmonstar> and since i already have Boxed TraitObjects anyways, it didnt cost me more to use this PtrMap
[19:36:45] <Gankro> nmatsakis: Usage is all random-access, eh?
[19:37:35] <nmatsakis> Gankro: in the compiler? in most cases, we don't iterate, if that's what you mean
[19:37:57] <Gankro> nmatsakis: Yeah
[20:07:46] *** Quits: arielb1 (Ariel@moz-lcu.ri7.19.46.IP) (Connection closed)
[20:08:40] *** Joins: flaper87 (flaper87@moz-fnn.1e9.132.209.IP)
[20:22:10] *** Joins: p1start (p1start@moz-nftjhe.org)
[20:59:35] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[21:18:41] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[21:18:41] *** ChanServ sets mode: +qo brson brson
[21:40:00] *** Joins: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net)
[21:40:00] *** ChanServ sets mode: +o pnkfelix
[22:04:22] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Quit: rcirc on GNU Emacs 24.3.92.1)
[22:06:40] *** Joins: annodomini (lambda@moz-hceqmj.hfc.comcastbusiness.net)
[22:10:31] *** Quits: Manishearth (manishearth@moz-8puj7k.net) (Ping timeout: 121 seconds)
[22:11:32] *** Joins: Manishearth (manishearth@moz-8puj7k.net)
[23:40:40] *** kimundi is now known as zz_kimundi
