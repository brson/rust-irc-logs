[14:00:36] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[14:01:00] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Quit: leaving)
[14:01:13] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[15:20:06] <Seldaek> cmr: new json? :)
[15:20:30] <cmr> hm
[15:20:36] <Seldaek> I'm having such a shitty and unproductive day, I might as well waste the rest of it on this..
[15:21:02] <cmr> jedestep: do you still have a copy of the rustc fork kicking aroudn that you can run `master` on the tests?
[15:21:11] <cmr> I removed mine and haven't finished porting the visitor yet :(
[15:21:24] <Seldaek> oh no worries
[15:21:44] <Seldaek> I still have some things to do that don't need new content
[16:09:22] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[16:29:07] <cmr> Seldaek: some new json for you:
[16:29:08] <cmr> {"enums":[],"structs":[],"fns":[]}
[16:29:12] <cmr> :p
[16:29:53] <Seldaek> wooh
[16:30:11] <Seldaek> and yet it is valuable info, because my code expected "functions" ;)
[16:30:17] <cmr> heh
[16:30:28] <cmr> I don't think it was ever functions?
[16:30:32] <cmr> it was funcs before I think
[16:30:53] <Seldaek> I never saw anything
[16:30:55] <Seldaek> I just made it up
[16:30:57] <cmr> heh
[16:31:47] <Seldaek> cmr: modules: {}, structs: {}, enums: {}, traits: {}, typedefs: {}, fns: {}, reexports: {}
[16:31:51] <Seldaek> that's what I have now
[16:32:02] <cmr> that looks good to me
[16:32:05] <cmr> well
[16:32:07] <cmr> modules -> mods
[16:32:14] <Seldaek> yeah I suppose
[16:32:20] <cmr> trying to keep everything consistent with the corresponding keyword in the source
[16:32:52] <Seldaek> yes that makes sense
[16:33:03] <Seldaek> reexports vs exports? 
[16:33:18] <Seldaek> I guess exports would include everything else 
[16:33:22] <Seldaek> so that's not so great
[16:33:24] <cmr> yeah
[16:33:34] <cmr> and "pubuses" is just nasty
[16:33:51] <Seldaek> yes please not :p
[16:34:31] <Seldaek> I don't ever want to see this word again :)
[16:34:50] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[16:37:20] <cmr> The next json you're going to get is going to have source location information
[16:37:28] <cmr> of the format filename.rs:linenumber, I think
[16:38:11] <Seldaek> that'd be awesome
[16:38:44] <Seldaek> thugh I hope filename.rs is enough to deterministatically link it
[16:38:55] <Seldaek> I assume with a base url + mod name + filename we're good
[16:39:04] <cmr> does that format work for you? I can split it into {"file": "", "line": num}
[16:39:36] <jedestep> cmr: I should still have a pull of that branch somewhere, what exactly should I do with it?
[16:39:40] <Seldaek> yeah I suck at low level languages but I can handle a str split in JS :p
[16:39:46] <cmr> jedestep: what branch?
[16:39:56] <Seldaek> nah forget it guys
[16:39:59] <jedestep> the rustdoc-fork branch
[16:40:01] <cmr> oh
[16:40:03] <jedestep> of rustc
[16:40:04] <cmr> no, it's fine now
[16:40:07] <jedestep> oh ok :)
[16:40:25] <Seldaek> jedestep: I was just being impatient
[16:40:27] <cmr> The old visitor isn't as clean but it works just as well with a few well-placed @mut
[16:41:04] <Seldaek> cmr: is the mod => path mapping enforced at the language level?
[16:41:13] <cmr> Seldaek: what do you mean?
[16:41:45] <Seldaek> is it guaranteed that mod std::foo::bar is in libstd/foo/bar.rs?
[16:41:48] <cmr> no
[16:41:59] <Seldaek> why not?
[16:42:04] <cmr> unlike python, we can define modules in an ad-hoc way
[16:42:08] <cmr> Seldaek: more flexibility
[16:42:10] <Seldaek> this sonuds like a horrible idea :)
[16:42:10] <cmr> for example
[16:42:41] <Seldaek> for having had to deal with random garbage code organization for years, I fully support language strictness at that level
[16:43:04] <cmr> https://github.com/mozilla/rust/blob/master/src/libextra/flate.rs#L23
[16:43:11] <cmr> as an example of where it's useful
[16:43:49] <cmr> And the `#[cfg(test)] mod tests { ... }` in basically every source file.
[16:43:59] <Seldaek> yeah that one fair enough
[16:44:16] <Seldaek> but the mod rustrt there, what does it end up as? extra::flate::rustrt?
[16:44:23] <cmr> it's not supposed to be public
[16:44:25] <cmr> but yes
[16:44:50] <Seldaek> so what's the benefit vs having it in libextra/flate/rustrt.rs?
[16:45:03] <Seldaek> I mean, having internal private modules in a file why not
[16:45:17] <Seldaek> but you should only be able to export pub ones with a strict path IMO
[16:45:29] <cmr> *shrug*
[16:45:35] <cmr> I wasn't around when any of this was being decided
[16:45:48] <cmr> I like what it is now, very flexible to whatever you need
[16:45:48] <Seldaek> yes, but now we have to deal with it 
[16:46:09] <Seldaek> if you tell me rustrt is in flate.rs, I can't know the path to flate.rs
[16:46:18] <Seldaek> so I need a path from root not just filename 
[16:46:30] <cmr> the paths I give will all be relative to the crate root
[16:46:44] <Seldaek> ok then we're good
[16:46:55] <cmr> sorry if that wasn't clear :)
[16:46:57] <Seldaek> your example scared me :p
[16:47:09] <cmr> it's the same mechanism rustc uses when reporting errors, like "visit.rs:110:12: 110:42 error: structure has no field named `visit_enum_def`"
[17:00:52] <cmr> jedestep: Do enum variants need an id?
[17:01:00] <cmr> can they ever be referenced as a type?
[17:10:51] <jedestep> cmr: I don't think variants need an id no
[17:11:01] <jedestep> although they do have an id in syntax::ast
[17:42:54] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[17:43:58] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[18:43:37] <cmr> Ok we're up and running with the old visitor
[18:44:26] <cmr> master updated
[19:12:39] <cmr> Seldaek: https://gist.github.com/cmr/88c63220163da3cb6b87
[19:13:44] <cmr> heh, I love how the pretty printer's key ordering is entirely nondeterministic
[19:14:03] <cmr> Seldaek: So, the "where" field
[19:14:07] <cmr> Not actually relative to the crate root!
[19:14:11] <cmr> Relative to the current directory
[19:14:16] <cmr> Not sure if good or bad yet
[19:14:21] <cmr> No way to change it anyhow
[19:14:38] <cmr> It's `filename:start_line:start_column end_line:end_column`
[19:30:41] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Quit: leaving)
[19:31:19] <Seldaek> cmr: json/js object keys are unordered as per the spec so that's not so surprising
[19:31:30] <Seldaek> various libs do optimizations and trash the order
[19:31:47] <cmr> Seldaek: yeah but for pretty printing you'd expect all objects with the same "shape" to have the same order, for ease of reading
[19:31:51] <cmr> otherwise.. not so pretty!
[19:31:58] <Seldaek> yes indeed 
[19:32:17] <Seldaek> as for the where field
[19:32:27] <Seldaek> I'd call it file or source
[19:32:45] <Seldaek> but it's not so bad if it has a prefix
[19:33:06] <Seldaek> I'll just have to allow mapping a prefix to a url prefix instead of just defining a url prefix
[19:33:08] <Seldaek> then it's fine
[19:35:40] <cmr> Actually!
[19:35:48] <cmr> There was an issue that this would very easily enable..
[19:36:04] <cmr> https://github.com/mozilla/rust/issues/1642
[19:37:49] <cmr> Seldaek: I'm going to rename it to source
[19:40:57] <cmr> Seldaek: https://gist.github.com/cmr/179a6d5315b8b3945d57
[19:41:47] <Seldaek> cmr: cheers
[19:42:11] <cmr> Once I fix https://github.com/cmr/rustdoc_ng/issues/10 I should have some real data for you, hopefully :)
[19:42:21] <Seldaek> though I don't think I'll have much more time anyway today
[19:42:23] <Seldaek> or tomorrow
[19:42:26] <cmr> that's fine
[19:42:29] <Seldaek> friday I'm off for 6days holidays
[19:42:40] <Seldaek> so we'll see next week
[20:13:24] <cmr> Seldaek: have some real data: https://gist.github.com/cmr/399441e52cf20c3e33be
[21:30:41] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[22:12:29] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[23:06:34] *** Quits: Seldaek (seld@moz-5DEA7688.ch) (Ping timeout)
[23:13:08] *** Joins: Seldaek (seld@E733C546.5464C2F1.F113998C.IP)
