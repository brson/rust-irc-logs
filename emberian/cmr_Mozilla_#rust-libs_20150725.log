[00:21:54] <Gankro> bluss: welcome back!!!!!
[00:22:30] <bluss> lol :)
[00:22:34] <bluss> thanks
[00:27:50] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[00:36:57] <Gankro> bluss: Sad to announce there wasn't much libs progress while you were gone; lots of vacations and schedule conflicts :/
[00:38:42] <bluss> Gankro: well it's natural that this time of the year is a bit slow
[00:39:04] <bluss> Gankro: I haven't caught up on all notifications yet
[00:39:21] <Gankro> I'm not sure I agree; random students should be at maximum throttle (this is about when I got started last year)!
[00:39:37] <bluss> oh maybe
[00:39:41] <Gankro> Although maybe europe or other hemisphere are different...?
[00:56:05] *** Quits: bluss (bluss@moz-dc3fi4.customer.cdi.no) (Ping timeout: 121 seconds)
[01:41:36] *** Joins: achanda (achanda@moz-qv7q4n.ca.comcast.net)
[02:36:51] *** Quits: achanda (achanda@moz-qv7q4n.ca.comcast.net) (Connection closed)
[02:43:20] *** Quits: kimundi (kimundi@moz-opd.h2h.188.87.IP) (Ping timeout: 121 seconds)
[02:44:51] *** Joins: kimundi (kimundi@moz-vb8u90.k94d.nekl.57bc.2002.IP)
[03:07:12] *** Joins: achanda (achanda@moz-qv7q4n.ca.comcast.net)
[03:11:21] *** Quits: achanda (achanda@moz-qv7q4n.ca.comcast.net) (Ping timeout: 121 seconds)
[03:43:32] *** Joins: achanda (achanda@moz-qv7q4n.ca.comcast.net)
[04:04:03] *** Quits: eternaleye (eternaleye@moz-7ps.ehi.245.50.IP) (Ping timeout: 121 seconds)
[04:05:09] *** Joins: eternaleye (eternaleye@moz-7ps.ehi.245.50.IP)
[04:09:21] *** Quits: eternaleye (eternaleye@moz-7ps.ehi.245.50.IP) (Ping timeout: 121 seconds)
[04:09:50] *** Joins: eternaleye (eternaleye@moz-7ps.ehi.245.50.IP)
[05:17:30] <Mutabah> I think I asked this a week or so... but then didn't do anything - Should there be open tickets on stabilisation of library features
[05:18:08] <huon> Mutabah: yes, https://github.com/rust-lang/rust/issues/26868
[05:18:30] <huon> aturon has been away this week, so there hasn't been much drive behind the libs team
[05:19:51] <Mutabah> *nod*
[05:19:58] <Mutabah> I might go add one for result_expect then
[07:17:15] <Mutabah> huon: There we go
[07:29:07] *** Joins: bluss (bluss@moz-dc3fi4.customer.cdi.no)
[08:50:59] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[09:52:43] *** Joins: killercup (killercup@moz-f6o3r9.dip0.t-ipconnect.de)
[09:59:09] *** Quits: achanda (achanda@moz-qv7q4n.ca.comcast.net) (Connection closed)
[10:23:34] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[11:31:06] <Elaine> If we separate the refcount from the data we can MASSIVELY increase Rc/Arc's flexibility, because then you can take Rc'd references into the interior of the object. (I think the signature would look fn Rc::borrow<T, U, F>(val: Rc<T>, F) -> Rc<U> where F: FnOnce(T) -> U
[11:31:22] <Elaine> At that point the Rc/Arc would be "just" as powerful as &
[11:31:41] <Elaine> FnOnce(&T) -> U, rather.
[11:31:59] <Elaine> hrm, &U
[11:32:27] <Elaine> would need to experiment to see how the lifetimes work out, so you can't eg return an Rc into a RefCell
[11:32:58] <Elaine> Same pattern would also be useful for Rc'd slices
[11:33:26] <SimonSapin> Elaine: You can do this now: https://github.com/SimonSapin/kuchiki/blob/a7f547cd51c001d77c95986aa1a3665a9e46a62a/src/tree.rs#L630-L662
[11:33:38] <SimonSapin> (with NodeRef generalized to Rc<T>)
[11:34:07] <Mutabah> Elaine: So, same way as C++'s shared_ptr is usually implemented?
[11:34:15] <Elaine> Mutabah: I don't know how shared_ptr works
[11:34:28] <Elaine> If that's what they do, then that seems like good precedent ;)
[11:34:37] <Mutabah> Two pointers, one to the refcoutn, the other to data
[11:35:10] <Elaine> SimonSapin: cool, so it does work safely.
[11:35:31] <SimonSapin> I *believe* it is safe :)
[11:48:48] <kimundi> There could be a Rcp (ref count plus) cargo package for that feature :P
[11:49:07] <kimundi> hmm
[11:49:20] <Elaine> kimundi: it's not as useful if the ecosystem gets partitioned along that boundary.
[11:49:52] <bluss> isn't (Rc<()>, *const T) just the thing you need. Looks like NodeRef
[11:50:41] <Elaine> that's the equivalent unsafe representation, yes.
[11:50:58] <kimundi> bluss: I think the point is to still have the ref count and the data share an allocation
[11:51:12] <bluss> kimundi: oh right
[11:51:32] <kimundi> which however would still work
[11:51:33] <bluss> I think Rc doesn't have to change though
[11:51:47] <kimundi> you'd just have (Rc<T>, *const T)
[11:52:06] <kimundi> hm
[11:52:31] <kimundi> but I guess you really need to erase the type of the original Rc<T>
[11:53:39] <SimonSapin> Itâ€™s really (Rc<T>, *const U), it derefs to U but drops a T when the refcount goes to zero
[11:54:01] <SimonSapin> you need to know what to drop somehow
[11:54:15] <kimundi> Elaine: Anyway, I see the appeal, but there will also be voices speaking out against making Rc<T> larger and potentially less well optimizable due the two pointer accesses. 
[11:54:45] <kimundi> SimonSapin: True, it needs info about the allocation size
[11:55:28] <SimonSapin> kimundi: that and which Drop impl to call
[11:55:47] <kimundi> yeah, all that
[11:58:02] <kimundi> There could be a variant that store something like a vtable
[11:58:32] <kimundi> But thats all too complex for the std lib then in any combination
[11:59:48] <kimundi> I wonder how the shared_ptr impls solve these corner cases
[12:19:25] <kimundi> http://is.gd/GEQudP
[12:19:30] <kimundi> ^ Example impl
[12:19:39] <kimundi> This seems actually quite versatile
[12:20:02] <kimundi> Does anyone see something unsafe on how I use and create the *const U there?
[12:33:29] <bluss> the subslice case already exists as huon's RcSlice
[12:34:05] <bluss> it's a wrapper around (Rc<Box<[T]>>, *const [T]), where it may of course deref to a subslice
[12:35:21] <kimundi> bluss: Yeah - I'm specifically reffering to my use of a &T -> &U closure and just storing and reusing the *const U from that - do you think that logic is sound without additional checks or restrictions?
[12:36:34] <kimundi> Right now I think yes, since the returned reference either points in the T or into something reachable from the shared-access-only T, or to 'static memory, and thus there should be no dangling/invalid pointers, right?
[12:39:21] <bluss> I think so
[12:39:22] <bluss> http://doc.rust-lang.org/nightly/core/cell/struct.RefMut.html#method.map
[12:39:25] <bluss> has the same logic
[12:42:16] <kimundi> bluss: Hm... In that case I think I'll have an interesting cargo package to show soon... :)
[12:43:53] <bluss> hm is this just as usable as rcslice? I guess it is
[12:49:15] <bluss> nice. huon's crate is called shared_slice. I bet you're obsoleting it now
[12:54:37] <kimundi> More than that even, but I'll first try to implement my idea fully before I'll try to obsolete anything :)
[12:57:26] <bluss> RefCell's Ref doesn't own anything so it doesn't have the requirement of carrying the original type 
[13:25:32] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[14:04:33] *** manishearth is now known as Manishearth
[15:41:50] *** Joins: achanda (achanda@moz-qv7q4n.ca.comcast.net)
[16:31:06] *** Quits: achanda (achanda@moz-qv7q4n.ca.comcast.net) (Connection closed)
[17:01:27] *** Joins: achanda (achanda@moz-qv7q4n.ca.comcast.net)
[18:23:22] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[19:00:35] *** Joins: achanda_ (achanda@moz-qv7q4n.ca.comcast.net)
[19:00:36] *** Quits: achanda (achanda@moz-qv7q4n.ca.comcast.net) (Connection closed)
[19:12:41] *** Quits: achanda_ (achanda@moz-qv7q4n.ca.comcast.net) (Connection closed)
[19:51:42] *** Joins: achanda (achanda@moz-qv7q4n.ca.comcast.net)
[20:25:50] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[21:22:40] <SimonSapin> Gankro: I was just refactoring string-cache today to use Option<Box<_>> instead of *mut _ in a linked list and ran into much of http://cglab.ca/~abeinges/blah/too-many-lists/book/first-pop.html
[21:24:29] <SimonSapin> (It has a custom data structure sort of like HashMap<String, arc::Weak<Something>> where map entries are removed when Something is dropped)
[21:30:11] <SimonSapin> Would a generic WeakHashMap make sense?
[21:31:00] *** Quits: bluss (bluss@moz-dc3fi4.customer.cdi.no) (Ping timeout: 121 seconds)
[21:31:17] *** Joins: bluss (bluss@moz-dc3fi4.customer.cdi.no)
[21:32:26] <Gankro> SimonSapin: javascript seems to think so
[21:32:41] <Gankro> https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap
[21:33:50] <Gankro> SimonSapin: but my gut is YAGNI
[21:34:37] <SimonSapin> python has both WeakKeyDictionary and WeakValueDictionary https://docs.python.org/3/library/weakref.html
[21:34:53] <SimonSapin> but yeah, probably not for std
[21:39:53] <SimonSapin> anyway, I like too-many-lists so far, looking forward to the next episode^Wchapter :)
[21:47:42] *** Quits: achanda (achanda@moz-qv7q4n.ca.comcast.net) (Connection closed)
[21:50:46] *** Joins: achanda (achanda@moz-qv7q4n.ca.comcast.net)
[22:00:10] *** Joins: Rym (uid91135@moz-l7h36v.ealing.irccloud.com)
[22:31:28] <huon> kimundi: Elaine: bluss: incidentally, I was experimenting with basically that yesterday, https://gist.github.com/anonymous/703a445b0cf596fb4f55
[22:31:42] <Elaine> heh
[22:31:53] <Elaine> the Rust hivemind speaks.
[22:32:53] <kimundi> huon: Heh, I'm almost done with my crate as well. Expect a /r/rust post in the next 24h ;)
[22:33:05] <huon> kimundi: stealing my idea >:(
[22:33:10] <huon> :P
[22:33:13] <huon> looking forward to it
[22:33:16] <huon> (post to users too ;) )
[22:33:20] <bluss> huon: wow, nice
[22:38:23] <huon> and yeah, it replaces shared_slice
[22:39:26] <bluss> I wonder if the type erased version can be a special case
[22:41:04] <huon> I would guess that it is more useful for the non-erased version to be the special case
[22:41:11] <huon> I wonder if type defaults work well enough
[22:41:56] <bluss> right. depending on how you turn it, using the defaults is either using the special case of a more generic type
[22:42:09] <bluss> or not using the default is the special case
[22:42:28] <bluss> not sure it's possible
[22:42:50] <huon> I think the "defaults guide inference" thing is meant to tackle this
[22:43:05] <huon> not sure the status of jroesch's work on that
[23:04:10] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
