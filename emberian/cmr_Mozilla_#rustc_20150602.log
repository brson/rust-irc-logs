[00:16:52] *** Quits: blank_name (blank_name@moz-j00b3g.mi.frontiernet.net) (Ping timeout: 121 seconds)
[00:18:53] *** Joins: blank_name (blank_name@moz-j00b3g.mi.frontiernet.net)
[00:29:05] *** Joins: Moonlightning (blackl@moz-1rc.30c.23.184.IP)
[00:32:58] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[00:38:28] *** Joins: brson (brson@moz-u4t.ku8.145.82.IP)
[00:38:29] *** ChanServ sets mode: +qo brson brson
[00:56:27] *** Joins: blank_na1e (blank_name@moz-p4egrb.mi.frontiernet.net)
[00:59:20] *** Quits: blank_name (blank_name@moz-j00b3g.mi.frontiernet.net) (Ping timeout: 121 seconds)
[01:23:08] *** Quits: brson (brson@moz-u4t.ku8.145.82.IP) (Quit: leaving)
[02:16:41] <nrc> aatch: ping
[02:19:14] <nrc> aatch: I'm looking at decoding of inlined code from metadata, in particular `decode_inlined_item` this seems to create a fresh decode context and thus reserve more ids. That seems to suggest that if I call the function twice, then I will get two inlined copies of the source fn, with different local node ids
[02:19:18] <nrc> is that correct?
[02:30:30] <aatch> nrc, I don't think so?
[02:31:06] <nrc> aatch: I would have thought not, but I can't see how
[02:31:21] <aatch> nrc, the ast_map has references to inlined items, trying investigating there?
[02:31:56] <nrc> that would be the callers responsibility in that case because doesn't check the ast_map, it only inserts into it, afaict
[02:35:02] *** kimundi is now known as zz_kimundi
[02:36:16] <aatch> nrc, well the generated IR doesn't seem to have copies, assuming that operator overload methods are treated the same way as regular function calls.
[02:38:10] <nrc> I'm not sure about all the callers, but at least the one I see in trans::inline does its own caching
[02:49:08] <aatch> nrc, I would not be overly surprised if it did inline functions multiple times.
[02:49:39] *** Quits: zz_kimundi (kimundi@moz-pvqpe9.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:51:34] *** Joins: zz_kimundi (kimundi@moz-bt8log.dip0.t-ipconnect.de)
[02:51:35] *** zz_kimundi is now known as kimundi
[02:53:41] <nrc> I don't know why but pretty much any code with ids in rustc makes me want to claw out my eyes
[03:03:18] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[03:36:37] *** Quits: Rym (y@moz-mhu.sd4.38.217.IP) (Quit: WeeChat 1.0)
[03:37:14] *** Joins: Rym (uid91135@moz-n2i7qm.charlton.irccloud.com)
[05:48:36] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[05:56:57] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[05:59:58] *** Quits: aatch (james@moz-5r41gb.6pd7.20lj.e000.2406.IP) (Connection closed)
[07:09:05] *** Joins: Tobba (Tobba@moz-6oh.7ki.21.217.IP)
[07:23:27] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[08:05:10] *** Joins: eddyb (eddyb@moz-e8s.ur8.27.188.IP)
[08:46:44] *** Joins: laumann (thomas@moz-gqpfnm.science.ku.dk)
[10:41:04] *** Joins: arielb1 (Mibbit@moz-44kh6r.tau.ac.il)
[10:41:10] <arielb1> nmatsakis: ping
[10:53:56] *** Quits: nrc (nrc@moz-14pjgj.xtra.co.nz) (Ping timeout: 121 seconds)
[11:11:15] *** Joins: nrc (nrc@moz-14pjgj.xtra.co.nz)
[11:11:15] *** ChanServ sets mode: +qo nrc nrc
[11:15:42] *** Quits: nrc (nrc@moz-14pjgj.xtra.co.nz) (Ping timeout: 121 seconds)
[11:21:39] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[11:47:16] *** Quits: Tobba (Tobba@moz-6oh.7ki.21.217.IP) (Ping timeout: 121 seconds)
[12:04:16] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[12:15:34] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[12:16:21] *** Joins: eddyb_ (eddyb@moz-c0q.mv7.25.188.IP)
[12:18:38] *** Quits: laumann (thomas@moz-gqpfnm.science.ku.dk) (Ping timeout: 121 seconds)
[12:19:26] *** Quits: eddyb (eddyb@moz-e8s.ur8.27.188.IP) (Ping timeout: 121 seconds)
[12:20:40] *** Joins: laumann (thomas@moz-3v9.hq0.225.130.IP)
[12:27:24] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[12:31:27] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[12:32:52] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[12:54:24] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[13:40:50] *** Quits: laumann (thomas@moz-3v9.hq0.225.130.IP) (Quit: leaving)
[13:42:41] *** eddyb_ is now known as eddyb
[13:42:56] <nmatsakis> arielb1: pong
[13:50:37] <nmatsakis> pnkfelix: short vesion of what takes time in rustc frontend though is definitely "traits". I have some suspicious as to why but I'm trying to drill down more (I had suspicions going in, but I'm trying to confirm with data)
[13:51:34] <nmatsakis> but I also need to test on more crates probably; I've been using librustc as my sample for now, but I ought to get a wider set
[14:05:58] <pnkfelix> nmatsakis: hey, w.r.t. that move_val_init PR I made... do you think there's any value in trying to generalize the idea to other intrinsics?  Also, would it be worthwhile to change move_val_init's signature so that it exactly matches the signature for ptr::write, and then try to reexport move_val_init *as* ptr::write rather than sticking with it as a wrapper?
[14:06:26] <pnkfelix> (i guess for the latter, I could evaluate the improvement by doing a global search-replace of calls to ptr::write with uses of the intrinsic, see if we get any improvement...)
[14:07:27] <nmatsakis> pnkfelix: what is the differences between the signatures?
[14:07:34] <pnkfelix> (I'm honestly not *too* concerned offhand with trying to apply the idea to other intrinsics ... many of them are meant to be applied to small data types that are hopefully optimized properly...)
[14:07:39] <nmatsakis> pnkfelix: there is some precedent, I think? where we directly exported the intrinsic?
[14:08:00] <pnkfelix> nmatsakis: I think ptr::write takes `dest: *mut T` while move_val_init takes `dest: &mut T`
[14:08:08] <nmatsakis> pnkfelix: tbh I have to review our story on intrinsics a bit, it came up in https://github.com/rust-lang/rfcs/pull/948 and I realized I'm confused (and not necessarily entirely happy)
[14:08:22] <nmatsakis> pnkfelix: ah, *mut seems better yes
[14:08:33] <nmatsakis> pnkfelix: especially, does move_val_init drop the old value? no.
[14:08:38] <pnkfelix> yeah I know
[14:08:40] <nmatsakis> so &mut T just seems totally wrong.
[14:08:41] <pnkfelix> it was very weird
[14:09:29] <arielb1> nmatsakis: ping again
[14:10:06] <arielb1> pnkfelix: what is slow on the front-end is:
[14:10:13] <arielb1>    1) trait resolution
[14:10:21] <arielb1>      2) anything involving substs
[14:11:18] <arielb1> I mean, allocating them
[14:11:51] <arielb1> trait resolution is slow mostly because it does it a lot
[14:15:59] <nmatsakis> arielb1: context was that I've been doing profiling and analysis, but I agree with your summary for the most part. I saw your ping on GH, will respond today -- I should say that changing the lang is out of the question, but I have a plan for reshuffling the current setup to avoid "rematching" traits where we know we won't make progress
[14:16:27] <arielb1> I was also doing profiling
[14:16:30] <nmatsakis> basically I think that the current split between paramenv/inferctxt/traitctxt is harmful and I want to collapse them somewhat
[14:16:52] <arielb1> traitctxt?
[14:16:56] <nmatsakis> well it's not a real thing
[14:16:59] <nmatsakis> but the fulfillment context
[14:17:06] <nmatsakis> and to some extent selection context, though that's more transient
[14:17:08] <arielb1> nmatsakis: and fnctxt
[14:17:21] <nmatsakis> well, FnCtxt is different, might be worth collapsing but I'm not sure
[14:17:25] <arielb1> wf uses FnCtxt for that role
[14:18:23] <arielb1> as InferCtxt+FulfillmentContext+ParameterEnvironment
[14:18:27] <nmatsakis> yes I know
[14:18:38] <nmatsakis> but FnCtxt has other stuff in it
[14:18:47] <nmatsakis> that does seem separable to me
[14:18:58] <nmatsakis> e.g. the side tables storing computed types of expressions
[14:19:02] <arielb1> FnCtxt needs to split
[14:19:02] <arielb1> really
[14:19:11] <arielb1> check/mod.rs wants splitting badly
[14:19:30] <nmatsakis> it's certainly overgrown, but I'm not sure precisely what you mean by "splitting"
[14:20:01] <arielb1> check/mod.rs should at least be split into an expr-checker and FnCtxt
[14:20:57] <arielb1> nmatsakis: would you like trans to use a shared FulfillmentContext too?
[14:21:03] <nmatsakis> so it's clear that the code needs to be spread out. huge files make me itchy. but I do also think more clearly definted interfaces would be helpful (of course) 
[14:21:36] <nmatsakis> arielb1: I think trans should, yes.
[14:21:52] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[14:22:05] <nmatsakis> arielb1: or rather a shared "typing environment", which would I guess be this merger I'm talking about
[14:22:09] <arielb1> why?
[14:22:30] <nmatsakis> well, mostly because I'd like to avoid the trans-specific caches that currently exist
[14:22:42] <nmatsakis> and instead just have trans/typeck share the same logic
[14:22:53] <arielb1> trans-specific?
[14:23:04] <nmatsakis> trans has its own layers of caching atop the existing ones
[14:23:12] <nmatsakis> it's not clear how helpful these are tbh
[14:23:33] <nmatsakis> though the existing ones were (I think?) causing trouble for nrc w/r/t closures, I have to catch up with him on current state there
[14:23:36] <arielb1> what are they?
[14:23:40] <arielb1> where are they
[14:24:31] <nmatsakis> arielb1: ccx.trait_cache(), for example
[14:24:33] <arielb1> trans::context has only trans stuff
[14:24:47] <arielb1> except for trait_cache, I guess
[14:25:04] <arielb1> I don't think typeck can use trait_cache
[14:25:05] <arielb1> as it is
[14:25:25] <nmatsakis> no, it can't. perhaps trait_cache is fine, idk.
[14:25:25] <arielb1> typeck already has the selection cache
[14:25:28] <nmatsakis> yes, I know
[14:25:40] <arielb1> and typeck needs confirmation
[14:25:44] <nmatsakis> given that the types differ
[14:25:47] * nmatsakis shrugs
[14:25:56] <nmatsakis> I mean, whether or not trans uses a shared env or not 
[14:25:58] <nmatsakis> isn't that big a deal
[14:26:21] <arielb1> I got some small perf improvements using a global param-env in trans
[14:27:40] <arielb1> for type_is_sized
[14:30:20] <eddyb> type_is_sized should be very fast (I'd almost cache it in the type flags)
[14:30:32] <arielb1> eddyb: I am planning to cache it in flags
[14:30:43] <arielb1> currently it isn't very fast
[16:49:30] *** Quits: arielb1 (Mibbit@moz-44kh6r.tau.ac.il) (Quit: http://www.mibbit.com ajax IRC Client)
[17:22:05] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[17:22:06] *** ChanServ sets mode: +qo brson brson
[17:41:36] *** Joins: arielb1 (Ariel@moz-9he9ta.red.bezeqint.net)
[18:00:20] *** Joins: sigma (sigma@moz-im7cik.range86-135.btcentralplus.com)
[18:22:37] *** Joins: Tuba (Tobba@moz-o13d22.bredband.telia.com)
[18:25:35] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[18:27:36] *** Quits: arielb1 (Ariel@moz-9he9ta.red.bezeqint.net) (Ping timeout: 121 seconds)
[18:28:30] *** Joins: arielb1 (Ariel@moz-9he9ta.red.bezeqint.net)
[19:00:55] *** Quits: sigma (sigma@moz-im7cik.range86-135.btcentralplus.com) (Connection closed)
[19:05:36] *** Joins: killercup (killercup@moz-723bo4.dip0.t-ipconnect.de)
[19:21:17] *** Joins: nrc (nrc@moz-14pjgj.xtra.co.nz)
[19:21:18] *** ChanServ sets mode: +qo nrc nrc
[20:32:01] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[20:34:16] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Quit: Leaving.)
[20:34:27] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[20:38:43] *** Tuba is now known as Tobba
[20:46:36] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Quit: leaving)
[21:13:21] *** Quits: Yurume (Yurume@moz-0t8.piq.68.115.IP) (Ping timeout: 121 seconds)
[21:14:32] *** Joins: Yurume (Yurume@moz-0t8.piq.68.115.IP)
[21:18:15] *** Quits: killercup (killercup@moz-723bo4.dip0.t-ipconnect.de) (Quit: Bye)
[21:32:34] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[21:52:37] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[22:03:57] *** Quits: kimundi (kimundi@moz-bt8log.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[22:09:11] *** Quits: reem (sid78397@moz-octfcu.brockwell.irccloud.com) (Ping timeout: 121 seconds)
[22:10:26] *** Joins: zz_kimundi (kimundi@moz-6vnj1q.dip0.t-ipconnect.de)
[22:10:49] *** zz_kimundi is now known as kimundi
[22:11:12] *** Quits: eddyb (eddyb@moz-c0q.mv7.25.188.IP) (Ping timeout: 121 seconds)
[22:13:59] *** Quits: aturon (sid36348@moz-n3h4qj.brockwell.irccloud.com) (Ping timeout: 121 seconds)
[22:18:19] *** Quits: frewsxcv (uid86219@moz-dneii9.brockwell.irccloud.com) (Ping timeout: 121 seconds)
[22:30:53] *** Joins: SilverKey (SilverKey@moz-b7q751.biz.rr.com)
[22:31:12] *** Quits: SilverKey (SilverKey@moz-b7q751.biz.rr.com) (Quit: Cheerio!)
[22:33:22] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[22:38:40] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Quit: Leaving)
[22:49:03] *** Joins: reem (sid78397@moz-octfcu.brockwell.irccloud.com)
[23:00:34] *** Joins: frewsxcv (sid86219@moz-dneii9.brockwell.irccloud.com)
[23:01:13] <nmatsakis> nrc: did that turn out to be the problem?
[23:02:09] <nrc> not sure, I've mostly being doing some reviews and talking to movers. I did get a log, but it was 2gigs of data and didn't really help
[23:05:13] *** Quits: reem (sid78397@moz-octfcu.brockwell.irccloud.com) (Quit: )
[23:13:37] *** Joins: aturon (sid36348@moz-n3h4qj.brockwell.irccloud.com)
[23:13:37] *** ChanServ sets mode: +o aturon
[23:15:21] *** Joins: reem (sid78397@moz-octfcu.brockwell.irccloud.com)
[23:18:01] <arielb1> nmatsakis: the VecPerParamSpace wasn't needed
[23:18:07] <arielb1> r? gh25975
[23:19:38] <arielb1> btw, do you have any comments on my fix-wf work?
[23:20:38] *** Joins: aatch (james@moz-5r41gb.6pd7.20lj.e000.2406.IP)
[23:43:10] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[23:49:36] *** kimundi is now known as zz_kimundi
[23:57:30] *** Quits: arielb1 (Ariel@moz-9he9ta.red.bezeqint.net) (Connection closed)
