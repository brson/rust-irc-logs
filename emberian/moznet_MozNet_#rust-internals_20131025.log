[00:01:11] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[00:05:42] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[00:13:05] *** Joins: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com)
[00:15:40] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[00:21:57] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[00:34:14] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[00:34:54] *** Quits: tjc (tjc@moz-F65A248F.tmodns.net) (Quit: Places to go, people to annoy)
[00:36:07] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[00:36:08] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 142e0d070 to 143f5b221: 02http://git.io/N3iJvQ
[00:36:08] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[00:36:11] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[00:36:12] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/q6yPEA
[00:36:12] <ghrust> 13rust/06auto 1476287cc 15Patrick Walton: libextra: Make arc clone inline
[00:36:12] <ghrust> 13rust/06auto 14b13415c 15Patrick Walton: libextra: Make arc::get and arc::new inline too....
[00:36:12] <ghrust> 13rust/06auto 14b0c4752 15bors: auto merge of #10055 : pcwalton/rust/arc-clone-inline, r=alexcrichton...
[00:36:14] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[00:42:48] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[00:43:49] <strcat> pcwalton: https://github.com/mozilla/rust/pull/10059 r?
[00:43:55] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[00:44:19] <pcwalton> hah
[00:44:21] <pcwalton> r+
[00:44:46] <strcat> it will make take glue not get inlined with optimization off but I doubt it will matter much
[00:45:33] <strcat> (and ideally we wouldn't have take glue... since we'd have a real GC)
[00:45:58] <pcwalton> I'm not sure the badness I was seeing in Servo was that bad
[00:46:02] <pcwalton> on reflection
[00:46:04] <pcwalton> but it is still a good change
[00:46:35] <strcat> pcwalton: we used to mark structural glue as never inline
[00:46:40] <strcat> so I knew where this evil thing was ;p
[00:50:46] <pcwalton> I wonder if we can use SIMD for border computation
[00:50:50] <pcwalton> because there are 4 values here
[00:50:52] <pcwalton> top, right, bottom, left
[00:51:00] <pcwalton> that should fit into a SIMD register
[00:51:27] <brson> that would be really sweet and simple
[00:51:54] *** Quits: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com) (Ping timeout)
[00:51:57] <pcwalton> brson: do we have SIMD types in rust? how did we decide to do it, did it get implemented?
[00:52:40] <brson> pcwalton: i think it's rather incomplete there's a std::unstable::simd module that defines some types that are tagged #[simd]
[00:52:48] <pcwalton> so the operation we want is
[00:52:59] <brson> that module is pretty old though, may not reflect current strategy
[00:53:07] <brson> and doesn't define *any* operators
[00:53:13] <pcwalton> :\
[00:53:31] <brson> maybe ping jensnockert to hack something together
[00:53:49] <brson> or sanxiyn
[00:53:52] <pcwalton> x[N] = t[N] == 0 ? v[N] : v[N] * CW
[00:54:02] <pcwalton> where N ranges over [0..3]
[00:54:34] <pcwalton> t[N] is a boolean, CW is a scalar value, and v[N] is either an int or a boolean depending on whether t[N] is true or not
[00:54:36] <pcwalton> err
[00:54:45] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[00:54:48] <pcwalton> t[N] is a boolean, CW is a scalar value, and v[N] is either an int or a float depending on whether t[N] is true or not
[00:55:05] <pcwalton> can that use SIMD?
[00:56:47] <acrichto> rusti: use unstable::simd::*; i64x2(1, 2) + i64x2(3, 4)
[00:56:49] -rusti- pastebinned 10 lines of output: http://sprunge.us/SKYJ
[00:57:00] <acrichto> rusti: use std::unstable::simd::*; i64x2(1, 2) + i64x2(3, 4)
[00:57:01] -rusti- std::unstable::simd::i64x2(4i64, 6i64)
[00:57:16] <acrichto> I think that all the operators are defined in the compiler, not in the libraries
[00:57:49] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[00:57:58] <pcwalton> maybe I should play with autovectorization
[00:58:50] <pcwalton> the awesome thing about the CSS spec is that it says nothing about how accurate percentages have to be
[00:59:10] <pcwalton> so I can probably skip floating point
[00:59:43] *** Quits: geoffhill (geoffhill@moz-244CF33A.amazon.com) (Input/output error)
[00:59:53] *** Joins: geoffhill (geoffhill@moz-244CF33A.amazon.com)
[01:00:20] <acrichto> ah I'm so happy you can print a million times and it doesn't segfault any more
[01:02:56] <aatch> pcwalton, percentages should be accurate to 1 sig fig :P
[01:03:30] *** Quits: geoffhill (geoffhill@moz-244CF33A.amazon.com) (Ping timeout)
[01:03:40] *** Joins: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com)
[01:04:20] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[01:05:38] <pcwalton> grr, didn't autovectorize
[01:05:44] <pcwalton> is there something I have to do to make rustc autovectorize?
[01:05:53] <aatch> pcwalton, -O3 normally
[01:06:08] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[01:06:10] <aatch> but I think it's pretty finicky from what strcat was saying
[01:06:31] <pcwalton> yeah, I used iter.enumerate and it didn't work.
[01:07:45] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[01:08:19] *** Joins: geoffhill (geoffhill@moz-244CF33A.amazon.com)
[01:08:29] <brson> simd == ices
[01:10:01] <brson> and you can't multiply a vector by a scalar
[01:10:14] <brson> the vector multiplation works at least
[01:10:26] <pcwalton> blech, it won't autovectorize for me
[01:10:31] <pcwalton> probably due to the fact that our vector lengths are in bytes
[01:10:36] <pcwalton> also it can't eliminate bounds checks :(
[01:10:40] <pcwalton> very sad
[01:16:32] *** Quits: pcwalton (pcwalton@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: pcwalton)
[01:19:20] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[01:20:58] *** Joins: ercxx (ercan@moz-7CFF3469.dyn.optonline.net)
[01:25:20] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[01:33:28] *** Quits: geoffhill (geoffhill@moz-244CF33A.amazon.com) (Ping timeout)
[01:39:14] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[01:40:09] <acrichto> llvm silent renaming of duplicate symbols strikes again!
[01:41:11] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[01:41:11] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/q6yPEA
[01:41:11] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[01:41:20] <aatch> Hmm.. it seems that the previous work on static linking got like 90% of the way there
[01:42:21] <acrichto> I have a local branch which builds all the runtime libraries as static libraries, but I never got static linking of rust libraries to work, I got a little bogged down in other things :(
[01:43:02] <acrichto> aatch: https://github.com/alexcrichton/rust/commit/056b7d6a0f46da11aaad8fb8321c5cbab3b023da, but it's probably pretty old by now
[01:44:38] <aatch> acrichto, heh, well the code is there for loading a "static crate" which turns out to just be a basic object file with a fancy extension (.rlib), I managed to get it load it and resolve, I'm just fixing an error that comes up while linking
[01:45:29] <aatch> hopefully my change fixes it and I can get it to actually output an appropriately named file (right now it actually just outputs <cratename>.o
[01:45:30] <aatch> )
[01:45:59] <strcat> then we just need LTO support ;p
[01:46:07] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[01:46:07] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/I9FNwA
[01:46:07] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[01:46:08] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[01:46:08] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/k-NcYQ
[01:46:08] <ghrust> 13rust/06auto 143b30377 15Alex Crichton: Fix a bug with the scheduler and destructor order...
[01:46:08] <ghrust> 13rust/06auto 143ee5ef1 15Alex Crichton: Remove the 'callback_ms' function from EventLoop...
[01:46:08] <ghrust> 13rust/06auto 14c03f704 15Alex Crichton: Implement a basic event loop built on LittleLock...
[01:46:10] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[01:46:12] <aatch> strcat, yep, one thing at a time :P
[01:47:46] <aatch> I'm hoping to be able to get workable static linking up and running. I'm not going to care much about building static versions of everything or handling any cases like that.
[01:48:43] <aatch> *Handling any edge cases
[01:49:51] <aatch> Well that was surprisingly easy.
[01:50:21] <aatch> I mean, I'm still dynamically linked against librustrt, but whatever.
[01:51:13] *** Joins: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[01:53:51] <Luqman> sweet, got variadic extern functions working: https://gist.github.com/luqmana/5a6960f831c2c2dc142b
[01:56:06] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[01:56:06] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 140bd2949 to 14b0c4752: 02http://git.io/N3iJvQ
[01:56:06] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[01:56:10] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[01:56:10] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/nM3GOg
[01:56:10] <ghrust> 13rust/06auto 14d497e6e 15Daniel Micay: stop trying to outsmart LLVM inline heuristics...
[01:56:10] <ghrust> 13rust/06auto 14c16a95c 15bors: auto merge of #10059 : thestinger/rust/glue, r=pcwalton...
[01:56:10] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[02:02:54] *** Quits: lkuper_ (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[02:11:26] *** Joins: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[02:15:47] *** Quits: kimundi (kimundi@moz-C410002E.dip0.t-ipconnect.de) (Ping timeout)
[02:19:17] *** Joins: kimundi (kimundi@moz-16FE982D.dip0.t-ipconnect.de)
[02:20:19] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[02:20:34] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[02:23:36] *** kimundi is now known as zz_kimundi
[02:25:45] *** Quits: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[02:29:13] <strcat> is there a method->trait map?
[02:29:22] <strcat> er
[02:29:24] <strcat> method->impl
[02:30:38] *** zz_kimundi is now known as kimundi
[02:31:28] <Luqman> strcat: methods on tcx maybe?
[02:31:56] <Luqman> tcx.methods DefId -> @ty::Method
[02:32:18] <aatch> strcat, well I can build a static rust-core, I'm getting link errors trying to statically link an executable, but that may be because I'm using a stage1 compiler
[02:32:30] <Luqman> which has a container field which could give you the impl or trait DefId
[02:33:45] <strcat> yep, thanks :)
[02:38:22] *** Joins: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[02:42:35] <strcat> Luqman: luckily destructors aren't in the method map!
[02:44:14] <Luqman> strcat: ah, special cases. fun fun fun.
[02:44:18] <aatch> acrichto, hey, where is rust_stack_exhausted?
[02:44:25] <strcat> Luqman: nah I think it just outputs them as needed
[02:53:38] <aatch> strcat, hah, I found a bug in rust-core
[02:53:47] <aatch> infinite recursion in free
[02:54:04] *** Joins: yghannam (yghannam@moz-C5BCCF4E.lightspeed.austtx.sbcglobal.net)
[02:54:22] *** Quits: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[02:55:55] <aatch> Otherwise, I have now managed to get rustc to output a static crate for rust-core, then statically link the example against it.
[02:56:07] <dbaupp> aatch: I thought strcat fixed that... ?
[02:57:21] <aatch> dbaupp, that's what I get for not updating...
[02:57:32] <dbaupp> heh
[02:59:47] <pcmattman> what is used to determine if a run-pass test "passed"?
[03:00:13] <aatch> Ok, so it seems that, for the moment, a no_std build also needs to have rust_stack_exhausted available.
[03:00:47] <cmr> pcmattman: compiled, returned 0
[03:01:01] <pcmattman> as in, exit status zero?
[03:01:07] <cmr> yeah
[03:01:16] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[03:01:16] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/nM3GOg
[03:01:16] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[03:01:24] <pcmattman> I have a test being terminated by a signal that thinks it passed :(
[03:01:32] <pcmattman> (SIGTRAP - from the dynamic linker)
[03:01:48] <cmr> the signal handler does exit(0) /
[03:01:59] <pcmattman> oh.
[03:03:47] <pcmattman> is that the signal handler for all signals or a select few (eg, if a run-pass test segfaults, is that a failure?)
[03:04:37] <cmr> there are no special signal handlers
[03:04:54] <cmr> but the signal has a default disposition, I'm wondering if the default behavior is to exit 0
[03:05:01] <cmr> because if so, that seems really really broken
[03:05:19] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[03:06:11] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[03:06:11] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/OIgolQ
[03:06:11] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[03:06:12] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[03:06:12] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/3wk5qw
[03:06:12] <ghrust> 13rust/06auto 143b30377 15Alex Crichton: Fix a bug with the scheduler and destructor order...
[03:06:12] <ghrust> 13rust/06auto 143ee5ef1 15Alex Crichton: Remove the 'callback_ms' function from EventLoop...
[03:06:13] <ghrust> 13rust/06auto 14c03f704 15Alex Crichton: Implement a basic event loop built on LittleLock...
[03:06:15] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[03:06:58] *** Quits: dbaupp (Thunderbir@moz-EA27E3E6.lns20.syd6.internode.on.net) (Ping timeout)
[03:07:08] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[03:08:18] *** Joins: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[03:08:54] *** Joins: dbaupp (Thunderbir@moz-EA27E3E6.lns20.syd6.internode.on.net)
[03:17:11] <pcmattman> cmr: the default behaviour in rust, or on the system?
[03:17:38] <cmr> pcmattman: system
[03:17:51] <pcmattman> definitely comes out with a non-zero exit status on the system with a test C program with no signal handlers installed
[03:18:02] <cmr> hm. maybe libuv does weird things..
[03:18:08] <cmr> I didn't think we touched signals ourselves.
[03:20:06] <aatch> Well basic static linking works now: https://github.com/Aatch/rust/tree/static-link
[03:20:38] <pcmattman> well, as it stands, a run-pass test that is pub fn main() { unsafe { *(0 as *mut int) = 0; } } passes even though it actually terminates with SIGSEGV
[03:20:41] <cmr> aatch: rlib?
[03:20:48] <pcmattman> on OSX, YMMV on not-osx
[03:20:51] <aatch> cmr, yep
[03:20:53] <cmr> pcmattman: that's not good
[03:21:02] <cmr> aatch: is that something you made up or is it a convention I'm unaware of?
[03:21:12] <pcmattman> cmr: I agree
[03:21:16] <aatch> cmr, it was what was there before
[03:21:44] <aatch> most of the work seems to have already been done. I just did the little extra required.
[03:22:22] <aatch> cmr, the issue with it being '.a' is that it isn't actually a static archive
[03:22:39] <cmr> aatch: because of metadata, yeah?
[03:22:57] <aatch> cmr, yep. it's actually just a normal object file (.o)
[03:23:16] <eddyb9> huh?
[03:23:45] <Luqman> aatch: but you can create a .a from a .o
[03:23:51] <eddyb9> what .a? produced by rustc?
[03:24:29] <aatch> Luqman, yes, but that's a specific file format, not what is currently considered a static library by rustc
[03:24:52] <aatch> Luqman, as in, the process of .o -> .a isn't `mv`
[03:24:54] *** Quits: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[03:25:08] <Luqman> aatch: sure, but i think it would make sense to teach rustc to output/handle .a
[03:25:22] <Luqman> yes, usually it's `ar rcs libfoo.a foo.o`
[03:25:34] <aatch> Luqman, possibly, but that has a bunch of complicating factors.
[03:25:44] <aatch> mostly around metadata
[03:27:49] *** Joins: eddyb (eddy@37F72125.9065A63B.FCAAE698.IP)
[03:29:22] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[03:30:52] *** Quits: yghannam (yghannam@moz-C5BCCF4E.lightspeed.austtx.sbcglobal.net) (Ping timeout)
[03:32:42] <pcmattman> cmr: created https://github.com/mozilla/rust/issues/10062, might have a look at it this evening if nobody else does, or it's decided it's a wontfix or expected behaviour
[03:32:51] <pcmattman> (for the signal handler thing)
[03:35:56] *** Joins: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[03:37:16] *** Quits: Luqman (laden@moz-AB7945E9.csclub.uwaterloo.ca) (Ping timeout)
[03:38:29] <pcmattman> and updated, as a segfault does the right thing on linux
[03:39:08] <eddyb9> libuv/osx bug, maybe
[03:40:50] *** Quits: ercxx (ercan@moz-7CFF3469.dyn.optonline.net) (Quit: WeeChat 0.4.2)
[03:46:05] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[03:46:05] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d59b72e to 14c16a95c: 02http://git.io/N3iJvQ
[03:46:05] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[03:46:06] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[03:46:06] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/s_jnSQ
[03:46:06] <ghrust> 13rust/06auto 149940402 15Alex Crichton: Cache and buffer stdout per-task for printing...
[03:46:06] <ghrust> 13rust/06auto 1474b6b7e 15bors: auto merge of #10060 : alexcrichton/rust/cached-stdout, r=brson...
[03:46:07] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[04:00:30] *** Quits: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[04:05:41] *** Joins: Luqman (laden@moz-AB7945E9.csclub.uwaterloo.ca)
[04:07:38] *** Quits: aatch (James@moz-B437F499.pocketrent.com) (Client exited)
[04:08:06] *** Quits: eddyb9 (eddy@37F72125.9065A63B.FCAAE698.IP) (Ping timeout)
[04:18:18] *** Joins: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[04:20:16] *** Joins: eddyb9 (eddy@BF35C1DC.9A7C5F59.4A6B528C.IP)
[04:21:55] *** Quits: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[04:26:10] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[04:26:10] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/iDf9DA
[04:26:10] <ghrust> 13rust/06auto 14327878e 15Daniel Micay: remove some dead trans code
[04:26:10] <ghrust> 13rust/06auto 147a76d07 15bors: auto merge of #10061 : thestinger/rust/rustc, r=alexcrichton
[04:26:11] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[04:26:29] *** Joins: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[04:29:25] *** Quits: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[04:33:39] *** Joins: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[04:37:49] <strcat> Luqman: sadly no luck at all with that thing ;\
[04:37:54] <strcat> keep retrying but no
[04:38:00] <strcat> http://ix.io/8Kj
[04:38:02] <strcat> *shrug*
[04:38:04] <strcat> task '<unnamed>' failed at 'No def'n found for syntax::ast::DefId{crate: 0, node: 119721} in tcx.methods', /home/strcat/projects/rust/src/librustc/middle/ty.rs:3692
[04:41:16] <Luqman> weird
[04:45:18] *** Joins: jeffdb_ (jeff@moz-D13B6004.hsd1.ca.comcast.net)
[04:48:38] <strcat> Luqman: maybe I need trait_method for a trait impl method?
[04:48:42] <strcat> I don't get it
[04:49:11] <strcat> most annoying bug ever :||
[05:00:50] <strcat> acrichto: around?
[05:01:20] <acrichto> strcat: yes
[05:01:30] *** Quits: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[05:01:41] *** Joins: tikue_ (tikue_star@95463E68.3B4A6B80.689607DE.IP)
[05:02:41] <strcat> acrichto: do you know anything about how cross-crate method stuff works?
[05:03:07] <acrichto> inlining or linking?
[05:03:20] <strcat> type context tables
[05:03:27] * strcat can't figure this out :(
[05:03:30] <acrichto> not about that no :(
[05:03:49] <strcat> I have a feeling no one understands it...
[05:04:00] <cmr> nmatsakis or pcwalton probably might.
[05:04:03] <cmr> (no typo)
[05:06:13] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[05:06:13] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 147a76d07 to 14c16a95c: 02http://git.io/N3iJvQ
[05:06:13] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[05:06:14] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[05:06:14] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/3R_39w
[05:06:14] <ghrust> 13rust/06auto 149940402 15Alex Crichton: Cache and buffer stdout per-task for printing...
[05:06:14] <ghrust> 13rust/06auto 141b951f7 15bors: auto merge of #10060 : alexcrichton/rust/cached-stdout, r=brson...
[05:06:15] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[05:06:15] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[05:06:36] * dbaupp wants to know about cross-crate method stuff for the #[deprecated] etc annotations too
[05:07:03] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Connection reset by peer)
[05:07:08] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:07:09] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Connection reset by peer)
[05:07:30] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:08:06] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[05:17:22] *** Quits: Kxepal (Miranda@moz-6B9ED67C.pppoe.mtu-net.ru) (Ping timeout)
[05:18:57] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[05:18:59] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[05:19:17] *** Joins: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP)
[05:20:26] *** Joins: Kxepal (Miranda@moz-C9C3DD3D.pppoe.mtu-net.ru)
[05:26:01] *** Quits: jeffdb_ (jeff@moz-D13B6004.hsd1.ca.comcast.net) (Quit: jeffdb_)
[05:40:09] *** Joins: tjc (tjc@moz-AA7D7DF7.tmodns.net)
[05:40:10] *** ChanServ sets mode: +o tjc
[05:47:37] *** Quits: tjc (tjc@moz-AA7D7DF7.tmodns.net) (Quit: Places to go, people to annoy)
[05:48:22] *** kimundi is now known as zz_kimundi
[05:51:09] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[05:51:10] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 141b951f7 to 14c16a95c: 02http://git.io/N3iJvQ
[05:51:10] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[05:51:13] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[05:51:13] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/q_nptA
[05:51:13] <ghrust> 13rust/06auto 149940402 15Alex Crichton: Cache and buffer stdout per-task for printing...
[05:51:13] <ghrust> 13rust/06auto 14bcdbb2d 15bors: auto merge of #10060 : alexcrichton/rust/cached-stdout, r=brson...
[05:51:13] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[05:52:24] <Luqman> r? https://github.com/mozilla/rust/pull/10026
[06:00:32] *** Quits: lkuper (lkuper@FBF17CA0.FFCF2A3B.51B6877.IP) (Ping timeout)
[06:02:02] *** Quits: tikue_ (tikue_star@95463E68.3B4A6B80.689607DE.IP) (Ping timeout)
[06:36:11] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[06:36:11] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14bcdbb2d to 14c16a95c: 02http://git.io/N3iJvQ
[06:36:11] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[06:36:15] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[06:36:15] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/lcXPOw
[06:36:15] <ghrust> 13rust/06auto 14327878e 15Daniel Micay: remove some dead trans code
[06:36:15] <ghrust> 13rust/06auto 14ac82d18 15bors: auto merge of #10061 : thestinger/rust/rustc, r=alexcrichton
[06:36:16] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[06:37:14] *** flaper87|afk is now known as flaper87
[07:02:19] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[07:14:37] *** zz_kimundi is now known as kimundi
[07:28:48] *** flaper87 is now known as flaper87|afk
[07:34:37] *** Joins: nrc (nrc@DA4ABEAF.1DE10CA8.D8E68FF6.IP)
[07:39:12] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[07:41:23] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[07:41:23] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/lcXPOw
[07:41:23] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[07:46:12] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[07:46:12] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Tq9LMA
[07:46:12] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[07:46:14] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[07:46:14] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/cyvVqw
[07:46:14] <ghrust> 13rust/06auto 143b30377 15Alex Crichton: Fix a bug with the scheduler and destructor order...
[07:46:14] <ghrust> 13rust/06auto 143ee5ef1 15Alex Crichton: Remove the 'callback_ms' function from EventLoop...
[07:46:15] <ghrust> 13rust/06auto 1464a5c3b 15Alex Crichton: Implement a basic event loop built on LittleLock...
[07:46:17] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[07:51:37] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[07:57:28] *** kimundi is now known as zz_kimundi
[08:00:24] *** zz_kimundi is now known as kimundi
[08:01:46] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[08:21:43] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[08:32:56] *** Quits: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com) (Ping timeout)
[08:38:34] *** Joins: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk)
[08:39:14] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[08:39:37] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[08:51:06] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[08:51:07] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/cyvVqw
[08:51:07] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[08:56:07] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[08:56:07] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/yWVPHg
[08:56:07] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[08:56:09] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[08:56:09] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/QF5nYg
[08:56:09] <ghrust> 13rust/06auto 149940402 15Alex Crichton: Cache and buffer stdout per-task for printing...
[08:56:09] <ghrust> 13rust/06auto 141c353c2 15bors: auto merge of #10060 : alexcrichton/rust/cached-stdout, r=brson...
[08:56:10] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[09:01:08] *** Joins: mib_ao6r5o (Mibbit@C3F166BF.FED7EB1F.57DA49D3.IP)
[09:01:37] *** Quits: mib_ao6r5o (Mibbit@C3F166BF.FED7EB1F.57DA49D3.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[09:16:16] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Ping timeout)
[09:17:17] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[09:26:48] *** kimundi is now known as zz_kimundi
[09:33:07] *** Joins: jdm (jdm@88F51059.F3BBB17D.144F44FA.IP)
[09:41:46] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[09:50:25] <nmatsakis> strcat gone? I do understand how cross-crate inlining works
[09:50:28] <nmatsakis> oh well
[09:52:16] <jdm> if I want to mutate the AST after it's created, what options do I have?
[09:52:30] <jdm> we have a number of @item or @Expr which have stymied me
[09:52:41] * jdm is experimenting with rust refactoring tools
[09:56:18] <jdm> Luqman: variadic ffi :O
[09:56:21] <jdm> you're the best
[10:07:03] *** Quits: Kxepal (Miranda@moz-C9C3DD3D.pppoe.mtu-net.ru) (Quit: Kxepal)
[10:07:20] *** Joins: Kxepal (Miranda@moz-C9C3DD3D.pppoe.mtu-net.ru)
[10:08:13] *** Quits: Kxepal (Miranda@moz-C9C3DD3D.pppoe.mtu-net.ru) (Connection reset by peer)
[10:08:35] *** Joins: Kxepal (Miranda@moz-C9C3DD3D.pppoe.mtu-net.ru)
[10:08:56] *** zz_kimundi is now known as kimundi
[10:21:54] *** flaper87|afk is now known as flaper87
[10:24:46] *** Joins: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com)
[10:32:34] *** Joins: jensnockert (jensnocker@moz-952CD207.ab.sol.lu.se)
[10:32:46] *** Quits: jensnockert (jensnocker@moz-952CD207.ab.sol.lu.se) (Input/output error)
[10:34:43] *** Joins: RomiRastamanUyee (Mibbit@moz-E767D7B6.opera-mini.net)
[10:36:46] *** Joins: mib_2onje6 (Mibbit@moz-E767D7B6.opera-mini.net)
[10:39:40] *** Quits: RomiRastamanUyee (Mibbit@moz-E767D7B6.opera-mini.net) (Quit: http://www.mibbit.com ajax IRC Client)
[10:39:54] *** Quits: eddyb9 (eddy@BF35C1DC.9A7C5F59.4A6B528C.IP) (Ping timeout)
[10:42:01] *** Quits: mib_2onje6 (Mibbit@moz-E767D7B6.opera-mini.net) (Quit: http://www.mibbit.com ajax IRC Client)
[10:48:25] *** flaper87 is now known as flaper87|afk
[11:01:54] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[11:04:48] <nmatsakis> jdm: folding
[11:05:01] <nmatsakis> jdm: the AST is not designed for in-place mutation
[11:05:01] * jdm has heard that term before
[11:05:12] <nmatsakis> jdm: look at libsyntax/ast_fold.rs
[11:05:16] <jdm> thanks
[11:05:34] <nmatsakis> jdm: or rather libsyntax/fold.rs
[11:08:08] *** Joins: jensnockert (jensnocker@moz-A6AA3085.wireless.lu.se)
[11:15:08] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[11:18:17] *** Quits: jensnockert (jensnocker@moz-A6AA3085.wireless.lu.se) (Input/output error)
[11:19:19] *** Joins: eddyb9 (eddy@37F72125.9065A63B.FCAAE698.IP)
[11:33:59] *** Joins: jensnock_ (jensnocker@moz-A6AA3085.wireless.lu.se)
[11:40:09] *** Quits: jensnock_ (jensnocker@moz-A6AA3085.wireless.lu.se) (Input/output error)
[12:09:45] *** flaper87|afk is now known as flaper87
[12:15:41] *** Joins: jensnockert (jensnocker@moz-A6AA3085.wireless.lu.se)
[12:21:27] *** Quits: jensnockert (jensnocker@moz-A6AA3085.wireless.lu.se) (Connection reset by peer)
[12:21:46] *** kimundi is now known as zz_kimundi
[12:21:48] *** Joins: jensnockert (jensnocker@moz-A6AA3085.wireless.lu.se)
[12:23:59] *** Quits: jensnockert (jensnocker@moz-A6AA3085.wireless.lu.se) (Input/output error)
[12:42:40] *** Quits: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com) (Ping timeout)
[12:57:21] *** zz_kimundi is now known as kimundi
[13:48:09] *** Joins: jensnockert (jensnocker@moz-C994F2B6.wireless.lu.se)
[13:57:21] *** Quits: jensnockert (jensnocker@moz-C994F2B6.wireless.lu.se) (Connection reset by peer)
[13:57:38] *** Joins: jensnockert (jensnocker@moz-C994F2B6.wireless.lu.se)
[14:02:57] *** Quits: jensnockert (jensnocker@moz-C994F2B6.wireless.lu.se) (Input/output error)
[14:54:36] *** Quits: nrc (nrc@DA4ABEAF.1DE10CA8.D8E68FF6.IP) (Ping timeout)
[14:58:31] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[14:58:31] *** ChanServ sets mode: +o pnkfelix
[15:00:52] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[15:02:30] *** Joins: yghannam (yghannam@moz-C5BCCF4E.lightspeed.austtx.sbcglobal.net)
[15:04:29] *** Quits: yghannam (yghannam@moz-C5BCCF4E.lightspeed.austtx.sbcglobal.net) (Ping timeout)
[15:17:02] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[15:24:10] *** flaper87 is now known as flaper87|afk
[15:25:20] <nmatsakis> pnkfelix: my rustc build with full lifetime parameter support is working now
[15:25:27] <pnkfelix> nmatsakis: ah great
[15:26:21] <pnkfelix> nmatsakis: that bug that was keeping RUST_LOG rustc libstd.rs from working was fixed by acrichto
[15:26:51] <pnkfelix> nmatsakis: so I'm now back to looking at why this 3u literal is not in the cx.node_types map
[15:27:35] <nmatsakis> pnkfelix: ah, right -- so were you able to grep for the messages that are emitted whenever we add a node to the map?
[15:27:45] <pnkfelix> I'm about to do that now
[15:27:46] <nmatsakis> pnkfelix: usually when I see a problem like this, I begin that way, because there are two possibilities:
[15:27:53] <nmatsakis> (1) the expr is never added to the fcx map
[15:28:00] <nmatsakis> (2) the type is never copied from the fcx map to the tcx map
[15:28:06] <nmatsakis> the latter occurs during the "writeback" phase
[15:28:11] <pnkfelix> ah, I was about to ask about that
[15:28:22] <nmatsakis> there are also messages when that occurs, so the next step is to grep for those :0
[15:28:49] <nmatsakis> I wish we had a way to label blocks with a region label
[15:28:54] <nmatsakis> Have to implement that sometime
[15:28:56] <pnkfelix> nmatsakis: maybe a subtask will be to do some of that iog indentation work you and I talked about.
[15:29:05] <pnkfelix> nmatsakis: we almost have that, right?
[15:29:17] <nmatsakis> depends on your def'n of "almost" I guess
[15:29:19] <pnkfelix> nmatsakis: we currently can only label loop/for stmts ?
[15:29:27] <nmatsakis> I think so
[15:34:21] <cmr> KSP has a bad habit of releasing updates at the worst times. How am I supposed to get work done!?
[15:44:02] <nmatsakis> I don't understand how it is that we decide when to abort compilation during type checking sometimes
[15:44:06] * nmatsakis grumbles
[15:44:10] *** Joins: jeffdb_ (jeff@moz-D13B6004.hsd1.ca.comcast.net)
[15:48:42] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[15:57:50] *** kimundi is now known as zz_kimundi
[15:58:32] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[15:58:32] *** ChanServ sets mode: +o pnkfelix
[16:01:14] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[16:14:48] *** Quits: km (quassel@moz-777F24DE.kevinmehall.com) (Ping timeout)
[16:15:35] *** flaper87|afk is now known as flaper87
[16:15:49] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[16:22:41] *** Joins: km (quassel@moz-777F24DE.kevinmehall.com)
[16:28:40] *** Quits: jdm (jdm@88F51059.F3BBB17D.144F44FA.IP) (Quit: Lost terminal)
[17:14:20] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[17:27:42] *** zz_kimundi is now known as kimundi
[17:36:10] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[17:36:10] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 141c353c2 to 14deeca5d: 02http://git.io/N3iJvQ
[17:36:10] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[17:36:15] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[17:36:15] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/SnpSlw
[17:36:15] <ghrust> 13rust/06auto 14e8f72c3 15Alex Crichton: Cache and buffer stdout per-task for printing...
[17:36:15] <ghrust> 13rust/06auto 14baeed88 15bors: auto merge of #10060 : alexcrichton/rust/cached-stdout, r=brson...
[17:36:15] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[17:39:07] *** flaper87 is now known as flaper87|afk
[17:49:30] *** Joins: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com)
[17:49:30] *** ChanServ sets mode: +ao pcwalton pcwalton
[17:50:17] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[17:57:48] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[18:06:20] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:06:20] *** ChanServ sets mode: +qo brson brson
[18:28:41] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[18:41:17] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[18:41:17] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/SnpSlw
[18:41:17] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[18:46:12] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[18:46:12] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/DqFcYw
[18:46:12] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[18:46:13] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[18:46:13] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/yvi94g
[18:46:13] <ghrust> 13rust/06auto 14568576b 15Seo Sanghyeon: Implement Clone trait for mutable unsafe pointers
[18:46:13] <ghrust> 13rust/06auto 14953e560 15bors: auto merge of #10066 : sanxiyn/rust/mut-ptr-clone, r=thestinger
[18:46:14] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[18:52:57] <acrichto> olsonjeffery: ping
[18:54:51] *** Joins: geoffhill (geoffhill@moz-244CF33A.amazon.com)
[19:07:13] <kimundi> acrichto: Yay, no more runtime aborts. The problem was that I introduced a alternate begin_unwind function that was still based on the body of begin_unwind a week ago
[19:07:31] <acrichto> kimundi: that's going to be removed right? We only want one unwind function I would imagine
[19:08:13] <kimundi> acrichto: Sure, the one you fixed should get thrown out :P (The one that uses unsafe pointers for strings)
[19:08:29] <acrichto> kimundi: yeah that's fine, we should only have one though
[19:08:36] <kimundi> acrichto: Need to change the fail langitems for that though, and I have no idea how to do that
[19:08:53] <acrichto> that'd require codegen changes sadly
[19:09:23] <kimundi> acrichto: Could you compare my new function to the old one here and look if I made any error that might not be caught by the testsuite? https://gist.github.com/Kimundi/f1a9d85404ffc0f070d7
[19:09:39] <kimundi> (both functions are in the gist)
[19:10:33] <acrichto> kimundi: looks fine to me, at the very least the old one should call the new one though
[19:11:02] <acrichto> kimundi: and I suppose printing on the other side can happen at a later time
[19:11:05] <kimundi> hm, you're right I can just make it a stub that allocates the string and calls the new one
[19:11:21] <acrichto> try to avoid the allocation, you can cast to &'static str b/c these are all in rodata
[19:11:26] <kimundi> Yeah, need to pass the linenumber etc through the unwinder too
[19:12:03] <kimundi> acrichto: Hm, does CString::new() ... .as_str() allocate?
[19:12:29] <acrichto> kimundi: no
[19:13:30] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[19:14:59] *** Quits: km (quassel@moz-777F24DE.kevinmehall.com) (Ping timeout)
[19:17:15] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[19:17:15] *** ChanServ sets mode: +o tjc
[19:22:06] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[19:22:09] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[19:22:10] *** ChanServ sets mode: +o tjc
[19:24:05] *** Joins: km (quassel@moz-777F24DE.kevinmehall.com)
[19:37:03] <cmr> tjc: ping
[19:37:12] <tjc> cmr: pong
[19:37:36] <cmr> tjc: working on 9003
[19:38:04] <cmr> I think I need to add the crate to be built at line 508 of rustpkg.rs (the Tests branch)
[19:38:12] <cmr> But I don't know how to get it, exactly...
[19:38:27] <cmr> It should be building main.rs and lib.rs if they exist with --test to rustc
[19:38:28] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[19:38:42] <cmr> And probably storing them as foomaintest and foolibtest
[19:39:03] <tjc> cmr: One sec, looking
[19:39:42] <tjc> cmr: Ah ok. Since we're getting rid of the "alternate crate root" option, I think that code will have to change more radically
[19:39:49] <cmr> Oh
[19:40:06] <tjc> cmr: since now we won't be able to predict just from file names which files contain tests, I think the Tests variant for WhatToBuild will just go away
[19:40:09] <tjc> hmm
[19:40:33] <cmr> Well, when saying `rustpkg test`, it still needs to pass a --test flag, and build test.rs
[19:40:39] <tjc> Sure, it's just...
[19:40:43] <cmr> (test.rs being the separate crate)
[19:41:04] <cmr> I havef probably looked at 1% of the code, though, and I don't really understand the structure, so I'll take your word ;)
[19:41:13] <tjc> don't necessarily take my word :-)
[19:41:16] <tjc> Let me read the issue again
[19:42:03] <kimundi> brson: I finished reworking my fail!-Any patch. I'm doing a final test run right now, and you can read about it in the last comment in https://github.com/mozilla/rust/pull/9967 :)
[19:42:17] <tjc> kimundi: I'm excited, this looks like great work :-0
[19:42:20] <tjc> :-) even
[19:42:45] *** Quits: km (quassel@moz-777F24DE.kevinmehall.com) (Ping timeout)
[19:42:52] <tjc> cmr: Okay, I had lost track of what we discussed in the meeting. You're right, there are still going to be test.rs crates
[19:43:06] <cmr> kimundi: what's the different from failing with an ~Any and a ~T? The ~T just gets wrapped into an ~Any?
[19:43:34] <tjc> cmr: But like you said, the Tests branch will (a) build all the test.rs crates and (b) also build all the mains and libs with --test
[19:43:39] *** Joins: km (quassel@moz-777F24DE.kevinmehall.com)
[19:44:26] <kimundi> cmr: Yeah. It basically emulates trait object coercion, and hopefully addresses brson's comment about not needing to cast to ~Any for fail! - though I might have misunderstood him on that one :)
[19:44:27] <cmr> tjc: I *think* I just need to add stuff to the PkgSrc with push_crate, but I don't know how to get the path to the things, or how to add rustc flags. I don't know if PkgSrc even has that information
[19:45:26] *** Quits: StarLight (StarLight@moz-9EB0C86E.dynamic.avangarddsl.ru) (Ping timeout)
[19:45:51] <cmr> tjc: Oh, and benching is going to take this same codepath, but pass --bench when actually running the executables.
[19:46:11] <tjc> cmr: well, really, pretenting that benchmarks don't exist, the Tests case is going to be the same as the Everything case now
[19:46:21] <tjc> that's why I thought at first that the Tests variant could just go away...
[19:46:27] <tjc> the flags are separate, let me remind myself of how that works
[19:47:04] <tjc> cmr: for how the flags work, see util::compile_input
[19:47:20] <cmr> So many args /o\
[19:47:22] <tjc> probably compile_input will take yet another flag (or alternately, you could add the flag to the BuildContext) saying "are we in test mode?"
[19:47:47] <tjc> and if we're in test mode, we would pass --test no matter what; not just if what is Test or Bench
[19:48:09] <tjc> also if you feel like refactoring that code so some of the args go in the context or something, feel free, that's not by design or anything :-)
[19:49:41] *** Joins: StarLight (StarLight@moz-36BD674D.dynamic.avangarddsl.ru)
[19:51:08] <cmr> tjc: thanks for the help!
[19:51:19] <tjc> cmr: Sure, thanks for working on this
[19:51:20] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[19:51:21] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/yvi94g
[19:51:21] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[19:51:23] <cmr> np
[19:51:38] <cmr> Every time I try to do a project in rust I hit more things to fix
[19:51:55] <cmr> Eventually I'll either finish a project or make rust perfect ;)
[19:52:59] <strcat> tjc: http://ix.io/8KI yet another failed attempt at fixing this...
[19:53:00] * strcat cries
[19:53:54] <strcat> generic dtor type bounds still don't work within a crate, and cross-crate ones without bounds are now broken too \o/
[19:53:59] * eddyb9 gives strcat some tissues and coffee
[19:54:39] <strcat> I was thinking maybe the data I need doesn't get output because it's done lazily
[19:54:45] <strcat> and dtors aren't explicit calls in the AST
[19:55:03] <strcat> but manually inserting it didn't change anything ;\
[19:55:33] <tjc> strcat: it has to get worse before it gets better!
[19:55:39] <strcat> the Drop trait does get output properly in metadata
[19:55:46] <strcat> but the current dtor code doesn't call the Drop trait
[19:55:50] <tjc> but the destructor bodies don't get output in metadata?
[19:55:57] <strcat> tjc: they do, with the Drop trait
[19:56:04] <strcat> but that's not currently how calls are generated to them
[19:56:11] <tjc> it sounds like the problem is that some code knows about the new Drop trait and other code is still working off the assumption that destructors are special
[19:56:17] <eddyb9> maybe the dtors are really broken
[19:56:19] <strcat> tjc: yep
[19:56:22] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[19:56:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/yZTVbg
[19:56:23] <ghrust> 13rust/06auto 14f04886b 15Seo Sanghyeon: Allow taking address of bottom
[19:56:23] <ghrust> 13rust/06auto 14dcdcd30 15bors: auto merge of #10067 : sanxiyn/rust/addr-of-bot, r=thestinger...
[19:56:23] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[19:56:24] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[19:56:24] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/cgdz0A
[19:56:24] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[19:56:29] <strcat> tjc: the problem is that I can't see a way to make this code use the regular path
[19:56:37] <strcat> because there is no AST calling this method
[19:56:39] <eddyb9> 0 commits? what?
[19:56:45] <tjc> strcat: Right, well, destructors are still a little bit special because they're called implicitly
[19:57:12] <strcat> I'm basically trying to switch it to doing what the trans_impl/trans_method stuff does and failing ;p
[19:57:18] <brson> kimundi: awesome! thank you
[19:57:19] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[19:57:26] <strcat> I think what I have is correct-ish...
[19:57:38] <eddyb9> can they be implemented by AST translation at an earlier level?
[19:58:08] <strcat> I think that would involve a major redesign of how this stuff works
[19:58:09] <kimundi> brson: I hope the changes to ~Any handling on task failure are in your intention :)
[19:58:10] <tjc> strcat: it seems like you should be able to take out all the special cases for destructors anyway, because now the special case is "is this a method of the Drop trait?" and not "is this a destructor?"
[19:58:12] <eddyb9> *transformation
[19:58:16] <tjc> so, taking out things like ii_dtor â€¦ (if you haven't already)
[19:58:26] <tjc> and then by seeing what fails to compile because it uses that, you can find the old code to update
[19:58:45] <strcat> tjc: the hard part is that trans is working with the scraps typeck left it
[19:58:54] <strcat> and typeck doesn't care about implicit dtor calls ;p
[19:59:12] <strcat> so maybe I'll just try inserting stuff into those tables manually
[19:59:14] <tjc> strcat: well, you can change typeck, too :-)
[19:59:22] <strcat> typeck is weird though
[19:59:29] <strcat> it's generating those tables while checking coherence
[19:59:32] * strcat doesn't get it
[19:59:35] <tjc> if it helps trans to make typeck output more information, then it's a good thing to do, even if you have to add fields to the type context or whatever
[19:59:58] <strcat> tjc: I'm tempted to just shove everything into destructor_for_type
[20:00:02] <strcat> the impl, the vtables
[20:00:04] <tjc> Yeah, typeck has changed since I last looked at it to a greater extent than trans has, so I know less about that
[20:00:07] <tjc> hmm
[20:00:22] <tjc> it seems like the code should be able to be more general than that, though
[20:00:30] <strcat> yeah, it does ;p
[20:00:32] <tjc> Like, the thing that needs to be special is finding the impl of Drop for a type
[20:00:45] <tjc> and that's special because you're looking up a certain magic language item
[20:00:51] <tjc> but once you have that, it's like any other method...
[20:01:01] <strcat> tjc: destructor_for_type finds the method
[20:01:14] <strcat> but then looking up that method finds nothing
[20:01:15] * strcat shrugs
[20:01:19] <tjc> ah, ok
[20:01:29] <tjc> Yeah, sounds kind of like a typeck issue, then
[20:01:41] * strcat tries something weird
[20:01:52] <tjc> But, hmm, typeck has to typecheck the destructor, so it must know about destructors *somewhere*
[20:02:05] <strcat> tjc: yeah, it finds the destructor def id
[20:02:18] <strcat>                 ty::ty_struct(type_def_id, _) => {
[20:02:20] <strcat>                     tcx.destructor_for_type.insert(type_def_id, method_def_id);
[20:02:22] <strcat>                     tcx.destructors.insert(method_def_id);
[20:02:31] <strcat> and I have that data available
[20:02:40] <tjc> That seems wrong, though
[20:02:47] <strcat> hm?
[20:02:54] <tjc> as in, I mean, why does it have a special case for ty_struct?
[20:03:06] <tjc> Hmm, no, maybe I'm confused
[20:03:07] <strcat> tjc: custom destructors only work on structs atm
[20:03:13] <tjc> Ah ok
[20:03:16] <tjc> Then I guess that's fine
[20:03:42] <strcat> the comment seems somewhat out of date ;p
[20:03:43] <strcat>                     // Destructors only work on nominal types.
[20:04:16] <strcat> enums are still nominal types, aren't they?
[20:04:50] <strcat> although I guess it means records didn't have dtors
[20:06:39] <eddyb9> why no dtors for enums? that doesn't seem fair
[20:06:48] <strcat> I have a bug open proposing we add it
[20:06:53] <strcat> but I can see why no one has.
[20:07:08] <eddyb9> strcat: you can be our hero :P
[20:07:14] <strcat> changing the representation of a primitive type is easy peasy compared to dealing with xcrate stuff
[20:07:38] <strcat> well sure, if I ever figure out how destructors work ;p
[20:07:41] <kimundi> On thing I wondered yesterday: WHat happens if you pattern - destructure a type with a destructor?
[20:07:51] <benh> You're not allowed
[20:08:00] <strcat> you can by-ref
[20:08:09] <benh> Well, you just can't move out of something with a destructor, yeah
[20:08:49] <kimundi> SO the compiler forbids destructive destructuring for types with constructors? Seems reasonable. :)
[20:09:05] <eddyb9> *destructors?
[20:09:11] <eddyb9> (deja vu)
[20:09:17] <kimundi> err, yes
[20:10:13] * strcat is probably going to give up and do something easy like passing large parameters more efficiently..
[20:10:24] <strcat> task '<unnamed>' failed at 'No def'n found for syntax::ast::DefId{crate: 0, node: 119721} in tcx.methods', /home/strcat/projects/rust/src/librustc/middle/ty.rs:3692
[20:10:26] <strcat> :s
[20:11:35] <eddyb9> kimundi: that seems a bit restrictive, depending on how widespread the use of dtors is. like, if you have a struct without a dtor inside a Rc, does that limit your pattern-matching capabilities?
[20:12:05] <strcat> you can't pattern match on Rc anyway
[20:12:08] <strcat> the field is priv
[20:12:14] <kimundi> eddyb9: No idea. I'm the one who asked about that, not the one who gave the answer ;)
[20:12:24] <eddyb9> riight
[20:13:28] <eddyb9> strcat: but you can get the field and match/destructure that, right?
[20:13:59] *** Quits: benh (ben@moz-4A0366D2.org) (Ping timeout)
[20:14:05] <eddyb9> how would it work? a reference with a 'self lifetime?
[20:17:21] *** Joins: benh (ben@moz-4A0366D2.org)
[20:20:12] <strcat> eddyb9: you can match by-reference
[20:27:04] <nmatsakis> strcat: you were asking questions about cross-crate inlining yesterday...did you figure it out?
[20:27:37] <strcat> nmatsakis: nope! :)
[20:27:42] <strcat> nmatsakis: trying to make generic dtors work
[20:28:19] <strcat> and after that, I'll look at fixing xcrate inline for dtors
[20:28:29] <nmatsakis> strcat: what is the problem you're having? do you understand the high-level idea of what's going on?
[20:28:41] <strcat> nmatsakis: well, I know why it's broken
[20:29:04] <strcat> nmatsakis: it doesn't use the regular code path, instead it uses base::get_res_dtor and it calls monomorphic_fn directly without passing vtables
[20:29:20] <strcat> so I've been banging my head against get_res_dtor
[20:29:39] <nmatsakis> strcat: ok, well, if you have questions about xcrate I'm probably the one to ping :)
[20:30:44] <strcat> nmatsakis: the problem actually starts before xcrate atm.
[20:30:48] <strcat> fails to compile libstd
[20:30:56] <strcat> nmatsakis: https://gist.github.com/thestinger/7161359 hits that 'trait not found' path
[20:31:21] <strcat> 'did' is the def_id for the destructor from the tcx.destructor_for_type table
[20:31:24] <strcat> the method
[20:33:36] <strcat> nmatsakis: do we generate this metadata on demand based on actual calls? I don't really get why it would be there
[20:34:25] <nmatsakis> strcat: which metadata, ty::trait_of_method()?
[20:34:40] <strcat> nmatsakis: yeah
[20:35:08] <strcat> which is just tcx.methods
[20:35:27] <nmatsakis> strcat: I believe that is populated in typeck
[20:36:27] <nmatsakis> strcat: specifically the collect phase, I imagine
[20:36:40] <strcat> nmatsakis: yeah I see the insert calls and don't see any branches related to dtors anywhere
[20:36:45] <strcat> so I expect it to be there
[20:36:48] <strcat> but it's not :(
[20:37:09] <nmatsakis> strcat: my guess would be that did is not the did of the method
[20:37:41] <nmatsakis> strcat: but I don't know that get_res_dtor path much at all
[20:37:51] <nmatsakis> strcat: poking around my guess looks to have been wrong :)
[20:38:12] <strcat> nmatsakis: destructor_for_type definitely seems like it should correctly map the type to the dtor method
[20:40:39] <nmatsakis> strcat: I guess if I were you I'd begin by inserting info! in the relevant spots and running with RUST_LOG so as to see exactly which dids are going in the table, etc
[20:40:53] <nmatsakis> strcat: (and compare against --pretty expanded,identified)
[20:44:55] <kimundi> brson: Hm, make check tells me I have cause a codegen regression of 4.26% for "iterate-over-array.rs" - I'm not sure how to deal with that. 
[20:45:31] <kimundi> brson: I guess that happens becuase array indexing can fail, and I have touched begin_unwind?
[20:46:04] <kimundi> (Is there some way for me to actually compare the codegen before/after ?)
[20:52:21] <Luqman> nmatsakis: did you get a chance to look at my varidic ffi pull?
[20:53:04] <nmatsakis> Luqman: I read through about 50% so far, it looked good
[20:53:24] <Luqman> cool, thanks
[20:53:36] <Luqman> i'll add some tests later when i have time
[20:53:44] <nmatsakis> Luqman: I have to devote a bit more time to reading the trans paths more carefully etc, I'll try to find that time this WE
[20:53:51] <strcat> kimundi: if you've made the call site code larger, perf will regress
[20:54:33] <nmatsakis> Luqman: one thing I was wondering (but didn't yet satisfactory my curiosity about) was whether you supported types like `extern "C" fn(int, ...)`
[20:55:11] <kimundi> strcat: Right, but I have no idea if/how I did that, or what that even means :)
[20:56:04] <kimundi> strcat: If you have a minute to look at it, here'S the diff: https://github.com/mozilla/rust/pull/9967/files#diff-55960353b41f38f8e96fe82c4e3fc4b7L472
[20:56:11] <strcat> most stuff in the stdlib is slow anyway ;p
[20:56:14] <Luqman> nmatsakis: hmmm, i don't think it does
[20:56:15] <strcat> the language is fast...
[20:56:59] <Luqman> nmatsakis: yep, `expected type, found token DOTDOTDOT`
[20:57:19] <eddyb9> so no printf?
[20:58:02] <eddyb9> (I guess you don't need type annotations as long as you're careful with what you send)
[20:58:13] <kimundi> eddyb9: Luqman's patch is exactly about allowing such calls, he just forgot about function pointers. :)
[20:58:21] <Luqman> nmatsakis: i guess i'll fix that later as well
[20:59:00] <eddyb9> kimundi: aah, ok
[20:59:23] *** Quits: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com) (Quit: .)
[20:59:30] <brson> kimundi: you can compile with -S --emit-llvm before and after to compare what the code gen looks like
[20:59:37] <eddyb9> kimundi: I thought he allowed only (...)
[21:00:24] <Luqman> eddyb9: nope i fixed that, you must have at least one named paramter
[21:00:44] <pcmattman> yay!
[21:00:49] *** Joins: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com)
[21:00:49] *** ChanServ sets mode: +ao pcwalton pcwalton
[21:00:53] <nmatsakis> Luqman: ok, just added a comment regarding one other thing that needs fixing
[21:01:26] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[21:01:27] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/yZTVbg
[21:01:27] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[21:01:56] *** Quits: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com) (Quit: pcwalton)
[21:02:07] *** Joins: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com)
[21:02:07] *** ChanServ sets mode: +ao pcwalton pcwalton
[21:02:32] <nmatsakis> Luqman: otherwise it looks ok, I'll wait till you rebase and add tests, and try to think of weird border cases to include for the tests :)
[21:02:38] <nmatsakis> Luqman: nic work
[21:06:22] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[21:06:22] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/uzaHww
[21:06:22] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[21:06:28] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[21:06:28] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/P4WNJg
[21:06:28] <ghrust> 13rust/06auto 14eb68011 15Marvin LÃ¶bel: Allow fail messages to be caught, and introduce the Any trait...
[21:06:28] <ghrust> 13rust/06auto 14a4063b3 15bors: auto merge of #9967 : Kimundi/rust/fail_cause_two, r=brson...
[21:06:28] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[21:07:49] <eddyb9> I suggest using notices, if supported, all this join/part spam is annoying
[21:08:15] <eddyb9> and what's causing the 0 commits message?
[21:08:26] <strcat> github is dumb
[21:08:53] <strcat> at least their irc bot is ;p
[21:09:04] <eddyb9> yes, but what triggers the dumb behavior?
[21:09:06] <benh> Maybe we should teach github how to talk to rusti instead so rusti can announe commits :)
[21:09:23] <kimundi> eddyb9: It's githubs bot, it does the join/part to not waste server resources on open connections, and the 0 commits message is because autos HEAD got reset
[21:09:51] <eddyb9> aah
[21:09:59] <strcat> it also considers it to be 0 commits when it sets auto to some set of commits that are already in the repository
[21:10:09] <kimundi> benh: rusti needs to migrate away from strcat's laptop first ;)
[21:10:13] <strcat> (retries)
[21:10:26] <strcat> kimundi: but I'm fond of peeking at the queries :(
[21:10:29] * strcat hides
[21:10:51] <eddyb9> can't bors wait until it has commits to add, then push?
[21:11:18] <strcat> if it has to do more API queries, more will go wrong - github is a fragile creature
[21:11:32] <strcat> and bors was hitting API limits when we had ~50 open PRs
[21:11:47] <eddyb9> :/
[21:12:08] <eddyb9> you can always bring notifico in here, and see how it fares
[21:12:41] <benh> (... or just send the github bot do an almost empty channel where rusti resides to filter and relay to here...)
[21:12:49] <benh> (or another throwaway bot)
[21:12:51] <tjc> eddyb9: your IRC client can suppressed printing joins and parts
[21:12:57] <tjc> or if it can't, use one that does :-)
[21:14:34] <pcmattman> not breaking what currently works is a plus, for the small cost of a header and tail on each notification :)
[21:16:37] *** Quits: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com) (Quit: pcwalton)
[21:16:55] <strcat> nmatsakis: so I have no idea where that def id comes from :)
[21:17:07] <strcat> the method is marked as 35 in the pretty printing
[21:17:15] <strcat> the id searched for is 36
[21:18:01] <strcat> there is no 36... in the output
[21:21:09] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: zzzzzzzzzz)
[21:26:19] *** Joins: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com)
[21:26:19] *** ChanServ sets mode: +ao pcwalton pcwalton
[21:29:17] *** Quits: jyyou (jyyou@moz-47B052FA.cs.nctu.edu.tw) (Ping timeout)
[21:29:20] <acrichto> brson: ping
[21:30:00] <nmatsakis> strcat: th epretty printer doesn't print all ids,
[21:30:12] <nmatsakis> strcat:  usually I just look for ids in the vicinity and then I have to guess / read the visitor code
[21:30:21] <nmatsakis> strcat: since the ids are assignd in the order that they are visited :)
[21:30:28] <strcat> ah then it's probably right
[21:31:02] <brson> acrichto: pong
[21:31:15] <acrichto> brson: got a sec to talk about homing missiles?
[21:31:33] <brson> acrichto: yes, I do have a sec to talk about homing missiles
[21:31:40] *** Joins: jyyou (jyyou@moz-47B052FA.cs.nctu.edu.tw)
[21:31:48] <acrichto> brson: so I'm worried about pinning a task to a scheduler after I/O finishees
[21:31:55] <acrichto> that's why there's a little dance to swap out the homes
[21:32:04] <acrichto> if you were AnySched before I/O, then you should be AnySched after I/O
[21:32:23] <acrichto> and then all the business with old and task.is_homed() is just trying to prevent creating unnecessary handles
[21:34:59] <brson> acrichto: don't fully understand what you are saying. if there wasn't a dance at all then you would be guaranteed to have the same home after I/O
[21:35:27] <acrichto> brson: but during I/O you may change the home b/c you must be flagged as pinned to the current scheduler
[21:36:13] <acrichto> brson: actually hm, perhaps you don't even need to change the task's home during I/o
[21:36:21] <brson> acrichto: when during I/O would the scheduler actually decide to send you to the wrong scheduler?
[21:36:30] <acrichto> I was worried about work stealing
[21:36:40] <acrichto> but looking at it I don't think you're ever on the queue
[21:36:42] <brson> afaik I/O is always: context switch, do I/O, context switch
[21:36:46] <acrichto> you're always resumed immediately
[21:36:59] <acrichto> hm this would simplify things greatly
[21:37:08] <brson> that's what I believe, yes. Maybe there's some asserts we can add to guarantee that
[21:38:24] <acrichto> brson: hm there's one case where the home may change
[21:38:27] *** Joins: tjc (tjc@moz-92ECC6AC.danastreet.live555.com)
[21:38:27] *** ChanServ sets mode: +o tjc
[21:38:35] <acrichto> if a task is pinned to a scheduler, but if its I/O scheduler is somewhere else
[21:38:40] <acrichto> is that even possible?
[21:38:50] <brson> yes, that's possible
[21:38:50] <acrichto> it seems like it isn't...
[21:38:53] <acrichto> aww
[21:39:10] <acrichto> so there'll have to be a little dance if you were originally pinned somewhere else
[21:39:26] * acrichto goes and runs some tests
[21:39:27] <brson> i don't think so, after I/O you just have to see if the task is homed
[21:39:42] <brson> then send it back to resume the user's code
[21:40:05] <acrichto> brson: but you can't get the I/O scheduler to run the task unless the I/O scheduler thinks that the task is either homed to it or not homed anywhere
[21:40:17] <brson> acrichto: ah
[21:40:22] <brson> acrichto: you could if the message was different
[21:40:34] <brson> RunSomeIo(Task)
[21:40:47] <acrichto> RunOnce(~Task) ?
[21:42:21] <brson> sure
[21:46:08] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[21:46:26] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[21:46:26] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14a4063b3 to 14dcdcd30: 02http://git.io/N3iJvQ
[21:46:26] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[21:46:27] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[21:46:27] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/mPWmSQ
[21:46:27] <ghrust> 13rust/06auto 14bfbf6b2 15Brian Anderson: Remove ancient emacs mode lines from test cases...
[21:46:27] <ghrust> 13rust/06auto 144757494 15bors: auto merge of #10072 : brson/rust/modelines, r=thestinger...
[21:46:27] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[21:47:04] *** Joins: strcat1 (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[21:47:07] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Connection reset by peer)
[21:47:32] *** strcat1 is now known as strcat
[21:47:45] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[21:48:07] *** Joins: doomlord_ (servitor@moz-3F3192E5.range86-184.btcentralplus.com)
[21:56:58] <olsonjeffery> acrichto: a belated pong
[21:57:04] <olsonjeffery> i see you've been busy. golf claps.
[21:57:25] <acrichto> olsonjeffery: :D, I was curious about what you think about removing the io::file traits
[21:57:32] <acrichto> and making them all direct impls on Path
[21:58:31] <acrichto> I'm trying to reduce the amount of friction to using io::file, and I'm thinking of removing open_reader/open_writer in favor of open/create (implied access/mode), and then merging all the traits into one impl or having only one trait  instead
[21:59:06] <olsonjeffery> always that tension between "easy for users" vs "leverage the power of the type system", heh
[21:59:35] <olsonjeffery> re: path.. im not sure.. that implies some leakage into std, which i guess we're ok with, given the recent trajectory?
[21:59:37] <acrichto> It didn't really seem like the traits were going to realistically be implemented for anything other than Path
[21:59:50] <acrichto> well I want to keep the impl in io::file
[22:00:00] <acrichto> the actual code itself that is
[22:00:05] * olsonjeffery nods
[22:00:14] <acrichto> and then https://github.com/mozilla/rust/issues/10071 struck :(
[22:00:34] <olsonjeffery> heh, yeah.
[22:01:06] <olsonjeffery> re: removing open_reader/writer .. not sure what to say, here.
[22:01:10] <olsonjeffery> access control isn't important?
[22:01:21] <acrichto> well you'd certainly still have access to it
[22:01:23] <olsonjeffery> FileReader/Writer, etc...
[22:01:33] <acrichto> open_stream would still be a thing along with file::open_stream
[22:01:53] <olsonjeffery> whats happening with those methods, though, is they're surfacing the open(2) time constraints on access
[22:01:54] <acrichto> although it's true that FileReader/Writer would have fixed modes at that point...
[22:02:08] <olsonjeffery> you can't transition read/write modes with an open fd
[22:02:38] <olsonjeffery> .net, as a shortcoming of the typesystem, can easily allow you to open a file read-only and get a read/write stream object which will happily throw
[22:02:48] <olsonjeffery> we kinda sorta allow this via open_stream, as well
[22:03:14] <olsonjeffery> but in general im happy with how the reader/writer divide turned out. are users complaining?
[22:03:23] <acrichto> maybe it's just me :P
[22:03:31] <acrichto> I fount it annoying to import so much just to opoen a file
[22:03:39] <olsonjeffery> that's valid
[22:03:41] <acrichto> you've got to import the mode and the file
[22:03:48] <acrichto> when most of the time I just want to import io::file
[22:03:51] <cmr> They should be in the prelude.
[22:04:03] <acrichto> modules shouldn't be in the prelude
[22:04:14] <olsonjeffery> yet we discourage wild card import!
[22:04:15] <acrichto> and I don't think modes belong in the prelude either
[22:04:23] <cmr> Why not?
[22:04:26] <acrichto> globs are scary :(
[22:04:39] <acrichto> they're too I/O specific, prelude things are kinda "the whole language needs this"
[22:04:42] <dbaupp> acrichto: work-around for #10071: https://github.com/mozilla/rust/issues/7607#issuecomment-21474969
[22:04:46] <olsonjeffery> this seems to be a common pattern: ooo shiny powerful type system oo linear types LETS TAKE IT TO THE MAX!!!!!11
[22:04:52] <olsonjeffery> then we walk it back :)
[22:05:03] <acrichto> dbaupp: you are the best
[22:05:20] <dbaupp> acrichto: no, nmatsakis is the best
[22:05:30] <acrichto> olsonjeffery: hm, well perhaps we could leave open_reader/open_writer
[22:05:34] <acrichto> to be able to specify modes
[22:05:46] *** Quits: tjc (tjc@moz-92ECC6AC.danastreet.live555.com) (Quit: zzzzzzzzzz)
[22:05:47] <dbaupp> acrichto: (fwiw, I found that by search for "found value name used as a type" from your error message ;) )
[22:05:49] <acrichto> but I'd still like to see something like open/create for returning readers/writers in a simple fashion
[22:05:56] <olsonjeffery> the ReadOnly, WriteOnly, ReadWrite is provided in those case..
[22:05:59] <acrichto> dbaupp: haha, I should probably have done that
[22:06:04] <olsonjeffery> oh wait, FileMode..
[22:06:13] <olsonjeffery> yeah. maybe it should assume Open ?
[22:06:26] <acrichto> olsonjeffery: if we had open() as a function on Path, then you don't even need to import anything to open a file, it's just "path.open()"
[22:06:32] <olsonjeffery> also: the weird entanglement of mode/access in POSIX open(2) :/
[22:06:46] <olsonjeffery> what would that return?
[22:07:42] <acrichto> olsonjeffery: https://github.com/alexcrichton/rust/commit/f317525e8d64a55e490d6853f269775681a8d5ad
[22:07:51] <acrichto> or https://github.com/alexcrichton/rust/blob/f317525e8d64a55e490d6853f269775681a8d5ad/src/libstd/rt/io/file.rs
[22:07:57] <acrichto> depending on how much diff you want to look at
[22:07:58] <olsonjeffery> anyways, just wanted to say: you're a real mensch, acrichto. doing lots of good work in the runtime.
[22:08:07] <dbaupp> acrichto: is the benchmark listed in https://github.com/mozilla/rust/pull/10070 before https://github.com/mozilla/rust/pull/10060 ?
[22:08:14] <olsonjeffery> im pretty much just working on my portfolio these days, heh. no time for fun stuff :(
[22:08:19] <acrichto> dbaupp: yes, thankfully :)
[22:08:22] <dbaupp> acrichto: (i.e. the .3 seconds will be even lower if you include the changes from #10060)
[22:08:26] <dbaupp> acrichto: ah, cool :)
[22:08:29] <acrichto> olsonjeffery: :(, but soon hopefully!
[22:11:00] <acrichto> brson: if this works, then it looks much cleaner
[22:11:11] <olsonjeffery> i know someone who knows someone at mofo, keeping my fingers crossed
[22:11:34] <olsonjeffery> but needing to land a few demos, first.
[22:11:44] <olsonjeffery> anyways. back to #rust-internals.
[22:15:04] <kimundi> brson: Hm, My PR failed on bors on a test that does not fail locally, and I'm still having the codegen issue...
[22:18:52] <brson> kimundi: i didn't realize that we had the metric regression testing on! I don't even know how it works...
[22:19:33] <kimundi> Ha, neither do I! (Well, I know it compares cc and rs code) ;)
[22:19:37] <brson> kimundi: linked failure has a race condition. if that failing test is one that you added I'd just #[ignore] it
[22:20:03] <kimundi> brson: Okay, will put a ignore there, it's about linked failure
[22:20:04] <brson> ah, those are codegen tests, not benchmarks
[22:20:13] <brson> ok, i don't know how the codegen tests work either. ..
[22:20:29] <strcat> codegen tests are based on bloat and not performance
[22:20:44] <strcat> graydon added them to stop us from regressing in terms of compile-time and code size
[22:20:58] <strcat> brson: we still don't have a 32-bit nopt mac bot
[22:21:15] <strcat> we were building code that was too big to link, it might work now
[22:21:16] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[22:21:16] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 144757494 to 14dcdcd30: 02http://git.io/N3iJvQ
[22:21:16] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[22:21:20] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[22:21:20] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/xdnkWg
[22:21:20] <ghrust> 13rust/06auto 1470fa4e7 15Heather: support for GNU configure syntax
[22:21:20] <ghrust> 13rust/06auto 14a0681e9 15Heather: Correct prefix / CFG_PREFIX work in configure / install.mk
[22:21:20] <ghrust> 13rust/06auto 14782cf04 15Heather: support for GNU configure syntax corrections: patch from brson
[22:21:22] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[22:21:24] <acrichto> oh I checked the other day, it works now
[22:25:16] <brson> strcat: mac32-nopt bots are back on
[22:25:28] <strcat> ah
[22:25:36] <brson> just now...
[22:25:49] <strcat> oh :)
[22:25:49] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[22:26:04] <dbaupp> there's an issue to closeit if it works
[22:26:10] * dbaupp searches
[22:27:37] <dbaupp> https://github.com/mozilla/rust/issues/7206 but that's not the one I was thinking of
[22:31:51] <Luqman> nmatsakis: oh right something else i thought of re variadic functions. for printf you can't actually pass a float. it gets auto promoted to a double.
[22:32:15] <Luqman> so right now printf("%f", 40.0f32) prints 0.000
[22:32:30] <strcat> and reads potentially undef memory ;]
[22:32:31] <Luqman> should we also do the auto promotion?
[22:38:56] <strcat> Luqman: can you pass a float to any variadic function in C without that auto-promotion?
[22:39:24] <Luqman> i don't think so
[22:40:17] <strcat> ah you can't use char, signed char, unsigned char, short, unsigned short, _Bool and float
[22:40:38] <strcat> Luqman: I think it makes sense to implement those auto-promotion rules (to int and double)
[22:41:21] <strcat> Luqman: or better, forbid them
[22:41:24] <strcat> and force an explicit cast
[22:42:14] <kimundi> strcat / brson: comparing the llvm between the test code as generated by the current arch git nightly and my stage2, it seems the only difference is that the stage2 one contains an addition noreturn attribute
[22:42:53] <strcat> foo.c:4:5: warning: implicit conversion from â€˜floatâ€™ to â€˜doubleâ€™ when passing argument to function [-Wdouble-promotion]
[22:42:56] <strcat>      printf("%f", 5.5f);
[22:42:58] <strcat>      ^
[22:44:38] <kimundi> If all the codegen test does is compare the llvm IR output, then that might explain the difference...
[22:45:18] <dbaupp> kimundi: it does a ratio of Rust IR to Clang IR and doesn't allow it to regress by more than x% (possibly x == 0, I can't remember)
[22:46:02] <kimundi> dbaupp: Right, but the only difference I can see seems to be an llvm attribute, not actual machine instructions
[22:46:36] <kimundi> If anyone else wants to compare: https://gist.github.com/Kimundi/aab9eb32608e2604a73b
[22:47:41] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[22:47:52] <dbaupp> kimundi: I think it's a `wc -l` style count, so if it's not allowed to regress at all, then adding any lines at all will make it unhappy.
[22:48:19] <dbaupp> kimundi: also, did your PR add the noreturn... wasn't that one of strcat's ones?
[22:48:30] <dbaupp> https://github.com/mozilla/rust/pull/10042
[22:51:02] <kimundi> dbaupp: As far as I can tell the only difference is 1. A noreturn attribute 2. Metadata got 11 bytes longer
[22:51:17] <kimundi> dbaupp: Both seem reasonable and expected :P
[22:51:38] <kimundi> brson: ^
[22:52:48] *** jack is now known as jack|travel
[22:53:23] <brson> kimundi: which function?
[22:53:48] <kimundi> brson: declare void @"_ZN8unstable4lang17fail_bounds_check19h167e28f443deb682aD11v0.9$x2dpreE"({}* noalias sret, { i64, %tydesc*, i8*, i8*, i8 }*, i8*, i64, i64, i64) #6
[22:55:20] <kimundi> dbaupp: My code is rebased on the most current git HEAD
[22:55:34] <brson> kimundi: I think the test driver is comparing the size of the 'test' function: https://gist.github.com/Kimundi/aab9eb32608e2604a73b#file-after-L281 and https://gist.github.com/Kimundi/aab9eb32608e2604a73b#file-prior-L281
[22:56:16] <dbaupp> kimundi: ok (is the failure local or on the bots?)
[22:56:21] <brson> oh, the test function is pretty much the same
[22:58:07] <kimundi> dbaupp: The failure is local, the bots never came that far because of a linked failure test failure
[22:58:13] <brson> kimundi: this seems like nbd
[22:58:30] <brson> although i don't really understand *what* regression is being reported
[22:58:36] <brson> it doesn't *look* like a regression
[22:58:57] <kimundi> brson: Neither do I. The more I'm learning right now about this thing, the more I'm confused about what's happening
[22:59:37] <dbaupp> kimundi: if it's local it's probably just because you haven't run the codegen tests recently enough (I've had problems were codegen has gradually regressed unrelated to my patches, but since I had not built for ages, the tests were comparing n weeks ago with the current build.)
[23:00:18] <kimundi> dbaupp: Oh, I though they where somehow synced with the repo
[23:01:36] <dbaupp> kimundi: hm, maybe... but I don't think so
[23:08:04] <kimundi> brson: In the meantime, could you give me a new r+ on https://github.com/mozilla/rust/pull/9967 ? I added a ignore attribute for the linked failure test, and if the codegen test is a local problem then it might just pass
[23:15:27] <acrichto> kimundi: wait can you not merge that just yet?
[23:15:38] <acrichto> looking at begin_unwind it assumes that it always has 'file', which is not true in the case of stack overflow
[23:16:02] <kimundi> acrichto: To late, but I can revert the one line change I made if you want :P
[23:16:03] <acrichto> kimundi: if you compile and run "fn main() { main() }" you'll see what I"m talking about
[23:16:28] <acrichto> it's more than just one change, the none-ness of the file needs to get propagated
[23:16:57] <kimundi> Hum, did the prior code do that?
[23:17:01] <acrichto> yes
[23:17:14] <acrichto> kimundi: oh wait nevermind
[23:17:26] <acrichto> stack exhuastion doesn't unwind
[23:17:30] <acrichto> I was remembering wrong :(
[23:17:32] <acrichto> carry on!
[23:18:15] <kimundi> heh, okay :)
[23:19:15] <dbaupp> rusti: main()
[23:19:15] -rusti- task '<unnamed>' has overflowed its stack
[23:19:16] -rusti- application terminated abnormally with signal 4 (Illegal instruction)
[23:19:25] <kimundi> haha
[23:19:30] <dbaupp> neat, a nice error message.
[23:19:39] <kimundi> oh wait, that's te be expected
[23:19:39] * dbaupp hugs acrichto
[23:19:43] <acrichto> <3
[23:20:13] * dbaupp wonders if the main task should be called `<main>` (or something), by default
[23:20:48] <acrichto> rusti: use std::task; fn foo() { foo() } let mut t = task::task(); t.name(~"foo"); t.spawn(foo)
[23:20:49] -rusti- ()
[23:20:49] -rusti- task 'foo' has overflowed its stack
[23:20:49] -rusti- application terminated abnormally with signal 4 (Illegal instruction)
[23:21:26] <kimundi> rusti: use std::task; fn foo() { foo() } let mut t = task::task(); t.name("foo"); t.spawn(foo)
[23:21:27] -rusti- task 'foo' has overflowed its stack
[23:21:27] -rusti- application terminated abnormally with signal 4 (Illegal instruction)
[23:21:40] <brson> dbaupp: yeah, that would be nice
[23:22:50] <acrichto> brson: I have updated the missiles, still testing locally to make sure everything passes but stage1-std and stage1-extra both passed just fine
[23:25:21] <dbaupp> https://github.com/mozilla/rust/issues/10073
[23:26:10] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[23:26:10] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14f35de11 to 14dcdcd30: 02http://git.io/N3iJvQ
[23:26:10] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[23:26:11] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[23:26:12] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/MOY9Wg
[23:26:12] <ghrust> 13rust/06auto 1491b56f6 15Marvin LÃ¶bel: Allow fail messages to be caught, and introduce the Any trait...
[23:26:12] <ghrust> 13rust/06auto 14d0889fd 15bors: auto merge of #9967 : Kimundi/rust/fail_cause_two, r=brson...
[23:26:12] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[23:29:12] <brson> can anybody guess why the tenXer service hook has been activated again on GitHub?
[23:29:43] <brson> it's active  for servo too :-/
[23:35:54] <acrichto> ...?
[23:35:57] <acrichto> what is tenXer even?
[23:37:27] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[23:39:59] <acrichto> ok there's a std::os tests which uses the 'diff' program to figure out if two files have the same contents
[23:40:03] <acrichto> what
[23:42:00] *** Joins: McPherrin (mimcpher@moz-345B5EBA.csclub.uwaterloo.ca)
[23:45:08] <acrichto> brson: are you ok if I merge ReaderUtil into Reader ?
[23:45:25] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[23:45:25] <acrichto> I vaguely remember that you didn't like the idea of the ByteExtensions getting merged
[23:47:13] <brson> I don't recall the ByteExtensions issue. It probably makes sense to ReaderUtil, ReaderByteConversions and WriterByteConversions into default methods
[23:47:34] <acrichto> mk I will investigate doing so
[23:47:39] <acrichto> using I/O is getting real nice real fast
[23:47:42] <kimundi> dafuq? Now my PR failed because the bots couldn't reach the gyp repo :P
[23:47:46] <acrichto> you no longer have to even improt anything!
[23:48:00] <kimundi> brson: Need a retry :)
[23:48:54] <brson> kimundi: done
[23:49:06] <acrichto> brson: I'm also becoming less and less convinced that I/O should have conditions removed
[23:49:08] <kimundi> thx
[23:50:01] <acrichto> but that's also a discussion for later
[23:50:34] <strcat> acrichto: but if it's already returning Option, how is the condition helping?
[23:51:01] <acrichto> strcat: not caring about errors is *so* easy, and caring about errors is also super easy with one helper function I added
[23:51:15] <acrichto> pub fn result<T>(cb: &fn() -> T) -> Result<T, IoError> {
[23:51:18] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[23:51:18] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d0889fd to 14dcdcd30: 02http://git.io/N3iJvQ
[23:51:18] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[23:51:18] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[23:51:18] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/FLdZnw
[23:51:18] <ghrust> 13rust/06auto 1491b56f6 15Marvin LÃ¶bel: Allow fail messages to be caught, and introduce the Any trait...
[23:51:18] <ghrust> 13rust/06auto 1464f31d9 15bors: auto merge of #9967 : Kimundi/rust/fail_cause_two, r=brson...
[23:51:19] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[23:52:02] <strcat> acrichto: so it's like an API that returns Result with the pain of an extra call ;s
[23:52:17] <acrichto> not really, b/c you can chain lots of things inside there
[23:52:36] <acrichto> I'm not entirely convinced we should keep conditions, but I'm liking them a lot more than I originally did
[23:53:07] <acrichto> strcat: one things it's really useful for is catching errors on writes
[23:53:14] <acrichto> that's something that almost no one ever checks for
[23:53:21] <acrichto> especially for things like printing
[23:53:25] <strcat> but it wouldn't be better than RAII
[23:53:28] <strcat> if failure worked in destructors
[23:53:37] <strcat> write(x); // fails on an error
[23:53:50] <acrichto> I don't think you'd want a failure though
[23:53:57] <strcat> write(x).get(); // doesn't fail on an error
[23:54:14] <acrichto> I'm not totally enthused with having to write get() all over the place...
[23:54:19] <strcat> you don't have to
[23:54:22] <strcat> only if you want to ignore the error
[23:54:27] <strcat> far better than what conditions make you do
[23:54:47] <acrichto> maybe huh, I'd have to see it in practice I think
[23:54:54] <strcat> and first failure in dtors has to work
[23:55:10] <acrichto> I personally really think that glue_drop should use invoke instead of call
[23:55:31] <strcat> I think it's harder than it seems to get it right
[23:55:35] <acrichto> that reason makes linked failure basically have a super high chance of leaking I/O resources
[23:55:39] <acrichto> yeah that's the sad part :(
[23:55:43] <strcat> if the destructor fails, you still need to continue calling the other nested dtors
[23:55:46] <strcat> like
[23:55:52] <acrichto> but right now the runtime doesn't even allow nested failure
[23:55:55] <strcat> a type A where it has a field with ~T
[23:55:57] <acrichto> we just abort on the second failure
[23:55:59] <strcat> and A has a custom dtor
[23:56:04] <strcat> the A dtor fails, it should still free the ~T
[23:56:09] <acrichto> yes
[23:56:17] <acrichto> that'd be fixed if glue_drop used invoke instead of call
[23:56:23] <acrichto> our glue_drop has no landing pads right now
[23:58:36] <strcat> acrichto: yeah but I mean the hard part is making the landing pads
[23:58:41] <strcat> calling invoke is the easy part :)
