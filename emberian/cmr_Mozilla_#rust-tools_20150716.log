[00:00:36] <edunham> brson: you're correct: https://pastebin.mozilla.org/8839647
[00:00:45] <edunham> it expired on July 14th
[00:02:18] <edunham> probably ought to switch everything to a new cert, I suppose. what're your preferences for how long it should be valid?
[00:02:23] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[00:03:09] <brson> edunham: it doesn't matter to me too much. changing certs will require reimaging all the amis though. can we extend the expiration of the existing cert?
[00:03:15] <brson> i still haven't even been able to decode the cert...
[00:03:46] <brson> your command works for me
[00:03:55] <brson> i guess i was trying it on the priv key, which is not a cert
[00:05:19] <acrichto> vadimcn: pong
[00:05:26] <acrichto> brson: edunham: whoa this sounds super weird
[00:05:31] <acrichto> did the cert expire?!
[00:05:35] <vadimcn> acrichto: I forgot - what's our stance on foreign exceptions that may be "thrown in" via FFI?
[00:05:37] <brson> acrichto: yeah, this is not the rust-lang cert
[00:05:39] <edunham> acrichto: yeah it's a perfectly sensible built-in precaution
[00:05:45] <vadimcn> do we care to propagate them?
[00:06:05] <acrichto> vadimcn: undefined behavior
[00:06:11] <acrichto> vadimcn: as in we don't spec what happens
[00:06:17] <edunham> obnoxiously, I'm just finding out now that we should actually (perhaps) have had the bots trust a self-signed CA cert we hold, so it could sign the master's relevant key at any given time
[00:06:17] <brson> i wonder if i set a reminder for myself before the rust-lang cert expires...
[00:06:21] * edunham reading http://superuser.com/questions/622434/can-self-signed-ssl-certificate-be-renewed-how
[00:06:23] <acrichto> vadimcn: we're only obliged to handle rust exceptions thrown with contiguous rust code on the stack
[00:06:31] <vadimcn> acrichto: ok, so abort is fine?
[00:06:32] <acrichto> brson: edunham: ah ok this makes more sense
[00:06:40] <acrichto> vadimcn: e.g. an exception thrown with no handler?
[00:07:02] <acrichto> vadimcn: or having a C++ exception fly over rust code
[00:07:15] <vadimcn> acrichto: let's say we have a rust dll loaded by C++ process
[00:07:23] <edunham> oh well, the conference doesn't have stuff scheduled for this evening, so I can have crash course in re-rolling the AMIs if need be
[00:07:36] <vadimcn> should we support C++ exceptions "flying through" Rust code?
[00:08:00] <acrichto> vadimcn: if given a choice I would prefer to not abort, but if abort is the easiest thing then that's totaly fine
[00:08:09] <acrichto> vadimcn: we're saying that is technically undefined behavior
[00:09:46] <vadimcn> it's cumbersome to support, but not impossible
[00:10:42] <acrichto> vadimcn: oh then let's definitely not support right now
[00:10:48] <acrichto> as in it's not required for correctness at all
[00:11:28] <vadimcn> well, since we want to run inside Firefox, I was wondering in they'd have a requirement to support C++ exceptions passing through
[00:11:39] <acrichto> vadimcn: nah they disable C++ exceptions everywhere
[00:11:42] <acrichto> they don't throw exceptions at all
[00:11:49] <vadimcn> ok, good
[00:12:32] <brson> it seems like we're going to have to update the certs on the slaves. edunham is that what you think?
[00:12:43] * brson prepares a tableflip
[00:16:39] <edunham> brson: i'll dig a bit deeper but i'm pretty sure the hardcoded date is a security feature
[00:16:47] <acrichto> brson: nrc: vadimcn: wycats: btw we have a bit of backlog to deal with in terms of triage for the tools team, would you guys be up for convening for a quick IRC meeting tmw to chat about some of the open issues/RFCs?
[00:16:48] <edunham> so, 80% sure yes
[00:17:22] <brson> edunham: are you still traveling?
[00:17:32] <vadimcn> acrichto: around what time?
[00:17:46] <acrichto> vadimcn: what times work well for you?
[00:17:51] <edunham> brson: yes, currently at macitconf food thing
[00:17:53] <brson> acrichto: do you think we can survive another night w/o integration?
[00:17:59] <acrichto> brson: ah yeah it's fine
[00:18:07] <acrichto> this weekend bors may just actually have work to do
[00:18:13] <acrichto> bors has taken enough weekends of recently
[00:18:14] <brson> ok, i'll fix all the slaves tomorrow
[00:18:15] <acrichto> doesn't deserve another one
[00:18:43] <brson> i'll post a message to internals
[00:18:52] <edunham> nah i'll be back to airbnb by like 7pm; that leaves a few hours of awake
[00:19:24] <edunham> though you're probably a lot faster at rolling the amis than me
[00:19:44] <brson> edunham: do you want to take care of this? i assumed it might be awkward while you were occupied with the con
[00:19:44] <edunham> i'll at least get the new cert ready for them
[00:19:49] <brson> edunham: ok, great thanks!
[00:20:10] <brson> i'll just check with you on the status when i get in tomorrow
[00:20:13] <edunham> the only awkward is that i don't know what's involved in rolling the amis
[00:20:48] <brson> edunham: you start one up from the existing ami, change it live, then ask for a new ami to be snapshotted in the ui. it's pretty simple
[00:20:51] <acrichto> edunham: I can help you through it if it's just updating a few files here and there on an AMI
[00:21:46] <edunham> brson: oh, that's super simple! 
[00:21:49] <brson> edunham: oh, then you edit the ami name in rust-buildbot/master/all-slaves.txt
[00:22:35] <vadimcn> acrichto: anything after 1pm PST would be fine
[00:22:51] <acrichto> vadimcn: ok cool, brson do you have any preference?
[00:22:51] <brson> the rust project is the worst at cert and key management
[00:23:03] <brson> we've gone through 3 signing keys, 1 expired, 1 I lost...
[00:23:09] <brson> acrichto: nah, whatever my schedule says is fine
[00:23:27] * acrichto assumes 1pm+
[00:23:41] <brson> yes open all afternoon
[00:23:42] <acrichto> I'll see if I can get ahold of wycats/nrc and let you guys know tmw morning
[00:23:52] <nrc> acrichto: yes
[00:23:59] <nrc> I have the lang meeting at 1
[00:24:04] <acrichto> nrc: 1pm+ PST works ok for you?
[00:24:06] <acrichto> ah ok, 2pm+ ?
[00:24:10] <nrc> 2 is good
[00:24:13] <acrichto> cool
[00:24:20] <acrichto> vadimcn: brson: let's tentatively say 2pm
[00:24:29] <vadimcn> acrichto: ok
[00:24:31] <acrichto> I'll confirm with wycats, but he may not wish to come
[00:24:54] <acrichto> we can start off on IRC, I don't think it'll take too long
[00:25:02] <acrichto> but we can promote to vidyo if necessary
[00:29:28] <vadimcn> acrichto: is there an easy way to tell LLVM to rename _Unwind_Resume?
[00:30:15] <acrichto> vadimcn: unfortunately I don't think so, I suspect we'll have to just define our own copy of that function
[00:30:51] <acrichto> vadimcn: er well hm
[00:30:58] <acrichto> vadimcn: on ARM I see this: setLibcallName(RTLIB::UNWIND_RESUME, "_Unwind_SjLj_Resume");
[00:31:04] <acrichto> (in the LLVM codebase)
[00:31:10] <acrichto> perhaps we could have a call which does the moral equivalent of that?
[00:31:14] <acrichto> but some rust specific name?
[00:31:27] <vadimcn> acrichto: yes, libgcc also defines it, it'd be nice to rename to make sure that we link our version
[00:31:32] <acrichto> yeah
[00:31:35] <acrichto> that's a good point
[00:31:45] <acrichto> although we could only enable this support for MSVC platforms
[00:31:48] <acrichto> and leave out mingw for now
[00:31:53] <acrichto> but that'd be a bit of a shame
[00:32:34] <edunham> ok, noob question, what's it mean for a call to have a moral equivalent? 
[00:33:13] <acrichto> edunham: oh I just say that in the sense that it's basically the same although implementation wise it's technically different
[00:33:23] <acrichto> but from any reasonable usage of something it's the same
[00:33:44] * acrichto may just be bad with words
[00:34:30] <edunham> oh, ok, that makes sense if I parse it to "equally good/bad" :)
[00:34:39] <edunham> it's just a personification I wasn't familiar with yet
[00:38:43] <vadimcn> acrichto: setLibcallName is a method of TargetLowering.  Do you know off the top of your head, how to get a pointer to that?  If not, I'll just keep digging...
[00:44:52] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Ping timeout: 121 seconds)
[00:47:02] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[00:47:02] *** ChanServ sets mode: +ao brson brson
[01:35:26] <acrichto> vadimcn: nah unfortunately not off the top of my head
[01:35:42] <acrichto> vadimcn: maybe from like a TargetMachine though?
[02:12:17] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[02:34:00] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Server shutdown)
[02:34:00] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Server shutdown)
[02:34:00] *** Quits: Manishearth (manishearth@moz-uc30rq.anapnea.net) (Server shutdown)
[02:34:00] *** Quits: Guest1111 (manishearth@moz-uc30rq.anapnea.net) (Server shutdown)
[02:36:07] *** Joins: Elaine (Elaine@moz-35s2fm.members.linode.com)
[02:36:08] *** Joins: vadimcn (uid46608@moz-0d43u8.highgate.irccloud.com)
[02:36:14] *** Joins: huon (huon@moz-hj272o.8rnv.rggd.6180.2400.IP)
[02:36:16] *** Joins: wycats (sid79@moz-b4lrm3.brockwell.irccloud.com)
[02:36:47] *** Joins: garndt (sid7486@moz-914hec.brockwell.irccloud.com)
[02:36:53] *** Joins: reem (sid78397@moz-octfcu.brockwell.irccloud.com)
[02:39:03] *** Joins: Manishearth (manishearth@moz-uc30rq.anapnea.net)
[02:42:39] *** Joins: aturon (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP)
[02:42:58] *** Joins: nrc (sid365@moz-3taf2s.0j4i.jtu0.0101.2620.IP)
[02:43:58] *** Joins: jimicy (sid338@moz-osdatg.0j4i.jtu0.0101.2620.IP)
[03:33:39] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[03:44:55] *** Quits: Gankro (sid71432@moz-sc2bd6.charlton.irccloud.com) (Ping timeout: 121 seconds)
[03:44:55] *** Quits: wycats (sid79@moz-b4lrm3.brockwell.irccloud.com) (Ping timeout: 121 seconds)
[03:46:03] *** Quits: garndt (sid7486@moz-914hec.brockwell.irccloud.com) (Ping timeout: 121 seconds)
[03:46:30] *** Quits: reem (sid78397@moz-octfcu.brockwell.irccloud.com) (Ping timeout: 121 seconds)
[04:06:15] *** Joins: reem (sid78397@moz-octfcu.brockwell.irccloud.com)
[04:07:03] *** Joins: wycats (sid79@moz-b4lrm3.brockwell.irccloud.com)
[04:07:03] *** ChanServ sets mode: +ao wycats wycats
[04:21:50] *** Joins: Gankro (sid71432@moz-sc2bd6.charlton.irccloud.com)
[04:23:24] *** Joins: garndt (sid7486@moz-914hec.brockwell.irccloud.com)
[04:24:50] *** ChanServ sets mode: +ao nrc nrc
[04:33:11] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[04:34:08] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[04:38:31] <wycats> achricto: I definitely wish to come but I'm currently in India
[04:38:56] <wycats> 2pm PST is 2:30am India time
[04:52:12] <acrichto> wycats: holy cow
[04:53:03] <acrichto> wycats: hm... I think we may have to resort to just taking notes
[04:53:05] <acrichto> at least this time
[04:53:20] <acrichto> nothing too major is likely to come up, just a few issues here and there and an RFC or two
[04:53:32] <acrichto> no decision on RFCs, just possibly FCP I think
[04:54:09] *** Joins: manishea1th (manishearth@moz-uc30rq.anapnea.net)
[05:05:52] *** Manishearth is now known as Guest11988
[05:05:52] *** manishea1th is now known as Manishearth
[05:05:59] *** Manishearth is now known as manishearth
[05:14:28] <wycats> acrichto: kk
[05:14:41] <wycats> <3
[05:14:52] <wycats> generally speaking I want to make these
[05:15:00] <acrichto> oh ofc
[05:15:07] <acrichto> we just haven't had many b/c we don't have that high volume of issues/such
[05:39:32] *** manishearth is now known as Manishearth
[07:27:51] *** Quits: aji (alex@prickle.ajitek.net) (Ping timeout: 121 seconds)
[07:29:19] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[07:33:38] *** Joins: aji (alex@prickle.ajitek.net)
[08:04:18] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Connection closed)
[08:04:32] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[08:39:14] *** ChanServ sets mode: +ao Manishearth Manishearth
[10:20:08] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[12:36:12] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[12:55:17] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[12:58:27] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[13:00:11] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[14:17:34] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[14:17:34] *** ChanServ sets mode: +ao brson brson
[15:38:19] <edunham> ok it looks like we only have 4 unique AMIs, plus the macs
[17:12:24] <acrichto> edunham: linux bot, linux snap, windows, ... what's the fourth?
[17:12:30] <acrichto> oh android
[17:12:38] <acrichto> and no more freebsd!
[17:13:10] <edunham> windows, generic linux, android, centos5 (wat?)
[17:13:43] <acrichto> edunham: ah centos is needed as a "super old linux distro"
[17:13:58] <acrichto> shipping binaries on linux is hard and the best way to do so reliably (that we know of) is to build everything on an ancient machine
[17:14:01] <acrichto> so you use an ancient libc
[17:14:15] <edunham> haha ok
[17:15:25] <edunham> so, *if* the slaves pull from github when they're spinning up, we *might* not actually need to re-make the AMIs
[17:19:03] <acrichto> edunham: that... would be kinda wesome
[17:23:01] <edunham> acrichto: thanks for the merge :)
[17:26:21] <edunham> since I'm in an interesting talk on security right now, could you test the off chance it might work now by re-kicking bors on https://github.com/rust-lang/rust/pull/27019 ?
[17:26:57] <acrichto> edunham: sure
[17:27:52] <edunham> thanks! I doubt it'll work, but nor am I certain it won't
[17:50:06] <acrichto> brson: so you may be very interested in this comment: https://bugzilla.mozilla.org/show_bug.cgi?id=1183850#c6
[17:52:21] <brson> edunham: sounds like everything is under control. what's the eta look like on restoring buildbot?
[17:53:47] <brson> acrichto: that's exciting. let's see if they'll give us their linux-mac cross chain and get it to work with rustc
[17:54:11] <acrichto> brson: yeah that'd be amazing
[17:54:12] <brson> I want to build a completely-self contained Rust distribution for Linux that crosses to everything
[17:54:23] <acrichto> if we could get windows builds working with that as well
[17:54:25] <acrichto> that would just be amazing
[17:54:28] <brson> it will work!
[17:54:37] * acrichto is quite eager
[17:54:42] <acrichto> I thought linux -> OSX was like impossible
[17:56:49] <edunham> brson: currently testing whether just updating the repo fixed it (it doesn't seem to have), then probably 2hrs to learn the AMI repackaging things... catch being that i'm in a talk right now and on a plane in a bit and stuff. I'm targeting having it done by the time my flight leaves at 2:30.
[17:58:12] <acrichto> edunham: ok homu was finally kicked
[17:58:47] <brson> edunham: great. thanks for taking care of this
[17:59:22] <edunham> brson: no problem; sorry it's going so slowly with all my tangents into figuring out what's going on
[17:59:30] <edunham> but it's a great way to learn how Buildbot is set up :)
[18:05:59] <acrichto> edunham: looks like the windows slave that just came online failed to start stunnel still
[18:06:16] <edunham> acrichto: blast. oh well, that answers that question!
[18:10:09] <edunham> oh, eww. The slaves are 47 commits behind the rust-buildbot repo.
[18:11:11] <edunham> brson: how much do we care about the slaves having an up-to-date copy of the buildbot repo on them?
[18:12:00] <brson> edunham: it almost doesn't matter. the buildslave code is dumb, uncustomized and rarely changes
[18:12:42] <brson> all that matters is that the buildslave package is compatible with our buildmaster and that the stunnel config works
[18:17:32] <edunham> ok; currently snapshotting the generic linux
[18:23:17] <edunham> oh jeez, is http://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/connecting_to_windows_instance.html really the way to get into the Windows boxes?
[18:27:20] <acrichto> edunham: I use "remote desktop" something or other
[18:27:24] <acrichto> I think it'd just rdp?
[18:27:38] <acrichto> but if you make an ssh tunnel to port 3389 on the instance (through the bastion)
[18:27:45] <acrichto> then you can connect via rdp over that
[18:29:35] <brson> edunham: here are simplified instructions https://github.com/brson/rust-infra#accessing-aws-machines
[18:29:42] <brson> it's pretty easy once you do it once
[18:30:11] <edunham> yeah; this is my first time figuring out access to the Windows stuff
[18:30:45] <edunham> oh, beautiful, thank you for the ssh tunnel to bastion incantation
[18:31:09] * edunham heads for next conference session to see whether it'll be relevant or whether the buildslaves are more important
[18:32:52] *** Quits: aturon (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP) (Quit: )
[18:32:57] *** Joins: aturon (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP)
[18:38:27] *** Quits: ericholscher (ericholsche@moz-5ti26e.or.comcast.net) (Connection closed)
[18:40:39] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Connection closed)
[18:50:03] *** Joins: ericholscher (ericholsche@moz-5ti26e.or.comcast.net)
[20:23:10] <acrichto> barosl: ping
[20:27:53] * edunham figures out how to nest ssh tunnels, because random airport IP should not be allowed into bastion
[20:28:03] <barosl> acrichto, Yup
[20:28:15] <acrichto> barosl: homu seems totally wedged on cargo
[20:28:21] <acrichto> although I just remembered our bots are all offline
[20:28:29] <acrichto> so that may be related?
[20:28:35] <acrichto> but I can't get homu to start testing a new PR
[20:29:41] <barosl> acrichto, You may need to close & open a PR
[20:29:52] <barosl> `force` just stops all the builds, so it won't help
[20:29:54] <acrichto> barosl: yeah I did that :(
[20:29:58] <barosl> Huh
[20:30:07] <acrichto> perhaps I need to update homu?
[20:30:41] <barosl> Perhaps... there's some patches done in the latest master but I'm not entirely sure it helps
[20:30:55] <acrichto> ah oh well
[20:31:01] <acrichto> I can just try poking again once buildbot is back online
[20:36:06] <barosl> acrichto, And... sorry for disturbing you, but I think it would be great if you could resolve the issue without restarting Homu, because I'm not sure the problem of this time can be reproducible in the future
[20:36:33] <acrichto> barosl: ah I haven't restarted it yet, but I'll try yeah
[20:36:51] <barosl> If buildbots are online again, and you reopen a PR and/or command `force`, even then Homu does not work, it must be a bug of Homu, so should be fixed
[20:37:03] <barosl> Thanks!
[20:38:48] <acrichto> ok cool
[20:38:50] <acrichto> I'll let you know
[21:00:48] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (A TLS packet with unexpected length was received.)
[21:03:08] <acrichto> nrc: vadimcn: up for some quick triage? (looks like brson is offline so gonna wait for him to get here to start though)
[21:03:48] <nrc> acrichto: just finishing up lang meeting - 2 mins?
[21:03:53] <acrichto> nrc: sure
[21:04:01] <acrichto> right *that's* why we chose 2pm
[21:04:09] <vadimcn> acrichto: I'm here
[21:04:31] <acrichto> vadimcn: nrc: I've prepared a list of things if you wanna glance over it ahead of time: https://etherpad.mozilla.org/rust-tools-triage
[21:06:09] <nrc> OK
[21:06:14] <nrc> ready
[21:06:29] <acrichto> nrc: let's give brson a few mins
[21:08:56] *** Quits: ericholscher (ericholsche@moz-5ti26e.or.comcast.net) (Quit: Leaving...)
[21:11:27] <acrichto> vadimcn: nrc: well in the meantime, vadimcn are you familiar with the installer issues that brson nomianted?
[21:11:37] <acrichto> I haven't been following them too closely
[21:12:08] <acrichto> I'm not sure what brson's intention was for them (e.g. P-high or something else)
[21:13:19] <vadimcn> yes, I've seen them
[21:13:28] <acrichto> do you think we should assign them to P-high?
[21:13:38] <acrichto> (e.g. we shoudl basically be very actively working to fix them)
[21:14:02] <vadimcn> the first part of 26765 is by design, as we want to allow side-by-side installations of different versions
[21:14:45] <vadimcn> freezing if installing over another Rust installation is unfortunate...
[21:15:09] <acrichto> hm it sounds like these are somewhat related?
[21:15:23] <acrichto> I'm a little worried on the first one that so many are surprised by the behavior
[21:15:30] <acrichto> we can't overlay 2 installations, right?
[21:15:56] <vadimcn> can you quantify "so many"?
[21:16:04] <acrichto> nah not really
[21:16:21] <acrichto> I guess it's just that one commenter
[21:16:30] <acrichto> it sounded like brson had heard more? not sure though
[21:17:05] <nrc> I would say P-med - P-high should be reserved for, essentially, emergencies, these don't seem like that. Perhaps they should get more weight because people hit the installer first?
[21:17:21] <nrc> I might be biased because I never use an installer
[21:17:29] <acrichto> yeah these may be best to wait for brson
[21:17:37] <acrichto> I suspect he'll have more opinions
[21:17:41] <acrichto> vadimcn do you feel the same way?
[21:17:46] <acrichto> e.g. these may not warrant P-high
[21:18:15] <vadimcn> I personally don't think it's P-high
[21:18:24] <acrichto> ok, I'll see if I can catch brson later
[21:18:36] <acrichto> so let's go to rfcs
[21:18:43] <acrichto> how about putting https://github.com/rust-lang/rfcs/pull/1193 in FCP?
[21:18:58] <acrichto> seems to have some good support
[21:19:07] <nrc> +1
[21:19:29] <vadimcn> +1
[21:19:41] <acrichto> cool
[21:19:47] <acrichto> so we have 3 other RFCs
[21:20:02] <acrichto> have either of you read much about https://github.com/rust-lang/rfcs/pull/1133 ?
[21:20:05] <acrichto> cargo and libstd depes
[21:20:07] <acrichto> deps*
[21:20:17] <acrichto> I feel like that's FCP-ready, but probably FCP-to-close rather than accept
[21:21:09] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[21:21:28] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[21:24:28] <vadimcn> so this is basically about preventing rustc from searching rustlib/<target> for crates, right?
[21:24:36] <nrc> looks FCP-ready to me
[21:24:45] <nrc> not sure if it is a good idea or not
[21:25:08] <acrichto> vadimcn: yeah
[21:25:20] <acrichto> I feel like there's a nugget of truth to this RFC
[21:25:31] <acrichto> but the world isn't in a state where we're ready to move forward on it
[21:25:44] <acrichto> the problem is that if the compiler can't search rustlib then you literally can't link to std
[21:26:36] <vadimcn> I ran into something like that yesterday, when rustc would search rustlib/x86_64-pc-windows-gnu/... even though I passed it --target=my-target flag
[21:26:51] <vadimcn> is this the same issue?
[21:27:13] <acrichto> that.. should definitely not happen
[21:27:23] <acrichto> this I believe is orthogonal to that
[21:27:36] <acrichto> this is just informing cargo to inform the compiler that a crate can't link to std/core
[21:27:43] <vadimcn> is rustc's library search algorithm documented?
[21:27:49] <nrc> urgh, I really want 595 (it bit mer recently), but breaking change :-s
[21:27:50] <acrichto> and then... in theory this allows manually linking to std/core via a Cargo.toml directive, but it's unclear
[21:28:00] <acrichto> vadimcn: somewhat yeah, but not overly so
[21:28:17] <acrichto> nrc: yeah I don't think it's ready for FCP
[21:28:30] <acrichto> it definitely needs some updates to get it ready to go
[21:28:43] <acrichto> vadimcn: nrc: but you guys feel ok FCP'ing 1133?
[21:28:55] <acrichto> can also let it bake longer to work it out some more
[21:29:36] <nrc> re 1133, yes, I'm not sure which direction it'll go, but it doesn't seem like there is much left to work out
[21:31:13] <acrichto> yeah
[21:31:16] <vadimcn> let's FCP it
[21:31:18] <acrichto> cool
[21:31:28] <acrichto> so the other two are cargo install and output options
[21:31:30] <nrc> I think 1200 needs a little more time before FCP - there's still plenty of discussion
[21:31:32] <acrichto> I feel like neither are ready for FCP
[21:31:35] <acrichto> agreed
[21:31:53] <acrichto> for 1200 I'm curious, have you guys followed the discussion much?
[21:32:09] <acrichto> I'm curious for more opinions about `cargo install` == `make install` vs having more package-manager-like features
[21:32:32] <acrichto> I talked with wycats briefly and the conclusion was that you wnat `cargo install` and `cargo uninstall`, which necessitates metadata
[21:32:35] <nrc> no - I did initially, but then it got too much
[21:32:41] <acrichto> so `cargo install --update` is just a tiny bit extra
[21:32:43] <acrichto> ah ok
[21:32:54] <acrichto> I think the extent of cargo install is kinda the main question now
[21:32:57] <nrc> agree you need uninstall
[21:32:59] <acrichto> but if you'd like to weigh in feel free :)
[21:33:40] <nrc> I would err for the absolute minimum initially, but the hard question is what that is
[21:34:00] <acrichto> I think that would strictly speaking scrap --update
[21:34:03] <acrichto> but that's basically it
[21:34:44] <nrc> I def think we should do it, and I don't agree with the 'use the system package manager' argument
[21:34:59] <vadimcn> I personally don't think cargo should be in the business of general package management.
[21:35:11] <nrc> acrichto: how minor is update? Is there any benefit in postponing it?
[21:35:22] <nrc> it seems very desirable
[21:35:22] <acrichto> nah it seems fine to postpone
[21:35:30] <acrichto> vadimcn: does cargo install + uninstall seem to package-manager-y though?
[21:35:50] <acrichto> I agree we don't want to do too much in that realm, but I'm not sure to what degree that realm covers
[21:36:09] <vadimcn> acrichto: yes
[21:36:24] <vadimcn> bet then again, I'm used to windows ecosystem
[21:36:31] <acrichto> so you wouldn't be in favor of cargo install at all?
[21:36:35] <acrichto> or just a scaled back version?
[21:36:54] <nrc> I think we need it to be comparable with make
[21:37:14] <nrc> doing uninstall seems like a no-brainer if we have install
[21:37:27] <acrichto> the problem is doing uninstall reliably means we need a manifest
[21:37:31] <acrichto> or some form of metadata for ourselves
[21:37:36] <acrichto> to map what was installed to what installed it
[21:37:47] <vadimcn> acrichto: is it supposed to track dependencies too?
[21:37:47] <acrichto> and that's a bit of a deviation from make
[21:37:50] <acrichto> but now a huge amount
[21:37:55] <acrichto> vadimcn: just in the sense that cargo already does that
[21:38:02] <acrichto> cargo install foo -- will only install binaries for the package foo
[21:38:10] <acrichto> we're not installing any libs, and all deps are statically linked into binaries
[21:38:11] <nrc> yeah, I see that, but it seems like an implementation detail to me
[21:38:16] <acrichto> true
[21:38:29] <acrichto> vadimcn: but yeah cargo install wouldn't install any dependencies
[21:38:33] <acrichto> it'd just download them as usual to build the crate
[21:39:33] <vadimcn> acrichto: this might work for trivial software, but anything more complicated surely needs dylibs and config files to be placed in the right locations?
[21:39:34] <nrc> I don't want to see cargo install like a fully featured package manager - for mature projects, the system package manager should be the obvious thing to use, but there seems to be a large middle ground of wanting to easily build and install from source that we need to covere
[21:39:58] <nrc> vadimcn: we could add that later, I think
[21:40:04] <acrichto> vadimcn: we can in theory add install scripts later
[21:40:07] <acrichto> to install things like native assets
[21:40:15] <acrichto> but dylibs are only system dylibs
[21:40:21] <acrichto> which are already installed through the system package manager
[21:40:33] <acrichto> and if a crate auto-builds a lib b/c it wasn't detected, it's statically linked 99% of the time
[21:40:45] <acrichto> config files are definitely a thing, but that seems like an install script kinda thing
[21:40:52] <acrichto> which is just along the lines of `make install`
[21:41:12] <vadimcn> acrichto: ok, I guess I don't work enough on linux to have an opinion here
[21:41:13] <acrichto> nrc: I'm starting to like thinking of this as a "install from source" command
[21:41:28] <acrichto> vadimcn: hm ok, it does seem like the RFC should be scaled back a bit regardless
[21:42:46] <acrichto> ok, I'll try to update that today or tomorrow
[21:42:53] <acrichto> but that's pretty much all I had for today
[21:43:01] <acrichto> I'd recommend peeking at --with and project templates
[21:43:06] <acrichto> and weigh in if you'd like
[21:43:12] <acrichto> but they're not immediately actionable I think
[21:43:44] <nrc> 1811: so meta :-)
[21:44:10] <acrichto> lol
[21:44:25] <acrichto> ah yeah that was a bit of a passing though
[21:44:27] <acrichto> thought*
[21:44:31] <acrichto> I don't see a huge reason to *not* do it
[21:44:36] <acrichto> I don't consider the API stable at all though
[21:44:43] <acrichto> like every portion of it is subject to change
[21:44:51] <acrichto> but I can see where it would be useful
[21:45:58] <nrc> yeah, seems nice to have
[21:46:55] <vadimcn> yes, why not
[21:47:01] <acrichto> hehe
[22:05:06] <barosl> acrichto, Hey, I just investigated the source code and found that Homu cannot recover itself if the Buildbot doesn't respond with the 'buildStarted' message after Homu commands it to start building
[22:05:20] <barosl> Chances are the message was already lost, so it is more likely that Homu should be restarted
[22:05:22] <acrichto> barosl: oh that may be it
[22:05:28] <acrichto> ok cool
[22:05:40] <acrichto> I'll see what happens once we get the bots back online
[22:06:10] <barosl> Ok, there's also possibility that the Buildbot sends the queued message again
[22:06:20] <acrichto> it may yeah
[22:28:17] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[22:28:17] *** ChanServ sets mode: +ao brson brson
[22:50:44] <vadimcn> acrichto: what is intrinsics::abort() supposed to do: terminate process on the spot, or raise and exception/signal?
[22:51:01] <vadimcn> s/and/an/
[22:58:22] <acrichto> vadimcn: terminate the process on the spot by executing an invalid instruction for the cpu
[22:58:30] <acrichto> which on windows I believe raises an exception/signal
[23:01:31] <vadimcn> Right. But that exception causes stack unwind, which executes destructors, which I am not sure is a good idea during abort
[23:01:59] <acrichto> vadimcn: indeed!
[23:02:07] <acrichto> vadimcn: but the personality will only catch rust exceptions, right?
[23:02:18] <vadimcn> I am running into this right how when I call rtabort! in stack unwind code
[23:02:59] <vadimcn> right now they'd be considered foreign exceptions
[23:03:56] <vadimcn> I can let specific system exceptions through rust personality without calling landing pads
[23:04:26] <vadimcn> or we could have abort() call something like RaiseFailFastException()
[23:05:11] <acrichto> vadimcn: I'm ... confused
[23:05:15] <acrichto> I prototyped something awhile back
[23:05:21] <acrichto> and all exceptions are tagged with a code, right?
[23:05:30] <acrichto> why can't we just ignore everything that's not tagged with rust?
[23:06:33] <vadimcn> that would also let C++ exceptions to pass through rust code without calling destructors
[23:06:49] <vadimcn> ('cause on Windows C++ exceptions also use SEH)
[23:07:47] <acrichto> that's fine
[23:07:59] <acrichto> I don't think we want to try to run dtors on all SEH exceptions right now
[23:09:43] <vadimcn> right, but what do we do: simply not run the destructors but let the stack unwind, or abort?
[23:10:54] <acrichto> well we don't do anything, right?
[23:11:03] <acrichto> it's up to the personality fn to unwind or abort?
[23:11:10] <acrichto> and our personality fn just punts?
[23:11:52] <vadimcn> I'm in the process of rewriting our personality fn, so I wanted to know what is the desired behavior
[23:12:27] <acrichto> I think it should catch all rust exceptions and then punt on everything else
[23:12:38] <acrichto> (that's how it still works, right?)
[23:13:57] <vadimcn> I am talking about the case when we have rust code sandwiched between two C++ code regions
[23:14:26] <acrichto> SEH personality fns are like the dwarf ones, right?
[23:14:34] <acrichto> they run once for finding the handler and then once for the cleanups?
[23:15:03] <vadimcn> roughly, but not quite the same
[23:15:19] <acrichto> in the "find the handler" mode I'd expect rust to punt on everything but rust exns
[23:15:29] <acrichto> where only the catch fn has the "yes I will catch" mode
[23:15:39] <acrichto> and then for the cleanup mode everything just runs cleanups unconditionally
[23:15:42] <vadimcn> yes
[23:15:53] <acrichto> which means if someone catches a segfault we'll keep running code
[23:15:58] <acrichto> but they probably shouldn't catch a segfault
[23:17:00] <vadimcn> on windows unwinding stack with destructors is somewhat difficult if exception was not thrown by rust
[23:17:17] <acrichto> yeah that's fine
[23:17:21] <acrichto> I'd do whatever's easiest in that case
[23:17:31] <acrichto> we say it shouldn't happen regardless
[23:18:49] <vadimcn> well, we can err on the side of safety and abort the process, or we can let the stack unwind without running our destructors
[23:19:16] <acrichto> either way I think is fine
[23:19:20] <acrichto> I'd pick whichever is easiest
[23:21:23] <vadimcn> ok, I'll do the latter.
[23:21:50] <acrichto> cool
[23:21:51] <vadimcn> though it undermines our "safety first" story somewhat...
[23:23:13] <acrichto> eh I feel like this falls in our "undefined behavior" story
[23:23:21] <acrichto> we've also got time to experiment either way with MSVC
[23:23:25] <acrichto> b/c it doesn't have widespread usage today
[23:25:08] <vadimcn> I thought we use that for mingw too...
[23:25:42] <acrichto> we may want to start out with just msvc
[23:25:44] <vadimcn> after my change we could stop linking to libgcc
[23:25:48] <acrichto> yeah
[23:25:54] <acrichto> in the long term I think we definitely want this for mingw
[23:25:57] <acrichto> b/c it drops the libgcc dep
[23:26:06] <acrichto> but for a transition period we may want to start out with just msvc
[23:26:09] <acrichto> to have minimal disruption
[23:26:54] <vadimcn> I don't expect much disruption, it passes all tests but one
[23:27:18] <acrichto> oh wow
[23:27:23] <acrichto> then maybe we can just turn on by default
[23:39:24] <brson> edunham: i'm going to update the windows ami now
[23:39:53] <edunham> brson: thank you
[23:54:48] <brson> edunham: the windows ami is updated. you can finish updating the rest of buildbot
[23:56:39] <edunham> brson: awesome, thanks. I'll drop the new AMI ID where it belongs, finish up the android and ancient-linux slaves, and kick buildbot. 
[23:56:45] <edunham> Could you also stick the new key onto the macs, please?
[23:56:57] <brson> edunham: sure
