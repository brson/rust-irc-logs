[00:00:45] *** Quits: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP) (Ping timeout)
[00:01:39] <olsonjeffery> help me make -j8, you're my only hope.
[00:01:57] <acrichto> that actually works now!
[00:02:05] <acrichto> at least between the std/syntax stages
[00:02:19] <acrichto> then you hit compilation of rustc itself
[00:02:23] <acrichto> and everyone gets a little sad
[00:03:00] <dbaupp> <3 the extra dissolution
[00:03:05] <dbaupp> parallelism for everyone!
[00:03:58] *** Joins: jensnockert (jensnocker@moz-988C9930.e0f8471ae7fa.afb.bredband2.com)
[00:04:29] *** Quits: tabraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net) (Input/output error)
[00:06:07] *** Quits: jensnockert (jensnocker@moz-988C9930.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[00:07:01] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[00:07:08] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Ping timeout)
[00:07:38] <olsonjeffery> has anyone talked about exposing the docs for the new libs? i take it they're being generated.
[00:07:47] <olsonjeffery> maybe rustdoc needs multi-crate doc generation?
[00:08:56] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[00:10:02] <acrichto> it was discussed earlier, I don't think an issue was made though
[00:10:10] <acrichto> it does seems like we really need multi-crate linking though
[00:10:17] <dbaupp> olsonjeffery: they are exposed here: http://static.rust-lang.org/doc/master/index.html (in a non-automated way)
[00:10:43] <dbaupp> multicrate search would be good too
[00:11:01] <acrichto> the initial rustdoc design had a list of crates at the top
[00:11:07] <acrichto> and a list of crates on the lefft on the main index page
[00:13:47] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[00:13:55] <olsonjeffery> dbaupp: ah, thanks.
[00:15:33] <olsonjeffery> ah, nice. src/doc/index.md
[00:16:51] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[00:18:15] *** Joins: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net)
[00:23:07] <olsonjeffery> f
[00:23:11] <olsonjeffery> whoops
[00:23:20] *** Quits: gimpf (gimpf@moz-9A3C6795.adsl.highway.telekom.at) (Ping timeout)
[00:26:36] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[00:26:36] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1491996b5 to 14acb1ec0: 02http://git.io/N3iJvQ
[00:26:36] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[00:26:39] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[00:26:39] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/ZHkcBw
[00:26:39] <ghrust> 13rust/06auto 141c1defe 15Alex Crichton: Shuffle around ownership in concurrent queues...
[00:26:39] <ghrust> 13rust/06auto 14662a498 15Alex Crichton: Rewrite channels yet again for upgradeability...
[00:26:39] <ghrust> 13rust/06auto 14a91ddd1 15bors: auto merge of #11578 : alexcrichton/rust/chan-changes, r=brson...
[00:26:41] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[00:28:27] *** Joins: gimpf (gimpf@moz-9A3C6795.adsl.highway.telekom.at)
[00:32:58] *** kimundi is now known as zz_kimundi
[00:34:02] *** Quits: notmatt (notmatt@CC62CF7E.1E7FDFDB.A82DBDDB.IP) (Client exited)
[00:34:32] *** Joins: notmatt (notmatt@CC62CF7E.1E7FDFDB.A82DBDDB.IP)
[00:36:20] *** Quits: notmatt (notmatt@CC62CF7E.1E7FDFDB.A82DBDDB.IP) (Ping timeout)
[00:36:35] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[00:36:35] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/nA0Cbg
[00:36:35] <ghrust> 13rust/06auto 1406606f6 15Alex Crichton: Implement clone() for TCP/UDP/Unix sockets...
[00:36:35] <ghrust> 13rust/06auto 141743a3e 15bors: auto merge of #11894 : alexcrichton/rust/io-clone, r=brson...
[00:36:36] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[00:36:37] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[00:36:37] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14a91ddd1 to 14acb1ec0: 02http://git.io/N3iJvQ
[00:36:37] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[00:37:11] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Ping timeout)
[00:38:18] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[00:41:42] <cgaebel> how do I enable debug! messages?
[00:43:09] <acrichto> cgaebel: RUST_LOG=debug (for all libraries everywhere), or RUST_LOG=my_module=debug
[00:43:17] <dbaupp> cgaebel: http://static.rust-lang.org/doc/master/complement-usage-faq.html
[00:43:21] <acrichto> cgaebel: my_module is the path to the module, so for something like hashmap it'd be std::hashmap
[00:43:28] <cgaebel> acrichto: ok thank you!
[00:43:38] <dbaupp> eh, why are we mentioning the log statement still
[00:43:40] <acrichto> cgaebel: other documentation can be found at http://static.rust-lang.org/doc/master/std/logging/index.html
[00:43:52] <acrichto> dbaupp: log!(lvl, ...) ?
[00:44:14] <dbaupp> acrichto: it appears the logging part of the usage faq just outdated
[00:44:36] <acrichto> oh man that is quite old
[00:44:45] <acrichto> What does it mean when a program exits with leaked memory?
[00:44:48] <acrichto> that is a very old question
[00:45:02] <acrichto> dbaupp: wait that entire faq is super old lol
[00:45:03] *** Joins: dherman (dherman@F5DBC48.1E9D22A9.3A1BB2FB.IP)
[00:45:03] *** ChanServ sets mode: +ao dherman dherman
[00:45:09] <dbaupp> yup
[00:45:23] *** Joins: sokomo (sokomo@8293D4FC.93FF164A.408809BB.IP)
[00:45:38] <acrichto> we should probably just remove that
[00:46:19] <dbaupp> btw, the "Performance and Side Effects" shows a function call and says "just a load and an integer comparison" but a function call isn't necessarily just an integer load: maybe it should just be a MY_MODULE_LOG_LEVEL static variable in the if statement?
[00:46:22] <strcat> doesn't rust still leak memory?
[00:46:27] <strcat> or is it talking about something else
[00:46:34] <strcat> (leak as in valgrind thinks it's a leak - it's a one time thing)
[00:48:39] *** Quits: dherman (dherman@F5DBC48.1E9D22A9.3A1BB2FB.IP) (Quit: dherman)
[00:50:30] <brson> agree we should consolidate the faqs. having three small, ancient faq pages is not too helpful
[00:59:50] *** Joins: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP)
[01:00:59] *** Quits: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP) (Connection reset by peer)
[01:01:20] *** Joins: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP)
[01:03:20] *** Quits: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP) (Ping timeout)
[01:13:11] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Ping timeout)
[01:14:10] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[01:14:56] <olsonjeffery> acrichto: libserialize PR is passing make check and rebased atop latest master
[01:17:09] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[01:17:10] *** ChanServ sets mode: +ao pcwalton pcwalton
[01:17:23] <olsonjeffery> r? https://github.com/mozilla/rust/pull/11984
[01:23:52] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Input/output error)
[01:35:49] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[01:37:11] *** Joins: new_one (new_one@13E43017.8AA374E2.B3C0173E.IP)
[01:50:24] <acrichto> olsonjeffery: would you mind rebasing those into fewer commits?
[01:53:13] <cmr> oh hey nmatsakis is back
[01:53:24] <nmatsakis> what's up?
[01:54:16] <cmr> just noting your presence :)
[01:55:37] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[01:58:41] *** Quits: gimpf (gimpf@moz-9A3C6795.adsl.highway.telekom.at) (Quit: Leaving.)
[02:02:01] *** Joins: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP)
[02:03:59] *** Quits: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP) (Ping timeout)
[02:04:55] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[02:06:48] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[02:11:29] *** Joins: ktt3ja (ktt3ja@moz-85E2770C.hsd1.va.comcast.net)
[02:15:50] <olsonjeffery> acrichto: thy will be done.
[02:16:56] <sfackler> ack! is there a mutex with lock and unlock methods in the standard lib anymore?
[02:21:32] <dbaupp> sfackler: std::unstable::mutex
[02:21:53] <sfackler> oh, derp
[02:21:59] <sfackler> I thought it got removed for some reason
[02:22:19] *** Quits: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[02:24:43] *** Quits: Axord (xord@moz-C0D5F15A.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[02:26:42] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[02:26:42] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/09FmJw
[02:26:42] <ghrust> 13rust/06auto 14ed777c9 15chromatic: Removed prelude::* from libstd files....
[02:26:42] <ghrust> 13rust/06auto 143a23a11 15chromatic: Added missing Windows/Mac OS X import.
[02:26:43] <ghrust> 13rust/06auto 14a4b794b 15chromatic: Cleaned up a lint warning.
[02:26:45] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[02:27:46] *** Joins: zimbabao (rajaram@3FC0D774.3009F76A.D2D1FAF0.IP)
[02:30:04] *** Quits: cluelessperson (cluelesspe@moz-617B0E16.tx.res.rr.com) (Connection reset by peer)
[02:30:14] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Ping timeout)
[02:30:14] *** Joins: cluelessperson (cluelesspe@moz-617B0E16.tx.res.rr.com)
[02:30:19] *** Joins: tabraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net)
[02:30:30] *** Quits: nate (pinkeh@moz-A3C418FF.hcs.harvard.edu) (Ping timeout)
[02:30:31] *** Joins: nate (pinkeh@moz-A3C418FF.hcs.harvard.edu)
[02:30:39] *** Quits: pauls (pauls@moz-BFEF1F22.ccs.neu.edu) (Ping timeout)
[02:30:42] *** Quits: Yurume (Yurume@A826BD81.8A0DEF81.38747683.IP) (Ping timeout)
[02:30:44] *** Joins: Yurume (Yurume@A826BD81.8A0DEF81.38747683.IP)
[02:30:56] *** Joins: pauls (pauls@moz-BFEF1F22.ccs.neu.edu)
[02:30:57] *** Joins: nrc__ (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[02:31:00] *** Quits: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net) (Ping timeout)
[02:31:04] *** Quits: Seldaek (seld@moz-5DEA7688.ch) (Ping timeout)
[02:31:06] *** Joins: Seldaek (seld@moz-5DEA7688.ch)
[02:31:12] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[02:31:13] *** nrc__ is now known as nrc
[02:41:34] *** Joins: yuriks (yuriks@541FB14B.E4E1C694.748B6D8D.IP)
[02:41:40] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[02:41:40] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/b5ErTA
[02:41:40] <ghrust> 13rust/06auto 1401815b3 15Eduard Burtescu: Don't copy arguments passed by value with indirection to allocas.
[02:41:40] <ghrust> 13rust/06auto 1428f277b 15bors: auto merge of #12014 : eddyb/rust/less-copies, r=cmr
[02:41:42] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[02:41:44] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[02:41:44] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1480b23d9 to 14acb1ec0: 02http://git.io/N3iJvQ
[02:41:44] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[02:44:52] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[02:44:52] *** ChanServ sets mode: +ao pcwalton pcwalton
[02:50:28] *** Joins: cgaebel (clark@moz-92F543E4.nycmny.east.verizon.net)
[02:52:24] <pcwalton> nmatsakis: we already have a CFG
[02:52:27] <pcwalton> in cfg/construct.rs
[02:52:40] <pcwalton> am I missing something?
[02:53:24] <pcwalton> oh, I guess it's unused
[02:53:42] <dbaupp> pcwalton: did you happen to measure/remember the performance increase using quicksort in servo gave to the sorting itself? (rather than just the overall effect of the improved sorting)
[02:53:52] <pcwalton> dbaupp: I didn't measure
[02:53:59] <dbaupp> ok, thanks
[02:55:43] <nmatsakis> pcwalton: what you're missing is that (a) it's unused and untested and (b) it wnats all closures to be analyzed separate from the enclosing function
[02:56:00] <nmatsakis> pcwalton: (b) is why I wanted to land my patch first
[02:56:04] <pcwalton> ah, ok
[02:56:25] <pcwalton> so it probably doesn't make a whole lot of sense to fix up the CFG to handle closures if your patch will deprecate that functionality
[03:02:07] *** Quits: cgaebel (clark@moz-92F543E4.nycmny.east.verizon.net) (Client exited)
[03:02:48] *** Joins: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP)
[03:03:01] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:03:04] <acrichto> pcwalton: do you wanna pull in the llvm patch locally?
[03:03:11] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:03:15] <pcwalton> acrichto: I don't see a huge rush
[03:03:18] <acrichto> mk
[03:03:24] <pcwalton> let's wait for upstream feedback
[03:04:14] <strcat> LLVM will be C++11 soon ;)
[03:04:25] <strcat> I bet some of our buildbots are going to break
[03:04:44] *** Quits: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP) (Ping timeout)
[03:04:50] <nmatsakis> pcwalton: prob not, no, I am trying to write up a quick description of the impact of the patch right now
[03:05:05] <acrichto> strcat: I had to pass --disable-compiler-version-checks for the last upgrade, we're gonna break real hard on the next upgrade
[03:05:12] <pcwalton> what's the remaining work to do before landing?
[03:05:23] <pcwalton> or probably I'll just wait for your description :)
[03:06:08] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[03:06:08] *** ChanServ sets mode: +ao dherman dherman
[03:06:17] * pcwalton goes back to removing ~[] from the language
[03:06:23] <nmatsakis> pcwalton: I think it passes all tests (rerunning right now after last rebase), so the main thing is I wanted to get everyone's approval
[03:06:26] <acrichto> pcwalton: you're brave
[03:06:35] <pcwalton> acrichto: heh, I'm the Rust janitor
[03:07:05] <pcwalton> just a PSA: please stop using ~[] in new patches
[03:07:08] <pcwalton> prefer vec_ng instead
[03:07:14] <acrichto> lol
[03:07:21] <pcwalton> I will be converting everything over
[03:07:24] <dbaupp> do we have a plan for vec_ng literals?
[03:07:26] <acrichto> pcwalton: the compiler is going to turn awful
[03:07:31] <pcwalton> I don't care :)
[03:07:43] <strcat> it won't be that bad if we impl the slice methods for Vec via a trait
[03:07:48] <acrichto> it'll at least provide us impetus I guess
[03:07:51] <strcat> auto-slicing is mostly unused
[03:07:55] <strcat> beyond that
[03:08:02] <nrc> what does 'ng' stand for?
[03:08:13] <dbaupp> nrc: next gen
[03:08:15] <pcwalton> dbaupp: I'll macro it
[03:08:18] <strcat> just a lazy disambiguation (next generation)
[03:08:28] <dbaupp> pcwalton: sounds good
[03:08:31] <nrc> oh
[03:08:44] <strcat> imo we should have std::slice and std::vec
[03:08:51] <strcat> smaller modules that way
[03:09:17] <nrc> so prefer ~vec_ng for ~[]?
[03:09:35] <dbaupp> I guess we could (temporarily) a have a trait impl'd for [T,.. n] for some small `n` on the assumption that people won't be initialising huge vectors as literals much
[03:10:00] *** Quits: new_one (new_one@13E43017.8AA374E2.B3C0173E.IP) (Ping timeout)
[03:10:03] <strcat> nrc: well, just Vec<T>
[03:10:03] <dbaupp> then Vec::literal([1, 2, 3]) would work
[03:10:05] <strcat> no ~
[03:10:15] <strcat> works like the other containers
[03:10:23] <strcat> dbaupp: seq!(1, 2, 3)
[03:10:27] <acrichto> pcwalton: perhaps a vec!() macro should be added to libstd for the time being?
[03:10:33] <acrichto> or seq!
[03:10:34] <strcat> let xs: Vec<int> = seq!(1, 2, 3);
[03:10:51] <acrichto> pcwalton: something allowing construction of the container with initial values that are moved in
[03:10:55] <strcat> let xs: HashMap<int, int> = seq!((1, 2), (3, 4));
[03:10:57] * strcat shrugs
[03:11:12] <dbaupp> strcat: that'd be nicer
[03:11:17] <strcat> where seq! expands to with_capacity + some generic push/insert thing
[03:11:26] <acrichto> jeez what scumbag decided to use conditions in std::fmt::parse
[03:11:27] <acrichto> <- this guy
[03:11:37] <dbaupp> chaining Some().move_iter()'s
[03:11:42] <dbaupp> + .collect()
[03:11:49] <dbaupp> acrichto: what a jerk ;P
[03:11:51] <strcat> dbaupp: lot of code bloat
[03:12:07] <dbaupp> strcat: <3 bloat
[03:12:09] <dbaupp> ;P
[03:12:19] <strcat> I'd rather have a generic best-effort insert inserting it in the cheapest way for that container
[03:12:27] <dbaupp> yeah
[03:12:39] <strcat> maybe at the front, maybe at the back, maybe it's a map preserving order or making order arbitrary
[03:13:13] <strcat> pcwalton: there are two people hard at work on mergefunc btw...
[03:13:13] *** Joins: cgaebel (clark@moz-92F543E4.nycmny.east.verizon.net)
[03:13:23] <strcat> I don't think the patch fixing the cast assert is merged yet though :(
[03:13:31] <strcat> takes so long for LLVM patches to land sometimes
[03:13:33] <dbaupp> strcat: did your patch finally land?
[03:13:36] <strcat> dbaupp: yes
[03:13:39] <dbaupp> \o/
[03:14:18] *** Joins: new_one (new_one@13E43017.8AA374E2.B3C0173E.IP)
[03:14:45] <strcat> http://llvm-reviews.chandlerc.com/D2591
[03:14:49] <strcat> and some others exist
[03:15:08] <cgaebel> hey strcat can you sanity check some code for me (10 lines)?
[03:15:12] <cgaebel> http://pastebin.com/GiEBm8hP
[03:15:13] <strcat> cgaebel: sure
[03:15:16] <strcat> sec
[03:15:21] <cgaebel> is it just me or is that output impossible...?
[03:15:57] <dbaupp> cgaebel: what type is the key?
[03:16:02] <dbaupp> ()?
[03:16:06] <cgaebel> no, int
[03:16:08] <dbaupp> rusti: Some(~())
[03:16:14] -rusti- timeout triggered!
[03:16:18] <dbaupp> rusti: Some(~())
[03:16:24] -rusti- timeout triggered!
[03:16:26] <dbaupp> bah
[03:16:27] <strcat> rusti: 2
[03:16:29] -rusti- 2
[03:16:31] <dbaupp> cgaebel: and the value?
[03:16:34] <cgaebel> ()
[03:16:36] <dbaupp> rusti: Some(~())
[03:16:37] -rusti- None
[03:16:39] <strcat> cgaebel: Some(~()) is a known bug
[03:16:42] <dbaupp> cgaebel: that's the problem
[03:16:43] <cgaebel> really?!
[03:16:44] <cgaebel> oh.
[03:16:45] <strcat> I opened an issue about it
[03:16:55] <cgaebel> any workaround?
[03:17:02] <cgaebel> actually, nvm I'll work around it
[03:17:08] <cgaebel> I'll just call "exists" or something..
[03:17:22] <cgaebel> what's the issue #?
[03:21:14] *** Quits: zz_kimundi (kimundi@moz-68679156.dip0.t-ipconnect.de) (Ping timeout)
[03:21:14] <dbaupp> cgaebel: probably https://github.com/mozilla/rust/issues/11998
[03:25:04] *** Joins: zz_kimundi (kimundi@moz-47FBED98.dip0.t-ipconnect.de)
[03:25:06] *** zz_kimundi is now known as kimundi
[03:40:33] <nmatsakis> pcwalton: http://smallcultfollowing.com/babysteps/blog/2014/02/04/closures-and-the-borrow-checker/
[03:40:39] <pcwalton> cool
[03:40:45] <pcwalton> gonna read once this is compiling
[03:45:02] *** Joins: carter (carter@moz-58F59B3A.members.linode.com)
[03:49:08] <nmatsakis> brson: acrichto: nrc: see post above ^ I wanted to have that written up for meeting but didn't get to it
[03:49:45] <nrc> ta, will read
[03:49:54] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[03:53:00] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[03:53:04] *** Quits: cgaebel (clark@moz-92F543E4.nycmny.east.verizon.net) (Quit: ChatZilla 0.9.90.1 [Firefox 26.0/20131206145143])
[03:54:53] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[03:56:42] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[03:56:42] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/b5ErTA
[03:56:42] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[03:58:37] <brson> nmatsakis: thanks
[04:01:40] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[04:01:41] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/IEyx9g
[04:01:41] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[04:01:45] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[04:01:45] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/GUvZ7g
[04:01:45] <ghrust> 13rust/06auto 1439db631 15Alex Crichton: Implement clone() for TCP/UDP/Unix sockets...
[04:01:45] <ghrust> 13rust/06auto 147ab1d28 15bors: auto merge of #11894 : alexcrichton/rust/io-clone, r=brson...
[04:01:46] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[04:03:33] *** Joins: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP)
[04:04:23] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[04:05:25] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[04:05:27] *** Quits: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP) (Ping timeout)
[04:05:49] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[04:06:57] <strcat> acrichto: http://lists.cs.uiuc.edu/pipermail/llvmdev/2014-January/069548.html the specific point at which the bots will break ;)
[04:07:12] <acrichto> welp
[04:07:42] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[04:07:49] <carter> oo
[04:11:13] <dbaupp> cmr: btw, I couldn't get the test runner to run under kcov reliably: caused hangs and runtime aborts :(
[04:11:22] <dbaupp> cmr: maybe it doesn't like threading?
[04:11:25] <cmr> dbaupp: shame
[04:11:35] <dbaupp> (Oh, I should try with RUST_THREADS=1, etc.)
[04:11:52] *** Quits: zimbabao (rajaram@3FC0D774.3009F76A.D2D1FAF0.IP) (Ping timeout)
[04:13:20] <strcat> rusti: static EMPTY: () = ();
[04:13:22] -rusti- pastebinned 10 lines of output: http://ix.io/ake
[04:14:29] <acrichto> nmatsakis: nice post! as always thanks so much for writing it up!
[04:14:36] <olsonjeffery> concurr
[04:15:13] <olsonjeffery> as i quipped on reddit: yay well-defined borrowing semantics.
[04:15:19] <olsonjeffery> boo Cell<T>.
[04:18:28] *** Joins: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP)
[04:18:36] <strcat> https://github.com/mozilla/rust/issues/11998#issuecomment-34136209 what I plan on doing about that Some(~()) thing if anyone cares
[04:18:38] <strcat> ;p
[04:19:21] * strcat wishes malloc just did this itself
[04:19:43] <strcat> implemented defined malloc(0) is silly, especially since they give a choice between null and allocating...
[04:20:00] <strcat> it is never what we ideally want
[04:21:09] <carter> urk... thats a nasty looking design problem
[04:23:37] <strcat> technically it could use EMPTY_PTR as the full internal solution
[04:23:47] <strcat> extra branch on free is pretty meaningless
[04:24:02] <strcat> but free has to be #[inline] for dead store elimination unless we write our own pass
[04:24:24] * strcat shrugs
[04:24:54] <strcat> maybe I'll submit a patch doing that and micro-optimize it more later...
[04:25:26] <strcat> custom allocators like being passed a size in free/realloc
[04:27:30] *** Joins: zimbabao (rajaram@229DE9BA.EEB7A4D4.D2D1FAF0.IP)
[04:27:44] <strcat> atm we collapse all ~T for T with no destructor to one glue so we lose that
[04:27:50] <strcat> but mergefunc will zap them thanks to unnamed_addr
[04:31:46] <carter> hrm
[04:32:05] <carter> i'll have to reread thath when i'm better rested then
[04:40:32] <strcat> meh
[04:40:32] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[04:40:35] <strcat> killing off glue simplification
[04:59:03] *** Quits: zv (zv@moz-955F83E9.hsd1.ca.comcast.net) (Ping timeout)
[05:04:42] <strcat> or Option<~T> could be 2 words when T is zero-size...
[05:04:55] <strcat> but it'd be nice to allow Option<~Trait> being 2 words instead of 3
[05:12:18] <pcwalton> nmatsakis: I think I know what's going on with why Servo flow construction is spending so much time in memmove
[05:12:32] <pcwalton> it's ultimately because of zeroing stuff out
[05:12:42] <pcwalton> it's this code:
[05:13:02] <pcwalton> let base = BaseFlow::new(self.next_flow_id(), node); let mut flow = ~BlockFlow::from_box(base, box_, is_fixed) as ~Flow;
[05:13:39] <cmr> wow, we've gotten to the point where zeroing is actually a measurable performance hit?
[05:13:41] <cmr> that's awesome
[05:13:42] <pcwalton> BaseFlow is a huge struct and it really needs to be DPS optimized so that it will go directly into BlockFlow::from_box. now BlockFlow::from_box() does get inlined
[05:14:03] <pcwalton> cmr: it's tricky in this case. it's not the zeroing *itself* which is the problem, but it has nasty fallout here
[05:14:05] <strcat> cmr: it makes std::trie and extra::treemap really slow ;s
[05:14:27] <pcwalton> I would object to "really slow"
[05:14:29] <pcwalton> but anyway
[05:14:36] <strcat> well, faster than most languages
[05:14:40] <strcat> 3x slower than unsafe code in rust
[05:14:51] <strcat> (at least searches are no slower)
[05:15:09] <pcwalton> the problem here is that we call glue_drop on the destructor of the base
[05:15:15] <pcwalton> and BaseFlow::glue_drop is *not* inlined
[05:15:37] <pcwalton> so LLVM cannot legally forward the memcpy and convert to DPS
[05:15:56] * strcat remembers when all glue was noinline
[05:16:10] <cmr> that wasn't that long ago ;p
[05:16:22] <pcwalton> if either BaseFlow::glue_drop were inlined or it weren't called at all, then LLVM could legally forward BaseFlow::new to construct in place for BlockFlow::from_box
[05:16:54] <pcwalton> eliminating the memcpy which is at the top of the profile for flow construction in Servo
[05:17:05] <pcwalton> I can check by munging the IR manually to see whether LLVM will do this
[05:17:19] <pcwalton> but I have become somewhat familiar with LLVM's memcpy optimization and it does fairly aggressively forward memcpys
[05:17:22] <pcwalton> so I think it will do this
[05:17:30] <pcwalton> so the solution is to drop running destructors on obviously dead variables
[05:17:42] <pcwalton> to stop running destructors, rather
[05:19:55] <pcwalton> other than the memmove the #2 and #3 functions are malloc and free
[05:20:21] <pcwalton> malloc should be high -- it's box building, that's what it *does* -- free should be at zero, though, and that's a servo problem (flushing boxes to inline flows creates temporary silliness)
[05:20:43] <strcat> malloc could be a lot faster than it is today
[05:21:23] <pcwalton> by using a different malloc?
[05:21:41] <pcwalton> rt::global_heap::malloc_raw is like
[05:21:44] <strcat> pcwalton: well... partly that and partly because what the OS exposes to allocators will improve
[05:22:04] <strcat> pcwalton: http://lwn.net/Articles/542504/ look at that enormous throughput difference ;p
[05:22:12] * strcat wants
[05:22:13] <pcwalton> push rbp; mov rbp,rsp; push rbi; push rax; mov rsi,rdi; call malloc
[05:22:27] <pcwalton> damn autocorrect stop autocorrecting my register names
[05:22:47] <pcwalton> yeah, I'm on Mac too so malloc is really slow
[05:22:49] <strcat> pcwalton: jemalloc/tcmalloc use mmap a lot and it zeroes all the memory
[05:22:57] <pcwalton> WebKit uses a custom malloc with the fast path inlined
[05:23:01] <pcwalton> for flow construction
[05:23:07] <strcat> + they have to deal with doing madvice WONTNEED
[05:23:10] <pcwalton> although that is mainly for frame poisoning as a security measure
[05:23:32] <strcat> vrange is basically... giving tcmalloc/jemalloc exactly what they want from their ideal API
[05:23:47] <strcat> the kernel knows when there's memory pressure and takes their unused but mapped VM
[05:23:47] <pcwalton> Gecko and WebKit have both written custom mallocs to minimize security fallout with the use after free of frames because it is so inevitable :(
[05:24:04] <pcwalton> (now you know why we care so much about memory safety)
[05:24:24] <strcat> glibc seems to detect 90% of use-after-free in the default config
[05:24:29] <strcat> er
[05:24:30] <strcat> double-free *
[05:24:40] <pcwalton> 90% is a pretty bad number for security :)
[05:25:05] <pcwalton> anyway that's the same approach
[05:25:41] <strcat> well, I don't like that glibc does that
[05:25:43] <strcat> it's slow!
[05:25:45] <pcwalton> heh
[05:25:54] <pcwalton> frame poisoning is also a performance tradeoff
[05:26:09] <pcwalton> it reduces cache locality
[05:26:15] <strcat> we could probably get some speed by turning off glibc's double-free detection ;\
[05:26:16] <pcwalton> I will be very happy to not have to do it in Servo
[05:26:18] <strcat> jemalloc/tcmalloc don't do it
[05:26:32] <strcat> I think it's an env var
[05:26:45] <strcat> anyway glibc makes really weird tradeoffs
[05:26:52] <strcat> it uses sbrk to avoid mmap's zeroing
[05:27:02] <strcat> so it gets fragmentation and can rarely release memory
[05:27:22] * strcat expects vrange to make jemalloc/tcmalloc/glibc pretty much the same thing...
[05:27:46] <strcat> they'll all switch to never releasing VM, but instead marking it unused in batches
[05:27:51] <cmr> strcat: is vrange actually chugging along on the path to mainline?
[05:27:52] <strcat> and they won't use sbrk *or* mmap
[05:27:59] <strcat> cmr: yes, it takes a long time
[05:28:01] <cmr> awesome :)
[05:28:03] <strcat> look at the real-time patches
[05:28:11] <cmr> I haven't been following its progress at all
[05:28:12] <strcat> they've been taking like 8 years to land
[05:28:17] <cmr> the ones that will never land? ;p
[05:28:21] <strcat> they do land
[05:28:38] <strcat> problem is that as they get closer to real real-time upstream, they cover closer to 100% of use cases
[05:28:45] <strcat> there are not enough people who need the remaining ones
[05:28:47] <strcat> ;p
[05:29:14] <strcat> have to be really careful and making a solution that's good enough 99% of the time because it will be stuck there forever...
[05:30:04] <strcat> rust has to fight that uphill battle too
[05:30:22] <strcat> it's a clear improvement over C and C++, but is it a *big enough* improvement to make people switch?
[05:31:45] <strcat> cmr: https://lkml.org/lkml/2013/10/2/682 oct 2013
[05:33:10] <strcat> cmr: I'll be so happy when this lands and OOM stops being such a horrible churn too...
[05:33:25] <strcat> cmr: OOM -> all applications release unused pooled memory
[05:33:29] * strcat shrugs
[05:33:53] <strcat> not sure how much overhead VM mappings have though
[05:39:06] *** Quits: jsonnull (Thunderbir@26F61E6.CFD9471D.494A0F8B.IP) (Quit: jsonnull)
[05:40:30] *** Joins: erickt (Adium@991D7890.9C346C7F.FAA4474F.IP)
[05:43:42] <pcwalton> strcat: memory safety is big
[05:46:40] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[05:46:40] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/jaKG0w
[05:46:40] <ghrust> 13rust/06auto 148a1dda9 15Alex Crichton: Adding tests for closed issues...
[05:46:40] <ghrust> 13rust/06auto 1403c28b4 15Alex Crichton: Make cfail test error messages more precise...
[05:46:40] <ghrust> 13rust/06auto 1450bdeb9 15Alex Crichton: Run all target crate tests on the windows/try bots...
[05:46:42] <strcat> pcwalton: but what if most of the code is in asm.js/NaCl?
[05:46:42] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[05:47:15] <pcwalton> performance hit, and asm.js/NaCl doesn't prevent people from owning your app anyway
[05:47:32] <pcwalton> they prevent people from owning your box but not your app ;)
[05:47:42] <strcat> well, asm.js is a performance hit but how much does NaCl hurt?
[05:47:49] <pcwalton> about the same
[05:47:59] <pcwalton> well
[05:48:02] <pcwalton> not quite, today
[05:48:09] <Eridius> nooo acrichto's IO::clone failed :'(
[05:48:21] <pcwalton> but NaCl is something like 20%, I think, if you can't use the segment registers (which you usually can't)
[05:48:31] <pcwalton> I would say it is better to compare to something like linux containers
[05:48:42] <pcwalton> but again, it doesn't prevent people from owning your app
[05:48:55] * strcat likes the guarantees seccomp gives for this
[05:49:14] <strcat> pcwalton: memory safety helps you write correct code but it's not the whole picture
[05:49:14] <pcwalton> and you also have to use IPC to cross between isolation boundaries
[05:49:17] <pcwalton> which is always such a mess
[05:49:27] <pcwalton> never said it was
[05:49:32] <strcat> I know
[05:49:34] <pcwalton> servo will have security vulnerabilities just like any other
[05:49:44] <pcwalton> but it's such a huge quantity of them
[05:49:47] <pcwalton> for C++ apps
[05:51:30] <strcat> I guess NaCl has slow graphics
[05:51:56] <Diamond> the trampoline is expensive.
[05:52:04] <Diamond> in nacl
[05:52:13] <strcat> what do they need a trampoline for?
[05:52:24] <Diamond> to hide the function address
[05:52:27] <Diamond> well 
[05:52:37] <Diamond> the stack fp
[05:52:40] <strcat> ah for the FFI barrier
[05:52:44] <Diamond> yep
[05:53:02] <Diamond> not as bad as a context switch though
[05:53:44] <strcat> they could use dri3 for gl now
[05:53:57] <strcat> and stop doing the horrible buffer + context switch thing
[05:54:04] *** Quits: zimbabao (rajaram@229DE9BA.EEB7A4D4.D2D1FAF0.IP) (Ping timeout)
[05:55:19] <Diamond> also the thread boundaries. I'm not familar with dri3 (looking it up...), so idk if that'd fix or lessen that pothole.
[05:55:27] *** Quits: new_one (new_one@13E43017.8AA374E2.B3C0173E.IP) (Quit: leaving)
[05:55:55] <strcat> Diamond: dri3 gives you a file descriptor for rendering
[05:56:15] <strcat> the old way was insecure
[05:56:35] *** Quits: ktt3ja (ktt3ja@moz-85E2770C.hsd1.va.comcast.net) (Quit: Leaving)
[05:56:49] <strcat> Diamond: https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/Documentation/dma-buf-sharing.txt this stuff
[05:57:44] <strcat> anyway before, I think a sandboxed tab would have been able to peek at the entire browser or perhaps the entire system
[05:57:50] <strcat> if they'd let it have gl directly
[05:59:03] <strcat> + intel added per-process GPU memory protection...
[05:59:08] <strcat> the other drives aren't really secure.
[05:59:08] *** Joins: zv (zv@moz-955F83E9.hsd1.ca.comcast.net)
[05:59:11] <strcat> drivers*
[05:59:15] <nrc> what happened to token::ident_to_string?
[05:59:56] <dbaupp> nrc: token::get_ident
[06:00:13] <strcat> anyway on linux systems with dri3 and sandy/ivy bridge or haswell GPU they could have gl in-process :P
[06:00:24] <nrc> dbaupp: thanks!
[06:00:29] * Diamond reads
[06:00:33] <strcat> which is afaik what most chromebooks are going to be
[06:01:03] <strcat> Diamond: the dri3 docs are probably a better place to look :P
[06:01:14] <strcat> that's the kernel's underlying mechanism
[06:05:01] *** Joins: eddyb (eddy@832D2DE5.66315F97.FB866788.IP)
[06:06:46] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[06:08:36] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[06:08:59] <eddyb> good morning :)
[06:09:16] <eddyb> pcwalton: you seem excited :P https://github.com/mozilla/rust/pull/12030#commitcomment-5274738
[06:09:24] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Input/output error)
[06:09:27] <pcwalton> heh
[06:10:00] <eddyb> did someone push it to try yet?
[06:10:52] <acrichto> eddyb: I pushed a branch of yours this morning
[06:11:30] * eddyb looks at the logs
[06:12:15] <eddyb> oops, didn't update rustdoc
[06:12:16] <strcat> eddyb: you agree free/realloc should take the old length right?
[06:12:20] <strcat> as a param
[06:12:43] <eddyb> strcat: I guess we can always know it... sure
[06:12:44] <dbaupp> eddyb: stop fixing everything! you're not letting anyone else do anything :P
[06:12:55] <strcat> eddyb: lets you skip to the right size class pool immediately
[06:13:12] * strcat shrugs
[06:13:16] <eddyb> strcat: it makes freeing fast, even though I still need a pointer in there
[06:13:28] <strcat> anyway seems like the easiest fix for https://github.com/mozilla/rust/issues/11998
[06:13:35] <strcat> sadly have to remove some glue collapsing
[06:13:38] <strcat> simplified_glue_type
[06:13:59] <strcat> (and by easiest, I mean easiest fix preserving that ~Trait for a zero-size type does not allocate)
[06:14:00] <eddyb> I guess I don't "need" the pointer if I keep a bitset but that's the original SLAM
[06:14:38] <eddyb> strcat: ~Trait should be handled by regular allocation and drop glue
[06:14:49] <strcat> eddyb: right, but malloc(0) does what?
[06:14:58] <strcat> (rust malloc, libc is implementation defined)
[06:14:58] <eddyb> the ~Trait drop glue calls the indirect drop glue
[06:15:11] <eddyb> strcat: okay then
[06:15:26] <strcat> I could just omit exchange_free calls
[06:15:30] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[06:15:30] *** ChanServ sets mode: +o tjc
[06:15:32] * strcat shrugs
[06:15:50] * strcat can't decide :(
[06:15:55] <eddyb> branches in those functions can be nasty
[06:16:16] <eddyb> dbaupp: oh come on, I'm doing nothing compared to all the other contributors
[06:16:24] <Diamond> ohwait
[06:16:40] <Diamond> the ppapi already supports context sharing.
[06:16:42] <dbaupp> eddyb: it's you and acrichto, and then the rest of us plebs. :P
[06:16:47] <Diamond> ppapi api
[06:17:00] <eddyb> Pepper API?
[06:17:12] <Diamond> yeah
[06:17:13] <eddyb> bwahahaha I figured it out
[06:17:19] <eddyb> NaCl and PP
[06:17:20] * pcwalton is confused as to why SROA isn't working on the Box
[06:17:23] <Diamond> lol
[06:17:25] <Diamond> yetp
[06:17:28] <Diamond> yep*
[06:18:00] <eddyb> gj, google (on the names)
[06:18:03] <strcat> pcwalton: just don't try looking at the sroa code...
[06:18:07] <eddyb> pcwalton: you mean @T?
[06:18:14] <pcwalton> no, I mean a servo thing
[06:18:49] <strcat> eddyb: we need a branch in free
[06:19:04] <strcat> but for everything but vectors, it will optimize out
[06:19:29] <eddyb> strcat: expose a free with a branch for everything else, leave exchange_free simpler
[06:20:11] <strcat> that works, although it does mean the allocator can't necessarily be as efficient
[06:20:11] <nrc> ...and what happened to ast::DefSelf?
[06:20:37] <eddyb> nrc: *poof*
[06:21:06] <eddyb> strcat: it means you're not depending on jump-threading for every allocation ever
[06:21:26] <strcat> free does plenty of work internally anyway
[06:21:34] <strcat> it's only a problem because we're using libc
[06:21:55] <eddyb> exchange_malloc/free is inlined everywhere, the abort branch causes us enough trouble already :P
[06:22:09] <strcat> a sane allocator could just have a 0 size class not allocating anything *and* not returning null
[06:22:30] <nrc> eddyb: so how is the def for |self| stored now? DefLocal?
[06:22:34] * strcat sighs
[06:23:37] <eddyb> nrc: `self` is nothing more than an argument. there's still ExplicitSelf because we can't use Self outside of trait default methods
[06:24:06] <nrc> eddyb: so DefArg?
[06:24:16] <eddyb> probably DefArg + DefLocal
[06:24:54] * nrc wonders why we need both DefArg and DefLocal
[06:25:01] <nrc> eddyb: thanks!
[06:25:35] <eddyb> AFAIK DefArg points at the argument while DefLocal is for the bindings in the patterns
[06:26:29] <nrc> ah right, there is a differece
[06:39:16] <strcat> acrichto: hmm... why did CowArc end up getting added as separate from Arc?
[06:39:28] <strcat> instead of as a impl<T: Freeze> for Arc<T>
[06:39:43] * strcat didn't follow that
[06:40:46] *** Joins: zimbabao (rajaram@47769425.AE842F9B.81C3DAA1.IP)
[06:43:10] <nrc> anyone know why I might be getting name resolution issues with Path::new after a big rebase?
[06:44:23] <eddyb> nrc: ast::Path, ast_map::Path and std::prelude::Path
[06:44:58] <nrc> eddyb: I'm after std:path::Path, perhaps I'm useing both and that is why rustc gets confused?
[06:45:13] <eddyb> nrc: look at the imports in the module you're in
[06:47:12] <eddyb> pcwalton: r? (rustdoc updated) and/or try https://github.com/mozilla/rust/pull/12030
[06:47:25] <nrc> yeah that was it, |use OsPath = std::path::Path| fixed it
[06:47:29] <nrc> cheers!
[06:49:06] <eddyb> nrc: I suggest, for the sake of all our greps, to import the module for one of them and use module::Path instead of Path
[06:49:23] <eddyb> ast::Path or ast_map::Path is fine. I want to remove ast_map::Path btw :D
[06:49:33] <pcwalton> eddyb: r=me
[06:49:37] <eddyb> so many vectors when we need none
[06:51:20] <nrc> eddyb: I already was importing the module for ast, I think I must import std::path and use path::Path
[06:51:25] <nrc> which works
[06:51:37] <eddyb> nrc: look out for ::*
[06:52:23] <eddyb> about ast_map::Path - instead of a vector pointer per node, we can use a NodeId, which is twice as small as *the pointer* on x64, and much smaller than the contents
[06:52:44] <nrc> yeah, it can be nasty. But I use pretty much every item in ast, so I think it is worth it. Maybe.
[06:52:59] <strcat> pcwalton: are we going to want backtraces when not built with debugging symbols?
[06:53:14] <pcwalton> eh, I dunno
[06:53:17] <pcwalton> is it worth it?
[06:53:20] <eddyb> pretty sure we do
[06:53:21] <pcwalton> I'm unsure
[06:53:27] <strcat> pcwalton: well I found out why fpelim was breaking stuff :(
[06:53:37] <strcat> DWARF CFI doesn't work if you do a stack switch
[06:53:43] <strcat> it needs frame pointers to follow the call stack up
[06:53:48] <strcat> I don't know why
[06:54:03] <pcwalton> weird
[06:54:59] * strcat won't worry about it
[06:55:08] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[06:55:26] <strcat> currently enabled on OS X and also when debugging info is on
[06:55:31] <strcat> so debugging info uses a register
[06:55:35] <strcat> which is a bad sad
[06:55:49] <strcat> but you can't mix LLVM optimizations and debug info atm anyway
[06:56:42] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[06:56:42] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/jaKG0w
[06:56:42] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[06:59:17] <nrc> is there an easy way to look up the NodeId of self in a method now? I.e., what Method::self_id used to do?
[06:59:54] <eddyb> nrc: first argument
[07:01:13] <nrc> |method.decl.inputs[0].id| ?
[07:01:14] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[07:01:14] *** ChanServ sets mode: +o tjc
[07:01:34] <eddyb> nrc: possibly. first check for explicit_self != SelfStatic
[07:01:44] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[07:01:44] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/MmYdkw
[07:01:44] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[07:02:02] <eddyb> nrc: and what's with ||? it's weird, considering the context. we tend to use `` if we need delimiters :/
[07:02:46] <nrc> I thought it was the standard way to say code - my irc client even puts it in a monospace font :-)
[07:03:38] <strcat> nrc: `foo` is markdown
[07:03:42] <strcat> github understands it
[07:04:02] <strcat> and rust uses it for docs so that's why everyone uses it ;p
[07:04:29] * nrc learns a new convention
[07:04:34] <pcwalton> yeah, |foo| is the Gecko way
[07:04:40] <pcwalton> `foo` is the Rust way
[07:04:44] <pcwalton> GitHub knows `foo` so
[07:04:49] <pcwalton> I think that's how it started
[07:04:57] * strcat has seen |foo| on the firefox bugzilla and thought it was really weird...
[07:05:04] <nrc> I'll add it to my list of things I don'
[07:05:06] <pcwalton> yeah, it's mostly a Gecko-ism AFAICT
[07:05:12] <nrc> t like about GitHub
[07:05:15] <strcat> pcwalton: in the linux irc channels I hang out in, people use `foo' :)
[07:05:19] <pcwalton> but it sounds like some other people use it too if your IRC client supports it
[07:05:26] <pcwalton> ack, GNU-ism :(
[07:05:44] * dbaupp 's client understands |foo| too
[07:05:45] <nrc> my irc client is chatzilla - it might well be just a Gecko thing
[07:05:51] *** Quits: erickt (Adium@991D7890.9C346C7F.FAA4474F.IP) (Quit: Leaving.)
[07:05:57] <pcwalton> probably a Netscape thing, ultimately :)
[07:06:04] <strcat> everything should be in monospace font so you can see ascii art :(
[07:06:07] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[07:06:08] <nrc> history!
[07:06:19] <strcat> rustilite: fn main() {}
[07:06:21] <nrc> strcat: agreed, lief is so much simpler in monospace
[07:06:26] <nrc> *life
[07:06:36] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[07:06:36] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/8ZOIDQ
[07:06:36] <ghrust> 13rust/06auto 142d7e45d 15Jeff Olson: pull extra::{serialize, ebml} into a separate libserialize crate...
[07:06:36] <ghrust> 13rust/06auto 14feb927f 15bors: auto merge of #11984 : olsonjeffery/rust/libserialize, r=alexcrichton...
[07:06:36] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[07:06:38] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[07:06:38] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/MmYdkw
[07:06:38] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[07:06:41] <strcat> unicode is certainly simpler with monospace
[07:06:48] <strcat> no ligatures... grapheme == glyph
[07:06:55] <pcwalton> so regarding the memmoves in servo, it's more complicated than I had assumed -- basically if LLVM ever sees a destructor on a struct if that dtor doesn't get inlined SROA will just bail
[07:07:04] <pcwalton> so I gave up and refactored Servo to eliminate the memmoves through DPS
[07:07:10] <pcwalton> the APIs are slightly cleaner now anyway
[07:07:12] <strcat> DPS?
[07:07:26] <pcwalton> destination passing style -- in this context, "return value optimization"
[07:07:30] <pcwalton> as C++ calls it
[07:07:37] <strcat> so, output parameters?
[07:07:48] <pcwalton> just "using the return value" instead of moving large structs everywhere :)
[07:07:49] <pcwalton>  6 files changed, 34 insertions(+), 52 deletions(-)
[07:07:52] <pcwalton> it's cleaner now anyway
[07:08:06] <pcwalton> the win was 5% on flow construction
[07:08:14] <pcwalton> "mov" in L1 cache barely hurts anything
[07:08:19] <pcwalton> it just clutters up the generated code
[07:08:23] <eddyb> check this out https://github.com/mozilla/rust/pull/12030#issuecomment-34142405
[07:08:41] <strcat> why is it faster?
[07:08:44] <dbaupp> eddyb: before/after?
[07:08:49] <strcat> well, cleaner
[07:09:01] <dbaupp> eddyb: (as in, are the two IRs before vs. after?)
[07:09:09] <eddyb> dbaupp: yes, forgot to add that
[07:09:19] <dbaupp> eddyb: and without opts?
[07:09:20] * eddyb feels like slapping whoever thought everyone needed the cost of @Trait -> &Trait conversion should be applied to everyone
[07:09:35] <eddyb> dbaupp: of course, most of that nonsense gets optimized out
[07:09:53] <dbaupp> eddyb: the new IR looks *very* nice!
[07:10:06] <eddyb> the function is, after all, equivalent to free
[07:10:10] <pcwalton> that's very nice
[07:10:41] *** Quits: canhtak (canhtak@moz-8A625E1D.wl.t.ulaval.ca) (Quit: canhtak)
[07:10:45] <eddyb> pcwalton: there's another copy for calling a trait method, that I'll remove later
[07:11:56] <eddyb> less optimizations we need to devirtualize, less possible breaking points
[07:12:01] *** Joins: gwty (gwtypc@AF2C22C3.5FE41E70.45DA6411.IP)
[07:12:16] <pcwalton> I had some crazy thoughts around devirtualization
[07:12:40] <pcwalton> if we only have one implementor of a private trait then devirtualize all calls to it
[07:12:58] <eddyb> pcwalton: what's the context?
[07:12:59] *** Quits: tabraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net) (Connection reset by peer)
[07:13:00] <pcwalton> the use case here is libgreen/libnative
[07:13:06] <pcwalton> if we structured things properly
[07:13:14] <strcat> pcwalton: but it's supported dynamically
[07:13:18] <pcwalton> if you only used libnative you could maybe devirtualize the entire task context
[07:13:20] <eddyb> ahh. I wanted to solve that one with weak constant trait objects
[07:13:23] <strcat> ah
[07:13:35] <pcwalton> have to of course structure things right
[07:13:37] <eddyb> but I don't know how to handle conflict resolution
[07:13:37] <strcat> pcwalton: what if you dlopen libgreen?
[07:13:48] <eddyb> strcat: I don't think we should support that
[07:13:55] <pcwalton> has to be structured right so that the trait becomes private to only libgreen/libnative
[07:14:00] <strcat> dlopen of rust crates? or just libgreen
[07:14:01] <pcwalton> anyway it's just an idea
[07:14:09] <pcwalton> so you couldn't dlopen libgreen
[07:14:29] * strcat still can't decide how to fix this :(
[07:14:32] <eddyb> that is, with my weak symbol idea, it has to be dynamically resolved (TLS/whatnot) if and only if multiple crates provide it
[07:14:52] <strcat> drop simplified_glue_type for boxes + pass size to exchange_free and make 0 size a no-op
[07:14:54] <strcat> or...
[07:15:14] <strcat> stop generating exchange_free calls for zero-size types, but the size can't be passed due to glue simplification
[07:15:42] <eddyb> strcat: I told you how to handle the free situation. and just don't use the simplified glue for zero-sized types
[07:15:42] <strcat> passing the size would be nice for a better allocator than malloc/free...
[07:15:48] <strcat> eddyb: I already did that
[07:15:58] <strcat> but I still want the size ;s
[07:16:09] <eddyb> strcat: pass it but don't branch on it
[07:16:18] <pcwalton> optimizing moves via emplace()-like APIs seems barely worth it
[07:16:19] <strcat> true
[07:16:39] <pcwalton> it does help a little bit if your structs are enormous but at least on x86 movs don't hit the ALU and are basically free
[07:16:52] <eddyb> strcat: you can branch in a wrapper for Vec, but not in the lang item
[07:16:57] <strcat> pcwalton: but what if we support having a move run code like C++? for gc roots
[07:17:12] <pcwalton> then we can revisit that.
[07:17:26] <strcat> eddyb: Vec doesn't use the lang item
[07:17:30] <strcat> at least, it doesn't have to
[07:17:42] <pcwalton> (although I don't see why a GC affects this; moves only happen from locals in Rust and locals are all handled via a stack map.)
[07:17:46] <eddyb> pcwalton: if we have a rust-specific weak-symbol-like system, with explicitly handled conflict resolution, then we can easily fix this
[07:18:28] <strcat> pcwalton: well, assuming there's a stack map then maybe it's not required ;p
[07:19:41] <strcat> why do spidermonkey/blink do the double indirection thing again?
[07:19:46] <strcat> I forget
[07:19:55] <strcat> smart_ptr -> gc_ptr -> object
[07:19:56] <eddyb> s/blink/v8/?
[07:20:07] <eddyb> strcat: the handles?
[07:20:09] <strcat> same thing ;p
[07:20:11] <strcat> eddyb: yes
[07:20:24] <eddyb> PersistentHandle may have a refcount, so I guess that's what you're referring to. or idk
[07:20:43] <strcat> I mean the pointers they use in C++ for gc objects are really pointers to gc object ptrs
[07:21:06] <eddyb> I guess v8 doesn't GC through C++ code
[07:21:20] <dbaupp> strcat: so they can rewrite them
[07:21:26] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[07:21:28] <dbaupp> for moving GC, aiui
[07:21:36] <strcat> dbaupp: but they could rewrite them on the C++ stack?
[07:21:47] <strcat> by using move ctors
[07:21:47] <dbaupp> strcat: not precisely?
[07:21:51] <strcat> or copy ctors
[07:21:53] <strcat> dbaupp: why?
[07:21:54] <dbaupp> oh, mayb
[07:21:55] <dbaupp> e
[07:21:57] <strcat> they can register themselves
[07:22:04] * strcat shrugs
[07:22:08] <dbaupp> I'm sure they have a good reason, given mozilla know how to write C++ :)
[07:22:12] <strcat> I have a feeling the 'why' is 'it's C++03'
[07:22:12] <eddyb> and they do this weird thing where a Persistent with a refcount of 1 is considered weak, and if it's the only link in a cycle, it can be collected
[07:22:40] <eddyb> strcat: v8 hasn't used C++11 features until an year or so ago
[07:22:54] <eddyb> if they even use them at all
[07:23:04] <strcat> LLVM does starting this week!
[07:23:16] <strcat> and not just in LLD anymore :)
[07:23:23] <eddyb> can we just rewrite it in Rust?
[07:23:47] <strcat> good luck
[07:23:52] <eddyb> parts of it look like C, others like ObjC/Java
[07:23:56] <strcat> designed with inheritance in mind
[07:24:12] <eddyb> fields in traits
[07:24:15] <strcat> eddyb: llvm mostly looks like java with a bit of modern c++ ;p
[07:24:28] <strcat> uses java-style class design
[07:24:59] <eddyb> their inheritance nonsense can be reimplemented cleanly in Rust, given one or two features
[07:25:09] <strcat> ugly features
[07:25:15] <eddyb> what, DST?
[07:25:17] <strcat> mno
[07:25:19] <strcat> no*
[07:25:23] <eddyb> field access in traits?
[07:25:25] <strcat> eddyb: rust is going to get single inheritance ;s
[07:25:31] <eddyb> pls no
[07:25:31] <strcat> for structs.
[07:25:36] <eddyb> pls pls no
[07:25:42] <strcat> eddyb: I agree, but it is going to get it
[07:25:51] <strcat> and I'll be sad
[07:26:15] <strcat> eddyb: find a better way to do the DOM in servo please then
[07:26:24] <eddyb> strcat: I know already how to!
[07:26:27] <strcat> do it
[07:26:34] <strcat> save us from class inheritance
[07:26:41] <eddyb> explicitely positioned trait fields
[07:26:49] <eddyb> like in capn-proto
[07:27:21] <strcat> eddyb: https://github.com/mozilla/rust/pull/12045/files ;s
[07:27:59] <eddyb> looks good
[07:28:16] <strcat> also changed those to i8 so they don't cast
[07:28:17] <eddyb> trait Node { parent: *Node @ 0; next: *Node @ 1; ... }
[07:28:34] <eddyb> yeah, sorry for (), bad call on my part
[07:28:50] <strcat> it's silly to try simplifying glue anyway
[07:28:53] <strcat> doesn't work for library types
[07:29:02] <strcat> won't work for Vec/Uniq types
[07:29:06] <strcat> need mergefunc
[07:29:15] <strcat> (outside of traits this stuff is all inlined anyway)
[07:30:09] <eddyb> if you don't specify "@ i", it's not fixed-position, so you can't get free access via a trait object. virtual field access is completely optional
[07:30:17] <strcat> eddyb: we should make TyDesc only used by reflect
[07:30:28] <strcat> eddyb: 1) remove drop glue from the TyDesc
[07:30:33] <strcat> make a separate drop glue table
[07:30:46] <strcat> well, there's no 2
[07:30:53] <strcat> I'll do it
[07:30:55] <eddyb> strcat: and then we can refactor reflect to require 0 indirection
[07:31:01] <strcat> I don't care about reflect
[07:31:03] <strcat> ;p
[07:31:05] <eddyb> or just remove it
[07:31:19] *** Quits: dbaupp (Thunderbir@2702835C.D5A1DCF.37681C44.IP) (Ping timeout)
[07:31:33] <strcat> or make it warn when you use "{:?}"
[07:31:52] <nrc> Is there a way to convert an Ident to a str? There used to be Token::ident_to_str. get_ident isn't quite what I want
[07:32:12] <eddyb> nrc: ident_to_str was replaced *with something*
[07:32:19] * strcat tries to stay far away from the parser :(
[07:32:35] <eddyb> nrc: is this for checking if an ident is "self"? (I hope not)
[07:32:53] *** Quits: gwty (gwtypc@AF2C22C3.5FE41E70.45DA6411.IP) (Ping timeout)
[07:32:59] <strcat> self is a keyword now so that's easier
[07:33:02] <nrc> eddyb no !
[07:33:03] <eddyb> strcat: auto-derived Show would do what I wanted to rewrite reflect to anyways
[07:33:16] <eddyb> nrc: okay then, use whatever ident_to_str was replaced with :P
[07:33:30] <strcat> eddyb: auto-derived == you can't not have it?
[07:33:32] <nrc> thanks, that's helpful :-p
[07:33:42] <strcat> eddyb: worse code bloat than visit glue ;\
[07:33:58] <eddyb> strcat: no, I mean #[deriving(Show)] instead of implementing it yourself
[07:34:55] <strcat> oh
[07:35:06] <strcat> eddyb: anyway I broke debugging hash tables with reflect
[07:35:21] <strcat> rusti: std::hashmap::HashSet::<int>::new()
[07:35:29] <strcat> .
[07:35:32] -rusti- failed to pastebin 1 lines of output
[07:35:35] <strcat> rusti: std::hashmap::HashSet::<int>::new()
[07:35:38] -rusti- pastebinned 1 lines of output: http://ix.io/akm
[07:35:49] *** Quits: zv (zv@moz-955F83E9.hsd1.ca.comcast.net) (Ping timeout)
[07:35:57] <strcat> eddyb: rusti needs reflect ;(
[07:36:01] <strcat> well, it needs *something*
[07:36:16] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[07:36:40] <strcat> needs to work for all types whether or not they have Show
[07:36:56] <eddyb> strcat: we can have a compile-time-resolved reflect that is generic and whatnot instead of the current mess
[07:37:10] <eddyb> and can query things like size_of or align_of
[07:37:26] <nrc> hmm, the replacement seems to be get_ident(ident.name).get() - that looks like it would benefit from a helper method
[07:38:02] <eddyb> nrc: I think .get() returns something with the lifetime of the result of get_ident
[07:38:29] <nrc> Urgh, how do I convert the INternedString to a str?
[07:39:10] <nrc> the replacement code does .get.to_owned(), but the to_owned just copies, I guess
[07:40:06] <eddyb> nrc: you can probably get a &str with no copies
[07:40:34] <nrc> I si tpossible to jump from a commit to the PR/issue on GitHub?
[07:40:48] <eddyb> nrc: next to the branch name
[07:40:59] <eddyb> it might require you to be at the HEAD of the branch
[07:41:18] <nrc> oh, maybe that's why I can't do it
[07:41:28] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[07:41:29] *** ChanServ sets mode: +o tjc
[07:43:34] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[07:46:42] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[07:46:42] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14feb927f to 144509b49: 02http://git.io/N3iJvQ
[07:46:42] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[07:46:44] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[07:46:44] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/HrjzyA
[07:46:44] <ghrust> 13rust/06auto 148d8c783 15Nick Cameron: Check for trait impl conflicts across crates
[07:46:44] <ghrust> 13rust/06auto 141bcc73f 15bors: auto merge of #12023 : nick29581/rust/err_res, r=alexcrichton...
[07:46:44] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[07:47:33] <strcat> eddyb: you know what would be kind of cool
[07:47:57] <strcat> eddyb: well, not in rust
[07:48:08] <strcat> rust cares too much about good error messages
[07:48:30] <strcat> eddyb: have xs[i] be bounds checked, and make a compile-time error if it doesn't optimize out ;p
[07:48:34] <strcat> who needs dependent typing anyway!
[07:49:00] <eddyb> strcat: I had a similar idea, but on a much larger scale
[07:49:15] <eddyb> strcat: hard to apply because of the dynamic green/native nonsense
[07:49:34] <eddyb> require nounwind on main :P
[07:49:59] <eddyb> I thought I would have to transform functions into predictors
[07:50:12] <eddyb> but LLVM already has a notion of "can unwind"
[07:50:37] <eddyb> with a static libnative setup, this should be relatively easy to get
[07:53:54] <strcat> or just drop unwinding support
[07:54:00] <strcat> who needs that anyway? ;p
[08:04:11] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[08:05:10] *** flaper87|afk is now known as flaper87
[08:11:11] <eddyb> slight problem with my plan :(
[08:11:35] <eddyb> right now crate metadata stores the full path for each item
[08:12:40] <acrichto> strcat: re cow arcs, we're generally lowering the bar for code coming into the assorted libraries in the compiler (for now at least), and it sounded like that was a popular feature in one form or another, I'd certainly entertain a PR to merge the two
[08:13:00] <eddyb> and my plan requires all parents to be in the ast_map. it's a waste of IDs the way we do it now
[08:14:09] <eddyb> and, well, I would have to bring in all the parents, which means their entire crates
[08:14:16] *** Quits: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP) (Ping timeout)
[08:14:55] *** Joins: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP)
[08:17:04] *** Joins: jensnock_ (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[08:17:11] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[08:20:20] *** Joins: doener (doener@moz-C68F600D.unity-media.net)
[08:21:30] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[08:28:24] *** Joins: Zr40 (zr40@EE4BB9F5.926C319A.BE2F4011.IP)
[08:29:10] *** Joins: dbaupp (Thunderbir@moz-25BBAF91.lns20.syd6.internode.on.net)
[08:40:59] <eddyb> PathPrettyName is silly. we don't actually need the hash :/
[08:41:21] <eddyb> we did when we were using __extensions__
[08:45:48] *** Joins: jsonnull (Thunderbir@26F61E6.CFD9471D.494A0F8B.IP)
[08:52:42] *** Quits: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP) (Client exited)
[08:52:49] *** Quits: jensnock_ (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[08:53:20] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[08:53:33] *** Joins: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP)
[08:56:39] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[08:56:39] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/HrjzyA
[08:56:39] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[08:58:28] *** Quits: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP) (Ping timeout)
[08:58:52] *** Joins: canhtak (canhtak@moz-8A625E1D.wl.t.ulaval.ca)
[08:59:03] *** Joins: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP)
[09:01:40] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[09:01:40] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/nbsi6A
[09:01:40] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[09:06:35] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[09:06:35] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/nbsi6A
[09:06:35] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[09:06:37] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[09:06:37] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/Fdu6Jw
[09:06:37] <ghrust> 13rust/06auto 1438f2526 15James Deng: Feature gate all quasi-quoting macros.
[09:06:37] <ghrust> 13rust/06auto 14124938b 15James Deng: Replaced with a single "quote" feature gate.
[09:06:37] <ghrust> 13rust/06auto 1453864ce 15bors: auto merge of #12025 : lilac/rust/feature-gate-quote, r=brson...
[09:06:39] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[09:08:37] *** Quits: canhtak (canhtak@moz-8A625E1D.wl.t.ulaval.ca) (Quit: canhtak)
[09:12:52] *** Joins: aurynj_ (Eon@583ABBE5.60FA2E28.B9E25744.IP)
[09:12:53] *** Quits: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP) (Quit: Leaving)
[09:13:01] *** Quits: aurynj_ (Eon@583ABBE5.60FA2E28.B9E25744.IP) (Connection reset by peer)
[09:13:04] *** Joins: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP)
[09:13:52] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[09:19:38] *** Joins: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com)
[09:21:38] * eddyb checks back::link again
[09:22:32] <eddyb> nevermind, it's too hard. though it could work very well for generics
[09:22:59] <eddyb> what I wanted to possibly announce is that we don't always need the symbol hash
[09:30:59] *** Joins: rca (rcatolino@moz-BC04AA53.adsl.proxad.net)
[09:37:04] *** Quits: sokomo (sokomo@8293D4FC.93FF164A.408809BB.IP) (Quit: Read error: Connection reset by peer)
[09:45:12] *** Quits: lpy (lpy@51E8C831.DDD9F058.E99F7FDB.IP) (Ping timeout)
[09:47:22] *** Joins: lpy (lpy@46283DA3.A491F94C.65042015.IP)
[09:49:50] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[10:00:36] *** Quits: rca (rcatolino@moz-BC04AA53.adsl.proxad.net) (Ping timeout)
[10:05:57] *** kimundi is now known as zz_kimundi
[10:10:51] *** Quits: lpy (lpy@46283DA3.A491F94C.65042015.IP) (Ping timeout)
[10:10:53] *** Joins: rca (rcatolino@moz-BC04AA53.adsl.proxad.net)
[10:11:39] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[10:11:39] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Fdu6Jw
[10:11:39] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[10:11:46] *** Joins: lpy (lpy@46283DA3.A491F94C.65042015.IP)
[10:13:36] *** Joins: lpy_ (lpy@798FF4A9.F4539CBC.E99F7FDB.IP)
[10:14:03] *** Quits: lpy (lpy@46283DA3.A491F94C.65042015.IP) (Ping timeout)
[10:16:35] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[10:16:35] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/B9d3WA
[10:16:35] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[10:18:23] *** Quits: eddyb (eddy@832D2DE5.66315F97.FB866788.IP) (Connection reset by peer)
[10:21:38] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[10:21:38] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/B9d3WA
[10:21:38] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[10:21:41] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[10:21:41] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/STxCQg
[10:21:41] <ghrust> 13rust/06auto 14b37700c 15Alex Crichton: Invoke gcc with -nodefaultlibs...
[10:21:41] <ghrust> 13rust/06auto 14b656a9b 15bors: auto merge of #12031 : alexcrichton/rust/nodefaultlibs, r=brson...
[10:21:42] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[10:22:39] *** Joins: eddyb (eddy@moz-92B95652.residential.rdsnet.ro)
[10:25:43] <eddyb> what? it attempted to merge *and* failed?
[10:28:00] <flaper87> dbaupp: do you happen to know what was the PR you wrote to improve the way variables where printed? <VI0> etc
[10:28:33] <flaper87> dbaupp: also, did you also changed the way regions are printed? not sure if that still applies, TBH. 
[10:28:37] <flaper87> dbaupp: I'm triaging this bug: https://github.com/mozilla/rust/issues/2632
[10:29:03] *** Quits: Luqman (laden@moz-AB7945E9.csclub.uwaterloo.ca) (Ping timeout)
[10:29:30] <dbaupp> flaper87: I did not touch regions
[10:29:52] <dbaupp> flaper87: https://github.com/mozilla/rust/pull/11513
[10:30:00] <flaper87> dbaupp: thanks for the info!
[10:31:19] <dbaupp> flaper87: I don't think the current format should be the final format, fwiw
[10:31:33] <dbaupp> and I'm not sure about the region variables part of it at all...
[10:31:35] * dbaupp thinks
[10:32:05] <flaper87> dbaupp: yeah, it's definitely better but it could be improved
[10:32:19] <flaper87> for instance, I wonder if we really need "generic" to be part of the message
[10:33:58] <eddyb> dbaupp: rebased, r=pcwalton? https://github.com/mozilla/rust/pull/12030
[10:36:15] <flaper87> eddyb: nice work there! must hae been painful!
[10:36:26] <eddyb> flaper87: easier than you'd think
[10:36:46] <flaper87> eddyb: then even better! 
[10:36:55] <dbaupp> eddyb: r-, it's too good to be true
[10:37:04] <flaper87> lol
[10:37:35] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Client exited)
[10:37:54] <eddyb> dbaupp: that makes me think of that blood type thing. it also starts with "r", doesn't it?
[10:37:56] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[10:38:24] *** Quits: lpy_ (lpy@798FF4A9.F4539CBC.E99F7FDB.IP) (Ping timeout)
[10:39:39] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Ping timeout)
[10:39:57] *** Joins: lpy (lpy@798FF4A9.F4539CBC.E99F7FDB.IP)
[10:42:24] <dbaupp> eddyb: ?
[10:42:32] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[10:43:09] <eddyb> dbaupp: Oâ‚‹ and Oâ‚Š
[10:43:28] <eddyb> dbaupp: this https://en.wikipedia.org/wiki/Rh_blood_group_system
[10:46:33] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[10:46:33] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/CC3T8A
[10:46:33] <ghrust> 13rust/06auto 14dde380d 15Eduard Burtescu: Removed @self and @Trait.
[10:46:33] <ghrust> 13rust/06auto 144bc9592 15bors: auto merge of #12030 : eddyb/rust/kill-at-self-and-trait, r=pcwalton
[10:46:33] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[10:58:50] * eddyb loves this. with a parent node ID for each node, the only node that has contents larger than a pointer is NodeForeignItem(@ForeignItem, AbiSet, Visibility)
[10:59:02] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Connection reset by peer)
[10:59:24] *** Quits: zimbabao (rajaram@47769425.AE842F9B.81C3DAA1.IP) (Ping timeout)
[10:59:58] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[11:00:39] *** Quits: rca (rcatolino@moz-BC04AA53.adsl.proxad.net) (Ping timeout)
[11:02:02] <dbaupp> r? https://github.com/mozilla/rust/pull/12047
[11:07:58] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[11:15:28] *** zz_kimundi is now known as kimundi
[11:16:35] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[11:16:35] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 144bc9592 to 1453864ce: 02http://git.io/N3iJvQ
[11:16:35] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[11:16:38] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[11:16:38] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/IwbPdQ
[11:16:38] <ghrust> 13rust/06auto 1487d026b 15chromatic: Improved pattern-match code and explanation....
[11:16:38] <ghrust> 13rust/06auto 14ed885e3 15bors: auto merge of #12035 : chromatic/rust/tutorial_improvements, r=alexcrichton...
[11:16:38] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[11:17:00] *** Joins: rca (rcatolino@moz-BC04AA53.adsl.proxad.net)
[11:18:58] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[11:19:54] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[11:32:42] *** Quits: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com) (Client exited)
[11:34:53] *** Joins: jensnock_ (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[11:35:33] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[11:38:15] *** Joins: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com)
[11:39:28] <eddyb> dbaupp: sigh, I forgot about stdtest. that one uses *so much RAM* it's not even funny
[11:39:51] <dbaupp> eddyb: to compile?
[11:39:56] <eddyb> yeah
[11:40:09] <eddyb> it's the main reason I don't run full check
[11:40:46] <dbaupp> worse than librustc?
[11:41:30] <eddyb> yupp
[11:41:50] <eddyb> librustc builds fine, then stdtest starts swapping
[11:43:57] <eddyb> dbaupp: what is this? pub fn decl_gc_metadata(ccx: &CrateContext, llmod_id: &str) {
[11:44:07] <dbaupp> never seen it
[11:44:58] <eddyb> can we remove it?
[11:45:19] <dbaupp> no idea
[11:45:19] <eddyb>     if !ccx.sess.opts.gc || !ccx.uses_gc { return; }
[11:45:37] <eddyb> sounds like something from one of strcat's dreams
[11:45:39] <eddyb> (or nightmares)
[11:48:19] *** Quits: rca (rcatolino@moz-BC04AA53.adsl.proxad.net) (Ping timeout)
[11:51:10] <eddyb> dbaupp: this is silly. the module map is only used by that pointless gc_metadata thing and loglevel
[11:51:32] <eddyb> I feel like I should kill loglevel, or at least its current hacky implementation
[11:51:42] *** Quits: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com) (Client exited)
[11:53:55] *** Joins: zimbabao (rajaram@42E94F62.F12708BC.D2D1FAF0.IP)
[11:54:15] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[11:55:22] <dbaupp> eddyb: don't you dare kill loglevel until you have something better implemented
[11:55:53] *** Quits: zimbabao (rajaram@42E94F62.F12708BC.D2D1FAF0.IP) (Ping timeout)
[11:56:09] *** Joins: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com)
[12:00:37] *** Quits: jensnock_ (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[12:05:48] *** Quits: lpy (lpy@798FF4A9.F4539CBC.E99F7FDB.IP) (Ping timeout)
[12:06:11] <eddyb> dbaupp: I can at least rename the rust_mod_map to rust_loglevel_map
[12:08:34] *** Joins: rca (rcatolino@moz-BC04AA53.adsl.proxad.net)
[12:08:56] *** Joins: lpy (lpy@798FF4A9.F4539CBC.E99F7FDB.IP)
[12:09:00] <eddyb> wait, there's no mention of rust_mod_map in src/lib*, what's setting those levels o_O?
[12:10:05] *** Quits: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com) (Client exited)
[12:10:08] *** Joins: jdm (jdm@5D5A6787.1B2BE23A.74119F78.IP)
[12:10:13] <dbaupp> src/libstd/rt/...
[12:10:26] <dbaupp> crate_map
[12:10:46] <eddyb> but the info is in the mode_map
[12:10:53] <eddyb> *mod_map. but maybe I'm just stupid
[12:11:02] <dbaupp> the crate map stores a pile of ModMaps
[12:11:05] <dbaupp> iirc.
[12:11:11] *** Joins: zimbabao (rajaram@1BB71A49.5F661045.D2D1FAF0.IP)
[12:11:17] <dbaupp> ModEntry's
[12:11:30] <dbaupp> (I assume it could be a naming mismatch)
[12:12:59] <eddyb> nah, it's fine, _rust_mod_map is the local module, referenced from the crate_map
[12:13:42] <eddyb> #[crate_map] we have an attribute for a feature used only by log_level? wow
[12:13:55] <dbaupp> debugging is quite nice :)
[12:14:07] <dbaupp> we even have an AST expr for it :P
[12:14:14] <dbaupp> (at least we used to)
[12:14:20] *** Quits: zimbabao (rajaram@1BB71A49.5F661045.D2D1FAF0.IP) (Ping timeout)
[12:14:21] <eddyb> dbaupp: pretty sure we still do
[12:14:31] <dbaupp> ExprLogLevel
[12:14:55] <eddyb> that's silly, we should be able to handle a call to an intrinsic
[12:15:53] *** Joins: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com)
[12:16:01] <eddyb> ::std::unstable::intrinsics::get_mod_data::<u32>("loglevel")
[12:17:00] <eddyb> it's technically a module-level static
[12:17:32] <eddyb> event_loop_factory: Option<fn() -> ~EventLoop>
[12:17:44] <eddyb> is that even used?
[12:20:44] <eddyb> src/librustuv/uvio.rs:#[lang = "event_loop_factory"]
[12:21:07] <eddyb> how come we have something neat like that and we can't distinguish between native/green and native+green?
[12:21:11] <eddyb> acrichto: ^^^^
[12:21:21] <eddyb> we need to stop being so silly
[12:21:52] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[12:22:53] *** Quits: lpy (lpy@798FF4A9.F4539CBC.E99F7FDB.IP) (Ping timeout)
[12:26:37] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[12:26:37] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/IwbPdQ
[12:26:37] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[12:27:12] *** Joins: lpy (lpy@65BED62B.2153E224.E99F7FDB.IP)
[12:29:23] <flaper87> dbaupp: r? https://github.com/mozilla/rust/pull/12017
[12:54:26] * dbaupp found an instance when concat_idents! actually works \o/
[13:05:59] *** Quits: lpy (lpy@65BED62B.2153E224.E99F7FDB.IP) (Quit: Leaving...)
[13:07:49] *** Joins: lpy (lpy@65BED62B.2153E224.E99F7FDB.IP)
[13:08:42] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[13:11:21] <eddyb> dbaupp: hmm. I think Rc<str> is similar to what LLVM uses
[13:12:25] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Ping timeout)
[13:17:34] *** Quits: lpy (lpy@65BED62B.2153E224.E99F7FDB.IP) (Ping timeout)
[13:18:48] *** Joins: lpy (lpy@65BED62B.2153E224.E99F7FDB.IP)
[13:23:22] <doener> heh, just wondered how clang gets to generate calls to lifetime.{start,end} in some cases and found absolutely nothign
[13:23:54] <doener> turns out that they make use of the "byval" attribute, and llvm itself takes care of declaring lifetimes then
[13:24:26] <dbaupp> can we use it?
[13:24:41] *** Joins: lpy_ (lpy@FA66696A.6C1907BC.E99F7FDB.IP)
[13:24:56] *** Quits: lpy (lpy@65BED62B.2153E224.E99F7FDB.IP) (Ping timeout)
[13:25:17] *** lpy_ is now known as lpy
[13:25:48] <doener> dbaupp: there's an open ticket about it
[13:26:04] <doener> dbaupp: it has both advantages as well as disadvantages
[13:27:10] <doener> dbaupp: advantage is implicit lifetimes, one register less for arguments (byval arguments have a fixed offset on the stack), and llvm can omit certain copies for e.g. tailcails
[13:27:55] <doener> dbaupp: disadvantages are that llvm cannot omit certain copies that we could omit manually, e.g. when the stack offset is different between two functions
[13:28:31] <doener> dbaupp: or when we know that the caller's copy isn't used anymore after the call
[13:29:07] <doener> https://github.com/mozilla/rust/issues/10030
[13:29:42] <doener> hm, I should probably add the above with some IR samples to the issue...
[13:29:47] <doener> when I get home...
[13:30:58] <dbaupp> ah, I see
[13:52:20] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[13:59:48] *** Joins: gimpf (gimpf@moz-8EE4C1B0.adsl.highway.telekom.at)
[14:18:51] *** Joins: erickt (Adium@991D7890.9C346C7F.FAA4474F.IP)
[14:22:53] *** Quits: jdm (jdm@5D5A6787.1B2BE23A.74119F78.IP) (Quit: Lost terminal)
[14:29:30] <nmatsakis> ok, so you can write Foo<A,..X,B> with any generic type Foo
[14:29:32] <nmatsakis> eddyb: ^
[14:29:44] <eddyb> well, if X is not a tuply type param of a function, then X has to have the right number of types
[14:30:01] <nmatsakis> what does that mean 
[14:30:09] <nmatsakis> i.e., it must be a tuple?
[14:30:19] <nmatsakis> like Foo<A,..(B,C),D>
[14:30:28] <eddyb> it can be a type alias
[14:30:35] <eddyb> and if we had associated types, one of those
[14:30:53] <nmatsakis> a type alias is basically a macro, so we can ignore that...
[14:31:21] <eddyb> in that case, Foo has to have exactly 4 type params, or be variadic, otherwise it's a type error
[14:31:22] <nmatsakis> if it were an associated type, it'd have to be a "tuply" associated type or something like that? (does that even make sense?)
[14:31:42] <eddyb> the resolved associated type would have to be tuply (I guess it makes sense)
[14:32:08] <nmatsakis> it doesn't really make sense to me, actually, but let's leave it aside for now. it seems to resemble a bound rather than a `..` syntax like thing
[14:32:24] <nmatsakis> anyway, ok, so let's say that X is a tuply type parameter, e.g.:
[14:32:39] <nmatsakis> fn f<..X>() { let v: Foo<A,..X,D> = ...; }
[14:32:55] <eddyb> in that case, Foo has to be variadic and take at least 2 type params
[14:32:58] <nmatsakis> ok
[14:33:13] <nmatsakis> (this makes sense)
[14:33:28] * nmatsakis opens up an emacs window to take notes
[14:33:33] <eddyb> Foo<T, U, ..Rest>, Foo<T, ..Rest, U> or Foo<..Rest, T, U>
[14:34:07] <eddyb> (the way I want to implement this is with start/end positions on type params, that can be negative to signify "from the end")
[14:34:49] <nmatsakis> ok, I'm trying to rationalize this into a grammar just now
[14:34:55] <nmatsakis> https://etherpad.mozilla.org/aUfhQ8NJpt
[14:35:47] * eddyb has to remember the grammar of formal grammar :P
[14:36:31] <nmatsakis> I'm using T... to mean "0 or more T's"
[14:36:38] * nmatsakis influenced by Redex
[14:37:18] <eddyb> N<T..., ".." E, T...> // I think that's missing the case where you have multiple "expandos"
[14:37:24] <nmatsakis> I did that on purpose
[14:37:33] <nmatsakis> because I tohught they weren't allowed :)
[14:37:54] <eddyb> they wouldn't have much use
[14:38:05] <nmatsakis> (at this moment, I'm just trying to figure out what you have in mind; I reserve judgement on whether it holds together till I understand it fully ;)
[14:38:13] <nmatsakis> ok, but if they are allowed that changes the grammar yes
[14:39:19] <nmatsakis> ok, so, in a declaration,
[14:39:32] <nmatsakis> one type parameter can be declared as ..T, and it must be first or last?
[14:40:03] <eddyb> nmatsakis: actually, I was wrong about that. it just has to be the only one
[14:40:11] <nmatsakis> ok
[14:40:34] <eddyb> and no default type params, I don't think we can disambiguate between the two
[14:40:46] <nmatsakis> I'll use the term variadic to describe a type parameter declared as ..X
[14:41:04] <nmatsakis> (as well as a type that includes a variadic type parameter)
[14:41:44] <nmatsakis> (it's not clear to me that we hvae to forbid default type parameters altogether)
[14:41:55] *** Joins: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk)
[14:41:59] <nmatsakis> ah well I guess we do
[14:42:52] <nmatsakis> eddyb: so let's exclude "trivial" constructions like ..(A,B) from the model
[14:42:53] *** Joins: canhtak (canhtak@moz-8A625E1D.wl.t.ulaval.ca)
[14:43:00] <nmatsakis> eddyb: if I'm not mistaken, those can just be normalized to A,B
[14:43:04] <nmatsakis> is that right?
[14:43:04] <eddyb> nmatsakis: those are expanded in astconv
[14:43:17] <nmatsakis> right but it's a trivial syntactic sugar
[14:43:21] <eddyb> yupp
[14:43:47] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[14:45:27] <nmatsakis> eddyb: above, you wrote that if I have fn<..X>() { let v: Foo<A,..X,D> = ...; }
[14:45:34] <nmatsakis> then Foo must be variadic and take at least 2 parameters
[14:45:42] <eddyb> wait, no
[14:45:42] <nmatsakis> but if Foo is variadic, it always accepts any number of parameters, no?
[14:45:51] <eddyb> let me think for a second...
[14:46:37] <eddyb> nmatsakis: it's non-variadic type param count has to be <= 2
[14:46:50] <eddyb> *its
[14:46:52] <nmatsakis> ok that makes sense
[14:47:49] <eddyb> and N doesn't have to be a type, I don't think. the rules should apply to all generic items
[14:49:10] <nmatsakis> don't confuse me ;)
[14:49:13] <nmatsakis> but yeah I can see that
[14:50:33] <nmatsakis> ok, let's talk about fns
[14:50:47] <eddyb> there's one extension, to patterns
[14:50:48] <nmatsakis> as I recall there was a syntax for expanding the number of parameters
[14:50:59] <nmatsakis> eddyb: you mean parameter patterns?
[14:51:09] <eddyb> no, patterns in general
[14:51:20] <eddyb> fn f<..Args>(..args: Args) would be a variadic function
[14:51:48] <eddyb> or ..Args, I'm not sure which makes more sense
[14:52:41] <nmatsakis> what is the meaning of this
[14:52:50] <nmatsakis> args refers to a tuple?
[14:52:58] <nmatsakis> i.e., if I wrote "f(1, 2, 3)"
[14:53:00] <nmatsakis> then args would be (1, 2, 3)?
[14:53:04] <eddyb> yupp
[14:53:15] <eddyb> it should work in any pattern, this is just the most useful one
[14:53:41] <nmatsakis> I'm not sure how it makes sense in other patterns yet, can you give an example?
[14:54:00] <nmatsakis> let args = (1, 2, 3) already works ;)
[14:54:17] * nmatsakis tries to think of other variadic contexts aside from fn calls
[14:54:19] <eddyb> match tuple { (head, ..middle, tail) => (tail, ..middle, head), _ => tuple }
[14:54:49] <nmatsakis> interesting.
[14:54:51] <eddyb> or let TupleStruct(a, b, ..rest) = *self;
[14:55:10] <nmatsakis> I see this as somewhat orthogonal
[14:55:16] <nmatsakis> though indisputably useful
[14:55:31] <eddyb> I don't want to add too specific features
[14:55:31] <nmatsakis> that is, this seems like an extension to tuple patterns
[14:55:37] <nmatsakis> what I mean is:
[14:55:48] <nmatsakis> hmm mayb eI am wrong
[14:55:57] <nmatsakis> I was thinking that these would impact rather different parts of the code base
[14:56:05] <nmatsakis> but it may be that this is not entirely true
[14:56:08] <eddyb> variadic generics + tuple patterns => variadic functions
[14:56:19] <nmatsakis> this is not entirely true
[14:56:31] <nmatsakis> that is, variadic functions are more than the sum of their parts
[14:56:35] <nmatsakis> seeing as they impact the ABI etc
[14:56:46] <eddyb> there's nothing ABI-specific here
[14:56:57] <eddyb> it's all monomorphized generics
[14:57:02] <nmatsakis> what I am saying is:
[14:57:09] <nmatsakis> ..args outside of a tuple only makes sense in the parameter list,
[14:57:09] <nmatsakis> somehow
[14:57:17] <nmatsakis> because there is this implicit wrapper
[14:57:23] <nmatsakis> let ..args = ... 
[14:57:24] <nmatsakis> makes no sense
[14:57:54] <eddyb> well, a function declaration almost looks like a tuple
[14:58:04] <nmatsakis> yes
[14:58:09] <flaper87> dbaupp: turns out that parse_abis eats the keywords itself, which made other things fail. I just changed that!
[14:58:34] <nmatsakis> eddyb: all I'm saying is that just implementing .. destructor for patterns doesn't give you the fn behavior you want
[14:58:47] <nmatsakis> we'll have to do some extra work to make it pass the extra parameters as individual values and so on
[14:58:53] <nmatsakis> (which is fine)
[14:58:58] <nmatsakis> ok, let me try to write this up 
[14:59:02] <nmatsakis> as I understand it so far
[14:59:36] <eddyb> ooh, right, so it doesn't pass a pointer to a tuple. silly me :)
[15:01:05] <eddyb> (well, no, it captures all the arguments into a tuple, so they're still individual arguments in the function type. that is, the function above should have type fn(..Args))
[15:01:28] <nmatsakis> right
[15:04:12] <nmatsakis> eddyb: I don't understand what it is you wrote there
[15:04:22] <nmatsakis> eddyb: it seems rather distinct from what I was thinking of
[15:04:32] *** Quits: canhtak (canhtak@moz-8A625E1D.wl.t.ulaval.ca) (Quit: canhtak)
[15:04:34] <nmatsakis> I was thinking that the ..T notation is signifying two things:
[15:04:41] <nmatsakis> 1. T is a tuple (we need to think about 1-tuples, btw)
[15:05:01] <nmatsakis> 2. a kind of syntactic transformation where multiple arguments are swept up into a tuple
[15:05:10] <eddyb> nmatsakis: it would mean that Foo takes two type parameters, and they are both tuples
[15:05:17] <nmatsakis> (I say kind of because it's more general than that, which slightly worries me but maybe it works out fine)
[15:05:33] <nmatsakis> for the purposes of expansion, it seems like property 1 is all we care about, and hence we could introduce a bound for it
[15:05:38] <nmatsakis> this makes associated types work out just fine
[15:05:49] <nmatsakis> (or might, anyway)
[15:06:04] <eddyb> type Zip<(Head1, ..Tail1), (Head2, ..Tail2)> could even work, but this is a bit far fetched
[15:06:05] <nmatsakis> eddyb: I had assumed that'd be permitted, actually
[15:06:12] <nmatsakis> both examples
[15:06:26] <nmatsakis> they seem to fall out from the rules I've written so far
[15:06:32] <nmatsakis> in the case of Zip, I guess it'd be declared
[15:06:36] <nmatsakis> struct Zip<A,B>
[15:06:44] <nmatsakis> and Tail1 and Tail2 would be variadic type parameters
[15:06:54] <eddyb> I guess I shouldn't use the "type" keyword
[15:07:00] <nmatsakis> ah, I see what you're getting at
[15:07:03] <nmatsakis> sorry my confusion
[15:07:09] <nmatsakis> I thought these were type *references*
[15:07:19] <eddyb> nope, declarations
[15:07:22] <nmatsakis> but you are referring to declarations
[15:07:22] <nmatsakis> yes
[15:07:29] <nmatsakis> type-destructuring
[15:08:13] <nmatsakis> ok. I get it.
[15:08:19] <nmatsakis> yes, that is a kind of alternative, with implications all its own
[15:08:24] <nmatsakis> I would certainly want that to be a separate proposal.
[15:08:34] <nmatsakis> so, let's go back to functions
[15:08:40] <eddyb> impl<Head, (..Tail): Clone> Clone for (Head, ..Tail) was one of the ways I thought about doing trait bounds *but it's much more complicated than having something like :..Trait*
[15:08:55] <eddyb> right, I'm getting ahead of myself
[15:09:06] <nmatsakis> fn foo<..Args>(..args: Args)
[15:09:17] <nmatsakis> am I correct that (1) it is not legal to write ..P where P is some pattern.
[15:09:22] <nmatsakis> it must be ..variable-name
[15:09:31] <eddyb> ..binding
[15:09:39] <nmatsakis> sure, binding
[15:09:42] <nmatsakis> I guess ..ref b is ok
[15:09:45] <eddyb> where binding can have ref and/or mut
[15:09:53] <nmatsakis> right
[15:10:08] <nmatsakis> moreover if you have a function argument declared as ..x,
[15:10:17] <nmatsakis> then the type must be a variadic type parameter
[15:10:43] <eddyb> it has to a tuple (which a variadic type param is)
[15:10:44] <nmatsakis> and presumably only one argument can be of the form ..x
[15:10:52] <nmatsakis> hmm
[15:11:05] <nmatsakis> ok, you could support literal tuples,
[15:11:08] <nmatsakis> it'd be effectively syntatic sugar
[15:11:31] <nmatsakis> let's assume we expand those out as a pre-step for the time being
[15:11:34] <nmatsakis> then you can have only one ..x 
[15:11:41] <nmatsakis> and it must be a variadic type parameter
[15:12:13] <eddyb> the thing is that a variadic type param is substituted as a tuple, so making things work with tuples is simpler
[15:12:33] *** Joins: andrew-__ (andrew-d_w@4CCE6E0C.339B431B.1E537B93.IP)
[15:12:47] <nmatsakis> possibly, yes
[15:13:07] <eddyb> but yes, only one (I guess it's not as restricted as generic declarations, though I'm not sure we want to disambiguate when it shouldn't be a common pattern)
[15:13:10] <nmatsakis> but in terms of the up-front rules, they are kind of a no-op
[15:13:14] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Ping timeout)
[15:13:32] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Client exited)
[15:13:54] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[15:14:27] <nmatsakis> I guess you could potentially do
[15:14:35] <nmatsakis> fn foo<..Args>(..x: (int, ..Args))
[15:14:52] <eddyb> yupp
[15:15:00] <nmatsakis> fn foo<..Args>(..x: (int, Args))
[15:15:21] * nmatsakis tries to think about how this would be codegen'd
[15:15:29] <nmatsakis> seems doable
[15:15:34] <nmatsakis> though not entirely obvious
[15:15:36] *** Quits: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp) (Ping timeout)
[15:15:51] <nmatsakis> (to say the least)
[15:16:04] <nmatsakis> also, Args must appear ... at most once?
[15:16:06] *** Joins: zimbabao (rajaram@7C44F489.DA20CA3D.D2D1FAF0.IP)
[15:16:13] <nmatsakis> maybe not
[15:16:29] <nmatsakis> fn foo<..Args>(x: Args, ..y: (int, ..Args))
[15:17:23] <eddyb> fn foo(x0: int, x1: char, a1: A1, a2: A2, ...) { let (..x: (int, char), ..args: Args) = (x0, x1, a1, a2, ...) }
[15:18:07] <eddyb> fn foo(x0: int, x1: char, a1: A1, a2: A2, ...) { let x = (x0, x1); let args = (a1, a2, ...); ... } // that makes more sense
[15:18:15] <nmatsakis> yes I know
[15:18:44] <nmatsakis> I'm not saying it can't be done
[15:18:50] <nmatsakis> I'm thinking now about the caller side
[15:18:54] <nmatsakis> and type inferencing 
[15:19:11] <nmatsakis> given a call like:
[15:19:18] <nmatsakis> foo(a, b, c, d, e)
[15:19:24] <nmatsakis> the type inferencer must ensure that:
[15:19:37] <nmatsakis> the type A of a is (C, D, E)
[15:19:49] <nmatsakis> b is int
[15:19:52] <nmatsakis> etc
[15:19:54] <nmatsakis> that seems ok
[15:20:02] <nmatsakis> foo(a, b, ..v)
[15:20:10] <nmatsakis> foo(a, b, c, ..v)
[15:20:14] <nmatsakis> more compliated
[15:20:33] <nmatsakis> there a would have to be (C, ..V) I guess, not so bad.
[15:20:34] <eddyb> the function type is resolved to fn(Args, int, ..Args), in the case above
[15:21:02] <nmatsakis> basically we need to define the subtyping rules where ..X is part of the type
[15:21:29] <eddyb> I read some inference code, but I'm not sure on the precise rules
[15:22:18] <nmatsakis> the main thing is that the grammar of types needs to be changed to include `..X` (where X is a type parameter)
[15:22:25] <nmatsakis> well, that wouldn't be a type
[15:22:30] <nmatsakis> rather a VT (variadic type)
[15:22:56] <nmatsakis> which can appear in a tuple
[15:23:07] <nmatsakis> and presumably newtype'd tuples
[15:23:11] <nmatsakis> (struct foo(a, b, c)
[15:23:21] <eddyb> or function arguments, tuple structs, enum variants, etc.
[15:23:46] <eddyb> VT more type-safe than my original flag-based implementation (an "expando" bool in ty_param)
[15:24:44] <eddyb> *VT is
[15:27:40] *** Quits: andrew-__ (andrew-d_w@4CCE6E0C.339B431B.1E537B93.IP) (Input/output error)
[15:31:31] <nmatsakis> eddyb: ok, this has been helpful, I think I'll ping you again later :) I've got to get tend to a few other things for a bit,
[15:31:37] <nmatsakis> I want to think more on kinds, bounds, etc too
[15:32:07] <eddyb> np, I'll go back to removing ast_map::Path
[15:34:49] *** Quits: erickt (Adium@991D7890.9C346C7F.FAA4474F.IP) (Quit: Leaving.)
[15:42:40] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[15:43:07] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[15:44:03] *** kimundi is now known as zz_kimundi
[15:44:56] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[15:47:53] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[15:50:32] *** Joins: jdm (jdm@5D5A6787.1B2BE23A.74119F78.IP)
[15:52:58] *** Quits: jdm (jdm@5D5A6787.1B2BE23A.74119F78.IP) (Ping timeout)
[15:53:16] *** Joins: jdm (jdm@CE271E82.3EB7C725.74119F78.IP)
[15:56:18] *** Joins: sokomo (sokomo@8293D4FC.93FF164A.408809BB.IP)
[16:04:09] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[16:04:42] *** Joins: gwty (gwtypc@68B91BE0.D5EA08E0.CF29F6CE.IP)
[16:05:07] *** Quits: Zr40 (zr40@EE4BB9F5.926C319A.BE2F4011.IP) (Quit: leaving)
[16:05:57] <acrichto> eddyb: the event_loop_factory tells you what the default event loop is for libgreen, the start lang item tells you whether native/green is the default
[16:06:35] <eddyb> acrichto: I want something that can be provided by crates with meaningful conflict resolution
[16:06:39] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[16:06:39] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/sGtNJQ
[16:06:39] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[16:06:47] <acrichto> eddyb: how so?
[16:07:56] <eddyb> acrichto: if you link in only libnative or libgreen, it could just use that crate's runtime handling. if you link both, the conflict is resolved by having a trait object, I guess
[16:08:31] <acrichto> eddyb: the theory is that there's not "just two" in the world though
[16:08:50] <olsonjeffery> acrichto: heh. so i repro'd that freebsd error on my machine. this is surreal.
[16:09:00] <olsonjeffery> (i passed make check last night.. so why does make check-fast fail)
[16:09:01] <eddyb> acrichto: yeah. any crate could provide that
[16:09:05] <olsonjeffery> also.. the extern mod is *right* there.
[16:09:26] <acrichto> olsonjeffery: check-fast concatenates all the tests together so the module structure is different
[16:10:03] <olsonjeffery> so how does that swallow the extern mod linking? do all run-pass tests that link to non-std crates fail?
[16:10:13] <olsonjeffery> and how do you xfail-fast a run-pass test, then?
[16:10:28] <acrichto>  // xfail-fast
[16:10:30] <acrichto> near the top of the file
[16:10:56] <olsonjeffery> :/
[16:10:58] <olsonjeffery> ok thanks
[16:11:26] <olsonjeffery> can it go after the copyright notice?
[16:11:34] <acrichto> yeah
[16:11:43] <acrichto> you can see some examples if you grep around for xfail-fast
[16:11:47] <acrichto> (we have a lot of those)
[16:11:58] * olsonjeffery nods
[16:12:05] <olsonjeffery> i learn something new every day
[16:12:14] <olsonjeffery> so im thinking of tackling extra::test, next. that'll blow some stuff up!
[16:12:26] <olsonjeffery> would be interesting in that it would imply no linking against extra from std for tests, though.
[16:13:08] <acrichto> oh man
[16:13:11] <acrichto> extern mod test;
[16:13:13] <acrichto> that would be amazing
[16:19:36] <olsonjeffery> i think, in light of the dissolution of libextra, the link to the index.html for all docs should be more prominent. perhaps even the sole link off of the rust-lang.org homepage
[16:21:50] *** Quits: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP) (Client exited)
[16:28:03] *** Joins: gwty_ (gwtypc@68B91BE0.D5EA08E0.CF29F6CE.IP)
[16:28:35] *** Quits: gwty_ (gwtypc@68B91BE0.D5EA08E0.CF29F6CE.IP) (Connection reset by peer)
[16:30:43] *** zz_kimundi is now known as kimundi
[16:33:32] *** Quits: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com) (Client exited)
[16:40:13] *** Joins: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net)
[16:40:36] <flaper87> acrichto: r? https://github.com/mozilla/rust/pull/12017 
[16:41:30] <acrichto> flaper87: if we're adding crate as a keyword, there are dozens of local variables named crate throughout the compiler, I'm curious why they didn't change?
[16:42:32] <flaper87> acrichto: Because I'm planing to do the cleanup in the next PR where I'll also rename all `extern mod` to `extern crate`
[16:42:51] <acrichto> flaper87: 'crate' is a new keyword, right?
[16:43:20] <flaper87> acrichto: yup, do you think I should s/crate/something/ in this patch?
[16:43:36] <flaper87> acrichto: thing is that we need a new snapshot to completely remove `extern mod` usage
[16:43:42] <acrichto> I thought we didn't allow keywords as identifiers
[16:44:04] <acrichto> extern mod sure, that can change later, but if crate is really a keyword then we shouldn't be able to name a local variable 'create'
[16:44:06] <acrichto> crate*
[16:46:02] <flaper87> acrichto: mmh, that's true. not sure why it didn't fail then
[16:46:33] <flaper87> here doesn't seem to be that many `let * crate =` around
[16:46:44] <flaper87> rustdoc seem to have most of those usage
[16:47:43] *** Quits: Kxepal (Miranda@moz-6CFAB9DE.pppoe.mtu-net.ru) (Ping timeout)
[16:48:09] <nmatsakis> man, if we add crate as a keyword,
[16:48:18] <acrichto> flaper87: https://github.com/mozilla/rust/blob/master/src/librustc/driver/driver.rs#L241
[16:48:23] <nmatsakis> it is very temptin to say we can remove #[...]; attributes 
[16:48:32] <nmatsakis> #foo #bar crate;
[16:48:44] <eddyb> oooh
[16:48:57] <nmatsakis> and #foo #bar mod; I guess
[16:49:05] <nmatsakis> actually, maybe just the latter
[16:49:08] <eddyb> so crate is implicit?
[16:49:12] <flaper87> acrichto: ah well, those too...
[16:49:23] <eddyb> can we get rid of crate_id?
[16:49:24] <nmatsakis> (the idea being that when you apply attributes to "mod;" you are applying them to the enclosing module)
[16:49:30] <nmatsakis> eddyb: huh?
[16:49:36] <nmatsakis> why would we do that?
[16:49:46] <eddyb> nmatsakis: crate "std#0.10-pre";
[16:50:05] <flaper87> nmatsakis: mmh, that's itneresting
[16:50:27] <flaper87> eddyb: I prefer `extern crate foo = "";` TBH
[16:50:53] <nmatsakis> eddyb: I... don't quite know what that hsa to do with crate_id, maybe we're thinking of different things
[16:50:57] *** Joins: Kxepal (Miranda@moz-C2AD231E.pppoe.mtu-net.ru)
[16:51:08] <nmatsakis> I was thinking of the small integer that rust uses internally to number the crates that are linked against
[16:51:12] <nmatsakis> *rustc
[16:51:14] <eddyb> nmatsakis: #[crate_id="..."]; is a crate-level attribute, no?
[16:51:20] <nmatsakis> oh, ok.
[16:51:23] <eddyb> aaah, not CrateId :P
[16:51:48] <eddyb> there is a logic to my madness (crate_id vs CrateId)
[16:52:11] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[16:52:38] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[16:53:22] <olsonjeffery> acrichto: can i get another r+ on that libserialize PR, please? thanks.
[16:53:35] <flaper87> acrichto: erm, changing them now, I just hit the compile error
[16:54:28] <acrichto> olsonjeffery: r+
[16:54:29] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[16:54:44] <flaper87> acrichto: thanks, btw!
[16:54:59] <acrichto> flaper87: np, and thank you for doing this :)
[16:55:14] *** Joins: canhtak (canhtak@moz-8A625E1D.wl.t.ulaval.ca)
[16:57:08] <eddyb> acrichto: might need to start printing "thank you for contributing to rust" stickers in larger quantities :P
[16:57:29] <eddyb> actually, a Rust-logo-shaped penny would look cool
[16:57:43] <acrichto> hehe
[16:59:10] *** Quits: gwty (gwtypc@68B91BE0.D5EA08E0.CF29F6CE.IP) (Client exited)
[17:01:27] <bstrie> can someone remind me why we require lifetime names to be declared up-front?
[17:02:02] <bstrie> with type parameters it makes sense, since we both need a way to disambiguate from non-generic types and to add trait constraints... but I can't think of a similar reason for lifetimes
[17:02:44] <bstrie> nmatsakis: ^ ?
[17:02:50] <eddyb> ohh, interesting point
[17:02:57] *** Quits: yuriks (yuriks@541FB14B.E4E1C694.748B6D8D.IP) (Ping timeout)
[17:02:57] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[17:03:22] <nmatsakis> bstrie: there are situations where it is ambiguous, for one thing,
[17:03:32] <nmatsakis> bstrie: but we used to infer that any undeclared name belonged to the innermost scope,
[17:03:35] <bstrie> nmatsakis: basically, I was wondering if you had future plans for an extension to lifetimes where something like `fn foo<'a: blah>(...) would make sense
[17:03:40] <nmatsakis> bstrie: it was decided more explicit would be clearer
[17:03:51] <nmatsakis> I don't curently have any plans like that,
[17:03:56] <nmatsakis> though I could *imagine* declarations like
[17:04:08] <nmatsakis> fn foo<'a, 'b>(...) where 'a <= 'b
[17:04:24] <nmatsakis> bstrie: an ambiguous case is nested fn types, like fn(fn(&int))
[17:04:28] <nmatsakis> or rather
[17:04:33] <nmatsakis> fn(fn(&'a int))
[17:04:38] <nmatsakis> is that fn<'a>(fn(&'a int))
[17:04:43] <nmatsakis> or fn(fn<'a>(&'a int))
[17:04:55] <nmatsakis> certainly we could do something like "always bind to the innermost scope unless already bound outside" etc
[17:05:09] <nmatsakis> but it's a refactoring hazard, among other things
[17:05:12] <bstrie> nmatsakis: I see. out of curiosity, does fn<'a>(fn(&'a int)) make sense?
[17:05:31] <nmatsakis> I mean, it makes sense in that it has a meaning, I'm not sure where you'd want to use a type like thta :)
[17:05:44] <nmatsakis> I think there are likely examples, but they will be few
[17:06:21] *** Quits: rca (rcatolino@moz-BC04AA53.adsl.proxad.net) (Ping timeout)
[17:06:28] <bstrie> nmatsakis: was just idly trying to think of ways to make lifetime syntax less noisy
[17:06:38] <bstrie> I mean, we're better than we use to be
[17:06:53] <bstrie> but I get the feeling that when people say that rust syntax is ugly, they're really referring to lifetimes :P
[17:07:06] <bstrie> now that our sigil burden has been reduced, that is
[17:07:26] <nmatsakis> perhaps. I find very few cases using explicit lifetimes in code I write, I think?
[17:07:33] <nmatsakis> I could try to measure
[17:07:39] <bstrie> and it *is* a little weird to have them in the type parameter list, although if they must be declared up-front I can't propose a better place to put them
[17:07:52] <cmr> well you use them a lot if you're writing libraries?
[17:07:53] <nmatsakis> I don't think it's weird at all but maybe I'm just weird :)
[17:08:06] <nmatsakis> that is, they are all things that get substituted,
[17:08:07] * cmr doesn't think it's weird either
[17:08:11] <nmatsakis> and especially when we go to higher-kinded types,
[17:08:13] <nmatsakis> they will be quite interchangable
[17:08:21] <bstrie> nmatsakis: it would be very informative to measure how often we resort to explicit lifetime parameters
[17:08:30] <nmatsakis> I want to know a few things:
[17:08:32] <bstrie> nmatsakis: and also break it out into how often we need one vs more than one
[17:08:32] <nmatsakis> 1. how often do we use them
[17:08:35] <nmatsakis> and 2. for what reasons
[17:08:45] <nmatsakis> I could imagine some well-chosen syntactic sugar eliminating the vast majority of them
[17:09:02] <nmatsakis> gotta go, lunch time
[17:09:13] <bstrie> nmatsakis: oh, so you're on the east coast :P
[17:15:14] *** Quits: sokomo (sokomo@8293D4FC.93FF164A.408809BB.IP) (Quit: Read error: Connection reset by peer)
[17:16:40] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[17:16:40] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/2XeogQ
[17:16:40] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[17:18:38] *** Joins: yuriks (yuriks@14F330CC.3D924459.5419EADB.IP)
[17:21:04] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[17:21:37] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[17:21:37] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/iM3F7Q
[17:21:37] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[17:21:38] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[17:21:38] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/nvl-8g
[17:21:38] <ghrust> 13rust/06auto 14dd21a51 15JeremyLetang: move concurrent stuff from libextra to libsync
[17:21:38] <ghrust> 13rust/06auto 142bf575c 15bors: auto merge of #11939 : JeremyLetang/rust/move-libsync, r=alexcrichton...
[17:21:39] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[17:22:36] *** Joins: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP)
[17:24:34] *** Quits: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP) (Ping timeout)
[17:30:45] *** Joins: rca (rcatolino@moz-BC04AA53.adsl.proxad.net)
[17:31:08] *** Quits: jdm (jdm@CE271E82.3EB7C725.74119F78.IP) (Ping timeout)
[17:31:28] *** Joins: jdm (jdm@8E411A9D.6D6FB126.74119F78.IP)
[17:32:37] *** Quits: jdm (jdm@8E411A9D.6D6FB126.74119F78.IP) (Input/output error)
[17:32:44] *** Joins: jdm (jdm@8E411A9D.6D6FB126.74119F78.IP)
[17:33:20] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[17:33:20] *** ChanServ sets mode: +ao dherman dherman
[17:33:53] *** Quits: jdm (jdm@8E411A9D.6D6FB126.74119F78.IP) (Input/output error)
[17:33:59] *** Joins: jdm (jdm@8E411A9D.6D6FB126.74119F78.IP)
[17:35:07] *** Quits: jdm (jdm@8E411A9D.6D6FB126.74119F78.IP) (Input/output error)
[17:35:10] *** Joins: jdm (jdm@8E411A9D.6D6FB126.74119F78.IP)
[17:35:58] *** Joins: andrew-d_w (andrew-d_w@moz-E7894907.nat.bb.dnainternet.fi)
[17:36:21] *** Quits: jdm (jdm@8E411A9D.6D6FB126.74119F78.IP) (Input/output error)
[17:36:26] *** Joins: jdm (jdm@8E411A9D.6D6FB126.74119F78.IP)
[17:41:30] *** Quits: jdm (jdm@8E411A9D.6D6FB126.74119F78.IP) (Ping timeout)
[17:41:33] *** Joins: jdm_ (jdm@889DA807.37C9DD5F.74119F78.IP)
[17:44:35] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[17:44:35] *** ChanServ sets mode: +o tjc
[17:57:10] *** Quits: jdm_ (jdm@889DA807.37C9DD5F.74119F78.IP) (Ping timeout)
[17:57:35] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:00:37] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:00:42] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:04:35] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Ping timeout)
[18:04:39] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:04:47] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:05:53] *** Joins: tjc_ (tjc@moz-6EB4E533.dsl.tsoft.com)
[18:05:56] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:06:06] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:06:37] <olsonjeffery> ARGH
[18:07:16] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:07:22] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:08:18] <olsonjeffery> acrichto: this libsync PR is definitely going to hose mine. ugh.
[18:08:33] <olsonjeffery> i just rebased on top of master and will wait for that one to land and rebase/push again.
[18:08:41] <cmr> olsonjeffery: which PR is yours?
[18:08:46] <olsonjeffery> libserialize
[18:09:03] <bstrie> libsplosion
[18:09:09] <olsonjeffery> i rebased/push, thus taking myself out of the line
[18:09:19] *** Quits: tjc_ (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[18:09:32] <olsonjeffery> woulda landed last night, if it wasn't for make check-fast
[18:09:45] <acrichto> olsonjeffery: :(
[18:09:54] <acrichto> olsonjeffery: I can take over the rebasings if you want
[18:10:27] *** Joins: tjc_ (tjc@moz-6EB4E533.dsl.tsoft.com)
[18:11:09] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:11:19] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:11:56] <olsonjeffery> acrichto: it looks like libsync and libserialize are all that's in the PR queue right now. id just politely ask whoever to sit on approving subsequent ones until this gets through.
[18:12:13] <olsonjeffery> (amusingly, like three libsplosion PRs have gotten through in the time since i opened mine)
[18:12:26] <olsonjeffery> sour grapes
[18:12:27] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:12:28] <bstrie> I really really love the word "libsplosion" now
[18:12:43] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:12:43] <acrichto> olsonjeffery: I added r+ p=10 so you're guaranteed to be next
[18:12:47] <bstrie> like if there were a network news channel that only focused on programmign languages
[18:12:52] <olsonjeffery> acrichto: ill need to manually rebase
[18:12:56] <olsonjeffery> the merge failed against auto
[18:13:08] <olsonjeffery> so im gonna wait for it to get to master and deal with it, then
[18:13:14] <acrichto> oh hm
[18:13:21] <acrichto> so many conflicts!
[18:13:37] <olsonjeffery> crates.mk, src/doc/index.md, libextra/lib.rs, etc
[18:13:51] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:13:52] *** Quits: tjc_ (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: Textual IRC Client: www.textualapp.com)
[18:14:24] <bstrie> conceptually I really like the idea of splitting out all these crates into many, it helps to avoid conflicts like this :P
[18:14:33] <olsonjeffery> its just getting there is a pain
[18:14:41] <bstrie> you're doing god's work, son
[18:14:48] <olsonjeffery> also need to untangle the DAG of depdendencies..
[18:14:54] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:14:55] <bstrie> that's gonna be an issue
[18:15:05] <bstrie> but at least it will be much more explicit now
[18:15:12] <bstrie> just gotta look at the extern mods
[18:15:13] <olsonjeffery> libterm points into libextra, while extra reilies on serialize, etc
[18:15:30] <olsonjeffery> no real rigor enforced on what direction the arrows should be pointing, as that'll inform what can go, when
[18:15:44] <olsonjeffery> will be better if we can pull extra::test out
[18:15:51] <olsonjeffery> then everyone will depend on that
[18:15:54] <bstrie> olsonjeffery: does libstd rely on anything in extra?
[18:16:01] <bstrie> I kinda really hope not...
[18:16:02] <olsonjeffery> bstrie: just extra::test
[18:16:10] <bstrie> what does that do?
[18:16:11] <olsonjeffery> for cfg(test)
[18:16:17] <olsonjeffery> it's the test framework :P
[18:16:24] <bstrie> is the plan to move it into libtest, or into std::test ?
[18:16:34] <olsonjeffery> acrichto: ^
[18:16:46] <olsonjeffery> bstrie: i was going to take a stab at libtest
[18:17:02] <bstrie> and wait, do we really not implement serialization on any of the types in libstd?
[18:17:11] <olsonjeffery> newp.
[18:17:26] <bstrie> olsonjeffery: so what you're saying is that those types just can't be serialized, ever
[18:17:26] <olsonjeffery> well no im wrong
[18:17:43] <olsonjeffery> bstrie: we do.. but that's because serialize can define impls of traits in its own crate
[18:18:03] <olsonjeffery> its done for primitives, vectors and hashmap-like data structures in std
[18:18:10] <bstrie> olsonjeffery: ah ok
[18:18:13] <olsonjeffery> but the impls are in serialize (formerly extra::serialie)
[18:18:14] <bstrie> icic
[18:18:36] <olsonjeffery> anywho.
[18:18:37] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:18:46] <bstrie> the logic seems a bit backwards but it's definitely better than having std depend on extra
[18:18:48] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:19:12] <bstrie> I'm still a bit unclear on how we determine what goes in extra vs std
[18:19:32] <olsonjeffery> well even w/ libserialize, std isn't going to rely on it (since std should be at the end of any DAG, unless libprim happens)
[18:19:36] <cmr> http://phoronix.com/forums/showthread.php?95078-KDevelop-With-Clang-Greatly-Improves-Its-C-Handling&p=394921#post394921
[18:19:46] <cmr> "GCC team can decide to use parsers internally, or make NP-like search over perfect optimised goals, or make link to astral body of Tau Ceti to produce code"
[18:19:46] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[18:19:56] <cmr> That has to be the most hilarious thing I've read, in recent memory.
[18:19:58] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:20:00] <olsonjeffery> bstrie: usually its like: "we have this thing that *has* to be in std... and it'd be a lot easier to do if <thing from extra> were also in std"
[18:20:03] <olsonjeffery> eg hashmap
[18:20:04] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:21:13] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:21:23] <doener> eddyb: http://lists.cs.uiuc.edu/pipermail/llvm-commits/Week-of-Mon-20140203/203984.html
[18:21:25] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:21:30] <bstrie> olsonjeffery: that's what I'm asking, to define "*has* to be in std"
[18:21:59] <eddyb> doener: is that you?
[18:22:20] <cmr> eddyb: yes
[18:22:34] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:22:34] <bstrie> doener: is this likely to be accepted?
[18:22:42] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:22:42] <eddyb> doener: sweet <3
[18:22:46] <olsonjeffery> i want to take a "PRIVATE THE OCEAN!" extreme approach and libsplosian all the libraries. no std, no nuffin.
[18:22:50] <doener> bstrie: I hope so
[18:23:04] <eddyb> bstrie: well, my bug fix got accepted in about a week, this looks similarly simple
[18:23:19] *** Joins: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP)
[18:23:26] <bstrie> doener: awesome
[18:23:50] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:23:59] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:24:50] <bstrie> olsonjeffery: nah, if we don't provide a stdlib then someone will just make a defacto one. or a defacto dozen
[18:25:08] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:25:12] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:25:15] <bstrie> let's not be like C and make everyone reimplement everything whenever they need a datastructure
[18:25:26] *** Quits: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP) (Ping timeout)
[18:26:02] <bstrie> and especially due to implementation coherence, it makes things a lot smoother to have a "core" set of traits and types
[18:26:21] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Input/output error)
[18:26:34] *** Joins: jdm (jdm@975D0492.AC1DA28C.74119F78.IP)
[18:26:47] <bstrie> just as you've done with libserialize, crates that provide new traits will have the opportunity to implement them on all libstd types. and vice versa
[18:26:52] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[18:27:47] <olsonjeffery> bstrie: i feel like, if libprim happens, then the argument for an std is kind of moot. because prim will be the ur-std, and everything else is basically a question of what you can take on, based on application context
[18:27:50] <bstrie> but if crate A defines a cool new trait and crate B defines a cool new type, you'll never be able to impl A for B
[18:27:58] <bstrie> well, maybe with newtyping? but that's gross
[18:28:04] <olsonjeffery> but i was mostly joking, i think there'll continue to be a libstd.
[18:28:27] *** Quits: jdm (jdm@975D0492.AC1DA28C.74119F78.IP) (Ping timeout)
[18:28:30] <olsonjeffery> but it isn't like rust won't provide the data structures. they'll just be a crates that's a peer of libserialize.
[18:28:42] *** Joins: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP)
[18:28:43] <olsonjeffery> but, as i said: very speculative. don't think it'll go down like that.
[18:29:15] <acrichto> olsonjeffery: prepare your rebasing engine
[18:29:26] <acrichto> olsonjeffery: or if you rebase on origin/auto you can force-push right now
[18:29:28] <acrichto> (I think)
[18:30:00] <cmr> non-typesafe llvm bindings kinda suck :(
[18:30:16] <olsonjeffery> acrichto: okily dokily
[18:30:19] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[18:30:25] * cmr discovers that LLVMAddAttribute is not LLVMAddFunctionAttr
[18:31:07] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[18:31:43] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[18:31:43] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/nvl-8g
[18:31:43] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[18:31:50] <acrichto> olsonjeffery: go, go, go!
[18:31:59] *** Quits: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP) (Input/output error)
[18:32:10] *** Joins: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP)
[18:32:25] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Ping timeout)
[18:33:15] <olsonjeffery> mergetool mergetool la la la
[18:33:20] <olsonjeffery> this is the mergetool song
[18:33:37] <cmr> is it the song of your people?
[18:35:51] *** Quits: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP) (Input/output error)
[18:36:02] *** Joins: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP)
[18:36:34] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[18:36:34] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/7ZurCQ
[18:36:34] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[18:37:11] *** Quits: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP) (Input/output error)
[18:37:29] *** Joins: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP)
[18:39:09] <olsonjeffery> acrichto: i pushed.. just doing check-fast really quick through stage0..
[18:39:18] <eddyb> https://www.youtube.com/watch?v=Xa682U0CLQw in other news, I just figured how to make all of this work :D
[18:39:36] <olsonjeffery> acrichto: ok.. looks like libsync didn't depend on serialize at all.. i think it's good
[18:40:20] <cmr> eddyb: Eugh they're making it into a movie?
[18:40:26] <cmr> I enjoyed the books but... meh.
[18:40:35] <acrichto> olsonjeffery: I don't think you conflict with the PR on bors right now, so I think that one should keep going through
[18:40:37] <eddyb> there's books? thanks for the tip :P
[18:40:41] <cmr> "Genre: Action | Adventure | Romance" yup, officially ruined.
[18:40:59] *** Quits: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP) (Input/output error)
[18:41:14] <eddyb> everything inlined from an external module will get a ~[PathElem] to tuck at the end of the list
[18:41:34] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[18:41:34] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 143f543f5 to 142bf575c: 02http://git.io/N3iJvQ
[18:41:34] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[18:41:35] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[18:41:35] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/ASDvtQ
[18:41:35] <ghrust> 13rust/06auto 14b8852e8 15Jeff Olson: pull extra::{serialize, ebml} into a separate libserialize crate...
[18:41:35] <ghrust> 13rust/06auto 1455684ba 15bors: auto merge of #11984 : olsonjeffery/rust/libserialize, r=alexcrichton...
[18:41:36] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[18:41:41] <eddyb> well, no, front of the list
[18:42:09] <eddyb> do we have a ValueIterator yet?
[18:42:15] *** Joins: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP)
[18:42:26] <acrichto> olsonjeffery: uh oh, I think I confused bors
[18:43:24] *** Quits: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP) (Input/output error)
[18:43:33] *** Joins: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP)
[18:43:42] *** Joins: Luqman (laden@moz-AB7945E9.csclub.uwaterloo.ca)
[18:44:09] *** Quits: andrew-d_w (andrew-d_w@moz-E7894907.nat.bb.dnainternet.fi) (Ping timeout)
[18:44:42] *** Quits: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP) (Input/output error)
[18:44:50] *** Joins: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP)
[18:45:59] *** Quits: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP) (Input/output error)
[18:46:05] <olsonjeffery> rut-roh
[18:47:07] <acrichto> protip: don't kill bors
[18:48:11] *** Joins: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP)
[18:49:20] *** Quits: jdm (jdm@22AEF835.B7C72CD0.74119F78.IP) (Input/output error)
[18:53:16] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[18:55:10] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[18:55:36] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[19:00:30] *** Joins: rca_ (rcatolino@moz-312D09C6.adsl.proxad.net)
[19:01:08] *** Quits: rca (rcatolino@moz-BC04AA53.adsl.proxad.net) (Ping timeout)
[19:06:27] <bstrie> so there are plans for deref traits for custom pointer types, but are there also plans for autoref on custom pointer types?
[19:07:11] <bstrie> e.g. if I have `fn foo(x: &int)`, I want to be able to do `let x = box(Gc) 1; foo(x);`
[19:07:15] <acrichto> bstrie: I believe that the plan is to allow: let foo: Rc<Foo> = ...; foo.method_on_foo();
[19:07:24] <acrichto> (I think)
[19:07:52] <acrichto> the idea is to have Box<T> == ~T I believe
[19:08:01] <acrichto> in which case I think we'd have to support it
[19:08:16] <bstrie> acrichto: I'm not thinking of methods, I'm thinking of not forcing an explosion of functions implemented for different pointer types
[19:08:48] <acrichto> bstrie: I'd certainly rather avoid that
[19:08:58] <acrichto> &T should be *the* method of taking a type, but not taking ownership
[19:08:59] <bstrie> so that we could have just `foo(x: &int)` rather than `foo_gc(x: Gc<int>)`, `foo_rc(x: Rc<int>)`
[19:09:09] <bstrie> etc
[19:09:13] <acrichto> I would be sad if that happened :(
[19:09:21] <bstrie> is there any reason we couldn't do this?
[19:09:32] <bstrie> how do we currently get a borrowed pointer out of Gc or Rc?
[19:09:42] <acrichto> .borrow()
[19:10:03] <acrichto> rusti: use std::rc::Rc; let a = Rc::new(3); println!("{:?}", a.borrow())
[19:10:04] -rusti- &3
[19:10:04] -rusti- ()
[19:10:14] <acrichto> rusti: use std::gc::Gc; let a = Gc::new(3); println!("{:?}", a.borrow())
[19:10:16] -rusti- &3
[19:10:16] -rusti- ()
[19:10:25] <bstrie> so then would it be hard to make the Borrow trait into tasty autoref sugar?
[19:10:37] <eddyb> bstrie: that's... deref not autoref AFAIK
[19:10:52] <acrichto> yeah there's a few things in play here I think
[19:10:59] <acrichto> (I'm probably not the one to ask)
[19:11:03] <bstrie> maybe I'm using the wrong terminology
[19:11:09] <bstrie> maybe it's autoborrowing, I dunno
[19:11:10] <eddyb> bstrie: what you want is what Deref does
[19:11:19] <eddyb> .borrow() it's dereferencing :P
[19:11:28] <eddyb> s/it's/is/ the naming is weird
[19:12:06] <bstrie> eddyb: all I care about is, does `fn foo(x: &int) {} let x = box(Gc) 1; foo(x);` work?
[19:12:20] <eddyb> bstrie: not now, requires the Deref traits
[19:12:31] <bstrie> but once you implement them, you get that for free?
[19:12:32] <eddyb> same for Rc (which is why we haven't gotten rid of @T yet)
[19:12:46] <eddyb> bstrie: that's what the Deref trait(s) do
[19:13:12] <bstrie> I'd expect a trait called Deref to let me do `let x = box(Gc); *x`
[19:13:53] <eddyb> but so you can do *x = foo; it needs to return a reference (because we have no other lvalues in Rust)
[19:14:13] <eddyb> so technically Deref and Borrow are the same thing
[19:14:20] <bstrie> ok, I see
[19:14:31] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[19:14:32] <eddyb> (and you can't always return a value because that could move)
[19:15:15] *** nrc is now known as nrc|waitangiday
[19:15:16] <bstrie> one other thing
[19:15:41] *** nrc|waitangiday is now known as nrc|waitangi
[19:15:43] <bstrie> I keep reading this box syntax as looking like `box(GC)`, but the type is named `Gc`. is the different capitalization important?
[19:15:53] *** nrc|waitangi is now known as nrc|waitangiday
[19:16:02] <eddyb> bstrie: GC/HEAP are temporary hacks
[19:16:47] <eddyb> let x: Gc<int> = box 1; might be one way to properly implement it (via a Box trait)
[19:16:48] <bstrie> I just want to make sure that I understand it properly, and that once you implement the pointer traits you get to use your type with `box`
[19:17:15] <eddyb> if the pointer traits are Deref and Box, sure
[19:17:16] <bstrie> without having to shove things into statics (which what "GC" suggests to me)
[19:19:12] <eddyb> we could potentially have something like let x = box(arena) 1; inferring ArenaPtr<int>. but with our current system, it might just be "unbounded type"
[19:20:00] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[19:20:00] *** ChanServ sets mode: +qo brson brson
[19:20:27] *** Joins: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP)
[19:22:14] *** Quits: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP) (Ping timeout)
[19:24:23] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[19:24:23] *** ChanServ sets mode: +ao pcwalton pcwalton
[19:43:22] *** Joins: andrew-d_w (andrew-d_w@moz-E7894907.nat.bb.dnainternet.fi)
[19:45:35] *** Quits: bytbox (s@moz-54E13927.washdc.fios.verizon.net) (Input/output error)
[19:52:34] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[19:53:52] <eddyb> it
[19:53:58] <eddyb> thank you, enter key
[19:55:01] <eddyb> it's late, but... I can't stop. one more change towards less clones
[19:55:05] *** Joins: dherman (dherman@moz-7B0110AD.mv.mozilla.com)
[19:55:05] *** ChanServ sets mode: +ao dherman dherman
[19:59:49] *** Quits: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP) (Ping timeout)
[20:01:17] <cmr> Eugh
[20:01:35] <cmr> acrichto: so I think I want to write a new binding for LLVM...
[20:01:47] <doener> o.O
[20:01:48] <acrichto> cmr: librustllvm!
[20:02:09] <acrichto> https://github.com/mozilla/rust/issues/8274
[20:02:11] <acrichto> https://github.com/mozilla/rust/issues/8275
[20:02:17] <acrichto> cmr: ^
[20:02:23] <acrichto> hodgepodge
[20:02:25] <acrichto> that is a good word
[20:02:36] <eddyb> in other news, the AST is now complete with parent "pointers"
[20:02:36] <cmr> indeed it is.
[20:02:40] <eddyb> (NodeIds)
[20:03:07] <cmr> acrichto: I don't want to because it's a pain, but their C API... really not very good.
[20:03:10] <eddyb> so it's technically possibly to iterate it
[20:03:23] <cmr> We can't use any of the sanitizers because their C API uses enums
[20:03:29] <acrichto> cmr: it is a little sad yeah :(
[20:03:34] <acrichto> we can't use enums?
[20:03:50] <cmr> Their C API doesn't include the constants
[20:03:57] <cmr> So on ARM the enum will be 32 bits.
[20:04:11] <cmr> bbs
[20:04:23] <acrichto> that shouldn't block you entirely though
[20:04:33] <acrichto> you could just define the values in a sub-par fashion
[20:04:37] <cmr> well I did
[20:04:52] <cmr> but it is only going to work sometimes :\
[20:04:52] <olsonjeffery> acrichto: so what's up w/ bors.. is it ded?
[20:04:57] <eddyb> dbaupp, cmr: can we use that coverage stuff or LLVM (in some way) to find public functions that aren't used?
[20:05:10] <cmr> eddyb: aren't used *by what*?
[20:05:16] <acrichto> olsonjeffery: looks like some builds accidentally got scheduled on aws
[20:05:17] <eddyb> cmr: in an entire binary
[20:05:20] <acrichto> olsonjeffery: they're just taking extra long
[20:05:24] <eddyb> I guess a lint would just be better
[20:05:32] <acrichto> olsonjeffery: http://buildbot.rust-lang.org/waterfall?branch=auto&refresh=15
[20:05:36] <olsonjeffery> yeah looking at it now
[20:05:39] <eddyb> cmr: I just removed one more public dead function
[20:11:16] *** Joins: Zr40 (zr40@moz-CCFEAB92.adsl.xs4all.nl)
[20:15:48] *** Quits: doener (doener@moz-C68F600D.unity-media.net) (Quit: leaving)
[20:17:00] <eddyb> /home/eddy/Projects/rust/src/libsyntax/ast_map.rs:87:5: 87:16 error: internal compiler error: Cannot relate bound region: ReLateBound(93056, BrNamed(syntax::ast::DefId{crate: 0u32, node: 93075u32}, a)) <= ReLateBound(93120, BrNamed(syntax::ast::DefId{crate: 0u32, node: 93143u32}, a))
[20:17:04] <eddyb> please please don't
[20:17:47] <acrichto> olsonjeffery: jeez I can see why we try to no load the aws bots at all
[20:19:48] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[20:19:52] <strcat> dbaupp: around?
[20:21:11] *** Joins: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP)
[20:21:17] <strcat> acrichto: http://ix.io/al1/diff this is what libstdc++ does
[20:21:20] <eddyb> how bad is this definition? pub fn path_to_str<'a, I: Iterator<&'a PathElem>>(mut it: I, itr: &IdentInterner) -> ~str {
[20:21:58] <acrichto> strcat: yeah, it's essentially the same thing though
[20:22:03] <acrichto> but with fewer comments
[20:22:15] <strcat> smaller dtor
[20:22:24] <acrichto> by like 2 instructions?
[20:22:26] <eddyb> strcat: can I be generic over an Iterator that outputs &'a T?
[20:22:35] <eddyb> I think I tried this in some other place recently and failed
[20:22:51] <strcat> acrichto: yeah, it's 2x as big as the old Rc dtor
[20:23:00] *** Quits: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP) (Ping timeout)
[20:23:02] <strcat> so I think the argument for keeping Rc without weak ptrs was valid as the dtor was small/inlined
[20:23:43] <acrichto> strcat: I'm not following, the only difference in the dtors is "(*self.ptr).weak += 1;"
[20:24:00] <strcat>             if self.ptr != 0 as *mut RcBox<T> {
[20:24:02] <strcat>                 (*self.ptr).count -= 1;
[20:24:03] <strcat>                 if (*self.ptr).count == 0 {
[20:24:05] <strcat>                     let _: ~RcBox<T> = transmute(self.ptr);
[20:24:07] <strcat>                 }
[20:24:09] <strcat>             }
[20:24:11] <strcat> is the Rc dtor
[20:24:13] <strcat> and the first branch is optimized out
[20:24:17] <strcat> it's just the drop flag workaround
[20:25:45] <olsonjeffery> sooo close
[20:26:00] <strcat> anyway w/e
[20:26:07] <strcat> I'll stay quiet and do my own thing
[20:26:17] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[20:26:41] <eddyb> strcat: Values iterator pls. otherwise I have to use Map<'static, Items<'a, PathElem>, PathElem>
[20:27:07] <strcat> acrichto: also removes a branch from the weak ptr dtor
[20:28:30] <strcat> acrichto: http://ix.io/al2/diff 
[20:28:42] <strcat> I think for a Weak ptr for Arc it might be more important
[20:29:17] <strcat> eddyb: huh?
[20:29:42] <eddyb> strcat: I need a concrete type for a chained iterator
[20:30:02] <eddyb> it's a vector iterator + a custom stack list
[20:30:12] <strcat> a by-value Pod vector iterator would have a lifetime
[20:30:37] <eddyb> strcat: but it wouldn't be in the E of Iterator<E>
[20:30:41] <eddyb> which is what's causing me trouble
[20:32:00] <acrichto> strcat: I'll remove my r+, you can talk to dbaupp
[20:32:27] <strcat> I regret not figuring out why libstdc++ used the 1 weak ptr count for strong ptrs
[20:32:41] <strcat> didn't seem necessary ;p
[20:34:00] *** Quits: mrmonday (mrmonday@moz-C7DC1A73.lin.openzula.org) (Input/output error)
[20:37:07] *** Joins: mrmonday (mrmonday@moz-C7DC1A73.lin.openzula.org)
[20:37:25] <flaper87> brson: hey, any hint about how this issue can be reproduced? https://github.com/mozilla/rust/issues/8253
[20:37:33] <flaper87> could be*
[20:37:52] <acrichto> flaper87: I'll just close that
[20:37:59] <acrichto> we've had many iterations since then
[20:38:04] <flaper87> acrichto: I can :D
[20:38:06] <flaper87> :P
[20:38:11] <acrichto> flaper87: feel free!
[20:38:21] <flaper87> acrichto: ok, thanks for the info!
[20:38:25] <acrichto> it's just an old issue at this point I think
[20:38:32] *** Joins: mankyKitty (Instantbir@moz-F98AF264.rev.sfr.net)
[20:39:14] <strcat> cmr: I think a real asan implementation conflicts with valgrind ;(
[20:39:27] <acrichto> olsonjeffery: zomg this is literally taking forever lol
[20:39:38] <olsonjeffery> interesting. someone did a libcollection PR.
[20:39:52] <olsonjeffery> that makes it possible to take json out of extra.
[20:40:01] <acrichto> baby steps
[20:40:06] <olsonjeffery> once against the dependency stuff in crates.mk is a mess
[20:40:08] <flaper87> that was my guess but I thought about giving it a try. I'll close it
[20:40:10] <olsonjeffery> again*
[20:40:15] <strcat> json is unsound ;(
[20:40:24] <flaper87> ww/me *had* no idea how much `crate` was being used
[20:40:35] <olsonjeffery> strcat: why, because of overflows in the parser?
[20:40:46] * flaper87 *had* no idea how much `crate` was being used
[20:40:47] <strcat> olsonjeffery: look at the json.rs file, search for transmute
[20:40:59] *** Quits: blank_name (blank_name@75624DB1.E6D3F868.537E532E.IP) (Ping timeout)
[20:41:07] <olsonjeffery> '["foo":{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{'
[20:41:16] <olsonjeffery> ah.
[20:41:43] <olsonjeffery> '[{, even
[20:42:16] <strcat> anyway I think the libstd json shouldn't pick the representations for you (like using TreeMap)
[20:42:27] * strcat talked about this in #rust... 2 days ago?
[20:42:32] <strcat> forget
[20:42:39] <flaper87> acrichto: in that case, should this suppression be removed? https://github.com/brson/rust/commit/8f9c1724d0e085c673df3134bdc606cde72207a1
[20:42:40] <olsonjeffery> it used to be hashmap, but was changed
[20:42:48] <strcat> olsonjeffery: well imo it should be neither
[20:42:50] <olsonjeffery> for the Object variant in Json
[20:43:01] <olsonjeffery> strcat: meh. expedience.
[20:43:09] <flaper87> that was added because of that leak
[20:43:13] <acrichto> flaper87: perhaps, but we don't run valgrind on mac any more anyway
[20:43:30] <strcat> olsonjeffery: well imo we should drop extra::bigint and extra::json, *shrug*
[20:44:18] <flaper87> acrichto: mmh, ok
[20:44:20] <olsonjeffery> json's used in rustdoc
[20:44:23] <olsonjeffery> otherwise it appears in some tests
[20:44:36] <strcat> #[bench], I think
[20:44:38] <olsonjeffery> maybe it can be segregated in its own crate and incubated out with time
[20:44:38] <strcat> right?
[20:44:50] <olsonjeffery> im not attached to it, personally
[20:44:54] *** Joins: blank_name (blank_name@75624DB1.E6D3F868.537E532E.IP)
[20:45:21] <cmr> strcat: yeah, it probably does.
[20:45:34] <olsonjeffery> is ebml any more sound?
[20:45:43] <strcat> well it doesn't have that specific transmute issue
[20:51:19] *** Quits: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP) (Connection reset by peer)
[20:51:42] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[20:51:42] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/ASDvtQ
[20:51:42] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[20:54:02] <eddyb> type FullPathIterator<'a> = iter::Chain<iter::Map<'static, &'a PathElem, PathElem, Items<'a, PathElem>>, LinkedPath<'a>>;
[20:54:13] <eddyb> nmatsakis: ^^ this is fun. when your type aliases don't fit on one line
[20:54:16] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[20:56:11] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[20:56:34] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[20:56:34] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/C_M1mg
[20:56:34] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[20:56:37] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[20:56:37] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/KB3_WQ
[20:56:37] <ghrust> 13rust/06auto 1456080c4 15Alex Crichton: Implement clone() for TCP/UDP/Unix sockets...
[20:56:37] <ghrust> 13rust/06auto 146aad3bf 15bors: auto merge of #11894 : alexcrichton/rust/io-clone, r=brson...
[20:56:37] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[20:57:33] <strcat> nmatsakis: around?
[20:57:43] <nmatsakis> strcat: no :(
[20:57:43] <cmr> eddyb: builder just got caught up, it's running benches now!
[20:57:46] <strcat> nmatsakis: why does RefCell need the asserts in the dtors?
[20:57:51] * strcat doesn't get it
[20:57:59] <nmatsakis> strcat: I'll take a look 
[20:58:00] <nmatsakis> unsure
[20:58:07] <eddyb> can we make them aborts instead of asserts?
[20:58:08] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[20:58:21] <eddyb> though that might a tad evil
[20:58:36] <nmatsakis> strcat: probably because the borrow's dtor should have run before the refcell itself
[20:59:10] <strcat> hm
[20:59:34] <strcat> nmatsakis: I don't understand why it needs to check that the borrow state is WRITING in the RefMut one, for example
[20:59:43] <strcat> maybe these are intended to be debugging asserts
[20:59:47] <strcat> rather than to uphold invariants
[20:59:51] <strcat> we really need to split assert
[21:00:06] <sfackler> strcat: it's a sanity check
[21:00:22] <strcat> yeah, but we don't have an assert that's optimized out
[21:00:23] <sfackler> if a RefMut exists, then the RefCell needs to be in the WRITING state
[21:00:26] <sfackler> oh
[21:00:27] <strcat> so these massively bloat the code
[21:00:30] <sfackler> got it
[21:00:36] <sfackler> I just put them in as a sanity check
[21:00:39] <strcat> hm
[21:00:44] <strcat> sfackler: well I want to add a debugging assert
[21:01:02] * strcat shrugs
[21:01:12] <sfackler> these would fall under that category of assert for sure
[21:01:19] <strcat> I don't really like that assert is a macro anyway :P, imo it's failure's job to print a backtrace
[21:01:22] <strcat> or gdb
[21:01:34] <strcat> assert! should be called uphold! or something
[21:02:28] <sfackler> iirc you can do something like assert!(foo, "didn't foo: {}", bar)
[21:03:39] <strcat> it's slow though ;s
[21:04:07] <strcat> failure itself can print a backtrace without overhead at every call site
[21:04:43] <sfackler> sure
[21:04:51] <strcat> in fact you could even write an abort automatically attaching a debugger if you wanted
[21:05:01] <sfackler> I do think it's weird that we use assert! for both sanity checking and test-style checking
[21:07:03] <eddyb> does the order of two lifetime parameters matter?
[21:07:11] <eddyb> what on earth is going on here :/
[21:07:33] <nmatsakis> strcat: seems like a sanity check, and I think it should hold
[21:07:36] <eddyb> https://github.com/mozilla/rust/pull/12030/files#diff-c82811a081b5fb219ba68dd88b49d0b1R35
[21:07:48] <eddyb> ^^ that code works fine in that branch, but not in this branch
[21:07:59] <eddyb> did something change recently wrt lifetimes?
[21:08:07] <nmatsakis> strcat: oh but I see concern is just code quality
[21:08:35] <strcat> yeah I noticed it is a serious perf issue with mutable Rc trees
[21:12:04] <strcat> afaik assert! doesn't really work
[21:12:16] <strcat> because in an inline function, the lines will not be right
[21:12:18] <strcat> maybe I'm wrong
[21:12:30] <strcat> I just assume that's how those file/line exts work
[21:13:33] <eddyb> this is really weird. <'a, 'b, 'c> didn't work on that branch but works here :/
[21:14:37] <strcat> https://github.com/mozilla/rust/issues/12049
[21:14:38] <mankyKitty> Does Rust have any issues with llvm 3.4 ? 
[21:14:46] <mankyKitty> (that people know of)
[21:14:59] <strcat> afaik it's probably already the 3.5 branch
[21:15:07] <strcat> the llvm rust uses
[21:15:32] <mankyKitty> okay nifty. I assumed it was something I did, this is fixable. :P
[21:16:03] *** Joins: ssira (ssira@moz-DC71C200.kanagawa.ocn.ne.jp)
[21:22:00] *** Joins: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP)
[21:22:12] <sfackler> strcat: the line number is calculated by the line!() procedural macro which runs before inlining: https://github.com/mozilla/rust/blob/master/src/libstd/macros.rs#L48
[21:22:26] <flaper87> pnkfelix: hey, do you have any news about this? https://github.com/mozilla/rust/issues/9452
[21:23:49] *** Quits: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP) (Ping timeout)
[21:24:03] <flaper87> Eridius: I haven't had the time to get back to that PR but I will :)
[21:24:27] <eddyb> o_O libsyntax compiles. do I dare fix librustc?
[21:25:19] <eddyb> you know, before the libsplosion, I would've asked to bitpack the NodeId and the CrateId of a DefId in an u32
[21:25:20] <olsonjeffery> \o/
[21:26:01] <eddyb> you know, 28 bits of NodeId, 4 of CrateId... now I'd use 6 for CrateId, just in case
[21:27:15] <eddyb> "error: use of undeclared type name `ast_map::Path`" I actually love seeing that error :D
[21:29:05] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[21:29:38] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[21:30:43] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[21:37:02] <flaper87> olsonjeffery: it landed :D w000t
[21:37:13] <eddyb> you've got to be kidding me: trans_expr_fn still supports for loops
[21:37:18] <flaper87> does anyone has more info about this issue? https://github.com/mozilla/rust/issues/9228
[21:37:24] <eddyb> the old closure-based ones
[21:41:16] *** Joins: Sharp (Sharp@moz-3301C7AB.static-ip.telepacific.net)
[21:41:19] *** Quits: Sharp (Sharp@moz-3301C7AB.static-ip.telepacific.net) (Quit: Sharp)
[21:51:04] *** Quits: mankyKitty (Instantbir@moz-F98AF264.rev.sfr.net) (Quit: mankyKitty)
[21:56:05] <dbaupp> strcat: https://github.com/mozilla/rust/pull/12047 r?
[21:57:31] <dbaupp> thanks
[21:58:08] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[21:59:28] <acrichto> hurray I/O clone finally landed
[22:01:37] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[22:01:37] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/KB3_WQ
[22:01:37] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[22:02:18] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[22:06:29] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[22:06:29] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/YZfHOA
[22:06:29] <ghrust> 13rust/06auto 14fc1d655 15Adrien TÃ©tar: etc/tidy: don't check SNAP against triple
[22:06:29] <ghrust> 13rust/06auto 140ebe112 15Adrien TÃ©tar: etc: add missing license boilerplates
[22:06:30] <ghrust> 13rust/06auto 14611c7a6 15Adrien TÃ©tar: rustdoc: update deps
[22:06:32] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[22:08:46] <brson> acrichto: \o/
[22:08:50] <brson> that will make a lot of people happy
[22:10:36] *** Quits: dbaupp (Thunderbir@moz-25BBAF91.lns20.syd6.internode.on.net) (Ping timeout)
[22:13:21] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[22:22:30] *** Joins: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP)
[22:23:58] *** Quits: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP) (Connection reset by peer)
[22:24:17] *** Joins: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP)
[22:25:14] * eddyb looks at all these Path clones that haunted pcwalton for so long...
[22:25:21] <eddyb> oh, wait, they're gone :P
[22:25:48] *** Quits: rca_ (rcatolino@moz-312D09C6.adsl.proxad.net) (Ping timeout)
[22:26:22] *** Quits: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP) (Ping timeout)
[22:29:36] <flaper87> acrichto: https://github.com/mozilla/rust/pull/12017 done! That was painful :D
[22:30:14] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[22:37:19] <flaper87> acrichto: btw, I'd recommend reviewing that PR at least 4 times. All those renames, although everything compiles and runs fine, are always risky.
[22:37:21] <flaper87> :D
[22:37:21] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[22:38:09] <ChrisMorgan> acrichto: on https://github.com/mozilla/rust/pull/12039, you updated the commit messageâ€”could you please update the PR description, too? People are sure to look at that also and it's helpful for quick access.
[22:39:09] <acrichto> ChrisMorgan: updated
[22:39:22] <ChrisMorgan> Thanks.
[22:39:55] * eddyb hopes std::any is the only place in std using @Trait
[22:40:09] <eddyb> kimundi: I know you did that ^^
[22:40:28] <eddyb> I guess I could've fixed that error this morning instead of going crazy on ast_map
[22:41:08] <eddyb> acrichto: haha, stage0 libgreen can compile after stage0 librustc :D
[22:41:08] *** kimundi is now known as zz_kimundi
[22:43:02] *** zz_kimundi is now known as kimundi
[22:44:27] <eddyb> acrichto, brson: nmatsakis said something that made me think this could be possible: #foo #bar crate "std#0.10-pre"; (to set crate_id and crate attributes, within the crate itself)
[22:44:55] <eddyb> well, he came up with the attributes, I added the id
[22:45:17] <acrichto> perhaps yeah, let the attribute bikeshed continue!
[22:45:32] <eddyb> if we add a crate keyword, let's make good use of it :P
[22:46:48] <eddyb> is there something wrong with the test infrastructure?
[22:47:10] <Eridius> flaper87: I haven't found the time to go back and review the current state of it either. Do you want me to do that, or do you want me to hold off until you find a solution for supporting both byte- and char-based patterns?
[22:47:10] <eddyb> because stdtest needs more RAM than librustc to compile
[22:47:29] <eddyb> and I'm starting to swap. wait, it typechecked. I don't need it to run
[22:47:38] *** Quits: canhtak (canhtak@moz-8A625E1D.wl.t.ulaval.ca) (Quit: canhtak)
[22:48:17] <flaper87> Eridius: I think I haven't updated it since you last review. Not sure what the best solution for char + byte check is. I think I'll go with your proposal, though. 
[22:48:52] <Eridius> flaper87: one idea is whether the pattern is a &[u8] or a &str. That may be confusing though. Another is using an enum for the pattern. That may be unwieldy though
[22:48:56] * eddyb wishes he'd think faster
[22:49:48] <eddyb> what's after std in tests? libsyntax?
[22:50:06] <sfackler> all of pretty as well
[22:50:15] <flaper87> Eridius: my concern is that there could be some corner cases we're not considering. For instance, if we go with having both Char and Bytes checked every time, we'll do more checks than we need and in the case of Bytes on unicode paths, we may end up matching more things than we should
[22:50:22] <flaper87> Eridius: I could be wrong but...
[22:50:35] <flaper87> Eridius: I'm starting to think that we should give it a go as-is
[22:50:40] <Eridius> flaper87: with the enum containing both Char and Byte, for any given pattern only one of the two will ever be present
[22:50:48] <Eridius> we won't be able to parse a pattern into a token stream with both Chars and Bytes together
[22:51:31] *** Quits: yuriks (yuriks@14F330CC.3D924459.5419EADB.IP) (Ping timeout)
[22:53:55] <flaper87> Eridius: right, and if we parse it to Bytes we will endup having the same issue we've now if the path is unicode. My suggestion was to have multiple implementations as we do for Path
[22:54:15] <flaper87> based on the OS we could either use Byte or Char
[22:54:27] <Eridius> flaper87: if we parse it to Bytes then I don't see what the issue is. A byte pattern means we're treating the path as bytes instead of as utf-8
[22:54:29] <flaper87> that's not as flexible as we would want but at least it'll be less confusing
[22:55:07] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[22:55:50] *** Quits: Zr40 (zr40@moz-CCFEAB92.adsl.xs4all.nl) (Quit: leaving)
[22:56:20] *** Joins: yuriks (yuriks@14F330CC.3D924459.5419EADB.IP)
[22:56:53] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[23:00:17] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[23:01:48] <flaper87> Eridius: back sorry. No issue there, I'm just trying to think if there's a better way to do it... thinking aloud :D
[23:05:07] *** Joins: canhtak (canhtak@moz-8A625E1D.wl.t.ulaval.ca)
[23:06:44] *** Quits: canhtak (canhtak@moz-8A625E1D.wl.t.ulaval.ca) (Quit: canhtak)
[23:09:32] <eddyb> acrichto: mind giving a r=pcwalton here? https://github.com/mozilla/rust/pull/12030 (I hope I didn't miss any silly test)
[23:09:35] *** Joins: canhtak (canhtak@moz-8A625E1D.wl.t.ulaval.ca)
[23:09:52] <eddyb> now I can sleep :P
[23:12:38] <eddyb> sfackler: you have dem powers?
[23:12:47] <sfackler> yep
[23:13:12] <eddyb> sfackler: I thought you were newer than me... my memory must be playing tricks then
[23:13:28] <sfackler> dunno
[23:15:49] <eddyb> I was wrong :)
[23:16:41] <eddyb> I rank #27 in additions and #21 in deletions (and I might jump a few places soon)
[23:17:32] <eddyb> but only #68 in commits, which is mostly because I'm relatively new and my PRs are monolithic
[23:18:28] <eddyb> maybe github needs a less biased ranking
[23:18:34] <sfackler> yeah, I don't see many PRs that cause Chrome to chug trying to scroll in the diff view
[23:18:39] *** Joins: Axord (xord@moz-C0D5F15A.lsanca.dsl-w.verizon.net)
[23:25:02] *** Joins: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP)
[23:26:43] *** Quits: eddyb (eddy@moz-92B95652.residential.rdsnet.ro) (Ping timeout)
[23:27:11] *** Quits: lpy (lpy@FA66696A.6C1907BC.E99F7FDB.IP) (Ping timeout)
[23:30:08] <Luqman> acrichto: r? https://github.com/mozilla/rust/pull/12051
[23:30:11] *** flaper87 is now known as flaper87|afk
[23:30:40] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[23:31:08] <acrichto> Luqman: longs are 8 bytes on arm, right?
[23:31:19] <acrichto> (just as a sanity check)
[23:32:58] <Luqman> acrichto: er, wait. they might be 4
[23:33:02] <Luqman> lemme check
[23:33:44] <Luqman> yea, it is 4
[23:33:48] <acrichto> oh dear
[23:33:58] <acrichto> on x86 linux, is it also 4?
[23:34:01] <acrichto> that would be bad...
[23:34:30] <acrichto> Luqman: hm, could you change the _align field to longlong ?
[23:34:34] <acrichto> I think that's guaranteed to be 8 bytes
[23:34:39] <acrichto> or just make it a u64 honestly
[23:34:45] <acrichto> no worries making it more aligned
[23:35:20] <Luqman> ok
[23:36:34] <Luqman> acrichto: mutex is long but cond is longlong. is it fine for both to be u64?
[23:36:51] <acrichto> oh wow
[23:36:54] <acrichto> I messed that up 
[23:37:00] <acrichto> they should both be longlong
[23:37:13] *** Parts: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net) ()
[23:38:42] <Luqman> acrichto: ok, done
[23:40:19] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[23:44:07] <cgaebel> I'm getting a failure in compile-fail/gated-phase.rs. is this expected?
[23:44:17] <cgaebel> (stage1-check)
[23:48:39] <acrichto> cgaebel: I wouldn't worry about that
[23:48:59] <cgaebel> achrichto: will do.
[23:49:09] <cgaebel> just making sure I didn't break my environment somhow
[23:49:22] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[23:50:54] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[23:57:45] <cgaebel> does make check-stage1 run all tests in all libraries?
[23:57:51] <cgaebel> (with the stage1)
[23:58:56] <acrichto> cgaebel: I'm not actually sure what subset of tests that runs
[23:59:05] <acrichto> make check-stage1-<lib> will run the library's tests though
[23:59:07] <acrichto> for sure
[23:59:14] <cgaebel> ok I'll do that then to be sure
[23:59:27] <cgaebel> the makefiles are kind of opaque
