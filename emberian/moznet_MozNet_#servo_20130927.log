[00:00:03] <doomlord_> any opinions on NaCl
[00:00:14] <doomlord_> r.e. browser taking over OS features
[00:00:15] <pcwalton> NaCl is a good crypto library
[00:00:19] <pcwalton> ;)
[00:00:49] <doomlord_> from mozilla perspective is it a competing google idea or a feature that could be adopted
[00:00:56] *** Quits: eatkinson (eatkinson@moz-9550586.airbears2.berkeley.edu) (Quit: eatkinson)
[00:04:17] <kmc> I think the problem with NaCl is that the interface to native code is PPAPI, which is basically "all the Chrome internals, as a library"
[00:04:27] <kmc> so it's hard for anyone but Chrome to implement NaCl
[00:05:01] <doomlord_> ah, that sucks
[00:05:11] <doomlord_> so it is  indeed google lockin-ware
[00:05:12] <kmc> https://wiki.mozilla.org/NPAPI:Pepper
[00:05:24] <kmc> at BlinkOn they were talking about deprecating NPAPI in Blink :/
[00:05:37] <kmc> at that point Chrome and Firefox can't use the same plugins at all??
[00:06:18] <kmc> doomlord_: I think NaCl is cool research-wise though, and I'd be interested to see other applications
[00:06:56] <kmc> e.g. running untrusted code in ring 0
[00:07:03] <kmc> generalizing stuff like the berkeley packet filters VM
[00:07:20] <kmc> but I'm not sure it would work in that setting
[00:16:35] *** Quits: Jayflux (Jason@moz-C7758FFB.as13285.net) (Quit: Leaving)
[00:19:48] *** Quits: jet (jet@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: jet)
[00:23:20] <jack> kmc, doomlord_: we're thinking about nacl for sandboxing c/c++ libs.
[00:23:26] <jack> but not as a web facing thing.
[00:26:22] <kmc> yeah that would be cool
[00:26:54] <kmc> I guess the big win is that it lets you sandbox within a single address space
[00:31:01] *** Quits: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: My lid went down)
[00:34:33] *** Quits: dbaron (dbaron@moz-BE33DA21.fw1.sfo1.mozilla.net) (Ping timeout)
[00:50:25] *** Joins: djkim (Mibbit@B4104EBB.3CC170B1.1E14B209.IP)
[00:51:28] *** Quits: djkim (Mibbit@B4104EBB.3CC170B1.1E14B209.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[00:53:33] *** Joins: jaeman (Mibbit@B4104EBB.3CC170B1.1E14B209.IP)
[00:56:04] *** Quits: jaeman (Mibbit@B4104EBB.3CC170B1.1E14B209.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[00:59:14] *** Quits: mccr8 (mccr8@moz-BBE3ABD.mv.mozilla.com) (Quit: mccr8)
[01:02:13] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[01:02:50] <kmc> jack: pcwalton said that Servo crashed in the demo at Strange Loop; do you know what happened?
[01:03:08] <kmc> was that the azure memory leak you mentioned?
[01:06:32] <jack> it didn't crash, the animation halted.
[01:06:36] <jack> I'll PM you the link
[01:06:42] <kmc> ok
[01:08:28] <jack> It happened about 1/4 of the time when I was testing pre-talk. but it happened every time _during_ the talk.
[01:08:37] <kmc> I couldn't reproduce the memory leak before, but I can now, with the CPU rendering patches (but using GPU rendering)
[01:08:38] <jack> Non-fatal but we need to fix this for the summit demo.
[01:09:03] <kmc> that is, I see the system memory usage climb steadily while longcat is running
[01:12:32] <tikue_> slightly OT, but I think the demo still adequately showed what servo's aiming for...
[01:13:34] <tikue_> thought it was slightly unfortunate : ]
[01:14:40] *** Quits: bz (bzbarsky@moz-EA9A3995.bstnma.fios.verizon.net) (Ping timeout)
[01:14:55] <tikue_> murphy's law
[01:17:08] <kmc> so I see a lot of allocation from both SkNativeSharedGLContext::createGLContext and AzDrawTargetCreateSourceSurfaceFromData... but the number of calls to the corresponding destroy functions matches
[01:19:17] *** Quits: dzbarsky (Adium@moz-77B37723.wlan.wireless-resnet.upenn.edu) (Quit: Leaving.)
[01:20:35] *** Joins: eatkinson (eatkinson@moz-E57448EF.airbears2.berkeley.edu)
[01:20:51] <kmc> I also see a lot of calls to GrGpu::createTexture but not to the GrTexture destructor or other likely cleanup points
[01:21:32] <jack> Yes, so the theory of mine was that it was creating texture atlases for each drawtarget and never destroying them
[01:23:31] <jack> http://mxr.mozilla.org/mozilla-central/source/gfx/skia/src/gpu/GrAtlas.h
[01:26:29] <kmc> I'm not seeing any calls to GrAtlas::GrAtlas() or GrAtlasMsg::getTexture()
[01:26:30] <jack> atlases seem to only be freed by ~GrTextStrike
[01:26:53] <jack> When you run this in the GL debugger on OSX you can see the atlas textures
[01:26:55] <kmc> hm this isn't a debug-skia build though, will retry
[01:27:00] <kmc> ah
[01:27:10] *** Joins: dbaron (dbaron@moz-C566053C.dsl.dynamic.sonic.net)
[01:31:22] *** Joins: bz (bzbarsky@moz-EA9A3995.bstnma.fios.verizon.net)
[01:31:26] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[01:33:12] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[01:33:16] *** Quits: fabrice1 (fabrice@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[01:34:42] <kmc> still no atlas calls. i might not be able to debug this particular problem on Linux :/
[01:36:14] <kmc> http://pastebin.mozilla.org/3153798  here's the backtrace for the many createTexture calls
[01:40:01] *** Quits: pcwalton (pcwalton@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: pcwalton)
[01:40:58] *** Quits: vodik (simon@moz-2D668626.cpe.net.cable.rogers.com) (Ping timeout)
[01:43:36] <jack> kmc: here's a test program i wrote when i was working on this: https://gist.github.com/metajack/6723102
[01:43:59] <jack> it approximates servo's stuff except for the multi-threaded part.
[01:44:23] <jack> here's the multithreaded version: https://gist.github.com/metajack/6723117
[01:44:36] *** Joins: brendan (brendaneic@moz-55B1EDE8.public.wayport.net)
[01:45:05] <jack> Not sure if those will help, but thought I'd share.
[01:45:15] <kmc> thanks
[01:47:03] <kmc> it looks like we are creating many GrContexts and never destroying them
[01:47:48] <jack> do they not get destroyed bythe draw target?
[01:48:48] <kmc> I think they should, but it's not what I'm seeing
[01:54:38] *** Joins: annevk (annevk@moz-451D5EF9.nyc.res.rr.com)
[01:55:33] <jack> Sounds like messed up the refcount protocol then.
[01:55:45] <kmc> yep. looking into it
[01:56:17] <jack> AzCreateSkiaDrawTargetForFBO
[01:56:20] *** Quits: annevk (annevk@moz-451D5EF9.nyc.res.rr.com) (Ping timeout)
[01:56:27] <jack> that creates the GrContext for the draw target.
[01:56:55] <jack> man, makefile debuggin si the worst.
[02:01:56] <cmr> jack: isn't it?
[02:04:02] *** Joins: dzbarsky (Adium@76587571.D5562F02.B5C6E82B.IP)
[02:05:50] <jack> i learned a new trick from pnkfelix today. --warn-undefined-variables
[02:05:54] <jack> why is that not hte default?
[02:06:27] <tikue_> what is an undefined variable 
[02:07:58] <jack> i you use $FOO but FOO isn't defined.
[02:08:08] *** Quits: brendan (brendaneic@moz-55B1EDE8.public.wayport.net) (Ping timeout)
[02:08:20] <jack> with the amount of things that finds, i'm not sure why makefiles ever worked.
[02:09:18] *** Joins: annevk (annevk@moz-451D5EF9.nyc.res.rr.com)
[02:09:42] *** Joins: dzbarsky1 (Adium@E5216EFC.D5562F02.B5C6E82B.IP)
[02:10:39] *** Quits: eatkinson (eatkinson@moz-E57448EF.airbears2.berkeley.edu) (Quit: eatkinson)
[02:11:03] *** Quits: dzbarsky (Adium@76587571.D5562F02.B5C6E82B.IP) (Ping timeout)
[02:18:24] *** Quits: azakai (alon@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[02:21:03] *** Joins: eatkinson (eatkinson@moz-E57448EF.airbears2.berkeley.edu)
[02:26:10] <tikue_> what's the main source of rendering appearing slow? the lack of heuristics for how much should be rendered? or something else?
[02:26:26] <jack> not sure what you're asking
[02:26:32] <tikue_> like 
[02:26:39] <jack> rendering is currently dominated by allocation time of the drawtargets it hink.
[02:26:41] <tikue_> when scrolling down a wikipedia page and you see the gray
[02:26:51] <jack> oh, that i don't know.
[02:28:02] <tikue_> maybe it has to do with gpu latency, and the renderer should just send larger requests
[02:28:31] <jack> well we should be prerendering the bits off screen to anticipate scrolling
[02:28:44] <jack> right now i think we don't render anything until we need to draw it.
[02:28:52] <jack> er, until it's in the viewport
[02:29:16] <tikue_> yeah we definitely don't. but it seems like chrome renders most of the page before you do any scrolling, because if you just drag the bar all the way down there's literally no grayboxing
[02:29:42] <tikue_> i seriously doubt it's rendering instantly on the fly
[02:29:58] <jack> they are prerendering it i imagine
[02:30:04] <jack> by the time you scroll, it's already rendered
[02:30:22] <jack> whereas we dont' start rendering until the compositor asks to for the tile.
[02:30:35] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[02:30:35] *** ChanServ sets mode: +qo dherman dherman
[02:30:56] <tikue_> yeah -- we used to naively render all at once, the compositor had no problem keeping up with painting when scrolling fast
[02:32:57] <tikue_> i don't fully understand how the renderer works, but it gets all the layout info at once right? it could go ahead and render more stuff in the background
[02:36:24] <jack> Yes
[02:36:29] <jack> It has the displaylists already
[02:37:22] *** Quits: zz_kimundi (kimundi@moz-822AC7D.dip0.t-ipconnect.de) (Ping timeout)
[02:37:32] *** Joins: vodik (simon@moz-2D668626.cpe.net.cable.rogers.com)
[02:40:41] *** Joins: zz_kimundi (kimundi@moz-221F72D2.dip0.t-ipconnect.de)
[02:40:42] *** zz_kimundi is now known as kimundi
[02:41:52] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[02:54:34] *** Quits: sankha93 (Instantbir@7061CD01.D6BD0D91.22D41759.IP) (Quit: Gone to save the world!)
[03:04:24] <jack> woah
[03:04:30] <jack> i think i got rustpkg building modules!
[03:04:42] <jack> and fixed a ton of makefile bugs
[03:08:28] *** Joins: pcwalton (pcwalton@moz-BE33DA21.fw1.sfo1.mozilla.net)
[03:08:28] *** ChanServ sets mode: +o pcwalton
[03:09:35] <jack> and of course i hit the removal of @fn
[03:09:37] <jack> *sigh*
[03:15:09] <jack> brson: if i have a ~fn, and a &~fn gets stored in an unsafe pointer, how do i get it back out to call it?
[03:15:39] <jack> error: cannot move out of dereference of & pointer
[03:16:01] <jack> can't out of * pointer either.
[03:17:24] <brson> jack: maybe transmute the pointer to *Closure, copy out the Closure and transmute it to ~fn
[03:17:32] <brson> sucks
[03:17:53] <jack> how do i copy ou thte closure?
[03:18:02] <jack> will .clone() work?
[03:18:26] <brson> jack: it should be implicitly copyable. it's just `struct Closure { *(), *() }`
[03:18:37] <brson> unstable::raw::Closure
[03:19:02] <jack> oh dear god
[03:19:17] *** Quits: vodik (simon@moz-2D668626.cpe.net.cable.rogers.com) (Ping timeout)
[03:19:20] <jack> is there a better way? should i stuff callbacks into TLS?
[03:19:27] * jack shoudl go look at what glfw-rs did
[03:20:07] <brson> if you don't need to move it out then you can coerce the ~fn to &fn
[03:20:34] <brson> let foo: &fn() = *unsafe_fn;
[03:20:38] <brson> maybe
[03:23:03] <jack> that doesn't work. still tries to move.
[03:23:12] <jack>         let hlcb: &fn(parent: &Option<CssHint>, child: &CssHint) -> CssHint = unsafe { *hlcbptr };
[03:23:12] <jack>  
[03:23:58] <jack> hlcbptr is *~fn(...) -> CssHInt
[03:24:47] <tikue_> jack: that sounds gross, but \O/ about rustpkg!!
[03:25:10] <jack> pcwalton: you must have fixed this what did you do?
[03:26:21] <pcwalton> fixed it where?
[03:26:30] <pcwalton> I didn't upgrade rust past the @fn removal
[03:26:36] <jack> pcwalton: :(
[03:26:41] <pcwalton> you can always convert @fn to @Trait
[03:26:42] <jack> so much for the easy solution.
[03:26:44] <pcwalton> they're exactly equivalent
[03:27:10] <jack> so every callback is a small trait?
[03:28:50] *** Quits: dzbarsky1 (Adium@E5216EFC.D5562F02.B5C6E82B.IP) (Quit: Leaving.)
[03:29:19] *** Joins: dzbarsky (Adium@E5216EFC.D5562F02.B5C6E82B.IP)
[03:30:23] <jack> error: type `@computed::ComputeFontSize:'static` does not implement any method in scope named `compute_font_size`
[03:30:24] <jack>  
[03:31:16] <jack> does something have to implement that trait?
[03:31:46] *** Quits: dzbarsky (Adium@E5216EFC.D5562F02.B5C6E82B.IP) (Quit: Leaving.)
[03:33:58] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[03:37:28] <jack> trait Foo { fn foo(); }
[03:37:45] <jack> fn bar(f: @Foo) {
[03:37:53] <jack>   f.foo();
[03:37:54] <jack> }
[03:38:04] <jack> gives me type @Foo doesn't ipmlement any metho named foo
[03:40:14] <jack> I'm also not sure how I"m supposed to create a callback. I guess I'd make a dummy struct and then do an impl.
[03:45:33] <pcwalton> you make a struct for the upvars
[03:45:39] <pcwalton> and then make a trait
[03:45:58] <pcwalton> is this just for netsurfcss?
[03:46:26] <pcwalton> whoa, I converted the entire flow tree to ~Trait and once compiling it worked
[03:46:28] <jack> Yes. I fixed it. except for the caller side.
[03:46:30] <pcwalton> I guess that's not too surprising though
[03:46:38] <pcwalton> since there can't be dynamic borrows with ~Trait
[03:46:42] <pcwalton> but it means the compiler is less buggy, yay
[03:46:49] <jack> i ahve to upgrade rust again no becuase extra::url::Url became private for a time.
[03:46:57] <jack> pcwalton: that's awesome
[03:47:07] * pcwalton checks perf
[03:48:11] <jack> can ~Trait be statically dispatched ever? I assume not
[03:49:12] *** Quits: eatkinson (eatkinson@moz-E57448EF.airbears2.berkeley.edu) (Quit: eatkinson)
[03:51:52] <pcwalton> it can't, but I added an unsafe hack to allow some static dispatch where it can be
[03:52:02] <pcwalton> ok, that was a 3% improvement, now we're 10% slower than gecko
[03:52:34] <jack> have you inlined hte C FFI stuff yet?
[03:53:06] <jack> most of the netsurf functions looked really simple last i was poking around in there.
[03:53:26] <pcwalton> jack: yes
[03:53:30] <pcwalton> I can PR that really soon actually
[03:53:41] <pcwalton> the biggest problem is that netsurf is just algorithmically worse than both gecko and webkit
[03:53:43] <pcwalton> it's really a netsurf problem
[03:53:48] <jack> ok
[03:53:51] <pcwalton> it should be eagerly converting from units to Au during selector matching
[03:53:59] <pcwalton> instead of converting every single time you request a property
[03:54:05] <pcwalton> these conversions are slow
[03:54:10] <pcwalton> and they dominate the asm now
[03:54:21] <pcwalton> I suspect massive speedups once this is fixed
[03:54:46] <pcwalton> they're floating point conversions even -- I could fix that but it seems barely worth it given that SimonSapin's stuff gets rid of netsurf
[03:58:17] *** Joins: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP)
[03:58:17] <ghservo> [13servo] 15kmcallister opened issue #979: GrContext leak  02http://git.io/-DPmWg
[03:58:17] *** Parts: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP) ()
[03:59:26] <pcwalton> uhhh
[03:59:46] <pcwalton> no way
[04:00:00] <tikue_> ?
[04:00:46] <pcwalton> sec
[04:01:21] <jack> kmc: i don't unerstadn why refcount would ever be 2.
[04:01:26] <jack> much less 3!
[04:01:48] <kmc> well it reaches 4 in fact :)
[04:01:51] <kmc> anyway that makes two of us
[04:02:19] *** kanru is now known as kanru|away
[04:02:26] <kmc> (I did check the refcount field directly as well as counting ref/unref calls)
[04:02:36] *** Joins: fabrice (fabrice@moz-94F028C6.hsd1.ca.comcast.net)
[04:02:41] <pcwalton> oh my God
[04:02:46] <pcwalton> I was measuring two Servo reflows instead of one
[04:02:48] <pcwalton> this whole time
[04:02:50] <tikue_> wat
[04:02:53] <pcwalton> ok we're way faster than gecko
[04:02:55] <tikue_> lOL
[04:03:01] <tikue_> \O/ wowowow
[04:03:06] <tikue_> are you sure pcwalton 
[04:03:10] <pcwalton> yeah I'm pretty sure
[04:03:16] <pcwalton> I can remeasure gecko
[04:03:57] * tikue_ thinks the renderer should do way more prerendering so that the layout speed is human-noticeable
[04:04:12] <tikue_> pcwalton: when is this stuff expected to land in master?
[04:04:36] <pcwalton> ok, that makes more sense
[04:04:39] <pcwalton> I can submit it now
[04:04:42] <pcwalton> so
[04:04:45] <pcwalton> we're 1.8x faster than Gecko
[04:04:50] <pcwalton> and 7% slower than WebKit
[04:05:37] <tikue_> that'sâ€¦really impressive.
[04:06:08] <pcwalton> it's also silly because netsurf is so slow
[04:06:12] <pcwalton> we should be able to easily beat webkit
[04:06:18] <pcwalton> once that's fixed
[04:06:57] <tikue_> when will SimonSapin's stuff land
[04:06:59] <kmc> awesome
[04:07:12] <jack> kmc: do objects get created with refcnt =1?
[04:08:21] <jack> kmc: line 188 of SkNativeSharedGLContext_mac.cpp has a spurious AddRef i think
[04:08:27] <jack> probably in the same spot in the others too
[04:08:29] <kmc> jack: I think they do
[04:08:33] <pcwalton> hmm, I'm seeing Gecko's stuff faster than I measured it before
[04:08:35] <pcwalton> we still win though
[04:08:59] <kmc> yep SkRefCnt() : fRefCnt(1) {}
[04:09:06] <jack> kmc: yeah, remove that line and i think the bug will be gone.
[04:09:17] <jack> because we AddRef at the caller
[04:09:33] <tikue_> by how much
[04:09:34] <jack> the convention is hte caller takes the ref
[04:09:44] <jack> and right now we do it on both sides :(
[04:10:20] <kmc> I was wondering about that, but I think the ref is for the struct SkNativeSharedGLContext holding onto it in fGrContext
[04:10:27] <jack> wait until we have simon's style stuff + parallel layout :)
[04:10:36] <kmc> note that the if (fGrContext) branch doesn't AddRef
[04:10:48] <jack> kmc: but Create already has a ref
[04:11:03] <jack> since we called create, we own it.
[04:11:11] <kmc> *nod*
[04:11:19] <kmc> that might be right, I'll look into it more
[04:12:02] <kmc> every minute spent thinking about this stuff makes me appreciate Rust more :)
[04:12:06] <pcwalton> hmm, seeing a lot of variability
[04:12:12] <pcwalton> in webkit
[04:13:06] *** Quits: lmandel (lmandel@moz-76CE9D51.cable.teksavvy.com) (Quit: lmandel)
[04:13:15] <pcwalton> ok, servo is faster than both webkit and gecko
[04:13:18] <pcwalton> for this benchmark
[04:13:18] <pcwalton> so, yay
[04:13:56] <jack> pcwalton++
[04:14:17] <pcwalton> gecko and webkit are about the same speed and we're about 30% faster than either
[04:14:21] <pcwalton> now I have an old version of safari
[04:14:31] <pcwalton> and my chrome has no profiling symbols
[04:14:34] <pcwalton> but I'm cautiously optimistic
[04:14:42] <jack> pcwalton: can you wite up a quick summary to the list? i think samsung will be happy to hear the news.
[04:14:45] <pcwalton> sure
[04:15:44] <tikue_> this seems pretty huge
[04:16:01] <pcwalton> it's so easy to mess up
[04:16:08] <pcwalton> let's not go wild and crazy with these numbers yet
[04:16:09] <pcwalton> it's 9 PM here ;)
[04:16:13] <tikue_> true
[04:16:15] <pcwalton> but yes it's cool
[04:17:51] <jack> tikue: to be fair, the gecko devs expected us to beat them.
[04:18:19] <jack> pcwalton: it would be interesting to check that gecko version dbaron suggested
[04:18:27] <jack> pre-margin-collapsing changes
[04:18:37] <tikue_> jack: but we weren'tâ€¦or at least we didn't know itâ€¦until now
[04:19:02] <jack> we certainly weren't before pcwalton's changes :)
[04:19:04] <tikue_> jack: that's a good idea
[04:19:56] <jack> pcwalton: if we can get this landed before summit and detail the test, we could tell everyone about it there.
[04:20:05] <pcwalton> sent to the ML
[04:20:05] <jack> pcwalton: what page are you testing on btw?
[04:20:12] <tikue_> the rainbow page presumably
[04:23:09] <pcwalton> jack: it's in the mailing list
[04:23:10] <pcwalton> blocky.html
[04:23:26] <pcwalton> I'll send a PR for my netsurf and rust-css changes
[04:23:30] <pcwalton> those are easy
[04:24:21] <tikue_> pcwalton: throw timecube at it?
[04:24:37] <pcwalton> tikue_: it'll be less good there
[04:24:43] <pcwalton> also that isn't really fair since we don't support all the layout features of timecube
[04:24:51] <tikue_> ah true
[04:24:53] <pcwalton> this page was specifically crafted to NOT have any shaping in it
[04:24:59] <tikue_> ok
[04:25:33] * tikue_ can't wait to see timecube in its full servo glory
[04:26:17] <pcwalton> btw I prefer http://longestjokeintheworld.com/ these days
[04:27:58] <tikue_> doesn't load on my servo
[04:28:25] <pcwalton> yeah, probably doesn't
[04:28:53] <pcwalton> oh yeah, I need a rustc fix for this...
[04:29:29] *** Quits: tikue_ (tkuehn@B489EA5.B9B3942C.689607DE.IP) (Quit: tikue_)
[04:31:12] *** Joins: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP)
[04:31:12] <ghservo> [13rust-netsurfcss] 15pcwalton opened pull request #32: Inline stuff and don't call through to the FFI for many properties. (06master...06gofast)  02http://git.io/qYWX4Q
[04:31:12] *** Parts: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP) ()
[04:31:46] *** Quits: annevk (annevk@moz-451D5EF9.nyc.res.rr.com) (Input/output error)
[04:31:53] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[04:31:53] *** ChanServ sets mode: +qo dherman dherman
[04:32:01] <pcwalton> dherman: 30% faster than gecko and webkit
[04:32:02] <pcwalton> according to my tests
[04:32:10] <pcwalton> could be WILDLY wrong
[04:32:25] <dherman> pcwalton: !!
[04:32:30] <dherman> pcwalton: single-core?
[04:32:31] <pcwalton> yeah
[04:32:33] <pcwalton> no parallelism yet
[04:32:42] <dherman> that is really exciting
[04:32:43] <pcwalton> just silly optimizations
[04:33:01] <dherman> are they easier to do here than gecko because of rust or because of servo
[04:33:02] <dherman> ?
[04:33:14] <dherman> i.e., is it the architecture or the language that's making it so easy to do
[04:33:20] <pcwalton> well, I guess both, we control the compiler
[04:33:24] <dherman> (not that your work is easy, but one engineer in two days is impressive)
[04:33:27] <pcwalton> so when I see problems I know how to fix it
[04:33:31] <pcwalton> it wasn't 2 days, it was a week :P
[04:33:37] <dherman> oh well then ;)
[04:33:43] <jack> hanging out with mraleph a bit at strangeloop, he was quite jealous of our ability to control the compiler :)
[04:33:54] <pcwalton> it helps a lot
[04:34:04] <pcwalton> if I see stupid asm being generated I just file an issue or fix
[04:34:18] <pcwalton> also I know the compiler which is equally as important as fixing it
[04:34:20] <pcwalton> nobody knows MSVC
[04:34:23] <dherman> yeah
[04:34:28] <pcwalton> equally as important as controlling it, rather
[04:34:35] <dherman> I guess I never really thought about that as an advantage
[04:34:46] <dherman> I think people tend to look at rust as one of the crazier aspects of servo
[04:34:48] <pcwalton> at this point I know pretty well what optimizations LLVM does
[04:34:56] <dherman> but being able to control the compiler is a pretty badass advantage
[04:35:14] <pcwalton> well, to be fair, we control the backend as much as google "controlled" webkit before forking it...
[04:35:23] <pcwalton> but strcat and I know what it does
[04:35:41] <dherman> still, you can control trans
[04:35:44] <pcwalton> yeah
[04:36:07] <pcwalton> btw, there is still some netsurf-induced overhead
[04:36:11] <pcwalton> this is not as fast as we can go
[04:36:18] <pcwalton> we should be able to go quite a bit faster
[04:36:23] <jack> pcwalton: I thought you couldnt' do fixed_stack_segment with inline?
[04:36:25] <dherman> awesome
[04:36:28] <pcwalton> not even counting parallelism
[04:36:35] <pcwalton> jack: good point
[04:36:39] <pcwalton> oh wait
[04:36:40] <pcwalton> yes, you can
[04:36:44] <pcwalton> fixed stack segment will get propagated up
[04:36:49] <pcwalton> there is some debate as to whether that is the right behavior
[04:37:27] <jack> ok. r+ then.
[04:37:49] *** Joins: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP)
[04:37:49] <ghservo> 01[13rust-netsurfcss01] 15metajack pushed 2 new commits to 06master: 02http://git.io/O2DqGg
[04:37:49] <ghservo> 13rust-netsurfcss/06master 147d68385 15Patrick Walton: Inline stuff and don't call through to the FFI for many properties.
[04:37:49] <ghservo> 13rust-netsurfcss/06master 146db29f0 15Jack Moffitt: Merge pull request #32 from pcwalton/gofast...
[04:37:49] *** Parts: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP) ()
[04:37:54] *** Joins: ghservo (ghservo@79968228.6A2AE50.F3114085.IP)
[04:37:54] <ghservo> [13rust-css] 15pcwalton opened pull request #37: Inline all the things (06master...06inline)  02http://git.io/0rMpdA
[04:37:54] *** Parts: ghservo (ghservo@79968228.6A2AE50.F3114085.IP) ()
[04:38:02] <pcwalton> r? on that too
[04:38:16] <dherman> pcwalton: is this an end-to-end benchmark you're doing?
[04:38:20] <dherman> or is it just isolating layout?
[04:38:24] <pcwalton> it is isolating layout
[04:38:26] <jack> what's SCCP?
[04:38:27] <pcwalton> and isolating BLOCK layout
[04:38:32] <pcwalton> sparse conditional constant propagation
[04:38:54] <pcwalton> eliminating branches by propagating information about "this thingy was known to be true at this location so it must be true at that other place"
[04:39:14] <pcwalton> it helps LLVM to eliminate *some* of the overhead from our netsurfcss->rust-css conversion (not all)
[04:39:35] <pcwalton> dherman: I deliberately crafted the benchmark to not have any text/shaping in it
[04:39:42] <pcwalton> because I know we don't have all of gecko's caches there and will lose
[04:39:44] <pcwalton> and webkit cheats
[04:39:46] <pcwalton> so we'll lose to them too
[04:40:14] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[04:40:14] <ghservo> 01[13rust-css01] 15metajack pushed 2 new commits to 06master: 02http://git.io/7Ecbfg
[04:40:14] <ghservo> 13rust-css/06master 14a4fc2fb 15Patrick Walton: Inline all the things
[04:40:14] <ghservo> 13rust-css/06master 14bb31565 15Jack Moffitt: Merge pull request #37 from pcwalton/inline...
[04:40:15] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[04:40:31] <dherman> always been curious to understand what kinds of things webkit does to do text shaping wrong/faster
[04:40:49] <pcwalton> they just don't shape
[04:40:55] <dherman> ?
[04:40:56] <pcwalton> so no kerning/ligatures
[04:41:00] <dherman> whoa
[04:41:02] <pcwalton> they pass basic advances straight to coregraphics
[04:41:16] <pcwalton> unless it is (a) non-latin text or (b) you say text-rendering: optimizeLegibility; in the css
[04:41:35] <dherman> wow
[04:41:42] <dherman> maybe servo should do the same
[04:41:44] <pcwalton> no
[04:41:47] <pcwalton> jonathan kew said don't do it
[04:41:51] <pcwalton> just cache like gecko
[04:41:54] <dherman> ah
[04:42:05] <dherman> so gecko doesn't do it too much slower?
[04:42:21] <pcwalton> apparently when they ripped the code to gecko out that did what webkit did it didn't result in a regression
[04:42:29] <pcwalton> because of all the caches
[04:42:42] <pcwalton> dherman: jfkthame gave me this testcase
[04:42:53] <pcwalton> in your favorite google browser enter this into the url bar:  data:text/html,<div style="font:16px Times New Roman">AWAKE! To Tell You The Truth 
[04:42:58] <pcwalton> then try firefox
[04:43:01] <pcwalton> it's much better in firefox
[04:43:31] <dherman> wow
[04:43:31] <dherman> yeah
[04:43:55] <dherman> same with safari, naturally
[04:43:57] <pcwalton> right
[04:44:01] <dherman> yuck!
[04:44:27] <dherman> what are the keys in the cache?
[04:44:36] <dherman> characters? bigrams? words? ...?
[04:44:43] <dherman> bigram is the wrong word
[04:44:46] <dherman> I guess I meant pairs of characters
[04:45:05] <pcwalton> textruns
[04:45:08] <pcwalton> words
[04:45:09] <pcwalton> basically
[04:45:11] <pcwalton> we need a word cache
[04:45:21] <dherman> I'm surprised that's not a big memory hog
[04:45:26] <pcwalton> (strictly speaking a word cache is a cheat too because it is legal to have ligatures that span words)
[04:45:31] <pcwalton> (but basically no fonts do it)
[04:46:18] <dherman> also unclear whether to have a separate cache per layout task or have a shared cache and risk excessive blocking
[04:46:28] <pcwalton> yeah, we always have that dilemma in servo
[04:46:34] <pcwalton> it's not blocking, it's cache contention
[04:46:38] <pcwalton> you can just lock free hash and you're fine
[04:46:49] <pcwalton> it's just that lock free implies atomics, atomics are bad with mesi cache coherence....
[04:46:54] <pcwalton> no free lunch
[04:47:34] <dbaron> I think we disable the word cache when the font has a ligature containing space
[04:48:03] <pcwalton> dbaron: aha
[04:48:24] <pcwalton> I was just wondering whether there would be some way to make the cache optimistic and fall back to slowness otherwise
[04:48:27] <dherman> seems like it'd be worth a devtools warning
[04:48:35] <dherman> WARNING: you are using a font that is slow
[04:48:43] <pcwalton> "warning: this font is awful, choose helvetica instead"
[04:48:48] <dherman> hahaha
[04:48:52] <dherman> pcwalton: y u no comic sans
[04:49:06] <dherman> if you use it ironically it's as cool as helvetica
[04:49:16] <pcwalton> just disable the word cache in comic sans
[04:49:19] <pcwalton> to punish authors for using it
[04:49:23] <dherman> win
[04:50:06] <dherman> pcwalton: so you're saying that atomic operations tend to cause cache misses?
[04:50:21] * dherman knows very little about atomics
[04:51:20] <pcwalton> dherman: they just cause cache invalidation because the memory bus has to lock everyone else out
[04:51:55] <dherman> oh
[04:52:12] <dherman> so their actual implementation forceably invalidates the cache?
[04:52:17] <pcwalton> that's why they're so expensive, you have to transition the memory into Exclusive state
[04:52:21] <pcwalton> http://stackoverflow.com/questions/2538070/atomic-operation-cost
[04:52:21] <dherman> yuck
[04:54:17] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[04:54:55] <pcwalton> ok, rust PR submitted https://github.com/mozilla/rust/pull/9560
[04:55:21] *** Quits: pcwalton (pcwalton@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: pcwalton)
[04:55:56] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[05:01:53] *** Joins: jdm (jdm@92FB48CA.8B5E9DF.9A8C35B4.IP)
[05:01:53] *** ChanServ sets mode: +o jdm
[05:07:33] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[05:08:47] <tikue> what is the difference i'm supposed to see in "AWAKE! To Tell You The Trut"
[05:08:55] <tikue> chrome/firefox look very similar to me
[05:15:26] *** Quits: dbaron (dbaron@moz-C566053C.dsl.dynamic.sonic.net) (Ping timeout)
[05:18:11] *** kanru|away is now known as kanru
[05:21:36] <fabrice> tikue: take a close look at the spacing between 'Y' and 'o' for instance
[05:22:27] <tikue> fabrice: oh, yeah it's much closer together in firefox
[05:22:39] <tikue> oh and the 'T' and 'o' as well
[05:22:41] * tikue can't unsee 
[05:23:04] <tikue> oh god it's almost all of them
[05:32:09] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[05:33:57] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[05:42:49] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[05:53:30] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[05:55:00] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[05:57:58] *** bz is now known as bz_sleep
[05:58:33] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[06:07:08] *** Quits: jdm (jdm@92FB48CA.8B5E9DF.9A8C35B4.IP) (Ping timeout)
[06:09:30] *** Joins: valenting (Thunderbir@C6866972.77435D89.FB866788.IP)
[06:09:46] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[06:09:46] *** ChanServ sets mode: +o jdm
[06:17:05] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[06:19:18] *** Joins: Debloper (debloper@moz-88FF8AE8.redhat.com)
[06:21:39] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[06:23:30] *** Joins: unbloat (unbloat@5BC9F1D1.3238CD1B.A3D1B221.IP)
[06:24:31] <jdm> SimonSapin: https://groups.google.com/a/chromium.org/forum/#!topic/blink-dev/OvnkiByaI3g
[06:33:53] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[06:46:28] *** Quits: valenting (Thunderbir@C6866972.77435D89.FB866788.IP) (Ping timeout)
[06:56:20] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Bye!)
[06:56:26] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[07:07:57] <jack> i hate make. that is all.
[07:08:07] *** jack is now known as jack|zzz
[07:26:43] <SimonSapin> jdm: very interesting. rust-cssparserâ€™s "trees of component values" definitely allow lazy parsing
[07:27:24] <SimonSapin> in fact I tried (and failed) to use extra::future at some point for @import, but it could be used for plain parsing as well
[07:41:06] *** Joins: tgummerer (tgummerer@moz-5DC8FA44.tbcn.telia.com)
[07:43:12] *** Quits: tgummerer (tgummerer@moz-5DC8FA44.tbcn.telia.com) (Ping timeout)
[07:55:39] <dbaupp> SimonSapin: extra::future is very crufty (which is probably part of the problems you had)
[07:56:08] *** Quits: heather (heather@moz-A0276582.hsd1.ca.comcast.net) (Client exited)
[07:56:28] *** Joins: heather (heather@moz-A0276582.hsd1.ca.comcast.net)
[07:57:41] *** Joins: tgummerer (tgummerer@51D3B54.FEF996EA.EA6FEF3D.IP)
[07:58:14] *** Joins: sankha93 (Instantbir@7061CD01.D6BD0D91.22D41759.IP)
[07:58:27] *** Quits: heather (heather@moz-A0276582.hsd1.ca.comcast.net) (Ping timeout)
[08:08:40] <SimonSapin> dbaupp: yes, I wish it had .get_mut_ref()
[08:13:33] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Ping timeout)
[08:14:55] *** Quits: alex-abreu (alex@moz-7421D6C9.mc.videotron.ca) (Ping timeout)
[08:21:32] *** Quits: unbloat (unbloat@5BC9F1D1.3238CD1B.A3D1B221.IP) (Quit: Leaving)
[08:21:54] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[08:31:13] *** Joins: bholley (anonymous@moz-D5EB36E2.rev.numericable.fr)
[08:44:59] *** Joins: Ms2ger (Ms2ger@9D0A393.CB23CDC6.3773EA9F.IP)
[08:57:40] *** Joins: alex-abreu (alex@moz-7421D6C9.mc.videotron.ca)
[09:16:42] *** Joins: victorporof (victorporo@77FE7E86.477C3F8E.79933D60.IP)
[10:05:23] *** Quits: victorporof (victorporo@77FE7E86.477C3F8E.79933D60.IP) (Quit: victorporof)
[10:08:16] *** Quits: doomlord_ (servitor@moz-2BA2D1DA.range86-184.btcentralplus.com) (Connection reset by peer)
[10:11:45] *** Joins: doomlord_ (servitor@moz-2BA2D1DA.range86-184.btcentralplus.com)
[10:19:37] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[10:20:02] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[10:34:25] *** Quits: sankha93 (Instantbir@7061CD01.D6BD0D91.22D41759.IP) (Quit: Gone to save the world!)
[10:48:04] *** Joins: victorporof (victorporo@8AB918FF.D4B9BCD.9B1E38F4.IP)
[12:01:17] *** Joins: heather_ (heather@moz-A0276582.hsd1.ca.comcast.net)
[12:03:08] *** Quits: heather_ (heather@moz-A0276582.hsd1.ca.comcast.net) (Ping timeout)
[12:22:30] *** Joins: eagen (eagen@8737942B.7A99C13A.B7961A98.IP)
[12:31:47] *** Quits: nathan7 (nathan@moz-60FC7746.nathan7.eu) (Ping timeout)
[12:45:26] *** Joins: nathan7 (nathan@moz-60FC7746.nathan7.eu)
[13:09:26] *** Quits: six600110 (six600110@moz-3C5CCD60.neo.res.rr.com) (Ping timeout)
[13:25:27] *** Joins: ahal (ahal@F77132FB.12EEDBD3.6BEEAEBD.IP)
[13:32:37] *** Joins: lbergstrom (Adium@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net)
[13:34:40] *** Joins: sankha93 (Instantbir@7061CD01.D6BD0D91.22D41759.IP)
[13:49:56] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[13:49:56] *** ChanServ sets mode: +o jdm
[13:59:39] *** Joins: six600110 (six600110@moz-3C5CCD60.neo.res.rr.com)
[14:00:20] *** Quits: Debloper (debloper@moz-88FF8AE8.redhat.com) (Quit: Leaving.)
[14:07:38] *** Joins: annevk (annevk@moz-451D5EF9.nyc.res.rr.com)
[14:09:53] *** Joins: exobit_ (textual@moz-E06F46F0.corp.bitshelter.com)
[14:24:09] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[14:24:09] *** ChanServ sets mode: +qo dherman dherman
[14:31:30] *** jack|zzz is now known as jack
[14:33:33] *** Joins: jensnockert (jensnocker@F1E3FD84.8AAAF769.FAAB0799.IP)
[14:40:50] *** Joins: dbaron (dbaron@moz-C566053C.dsl.dynamic.sonic.net)
[14:43:21] *** Quits: fabrice (fabrice@moz-94F028C6.hsd1.ca.comcast.net) (Quit: Leaving.)
[15:07:59] *** Joins: Kostic (marko@C4D4CB5C.58A2DD99.2168A69F.IP)
[15:11:41] <jack> I think that make and rustc are just fundamentally incompatible.
[15:12:01] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[15:12:35] <dbaupp> jack: rustc and rustpkg less so, hopefully
[15:12:59] <jack> rustpkg is fine.
[15:13:07] <jack> the issue is that rustc generates an unknown filename
[15:13:11] <jack> make can't deal with this at all.
[15:13:46] <dbaupp> ah, with the hash?
[15:15:10] <klutzy> libsome.dummy hack seems to work at first but it does not if hash changes
[15:15:29] <jack> the issue is that i am building some stuff with rustpkg now
[15:15:54] <jack> .dummy only works if make is checking the source files for changes.
[15:16:33] <jack> we have targets in servo like rust-geom and sharegl
[15:16:41] <jack> but those are PHONY targets
[15:16:51] <jack> but you can't use a PHONY target in a prereq along with a file target
[15:16:55] *** bz_sleep is now known as bz
[15:17:04] <jack> so i can't make servo depend on rustpkg built libs :(
[15:17:15] <jack> trying to use order-only prereqs now
[15:18:11] <jack> jdm: do you get a warning when compiling rust-http about missing debuginfo?
[15:18:28] <klutzy> I think I got yesterday
[15:18:58] <jdm> jack: I don't recall seeing that before
[15:19:15] <jdm> jack: although that's common on os x when not building with -Z debug-info
[15:19:24] <klutzy> src/libhttp/client/request.rs:77:8: 101:9 warning: debuginfo: Could not find namespace node for function
[15:19:43] <cmr> mw said not to worry about it in his most recent blog post
[15:20:05] <jdm> klutzy: https://github.com/mozilla/rust/issues/9268
[15:20:15] <jdm> just needs someone to look into it at some point
[15:23:02] *** Joins: fabrice (fabrice@moz-BBE3ABD.mv.mozilla.com)
[15:24:07] *** Joins: dzbarsky (Adium@76587571.D5562F02.B5C6E82B.IP)
[15:24:14] *** Quits: dzbarsky (Adium@76587571.D5562F02.B5C6E82B.IP) (Client exited)
[15:24:58] <jack> jdm: ok. just wanted to make sure it was filed
[15:25:10] *** Quits: eagen (eagen@8737942B.7A99C13A.B7961A98.IP) (Client exited)
[15:27:14] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[15:27:31] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[15:29:49] <jack> sigh. order only dependencies don't work either.
[15:31:41] *** Joins: dzbarsky (Adium@E5216EFC.D5562F02.B5C6E82B.IP)
[15:32:34] *** Joins: mccr8 (mccr8@moz-BBE3ABD.mv.mozilla.com)
[15:34:52] *** Joins: eagen (eagen@8737942B.7A99C13A.B7961A98.IP)
[15:42:33] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Ping timeout)
[15:47:27] *** Quits: jensnockert (jensnocker@F1E3FD84.8AAAF769.FAAB0799.IP) (Input/output error)
[15:56:45] *** Quits: Kostic (marko@C4D4CB5C.58A2DD99.2168A69F.IP) (Client exited)
[15:57:08] *** Quits: fabrice (fabrice@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[16:01:35] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[16:01:37] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[16:16:22] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[16:16:23] *** ChanServ sets mode: +qo dherman dherman
[16:17:16] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[16:19:49] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[16:28:27] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[16:29:22] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[16:33:02] *** Joins: tjc (tjc@moz-FEE214EF.tmodns.net)
[16:33:02] *** ChanServ sets mode: +o tjc
[16:36:15] *** Joins: jet (jet@moz-79F891EE.hsd1.ca.comcast.net)
[16:41:52] <jack> tjc: i am in Makefile hell
[16:42:07] <jack> tjc: how much do you know about make? :)
[16:50:20] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[16:51:36] *** Quits: tjc (tjc@moz-FEE214EF.tmodns.net) (Quit: zzzzzzzzzz)
[16:54:16] *** Quits: jet (jet@moz-79F891EE.hsd1.ca.comcast.net) (Quit: jet)
[16:58:17] <lbergstrom> jack: any specific questions? I have fought the demons of autotools and make before and might be able to help. Any break from layout hell would be welcome (TIL: "seamless" iframes are going to be quite the wrinkle if we decide to support them - nobody else does yet)
[16:59:56] <jack> oh wow, i should have asked you first 
[17:00:10] <jack> so basically the issue is now we have several dependencies that are built by rustpkg
[17:00:44] <jack> so there is a phony rule with no prereqs to call rustpkg to build stuff
[17:01:11] <jack> but the old rules which are not phony need ot depend on these dependencies.
[17:01:30] <jack> but if you put a phony rule in a normal rule, it will force it to trigger every time.
[17:03:14] <lbergstrom> what's the desired behavior? you want rustpkg only to run when one of the things within those dependencies has been updated but otherwise not?
[17:04:00] <jack> I want to run rustpkg every time. I don't want to rebuild unless rustpkg actually did real work.
[17:04:25] <jack> The problem is that rustpkg outputs a file with hash in the name, so I can't know it a priori.
[17:06:18] *** Joins: azakai (alon@moz-BBE3ABD.mv.mozilla.com)
[17:06:31] <lbergstrom> hrmph, usually I've seen this supported with a 'sentinal' file that you know the name of (and hook into clean in the obvious way) that only gets touched by rustpkg if it's been updated
[17:07:03] <lbergstrom> I'd talk to tjc about it, but if I were going to hack it, I'd probably either wrap rustpkg in a script that looks for that hash file name and creates the appropriate sentinal
[17:07:33] <lbergstrom> or parses the output from rustpkg to find the name of the sentinal and then touches the file directly from the Makefile (though that gets very ugly, very fast - embedded sed calls in Makefile are evil)
[17:09:51] *** Joins: jet (jet@moz-79F891EE.hsd1.ca.comcast.net)
[17:09:56] *** Quits: jet (jet@moz-79F891EE.hsd1.ca.comcast.net) (Quit: jet)
[17:10:21] <lbergstrom> Similar hackery with sentinal files when using gcc: https://www.gnu.org/software/autogen/manual/html_node/autogen-dep_002dtrack.html
[17:10:30] *** Quits: dbaron (dbaron@moz-C566053C.dsl.dynamic.sonic.net) (Ping timeout)
[17:10:51] <jack> hmm. I didn't htink about wrapping rustpkg.
[17:11:08] <jack> you'd have to check to see if the file is new
[17:11:12] <jack> even if it has the same name
[17:11:24] <jack> i suppose the sentinel file could store the hash 
[17:11:52] <jack> their might be multiple files with hashes though, so not sure how i'd know which one ithe right one without modifying rustpkg
[17:13:41] <lbergstrom> I was assuming rustpkg (or the script) would just update the sentinal file to have a timestamp one second after any of the files that it modified when it did real work
[17:16:27] *** Quits: lbergstrom (Adium@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net) (Quit: Leaving.)
[17:17:56] <jack> I was hping not to have to modify rustpkg, but maybe for makefile compatibility it will need to do this.
[17:27:33] *** Joins: timot (timot@moz-5DFC99F3.bredband.tre.se)
[17:40:12] *** Joins: fabrice (fabrice@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:40:28] *** Joins: tjc (tjc@moz-FEE214EF.tmodns.net)
[17:40:28] *** ChanServ sets mode: +o tjc
[17:40:57] <tjc> jack: Oops, sorry...
[17:41:04] <tjc> I've tried to avoid learning much about make :-)
[17:44:09] *** Joins: Kostic (marko@C4D4CB5C.58A2DD99.2168A69F.IP)
[17:44:17] *** Quits: dzbarsky (Adium@E5216EFC.D5562F02.B5C6E82B.IP) (Quit: Leaving.)
[17:46:15] *** Quits: tjc (tjc@moz-FEE214EF.tmodns.net) (Quit: zzzzzzzzzz)
[17:48:44] *** Joins: jdm (jdm@FCCEA34F.7672369.D8E68FF6.IP)
[17:48:44] *** ChanServ sets mode: +o jdm
[17:51:08] *** Quits: Kostic (marko@C4D4CB5C.58A2DD99.2168A69F.IP) (Client exited)
[17:55:07] *** Joins: dbaron (dbaron@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:57:20] *** Quits: timot (timot@moz-5DFC99F3.bredband.tre.se) (Ping timeout)
[18:00:02] *** Joins: jet (jet@moz-BE33DA21.fw1.sfo1.mozilla.net)
[18:08:04] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[18:12:38] *** Joins: timot (timot@moz-5DFC99F3.bredband.tre.se)
[18:18:58] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:18:59] *** ChanServ sets mode: +o brson
[18:19:51] *** Joins: tjc (tjc@moz-BE33DA21.fw1.sfo1.mozilla.net)
[18:19:51] *** ChanServ sets mode: +o tjc
[18:21:58] <Ms2ger> tjc, that's a sensible thing to do :)
[18:22:29] <tjc> Ms2ger: I apply it to more than just make, too! ;-)
[18:22:42] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[18:23:05] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[18:30:52] <jack> brson, tjc: do you have any feelings about rustpkg + make?
[18:31:37] <tjc> jack: Last we talked, I thought the plan was to have simple Makefiles that would call rustpkg for the components that are going to be built with rustpkg...
[18:31:43] <jack> This seems like a real deficiency. Maybe adding a flag to generate libfoo.dummy is the right way to go.
[18:31:45] *** Joins: heather (heather@moz-A0276582.hsd1.ca.comcast.net)
[18:32:02] <tjc> also i think I may have missed some of the intervening conversation
[18:32:06] *** Quits: heather (heather@moz-A0276582.hsd1.ca.comcast.net) (Connection reset by peer)
[18:32:07] <jack> tjc: that's what I do. rustpkg works fine. the issue is that all my other makefile target rebuild *every* time
[18:32:22] *** Joins: heather (heather@moz-A0276582.hsd1.ca.comcast.net)
[18:32:34] <tjc> jack: hmm, because of rustpkg always copying when it installs? or...
[18:32:37] <jack> because the rustpkg targets are PHONY targets, meaning they don't name a file that will be created as a result of the rules
[18:32:49] *** Quits: jet (jet@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: jet)
[18:32:53] <jack> a nomral target is:
[18:32:57] <jack> servo: servo.o
[18:32:58] <jack>    ...
[18:33:02] <jack> servo.o: servo.c
[18:33:04] <jack>    gcc ...
[18:33:20] <jack> so the left hand side is a generated file
[18:33:47] <jack> you cna make a target as .PHONY which means tht there is no corresponding file, but this means that rule will always trigger.
[18:33:55] <jack> the `clean` target is an example
[18:33:59] <jack> since ther eis no file called clena
[18:34:00] <tjc> jack: and that doesn't work with rustpkg things because the library file has a hash in the name that you don't know in advance?
[18:34:28] *** Quits: bholley (anonymous@moz-D5EB36E2.rev.numericable.fr) (Quit: bholley)
[18:34:40] <jack> tjc: nto only do i not know it, but even knowing the pattern is not enough I dthink. because there might be legitmately multiple libfoo-$HASH.so
[18:34:52] <jack> i have no idea which one is hte right one.
[18:35:44] <jack> Not ot mention that hte hash is a functino of the dependencies
[18:36:12] <jack> rustpkg knows if it has needed to execute something. i could check the return code i suppose
[18:36:29] <jack> but making it return non-zero when it successful seems like a non-starter.
[18:36:37] <tjc> jack: yeah, that seems potentially confusing
[18:36:51] <tjc> As a transitional thing, maybe rustpkg could just make a symbolic link called libfoo.so that points to the latest libfoo-$HASH.so
[18:37:01] <tjc> that's a little weird since as you said, there could be multiple hashes
[18:37:04] <jack> i think lars' idea is to have rustpkg generate/touch a well known file if it actually does work
[18:37:14] <tjc> but maybe it's ok for the duration while we're still using make
[18:37:37] <jack> Well, presumably people will always use make because they might be integrating Rust stuff into some larger non-rust project
[18:37:41] <tjc> or touching some different arbitrary fileâ€¦ well, I don't know, it would have to be deleted after each invocation of rustpkg so you don't pick it up when building unrelated things
[18:38:14] <tjc> Or it could print out a message saying whether or not it rebuilt anything, and the makefile could grep the output. that also seems awkward
[18:38:18] <jack> tjc: it would only be behidn a flag and only on hte final output
[18:38:23] <jack> or at least that was my thinking
[18:38:36] <jack> like rustpkg --make-compat install foobar
[18:38:47] <tjc> uh huh
[18:38:53] <jack> would build install, foo, bar, and foobar, and then generate a libfoobar.dummy
[18:39:36] <jack> actually that won't work either.
[18:39:40] <jack> becuase i want rustpkg to run every time.
[18:39:48] <jack> *sigh*
[18:41:09] <jack> There doesn't seem to be a way to express "Run X, but only if reason Y, consider the target updated."
[18:41:21] <jack> if X runs, it's always fresh
[18:43:56] <jack> Any chance C dependencies are nearly ready? :)
[18:48:46] <tjc> jack: nope -- I'm going to work on it for as much of the weekend as necessary, though
[18:49:17] *** Joins: rhelmer (rhelmer@moz-DB4A9C19.scl3.mozilla.com)
[18:50:03] <jack> this problem only really exists for rust libraries
[18:50:06] <jack> binaries have a known name
[18:50:31] <jack> it occurs to me that I could hack this by adding a bin.rs that depends on the lib but does nothing.
[18:51:42] *** Joins: valenting (Thunderbir@55FBCC0.8C025854.E16F0CF5.IP)
[18:52:03] <tjc> hmm, good point
[18:52:30] <jack> can i controlt he name o fhte binary?
[18:52:58] <tjc> Right now it's always going to be based on the package ID (which is wrong if there are multiple crates, but I have a branch where I'm working on that)
[18:53:13] <tjc> but it should be predictable, at least
[18:53:17] <tjc> since there's no hash
[18:53:58] <jack> so foo/bin.rs will produce bin/foo?
[18:54:09] <tjc> right
[18:54:52] <jack> i wonder if I can use wildcards
[18:54:58] <tjc> for the library name?
[18:55:15] <tjc> libfoo-*-*.so -- if you can say that, then that should work
[18:59:30] <jack> Wow. Everytime I get a new idea, I am thwarted.
[18:59:41] <jack> So wildcards work, but it causes a different problem.
[18:59:50] <jack> There's no way to know when to rebuild libfoo*
[19:00:14] <jack> only running rustpkg will determine that. which means that make will build it if it's missing, but never rebuild it.
[19:06:03] <tjc> jack: what about the dummy-bin.rs idea?
[19:07:10] <jack> has the same problem.
[19:07:45] <jack> I have a new idea of mixing the last idea iwth order-only prereqs
[19:10:34] *** Joins: jensnockert (jensnocker@moz-2DBD7676.mobileonline.telia.com)
[19:10:36] <jack> order-only prereqs will trigger but not force the target to be rebuilt
[19:11:03] <jack> so if i include the wildcard as a regular prereq and add an order only on a phony target, then it may or may not get rebuilt and the wildcard will see any changes and force rebuilds.
[19:11:10] <jack> IT WORKS!
[19:11:18] <jack> I have conquered you, make!
[19:11:42] <jack> This is probably worth adding to the rustpkg docs.
[19:11:58] * jack files a bug so he doesn't forget to do that.
[19:14:57] <jack> tjc: can we hide all this output behind -v?
[19:18:00] <tjc> jack: excellent!
[19:18:04] <tjc> what's the link for the bug you filed?
[19:18:13] <jack> https://github.com/mozilla/rust/issues/9572
[19:18:23] <tjc> cool. also, which output do you mean by "all this output"?
[19:18:44] <jack> "workcache: discovered output ...."
[19:19:26] <jack> it's probably also not super useful to have that warning either.
[19:21:04] <tjc> oh, that
[19:21:10] <tjc> Yeah, I'm not sure why that's even getting printed out
[19:21:12] <tjc> *makes a note*
[19:24:27] *** Quits: Ms2ger (Ms2ger@9D0A393.CB23CDC6.3773EA9F.IP) (Quit: nn)
[19:27:08] <jack> tjc: can i give multiple pkgids to rustpkg?
[19:27:23] <tjc> jack: right now, no...
[19:27:42] <tjc> what would be the advantage over just calling rustpkg repeatedly?
[19:28:27] <jack> if i have a parallel rules in a makefile, it means rustpkg may fight with others
[19:28:56] <jack> ie, if i install bar and baz and they both depend on foo, then the two parallel rustpkg invocation will race
[19:29:39] <jack> i'm not sure if i can make a set of targets mutually exclusive
[19:30:01] <jack> i suppose i could put the dependencies in the makefile between the crates.
[19:30:29] <tjc> Ah, yeah
[19:31:03] <tjc> I guess there would be no harm in allowing rustpkg to take multiple package IDs (and just build them in order), but it's not implemented at this moment
[19:34:35] <jack> almost done with this. just porting servo to latest rust.
[19:34:39] <jack> may the visibility rules were buggy
[19:34:43] <jack> s/may/man/
[19:35:52] *** Joins: tikue_ (tkuehn@58063012.87C752B1.689607DE.IP)
[19:40:57] <tjc> Heh, yeah
[19:41:34] <jack> bjz_: ping
[19:47:13] *** Quits: ahal (ahal@F77132FB.12EEDBD3.6BEEAEBD.IP) (Quit: Leaving)
[19:49:20] *** Joins: Jayflux (Jason@moz-2D2FE62F.ppp.as43234.net)
[19:51:56] <jack> bjz_: nm. i figured out how you refactored keys in glfw-rs
[19:52:10] *** Quits: heather (heather@moz-A0276582.hsd1.ca.comcast.net) (Client exited)
[19:52:30] *** Joins: heather (heather@moz-A0276582.hsd1.ca.comcast.net)
[19:54:20] *** Quits: heather (heather@moz-A0276582.hsd1.ca.comcast.net) (Ping timeout)
[20:09:01] <kmc> jack: does SkNativeSharedGLContext exist in upstream skia, or did we add it?
[20:09:11] <jack> That's a jack original.
[20:09:19] <kmc> :)
[20:09:38] <jack> There is something similar in Skia called SkContextHelper.cpp or soemthing
[20:09:46] <kmc> I think we may still be off by one in the refcounting -- right now it leaks with refcount = 2, so we'd still have refcount = 1
[20:09:48] <jack> but i thought it was best to keep our changes to skia in separate files.
[20:09:59] <kmc> but I should at least test the patch before I conclude that
[20:10:02] <kmc> *nod*
[20:10:12] <jack> Maybe that second AddRef is spurious too?
[20:10:18] <jack> and it's supposed to transfer ownership or something?
[20:10:35] <jack> are tuple structs special to resolve?
[20:10:40] <jack> i can't seem to call methods on a tuple struct
[20:16:02] <kmc> yeah CreateSkiaDrawTargetForFBO increments the refcount on the GrContext (makes sense to me) so we shouldn't do it in azure-c.cpp as well
[20:16:14] <kmc> I think... testing now. we'll see what Valgrind says too
[20:16:52] <jack> what line?
[20:17:15] <kmc> 245, inside AzCreateSkiaDrawTargetForFBO
[20:17:31] <jack> oh yeah, i see that now.
[20:17:43] <jack> Clearly I was thinking too hard about that at the time.
[20:18:34] <kmc> it's too bad that Skia does reference counting in C++ without smart pointers
[20:18:49] <kmc> well, there seem to be some smart pointers, but also a lot of manual ref / unref calls
[20:18:50] <Yoric> kmc: How does it do that?
[20:18:54] <Yoric> :/
[20:19:02] <Yoric> That sounds ugly.
[20:19:15] <kmc> Yoric: your object itself inherits from SkRefCnt, which has an unref method that calls "delete this;" (!) if the refcount drops to zero
[20:20:18] <kmc> maybe they are looking to avoid the overhead of storing refcounts outside the object, but Boost has a smart-pointer solution to that (http://www.boost.org/doc/libs/1_54_0/libs/smart_ptr/intrusive_ptr.html)
[20:21:35] <kmc> in fact it's supposed to work with arbitrary existing refcounting schemes... so I imagine you could migrate Skia to something like this pieceemeal
[20:21:46] <kmc> but I don't know nearly enough about Skia to pass judgement on their memory management design.
[20:22:45] *** Joins: Jesse_ (jruderman@moz-BBE3ABD.mv.mozilla.com)
[20:22:51] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[20:24:27] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[20:28:06] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[20:28:17] <jack> tjc: i have servo built with rustpkg submodules now :)
[20:28:19] *** Quits: tgummerer (tgummerer@51D3B54.FEF996EA.EA6FEF3D.IP) (Ping timeout)
[20:28:25] <tjc> jack: Great!
[20:28:36] <jdm> jack: \o/
[20:28:41] <tjc> how many submodules are left to go? just the ones with C deps?
[20:29:56] <jack> there are three classes of them i gues. 1) all rust + a statically linked C shim (rust-cocoa, rust-png) 2) rust but depends on in-tree C libraries (rust-netsurfcss, rust-mozjs) and 3) all rust but has generated rust source
[20:30:24] <jack> rust-cssparser is a good example of the latter.
[20:30:30] <jack> er, of #3
[20:31:33] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[20:32:08] <tjc> ah ok
[20:32:12] <kmc> http client also has generated code
[20:32:15] <tjc> I think (3) should be do-able with no changes to rustpkg
[20:32:20] <tjc> oh wait
[20:32:23] <kmc> (which currently ends up in the source tree, not the build tree :/)
[20:32:25] <tjc> Rust generated by another Rust program?
[20:32:28] <kmc> yep
[20:32:31] <kmc> (for http)
[20:32:38] <tjc> Then I think that should work but it'll be a good stress test of custom build scripts
[20:32:43] <tjc> I gtg for now but I'll be back after 3
[20:32:57] *** Quits: tjc (tjc@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: zzzzzzzzzz)
[20:33:58] <jack> tjc: rust-http is a rust program. rust-cssparser is a python script.
[20:34:17] <jack> servo's script create is a couple of python scripts
[20:34:34] <jack> i can almost never type crate right the first time. *sigh*
[20:44:33] *** Joins: tjc (tjc@moz-BE33DA21.fw1.sfo1.mozilla.net)
[20:44:33] *** ChanServ sets mode: +o tjc
[20:44:59] *** Quits: tjc (tjc@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: zzzzzzzzzz)
[20:52:28] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[20:52:29] *** ChanServ sets mode: +qo dherman dherman
[20:56:01] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[20:59:12] *** Joins: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP)
[20:59:13] <ghservo> [13rust-mozjs] 15metajack opened pull request #37: Upgrade to latest Rust (06master...06rustup)  02http://git.io/tYhccg
[20:59:13] *** Parts: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP) ()
[21:00:09] *** Joins: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP)
[21:00:10] <ghservo> 01[13rust-wapcaplet01] 15metajack pushed 1 new commit to 06master: 02http://git.io/Vb2jrg
[21:00:10] <ghservo> 13rust-wapcaplet/06master 14b4613b8 15Jack Moffitt: Upgrade Rust.
[21:00:10] *** Parts: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP) ()
[21:00:52] *** Quits: Jesse_ (jruderman@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[21:01:17] *** Quits: tikue_ (tkuehn@58063012.87C752B1.689607DE.IP) (Quit: tikue_)
[21:01:38] *** Joins: tikue_ (tkuehn@58063012.87C752B1.689607DE.IP)
[21:02:01] *** Quits: tikue_ (tkuehn@58063012.87C752B1.689607DE.IP) (Quit: tikue_)
[21:02:16] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[21:02:32] *** Joins: tgummerer (tgummerer@moz-5DC8FA44.tbcn.telia.com)
[21:03:02] *** Quits: valenting (Thunderbir@55FBCC0.8C025854.E16F0CF5.IP) (Ping timeout)
[21:05:13] *** Joins: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net)
[21:06:11] *** Joins: lbergstrom (Adium@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net)
[21:11:32] *** Quits: timot (timot@moz-5DFC99F3.bredband.tre.se) (Ping timeout)
[21:11:55] *** Quits: tgummerer (tgummerer@moz-5DC8FA44.tbcn.telia.com) (Ping timeout)
[21:11:58] *** Joins: timot (timot@moz-730F561B.bredband.tre.se)
[21:19:16] *** Joins: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP)
[21:19:16] <ghservo> [13rust-mozjs] 15jdm closed pull request #37: Upgrade to latest Rust (06master...06rustup)  02http://git.io/tYhccg
[21:19:16] *** Parts: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP) ()
[21:20:02] *** Joins: tikue_ (tkuehn@885B1A5.2ACBBF24.689607DE.IP)
[21:21:33] *** Joins: ghservo (ghservo@F6EE6DE3.6A2AE50.F3114085.IP)
[21:21:33] <ghservo> [13rust-netsurfcss] 15metajack opened pull request #33: Upgrade Rust. (06master...06rustup)  02http://git.io/7xvuRg
[21:21:33] *** Parts: ghservo (ghservo@F6EE6DE3.6A2AE50.F3114085.IP) ()
[21:22:29] *** Joins: ghservo (ghservo@79968228.6A2AE50.F3114085.IP)
[21:22:29] <ghservo> 01[13rust-hubbub01] 15metajack pushed 1 new commit to 06master: 02http://git.io/ecx7dg
[21:22:29] <ghservo> 13rust-hubbub/06master 1438e8aa7 15Jack Moffitt: Upgrade Rust.
[21:22:29] *** Parts: ghservo (ghservo@79968228.6A2AE50.F3114085.IP) ()
[21:25:19] *** Quits: timot (timot@moz-730F561B.bredband.tre.se) (Ping timeout)
[21:25:49] *** Joins: ghservo (ghservo@F6EE6DE3.6A2AE50.F3114085.IP)
[21:25:50] <ghservo> 01[13rust-harfbuzz01] 15metajack pushed 1 new commit to 06master: 02http://git.io/vpIalQ
[21:25:50] <ghservo> 13rust-harfbuzz/06master 1470a83fe 15Jack Moffitt: Warning police.
[21:25:50] *** Parts: ghservo (ghservo@F6EE6DE3.6A2AE50.F3114085.IP) ()
[21:27:55] *** Joins: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP)
[21:27:55] <ghservo> [13rust-cssparser] 15metajack opened pull request #18: Upgrade to latest Rust. (06master...06rustup2)  02http://git.io/KALwuw
[21:27:55] *** Parts: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP) ()
[21:29:08] <kmc> jack et al: thanks for doing the Makefile hacking!  building C libs in parallel with LLVM / Rust is pretty great; I can do a clean build of Servo + all deps in 22 minutes, with 300% overall CPU utilization
[21:29:54] <jack> kmc: rustpkg will make it faster.
[21:30:00] <jack> maybe not this intermediate one, but the final one
[21:30:11] <jack> because it will eliminate almost all the shell execution :)
[21:30:19] <kmc> excellent
[21:30:23] *** Joins: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP)
[21:30:23] <ghservo> [13rust-css] 15metajack opened pull request #38: Upgrade Rust. (06master...06rustup)  02http://git.io/NugdUg
[21:30:23] *** Parts: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP) ()
[21:30:56] <kmc> 300% is surprisingly high considering how much time appears to be spent in rustc... do we build the different crates of a given rustc stage in parallel?
[21:31:27] <cmr> kmc: only the last few crates which don't have interdependencies
[21:31:37] <cmr> (rustdoc, rustpkg, others?)
[21:31:50] <kmc> anyway LLVM and SpiderMonkey and NSS probably account for the bulk of it
[21:31:54] *** Joins: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP)
[21:31:54] <ghservo> [13rust-azure] 15metajack opened pull request #52: Upgrade Rust. (06master...06rustup)  02http://git.io/mmRSGQ
[21:31:54] *** Parts: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP) ()
[21:33:09] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[21:33:09] <ghservo> [13rust-alert] 15metajack opened pull request #11: Upgrade Rust. (06master...06rustup2)  02http://git.io/1oJatQ
[21:33:09] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[21:33:20] *** Quits: lbergstrom (Adium@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net) (Quit: Leaving.)
[21:34:28] *** Joins: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP)
[21:34:28] <ghservo> 01[13rust-core-foundation01] 15metajack created 06rustup2 (+1 new commit): 02http://git.io/OMCfaA
[21:34:28] <ghservo> 13rust-core-foundation/06rustup2 14c8a4f4f 15Jack Moffitt: Upgrade Rust.
[21:34:28] *** Parts: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP) ()
[21:35:28] *** Joins: lbergstrom (Adium@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net)
[21:35:54] *** Joins: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP)
[21:35:54] <ghservo> 01[13rust-azure01] 15jdm pushed 2 new commits to 06master: 02http://git.io/KjMVPQ
[21:35:54] <ghservo> 13rust-azure/06master 1493604d1 15Jack Moffitt: Upgrade Rust.
[21:35:54] <ghservo> 13rust-azure/06master 144fd669b 15Josh Matthews: Merge pull request #52 from metajack/rustup...
[21:35:54] *** Parts: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP) ()
[21:36:02] *** Joins: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP)
[21:36:02] <ghservo> [13rust-alert] 15jdm closed pull request #11: Upgrade Rust. (06master...06rustup2)  02http://git.io/1oJatQ
[21:36:02] *** Parts: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP) ()
[21:37:04] *** Joins: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP)
[21:37:04] <ghservo> 01[13rust-core-foundation01] 15metajack merged 06rustup2 into 06master: 02http://git.io/vvjSIw
[21:37:04] *** Parts: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP) ()
[21:38:01] *** Joins: ghservo (ghservo@79968228.6A2AE50.F3114085.IP)
[21:38:01] <ghservo> 01[13rust-cssparser01] 15jdm pushed 2 new commits to 06master: 02http://git.io/Qwe7rw
[21:38:01] <ghservo> 13rust-cssparser/06master 1449f71df 15Jack Moffitt: Upgrade to latest Rust.
[21:38:01] <ghservo> 13rust-cssparser/06master 14e5a7555 15Josh Matthews: Merge pull request #18 from metajack/rustup2...
[21:38:01] *** Parts: ghservo (ghservo@79968228.6A2AE50.F3114085.IP) ()
[21:39:20] *** Joins: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP)
[21:39:20] <ghservo> [13rust-css] 15jdm closed pull request #38: Upgrade Rust. (06master...06rustup)  02http://git.io/NugdUg
[21:39:20] *** Parts: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP) ()
[21:39:23] *** Joins: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP)
[21:39:23] <ghservo> [13rust-netsurfcss] 15jdm closed pull request #33: Upgrade Rust. (06master...06rustup)  02http://git.io/7xvuRg
[21:39:23] *** Parts: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP) ()
[21:42:51] *** Quits: sankha93 (Instantbir@7061CD01.D6BD0D91.22D41759.IP) (Quit: Gone to save the world!)
[21:44:55] *** Joins: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP)
[21:44:55] <ghservo> [13servo] 15kmcallister opened issue #980: SpiderMonkey assertion failure running longcat in Valgrind  02http://git.io/fQHQxQ
[21:44:55] *** Parts: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP) ()
[21:46:14] *** Quits: jensnockert (jensnocker@moz-2DBD7676.mobileonline.telia.com) (Connection reset by peer)
[21:49:01] *** Joins: jensnockert (jensnocker@moz-2DBD7676.mobileonline.telia.com)
[21:49:24] *** bz is now known as bz_dinner
[21:54:24] *** Joins: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP)
[21:54:24] <ghservo> [13servo] 15kmcallister closed issue #980: SpiderMonkey assertion failure running longcat in Valgrind  02http://git.io/fQHQxQ
[21:54:24] *** Parts: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP) ()
[21:54:38] *** Joins: ghservo (ghservo@F6EE6DE3.6A2AE50.F3114085.IP)
[21:54:38] <ghservo> 01[13rust-http01] 15metajack pushed 23 new commits to 06servo: 02http://git.io/umFV_g
[21:54:38] <ghservo> 13rust-http/06servo 142188d8c 15Huon Wilson: Replace some unsafe code with a safe stdlib wrapper.
[21:54:38] <ghservo> 13rust-http/06servo 144fd1871 15Jesse Ray: updated from_str syntax
[21:54:39] <ghservo> 13rust-http/06servo 14e43448d 15Jesse Ray: updated unwrap_or_default syntax
[21:54:41] *** Parts: ghservo (ghservo@F6EE6DE3.6A2AE50.F3114085.IP) ()
[21:54:41] <kmc> adding the info to the wiki
[21:55:34] *** Quits: tikue_ (tkuehn@885B1A5.2ACBBF24.689607DE.IP) (Quit: tikue_)
[22:01:06] *** Joins: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP)
[22:01:06] <ghservo> 01[13glfw-rs01] 15metajack pushed 11 new commits to 06servo: 02http://git.io/slSu6w
[22:01:06] <ghservo> 13glfw-rs/06servo 148880c74 15jeaye: Added managed callback example
[22:01:06] <ghservo> 13glfw-rs/06servo 145e2a826 15Brendan Zabarauskas: Re-indent to 4 spaces, add doc comment
[22:01:07] <ghservo> 13glfw-rs/06servo 144114c75 15Brendan Zabarauskas: Modify managed-callbacks example to make the use case more obvious
[22:01:09] *** Parts: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP) ()
[22:04:00] <jack> oh god.
[22:04:06] <jack> i have got to be more careful with rebases.
[22:04:22] <jack> i just did a huge rebase against master instead of against my branch
[22:04:39] * jack looks for reflog
[22:28:25] *** Quits: dbaron (dbaron@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: 8403864 bytes have been tenured, next gc will be global.)
[22:28:45] *** Joins: dbaron (dbaron@moz-BE33DA21.fw1.sfo1.mozilla.net)
[22:34:32] <lbergstrom> There shouldn't be an issue if the laptop at the summit is a retina macbook pro using mirrored display, right? I'm worried about whether the HIDPI stuff will be handled properly when it's scaled to 1280x1024 or whatever, since we don't handle that and have "mini-servo" right now on R-MBPs...
[22:35:48] <lbergstrom> I don't have an old monitor or projector to test it on here at home :-)
[22:35:58] <jack> if you mirror it will be in the low res.
[22:36:05] <jack> i demoed on non-mirrored with retina and it was fine
[22:36:12] <jack> i assume mirrored will also be fine.
[22:37:25] <lbergstrom> yeah, I use non-mirrored here at home and it looks fine
[22:37:37] *** Quits: jensnockert (jensnocker@moz-2DBD7676.mobileonline.telia.com) (Connection reset by peer)
[22:38:20] <cmr> Does servo handle IDNAs yet?
[22:38:42] <jack> no
[22:38:52] <jack> unless extra::url does
[22:38:58] <cmr> it doesn't
[22:39:01] <jack> but i assume there is more to supporting them than that.
[22:39:19] <kmc> you need the Punycode algorithm and all the rules for preventing glyph confusion
[22:39:27] <kmc> and maybe other stuff
[22:40:54] <kmc> though technically, I think you only need the latter to determine whether to display the domain name in the UI using non-ASCII, and since we don't display it at all... ;)
[22:41:49] <kmc> that is, it might be the embedder's problem
[22:41:55] <kmc> but I don't know all the details
[22:42:19] *** Joins: tjc (tjc@moz-17B89992.tmodns.net)
[22:42:19] *** ChanServ sets mode: +o tjc
[22:47:29] *** Joins: tikue_ (tkuehn@885B1A5.2ACBBF24.689607DE.IP)
[22:48:05] *** Joins: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP)
[22:48:05] <ghservo> [13skia] 15kmcallister opened pull request #26: Fix crash and memory leak (06master...06refcount)  02http://git.io/mEf8qQ
[22:48:05] *** Parts: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP) ()
[22:48:25] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[22:48:25] <ghservo> [13rust-azure] 15kmcallister opened pull request #53: Fix memory leak from bad refcounting (06master...06refcount)  02http://git.io/-qRKpA
[22:48:25] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[22:50:28] *** Joins: ghservo (ghservo@C8693FCB.6A2AE50.F3114085.IP)
[22:50:28] <ghservo> [13skia] 15metajack closed pull request #26: Fix crash and memory leak (06master...06refcount)  02http://git.io/mEf8qQ
[22:50:28] *** Parts: ghservo (ghservo@C8693FCB.6A2AE50.F3114085.IP) ()
[22:51:07] *** Joins: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP)
[22:51:07] <ghservo> [13rust-azure] 15metajack closed pull request #53: Fix memory leak from bad refcounting (06master...06refcount)  02http://git.io/-qRKpA
[22:51:07] *** Parts: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP) ()
[22:51:07] *** Joins: ghservo (ghservo@C8693FCB.6A2AE50.F3114085.IP)
[22:51:07] <ghservo> 01[13rust-azure01] 15metajack pushed 2 new commits to 06master: 02http://git.io/TkdRKQ
[22:51:07] <ghservo> 13rust-azure/06master 1471e4819 15Keegan McAllister: Fix memory leak from bad refcounting...
[22:51:07] <ghservo> 13rust-azure/06master 14a02f1ea 15Jack Moffitt: Merge pull request #53 from kmcallister/refcount...
[22:51:08] *** Parts: ghservo (ghservo@C8693FCB.6A2AE50.F3114085.IP) ()
[22:51:19] <jack> yay memleak fixes.
[22:51:37] <jack> anyone find the animation stopping thing yet?
[22:52:25] <kmc> I haven't seen that bug.  I was hoping it was a symptom of the memory leak
[22:53:05] <kmc> there aren't any changes in the Servo repo but I won't push a submodule update yet because we're in the middle of a Rust upgrade
[22:54:18] <jack> did rust-azure change much?
[22:54:32] <kmc> for the bugfix? they're both very small
[22:54:40] <jack> yeah, drop changed 
[22:54:46] <jack> i meant for hte upgrade.
[22:54:46] <kmc> but you merged my commit with the drop change... yeah
[22:54:49] <jack> skia didn't change at all.
[22:54:59] <kmc> cool
[22:55:07] <kmc> no Rust code in the skia submodule, right?
[22:55:08] <jack> i am building the linux one now to make sure i didn't forget anything
[22:55:13] <kmc> cool
[22:55:20] <jack> so i can finish that then you can pile yours on top
[22:55:31] <kmc> seems like Skia and Azure are really one library for most of our purposes... the Skia code ends up in librust-azure-whatever.so doesn't it?
[22:55:53] <jack> yes, it's statically linked.
[22:56:10] <jack> we need to reorganize it so that skia is a submodule of rust-azure
[22:56:31] <kmc> nested submodules are even more of a pain than regular submodules
[22:56:32] <jack> same for several other libs
[22:56:34] <kmc> but it's probably the right thing here, yeah
[22:56:42] <kmc> it gets unmanageable if you have diamond dependencies
[23:00:20] *** Joins: ghservo (ghservo@79968228.6A2AE50.F3114085.IP)
[23:00:20] <ghservo> 01[13rust-layers01] 15metajack pushed 1 new commit to 06master: 02http://git.io/S44w3g
[23:00:20] <ghservo> 13rust-layers/06master 14a8c7b10 15Jack Moffitt: Upgrade Rust.
[23:00:20] *** Parts: ghservo (ghservo@79968228.6A2AE50.F3114085.IP) ()
[23:05:23] <tikue_> lbergstrom: do you have a link to that recent sml powerpoint?
[23:05:47] <lbergstrom> tikue_: you mean bob harper's ml workshop invited talk?
[23:06:01] <tikue_> lbergstrom: yeah that sounds right
[23:06:23] <lbergstrom> http://www.cs.cmu.edu/~rwh/talks/mlw13.pdf
[23:06:59] <tikue_> lbergstrom: awesome thanks!
[23:07:07] <lbergstrom> we have the definition online (as of SML90), but have a lot of work to do to get it up to SML97. I have two 8 hour flights over the atlantic coming up soon, thoughâ€¦ :-)
[23:07:14] <tikue_> :P
[23:10:51] *** Joins: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP)
[23:10:51] <ghservo> 01[13rust-azure01] 15metajack pushed 1 new commit to 06master: 02http://git.io/MI6_5g
[23:10:51] <ghservo> 13rust-azure/06master 149120196 15Jack Moffitt: Missed piece of Rust upgrade.
[23:10:51] *** Parts: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP) ()
[23:13:09] <jack> they haven't posted the ICFP contest results yet
[23:13:26] <jack> :(
[23:14:21] <lbergstrom> did they do the presentation of awards yet?
[23:14:39] <lbergstrom> oh, yeah, thursday at 5pm EST
[23:15:04] <cmr> I take it the rust team didn't win then :(
[23:17:07] <jack> well, we came in just under top 20 i think.
[23:17:15] <jack> our score was 1209
[23:17:24] <tikue_> that sounds pretty great
[23:17:42] <jack> sorry, just under 25. #25 is supposed 1250
[23:17:57] <jack> but i was hoping for official numbers 
[23:18:23] <cmr> annevk: Is there a testsuite of http://url.spec.whatwg.org/ anywhere?
[23:24:04] *** Quits: fabrice (fabrice@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: Leaving.)
[23:24:25] *** Quits: Jayflux (Jason@moz-2D2FE62F.ppp.as43234.net) (Quit: Leaving)
[23:29:49] *** Quits: tjc (tjc@moz-17B89992.tmodns.net) (Ping timeout)
[23:31:29] *** Joins: tjc (tjc@moz-17B89992.tmodns.net)
[23:31:29] *** ChanServ sets mode: +o tjc
[23:36:16] *** Joins: bholley (anonymous@moz-D5EB36E2.rev.numericable.fr)
[23:38:31] *** Quits: tjc (tjc@moz-17B89992.tmodns.net) (Quit: zzzzzzzzzz)
[23:51:58] *** Joins: MauricioC (mauricioc@moz-2CFCD404.impa.br)
[23:52:34] *** Joins: heather (heather@moz-A0276582.hsd1.ca.comcast.net)
[23:53:34] <jack> damnit.
[23:53:50] <jack> pcwalton: you merged rust-layers and such but didn't update servo
[23:54:15] <jack> now we're right back where we started with submodules we can't update :(
[23:54:26] *** Quits: heather (heather@moz-A0276582.hsd1.ca.comcast.net) (Ping timeout)
[23:54:33] *** Quits: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: My lid went down)
[23:55:21] * jack tries to figure out how to make progress
[23:56:55] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Ping timeout)
[23:58:26] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
