[00:00:12] *** Quits: capella-s32 (capella-s3@moz-vcqob4.res.rr.com) (Connection closed)
[00:00:27] *** Joins: capella-s3 (capella-s3@moz-vcqob4.res.rr.com)
[00:03:33] *** Quits: achernya (quassel@moz-i01917.mit.edu) (Ping timeout: 121 seconds)
[00:09:02] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[00:12:29] *** Joins: achernya (quassel@moz-i01917.mit.edu)
[00:13:10] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[00:19:42] *** Quits: arielb1 (Ariel@moz-8gbedh.red.bezeqint.net) (Connection closed)
[00:20:15] *** Joins: aatch (james@moz-c6etfk.fosn.r6an.e000.2406.IP)
[00:32:28] *** Joins: dinfuehr (dinfuehr@moz-mkhuel.highway.telekom.at)
[00:36:02] <reem> Where can I find a list of the things which *can* come after macro fragments?
[00:36:02] *** bvssvni is now known as bvssvni_
[00:36:09] <reem> randomly guessing has yielded nothing
[00:36:21] <reem> (what can follow a $ty?_
[00:36:30] *** Quits: dinfuehr (dinfuehr@moz-mkhuel.highway.telekom.at) (Ping timeout: 121 seconds)
[00:36:35] <cmr> https://github.com/rust-lang/rfcs/blob/master/text/0550-macro-future-proofing.md
[00:36:39] <cmr> is the RFC for it.
[00:37:07] <cmr> https://github.com/rust-lang/rust/blob/master/src/libsyntax/ext/tt/macro_rules.rs#L316 is the implementation.
[00:37:16] <cmr> https://github.com/rust-lang/rust/blob/master/src/libsyntax/ext/tt/macro_rules.rs#L451 is the relevant information.
[00:37:26] <cmr> (as well as is_in_follow, which follows it)
[00:39:51] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[00:43:17] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Ping timeout: 121 seconds)
[00:46:05] <WindowsBunny> nrc: Do keep me updated if you figure out a way to get a true ident concat
[00:46:17] <nrc> shall do!
[00:50:33] <reem> cmr: thanks
[00:50:33] *** Joins: mib_rv6z2w (Mibbit@moz-hu6.nja.252.72.IP)
[00:51:09] <reem> I am trying to call macro_rules! within a macro body, but any bindings within the nested macro_rules! errors because the outer macro doesn’t define that binding
[00:51:32] <reem> e.g. I have ($wmethod:ident) in the inner macro and no macro variable in the outer macro called $wmethod
[00:51:38] <reem> is this expected?
[00:51:39] <reem> or a bug?
[00:51:57] <cmr> Hm, macro-defining-macros are usually pretty untested.
[00:52:16] <cmr> that seems like a bug.
[00:52:29] <reem> it’s quite useful to “capture” from the outer macro, like a closure
[00:52:52] <reem> so I don’t have to constantly pass around and repeat inherited state
[00:58:03] *** Quits: mib_rv6z2w (Mibbit@moz-hu6.nja.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[00:58:40] <reem> How easy/difficult would this be to fix? https://github.com/rust-lang/rust/issues/26329
[01:00:20] *** Quits: brson (brson@moz-n5b.14a.129.78.IP) (Connection closed)
[01:00:37] *** kimundi is now known as zz_kimundi
[01:01:06] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[01:02:41] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[01:03:36] <eddyb> cmr: macro-defining macros are pretty broken
[01:03:50] <eddyb> because we have no support for escaping tokens
[01:04:10] <eddyb> so any $x gets expanded, no matter where it is inside the RHS of a macro_rules macro
[01:05:02] <cmr> reem: probably very difficult.
[01:05:16] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[01:05:38] <eddyb> cmr: I wouldn't say so
[01:05:47] <eddyb> just make \ before any token escape it
[01:06:24] <eddyb> i.e. produce a wrapper which is unpacked by macro expansion
[01:06:38] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[01:06:45] <eddyb> then you can use \$ inside the inner macro
[01:06:56] <eddyb> I have no idea why this wasn't in Rust 0.8
[01:07:03] <cmr> That would certainly work locally, but how should it interact with hygiene?
[01:07:07] <cmr> macro defining macros used to work.
[01:07:31] <eddyb> by automatically escaping nested macro_rules macros?
[01:07:33] <cmr> or at least, we have a lot of machinery that should make them work.
[01:07:58] <eddyb> I can't see how that would end out well without making macro_rules work differently from other macros
[01:08:07] <eddyb> like, in the parser itself
[01:08:25] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[01:08:32] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[01:08:45] <eddyb> besides, escaping tokens is needed from time to time
[01:09:27] <eddyb> and I'm not sure what you mean by hygiene. presumably \ident would be treated like ident, just packed
[01:11:23] <reem> also this https://github.com/rust-lang/rust/issues/26330
[01:11:34] <reem> my awesome macros are all crumbling down around me
[01:11:46] <cmr> reem: that will never work
[01:11:55] <cmr> macros are only allowed to expand into valid AST nodes.
[01:11:58] <eddyb> well, it will work if ast::Arm gets a macro variant
[01:12:08] <cmr> eh
[01:12:18] <reem> cmr: from the perspective of a user that’s a bad reason
[01:12:27] <cmr> You can't split a match arm anywhere in the ast.
[01:12:36] <cmr> reem: from the perspective of a user macros are bad and shouldn't be used.
[01:12:42] <eddyb> :P
[01:12:50] <cmr> s/split/splice/
[01:13:01] <eddyb> inside a macro itself, someone proposed $!(...) for early expansion
[01:13:01] <reem> Well..
[01:13:07] <eddyb> which would support stuff like this
[01:13:48] <cmr> nrc: what's the general feeling towards macro_rules! these days?
[01:13:57] <cmr> is there still ruminations about replacing it entirely
[01:13:59] <cmr> ?
[01:15:02] <reem> yes
[01:15:13] <reem> there were some fixes to the system for 1.0 to get something vaguely usable
[01:15:28] <reem> but there are still desires to dump it for a better version
[01:15:37] <reem> especially regarding stuff like type hygiene
[01:16:50] <nrc> cmr: yeah, I've been reading a lot about hygiene recently to see what a better system might look like
[01:17:05] <nrc> at the minimum there is still a desire to see better modularisation of macros
[01:17:34] <reem> being able to compose/create your own fragments would be good too
[01:17:36] <nrc> there is definitely more desire in the core team to address procedural macros ahead of macro_rules though
[01:21:52] <aatch> Argh, I think my installed compiler has some of my changes so I don't know if these test failures are my fault or not.
[01:22:13] <aatch> That said, panicking in a destructor is bad idea right?
[01:23:37] <eddyb> aatch: it should cause an abort, if the destructor was called while unwinding
[01:24:07] <aatch> eddyb, it's not while unwinding, that's the weird thing.
[01:26:54] <aatch> It's also giving me "end of stack" as the error code.
[01:27:06] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[01:27:27] <reem> nrc: that sort of surprises me - it seems like procedural macros are rarer and infinitely harder to stabilize
[01:27:55] <nrc> reem: they are, but they are a missing piece, whereas macro_rules at least exists at the moment
[01:28:20] *** Joins: larhat1 (Adium@moz-vlo5br.cable.virginm.net)
[01:28:24] <nrc> also macro_rules is OK, but the current, unstable syntax extentsions are pretty horrible
[01:28:42] <reem> reasonable
[01:29:03] <aatch> I assume procedural macros are intended to be somewhere between syntax extensions and macro_rules?
[01:29:17] <eddyb> procedural macros are syntax extensions AFAIK
[01:29:20] <reem> historically syntax extension and procedural macro have been used interchangeable
[01:29:22] <cmr> eddyb: also hodor never finished but I killed it after an hour and the profile has 50% of the time in Vec::clone, and 45% in Vec::drop
[01:29:32] <eddyb> hurr durr
[01:29:37] <nrc> personally, I think we need to address both and soon, but that either are lower priority than compiler performance and other things
[01:29:59] <eddyb> cmr: now why does that not surprise me :D?
[01:30:09] <nrc> aatch: I think everyone has their own terminology for exactly what procedural macro or syntax extension, etc. means
[01:30:32] <eddyb> cmr: not very useful without a backtrace, sadly. not that you need a full hour to get something reliable on that scale
[01:31:57] <aatch> nrc, fair enough. To me it's just that some things that seem to require syntax extensions right now don't need the full power of something integrated into the compiler like that.
[01:32:24] *** Quits: larhat1 (Adium@moz-vlo5br.cable.virginm.net) (Ping timeout: 121 seconds)
[01:32:59] <nrc> yeah, I've been toying with the idea of moving syntax extensions out of the language and providing hooks for tools, but that has downsides - primarily potential fragmentation
[01:33:30] *** Joins: dinfuehr (dinfuehr@moz-mkhuel.highway.telekom.at)
[01:35:11] <aatch> nrc, from my perspective, something that allows a little more inspection than macro_rules, but is still written as part of a crate would be best. Just being able to distinguish between "this is a '3'" and "this is an expression" would help.
[01:37:32] *** Quits: dinfuehr (dinfuehr@moz-mkhuel.highway.telekom.at) (Ping timeout: 121 seconds)
[01:39:36] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[01:52:22] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[01:58:23] *** Joins: WindowsBunny1 (Peter@moz-vlal7g.east.verizon.net)
[02:00:00] *** Quits: brain (brain@moz-ake53i.rcsntx.sbcglobal.net) (Quit: Leaving)
[02:00:47] *** WindowsBunny is now known as Guest26621
[02:00:47] *** WindowsBunny1 is now known as WindowsBunny
[02:01:25] *** Quits: Guest26621 (Peter@moz-vlal7g.east.verizon.net) (Ping timeout: 121 seconds)
[02:01:30] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Quit: Leaving)
[02:01:32] *** Joins: Tuba (Tobba@moz-o13d22.bredband.telia.com)
[02:01:41] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[02:01:41] *** Quits: Tuba (Tobba@moz-o13d22.bredband.telia.com) (Connection closed)
[02:08:10] *** Joins: koobs (koobs@moz-lu0tvm.internode.on.net)
[02:13:59] *** Joins: Nozama (Mibbit@moz-odl.dc7.36.120.IP)
[02:16:56] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[02:16:56] *** ChanServ sets mode: +o pcwalton
[02:26:42] *** Joins: hyperassociative_ (Mibbit@moz-gn0vp5.ca.comcast.net)
[02:26:53] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[02:26:53] *** ChanServ sets mode: +ao erickt erickt
[02:26:55] *** Quits: hyperassociative_ (Mibbit@moz-gn0vp5.ca.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[02:27:19] *** Joins: hyperassociative_ (Mibbit@moz-gn0vp5.ca.comcast.net)
[02:31:23] *** Joins: Feyn (aram@moz-88k.k93.115.42.IP)
[02:34:37] *** Joins: dinfuehr (dinfuehr@moz-mkhuel.highway.telekom.at)
[02:34:55] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[02:36:44] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[02:36:44] *** ChanServ sets mode: +ao erickt erickt
[02:38:39] *** Quits: dinfuehr (dinfuehr@moz-mkhuel.highway.telekom.at) (Ping timeout: 121 seconds)
[02:39:42] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[02:41:58] *** Quits: Nozama (Mibbit@moz-odl.dc7.36.120.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[02:42:55] <Nashenas88> I think I found a bug with the docs. Following the RawLink link in https://doc.rust-lang.org/std/marker/trait.Sync.html leads to https://doc.rust-lang.org/collections/linked_list/struct.Rawlink.html which is a 404 page. Is this considered a bug?
[02:43:56] <aatch> Nashenas88, yes, RawLink isn't a public type.
[02:44:12] *** Quits: hyperassociative_ (Mibbit@moz-gn0vp5.ca.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[02:44:38] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[02:45:19] <Nashenas88> Ahh, so it shouldn’t show up in the docs?
[02:45:37] <aatch> Nashenas88, correct.
[02:45:45] *** Joins: dcb (textual@moz-j72nfe.ca.comcast.net)
[02:46:14] <Nashenas88> I’ll see if it’s the same in nightly
[02:47:11] *** Joins: hyperassociative (Mibbit@moz-gn0vp5.ca.comcast.net)
[02:49:00] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[02:49:25] <Nashenas88> Seems it’s already a bug #23912
[02:49:27] <Nashenas88> https://github.com/rust-lang/rust/issues/23912
[02:49:36] *** Quits: aatch (james@moz-c6etfk.fosn.r6an.e000.2406.IP) (Quit: Leaving)
[02:49:46] *** Joins: aatch (james@moz-c6etfk.fosn.r6an.e000.2406.IP)
[02:50:01] *** Quits: zz_kimundi (kimundi@moz-6qind6.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:51:41] *** Joins: zz_kimundi (kimundi@moz-0a7524.dip0.t-ipconnect.de)
[02:51:42] *** zz_kimundi is now known as kimundi
[02:55:58] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[02:59:31] *** Joins: frewsxcv (sid86219@moz-dneii9.brockwell.irccloud.com)
[03:00:33] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[03:00:33] *** ChanServ sets mode: +ao erickt erickt
[03:01:44] <frewsxcv> is anyone aware of an ical or google calendar or ecalendar thing that displays release dates for rust versions?
[03:02:44] *** Quits: dcb (textual@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[03:03:37] *** Joins: mib_e74d83 (Mibbit@moz-hu6.nja.252.72.IP)
[03:03:52] <cmr> That sounds useful.
[03:05:37] *** Quits: mib_e74d83 (Mibbit@moz-hu6.nja.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[03:08:12] <frewsxcv> maybe i should make one?
[03:09:38] <c74d> I suppose there could be a “Next release in…” counter on the Rust homepage.
[03:20:38] <bstrie> Gankro: it's just been pointed out to me that sorting arrays in rust is an O(1) operation because our array indices have a maximum length
[03:21:02] <bstrie> can we put this in the docs somewhere
[03:21:35] <sfackler> ...
[03:21:42] <cmr> he's not wrong.
[03:22:16] <cmr> it will complete in fewer than 64 * 2^64 operations.
[03:22:19] *** Joins: p1start (p1start@moz-nftjhe.org)
[03:22:21] <cmr> :P
[03:22:32] <sfackler> "we can solve the halting problem because there are only ~2^80 possible states"
[03:22:35] <cmr> times some constant
[03:24:41] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[03:26:40] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[03:26:40] *** ChanServ sets mode: +ao erickt erickt
[03:27:36] *** Joins: semarie (semarie@moz-1fgc6t.privacyfoundation.ch)
[03:30:38] <richo> story checks out
[03:31:07] *** Joins: kingwen (chatzilla@moz-o1n.l67.119.113.IP)
[03:31:13] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[03:31:27] *** Quits: kingwen (chatzilla@moz-o1n.l67.119.113.IP) (Quit: ChatZilla 0.9.91.1 [Firefox 38.0.5/20150525141253])
[03:32:38] *** Joins: zxq9 (ceverett@moz-c1f1em.asahi-net.or.jp)
[03:35:21] *** Joins: dinfuehr (dinfuehr@moz-mkhuel.highway.telekom.at)
[03:37:42] *** Joins: theme (theme@moz-i3mhhb.asianet.co.th)
[03:39:23] *** Quits: dinfuehr (dinfuehr@moz-mkhuel.highway.telekom.at) (Ping timeout: 121 seconds)
[03:41:59] <aatch> Is it possible to revert gh22538?
[03:41:59] <[o__o]> Fix trans for foreign methods: https://github.com/rust-lang/rust/pull/22538
[03:42:39] <aatch> It doesn't really make sense to have foreign-abi methods to start with and they aren't properly implemented anyway.
[03:43:32] <WindowsBunny> aatch: thats kinda weird
[03:44:25] <aatch> I mean, I could probably fix it up, but I'd rather just disallow them. HOWEVER... that is technically a breaking change...
[03:46:18] <hyperassociative> w.r.t. https://github.com/rust-lang/rust/blob/master/src/librustc/README.md , is `sty` now `librustc::middle::TypeVariants`? and the associated ast enum `libsyntax::ast::Ty_`?
[03:46:33] <WindowsBunny> aatch: Run a crater on it, and get representatives to speak with every known production use of rust to verify that nobody is using them
[03:47:04] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[03:47:14] *** Joins: Jessin (Jesin@moz-4jre1i.eecs.lehigh.edu)
[03:47:30] <hyperassociative> WindowsBunny: what's a 'crater' in this context?
[03:47:33] *** Quits: Jesin (Jesin@moz-olsidu.eecs.lehigh.edu) (Ping timeout: 121 seconds)
[03:47:59] <WindowsBunny> hyperassociative: Something that I think brson is working on that lets you test changes to rust across everything on crates.io
[03:48:11] <WindowsBunny> so you can see before and after to find regressions
[03:48:16] <cmr> https://github.com/brson/taskcluster-crater
[03:48:21] <hyperassociative> WindowsBunny: wow. That sounds crazy/awesome.
[03:49:09] *** Jessin is now known as Jesin
[03:50:16] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[03:51:28] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[03:51:28] *** ChanServ sets mode: +ao erickt erickt
[03:59:56] <theme> I want to contribute to rust, but I don't know where to start
[04:00:05] <theme> I am good at algorithms and data structures
[04:00:55] <aatch> theme, refactor trans.
[04:01:10] <theme> err.... 
[04:01:21] <theme> what the heck is trans?
[04:01:22] <WindowsBunny> theme: Fix resolve so that recursive glob imports will work
[04:01:32] * theme is a dummy on compilers
[04:01:40] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[04:01:45] <aatch> theme, the part of rustc that actually does compilation.
[04:01:54] <WindowsBunny> theme: If you're confused just look at the handy guide to all the various parts of rustc
[04:01:54] <aatch> The rest of the compiler is just bookeeping.
[04:02:04] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[04:02:04] *** ChanServ sets mode: +o pcwalton
[04:02:07] <WindowsBunny> I wish that guide existed though
[04:02:11] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (A TLS packet with unexpected length was received.)
[04:02:33] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[04:02:44] <aatch> WindowsBunny, part of me wants that guide, another, more cynical part wants newbies to suffer as I did.
[04:02:58] <cmr> What do you mean that guide doesn't exist?
[04:03:02] <cmr> It's called src/librustc_*
[04:03:06] <hyperassociative> Soooo... has anyone thought about making librustdoc output hyperlinked code and a call graph?
[04:03:06] <WindowsBunny> :|
[04:03:06] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[04:03:06] *** ChanServ sets mode: +ao erickt erickt
[04:03:20] <cmr> hyperassociative: that's what dxr is for.
[04:03:25] <WindowsBunny> hyperassociative: I'm sure someone thought about it
[04:03:31] <hyperassociative> cmr: dxr?
[04:03:47] <theme> cmr, WindowsBunny, I thought that guide existed somewhere...
[04:03:49] <hyperassociative> (seriously, I'd love to see a callgraph of rustc)
[04:04:03] <WindowsBunny> theme: If it did, it is way outdated by now
[04:04:10] <cmr> And anyway, rustdoc doesn't know about function bodies.
[04:04:12] <theme> :/
[04:04:22] <hyperassociative> cmr: :-( :-( :-(
[04:04:33] <theme> Any library suggestions for me to contribute?
[04:04:40] <aatch> hyperassociative, I made rustc itself output a callgraph (as a graphviz file), pretty much unreadable...
[04:05:02] <cmr> theme: https://github.com/contain-rs needs work on datastructures
[04:05:17] <cmr> I'd love a hamt and a better trie :)
[04:05:34] <hyperassociative> aatch: I imagine, but I feel like that's more a how-do-you-cull-away-parts-people-don't-want-to-look-at problem than anything else
[04:05:35] <theme> cmr, hmm... maybe I'd check out that
[04:05:57] <cmr> theme: An interval tree would also be useful.
[04:06:18] <theme> cmr, lemme recall what is an interval tree...
[04:06:29] <cmr> Not a container, but still a useful datastructure.
[04:06:36] <aatch> I should clean up my XorList and contribute it to to contain-rs.
[04:06:37] <theme> I keep confusing myself with interval trees / segment trees
[04:09:53] *** Joins: dcb (textual@moz-j72nfe.ca.comcast.net)
[04:12:30] *** Quits: dcb (textual@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[04:13:04] <hyperassociative> I don't believe anyone answered my earlier question: was `sty` in librustc/middle/ty.rs renamed to `TypeVariants`?
[04:13:41] <aatch> hyperassociative, yes.
[04:13:42] <cmr> hyperassociative: no, it's still called sty.
[04:13:55] * cmr checks how old his git checkout is
[04:14:00] <hyperassociative> .......
[04:14:05] <aatch> cmr, it was renamed recently, along with the variants themselves.
[04:14:20] <aatch> cmr, to bring it more in-line with Rust style.
[04:14:21] <cmr> indeed.
[04:14:29] <hyperassociative> Okay, cool, thanks y'all.
[04:15:38] *** Quits: Nashenas88 (Nashenas88@moz-of81j9.miamfl.sbcglobal.net) (Client exited)
[04:19:10] *** Joins: yjv (yjv@moz-ll38tk.pa.comcast.net)
[04:19:52] *** Quits: O01eg (o01eg@moz-m788t8.907j.4n8f.2698.2a02.IP) (Client exited)
[04:28:21] *** Quits: theme (theme@moz-i3mhhb.asianet.co.th) (Quit: Leaving)
[04:35:01] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[04:36:06] *** Quits: Skyler (Skyler@moz-7ds39s.sd.cox.net) (Client exited)
[04:36:06] *** Joins: dinfuehr (dinfuehr@moz-mkhuel.highway.telekom.at)
[04:40:08] *** Quits: dinfuehr (dinfuehr@moz-mkhuel.highway.telekom.at) (Ping timeout: 121 seconds)
[04:45:51] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[04:45:51] *** ChanServ sets mode: +ao erickt erickt
[04:50:34] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[04:53:01] *** Joins: Rusticorn (Rusticorn@moz-ton.ucv.66.182.IP)
[04:53:22] *** Quits: aatch (james@moz-c6etfk.fosn.r6an.e000.2406.IP) (Connection closed)
[04:56:52] *** Quits: skeuomorf (skeuomorf@moz-ne6.2md.32.197.IP) (Ping timeout: 121 seconds)
[04:59:55] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[05:03:48] *** Quits: Rusticorn (Rusticorn@moz-ton.ucv.66.182.IP) (Connection closed)
[05:03:56] *** Joins: Rusticorn (Rusticorn@moz-ton.ucv.66.182.IP)
[05:04:01] *** Joins: vky (vky@moz-fqci96.ca.comcast.net)
[05:06:44] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[05:06:44] *** ChanServ sets mode: +ao erickt erickt
[05:09:38] *** Quits: yjv (yjv@moz-ll38tk.pa.comcast.net) (Connection closed)
[05:10:16] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[05:10:47] *** Quits: Rusticorn (Rusticorn@moz-ton.ucv.66.182.IP) (Quit: AndroIRC - Android IRC Client ( http://www.androirc.com ))
[05:19:10] *** Joins: Rusticorn (Rusticorn@moz-ton.ucv.66.182.IP)
[05:23:36] *** Quits: akawaka (akawaka@moz-0bb8q8.irvnca.sbcglobal.net) (Ping timeout: 121 seconds)
[05:24:16] *** Joins: akawaka (akawaka@moz-0bb8q8.irvnca.sbcglobal.net)
[05:24:21] *** Quits: Rusticorn (Rusticorn@moz-ton.ucv.66.182.IP) (Connection closed)
[05:32:28] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[05:35:53] *** Joins: dcb (textual@moz-j72nfe.ca.comcast.net)
[05:36:01] *** Quits: dcb (textual@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[05:36:51] *** Joins: dinfuehr (dinfuehr@moz-mkhuel.highway.telekom.at)
[05:37:12] *** Quits: Jesin (Jesin@moz-4jre1i.eecs.lehigh.edu) (Quit: Leaving)
[05:38:03] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[05:40:53] *** Quits: dinfuehr (dinfuehr@moz-mkhuel.highway.telekom.at) (Ping timeout: 121 seconds)
[05:41:41] <sfackler> there's no stdlib conversion trait that would be able to replace this, right? https://github.com/sfackler/rust-postgres/blob/breaks/src/lib.rs#L152-L155
[05:42:09] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[05:42:54] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[05:43:35] *** Joins: Kingsquee (kingsley@moz-3fm07c.bchsia.telus.net)
[05:43:49] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[05:44:54] <WindowsBunny> sfackler: How about Into<Result<ConnectParams, Box<StdError+StdSync+Send>>> ?
[05:46:21] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[05:47:00] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[05:47:03] *** Joins: oli_obk__ (Mibbit@moz-7bq.0sb.52.141.IP)
[05:47:29] <sfackler> wouldn't coherence prevent me from implementing that for str though?
[05:47:54] <WindowsBunny> maybe!
[05:58:05] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[05:58:12] *** Joins: James_ (quassel@moz-g7un1m.range86-163.btcentralplus.com)
[05:58:40] <Mutabah> I think I've seen other cases of this
[05:58:57] <Mutabah> Maybe we need a trait to have a failable Into?
[06:03:44] *** Quits: James_ (quassel@moz-g7un1m.range86-163.btcentralplus.com) (Ping timeout: 121 seconds)
[06:03:58] *** Quits: hyperassociative (Mibbit@moz-gn0vp5.ca.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[06:12:23] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[06:14:02] <Manishearth> cmr: it's been running since yesterday on my work machine. no end in sight
[06:15:02] *** Joins: mukilan (mukilan@moz-0he.e0v.164.122.IP)
[06:15:19] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[06:18:04] *** Joins: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP)
[06:23:02] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[06:24:16] *** Quits: koobs (koobs@moz-lu0tvm.internode.on.net) (Ping timeout: 121 seconds)
[06:30:39] *** Joins: Johannes (Johannes@moz-4et8d7.ocn.ne.jp)
[06:33:33] *** Quits: Johannes (Johannes@moz-4et8d7.ocn.ne.jp) (Quit: Leaving...)
[06:33:44] *** Joins: Johannes (Johannes@moz-4et8d7.ocn.ne.jp)
[06:38:16] *** Quits: Johannes (Johannes@moz-4et8d7.ocn.ne.jp) (Quit: Leaving...)
[06:38:23] *** Joins: Johannes (Johannes@moz-4et8d7.ocn.ne.jp)
[06:40:47] *** Joins: dcb (textual@moz-j72nfe.ca.comcast.net)
[06:42:39] *** Quits: Rym (uid91135@moz-n2i7qm.charlton.irccloud.com) (Quit: Connection closed for inactivity)
[06:46:49] *** Quits: dcb (textual@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[06:48:18] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[06:51:22] *** Joins: laumann (thomas@moz-3m6.3kq.109.2.IP)
[06:58:12] *** Joins: dcb (textual@moz-j72nfe.ca.comcast.net)
[06:58:19] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[07:00:47] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[07:06:08] *** Quits: vky (vky@moz-fqci96.ca.comcast.net) (Ping timeout: 121 seconds)
[07:07:52] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[07:09:34] *** kimundi is now known as zz_kimundi
[07:16:09] *** Quits: dcb (textual@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[07:21:58] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[07:32:02] *** Joins: ptalbot (ptalbot@moz-1gn7gb.eu0n.jcdj.0660.2001.IP)
[07:35:27] *** Joins: imperio (Mibbit@moz-ddsl0n.abo.wanadoo.fr)
[07:35:35] *** Parts: imperio (Mibbit@moz-ddsl0n.abo.wanadoo.fr) ()
[07:36:07] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[07:36:13] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Connection closed)
[07:38:11] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[07:40:13] *** Joins: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP)
[07:41:33] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[07:47:00] *** Quits: martin (martin@moz-bmp33l.u0v6.gff7.1608.2001.IP) (Ping timeout: 121 seconds)
[07:48:19] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[07:48:42] *** Joins: martin (martin@moz-bmp33l.u0v6.gff7.1608.2001.IP)
[07:50:15] *** Quits: bvssvni_ (sven@moz-8nne1d.bb.online.no) (Ping timeout: 121 seconds)
[07:55:18] *** Quits: martin (martin@moz-bmp33l.u0v6.gff7.1608.2001.IP) (A TLS packet with unexpected length was received.)
[07:55:32] *** Joins: bjz (bjz@moz-puppgq.tpgi.com.au)
[07:55:42] *** Joins: martin (martin@moz-bmp33l.u0v6.gff7.1608.2001.IP)
[07:57:39] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[08:01:14] *** Joins: bvssvni (sven@moz-fc63b3.bb.online.no)
[08:13:16] *** Quits: Kxepal832 (Miranda@moz-jl7jhg.pppoe.mtu-net.ru) (Ping timeout: 121 seconds)
[08:17:49] *** Quits: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au) (Ping timeout: 121 seconds)
[08:24:05] *** Joins: koobs (koobs@moz-lu0tvm.internode.on.net)
[08:24:51] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Ping timeout: 121 seconds)
[08:25:35] *** Quits: nham (nham@moz-lglsfe.il.comcast.net) (Quit: leaving)
[08:28:05] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[08:37:18] *** Quits: phynx (chatzilla@moz-ioi514.dsl.scarlet.be) (Ping timeout: 121 seconds)
[08:55:28] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Connection closed)
[08:55:29] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[08:56:20] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[09:01:33] <aatch> dear god pnkfelix, you're a machine!
[09:03:48] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[09:08:59] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[09:09:28] *** Joins: vmx (vmx@moz-mraeio.dip0.t-ipconnect.de)
[09:10:58] <nrc> Manishearth: ping
[09:12:08] <Manishearth> nrc: pong
[09:13:31] <nrc> Manishearth: hey, I was looking at the ast_map parenting. I realise that I want the enclosing scope, not the actual parent in the AST. Is that what you want or you actually want the parent node in the AST?
[09:13:50] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[09:13:58] <Manishearth> nrc: I want the parent node
[09:14:11] <Manishearth> nrc: I suppose the region maps give the enclosign scope?
[09:15:08] <Manishearth> nrc: you could use a generic parenting and loop till you find the block
[09:15:15] <nrc> that seems a bit scary - what if the AST changes? Will it break your lints?
[09:15:36] <Manishearth> nrc: "AST changes"? 
[09:15:53] <nrc> Yeah, once you have the most fine grained thing, you can find less fine grained things
[09:16:11] <Manishearth> unused clone should be resilient to ast changes
[09:16:17] <nrc> Manishearth: yeah, the AST is not stable
[09:16:24] <Manishearth> that's always been a problem
[09:16:28] <Manishearth> nothing new
[09:16:48] <bluss> I think I just discovered my benchmark thousands separators change is buggy, this is not good
[09:16:49] <nrc> why does unused clone need the AST parent?
[09:17:00] <Manishearth> nrc: because I want to use ExprUseVisitor
[09:17:12] <nrc> ah
[09:17:15] <aatch> I am confused, how does this test actually work: https://github.com/rust-lang/rust/blob/master/src/test/run-pass/backtrace.rs
[09:17:16] <Manishearth> otherwise I need to copy ExprUseVisitor and make some modifications
[09:18:10] <nrc> Neither of those options sound good to me, but not copying is slightly better
[09:19:06] <nrc> any way, lets see if this works...
[09:20:04] <Manishearth> nrc: I think having proper parenting will be useful in general though
[09:20:59] <nrc> hmm, actually this is a bit weird, since the _real_ parent might not be in the ast_map, should the parent the ast_map knows about be the next mapped ancestor or the actual parent? The former guarentees we can walk parents, the latter does not, but is more precise
[09:23:38] *** Joins: jincreator1 (Thunderbird@moz-d7i.i1g.195.175.IP)
[09:25:12] *** Quits: jincreator (Thunderbird@moz-d7i.i1g.195.175.IP) (Ping timeout: 121 seconds)
[09:25:12] *** jincreator1 is now known as jincreator
[09:25:36] *** Quits: _Vi (vi@moz-bbs.vhj.131.104.IP) (Ping timeout: 121 seconds)
[09:25:54] <Manishearth> nrc: why can't it be in the ast map?
[09:26:00] <Manishearth> we walk all nodes
[09:26:09] <Manishearth> top down
[09:26:23] <nrc> We don't store them all in the map though, I'm not sure why not
[09:26:28] <Manishearth> wut
[09:26:32] <Manishearth> .. no
[09:26:41] <Manishearth> what code does that? O.o
[09:27:08] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[09:27:52] <nrc> Not sure, but I know that I've unwrapped the result and panicked before
[09:28:24] <nrc> Also, not all nodes have node ids, so we can't always represent the actual parent, the best we can do is next parent with a NodeId
[09:28:38] <nrc> (unless all the nodes without ids are leaves, but I doubt that)
[09:30:21] *** Quits: Feyn (aram@moz-88k.k93.115.42.IP) (Quit: Leaving)
[09:31:37] <Manishearth> nrc: why do not all nodes have ids?
[09:31:46] <Manishearth> nrc: I suspect that's the local node / nonlcoal node distinction
[09:32:39] <nrc> I think it is just to save memory/laziness - when we haven't needed an id for a node, we haven't given it one
[09:33:16] *** Joins: munksgaard (munksgaard@moz-urnkl5.u.parknet.dk)
[09:33:26] <Manishearth> ah
[09:33:29] <nrc> I think just the id'ed nodes should be OK for you - that includes all expressions and items at least
[09:33:30] <Manishearth> hm
[09:34:05] <nrc> I do want a uniform AST where everything has an id and a span, but its not going to happen soon :-(
[09:34:08] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Quit: Leaving)
[09:34:13] <Manishearth> nrc: please
[09:34:16] <Manishearth> drop everything
[09:34:16] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[09:34:19] <Manishearth> and do eet
[09:34:25] <Manishearth> :p
[09:38:55] *** Joins: Skyler (Skyler@moz-7ds39s.sd.cox.net)
[09:45:36] *** Quits: njn (chatzilla@moz-0ah9lm.iinet.net.au) (Quit: ChatZilla 0.9.91.1 [Firefox 41.0a1/20150531163607])
[09:46:32] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[09:51:14] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[09:59:08] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[10:01:53] *** Joins: ChrisMorgan (ChrisMorgan@moz-mpe2k5.tpgi.com.au)
[10:10:22] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[10:10:22] *** ChanServ sets mode: +ao erickt erickt
[10:12:37] *** Joins: aepsil0n (eduard@moz-6491ha.mv2h.pepi.8071.2a02.IP)
[10:13:43] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Connection closed)
[10:15:58] *** Quits: erz (erz@moz-ab429s.broadband.corbina.ru) (Quit: My Mac has gone to sleep. ZZZzzz…)
[10:18:51] *** Quits: ChrisMorgan (ChrisMorgan@moz-mpe2k5.tpgi.com.au) (Ping timeout: 121 seconds)
[10:19:05] *** Joins: summerlight (summerlight@moz-99k.2mj.130.121.IP)
[10:20:24] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[10:20:24] *** ChanServ sets mode: +ao erickt erickt
[10:23:04] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[10:28:16] *** Joins: goyox86 (textual@moz-6gq.t8s.78.166.IP)
[10:34:58] *** Joins: phynx (chatzilla@moz-ioi514.dsl.scarlet.be)
[10:48:37] <aatch> Ok, finally figured out why my changes broke stuff. My changes broke a single usage of mem::transmute and from there everything just exploded.
[10:51:35] *** Joins: Quxxy_ (chatzilla@moz-efh10q.internode.on.net)
[10:52:36] *** Quits: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP) (Ping timeout: 121 seconds)
[10:52:40] *** Quxxy_ is now known as Quxxy
[10:52:52] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[11:02:35] <Manishearth> aatch: More than ocne has mem::transmute caused indecipherable bugs in servo
[11:02:52] <Manishearth> aatch: I wonder if we could add a way of tracking data and errors
[11:03:03] <Manishearth> ownerhship really helps here so we just need to tag everything
[11:04:08] <aatch> Manishearth, not really sure how to do that. I'm just trying to implement likely/unlikely.
[11:04:56] <madmalik> nrc: i find the ast highly confusing... 
[11:05:41] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[11:07:25] <Manishearth> aatch: likely?
[11:07:35] <Manishearth> madmalik: let me know what's confusing and I'll try to doc it more
[11:07:38] * Manishearth -> food
[11:11:38] *** Joins: arielb1 (Mibbit@moz-cmi.jfj.114.192.IP)
[11:11:47] *** Quits: arielb1 (Mibbit@moz-cmi.jfj.114.192.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[11:13:06] <pnkfelix> aatch: beg pardon?
[11:13:22] <aatch> pnkfelix, the new box/placement stuff.
[11:13:39] <aatch> pnkfelix, it's impressive.
[11:13:40] <pnkfelix> aatch: oh yeah, that's just a PR that's been brewing for a long long time
[11:13:52] <pnkfelix> aatch: I hope we land it this time
[11:14:17] <aatch> Manishearth, branch prediction hinting.
[11:14:57] *** zz_kimundi is now known as kimundi
[11:15:25] <Manishearth> ah
[11:15:26] <Manishearth> nice
[11:16:26] <aatch> Manishearth, the lowering of the expect intrinsic happens really early though, so I had to change/improve our handling of function calls to get them to actually do any work.
[11:17:19] <aatch> It's like yak shaving, but I actually need all that fur :D
[11:26:53] <aatch> Woo, it's working!
[11:27:54] *** Joins: ChrisMorgan (ChrisMorgan@moz-mpe2k5.tpgi.com.au)
[11:27:57] *** Quits: bdero (bran@moz-lbs.91h.47.73.IP) (Ping timeout: 121 seconds)
[11:28:06] * Manishearth gives aatch another yak
[11:28:13] *** Quits: bjz (bjz@moz-puppgq.tpgi.com.au) (Quit: My Mac has gone to sleep. ZZZzzz…)
[11:28:50] <aatch> I might attempt adding `unlikely` to the try! macro
[11:29:06] <aatch> for the error case.
[11:29:12] <kimundi> Everytime we get spammers I run in the problem that my nick is not registered on this network. And everytime I mean to do that already but run into some weird problem :P
[11:29:18] *** Joins: bjz (bjz@moz-puppgq.tpgi.com.au)
[11:30:16] * kimundi can't join #rust right now
[11:30:54] <aatch> kimundi, what's stopping you from registering?
[11:31:16] <Manishearth> kimundi: join now
[11:31:28] <kimundi> Manishearth: thx
[11:32:10] <Manishearth> kimundi: can you speak in it?
[11:32:57] <kimundi> aatch: Not sure, actually. All I remember is that I tried it before without success. :P
[11:33:10] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[11:33:22] <kimundi> I can try it again right now, if someone points me add how to do it :)
[11:33:42] <untitaker> wow could you please stop those spambots on mozirc -.-
[11:33:45] <Manishearth> cool
[11:33:52] <untitaker> hmm probably should use another chan, sorry
[11:33:53] <Manishearth> kimundi: /msg chanserv help register
[11:33:54] <aatch> kimundi, `/msg nickserv register` should get you started.
[11:34:02] <aatch> Or that
[11:34:11] <Manishearth> untitaker: /mode untitaker -R
[11:34:27] <Manishearth> nickserv is better
[11:34:30] <untitaker> Manishearth: what does this do?
[11:34:36] <Manishearth> untitaker: /mode untitaker +R
[11:34:38] <Manishearth> sorry
[11:34:40] <Manishearth> wrong one
[11:34:54] <Manishearth> untitaker: it only allows PMs from registered people
[11:35:15] <aatch> untitaker, also /mode untitaker +c
[11:35:18] <untitaker> does this persist across sessions or do I have to config znc to execute it again?
[11:35:34] <Manishearth> no idea
[11:35:39] <Manishearth> aatch: +c?
[11:35:47] <untitaker> well, excellent anyways, thanks
[11:35:53] <aatch> untitaker, which only allows people in the same channel as you to pm you
[11:36:02] <Manishearth> ah
[11:36:45] <aatch> Manishearth, they started registering the names, so +R doesn't stop all of them.
[11:38:28] <Manishearth> ick
[11:39:24] <untitaker> sorry for derailing, i was "rageblind"
[11:39:34] <kimundi> aatch: Ah, I remember my weird issue. My nick _is_ registerd, but I seem to have trouble with aoutomatically logging in
[11:39:59] <kimundi> And it confuses me because apparently I can sue the nick without issue regardless
[11:40:02] *** Quits: untitaker (untitaker@moz-vuq655.highway.telekom.at) (Quit: ZNC - http://znc.in)
[11:40:13] *** Joins: untitaker (untitaker@moz-vuq655.highway.telekom.at)
[11:41:25] <aatch> Woo, I'm up to compile-fail tests!
[11:41:49] *** Quits: vmx (vmx@moz-mraeio.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[11:45:13] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[11:46:00] <kimundi> ...and I get spam again. great
[11:46:20] <kimundi> what was the command again to blog non-in-channel?
[11:46:43] <aatch> kimundi, /mode kimundi +c
[11:48:59] <kimundi> Manishearth: What does +R do?
[11:50:40] <Manishearth> kimundi: only registered users
[11:50:50] <kimundi> ah, ok. thx
[11:55:50] *** Quits: summerlight (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[11:55:59] <aatch> Ok, now I just need to write some tests and some documentation and my likely/unlikely intrinsics are good to go!
[12:00:48] *** Joins: vmx (vmx@moz-mraeio.dip0.t-ipconnect.de)
[12:02:12] *** Joins: ytain (ytain@moz-pum3eh.dsl.teksavvy.com)
[12:04:01] *** Joins: rkruppe (chatzilla@moz-0k5kpu.uopk.14d9.41b8.2001.IP)
[12:06:57] *** Joins: summerlight (summerlight@moz-99k.2mj.130.121.IP)
[12:12:34] *** Joins: erz (erz@moz-8v4.af0.232.213.IP)
[12:14:42] *** Quits: erz (erz@moz-8v4.af0.232.213.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[12:16:52] *** Joins: Sho (sho@moz-aig7ns.cust.telecolumbus.net)
[12:18:08] *** Joins: erz (erz@moz-8v4.af0.232.213.IP)
[12:18:27] <kimundi> what would happen if you dlopen a rust crate from a statically compiled one?
[12:18:55] <kimundi> would you get duplication of the std library?
[12:25:00] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[12:26:31] *** Quits: erz (erz@moz-8v4.af0.232.213.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[12:27:35] *** Joins: rkruppe_ (chatzilla@moz-b4amct.hrz.tu-darmstadt.de)
[12:27:50] *** Joins: erz (erz@moz-8v4.af0.232.213.IP)
[12:29:11] *** Quits: erz (erz@moz-8v4.af0.232.213.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[12:29:54] *** Quits: rkruppe (chatzilla@moz-0k5kpu.uopk.14d9.41b8.2001.IP) (Ping timeout: 121 seconds)
[12:30:01] *** rkruppe_ is now known as rkruppe
[12:30:32] *** Quits: Kingsquee (kingsley@moz-3fm07c.bchsia.telus.net) (Quit: Konversation terminated!)
[12:38:39] *** Joins: bdero (bran@moz-e4f4ei.mit.edu)
[12:39:22] *** Quits: bdero (bran@moz-e4f4ei.mit.edu) (Connection closed)
[12:41:33] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[12:42:45] *** Joins: bdero (bran@moz-340.8qn.132.18.IP)
[12:44:15] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[12:44:20] *** Joins: erz (erz@moz-8v4.af0.232.213.IP)
[12:45:37] <eddyb> who here knows associated types and HRTB?
[12:45:48] <eddyb> nmatsakis: you're not around, are you?
[12:46:16] *** Joins: skeuomorf (skeuomorf@moz-ne6.2md.32.197.IP)
[12:47:10] <eddyb> well, in case someone sees this
[12:47:16] <eddyb> impl<T> UserString for ty::Binder<T> where T: UserString + Clone + for<'a> ty::Lift<'a>, for<'a> <T as ty::Lift<'a>>::Lifted: UserString + TypeFoldable<'a>
[12:47:56] <eddyb> the <T as ty::Lift<'a>>::Lifted part is not resolved to a concrete type where possible so I'm getting errors that it doesn't implement UserString and TypeFoldable
[12:48:23] <eddyb> I don't even know if this is supported in the first place
[12:48:43] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[12:50:08] *** Quits: ChrisMorgan (ChrisMorgan@moz-mpe2k5.tpgi.com.au) (Ping timeout: 121 seconds)
[12:50:10] <bluss> I don't use any email notifications with github, so question to those who do: what happens when a comment / issue's text is edited?
[12:50:23] <eddyb> bluss: nothing
[12:50:28] <bluss> ok so no spam
[12:50:32] <eddyb> edits are silent even at the API level AFAIK
[12:52:13] <bluss> I encourage everyone to get the true bluss experience™ on github.com since my first versions of comments often look like drunk typing.. I correct a lot of errors.. :/
[12:52:48] <bluss> eddyb: I'm hoping they hold off notification emails so they can include the edits that happen very close to when a comment is posted
[12:53:09] <eddyb> I don't think that's the case
[12:55:55] *** Joins: _Vi (vi@moz-bbs.vhj.131.104.IP)
[12:56:03] *** Quits: erz (erz@moz-8v4.af0.232.213.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[12:57:43] *** Joins: arielb1 (Mibbit@moz-cmi.jfj.114.192.IP)
[13:06:53] *** Quits: rkruppe (chatzilla@moz-b4amct.hrz.tu-darmstadt.de) (Ping timeout: 121 seconds)
[13:07:52] *** Joins: rkruppe (chatzilla@moz-0k5kpu.uopk.14d9.41b8.2001.IP)
[13:11:59] *** Quits: goyox86 (textual@moz-6gq.t8s.78.166.IP) (Ping timeout: 121 seconds)
[13:13:24] *** Joins: goyox86 (textual@moz-qfs.570.70.83.IP)
[13:13:37] <kimundi> eddyb: Damn it, I got a bunch of ideas and variations about dynamic code loading, which prevents me from just writing a "plugin" RFC because I don't see one clear path of action :P
[13:15:05] <kimundi> eddyb: I started writing about a proposal for a "simple" plugin variant that explicitly uses the dynamic linker, never unloads the crate to use static function pointers, etc. But I can already 3 different points where I can diverge in it. :P
[13:17:35] <kimundi> eddyb: Namely, 1) Whether it should use "duck typing" for accessing an plugin item directly (load("foo::bar"), with the result just depend on whether there is a foo::bar in the plugin) VS some way to implement a trait for the plugin to get type safety (impl ExternalCrate for crate {...}, with the plugin loader allowing access as a trait object)
[13:18:16] <kimundi> eddyb: 2), the question of defaults in regard to the possibility of 'crate. We might now want to hog the crate type "plugin" for a 'static-only-always-leaks solution
[13:18:51] <eddyb> kimundi: leaking is not a solution
[13:18:57] <kimundi> eddyb: 3) Whether to make use of the dynamic linker for plugins, or leave the option open for a custom solution
[13:19:17] <eddyb> I want to use this for reloading part of an app
[13:19:24] <kimundi> eddyb: Well, leaking is how the regular dynamic linker works effectively :P
[13:20:05] <eddyb> dynamic linkers have refcounts, no?
[13:20:10] <kimundi> eddyb: Me too, but apparently many existing dlopen impls don'T actually unload a closed library again
[13:20:35] <eddyb> huh, which ones?
[13:20:47] <kimundi> eddyb: They do, but there is a lot of variations and "let it leak instead of risk a segfault" safety behavior as well
[13:20:56] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[13:21:09] <eddyb> I'm asking about the refcounts for a different thing
[13:21:22] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[13:21:25] <kimundi> Don't have sources right now, this was stackoverflow knowledge after a google binge a few months back
[13:21:26] <eddyb> is there a way to "bump" the refcount without going through the trouble of looking up the library again?
[13:21:44] <kimundi> eddyb: you can load a library as "never unload me"
[13:22:24] <kimundi> and afaik dlopen might cache the path of the library so that if you do it again, you might just get the old image instead of a fresh one :P
[13:23:33] <kimundi> So, the issue I'm seeing is that we might have a working 'crate solution, but to make it work wit the existing dynamic linkers we need to generate new filenames for each recompiled library _and_ might not actually be able to unload the old ones
[13:24:01] <eddyb> kimundi: anyways, 'crate is for correctness
[13:24:05] <kimundi> sure
[13:24:28] <kimundi> but "never unload it, treat it as 'static" is also correct.
[13:24:41] <eddyb> it's also terrible
[13:24:49] <kimundi> so, there is aconservative first step we could take
[13:24:59] <eddyb> the usable interface would be refcounting the crate through objects
[13:25:36] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[13:26:17] <kimundi> Heh, that could be autogenerated with a "impl Trait for crate" scheme that gives you a &'crate Trait form the loader side :)
[13:26:31] <kimundi> no wait, no destructors run through a &...
[13:26:55] <kimundi> well, can just wrap the handle in a RC then
[13:27:43] <kimundi> And then have a custom Box<Trait> adapter around that that drops it
[13:28:06] <kimundi> huh, a lot of these issues become very easy if you just have access to code generation directly :P
[13:28:07] <eddyb> it would be compiler-generated
[13:28:13] <kimundi> yes
[13:28:31] <eddyb> and it would have to do trampoline funzies
[13:28:35] *** chmanchester|afk is now known as chmanchester
[13:29:02] <eddyb> so when you unsize a type to a trait object and that trait object is + 'static
[13:29:16] <kimundi> eddyb: well, you could build a franken-object that has the handle cleanup code in the destructor, the plugin functions in the vtable, and a zero sized type as data
[13:29:20] <eddyb> the refcount is bumped and the destructor is different
[13:29:53] <eddyb> kimundi: that's not what I'm talking about
[13:30:10] <eddyb> I'm talking about e.g. turning a regular function into a Box<Fn()+'static>
[13:30:16] *** Quits: goyox86 (textual@moz-qfs.570.70.83.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[13:30:18] <mukilan> Hi! Can someone tell me if this is a compiler bug or I've misunderstood something? https://play.rust-lang.org/?gist=8ec6ff23ed781ba35562&version=stable
[13:30:44] <kimundi> eddyb: Sure, this would work as well, since this is just a one-method trait object
[13:30:53] <kimundi> eddyb: So really, we where tlaking about the same thing ;)
[13:30:57] <eddyb> mukilan: because Bar could be implemented for a different trait
[13:31:20] <eddyb> kimundi: yeah but it's not just one trait or just one structure
[13:32:15] <mukilan> eddyb: Sorry, i don't follow. could you provide an example?
[13:32:27] <kimundi> eddyb: Well, I guess I was talking about having the vtable contain the plugin symbols directly, while you are talking about the call method delegating/trampolin to the function pointer first, right?
[13:32:32] <eddyb> mukilan: trait Bar {} impl Foo for Bar {...}
[13:32:41] <eddyb> mukilan: and you can't cast &Bar to &Foo
[13:32:48] <eddyb> kimundi: no
[13:33:04] <kimundi> eddyb: Okay, then explain again :)
[13:33:08] <eddyb> kimundi: you seemed to be talking about one trait object per crate
[13:33:21] <eddyb> which may not be enough
[13:33:28] <kimundi> eddyb: Yes, but the technique can also be used for one trait object per function in crate
[13:33:36] <eddyb> that's not enough
[13:33:42] <eddyb> it's still bounded
[13:33:49] <kimundi> err, N trait objects per function
[13:34:09] *** Joins: goyox86 (textual@moz-qfs.570.70.83.IP)
[13:34:15] <kimundi> didn't even think about _that_ part as a limitation until now :P
[13:34:17] <eddyb> I am talking about automatically handling any coercion to a 'static trait object
[13:34:38] <kimundi> coercion of what?
[13:34:38] <eddyb> anyways, the *drop glue* has to jump to a 'static function to decrease the refcount and unload the library if necessary, it cannot do that itself
[13:34:56] <eddyb> because if it does that, the instruction to return to the caller of the drop glue will be in unmapped memory
[13:35:04] <eddyb> kimundi: of anything
[13:35:19] <kimundi> eddyb: right, the drop glue would live in the plugin_loader library
[13:35:21] *** Joins: iitaku (textual@moz-da5bg2.ocn.ne.jp)
[13:35:24] <eddyb> no, it couldn't
[13:35:36] <eddyb> the drop glue is for an arbitrary type
[13:35:51] <eddyb> Box<T> -> Box<Trait+'static>
[13:35:57] <eddyb> T's drop glue is specific to T
[13:36:04] <eddyb> it's also 'crate, not 'static
[13:36:19] <kimundi> ah, I though we where just talking about static functions as a source
[13:36:33] <eddyb> that was an example
[13:36:40] <eddyb> you could also use closures
[13:36:45] <eddyb> they're the same
[13:36:48] <kimundi> which would mean zero-sized type, which would mean freedom to pick your own drop glue location. If its any type returned from the  plugin, thats a harder, true
[13:37:05] <eddyb> ahh sorry for the confusion
[13:37:22] <eddyb> kimundi: yeah, no, it has to work for arbitrary types or otherwise it's severely limiting
[13:37:51] <eddyb> kimundi: one issue though: a function generic over 'a and 'a could be 'static but you don't know inside the function
[13:38:26] <eddyb> you have to make such a function not callable with 'a == 'static, methinks
[13:38:50] *** Joins: erz (erz@moz-8v4.af0.232.213.IP)
[13:38:54] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[13:38:57] *** Quits: erz (erz@moz-8v4.af0.232.213.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[13:39:00] <eddyb> or just make it add the refcount thing
[13:39:12] *** Joins: rkruppe_ (chatzilla@moz-b4amct.hrz.tu-darmstadt.de)
[13:39:15] <eddyb> it's only going to cause some slowdown (the refcount has to be atomic)
[13:40:15] <kimundi> eddyb: So, what I meant was implementing a trait for the plugin itself so that plugins can be made to work in the typesystem, rather than being based on opening an arbitrary module path in it. You'd then do stuff like returning an arbitrary Box<Trait+'a> from a plugin on top of that.
[13:40:30] *** Quits: rkruppe (chatzilla@moz-0k5kpu.uopk.14d9.41b8.2001.IP) (Ping timeout: 121 seconds)
[13:40:37] *** rkruppe_ is now known as rkruppe
[13:40:47] <kimundi> eddyb: Let me think about what you said for a moment
[13:40:51] <eddyb> kimundi: yeah, but as I said, that's too limiting
[13:41:03] <eddyb> it's a special case that won't fit a lot of scenarios
[13:41:22] <eddyb> kimundi: also, I don't mind having a single entry point into the plugin
[13:41:27] *** Quits: rkruppe (chatzilla@moz-b4amct.hrz.tu-darmstadt.de) (Quit: ChatZilla 0.9.91.1 [Firefox 38.0.5/20150525141253])
[13:41:55] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[13:41:58] <eddyb> but, for example, the entry point could insert callbacks into a structure provided by the loader to the entry point
[13:42:19] <kimundi> eddyb: I see it as the general case actually. You just get a trait object that has its data backed in a library imagine, instead of a heap allocation. And while that is alive, you can call methods on to get data from its inside
[13:42:20] <doener> are "no space left on device" failures on the build bots transient or do they need manual intervention?
[13:42:45] <eddyb> kimundi: yeah but how do you handle anything that doesn't fit that model?
[13:42:51] <eddyb> kimundi: like my callback example
[13:43:39] <eddyb> I think a single entry point is sufficient... the entry point itself could take a string and return you a function wrapped in an Any etc.
[13:44:03] <eddyb> but the ability to create 'static objects is needed for anything serious
[13:44:22] <eddyb> kimundi: I really want this, I have a neat trick to use it for :D
[13:44:43] <eddyb> kimundi: but I don't think we can propose anything without prototyping :/
[13:44:50] <kimundi> eddyb: Since I'm seeing my plugin-as-traitobject idea as interchangeable interface to the "open this symbol and get me the function pointer" one, I'm actually unsure how your scenario could _not_ work
[13:44:52] <eddyb> I mean, an overall proposal
[13:45:09] <eddyb> crate_type = "plugin" and 'crate are pre-requisites
[13:45:25] <eddyb> kimundi: you have no way to create 'static trait objects on demand
[13:45:46] <eddyb> I don't need the "get typed symbol name" at all
[13:45:46] <kimundi> eddyb: Right, that was my initial issues. I wanted to write an RFC for a simple plugin variant, and then remembered how wast the design space is :)
[13:46:37] <eddyb> you have to start with generally useful primitives
[13:46:58] <kimundi> eddyb: Okay, I'm not sure what you mean with "having no way to create a 'static trait object on demand" - what is the issue in your eyes, at what point?
[13:47:20] <eddyb> after you've got 'crate and the compiler understands 'static != 'crate, and you test it on generic functions, across crates, etc.
[13:47:35] <eddyb> kimundi: Box<Callback+'static>
[13:47:42] <eddyb> where Callback is a trait
[13:47:45] <eddyb> how do I make that?
[13:47:59] <arielb1> eddyb: from Box<T> where T: 'static
[13:48:10] <eddyb> arielb1: talking about plugins which can be unloaded
[13:48:14] <kimundi> make it _where_? I don't know on which side of loader/plugin you even are right now :)
[13:48:20] <eddyb> kimundi: in the plugin
[13:48:23] <arielb1> eddyb: plugins won't have T: 'static types of course
[13:48:26] <arielb1> that would be bad
[13:48:31] <eddyb> arielb1: I know how to do it
[13:48:39] <eddyb> just convincing kimundi that it's necessary
[13:49:00] <eddyb> arielb1: bump refcount on creation, have drop glue trampoline to refcount decrement and unload if 0
[13:49:20] <arielb1> eddyb: that's BoxRc
[13:49:21] <eddyb> for Box<T> -> Box<Trait+'static> where T: 'crate
[13:49:31] <arielb1> :-)
[13:49:36] <eddyb> arielb1: no, the refcount is crate-wide
[13:49:41] <eddyb> or plugin-wide, I should say
[13:49:55] <arielb1> eddyb: its a Box for the object, an Rc for the vtable
[13:49:57] <kimundi> eddyb: Okay, so this is about a single plugin function that wants to return a 'static trait object that has the machinery embedded to keep the plugin alive for its duration, that you want to create inside the plugin directly to avoid pointless indirection?
[13:49:57] *** Quits: aepsil0n (eduard@moz-6491ha.mv2h.pepi.8071.2a02.IP) (Connection closed)
[13:50:06] <eddyb> kimundi: no
[13:50:26] <eddyb> this is about *arbitrary* trait objects that are 'static and keep the plugin alive
[13:50:46] <eddyb> an example is a callback for some event in a place of the system that doesn't know plugins can exist
[13:50:49] <eddyb> and doesn't care
[13:51:32] <eddyb> arielb1: what, dynamically allocate the vtable?
[13:51:34] <kimundi> I don't know where I missed the "more arbitrary" aspect, but thats what I meant. you get a 'static object that is self contained :P
[13:51:46] <eddyb> kimundi: not just one
[13:51:54] <eddyb> I want a million
[13:51:57] <kimundi> sure, sure
[13:52:02] <eddyb> and not just in the loader
[13:52:12] <eddyb> the plugin *needs* the ability to pretend it's 'static
[13:52:33] <kimundi> so you want to be able to thread the "keep me alive" refcount al the way through nested potential interfaces of the plugin? 
[13:52:34] <eddyb> "rooting" itself through trait objects
[13:52:39] <eddyb> kimundi: yes!
[13:52:57] *** Quits: arielb1 (Mibbit@moz-cmi.jfj.114.192.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[13:53:22] <kimundi> eddyb: And you are fine with an additional level of indirection inside the trait object?
[13:53:31] <eddyb> what do you mean?
[13:53:46] <eddyb> Rc<Plugin>?
[13:54:06] <kimundi> yeah + plus the function pointers into the plugin itself
[13:54:20] <eddyb> kimundi: actually, it's impossible to have anything larger than the original type
[13:54:33] <eddyb> Box<T> *already exists* by the time I want to turn it into Box<Trait+'static>
[13:54:56] <kimundi> What do you mean?
[13:55:34] <eddyb> I create a Box<T> without expressing the intent to turn it into a 'static trait object
[13:55:35] <kimundi> I don't understand what you mean with "impossible to have anything larger" - is this a restriction, or a "this can't happen anyway" case?
[13:55:49] <eddyb> kimundi: coercion can't change the size of the type
[13:56:06] <eddyb> Box<T> -> Box<Trait> can't add something after the T in the box
[13:56:13] <kimundi> yes, but I don't see the relevance
[13:56:24] <eddyb> then you have an unnecessary limitation
[13:56:43] <kimundi> MY question about indreiction was specifically because all that can be solved with an additional level of "Box"
[13:56:44] <eddyb> you want structures to be aware and contain the Rc<Plugin>
[13:56:54] <eddyb> solved how?
[13:57:35] <kimundi> eddyb: So, your case is that the plugin returns a Box<T>:'crate that you want to turn into a Box<Trait+'static> that keeps it alive, right?
[13:57:42] <eddyb> no
[13:57:55] <eddyb> kimundi: some arbitrary piece of code does that
[13:58:08] <eddyb> wait, you don't mean plugin entry point by plugin
[13:58:22] <eddyb> something inside the plugin creates a Box<T> where T: 'crate
[13:58:37] <eddyb> something else inside the plugin creates a Box<Trait+'static>
[13:58:57] <eddyb> and puts it in a 'static structure owned by the loader
[13:59:19] <eddyb> and there is no relationship between this function and the plugin entry point
[13:59:49] <kimundi> wasn't talking about the entry point in any specific way
[14:00:03] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[14:00:29] <kimundi> So, this "inside the plugin creates a Box<Trait+'static>" can only happen if the plugin can interact with the loader, right?
[14:01:02] <kimundi> since it would only be allowed to create Box<Trait+'crate> on its inside
[14:02:23] <eddyb> huh?
[14:02:34] <eddyb> what are you talking about?
[14:02:48] <eddyb> no, no loader interaction
[14:02:52] <kimundi> I'm asking you the same for many minutes now in an attempt to understand you :)
[14:03:03] <eddyb> kimundi: you have limitations
[14:03:13] <eddyb> I know of a system which has pratically none
[14:03:26] <eddyb> can you show that a limited system is equivalent to the unlimited one :P?
[14:03:46] <eddyb> in which everything, including functions, can be turned into 'static trait objects
[14:03:58] <kimundi> If you would just properly define all your lit and unlimit cases I'd be glad to not be able to do that :P
[14:04:18] <eddyb> (i.e. the immediate replacement for fn()+'crate is Box<Fn()+'static>)
[14:04:32] <eddyb> kimundi: I don't want changes in the host application
[14:04:51] <eddyb> think of a really complex and messed up UI system
[14:04:54] <kimundi> eddyb: BUt changes in the plugin are fine?
[14:05:14] <eddyb> kimundi: only if they don't require extra work for each "exported" type
[14:05:34] <eddyb> or each trait under which 'crate types are "exported" as 'static
[14:05:54] <eddyb> if it does, that's limiting. we don't even have a way of naming function types
[14:06:10] <eddyb> and the Fn trait are not defined in the plugin or loader
[14:06:30] <kimundi> I'm just trying to determine at which point in the plugin you allow the magic to happen.
[14:06:47] <eddyb> kimundi: any
[14:06:53] <kimundi> clearly not
[14:06:55] <eddyb> why?
[14:07:15] <kimundi> since you already explicitly forbad me from adding magic into the entry point interface or the host application :P
[14:07:16] <eddyb> bbl
[14:09:55] <kimundi> eddyb: So, what I don't understand with all your Box<Trait+'static> examples is how you envision it to be actually used. Can you sketch a quick two file example of host + plugin psydo code?
[14:11:16] *** Quits: Sho (sho@moz-aig7ns.cust.telecolumbus.net) (Quit: Konversation terminated!)
[14:11:19] <mukilan> eddyb: I thought about what you said. I still don't understand why Bar being implemented for another trait will prevent 'self' from being a valid &Bar object that can be passed around.. the compiler already has the vtable+data ptr (which will be a trait object)?
[14:11:27] *** Joins: Sho (sho@moz-aig7ns.cust.telecolumbus.net)
[14:11:54] *** Joins: druznek (druznek@moz-e9s7mb.ip269.fastwebnet.it)
[14:12:40] <kimundi> eddyb: I mean, at some point you need to actually load the plugin from the host application, and interact with it through some interface to get handles to items inside of it.
[14:13:32] <kimundi> eddyb: And then you would be able to interact with those handles.
[14:13:56] <kimundi> eddyb: And I'm wondering where you see/don't see the limitations
[14:20:56] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[14:21:55] <kimundi> eddyb: If you are talking about the ability to, inside the plugin, turn a Box<Trait+'crate> into a Box<Trait+'static> that will keep the plugin alive on the outside, then I could imagine something like a plugin_client::make_static(my_box) helper that modifies the trait object in a way that makes it keep the handle alive. I guess this is where the refcound would get incremented, and the destructor somehow modified to decrement it 
[14:21:55] <kimundi> again
[14:22:09] <SimonSapin> playbot: &[].ptr() as usize
[14:22:10] -playbot- <anon>:9:13: 9:18 error: type `[_; 0]` does not implement any method in scope named `ptr`
[14:22:10] -playbot- <anon>:9         &[].ptr() as usize
[14:22:10] -playbot- output truncated; full output at: http://bit.ly/1JVkt02
[14:22:20] <SimonSapin> playbot: &[].as_ptr() as usize
[14:22:22] -playbot- <anon>:9:13: 9:21 error: unable to infer enough type information about `_`; type annotations required [E0282]
[14:22:22] -playbot- <anon>:9         &[].as_ptr() as usize
[14:22:22] -playbot- output truncated; full output at: http://bit.ly/1cYopAl
[14:22:28] <kimundi> playbot: (&[]).ptr() as usize
[14:22:30] -playbot- <anon>:9:15: 9:20 error: type `&[_; 0]` does not implement any method in scope named `ptr`
[14:22:30] -playbot- <anon>:9         (&[]).ptr() as usize
[14:22:30] -playbot- output truncated; full output at: http://bit.ly/1JVkvVZ
[14:22:41] <SimonSapin> playbot: let a: &[u8] = &[]; a.as_ptr() as usize
[14:22:43] <kimundi> playbot: (&[]).as_ptr() as usize
[14:22:43] -playbot- 139858719719617
[14:22:44] -playbot- <anon>:9:15: 9:23 error: unable to infer enough type information about `_`; type annotations required [E0282]
[14:22:44] -playbot- <anon>:9         (&[]).as_ptr() as usize
[14:22:44] -playbot- output truncated; full output at: http://bit.ly/1cYosfk
[14:23:43] <SimonSapin> Are slices NoneZero? https://github.com/servo/tendril/blob/5101d43563c3b5634eb4cb021e148759ac71ddfa/src/tendril.rs#L687-L690
[14:24:04] <bluss> yes
[14:24:19] <SimonSapin> bluss: so that linked code is buggy, right'
[14:24:21] <SimonSapin> ?
[14:24:39] *** Joins: tehAnswer (Mibbit@moz-cv7.urh.130.89.IP)
[14:24:40] <kimundi> eddyb: Is that what you meant?
[14:25:00] <tehAnswer> hey guys
[14:25:19] <tehAnswer> If I want to make an small change in the rust docs, am I able to?
[14:25:24] <Manishearth> tehAnswer: sure :)
[14:25:28] <Manishearth> tehAnswer: src/doc
[14:25:35] <bluss> SimonSapin: yes. It can just use &[] instead
[14:25:44] <SimonSapin> bluss: cool, thanks
[14:26:54] <bluss> SimonSapin: in general std::slice::from_raw_parts{,_mut} is preferred, it's stable
[14:27:00] <bluss> over transmute
[14:27:14] <SimonSapin> right
[14:27:25] <tehAnswer> Manishearth so the way to go is fork the repo and make the PR, right?
[14:27:45] <SimonSapin> but there’s a number of other things that need to be stabilizied for this library to run on stable Rust anyway
[14:28:13] <Manishearth> tehAnswer: yes
[14:35:20] <doener> Manishearth: do you know if it's useful to retry a build that failed because of "disk full" or if that needs someone to manually free up space?
[14:36:41] <bluss> nrc's PR errored with "No space left on device"
[14:37:32] <doener> mine, too
[14:37:49] <bluss> maybe I meant yours :) anyway
[14:38:00] <bluss> Manishearth: can you fix this too? :)
[14:40:48] *** Joins: vky (vky@moz-fqci96.ca.comcast.net)
[14:48:33] <eddyb> mukilan: maybe take_bar has the wrong signature?
[14:48:50] <eddyb> mukilan: fn take_bar<T: Bar>(bar: &T) { bar.run(); } would work
[14:48:58] <eddyb> well, maybe not
[14:49:09] <eddyb> fn take_bar<T: ?Sized+Bar>(bar: &T) { bar.run(); } 
[14:49:14] <eddyb> that would definitely work
[14:50:39] <eddyb> kimundi: the handles you are talking about could use 'crate
[14:50:49] <mukilan> eddyb: unfortunately in my case take_bar needs to take trait objects...
[14:51:12] <eddyb> mukilan: then you need to add : Sized to your trait
[14:51:19] <eddyb> which means it... well, no
[14:51:32] <eddyb> mukilan: you need to add `where Self: Sized` to the method that calls take_bar
[14:51:59] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[14:52:00] <eddyb> mukilan: which manes you can't call that method through a trait object
[14:52:25] <eddyb> you could also manually implement the method
[14:52:31] <mukilan> eddyb: yeah, i tried that and it works, but again, the method that calls take_bar is also virtually dispatched
[14:52:37] <mukilan> eddyb: manually?
[14:52:40] <kimundi> eddyb: Sorry, which handle? I was kind ambiguous in my last messages. Does the last one, with the "plugin_client::" stuff match what you want to be able to do?
[14:52:44] *** Quits: iitaku (textual@moz-da5bg2.ocn.ne.jp) (Quit: My Mac has gone to sleep. ZZZzzz…)
[14:52:52] <eddyb> kimundi: no, because that's not technically feasible
[14:53:12] <eddyb> kimundi: if you use Unsize and/or CoerceUnsized instead, then maybe
[14:53:16] <eddyb> but it's still a huge hack :P
[14:53:36] <eddyb> hmm
[14:53:52] <kimundi> eddyb: So, thats a upper bound on your "no limitation" then ;). BAck to square one, please write me an psydo code example :)
[14:53:59] <eddyb> sure
[14:54:34] <mukilan> eddyb: Thankfully, I have a workaround for this problem, but I wanted to understand if this was a compiler bug or a valid restriction...
[14:54:38] <kimundi> Also, if that hack worked, would it be a superset of what you want to do?
[14:54:42] <eddyb> mukilan: valid restriction
[14:54:59] <eddyb> mukilan: the trait doesn't disallow implementing it for another trait
[14:55:02] <eddyb> mukilan: or for, say, [u8]
[14:55:13] <eddyb> and you can't turn &[u8] into &Trait even if [u8]: Trait
[14:55:21] <eddyb> because &[u8] is already a fat pointer
[14:55:39] <eddyb> kimundi: you need HKT to make it work
[14:56:05] <kimundi> eddyb: Lets ignore pesky thing like a type system for now ;)
[14:56:19] <eddyb> kimundi: i.e. be generic over SmartPointer<*> where SmartPointer<T> unsizes to SmartPointer<Target>
[14:56:35] <eddyb> and you unsize SmartPointer<NewTypeWrapperWithDestructorBomb<T>> instead
[14:56:46] <eddyb> s/unsizes/coerces (via unsizing)
[14:57:04] <kimundi> so, that would be Box<T> -> Box<Trait>
[14:57:06] <kimundi> right?
[14:57:12] <kimundi> (which is not what I meant)
[14:57:15] <eddyb> yeah, in a function
[14:57:20] <eddyb> instead of in the compiler
[14:57:31] <eddyb> operating on the trait object itself is really hard
[14:58:02] <kimundi> eddyb: Ŝo, you would be fine with a coerce_to_to_trait_with_plugin_keepalive() ?
[14:58:09] <eddyb> it requires allocating a new vtable amongst other things
[14:58:30] <eddyb> kimundi: even with HKT that wouldn't be as flexible as possible :P
[14:58:53] <eddyb> kimundi: and the wrapper type has to be defined inside the plugin itself somehow
[14:59:11] <eddyb> technically you could box KeepAlive(value)
[14:59:12] <kimundi> eddyb: gah, gimme an example that is the most flexible one. Its getting annoying trying to guess what you mean :P
[14:59:19] <eddyb> but the compiler doesn't let you unsize that to 'static
[14:59:26] <eddyb> yeah, writing an example as we speak
[14:59:31] <kimundi> kk
[15:00:28] <mukilan> eddyb: hmmm...i still don't get how that would be an issue...i feel too sleepy to think about it now...will try again tomorrow. thanks for you help :)
[15:00:42] <eddyb> mukilan: &self can be [u8]
[15:00:46] <eddyb> mukilan: nothing prevents that
[15:00:54] <eddyb> mukilan: and your code has to compile *even if* &self is [u8]
[15:01:04] <eddyb> mukilan: err, &self: &[u8] not [u8]
[15:01:17] <eddyb> mukilan: &[u8] doesn't coerce to &Trait
[15:01:27] <eddyb> hence, your code wouldn't compile in every possible case
[15:01:33] <eddyb> ([u8] is just an example of unsized type)
[15:01:42] <Quxxy> Let's assume I found a way to measure heap usage.  Would there be interest in having that added to libtest for benchmarks?
[15:01:57] <eddyb> Quxxy: talk to Manishearth
[15:03:37] <eddyb> fn entry(ui: &mut Ui) { let mut button = make_button(); button.on("click", (box || println!("button clicked") as Box<Fn()+'static>); ui.lookup("toolbar#primary").add_child(); } fn make_button() -> Box<Ui+'static> { box Button { ... } }
[15:03:52] <eddyb> well, that's botched
[15:03:54] <Manishearth> Quxxy: https://github.com/servo/servo/pull/6188
[15:03:56] <eddyb> add_child(button)
[15:04:07] <eddyb> kimundi: and that's just the start, I probably need a gist
[15:04:33] <Quxxy> Manishearth: Oh, I'm going via the system API
[15:04:45] <kimundi> eddyb: I gist with two files, one the plugin and one the host with the loader. Anything else and I can't follow you at this point :P
[15:04:48] <Manishearth> Quxxy: this does too
[15:04:54] <Manishearth> Quxxy: this is just transitive
[15:05:05] <eddyb> kimundi: the host doesn't behave differently with plugins
[15:05:18] <kimundi> eddyb: No, but it loads a plugin
[15:05:21] <eddyb> you want me to write an UI DOM for this?
[15:05:46] <kimundi> eddyb: No, a minimum example is fine...
[15:05:48] <eddyb> kimundi: load_plugin("fancy_button").get_fn("entry")(&mut ui_root)
[15:06:00] <eddyb> the plugin object doesn't outlive the entry function call
[15:06:19] <Quxxy> Manishearth: It doesn't look like it; this looks like it's tracing an allocation graph to compute the size of said graph
[15:06:26] <eddyb> removing the button from the toolbar unloads the plugin
[15:06:27] <kimundi> eddyb: See, that doesn't map to any of the interfaces I had in mind even with your explanations :P
[15:06:32] <eddyb> lol
[15:06:45] <Quxxy> I'm talking about sampling the OS-reported memory usage for a process while running some arbitrary benchmark code to estimate how much memory it consumes
[15:06:54] <eddyb> kimundi: and that's not even obeying the "disjoing from entry function" requirement
[15:06:56] <kimundi> eddyb: Which is why I want you to explain it fully, and write it down somewhere less transient than irc :)
[15:07:15] <eddyb> kimundi: what's the part you really didn't expect?
[15:09:22] <kimundi> eddyb: Well, not exactly not "expect", but thats still too ambitious for my liking :P
[15:09:31] <eddyb> that's just the baseline
[15:09:37] <eddyb> if that doesn't work, I can't use this for anything
[15:09:51] <kimundi> eddyb: I get very easily confused if things are not exactly explained to me, and all attempts to infer what you mean failed today, so...
[15:10:27] <eddyb> right, but what part of the code example didn't fit what I tried to explain?
[15:10:40] <eddyb> arbitrary types are turned into 'static trait objects inside the plugin
[15:10:45] <eddyb> and injected into the host
[15:11:14] <eddyb> kimundi: it has to be as close as possible to the flexibility of a concurrent GC without actually having a GC. I haven't considered a cycle collector yet, it would be too much trouble and I'm not sure I need it :P
[15:11:25] <eddyb> and I'm okay with losing function pointers, they're actually kinda rare
[15:13:31] <kimundi> eddyb: Okay, so after I copied your example into a text editor, formated it correctly etc and was actually able to thing about it without getting my brain distracted by not finding recognizing code based on indentation... I identified the point where you are okay with compiler magic to happen at the point where you coerce the Box<T> into a Box<Trait+'static> directly?
[15:13:47] <eddyb> I *want* compiler magic to happen
[15:13:52] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[15:14:20] <eddyb> you need a DropWhole trait or something similar to have control over what happens *at the end* of the drop glue
[15:14:36] <eddyb> it's not actually possible right now to write the wrapper
[15:14:36] <kimundi> Please answer yes/no first :P
[15:14:39] <eddyb> well, it is
[15:14:46] <eddyb> kimundi: yes
[15:14:48] <kimundi> okay
[15:15:57] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Connection closed)
[15:16:29] <kimundi> eddyb: Is it being "Box" fixed, or is that also something where you want freedom?
[15:19:45] <Quxxy> Manishearth: Probably going to bed soon, so I just want to ask: is that approach (sampling OS perf counters while a benchmark is running) worth pursuing and adding to libtest?
[15:21:58] <eddyb> kimundi: it's not fixed
[15:22:02] <eddyb> it would be Rc or Arc
[15:22:05] <kimundi> okay
[15:22:08] <eddyb> in the cases I actually want
[15:22:52] <kimundi> eddyb: So the only freedom you have is generating a custom vtable basically...
[15:23:28] <kimundi> ...while ensuring it can destroy itself somehow
[15:24:33] *** Quits: martin (martin@moz-bmp33l.u0v6.gff7.1608.2001.IP) (Ping timeout: 121 seconds)
[15:25:03] <kimundi> so you only have behavior. which means for it to store data like a reference to the plugin it needs to use static or 'crate data
[15:25:30] <Manishearth> Quxxy: no because it needs autoderive everywhere
[15:26:11] <Quxxy> Manishearth: I don't understand; I'm asking the OS
[15:27:11] <Manishearth> Quxxy: the OS doesn't know about ownership
[15:27:29] <Quxxy> No, but why does it need to?
[15:27:51] <Manishearth> Quxxy: because you want to recurse down fields right?
[15:27:55] <Manishearth> or what are you trying to do?
[15:27:55] <Quxxy> No
[15:28:01] <Manishearth> bulk counters? sure
[15:28:12] *** Quits: ptalbot (ptalbot@moz-1gn7gb.eu0n.jcdj.0660.2001.IP) (Ping timeout: 121 seconds)
[15:28:13] *** Joins: erz (erz@moz-ab429s.broadband.corbina.ru)
[15:28:13] <Quxxy> I want to (roughly) measure peak memory usage during the course of a benchmark
[15:28:41] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[15:28:44] *** Quits: erz (erz@moz-ab429s.broadband.corbina.ru) (Connection closed)
[15:29:05] *** Joins: erz (erz@moz-ab429s.broadband.corbina.ru)
[15:29:40] <steveklabnik> r? anyone https://github.com/rust-lang/rust/pull/26314
[15:29:51] <eddyb> kimundi: it can do anything it wants
[15:30:00] <eddyb> kimundi: it can store a Rc<Plugin> if its wants to
[15:30:35] <kimundi> eddyb: But not in the object itself
[15:30:40] <eddyb> sure it can
[15:30:47] <kimundi> how?
[15:31:05] <eddyb> well, you want something extra, you put it there
[15:31:30] <bluss> steveklabnik: done
[15:31:57] <kimundi> eddyb: But you don't know how to do that in the generic case? I asked about Box being fixed specifically because of that.
[15:32:27] <eddyb> kimundi: why would you want to add something like Rc<Plugin> to a trait object without it being in the concrete type?
[15:32:38] <kimundi> eddyb: ????????????
[15:32:39] <steveklabnik> bluss: <3
[15:33:08] <eddyb> the trick to writing the wrapper is struct Wrapper<T>(T, Cleaner); struct Cleaner; impl Drop for Cleaner {...} btw
[15:33:15] <eddyb> and inline assembly, of course
[15:34:01] <kimundi> eddyb: Can we please change this discussion to a mode where instead of "it" we only use fully qualified nouns to refer to objects in our sentences? Either I misunderstand you all the time, or you are inconsistent :P
[15:34:10] <eddyb> okay
[15:34:15] <eddyb> [18:25] <kimundi> so you only have behavior. which means for it to store data like a reference to the plugin it needs to use static or 'crate data
[15:34:40] <eddyb> so you want to "export" a value of type T as Box<Trait+'static>
[15:34:54] <steveklabnik> edunham: around?
[15:34:59] <eddyb> what plugin-specific data are you talking about in your statement above?
[15:35:29] <eddyb> do you want to be able to put something inside T, i.e. inside a struct definition or capture something in a closure?
[15:35:44] <eddyb> or do you want something to be automatically injected during the "export"?
[15:35:45] <kimundi> eddyb: So, hold on
[15:35:52] <kimundi> eddyb: Your example
[15:35:56] <kimundi> fn make_button() -> Box<Ui+'static> {
[15:35:56] <kimundi>     box Button { ... } 
[15:35:56] <kimundi> }
[15:36:04] <eddyb> yeah
[15:36:09] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[15:36:10] *** ChanServ sets mode: +o brson
[15:36:16] <kimundi> You claimed that the Box<...> can be arbitrary, and it should still work
[15:36:23] <eddyb> yeah you can change it to Rc
[15:36:36] <eddyb> (and it would have to be Rc in an "classic" UI system
[15:36:42] <eddyb> even Arc)
[15:36:58] <bluss> steveklabnik: ok that was fruitless, a buildbot has a full disk..
[15:37:08] <kimundi> which means you start out with a Box<T> or Rc<T>, and _can't change_ that value in any way because the compiler can not possibly know about all possible smart pointers
[15:37:09] <bluss> auto-mac-64-nopt-t
[15:37:12] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[15:37:21] <eddyb> kimundi: and how to reallocate them, yes
[15:37:53] *** Joins: zmack_ (zmack@moz-3t9.aat.233.213.IP)
[15:38:35] <kimundi> eddyb: So, that means, for turning that Box<T> into a Box<Trait>, you can not store any data inside the data part of the object, since that is fixed. And you can also not wrap it, since you would need an additional Box or Rc allocation for that, which the compiler does also not know about
[15:38:42] <eddyb> (hmm, the Wrapper I mentioned for doing some special-cases in a library still wouldn't work very well because it wouldn't give you the combined <T as Trait> vtable with Wrapper<T>'s dtor, as Wrapper<T> doesn't implement any specific traits. newtype magic would be required)
[15:38:57] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[15:38:57] *** ChanServ sets mode: +ao erickt erickt
[15:39:00] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Ping timeout: 121 seconds)
[15:39:10] <kimundi> into a Box<Trait+'static> I mean
[15:39:16] <eddyb> kimundi: well, the box protocol would allow the compiler to do something crazy, but you are correct
[15:40:16] <kimundi> eddyb: Okay, so ignoring the box protocol for actually generating such an wrapper, you only have the data part of the object which you can not usefully touch, and the vtable
[15:40:22] <steveklabnik> bluss: yeah :(
[15:40:25] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[15:40:52] <kimundi> eddyb: So all your freedom of doing magic is restricted to generating the vtable itself
[15:41:34] <kimundi> eddyb: The vtable methods and destructor only see the object data itself, which you can not touch, so the only way for them to store or lookup additional data is with global variables
[15:41:54] <eddyb> kimundi: of course
[15:42:09] <eddyb> the refcount *is* global
[15:42:31] <eddyb> it could even be looked up based on the location in memory of the calling function
[15:42:54] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[15:43:19] <kimundi> okay
[15:44:51] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[15:45:09] <eddyb> I'm thinking the host (or a plugin library included by the host) would provide a function lang item to be called and maybe a constant one to create a static from
[15:45:26] *** Quits: doener (doener@moz-eku96m.hsi08.unitymediagroup.de) (Quit: leaving)
[15:45:27] <kimundi> eddyb: So, given those constraints, where are you right now. DO you have a solution, problems...?
[15:45:48] <eddyb> kimundi: there's no way to know more before 'crate
[15:46:06] <eddyb> there's edge cases with generics that I have no idea about
[15:46:41] <kimundi> the loader could open an empty global of the plugin, and write a pointer for accessing the refcount in there. code in the plugin would then access the global
[15:47:25] <eddyb> yeah, that's a likely approach
[15:47:44] <eddyb> or a refcount+pointer to dynamic library handle
[15:47:52] <kimundi> dlopen(); read_typeinfo(); write_handle_handle(); usercode();
[15:48:33] <eddyb> kimundi: once you have 'crate working and you've figured out most of the tricky cases, you'll know whether or not Box<T> -> Box<Trait+'static> where T:'crate is feasible at the type level
[15:48:57] <eddyb> I'm sensing trouble with HRTB already :P
[15:49:38] <kimundi> eddyb: Well, what I outlined above sounds very feasible if we have custom compiler code generation for crate_type="plugin"
[15:50:00] *** Quits: tehAnswer (Mibbit@moz-cv7.urh.130.89.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[15:50:06] <eddyb> kimundi: IMO most of it should be done through lang items
[15:50:15] <kimundi> and obviosly we could not call generic functions that way
[15:50:24] *** Joins: Kxepal (Miranda@moz-oc8g1c.pppoe.mtu-net.ru)
[15:50:55] <kimundi> eddyb: Including the custom-destructor-with-global-variable thingy?
[15:51:00] <eddyb> yeah
[15:51:17] <eddyb> you need a lang item for increment and one for decrement, I guess
[15:51:23] <eddyb> or a trait
[15:51:52] <eddyb> kimundi: the codegen isn't a big deal, mostly a hack to make sure you never execute plugin code when the refcount drops to 0 and the plugin is unloaded in code called from the drop glue
[15:52:00] <kimundi> you can hardcode the "a global pointer" interface, and then have lang items for both sides of interaction. IS that what you mean?
[15:52:23] <eddyb> kinda. the type of the global variable doesn't have to be fixed, it can be a lang item
[15:52:32] <kimundi> right
[15:53:08] <eddyb> honestly, I'd use #[start] or #[main] for the entry point
[15:53:17] <eddyb> with custom signatures but a fixed symbol name
[15:53:23] <kimundi> now we only need to ensure the destructor stays alive while causing the destruction of the crate it lives in...
[15:53:43] <eddyb> kimundi: yupp, that's solved by tail calling i.e. jumping instead of calling
[15:54:09] <eddyb> maybe you can do it without inline assembly by asking LLVM to ensure TCO happens in the drop glue
[15:54:10] <kimundi> is that a cross-platform gurantee?
[15:55:02] <eddyb> kimundi: only on platforms with a mixed data and call stack
[15:55:09] <eddyb> i.e. not Forth machines
[15:55:32] <eddyb> kimundi: actually, no, even there it's possible to tail-jump
[15:55:32] <edunham> steveklabnik: hey, what's up? 
[15:56:03] <steveklabnik> edunham: the buildbots are apparently out of disk space, i think that's your department, yeah?
[15:56:09] <steveklabnik> :)
[15:56:17] <steveklabnik> http://buildbot.rust-lang.org/builders/auto-mac-64-nopt-t/builds/5401/steps/git/logs/stdio
[15:56:32] *** Quits: druznek (druznek@moz-e9s7mb.ip269.fastwebnet.it) (Quit: Leaving)
[15:56:39] <eddyb> I recall something about core dumps the last few times this happened
[15:56:48] <kimundi> eddyb: so, you just jump away from crate code to static code while transitioning from object destructor to handle destructor, right?
[15:57:02] <eddyb> kimundi: yes
[15:57:07] <kimundi> okay
[15:57:14] <eddyb> kimundi: and the caller of the drop glue should not be 'crate code
[15:57:46] <kimundi> right, but I think that can't happen anyway?
[15:57:49] <eddyb> kimundi: found a problematic case
[15:58:01] <eddyb> by-value calls to a trait object. not implemented right now, but planned
[15:58:23] <eddyb> kimundi: but they need special codegen in the compiler and it can add manual rooting calls
[15:58:37] *** Joins: yjv (yjv@moz-j0cdis.fios.verizon.net)
[15:58:42] <eddyb> s/it/the compiler/
[15:58:54] *** Quits: yjv (yjv@moz-j0cdis.fios.verizon.net) (Connection closed)
[15:59:08] <edunham> steveklabnik: thanks for the heads up; i'll take a loo
[15:59:10] <edunham> k
[15:59:18] *** Joins: yjv (yjv@moz-j0cdis.fios.verizon.net)
[16:00:24] <kimundi> edunham: hm, I don't see the issue
[16:00:36] <kimundi> eddyb: *
[16:01:01] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[16:01:02] <eddyb> edunham: it's kinda annoying that we're filling bots with core dumps but if I want to debug an odd failing case on a bot I can't really do that without someone giving me full access to a bot (which I don't really want)
[16:01:07] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[16:01:29] <kimundi> eddyb: Would the issue be that you need cleanup code after the destructor of the trait object ran?
[16:01:44] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[16:01:51] <steveklabnik> edunham: awesome thanks :)
[16:02:16] <eddyb> edunham: it would be really cool if there was any lightweight container solution where every instance had post-mortem SSH access for a couple hours or something like that
[16:02:23] <eddyb> edunham: but I'm daydreaming :D
[16:02:43] <steveklabnik> immutable infrastructure! down with ssh access!
[16:02:44] <steveklabnik> :)
[16:03:08] <eddyb> steveklabnik: Hydra would be cool but the windows support in Nix is not really that good
[16:03:16] <eddyb> I think it works fine on OSX
[16:03:34] <eddyb> kimundi: the issue is that the trait object is owned by the method in such cases
[16:03:46] <eddyb> kimundi: so if the method does drop(self), *oops*, the method is unloaded
[16:03:49] <eddyb> (or could be)
[16:03:55] *** Quits: zmack_ (zmack@moz-3t9.aat.233.213.IP) (Ping timeout: 121 seconds)
[16:04:14] <kimundi> ah, hm.
[16:04:21] *** Joins: O01eg (o01eg@moz-32r1fi.ie0e.4n8f.2698.2a02.IP)
[16:04:35] <eddyb> kimundi: however, the compiler can insert root() (aka refcount_increment()) at the beginning of the function and tailcalls to unroot() (aka refcount_decrement()) at each return point
[16:04:44] <eddyb> (and, of course, landing pads)
[16:04:52] *** Joins: dcb (textual@moz-j72nfe.ca.comcast.net)
[16:05:51] <eddyb> kimundi: I think the entry point needs rooting itself. I guess this would be handled by the library that does loading and lets you call the entry point
[16:06:20] <kimundi> yeah
[16:06:21] <eddyb> i.e. the refcount starts at 1, not 0, and the library handle the host gets will decrement the refcount when it drops
[16:06:27] *** Joins: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net)
[16:06:36] <kimundi> exactly
[16:06:44] <eddyb> kimundi: I am not worried about codegen, really. worst case we have to JIT something :P
[16:07:05] <eddyb> I am scared about the lifetimes we have not supporting this properly
[16:07:18] <eddyb> I don't want a typesystem overhaul to support plugins
[16:07:27] <kimundi> eddyb: So, this actually sounds like it doesn't need 'crate at all ;). Since any 'static leak will keep itself alive
[16:07:43] <eddyb> kimundi: function pointers
[16:08:00] <eddyb> those don't come with drop glue. you could just prevent them from being created
[16:08:14] <eddyb> since creating function pointers is a coercion now
[16:08:22] <kimundi> yeah, trait objects only
[16:08:39] <eddyb> do you want to insert the root/unroot logic for every trait object in the plugin?
[16:08:49] <eddyb> hmm, that's not... terrible :D
[16:09:43] <kimundi> anyway, even if 'crate is maybe not needed I'D still see it as a valuable complement, so I'm not arguing against it, really :)
[16:09:45] <eddyb> it's more conservative, but it has waay less potential issues with lifetimes
[16:10:00] <eddyb> kimundi: hmm, statics?
[16:10:14] <kimundi> WOuld be nice to have a plugin solution that inherently allows both borrowed and owned access
[16:10:34] <eddyb> like, what prevents you from taking &'static str and returning it from a function called by the host?
[16:10:45] <kimundi> eddyb: Yeah ok. We need 'crate as a balclist then
[16:10:50] <kimundi> blacklist*
[16:11:14] <eddyb> I haven't considered &mut Foo -> &mut Trait+'static
[16:11:26] <eddyb> kimundi: hehe
[16:11:39] <eddyb> make it check for 'static on the outside, not on the inside
[16:11:45] <eddyb> &'a mut Trait+'static isn't 'static
[16:11:49] <eddyb> Box<Trait+'static> is 'static
[16:11:54] *** Quits: dcb (textual@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[16:12:05] <eddyb> I'm guessing this is the simplest way to detect ownership
[16:12:25] <kimundi> not entirely following
[16:12:28] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[16:12:59] *** Quits: lu324 (lu324___@moz-3v8ljg.dhcp.embarqhsd.net) (Ping timeout: 121 seconds)
[16:13:34] <eddyb> kimundi: well, when coercing &'a mut T to &'a mut Trait+'static, you don't want to root()
[16:13:40] *** Joins: pcwalton (pcwalton@moz-nh2.o1i.216.216.IP)
[16:13:40] *** ChanServ sets mode: +o pcwalton
[16:13:54] <eddyb> because &mut Trait won't call its drop glue, ever
[16:14:19] <eddyb> kimundi: so you have to detect ownership
[16:14:55] <eddyb> only &'static Trait+'static could be considered "owning" if we test the whole fat pointer for 'static
[16:15:07] <eddyb> and that just cannot be created from 'crate data
[16:16:24] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[16:18:54] <eddyb> kimundi: what I waited on was fn()+'a
[16:19:02] <eddyb> once that's in, you can plug 'crate almost everywhere
[16:19:05] <eddyb> and experiment with it
[16:19:08] <kimundi> yeah
[16:19:18] <eddyb> kimundi: but I didn't want to add fn()+'a *and* 'crate at the same time in an experimental branch
[16:19:23] <kimundi> heh
[16:19:25] <eddyb> I was hoping it would be taken care of :P
[16:20:39] <kimundi> eddyb: Well, nmatsakis seems to consider it for some soundness fixes he has. Maybe we can just implement it on a provisorial basis :P
[16:20:53] <eddyb> with what design?
[16:21:05] <eddyb> the RFCs I've seen were bikesheds
[16:21:07] <kimundi> well, basically just fn()+'a
[16:21:32] <eddyb> and right now I have a major compiler refactoring blocked by something to do with HRTB and projection normalization
[16:22:04] <eddyb> the hard part turned out to be easy. really easy
[16:22:57] <eddyb> I'm guessing I didn't have all the tools last autumn for this (unboxed closures and HRTB). and I didn't understand scoped TLS
[16:23:19] <eddyb> now I have something which compiles except for one damn thing
[16:23:47] * eddyb realizes he can remove that bound and just break the implementation, temporarily
[16:24:32] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[16:25:23] <eddyb> it's not even a breaking change, just that for<'a> Foo<'a> will be printed as Foo<'a> or Foo
[16:26:22] <kimundi> eddyb: If I wanted to try implementing fn()+'a, would you know where to start?
[16:26:46] <eddyb> kimundi: syntax and the type system
[16:27:16] <eddyb> you'd want to compare all uses of TyRef vs TyBareFn
[16:27:46] <eddyb> I think only regionck would need to care about the new lifetime
[16:28:23] <eddyb> kimundi: everything creating a TyBareFn from some other TyBareF - wait
[16:29:50] <eddyb> kimundi: you'd need to wait for elif (eefriedman)'s patch to split TyBareFn
[16:30:13] <eddyb> you want to only add a lifetime to the pointer, not the fn type
[16:30:47] <kimundi> eddyb: I wonder if it would be easier/less error prone to just turn TyBareFn into something like TyRef(TypBarFn) internally, rather than trying to add lifetime stuff :P
[16:30:51] <eddyb> and determine the right lifetime ('crate vs 'static) when reifying the fn type into a fn pointer (which is a coercion)
[16:31:09] <eddyb> kimundi: but then it would match &T where T: ?Sized
[16:31:30] <kimundi> eddyb: Just talking about internal structure
[16:31:32] <eddyb> I'm not sure we can turn fn pointers into &Something without breaking code
[16:31:39] <eddyb> kimundi: the internal structure is observable
[16:31:43] <kimundi> oky
[16:32:11] <eddyb> what I was saying is that code creating a fn pointer from some other fn pointer should keep the lifetime
[16:32:19] <kimundi> yeah
[16:32:44] <eddyb> otherwise, it's decided in reification
[16:32:47] <kimundi> would the fn-type need to have the 'crate bound as well? The same was the &'a T type has the 'a lifetime?
[16:33:01] <eddyb> hmm?
[16:33:07] <eddyb> kimundi: oh
[16:33:29] <kimundi> or else you could plug it into T: 'static + Fn()
[16:33:50] <eddyb> that's interesting
[16:34:10] <eddyb> whether a fn type outlives 'a has to be determined based on the fn definition
[16:34:40] <eddyb> but I think it's customizable, i.e. it's not based solely on lifetimes inside a type
[16:35:58] <kimundi> So... am I right that it needs 'crate?
[16:36:30] <eddyb> not inside the middle::ty::Ty
[16:36:39] <eddyb> a fn type carries with it the DefId of the function
[16:36:49] <eddyb> 'crate vs 'static can be computed on demand from that
[16:37:04] <eddyb> kimundi: btw, syntax extensions match the same model I have :D
[16:37:14] <kimundi> okay, so its implied rather than stored, but 'Crate would be there user facing
[16:37:18] <eddyb> kimundi: the entry pointer registers callbacks in a provided context
[16:37:32] <eddyb> so compiler plugins could be the first test subject
[16:37:38] <eddyb> kimundi: yes
[16:39:52] *** Joins: Nashenas88 (Nashenas88@moz-of81j9.miamfl.sbcglobal.net)
[16:42:44] *** Joins: Jesin (Jesin@moz-4jre1i.eecs.lehigh.edu)
[16:44:59] *** Joins: martin (martin@moz-bmp33l.u0v6.gff7.1608.2001.IP)
[16:50:36] *** Quits: Quxxy (chatzilla@moz-efh10q.internode.on.net) (Ping timeout: 121 seconds)
[16:51:39] *** Joins: nham (nham@moz-lglsfe.il.comcast.net)
[16:54:32] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[16:55:51] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Connection closed)
[16:55:51] *** Quits: pcwalton (pcwalton@moz-nh2.o1i.216.216.IP) (Client exited)
[16:58:21] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[16:59:11] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[16:59:24] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[16:59:32] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[17:00:19] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[17:01:53] *** Quits: summerlight (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[17:06:53] *** Quits: goyox86 (textual@moz-qfs.570.70.83.IP) (Ping timeout: 121 seconds)
[17:07:12] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[17:07:18] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[17:10:14] *** Joins: canhtak (jeremy@moz-3o9del.luxdsl.pt.lu)
[17:13:51] *** Quits: bdero (bran@moz-340.8qn.132.18.IP) (Ping timeout: 121 seconds)
[17:16:40] *** chmanchester is now known as chmanchester|afk
[17:21:02] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[17:23:17] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[17:25:10] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[17:32:08] *** Joins: capella-s32 (capella-s3@moz-lfs.30o.87.66.IP)
[17:32:09] *** Joins: bdero (bran@moz-nd2f6b.dyn.mit.edu)
[17:33:17] *** Quits: capella-s3 (capella-s3@moz-vcqob4.res.rr.com) (Ping timeout: 121 seconds)
[17:33:58] *** Joins: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP)
[17:34:11] *** Quits: capella-s32 (capella-s3@moz-lfs.30o.87.66.IP) (Connection closed)
[17:36:03] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[17:36:56] *** kimundi is now known as zz_kimundi
[17:37:01] *** zz_kimundi is now known as kimundi
[17:38:10] *** Joins: sigma (sigma@moz-uqk2kb.range86-146.btcentralplus.com)
[17:40:32] *** Joins: elif (chatzilla@moz-ev8m1p.res.rr.com)
[17:41:19] *** Joins: lu324 (lu324___@moz-3v8ljg.dhcp.embarqhsd.net)
[17:42:28] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[17:42:28] *** ChanServ sets mode: +o pcwalton
[17:43:15] *** Quits: vky (vky@moz-fqci96.ca.comcast.net) (Ping timeout: 121 seconds)
[17:43:42] *** Quits: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP) (Connection closed)
[17:44:29] *** Joins: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP)
[17:46:31] *** Quits: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP) (Connection closed)
[17:46:57] *** Joins: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP)
[17:49:43] *** Quits: oli_obk__ (Mibbit@moz-7bq.0sb.52.141.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[17:55:34] *** Quits: canhtak (jeremy@moz-3o9del.luxdsl.pt.lu) (Client exited)
[17:56:13] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[17:56:35] *** chmanchester|afk is now known as chmanchester
[17:58:18] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[18:00:15] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Ping timeout: 121 seconds)
[18:01:00] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[18:01:16] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[18:04:48] *** Quits: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP) (Connection closed)
[18:06:16] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[18:07:00] *** Joins: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP)
[18:07:03] *** Joins: goyox86 (textual@moz-rvv.00r.255.109.IP)
[18:08:38] *** Quits: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP) (Connection closed)
[18:09:24] *** Joins: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP)
[18:11:50] *** Joins: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net)
[18:13:03] *** Quits: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP) (Connection closed)
[18:13:55] *** Joins: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP)
[18:15:04] *** Joins: blaenk (blaenkdenum@moz-ggnkpd.res.rr.com)
[18:16:10] <blaenk> erickt: can you take a look at https://github.com/erickt/rust-zmq/issues/69 when you get a chance
[18:17:33] *** Quits: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP) (Connection closed)
[18:18:32] *** Joins: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP)
[18:19:52] *** Quits: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP) (Connection closed)
[18:20:48] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[18:20:48] *** Joins: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP)
[18:21:48] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[18:21:48] *** Quits: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP) (Connection closed)
[18:22:39] *** Joins: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP)
[18:23:41] *** Quits: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP) (Connection closed)
[18:24:44] *** Joins: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP)
[18:25:06] *** Quits: vmx (vmx@moz-mraeio.dip0.t-ipconnect.de) (Quit: Leaving)
[18:25:51] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[18:27:40] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[18:27:44] *** Quits: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP) (Connection closed)
[18:28:13] *** Quits: nmatsakis (nmatsakis@moz-no0.93r.245.63.IP) (Quit: leaving)
[18:28:39] *** Joins: nmatsakis (sid381@moz-32a8b5.0j4i.jtu0.0101.2620.IP)
[18:28:48] *** Joins: arielb1 (Ariel@moz-lpse9v.red.bezeqint.net)
[18:29:41] *** Joins: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP)
[18:30:28] <eddyb> nmatsakis: are you here by any chance?
[18:30:53] *** Quits: capella-s3 (capella-s3@moz-lfs.30o.87.66.IP) (Connection closed)
[18:31:09] *** ChanServ sets mode: +o nmatsakis
[18:31:38] <nmatsakis> eddyb: I am here
[18:31:50] <eddyb> nmatsakis: I am having trouble with a HRTB
[18:31:55] *** Joins: capella-s3 (capella-s3@moz-vcqob4.res.rr.com)
[18:31:55] <nmatsakis> ok
[18:32:07] <eddyb> impl<T> UserString for ty::Binder<T> where T: UserString + Clone + for<'a> ty::Lift<'a>, for<'a> <T as ty::Lift<'a>>::Lifted: UserString + TypeFoldable<'a>
[18:32:31] <eddyb> it's a bit messy, but the important part is that I have a HRTB on an associated type, the output of an operation
[18:33:17] <eddyb> if I substitute T with TraitRef<'tcx>, I get that <TraitRef<'tcx> as Lift<'a>>::Lifted doesn't implement UserString, when I try to use this impl
[18:33:44] <eddyb> TraitRef does implement Lift and that projection should be normalized to TraitRef<'a>
[18:33:54] <eddyb> (which implements UserString)
[18:34:13] <eddyb> nmatsakis: is this a known design limitation, a known bug, or neither?
[18:34:32] <nmatsakis> eddyb: I'm trying to decide ;)
[18:34:39] <nmatsakis> eddyb: is it possible to produce a smaller example?
[18:34:48] <nmatsakis> I see what you're getting at but it'd be helpful to have something to play around with
[18:34:51] <eddyb> should be able to just extract it
[18:35:42] <eddyb> nmatsakis: btw Repr and UserString don't take tcx in my branch :D. I'm amazed this (seems to) compile :D
[18:36:14] <nmatsakis> eddyb: yes I was wondering about that ;) what did you change trait signature to? 
[18:36:23] <nmatsakis> that is, I was wondering why bother with a HRTB here
[18:36:32] <eddyb> trait Repr { fn repr(&self) -> String; }
[18:36:38] <eddyb> it will be fmt::Debug at some point
[18:37:08] <eddyb> nmatsakis: the HRTB is to "lift" e.g. Ty<'tcx> to Ty<'a> where 'a is the anonymous lifetime of the TLS tcx
[18:37:28] <eddyb> nmatsakis: it's actually only needed as a bound in the impl for ty::Binder<T>
[18:37:47] <eddyb> everything else can use tcx.lift(&value) directly
[18:38:25] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[18:38:26] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[18:38:31] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[18:38:54] *** Quits: ytain (ytain@moz-pum3eh.dsl.teksavvy.com) (Quit: Textual IRC Client: www.textualapp.com)
[18:38:55] <nmatsakis> eddyb: you're just not making use of the tcx?
[18:39:38] <eddyb> nmatsakis: I get the TLS tcx via with_tcx(|tcx| ...) and that just gives me a &ty::ctxt which doesn't match with the lifetime of whatever I'm printing
[18:40:03] <eddyb> hence the "lift" operation which is entirely safe and abuses the interning hashmaps
[18:40:50] <nmatsakis> I see
[18:40:54] <nmatsakis> interesting
[18:42:02] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[18:42:16] <eddyb> nmatsakis: I thought about it when I was wondering how I'm going to do writeback with nested interners
[18:42:46] <eddyb> and if there are no inference variables in a type, the model I had in mind should have the type in the global interner, but the lifetime is local
[18:43:03] <arielb1> eddyb: I think you should fold the type
[18:43:09] <eddyb> a global interner lookup can confirm that the type lives long enough indeed
[18:43:26] <eddyb> arielb1: I am not *that* sadistic
[18:43:45] <arielb1> I mean, on writeback
[18:44:00] <arielb1> that shouldn't be such a bad perf improvement
[18:44:03] <arielb1> *problem
[18:44:05] <eddyb> well, it's already folded due to resolution so maybe it can be made to always return the right lifetime
[18:44:13] <arielb1> because there are not such many types
[18:44:27] <arielb1> that are written-back
[18:44:36] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[18:44:53] <eddyb> but lifting is a safe and (relatively) cheap operation
[18:45:02] <arielb1> lifting?
[18:45:13] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[18:45:13] *** ChanServ sets mode: +o pcwalton
[18:45:18] <arielb1> is that = folding?
[18:45:51] <eddyb> arielb1: no, just a quick interner lookup
[18:45:52] <arielb1> ty_fold can trivially transform a Ty<'a> to a Ty<'b> (given a ty::ctxt<'b>)
[18:46:06] <eddyb> right now it can't and it's not going to be pretty if I add a second lifetime to it
[18:46:11] <eddyb> nmatsakis: http://is.gd/JjQm5e
[18:46:22] *** Quits: Jesin (Jesin@moz-4jre1i.eecs.lehigh.edu) (Quit: Leaving)
[18:46:33] <eddyb> arielb1: not to mention it will need to switch over to associated types
[18:46:39] <eddyb> and I'll have the same HRTB issues
[18:46:44] <arielb1> eddyb: switch over?
[18:46:54] <eddyb> right now it returns the same type it got
[18:47:02] <arielb1> have TyFold<'a, 'b>
[18:47:14] <eddyb> how do you write the signature?
[18:47:24] <eddyb> without an associated type for the output?
[18:47:38] <arielb1> TypeFolder<'a, 'b>
[18:47:57] <arielb1> TypeFoldable<'a, 'b>
[18:48:14] <arielb1> s/TypeFolder<'tcx>/TypeFolder<'tcx,'tcx>/
[18:48:35] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[18:48:36] <eddyb> the signature of the folding method, I mean
[18:48:52] <eddyb> nmatsakis: bingo http://is.gd/okuAiy
[18:49:28] <arielb1> maybe make it TypeFoldable<'a, Out>
[18:49:53] <arielb1> actually that would need to be TypeFoldable<'a, 'b, Out: 'b>
[18:49:55] <arielb1> ugly
[18:50:22] *** Joins: Jesin (Jesin@moz-4jre1i.eecs.lehigh.edu)
[18:50:30] <arielb1> there are not that much impls of it through
[18:50:55] <arielb1> and the 'a may not be needed (if you don't need the orig tcx)
[18:50:56] <eddyb> nmatsakis: http://is.gd/MarmJ3
[18:51:26] <eddyb> nmatsakis: this is somewhat cleaner
[18:52:00] <eddyb> I'd expect <Ty<'_> as Convert<'out>>::Output to be normalized to Ty<'out> but it isn't
[18:52:09] <arielb1> eddyb: we don't normalize in the presence of HRTB
[18:52:21] <eddyb> I knew I was missing something
[18:52:31] <eddyb> arielb1: even if the impl is valid forall 'a?
[18:52:37] <arielb1> eddyb: yes
[18:52:41] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[18:52:46] <arielb1> all impls are valid forall 'a
[18:52:57] <nmatsakis> eddyb: I see, normalizing in presence of HRTB wouldn't... I don't think... be too hard, I just didn't have a good example of it yet for the most part, though there may have been some complications. 
[18:52:59] <eddyb> unless it's for Ty<'static>
[18:53:18] <eddyb> nmatsakis: :D
[18:53:29] <nmatsakis> arielb1: ps you were asking about the "unify despite ambiguity" -- the reason for that is that often, with closures, we can't decide what kind of closure it is (hence which trait it implements), but we do know its signature, and we need that to make progress with type inference
[18:53:39] <arielb1> nmatsakis: I know
[18:53:42] <eddyb> nmatsakis: well, if you don't do it, for<'a> Trait<'a> will print like Trait<'a> or Trait, after my change
[18:54:01] <arielb1> closures shouldn't have normalizable associated types except during trans
[18:54:04] <nmatsakis> eddyb: I've been putting off some of this work (though arielb1 has been soldiering on) both because I've got a few other things I'm looking into and becaus eI want to overhaul normalization so that it is done lazilly
[18:54:11] *** Quits: mukilan (mukilan@moz-0he.e0v.164.122.IP) (Connection closed)
[18:54:13] <eddyb> nmatsakis: I wonder how many compile-fail tests this will break
[18:54:16] <nmatsakis> I've been meaning to write an internals post sketching out the idea...
[18:54:47] <nmatsakis> arielb1: hmm interesting
[18:54:53] <eddyb> are you okay with temporary degradation of for<'a> printing?
[18:54:57] <arielb1> nmatsakis: not really
[18:55:01] <eddyb> (it's funny how HRTB breaks printing HRTB)
[18:55:22] <arielb1> you can get normalizable associated types because of fulfillment "races"
[18:55:33] <arielb1> so we just need not to do anything stupid in that case
[18:56:03] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[18:57:30] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[18:57:33] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[19:00:28] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[19:01:32] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Ping timeout: 121 seconds)
[19:02:37] <eddyb> arielb1: btw, one reason I couldn't split tcx into global/local-for-inference last year was TypeFoldable
[19:02:39] *** Quits: laumann (thomas@moz-3m6.3kq.109.2.IP) (Ping timeout: 121 seconds)
[19:02:47] <eddyb> arielb1: and its use of Repr
[19:03:46] *** Joins: larhat1 (Adium@moz-vlo5br.cable.virginm.net)
[19:08:05] *** Quits: nham (nham@moz-lglsfe.il.comcast.net) (Ping timeout: 121 seconds)
[19:08:29] *** Joins: eerie_ (eerie@moz-2u3428.red.bezeqint.net)
[19:09:49] <arielb1> nmatsakis: did you make any advance about wf-checking?
[19:10:16] <nmatsakis> arielb1: so this is my current draft, https://github.com/nikomatsakis/rfcs/blob/projection-and-lifetimes/text/0000-wf-and-variance.md
[19:10:21] <eddyb> this is jolly, I replaced Repr<'tcx> including trans::adt::Repr<'tcx>
[19:10:42] <nmatsakis> arielb1: I was just going to re-read it, but it lays out my thoughts on where we should check for WF and where we should be using implied bounds,
[19:11:05] <nmatsakis> arielb1: what I've not done (but may do now...) is to track down some of the compilation errors I was seeing when I first tried to enforce those rules in places where I think we're forgetting them now
[19:11:27] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Ping timeout: 121 seconds)
[19:16:20] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[19:16:42] <arielb1> nmatsakis: we don't check even lifetime-less wf for functions?
[19:17:18] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[19:17:19] <arielb1> we do have to check wf for non-generic functions (because these are always codegen-ed)
[19:17:28] <nmatsakis> arielb1: I wasn't sure about that point; but I was trying to lay out a kind of minimal WF -- that is, sometimes we will not be able to check WF, so I want to think about it as "we don't check", even if we decide to do so (for convenience)
[19:17:45] <nmatsakis> arielb1: well, we check WF on the fn *definition*
[19:18:02] <arielb1> nmatsakis: on the *type* of the fn *definition*
[19:18:04] *** Joins: nham (nham@moz-lglsfe.il.comcast.net)
[19:18:04] <kimundi> nmatsakis: Sorry, but I have to ask: What does WF stand for?
[19:18:14] <arielb1> which *is* for<..> fn(t_1,t_2,t_3)
[19:18:21] <nmatsakis> arielb1: do you mean, the types of the fn's arguments?
[19:18:23] <nmatsakis> kimundi: "well-formed"
[19:18:29] <kimundi> ah, okay :)
[19:18:39] <kimundi> thx
[19:18:40] <arielb1> nmatsakis: these late-bound regions don't just *disappear*, you know
[19:19:06] <arielb1> but we get to assume the region relationships we need
[19:19:08] <nmatsakis> arielb1: when checking the fn definition, we are using skolemized regions, but we can lean on implied bounds also
[19:19:10] <arielb1> so we can just drop them
[19:19:15] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[19:19:30] *** Joins: aepsil0n (eduard@moz-6491ha.mv2h.pepi.8071.2a02.IP)
[19:19:34] <nmatsakis> arielb1: I guess another way to think about it.. hmm.. would be to check WF, but add implied bounds temporarily into the environment
[19:19:50] <nmatsakis> that'd require some effort to implement, but...makes sense
[19:20:15] <arielb1> nmatsakis: so bounds coming from associated type normalization count?
[19:20:19] <nmatsakis> (that is, check WF also for fn() types)
[19:20:40] <nmatsakis> arielb1: elaborate?
[19:20:51] <arielb1> if we have <Foo as Bar>::Out
[19:20:57] <arielb1> I mean
[19:21:05] <arielb1> <Foo<'a,'b> as Bar>::Out
[19:21:05] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[19:21:16] <arielb1> impl<'a, 'b> Foo<'a, 'b> for Bar where 'a: 'b
[19:22:34] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[19:22:40] <arielb1> I think we can say "lifetime bounds on HRT are checked when the type is instantiated, so we can just erase the lifetimes to 'static"
[19:22:55] <arielb1> or skolemize them
[19:22:57] <arielb1> which is equivalent
[19:23:03] <eddyb> nmatsakis: did you see the issue elif raised about fn foo<T>(){} foo::<T> having the same type as foo::<U>, even without reification?
[19:23:06] <arielb1> (onless we integrate dropck with wf somehow)
[19:23:24] <eddyb> this seems like a potentially serious breaking change, and I got reminded of it when you started talking about WF
[19:23:29] <arielb1> if we integrate dropck, then for<'a> fn(&'a mut Box<Trait+'a>) becomes non-wf
[19:24:25] <arielb1> even without the Box I guess
[19:24:34] <nmatsakis> eddyb: yes, I know about that
[19:25:01] <nmatsakis> eddyb: there will be some breakage no doubt; this area was highlighted as an area of instability in the language
[19:25:14] <nmatsakis> eddyb: I've prototyped some related changes and didn't find that much breakage though
[19:25:35] <nmatsakis> eddyb: but I'm trying to work my way through to that issue, yes
[19:25:57] <eddyb> nmatsakis: it would be a shame if reification becomes impossible because it was postponed as low priority and that issue sneaked its way into 1.0
[19:25:59] <nmatsakis> arielb1: I don't think we need to integrate dropck into WF; it's not clear that it makes sense, since dropck is concerned with the lifetime of the underlying resource, not a reference
[19:26:10] *** Quits: Sho (sho@moz-aig7ns.cust.telecolumbus.net) (Quit: Konversation terminated!)
[19:26:33] <arielb1> nmatsakis: pnkfelix's "on every type in the program" dropck rule is kind-of weird
[19:26:37] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[19:26:42] <arielb1> I mean, wrt. HRT
[19:27:17] <arielb1> maybe "on every type constructor" would be better
[19:27:23] <arielb1> *value constructor
[19:27:40] <arielb1> but then we would need to propagate it I guess
[19:30:40] <arielb1> maybe "on every rvalue and local" would work
[19:31:07] <arielb1> dropck is structural not nominal so it won't look inside &T rvalues
[19:32:04] *** Quits: _Vi (vi@moz-bbs.vhj.131.104.IP) (Ping timeout: 121 seconds)
[19:32:27] *** Quits: untitaker (untitaker@moz-vuq655.highway.telekom.at) (Ping timeout: 121 seconds)
[19:32:51] <arielb1> we should erase_late_bound_regions (or skolemize_*, shouldn't matter) when dropck-ing at trait object
[19:34:20] <nmatsakis> arielb1: I'm not sure I follow. The dropck code is run on every value that we will be dropped (i.e., lvalues, rvalue temporaries)
[19:34:39] <nmatsakis> arielb1: not "every type in the program"..or am I missing something?
[19:35:23] *** Joins: untitaker (untitaker@moz-gfukss.highway.telekom.at)
[19:36:06] <arielb1> the language is "Let v be some value (either temporary or named)"
[19:36:23] <arielb1> I guess it was just unclear
[19:36:41] <arielb1> given that there is a value behind an &T
[19:38:22] <arielb1> I don't think dropck is relevant for standard lvalues
[19:38:31] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[19:39:07] <arielb1> I mean, if you do call_fn(&(*a).b)
[19:39:16] <arielb1> then *a, and (*a).b are lvalues
[19:40:48] *** Quits: sigma (sigma@moz-uqk2kb.range86-146.btcentralplus.com) (Ping timeout: 121 seconds)
[19:41:31] *** Quits: eerie_ (eerie@moz-2u3428.red.bezeqint.net) (Ping timeout: 121 seconds)
[19:41:43] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Connection closed)
[19:42:21] <arielb1> dropck.rs says "type of every expression"
[19:42:30] <arielb1> which isn't enough because covariance
[19:44:02] <arielb1> and it disallows working with dereferences of values of type &mut Foo<'a, 'b>
[19:44:28] *** Quits: yjv (yjv@moz-j0cdis.fios.verizon.net) (Connection closed)
[19:44:34] <arielb1> (technically)
[19:45:02] *** Quits: semarie (semarie@moz-1fgc6t.privacyfoundation.ch) (A TLS packet with unexpected length was received.)
[19:46:33] <arielb1> the real rule is that it has to be applied to everything that is dropped at end-of-scope
[19:49:19] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[19:58:12] *** Quits: bdero (bran@moz-nd2f6b.dyn.mit.edu) (Ping timeout: 121 seconds)
[19:58:45] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[19:59:37] <arielb1> nmatsakis: trait declarations being checked like impls would be a big [breaking-change]
[19:59:56] <arielb1> lots of traits have methods that take self without :Sized
[20:01:01] <nmatsakis> arielb1: yeah, I know :) but I don't think that needs to be a WF violation. I should make that clear.
[20:01:22] <arielb1> nmatsakis: we do need to check that on non-generic methods
[20:01:51] <arielb1> or implement it :-)
[20:01:55] <nmatsakis> arielb1: we currently check it when the method is impl'd, and I think that's fine. The requirement that argument types be sized doesn't have to be part of WF necessarily. (And I'd prefer to lift that restriction longer term anyway)
[20:02:50] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Ping timeout: 121 seconds)
[20:02:54] <nmatsakis> (anyway, we did intentionally take advantage of that...loophole in the code when we made Self not Sized by default)
[20:04:26] <arielb1> also, I think you can hide an fn as a trait object and use it to call the fn without wf-checking taking place
[20:05:38] *** Joins: Gankro_ (Mibbit@moz-u3dg2t.sfo1.mozilla.com)
[20:06:47] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[20:07:35] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[20:07:57] <brson> discourse is down
[20:08:39] *** Quits: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP) (A TLS packet with unexpected length was received.)
[20:13:10] <brson> what is the process for stabilizing libraries?
[20:13:23] <brson> this pr stabilized two functions w/o much fanfare https://github.com/rust-lang/rust/pull/26039
[20:13:35] <brson> at the same time it changed their behavior
[20:16:11] <brson> it also seems to change the behavior of the stable char::to_uppercase function
[20:17:10] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[20:17:10] *** ChanServ sets mode: +o pcwalton
[20:17:56] <brson> also changed the stable char::to_lowercase function
[20:20:18] <WindowsBunny> brson: I think any PR that stabilizes stuff should be required to have consensus from the relevant subteam + a final comment period if the subteam thinks it needs one + must update the release notes
[20:23:20] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[20:24:45] <awe> Does http://sprunge.us/OBGK mean that I ran out of memory...?
[20:24:46] <reem> Would be cool if we linted PRs for newly stabilized APIs like servo does for PRs modifying unsafe code
[20:25:15] <sfackler> awe: yeah
[20:25:21] <arielb1> what's I-wrong?
[20:25:23] <cmr> brson: given that it's an "addition to std" (the public interface at least), https://github.com/rust-lang/rfcs#when-you-need-to-follow-this-process applies
[20:25:28] <arielb1> I always thought it was for wrong-code bugs
[20:27:02] <kmc> what servo does is more like detecting any PR whose diff contains the string "unsafe"
[20:27:04] <reem> arielb1: I think miscompilation and/or clear bugs in some std API
[20:27:05] <kmc> last I checked :P
[20:27:25] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[20:27:31] <reem> we could check for any diff that contains stable in the added portions
[20:27:41] <reem> or more instances of stable in the added portion than the deleted portion
[20:28:09] *** Joins: _Vi (vi@moz-bbs.vhj.131.104.IP)
[20:29:16] <awe> sfackler: are there other conditions that would cause this?
[20:29:30] <WindowsBunny> awe: oom means out of memory
[20:29:37] <awe> Yes, I'm aware.
[20:29:39] <WindowsBunny> and oom is only caused when an allocation fails
[20:30:09] <WindowsBunny> So you could possibly be trying to allocate an unrealistically huge allocation
[20:30:19] <WindowsBunny> possibly due to fault logic
[20:30:58] <WindowsBunny> awe: But to_owned on a str shouldn't be doing that
[20:31:14] <WindowsBunny> since it is just duplicating an existing string :|
[20:32:07] <WindowsBunny> awe: So either that str is corrupt
[20:32:28] <WindowsBunny> OR you have an infinite loop of some sort allocating quickly until ded
[20:33:02] <cmr> WindowsBunny: ......... or they're out of memory.
[20:33:09] <awe> cmr: I'm definitely not out of memory.
[20:33:21] <awe> cmr: The program just started and it's using 1.7 MB of RAM.
[20:33:57] <awe> That's why I was asking if there's something else that might cause this.
[20:34:08] <WindowsBunny> I'm betting on that str being corrupt
[20:34:33] <WindowsBunny> Which means it has an invalid length that to_owned tries to allocate a new String for
[20:35:02] *** Joins: ConnorDoyle (ConnorDoyle@moz-70n.7f4.118.12.IP)
[20:35:53] <awe> One thing that's also weird is that the line from frame #4 doesn't call the function referred to in frame #3?
[20:36:55] <brandonson> awe: does something nearby call it?
[20:36:59] <awe> No.
[20:37:23] <brandonson> awe: alternatively, did you whack your stack completely?  lol
[20:37:27] <awe> Frame #4 is in a dynamically loaded dynamic library.
[20:37:54] <awe> Nowhere in that library is there a call to send_ctcp
[20:38:06] <awe> but that's what frame #3 is.
[20:38:27] <awe> Also, the message in frame #3 appears to be the name of the bot with the first few characters overwritten with the message that caused it to crash.
[20:38:36] <awe> (the bot's name was awebot_ and the message was ayy)
[20:39:16] <brandonson> awe:  hmm.  frame 4 doesn't call a closure by any chance?
[20:39:33] <eddyb> nmatsakis: test result: FAILED. 1725 passed; 38 failed; 11 ignored; 0 measured
[20:39:40] <awe> Nope, no closures.
[20:40:18] <eddyb> nmatsakis: I don't want to change all of those expected error messages :(
[20:40:37] <eddyb> nmatsakis: good news that everything else is working
[20:40:49] <eddyb> *good news is
[20:42:15] <awe> brandonson: do you think it's possible that std::dynamic_lib is doing something wrong?
[20:43:35] <brandonson> awe: could be, but I can't really say.  Haven't done dynamic libs in rust.
[20:43:48] <arielb1> eddyb: what have you done?
[20:44:20] <awe> brandonson: From my experiences using it, it seems like nobody except for rustc and me has >.>
[20:44:24] <eddyb> arielb1: freed ppaux from under the reign of 'tcx
[20:44:40] <kimundi> awe: how are you using it?
[20:44:49] *** Joins: genbattle (genbattle@moz-4v0.gkd.16.182.IP)
[20:44:53] <kimundi> awe: its unsafe for a reason :)
[20:44:58] <awe> I know.
[20:45:05] <awe> kimundi: https://github.com/aatxe/awebot/blob/master/src/main.rs
[20:45:17] <eddyb> arielb1: the impl of UserString for ty::Binder<T> is broken because of the lack of projection normalization under HRTB
[20:45:30] <eddyb> arielb1: so I removed the "for<'a> " part of the output
[20:45:40] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[20:45:46] <arielb1> eddyb: and how that fixes it?
[20:45:52] <awe> kimundi: it's also terribly under-documented though.
[20:45:59] <eddyb> arielb1: that's the part that requires the crazy bounds
[20:46:30] <arielb1> maybe do explicit impls?
[20:46:31] *** Quits: larhat1 (Adium@moz-vlo5br.cable.virginm.net) (Quit: Leaving.)
[20:46:31] <eddyb> arielb1: when it goes through ty_fold::replace_late_bound_regions
[20:46:40] <eddyb> well, that's an option
[20:47:13] <eddyb> I could write a function that works on the already lifted value and call it from N impls
[20:47:42] <eddyb> arielb1: thanks, I didn't think of that :D
[20:49:41] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Ping timeout: 121 seconds)
[20:53:33] *** Joins: bdero (bran@moz-0e2lk5.sns9.e6pb.0197.2601.IP)
[20:55:56] *** Quits: aepsil0n (eduard@moz-6491ha.mv2h.pepi.8071.2a02.IP) (Quit: Leaving.)
[20:59:44] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[21:09:29] <eddyb> arielb1: I did screw up one of the Lift impls. sadly, that's not the cause of the HRTB failure, but the proxy impls are working out
[21:11:56] *** Joins: larhat1 (Adium@moz-vlo5br.cable.virginm.net)
[21:14:53] <brson> somebody is trying to redesign twir https://github.com/cmr/this-week-in-rust/pull/66
[21:15:27] <cmr> brson: that's Vikrant
[21:16:42] <brson> cmr: indeed!
[21:20:34] *** Quits: Gankro_ (Mibbit@moz-u3dg2t.sfo1.mozilla.com) (Quit: http://www.mibbit.com ajax IRC Client)
[21:23:44] *** Joins: erickt (erickt@moz-4sl51b.hfc.comcastbusiness.net)
[21:23:44] *** ChanServ sets mode: +ao erickt erickt
[21:24:06] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[21:26:23] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[21:28:15] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[21:29:45] <pcwalton> I'm going to r+ https://github.com/rust-lang/rust/pull/26326
[21:29:51] <pcwalton> speak now or forever hold your peace
[21:31:39] *** Quits: burntsushi (burntsushi@moz-t92kn9.ma.charter.com) (Quit: Konversation terminated!)
[21:32:24] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[21:32:51] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[21:36:25] <WindowsBunny> pcwalton: I am speaking now, but not to oppose it
[21:38:15] *** kimundi is now known as zz_kimundi
[21:41:20] *** Joins: burntsushi (burntsushi@moz-t92kn9.ma.charter.com)
[21:41:24] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[21:41:50] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[21:43:16] *** Joins: lorenzb (lorenzb@moz-3j4hkt.ethz.ch)
[21:44:02] *** Quits: arielb1 (Ariel@moz-lpse9v.red.bezeqint.net) (Quit: Ex-Chat)
[21:47:26] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Quit: Leaving)
[21:47:33] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[21:56:04] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[22:00:44] *** Quits: lorenzb (lorenzb@moz-3j4hkt.ethz.ch) (Quit: Computer went to sleep)
[22:02:26] *** Joins: lorenzb (lorenzb@moz-3j4hkt.ethz.ch)
[22:06:43] *** Quits: munksgaard (munksgaard@moz-urnkl5.u.parknet.dk) (Connection closed)
[22:09:53] *** Quits: goyox86 (textual@moz-rvv.00r.255.109.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[22:12:56] *** Quits: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net) (Ping timeout: 121 seconds)
[22:18:58] <Gankro> pnkfelix: Are more dropck changes in the works?
[22:19:25] <pnkfelix> Gankro: nothing immediately planned
[22:19:43] <Gankro> pnkfelix: what about https://github.com/rust-lang/rfcs/issues/829 ?
[22:19:59] <pnkfelix> Gankro: nothing immediately planned
[22:20:04] <Gankro> kk
[22:20:19] <Gankro> pnkfelix: so the RFC text is accurate for the forseeable future?
[22:21:28] <pnkfelix> Gankro: I think so.  some of the details may need modification, not sure, I've seen rumblings about its interactions with HKT but i think it may be more a question of fine-tuning the spec or at least clarifying it
[22:23:52] *** Joins: mib_t68bhl (Mibbit@moz-hu6.nja.252.72.IP)
[22:24:44] *** Joins: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au)
[22:24:51] <eddyb> nmatsakis: if you're still around, you'll want to take a look at https://github.com/rust-lang/rust/pull/26351
[22:24:52] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[22:25:07] <eddyb> most of it is dull application of regex
[22:25:21] <eddyb> (quantity-wise)
[22:26:12] <eddyb> there's a risk of it going stale, I already had to rebase once, after opening the PR
[22:28:57] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[22:31:09] *** Quits: lorenzb (lorenzb@moz-3j4hkt.ethz.ch) (Quit: Computer went to sleep)
[22:34:53] *** Joins: Rym (uid91135@moz-n2i7qm.charlton.irccloud.com)
[22:35:07] <WindowsBunny> um acrichto
[22:35:14] <WindowsBunny> Are you sure you're noticing that build error in llvm?
[22:35:17] <WindowsBunny> /Users/rustbuild/src/rust-buildbot/slave/auto-mac-64-nopt-t/build/src/llvm/include/llvm/ExecutionEngine/Orc/LazyEmittingLayer.h:126:66: error: only virtual member functions can be marked 'override'                                  bool ExportedSymbolsOnly) const override {
[22:35:26] <acrichto> zomg how did I not see that
[22:36:11] <WindowsBunny> acrichto: You forgot to scroll up :P
[22:36:21] <WindowsBunny> After it errored it continued to build a bunch of files before finally aborting
[22:36:43] <acrichto> WindowsBunny: wow thanks for the pointer!
[22:36:47] <acrichto> not... sure how I missed that
[22:36:51] <eddyb> WindowsBunny: gotta love that parallel compilation :D
[22:37:05] <WindowsBunny> acrichto: I'm watching your back ;)
[22:38:26] <eddyb> the bunny who watches from the windows
[22:39:07] <acrichto> WindowsBunny: so I have a question
[22:39:16] <acrichto> I got a build of cargo targeting MSVC to finally link
[22:39:20] <WindowsBunny> wooooooo
[22:39:30] <acrichto> but when I run the executable it instantly throws up a dialog that a debug assertion failed
[22:39:38] <WindowsBunny> ouch
[22:39:54] <acrichto> do you know of a way to debug that?
[22:39:57] <acrichto> gdb wasn't handling it very well
[22:40:00] <WindowsBunny> Sure, run the process in VS
[22:40:07] <WindowsBunny> Also, what was the dialog?
[22:40:21] <acrichto> hm
[22:40:27] <acrichto> not sure how to take a screenshot in this vm...
[22:40:41] <acrichto> the expression it failed at was (_osfile(fh) & FOPEN)
[22:40:50] <WindowsBunny> o_0
[22:41:13] <acrichto> is there a free version of VS?
[22:41:16] <WindowsBunny> acrichto: Yes
[22:41:17] <acrichto> mine says my license is expired
[22:41:21] <WindowsBunny> VS 2013 community edition
[22:41:47] <acrichto> so did I just install the wrong thing?
[22:41:55] <WindowsBunny> acrichto: Which version did you install?
[22:41:57] <acrichto> b/c when I try to install that it only asks me to repair it
[22:41:59] <acrichto> I'm not sure :(
[22:42:08] <acrichto> the start icon just says "VS 2013"
[22:42:18] <WindowsBunny> acrichto: Well, if the license is expired, you typically just need to login again
[22:42:27] <WindowsBunny> and it'll refresh your license, assuming you are using the community edition
[22:42:35] <acrichto> I'll try uninstalling and reinstalling perhaps
[22:42:39] *** Quits: larhat1 (Adium@moz-vlo5br.cable.virginm.net) (Quit: Leaving.)
[22:42:41] <acrichto> I don't have a login :(
[22:42:54] <WindowsBunny> You don't have a Microsoft account? D:
[22:42:58] <acrichto> lol
[22:43:39] <WindowsBunny> All you have to do is sell Microsoft a bit of your information and they'll let you use community edition all you want
[22:46:15] <WindowsBunny> Once you do have a functioning VS, just file -> open -> project/solution, and then open the .exe directly
[22:46:28] <WindowsBunny> adjust the working directory and paths stuff as needed, and then debug it
[22:47:59] *** Quits: bjz (bjz@moz-puppgq.tpgi.com.au) (Quit: My Mac has gone to sleep. ZZZzzz…)
[22:49:29] <eddyb> does anyone think it would be a bad idea to replace sess.bug calls with panics?
[22:49:53] <eddyb> I'd almost write panic!((span, ...)) than call sess.bug
[22:50:12] <eddyb> I think we already catch panics in the compiler so I don't know why we have a separate thing
[22:50:33] *** Joins: swgillespie (swgillespie@moz-apj.3un.220.167.IP)
[22:50:33] <acrichto> WindowsBunny: cool thanks! I will get back to you once that's working
[22:50:35] <acrichto> if... it works
[22:50:55] <WindowsBunny> acrichto: You could also let me try to build your msvc version of cargo
[22:51:11] <acrichto> WindowsBunny: https://github.com/alexcrichton/cargo/tree/msvc
[22:51:21] <eddyb> just read TWiR, and Result::expect looks more ergonomic than matching over Err(e) and calling sess.bug
[22:51:23] <WindowsBunny> Anything special I have to do for it?
[22:51:48] <acrichto> WindowsBunny: hm, I think you need an override pointing to curl-rust
[22:51:59] <acrichto> https://github.com/alexcrichton/curl-rust/tree/msvc
[22:52:16] <acrichto> WindowsBunny: other than that it should be `./.travis.install.sh && ./configure --build=... --local-rust-rust-root=...`
[22:52:20] <acrichto> and then just make
[22:52:22] <acrichto> (in theory)
[22:53:40] <WindowsBunny> >make
[22:53:47] <WindowsBunny> :|
[22:53:53] <acrichto> WindowsBunny: oh I'm running from a MinGW shell still
[22:54:03] <acrichto> yeah yeah we'll get around to maybe not requiring mingw to build one day :P
[22:54:08] <WindowsBunny> acrichto: all the make system does is fetch a snapshot cargo right?
[22:54:11] <WindowsBunny> And then a cargo build?
[22:54:13] <acrichto> yeah
[22:54:17] <acrichto> plus set up some random env vars
[22:54:23] <acrichto> make also has the logic for building a tarball
[22:55:15] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[22:56:14] *** Joins: larhat1 (Adium@moz-vlo5br.cable.virginm.net)
[22:56:34] *** Quits: mib_t68bhl (Mibbit@moz-hu6.nja.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[23:02:25] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Ping timeout: 121 seconds)
[23:02:39] *** Joins: elif_ (chatzilla@moz-ev8m1p.res.rr.com)
[23:03:10] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[23:04:27] *** Quits: elif (chatzilla@moz-ev8m1p.res.rr.com) (Ping timeout: 121 seconds)
[23:04:35] *** elif_ is now known as elif
[23:05:19] *** Quits: larhat1 (Adium@moz-vlo5br.cable.virginm.net) (Quit: Leaving.)
[23:07:30] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[23:08:01] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[23:08:01] *** ChanServ sets mode: +o pcwalton
[23:16:20] *** Joins: njn (chatzilla@moz-0ah9lm.iinet.net.au)
[23:18:11] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[23:18:48] <WindowsBunny> acrichto: You forgot to test your cargo stable branch on windows? :P
[23:25:38] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[23:26:48] *** Quits: erz (erz@moz-ab429s.broadband.corbina.ru) (Quit: My Mac has gone to sleep. ZZZzzz…)
[23:29:34] *** Quits: erickt (erickt@moz-4sl51b.hfc.comcastbusiness.net) (Ping timeout: 121 seconds)
[23:29:43] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Ping timeout: 121 seconds)
[23:33:59] * WindowsBunny runs the cargo
[23:34:07] <WindowsBunny> oh boy, I got the assertion :D
[23:34:09] <WindowsBunny> now lets debug it
[23:35:58] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[23:37:13] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[23:37:53] <WindowsBunny> acrichto: Here's a backtrace https://gist.github.com/906746eccf9524b17d98
[23:38:09] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[23:38:41] <WindowsBunny> I think the backtrace might be a bit borked
[23:40:00] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Ping timeout: 121 seconds)
[23:46:05] <WindowsBunny> acrichto: I'm sad because pdb debug info for any libraries that are statically linked in is lost
[23:46:11] <WindowsBunny> due to the way rustc/cargo build stuff
[23:52:33] <WindowsBunny> Anyway, it seems this assertion is failing
[23:52:34] <WindowsBunny> _VALIDATE_CLEAR_OSSERR_RETURN((_osfile(fh) & FOPEN), EBADF, -1);
[23:54:12] *** Quits: elif (chatzilla@moz-ev8m1p.res.rr.com) (Quit: ChatZilla 0.9.90.1-rdmsoft [XULRunner 29.0/20140421221237])
[23:56:24] <WindowsBunny> acrichto: As far as I can tell, it means the file handle was closed
[23:57:12] *** Quits: pjenvey (pjenvey@moz-ph7jic.org) (Quit: leaving)
[23:57:17] *** Joins: pjenvey_ (pjenvey@moz-p7k1r4.underboss.org)
[23:57:27] *** pjenvey_ is now known as pjenvey
[23:59:31] *** Quits: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net) (Client exited)
