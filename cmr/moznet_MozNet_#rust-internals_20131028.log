[00:02:13] *** kimundi is now known as zz_kimundi
[00:22:44] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[00:22:44] *** ChanServ sets mode: +qo brson brson
[00:43:15] *** Joins: yghannam (yghannam@moz-C5BCCF4E.lightspeed.austtx.sbcglobal.net)
[00:50:28] *** Quits: yghannam (yghannam@moz-C5BCCF4E.lightspeed.austtx.sbcglobal.net) (Ping timeout)
[00:56:56] *** Joins: tikue_ (tikue_star@427BE2B8.21C37D63.689607DE.IP)
[01:00:14] *** Quits: eddyb (eddy@37F72125.9065A63B.FCAAE698.IP) (Ping timeout)
[01:10:56] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[01:12:59] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[01:14:50] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[01:15:43] *** Quits: jeffdb_ (jeff@moz-D13B6004.hsd1.ca.comcast.net) (Ping timeout)
[01:16:42] *** Joins: jeffdb_ (jeff@moz-D13B6004.hsd1.ca.comcast.net)
[01:19:09] *** Joins: brson (brson@6A848D32.C1B840DD.76F66111.IP)
[01:19:09] *** ChanServ sets mode: +qo brson brson
[01:35:57] *** Quits: tjc (tjc@moz-957520D8.lightspeed.frsnca.sbcglobal.net) (Quit: Places to go, people to annoy)
[01:41:17] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Bye!)
[01:41:26] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[01:41:26] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[01:41:26] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14826d342 to 1416b8a41: 02http://git.io/N3iJvQ
[01:41:27] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[01:41:33] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[01:41:33] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/KCeP5g
[01:41:33] <ghrust> 13rust/06auto 1428f4f65 15Alex Crichton: Fix a typo in a rt::io::signal test...
[01:41:33] <ghrust> 13rust/06auto 148455ad8 15Alex Crichton: Ignore a test which never completes on windows...
[01:41:33] <ghrust> 13rust/06auto 14a120011 15bors: auto merge of #10098 : alexcrichton/rust/attempts, r=alexcrichton...
[01:41:35] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[02:26:57] *** Quits: brson (brson@6A848D32.C1B840DD.76F66111.IP) (Quit: leaving)
[02:38:50] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[02:41:25] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[02:41:25] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/KCeP5g
[02:41:25] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[02:43:53] <cmr> What is the new nomination process? Tag the issue with P-high-untriaged?
[02:46:27] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[02:46:27] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02https://github.com/mozilla/rust/compare/a1200118271a...a1200118271a
[02:46:27] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[02:46:28] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[02:46:28] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/4Gt31A
[02:46:28] <ghrust> 13rust/06auto 14642da46 15Matthew Iselin: Set external linkage on Rust functions defined with foreign ABIs.
[02:46:28] <ghrust> 13rust/06auto 1416b5390 15Matthew Iselin: Make all functions, not just foreign ABI ones, link with external linkage if they are publically visible.
[02:46:29] <ghrust> 13rust/06auto 14810fcfc 15Matthew Iselin: Link statics with external linkage if they are publically visible
[02:46:31] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[02:47:35] <cmr> (https://github.com/mozilla/rust/issues/10114)
[02:58:54] *** Quits: dbaupp (Thunderbir@moz-592B18A.lns20.syd6.internode.on.net) (Ping timeout)
[03:02:22] *** Joins: dbaupp (Thunderbir@moz-592B18A.lns20.syd6.internode.on.net)
[03:04:35] *** Quits: zz_kimundi (kimundi@moz-2953ED52.dip0.t-ipconnect.de) (Ping timeout)
[03:08:03] *** Joins: zz_kimundi (kimundi@moz-EA7ECD3D.dip0.t-ipconnect.de)
[03:08:05] *** zz_kimundi is now known as kimundi
[03:11:53] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[03:12:06] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[03:13:46] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[03:21:33] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[03:21:33] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1406000d2 to 14a120011: 02http://git.io/N3iJvQ
[03:21:33] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[03:21:34] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[03:21:34] <ghrust> 01[13rust01] 15bors pushed 12 new commits to 06auto: 02http://git.io/SCWsNA
[03:21:34] <ghrust> 13rust/06auto 14c62d604 15Jason Toffaletti: lock-free queue for scheduler message queue
[03:21:34] <ghrust> 13rust/06auto 14bf0e6eb 15Jason Toffaletti: add cache line padding
[03:21:34] <ghrust> 13rust/06auto 145876e21 15Jason Toffaletti: add multi-producer multi-consumer bounded queue to use for sleeper list
[03:21:36] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[03:21:40] <pcmattman> http://buildbot.rust-lang.org/builders/auto-mac-64-opt/builds/2191/steps/test/logs/stdio ???
[03:21:45] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[03:21:52] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[03:22:02] <pcmattman> bit of an interesting error, hmm
[03:24:48] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[03:39:54] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[03:40:27] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[03:42:23] *** Quits: tikue_ (tikue_star@427BE2B8.21C37D63.689607DE.IP) (Ping timeout)
[03:42:27] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:42:51] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:49:45] *** Joins: tikue_ (tikue_star@427BE2B8.21C37D63.689607DE.IP)
[04:31:42] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[04:31:42] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/SCWsNA
[04:31:42] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[04:36:32] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[04:36:32] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/HeqxkQ
[04:36:32] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[04:36:36] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[04:36:36] <ghrust> 01[13rust01] 15bors pushed 8 new commits to 06auto: 02http://git.io/ZsuzVA
[04:36:36] <ghrust> 13rust/06auto 142c30fce 15Palmer Cox: Clarify that the SipHash implementation has not be validated for cryptographic purposes.
[04:36:36] <ghrust> 13rust/06auto 14c5f10b4 15Palmer Cox: Update workcache to no longer use Sha1.
[04:36:36] <ghrust> 13rust/06auto 14653ee13 15Palmer Cox: Remove MD5 and Sha2. Move Sha1 and support code into librustpkg.
[04:36:38] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[05:09:01] *** Quits: tikue_ (tikue_star@427BE2B8.21C37D63.689607DE.IP) (Ping timeout)
[05:10:12] *** Joins: tikue_ (tikue_star@427BE2B8.21C37D63.689607DE.IP)
[05:12:51] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[05:14:37] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[05:15:51] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Ping timeout)
[05:17:33] *** Quits: Kxepal (Miranda@moz-310BBEE9.pppoe.mtu-net.ru) (Ping timeout)
[05:20:47] *** Joins: Kxepal (Miranda@moz-2EF7C242.pppoe.mtu-net.ru)
[05:23:25] *** Joins: eddyb (eddy@37F72125.9065A63B.FCAAE698.IP)
[05:26:26] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[05:30:16] *** Parts: acrichto (acrichto@moz-69F2E428.ugrad.cs.cmu.edu) ()
[05:30:19] *** Joins: acrichto (acrichto@moz-69F2E428.ugrad.cs.cmu.edu)
[05:36:22] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[05:36:22] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/ZsuzVA
[05:36:22] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[05:38:53] <pcmattman> My OSX laptop is breaking with '__rust_crate_map_toplevel' being undefined. Well, no, '__rust_crate_map_toplevel12727'...
[05:41:18] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[05:41:18] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/09Rt2g
[05:41:18] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[05:41:19] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[05:41:19] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/zyqWKg
[05:41:19] <ghrust> 13rust/06auto 147d5c7b8 15gifnksm: extra: Add getter methods to extra::rational::Ratio...
[05:41:19] <ghrust> 13rust/06auto 14cb5b21e 15bors: auto merge of #10050 : gifnksm/rust/ratio-methods, r=pcwalton...
[05:41:20] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[05:41:26] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Bye!)
[05:41:35] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[06:14:35] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[06:18:40] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[06:20:06] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[07:13:54] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[07:14:33] *** Joins: jensnock_ (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[07:14:59] *** Quits: tikue_ (tikue_star@427BE2B8.21C37D63.689607DE.IP) (Ping timeout)
[07:15:40] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[07:16:21] *** Quits: jensnock_ (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[07:41:31] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[07:41:31] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/zyqWKg
[07:41:31] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[07:46:23] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[07:46:23] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/fG6lQg
[07:46:23] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[07:46:24] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[07:46:24] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/i8zLvw
[07:46:24] <ghrust> 13rust/06auto 142011ad2 15Alex Crichton: Remove the extension traits for Readers/Writers...
[07:46:24] <ghrust> 13rust/06auto 14763852b 15bors: auto merge of #10079 : alexcrichton/rust/no-reader-util, r=brson...
[07:46:25] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[07:57:10] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[08:01:49] *** flaper87|afk is now known as flaper87
[08:26:17] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[08:26:17] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14763852b to 14cb5b21e: 02http://git.io/N3iJvQ
[08:26:17] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[08:26:18] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[08:26:18] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/4a_MIw
[08:26:18] <ghrust> 13rust/06auto 14fa8e71a 15Marvin LÃ¶bel: Allow fail messages to be caught, and introduce the Any trait...
[08:26:18] <ghrust> 13rust/06auto 149ef23e9 15bors: auto merge of #9967 : Kimundi/rust/fail_cause_two, r=huonw...
[08:26:19] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[08:27:02] <dbaupp> kimundi: hopefully it goes through this time :)
[08:29:00] <dbaupp> r? https://github.com/mozilla/rust/pull/10117
[08:33:37] *** kimundi is now known as zz_kimundi
[08:51:22] *** Quits: jeffdb_ (jeff@moz-D13B6004.hsd1.ca.comcast.net) (Quit: jeffdb_)
[08:59:58] *** zz_kimundi is now known as kimundi
[09:36:32] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[09:36:32] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/4a_MIw
[09:36:32] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[09:41:19] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[09:41:19] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/m47Iww
[09:41:19] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[09:41:23] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[09:41:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/ElYUTQ
[09:41:23] <ghrust> 13rust/06auto 147a1d97e 15Alex Crichton: Enhance timers to create ports...
[09:41:23] <ghrust> 13rust/06auto 14de3d36a 15bors: auto merge of #10083 : alexcrichton/rust/timer-port, r=pcwalton...
[09:41:23] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[09:42:59] <dbaupp> kimundi: \o/
[09:46:45] <kimundi> dbaupp: \o/
[09:47:05] <kimundi> Now I can submit my other two PRs ;)
[09:49:11] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[09:59:10] <kimundi> r? https://github.com/mozilla/rust/pull/10120 
[10:41:26] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[10:41:26] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/ElYUTQ
[10:41:26] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[10:44:18] *** Joins: jdm (jdm@88F51059.F3BBB17D.144F44FA.IP)
[10:46:24] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[10:46:24] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/UhuC-g
[10:46:24] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[10:46:26] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[10:46:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/4xRPEA
[10:46:26] <ghrust> 13rust/06auto 14a239c0e 15Joshua Yanovski: Make addl_lib_search_paths a HashSet (Closes #7718).
[10:46:26] <ghrust> 13rust/06auto 14ef354e7 15bors: auto merge of #10089 : pythonesque/rust/issue-7718, r=catamorphism...
[10:46:26] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[11:05:39] <kimundi> dbaupp: I think it's amusing that I'm so used to last-expr-return now that I completely forgot about the semicolon after the return :)
[11:06:38] <dbaupp> kimundi: haha :)
[11:07:22] <kimundi> dbaupp: Anyway, I think changing that function to return &'static str is a step in the right direction
[11:07:41] <dbaupp> kimundi: I agree, I just think it can be done later when the rest of the code supports it
[11:08:11] <kimundi> Meh, might as well change this one now
[11:08:19] <dbaupp> (since it's entirely an implementation detail, and using @str there saves writing two .to_managed()'s... disk space is important :P )
[11:10:01] *** Quits: dbaupp (Thunderbir@moz-592B18A.lns20.syd6.internode.on.net) (Ping timeout)
[11:11:41] *** Joins: dbaupp (Thunderbir@moz-15934519.lns20.syd6.internode.on.net)
[11:16:48] *** flaper87 is now known as flaper87|afk
[11:22:55] <kimundi> dbaupp: Changed it back to @str :P
[11:24:37] <kimundi> I think the highest danger with changing it now is that as soon as the functions that use this string source get updated to use &str, the .to_managed() calls would just silently coerce to &str again, just doing a silent unnecessary allocation
[11:46:24] *** kimundi is now known as zz_kimundi
[12:25:10] *** Quits: jdm (jdm@88F51059.F3BBB17D.144F44FA.IP) (Quit: Lost terminal)
[12:36:37] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[12:36:37] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14ef354e7 to 14de3d36a: 02http://git.io/N3iJvQ
[12:36:37] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[12:36:39] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[12:36:39] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/jzySvw
[12:36:39] <ghrust> 13rust/06auto 14651f5db 15Alex Crichton: Implement another error code found on windows....
[12:36:39] <ghrust> 13rust/06auto 14672edb2 15bors: auto merge of #10093 : alexcrichton/rust/issue-8811, r=pcwalton...
[12:36:39] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[12:39:52] *** zz_kimundi is now known as kimundi
[12:51:55] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[12:52:23] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[12:52:29] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[13:03:08] *** flaper87|afk is now known as flaper87
[13:14:32] *** Quits: eddyb (eddy@37F72125.9065A63B.FCAAE698.IP) (Ping timeout)
[13:17:37] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[13:31:46] *** Joins: eddyb (eddy@A93A03C9.9065A63B.FCAAE698.IP)
[13:36:40] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[13:36:40] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/jzySvw
[13:36:40] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[13:41:44] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[13:41:44] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/bxsx7w
[13:41:44] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[13:41:45] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[13:41:45] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/ADTbFw
[13:41:45] <ghrust> 13rust/06auto 14357ef1f 15Alex Crichton: Rewrite boxed_region/memory_region in Rust...
[13:41:45] <ghrust> 13rust/06auto 14bee40a9 15bors: auto merge of #10094 : alexcrichton/rust/issue-8704, r=pcwalton...
[13:41:46] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[13:44:43] *** Quits: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr) (Ping timeout)
[13:54:55] *** Joins: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr)
[14:01:03] *** Joins: erickt (etryzelaar@BF60BF52.64BC77A3.7FC6A66E.IP)
[14:05:01] *** Quits: erickt (etryzelaar@BF60BF52.64BC77A3.7FC6A66E.IP) (Quit: leaving)
[14:05:23] *** Joins: erickt (etryzelaar@BF60BF52.64BC77A3.7FC6A66E.IP)
[14:18:48] <nmatsakis> pnkfelix: ping
[14:18:53] <pnkfelix> nmatsakis: pong
[14:19:08] <nmatsakis> pnkfelix: just wanted to check in with you, ask if you'd made progress w/ Sized
[14:19:33] <pnkfelix> nmatsakis: i'm working on it now
[14:19:39] <nmatsakis> bah, running run-pass takes forever
[14:19:44] *** Quits: erickt (etryzelaar@BF60BF52.64BC77A3.7FC6A66E.IP) (Ping timeout)
[14:19:49] <pnkfelix> nmatsakis: still trying to understand this type-checking issue
[14:19:54] <nmatsakis> pnkfelix: how would you feel about reviewing the lifetimes patch
[14:20:01] <nmatsakis> pnkfelix: oh, which type-checking issue?
[14:21:10] <pnkfelix> nmatsakis: the one where looking up the type for a particular node_id was failing
[14:21:16] <nmatsakis> pnkfelix: oh right?
[14:21:21] <nmatsakis> pnkfelix: I hda forgotten about that
[14:21:23] <pnkfelix> nmatsakis: at this point I've determined that the node id in question is in a const-expression
[14:21:30] <pnkfelix> nmatsakis: within a type
[14:22:03] <pnkfelix> nmatsakis: i.e. its a fixed-length a vec type, like `let v : [int, BUF_LEN];`
[14:22:11] <nmatsakis> pnkfelix: ah, within a type, ok that makes more sense
[14:22:19] <pnkfelix> nmatsakis: argh, `let v: [int, ..BUF_LEN]`
[14:22:50] <nmatsakis> pnkfelix: we're probably just not type checking such expressions
[14:22:54] <pnkfelix> nmatsakis: yeah, so now I've been trying to figure out what best to do about it.  Maybe it would be easiest to just not descend into types
[14:23:06] <pnkfelix> nmatsakis: but I think it might be better to actually get descending into the types to work
[14:23:49] <pnkfelix> nmatsakis: e.g. I imagine we *should* be type-checking const-expressions, right?  Or should we just assume that the constant-expression evaluation will catch any type errros?
[14:24:07] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[14:24:10] <nmatsakis> pnkfelix: I think we should, yes.
[14:24:24] <nmatsakis> pnkfelix: I don't feel like it's the constant-evaluation-code's job to repeat the type checking
[14:25:03] *** Joins: erickt (etryzelaar@BF60BF52.64BC77A3.7FC6A66E.IP)
[14:25:18] <nmatsakis> pnkfelix: I'm just debating what's the most elegant way to get in and check those expressions -- we do check the values of constants like `static foo: int = 3`
[14:25:35] <pnkfelix> nmatsakis: it seemed to me like you and pcwalton *discussed* the need for interleaving const-eval and type-checking on PR 5112
[14:25:59] <nmatsakis> pnkfelix: yes, they can't be cleanly separated into two phases,
[14:26:29] <nmatsakis> pnkfelix: but I don't think that this means that the const_eval code has to type check the expressions it evaluates,
[14:26:36] <nmatsakis> pnkfelix: though admittedly these type checks are relatively simple
[14:26:44] *** Quits: erickt (etryzelaar@BF60BF52.64BC77A3.7FC6A66E.IP) (Ping timeout)
[14:27:06] <pnkfelix> nmatsakis: I haven't actually looked at the const-eval code yet.  I just read the comments on PR 5112
[14:27:09] <nmatsakis> pnkfelix: we've also not definitely settled what the set of legal constant expressions will be, which greatly affects this question about interleaving etc
[14:27:21] <nmatsakis> pnkfelix: today we support an expansive set including e.g. field projection
[14:27:33] <nmatsakis> pnkfelix: I am not so sure this is a good idea
[14:28:23] <nmatsakis> pnkfelix: certainly it makes our lives more complicated to do so
[14:29:15] <pnkfelix> nmatsakis: yeah, there are many question marks around const-expressions.
[14:29:56] <eddyb> the only certain thing is that we want CTFE :P
[14:31:35] <nmatsakis> pnkfelix: anyway, I feel like this discussion is getting a bit far afield from solving your immediate problem,
[14:31:55] <pnkfelix> nmatsakis: well, it may affect what tack I take in fixing it
[14:32:38] <nmatsakis> pnkfelix: yes I know, I am just debating if there's an expedient place to run the type checker right now -- but I guess we ought to try to figure out how this whole bit of code *should* work
[14:32:41] <pnkfelix> nmatsakis: e.g. I was considering doing this: #10108
[14:33:43] <pnkfelix> nmatsakis: (but #10108 is just a small step along the way towards a solution, not a solution in itself)
[14:34:16] <nmatsakis> pnkfelix: that seems like a good idea in any case 
[14:35:55] <nmatsakis> pnkfelix: I'm thinking a bit more on this matter of constants: right now, we separate type checking into two phases, collect/check -- collect generates types for all items, check then checks fn bodies
[14:36:13] <nmatsakis> pnkfelix: problem is that we sometimes need to evaluate constant expressions *during* collect
[14:36:31] <nmatsakis> pnkfelix: so the ordinary type-checking code cannot (yet) run, since it requires that collect has completed,
[14:36:50] <nmatsakis> pnkfelix: unless we can somehow know for certain that it will not touch the data structures that collect is generating,
[14:36:59] <nmatsakis> pnkfelix: which is where the discussion from #5112 comes in,
[14:37:10] <nmatsakis> pnkfelix: because things like sizeof::<T>() will for certain require the data that collect is producing,
[14:37:28] <nmatsakis> pnkfelix: and hence introduce a DAG requirement amongst top-level items,
[14:37:32] <pnkfelix> nmatsakis: right, so you need to do a topological sort
[14:37:36] <nmatsakis> pnkfelix: that we must dynamically detect and inforce
[14:37:46] <pnkfelix> nmatsakis: (either explicitly or implicitly)
[14:37:53] <nmatsakis> pnkfelix: of course there is already such a requirement in some cases, e.g. we report an error if you do:
[14:37:56] <nmatsakis> pnkfelix: type A = A
[14:39:20] <nmatsakis> pnkfelix: anyway long story short, I am reconsidering my statement that "constant evaluation should not repeat the type check rules" -- if the subset of expressions we accept is small enough, it may actually be more expedient to repeat the rules than try and make the general expr checking apparatus work when incomplete type information is available
[14:40:13] <pnkfelix> nmatsakis: hmm.  okay.
[14:41:50] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[14:41:50] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/ADTbFw
[14:41:50] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[14:42:19] <nmatsakis> pnkfelix: alternatively, there could be a "pre-pass" that checks that the constant obeys the proper subset and that there are no cycles introduced, and then invokes the general code, content in the knowledge that it shouldn't touch any data that is not yet ready
[14:42:21] <pnkfelix> nmatsakis: so, IIUC, the const_eval is duplicating the type-checking
[14:42:27] <pnkfelix> nmatsakis: (some of the type-checking)
[14:42:40] <pnkfelix> nmatsakis: but it is *not* actually buildlng up the same data-structures
[14:42:46] <nmatsakis> pnkfelix: you mean today?
[14:42:57] <pnkfelix> nmatsakis: (yes, I'm just trying to check my understanding of today)
[14:43:16] <pnkfelix> nmatsakis: and it does not write back the type info into the node_id-to-type map.  Sound right?
[14:43:37] <nmatsakis> pnkfelix: seems to be correct, I haven't dug into the code yet
[14:44:15] <pnkfelix> nmatsakis: I'm skimming over const_eval to try to get a feel for whether it would be feasible for it to write info back into the node_id-to-type map (if it were given the capability to update the map)
[14:44:27] <nmatsakis> pnkfelix: I lean towards the idea that, in terms of solving your immediate problem, the right fix might be to hack in something quick and dirty and leave a FIXME behind
[14:44:43] <nmatsakis> pnkfelix: another option of course --
[14:45:17] <pnkfelix> nmatsakis: yeah, I don't want to get to far afield from the immediate problem of attacking DST
[14:45:42] <nmatsakis> pnkfelix: -- one thing to be wary of, const_eval is I think used from other phases besides typeck
[14:46:10] <nmatsakis> pnkfelix: another option might to augment the check phase to insert types, and leave the "defense" duplicated logic in const_eval as well, but it's kind of yucky and awkward
[14:46:26] <pnkfelix> nmatsakis: right, that ties into your comment about parametrizing the const_eval over what phase it is operating in, on #3469
[14:46:37] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[14:46:37] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/ISa-_w
[14:46:37] <ghrust> 13rust/06auto 14436d874 15Huon Wilson: Make the documentation for std::task::spawn_sched render correctly....
[14:46:37] <ghrust> 13rust/06auto 1440be23c 15bors: auto merge of #10095 : huonw/rust/master, r=cmr...
[14:46:37] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[14:46:56] <pnkfelix> nmatsakis: "that ties into â€¦" was referring to your comment about what to be wary of
[14:47:55] <nmatsakis> pnkfelix: oh, I had forgotten about that comment, but I see I already had these thoughts, indeed :)
[14:51:45] <pnkfelix> nmatsakis: anyway, to answer your earlier question, I can review the lifetime patch
[14:52:07] <pnkfelix> nmatsakis: I don't see it up in the bors queue ...
[14:52:27] <nmatsakis> pnkfelix: it's not quite there yet, hopefully early this week
[14:52:32] <pnkfelix> nmatsakis: oh okay
[14:52:34] <nmatsakis> pnkfelix: still dotting i's and crossing t's
[14:52:58] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[15:05:43] *** Joins: erickt (etryzelaar@93E94B80.D1E9439C.98A37E8C.IP)
[15:10:15] <pnkfelix> nmatsakis: okay, it was pretty easy to put in a work-around hack.
[15:10:58] <Seldaek> quick thought.. how hard would it be to auto-wrap the file body in "fn main() {}" (minus imports ideally) if there is no fn main present? it'd be kinda neat for minimalistic code samples, and shell scripts perhaps
[15:11:34] <cmr> Seldaek: pretty easy, but I don't think that would be desirable.
[15:11:55] <cmr> I'd rather see a wrapper program that would execute it in the jit, so you could say like #! rustscript
[15:12:18] <pnkfelix> Seldaek: I wouldn't want that change unless (at least) it were guarded by a command line switch.  At which point we'd be talking about reviving `rust run` or something
[15:12:45] <Seldaek> hehe, yeah I just was reading http://picheta.me/articles/2013/10/about-nimrods-features.html and thought "damn, rust is pretty close" (search for unicode)
[15:13:03] <Seldaek> it's not a huge deal
[15:16:10] <olsonjeffery> flaper87: ping
[15:17:27] <nmatsakis> pnkfelix: is there an issue for "constant evaluation is broke and ill-defined?" -- you closed #3469, but it's not clear to me what covers the bigger issue
[15:17:54] <pnkfelix> nmatsakis: we have an isuse for it being ill-defined, in the sense that its totally undocumented ...
[15:18:24] <pnkfelix> #5551 is that.  Its become a meta-bug for const-expression issues, I think
[15:19:25] <pnkfelix> nmatsakis: you stated earlier in the conversation today that we support field-projection in const_eval, but a recent comment on #5551 seems to contradict that...
[15:20:22] <nmatsakis> pnkfelix: well, nobdy knows what we support anyhow, but I think we do suppoirt field-project inconsistently
[15:22:30] <nmatsakis> pnkfelix: but I could be wrong
[15:23:12] <pnkfelix> nmatsakis: its not clear to me.
[15:23:24] <pnkfelix> e.g. /tmp/f.rs:5:12: 5:24 error: expected constant expr for vector length: Unsupported constant expr
[15:23:24] <pnkfelix> /tmp/f.rs:5     let v : [int, ..A.x] = [5, 6, 7];
[15:24:47] <pnkfelix> nmatsakis: (but the *code* in const_eval makes it look like a ExprField(base, _, _) is classified according to self.classify(base), which makes it seem like field-project should just inherit whatever the base has ...)
[15:24:51] <nmatsakis> pnkfelix: try static: int = A.x
[15:25:03] <nmatsakis> pnkfelix: er, static x: int = A.x
[15:25:31] <nmatsakis> pnkfelix: also, what is `A` here? presumably some other static?
[15:25:42] <pnkfelix> nmatsakis: yeah, sorry, I was trying to keep things succinct
[15:25:49] <pnkfelix> nmatsakis: I'll switch to a gist, give me a sec
[15:26:55] <pnkfelix> nmatsakis: I think it still doesn't work, and I think the error message you get is terrible.
[15:27:03] <pnkfelix> nmatsakis: (give me a sec and I'll show you)
[15:27:47] <flaper87> olsonjeffery: pong
[15:28:34] <nmatsakis> pnkfelix: well we definitely support `*` I believe, at least in limited cases, and `a[0]`
[15:28:45] <nmatsakis> pnkfelix: and I think they are equally troublesome
[15:29:19] <pnkfelix> nmatsakis: https://gist.github.com/pnkfelix/7198893
[15:29:45] <pnkfelix> nmatsakis: that is a terrible error message.
[15:30:15] <olsonjeffery> flaper87: did you see that acrichto landed a bunch of work on Timer?
[15:30:29] <olsonjeffery> not sure if he knew you were working on it, but i believe this moots your PR
[15:30:46] <olsonjeffery> not sure if he did the work to actually make timer selectable, though
[15:30:54] <nmatsakis> pnkfelix: https://gist.github.com/pnkfelix/7198893#comment-938854
[15:30:56] <olsonjeffery> but if not, it would make a subsequent PR to add that really easy
[15:31:39] <flaper87> olsonjeffery: mmh, no I didn't see those patches, I've been a bit away the last few weeks but I'll be back soon. 
[15:31:46] <pnkfelix> nmatsakis: stupid question: are the right hand sides of statics restricted to const expressions ?
[15:32:09] <nmatsakis> pnkfelix: yes
[15:32:16] <nmatsakis> pnkfelix: the reason that one works and the other doesn't,
[15:32:19] <flaper87> olsonjeffery: given the fact that I spent a lot of time on that thing, I'd love to implement the whole thing myself but if he did then I'm happy anyway :D
[15:32:28] <nmatsakis> pnkfelix: is that in the case of the RHS used in that way,
[15:32:30] <olsonjeffery> flaper87: you could talk to acrichto, when he turns up, to get up to speed on where its at
[15:32:31] <flaper87> I'll have to take a look at what he did
[15:32:33] <olsonjeffery> im sure there's some work to do
[15:32:37] <nmatsakis> pnkfelix: it only gets type-checked after collect is done etc,
[15:32:39] <nmatsakis> pnkfelix: I think,
[15:32:45] <flaper87> olsonjeffery: cool, thanks a lot for the heads up!
[15:32:48] <olsonjeffery> as far as mozilla emps go, he's most active in the runtime
[15:32:49] <nmatsakis> pnkfelix: but in the case you were using, it gets type-checked via some slightly different path,
[15:32:52] <pnkfelix> nmatsakis: (I was briefly wondering if static init blocks had sneaked in via epxressions on rhs of statics.)  Okay.
[15:32:53] <olsonjeffery> so if anything, you could get some work from him
[15:32:53] <nmatsakis> pnkfelix: basically it's incoherent
[15:34:19] *** Quits: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk) (Ping timeout)
[15:35:14] <pnkfelix> nmatsakis: I'll file an issue for this
[15:36:17] <nmatsakis> pnkfelix: ok
[15:36:34] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[15:36:34] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1440be23c to 14bee40a9: 02http://git.io/N3iJvQ
[15:36:34] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[15:36:41] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[15:36:41] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Wd5Q-Q
[15:36:41] <ghrust> 13rust/06auto 141e4986c 15Daniel Micay: make the bottom type immediate...
[15:36:41] <ghrust> 13rust/06auto 14560d999 15bors: auto merge of #10107 : thestinger/rust/immediate, r=huonw
[15:36:42] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[15:45:12] *** lbergstrom|away is now known as lbergstrom
[15:49:25] *** Joins: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk)
[16:01:07] *** Quits: jyyou (jyyou@moz-47B052FA.cs.nctu.edu.tw) (Ping timeout)
[16:03:51] *** Quits: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk) (Ping timeout)
[16:04:16] *** Joins: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk)
[16:05:09] *** Joins: ash_136 (ashvini@4DDE72E5.F9E46DD1.E5F05D4F.IP)
[16:12:11] *** Joins: steveklabnik (steveklabn@moz-5EF6C37C.socal.res.rr.com)
[16:14:59] *** Quits: erickt (etryzelaar@93E94B80.D1E9439C.98A37E8C.IP) (Ping timeout)
[16:25:25] *** kimundi is now known as zz_kimundi
[16:31:22] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[16:31:51] *** Quits: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk) (Ping timeout)
[16:32:07] *** Joins: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk)
[16:32:49] <jld> pnkfelix,nmatsakis: It seems to me the problem there is that static initializers *aren't* restricted to constant expressions in the sense of const_expr.
[16:33:34] <pnkfelix> jld: okay, so now I don't feel so bad for asking my stupid question.
[16:34:03] <jld> pnkfelix: const_eval, I mean.
[16:35:13] <jld> pnkfelix: const_eval was added on because the regular const (as in `static`) stuff is handled in trans, so couldn't be used for things like array lengths.
[16:35:31] <pnkfelix> jld: I haven't looked at it carefully, but it seemed to me like the semantics of eval_const_expr  does not match what I'd expect from ConstEvalVisitor::classify
[16:35:42] <jld> pnkfelix: And it has some type-related weirdnesses, like how casts sort of don't do anything.  (Except when they do.  I don't entirely understand it.)
[16:36:04] <pnkfelix> jld: So we effectively have two different classes of const expressions, currently ?
[16:36:11] <jld> pnkfelix: Yes.
[16:36:26] <pnkfelix> jld: One that is translated by trans, and another evaluated by eval_const_expr.  Okay.
[16:37:16] <jld> pnkfelix: And *both* of those are (mostly) separate from translation of runtime expressions.
[16:37:39] <kaeso> klutzy: I was looking at llvm, and I noticed that the code touched by the first hunk of this was removed as dead now https://github.com/alexcrichton/llvm/commit/c9ffab392a39eb85f2f15ffc8d41e8c4f4397b8e
[16:38:05] <kaeso> klutzy: can you please expand the commit log and try to send the second hunk to llvm upstream?
[16:43:23] <klutzy> kaeso: I'm goning to sleep now, but I'll try to look and send it tomorrow :)
[16:44:07] <kaeso> klutzy: thanks, I think it's small enough not to need a test-case
[16:45:13] <kaeso> klutzy: the other one you have in the queue too maybe, but I was still looking it that feature is tested anywhere in the test-suite for the other arches
[16:45:24] <kaeso> *if that
[16:46:28] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[16:46:28] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Wd5Q-Q
[16:46:28] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[16:51:33] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[16:51:33] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/QgYkKQ
[16:51:33] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[16:51:34] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[16:51:34] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Yc1HUg
[16:51:34] <ghrust> 13rust/06auto 14a239c0e 15Joshua Yanovski: Make addl_lib_search_paths a HashSet (Closes #7718).
[16:51:34] <ghrust> 13rust/06auto 140a9a706 15bors: auto merge of #10089 : pythonesque/rust/issue-7718, r=catamorphism...
[16:51:34] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[16:53:33] *** Quits: Kxepal (Miranda@moz-2EF7C242.pppoe.mtu-net.ru) (Ping timeout)
[16:55:43] <nmatsakis> jld: yes, I see, because we want to allow you to take addr of static things or something? in general, it's not clear to me that we *need* two categories of const exprs
[16:57:10] <pnkfelix> nmatsakis: are you also asserting we should not need two distinct code paths?  Or are you merely stating that the two code paths should operate on the same subset of the language?
[16:57:34] *** Joins: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[16:57:34] *** ChanServ sets mode: +ao pcwalton pcwalton
[16:57:35] <pnkfelix> nmatsakis: (my intuition is that we'll always need distinct handling in trans versus const_eval.rs)
[16:59:02] *** Joins: jyyou (jyyou@moz-47B052FA.cs.nctu.edu.tw)
[17:00:16] <nmatsakis> pnkfelix: I don't think so
[17:00:24] <nmatsakis> pnkfelix: I think i'm saying both
[17:00:46] <nmatsakis> pnkfelix: I think we should be able to evaluate constants into a value, and the output of this might be a symbolic thing like "addr(tihs_other_constant)" -- and then we can trans that
[17:01:10] <pnkfelix> nmatsakis: oh I see.  Okay, if our value domain is sufficient expressive, then I guess that should work.
[17:01:11] <nmatsakis> pnkfelix: this is more-or-less what trans does, but it represents those values as LLVM values and then various side-tables adding extra info where the LLVM vlaues are inadequate
[17:01:23] <nmatsakis> pnkfelix: which then of course renders that code useless to earlier phases
[17:01:32] *** zz_kimundi is now known as kimundi
[17:01:39] <nmatsakis> pnkfelix: but I could be wrong, maybe they have to be different
[17:01:56] <pnkfelix> nmatsakis: while I have your attention
[17:02:22] <pnkfelix> nmatsakis: I am looking over at how  the set of BuiltinBounds is handled
[17:02:57] <pnkfelix> nmatsakis: because I'm trying to figure out why my adding `trait FromPrimitive : Sized { â€¦ }` to num.rs did not do what I expected
[17:03:52] <pnkfelix> nmatsakis: because methods that return Self within FromPrimitive did not seem to be tagged as having the Sized bound
[17:03:54] <jld> Or, looked at another way: right now we have two interpreters for subsets of rust, and we'd like to have one.
[17:04:05] <SimonSapin> I keep getting this error when building Rust in a fresh Servo clone on OS X: i686-apple-darwin11-llvm-g++-4.2: x86_64-apple-darwin/rt/libuv/libuv.a: No such file or directory
[17:04:16] <jld> One of those interpreters uses LLVM for its value representation (and the other can't), but that's not actually necessary to implement the semantics.
[17:04:23] <SimonSapin> Does it look anything like a known bug?
[17:04:42] <pnkfelix> nmatsakis: so, the question: We *do* try to eagerly copy over the BuiltinBounds for each type parameter into a record directly associated with that type parameter, right?
[17:05:01] *** jack is now known as jack|lunch
[17:05:15] <pnkfelix> nmatsakis: (i'm trying to determine where such a copy happens so that I can figure out why my addition of Sized is not ending up thereâ€¦)
[17:05:41] <pnkfelix> SimonSapin: I've seen things like that in the past
[17:05:52] <pnkfelix>  SimonSapin: but it was usually either a Makefile bug
[17:06:10] <pnkfelix> SimonSapin: or a problem with my checkout (e.g. an unclean build dir)
[17:06:13] <nmatsakis> pnkfelix: it works as follows -- in typeck/collect, there is a function callect ty_generics() that converts from an ast::Generics into a ty::Generics,
[17:06:32] <nmatsakis> pnkfelix: and as part of that it generates as TypeParameterDef for each type parameter,
[17:06:38] <nmatsakis> pnkfelix: contained in that should be a list of the bounds,
[17:07:01] <nmatsakis> pnkfelix: you can run wtih RUST_LOG=rustc::middle::typeck::collect and grep for "def for param"
[17:07:05] <nmatsakis> pnkfelix: to see the output
[17:07:41] <nmatsakis> pnkfelix: then later the TypeContents code in ty.rs looks up this TypeParameterDef to figure things out
[17:08:24] <SimonSapin> pnkfelix: I doubt itâ€™s an unclean build dir as I started from a fresh clone
[17:08:40] <SimonSapin> I nuked my build dir just in case, re-building LLVM now
[17:09:02] <pnkfelix> SimonSapin: yeah, sorry, I meant to state more clearly that my experience may not apply to you
[17:09:42] <pnkfelix> SimonSapin: did you upgrade your Xcode or anything recently?
[17:10:13] <pnkfelix> SimonSapin: (I'm racking my brain trying to remember if I've ever seen this in response to out-of-date command-line utilities installation, etc)
[17:10:19] <SimonSapin> pnkfelix: No. But Iâ€™m primarily on Linux, this is a loaner Macbook that I used once a month or so ago
[17:10:51] <SimonSapin> the submodules were is a broken state when I pulled, so I started with a fresh clone
[17:11:12] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[17:14:16] *** cmr is now known as Blaziken
[17:15:05] *** Blaziken is now known as cmr
[17:24:23] *** flaper87 is now known as flaper87|afk
[17:30:09] <pnkfelix> nmatsakis: in the `def for param` output
[17:30:29] *** Quits: jyyou (jyyou@moz-47B052FA.cs.nctu.edu.tw) (Ping timeout)
[17:30:35] <pnkfelix> nmatsakis: what are the DefId.node values?  They do not seem to correspond to node ids in the --pretty identified output.
[17:32:33] <nmatsakis> pnkfelix: that's because --pretty identified doens't print most of the ids
[17:32:40] <nmatsakis> pnkfelix: e.g., it doesn't print the node ids for type parameter definitions
[17:32:53] <nmatsakis> pnkfelix: (which is what the defids are in this case)
[17:33:07] <pnkfelix> nmatsakis: what do you do to get those then?
[17:34:51] <pnkfelix> nmatsakis: (don't worry about spending too much time on this, I can add my own instrumentation; I just figured if the info was already ready-to-go ...)
[17:35:17] *** Joins: erickt (etryzelaar@BF60BF52.64BC77A3.7FC6A66E.IP)
[17:35:50] <nmatsakis> pnkfelix: there is no existing sol'n, what I do is typically to guess based on the output from --pretty expanded-identified
[17:36:02] <nmatsakis> pnkfelix: that is, I look for a nearby #, and since I know they get assigned in sequential order,
[17:36:15] <nmatsakis> pnkfelix: I can figure it out readily enough usually -- but I'm almost always going from ID to source code,
[17:36:24] <nmatsakis> pnkfelix: so I've never really had to go in the opposite direction? 
[17:36:26] <pnkfelix> nmatsakis: ( I *was* looking at --pretty expanded,identified , sorry, I didn't say that earlier...)
[17:36:42] <pnkfelix> nmatsakis: okay, I'll poke at it myself.
[17:36:43] <nmatsakis> pnkfelix: it's a bit annoying to be honest, I've just never been motivated to improve it
[17:36:56] <pnkfelix> nmatsakis: the important thing is, *all* of the id's are globally unique, right?
[17:37:47] <nmatsakis> pnkfelix: yes.
[17:37:53] <pnkfelix> nmatsakis: (I just don't want to misinterpret the number of DefId.node as something it is notâ€¦)  Okay thanks.
[17:39:02] <nmatsakis> pnkfelix: globally unique w/in a crate, I should say
[17:39:20] <pnkfelix> nmatsakis: sure, okay.  So not *globally*
[17:40:25] * eddyb puts bulletproof vest on
[17:40:28] <eddyb> https://github.com/mozilla/rust/issues/10124
[17:42:04] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[17:45:14] <eddyb> nmatsakis: you wrote "Fn Types in Rust, Take 3", right? could you take a look at my proposal for variadic generics (and the Fn trait example)?
[17:48:35] <nmatsakis> eddyb: I skimmed it, but I have to give it more thought -- my general feeling is "not for v1.0" -- i.e., I want something like this, but not NOW. I like the idea of unifying with tuples though
[17:48:57] <nmatsakis> eddyb: it alone doesn't allow you to replace fns with traits
[17:49:25] <nmatsakis> eddyb: you also need to address the issue of lifetime binders
[17:49:37] <nmatsakis> eddyb: which I may or may not have gone into detail about in that blog post, can't recall :)
[17:50:20] <eddyb> lifetimes make things more complicated, and I understand that it may not get into 1.0
[17:50:57] <eddyb> but I had the idea of building on top of tuples and extending them, and felt the need to write it down
[17:51:40] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[17:51:40] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Yc1HUg
[17:51:40] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[17:51:48] <SimonSapin> "Error: No Xcode is selected."
[17:51:58] <eddyb> you can feel the natural language barrier, but I hope I'll get to polish this before it's seriously considered for implementation
[17:52:50] <nmatsakis> eddyb: I thnk the core idea is a good one, yes, and as I said using tuples seems nice
[17:53:49] <eddyb> thanks, at least I'm paving the way :)
[17:55:37] <SimonSapin> pnkfelix: after nuking the build directory and building LLVM on one core, Iâ€™m getting the same error again
[17:55:43] <SimonSapin> i686-apple-darwin11-llvm-g++-4.2: x86_64-apple-darwin/rt/libuv/libuv.a: No such file or directory
[17:55:46] <SimonSapin> i686-apple-darwin11-llvm-g++-4.2: x86_64-apple-darwin/rt/libuv/libuv.a: No such file or directory
[17:55:48] <SimonSapin> i686-apple-darwin11-llvm-g++-4.2: x86_64-apple-darwin/rt/libuv/libuv.a: No such file or directory
[17:55:49] <SimonSapin> i686-apple-darwin11-llvm-g++-4.2: x86_64-apple-darwin/rt/libuv/libuv.a: No such file or directory
[17:55:52] <SimonSapin> i686-apple-darwin11-llvm-g++-4.2: x86_64-apple-darwin/rt/libuv/libuv.a: No such file or directory
[17:55:54] <SimonSapin> i686-apple-darwin11-llvm-g++-4.2: x86_64-apple-darwin/rt/libuv/libuv.a: No such file or directory
[17:55:55] <pnkfelix> SimonSapin: uh oh
[17:56:06] <SimonSapin> sorry, about the duplicate
[17:56:11] <pnkfelix> SimonSapin: (sorry, wasn't sure if that was going to stop)
[17:56:36] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[17:56:37] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/B6wIUg
[17:56:37] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[17:56:38] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[17:56:38] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/2wbR3g
[17:56:38] <ghrust> 13rust/06auto 1472557d8 15Alex Crichton: Remove the extension traits for Readers/Writers...
[17:56:38] <ghrust> 13rust/06auto 14e6102fc 15bors: auto merge of #10079 : alexcrichton/rust/no-reader-util, r=brson...
[17:56:39] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[17:56:45] <pnkfelix> SimonSapin: so, is libuv.a actually not being built then?
[17:57:10] <pnkfelix> SimonSapin: if you call `make` a second time in the build dir, does it stop with the same error?
[17:57:22] <SimonSapin> yes
[17:57:33] <SimonSapin> yes, second 'make' gives the same error
[17:57:56] <SimonSapin> x86_64-apple-darwin/src/compiler/rust/x86_64-apple-darwin/rt/libuv/ apparently only contains src and makefiles
[17:58:25] <pnkfelix> SimonSapin: hmm.  Can you build a checkout of rust itself?
[17:59:02] <pnkfelix> SimonSapin: (i.e. I'm trying to understand if I'll need to do a checkout of servo to replicate your issue, or if it also occurs on a standalone rust checkout)
[17:59:06] *** Quits: erickt (etryzelaar@BF60BF52.64BC77A3.7FC6A66E.IP) (Ping timeout)
[17:59:30] <pnkfelix> nmatsakis: ping
[17:59:34] <nmatsakis> pnkfelix: pong
[17:59:40] <pnkfelix> nmatsakis: just wanted to double-check
[18:00:28] <pnkfelix> nmatsakis: the intuition i mentioned earlier, that the BuiltinBounds should be eagerly copied into the ParamBounds (rather than, I dunno, re-doing the lookup on the parent hierarchy each time)
[18:01:05] <pnkfelix> nmatsakis: that *is* what should be happening, right?  (The debug output from `def for param`, AFAICT, indicates that the BuiltinBounds are not being populated correctly)
[18:01:10] <nmatsakis> pnkfelix: I'm not sure what you mean by eagerly
[18:01:21] <SimonSapin> pnkfelix: on the same commit?
[18:01:37] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[18:01:40] <nmatsakis> pnkfelix: but I tihnk the answer is "yes"
[18:01:51] *** Joins: jyyou (jyyou@moz-47B052FA.cs.nctu.edu.tw)
[18:01:54] <nmatsakis> pnkfelix: basically typeck should be computing this information and storing it, and later phases should be looking it up
[18:01:58] <pnkfelix> nmatsakis: I have a type parameter, fn foo<N: FromPrimitive>() -> N, or something
[18:02:02] <strcat> pcwalton: http://llvm-reviews.chandlerc.com/D2034 I think you'll find this funny
[18:02:09] <pnkfelix> nmatsakis: where `trait FromPrimitive : Sized { â€¦ }`
[18:02:15] <strcat> pcwalton: clang always outputs 64-bit expect instructions so the i1 version didn't work >.<
[18:02:33] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:02:33] <strcat> I was wondering why it wasn't working
[18:02:33] *** ChanServ sets mode: +qo brson brson
[18:02:44] <pnkfelix> nmatsakis: and the collect pass on `fn foo<N : FromPrimitive>()`
[18:03:06] <pnkfelix> nmatsakis: should put `Sized` into the builtin_bounds for N.  That's all I mean by "eagerly"
[18:03:17] <pnkfelix> SimonSapin: sure
[18:03:28] <pnkfelix> SimonSapin: yeah, might as well choose the same commit point for rust.git
[18:03:37] <strcat> and we can't easily use the cold attribute because they commented it out :(
[18:03:47] <strcat> in the C API
[18:03:55] *** Quits: steveklabnik (steveklabn@moz-5EF6C37C.socal.res.rr.com) (Ping timeout)
[18:04:09] <SimonSapin> pnkfelix: FWIW, Iâ€™m on Rust i686-apple-darwin11-llvm-g++-4.2: x86_64-apple-darwin/rt/libuv/libuv.a: No such file or directory
[18:04:12] <pnkfelix> SimonSapin: (and then if you find you cannot build rust on its own, then I'd say try on the head as well, just to double check that it isn't a problem that has been fixed in the mean timeâ€¦)
[18:04:13] <SimonSapin> erf
[18:04:17] *** Quits: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[18:04:17] <SimonSapin> rust 3f240fedecf84f9bb614c52f5cc1335057008749
[18:04:33] <pnkfelix> SimonSapin: Okay, I'm probably not likely to investigate for a little bit
[18:04:48] <strcat> http://llvm.org/docs/doxygen/html/Core_8h_source.html#l00164 *sigh*
[18:04:50] <pnkfelix> SimonSapin: so if you can gather more info in the meantime, I'd appreciate it.
[18:05:10] <nmatsakis> pnkfelix: I believe so, yes -- though it occurs to me that there is some phase ordering there, I wonder if the current code doesn't account for it properly
[18:05:11] <pnkfelix> SimonSapin: well, actually, I guess it doesn't hurt me to make a clone at that revision and see if I can build it.
[18:05:11] <SimonSapin> trying a stand-alone build now
[18:05:39] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[18:05:53] <strcat> they can't be a 33rd flag in their enum because the ABI mandates it can't get bigger :(
[18:06:26] <eddyb> strcat: can't wait until libclang is used by rustc to interface with C++ code :D
[18:06:32] <nmatsakis> pnkfelix: oh, wait --
[18:06:35] <nmatsakis> pnkfelix: I think I am misleading you
[18:06:53] <strcat> we would likely need real multiple inheritance to map the C++ API to rust...
[18:07:11] <SimonSapin> building on a remote machine is actually nice. I can let it work while I go home :)
[18:07:12] <nmatsakis> pnkfelix: re-reading the code, it looks like TypeContents is responsible for checking for "indirect" builtin bounds
[18:07:37] <nmatsakis> pnkfelix: via the each_inherited_builtin_bound() function
[18:07:47] <eddyb> strcat: can't C++ classed be mapped as opaque (pointers)?
[18:08:06] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[18:08:07] *** ChanServ sets mode: +o tjc
[18:08:08] <strcat> eddyb: the LLVM API type safely is mostly done through inheritance
[18:08:10] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[18:08:10] *** ChanServ sets mode: +ao pcwalton pcwalton
[18:08:14] <nmatsakis> pnkfelix: which of course eliminaes this phase dependency I was talking about
[18:08:17] <SimonSapin> nmatsakis: new error: /usr/bin/ranlib: file: lib/libjemalloc.a(mb.o) has no symbols
[18:08:33] *** Joins: erickt (etryzelaar@BF60BF52.64BC77A3.7FC6A66E.IP)
[18:08:39] <pcwalton> strcat: I saw that
[18:08:57] <pcwalton> strcat: do you know what the ETA on the review is?
[18:09:06] <strcat> pcwalton: nope
[18:09:13] <nmatsakis> SimonSapin: did you mean to address that to me? 
[18:09:26] <SimonSapin> sorry, that was for pnkfelix 
[18:09:30] <strcat> pcwalton: we could start outputting them like clang but it means doing zext -> expect -> icmp which is silly
[18:09:33] <eddyb> strcat: what I mean... you have a llvm::Foobar pointer, you can then use libclang to emit ll to call a method on it, even if it's a templated inline whatever, it should still work :/
[18:09:34] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[18:09:48] <pcwalton> strcat: can we at least merge the change into our branch?
[18:09:59] <strcat> pcwalton: I guess we could
[18:10:31] <strcat> for @mut borrow checks I think a #[cold] attribute on functions will work
[18:13:08] <pnkfelix> nmatsakis: so, â€¦ what can I conclude about the output from `def for param` ?  What can I conclude about how eagerly the bulitin_bounds set is computed?
[18:13:09] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[18:13:46] <nmatsakis> pnkfelix: you can conclude that def for param should list precisely the supertraits/bounds the user wrote,
[18:13:56] <nmatsakis> pnkfelix: and that the TypedContents code should be iterating over those recursively,
[18:14:02] <nmatsakis> pnkfelix: to yield the final set of bounds,
[18:14:06] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Ping timeout)
[18:14:28] <nmatsakis> pnkfelix: see kind_bounds_to_contents() and each_inherited_builtin_bound()
[18:14:37] <nmatsakis> pnkfelix: there are some debugging printouts there too
[18:14:44] <nmatsakis> pnkfelix: those fns are in middle/ty.rs
[18:15:17] <nmatsakis> anybody seen errors like "multiple matching crates for `static_priv_by_default`'" lately?
[18:15:23] <nmatsakis> running compile-fail
[18:15:26] <nmatsakis> or are those my fault :)
[18:16:11] <pnkfelix> nmatsakis: okay.  I assume this TypedContents computation of the final set of bounds should be being run to completion before we go into kind::check_expr
[18:16:32] <pnkfelix> nmatsakis: so I'm still mystified as to what is happening, but at least I know that `def for param` is not the correct thing for me to be looking at.
[18:16:58] <nmatsakis> pnkfelix: the TypedContents computation is invoked lazilly upon request
[18:17:34] <nmatsakis> pnkfelix: kind.rs calls ty::type_contents()
[18:18:13] <pnkfelix> nmatsakis: hmm.  Okay, so the code *I'm* writing is wrong I guess.
[18:19:34] <nmatsakis> pnkfelix: it happens to the best of us ;)
[18:20:04] <pnkfelix> nmatsakis: I was trying to do `ty::type_is_sized(tcx, ty::expr(tcx, expr))`, but from what you are saying, the result of `ty::expr(tcx, expr)` will not necessarily yield a record with all of the relevant info populated into it.
[18:20:50] <nmatsakis> pnkfelix: ty::Type_is_Sized should be ok
[18:20:57] <nmatsakis> pnkfelix: that is just a wrapper around ty::type_contents
[18:21:12] <nmatsakis> pnkfelix: oh, wait
[18:21:26] <nmatsakis> pnkfelix: I don't know what's up with that fn
[18:21:28] <pnkfelix> nmatsakis: woo, I was about to check if I was popping my crazy pills.
[18:21:48] <nmatsakis> pnkfelix: that function is broke
[18:21:52] <pnkfelix> nmatsakis: (because of all the code in ty.rs, that's the *one* function I've looked at the most)
[18:22:04] <nmatsakis> pnkfelix: it probably should look more like ty::type_needs_drop
[18:22:20] <nmatsakis> pnkfelix: or type_is_sendable
[18:22:21] <nmatsakis> pnkfelix: etc
[18:22:33] <pnkfelix> nmatsakis: okay.  Good find.
[18:22:39] <nmatsakis> pnkfelix: it doesn't appear to be called
[18:22:53] <pnkfelix> nmatsakis: no, I think that's why its been able to be this broken.
[18:22:57] *** Joins: steveklabnik (steveklabn@moz-679CA643.public.wayport.net)
[18:23:03] <nmatsakis> pnkfelix: yep
[18:35:37] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[18:41:24] <pnkfelix> nmatsakis: for `match *x { â€¦ }`, is it reasonable/correct to require that `*x` be a sized type?  It matches my own intuition, but I wanted to double check.
[18:42:24] <nmatsakis> pnkfelix: I think we decided that it was not necessarily reasonable?
[18:42:45] <nmatsakis> pnkfelix: e.g. "match *x { ref y => "
[18:42:50] <pnkfelix> nmatsakis: (I was just now thinking that maybe one might encounter patterns like `[ref x, ref y, ..ref rest]` or something, where you would not compile-down into code that needs the sizes.)
[18:43:18] <nmatsakis> pnkfelix: also that
[18:43:26] <pnkfelix> nmatsakis: okay, then I must have forgotten that detail.  But yes, these are the kinds of things I was thinking of.
[18:43:31] <brson> acrichto: how's the stability of the runtime today?
[18:43:39] <pnkfelix> nmatsakis: but you're right, we specifically mentioned refutable pattern bindings
[18:43:57] <acrichto> brson: it's looking pretty good, although there's still random segfaults on linux and possible deadlock on win32-nopt that I haven't been able to reproduce
[18:44:16] <acrichto> brson: the segfaults have been happening for awhile, but I think they're becoming more frequent now that we're actually using the runtime everywhere
[18:46:35] <acrichto> brson: only had 1 bounce in the last 10 pulls
[18:47:30] <brson> acrichto: well at least it's not impacting us too much now. thanks for investigating. the random segfaults are scary though
[18:47:48] <acrichto> brson: yeah I've been trying to reproduce, but I haven't even been able to get it to segfault locally
[18:49:26] <brson> no twir this weekend? i feel so lost
[18:49:35] <SimonSapin> pnkfelix: I could reproduce "libuv.a: No such file or directory" on a stand-alone clone of Rust
[18:49:43] <SimonSapin> on 3f240fedecf84f9bb614c52f5cc1335057008749
[18:50:02] <SimonSapin> trying master now
[18:50:02] <pnkfelix> SimonSapin: my build at that commit completed successfully
[18:50:05] <pnkfelix> SimonSapin: so hold on a sec
[18:50:33] <brson> acrichto: ooh, our lock-free queues landed! that in itself is pretty frightening
[18:50:36] <brson> i hope they are correct
[18:50:42] <pnkfelix> SimonSapin: at this point, I'm pretty sure that your problem is probably something in your host environment
[18:50:43] <acrichto> brson: nice!
[18:50:48] <brson> only one more datastructure needs to be rewritten
[18:51:10] <pnkfelix> SimonSapin: shall we move to private message?
[18:51:19] <acrichto> SimonSapin: you may be interested in https://github.com/mozilla/rust/issues/9974#issuecomment-26734071
[18:51:24] <acrichto> brson: which one is that?
[18:51:26] <SimonSapin> pnkfelix: the same environment built servo successfully a month ago
[18:51:36] <pnkfelix> SimonSapin: (actuallyâ€¦ I need to leave soon, so maybe lets stay on the channel so that someone else can take over for me...)
[18:51:37] *** Quits: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk) (Ping timeout)
[18:51:57] *** Joins: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk)
[18:52:20] <pnkfelix> acrichto: $target is the build directory, right?  SimonSapin has been telling me that he's starting with a fresh clone, an empty build dir.
[18:52:38] <acrichto> pnkfelix: it has to do with xcode not being installed correctly (not sure if that's relevant)
[18:52:47] <SimonSapin> reproduced on master as well
[18:52:47] <brson> acrichto: the work-stealing dequeue (the most important one ...)
[18:52:50] <pnkfelix> acrichto: i suspect that is the case here, yes
[18:53:02] <acrichto> brson: ah yes!
[18:53:10] <brson> then the entire runtime will be lock free and we'll have awesome bragging rights
[18:53:10] <pnkfelix> acrichto: but, the ticket you linked didn't say anything about Xcode, no?
[18:53:31] <brson> except for the random crashes...
[18:53:38] <acrichto> pnkfelix: that's how to fix it and/or detect that there's an xcode error
[18:53:48] <acrichto> pnkfelix: those specific commands will show you the output of the gyp program
[18:53:52] <acrichto> brson: soon though, soon!
[18:53:54] <pnkfelix> acrichto: oh I see
[18:54:00] <pnkfelix> SimonSapin: listen to acrichto
[18:54:03] *** Quits: erickt (etryzelaar@BF60BF52.64BC77A3.7FC6A66E.IP) (Ping timeout)
[18:54:26] <acrichto> brson: I'm working on polishing off rt::io::file right now
[18:54:50] <acrichto> turns out we're missing a fair bit of "fluff" functionality
[18:55:01] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[18:55:01] <SimonSapin> I donâ€™t have a full XCode, only the command line tools
[18:55:09] <acrichto> SimonSapin: I think that's the problem
[18:55:33] <acrichto> SimonSapin: I forget what the exact error is, but those commands will show you the output of the gyp program and why it's complaining
[18:56:02] *** Joins: geoffhill (geoffhill@moz-244CF33A.amazon.com)
[18:56:43] <acrichto> brson: I find myself dealing with setting file permissions right now, was there an idea of what direction that would evolve into?
[18:57:04] <SimonSapin> acrichto: so, is full XCode a dependency?
[18:57:13] <acrichto> SimonSapin: of gyp possibly (I forget the error)
[18:57:41] <SimonSapin> " Can't run /Library/Developer/usr/bin/xcodebuild (no such file)."
[18:57:44] <SimonSapin> ok
[18:57:55] <SimonSapin> how recent is it that Rust uses gyp?
[18:58:05] <pnkfelix> SimonSapin: libuv uses it
[18:58:12] <brson> acrichto: I haven't thought about it, no. Pick some other language that does it crossplatform well and copy, as usual
[18:58:47] <brson> 381 people in #rust today
[18:59:19] *** Joins: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[18:59:20] *** ChanServ sets mode: +ao pcwalton pcwalton
[18:59:25] <strcat> do function attributes work cross-crate by default?
[19:00:02] *** Quits: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk) (Ping timeout)
[19:00:10] <SimonSapin> Ok, I think I didnâ€™t need full XCode, but I needed to run "sudo xcode-select -switch /"
[19:00:43] *** Joins: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk)
[19:01:31] <strcat> ah there's so much broken stuff
[19:01:40] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[19:01:40] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/2wbR3g
[19:01:40] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[19:01:47] <strcat> contains_name only works within a crate...
[19:01:58] <strcat> and... everything uses it
[19:02:26] <SimonSapin> thanks pnkfelix, acrichto 
[19:02:40] <acrichto> SimonSapin: no problem! I wish libuv wouldn't use gyp as well :(
[19:02:52] <acrichto> although we could also "fix" the problem by using the system gyp, I think that we're compatible with it
[19:02:59] <acrichto> above a certain fersion
[19:03:00] <acrichto> version*
[19:03:22] *** jack|lunch is now known as jack
[19:04:41] <brson> acrichto: is std::io gone?!
[19:04:44] <acrichto> brson: yes :)
[19:04:50] <brson> damn
[19:04:56] <acrichto> I didn't like it
[19:05:06] <strcat> brson: hm?
[19:05:13] <brson> acrichto: nice work!
[19:05:31] <brson> acrichto: so what do you have in mind for the next steps?
[19:05:53] <acrichto> brson: moving uv to its own create, then start going through the I/O modules one-by-one and polish them off to the point where they should be done
[19:06:08] <pnkfelix> acrichto: BTW I'd like to see support for getting stack backtraces back again.  I didn't even know that we *had* had it on our allocations earlier.
[19:06:14] *** Quits: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk) (Ping timeout)
[19:06:21] <acrichto> pnkfelix: for managed boxes?
[19:06:24] *** Quits: steveklabnik (steveklabn@moz-679CA643.public.wayport.net) (Ping timeout)
[19:06:26] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[19:06:26] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/sz3lFA
[19:06:26] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[19:06:31] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[19:06:31] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/AF6v5Q
[19:06:31] <ghrust> 13rust/06auto 14436d874 15Huon Wilson: Make the documentation for std::task::spawn_sched render correctly....
[19:06:31] <ghrust> 13rust/06auto 142ab4a6f 15bors: auto merge of #10095 : huonw/rust/master, r=cmr...
[19:06:31] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[19:06:32] <pnkfelix> acrichto: well, I'd like to have an API for it in general.
[19:06:37] <pnkfelix> acrichto: (and then one client would be managed boxes)
[19:06:51] <acrichto> pnkfelix: I don't think we can do it in the general case
[19:07:03] <acrichto> pnkfelix: I think windows/osx have native os ability to do this, but I think linux needs libunwind
[19:07:06] <brson> acrichto: there's a few things I want for io: 1) that it should again live under std::io (std::rt is just impl details), 2) that we unify the non-blocking/blocking implementations under the same interface
[19:07:09] <acrichto> so we'd have to pull that in as a dependency
[19:07:10] <pnkfelix> acrichto: I'm just talking about something to make development nicer
[19:07:31] <acrichto> brson: ah yes, that's what you meant! I actually wanted to ask you about that
[19:07:37] <acrichto> pnkfelix: I would love backtraces too though :)
[19:07:49] <acrichto> brson: so is the general idea that std::rt::io becomes std::io
[19:07:56] <pnkfelix> acrichto: does glibc not have the backtrace() function?  I was hoping to layer something simple on top of that.
[19:07:56] <acrichto> brson: b/c std::io::net::tcp is still pretty painful
[19:08:06] <brson> strcat: i just mean, like 'dayumm', acrichto is the man
[19:08:12] <acrichto> pnkfelix: oh maybe it does, we could just use that in that case
[19:08:14] <pnkfelix> acrichto: e.g. http://www.gnu.org/software/libc/manual/html_node/Backtraces.html
[19:08:21] <acrichto> pnkfelix: ah, nevermind :)
[19:08:41] <acrichto> pnkfelix: oh man this could totally be an unstable:: module
[19:08:50] <acrichto> or possibly an os:: method (although I'd prefer unstable)
[19:08:58] <pnkfelix> acrichto: okay.  Anyway, its not something *you* have to do.  I just noticed you mentioned that they were going away on @boxes, and I said "d'oh!  I didn't know we even had that!"
[19:08:59] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[19:09:00] * McPherrin would like libuv's uv_poll_t exposed in uvll
[19:09:21] * McPherrin will do it later this week if nobody else does
[19:09:32] <pnkfelix> acrichto: (I was literally just last week mentioning to nmatsakis how cool it was to have stack-trace on allocation path functionality back when I worked on Tamarin)
[19:09:44] <acrichto> pnkfelix: haha, sorry about that :(
[19:10:21] <pnkfelix> acrichto: well, maybe we can hack something up for unstable::  , that sounds pretty cool.  Do you know the Windows API for this stuff?
[19:10:43] <acrichto> pnkfelix: http://stackoverflow.com/questions/5693192/win32-backtrace-from-c-code was the first hit for "windows backtrace" on google and seems plausible at least
[19:10:45] <brson> acrichto: basically, yes. I think i'd like to have two parallel implementations (blocking/non-blocking) that live in submodules of std::io, and have std::io be another abstraction layer that picks the most appropriate implementation during construction. it may involve a little refactoring
[19:10:46] <pnkfelix> acrichto: (if not, that's okay, we can just make the API potentially always return an empty stack or None.)
[19:11:08] <brson> acrichto: i'm not *sure* this is the right approach (the yet-another-abstraction-layer), but there is a clear need for both types of I/O
[19:11:11] <pnkfelix> acrichto: ah, cool.  Bookmarked.  :)
[19:11:26] <brson> and istm that in the general case people shouldn't have to think about which they are using
[19:11:52] <acrichto> brson: from looking at things, it looks like IoFactory does a really good job of abstracting all of this
[19:12:15] <acrichto> brson: so much so that I'd think that std::io is purely a consumer of IoFactory, and we can provide a "blocking factory" in std::rt::native
[19:12:29] <brson> acrichto: if we went that route then most or all of the code in std::rt::io::native would need rewriting, yeah?
[19:12:34] <brson> which is fine
[19:12:45] <acrichto> brson: yeah right now it's just all ad-hoc, not ascribing to any particular interface
[19:13:02] <brson> IoFactory does seem like a reasonably place to do that abstraction, since it already exists
[19:13:14] <acrichto> I'd like to be able to expose the I/O factory to users
[19:13:24] <acrichto> so they at least have the option of choosing a blocking or non-blocking implementation
[19:13:25] <brson> omg that's a frightening prospect
[19:13:30] <brson> it's a mess
[19:13:32] <acrichto> hm maybe not
[19:13:54] <brson> maybe just Blocking/NonBlocking
[19:14:03] <brson> leave the details buried in the impl
[19:14:15] <acrichto> hm
[19:14:53] <brson> i mean, I guess ultimately it needs to be exposed if anybody wants to implement their own i/o event loop
[19:15:09] <acrichto> right now it has to get exposed for uv to be in its own crate
[19:15:16] <acrichto> along with the scheduler and other runtime internals
[19:15:26] *** Joins: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk)
[19:15:32] <brson> yeah, and we'll mark it #[experimental]
[19:15:47] <brson> all of rt is #[experimental] forever
[19:16:01] <acrichto> hehe
[19:16:19] <acrichto> we should probably start using the stability attributes sooner rather than later
[19:16:26] <SimonSapin> eh, now gyp is waiting on "xcodebuild -version -sdk macosx Path", which doesnâ€™t seem to return
[19:16:30] <brson> yes ... i'm so sad I haven't gotten that jumpstarted yet
[19:17:09] <SimonSapin> I wonder if itâ€™s waiting for me to click "accept the license" or something
[19:17:24] <SimonSapin> except I left the office and am using SSH remotely
[19:17:50] <lbergstrom> SimonSapin: ```sudo xcodebuild -license``` ?
[19:18:00] *** Quits: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk) (Quit: Ex-Chat)
[19:18:10] <lbergstrom> spacespacespacespace "accept"
[19:18:41] * brson lunch
[19:18:55] <kimundi> acrichto: If I implement FailMessage for fmt::Arguments, what exactly should I do with it?
[19:20:40] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: zzzzzzzzzz)
[19:21:29] *** Joins: Kxepal (Miranda@moz-54BF1851.pppoe.mtu-net.ru)
[19:24:25] <SimonSapin> lbergstrom: thatâ€™s blocking as well
[19:24:34] <SimonSapin> the license thing was only speculation
[19:26:12] <lbergstrom> SimonSapin: assuming it's an xcode tools issue, the only other "magic" I can remember throwing at it in the past is ```sudo xcode-select â€”reset```
[19:29:08] *** Quits: acrichto (acrichto@moz-69F2E428.ugrad.cs.cmu.edu) (Ping timeout)
[19:33:15] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[19:33:16] *** ChanServ sets mode: +o tjc
[19:33:45] <pnkfelix> SimonSapin: https://lists.macosforge.org/pipermail/macports-dev/2012-April/018832.html
[19:34:00] <pnkfelix> SimonSapin: i.e. have you tried `sudo xcodebuild -license` yet ?
[19:34:10] <pnkfelix> oh sorry, I didn't read backscroll
[19:35:41] <strcat> pcwalton: https://github.com/mozilla/rust/pull/10127 r?
[19:36:24] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[19:36:35] <SimonSapin> pnkfelix: yes, itâ€™s blocking as well
[19:36:37] *** Joins: erickt (etryzelaar@93E94B80.D1E9439C.98A37E8C.IP)
[19:36:51] <strcat> ; Function Attrs: cold noreturn
[19:36:53] <strcat> declare void @"_ZN2rt8borrowck13fail_borrowed18h342dc2e91f87178aL11v0.9$x2dpreE"({}* noalias sret, { i64, %tydesc*, i8*, i8*, i8 }*, %"struct.std::unstable::raw::Box<()>[#1]"*, i8*, i64) #1
[19:36:55] <strcat> :)
[19:37:17] <SimonSapin> pnkfelix, lbergstrom: thanks for the help so far but I give up for today
[19:37:17] <strcat> now whether it actually makes it faster is another story...
[19:37:29] <strcat> but it does now weight the branches and order them differently
[19:38:29] <lbergstrom> SimonSapin: Sorry it didn't work out! I did a clean install of servo on my 10.9 OSX machine and it just finished and built successfully (I was building a slide deck anyway)
[19:40:38] <SimonSapin> lbergstrom: yeah, itâ€™s my xcode command line tools that are broken somehow
[19:40:47] <SimonSapin> Iâ€™ll try to update or install a full xcode tomorrow
[19:45:15] *** Joins: tautologico (shung@703660AA.CFE755C8.C27E1635.IP)
[19:45:37] *** Quits: StarLight (StarLight@moz-5C4BD02.dynamic.avangarddsl.ru) (Ping timeout)
[19:45:55] <Sharp> Hey everyone.  Quick question.  In ast::Field, what is the best way to get the span of the ident (given that it's not stored with it)?  Is there some idiom for generating a "fake" Span in that situation, or should I just include span information when the Ident is parsed?
[19:46:47] <tjc> Sharp: usually an ident appears as a field of a data type that has a span itself, if that makes sense...
[19:47:16] <Sharp> Yeah, the field itself has a Span.  But the Span of the field includes the ident and the type, I think.
[19:47:24] <tjc> oh, I see
[19:47:25] <tjc> hmm...
[19:47:25] <Sharp> So if we just want to highlight the ident that doesn't really work.
[19:47:29] <tjc> I wonder what the reason for that is
[19:47:51] <tjc> Sharp: i suggest just changing the Field type to have a span for the ident
[19:47:58] <tjc> probably whoever wrote that code wasn't thinking about IDEs :-)
[19:48:00] <Sharp> Okay, cool.  I'll do that.  Thanks :)
[19:48:10] <tjc> no prob
[19:48:54] <tautologico> Sharp: are you working on some code editor/IDE?
[19:49:04] <Sharp> https://github.com/mozilla/rust/issues/8263
[19:49:35] <Sharp> Working through E-easy issues that nobody has claimed yet to become familiar with the Rust internals.
[19:49:58] *** Joins: StarLight (StarLight@moz-5848D83A.dynamic.avangarddsl.ru)
[19:50:55] <tautologico> cool
[19:56:52] *** Joins: acrichto (acrichto@moz-69F2E428.ugrad.cs.cmu.edu)
[19:57:06] <acrichto> kimundi: you can use std::fmt::format to get a ~str from a fmt::Arguments
[19:57:15] <kimundi> okay
[19:57:22] <acrichto> kimundi: and putting that code path into libstd instead of codegen is what I think would be nice
[19:57:48] <kimundi> I don't understand what you mean with that :)
[19:58:31] <acrichto> kimundi: basically right now fail!("foo {}", "bar") expands to begin_unwind(fmt::format(some fmt::Arguments))
[19:58:52] <acrichto> but removing the layer of indirection and putting it directly into the library would mean that it would expand to smaller code
[19:59:58] <kimundi> Hm... I'm not sure how implementing FailMessage for Arguments would be different though? format would just be called inside begin_unwind, instead outside of it
[20:01:01] <acrichto> the codegen at the fail!() side would be "set up argument", "call begin_unwindg"
[20:01:07] <acrichto> instead of having to deal with the intermediate ~str
[20:01:14] <acrichto> which then has drop glue I believe
[20:01:30] <kimundi> Okay, so the fail! and assert macros would change to use format_args!, right?
[20:01:41] <acrichto> correct
[20:02:06] <kimundi> which would generate the Arguments struct, which would only create codegen for that instantiation of begin_unwind
[20:02:25] <acrichto> that's the idea at least
[20:02:47] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[20:11:30] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[20:11:30] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/AF6v5Q
[20:11:30] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[20:16:38] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[20:16:38] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/BWCS2Q
[20:16:38] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[20:16:42] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[20:16:42] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/aA3oUQ
[20:16:42] <ghrust> 13rust/06auto 140e6a575 15Tim Chevalier: rustpkg: Build dependencies into the correct workspace when using --rust-path-hack...
[20:16:42] <ghrust> 13rust/06auto 1435349a7 15bors: auto merge of #10110 : catamorphism/rust/rustpkg-dependency-build-dir, r=metajack...
[20:16:42] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[20:20:18] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[20:29:03] <acrichto> brson: if you get a chance, could you take a look at https://github.com/mozilla/rust/pull/10058 today? It's not mergeable, but when merging I'll just have to play games with myself to make sure that I keep the copies up to date
[20:29:12] <acrichto> no rush of course!@
[20:32:31] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[20:33:53] <kimundi> acrichto: Okay, now I'm actually trying to implement the format_args! stuff, and I'm still confused because that macro seems to take a function instead of expanding to a Arguments struct as I though before it would
[20:34:18] <acrichto> kimundi: there's no sound way currently for it to return &fmt::Arguments
[20:34:19] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[20:34:26] <cmr> Does anyone have perf numbers for https://github.com/mozilla/rust/pull/10080 ? (cc brson)
[20:34:33] <acrichto> kimundi: so the first argument is a function/closure that takes just one argument
[20:36:33] <acrichto> cmr: one good number is that if you print "foo\n" 10000000 times, we're 30% faster than C
[20:36:33] <kimundi> acrichto: Okay, but how to a pass that into begin_unwind? should it expand to somethign like format_args!(|a| rt::task::begin_unwind(a, line!(), file!()), ... ) ?
[20:36:47] <acrichto> kimundi: yes
[20:36:57] <kimundi> Hm, okay
[20:43:58] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[20:46:05] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[20:47:22] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[20:47:22] <ghrust> 01[13rust01] 15alexcrichton 04force-pushed 06auto from 1435349a7 to 142ab4a6f: 02http://git.io/N3iJvQ
[20:47:22] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[20:47:32] <acrichto> oh argh wrong branch :(
[20:47:44] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[20:47:44] <ghrust> 01[13rust01] 15alexcrichton merged 06auto into 06snap-stage3: 02http://git.io/FOqPnA
[20:47:44] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[20:48:25] <Luqman> making a snap shot from auto?
[20:48:41] <acrichto> accidentally pushed auto first
[20:48:58] <Luqman> ah
[20:51:40] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[20:51:40] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/BWCS2Q
[20:51:40] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[20:51:43] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[20:51:43] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/k-zgrA
[20:51:43] <ghrust> 13rust/06auto 140e6a575 15Tim Chevalier: rustpkg: Build dependencies into the correct workspace when using --rust-path-hack...
[20:51:43] <ghrust> 13rust/06auto 14cd6e9f4 15bors: auto merge of #10110 : catamorphism/rust/rustpkg-dependency-build-dir, r=metajack...
[20:51:44] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[20:52:06] *** Quits: geoffhill (geoffhill@moz-244CF33A.amazon.com) (Quit: geoffhill)
[20:56:19] *** Quits: erickt (etryzelaar@93E94B80.D1E9439C.98A37E8C.IP) (Ping timeout)
[20:57:46] *** Quits: tautologico (shung@703660AA.CFE755C8.C27E1635.IP) (Quit: tautologico)
[21:02:15] *** Quits: dbaupp (Thunderbir@moz-15934519.lns20.syd6.internode.on.net) (Ping timeout)
[21:03:44] <kimundi> acrichto: Hm, making fail! use format_args causes trouble because it no longer expands to something with return value !
[21:04:23] *** Joins: geoffhill (geoffhill@moz-79C8D45C.amazon.com)
[21:04:24] *** Joins: tikue_ (tikue_star@A64AE68.28259105.689607DE.IP)
[21:04:59] <acrichto> kimundi: hm maybe it's not worth the trouble then
[21:05:45] <kimundi> acrichto: I could add a fn noreturn<T>(_: T) -> !
[21:06:08] <kimundi> and wrap it in that
[21:06:32] <acrichto> I don't want to get too complicated, I'm only guessing that this is a codegen improvement, I don't know for sure
[21:06:38] <acrichto> no need to add unnecessary complications
[21:07:45] <strcat> the noreturn is helpful when you already have lean code, but the libstd stuff already causes a bunch of indirect calls, landing pads, and so on
[21:10:03] * kimundi is not sure how he should proceed now
[21:10:46] *** Quits: eddyb (eddy@A93A03C9.9065A63B.FCAAE698.IP) (Ping timeout)
[21:16:07] <Sharp> tjc: If you're still around: I notice that pretty much every other ast type has at most one explicit Span field.  Should I use a wrapped Ident instead?  Or a Path, or something?  Or just add Span to Ident?
[21:16:30] <tjc> Sharp: Yes, I think the cleanest way to do it is to use a wrapped ident -- there already might be a newtype for that, let me take a quick look...
[21:16:46] <tjc> I don't recommend adding Span to Ident, that will result in literally hundreds of type errors to fix, if not more :-)
[21:17:12] <Sharp> That's not an issue to me if it's actually the correct solution, I just don't know if it is :D
[21:17:22] <tjc> well, it might also be a performance problem to do that (I'm not sure)
[21:18:10] <tjc> Sharp: i guess you can either use Spanned<Ident> or equivalently, `type SpannedIdent = Spanned<Ident>;`
[21:18:20] <tjc> I'm a little surprised that doesn't exist already, but it doesn't seem to
[21:18:22] <Sharp> Yeah, that's what I was thinking--just wanted to make sure that was correct since nothing else was doing it.
[21:18:24] <Sharp> Yeah, me too.
[21:18:43] <strcat> kimundi: well, I just mean that the failure stuff causes bad enough code that the noreturn won't matter
[21:18:49] <strcat> a silly example:
[21:18:58] <strcat> http://ix.io/8MW (rust-core) vs. http://ix.io/8MY (libstd), pushing 100 elements
[21:19:15] <strcat> (to a vector)
[21:19:42] <strcat> noreturn might remove a instruction or two
[21:19:46] <kimundi> I'm not sure what I'm looking at. :)
[21:20:02] <strcat> bloat ;p
[21:20:39] <kimundi> strcat: I was not talking about the noreturn function flag, I was talking about the bottom type
[21:21:07] <strcat> I only added that to those functions as a silly micro-optimization though, I don't think it's taken of semantically
[21:21:24] <strcat> fail_, etc.?
[21:21:39] <strcat> I wonder what this is 
[21:21:41] <strcat>    0x0000000000400d12 <+82>:movabs $0x1fffffffffffffff,%r15
[21:21:50] <strcat> odd
[21:22:23] <pcmattman> strcat: 64-bit immediate
[21:22:59] <strcat> yes but why are we generating it
[21:23:05] <kimundi> strcat: This is about moving the ~str allocation that currently happens at each fail! with a format string into the begin_unwind function itself
[21:23:36] <kimundi> which means using format_args!, which means fail! would not expand to something with return value !
[21:24:12] <kimundi> would this be a safe or a unsafe function? pub unsafe ignore_noreturn<T>(_: T) -> ! { cast::transmute(()) }
[21:24:42] <cmr> kimundi: it wouldn't run the argument's destructor
[21:24:48] <cmr> (if it has one)
[21:24:53] *** Quits: geoffhill (geoffhill@moz-79C8D45C.amazon.com) (Quit: geoffhill)
[21:26:55] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[21:27:51] <jld> strcat: I'm struck by the shr-or-mov thing going on in the longer disassembly.
[21:28:23] <strcat> I think it would be much easier to throw out all of that ~[T] code than try to fix it
[21:28:36] <strcat> some of the trans::tvec stuff has undef behaviour :(
[21:29:49] <strcat> jld: well, I don't get it, but I'd expect it to be from all of the calculations it needs to do for element vs byte size and overflow checks
[21:30:07] <strcat> bit shifts are harder enough to follow in high level code...
[21:31:28] <strcat> it has to calculate the current element size (byte_len / element_len), and then do new_element_size * element_len + header_size
[21:31:32] <strcat> all with overflow checks
[21:32:21] *** Joins: steveklabnik (steveklabn@moz-5EF6C37C.socal.res.rr.com)
[21:32:57] <jld> strcat: But still... that looks like a find-first-set, or something related to it.
[21:33:42] <jld> Except there should be an instruction for that, since this is amd64.
[21:34:35] <strcat> jld: and I compiled for core-avx2
[21:34:47] <strcat> hrm
[21:35:26] <strcat> it has so many branches
[21:35:41] <strcat> and that magical constant
[21:36:06] <strcat> jld: following this code is beyond what my brain is capable of today ;p
[21:36:07] <jld> (Also the 80386 had BSF/BSR, which is something I used to not have to look up when I did x86 in my day job.)
[21:37:34] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[21:39:17] <cmr> Does anyone have announcements for This Week in Rust?
[21:42:35] *** Joins: geoffhill (geoffhill@moz-244CF33A.amazon.com)
[21:42:43] <strcat> jld: I'm surprised to see a cmove there
[21:42:57] *** Quits: ash_136 (ashvini@4DDE72E5.F9E46DD1.E5F05D4F.IP) (Quit: Leaving)
[21:43:19] <strcat> unless that's not what I think it is ;p
[21:44:24] <strcat> I don't really see which equality comparison it'd have turned into that
[21:45:05] <strcat> ah I think that's for the += 2 if it's zero
[21:45:19] <strcat> += 4 *
[21:45:35] *** Quits: tikue_ (tikue_star@A64AE68.28259105.689607DE.IP) (Ping timeout)
[21:45:37] <strcat> or not, that's right under
[21:46:02] * strcat would not be a good compiler
[21:46:18] <cmr> heh
[21:48:06] *** Joins: tautologico (shung@703660AA.CFE755C8.C27E1635.IP)
[21:51:20] <brson> cmr: no perf numbers on the new lock free queues. i was lazy, and I don't have benchmarks that actually stress these queues. I did test it on a simple pingpong benchmark (where these queues don't particularly matter) and the perf was the same to slightly better
[21:51:50] <brson> the one place this should really matter a lot is on a lightly-loaded system with many cores
[21:52:25] <brson> but performance on that work load also leans on the work stealing deque, which is still locky
[21:52:34] <strcat> brson: did it just use a global mutex before?
[21:52:59] <brson> strcat: both these queues we're just mutex-wrapped vectors before
[21:54:46] *** Joins: tikue_ (tikue_star@A64AE68.28259105.689607DE.IP)
[22:06:11] *** Joins: jeffdb_ (jeff@moz-D13B6004.hsd1.ca.comcast.net)
[22:06:41] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[22:08:09] <strcat> brson: can you temporarily set /mode +i in #rust
[22:08:14] <strcat> invite-only
[22:08:17] <strcat> just until they go away
[22:08:27] <strcat> (or someone else)
[22:08:52] <Sharp> Seems like struct_field needs to get a spanned ident too, since we have some functions that create Fields from them.
[22:10:09] <acrichto> kimundi: std::sys can be removed after 10120, right?
[22:10:17] <acrichto> kimundi: nvmd I kept reading
[22:11:44] <kimundi> acrichto: Right, need a snapshot first though
[22:14:46] <acrichto> kimundi: hm I'm not sure that we want to keep using a trait-based failure mechanism
[22:14:54] <acrichto> kimundi: the error messages are going to be a little odd
[22:14:56] <acrichto> rusti: fail!(23)
[22:14:57] -rusti- pastebinned 8 lines of output: http://sprunge.us/KCbJ
[22:15:39] <acrichto> well I suppose it's not much worse than it was before
[22:15:46] <kimundi> acrichto: Well, there is no other option except always allocating a new layer of ~Any on failure
[22:15:56] *** maikeru is now known as mletterle
[22:16:16] <acrichto> we could require fail!(x) have x: ~Any, and fail!("foo {}", 3) call a separate function explicitly taking ~sstr
[22:16:53] <acrichto> or hm, maybe x: ~T where T: Send
[22:17:30] <kimundi> Which would make fail!("foo") either always allocate, or impossible
[22:18:11] <strcat> it's okay if failure is a really slow path
[22:18:14] <strcat> as long as the call site is tiny
[22:19:24] <kimundi> I think fail! using a FailMessage trait is fine, and if not expected, then at least easily learnable. If you invoke fail! wrongly, it tells you that whatever you fail with doesn't implement the trait, which you can then look for in the documentation.
[22:19:50] <brson> imo opinion making fail always allocate is ok. would also prefer that the failure lang item is a single parameterized function instead of a method, just because i think it's cleaner for the compiler interface to be functions not methods, just a stylistic preference
[22:19:52] <kimundi> FailMessage should maybe move out of rt::task though
[22:20:27] <brson> oh, it's not a lang item though
[22:20:31] <kimundi> brson: making failure a single parametrized function is what https://github.com/mozilla/rust/pull/10120 does
[22:20:31] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[22:20:31] *** ChanServ sets mode: +o pnkfelix
[22:20:37] <brson> kimundi: oh, good
[22:20:45] <kimundi> It just also keeps a trait bound on the parameter
[22:20:51] <acrichto> having a trait still doesn't sit well with me though
[22:21:03] <kimundi> To restrict failing to the types they where restricted to before
[22:21:07] <acrichto> it seems like the function should be "fn begin_unwind<T: Send>"
[22:21:21] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[22:21:21] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/k-zgrA
[22:21:22] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[22:21:35] <acrichto> in the ideal world it would just be "fn begin_unwind<T: Send>(t: T)" and that's it
[22:22:32] <kimundi> yeah, but we can't tread that generic type through the unwinding path without boxing it in a ~Any early
[22:23:07] <acrichto> this is where the extra method on Any may be nice
[22:23:10] <acrichto> if it were an Error
[22:23:11] <kimundi> And we'd need to _always_ box it, even if it already is a ~Any, or a ~T, T: Send
[22:23:17] <pnkfelix> hmm, joining #rust requires an invitation ?
[22:23:20] <acrichto> (~t as ~Any).error_message()
[22:23:39] <acrichto> kimundi: always allocating isn't really that much of a problem
[22:23:48] <Luqman> pnkfelix: spammer
[22:24:04] <kimundi> WHich would mean propagating a failure through a reapeated fail! with a tasks return value would just keep adding layers of ~Any boxes
[22:24:55] <pnkfelix> Luqman: does an op have to invite me?
[22:25:07] <strcat> pnkfelix: yes, it would be nice to set it to require nickserv auth instead if possible
[22:25:09] <strcat> I don't know how
[22:25:13] <acrichto> kimundi: if you fail with an ~Any then I would expect the other end to say (ret.is::<~Any>)
[22:25:23] <strcat> pnkfelix: you can probably invite yourself too...
[22:25:25] <strcat> via chanserv
[22:26:04] <Luqman> pnkfelix: this might work /msg ChanServ invite #rust 
[22:26:25] <pnkfelix> Luqman: thx, that did work.  funny.
[22:26:27] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[22:26:28] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/IGJzRA
[22:26:28] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[22:26:28] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[22:26:28] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/qzA84w
[22:26:28] <ghrust> 13rust/06auto 14dde8be6 15Daniel Micay: mark bounds check failures as the cold path...
[22:26:28] <ghrust> 13rust/06auto 14473ab66 15bors: auto merge of #10113 : thestinger/rust/expect, r=cmr...
[22:26:29] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[22:32:54] <kimundi> acrichto: Anyway, I'm going to bed now.
[22:33:11] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Input/output error)
[22:33:13] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[22:39:38] *** Quits: tautologico (shung@703660AA.CFE755C8.C27E1635.IP) (Quit: tautologico)
[22:41:01] *** Joins: tautologico (shung@703660AA.CFE755C8.C27E1635.IP)
[22:41:22] *** Quits: tautologico (shung@703660AA.CFE755C8.C27E1635.IP) (Quit: tautologico)
[22:42:22] *** Joins: aatch (James@moz-B437F499.pocketrent.com)
[22:57:03] *** lbergstrom is now known as lbergstrom|dinner
[22:59:11] <Sharp> Oh bah, Enums are Structs, aren't they.
[22:59:26] <cmr> Sharp: no?
[22:59:37] <Sharp> In the AST it seems like they pretty much are.
[22:59:39] <cmr> Oh
[22:59:49] <cmr> They can have struct variants.
[23:07:16] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[23:07:16] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14473ab66 to 14cd6e9f4: 02http://git.io/N3iJvQ
[23:07:16] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[23:07:17] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[23:07:17] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Tdhg1A
[23:07:17] <ghrust> 13rust/06auto 14dde8be6 15Daniel Micay: mark bounds check failures as the cold path...
[23:07:17] <ghrust> 13rust/06auto 148852cb7 15bors: auto merge of #10113 : thestinger/rust/expect, r=cmr...
[23:07:17] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[23:07:48] <Luqman> Sharp: huh? they are separate in the ast at least, item_struct & item_enum
[23:07:57] <strcat> acrichto: ah lets make your fix go in first
[23:07:59] <strcat> sec
[23:08:18] <acrichto> strcat: yours will probably see, I saw the error happen this morning but it didn't happen consecutively reliably
[23:08:28] <strcat> oh then I won't bother
[23:08:31] <Sharp> Lugman: They both seem to turn into ExprStructs though, which means that anything I add to Field I have to deal with for enums too.
[23:09:41] <Sharp> *Luqman, sorry.
[23:09:54] *** Quits: km (quassel@moz-777F24DE.kevinmehall.com) (Ping timeout)
[23:10:03] <strcat> you know, every time I see this
[23:10:07] <strcat>     ty_estr(vstore),
[23:10:09] <strcat>     ty_enum(DefId, substs),
[23:10:10] <cmr> Are we tied to LLVM's idea of a target triple or can we add another field to ours?
[23:10:16] <strcat> I've never going to not see that as 'e-num'
[23:10:46] <cmr> ie, x86_64-unknown-linux-gnu-guarded, x86_64-unknown-linux-gnu-segmented
[23:10:50] *** Joins: dbaupp (Thunderbir@CE33C7D9.D5A1DCF.37681C44.IP)
[23:11:03] <Luqman> Sharp: what do you mean? enums never show up in an expression context
[23:11:31] <cmr> or, more likely, x86_64-unknown-linux-gnu-{std,core}
[23:11:45] <acrichto> cmr: I'm not sure that we want to conflate the target triple with a build configuration
[23:11:46] <cmr> The last one specified the runtime it is compiled against.
[23:11:49] *** Joins: km (quassel@moz-777F24DE.kevinmehall.com)
[23:12:00] <cmr> acrichto: it's not just a build configuration though, it also defined the ABI it needs to use.
[23:12:07] <cmr> *defines
[23:12:13] <acrichto> not std/core, segmented/guarded maybe
[23:12:17] <cmr> sure
[23:12:23] <Sharp> Er, really?   Maybe I'm confusing Struct variants with enums then?
[23:12:41] <cmr> But a runtime specifies the stack safety mechanism, how TLS works, etc.
[23:12:48] <cmr> You can't link two crates using different runtimes together
[23:13:04] <acrichto> cmr: I'd almost prefer this all be metadata that's matched on
[23:13:16] <acrichto> we already have the infrastructure for matching on metadata attributes
[23:13:20] <strcat> acrichto: we're going to need 3 copies of the stdlib already (static, dynamic, lto)
[23:13:23] <Luqman> Sharp: well what do you mean by enum? something like enum Foo { A, B(int), C { x: int } } is not an expression
[23:13:32] <cmr> acrichto: Sure, but where do you put the two different libstd for the two different runtimes?
[23:13:44] <Sharp> No, but something like Foo { /*â€¦*/ } presumably is.
[23:13:48] <acrichto> cmr: their linkage attributes generate different hashes
[23:13:52] <Sharp> Er, well, you wouldn't do that
[23:13:55] <cmr> Ah yes, I forgot about the hash
[23:13:56] <Sharp> How about just A()
[23:13:57] <acrichto> one will be libstd-foo.dylib and the other is libstd-bar.dylbi
[23:14:00] <cmr> right
[23:14:04] <cmr> Ok, so that works.
[23:14:17] <Luqman> Sharp: sure, those are expressions
[23:14:27] <acrichto> strcat: I think you'd explicitly opt-in to building particular portions of rust libraries
[23:14:44] <acrichto> strcat: I thought that by default we'd stick with dynamic linking but you'd have an option to have static linking
[23:14:51] <acrichto> in the build process
[23:14:59] <cmr> We should build+install both IMO
[23:15:05] <Sharp> Right, and they have Fields associated with them, so I have to deal with those :)  That's all I meant.
[23:15:09] <strcat> acrichto: dynamic linking is a bad default
[23:15:16] <acrichto> also, from what I've seen we'd generate a .o file and then generate the shared library or static library from that
[23:15:23] <acrichto> so it's mostly disk space, not compile-times
[23:16:06] <Luqman> Sharp: sure but i just mean, enums aren't structs. They can have struct variants
[23:16:23] <Sharp> Fair enough :)  I was confused.
[23:16:28] <Luqman> (ignoring the fact we do make enums & structs LLVM structs in trans :P)
[23:16:50] <strcat> acrichto: dynamic linking makes sense if you have a stable ABI and you're linking against globally installed libraries
[23:17:04] <strcat> if either isn't true, then it's not really useful
[23:17:42] <strcat> if it's not stable you end up needing to rebuild anything to push out a lib upgrade anyway
[23:17:57] <acrichto> hm that's a good point
[23:18:19] <strcat> and for non-global libs, it's *really* annoying since moving stuff around will breake
[23:18:20] <strcat> break*
[23:18:30] <strcat> except rustc uses ugly rpath hacks to cover that up in some cases...
[23:18:40] <strcat> and fedora/debian aren't going to ship a rust pkg until that's gone
[23:19:09] <strcat> (we also need to allow using an external libuv/llvm to make them happy ;p)
[23:20:29] <acrichto> I should see if we can update to using libuv master
[23:20:56] <strcat> acrichto: it'd be really nice if we had an --external-libuv switch for configure
[23:21:29] <acrichto> we'd still have to be able to detect the version
[23:21:35] <acrichto> we only work on a fairly recent libuv
[23:21:55] <strcat> right
[23:23:23] * strcat wonders how much fixed-size vecs will break if small ones are immediate
[23:28:18] *** lbergstrom|dinner is now known as lbergstrom
[23:34:15] <aatch> acrichto, this is why I'm reluctant to use a standard static archive, on elf systems anyway, http://llvm.org/doxygen/ObjectFile_8cpp_source.html#l00050
[23:34:49] <acrichto> aatch: what is that?
[23:35:23] <aatch> acrichto, there's no handling of .a files in llvm, we'd have to roll our own format handling for it.
[23:35:35] <aatch> mostly because they aren't actually object files.
[23:36:03] <pcmattman> surely .a files are a linker thing, not a compiler thing?
[23:36:57] <aatch> pcmattman, we store metadata in a section of the object file
[23:37:17] <aatch> it's why we don't need header files.
[23:37:31] <pcmattman> right, I was more referring to it not being supported in llvm
[23:38:53] <aatch> pcmattman, oh right, yes. Though it's more likely that generic handling of .a files is probably too hard to be worth it.
[23:39:02] <acrichto> aatch: it actually may not be totally unreasonable to do .a handling ourselves
[23:39:22] <acrichto> all they are is a bundle of .o files with maybe a symbol table here or ther
[23:39:25] <acrichto> (I think)
[23:39:34] <cmr> Why don't we define our own container?
[23:39:45] <cmr> ...because then the linker can't use it.
[23:39:52] <acrichto> compat with ld as a linker is something I figured we'd want to strive for
[23:39:56] <cmr> :P
[23:40:04] <acrichto> we could just distribute object files
[23:40:12] <cmr> I need to think more before I hit enter
[23:40:13] <aatch> acrichto, well that's kind of the point.
[23:40:14] <acrichto> but specifying a path to them would be hard
[23:42:05] <aatch> acrichto, we could follow the lead of llvm and many other projects by having a rust-config script that outputs the right paths, etc.
[23:42:32] <acrichto> aatch: hmm that could be possible, we'd have to deal with hashes on library filenames as well
[23:42:37] <acrichto> but that is fairly plausible
[23:42:58] <acrichto> probably easier than dealing with writing our own .a parser and then doing something totally different on windows
[23:43:34] <aatch> acrichto, exactly. I mean, static libraries themselves don't actually need hashes, so that helps there.
[23:43:48] <acrichto> we'd probably still want the hashes though
[23:43:51] <cmr> aatch: they do.
[23:43:59] <acrichto> you could have two versions of a static library and you want to make sure you link against the right one
[23:44:03] <cmr> version, runtime.
[23:44:20] <aatch> isn't that only important for distribution though?
[23:44:32] <aatch> so you load the right file at the other end?
[23:44:58] <acrichto> I imagine that development also matters
[23:45:56] <aatch> I'm skeptical of the use case of needing to have multiple versions of a static library at the same time.
[23:46:08] <cmr> aatch: multiple runtimes needs it.
[23:47:15] <aatch> cmr, but why have some opaque hash for it?
[23:47:32] <aatch> Surely just having a descriptive name would work better?
[23:47:39] <cmr> aatch: I suppose it would!
[23:47:59] <strcat> acrichto: there are different linker formats anyway
[23:48:15] <strcat> and it's totally different if you use LTO ofc
[23:49:14] <aatch> I mean, I was under the impression that the point of the hashes was to ensure you didn't load the wrong library at the other end. Since that is anywhere between a crash or a security hole.
[23:55:47] <acrichto> I swear if you grep for any 4 digit pattern you will always get at least one hit in the ziggurat tables
[23:56:09] <strcat> lol
[23:56:27] <strcat> what are those for anyway? just generating certain distributions?
[23:56:42] <acrichto> from what dbaupp was saying it sounded like a super-optimized way to generate the distributions
[23:57:02] <acrichto> on 10099 he replaced it with some math, and apparently it was like 4x slower
