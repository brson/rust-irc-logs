[00:00:02] <pcwalton> yes
[00:00:08] <WindowsBunny> pcwalton: But enabling/disabling auto inlining shouldn't affect whether the function is part of the dynamic library?
[00:00:24] <pcwalton> if it's inlined you can't change it anymore without breaking ABI compat
[00:00:48] *** Joins: reem (reem@moz-rnqk15.ca.comcast.net)
[00:01:10] <WindowsBunny> right, the non-inlined method might change behavior, but the inlined method would be using the old version
[00:01:14] *** Quits: summerlight_ (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[00:01:28] <pcwalton> that's bad :)
[00:01:38] <pcwalton> the point of this is to for example fix security issues
[00:01:45] <pcwalton> if your vulnerable code is inlineable...
[00:02:53] *** Joins: reem_ (reem@moz-rnqk15.ca.comcast.net)
[00:03:59] *** Quits: mystor (mystor@moz-rrn.r78.15.130.IP) (Ping timeout: 121 seconds)
[00:04:15] *** Quits: reem (reem@moz-rnqk15.ca.comcast.net) (Connection closed)
[00:07:21] <arrrrrrrrr> is there a to_lower for stringify?
[00:07:48] *** Joins: pachucoz (Mibbit@moz-juv.9o3.252.72.IP)
[00:10:19] <pcwalton> the destructor of Arc is really inefficient
[00:10:24] <pcwalton> I'm going to partial inline it
[00:10:34] <pcwalton> it keeps showing up in profiles for no reason
[00:11:23] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[00:11:52] *** Joins: brson (brson@moz-o67.m43.48.37.IP)
[00:11:52] *** ChanServ sets mode: +o brson
[00:21:36] *** Quits: reem_ (reem@moz-rnqk15.ca.comcast.net) (Connection closed)
[00:22:30] <huon> pcwalton: maybe https://github.com/rust-lang/rust/pull/21418 would help? (the merged status there is a lie, unfortunately)
[00:22:32] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[00:22:42] *** Joins: mystor_ (mystor@moz-rrn.r78.15.130.IP)
[00:23:08] <pcwalton> huon: I think the partial inlining will help
[00:25:55] <huon> barosl: nrc|afk: highfive and homu have been deployed to the contain-rs organisation: http://huon.me:54857/ https://github.com/contain-rs/highfive/pull/1#event-258778176
[00:26:01] <huon> barosl: nrc|afk: it's very cool :)
[00:26:34] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Ping timeout: 121 seconds)
[00:29:52] *** Quits: c74d (c74d3a4ebb6@moz-0ersgu.oc.cox.net) (Ping timeout: 121 seconds)
[00:30:08] <nrc|afk> \o/
[00:35:43] *** Quits: kmcguire_ (kmcguire@moz-pg1gb9.biz.rr.com) (Ping timeout: 121 seconds)
[00:37:22] *** Quits: pachucoz (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[00:37:35] <pcwalton> cmr: r? https://github.com/rust-lang/rust/pull/23498
[00:41:45] *** Joins: {-}grant ({0}grant@moz-63ubas.in.charter.com)
[00:41:54] <Manishearth> 3~3~oo, next rollup brings me to 100 non-merge commits :D
[00:42:04] <Manishearth> *oooo
[00:47:54] <WindowsBunny> Manishearth: How do you even type 3~ accidentally?
[00:50:16] <Manishearth> WindowsBunny: I haven't fixed my terminal encoding yet
[00:50:22] <Manishearth> that's a control char
[00:50:29] <WindowsBunny> orite, silly terminal users
[00:50:36] <Manishearth> I have fixed it, but I'm too lazy to restart my screen session
[00:50:51] <Manishearth> because that involves rejoining my rooms and then reordering them
[00:54:13] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[00:56:16] <Luqman> Manishearth: nah, just relocate your irssi/weechat/whathaveyou to a new screen session :P
[00:56:26] <Manishearth> wait what
[00:56:33] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[00:56:45] <Luqman> Manishearth: https://github.com/nelhage/reptyr
[00:58:48] *** Quits: brson (brson@moz-o67.m43.48.37.IP) (Quit: leaving)
[01:00:38] *** Joins: Johannes_ (Johannes@moz-4et8d7.ocn.ne.jp)
[01:03:12] *** Quits: Manishearth (manishearth@moz-8puj7k.net) (Quit: Lost terminal)
[01:04:07] *** Joins: manishearth (manishearth@moz-8puj7k.net)
[01:04:15] *** Quits: Johannes (Johannes@moz-4et8d7.ocn.ne.jp) (Ping timeout: 121 seconds)
[01:04:20] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[01:04:42] <manishearth> Luqman: didn't work :P
[01:04:53] *** manishearth is now known as Manishearth
[01:05:03] *** Quits: swgillespie (swgillespie@moz-upj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[01:05:57] <Manishearth> मनीष
[01:06:01] <Manishearth> yay, unicode goodness
[01:06:11] <Manishearth> sans the combining characters, but whatever
[01:10:38] *** Quits: mystor_ (mystor@moz-rrn.r78.15.130.IP) (Connection closed)
[01:11:49] *** Joins: mystor (mystor@moz-rrn.r78.15.130.IP)
[01:16:00] *** Quits: mystor (mystor@moz-rrn.r78.15.130.IP) (Ping timeout: 121 seconds)
[01:20:44] *** Quits: {-}grant ({0}grant@moz-63ubas.in.charter.com) (Connection closed)
[01:20:45] <Gankro> steveklabnik: I vaguely recall some PR where you were *adding* Rust to code fences. Was that just a rustbook/.md thing?
[01:21:13] *** Joins: {-}grant ({0}grant@moz-63ubas.in.charter.com)
[01:21:19] *** nrc|afk is now known as nrc
[01:23:59] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Ping timeout: 121 seconds)
[01:24:21] *** Joins: reem (reem@moz-o83ume.coob.q2h1.0009.2601.IP)
[01:24:39] *** Quits: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au) (Ping timeout: 121 seconds)
[01:33:07] <Manishearth> acrichto: can we squelch the last old impl check in old_io on IncomingConnections by adding a T type param to IncomingConnections?
[01:34:05] <acrichto> Manishearth: for now it'll have to wait until we remove old_io
[01:36:32] <barosl> huon, Huh, you're doubling the number of the repositories every day
[01:36:54] <Manishearth> acrichto: oh, it's going away? that seems okay
[01:38:27] *** Joins: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au)
[01:39:59] *** Quits: Rym_ (y@moz-859.d1r.39.217.IP) (Connection closed)
[01:40:12] *** Joins: Rym_ (y@moz-859.d1r.39.217.IP)
[01:47:27] <Gankro> aturon: acrichto: tricky crate/module/type naming/construction conventions: https://github.com/Gankro/collect-rs/issues/138#issuecomment-83255200
[01:51:12] <bstrie> what library do we currently use for markdown parsing?
[01:52:03] <sfackler> bstrie: hoedown I think
[01:55:25] *** Quits: eibwen (eibwen@moz-eknsl2.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[01:56:08] *** Joins: jdm (jdm@moz-i5m.05u.207.66.IP)
[02:07:25] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[02:08:01] *** Quits: Rym_ (y@moz-859.d1r.39.217.IP) (Connection closed)
[02:08:02] *** Quits: marsel (user@moz-b9s.mg0.180.94.IP) (Ping timeout: 121 seconds)
[02:11:59] <Luqman> Manishearth: whoops, sorry. worked for me i the past
[02:12:24] *** Joins: larsberg (sid16141@moz-fnneme.uxbridge.irccloud.com)
[02:12:53] <Manishearth> np
[02:14:02] *** Joins: theme (theme@moz-i3mhhb.asianet.co.th)
[02:20:06] <acrichto> Gankro: I'd almost expect hashmap/treemap to be the crate names (e.g. the sets are implemented with the maps)
[02:21:00] <Manishearth> barosl: huon just occurred to me, homu is the next step towards iteratively figuring out the best CI system :P 
[02:21:16] <Manishearth> We start with the shoot-first-ask-questions-later approach of regular CI
[02:21:30] <Manishearth> and then Graydon et al realize that that sucks, and create bors
[02:21:52] <Manishearth> but bors gets backed up, so we realize that shoot-first-ask-questions later was actually rather sensible in *most* cases
[02:22:05] <Manishearth> except the few times where master breaks which you want to avoid
[02:22:21] <reem> Gankro: Personally I wouldn't be surprised by `hash` for hash::Map and hash::Set if they weren't in std, so `tree` and `trie` sound fine to me.
[02:22:34] <Manishearth> so we move to rollups, because there's a good chance that the rollup-ping won't cause any conflicts
[02:23:45] <Manishearth> (My proposed improvement is another iterative step)
[02:23:58] <Manishearth> eventually we'll converge to the true CI system of our needs :p
[02:24:29] <barosl> I believe the next step would be a complete isolation of each build
[02:24:35] <Manishearth> ?
[02:24:38] <barosl> brson said this before
[02:24:48] <barosl> or, acrichto?
[02:24:53] <theme> Aren't we supposed to fix those random failures first?
[02:24:57] *** Joins: adu (ajr@moz-0foa9t.md.comcast.net)
[02:25:06] <reem> the next step is running the build on a supercomputer and doing builds in 30 seconds :P
[02:25:08] <theme> sorry if I gravely misunderstood something
[02:25:09] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[02:25:12] <Manishearth> "complete isolation of each build"?
[02:25:15] <Manishearth> theme: mostly yes
[02:25:25] <theme> Manishearth, what "yes"?
[02:25:26] *** Quits: jdm (jdm@moz-i5m.05u.207.66.IP) (Quit: )
[02:25:29] <barosl> Manishearth, Currently we're not utilizing any virtualization and/or something like Docker, so each build isn't isolated correctly
[02:25:31] <Manishearth> theme: fixed
[02:25:35] <Manishearth> barosl: ah I see
[02:25:37] <theme> oh... *_*
[02:25:43] <Manishearth> theme: ... mostly
[02:25:50] <Manishearth> we still have a bunch of windows intermittents
[02:25:55] <Manishearth> but they don't bite .. much
[02:27:23] <klutzy> the hanging failures?
[02:27:30] <Manishearth> yeah
[02:27:47] <theme> erm... we are hanging them?
[02:27:54] <theme> Did I misparse something?
[02:28:19] <theme> nvm
[02:28:30] <klutzy> there're suspectly multithread bugs which causes certain tests randomly hang
[02:29:39] <klutzy> when I digged locally last month, there were even hangs inside jemalloc :-/ not sure if it's separate bug
[02:30:35] *** Quits: Johannes_ (Johannes@moz-4et8d7.ocn.ne.jp) (Connection closed)
[02:30:57] *** Joins: Johannes (Johannes@moz-4et8d7.ocn.ne.jp)
[02:31:13] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[02:31:15] <barosl> Multithreading is hard... let's just introduce GIL
[02:31:29] * cmr shudders
[02:31:42] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[02:31:50] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[02:33:19] <klutzy> http://buildbot.rust-lang.org/builders/auto-win-64-nopt-t/builds/2591/steps/test/logs/stdio
[02:33:20] <klutzy> Zombie process: "\Device\HarddiskVolume1\dojob.exe"
[02:33:31] <klutzy> this means some process hanged, right?
[02:34:16] <Manishearth> no that one is fine
[02:34:26] <Manishearth> dojob itself is zombieable
[02:34:31] <Manishearth> anything else is bad
[02:35:24] <klutzy> aha
[02:35:58] <Manishearth> reminds me, I should mass-download buildbot logs and grep 'em
[02:36:05] <Manishearth> for zombies
[02:38:01] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[02:38:42] *** Joins: summerlight_ (summerlight@moz-99k.2mj.130.121.IP)
[02:41:46] *** Joins: dcb (textual@moz-j72nfe.ca.comcast.net)
[02:53:02] <Manishearth> woop woop snap time
[03:02:18] <freebroccolo> acrichto huon: can someone push the num 0.1.16 to crates.io?
[03:04:06] <acrichto> freebroccolo: oh oops I must have forgotten to do that
[03:04:08] <acrichto> published now!
[03:04:23] <freebroccolo> ah, thanks :)
[03:06:34] *** Joins: brson (brson@moz-9bc.c9m.56.172.IP)
[03:06:34] *** ChanServ sets mode: +o brson
[03:10:22] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[03:11:52] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[03:13:32] *** Quits: tjakubow (tom@moz-ag87jj.fios.verizon.net) (Quit: WeeChat 1.1.1)
[03:17:32] <Manishearth> acrichto: could you fix up the windows path stuff in the rollup?
[03:17:56] <acrichto> Manishearth: yeah feel free to leave it out
[03:17:58] <Manishearth> I'm not sure exactly what change caused this and I don't want to keep poking it till I have everything I need
[03:18:04] <Manishearth> acrichto: not sure which PR caused it :P
[03:18:17] <Manishearth> oh wait
[03:18:19] <Manishearth> less-prelude
[03:18:25] <acrichto> Manishearth: it was the old_io/old_path out of the prelude
[03:18:28] <acrichto> yeah
[03:18:43] *** sunfish is now known as sunfish-away
[03:23:04] <WindowsBunny> oh, the old path is finally out of the prelude?
[03:23:54] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[03:23:54] *** ChanServ sets mode: +o pcwalton
[03:25:15] *** Joins: ytain (ytain@moz-44k.q8p.140.24.IP)
[03:27:51] <klutzy> is there an issue that rustdoc doesn't recognize methods at `#[lang=...] impl { ... }`?
[03:28:29] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[03:29:15] *** Quits: kmehall (quassel@moz-i98f9d.kevinmehall.com) (Ping timeout: 121 seconds)
[03:29:56] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Ping timeout: 121 seconds)
[03:30:07] <cmr> Guhhh, why does DerefMut use the Deref impl's Target :(
[03:30:50] <cmr> In this case it's not a big deal, since I can just deref to &[T] instead of &Vec<T>, but...
[03:30:55] *** Joins: kmehall (quassel@moz-i98f9d.kevinmehall.com)
[03:31:33] <Manishearth> klutzy: ?
[03:32:56] <klutzy> Manishearth: e.g. [T]::sort_by() is not found at search results.
[03:33:17] *** Quits: kimundi (kimundi@moz-r03hcq.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[03:33:36] *** Quits: sprang (sprang@moz-bll05b.zoominternet.net) (Connection closed)
[03:33:45] <theme> cmr, sounds ok o be
[03:33:47] <theme> to me
[03:34:28] <klutzy> (due to gh23104)
[03:34:28] <[o__o]> allow inherent implementations on primitives, remove some extension traits: https://github.com/rust-lang/rust/pull/23104
[03:34:46] *** Joins: kimundi (kimundi@moz-51c9op.dip0.t-ipconnect.de)
[03:35:22] *** Joins: c74d (c74d3a4ebb6@moz-0ersgu.oc.cox.net)
[03:35:26] <klutzy> hmm, seems like not reported yet
[03:36:50] <theme> For some reason, it is here http://doc.rust-lang.org/nightly/std/primitive.slice.html#method.sort_by
[03:36:54] <theme> but not found by search
[03:37:44] <klutzy> oh, interesting
[03:38:25] <theme> But I have no idea where the methods on `*const T` and `*mut T` are O_o
[03:38:28] *** Quits: brson (brson@moz-9bc.c9m.56.172.IP) (Quit: leaving)
[03:38:46] *** kimundi is now known as zz_kimundi
[03:39:53] <theme> What are we going to do with Duration?
[03:41:40] <reem> Has github ever marked bors as non-human? I just created reem-bot and github notified me that it hid the profile because it thinks it's not human.
[03:42:05] <reem> I'm wondering what I should say in response, since I plan to use it for homu
[03:42:49] <cmr> hm, I guess that's technically against their terms of service...
[03:43:00] <cmr> A.7 and (ish?) A.1
[03:43:04] <cmr> A.2, sorry
[03:44:12] <theme> eh?
[03:44:25] <theme> so bors and homu violated terms of service all along?
[03:44:38] <theme> wait a sec, it says "registered"
[03:45:05] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[03:45:05] *** ChanServ sets mode: +o pcwalton
[03:45:17] <theme> Does that mean that an account that is manually registered but automatically operated is allowed?
[03:45:40] *** zz_kimundi is now known as kimundi
[03:51:07] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Ping timeout: 121 seconds)
[03:51:53] *** Quits: theme (theme@moz-i3mhhb.asianet.co.th) (Quit: Leaving)
[03:52:16] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[03:52:16] *** ChanServ sets mode: +o pcwalton
[03:52:42] *** Joins: sprang (sprang@moz-bll05b.zoominternet.net)
[03:53:31] <reem> I hope so
[03:53:40] <cmr> I think the answer is yes
[03:56:31] * nrc soothes rust-highfive
[03:56:39] <nrc> "it's Ok, they won't hurt you"
[03:58:46] <sfackler> nrc: have a chance to look at https://github.com/rust-lang/rust/pull/23486 ?
[03:59:12] <nrc> not yet
[03:59:26] <nrc> but I will, there is a tab open for it and everything
[04:01:04] <sfackler> thanks!
[04:05:26] *** Quits: Murarth (Murarth@moz-clm.78t.166.46.IP) (Quit: Screw you guys. I'm going home.)
[04:05:39] *** Joins: Murarth (Murarth@moz-12ajc1.phnx.qwest.net)
[04:07:49] *** Joins: shmoo (Mibbit@moz-juv.9o3.252.72.IP)
[04:09:24] *** Quits: reem (reem@moz-o83ume.coob.q2h1.0009.2601.IP) (Connection closed)
[04:13:32] *** Joins: reem (reem@moz-o83ume.coob.q2h1.0009.2601.IP)
[04:15:30] *** Quits: shmoo (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[04:29:04] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Connection closed)
[04:30:47] *** Quits: summerlight_ (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[04:32:27] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[04:32:49] <Manishearth> anyone want to fix bitrig?
[04:32:50] <Manishearth> http://buildbot.rust-lang.org/builders/snap3-bitrig-64/builds/108/steps/test/logs/stdio
[04:33:57] *** Quits: arrrrrrrrr (arrrrrrrrs@moz-vimofl.dynamic.qsc.de) (Ping timeout: 121 seconds)
[04:39:23] *** Quits: dcb (textual@moz-j72nfe.ca.comcast.net) (Connection closed)
[04:41:19] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[04:42:29] <Yurume> http://ix.io/gYk :)
[04:48:47] *** Joins: semarie (semarie@moz-e4rh2f.7by7.de)
[04:49:19] *** Quits: ytain (ytain@moz-44k.q8p.140.24.IP) (Quit: Textual IRC Client: www.textualapp.com)
[04:56:46] <erickt> acrichto: ping
[05:05:01] *** Quits: reem (reem@moz-o83ume.coob.q2h1.0009.2601.IP) (Connection closed)
[05:07:28] *** Joins: reem (reem@moz-o83ume.coob.q2h1.0009.2601.IP)
[05:14:55] *** Quits: gsingh93 (gulshan@moz-3fu4am.mi.comcast.net) (Ping timeout: 121 seconds)
[05:15:50] *** Joins: tjakubow (tom@moz-ag87jj.fios.verizon.net)
[05:18:03] <reem> I just realized how cool it is that the removal of 'static from Send just magically enabled a lot of existing code to now be usable in a data parallel context.
[05:18:18] <reem> I haven't had to change almost any bounds by adding 'static
[05:20:18] *** Quits: scialex (scialex@moz-if7.du5.16.138.IP) (Ping timeout: 121 seconds)
[05:21:14] *** Joins: theme (theme@moz-i3mhhb.asianet.co.th)
[05:21:23] <erickt> sfackler: ping
[05:21:25] <sfackler> erickt: pong
[05:21:32] <erickt> oh that was fast :)
[05:21:46] <eddyb> reem: is this the first use of region typing in fork-join parallelism?
[05:22:18] <reem> That I'm aware of
[05:22:31] <reem> but I'm not aware of all the things in this space, so who knows
[05:22:46] <reem> I don't know any other language that lets you do that safely
[05:22:46] <erickt> so I recently saw someone blog about perfect hashing on hacker news, and it made me think it'd be pretty cool if our string pattern matching could take advantage of it
[05:23:07] <eddyb> erickt: the consistent jump thing?
[05:23:32] <eddyb> I thought that had very limited usecases, in "big data"
[05:23:33] <erickt> eddyb: I think so?
[05:23:49] <Yurumechan> consistent jumping is more about reducing the perf impact of rehashing
[05:24:02] <eddyb> Yurumechan: oh, right
[05:24:09] <eddyb> hang on...
[05:24:16] *** Quits: scott (uid25790@moz-e5ok1n.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[05:24:40] <eddyb> Yurumechan: for HashMap, would that means resizing will require no shuffling?
[05:24:52] <eddyb> *mean
[05:24:52] <erickt> eddyb: ah ok. perfect hashing is an algorithm for constructing a hash function that'll only match a certain set of values
[05:24:56] <Yurumechan> no
[05:25:09] <Yurumechan> it will move some elems
[05:25:13] <Yurumechan> but not all
[05:25:22] <eddyb> Yurumechan: that's what it does right now
[05:25:27] <eddyb> for any given hash function
[05:25:47] <Yurumechan> and the number of "some" is greatly reduced
[05:25:55] <eddyb> Yurumechan: well, that's better
[05:26:12] <erickt> sfackler: so anyway I just checked, and if I read trans correctly, our string pattern matching compiles down into essentially a chain of memcmps
[05:26:13] <Yurumechan> but I doubt it is good for general hashtable
[05:26:38] <eddyb> erickt: oh, I had some ideas about that :D
[05:26:56] <Yurumechan> iirc it will move a half of all elements (rather than almost all elems) in the setting of 2x growth hashtabs
[05:27:43] <sfackler> erickt: that chain of memcmps is why i wrote rust-phf :) https://github.com/sfackler/rust-postgres/issues/18
[05:27:50] <erickt> so we could get some nice wins if we instead either used a trie-like comparison chain, but I wonder if doing a perfect hash would be even faster
[05:28:00] <erickt> hehe
[05:28:04] <Yurumechan> so it has no advantage over traditional hash truncation
[05:28:05] <eddyb> erickt: sadly, we're not working with Mills which let you match "abXX" against "ab" where XX are bytes in unallocated space
[05:28:20] <erickt> very sad
[05:28:32] <Yurumechan> it will, however, shine when you need to rehash every time resizing occurs
[05:28:32] *** Joins: gsingh93 (gulshan@moz-3fu4am.mi.comcast.net)
[05:28:37] <erickt> I wish the mills was real
[05:28:44] <eddyb> their speculative demos read 32 bytes per iteration
[05:28:45] *** Quits: zeiris (zeiris@moz-8jbmam.letter.agency) (Ping timeout: 121 seconds)
[05:29:05] <eddyb> with no fallback case
[05:29:08] <sfackler> erickt: it could definitely perform better
[05:29:21] <sfackler> but note that I've done basically no optimization of rust-phf's hashing algorithms
[05:29:44] <eddyb> erickt: v8 has manually written trie-like tokenizer states
[05:29:46] *** Joins: zeiris (zeiris@moz-8jbmam.letter.agency)
[05:29:46] <erickt> how long does it take to calculate one of those tables?
[05:29:50] <sfackler> I did see this though - might read over it and see if there are any good ideas there http://blogs.perl.org/users/rurban/2014/08/perfect-hashes-and-faster-than-memcmp.html
[05:30:09] <sfackler> erickt: html5ever has a ~20,000 node map that takes like < .1 to compile
[05:30:15] <sfackler> er, generate
[05:30:19] <erickt> yeah that's the article that got me inspired :)
[05:30:35] <eddyb> erickt: for us... there could be a TR state leading to TRUE, TRAIT, or some arbitrary identifier
[05:30:58] <sfackler> the ~250 node map in rust-postgres take like a couple milliseconds I think
[05:31:16] <erickt> sfackler: that's not expensive at all. I wonder if it'd be worth trying to get it into trans
[05:31:26] <erickt> eddyb: exactly :)
[05:31:37] <sfackler> ah, sorry the big one is a 100,000 node map in < .5 seconds
[05:31:52] <sfackler> yeah could be
[05:31:59] <sfackler> it does add some overhead space-wise
[05:32:41] <sfackler> 8 bytes per string I think right now
[05:32:41] <erickt> oh? how much?
[05:32:46] <theme> Are there any plans to make `#[derive(Ord)]` imply `#[derive(PartialEq, Eq, PartialOrd, Ord)]`?
[05:32:56] <erickt> sfackler: on top of the string length?
[05:32:59] <sfackler> yeah
[05:33:11] <eddyb> theme: it... has to, if they're unsafe impls. cc nmatsakis, acrichto
[05:33:13] <sfackler> to store this table: https://github.com/sfackler/rust-phf/blob/master/phf/src/map.rs#L22
[05:33:19] <eddyb> theme: there might be a RFC issue thread
[05:33:30] <theme> eddyb, eh? why?
[05:33:38] <theme> eddyb, you are talking about my RFC, right?
[05:33:52] <eddyb> theme: mmaybe, if you wrote one about unsafe Eq/Ord
[05:33:56] <theme> yes
[05:34:06] <Yurumechan> wild idea: allow #[study] or #[try_harder] attr which examines the AST harder and potentially come up with an optimized alternative like perfect hashing for match
[05:34:25] <theme> Certain alternatives would get pretty messy if we don't have that
[05:34:29] <eddyb> Yurumechan: > AST
[05:34:33] <Yurumechan> afaik perl has study expr :p
[05:34:49] <Yurumechan> (for regex)
[05:34:55] <eddyb> Yurumechan: you probably want to run a superoptimizer like what Regehr is working on
[05:35:00] <Yurumechan> haha
[05:35:02] <Yurumechan> but no
[05:35:02] <erickt> sfackler: that's not too bad either.
[05:35:14] <eddyb> Yurumechan: I am serious
[05:35:24] <Yurumechan> I'm thinking more about ast-to_ast transform
[05:35:49] <erickt> Yurumechan: but I'm pretty sure that's superoptimization :)
[05:36:05] <eddyb> Yurumechan: AST sucks
[05:36:26] <eddyb> I'm sorry, but that's the truth, it's almost useless for such things
[05:36:29] <sfackler> erickt: actually now that I think about it it's a pretty big code size win anyway because the function's no longer a ginormo memcmp chain
[05:36:31] <erickt> eddyb: weren't you also working on a rust ir :)
[05:36:38] <eddyb> erickt: no, aatch was
[05:36:59] *** Quits: O01eg (o01eg@moz-vnl.it5.194.109.IP) (Client exited)
[05:37:00] <eddyb> erickt: I have only tried (and failed) to cleanup trans in preparation of that IR
[05:37:06] <erickt> aatch, my optimization hero
[05:37:13] <Yurume> eddyb: I value --pretty expanded -ability of such transformation :p
[05:37:15] <eddyb> well, I'm doing some DST right now, which kinda counts
[05:37:29] <Yurume> so that you have a better idea whether the compiler messed up or not
[05:37:41] <eddyb> Yurume: MIR -> AST is far more valuable
[05:37:51] <eddyb> because you can then know whether typeck messed up or not, too
[05:38:08] <eddyb> and eventually visualize *all* lifetimes
[05:38:30] <eddyb> Yurume: I almost replaced ast::Expr the other day with a stack machine bytecode
[05:38:37] <Yurume> possible.
[05:38:40] <eddyb> but I couldn't figure out a nice way to do function calls
[05:38:44] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[05:38:54] <eddyb> that was easy to pretty-print and whatnot
[05:41:43] <erickt> speaking of IR, the scala folks just announced they're making their own intermediate format that lets them target javascript and the jvm
[05:41:51] <eddyb> smart
[05:45:25] <erickt> sfackler: either way I should probably use phf in serde. Should be a nice speedup identifying fields
[05:46:22] *** Joins: dinfuehr (dinfuehr@moz-oq92c2.highway.telekom.at)
[05:46:23] <eddyb> erickt: btw, I want to get rid of RustcEncodable/RustcDecodable, using just macro_rules
[05:46:43] <erickt> you've mentioned that!
[05:46:50] <erickt> good luck :)
[05:47:00] <eddyb> erickt: and then diverging the rustc-serialize crates.io library (while deprecating it) and the built-in one
[05:47:34] <theme> ping Gankro, sfackler, reem
[05:47:37] <erickt> the macros I had to write for serde are pretty nasty: https://github.com/erickt/rust-serde/blob/master/serde_macros/src/de.rs
[05:47:52] <eddyb> erickt: I am talking about the old stuff
[05:47:57] <erickt> yeah
[05:48:01] <theme> I have changed my mind about the unsafe comparison traits RFC
[05:48:03] <theme> https://github.com/rust-lang/rfcs/pull/956#issuecomment-83343460
[05:48:09] <eddyb> erickt: I am kinda hoping someone else can do it, because I'm already spending more than than I have on other random things
[05:48:43] <eddyb> erickt: I thought I looked at the output and told you it can be done with simple rules
[05:49:09] <eddyb> erickt: it's really hard to read syntax extension code
[05:49:40] <erickt> it's hard to write too :)
[05:49:51] <erickt> I think it's a little easier with aster though
[05:50:56] <eddyb> erickt: do you have a gist of a complete "feature demo"?
[05:51:04] <eddyb> erickt: i.e. expanded output for any possible case
[05:51:26] <erickt> eddyb: of something fully expanded? no, but I can make one for you
[05:51:52] <eddyb> erickt: input and output and I will attempt to derive a macro_rules implementation :P
[05:52:08] <eddyb> erickt: without solving hard AI ;;)
[05:52:46] <erickt> eddyb: I didn't try formatting it, but this is my macro stress test: https://gist.github.com/erickt/19075c628c9d31ad0bf4
[05:53:22] <erickt> eddyb: here's it unexpanded: https://github.com/erickt/rust-serde/blob/master/tests/test_macros.rs
[05:53:31] <eddyb> erickt: thanks!
[05:53:54] <eddyb> erickt: derive(serialize) works now, no?
[05:54:01] <erickt> does it?
[05:54:02] <erickt> neat
[05:54:06] *** Quits: dinfuehr (dinfuehr@moz-oq92c2.highway.telekom.at) (Connection closed)
[05:54:13] <erickt> I'm so far behind on what's up in rust
[05:54:16] <eddyb> you should use uppercase there if it just works
[05:54:31] <eddyb> (as in, rename the attribute in your syntax extension)
[05:55:19] <erickt> so define it as derive_Serialize?
[05:55:21] <erickt> I'll try it
[05:55:25] *** Joins: dinfuehr (dinfuehr@moz-oq92c2.highway.telekom.at)
[05:55:29] <eddyb> yeah and use it like derive(Serialize)
[05:55:39] <eddyb> erickt: dammit I forgot about the bounds :|
[05:56:05] <erickt> yeah that's one of the hard bits. bounds and where clauses were the reason I wrote aster
[05:56:18] <erickt> it was just so messy dealing with them with raw ast
[05:56:21] <eddyb> erickt: it would still work for everything in rustc
[05:56:29] <eddyb> because it's pretty primitive
[06:00:09] <acrichto> erickt: pong
[06:01:12] <erickt> acrichto: good evening! So remember that speedup to the Write methods I mentioned a bit ago? I think it might just be a question of putting #[inline] on the Write impls
[06:01:58] <acrichto> erickt: interesting!
[06:02:35] <erickt> I'm doing a rust build now with #[inline] to verify. I think we had inlines on std::io_old, so that might be my performance hit.
[06:02:39] *** Joins: Nekit1234007 (nekit@moz-2vpc3e.broadband.iskratelecom.ru)
[06:03:34] <carllerche> erickt: I noticed explicit inlining sometimes provided huge boosts, i wonder why the compiler didn't inline originally
[06:03:46] <erickt> I just wanted to check if you had any sense of when it makes sense to inline and not inline things
[06:04:14] <erickt> carllerche: by explicit inlining, do you mean with #[inline]? or actually copying the code locally?
[06:04:26] <carllerche> #[inline]
[06:08:20] <erickt> gotcha. yeah I know years ago I went on a wild #[inline] spree without much supporting evidence
[06:08:38] <erickt> it probably makes sense to remove most of them, but I'm sure there are some critical functions that should get them
[06:10:01] <eddyb> erickt, acrichto: apparently I can use where clauses for Decodable/Encodable impls if I add back the Encoder/Decoder type param to the trait
[06:10:10] <eddyb> because it would look like int: Decodable<D>
[06:10:17] <erickt> acrichto: anyway, here's my test microbenchmark that suggests a 10% speedup with #[inline]: https://gist.github.com/erickt/eb1a6d1d789dc3078be7
[06:10:17] <eddyb> which is valid, as the impl is generic over D
[06:10:44] <erickt> acrichto: foo0 is essentially what we have, and foo2 is that weird hack that seemed to be faster
[06:10:48] <eddyb> acrichto: was there any logic for the move to method-level generics in Encodable/Decodable?
[06:10:54] *** Joins: zippity (Mibbit@moz-juv.9o3.252.72.IP)
[06:10:56] <eddyb> acrichto: I only know it broke nice usecases
[06:12:25] <erickt> eddyb: I wasn't involved when acrichto removed the typaram, but I think part of it was that no one ended up writing an Encodable that was only implemented for a specific Encoder
[06:12:37] <eddyb> erickt: NBT
[06:12:41] <erickt> eddyb: so user experience was a bit better
[06:12:49] <erickt> NBT?
[06:12:51] <eddyb> except for anyone who cared...
[06:12:57] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Connection closed)
[06:13:35] <erickt> I've always wanted to play with them (and I think burntsushi's cbor's tagged types makes a compelling argument for them)
[06:14:08] <erickt> but I figured if I get serde working well enough I'll kill off rustc-serialize so I didn't think it was worth the effort to convince acrichto to add them back :)
[06:14:29] <eddyb> erickt: if you have the chance of doing something similar in serde, you can sidestep the issue entirely
[06:14:36] <eddyb> the non-generic where clause thing
[06:14:51] <erickt> how so?
[06:15:05] <erickt> see all these new fangled things you kids have these days
[06:15:08] <eddyb> `where int: Decodable<D>`
[06:15:21] <eddyb> if D is a generic type param, that's always valid
[06:15:30] <eddyb> no matter the LHS
[06:16:30] <eddyb> I may have also seen tuple tricks
[06:16:51] <erickt> ah
[06:17:27] <erickt> oh, so one thing I am doing that might make it tricky to make `trait Deserialize<D> { ... }` unfortunate
[06:17:30] <eddyb> which... would work nicely, lol
[06:17:40] *** Quits: zippity (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[06:17:40] <eddyb> (int, T, U, V): Trait
[06:17:56] <eddyb> no, it wouldn't work, nvm
[06:17:57] <erickt> is that I'm actually using multiple deserializers to deserialize things
[06:18:38] <eddyb> erickt: well, your workflow is different, so it's understandable if you can't use the same trick
[06:18:52] <erickt> eddyb: for example: https://github.com/erickt/rust-serde/blob/master/src/json/de.rs#L590
[06:18:55] <erickt> yeah
[06:18:59] <erickt> but I do want it
[06:19:45] <erickt> my only worry is that if we do end up getting some form of specialization that I could box myself out of being able to use it
[06:21:54] <acrichto> erickt: ah sorry stepped out for a bit, but I've found that if you think you need #[inline] the best way to validate it quickly is to compile with `-Clto`
[06:22:05] <acrichto> b/c if we LTO everything and LLVM would otherwise inline it then it'll do it in that case
[06:22:45] <erickt> acrichto: can I pass -Clto through `cargo bench`?
[06:23:01] <acrichto> erickt: [profile.bench] lto = true
[06:25:08] *** Quits: theme (theme@moz-i3mhhb.asianet.co.th) (Ping timeout: 121 seconds)
[06:26:36] *** Quits: eddyb (eddyb@moz-l1n.kjd.26.188.IP) (Ping timeout: 121 seconds)
[06:26:49] *** Joins: theme (theme@moz-i3mhhb.asianet.co.th)
[06:30:15] *** Quits: dinfuehr (dinfuehr@moz-oq92c2.highway.telekom.at) (Connection closed)
[06:33:29] <Manishearth> acrichto: could you close:
[06:33:30] <Manishearth> 30718dd44be229a5c61648a4aed6711441ef7b6d
[06:33:37] <Manishearth> whoops
[06:33:37] <Manishearth> https://github.com/rust-lang/rust/pull/23497#issuecomment-83360775
[06:33:41] <Manishearth> https://github.com/rust-lang/rust/pull/23497#issuecomment-83360775
[06:33:45] <Manishearth> https://github.com/rust-lang/rust/pull/23496#issuecomment-83360965
[06:33:47] *** Joins: summerlight_ (summerlight@moz-99k.2mj.130.121.IP)
[06:33:50] <Manishearth> https://github.com/rust-lang/rust/pull/23494#issuecomment-83361270
[06:33:55] <Manishearth> https://github.com/rust-lang/rust/pull/23493#issuecomment-83361393
[06:33:59] <Manishearth> https://github.com/rust-lang/rust/pull/23490#issuecomment-83361537
[06:34:06] <Manishearth> please?
[06:34:15] <Manishearth> somehow github didn't detect the rollup merging
[06:34:22] <Manishearth> for those PRs
[06:35:22] <Manishearth> *sigh* one of my rebases became a cherrypick brigade due to some side effect of a git rebase flag
[06:35:33] <Manishearth> that's why
[06:35:57] <Manishearth> (git doesn't update the diff either, even though the merge is a noop)
[06:38:18] *** Joins: guewen (guewen@moz-ftf7u4.cust.swisscom.ch)
[06:38:32] *** Quits: Gankro (uid71432@moz-sc2bd6.charlton.irccloud.com) (Quit: Connection closed for inactivity)
[06:39:24] <Manishearth> oh, past midninght for you
[06:39:25] <Manishearth> hm
[06:39:39] <Manishearth> erickt: ?
[06:40:03] <Manishearth> wait no you too
[06:40:09] <erickt> Manishearth: right back you
[06:40:10] <erickt> oh
[06:40:12] <erickt> nevermind them
[06:40:14] <erickt> then
[06:40:23] <Manishearth> erickt: could you close them?
[06:40:30] <Manishearth> (thought you would be asleep :P )
[06:41:00] <erickt> just about to go to bed
[06:41:10] <Manishearth> ah nvm then
[06:41:20] * Manishearth waits for Europe to wake up
[06:41:26] <erickt> but that's odd, github usually closes things when they've been committed
[06:41:30] <Manishearth> or wait, nrc
[06:41:35] <erickt> :)
[06:41:38] <erickt> good luck!
[06:41:39] <Manishearth> erickt: so if you cherry pick, it doesn't notice
[06:41:58] *** Joins: eddyb (eddyb@moz-0eb.2kg.166.109.IP)
[06:41:58] <Manishearth> and what happened here was effectively the same as a cherry pick (though how it happend is still a mystery)
[06:42:32] <Manishearth> the strange thing is is that github is not showing those PRs as having 0 changes, even though a git rebase master; git push -f would make them noop PRs
[06:42:39] <Manishearth> eddyb: wanna close some PRs?
[06:42:53] <sfackler> i got it
[06:42:57] <Manishearth> yay thanks
[06:43:17] <nrc> Manishearth: hmmm?
[06:43:36] <Manishearth> (I'm being a bit insistent now since I need to take a nap and by the time I get back some of those might have reached the top of the queue, nto good)
[06:43:44] <eddyb> nmatsakis: I meant to ask you something about Unsize.. 
[06:43:45] <sfackler> should be all of them?
[06:43:48] <Manishearth> nrc: nvm, sfackler got it
[06:44:04] <nrc> cool
[06:44:25] <Manishearth> sfackler: https://github.com/rust-lang/rust/pull/22631
[06:44:59] <eddyb> nmatsakis: hehe I think I figured it out. traits::select can return custom data for builtin impls, no?
[06:45:08] <Manishearth> but yeah, that should be it aside from gh22631
[06:45:08] <[o__o]> Allow Float::ldexp to be called as a method: https://github.com/rust-lang/rust/pull/22631
[06:45:21] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[06:45:24] <eddyb> for structs I just need the leaves
[06:45:38] <Manishearth> sfackler: sorry, https://github.com/rust-lang/rust/pull/23495
[06:45:47] <Manishearth> 22631 should be kept open
[06:46:04] <Manishearth> (they all have comments at the bottom with a link to the commit which should have closed them)
[06:46:12] <reem> WindowsBunny: ping
[06:46:35] *** Joins: killercup (killercup@moz-edmf2j.dip0.t-ipconnect.de)
[06:46:37] <eddyb> nrc: can you confirm my hypothesis about traits::select?
[06:46:57] <WindowsBunny> reem: pang
[06:47:23] <eddyb> i.e that I can just return BuiltinUnsize(...)
[06:47:30] <reem> WindowsBunny: I'm struggling to understand how it's possible to use completion-based io without allocating.
[06:47:50] <Manishearth> sfackler: thanks :)
[06:47:59] <WindowsBunny> reem: It pretty much requires a 'static lifetime on the buffer :(
[06:48:08] <reem> Ya, that's what I'm realizing.
[06:48:23] <reem> That's kind of an unfortunate design, isn't it?
[06:49:01] <WindowsBunny> reem: It's what we've got, so we've got to make the best of it
[06:49:13] <WindowsBunny> Actually, I could probably abuse the shit out of traits
[06:49:30] <WindowsBunny> hmmm
[06:49:35] <eddyb> reem: would be nice if carllerche's planned high-level IO lib wouldn't allocate closures
[06:49:42] <eddyb> (I have seen no design)
[06:49:52] <carllerche> eddyb: seems hard :)
[06:50:24] <carllerche> eddyb: do you mean w/o allocating for the closures on top of the underlying future / stream?
[06:50:30] <eddyb> callbacks are terribad, mkay?
[06:50:53] <carllerche> eddyb: unless you are bound to a single stack, you kind of have to allocate somewhere
[06:51:06] *** Quits: theme (theme@moz-i3mhhb.asianet.co.th) (Quit: Leaving)
[06:51:09] <reem> It's really not possible to avoid allocation entirely.
[06:51:23] <eddyb> carllerche: I haven't seen no mio/wio API comparison so I can't be certain
[06:51:36] <reem> WindowsBunny: I would love to see a design if you had time, I've been struggling to see how it could be made nice with low overhead.
[06:51:47] <WindowsBunny> reem: I'm working on it :P
[06:51:56] <WindowsBunny> I'll implement two example File APIs
[06:52:04] <WindowsBunny> one with callback async, the other with IOCP async
[06:52:04] <eddyb> I guess what I need is WIP
[06:52:15] <carllerche> eddyb: my future / stream stuff allocates (at least) once per instance of a Future or a Stream
[06:52:59] *** Joins: theme (theme@moz-i3mhhb.asianet.co.th)
[06:54:55] *** Quits: killercup (killercup@moz-edmf2j.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[06:55:01] <eddyb> carllerche: what would that mean, concretely, in a HTTP static file server?
[06:55:16] *** Joins: dinfuehr (dinfuehr@moz-oq92c2.highway.telekom.at)
[06:55:46] <reem> eddyb: It's possible to write a Future-based API that doesn't allocate the actual data being read and written.
[06:55:48] <carllerche> eddyb: depends on how complicated the logic is obviously
[06:55:59] <WindowsBunny> reem: The biggest hurdle though, is that I need to have a 'static OVERLAPPED struct passed along with each async call
[06:56:02] <carllerche> eddyb: a tcp socket will have 2 associated streams, so 2 allocations
[06:56:14] <WindowsBunny> reem: and since you can do multiple async calls on a given handle, that means I have to allocate for each call
[06:56:16] <carllerche> eddyb: buffers will be preallocated from a slab, so no allocs at runtime
[06:56:37] <carllerche> eddyb: simple ops on the stream won't allocate, but some will have to, so it depends now much the streams are manipulated
[06:56:39] <eddyb> carllerche: hmm, round-robin?
[06:56:49] <carllerche> eddyb: what round robin?
[06:56:52] <eddyb> or, not really
[06:57:05] <eddyb> multiplexing streams on buffers
[06:57:17] <WindowsBunny> reem: At best I could allocate them from an arena
[06:58:03] <reem> WindowsBunny: If allocations are unavoidable on windows that means there's no hope for a cross-platform API that doesn't.
[06:58:25] <carllerche> eddyb: well, there will be a buffer pool, handles will most likely be ref counted so that they automatically get returned
[06:58:27] <eddyb> carllerche: i.e. does the number of buffers in use stay relatively constant, and connections just use buffers as they need to?
[06:58:38] <carllerche> eddyb: that's how i plan to do it
[06:58:59] <eddyb> because you can't fill a thousand buffers at once
[06:59:18] <carllerche> eddyb: well, buffer handles get passed in the streams
[06:59:36] <eddyb> (watch me be wrong because of some internet backbone technology)
[06:59:42] <eddyb> I guess mrmonday would know
[07:00:07] <carllerche> when data is ready on a socket, it would fill a buffer and send the handle over a stream
[07:01:02] <eddyb> so the stream could be a channel on top of mio?
[07:01:30] <eddyb> coupled with a thread pool, I can definitely see it working
[07:01:31] <WindowsBunny> reem: with callback based IO it is inevitable due to needing to box the callback
[07:01:36] <carllerche> eddyb: it will be a syncbox stream, which is richer
[07:01:47] <eddyb> carllerche: can those be reused?
[07:01:55] <carllerche> https://github.com/carllerche/syncbox/blob/master/src/util/async/stream.rs for now
[07:02:19] <eddyb> so after saturation you stop allocating
[07:02:25] <WindowsBunny> reem: Unless we want to restrict people to plain fn without any state
[07:02:38] <WindowsBunny> which is _really_ hard to work with
[07:02:46] <carllerche> eddyb: potentially
[07:02:51] <eddyb> mmmm
[07:02:58] <reem> WindowsBunny: I meant allocation of the data
[07:03:23] <carllerche> eddyb: the internal state machine knows when it is done and prior handles are gone
[07:03:30] <eddyb> carllerche: can this work on windows?
[07:03:42] <reem> Sure.
[07:03:48] <carllerche> eddyb: yes, it's designed to handle the iocp abstraction... 
[07:04:03] <WindowsBunny> reem: for the buffer itself we can either ask the user to provide us a buffer or use a buffer from a pool
[07:04:05] <Murarth> So, is it too late to propose any changes to std::net?
[07:04:15] <WindowsBunny> Murarth: Beta isn't out yet!
[07:04:24] <eddyb> carllerche: I really want to try out reusing *everything*
[07:04:30] *** Quits: gsingh93 (gulshan@moz-3fu4am.mi.comcast.net) (Ping timeout: 121 seconds)
[07:04:31] <Murarth> I just find the removal of IpAddr and the change of lookup_host to return SocketAddr a bit weird.
[07:04:43] <carllerche> eddyb: while I agree, at a certain point you don't want to re-implement jemalloc :P
[07:04:49] <eddyb> yes and no
[07:05:13] <carllerche> i plan on doing whatever I can do for low overhead, but w/o sacrificing an ergonomic API
[07:05:23] <carllerche> eddyb: this is what a TCP proxy could look like: http://slides.com/carllerche/rust-io-meetup#/7/4
[07:05:52] <eddyb> carllerche: strcat successfuly implemented a subset of jemalloc with some ridiculous improvements on certain benchmarks
[07:05:58] <eddyb> a few orders of magnitude
[07:06:18] <carllerche> eddyb: basically, if dealing w/ a large set of uniformly sized types, you can do much better
[07:06:29] <carllerche> but, beyond that... i don't really think there is much win
[07:07:00] <carllerche> the Stream<Bytes> type could be re-used since there will be many of them
[07:07:24] <eddyb> mmm
[07:07:39] <eddyb> carllerche: you're composing generators? cool
[07:09:11] <eddyb> I guess it entirely sidesteps the issue of polymorphic yield
[07:09:39] <carllerche> eddyb: what do you mean by that?
[07:10:25] <eddyb> x = yield y; where the type of x depends on the type of y
[07:10:43] <eddyb> and not all yields have the same types
[07:11:29] <eddyb> may need GADTs
[07:12:06] <eddyb> *all yields within a function
[07:12:27] <eddyb> well, generator, not function... you get the idea :P
[07:12:59] <reem> Language issue: it's not possible to call a UFCS method through a trait object.
[07:13:11] <eddyb> reem: example?
[07:13:27] <eddyb> trait objects do implement their actual traits
[07:13:30] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[07:13:34] <eddyb> reem: a static method?
[07:13:45] <reem> pub trait HeaderMarker { fn header_name() -> &'static str; }
[07:13:52] <reem> can't call header_name if I have a Box<HeaderMarker>
[07:14:01] <eddyb> that's a static method, UFCS is call syntax
[07:14:12] <reem> Yes
[07:14:13] <eddyb> reem: it's problematic
[07:14:14] <reem> ok
[07:14:25] <eddyb> it would have to work like a non-static method
[07:14:49] <eddyb> mmaybe we should allow regular method call syntax for all static methods
[07:15:19] <eddyb> we kinda need trait_obj.CONST
[07:16:07] <reem> It's also possible to refactor the trait to instead take self and just be implemented on zero-sized-types by convention.
[07:16:20] <reem> s/self/&self/
[07:16:35] <carllerche> eddyb: anyway, this is still a work in progress.. the TCP lib is getting there, but still pretty rough. I'm currently trying to get the future / stream primitives in shape
[07:17:57] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Ping timeout: 121 seconds)
[07:25:53] *** Quits: untitaker (untitaker@moz-m10bh3.highway.telekom.at) (Ping timeout: 121 seconds)
[07:27:36] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[07:30:01] *** Quits: dinfuehr (dinfuehr@moz-oq92c2.highway.telekom.at) (Connection closed)
[07:30:55] *** Quits: c0170 (c0170@moz-4stj9o.cable.virginm.net) (Ping timeout: 121 seconds)
[07:30:58] *** Joins: untitaker (untitaker@moz-lh5b29.highway.telekom.at)
[07:33:59] *** Quits: njn (chatzilla@moz-sqinim.iinet.net.au) (Quit: ChatZilla 0.9.91.1 [Firefox 39.0a1/20150315153114])
[07:34:01] *** Joins: lfairy (lfairy@moz-hk2b0q.vf.net.nz)
[07:34:17] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[07:38:04] <eddyb> nmatsakis: a comment in typeck suggests a reborrow is necessary for x == y where those are &T with different lifetimes
[07:38:12] <eddyb>  nmatsakis have we not solved this?
[07:39:59] *** Quits: lfairy (lfairy@moz-hk2b0q.vf.net.nz) (Ping timeout: 121 seconds)
[07:40:13] <eddyb> (using impls)
[07:42:28] *** Joins: lfairy (lfairy@moz-hk2b0q.vf.net.nz)
[07:43:13] *** Joins: squiddy (squiddy@moz-md4.pm3.19.178.IP)
[07:45:24] *** Joins: kushal (kdas@moz-k3qqn7.202.sitibroadband.in)
[07:46:44] *** Quits: sprang (sprang@moz-bll05b.zoominternet.net) (Ping timeout: 121 seconds)
[07:47:24] *** Joins: c0170 (c0170@moz-bb29a4.cambridge.arm.com)
[07:48:00] *** Joins: eddyb_ (eddyb@moz-0eb.2kg.166.109.IP)
[07:50:30] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[07:51:00] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[07:55:01] <WindowsBunny> reem: Harass me daily to work on wio please
[07:55:12] <reem> oh? link?
[07:55:32] <WindowsBunny> reem: https://github.com/retep998/wio-rs
[07:55:47] <reem> you should get rid of the -rs
[07:56:04] <reem> imo
[07:56:23] <WindowsBunny> I suffix all my rust stuff with -rs to make it easier to find in my repo list
[07:56:42] *** Quits: eddyb (eddyb@moz-0eb.2kg.166.109.IP) (Quit: Bye)
[07:56:46] <theme> eh?
[07:56:49] <theme> is wio like mio?
[07:57:04] <reem> I do the same thing by prefixing with rust-, but I omit it for big or particularly interesting projects
[07:57:06] <WindowsBunny> theme: it's the windows equivalent, heavily WIP
[07:58:31] <theme> ^_^
[08:02:30] *** Joins: zmack (zmack@moz-gn3.aat.233.213.IP)
[08:04:38] *** Quits: c0170 (c0170@moz-bb29a4.cambridge.arm.com) (Connection closed)
[08:06:52] *** Quits: Nekit1234007 (nekit@moz-2vpc3e.broadband.iskratelecom.ru) (A TLS packet with unexpected length was received.)
[08:07:35] *** Joins: Nekit1234007 (nekit@moz-2vpc3e.broadband.iskratelecom.ru)
[08:16:14] *** Quits: zmack (zmack@moz-gn3.aat.233.213.IP) (Connection closed)
[08:16:54] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[08:21:37] *** Joins: killercup (killercup@moz-4udt1b.dip0.t-ipconnect.de)
[08:26:01] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[08:28:07] *** Joins: arrrrrrrrr (arrrrrrrrs@moz-vimofl.dynamic.qsc.de)
[08:30:25] *** Quits: eddyb_ (eddyb@moz-0eb.2kg.166.109.IP) (Ping timeout: 121 seconds)
[08:33:41] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Quit: )
[08:38:07] *** Quits: arrrrrrrrr (arrrrrrrrs@moz-vimofl.dynamic.qsc.de) (Ping timeout: 121 seconds)
[08:39:05] *** Joins: larhat (Adium@moz-8v4.af0.232.213.IP)
[08:40:26] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[08:41:16] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[08:45:00] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[08:47:55] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[08:49:31] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[08:52:10] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[08:54:08] *** Quits: lfairy (lfairy@moz-hk2b0q.vf.net.nz) (Connection closed)
[08:56:33] *** Joins: imperio (Mibbit@moz-opqtbe.abo.bbox.fr)
[08:59:06] *** Quits: adu (ajr@moz-0foa9t.md.comcast.net) (Client exited)
[09:03:39] *** Quits: squiddy (squiddy@moz-md4.pm3.19.178.IP) (A TLS packet with unexpected length was received.)
[09:04:17] *** Joins: squiddy (squiddy@moz-md4.pm3.19.178.IP)
[09:06:43] *** Quits: squiddy (squiddy@moz-md4.pm3.19.178.IP) (A TLS packet with unexpected length was received.)
[09:07:13] *** Joins: squiddy (squiddy@moz-md4.pm3.19.178.IP)
[09:11:01] *** Quits: apoelstra (username@moz-pvbasl.net) (Ping timeout: 121 seconds)
[09:12:23] *** Joins: munksgaard (munksgaard@moz-vj4.hq0.225.130.IP)
[09:12:59] *** Joins: zmack (zmack@moz-1oe.89t.76.82.IP)
[09:14:08] *** Joins: aepsil0n (eduard@moz-s4dovi.73sq.ctqi.8071.2a02.IP)
[09:17:39] *** Joins: marsel (user@moz-0kd.g6r.180.94.IP)
[09:18:43] *** Quits: reem (reem@moz-o83ume.coob.q2h1.0009.2601.IP) (Connection closed)
[09:22:53] *** Joins: apoelstra (username@moz-pvbasl.net)
[09:23:19] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Connection closed)
[09:30:27] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[09:30:31] <mrmonday> there's quite a lot of backlog to read through there, if someone wants to fill me in I'll help if I can
[09:30:45] <mrmonday> (eddyb pinged me)
[09:35:09] *** Joins: Sindriava (textual@moz-pk3ipm.fit.cvut.cz)
[09:38:34] *** Joins: laumann (thomas@moz-1f0.hq0.225.130.IP)
[09:39:11] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[09:40:45] *** Quits: marsel (user@moz-0kd.g6r.180.94.IP) (Ping timeout: 121 seconds)
[09:43:41] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[09:49:10] *** Joins: simukis (nagisa@moz-pol184.mif.vu.lt)
[09:49:27] *** Quits: Sindriava (textual@moz-pk3ipm.fit.cvut.cz) (Quit: My Mac has gone to sleep. ZZZzzz…)
[09:56:05] *** Quits: nrc (nrc@moz-4bhi2i.xtra.co.nz) (Connection closed)
[10:00:16] <theme> Is there any github issue for rustdoc not showing inherent methods on primitive types
[10:00:23] <theme> I mean, search cannot find them
[10:01:13] <theme> by search, I meant rustdoc search
[10:01:53] <kimundi> theme: Which kinds of methods are you thinking of? Afaik primitive types get all their methods from traits
[10:02:08] <theme> kimundi, not now
[10:02:16] <theme> kimundi, that recently changed
[10:02:18] <theme> did it?
[10:02:23] <kimundi> did it?
[10:03:04] <theme> kimundi, https://github.com/rust-lang/rust/pull/23104
[10:03:26] <theme> changed 2 days ago
[10:03:39] <theme> apparently this caused a bug in rustdoc
[10:03:52] <kimundi> Oh, nice!
[10:03:57] <kimundi> Yeah I bet
[10:05:03] <theme> apparently nobody filed this yet
[10:05:05] <theme> I'll file it
[10:06:09] *** Joins: marsel (user@moz-o0t.pfd.255.92.IP)
[10:08:52] <theme> kimundi, https://github.com/rust-lang/rust/issues/23511
[10:08:57] <theme> filed an issue
[10:17:30] *** Quits: sinclair (chatzilla@moz-o36q4q.xnet.co.nz) (Connection closed)
[10:33:19] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[10:33:29] *** Quits: rprichard (rprichard@moz-b05bme.en8f.d045.0009.2601.IP) (Connection closed)
[10:35:22] *** Joins: rustical (dida@moz-55rvi2.dclient.hispeed.ch)
[10:37:50] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[10:55:59] *** Quits: zmack (zmack@moz-1oe.89t.76.82.IP) (Connection closed)
[11:04:47] *** Joins: kmcguire_ (kmcguire@moz-pg1gb9.biz.rr.com)
[11:05:20] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[11:09:50] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[11:12:33] *** Joins: larhat1 (Adium@moz-8v4.af0.232.213.IP)
[11:15:09] *** Quits: larhat (Adium@moz-8v4.af0.232.213.IP) (Ping timeout: 121 seconds)
[11:20:55] *** Joins: arrrrrrrrr (arrrrrrrrs@moz-vimofl.dynamic.qsc.de)
[11:35:34] *** Joins: fuogosqqe (Mibbit@moz-juv.9o3.252.72.IP)
[11:37:04] *** Quits: simukis (nagisa@moz-pol184.mif.vu.lt) (Ping timeout: 121 seconds)
[11:39:42] *** Joins: nrc (nrc@moz-4bhi2i.xtra.co.nz)
[11:39:42] *** ChanServ sets mode: +o nrc
[11:44:43] *** Quits: nrc (nrc@moz-4bhi2i.xtra.co.nz) (Ping timeout: 121 seconds)
[11:48:18] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[11:51:09] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[11:51:20] *** Quits: fuogosqqe (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[11:54:27] *** Joins: bjz (bjz@moz-puppgq.tpgi.com.au)
[11:55:54] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[11:58:23] *** Quits: killercup (killercup@moz-4udt1b.dip0.t-ipconnect.de) (Quit: Bye)
[11:59:31] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[12:00:05] *** Quits: ctennis (ctennis@moz-vcpg3c.in.comcast.net) (Quit: Leaving...)
[12:04:00] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[12:07:44] *** Joins: eibwen (eibwen@moz-044opj.dip0.t-ipconnect.de)
[12:09:24] <huon> aturon: I didn't get a chance to play with implementing/experimenting more with your proposal today, unfortunately :( tomorrow hopefully...
[12:11:14] *** Joins: ctennis (ctennis@moz-su6.e72.137.99.IP)
[12:11:23] *** Joins: zmack (zmack@moz-1oe.89t.76.82.IP)
[12:12:46] *** Joins: eddyb_ (eddyb@moz-l1n.kjd.26.188.IP)
[12:19:06] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[12:23:31] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Ping timeout: 121 seconds)
[12:28:13] *** Quits: doener (doener@moz-cpsld2.hsi08.unitymediagroup.de) (Connection closed)
[12:37:44] <theme> Excuse me
[12:37:53] <theme> why does String implement FromStr with Err = ()?
[12:38:03] <theme> why not something like ParseStringError?
[12:38:36] <arrrrrrrrr> theme: what great errors do you expect when parsing a string from a string?
[12:38:46] <theme> arrrrrrrrr, compile errors in my code :(
[12:39:17] <theme> I got a long search for an error caused by this in a large macro
[12:39:24] <theme> " error: the trait `core::error::FromError<()>` is not implemented for the type `blahblah`"
[12:40:26] <theme> Seriously, implementing FromError<()> feels useless -_-
[12:43:09] <eddyb_> theme: hah, I see the problem
[12:43:21] <theme> eh?
[12:46:00] <theme> Maybe we should make Err = NonexistentStringParseError
[12:46:09] <theme> enum NonexistentStringParseError {}
[12:46:19] <theme> lol
[12:46:39] <eddyb_> theme: if only we had good rules for those...
[12:46:45] <theme> *_*
[12:46:59] <eddyb_> then you wouldn't need to implement anything
[12:47:08] <eddyb_> because the Err path would never be taken
[12:47:12] <theme> yes
[12:47:24] <theme> and implement boilerplace with unreachable!()?
[12:47:36] <eddyb_> not really...
[12:47:48] <eddyb_> theme: but generics are not protected *shrug*
[12:47:52] <theme> Like traits for .unwrap()
[12:48:02] <eddyb_> you need an Inhabited trait like Sized
[12:48:11] <theme> eddyb_, that's not Sized?
[12:48:13] <theme> wtf
[12:48:20] <eddyb_> theme: what?
[12:48:29] * theme just said wtf the (n+1)th time
[12:48:37] <eddyb_> theme: I mean, a trait that you can use like `T: ?Inabited`
[12:48:40] <eddyb_> *Inhabited
[12:48:45] <theme> playbot, enum Foo {} std::mem::size_of::<Foo>()
[12:48:46] -playbot- 0
[12:48:49] <theme> ...
[12:48:54] <eddyb_> theme: read what I wrote again
[12:49:06] <theme> eddyb_, ok.... why do you need that?
[12:49:08] <eddyb_> *like*. anti-kind or whatever you want to call what Sized is
[12:49:11] <eddyb_> theme: because generics
[12:49:36] <theme> eddyb_, just implement Debug and Error
[12:49:41] <theme> and we are done, right?
[12:49:50] <theme> and implement those with unreachable!()
[12:49:51] <eddyb_> theme: if you have special rules for enum Foo {} that *must* be applied, then generic type parameters can't be Foo *by default*
[12:49:54] <theme> or maybe even unimplemented!()
[12:49:54] <eddyb_> theme: ... no
[12:50:12] <eddyb_> theme: that's a big hack
[12:50:24] <eddyb_> uninhabited values are not first class and it's annoying
[12:50:34] <theme> How are they annoying?
[12:50:40] <theme> eddyb_, oh wait...
[12:50:45] <theme> we can make ! a type
[12:50:47] <eddyb_> theme: because you can plug them into unsafe code
[12:50:57] <eddyb_> ! used to be a type. it's not anymore because it led to *endless* issues
[12:51:07] <theme> and make Err = !
[12:51:12] <theme> eddyb_, what issues?
[12:51:22] <theme> eddyb_, what unsafe code causes problems?
[12:51:28] <theme> it's dead code, right?
[12:51:34] <eddyb_> theme: it's UB
[12:51:38] <theme> ?
[12:51:45] <eddyb_> it's not dead code, it's undefined behavior
[12:51:45] <theme> oh
[12:51:49] <theme> uninitialized()...
[12:52:02] *** Joins: jdm (jdm@moz-ilbt2e.cable.teksavvy.com)
[12:52:18] <theme> eddyb_, what problems can you cause if you don't have a constructor?
[12:52:20] <eddyb_> theme: just search in the issue list for ty_bot
[12:52:34] <eddyb_> for the problems ! was creating *all the time*
[12:52:53] <eddyb_> (you have to account for it *everywhere* during type-checking, which is much harder than it sounds)
[12:53:35] <eddyb_> playbot: enum Void {} let x = unsafe { *(1 as *const Void) };
[12:53:36] -playbot- <anon>:14:39: 14:60 error: cannot move out of dereference of unsafe pointer
[12:53:36] -playbot- <anon>:14         enum Void {} let x = unsafe { *(1 as *const Void) };
[12:53:36] -playbot- output truncated; full output at: http://bit.ly/1xitMUK
[12:53:38] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[12:53:48] <eddyb_> playbot: #[derive(Copy)] enum Void {} let x = unsafe { *(1 as *const Void) };
[12:53:49] -playbot- ()
[12:53:58] <eddyb_> that's... not what's supposed to happen
[12:54:07] <theme> ewhat?
[12:54:08] <eddyb_> playbot: #[derive(Copy)] enum Void {} let x = unsafe { *(1 as *const Void) }; match x { }
[12:54:10] -playbot- output truncated; full output at: http://bit.ly/1BSu96U
[12:54:14] <theme> file a bug?
[12:54:26] <eddyb_> theme: a bug claiming that it's supposed to abort?
[12:54:38] <theme> I dunno
[12:54:46] <theme> but wtf is .borrow().is_none()?
[12:54:50] <eddyb_> hahahahaha yuss
[12:55:08] <eddyb_> theme: my code there is breaking threading in libstd
[12:55:10] <eddyb_> AFAICT
[12:55:23] <eddyb_> theme: press LLVM IR
[12:55:40] *** Quits: aepsil0n (eduard@moz-s4dovi.73sq.ctqi.8071.2a02.IP) (Quit: Leaving.)
[12:55:42] <eddyb_> this is very irresponsible
[12:55:54] * theme attempts to read it
[12:56:01] <eddyb_> theme: `unreachable`
[12:56:12] <eddyb_> theme: LLVM is not required to emit *anything* for main
[12:56:19] <eddyb_> arielb1 was being unreasonable about the whole thing and I just dropped it
[12:56:20] <theme> lol
[12:56:40] <eddyb_> yupp, main has no body
[12:56:42] <theme> eddyb_, what about arielb1?
[12:56:46] <eddyb_> (if you look in the assembly)
[12:56:52] <eddyb_> theme: he made me drop the discussion about these
[12:57:17] <eddyb_> I didn't have the time to fight them
[12:57:18] <theme> and how did .borrow().is_none() come up?
[12:57:26] <eddyb_> theme: because it breaks libstd
[12:57:51] <eddyb_> theme: really, this is UB eating up code
[12:57:54] <theme> eddyb_, it's nowhere in the llvm, right?
[12:58:07] <eddyb_> theme: with LTO you'll end up with 0 assembly, I bet
[12:58:10] * eddyb_ should try it
[12:58:12] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[12:58:23] <theme> what lto?
[12:58:26] <eddyb_> -Clto
[12:58:34] <theme> linear tape open?
[12:58:41] <eddyb_> link-time optimization
[12:58:49] <eddyb_> put all the IR in one unit
[13:00:03] *** Quits: marsel (user@moz-o0t.pfd.255.92.IP) (Ping timeout: 121 seconds)
[13:00:22] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[13:00:40] <eddyb_>  awww
[13:00:45] <eddyb_> theme: @_ZN2rt10lang_start20h94ba55cffd0e1e7ayBJE is not inlined for some reason
[13:00:52] <theme> ...
[13:01:08] <eddyb_> theme: that means I can't make it up everything
[13:01:24] <eddyb_> hmm
[13:01:51] <eddyb_> theme: *make it eat up
[13:02:08] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Connection closed)
[13:02:15] *** Joins: sprang (sprang@moz-bll05b.zoominternet.net)
[13:02:47] <theme> hmm
[13:03:15] <eddyb_> theme: OH I wasn't compiling with optimization
[13:04:34] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Ping timeout: 121 seconds)
[13:06:08] <theme> eddyb_, what makes ! so hard?
[13:07:34] <eddyb_> theme: propagating it *everywhere*
[13:07:36] <eddyb_>   %281 = invoke %"rt::libunwind::_Unwind_Exception"* @rust_try(void (i8*)* @_ZN2rt6unwind3try6try_fn21h15464054294204427796E, i8* %272)
[13:07:48] <theme> what is that?
[13:07:57] <eddyb_> pretty sure %272 is holding the pointer to main
[13:08:10] <theme> I thought that ! is just like for<T> T
[13:08:14] <theme> plus coercions
[13:08:18] <eddyb_> theme: there's 0 coercions
[13:08:27] <theme> I mean, coercion to ()
[13:08:41] <eddyb_> that's a fallback mechanism
[13:08:43] <theme> wait a sec, that's unsized
[13:08:56] <eddyb_> ! can be any type, and we default to ()
[13:08:58] <theme> so ...
[13:09:09] <theme> is ! just a type that coerces to everything?
[13:09:13] <theme> is that so hard?
[13:09:14] <eddyb_> *sigh*
[13:09:20] <eddyb_> theme: it doesn't *coerce*
[13:09:25] <eddyb_> a coerce *does* something
[13:09:36] <eddyb_> ! uses subtyping
[13:09:37] <theme> playbot, let x: i32 = panic!();
[13:09:38] -playbot- thread '<main>' panicked at 'explicit panic', <anon>:14
[13:09:38] -playbot- playpen: application terminated with error code 101
[13:09:46] <theme> eddyb_, what?
[13:09:53] <theme> I thought subtyping was about lifetimes
[13:10:11] <eddyb_> right now, yes
[13:10:14] <eddyb_> ! doesn't exist anymore
[13:10:20] <eddyb_> well, not yet
[13:10:21] <theme> ok
[13:10:28] <theme> so... subtyping
[13:10:32] <theme> doesn't sound so hard
[13:10:33] <eddyb_> theme: inference type variables also use subtyping
[13:10:38] <theme> yes
[13:10:42] <theme> and...?
[13:10:42] *** Joins: simukis_mib (Mibbit@moz-7gm.nmh.219.193.IP)
[13:10:54] *** simukis_mib is now known as simukis
[13:10:55] <eddyb_> right now we don't have !, we generate a fresh inference type variable
[13:11:01] <eddyb_> that we mark as "diverging"
[13:11:01] <theme> can we just add something like ?NotBottom
[13:11:08] <theme> a default trait
[13:11:26] <theme> So type parameter is Sized+NotBottom by default
[13:11:30] <eddyb_> that's not what default traits are. though I'm thinking of default impls, there might not be any concept associated with "default trait"
[13:11:35] <eddyb_> theme: NotBottom is a stupid name
[13:11:37] <theme> whatever
[13:11:39] <eddyb_> for a lot of reasons
[13:11:50] <eddyb_> [14:48] <eddyb_> theme: I mean, a trait that you can use like `T: ?Inhabited`
[13:11:55] <theme> ok...
[13:12:02] <theme> so... is that hard to implement?
[13:12:18] <eddyb_> not really. but it wouldn't be adding ! back as a type
[13:12:53] <eddyb_> I guess !'s issue would repeat with uninhabited enums
[13:13:04] <theme> hmm
[13:13:09] <eddyb_> theme: there's a way to deal with this, but it might be too hard
[13:13:19] *** Joins: ytain (ytain@moz-44k.q8p.140.24.IP)
[13:13:39] <eddyb_> deeply replace any ! type parameters with fresh divering inference type variables
[13:14:08] <eddyb_> maybe you just need to do it at the outermost level
[13:14:44] <theme> haskell apparently doesn't have this problem due to laziness
[13:14:45] <eddyb_> theme: the ?Inhabited thing is a *prerequisite*, but I guess everyone using ?NotBottom figured that out
[13:15:20] <eddyb_> I'm curious if you can remove -> ! from the language and replace it with strictly uninhabited enums
[13:15:35] <eddyb_> Void would be a terrible name
[13:15:46] <eddyb_> fn panic() -> Void // lol
[13:16:50] <theme> eddyb_, fn panic() -> Crash?
[13:16:52] <eddyb_> theme: right now ! is super easy to deal with because only functions and method can produce it
[13:16:54] <theme> lol
[13:17:00] <eddyb_> *methods
[13:17:17] <eddyb_> but a generalized type would have to be dealt with at any point
[13:18:03] <eddyb_> maybe you can only use it in types inside enum variants, but not in structs
[13:18:13] <eddyb_> but that's a bit too weird
[13:18:30] <theme> eddyb_, any ICE's with ! that applies to empty enums?
[13:18:48] <eddyb_> theme: what?
[13:19:08] <theme> eddyb_, any ICE's that used to happen with !
[13:19:16] <theme> that also happens with empty enums?
[13:19:21] <eddyb_> theme: issue list. I can't remember all of them
[13:19:35] <eddyb_> theme: no, they're not the same beucase uninhabited enums are second-class
[13:19:44] <eddyb_> so they had none of the typeck-level properties
[13:19:55] <eddyb_> (which allows them to do nasty things *still*)
[13:20:25] <theme> Oh
[13:20:34] <theme> `&!` coerces to `&T`?
[13:20:41] <eddyb_> nmatsakis: here's an idea: make writing a type to the fcx check if it's uninhabited and replace it with a fresh inference var if so. how many of !'s issues would that solve?
[13:20:43] <theme> I understand the issue now
[13:20:55] <eddyb_> theme: that's just one tiny problem
[13:21:11] <eddyb_> virtually *anything* in typeck used to be susceptible
[13:21:37] <theme> ok...
[13:21:57] * theme still can't get his head around variance
[13:21:58] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[13:23:32] <eddyb_> theme: fn() -> ! is fn() -> T for any T
[13:23:48] <theme> well... you don't have to elaborate more
[13:23:54] <eddyb_> fn(T) for any T is fn(!)
[13:24:07] <theme> wait
[13:24:08] <theme> what
[13:24:15] <theme> ok... hello variance
[13:24:23] <eddyb_> that's how variance works :P
[13:25:25] *** Quits: jgallagher (john@moz-6ge.dhn.131.24.IP) (Client exited)
[13:25:31] <theme> eddyb_, btw do you have any ideas about this? https://github.com/rust-lang/rfcs/pull/956#issuecomment-83343460
[13:26:49] <eddyb_> theme: arrrrrrrrr left me speechless
[13:26:53] <eddyb_> and clueless
[13:26:57] <theme> eddyb_, ???
[13:27:11] <theme> what's his github username again?
[13:27:44] <eddyb_> theme: https://github.com/rust-lang/rfcs/pull/956#issuecomment-77906756
[13:28:02] <theme> eddyb_, skip that
[13:28:20] <theme> I think this argument undermined his whatever idea https://github.com/rust-lang/rfcs/pull/956#issuecomment-77969917
[13:29:22] <eddyb_> LOL
[13:29:28] <eddyb_> theme: you're joking, right?
[13:30:01] <theme> eddyb_, I think his point is to have types that implement <= and >=
[13:30:04] <theme> but not others
[13:31:04] <eddyb_> theme: you're sure that long post didn't talk about anything else?
[13:31:59] <theme> well... undermining the assumption is enough
[13:32:26] <theme> also... coherence is going to be a headache with *that*
[13:33:47] <theme> eddyb_, tl;dr: skip that shit
[13:34:42] <theme> gotta go
[13:34:56] *** Quits: theme (theme@moz-i3mhhb.asianet.co.th) (Quit: Leaving)
[13:36:55] *** Joins: eddyb (eddyb@moz-l1n.kjd.26.188.IP)
[13:37:15] *** Quits: eddyb_ (eddyb@moz-l1n.kjd.26.188.IP) (Ping timeout: 121 seconds)
[13:38:06] <eddyb> calling that expository effort "shit" doesn't sound like good faith to me
[13:38:26] <eddyb> nmatsakis: another coercion?
[13:40:52] <eddyb> nmatsakis: well, no rebase concerns this time
[13:41:54] <farcaller> can someone tell me if a plan of wrapping a `fn(self) {}` into a temp `impl X` and extracting it afterwards from `quote_item!()` sounds reasonable?
[13:42:14] <farcaller> because I need to recompile rustc and I'll be very sad to loose 3 hours on that :)
[13:43:34] <eddyb> farcaller: why would need to recompile rustc?
[13:43:48] <eddyb> and why would it take 3 hours?
[13:43:57] <farcaller> there's no impl_to_tokens!() for ast::ImplItem
[13:44:15] <farcaller> and I don't know. that thing is really slow to compile :)
[13:44:45] <eddyb> farcaller: but yes, if you grep for `quote_item!(impl` you"ll find a test that does this
[13:44:58] <farcaller> mhm, that's how I got this idea
[13:45:12] <farcaller> I just need to sourcify/tokenize it back
[13:45:13] *** Joins: eddyb_ (eddyb@moz-l1n.kjd.26.188.IP)
[13:45:25] <eddyb> farcaller: I mean, aren't you doing this in a syntax extension? why the need to rebuild rustc?
[13:46:05] <farcaller> uh. because I can't `impl ToSource for ast::ImplItem` from my crate?
[13:46:17] <farcaller> and `ToTokens`
[13:47:38] <eddyb> oh
[13:47:47] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[13:48:45] <farcaller> ./configure --disable-docs --enable-clang --enable-rpath --disable-verify-install --prefix=/Users/farcaller/.local/rust-head && make -j5 install <- is this the most reasonable way to compile rustc fast?
[13:49:55] <eddyb> farcaller: if you want to do that... you should do it like everything else
[13:50:09] <farcaller> hm?
[13:50:27] <eddyb> farcaller: add a pretty-printer entry-point
[13:50:54] <eddyb> farcaller: look at the impl of ToTokens for Item
[13:50:58] <farcaller> well, yes, I try to figure out how to get through down to print_impl_item
[13:51:16] <eddyb> and duplicate any point in the chain
[13:51:42] <eddyb> farcaller: and if you do this... might as well do it for TraitItem, too :P
[13:51:55] * eddyb should've left those impls in
[13:51:59] <farcaller> and then send a PR? :p
[13:52:18] <eddyb> for some reason I thought quote_method was the only thing using method_to_string
[13:52:19] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[13:54:00] *** Joins: dinfuehr (dinfuehr@moz-dqqmpp.public.telering.at)
[13:54:07] *** Quits: zmack (zmack@moz-1oe.89t.76.82.IP) (Connection closed)
[13:56:58] *** Quits: dinfuehr (dinfuehr@moz-dqqmpp.public.telering.at) (Connection closed)
[13:59:23] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Quit: rcirc on GNU Emacs 24.3.92.1)
[13:59:37] *** Joins: jgallagher (john@moz-d5e8oc.hfc.comcastbusiness.net)
[14:20:07] *** Joins: adu (ajr@moz-4ca.v06.48.108.IP)
[14:21:05] *** Joins: zmack (zmack@moz-b26i0b.home.aster.pl)
[14:22:32] *** Joins: dinfuehr (dinfuehr@moz-ejhjee.tuwien.ac.at)
[14:22:37] *** Joins: Gankro (uid71432@moz-sc2bd6.charlton.irccloud.com)
[14:25:45] *** Joins: bfops (uid58242@moz-e5u6m0.charlton.irccloud.com)
[14:25:50] *** Joins: marsel (user@moz-dvn.d4u.180.94.IP)
[14:32:42] *** Quits: dinfuehr (dinfuehr@moz-ejhjee.tuwien.ac.at) (Connection closed)
[14:33:15] *** Joins: Sindriava (textual@moz-ca79jq.broadband10.iol.cz)
[14:37:54] *** Quits: rustical (dida@moz-55rvi2.dclient.hispeed.ch) (A TLS packet with unexpected length was received.)
[14:41:56] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[14:45:21] *** Joins: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP)
[14:45:22] *** ChanServ sets mode: +o pnkfelix
[14:45:26] *** Joins: doener (doener@moz-929cn9.unity-media.net)
[14:46:28] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[14:47:14] *** Joins: mib_nvp2pt (Mibbit@moz-juv.9o3.252.72.IP)
[14:49:04] *** Quits: munksgaard (munksgaard@moz-vj4.hq0.225.130.IP) (Ping timeout: 121 seconds)
[14:53:29] *** Quits: Sindriava (textual@moz-ca79jq.broadband10.iol.cz) (Quit: My Mac has gone to sleep. ZZZzzz…)
[14:55:23] *** Quits: achernya (quassel@moz-i01917.mit.edu) (Ping timeout: 121 seconds)
[14:56:39] *** Joins: achernya (quassel@moz-8tbl8i.6686.inna.4830.2001.IP)
[14:58:41] *** Quits: mib_nvp2pt (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[15:03:46] *** Quits: ytain (ytain@moz-44k.q8p.140.24.IP) (Quit: Textual IRC Client: www.textualapp.com)
[15:06:23] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[15:11:58] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[15:11:59] *** ChanServ sets mode: +o pcwalton
[15:14:48] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[15:18:58] *** Joins: brson (brson@moz-u3dg2t.sfo1.mozilla.com)
[15:18:58] *** ChanServ sets mode: +o brson
[15:20:58] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Ping timeout: 121 seconds)
[15:29:29] *** Joins: kermitsxc (Mibbit@moz-juv.9o3.252.72.IP)
[15:30:40] *** Quits: kermitsxc (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[15:34:11] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[15:34:41] *** Quits: Kxepal (Miranda@moz-a6fhk9.pppoe.mtu-net.ru) (Ping timeout: 121 seconds)
[15:35:03] *** Joins: Kxepal (Miranda@moz-t124v6.pppoe.mtu-net.ru)
[15:35:06] *** sunfish-away is now known as sunfish
[15:36:05] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[15:36:39] *** Joins: O01eg (o01eg@moz-jnir55.0tnt.4n8f.2698.2a02.IP)
[15:40:38] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[15:41:24] <farcaller> stage1 is effectively same as stage2, right?
[15:42:11] <eddyb_> farcaller: except a few issues, some of them involving... plugins
[15:42:27] <farcaller> oh well.
[15:42:52] * farcaller goes back to compiling :)
[15:43:41] <bfops> I think I've hit a borrow checking bug, but I'm not sure. I feel like this should be allowed? http://is.gd/jvdb5w
[15:44:50] *** Joins: munksgaard (munksgaard@moz-urnkl5.u.parknet.dk)
[15:47:50] <simukis> bfops, doesn’t look like a bug
[15:48:56] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[15:49:23] <cmr> bfops: no, that wouldn't be sound, you'd be able to violate type safety if that was allowed.
[15:49:36] <simukis> more like a convulted example
[15:50:06] <cmr> bfops: consider if Foo was an enum, and assigning to x changed which variant it was.
[15:50:20] <cmr> then y could now be pointing into garbage
[15:50:37] <cgaebel> x is a reference
[15:50:40] <cgaebel> not an enum
[15:50:41] *** Quits: achernya (quassel@moz-8tbl8i.6686.inna.4830.2001.IP) (Ping timeout: 121 seconds)
[15:51:00] <cgaebel> looks sound to me.
[15:51:47] <bfops> this reeeeally similar example works http://is.gd/0hdhai
[15:51:53] <bfops> (also works without any muts)
[15:52:01] *** Joins: achernya (quassel@moz-8tbl8i.6686.inna.4830.2001.IP)
[15:52:09] <bfops> the lifetimes are just a little more constrained on that second one though
[15:52:20] <doener> bfops: and you have two different x's
[15:52:25] <doener> instead of just one
[15:52:51] <bfops> two different x's that never live at the same time
[15:54:03] <cmr> cgaebel: it could be a reference into the interior of the enum
[15:54:10] <simukis> http://is.gd/xw14KX simple example with less muts to show the issue
[15:54:17] <simukis> the thing is that you cannot borrow mut more than once
[15:54:36] <bfops> cmr: the enum should remain borrowed, but not the reference itself
[15:55:03] <bfops> simukis: but y isn't a mutable borrow anymore
[15:55:11] <simukis> we do this to make sure we can ensure our safety
[15:55:24] <simukis> y is an immutable borrow *from* a mutable borrow
[15:55:34] <simukis> doing x.foo borrows x.
[15:55:41] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[15:55:45] <simukis> and borrowing x.foo keeps the borrow to the x.
[15:56:07] <simukis> for the full duration of x.foo borrow.
[15:56:56] <cgaebel> bfops: http://is.gd/5wdRho works, but idk if it's what you want
[15:57:17] <bfops> hm
[15:58:34] *** Joins: killercup (killercup@moz-4udt1b.dip0.t-ipconnect.de)
[15:58:51] <bfops> actually even if y *were* a mutable borrow - so what? `baz` should remain mutably borrowed for the whole duration, I agree
[15:59:25] <bfops> cgaebel: nah, ultimately I need a borrow that exists for at least the RHS of the assignment to x
[15:59:32] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[15:59:32] *** ChanServ sets mode: +o pcwalton
[16:00:21] <bfops> The use case is processing a tree in a loop since tail recursion isn't really a thing. So I need something like branch = step(branch) somewhere, where branch: &'a mut Tree
[16:00:52] *** Joins: Murarth_ (Murarth@moz-mpmr8r.phnx.qwest.net)
[16:01:12] *** Quits: Murarth (Murarth@moz-12ajc1.phnx.qwest.net) (Ping timeout: 121 seconds)
[16:01:12] *** Murarth_ is now known as Murarth
[16:01:38] <reem> mem::swap and mem::replace are friends
[16:01:57] *** Joins: skippydippy (Mibbit@moz-juv.9o3.252.72.IP)
[16:02:52] <eddyb_> reem: replace uses swap. not sure if that qualifies as friendship...
[16:03:23] <reem> hehe, I meant they can be friends with you
[16:03:38] <simukis> s/friends/the tools/
[16:03:44] *** Quits: Nekit1234007 (nekit@moz-2vpc3e.broadband.iskratelecom.ru) (A TLS packet with unexpected length was received.)
[16:03:48] *** Joins: Nekit1234007 (nekit@moz-2vpc3e.broadband.iskratelecom.ru)
[16:05:00] *** Quits: imperio (Mibbit@moz-opqtbe.abo.bbox.fr) (Quit: http://www.mibbit.com ajax IRC Client)
[16:05:39] *** Quits: skippydippy (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[16:05:59] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Connection closed)
[16:06:22] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[16:06:51] *** Quits: simukis (Mibbit@moz-7gm.nmh.219.193.IP) (Quit: zombie attack, solar eclipse, no vision, running in a random direction.)
[16:14:30] *** Quits: munksgaard (munksgaard@moz-urnkl5.u.parknet.dk) (Ping timeout: 121 seconds)
[16:15:47] *** Quits: squiddy (squiddy@moz-md4.pm3.19.178.IP) (Quit: Leaving)
[16:17:02] <barosl> Where did the build procedure documents (e.g. How to use check-stage1) move to? I remember having seen them in-tree, but I'm not sure where it is
[16:18:37] <eddyb_> barosl: make tips?
[16:18:44] <barosl> Yeah, sort of
[16:18:56] <barosl> They were in the wiki, but they're now gone, so...
[16:19:02] <barosl> Aha
[16:19:11] <barosl> You mean the subcommand `tips`
[16:19:21] <steveklabnik> https://github.com/rust-lang/rust-wiki-backup <-
[16:19:32] *** Joins: eerie (eerie@moz-nu5r7u.red.bezeqint.net)
[16:19:44] <barosl> Hmm, What I wanted to do is telling my friends some links to help them
[16:20:05] *** Quits: eerie (eerie@moz-nu5r7u.red.bezeqint.net) (Connection closed)
[16:20:11] <barosl> Is that the best link that is currently available?
[16:20:25] <bfops> reem: I totally forgot about those, I'll try that out.
[16:20:59] <WindowsBunny> steveklabnik: Now that the wiki is kill, there needs to be something in the book about installing a full mingw setup if you're on windows and want to depend on C/C++ bits
[16:21:14] <WindowsBunny> It's such a common question and I'd always direct them to a page on the wiki explaining it
[16:21:33] <steveklabnik> i'd love to add that stuff to the real, actual docs
[16:21:59] <barosl> steveklabnik, Including Note-testsuite, right?
[16:22:05] <steveklabnik> i don't have the expertise to write it up, though.
[16:22:22] <steveklabnik> barosl: i'm not sure what you're asking, but that's a dump of the entire wiki 5 mins before i shut it off
[16:23:04] <steveklabnik> WindowsBunny: maybe https://github.com/rust-lang/rust#building-on-windows is the right place?
[16:23:06] <barosl> steveklabnik, I mean, there will be more "official" docs for "how to use the test suite" soon, right?
[16:23:34] <steveklabnik> barosl: oh, well, that depends. i'm basically seeing what it is people actually used from that page
[16:23:40] <WindowsBunny> steveklabnik: That is intended for people trying to build Rust, people shouldn't have to read the source code readme to know how to use rust on windows
[16:23:51] <steveklabnik> WindowsBunny: ahh yes sorry, i see that distinction now
[16:24:11] <steveklabnik> barosl: so 'soon', i'm not sure, but i'll register that as a vote for docs on that ;)
[16:24:53] <barosl> Looking at the tree, I think placing README.md at `src/test` also looks promising
[16:25:09] <barosl> Something like README.md in `src/librustc`
[16:26:53] *** Quits: killercup (killercup@moz-4udt1b.dip0.t-ipconnect.de) (Quit: My Mac has gone to sleep. ZZZzzz…)
[16:27:02] <steveklabnik> yeah, that would be a good place for that
[16:29:55] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[16:38:00] <brson> what rfc added inherent impls for primitives?
[16:38:08] *** Joins: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net)
[16:39:00] *** Quits: Jesin (Jesin@moz-i7sbhm.res.Lehigh.EDU) (Quit: Leaving)
[16:39:18] <brson> i don't see one
[16:39:31] <brson> they were added in https://github.com/rust-lang/rust/pull/23104
[16:40:02] <farcaller> is a partial PR with only ImplItem impl_to_source! fixes going to be accepted?
[16:44:45] *** Joins: gsingh93 (gulshan@moz-3fu4am.mi.comcast.net)
[16:45:26] *** Joins: Jesin (Jesin@moz-i7sbhm.res.Lehigh.EDU)
[16:50:52] *** Joins: eerie (eerie@moz-nu5r7u.red.bezeqint.net)
[16:53:02] <bfops> reem: I don't think mem::replace/swap work either, since they take &mut Ts and you can't mutably borrow x since it's already borrowed.
[16:53:28] <bfops> I think it's time to go unsafe
[16:54:26] *** Quits: summerlight_ (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[16:54:39] *** Quits: eerie (eerie@moz-nu5r7u.red.bezeqint.net) (Connection closed)
[16:54:41] *** Joins: eerie (eerie@moz-nu5r7u.red.bezeqint.net)
[16:56:21] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[16:56:44] *** Joins: squiddy (squiddy@moz-md4.pm3.19.178.IP)
[16:58:42] <reem> I can't really tell just from the description how to fix your problem
[16:59:39] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[17:00:51] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[17:02:57] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[17:02:57] *** ChanServ sets mode: +o pcwalton
[17:03:55] *** Joins: ytain (ytain@moz-44k.q8p.140.24.IP)
[17:07:03] <farcaller> eddyb: should I go and add quote_impl_item!() ?
[17:09:53] <eddyb_> farcaller: no
[17:15:13] *** Joins: rprichard (rprichard@moz-s27r3p.en8f.d045.0009.2601.IP)
[17:16:18] <eddyb_> playbot: 0 as *const () as *const Copy
[17:16:19] -playbot- <anon>:14:9: 14:23 error: internal compiler error: expected object type
[17:16:19] -playbot- <anon>:14         0 as *const () as *const Copy
[17:16:19] -playbot- output truncated; full output at: http://bit.ly/1H3TPyo
[17:16:45] <eddyb_> playbot: let x: *const Copy = 0 as *const ();
[17:16:46] -playbot- <anon>:14:30: 14:44 error: mismatched types:
[17:16:47] -playbot-  expected `*const core::marker::Copy`,
[17:16:47] -playbot- output truncated; full output at: http://bit.ly/1DCGdwx
[17:16:57] <eddyb_> nmatsakis: ^^ I'm pretty sure that's supposed to work
[17:17:21] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[17:18:51] <bfops> I can't seem to process a linked list in a loop either: http://is.gd/Ng6VVh
[17:20:31] <bfops> (with or without mem::replace)
[17:20:34] <cgaebel> clickbait title: traversing a linked list (efficiently) is impossible in (safe) rust
[17:21:18] <cgaebel> brb posting to reddit
[17:21:31] <cgaebel> (without the things in parens, obviously)
[17:22:00] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Connection closed)
[17:22:25] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[17:26:49] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Ping timeout: 121 seconds)
[17:31:31] *** Joins: dudel (dud@moz-55rvi2.dclient.hispeed.ch)
[17:31:48] <bfops> another example that seems kind of silly http://is.gd/EpkTw5
[17:35:49] *** Joins: sigma (sigma@moz-ohog4c.range86-135.btcentralplus.com)
[17:36:15] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Connection closed)
[17:38:07] <bfops> I get that this makes multiple mutable references, which is obviously unsafe, but what's the safe way to do this?
[17:38:16] *** Joins: killercup (killercup@moz-edmf2j.dip0.t-ipconnect.de)
[17:39:25] *** Joins: pcwalton (pcwalton@moz-msl7jr.static-ip.telepacific.net)
[17:39:26] *** ChanServ sets mode: +o pcwalton
[17:39:55] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[17:43:56] *** Quits: laumann (thomas@moz-1f0.hq0.225.130.IP) (Ping timeout: 121 seconds)
[17:47:03] *** Joins: scialex (scialex@moz-j5mi8i.cs.brown.edu)
[17:50:30] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[17:51:35] *** Quits: eddyb (eddyb@moz-l1n.kjd.26.188.IP) (Quit: Bye)
[17:51:43] *** eddyb_ is now known as eddyb
[17:55:00] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[17:56:44] *** Quits: squiddy (squiddy@moz-md4.pm3.19.178.IP) (Quit: Leaving)
[17:56:57] *** Joins: avikpal (avikpal@moz-948.mpm.194.117.IP)
[17:58:05] *** Quits: eerie (eerie@moz-nu5r7u.red.bezeqint.net) (Connection closed)
[17:58:59] *** Quits: ytain (ytain@moz-44k.q8p.140.24.IP) (Quit: Textual IRC Client: www.textualapp.com)
[18:01:19] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[18:05:38] <bluss> bfops: I'm thinking the answer is probably recursion
[18:05:47] *** Joins: reem (reem@moz-gnnetp.coob.q2h1.0009.2601.IP)
[18:05:50] <bfops> bluss: so gg stack
[18:05:54] <bfops> I'll miss you
[18:06:21] <bluss> depends on what the compiler does
[18:06:21] <bfops> iirc, rust explicitly doesn't guarantee tail recursion gets inlined
[18:06:42] <bfops> I'd like to *not* rely on what the compiler does. I'd like to be able to say "here, do this"
[18:07:48] <cgaebel> bluss: rustc doesn't guarantee tail recursion
[18:07:49] *** Joins: avikpal_ (avikpal@moz-ts0.36b.194.117.IP)
[18:07:57] *** Quits: avikpal (avikpal@moz-948.mpm.194.117.IP) (Ping timeout: 121 seconds)
[18:08:01] <bfops> if I wanted to rely on the compiler/optimizer being clever for me, I'd use the JVM
[18:08:04] <cgaebel> it's been discussed to death, and rejected. it's interacts badly with destructors
[18:08:13] <steveklabnik> it wasn't fully rejected forever
[18:08:19] <steveklabnik> we even have 'become' reserved
[18:08:26] <steveklabnik> it just won't ever do it implicitly
[18:09:09] *** Joins: eerie (eerie@moz-nu5r7u.red.bezeqint.net)
[18:09:47] <bluss> I'm not even trying to discuss that, just saying that I think the borrow checker can handle that if you write it recursively
[18:10:48] <bfops> it can
[18:11:06] <bfops> but then I have to rely on compiler inlining tail recursion to make this efficient
[18:12:02] <bfops> like rust is a systems programming language, this *should* be possible in a loop.
[18:13:45] <bluss> we know that the borrow checker rejects sound programs
[18:14:05] <bfops> I got the linked list example to work by explicitly creating a trait to explicitly move the reference =/ http://is.gd/XlFaAN
[18:14:30] <bluss> ah that's nice
[18:14:51] <bfops> that's not what it should take to make this possible in safe rust
[18:15:20] <reem> Can I mark if/else branches hot and cold?
[18:15:23] <cgaebel> that's dutty.
[18:15:26] <bfops> it should be easier than that to say "don't borrow this reference. move it"
[18:15:41] <bfops> or easier than that to do this
[18:15:43] <cgaebel> reem: I just use a #[cold] function for the cold branch
[18:15:46] <bfops> regardless of exactly how it's done
[18:16:32] *** Joins: avikpal (avikpal@moz-cvj.cvs.194.117.IP)
[18:16:43] *** Quits: avikpal_ (avikpal@moz-ts0.36b.194.117.IP) (Ping timeout: 121 seconds)
[18:19:29] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[18:20:58] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[18:21:43] *** Quits: eerie (eerie@moz-nu5r7u.red.bezeqint.net) (Connection closed)
[18:23:28] *** Quits: avikpal (avikpal@moz-cvj.cvs.194.117.IP) (Ping timeout: 121 seconds)
[18:23:30] *** Joins: avikpal_ (avikpal@moz-7au.3e4.194.117.IP)
[18:30:02] *** Quits: pcwalton (pcwalton@moz-msl7jr.static-ip.telepacific.net) (Client exited)
[18:31:24] *** Quits: avikpal_ (avikpal@moz-7au.3e4.194.117.IP) (Ping timeout: 121 seconds)
[18:32:16] *** Joins: avikpal (avikpal@moz-tqp.4af.194.117.IP)
[18:42:40] <reem> cgaebel: Is there a "hot" version?
[18:43:14] <cgaebel> reem: #[cold] means "put this code in a different section, never inline, hint to the compiler it will be in cold paths"
[18:43:21] <cgaebel> technically, everything not #[cold] is #[hot] :P
[18:43:44] <reem> Oh, so it's not at all similar to likely/unlikely annotations
[18:43:48] <cgaebel> no
[18:43:58] <cgaebel> it might automatically tag branches
[18:43:59] <cgaebel> not sure
[18:44:15] <reem> I just wrote #[inline(always)] #[cold] fn unlike<T>(t: T) -> T { t } to try and fake unlikely hints
[18:44:27] <reem> but I guess that is wrong
[18:44:38] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[18:44:55] <cgaebel> yeah that'll just do useless work :P
[18:45:17] <cmr> https://github.com/thestinger/rust-core/blob/8dd3ccbfaa842c2ff2b8e29a9187222f9860f5c0/core/macros.rs#L13
[18:47:34] <cgaebel> oh yeah I forgot we have the expect intrisic
[18:47:48] <cgaebel> it only ICEs the compiler about 60% of the time, too!
[18:48:13] <arrrrrrrrr> is there a way to create a sparse static array where all unset values are set to zero?
[18:49:11] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[18:49:11] <simukis> arrrrrrrrr: no, you have to initialize it to 0 first and then fill it with your values or explicitly write out every value
[18:50:02] <arrrrrrrrr> that's inefficient
[18:52:12] <cgaebel> arrrrrrrrr: mem::uninitialized
[18:52:25] <arrrrrrrrr> cgaebel: static
[18:52:29] <cgaebel> lazy_static
[18:52:49] <cgaebel> or type out the elements yourself
[18:52:51] <cgaebel> or use a macro
[18:53:01] <cgaebel> or use a python script to generate them
[18:53:02] *** Quits: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP) (Quit: rcirc on GNU Emacs 24.3.92.1)
[18:53:07] <cgaebel> there's no special syntax for it
[18:53:09] <arrrrrrrrr> like I said: inefficient
[18:53:23] <cgaebel> none of my suggestions are less efficient
[18:53:33] <cgaebel> I guess a well-predicted branch for lazy static
[18:53:39] <cgaebel> but the other solutiosn aren't
[18:53:57] *** Joins: Rym (y@moz-859.d1r.39.217.IP)
[18:53:58] <arrrrrrrrr> you're saying that lazy_static is not less efficient than having constant values known to the compiler at compile time
[18:54:01] <arrrrrrrrr> that's interesting
[18:54:11] <cgaebel> the cost is a single well-predicted branch.
[18:54:20] <cgaebel> and did you see my other solutions?
[18:54:45] <arrrrrrrrr> yes, those are also inefficient. the other kind
[18:55:08] <bfops> the kind where you have to explicitly tell the compiler what you mean..?
[18:55:14] <bfops> yes, they cost programmer time..
[18:55:23] <arrrrrrrrr> if anyone can come up with a real solution to get this array in rust then that would be appreciated
[18:55:26] <arrrrrrrrr> https://gist.github.com/anonymous/1ebade7b67168ba9c971
[18:55:42] <bfops> again, macro sounds closest to what you're looking for.
[18:55:56] <arrrrrrrrr> I don't see how a macro can find the holes and fill them with zeroes
[18:56:04] <cgaebel> have you read the macro guide?
[18:56:29] <reem> it's doable, but probably annoying
[18:56:30] <bfops> hm yeah actually I'm not sure if macros are powerful enough for that.
[18:56:32] <cgaebel> arrrrrrrrr: https://doc.rust-lang.org/book/plugins.html
[18:56:43] <arrrrrrrrr> cgaebel: now please something that works in stable
[18:56:44] <reem> I'd *definitely* try lazy_static and see if it's actually a performance problem before bothering with a macro
[18:57:29] <cgaebel> arrrrrrrrr: write a python script
[18:57:35] <arrrrrrrrr> no
[18:57:40] <bfops> stable? it's not even 1.0 yet..
[18:57:55] <cmr> bfops: that doesn't mean some of us aren't writing for the 1.0-featureset though
[18:58:02] <bfops> ah got it
[18:58:09] <cgaebel> "no". aight.
[18:58:23] <cgaebel> Have fun with that. I'm going to go get lunch.
[18:59:38] <reem> arrrrrrrrr: The answer to your question, if you want only a completely direct answer, is "no"
[19:00:20] <arrrrrrrrr> a systems language that need help from python scripts to be as efficient as c
[19:00:32] <reem> arrrrrrrrr: Obviously it's not perfect...
[19:00:36] <bfops> what? how would you do that in C?
[19:00:43] <cmr> bfops: what he gist'd is valid C.
[19:00:55] <eddyb> cgaebel: erickt's synext
[19:00:57] <reem> The C version writes everything out manually
[19:01:02] <cmr> no, not everything
[19:01:12] <cmr> it sets specific indices to specific values, the rest are zeroed.
[19:01:32] <bfops> wait are you sure they're zeroed?
[19:01:33] <bfops> aren't they just undefined?
[19:01:47] <bfops> oh static memory got it
[19:01:54] <reem> I see
[19:02:06] <arrrrrrrrr> it's not about static memory
[19:02:11] <arrrrrrrrr> it's zeroed either way
[19:02:26] <bfops> wait why?
[19:02:36] <arrrrrrrrr> because that's what the standard says
[19:02:52] <reem> arrrrrrrrr: So yes, you're right. There's no convenient way to do this in rust right now, so in this case rust is going to be worse than C. There's no reason we couldn't add sugar to do stuff like this later though, so there's no need to worry about this as a serious limitation of the language.
[19:03:13] <eddyb> hmm?
[19:03:14] <reem> (vs. just a temporary inconvenience that you have to deal with this)
[19:03:21] <arrrrrrrrr> I'll just write a big match for now
[19:03:24] <eddyb> what are we talking about now?
[19:03:41] <eddyb> LLVM has zeroinitializer for things like [0; N]
[19:03:48] <reem> eddyb: Initializing a large static array with sparse values, leaving everything else zeroed
[19:03:49] <eddyb> we don't use it and end up blowing up
[19:03:53] <reem> eddyb: Like this https://gist.github.com/anonymous/1ebade7b67168ba9c971
[19:04:19] <eddyb> hey, remember that syntax we were throwing around?
[19:04:44] *** Joins: eerie (eerie@moz-nu5r7u.red.bezeqint.net)
[19:04:56] <reem> you'll have to be a *bit* more specific :P
[19:05:09] <eddyb> the bulk of that syntax could be valid Rust if some crazy people (*cough*) got their way
[19:05:18] <eddyb> reem: Point { (.x, .y) = (1, 2) }
[19:08:24] *** Quits: Rusky (russell@moz-2a17lj.slkc.qwest.net) (Ping timeout: 121 seconds)
[19:09:04] *** Quits: zmack (zmack@moz-b26i0b.home.aster.pl) (Connection closed)
[19:09:51] *** Quits: reem (reem@moz-gnnetp.coob.q2h1.0009.2601.IP) (Connection closed)
[19:13:12] <aturon> acrichto: can you remind me of the plan for timer? is there an external crate?
[19:13:34] <acrichto> aturon: old_io::timer?
[19:13:43] <aturon> yes
[19:13:45] <steveklabnik> aturon: there's a pr for thread::sleep
[19:13:56] <acrichto> aturon: I didn't plan on reimplementing it anywhere
[19:14:19] <aturon> acrichto: ok, for some reason i thought we had some externalization plan. i've seen a few people asking about it
[19:14:39] <acrichto> aturon: architecturally it requires a helper thread, and it's not like it's impossible to move elsewhere
[19:14:44] <acrichto> so we could make a crate on crates.io
[19:15:30] <aturon> acrichto: ok, i'll let people know that if there's enough demand we can help move it out of tree, once higher-priority stuff is done. thanks
[19:16:28] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[19:16:29] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[19:16:29] *** ChanServ sets mode: +o pcwalton
[19:16:53] *** Quits: dudel (dud@moz-55rvi2.dclient.hispeed.ch) (Quit: Leaving)
[19:16:59] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[19:18:00] *** Joins: swgillespie (swgillespie@moz-upj.3un.220.167.IP)
[19:21:54] *** Quits: sigma (sigma@moz-ohog4c.range86-135.btcentralplus.com) (Ping timeout: 121 seconds)
[19:23:44] *** Joins: Rusky (russell@moz-2a17lj.slkc.qwest.net)
[19:24:59] *** Quits: scialex (scialex@moz-j5mi8i.cs.brown.edu) (Quit: Leaving)
[19:26:15] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[19:27:16] *** Quits: brson (brson@moz-u3dg2t.sfo1.mozilla.com) (Quit: leaving)
[19:27:34] *** Quits: kmcguire_ (kmcguire@moz-pg1gb9.biz.rr.com) (Ping timeout: 121 seconds)
[19:28:02] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Ping timeout: 121 seconds)
[19:36:58] <simukis> timer can be easily implemented without a helper thread imo
[19:37:28] <simukis> on windows with the timer API I linked to in thread::sleep PR and on linux with signals.
[19:37:52] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[19:39:33] <simukis> s/linux/unix
[19:39:41] *** Joins: nrc (nrc@moz-4bhi2i.xtra.co.nz)
[19:39:41] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[19:39:41] *** ChanServ sets mode: +o nrc
[19:43:09] <reem> simukis: link to that comment?
[19:44:13] *** Joins: srh (User@moz-ov4.5f3.242.50.IP)
[19:44:46] <simukis> reem: easier to just link to the API itself: https://msdn.microsoft.com/en-us/library/ms687008(v=vs.85).aspx
[19:45:22] <simukis> SetWaitableTimer allows to set a period
[19:45:55] <reem> and WaitForSingleObject blocks?
[19:47:17] <simukis> reem: you don't have to Wait
[19:47:51] <reem> simukis: I'm totally unfamiliar with all of these APIs, ftr.
[19:48:08] *** Joins: zmack (zmack@moz-4b0.o8l.26.188.IP)
[19:48:28] <simukis> I'm not windows user either, I just skim their docs once in a while when I am reviewing std patches
[19:48:38] <simukis> you'll have to ask bunny for details
[19:49:01] <simukis> the thing is that windows has a concept simlar to signals
[19:49:15] <simukis> where it interrupts a thread and executes another arbitrary code
[19:49:35] <reem> ok interesting
[19:49:50] <reem> once you have that primitive I see how you could write a timer
[19:50:12] *** Quits: {-}grant ({0}grant@moz-63ubas.in.charter.com) (Ping timeout: 121 seconds)
[19:57:42] *** Quits: larhat1 (Adium@moz-8v4.af0.232.213.IP) (Quit: Leaving.)
[20:00:21] *** Quits: Nekit1234007 (nekit@moz-2vpc3e.broadband.iskratelecom.ru) (Quit: leaving)
[20:01:26] <larsberg> make sure you have somebody who knows windows well review that code; the requirements for if/how the message loop needs to be pumped differ depending on the thread's creation order, COM apartment status, etc. and you can break things like async I/O completions in pretty subtle ways if you're not careful
[20:02:00] <arrrrrrrrr> simukis: signals? are you sure?
[20:02:18] <reem> Does it ever make sense to do a release load or an acquire store?
[20:03:15] <arrrrrrrrr> no
[20:04:41] <simukis> arrrrrrrrr: what else does one use SIGALRM for?
[20:05:37] <arrrrrrrrr> simukis: nothing? don't use signals.
[20:06:29] <simukis> oh well, the unixes can then use an inferior (to windows) method of using a helper thread.
[20:08:44] <arrrrrrrrr> now you're implying that you can only have timers with signals
[20:08:48] <arrrrrrrrr> but that's also wrong
[20:10:54] * reem is curious to hear alternatives
[20:11:04] <simukis> with signals *and* helper threads.
[20:12:16] <arrrrrrrrr> reem: depends on what you're trying to do
[20:12:28] <simukis> timers
[20:12:31] <reem> I don't have anything concrete, I'm just interesting in ideas for timers
[20:12:45] <arrrrrrrrr> simukis: what does a timer do? you've to be more specific
[20:13:49] <simukis> arrrrrrrrr: interrupts thread every specified interval of time and executes your arbitrary code.
[20:14:41] <simukis> alternativelly to interrupting it could only execute your arbitrary code at well specified locations, e.g. when you call some function.
[20:15:05] *** Quits: avikpal (avikpal@moz-tqp.4af.194.117.IP) (Connection closed)
[20:15:13] <arrrrrrrrr> that sounds pretty ridiculous
[20:16:20] <arrrrrrrrr> if by "some function" you mean timer_gettime, then that works
[20:16:24] <arrrrrrrrr> but not for random functions
[20:16:38] <arrrrrrrrr> or the stdlib could litter its code with timer_gettime calls
[20:16:42] <arrrrrrrrr> then that would work
[20:17:12] <reem> I don't think there should be anything but thread::sleep in std
[20:17:14] *** Quits: jgallagher (john@moz-d5e8oc.hfc.comcastbusiness.net) (Client exited)
[20:17:25] <arrrrrrrrr> certainly nothing with signals
[20:17:26] <simukis> reem: I share your sentiment
[20:21:09] <simukis> how hard is it to get things into try?
[20:22:05] <XMPPwocky> into try?
[20:22:16] * simukis doesn't want to set up virtual machines on his 128GB drive to test his patch on windows, all of the bsd flavours and is not enthusiastic spending a billion USD for an iphone to test the patch on
[20:22:31] <simukis> err, I mean €, I use €.
[20:23:02] <simukis> XMPPwocky: try builders.
[20:23:20] <simukis> never seen them actually used
[20:24:00] *** Quits: swgillespie (swgillespie@moz-upj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[20:26:46] *** Joins: swgillespie (swgillespie@moz-upj.3un.220.167.IP)
[20:26:49] <cmr> simukis: what branch do you want tried?
[20:27:02] *** Joins: srh_ (User@moz-ov4.5f3.242.50.IP)
[20:29:38] <simukis> cmr: I don’t have anything so far, but will certainly have some soon
[20:30:07] <simukis> just wanted to ask so I know whether I should go ahead and find a machine with all the other OSes on it instead
[20:30:08] <arrrrrrrrr> how do I cast a SignedInt to a i32?
[20:30:30] <simukis> transmute?
[20:30:36] <arrrrrrrrr> no
[20:30:46] *** Quits: srh (User@moz-ov4.5f3.242.50.IP) (Ping timeout: 121 seconds)
[20:30:49] <simukis> we don't have anything like dynamic_cast in C++ yet, in my knowledge
[20:31:11] <cmr> simukis: no, anyone with commit access can push it for you
[20:31:21] <simukis> cmr: ok, thanks!
[20:33:15] <WindowsBunny> arrrrrrrrr: Clearly we need a Cast trait
[20:33:48] <simukis> WindowsBunny: http://doc.rust-lang.org/std/num/trait.NumCast.html ;_
[20:33:51] <arrrrrrrrr> Errno(-ret.to_i64().unwrap() as c_int)
[20:33:55] <arrrrrrrrr> disgusting
[20:35:02] <reem> WindowsBunny: There's an RFC for a set of conversion traits.
[20:35:40] <reem> As/Into/From
[20:37:33] <arrrrrrrrr> why does as _ not work in macros?
[20:38:12] <reem> It does sometimes
[20:39:19] <arrrrrrrrr> 122 errors tell me otherwise
[20:40:10] <arrrrrrrrr> https://gist.github.com/anonymous/d0db2b6d83856f4152fd
[20:40:17] <arrrrrrrrr> great, doesn't work outside of the macro either
[20:41:35] <reem> what's the error?
[20:41:48] <cmr> oribably type must be known in this context
[20:42:11] *** Quits: ctennis (ctennis@moz-su6.e72.137.99.IP) (Quit: Leaving...)
[20:42:17] <arrrrrrrrr> ^
[20:42:26] <arrrrrrrrr>  error: non-scalar cast: `isize` as `[type error]`
[20:42:44] <reem> in this case it looks really trivial to just do as c_int instead
[20:43:15] *** Joins: erickt (erickt@moz-l8ebtf.sfo1.mozilla.com)
[20:43:50] <arrrrrrrrr> are you making excuses for the compiler?
[20:44:39] <reem> If recommending a workaround counts as making excuses
[20:44:55] <reem> but that seems to be a very aggressive and not useful definition of making excuses ;)
[20:44:58] <arrrrrrrrr> https://gist.github.com/anonymous/76865bd220d47c3d80fb
[20:45:02] *** Quits: semarie (semarie@moz-e4rh2f.7by7.de) (A TLS packet with unexpected length was received.)
[20:45:04] *** Joins: larhat (Adium@moz-noi20f.mfe0.h1q1.2168.2a02.IP)
[20:45:04] <arrrrrrrrr> now that's ridiculous
[20:45:11] <arrrrrrrrr> this as doesn't work either
[20:45:25] *** Quits: Rym (y@moz-859.d1r.39.217.IP) (Ping timeout: 121 seconds)
[20:45:26] <reem> is `as _` supported, generally speaking?
[20:45:35] <reem> playbot: let x: i64 = 3i32 as _;
[20:45:36] -playbot- <anon>:14:22: 14:31 error: the type of this value must be known in this context
[20:45:36] -playbot- <anon>:14         let x: i64 = 3i32 as _;
[20:45:36] -playbot- output truncated; full output at: http://bit.ly/1H7jVEl
[20:45:42] <cmr> it only works in simple cases.
[20:45:50] <reem> "simple" :P
[20:45:51] <arrrrrrrrr> works for pointers
[20:46:09] <reem> it probably works for `as X<_>`, but not `as _` specifically
[20:46:29] <reem> e.g. rustc for some reason has a tough time with completely open `as`
[20:49:15] *** Quits: erickt (erickt@moz-l8ebtf.sfo1.mozilla.com) (Ping timeout: 121 seconds)
[20:49:34] *** Joins: erickt (erickt@moz-l8ebtf.sfo1.mozilla.com)
[20:52:20] *** Joins: reedlepee (Mibbit@moz-juv.9o3.252.72.IP)
[20:53:46] *** Joins: ctennis (ctennis@moz-vcpg3c.in.comcast.net)
[20:55:38] *** Quits: reedlepee (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[20:56:46] <nrc> it depends, I think, on the context in which the cast exists too - rustc needs to be able to infer the value for _, which is more complicated than most inference
[20:56:54] *** Quits: erickt (erickt@moz-l8ebtf.sfo1.mozilla.com) (Ping timeout: 121 seconds)
[20:57:31] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[21:01:48] *** Joins: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net)
[21:01:48] *** ChanServ sets mode: +o pnkfelix
[21:01:54] *** Joins: brson (brson@moz-u3dg2t.sfo1.mozilla.com)
[21:01:55] *** ChanServ sets mode: +o brson
[21:03:09] *** Quits: eternaleye (eternaleye@moz-5fh.ehi.245.50.IP) (Ping timeout: 121 seconds)
[21:03:34] <reem> arrrrrrrrr: I was just thinking that unsized arguments in the same vein as unsized returns could be used to solve https://github.com/rust-lang/rfcs/issues/981 without subtyping/conversions
[21:04:21] <reem> I haven't thought too hard about all the interactions though, just something interesting to possibly consider.
[21:04:45] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[21:06:03] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[21:06:03] *** ChanServ sets mode: +o pcwalton
[21:06:22] *** Quits: larhat (Adium@moz-noi20f.mfe0.h1q1.2168.2a02.IP) (Quit: Leaving.)
[21:07:23] *** Joins: eternaleye (eternaleye@moz-5fh.ehi.245.50.IP)
[21:08:11] <arrrrrrrrr> how expensive are re-exports in terms of compile time?
[21:10:26] <sfackler> very cheap I believe
[21:10:32] <arrrrrrrrr> that's good
[21:10:33] <sfackler> resolve is like 0% of compile time
[21:10:48] <simukis> arrrrrrrrr: pretty cheap relative to various checks and trans
[21:10:52] <simukis> s/trans/llvm/
[21:11:08] <arrrrrrrrr> I've decided to put the whole content of one of my crates in an "imp" mod where everything is public and then I re-export everything in top level modules
[21:14:29] *** Quits: killercup (killercup@moz-edmf2j.dip0.t-ipconnect.de) (Quit: My Mac has gone to sleep. ZZZzzz…)
[21:16:15] *** Quits: zmack (zmack@moz-4b0.o8l.26.188.IP) (Connection closed)
[21:18:08] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Connection closed)
[21:18:26] <arrrrrrrrr> I'm surprised that rustdoc handles it properly
[21:18:33] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[21:21:24] *** Joins: blaenk_ (blaenkdenum@moz-em283u.res.rr.com)
[21:22:38] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Ping timeout: 121 seconds)
[21:23:13] *** Joins: lfairy (lfairy@moz-5un4tp.vf.net.nz)
[21:24:10] *** Quits: blaenk_ (blaenkdenum@moz-em283u.res.rr.com) (Connection closed)
[21:25:03] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[21:27:10] *** Joins: srh__ (User@moz-ov4.5f3.242.50.IP)
[21:29:53] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[21:30:15] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Connection closed)
[21:30:44] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[21:30:49] *** Quits: srh_ (User@moz-ov4.5f3.242.50.IP) (Ping timeout: 121 seconds)
[21:33:31] *** Joins: jgallagher (john@moz-6ge.dhn.131.24.IP)
[21:40:34] *** Quits: guewen (guewen@moz-ftf7u4.cust.swisscom.ch) (Quit: Leaving...)
[21:40:46] <richo> I'm haing a look at #23460, but it seems like passing the error messages aroudn as &str's everywhere is fairly unfortunately, eg a type fix will break a bunch of checks. How reasonable is it for me to convert them into an enum?
[21:40:56] <richo> (Seems that this would also make i18n much simpler down the road)
[21:41:14] <richo> specifically, https://github.com/rust-lang/rust/blob/master/src/librustc/session/mod.rs#L262-271
[21:42:03] <richo> and https://github.com/rust-lang/rust/blob/master/src/librustc/middle/infer/error_reporting.rs#L360-372
[21:43:00] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Connection closed)
[21:43:31] *** Joins: njn (chatzilla@moz-sqinim.iinet.net.au)
[21:43:55] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[21:44:38] <reem> richo: an enum with a Display implementation sounds like the right way to do this
[21:45:13] <richo> cool, it wasn't immediately clear to me that Display is the correct approach, because I don't have a great sense of the contract of that trait, but I can do the migration easy enough
[21:45:27] *** Parts: huon (huon@moz-hj272o.8rnv.rggd.6180.2400.IP) ("Leaving")
[21:45:28] <richo> changing approach for what the actual -> String machinery looks like is trivial
[21:45:30] <richo> thanks!
[21:45:34] *** Joins: huon (huon@moz-hj272o.8rnv.rggd.6180.2400.IP)
[21:45:34] *** ChanServ sets mode: +o huon
[21:46:48] <reem> Display is the formatter used in {}
[21:47:16] <reem> it is supposed to format the value for printing to users
[21:47:21] <reem> so sounds perfect for something like this
[21:47:41] <arrrrrrrrr> reem: I don't think that's true
[21:48:08] <reem> oh?
[21:48:29] <arrrrrrrrr> Display is for things with an injective function -> String
[21:49:19] <reem> oh that's not my impression at all
[21:49:19] <richo> I've implemented it as Display for now, I can go back and change it
[21:49:26] <reem> I think Debug is more similar to that
[21:49:50] <reem> I don't think there are really rules for Display
[21:50:03] <arrrrrrrrr> reem: not at all. str --Debug--> str --parse--> str doesn't give the original result
[21:50:04] <reem> since different apps will want totally different user-facing formatting
[21:50:32] <reem> arrrrrrrrr: That's orthogonal
[21:50:46] <reem> Neither Debug nor Display are generally reversible
[21:51:00] <arrrrrrrrr> it's not. the debug implementation of str is not injective
[21:51:26] <huon> what are two strings that give the same {:?} output?
[21:51:36] <arrrrrrrrr> ä and \xWHATEVERY
[21:51:40] <arrrrrrrrr> *WHATEVER
[21:51:53] <huon> that's two literals that give the same output, but they're the same in memory
[21:51:58] <arrrrrrrrr> rusti: println!("{:?}", "ä")
[21:51:59] -playbot- "\u{e4}"
[21:51:59] -playbot- ()
[21:52:05] <arrrrrrrrr> well, not \x but \u
[21:52:10] <reem> I was not under any impression either Debug or Display are supposed to be injective
[21:52:22] <arrrrrrrrr> rusti: println!("{:?}", "\\u{e4}")
[21:52:24] -playbot- "\\u{e4}"
[21:52:24] -playbot- ()
[21:52:33] <arrrrrrrrr> ah
[21:52:42] <arrrrrrrrr> maybe it is injective
[21:53:31] <reem> playbot: use std::sync::Mutex; println!("{:?}", Mutex::new(7)); println!("{:?}", Mutex::new(15));
[21:53:33] -playbot- Mutex { data: 7 }
[21:53:33] -playbot- Mutex { data: 15 }
[21:53:33] -playbot- ()
[21:53:44] <reem> wow that is surprising
[21:54:06] <cmr> playbot-mini: use std::sync::Mutex; let x = Mutex::new(7); let y = x.lock(); println!("{:?}", x);
[21:54:06] -playbot-mini- <anon>:1:23: 1:26 error: expected item, found `let`
[21:54:07] -playbot-mini- <anon>:1 use std::sync::Mutex; let x = Mutex::new(7); let y = x.lock(); println!("{:?}", x);
[21:54:07] -playbot-mini- output truncated; full output at: http://bit.ly/1BUnSrj
[21:54:22] <cmr> playbot: use std::sync::Mutex; let x = Mutex::new(7); let y = x.lock(); println!("{:?}", x);
[21:54:24] -playbot- Mutex { <locked> }
[21:54:24] -playbot- ()
[21:54:39] <cmr> (RWLock etc all do the same)
[21:54:42] <reem> arrrrrrrrr: Mutex's Debug impl is not injective ^
[21:54:50] <arrrrrrrrr> reem: how so?
[21:54:54] <arrrrrrrrr> looks injective to me
[21:55:05] <huon> Mutex::new(1) and Mutex::new(2) give the same output when locked
[21:55:21] <reem> to clarify, I'm using injective to mean one-to-one function, in the mathematical sense
[21:55:30] <arrrrrrrrr> that's MutexGuard
[21:55:41] <huon> that's not MutexGuard
[21:55:49] <reem> arrrrrrrrr: It's Mutex. x is being logged, not y.
[21:55:51] <huon> x is a Mutex<i32> (in cmr's example)
[21:55:54] <arrrrrrrrr> I see
[21:56:45] *** Quits: eerie (eerie@moz-nu5r7u.red.bezeqint.net) (Connection closed)
[21:57:15] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Ping timeout: 121 seconds)
[21:57:33] *** Joins: {-}grant ({0}grant@moz-63ubas.in.charter.com)
[22:00:12] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Connection closed)
[22:00:54] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[22:01:30] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[22:03:41] <aturon> huon: did you have any further thoughts on the rand "combo" refactoring?
[22:03:54] *** Quits: adu (ajr@moz-4ca.v06.48.108.IP) (Client exited)
[22:04:31] *** Quits: swgillespie (swgillespie@moz-upj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[22:05:48] <huon> aturon: not yet
[22:06:01] <huon> aturon: I want to implement/experiment with your idea
[22:07:28] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Connection closed)
[22:07:42] <aturon> huon: ok. after thinking about it some more, my feeling is that if we want to allow customizable ranges/distributions, we should probably push for an open-ended solution
[22:07:58] <aturon> huon: in particular, the "assoc" approach ends up locking you into ad hoc notions of "distribution" per type
[22:08:05] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[22:08:25] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[22:08:39] <aturon> IOW, i don't see any way to write a reasonable convention for how to choose the associated type
[22:09:40] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[22:10:12] <huon> I agree it's suboptimal
[22:10:32] <huon> put that way it sounds a lot like we shouldn't take that approach
[22:12:24] <aturon> huon: one way to dig a bit deeper would be to try to figure out what the associated type choices would be for various types in std. i suspect they largely wind up being Range
[22:13:07] <aturon> in which case, having gen + gen_range (using notation) seems like a reasonable incremental improvement over today's setup, without introducing a bunch of new complexity
[22:14:18] <aturon> (at any rate, that's probably another good alternative to list, just to keep things grounded)
[22:14:58] <huon> aturon: I'm not sure what you mean by 'using notation'?
[22:15:03] <huon> i.e. .gen(a..b)?
[22:15:49] <aturon> huon: no, i mean: have a gen(&mut self) and gen_range<R: Into<Range<T>>>(&mut self, range: R)
[22:16:19] <aturon> (gen_range needs additional bounds, but you get the idea)
[22:18:17] *** Quits: bjz (bjz@moz-puppgq.tpgi.com.au) (Quit: My Mac has gone to sleep. ZZZzzz…)
[22:22:49] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Ping timeout: 121 seconds)
[22:23:28] <carllerche> is next_power_of_two completely gone then?
[22:23:58] <arrrrrrrrr> why would it
[22:24:36] <carllerche> ah, it looks like it was moved
[22:25:08] <huon> carllerche: it's now an inherent method on the integer types
[22:25:20] <huon> (which don't appear in the search atm)
[22:25:22] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Client exited)
[22:25:35] <huon> http://doc.rust-lang.org/nightly/std/primitive.u8.html#method.next_power_of_two
[22:25:49] <arrrrrrrrr> >Unspecified behavior on overflow.
[22:25:57] <aturon> huon: is there an issue open on the search problem?
[22:25:58] <carllerche> huon: search wasn't working for me
[22:26:13] <huon> aturon: I believe so
[22:26:17] <steveklabnik> yeah i saw a PR i believe
[22:26:38] <steveklabnik> https://github.com/rust-lang/rust/issues/23511 <- oh just htis issue
[22:26:39] <steveklabnik> this
[22:27:14] *** Joins: srh_ (User@moz-ov4.5f3.242.50.IP)
[22:27:28] <aturon> huon: steveklabnik: thanks!
[22:30:06] <brson> why did collections get its own test crate?
[22:30:27] <sfackler> brson: staging issues when moving methods to inherent impls on primitives
[22:30:52] *** Quits: srh__ (User@moz-ov4.5f3.242.50.IP) (Ping timeout: 121 seconds)
[22:30:53] <brson> thanks
[22:31:13] *** Quits: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net) (Client exited)
[22:34:55] *** Quits: brson (brson@moz-u3dg2t.sfo1.mozilla.com) (Ping timeout: 121 seconds)
[22:42:49] *** Quits: srh_ (User@moz-ov4.5f3.242.50.IP) (Quit: Leaving)
[22:43:17] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Quit: Leaving)
[22:45:02] *** Quits: jdm (jdm@moz-ilbt2e.cable.teksavvy.com) (Quit: )
[22:48:36] *** Joins: adu (ajr@moz-0foa9t.md.comcast.net)
[22:48:57] *** Joins: swgillespie (swgillespie@moz-upj.3un.220.167.IP)
[23:01:37] *** Quits: tjakubow (tom@moz-ag87jj.fios.verizon.net) (Quit: WeeChat 1.1.1)
[23:06:36] *** Joins: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net)
[23:06:37] *** ChanServ sets mode: +o pnkfelix
[23:07:05] <nrc> ah crap, I can't remember how monomorphisation works :-s
[23:24:27] *** Joins: mib_35qnzj (Mibbit@moz-juv.9o3.252.72.IP)
[23:25:35] *** Quits: mib_35qnzj (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[23:27:19] <pnkfelix> nrc: BTW if you *want* to review PR gh23535 (highfive had originally assigned you), feel free.
[23:27:19] <[o__o]> Replace zeroing-on-drop with filling-on-drop.: https://github.com/rust-lang/rust/pull/23535
[23:27:32] <pnkfelix> nrc: but I assumed you'd just as soon have nmatsakis do it
[23:27:38] <nrc> pnkfelix: I absolutely do not :-p
[23:29:00] <nrc> my thought process was, "ooo, that's good timing, something I can review whilst I wait for this to compile", "oh", "ah, thank god, NIko is now assigned"
[23:29:03] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[23:29:13] <pnkfelix> nrc: its not *that* bad
[23:29:28] <pnkfelix> nrc: but I understand your apprehension
[23:29:41] <nrc> :-)
[23:30:04] <nrc> pnkfelix: are you using run-pass-valgrind tests?
[23:30:13] <nrc> it seems like the kind of thing which should have them
[23:30:40] <pnkfelix> nrc: I didn't add any new ones, but I believe my machine is running valgrind... let me see
[23:31:05] *** Quits: ebfull (ebfull@moz-2hf06a.co.comcast.net) (Ping timeout: 121 seconds)
[23:31:36] <nrc> the advantage of run-pass-valgrind tests is that they are run with Valgrind on the builders, so they prevent regressions by people who don't always run Valgrind
[23:31:40] <eddyb> nrc: larsberg seemed to think you were working on DST, please tell me we're not duplicating work :)
[23:31:57] <nrc> eddyb: coercions? Not at the moment
[23:32:04] <pnkfelix> nrc: I'll see if I can put some in
[23:32:06] <eddyb> nrc: good, good :D
[23:32:06] <nrc> eddyb: I'm working on other coercion stuff
[23:32:16] <nrc> eddyb: are you looking at DST coercions?
[23:32:27] <eddyb> nrc: not merely looking
[23:32:37] <eddyb> but I'm curious what else you're doing that touches coercions
[23:32:49] <nrc> changing casts
[23:32:56] <nrc> to do the trivial casts lint
[23:33:19] <nrc> which turned out to be harder than expected
[23:33:59] <nrc> eddyb: are you planning to rebase your type ascription branch?
[23:34:14] <eddyb> nrc: I could probably do it right now... it's tiny :D
[23:34:40] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[23:34:46] <nrc> sweet
[23:34:53] <eddyb> nrc: but nmatsakis agreed we should handle DST coercions first because we don't know what the end result will look like, exactly
[23:34:59] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[23:34:59] *** ChanServ sets mode: +o pcwalton
[23:35:23] <nrc> sure
[23:35:35] <arrrrrrrrr> https://gist.github.com/anonymous/665b3660619391809d6f
[23:35:45] <arrrrrrrrr> what's the problem here?
[23:35:46] <eddyb> nrc: I'm getting close to being able to add the new traits https://github.com/eddyb/rust/commits/dst
[23:36:20] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[23:41:15] <nrc> eddyb: you're removing Box coercions?
[23:43:22] <eddyb> nrc: look closer :D
[23:43:57] <eddyb> nrc: no, just encoding them using the same mechanism
[23:44:34] <eddyb> nrc: I'm going to end up with unsize: Option<Ty<'tcx>>
[23:44:35] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[23:46:36] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[23:50:19] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Quit: rcirc on GNU Emacs 24.3.92.1)
[23:52:54] <arrrrrrrrr> https://gist.github.com/anonymous/801134bd3c564ce14557
[23:53:01] <arrrrrrrrr> this is pretty ridiculous
[23:53:50] <arrrrrrrrr> why does the return borrow self for the rest of the function?
[23:54:04] <eddyb> arrrrrrrrr: SEME
[23:54:07] <eddyb> arrrrrrrrr: or lack thereof
[23:55:08] *** Joins: arrrrrrr1 (arrrrrrrrs@moz-4jf9qp.dynamic.qsc.de)
[23:57:54] *** Quits: arrrrrrrrr (arrrrrrrrs@moz-vimofl.dynamic.qsc.de) (Ping timeout: 121 seconds)
