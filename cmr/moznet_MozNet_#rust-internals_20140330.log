[00:03:09] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[00:05:00] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[00:21:41] *** Joins: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP)
[00:21:41] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/xwQAGQ
[00:21:41] *** Parts: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP) ()
[00:25:14] *** Quits: canhtak (canhtak@moz-4FB0FBC1.wl.t.ulaval.ca) (Quit: canhtak)
[00:29:30] *** Joins: canhtak (canhtak@moz-4FB0FBC1.wl.t.ulaval.ca)
[00:45:46] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Connection reset by peer)
[00:47:06] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[00:59:16] *** Quits: mawuli (mawuli@F7A4F2ED.68EE7C48.E520B65A.IP) (Ping timeout)
[00:59:42] *** Joins: mawuli (mawuli@F7A4F2ED.68EE7C48.E520B65A.IP)
[01:03:00] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[01:03:51] <cmr> strcat: did you see https://github.com/mozilla/rust/pull/13039 ?
[01:03:58] <strcat> yes
[01:04:01] <strcat> we talked about it on irc
[01:04:09] <cmr> ok
[01:08:48] *** Quits: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net) (Ping timeout)
[01:09:12] *** Joins: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net)
[01:10:01] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[01:13:37] *** Quits: luz (lu.cy@moz-CD18B14B.customer.cdi.no) (Ping timeout)
[01:15:24] *** Joins: luz (lu.cy@moz-CD18B14B.customer.cdi.no)
[01:21:21] *** Quits: Armavica (virgile@moz-AD428ED7.ens.fr) (Quit: Lost terminal)
[01:22:56] *** Joins: Armavica (virgile@moz-AD428ED7.ens.fr)
[01:34:24] <cmr> huon: something hapened with python that completely destroyed the bencher
[01:34:29] <cmr> huon: but the builder is all caught up
[01:34:33] <cmr> huon: investigating
[01:34:55] *** Quits: japaric (japaric@FCB3637C.59294C36.95AFB88D.IP) (Ping timeout)
[01:44:24] *** Quits: aatch (aatch@moz-2BB0AC01.cable.telstraclear.net) (Client exited)
[01:44:35] <kimundi> Is ther anything else in the testsuite after pretty?
[01:45:16] *** Joins: aatch (aatch@moz-2BB0AC01.cable.telstraclear.net)
[01:46:15] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[01:46:23] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:50:48] <sfackler> kimundi: doc tests maybe
[01:53:30] <kimundi> r? https://github.com/mozilla/rust/pull/13203
[01:54:54] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Connection reset by peer)
[01:55:23] *** Joins: esummers (esummers@moz-3B015C90.wi.res.rr.com)
[01:56:31] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[01:56:37] *** Joins: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP)
[01:56:37] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/0jTrLw
[01:56:37] <ghrust> 13rust/06auto 14c356e3b 15Marvin LÃ¶bel: Removed deprecated functions `map` and `flat_map` for vectors and slices.
[01:56:37] <ghrust> 13rust/06auto 14d79fbba 15bors: auto merge of #13203 : Kimundi/rust/de-map-vec3, r=cmr...
[01:56:38] *** Parts: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP) ()
[01:56:39] *** Joins: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP)
[01:56:39] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/Bq4WLg
[01:56:39] *** Parts: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP) ()
[02:15:57] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[02:20:20] *** Joins: Nekit1234007_ (Nekit12340@1A3BF3D7.477D93D.4707F662.IP)
[02:20:56] *** Quits: Nekit1234007 (Nekit12340@7B4CA0FD.CDD224AA.4707F662.IP) (Ping timeout)
[02:23:41] *** Quits: rook (rook@moz-DE88DB2D.hfc.comcastbusiness.net) (Quit: rook)
[02:29:08] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[02:31:05] *** Joins: compmstr (Mibbit@moz-24DB0F25.dyn.optonline.net)
[02:31:34] *** kimundi is now known as zz_kimundi
[02:34:57] <herrwolfe45> hi - I am trying to compile rustc with debug-information by using ./configure --enable-debug. However, each time I try to run it under gdb, I get "no debug symbols found".
[02:35:54] <sfackler> that doesn't enable debug symbols, it disables the elimination of debug! statments
[02:36:38] <compmstr> Does anyone know how to get the type path from a syntax::ast::Ty?
[02:36:47] <herrwolfe45> ah - thank sfackler 
[02:37:01] <cmr> herrwolfe45: RUSTFLAGS="-g" when building
[02:38:03] *** Quits: zz_kimundi (kimundi@moz-C9206138.dip0.t-ipconnect.de) (Ping timeout)
[02:41:16] *** Joins: japaric (japaric@F19FD5A3.A75B951F.A936879B.IP)
[02:41:36] *** Joins: zz_kimundi (kimundi@moz-8B5A2112.dip0.t-ipconnect.de)
[02:41:39] *** zz_kimundi is now known as kimundi
[02:44:20] <herrwolfe45> cmr: should this be passed as `RUSTFLAGS="-g" make check-stage1-rmake`"?
[02:44:41] <sfackler> herrwolfe45: reverse taht
[02:44:49] <cmr> well, as an env var it also works.
[02:44:53] <sfackler> oh
[02:44:54] <sfackler> til
[02:46:04] <herrwolfe45> ok - thanks!
[02:54:37] *** Quits: bytbox (s@moz-E1E7FAC3.washdc.fios.verizon.net) (Ping timeout)
[02:54:39] *** Joins: bytbox (s@moz-E1E7FAC3.washdc.fios.verizon.net)
[03:09:20] <cgaebel> Can I kill mangle now?
[03:11:43] <sfackler> acrichto: ping
[03:13:27] *** Quits: compmstr (Mibbit@moz-24DB0F25.dyn.optonline.net) (Quit: http://www.mibbit.com ajax IRC Client)
[03:25:50] *** Quits: cgaebel (clark@moz-F9D89110.nyc.res.rr.com) (Ping timeout)
[03:26:40] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Connection reset by peer)
[03:27:36] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[03:44:44] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[03:46:41] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[03:46:41] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/0jTrLw
[03:46:41] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[04:03:09] *** Quits: gwty (gwtypc@D17752E3.C4444A44.137C914F.IP) (Ping timeout)
[04:15:26] *** Quits: bvssvni (Mibbit@moz-A47B6F8E.bb.online.no) (Quit: http://www.mibbit.com ajax IRC Client)
[04:20:10] <acrichto> sfackler: pong
[04:21:09] <cmr> acrichto: does linking to native *always* pull in start?
[04:21:29] <cmr> acrichto: also are the myriad of #[lang="start"], #[start], and #[main] documented anywhere?
[04:21:46] <acrichto> cmr: libnative has the start lang item
[04:21:50] <acrichto> but that's it
[04:21:54] <acrichto> #[start] and #[main] are separate
[04:22:52] <cmr> Mind explaining what they each do, so I don't have to go crawl code? I'm doing some updates to the manual.
[04:23:23] <acrichto> #[main] just switches the main function
[04:23:31] <acrichto> it makes it so you can have something other than 'fn main' at the top level
[04:23:43] <acrichto> #[start] bypasses the lang start item and is essentially C's 'int main()'
[04:23:48] <acrichto> lang start is the "auto start"
[04:24:02] <sfackler> acrichto: should implementations of Show be using Formatter::pad? it seems like we don't in general
[04:24:29] <strcat> acrichto: what's the use case for #[main]?
[04:24:30] <acrichto> if possible, but only for primitive things
[04:24:35] <strcat> test harness?
[04:24:42] <acrichto> sfackler: most formatting implementations don't respect it yeah
[04:24:49] <sfackler> ok, cool. so composite types should just write directly to the buf?
[04:24:53] <acrichto> strcat: that, and just being able to do something other than 'fn main' at the top level
[04:24:58] <acrichto> sfackler: yeah
[04:25:11] <strcat> acrichto: seems ugly though, you can always do #[cfg(...)]
[04:25:17] <strcat> makes sense that it's there for the test harness though
[04:31:45] <cmr> acrichto: what's the usecase for no_main? isn't that just not emitting an executable?
[04:31:58] <acrichto> SDL
[04:32:10] <acrichto> SDL defines the 'main' symbol  and it's up to you to define the SDL_main symbol
[04:32:17] <acrichto> but it's also an executable that's being emitted
[04:32:29] <strcat> acrichto: no, only sdl1.2 does
[04:32:33] <strcat> and it's broken in many other ways
[04:32:35] <strcat> ;p
[04:32:44] <cmr> So it really means no_start, not main?
[04:32:52] <cmr> (#[start], that is)
[04:33:03] <acrichto> #[no_start] may be a bad name, it means "don't link to libnative"
[04:33:15] <acrichto> #[no_main means "don't emit anything for the symbol main"
[04:33:19] <acrichto> but still build an executable
[04:39:47] *** Joins: brson (brson@moz-62518563.mtv2.mozilla.com)
[04:39:47] *** ChanServ sets mode: +qo brson brson
[04:40:33] <cmr> brson: I've started up https://etherpad.mozilla.org/O7HIOOo25R
[04:42:04] <brson> cmr: sweet!
[04:42:11] <brson> you should mention that in the minutes
[04:42:15] <cmr> not sure how or if to advertise it
[04:42:57] <brson> it's sort of unfortunate that our process and tooling don't provide this information :(
[04:43:06] <sfackler> acrichto: do you have any idea what causes some trait impls to be missing the "impl foo for " part in rustdoc? e.g. http://www.rust-ci.org/sfackler/rust-postgres/doc/postgres/types/trait.ToSql.html
[04:43:54] <acrichto> sfackler: whoa that's a little odd
[04:44:03] <brson> cmr: this is a more inclusive version of the status updates at weekly meetings
[04:44:12] <acrichto> sfackler: I think it's types in the crate vs types not in the crate
[04:44:19] <acrichto> no particular reason though
[04:44:41] <sfackler> acrichto: that's what I thought, but crate/vs not crate doesn't seem to be what's going on here
[04:44:59] <cmr> The `impl for` is supposed to to omitted whenever the impl does not have bounds.
[04:45:08] <brson> acrichto: http://brson.github.io/rust-www/
[04:46:02] <acrichto> brson: that is quite different!
[04:46:28] <sfackler> brson: nice!
[04:46:44] <acrichto> brson: what's the character supposed to be between the list of things?
[04:46:48] <acrichto> ê”·
[04:46:56] <acrichto> I see some weird unicode thing
[04:47:06] <brson> ugh
[04:47:06] <sfackler> the install/docs/other downloads buttons seem like they should be flush with the right side
[04:47:10] <cmr> "With Rust, developers will" should be "With Rust, developers can"
[04:47:14] <cmr> acrichto: I see a tilde
[04:47:29] <acrichto> cmr: between "lambdas" and "type iference" ?
[04:47:37] <brson> the ones between the laundry list is a dot
[04:47:37] <cmr> oh that
[04:47:44] <brson> i used the wrong one
[04:47:50] <brson> because i didn't have internets to look it up
[04:48:00] <brson> so it's a very strange dot
[04:48:07] <cmr> acrichto: http://i.imgur.com/qxdImcm.png
[04:48:21] <acrichto> weird
[04:48:29] <brson> i'll find the right one
[04:48:29] <sfackler> I see a box as well
[04:48:40] <acrichto> brson: I like how lightweight it is compared to the current version
[04:48:42] <cmr> brson: I feel this design is unbalanced, in that the left hand side of the page is very dense, and the right hand side is incredibly sparse.
[04:49:09] <brson> this is the install page http://brson.github.io/rust-www/install.html
[04:49:23] <mcpherrin> I like the install page.
[04:49:45] <mcpherrin> though the grey-on-white is hard to read on my screen
[04:49:56] <brson> maybe it should be darker
[04:50:08] <brson> i'll try
[04:50:20] <cmr> "It looks like languages you are familiar with, but its deeper mysteries reveal themselves with time" lol
[04:50:21] <brson> i wasn't sure about putting docs on the install page
[04:50:33] <cmr> I like the content
[04:50:40] <cmr> has character
[04:50:59] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[04:52:16] <mcpherrin> brson: I was expecting that docs link to be a link to *download* all the documentation
[04:52:33] <brson> cmr: would putting the buttons above the elevator pitch be better?
[04:52:43] <brson> mcpherrin: yeah :(
[04:52:52] <brson> i removed the alternate doc link from the header
[04:52:58] <brson> worried about that
[04:53:00] <cmr> brson: might be. I'm unfortunately not an experienced designer.
[04:53:27] <strcat> brson: what's that switch I need to pass again? --no-verify-install ?
[04:53:51] <brson> strcat: --disable-verify-install
[04:54:34] <cmr> brson: perhaps bushing the bottons all the way to the right of the page and letting the text fill most of the rest of the space.
[04:54:58] <cmr> (ie, the right-hand aligned with the "Community" links)
[04:55:07] <brson> cmr: possibly, yeah. i'm going to have to css better ...
[04:55:16] <cmr> can't help you with that, sorry :(
[04:55:25] * cmr tries
[04:56:05] <brson> that's a lot of great feedack, thanks. i wrote it all down and will try to address them all
[04:56:43] <mcpherrin> brson: fortunately I think you've got a few CSS experts around :)
[04:57:08] <cmr> brson: I think changing the class of #patch to col-md-9 and the button's div to col-md-3 improves it
[04:57:24] <cmr> the content of the button's div isn't right-aligned, don't know how to fix that.
[04:58:14] *** Joins: lpy (lpy@8B40CDAC.F09091A8.1348A864.IP)
[05:00:13] *** Joins: lpy_ (lpy@E44EE2C4.F09091A8.1348A864.IP)
[05:00:48] *** Quits: lpy (lpy@8B40CDAC.F09091A8.1348A864.IP) (Ping timeout)
[05:04:58] <brson> i can't stop listening to disco
[05:05:19] <cmr> that's a good problem to have
[05:05:56] * strcat really hates C strings
[05:06:09] <strcat> rust makes me forget how painful they are
[05:06:44] <brson> i made up a 'z' html tag. is that ok?
[05:07:14] <strcat> brson: there's some new standard for user-defined html tags but I wouldn't ;p
[05:07:18] <sfackler> wat
[05:07:19] *** Joins: gwty (gwtypc@D17752E3.C4444A44.137C914F.IP)
[05:08:53] <sfackler> cmr: so it looks like the distinction on "impl foo for bar" vs "bar" is just whether or not the type was defined in this crate
[05:08:58] <sfackler> which seems weird to me
[05:13:34] *** Quits: mawuli (mawuli@F7A4F2ED.68EE7C48.E520B65A.IP) (Connection reset by peer)
[05:14:25] *** Joins: mawuli (mawuli@F7A4F2ED.68EE7C48.E520B65A.IP)
[05:15:44] *** Joins: japaric_ (japaric@CFC3E8D5.E67A32BD.5C7588CA.IP)
[05:15:55] *** Quits: japaric (japaric@F19FD5A3.A75B951F.A936879B.IP) (Ping timeout)
[05:17:59] <brson> i replaced the dot with a standard interpunct
[05:18:39] <acrichto> brson: rust ate my laundry, should I file an issue?
[05:18:48] <acrichto> (the dots look good)
[05:19:05] <acrichto> "no data races"
[05:19:16] <acrichto> we can't emphasize that enough
[05:19:27] <brson> is there a better way to say it?
[05:19:51] <sfackler> <h1><blink><marquee>No data races</marquee></blink></h1>
[05:19:54] <brson> i'd like all the luandry list things to link to something useful
[05:19:57] <acrichto> <blink><strong>no data races</blink></strong>
[05:19:59] <acrichto> lol
[05:20:12] <cmr> with invalidly nested elements, even
[05:20:14] <cmr> tisk tisk
[05:20:26] <cmr> brson: the real test, is how well does this render in servo?
[05:20:27] * cmr tests
[05:20:27] * acrichto is the finest html author around
[05:20:42] * cmr builds pcwalton's acid2 branch
[05:20:50] <sfackler> brson: the "inference" in "type inference" wraps to a second line for me
[05:20:52] <acrichto> brson: we'd need to get the blogging going to get links for these things
[05:21:16] <sfackler> cmr: is there any reason to not use the "impl A for B" form for all types in rustdoc?
[05:21:18] <brson> sfackler: thanks. i'll try to fix that
[05:21:31] <acrichto> brson: it looks ok to me, may just be font size
[05:21:32] <cmr> sfackler: noisy, useless.
[05:21:40] <acrichto> or some other weird thing
[05:21:40] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Connection reset by peer)
[05:21:42] <cmr> sfackler: you're *already* looking at the page for the trait, and the list of implementors.
[05:21:53] <cmr> sfackler: do you need to see `impl SameTrait for` all the time?
[05:21:56] <sfackler> sure, but it's just *inconsistent* now
[05:22:00] *** Joins: edwardw (Mibbit@4660DACB.EE06708D.4BFBD933.IP)
[05:22:03] <cmr> that should be fixed.
[05:22:18] <cmr> it should only show `impl ...` where there are type parameters in the "impl"
[05:23:40] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[05:27:26] <brson> strcat: does DESTDIR work for you again?
[05:27:57] <strcat> brson: I think so
[05:28:02] <strcat> brson: just the verification step failed
[05:28:05] <strcat> forgot to update it
[05:28:25] <strcat> brson: I started the build again but it's in a load average queue behind stuff ;p
[05:28:35] <strcat> for one thing.... the daily firefox aurora build, with PGO
[05:28:37] * strcat sighs
[05:30:02] <cmr> hah
[05:30:07] <cmr> that poor build server
[05:30:22] <strcat> load average: 8.64, 6.94, 6.38
[05:48:24] *** Quits: canhtak (canhtak@moz-4FB0FBC1.wl.t.ulaval.ca) (Quit: canhtak)
[05:48:45] *** Quits: gwty (gwtypc@D17752E3.C4444A44.137C914F.IP) (Ping timeout)
[05:50:31] *** Joins: gwty (gwtypc@D17752E3.C4444A44.137C914F.IP)
[06:06:30] *** Quits: brson (brson@moz-62518563.mtv2.mozilla.com) (Ping timeout)
[06:09:43] *** Quits: gwty (gwtypc@D17752E3.C4444A44.137C914F.IP) (Ping timeout)
[06:11:42] *** Joins: gwty (gwtypc@D17752E3.C4444A44.137C914F.IP)
[06:20:25] *** Joins: brson (brson@moz-62518563.mtv2.mozilla.com)
[06:20:25] *** ChanServ sets mode: +qo brson brson
[06:21:24] *** Quits: gwty (gwtypc@D17752E3.C4444A44.137C914F.IP) (Ping timeout)
[06:24:31] <cmr> Nobody updated the manual with the new attribute syntax :(
[06:26:43] <mcpherrin> documentation only exists in two states: incomple or outdated
[06:26:57] <cmr> unfortunate but true.
[06:28:31] *** Joins: gwty (gwtypc@D17752E3.C4444A44.137C914F.IP)
[06:29:08] <Luqman> cmr: wanna do the vim syntax file while you're at it? :P
[06:29:29] <cmr> I guess I'll do all the syntax files, if it's simple.
[06:29:58] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[06:33:32] <cmr> Should #[test] be in the language reference?
[06:33:40] <cmr> It could/should be implemented entirely by a libtest syntax extension.
[06:33:44] <cmr> And not part of the language itself.
[06:33:45] <huon> not really?
[06:34:02] <cmr> not really at hat?
[06:34:02] <huon> it requires magical override-privacy
[06:34:14] <huon> (it shouldn't really be in the lang ref)
[06:34:19] <cmr> it does require that.
[06:34:35] <cmr> on the other hand I'm willing to say that's a feature of the implementation (rustc)
[06:34:38] <sfackler> why *does* it require magical override-privacy anyway?
[06:34:49] <cmr> sfackler: so all your test modules and functions don't need to be public.
[06:34:53] <mcpherrin> being able to override privacy seems like a feature useful in general
[06:35:15] <huon> sfackler: it creates a main function to call all the test functions, but it's at the top level, i.e. no access to private members of children
[06:35:20] <cmr> mcpherrin: #[!resolve_unexported] on your module :P
[06:35:34] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Ping timeout)
[06:35:45] <mcpherrin> shouldn't tie people to a single libtest impl
[06:36:17] <huon> need something like `--crate-transform test`
[06:36:27] <huon> --crate-transform mytest
[06:36:28] <huon> etc.
[06:36:59] <cmr> I'm also inclined to leave out #[cold] and #[inline]
[06:37:20] <cmr> they cause no language-visible effects
[06:37:52] <cmr> I believe lints should also be left out of the language proper.
[06:38:04] <huon> individual lints, yeah
[06:38:10] <mcpherrin> lints should stay in the dryer
[06:38:13] <cmr> the entire lint system
[06:38:14] <huon> #[allow] etc. should probably be part of it?
[06:38:18] <cmr> why?
[06:38:35] <huon> dunno... feels kinda fundamental
[06:38:48] <huon> half the reason I like rust is because the compiler is so helpful :P
[06:38:52] <cmr> to the compiler perhaps
[06:38:55] <cmr> yes, certainly.
[06:38:59] <cmr> but that's not a property of the language?
[06:39:14] <huon> language could require compilers to be helpful :P
[06:39:17] <cmr> heh
[06:39:18] <huon> (but yeah)
[06:39:26] <huon> you're very convincing
[06:39:44] <cmr> irony?
[06:39:59] <cmr> I'm on the fence about lints
[06:40:06] <cmr> the lint level propagation is somewhat tricky.
[06:40:11] <cmr> and it might be useful to have it specified.
[06:40:21] <huon> no, I agree that you can leave it of the lang ref
[06:40:26] <cmr> although that could be in a separate "rustc extensions"
[06:40:29] <cmr> document
[06:40:29] <huon> oh... yeah, that might be useful?
[06:40:33] <mcpherrin> Rust spec, section 6.2.1: The compiler must be helpful to a programmer with skill level as defined in S53.4.1a who makes errors listed in S6.2.2
[06:40:45] <huon> cmr: wouldn't that need to be feature gated then?
[06:40:50] <huon> if it's a rustc extension
[06:40:55] <cmr> GASP
[06:41:05] <huon> mcpherrin: people make errors in Rust?
[06:41:16] <huon> are you living in a fantasy world?
[06:41:23] <cmr> huon: that might make sense, but I reaaaally don't want to go there
[06:41:49] <huon> cmr: yeah, feature gating all lints is a nonstarter
[06:42:03] <edwardw> huon: they do. some of them tried to put grenade in stack!
[06:42:07] <cmr> lol
[06:42:13] <cmr> perhaps we should spec the lint propagation stuff.
[06:42:26] <cmr> and leave the rest of it a implementation-defined.
[06:43:14] <edwardw> but `deny` lint does change the behavior of the compiler, doesn't it?
[06:43:23] <cmr> it does.
[06:43:27] <cmr> it now rejects code that it used to allow.
[06:43:35] <edwardw> yep
[06:44:18] <cmr> I feel like it's OK for an implementation to reject certain valid code, conditionally.
[06:44:18] <huon> bleh, another BC hazard :(
[06:44:40] <huon> lints can't be promoted to a stricter level
[06:45:01] <cmr> huon: I'm willing to say "default lint levels are undefined"
[06:45:12] <huon> cmr: makes code not compile, thoguh
[06:45:14] <sfackler> defining what BC guarantees we'll give will be a fun time
[06:45:15] <cmr> #[warn(lint_name)] if you want it explicit.
[06:45:23] <cmr> huon: I am OK with that.
[06:45:27] <huon> I guess so
[06:45:42] <huon> what about adding a new lint?
[06:45:50] <huon> would that have to be warn-by-default?
[06:45:50] <cmr> unrecognized_lint is warn by default.
[06:46:12] <sfackler> for example, in the strictest possible interpretation, we could never add methods to anything since third party code *could have* defined a trait with the same method and impled it for that type
[06:46:29] <huon> since deny by default can make code not compile in a new way, that downstream cannot possibly avoid
[06:46:37] <cmr> yeah.
[06:46:53] <huon> (since e.g. a deny lint added in 1.1 doesn't even exist in 1.0, and so people can't #[allow] it)
[06:47:03] <sfackler> I don't think there's much of a point to deny-by-default lints anyways once the language is stable
[06:47:28] <cmr> why?
[06:47:31] <huon> unnecessary_parens needs to be deny-by-default
[06:47:43] <huon> just to annoy all those C/C++ programmers :P
[06:47:46] <sfackler> har har
[06:47:53] <cmr> stuff like "Unused type parameter" should definitely be IMO
[06:48:14] <huon> we should reform how/when we run lints too
[06:48:17] <cmr> yeah.
[06:48:18] <huon> to make the maximally useful
[06:48:24] <cmr> the lint infrastructure needs some love
[06:48:26] * huon wishes he had more rust time :(
[06:48:29] <edwardw> "Unused type parameter" is already a thing?
[06:48:34] * cmr also wishes huon had more rust time
[06:48:34] <huon> edwardw: nope
[06:48:36] <cmr> edwardw: no
[06:48:36] <strcat> huon: 1) put clock in water
[06:48:38] <cmr> just an example
[06:48:45] <sfackler> cmr: I kind of feel that a check like "unused type parameter" shouldn't be a lint
[06:48:51] <sfackler> but a separate check
[06:49:00] <huon> strcat: I only have aluminium watches :(
[06:49:13] <strcat> huon: close enough
[06:49:18] <edwardw> I added it the other day, but the first thing it rejected was markers themselves :P
[06:49:31] <cmr> sfackler: yeah, for this lint I'd prefer if it were an actually typeck thing
[06:49:46] <cmr> edwardw: yeah, it should not do that for the markers. it knows what the markers are since they are lang items
[06:50:25] <strcat> woo, it decided to start building rust
[06:50:57] <cmr> So both #[main] and #[start] signal entry points.
[06:51:05] <cmr> What qualifier should I use to disambiguate them?
[06:51:21] <huon> cmr: spelling?
[06:51:32] <huon> the length of the word?
[06:51:36] <cmr> "entrie point" and "entry point"
[06:51:54] <strcat> cmr: #[main] isn't an entry point
[06:52:00] <strcat> cmr: ;)
[06:52:00] <sfackler> plumbing and porcelain :P
[06:52:05] <cmr>  - `main` - indicates that this function should be used as the entry point,
[06:52:06] <cmr>    instead of the function in the crate root named `main`
[06:52:08] <cmr>  - `start` - indicates that this function should be used as the ????
[06:52:19] <strcat> cmr: #[start] -> define the entry point, #[main] -> define the main function called by the default entry point
[06:52:29] <cmr> strcat: works for me, much cleaner.
[06:52:29] <strcat> or w/e
[06:53:37] <strcat> ugh
[06:53:41] <strcat> need to teach playpen about bind mounts
[06:54:05] <sfackler> cmr: add in the expected signatures of the main and start functions while you're there
[06:54:10] <strcat> clearly my irc client needs to run in a sandbox
[06:54:12] <sfackler> since iirc we still don't type check them
[06:54:24] <cmr> sfackler: I'm doing that in the lang="start" documentation
[06:54:26] *** Quits: brson (brson@moz-62518563.mtv2.mozilla.com) (Ping timeout)
[06:54:36] <cmr> of which there is none.
[06:54:47] <cmr> I am going to go on a fractal rampage of updating the manual at this rate.
[06:55:26] * huon quickly finds an attack vector in strcat's irc client before that path is closed
[06:55:40] <huon> cmr: sounds good ;P
[06:55:45] * huon expects it by tomorrow
[06:55:59] <huon> speaking of tomorrow...
[06:56:23] * huon disappears to do some work for the classes he teaches
[06:56:36] <huon> (how did this happen? people listening to what I say :S )
[06:57:14] <cmr> sfackler: while I'm at it, mind documenting loadable syntax extensions?
[06:57:46] <sfackler> uuuuuuuuuuuugh documentation
[06:57:54] <cmr> ;P
[06:58:02] <cmr> it's soothing once you get into the groove
[06:58:30] <huon> sfackler: you submitted a patch for exportable macro_rules, right? :P
[06:58:47] *** Joins: brson (brson@6A848D32.C1B840DD.76F66111.IP)
[06:58:47] *** ChanServ sets mode: +qo brson brson
[07:21:33] <cmr> Should #[thread_local] and #[significant_address] be in the language reference?
[07:21:55] <cmr> I feel like the latter is purely an optimization.
[07:22:06] <huon> when they are unfeature-gated
[07:22:10] <huon> it's not just an optimisation
[07:22:19] <huon> #[insignificant_address] would be
[07:22:22] <eddyb> xcrate instantiation
[07:22:30] <cmr> ah yes
[07:22:34] <cmr> an un-optimization
[07:22:43] <cmr> derp
[07:22:47] <cmr> it's #[address_insignificant]
[07:23:11] * cmr learns how to memory
[07:24:11] <cmr> eddyb: this is the language reference, implementation details do not matter, only semantics.
[07:24:42] <eddyb> xcrate instantiation is a pretty important semantic
[07:24:48] <cmr> no it isn't.
[07:24:50] <cmr> it's unobservable.
[07:25:03] <huon> is it?
[07:25:07] <cmr> isn't it?
[07:25:09] <huon> does & do the right thing?
[07:25:17] <eddyb> I wish I had something better than "take the address of something" which gets back to the attribute name
[07:25:19] <cmr> is the value of & specified?
[07:25:24] <eddyb> cmr: hence, semantics
[07:25:30] <cmr> (answer: no)
[07:25:42] <eddyb> pls don't make & UB
[07:25:47] <cmr> it can't ever be mutated, and we don't use referential equality...
[07:26:40] <eddyb> Rust is a systems language. someone might want to know where and when they can use reference equality. for various reasons
[07:26:48] <cmr> eddyb: uh, xcrate instantiation can't matter for #[address_insignificant] because they can't be reachable.
[07:26:50] * eddyb shrugs
[07:27:16] <cmr> So the value of &YOUR_STATIC will always be the same.
[07:27:19] <huon> local data uses address
[07:27:36] <cmr> ... it just might also be the same as something else.
[07:27:57] <cmr> Do we want aliasing guarantees about pointers-to-statics?
[07:28:01] <cmr> Can we even do that?
[07:28:24] <cmr> huon: it also definitely does *not* use address_insignificant
[07:28:27] <huon> does immutable ones don't matter, do they?
[07:28:33] <huon> cmr: yes, that's true :P
[07:28:35] <eddyb> https://github.com/mozilla/rust/issues/13202
[07:28:39] <eddyb> haha &mut !
[07:28:59] <eddyb> cmr: I didn't change that part of the code
[07:29:22] <cmr> eddyb: autoderef is in the stack trace, it's your bug :p
[07:29:24] <huon> cmr: did you see https://github.com/mozilla/rust/pull/8678 btw?
[07:29:36] <eddyb> cmr: go back three months and check it, I dare you
[07:30:09] <eddyb> cmr: nobody hit this because nobody put ! in a method call argument
[07:30:14] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Connection reset by peer)
[07:30:36] <eddyb> cmr: though, wtf is RefMut doing in there? I'm confused
[07:30:38] <cmr> eddyb: I believe it, but it's vaguely related to something you've touched, so it's yours anyway
[07:30:39] <huon> eddyb: the only sane way to do that would be to have months and months of pre-built rust binaries... noone has that :P
[07:30:43] <cmr> eddyb: yes it's very confusing.
[07:30:46] * cmr coughs
[07:31:01] <cmr> huon: eddyb: the bencher is currently running btw
[07:31:06] <cmr> been uploading data for the past few hours
[07:31:17] <eddyb> let's try something
[07:31:43] <eddyb> rusti: (fail!("foo")).to_str()
[07:31:50] -rusti- pastebinned 9 lines of output: http://ix.io/bkY
[07:32:07] <cmr> So, #[address_insignificant], part of the language or part of the implementation?
[07:32:24] <huon> cmr: btw, I've discussed similar things to https://github.com/mozilla/rust/issues/13194 with nmatsakis
[07:32:25] <eddyb> hahaha, I see what's going on, cmr
[07:32:26] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[07:32:39] <eddyb> *may* be might fault, I still doubt it
[07:32:56] <huon> he has some ideas other than an attribute, so I would encourage you to wait
[07:33:11] <eddyb> cmr: the old deref loop was worse IMO
[07:33:12] * cmr waits 2 months for nmatsakis
[07:33:14] <huon> (iirc, a type like `NotNull<T> = *mut T`)
[07:33:26] <cmr> I was hoping to not add a language item.
[07:33:33] <cmr> (thus the attribute)
[07:34:03] <eddyb> I want NotNull for Rc
[07:34:11] <cmr> eddyb: yes, read the issue :p
[07:34:38] <huon> yes, the attribute is the other obvious choice
[07:34:46] <eddyb> cmr: it's bad when you do it to Span and it goes from two words to three
[07:34:51] <huon> but there are some advantages to having a proper type for it
[07:34:53] <eddyb> rusti: (fail!("foo")).eq(&0)
[07:34:56] <cmr> Such as?
[07:34:56] -rusti- pastebinned 9 lines of output: http://ix.io/bkZ
[07:35:01] <huon> (i can't remember the details, it was a while ago)
[07:35:03] <cmr> ok
[07:35:11] <eddyb> cmr: encapsulation
[07:35:27] <cmr> I reject encapsulation when it offers no other benefits.
[07:35:31] <eddyb> you should be able to construct it from &mut T, but not any *mut T
[07:35:35] <cmr> because it is not a panacea in itself.
[07:35:42] <cmr> I explicitly cannot be using &mut T here
[07:35:44] <strcat> brson: package built fine :)
[07:36:03] <eddyb> cmr: or *mut T -> Option<NotNull<T>>
[07:36:19] <strcat> rusti: 2
[07:36:20] -rusti- <anon>:1:1: 1:59 warning: this inner attribute syntax is deprecated. The new syntax is `#![foo]`, with a bang and no semicolon.
[07:36:21] -rusti- <anon>:1 #[feature(globs, macro_rules, struct_variant, simd, asm)];
[07:36:21] -rusti-          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[07:36:21] -rusti- 2
[07:36:49] <strcat> rusti: 2
[07:36:50] -rusti- 2
[07:37:00] <cmr> eddyb: there's also the sadness of not being able to dereference NotNull<T>
[07:37:25] <cmr> Unless we want an UnsafeDeref
[07:37:34] <eddyb> cmr: hmmm
[07:37:51] <strcat> yeah but anyway
[07:37:52] <eddyb> unsafe impl<T> Deref<T> for NotNull<T>
[07:37:57] <cmr> nope
[07:38:04] <cmr> now we need to qualify other types with `unsafe`.
[07:38:08] <eddyb> mhmm
[07:38:12] <cmr> if they can accept unsafe impls.
[07:38:13] <strcat> rusti: std::mem::size_of::<Option<~(int, int)>()
[07:38:13] -rusti- <anon>:11:48: 11:49 error: expected `,` but found `(`
[07:38:13] -rusti- <anon>:11         std::mem::size_of::<Option<~(int, int)>()
[07:38:13] -rusti-                                                          ^
[07:38:13] -rusti- playpen: application terminated with error code 101
[07:38:23] <strcat> rusti: std::mem::size_of::<Option<~(int, int)>>()
[07:38:24] -rusti- 8
[07:38:38] <cmr> that's 3x complexity, with DST
[07:38:39] <strcat> rusti: struct Foo(~(int, int); std::mem::size_of::<Option<Foo>>()
[07:38:42] -rusti- pastebinned 7 lines of output: http://ix.io/bl0
[07:38:46] <cmr> `unsized unsafe T: B`
[07:38:49] <strcat> rusti: struct Foo(~(int, int)); std::mem::size_of::<Option<Foo>>()
[07:38:49] -rusti- 16
[07:38:52] <eddyb> rusti: std::mem::size_of::<Option<(~int, int)>>()
[07:38:53] -rusti- 24
[07:39:02] <eddyb> aww I thought that would be optimized
[07:39:03] <cmr> `unsized T: unsafe B` rather
[07:39:12] <strcat> eddyb: no it doesn't even do a newtype
[07:39:21] <eddyb> meh
[07:39:49] <eddyb> I can solve the Span blowup
[07:40:04] <eddyb> by replacing Vec with OwnedSlice
[07:42:05] <eddyb> cmr: I can't tell what's going on with autoderef :|
[07:42:18] <eddyb> cmr: can you confirm it was broken before it?
[07:42:35] <cmr> sure.
[07:42:36] <eddyb> s/it/fail!("foo").to_str()/ s/it/autoderef/
[07:44:14] <cmr> [3:43:24]/tmp> /mnt/rustb/987de2986539fe01e86aa711b43f05e94becba89/stage2/bin/rustc foo.rs
[07:44:15] <cmr> foo.rs:1:13: 1:36 error: cannot determine a type for this bounded type parameter: unconstrained type
[07:44:17] <cmr> foo.rs:1 fn main() { (fail!("foo")).to_str(); }
[07:44:19] <cmr>                      ^~~~~~~~~~~~~~~~~~~~~~~
[07:44:27] <cmr> broken, but in an acceptable way.
[07:45:28] <eddyb> *sigh* you were right, autoderef is too eager
[07:45:55] <eddyb> (I thought you were actually referring to my first changes in the area, in which I didn't touch the subtyping stuff in method lookup)
[07:46:28] <eddyb> not sure how to fix it, ! is more or less a hack across typeck
[07:47:09] <cmr> When autoderef is applied to !, don't try to deref it?
[07:47:38] <eddyb> hmm
[07:47:45] <cmr> (or, rather, don't consider it a candidate for autoderef)
[07:47:55] <eddyb> right, that would do it, thanks
[07:49:46] *** Quits: mawuli (mawuli@F7A4F2ED.68EE7C48.E520B65A.IP) (Ping timeout)
[07:52:53] *** Joins: mawuli (mawuli@F7A4F2ED.68EE7C48.E520B65A.IP)
[07:59:10] *** Joins: doener (doener@moz-C68F600D.unity-media.net)
[08:06:22] *** Quits: brson (brson@6A848D32.C1B840DD.76F66111.IP) (Ping timeout)
[08:07:59] *** Quits: gwty (gwtypc@D17752E3.C4444A44.137C914F.IP) (Ping timeout)
[08:09:46] *** Quits: edwardw (Mibbit@4660DACB.EE06708D.4BFBD933.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[08:10:43] *** Joins: brson (brson@moz-62518563.mtv2.mozilla.com)
[08:10:43] *** ChanServ sets mode: +qo brson brson
[08:23:17] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:23:27] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:23:37] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:26:19] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:30:34] *** Quits: brson (brson@moz-62518563.mtv2.mozilla.com) (Ping timeout)
[08:32:23] *** Quits: esummers (esummers@moz-3B015C90.wi.res.rr.com) (Connection reset by peer)
[08:32:40] *** Joins: esummers (esummers@moz-3B015C90.wi.res.rr.com)
[08:36:21] *** flaper87|afk is now known as flaper87
[08:37:01] <flaper87> o/
[08:37:09] *** Quits: esummers (esummers@moz-3B015C90.wi.res.rr.com) (Connection reset by peer)
[08:37:24] *** Joins: esummers (esummers@moz-3B015C90.wi.res.rr.com)
[08:39:24] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:39:29] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:43:38] <doener> \o
[08:49:30] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[08:54:40] <flaper87> doener: o/
[08:55:13] * cmr waits for the waving iloop
[08:55:41] <flaper87> lol
[08:55:47] <cmr> doener: btw, for tbaa.struct on enums, I'm thinking about emitting each variant's data separately from the padding, to make it easier to read and understand
[08:56:01] <cmr> doener: do you think this a bad idea, and just the tbaa.struct metadata should overlap into the fields?
[08:56:13] <cmr> doener: also, I learned that it applies to *memcpy calls*, not the types themselves!
[08:56:17] <cmr> which makes sense.
[08:56:53] <doener> cmr: yeah, the fact that it applies to memcpys is what makes me fail to see how to properly use it
[08:57:41] <cmr> what part do you not see?
[08:58:10] <doener> consider this: enum E { A(i64), B(&int) } fn foo(e: E) { ... } and then somewhere a call to it: foo(e)
[08:58:40] <doener> because E isn't immediate, you'll have to memcpy "e" for the call. But it's unknown whether e is A or B
[08:59:51] <cmr> so that is type { i8, [7 x i8], [1 x i64] }
[08:59:58] <cmr> the [7 x i8] is the padding, right?
[09:00:17] <cmr> so the 7 bytes starting at offset 1 would be excluded
[09:00:29] <eddyb> i1, even ;)
[09:00:31] *** Quits: Luqman (laden@moz-AB7945E9.csclub.uwaterloo.ca) (Ping timeout)
[09:00:33] <doener> in that case, both structs use the same memory regions, so you just can't express aliasing well (you'll need a "may alias")
[09:00:59] <cmr> that is, metadata !{ i64 0, i64 1, !0, i64, 8, i64 8, !0 }
[09:01:55] <cmr> doener: isn't tbaa.struct just specifying which "fields" content actually matters for the copy?
[09:02:30] <doener> cmr: the !0 in your example is a tbaa tag
[09:02:52] <cmr> yes, !0 here being "rustc tbaa"
[09:02:57] <cmr> for may alias
[09:03:04] <cmr> (the root of the type tree)
[09:03:16] <cmr> I thought tbaa.struct was just about not copying padding
[09:03:24] <cmr> at least that's the only contexts I think I've seen it in
[09:03:30] <cmr> where sroa does bad things with all the padding
[09:03:46] *** Joins: Luqman (laden@moz-AB7945E9.csclub.uwaterloo.ca)
[09:03:46] <cmr> I admit to not actually know what it does, only faint gleamings from the langref and rust issues
[09:03:49] <doener> cmr: but I guess I answered the question myself, we just have to "may alias" everything in enums, and use the disjunction of all used memory regions
[09:03:59] <cmr> yeah, that's what I planned on.
[09:04:44] <cmr> Is the alias information of the fields actually used?
[09:04:54] <cmr> Since the metadata is only on the memcpy call I figured it wouldn't actually matter.
[09:04:58] <cmr> I might have to read the source.
[09:05:05] <doener> eddyb: regarding i1, the hack I did had a bug. The "padding" must be i8
[09:05:30] <doener> cmr: I suppose sroa would transfer the tag to the splitted loads
[09:14:16] *** Joins: NiccosSystem (NiccosSyst@moz-ED196BB4.customer.lyse.net)
[09:16:19] *** Joins: gwty (gwtypc@D17752E3.C4444A44.137C914F.IP)
[09:18:39] *** Quits: mawuli (mawuli@F7A4F2ED.68EE7C48.E520B65A.IP) (Ping timeout)
[09:19:00] *** Joins: mawuli (mawuli@F7A4F2ED.68EE7C48.E520B65A.IP)
[09:30:56] *** Nekit1234007_ is now known as nekit1234007
[09:33:56] <doener> cmr: hm, AFAICT currently only TBAA makes use of tbaa.struct, memcpy doesn't use it yet
[09:35:58] <cmr> doener: it won't elide copied of padding etc? what does tbaa actually *do* with it?
[09:36:39] <doener> alias analysis, i.e. what the names implies ;-)
[09:40:40] *** Quits: eddyb (eddy@F8B50789.F33C1089.FB866788.IP) (Ping timeout)
[09:42:42] *** Joins: eddyb (eddy@F8B50789.F33C1089.FB866788.IP)
[09:42:51] *** Joins: NiccosSystem` (NiccosSyst@moz-ED196BB4.customer.lyse.net)
[09:42:58] *** Quits: NiccosSystem (NiccosSyst@moz-ED196BB4.customer.lyse.net) (Ping timeout)
[09:50:06] <cmr> http://i.imgur.com/qkpCJYV.png
[09:50:13] <cmr> (http://brson.github.io/rust-www/ in servo)
[09:50:21] <cmr> it *almost* works.
[09:51:13] <cmr> for contrast, rust-lang.org: http://i.imgur.com/ysw3WJ3.png
[09:52:04] <huon> zalgo!
[09:52:14] <huon> that's pretty cool
[09:52:23] <cmr> (This is pcwalton's acid2-2 branch)
[09:52:31] <cmr> it still segfaults when you click links sometimes
[09:52:32] <cmr> but whatever
[09:53:01] <huon> hah, so much for memory safety
[09:53:17] <cmr> actually it's not a segfault, sorry.
[09:53:19] <cmr> just an abort.
[09:53:32] <cmr> task '<unnamed>' failed at 'RefCell<T> already borrowed', /home/cmr/src/servo/src/compiler/rust/src/libstd/cell.rs:154
[09:53:37] <huon> ah
[09:53:49] <cmr> it then proceeds to double-fail, leak tons of X pixmaps, and explode.
[09:54:03] <huon> hahaha
[09:54:16] <huon> close enough
[09:58:49] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Connection reset by peer)
[10:00:29] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[10:00:53] <eddyb> huon: hmm, why am I using moands for P?
[10:00:56] <eddyb> *monads
[10:01:03] <eddyb> I have "map" and "and_then"
[10:01:05] <huon> eddyb: because you're sane
[10:01:19] <huon> map is just functor
[10:01:23] <huon> btw
[10:01:27] <huon> ;P
[10:01:29] <eddyb> .map(f) being .and_then(|x| P(f(x)))
[10:01:38] <eddyb> huon: well, I meant Functors and Monads
[10:02:36] <eddyb> map f = >>= (return f)
[10:02:43] <eddyb> huon: I... I think I just wrote Haskell
[10:03:00] <huon> nearly
[10:03:16] <huon> map f = (>>= (return f))
[10:03:43] <huon> (well, it's called `fmap` in  haskell, but you're correct)
[10:04:02] <huon> wait... should be `return . f` too
[10:04:03] <eddyb> if only we didn't have the infix problem...
[10:04:12] <cmr> and also lack of currying
[10:04:15] <eddyb> huon: oh yeah
[10:04:28] <eddyb> cmr: meh, currying
[10:04:35] <cmr> "meh"
[10:04:36] * cmr loves it
[10:04:36] <eddyb> Rust with currying is too much like Haskell
[10:04:42] <cmr> That's like
[10:04:43] <cmr> a good thing
[10:04:48] <cmr> I don't mean rust should have it
[10:06:03] <eddyb> I bet some people will look at and_then just like they look at grow_fn
[10:06:18] <cmr> I see grow_fn as redundant, not strange :p
[10:06:24] <strcat> cmr: when we have unboxed closures
[10:06:28] <cmr> yeah
[10:06:36] <strcat> foo(_, x, _)
[10:06:56] <eddyb> as a shorthand for the equivalent lambda?
[10:06:59] <strcat> as sugar for |a, b| foo(a, x, b)
[10:07:00] <strcat> eddyb: yes
[10:07:06] <eddyb> now *that* I wouldn't mind
[10:07:18] <strcat> need unboxed closures first
[10:08:07] <eddyb> >>= Some(_)
[10:08:27] <eddyb> hmm
[10:08:42] <eddyb> rusti: let x = 5; x >>= 1; x
[10:08:45] -rusti- pastebinned 8 lines of output: http://ix.io/blg
[10:08:52] <eddyb> rusti: let mut x = 5; x >>= 1; x
[10:08:52] -rusti- 2
[10:09:34] <eddyb> strcat: if I had more hope for VG, I'd write that RFC
[10:10:35] <cmr> I don't see why VG would be rejected.
[10:10:42] <cmr> We're going to need them for unboxed closures?
[10:11:19] <eddyb> I may have overestimated certain sentiments
[10:11:38] *** Joins: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP)
[10:11:38] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/x-qiwg
[10:11:38] <ghrust> 13rust/06auto 142166f5f 15Guillaume Pinot: make shootout-k-nucleotide.rs pass official test...
[10:11:38] <ghrust> 13rust/06auto 1448ca4df 15bors: auto merge of #13206 : TeXitoi/rust/fix-shootout-k-nucleotide, r=cmr...
[10:11:39] *** Parts: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP) ()
[10:20:02] <eddyb> cmr: aaaah I see a new pattern
[10:20:15] <eddyb> cmr: the growth here is valid, I think http://huonw.github.io/isrustfastyet/mem/#b8601a3
[10:20:39] <eddyb> cmr: caused by pre-cfg AST duplication when moving things around
[10:20:58] <eddyb> cmr: and it goes down with the snapshot http://huonw.github.io/isrustfastyet/mem/#df9cf18
[10:21:08] <cmr> yeah.
[10:21:21] <cmr> it'd be nice to have things besides librustc to use as the memory benchmark
[10:21:25] <cmr> that don't actually change much
[10:22:08] <eddyb> http://huonw.github.io/isrustfastyet/mem/#87e72c3 hmpf
[10:22:35] <eddyb> the peak caused by my @ removal seems to be temporary
[10:23:22] <huon> wasn't that the problem fixed by https://github.com/mozilla/rust/pull/12993
[10:23:45] <eddyb> aaah, right
[10:34:02] *** lpy_ is now known as lpy
[10:44:00] *** Quits: Kxepal (Miranda@moz-6DDBE711.pppoe.mtu-net.ru) (Quit: Kxepal)
[10:44:20] *** Joins: Kxepal (Miranda@moz-6DDBE711.pppoe.mtu-net.ru)
[10:51:26] *** Quits: huon (Thunderbir@moz-7CC720CF.lns20.syd7.internode.on.net) (Quit: huon)
[10:52:07] *** Joins: huon (Thunderbir@moz-7CC720CF.lns20.syd7.internode.on.net)
[10:52:07] *** ChanServ sets mode: +o huon
[10:56:13] <cmr> eddyb: also, https://etherpad.mozilla.org/O7HIOOo25R
[10:56:20] *** Joins: newbie (kvirc@moz-E7BC7E0A.dip0.t-ipconnect.de)
[10:56:55] *** Quits: eibwen (kvirc@moz-7F361249.dip0.t-ipconnect.de) (Ping timeout)
[10:57:35] <eddyb> cmr: wooo
[10:59:25] *** aatch is now known as aatch|home
[11:02:36] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[11:05:08] *** Quits: gwty (gwtypc@D17752E3.C4444A44.137C914F.IP) (Ping timeout)
[11:05:47] <eddyb> cmr: wishlists would be nice
[11:06:01] <cmr> whose wishlists?
[11:06:06] <eddyb> everyone's
[11:06:20] <cmr> make an etherpad :)
[11:06:49] <eddyb> like, I would like the @ in Span to be replaced with Rc and then Vec -> OwnedSlice across the AST to counteract the memory bloat
[11:07:06] <eddyb> but I may not get to that today
[11:07:41] <kimundi> Just add a "up for grabs" section tot hat etherpad I'd say.
[11:08:35] <eddyb> cmr: thanks :D
[11:08:47] <cmr> although isn't that just the issue list on github
[11:08:48] <cmr> ?
[11:09:12] <eddyb> well...
[11:09:16] <kimundi> Well, I'd see this as more small scale.
[11:09:21] <cmr> yes, this is true.
[11:09:34] <eddyb> we end up at "github sucks" if we start debating this
[11:09:38] <cmr> :P
[11:10:52] <kimundi> "rewrite trans" - this is not what I meant! ;)
[11:10:55] <cmr> :P
[11:10:59] <cmr> I just needed a first item
[11:11:09] <cmr> I was channeling my inner bstrie
[11:11:27] <kimundi> (No need to remove it, I don't really care ;))
[11:12:16] * kimundi is happy map and flat_map finally died.
[11:12:42] <eddyb> kimundi: now I have to update a million lines
[11:12:49] <kimundi> hehe
[11:12:54] <cmr> eddyb: oh, also
[11:12:59] <eddyb> kimundi: thankfully I hope I'll just be able to ignore your changes in fold.rs
[11:13:01] <cmr> eddyb: please
[11:13:04] <cmr> please *please*
[11:13:09] <cmr> start using multiple commits.
[11:13:12] <cmr> commit -p is your friend
[11:13:13] <eddyb> haha
[11:13:23] <eddyb> cmr: have you seen recent PRs?
[11:13:35] <cmr> all I really want is the commit that, for example, removes the @ from a t ype
[11:13:40] <eddyb> the de-@ was done one structure at a time
[11:13:46] <cmr> separate from fixing the fallout from that.
[11:13:50] <eddyb> oh?
[11:14:03] <cmr> yes, each struct is a good step forward!
[11:14:39] <eddyb> I want to do something similar with P, but not as detailed
[11:15:07] <eddyb> adding syntax::ptr::P and replacing @ with P would be separate commits. and then the fallout
[11:15:45] <cmr> Send is described as "Types able to be transferred across task boundaries.
[11:15:52] <cmr> what the hell does that actually mean
[11:16:14] <eddyb> deep ownership
[11:16:15] <kimundi> Hm, nice. removing append/append_one get up to libsyntax until it starts to complain.
[11:16:29] <eddyb> cmr: Share + deep ownership, I guess
[11:16:38] <eddyb> cmr: Share should handle the thread safety stuff
[11:16:44] <kimundi> Not neccessary Share, I think?
[11:16:47] <eddyb> or maybe Isolate + deep ownership
[11:17:15] <eddyb> kimundi: you won't make this easy for me, will ya :P?
[11:17:27] <kimundi> Just because you can safely send a T, it doesn'T mean that &T is threadsafe to access I think.
[11:17:33] <cmr> definitely not.
[11:18:12] <kimundi> deep ownership is all its about I think.
[11:18:27] <eddyb> kimundi: has to be thread-safe though
[11:18:45] <eddyb> you can own things that you can't use outside of the thread they were created in
[11:18:56] <eddyb> like a task-local heap
[11:19:34] *** Joins: bvssvni (Mibbit@moz-A47B6F8E.bb.online.no)
[11:19:35] <kimundi> Thats stuff that lies outside the trait system in a way.
[11:20:03] <cmr> not particularly, I don't think
[11:20:05] <kimundi> I guess this would technical mean its allocator needs to be Share
[11:20:09] <kimundi> ?
[11:20:19] <cmr> that puts us back firmly into "Can be sent across task boundaries"
[11:20:21] <eddyb> kimundi: Rc isn't Send, Arc is Send
[11:20:33] * kimundi should maybe read the backlog to know what this discussion is actually about
[11:20:51] <cmr> kimundi: definition of Send
[11:21:00] <cmr> (for the manual)
[11:22:13] <kimundi> "Threadsafe to transfer ownership across task boundaries"?
[11:23:11] <cmr> could "Copy" be "Able to be deeply cloned using a memcpy"?
[11:23:22] <cmr> kimundi: I'm just going to go with "Able to be sent across task boundaries"
[11:23:29] <cmr> simpler, I think it covers the "threadsafe" part
[11:23:35] <cmr> also thread safety isn't enough
[11:23:44] <cmr> eg libgreen tasks migrate between threads.
[11:23:48] <cmr> requiring a stronger guarantee
[11:24:17] <eddyb> cmr: migration => Send ;)
[11:26:14] <cmr> http://static.rust-lang.org/doc/master/src/std/home/rustbuild/src/rust-buildbot/slave/doc/build/src/libstd/intrinsics.rs.html#73
[11:26:16] <cmr> why does this exist
[11:26:19] <cmr> why is this a lang item
[11:26:34] <cmr> lang items are an eternal part of the langauge
[11:26:36] <cmr> *language
[11:28:36] <cmr> dear god how long has this existed.
[11:28:41] <cmr> I'm going to murderize this
[11:28:59] <eddyb> cmr: haha
[11:29:12] <eddyb> cmr: good freaking luck
[11:29:21] <eddyb> cmr: it's used in TyVisitor
[11:29:37] <cmr> I don't even care
[11:29:40] <eddyb> ah, only get_disr which is a hack
[11:29:41] <cmr> I'll just remove type safety.
[11:29:56] <huon> cmr: "A type is Send if a value is threadsafe when passed between threads by-value"
[11:29:59] <eddyb> can pass *u8 just as well
[11:30:43] <cmr> huon: the language reference doesn't have a concept of threads yet.
[11:31:21] <huon> cmr: well... how on earth will any definition of Send make sense?
[11:31:33] <huon> (without a concept of thread-safety, that is.)
[11:31:34] <flaper87> ... and Share 
[11:31:41] <flaper87> o/
[11:31:57] <eddyb> just call kinds axioms
[11:33:10] <huon> cmr: &A is copy, but a Copy copy is not deep
[11:34:07] <cmr> good point
[11:34:31] <huon> "types that do not move ownership when used by-value"
[11:35:33] <kimundi> "Types the implicitly fork ownership"? :P
[11:36:06] <bvssvni> types that causes no dangling pointers when copied
[11:36:27] <eddyb> /s
[11:38:19] <kimundi> "Types that... ah fuck it you'll learn on your own."
[11:38:34] <cmr> lol
[11:38:41] <flaper87> loool
[11:38:45] <bvssvni> haha
[11:38:45] <eddyb> kimundi: worked well until 1.0
[11:38:54] <cmr> "Share: you're smart, you'll figure it out"
[11:38:55] <kimundi> indeed ;D
[11:39:00] <eddyb> cmr: Smaht
[11:39:10] *** Quits: nekit1234007 (Nekit12340@1A3BF3D7.477D93D.4707F662.IP) (Ping timeout)
[11:40:14] <kimundi> But seriously, I think the manual needs some kind of concept of threadsafety in order for these buildin traits to make any sense.
[11:40:23] <cmr> yes.
[11:40:25] <cmr> it will.
[11:40:49] <bvssvni> doesn't have to correct in a computer scientific way, just understandable
[11:41:06] <huon> just take C++11's data race definition
[11:41:06] * eddyb squints at bvssvni
[11:41:16] * bvssvni squints back
[11:41:18] <cmr> I think I'm going to be spending a lot of time with the manul in the near future.
[11:41:23] <huon> and define threadsafe as "no possibility of data race outside unsafe code"
[11:41:30] <cmr> lol
[11:41:39] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[11:41:39] <ghrust> [13rust] 15bors 04force-pushed 06auto from 1448ca4df to 14d79fbba: 02http://git.io/N3iJvQ
[11:41:39] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[11:41:41] <huon> ... that wasn't a joke
[11:41:41] *** Joins: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP)
[11:41:41] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/gaCllA
[11:41:41] <ghrust> 13rust/06auto 14a0c366b 15Guillaume Pinot: make shootout-k-nucleotide.rs pass official test...
[11:41:41] <ghrust> 13rust/06auto 148dca3ae 15bors: auto merge of #13206 : TeXitoi/rust/fix-shootout-k-nucleotide, r=cmr...
[11:41:41] *** Parts: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP) ()
[11:42:03] <cmr> "data race is defined as destroying the universe in a non-reversible, observable manner. rustc statically prevents this from ever occuring"
[11:42:08] <kimundi> "Safe to access in parallel running code"
[11:42:25] <cmr> "All possible interleaving of concurrent access lead to correct, consistent results"
[11:43:04] <kimundi> Sounds nicely complicated, I'll buy it!
[11:43:07] <bvssvni> what about determinism
[11:43:08] <huon> "C++11 [...] defined a data race strictly as a race condition between non-atomic variables"
[11:43:52] <huon> cmr: doesn't that mean that mutexes are not threadsafe?
[11:44:13] <cmr> huon: why does it?
[11:44:16] <huon> e.g. one thread multiplies by 2, one thread adds 1
[11:44:37] <cmr> fine
[11:44:38] <huon> the order in which they acquire the mutex dictates whether the result of starting with 2 is 5 or 6
[11:44:54] <cmr> "All possible interleaving of concurrent access appear as though they were executed sequentially"
[11:44:58] <huon> and rust doesn't (and can't) do anything to prevent that
[11:44:59] <huon> :/
[11:45:08] <huon> why not just take the well define definition from C++11
[11:45:08] <huon> ?
[11:45:11] <cmr> lol
[11:45:31] <huon> freedom from data races is precisely what rust guarantees
[11:45:33] <cmr> thread-safety is too nebulous to define precisely.
[11:45:45] <huon> define it as "no data races"
[11:45:46] <huon> solved.
[11:47:17] <kimundi> Outsourcing the problem. I like it.
[11:50:46] <eddyb> let other_fields: Vec<vec::MoveItems<(_, _, P<ast::Expr>)>> = raw_fields.collect();
[11:50:50] <eddyb> this isn't nice :(
[11:51:23] <eddyb> aaaand it wants a complete type. great
[11:51:49] <cmr> kimundi: fix _, or convince nmatsakis to fix _!
[11:52:06] <eddyb> let other_fields: Vec<vec::MoveItems<(Span, Option<Ident>, P<Expr>)>> = raw_fields.collect();
[11:52:10] <eddyb> so that works
[11:52:28] <eddyb> (but doesn't fit on one line)
[11:52:33] <kimundi> Well, afaik nmatsakis is already convinced to to trait method resolve changes that might fix this, and I lack the expertise for this, so... :P
[11:52:36] <eddyb> cmr: nmatsakis is already working on it ;)
[11:52:42] <cmr> \o/
[11:53:03] <eddyb> also fixing the deref_mut issue
[11:53:12] <eddyb> (allowing us to implement the Index traits sanely)
[11:53:36] <eddyb> 185 borrow errors :(
[11:57:59] *** Joins: nekit1234007 (Nekit12340@1A3BF3D7.477D93D.4707F662.IP)
[12:00:22] *** Joins: gwty (gwtypc@A283307D.72A15502.D66E6624.IP)
[12:08:10] *** Quits: darkf (darkf@moz-F9058B8A.net) (Ping timeout)
[12:08:29] *** Joins: darkf (darkf@moz-F9058B8A.net)
[12:23:19] *** newbie is now known as eibwen
[12:24:24] *** Quits: darkf (darkf@moz-F9058B8A.net) (Ping timeout)
[12:28:02] *** Joins: darkf (darkf@moz-F9058B8A.net)
[12:37:24] <cmr> r? https://github.com/mozilla/rust/pull/13207
[12:37:32] <cmr> bvssvni: ^ have your attribute list :)
[12:37:39] *** Quits: rcxdude (rcxdude@moz-C1B0669A.range109-145.btcentralplus.com) (Ping timeout)
[12:39:31] *** Joins: rcxdude (rcxdude@moz-600BFD57.range86-179.btcentralplus.com)
[12:40:01] <bvssvni> cmr: Thanks!
[12:41:34] *** Quits: darkf (darkf@moz-F9058B8A.net) (Ping timeout)
[12:42:39] <bvssvni> cmr: how will I get it when the pull is accepted?
[12:43:16] <cmr> bvssvni: it will be in the reference manual.
[12:43:29] <bvssvni> cmr: nice!
[12:43:34] <cmr> right here: http://static.rust-lang.org/doc/master/rust.html#attributes
[12:44:22] <bvssvni> oh they are made after C# attributes, didn't knew that
[12:48:46] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Connection reset by peer)
[12:50:20] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[12:50:55] *** Joins: canhtak (canhtak@moz-4FB0FBC1.wl.t.ulaval.ca)
[12:56:02] *** Quits: gwty (gwtypc@A283307D.72A15502.D66E6624.IP) (Ping timeout)
[13:07:07] *** Joins: cgaebel (clark@moz-F9D89110.nyc.res.rr.com)
[13:12:01] <doener> how did the old morestack stack growth work? Was is by a fixed amount or by the bare minimum needed for the call?
[13:13:26] <eddyb> why is Decl spanned within a spanned Stmt?
[13:13:27] <eddyb> *sigh*
[13:15:40] *** Joins: aurynj (Eon@583ABBE5.60FA2E28.B9E25744.IP)
[13:19:14] <cmr> http://llvm.org/pubs/2005-05-04-LattnerPHDThesis.pdf
[13:19:30] <cmr> there's a ton of good information in here
[13:19:37] <cmr> and you don't have to pay for a book!
[13:37:26] *** Joins: MinZ (minzh@8EBAD0D5.16D11093.8DE9D37C.IP)
[13:39:03] *** Quits: lpy (lpy@E44EE2C4.F09091A8.1348A864.IP) (Client exited)
[13:41:26] *** Joins: edwardw (edwardw@FE274C20.C036752E.F5B522C5.IP)
[13:52:20] <eddyb> like a hundred errors in ext::format X_X
[13:53:44] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[14:01:25] *** Quits: nekit1234007 (Nekit12340@1A3BF3D7.477D93D.4707F662.IP) (Ping timeout)
[14:09:38] <doener> wtf? I have an old an a new version of the fib benchmark. According to perf, 99,97% of the runtime is spent in the inner loop in both versions. And that loop is identical in both versions. Yet, the new version is faster, and the margin by which it is faster increases when I increase the fib number that is calculated
[14:14:17] <doener> hm, the old one generates more branch misses, but why?
[14:14:52] <cmr> the loop is identical as in the asm is the same?
[14:15:41] <cmr> there's really not a lot of room to optimize a fibonacci generator though...
[14:16:18] <doener> cmr: exactly the same asm
[14:18:43] <cmr> I'm curious to see what LLVM actually does with this tbaa information
[14:19:01] <cmr> I feel like a good portion of it is covered by noalias on function args.
[14:19:11] <cmr> well, no, that's not true
[14:19:18] <cmr> at all
[14:19:19] <cmr> nevermind
[14:19:21] <cmr> still curious
[14:20:21] *** Joins: nekit1234007 (Nekit12340@1A3BF3D7.477D93D.4707F662.IP)
[14:26:02] <doener> https://gist.github.com/dotdash/d2169dc44d7846a87960
[14:26:05] <doener> cmr: ^^
[14:28:43] *** Quits: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net) (Ping timeout)
[14:29:13] *** Joins: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net)
[14:29:17] * cmr sleeps
[14:35:00] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[14:36:25] *** Joins: gwty (gwtypc@A283307D.72A15502.D66E6624.IP)
[14:46:41] *** Quits: gwty (gwtypc@A283307D.72A15502.D66E6624.IP) (Connection reset by peer)
[14:54:45] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[14:55:44] <herrwolfe45> hi - I'm sorry to keep asking about debug information, but I'm not having any luck compiling rustc with it. I've set an env_var RUSTFLAGS="-g" and also tried passing same as `make check-stage1-rmake RUSTFLAGS="-g"`. My goal is to be able to run rustc under GDB. Thanks!
[14:58:41] *** Quits: nekit1234007 (Nekit12340@1A3BF3D7.477D93D.4707F662.IP) (Ping timeout)
[14:59:11] *** Quits: japaric_ (japaric@CFC3E8D5.E67A32BD.5C7588CA.IP) (Ping timeout)
[15:00:20] *** Joins: japaric_ (japaric@F25E6A94.64CFB2BA.F29ED47E.IP)
[15:02:40] *** Quits: MinZ (minzh@8EBAD0D5.16D11093.8DE9D37C.IP) (Input/output error)
[15:02:49] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[15:06:54] <doener> herrwolfe45: hm, "RUSTFLAGS=-g make" always worked for me
[15:07:07] <herrwolfe45> doener: ok, i must be doing something else incorrectly. 
[15:08:14] <herrwolfe45> thanks though
[15:08:16] <doener> herrwolfe45: maybe try with VERBOSE=1 to see the commands that are being run
[15:17:36] *** Joins: nekit1234007 (Nekit12340@1A3BF3D7.477D93D.4707F662.IP)
[15:22:47] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Quit: TheHydroImpulse)
[15:30:28] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[15:33:19] *** Quits: canhtak (canhtak@moz-4FB0FBC1.wl.t.ulaval.ca) (Quit: canhtak)
[15:35:26] <eddyb> doener: what's the asm?
[15:35:54] <eddyb> doener: in the IR, I see a load being eliminated in good
[15:36:10] <eddyb> (I guess that's the point of the TBAA metadata)
[15:36:49] <doener> eddyb: yeah, the two types (A and B) don't alias, so it can eliminate the second load because the store doesn't affect it
[15:37:00] <eddyb> doener: are you sure the asm is identical? if you can give me some binaries, I can look at them in radare2
[15:37:26] <doener> eddyb: the difference comes from installed rustc vs. rustc from stage2/bin
[15:37:38] <doener> eddyb: also, the gist is unrelated
[15:37:49] <eddyb> oh?
[15:38:00] <eddyb> doener: oops :D
[15:38:09] <doener> I have no idea _why_ that happens, but it does
[15:38:34] <eddyb> doener: keep in mind that disassemblers might throw out things like branch predictor hint prefixes
[15:38:40] <eddyb> doener: you have to look at the bytes
[15:40:35] <doener> eddyb: https://gist.github.com/dotdash/01aa1b7e48688ce8ae04
[15:41:21] <eddyb> doener: worse now?
[15:41:51] <eddyb> 50k new branches
[15:42:12] <eddyb> 200k new instructions
[15:42:25] <eddyb> doener: it sounds like the newer version is more complicated
[15:42:40] <eddyb> and/or the runtime is more expensive
[15:42:56] <doener> eddyb: but why? 
[15:43:05] <eddyb> doener: can you actually show binary/assembly?
[15:43:27] <eddyb> if you can easily install radare2, that would be amazing :D
[15:43:33] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[15:43:44] <eddyb> (you'd need to isolate the hot loop to an #[inline(never)] function)
[15:43:54] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[15:44:13] <doener> it's recursive with no TCO, so that should be fine ;-)
[15:44:30] <eddyb> oh, it's not a loop?
[15:44:45] <doener> recursive fibonacci
[15:44:54] <eddyb> doener: the IR is identical, yes?
[15:45:00] <doener> it's in src/test/bench/
[15:45:12] <doener> eddyb: it's the same compiler. Why should "make install" change the IR?
[15:45:25] <eddyb> wait, what?
[15:45:35] <eddyb> I thought it was stage0 vs stage2
[15:45:37] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[15:46:11] <doener> no, rustc is the installed one, stage2 is from the build dir
[15:46:26] <eddyb> doener: can you md5sum to confirm they're identical?
[15:46:34] <eddyb> hmm, maybe one of the libraries isn't
[15:46:52] <eddyb> doener: is this deterministic? or is it one of the "random link order" oddities?
[15:47:31] <eddyb> doener: things like this plague the "is rust slim yet" graph
[15:47:35] <doener> deterministic so far (10 build I guess)
[15:48:11] <eddyb> doener: can you bindiff the resulting binaries?
[15:48:46] <doener> I'm trying to figure out how I'm supposed to use radiff2
[15:48:48] <eddyb> (again, radare2 would help :P. radiff2 and then find what symbol they belong to with rabin2)
[15:48:48] *** Joins: canhtak (canhtak@moz-4FB0FBC1.wl.t.ulaval.ca)
[15:48:53] <eddyb> doener: haha
[15:49:32] <eddyb> oh, it's weird
[15:50:08] <eddyb> doener: start_old bytes_old => bytes_new start_new
[15:51:30] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[15:51:53] <doener> eddyb: tons of output
[15:52:21] *** Quits: eddyb (eddy@F8B50789.F33C1089.FB866788.IP) (Ping timeout)
[16:00:13] *** Joins: eddyb (eddy@F8B50789.F33C1089.FB866788.IP)
[16:00:46] <doener> eddyb: tons of output from radiff2
[16:01:13] <eddyb> doener: note to self: never supply the -s parameter to radiff2
[16:01:26] <eddyb> no idea what it does, but it hung my laptop
[16:01:32] <doener> heh
[16:02:10] <eddyb> aaand I don't have a working set for the P change. lovely
[16:02:59] <eddyb> doener: maybe you should just diff --emit=asm
[16:04:02] <doener> eddyb: identical except for symbol names
[16:04:10] <eddyb> same length?
[16:04:16] <doener> yep
[16:04:29] <eddyb> doener: think dynamic link paths moving code out of its optimal cache placement
[16:04:34] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[16:04:51] <eddyb> what's the size difference between the two binary files?
[16:04:55] <eddyb> and what does ldd output?
[16:05:39] <doener> 157 bytes
[16:05:58] <doener> https://gist.github.com/dotdash/85f2d2f222139d12f4e1
[16:06:04] <doener> ldd output
[16:06:33] <eddyb> doener: odd
[16:08:36] <eddyb> doener: r2 installed; then, inside the r2 shell, `is | grep fib` (no quotes), get the address, `s 0xADDR_OF_FN` and `V` to enter "visual mode"
[16:08:47] <eddyb> then... I forgot how to change it, lol
[16:09:30] <eddyb> doener: ah, `p`
[16:10:05] <eddyb> it's weird at first, but probably the best tool out there
[16:13:58] <doener> eddyb: identical for both binaries, except for the starting address, 0x4460 vs. 0x44f0
[16:14:27] <eddyb> 0x60 is a multiple of 0x20 while 0xf0 isn't
[16:15:02] <eddyb> doener: the function has the same number of bytes in both? not exactly what I would expect :/
[16:15:12] <eddyb> doener: does readelf show any dissimilarities?
[16:18:30] <doener> eddyb: RPATH
[16:18:43] <doener> with -C no-rpath, they behave identical
[16:18:49] <doener> holy...
[16:20:14] * eddyb learned alignments
[16:20:37] <eddyb> doener: okay, so that doesn't show up in ldd, but it's what I suspected
[16:20:52] <eddyb> doener: I wish you could force it to be aligned to a multiple of 0x20
[16:27:48] *** Quits: bytbox (s@moz-E1E7FAC3.washdc.fios.verizon.net) (Ping timeout)
[16:29:06] *** Joins: bytbox (s@moz-E1E7FAC3.washdc.fios.verizon.net)
[16:33:05] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[16:33:09] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[16:45:45] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[17:08:04] *** Quits: Kxepal (Miranda@moz-6DDBE711.pppoe.mtu-net.ru) (Ping timeout)
[17:08:27] *** Joins: mib_3w75d0 (Mibbit@17C39DD.FA4CF353.CC1A2609.IP)
[17:11:44] *** Joins: Kxepal (Miranda@moz-BAA550EE.pppoe.mtu-net.ru)
[17:16:33] *** Quits: mib_3w75d0 (Mibbit@17C39DD.FA4CF353.CC1A2609.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[17:24:40] <eddyb> cmr: I wish we had Copy refinements
[17:25:33] <eddyb> I guess I could clone unwrapped values and package them, but meh
[17:37:20] *** Joins: bjz_ (bjz@B398BE78.F804C29E.D35A31DF.IP)
[17:37:20] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[17:38:22] <eddyb> command 2> >(grep -v something 1>&2)
[17:38:32] <eddyb> mad bash skills
[17:49:10] *** Quits: doener (doener@moz-C68F600D.unity-media.net) (Quit: leaving)
[17:56:09] *** Quits: edwardw (edwardw@FE274C20.C036752E.F5B522C5.IP) (Ping timeout)
[17:56:56] *** Joins: edwardw (edwardw@68931FF2.B77F1D58.FAED9FFC.IP)
[18:01:10] <eddyb> cmr: bash -c "LD_PRELOAD=/usr/lib64/libjemalloc.so.1 make -C /home/eddy/Projects/rust rustc-stage1 RUSTFLAGS='-Z time-passes' -j2 2> >(grep 'error:' 1>&2)"
[18:01:19] <eddyb> cmr: because clicking on errors
[18:06:39] <eddyb> libsyntax/ext/format.rs:612:13: 612:16 error: in type `&'a mut ext::base::ExtCtxt<'b>`, pointer has a longer lifetime than the data it references
[18:06:53] <eddyb> that error shows up if I destructure a Context :/
[18:07:32] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[18:09:56] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[18:10:53] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[18:13:15] *** Joins: enix_ (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[18:13:15] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Connection reset by peer)
[18:14:59] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Quit: ì „ ì´ë§Œ ê°‘ë‹ˆë‹¤.)
[18:17:22] *** Joins: lkuper (lkuper@F23E847.654CD82F.51B6877.IP)
[18:18:20] <eddyb> :S
[18:24:52] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[18:24:58] <eddyb> ecx: &ref mut ecx, // gets me further, but I can't really do that (it borrows and I want to move out)
[18:26:45] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[18:26:45] <ghrust> [13rust] 15bors 04force-pushed 06auto from 148dca3ae to 14d79fbba: 02http://git.io/N3iJvQ
[18:26:45] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[18:29:20] <eddyb> kimundi: thanks to you, I don't even have to think for this hack! let ecx = unsafe {&mut *(self.ecx as *mut _)};
[18:33:44] <kimundi> eddyb: :P
[18:38:48] <eddyb> our statement parsing code is nuts
[18:42:00] *** Quits: detrino (chris@moz-EAECB432.lv.lv.cox.net) (Ping timeout)
[18:48:25] *** Joins: detrino (chris@moz-EAECB432.lv.lv.cox.net)
[18:49:15] *** Quits: cgaebel (clark@moz-F9D89110.nyc.res.rr.com) (Ping timeout)
[18:55:06] <eddyb> I'll be surprised if I didn't break the parser
[18:57:08] <kimundi> eddyb: Refactoring or new feature?
[18:57:32] <eddyb> kimundi: P
[19:09:40] *** Quits: canhtak (canhtak@moz-4FB0FBC1.wl.t.ulaval.ca) (Quit: canhtak)
[19:12:43] *** Quits: esummers (esummers@moz-3B015C90.wi.res.rr.com) (Quit: Computer has gone to sleep.)
[19:13:07] *** Joins: esummers (esummers@moz-3B015C90.wi.res.rr.com)
[19:13:20] * kimundi was unsure for a moment wether this is a mistyped :P or P<T>, and decides the latter is most logical.
[19:13:48] <eddyb> kimundi: only 36 borrow errors left in libsyntax, all in ast_map
[19:13:56] <eddyb> which needs to use unsafe pointers for now
[19:14:27] <eddyb> (I'll probably borrow the crate safely, later on)
[19:14:40] <eddyb> (and maybe assign IDs by mutating instead of folding)
[19:14:47] *** Quits: esummers (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[19:16:42] *** Joins: esummers (esummers@moz-3B015C90.wi.res.rr.com)
[19:26:31] *** Quits: esummers (esummers@moz-3B015C90.wi.res.rr.com) (Quit: Computer has gone to sleep.)
[19:26:54] *** Joins: esummers (esummers@moz-3B015C90.wi.res.rr.com)
[19:29:22] *** Quits: esummers (esummers@moz-3B015C90.wi.res.rr.com) (Quit: Computer has gone to sleep.)
[19:29:48] *** Joins: esummers (esummers@moz-3B015C90.wi.res.rr.com)
[19:30:14] <eddyb> (aww I forgot about inlined items, drat)
[19:31:28] *** Quits: esummers (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[19:31:34] *** Joins: esummers (esummers@moz-3B015C90.wi.res.rr.com)
[19:33:01] *** Joins: canhtak (canhtak@moz-4FB0FBC1.wl.t.ulaval.ca)
[19:36:33] *** Quits: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr) (Ping timeout)
[19:40:24] *** Joins: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr)
[19:40:51] *** Joins: aatch (James@moz-B437F499.pocketrent.com)
[19:41:26] *** NiccosSystem` is now known as NiccosSystem
[19:41:48] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[19:41:48] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/SO9L5Q
[19:41:48] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[19:41:48] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[19:42:30] *** Joins: cgaebel (clark@moz-F9D89110.nyc.res.rr.com)
[19:46:44] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[19:46:44] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/n_MNiA
[19:46:44] <ghrust> 13rust/06auto 149fc45c1 15Colin Sherratt: Check that the old value was 1 and not 0 when dropping a Arc value....
[19:46:44] <ghrust> 13rust/06auto 14402739d 15bors: auto merge of #13211 : csherratt/rust/arc_fix, r=alexcrichton...
[19:46:44] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[19:46:48] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[19:46:48] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/m48kEQ
[19:46:48] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[19:47:46] <eddyb> kimundi, huon: \o/ libsyntax compiles P
[19:47:57] <kimundi> \o/
[19:47:58] <eddyb> and no lints, I'm (pleasantly) surprised
[19:48:12] <eddyb> not that it will run, because I'm using a few hacks. but it should be fixable
[19:48:23] <eddyb> aaaand now to get type errors from rustc :D
[19:51:17] *** Quits: mawuli (mawuli@F7A4F2ED.68EE7C48.E520B65A.IP) (Ping timeout)
[19:51:44] *** Joins: mawuli (mawuli@F7A4F2ED.68EE7C48.E520B65A.IP)
[19:52:32] *** Joins: japaric (japaric@DC168457.F3E5B3F6.F4D5766F.IP)
[19:52:59] *** Quits: japaric_ (japaric@F25E6A94.64CFB2BA.F29ED47E.IP) (Ping timeout)
[19:53:39] <eddyb> kimundi: oh dear, how diagnostic::expect clones.... it's stupid
[19:54:47] <kimundi> eddyb: Tell me about it... I'm removing ~60 calls to vec::append, and each one takes a slice and clones its content
[19:55:01] <kimundi> I can move over half of it to move iterators
[19:55:18] <eddyb> kimundi: try to not change too many things in fold
[19:55:23] <eddyb> because I basically rewrote that
[19:55:28] <eddyb> everything else is fine
[19:55:38] <kimundi> Eh, whoever makes a PR first wins ;)
[19:55:59] <kimundi> (But I'll try to keep it in mind)
[19:56:08] <eddyb> did you remove .map?
[19:56:20] <eddyb> because that will ruin fold
[19:56:53] <eddyb> SiegeLord: I guess you are in here. but talk of the devil :P
[19:58:04] <eddyb> screw you, vtable checking
[19:58:12] <eddyb> with your fatal errors
[19:58:28] <eddyb> kimundi: I can only estimate an error count of "huge"
[19:59:02] <kimundi> eddyb: I did indeed remove map, and I don't know an exact error count
[19:59:16] <kimundi> But "huge" was accurate
[19:59:18] <eddyb> strcat will love this, will litter rustc with hundreds of &**x
[19:59:20] <eddyb> kimundi: I mean, mine
[19:59:51] <eddyb> 100 errors in just a handful of files
[20:00:18] <eddyb> good night for now
[20:00:34] *** Quits: enix_ (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Connection reset by peer)
[20:00:37] *** Joins: enix__ (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[20:02:05] *** Quits: eddyb (eddy@F8B50789.F33C1089.FB866788.IP) (Ping timeout)
[20:14:36] *** Quits: edwardw (edwardw@68931FF2.B77F1D58.FAED9FFC.IP) (Quit: Leaving...)
[20:16:03] *** Quits: huon (Thunderbir@moz-7CC720CF.lns20.syd7.internode.on.net) (Ping timeout)
[20:29:45] <sfackler> r? https://github.com/mozilla/rust/pull/13215
[20:30:05] <sfackler> travis builds seem to be broken
[20:37:35] *** Joins: Nekit1234007_ (Nekit12340@6DDA7830.B6412B36.4707F662.IP)
[20:38:08] *** Quits: nekit1234007 (Nekit12340@1A3BF3D7.477D93D.4707F662.IP) (Ping timeout)
[20:44:26] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[20:53:09] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[20:53:09] *** ChanServ sets mode: +o tjc
[20:53:16] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: Textual IRC Client: www.textualapp.com)
[21:01:24] <herrwolfe45> doener: thanks for the tip about verbose, it showed rust is indeed being built with debug info.
[21:01:48] *** Joins: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP)
[21:01:48] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14402739d to 14ec7d0c7: 02http://git.io/N3iJvQ
[21:01:48] *** Parts: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP) ()
[21:08:33] *** Quits: doomlord_ (servitor@moz-88D9A890.range86-184.btcentralplus.com) (Ping timeout)
[21:12:33] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[21:14:23] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[21:14:45] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[21:16:26] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[21:18:20] *** Joins: doomlord_ (servitor@moz-88D9A890.range86-184.btcentralplus.com)
[21:22:18] *** Quits: whitglint (uid15486@moz-31ABA2C0.irccloud.com) (Quit: Connection closed for inactivity)
[21:22:56] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Quit: TheHydroImpulse)
[21:23:03] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[21:30:57] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[21:36:51] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Quit: TheHydroImpulse)
[21:40:43] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[21:40:45] *** Quits: lkuper (lkuper@F23E847.654CD82F.51B6877.IP) (Quit: lkuper)
[21:44:42] *** Quits: esummers (esummers@moz-3B015C90.wi.res.rr.com) (Quit: Computer has gone to sleep.)
[21:45:05] *** Joins: esummers (esummers@moz-3B015C90.wi.res.rr.com)
[21:45:25] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[21:46:46] *** Quits: esummers (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[21:47:00] *** Quits: doomlord_ (servitor@moz-88D9A890.range86-184.btcentralplus.com) (Client exited)
[21:50:49] *** Joins: andrew-d_w (andrew-d_w@moz-17320F4E.hsd1.ca.comcast.net)
[21:50:57] *** Quits: andrew-d_w (andrew-d_w@moz-17320F4E.hsd1.ca.comcast.net) (Input/output error)
[21:51:18] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[21:55:00] *** Quits: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net) (Ping timeout)
[21:55:21] *** Joins: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net)
[21:55:56] *** Quits: enix__ (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Ping timeout)
[22:00:29] *** Quits: NiccosSystem (NiccosSyst@moz-ED196BB4.customer.lyse.net) (Ping timeout)
[22:01:29] *** Joins: esummers (esummers@moz-3B015C90.wi.res.rr.com)
[22:03:10] *** Quits: esummers (esummers@moz-3B015C90.wi.res.rr.com) (Ping timeout)
[22:05:02] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Quit: TheHydroImpulse)
[22:14:02] <larsberg> Does anybody know what the symbol "_ZN2rt6unwind18begin_unwind_inner20hc3acc718979b6b746Aj9v0.10.preE" might refer to? I'm getting it as a missing symbol attempting to load a fairly plain (i.e., no weird link commands or FFI usage) .so on Android...
[22:15:24] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[22:16:36] <sfackler> larsberg: it's part of the task failure infrastructure
[22:16:44] <sfackler> std::rt::unwind::begin_unwind_inner
[22:17:37] <flaper87> larsberg: are you using no_std ? (or not linking to it?)
[22:17:38] <larsberg> sfackler: so is this code that's supposed to be generated and live in my library? Or is it in e.g., librustuv?
[22:18:24] <sfackler> it should be a part of libstd
[22:19:38] <larsberg> flaper87: hrm, don't use no_std, but I'm also not pulling in any random crates here. Is there something you'd expect to see (e.g., one of green/native as an extern crate)?
[22:21:20] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[22:25:20] <flaper87> larsberg: mmmh, if there's a missing link, I think it's against std :/ For instance, begin_unwind (which calls begin_unwind_inner) is called by fail!
[22:25:31] <flaper87> larsberg: begin_unwind_fmt also calls begin_unwind_inner
[22:25:57] <flaper87> but you said you're not doing anything fancy and it should be a fairly plain .so
[22:28:38] *** Quits: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net) (Ping timeout)
[22:28:57] <larsberg> hrm, I must have nothing that causes an explicit reference to libstd (on android, dlopen doesn't recursively open dependencies, so we have to manually read SO files' elf headers and dlopen them)
[22:29:00] *** Joins: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net)
[22:30:36] <flaper87> larsberg: ah, good point, didn't know that
[22:37:24] *** flaper87 is now known as flaper87|afk
[22:39:09] *** Quits: eibwen (kvirc@moz-E7BC7E0A.dip0.t-ipconnect.de) (Ping timeout)
[22:40:03] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[22:46:23] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[22:48:05] *** Joins: ChrisMorgan (chris@moz-8DCBEA52.vic.adsl.internode.on.net)
[22:56:49] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[22:56:49] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/_h9Srw
[22:56:49] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[23:01:45] *** Joins: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP)
[23:01:45] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/VPsRLw
[23:01:45] <ghrust> 13rust/06auto 149fc45c1 15Colin Sherratt: Check that the old value was 1 and not 0 when dropping a Arc value....
[23:01:45] <ghrust> 13rust/06auto 142674a16 15bors: auto merge of #13211 : csherratt/rust/arc_fix, r=alexcrichton...
[23:01:46] *** Parts: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP) ()
[23:04:29] *** Joins: brson (brson@moz-62518563.mtv2.mozilla.com)
[23:04:29] *** ChanServ sets mode: +qo brson brson
[23:06:22] * cmr joins in on the "write an inheritance rfc" party
[23:08:02] *** Quits: bvssvni (Mibbit@moz-A47B6F8E.bb.online.no) (Quit: http://www.mibbit.com ajax IRC Client)
[23:08:29] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[23:11:05] <nrc> cmr: all the cool kids are doing it
[23:11:37] <cmr> :p
[23:11:41] *** Joins: Nekit1234007 (Nekit12340@4D86C49F.ABE6C08B.4707F662.IP)
[23:12:01] <cmr> did Gabor write up an RFC for his Coercible stuff?
[23:12:10] <cmr> (also I find it very hard to not read that as Crucible)
[23:12:14] *** Quits: Nekit1234007_ (Nekit12340@6DDA7830.B6412B36.4707F662.IP) (Ping timeout)
[23:15:01] * ChrisMorgan has often wondered whether enums and structs could be unified but hadn't seen it as being connected to inheritance
[23:15:17] <cmr> they certainly can be unified
[23:15:32] <cmr> I don't think they should, but they could be :p
[23:18:36] <nrc> cmr: I don't think so (re Gabor's Coercible stuff)
[23:18:52] <nrc> I don't see it amongst the RFC PRs at any rate
[23:19:21] <cmr> I still find the original single inheritance proposal most appealing...
[23:19:34] <cmr> are there problems with it that I haven't seen raised?
[23:20:53] <nrc> cmr: I don't think there are problems, per se
[23:21:29] <nrc> lots of people don't seem to like it - either because they just don't like OO inheritance or because it doesn't feel very Rust-y
[23:21:42] <cmr> it seems to me to be very minimal, in that it doesn't touch any existing features, and mirrors existing trait inheritance..
[23:21:58] <cmr> I feel with closed inheritance mentioned elsewhere it's very workabl.
[23:22:03] <nrc> there is also some overlap then between when to use enums and when to use struct inheritance
[23:22:31] <nrc> yeah, I don't mind virtual structs
[23:23:10] <nrc> unifying structs/enums feels more elegant and less bolted on, but I think which is more practical is more important
[23:23:26] <nrc> and I'm not sure about the answer there
[23:23:32] <cmr> to me it feels *less* elegant, in that it makes enum semantics very, very strange
[23:23:35] <cmr> at least from my pov
[23:23:44] <cmr> it's unlike anything I've seen before
[23:24:07] <nrc> adding fields or nesting or both?
[23:24:46] <cmr> let me re-read, that response makes me feel I am misunderstanding something
[23:24:56] <cmr> (haven't had caffeine yet, just woke up)
[23:25:17] <nrc> I think nesting is kind of natural (in my experience, programmers understand nesting intuitively)
[23:25:25] <nrc> but adding fields to enums is a bit weird
[23:26:23] <nrc> I'm going out for lunch, please continue on the PR, I'm more likely to find comments
[23:26:26] *** nrc is now known as nrc|afk
[23:26:58] <cmr> ok.
[23:33:53] *** Quits: canhtak (canhtak@moz-4FB0FBC1.wl.t.ulaval.ca) (Quit: canhtak)
[23:40:47] <cmr> flaper87|afk: does Freeze have an expression anymore, or is the concept removed entirely?
[23:46:51] <SimonSapin> bjz_: Iâ€™m not convinced the ability of being cast is worth a separate keyword for C-like enums
[23:47:10] <cmr> SimonSapin: don't you find it useful for it to be a separate type?
[23:47:26] <SimonSapin> (for context, we were discussing in #rust renaming enum to union or something https://github.com/rust-lang/rfcs/pull/24#issuecomment-39043172 )
[23:47:37] <cmr> (with a specific size, for FFI)
[23:47:58] <SimonSapin> cmr: well, each enum is a separate type
[23:48:04] <cmr> yes...
[23:48:09] <SimonSapin> some of them are C-like
[23:48:14] <SimonSapin> just like some structs are Send
[23:48:23] <cmr> The idea is to *remove* that distinction
[23:48:27] <cmr> not just rename the keyword
[23:48:42] <SimonSapin> Iâ€™m confused
[23:49:17] <cmr> The context was that our enums and the enums from C are hugely different but use the same keyword. So, split them up, and use something else for discriminated unions.
[23:50:20] <SimonSapin> cmr: Iâ€™m for renaming, but I donâ€™t think that separation is helpful
[23:51:08] <SimonSapin> If you can still have unions with some variants that are nullary there is not reason to prevent unions with all variants being nullary
[23:51:35] <SimonSapin> so youâ€™d have two possible keywords to encode the same type?
[23:51:59] <cmr> no, only the C-like type would be able to have an explicit representation set.
[23:52:21] <cmr> (This also helps with our "enum layout is undefined, except when all of the variants are nullary", and the same special case for setting the discriminator)
[23:53:15] <cmr> C-like enums behave very differently than the rest of the enums, so I think it's useful to make them separate.
[23:53:30] <SimonSapin> hum, ok, maybe
[23:55:50] *** Joins: lkuper (lkuper@moz-7BF67E71.tmodns.net)
