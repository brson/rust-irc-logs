[00:02:39] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[00:03:33] <acrichto> flaper87|afk: ping
[00:04:29] <acrichto> cmr: ping
[00:04:48] <cmr> acrichto: pong
[00:04:56] <acrichto> cmr: can you remove your r+ from https://github.com/mozilla/rust/pull/12017 ?
[00:05:04] <acrichto> I just realize it just turns everything into NOTE instead of error
[00:05:11] <cmr> oh jeez
[00:05:13] <acrichto> we want to deprecate 'extern mod' asap
[00:05:19] <cmr> done
[00:06:42] <bjz> Eridius: https://github.com/mozilla/rust/pull/12218
[00:06:54] <bjz> does that look ok?
[00:07:47] *** Joins: luzie (lucy@moz-CD18B14B.customer.cdi.no)
[00:08:15] *** Quits: luz (lucy@moz-CD18B14B.customer.cdi.no) (Ping timeout)
[00:09:20] <acrichto> bjz: out of curiosity, how come the new Arguments structure?
[00:09:37] <nrc> do we have a policy for tidying up code? Like, if I'm working on a function and it is in bad style, should I fix it, or leave it to preserve blame?
[00:10:05] <acrichto> nrc: I generally fix functions that I'm working around, but I don't go out of my way to fix things (I don't believe that we have a policy on this)
[00:10:35] <nrc> ok, cool
[00:11:55] *** Joins: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP)
[00:11:55] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/SGUJrA
[00:11:55] *** Parts: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP) ()
[00:13:06] <bjz> acrichto: I had a `fn arguments_to_str(args: &[clean::Argument]) -> ~str {` which wasn't really in keeping with the other stuff
[00:13:27] <bjz> acrichto: rustpkg impled Show on ~[Arguments] -_-#
[00:13:35] <acrichto> is that bad?
[00:13:40] <acrichto> oh conflicting impls
[00:13:44] <bjz> yep
[00:13:54] <acrichto> oh and you don't want the brackets
[00:13:56] <acrichto> sadface
[00:14:02] <bjz> yep
[00:14:11] <acrichto> r+
[00:14:32] <bjz> thanks!
[00:16:49] *** Joins: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP)
[00:16:49] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/o8yROw
[00:16:49] *** Parts: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP) ()
[00:16:50] *** Joins: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP)
[00:16:50] <ghrust> 01[13rust01] 15bors pushed 9 new commits to 06auto: 02http://git.io/nWBg7g
[00:16:50] <ghrust> 13rust/06auto 144e9724d 15Steven Fackler: Stop unloading syntax libraries...
[00:16:50] <ghrust> 13rust/06auto 14e9058e0 15Alex Crichton: Include compiler-rt in the distribution tarballs
[00:16:51] <ghrust> 13rust/06auto 14fb595cd 15Seo Sanghyeon: Resolve type variables when checking casting to char
[00:16:53] *** Parts: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP) ()
[00:17:36] <acrichto> will it merge?!
[00:17:38] <acrichto> will it blend?!
[00:17:44] * cmr hopes so.
[00:18:07] <acrichto> bjz: how confident are you in your patch?
[00:18:48] <bjz> acrichto: it would be good to look at the output of rustdoc first, but apart from that I'm confident
[00:19:10] <acrichto> alright, if the rollup fails which I'm sure it will I'll include your PR as well
[00:19:28] <bjz> acrichto: unfortunately rustdoc doesn't have many unit tests
[00:19:46] <acrichto> "unfortunately" it was great when writing the html stuff :)
[00:20:00] *** Quits: doomlord_ (servitor@moz-9B2006BF.range109-151.btcentralplus.com) (Quit: Leaving)
[00:24:54] <acrichto> new snapshots are almost here!
[00:25:01] <acrichto> according to buildbot eta at least
[00:25:05] <acrichto> which is almost always wrong
[00:25:09] <cmr> I was going to say
[00:25:15] <cmr> I don't even know what it's measuring.
[00:25:53] <acrichto> it in theory has past samples
[00:25:55] <acrichto> per step
[00:26:01] <acrichto> even per bot if it's smart enough
[00:27:35] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[00:28:02] <aatch> by default, buildbot uses the amount of output
[00:28:15] <acrichto> interesting
[00:28:16] <aatch> to track how far along things are.
[00:28:32] <aatch> You can write steps that use a different tracking mechanism though
[00:29:10] <aatch> I made one that looks for CMake's percentage output and used that as the primary one
[00:30:31] <bjz> acrichto: so my PR will be wrapped up in another commit?
[00:30:53] <acrichto> bjz: yeah if #12221 fails I'll try rolling your PR into that one as well
[00:30:58] <bjz> awesome
[00:31:04] <acrichto> if #12221 gets closed it'll close everything rolled up automatically
[00:31:12] <acrichto> if it fails and I'm not around bors will just keep going as normal
[00:31:29] <bjz> next snapshot we can get rid of deriving(ToStr)
[00:31:51] <acrichto> wheeeee
[00:31:58] <acrichto> snap3-linux passed!
[00:32:00] <acrichto> green light
[00:32:00] <bjz> and impl ToStr by delegating to Show
[00:32:01] <acrichto> green light
[00:32:04] <bjz> \o/
[00:32:17] <acrichto> snap3-mac, don't let me down
[00:33:56] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[00:34:18] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[00:35:50] *** Joins: canhtak (canhtak@moz-4D8F0D46.wl.t.ulaval.ca)
[00:36:04] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[00:38:05] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[00:38:27] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[00:39:41] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[00:42:02] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[00:42:09] <cgaebel> did I get all the code review comments!?
[00:42:31] *** Joins: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[00:44:40] *** Quits: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Ping timeout)
[00:45:01] *** Quits: eibwen (kvirc@moz-222E10E3.dip0.t-ipconnect.de) (Ping timeout)
[00:46:49] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[00:46:49] <ghrust> 01[13rust01] 15bors pushed 9 new commits to 06auto: 02http://git.io/IaXf1w
[00:46:49] <ghrust> 13rust/06auto 144e9724d 15Steven Fackler: Stop unloading syntax libraries...
[00:46:49] <ghrust> 13rust/06auto 14e9058e0 15Alex Crichton: Include compiler-rt in the distribution tarballs
[00:46:50] <ghrust> 13rust/06auto 14fb595cd 15Seo Sanghyeon: Resolve type variables when checking casting to char
[00:46:52] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[00:46:55] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[00:47:10] <acrichto> all snapshots succeeded!
[00:47:13] <Eridius> damn, we still don't allow `continue` in a closure?
[00:47:26] <Eridius> I guess we can't, acn we?
[00:47:27] <Eridius> *can
[00:47:29] <Eridius> >_<
[00:57:30] *** Quits: mawuli (mawuli@moz-5ADAB167.com.gh) (Ping timeout)
[00:58:18] *** Joins: mawuli (mawuli@moz-5ADAB167.com.gh)
[00:59:15] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[00:59:15] *** ChanServ sets mode: +ao dherman dherman
[01:01:28] *** Joins: deiome (christophe@moz-20DF51FE.dynamic.tstt.net.tt)
[01:06:42] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[01:07:44] <ktt3ja> just checking, the AST is immutable, right?
[01:08:46] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[01:09:05] <cmr> ktt3ja: should be, yes.
[01:11:28] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Quit: Leaving...)
[01:11:38] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[01:12:11] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Quit: Leaving...)
[01:13:36] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[01:24:38] *** kimundi is now known as zz_kimundi
[01:30:08] <acrichto> rusti: version
[01:30:10] -rusti- "rustc 0.10-pre (4cd555d 2014-01-24 03:28:15 -0500)"
[01:30:12] <acrichto> rusti: let foo = ~"hello"; let foo: ~[&str] = foo.words().collect(); foo[0]
[01:30:14] -rusti- " \x00\x00\x00\x00"
[01:30:25] *** Quits: mawuli (mawuli@moz-5ADAB167.com.gh) (Ping timeout)
[01:30:34] <sfackler> !
[01:30:38] *** Joins: mawuli (mawuli@moz-5ADAB167.com.gh)
[01:30:48] <acrichto> I think niko's lifetime changes fixed that
[01:31:52] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[01:31:52] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d53bb38 to 1458eeb07: 02http://git.io/N3iJvQ
[01:31:52] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[01:31:53] *** Joins: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP)
[01:31:54] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/5TR4ow
[01:31:54] <ghrust> 13rust/06auto 14c340347 15JeremyLetang: remove duplicate function from std::ptr (is_null, is_not_null, offset, mut_offset)
[01:31:54] <ghrust> 13rust/06auto 14f517d89 15bors: auto merge of #12167 : JeremyLetang/rust/ptr-func, r=alexcrichton...
[01:31:54] *** Parts: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP) ()
[01:32:19] <cgaebel> hey acrichto, did I get all the code review comments?
[01:32:38] <acrichto> cgaebel: what do you mean?
[01:32:58] <cgaebel> did I miss any?
[01:33:11] <cgaebel> can I rebase now? :D
[01:33:18] <acrichto> ah, let me read over
[01:33:27] <cgaebel> woo
[01:33:46] * cgaebel is probably /too/ excited
[01:33:59] *** Quits: jack (sid19593@moz-A42E5B7B.irccloud.com) (Ping timeout)
[01:40:39] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[01:40:39] *** ChanServ sets mode: +o tjc
[01:40:53] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[01:41:07] *** Joins: jack (sid19593@moz-A42E5B7B.irccloud.com)
[01:43:15] *** Joins: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[01:45:23] *** Quits: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Ping timeout)
[02:00:20] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[02:00:35] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[02:01:19] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[02:03:01] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[02:06:03] *** Quits: larsberg (larsberg@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net) (Quit: Leaving.)
[02:07:11] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[02:10:25] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[02:14:28] *** Quits: brson (brson@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: leaving)
[02:16:14] *** Joins: erickt_ (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[02:16:50] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[02:16:50] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14f517d89 to 1458eeb07: 02http://git.io/N3iJvQ
[02:16:50] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[02:16:51] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[02:16:51] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/MQ6r3Q
[02:16:51] <ghrust> 13rust/06auto 1444317ed 15Alex Crichton: Fix a bug where cached stacks weren't re-used...
[02:16:51] <ghrust> 13rust/06auto 14379c73f 15Alex Crichton: Don't allocate in LocalHeap::new()...
[02:16:51] <ghrust> 13rust/06auto 1476b1755 15Alex Crichton: Don't require an allocation for on_exit messages...
[02:16:53] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[02:18:41] *** Quits: erickt_ (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[02:20:22] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[02:25:57] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: Leaving)
[02:26:04] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[02:35:29] <Eridius> sweet, ICE. Haven't triggered one of those in a while
[02:37:30] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[02:40:00] *** Joins: gimpf (gimpf@moz-4A87FAE6.adsl.highway.telekom.at)
[02:40:37] *** Quits: sunfish (chatzilla@moz-C06D9702.mtv1.mozilla.com) (Ping timeout)
[02:40:55] *** Quits: deiome (christophe@moz-20DF51FE.dynamic.tstt.net.tt) (Quit: Leaving)
[02:42:32] *** Joins: zimbabao (rajaram@BDAF3FA4.1E78B47A.D2D1FAF0.IP)
[02:44:01] *** Joins: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[02:46:06] *** Quits: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Ping timeout)
[02:50:55] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[02:50:55] *** ChanServ sets mode: +ao dherman dherman
[02:58:05] <Eridius> acrichto: I just hit failed at 'assertion failed: prev >= 0', /Users/kevin/Dev/rust/rust/src/libstd/comm/stream.rs:355
[02:58:09] <Eridius> which as near as I can tell isn't expected to fail
[02:59:31] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Ping timeout)
[02:59:38] *** Quits: gimpf (gimpf@moz-4A87FAE6.adsl.highway.telekom.at) (Quit: Leaving.)
[03:01:17] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[03:01:18] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[03:02:36] <acrichto> Eridius: can you open an issue?
[03:03:57] <acrichto> Eridius: oh I see the bug, it's pretty minor
[03:11:28] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[03:13:14] *** Quits: zimbabao (rajaram@BDAF3FA4.1E78B47A.D2D1FAF0.IP) (Ping timeout)
[03:15:33] *** Joins: pcwalton (pcwalton@moz-14285ACF.ptr.us.xo.net)
[03:15:33] *** ChanServ sets mode: +ao pcwalton pcwalton
[03:15:55] *** Quits: pcwalton (pcwalton@moz-14285ACF.ptr.us.xo.net) (Quit: pcwalton)
[03:17:26] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[03:17:26] *** ChanServ sets mode: +o tjc
[03:26:21] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[03:27:40] <Eridius> acrichto: what's the bug?
[03:27:53] <Eridius> and do you still need an issue or are you tracking it already yourself?
[03:27:55] <acrichto> just not casing DISCONNECTED
[03:28:07] <acrichto> it'll take me a bit to get around to it
[03:28:11] <acrichto> so an issue is probably best
[03:28:18] <Eridius> ok
[03:29:31] <Eridius> filed as https://github.com/mozilla/rust/issues/12226
[03:32:32] *** Joins: zimbabao (rajaram@3FC8A380.13E31C97.D2D1FAF0.IP)
[03:33:37] <acrichto> thanks
[03:34:41] *** Joins: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net)
[03:35:26] *** Quits: zz_kimundi (kimundi@moz-7F6EAE0B.dip0.t-ipconnect.de) (Ping timeout)
[03:36:20] * huon is back, with a new name
[03:37:04] * acrichto gasps
[03:37:18] <huon> acrichto: pong for several days ago, btw
[03:37:24] <acrichto> lol
[03:39:00] <acrichto> huon: good catch with the handle.id = garbage;
[03:39:04] <Eridius> huon: :O
[03:39:12] *** Joins: zz_kimundi (kimundi@moz-7D8AC97.dip0.t-ipconnect.de)
[03:39:13] *** zz_kimundi is now known as kimundi
[03:41:16] <sfackler> huon: pls D: https://github.com/mozilla/rust/blob/master/src/libsyntax/ext/deriving/generic.rs#L219
[03:41:37] <huon> hehe
[03:41:46] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[03:41:49] <huon> I mean... how horrible
[03:41:50] <sfackler> I hope you felt a little bit bad when you wrote that :P
[03:41:55] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[03:41:55] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14391a1fb to 1458eeb07: 02http://git.io/N3iJvQ
[03:41:55] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[03:41:56] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[03:41:56] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/LiPXEA
[03:41:56] <ghrust> 13rust/06auto 14cc34dbb 15Alex Crichton: Expose whether event loops have active I/O...
[03:41:56] <ghrust> 13rust/06auto 144256d24 15Alex Crichton: Percolate the (Scheduler, GreenTask) pair upwards...
[03:41:56] <ghrust> 13rust/06auto 142650b61 15Alex Crichton: Don't hit epoll unless a scheduler absolutely must...
[03:41:58] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[03:42:18] <huon> sfackler: feel free to change it to an proper enum
[03:42:44] <sfackler> i'm actually thinking about restructuring how itemdecorators work in general
[03:42:44] <huon> the one problem with external syntax extensions: syntax::ext is now a public API :'(
[03:42:57] <sfackler> since the current method causes weird order dependencies
[03:43:14] <huon> that won't change the core parts of deriving will it?
[03:43:19] <sfackler> no
[03:43:46] <sfackler> I *think* what I want is to have the function take a reference to the item, and then return an array of items
[03:43:52] <sfackler> the actual struct/enum is immutable
[03:44:40] <bjz> acrichto: have you thought of maybe having something like: https://gist.github.com/bjz/b78261faca4dfe15f11c
[03:44:45] *** Joins: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[03:45:31] <huon> sfackler: what's it currently do?
[03:45:41] *** Joins: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net)
[03:45:54] <acrichto> bjz: that would be possible, but what's the use case?
[03:46:24] <bjz> acrichto
[03:46:27] <bjz> oops
[03:46:48] <acrichto> o/
[03:46:51] *** Quits: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Ping timeout)
[03:48:54] <huon> :( having correct closures is making `defer!` much less useful/useable
[03:49:29] <bjz> acrichto: I mean in terms of allowing user libraries to demand the main thread. But, it might be too complicated/ugly. And the use case might be too small :[
[03:50:12] <bjz> acrichto: https://github.com/bjz/glfw-rs/issues/97
[03:50:21] <bjz> huon: are you dbaupp? :P
[03:50:29] <acrichto> bjz: I'd be worried about the usability of the libraries if you don't start from the main thread though
[03:50:48] <huon> bjz: maaaaybe
[03:50:50] <huon> (yes)
[03:50:52] <bjz> hah
[03:51:06] <huon> bjz: can you define an exportable macro that does the necessary set up?
[03:51:44] <huon> making it impossible/harder to do anything without setting up.
[03:52:29] <huon> like glfw_main!(glfw => { glfw.create_window(...); ... })
[03:52:45] <sfackler> huon: it starts out with a ~[item], and threads that through all of the decorator functions which in practice just keep on tacking impl blocks, but can actually do anything they want with the array
[03:53:06] <sfackler> it ends up being this weird n^2 thing
[03:53:24] <bjz> huon: what happens if the use is using another IO lib that wants the main thread as well?
[03:53:50] <bjz> huon: and that has its own custom macro
[03:54:20] <acrichto> bjz: is this a main thread requirement or a "don't use this on another thread" requirement?
[03:54:22] <huon> bjz: I guess you'd have to still expose the manual stuff, but make the common(?) case simpler
[03:54:56] <huon> sfackler: ah, yes. (n^2? isn't it just .pushing?)
[03:55:08] <huon> but yeah, removing that weirdness would be good
[03:55:21] <sfackler> huon: the deriving internals do basically for item in items { if it's a struct definition, make the impl }
[03:55:39] <sfackler> and iirc that repeats for each different deriving thing
[03:55:42] <huon> ah, right
[03:55:45] <huon> "yay"
[03:55:47] <sfackler> yep
[03:56:09] <sfackler> the question is if we want to allow itemdecorators to modify the item they're attached to
[03:56:22] <huon> I'd say yes
[03:56:26] <sfackler> I'd say no, since it introduces confusing order dependence
[03:56:41] <sfackler> iirc if you do #[deriving(Clone)] #[remove_a_field] things will probably break
[03:56:49] <sfackler> vs #[remove_a_field] #[deriving(Clone)]
[03:56:52] <huon> #[prefix="foo_"] extern { fn bar(); fn baz(); } => extern { fn foo_bar(); fn foo_baz(); }
[03:56:57] <huon> ah yeah
[03:57:04] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:57:09] <sfackler> maybe we could have 2 different itemdecorators
[03:57:19] <sfackler> one that makes new items and one that modifies the item
[03:57:22] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:57:24] <sfackler> and run all the modification ones first
[03:57:31] <sfackler> it still seems kind of sketchy
[03:57:34] <huon> yeah...
[03:57:41] <huon> I guess make it immutable for now is fine
[03:57:56] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[03:57:56] *** ChanServ sets mode: +ao dherman dherman
[03:58:04] <huon> and if we *really* need mutability for something we can work out a plan when we get there
[03:58:08] <sfackler> yeah
[03:58:25] <sfackler> I think having a separate thing from ItemDecorator would probably work decently well
[03:58:39] * sfackler -> home
[04:03:54] <Eridius> acrichto: is there any way to find out what tasks are keeping a program alive after it falls off the end of main()?
[04:04:57] <Eridius> I think I know what the task is, but I don't know for sure
[04:05:14] <acrichto> not right now, no
[04:05:19] <Eridius> I also want some way to spawn a task and mark it to let it be killed automatically if it's the last task alive in its task pool
[04:05:55] <Eridius> actually I guess I don't know what task it is, because the one I thought it was should have exited already >_<
[04:07:13] * Eridius really doesn't want to have to stick an `unsafe { libc::exit(0) }` at the end of main()
[04:08:51] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[04:08:51] *** ChanServ sets mode: +ao pcwalton pcwalton
[04:11:04] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[04:16:12] *** Joins: erickt_ (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[04:18:35] *** Quits: erickt_ (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[04:18:35] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[04:22:06] <huon> heh, we have some "somke" tests
[04:25:35] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[04:26:51] *** Joins: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP)
[04:26:51] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 147cf85eb to 1458eeb07: 02http://git.io/N3iJvQ
[04:26:51] *** Parts: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP) ()
[04:26:55] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[04:26:55] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/DnnkUQ
[04:26:55] <ghrust> 13rust/06auto 14c527e66 15Kevin Ballard: rustdoc: Strip impls of stripped private types...
[04:26:55] <ghrust> 13rust/06auto 14410cb31 15Kevin Ballard: rustdoc: Strip impls of traits on #[doc(hidden)] types...
[04:26:55] <ghrust> 13rust/06auto 14fa0026d 15bors: auto merge of #12195 : kballard/rust/rustdoc-strip-impls-of-stripped, r=cmr...
[04:26:57] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[04:30:16] <huon> acrichto: ping
[04:30:18] *** Joins: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[04:37:22] *** Quits: zimbabao (rajaram@3FC8A380.13E31C97.D2D1FAF0.IP) (Ping timeout)
[04:39:52] <acrichto> huon: pong
[04:42:49] <huon> acrichto: is there any particular reason we have std::unstable::mutex::Mutex as well as std::sync::LittleLock?
[04:43:01] <acrichto> huon: nah, just legacy at this point
[04:43:12] <huon> so LittleLock should go?
[04:43:31] <huon> (can Mutex graduate out of unstable yet?)
[04:44:00] <acrichto> it depends
[04:44:07] <acrichto> Mutex is pretty low level and doens't have a safe api
[04:44:11] <acrichto> but little lock does have a safe api
[04:44:14] <acrichto> I think...
[04:44:17] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[04:44:17] *** ChanServ sets mode: +ao dherman dherman
[04:44:22] <acrichto> they both kinda have their uses
[04:44:31] <huon> LittleLock is a very thin wrapper around Mutex
[04:45:06] <acrichto> it has an RAII lock though
[04:45:11] <acrichto> and no unlock method
[04:45:11] <huon> I'm adding that to Mutex
[04:45:26] <acrichto> if that works then I think we could drop little lock
[04:45:35] <acrichto> we may want to discuss more before promoting mutex though
[04:45:44] <acrichto> I don't think it should go in std::sync
[04:45:59] <huon> ok
[04:48:50] <sfackler> acrichto: fwiw, a non-raii lock is necessary to interface with some C libraries
[04:49:05] <acrichto> I've found it to be quite convenient sometimes
[04:50:00] <huon> acrichto: btw, LittleLock doesn't actually have a safe API
[04:50:08] <huon> all the methods are `unsafe` still
[04:50:28] <huon> sfackler: my modifications include .lock_noguard for use without the RAII wrapper
[04:51:00] <acrichto> huon: cool
[04:52:17] <huon> acrichto: <3 #[must_use] btw
[04:52:31] <acrichto> :D
[04:52:44] <huon> put #[must_use] on the RAII guard => compiler tells you when you forget to save it
[04:53:03] <acrichto> that's pretty clever actually
[04:54:16] <acrichto> ok I have 14 open PRs, I need to stop and land some of them
[04:55:28] <huon> nah
[04:55:42] <huon> just fill the queue entirely with your PRs
[04:55:47] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[04:56:03] <acrichto> I think the android bot hates me right now
[05:07:42] <Eridius> how did bench/core-map.rs just fail on my PR? http://buildbot.rust-lang.org/builders/auto-linux-64-x-android-t/builds/1144/steps/test/logs/stdio
[05:07:46] <Eridius> hmm it says "Killed"
[05:08:46] * Eridius assumes this is some sort of spurious failure and will retry
[05:09:57] <acrichto> Eridius: don't retry that just yet
[05:10:00] <Eridius> oh?
[05:10:01] <acrichto> it's happening a lot on the bots recently
[05:10:06] <acrichto> 3 of my PRs failed for that reason
[05:10:13] <Eridius> so, what, just let bors continue to run other PRs?
[05:10:36] <acrichto> well, you can retry, but I think many things will fail for that reason
[05:11:12] <Eridius> damn android bot
[05:11:44] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[05:11:55] *** Joins: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP)
[05:11:55] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/txUnaA
[05:11:55] <ghrust> 13rust/06auto 14c527e66 15Kevin Ballard: rustdoc: Strip impls of stripped private types...
[05:11:55] <ghrust> 13rust/06auto 14410cb31 15Kevin Ballard: rustdoc: Strip impls of traits on #[doc(hidden)] types...
[05:11:56] <ghrust> 13rust/06auto 14d77a0c9 15bors: auto merge of #12195 : kballard/rust/rustdoc-strip-impls-of-stripped, r=cmr...
[05:11:58] *** Parts: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP) ()
[05:12:12] <Eridius> heh ok, too late
[05:12:18] <Eridius> I won't retry a second time if this fails though
[05:14:19] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[05:17:07] <Eridius> acrichto: I assume you know what you're doing with that start_selection PR
[05:17:12] <Eridius> and thanks
[05:18:07] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[05:18:46] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[05:19:02] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[05:19:06] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:19:15] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:20:48] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[05:20:57] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:24:38] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[05:24:58] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:27:37] *** Joins: zimbabao (rajaram@47769425.AE842F9B.81C3DAA1.IP)
[05:33:29] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[05:37:44] *** Quits: canhtak (canhtak@moz-4D8F0D46.wl.t.ulaval.ca) (Quit: canhtak)
[05:43:44] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: Textual IRC Client: www.textualapp.com)
[05:47:02] *** Joins: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP)
[05:47:02] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d77a0c9 to 1458eeb07: 02http://git.io/N3iJvQ
[05:47:02] *** Parts: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP) ()
[05:50:45] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[05:56:42] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Ping timeout)
[05:58:57] <Eridius> damn you android bot!
[06:16:22] <Eridius> boy, I wish there was a way to avoid recompiling libraries when only tests have been modified
[06:17:06] <huon> Eridius: NO_REBUILD=1
[06:17:12] <huon> works for std and extra
[06:17:21] <huon> but I've just discovered it doesn't for green :'(
[06:18:41] <Eridius> huon: oh sure, but I'm running `make check`
[06:18:46] <Eridius> NO_REBUILD doesn't work for most stuff unfortunately
[06:18:51] <Eridius> it doesn't even work for e.g. checking documentation
[06:19:00] <ChrisMorgan> Eridius: I can imagine having the likes of a --lazy flag in rustc to have it check if the constructed AST is identical to the previously compiled AST (and all flags and such the same).
[06:19:28] <Eridius> hash the AST, embed that in the built product, and skip the rebuild if it ends up the same?
[06:19:55] <ChrisMorgan> Something like that.
[06:20:12] <Eridius> alternatively we could extract all tests into their own files and figure out how to tell the makefiles that those files should only contribute to the test targets. But that's cumbersome
[06:20:14] <ChrisMorgan> Not sure whether you'd want that to be the default or not.
[06:21:17] <huon> Eridius: ah, yeah.
[06:21:23] <huon> Eridius: you can also touch the files back in time
[06:21:36] <Eridius> huon: hmm
[06:21:37] <huon> so the makefiles can't tell they've been modified
[06:21:47] <Eridius> I wonder if vim has a way to write without changing mod date?
[06:21:58] <Eridius> although actually, I _do_ need to rebuild the tests
[06:22:02] <Eridius> I just don't want to rebuild the libraries
[06:22:04] <Eridius> so that doesn't work
[06:22:07] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[06:22:07] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/7CCZOQ
[06:22:07] <ghrust> 13rust/06auto 14b37700c 15Alex Crichton: Invoke gcc with -nodefaultlibs...
[06:22:07] <ghrust> 13rust/06auto 145a45b94 15bors: auto merge of #12205 : alexcrichton/rust/nodefaultlibs, r=brson...
[06:22:08] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[06:22:20] <Eridius> well, I mean if the test failed to compile, I don't have a problem, but if it compiled and simply didn't pass, I have to rebuild it
[06:22:52] <huon> remove the test runner and the tmp/*.ok file and then touch it back in time
[06:23:05] <huon> bleh, hacks :(
[06:23:17] <Eridius> too much effort
[06:23:26] <huon> yup
[06:26:56] <ChrisMorgan> Eridius: http://vim.wikia.com/wiki/Save_buffer_without_changing_Last_Modified_attribute (not that you need it, but just a demonstration that it can be done, albeit in a roundabout way)
[06:27:23] <Eridius> ugh
[06:30:08] <cmr> http://www.phoronix.com/scan.php?page=news_item&px=MTYwMTY
[06:30:10] <cmr> eeeeugh
[06:30:16] <cmr> way to lie, michael
[06:30:35] <cmr> this is spreading in all manner of wrong ways.
[06:34:20] *** Quits: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com) (Ping timeout)
[06:37:38] *** Joins: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com)
[06:47:00] *** Joins: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP)
[06:47:00] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/2jViwQ
[06:47:00] <ghrust> 13rust/06auto 14d0770c1 15Steven Fackler: Stop unloading syntax libraries...
[06:47:00] <ghrust> 13rust/06auto 14e41805a 15bors: auto merge of #12206 : sfackler/rust/leak-dylibs, r=pcwalton...
[06:47:01] *** Parts: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP) ()
[06:47:03] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[06:47:03] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 145a45b94 to 1458eeb07: 02http://git.io/N3iJvQ
[06:47:03] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[07:06:49] *** Quits: Kxepal (Miranda@moz-9E323D1A.pppoe.mtu-net.ru) (Quit: Kxepal)
[07:07:09] *** Joins: Kxepal (Miranda@moz-9E323D1A.pppoe.mtu-net.ru)
[07:15:03] *** Joins: eddyb (eddy@688E9026.F7C96DA2.FCAAE698.IP)
[07:16:11] *** Joins: erickt_ (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[07:18:11] * sfackler shakes fist at android
[07:18:37] *** Quits: erickt_ (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[07:22:01] *** Joins: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP)
[07:22:01] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/GkBtcA
[07:22:01] <ghrust> 13rust/06auto 14e4688d5 15Felix S. Klock II: Remove a source of O(n^2) running time in bigints....
[07:22:01] <ghrust> 13rust/06auto 14bbff975 15bors: auto merge of #12209 : pnkfelix/rust/fsk-bigint-perf-improvements, r=huonw...
[07:22:02] *** Parts: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP) ()
[07:33:14] *** flaper87|afk is now known as flaper87
[07:34:04] <flaper87> eddyb: around?
[07:34:12] <eddyb> just woke up :)
[07:34:31] <flaper87> eddyb: great that makes it 2 of us
[07:34:38] * flaper87 slaps himself 2 times and says hi
[07:34:47] *** Quits: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net) (Ping timeout)
[07:34:58] <flaper87> eddyb: want to get your thoughts on something: http://pastebin.mozilla.org/4271679
[07:35:12] <flaper87> eddyb: https://github.com/FlaPer87/rust/commit/6adeeafd7a9716ee868c1ee0e815db0697bcdf86
[07:36:04] <eddyb> aaaand that crashed my chrome for some reason :/
[07:36:27] <flaper87> eddyb: `ty::expr_ty` on the expr basically returns the type of the variable and not the type of the Variant :/
[07:36:36] <flaper87> eddyb: :(
[07:37:30] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[07:39:19] <eddyb> flaper87: you need something smarter
[07:39:52] <huon> flaper87: you want to get the variant that corresponds to an Expr?
[07:40:35] *** Quits: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com) (Ping timeout)
[07:40:38] <huon> cmr: http://www.octayn.net/ seems to be redirecting to about.me
[07:40:39] <eddyb> flaper87: you have to take the expression and compute a custom type contents, for the value, not the type
[07:40:50] <flaper87> eddyb: yeah, I know, I wanted to know if there are already some functions for taht or I'll write my own
[07:40:57] <cmr> huon: that's what it does.
[07:41:02] <cmr> oh
[07:41:05] <cmr> hm
[07:41:05] <flaper87> huon: I need the type of the value 
[07:41:08] <flaper87> huon: changed nick ?
[07:41:11] <flaper87> :D
[07:41:11] <cmr> that's the wrong page...
[07:41:29] <eddyb> huon: are you dbaupp, by any chance?
[07:42:03] <huon> eddyb: yep
[07:42:13] <eddyb> flaper87: the expression shouldn't be recursive, so you don't need the fancy mechanism in type contents
[07:42:30] *** Joins: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com)
[07:42:32] <huon> cmr: every url to octayn.com is redirecting like that
[07:42:42] <huon> (well, the one non-top-level one I clicked before)
[07:42:53] <eddyb> huon: *sigh* time to adjust
[07:43:07] <huon> flaper87: type of the value? ... that's always Option<T>
[07:43:20] <eddyb> huon: he actually needs the type contents of the value
[07:43:22] <cmr> hrm.
[07:43:24] <huon> eddyb: yep
[07:43:30] <cmr> huon: seems to be fixed?
[07:43:37] * cmr didn't touch a single thing, just logged in.
[07:44:08] <cmr> seems about.me is having some problems.
[07:44:14] <huon> cmr: http://www.octayn.net/benches/rustc.svg still redirect for me
[07:44:20] <eddyb> flaper87: you have to combine a custom type_contents with some kind of static value traversal, like in check_consts, I guess
[07:44:42] <cmr> huon: drop the www
[07:45:02] * cmr goes to fix that.
[07:45:03] <huon> flaper87: a variant is not a separate type to the enum from which it comes, so you'll confuse people less if you avoid saying "type of a value" when you don't mean `None -> Option<T>`
[07:46:41] <flaper87> huon: roger that, thanks! :)
[07:47:01] <huon> cmr: doesn't seem to work even without the www
[07:47:03] <flaper87> eddyb: yeah, I think I'll move this to typeck/check/, it makes more sense to me
[07:47:17] <eddyb> flaper87: does it?
[07:47:22] <huon> cmr: oh, no it does
[07:47:23] <eddyb> middle has a weird layout
[07:47:43] <flaper87> eddyb: we're checking the type anyway and that happens before the kind analysis
[07:47:50] <flaper87> so, it does kinda make sense
[07:48:13] <cmr> Oh the www redirect was on a DNS level, not nginx...
[07:48:13] <huon> anyway, now that I can see the flamegraph... geez we're spending a lot of time in the hashmap
[07:48:26] <eddyb> consts are checked separately AFAIK
[07:48:56] <flaper87> eddyb: const_eval, I think
[07:49:14] <huon> flaper87: check_const
[07:49:22] <eddyb> and check, yeah ^^
[07:49:52] <eddyb> did nmatsakis leave anything for me?
[07:50:20] <cmr> huon: well, www should be fixed now, modulo dns propagation time.
[07:50:42] <eddyb> maybe a message starting with "your mission, should you decide to accept it, ..."?
[07:50:46] <cmr> that record had a really long ttl, so...
[07:51:49] <huon> eddyb: https://botbot.me/mozilla/rust-internals/search/?q=eddyb%3A
[07:52:34] <eddyb> of course :(
[07:53:51] <eddyb> well, I realized that I'm silly and my inflate implementation is probably slower in the "copy-paste-maybe-repeat" loop, that accounts for way more operations than the huffman stuff
[07:54:16] <eddyb> so I'm fiddling with that. I wish we had a mut_windows iterator *sigh*
[07:54:22] <cmr> eddyb: you know how to profile, right? :P
[07:54:30] <huon> eddyb: if you split out the parts into #[inline(never)] functions you can get easy profiling of the parts
[07:54:42] <huon> (and, as you know, mut_windows is unsafe :P )
[07:54:49] <eddyb> how is it unsafe?
[07:54:56] <huon> overlapping &mut
[07:54:58] <huon> 's
[07:55:15] <eddyb> pffft, I forgot about that
[07:55:15] <huon> foo.mut_windows(10).collect() // oops
[07:55:33] <eddyb> internal iterator time?
[07:55:46] <eddyb> cmr: not that it helps when everything is in a single function with macros and/or inlined helpers
[07:56:00] <huon> eddyb: cf. #[inline(never)] :P
[07:56:02] <cmr> eddyb: well you still get instruction-level profiling.
[07:56:14] <huon> (makes it slightly slower but at least it shows you which parts are being a drag)
[07:56:17] <cmr> and perf can help with cache misses and branch mispredictions etc.
[07:56:26] <cmr> (ie, microoptimization)
[07:56:32] <eddyb> there's like one or two bytes to decode every 300 decompressed
[07:56:42] <eddyb> (that is, with repeating patterns)
[07:57:01] <eddyb> I just didn't see it the first time
[07:58:06] <eddyb> and as long as I'm not using too much memory on the dynamic huffman nonsense, I should be fine
[08:02:32] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[08:04:58] <huon> acrichto: r? https://github.com/mozilla/rust/pull/12235
[08:06:56] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[08:06:56] *** ChanServ sets mode: +ao dherman dherman
[08:07:04] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[08:07:04] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14bbff975 to 1458eeb07: 02http://git.io/N3iJvQ
[08:07:04] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[08:07:05] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[08:07:05] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/7up-cg
[08:07:05] <ghrust> 13rust/06auto 144f72c01 15Matthijs van der Vleuten: doc: rename 'nil' to 'unit' when describing `()`
[08:07:05] <ghrust> 13rust/06auto 1464a2fea 15bors: auto merge of #12210 : zr40/rust/patch-1, r=cmr...
[08:07:06] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[08:07:22] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[08:08:36] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Ping timeout)
[08:09:09] *** Joins: Jesse_ (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[08:09:17] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Ping timeout)
[08:10:51] *** Quits: Jesse_ (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Connection reset by peer)
[08:10:55] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[08:12:59] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Ping timeout)
[08:13:19] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[08:13:43] *** Quits: Blaze_ (tuomino2@moz-785A3407.org.aalto.fi) (Ping timeout)
[08:16:43] *** Quits: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Ping timeout)
[08:17:08] *** Joins: Blaze_ (tuomino2@moz-785A3407.org.aalto.fi)
[08:17:27] *** Joins: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[08:20:18] <flaper87> I think my english is even worse this morning. Not sure what acrichto meant here: https://github.com/mozilla/rust/pull/12017#issuecomment-34934147 I mean, I can't emit an error because it would fail, is he suggesting to just hide the note until we can actually emit the error ?
[08:20:50] <flaper87> s/it would fail/it would make the compilation fail/
[08:23:00] <huon> flaper87: I think he means just don't bother emitting anything for extern mod until a snapshot
[08:23:03] <huon> and then emit an error
[08:23:15] <huon> rather than having an intermediate note-emitting pahse
[08:23:35] <flaper87> huon: ok, thanks a lot
[08:23:40] <flaper87> I'll get rid of that note
[08:42:26] <flaper87> huon: thanks for the review :)
[08:45:47] <Yurume> is it a known problem that -Z lto doesn't work in Windows?
[08:46:10] <Yurume> (tried to find the related issue to get the status quo and failed)
[08:46:43] <huon> Yurume: if there's no issue then it's unknown
[08:46:50] <Yurume> hmm!
[08:52:10] *** Joins: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP)
[08:52:10] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/PHj60A
[08:52:10] <ghrust> 13rust/06auto 1430a25a9 15Seo Sanghyeon: Resolve type variables when checking casting to char
[08:52:10] <ghrust> 13rust/06auto 148ee7186 15bors: auto merge of #12211 : sanxiyn/rust/issue-9918, r=pcwalton...
[08:52:11] *** Parts: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP) ()
[08:54:13] *** Quits: eddyb (eddy@688E9026.F7C96DA2.FCAAE698.IP) (Ping timeout)
[09:00:05] *** Joins: eddyb (eddy@688E9026.F7C96DA2.FCAAE698.IP)
[09:00:17] *** Quits: ktt3ja (ktt3ja@moz-85E2770C.hsd1.va.comcast.net) (Quit: Leaving)
[09:02:43] *** Quits: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com) (Client exited)
[09:03:11] *** Quits: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP) (Ping timeout)
[09:06:03] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[09:08:02] *** Joins: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP)
[09:09:23] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[09:11:19] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Ping timeout)
[09:16:08] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[09:17:03] *** Joins: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com)
[09:18:28] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[09:18:39] *** Quits: sigma (sigma@moz-B2E77065.range86-184.btcentralplus.com) (Client exited)
[09:22:07] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[09:22:28] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[09:24:09] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[09:27:12] *** Joins: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP)
[09:27:12] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 148ee7186 to 1458eeb07: 02http://git.io/N3iJvQ
[09:27:12] *** Parts: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP) ()
[09:27:13] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[09:27:13] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/ZfXygw
[09:27:13] <ghrust> 13rust/06auto 14c4c9eda 15Alex Crichton: extra: Capture stdout/stderr of tests by default...
[09:27:13] <ghrust> 13rust/06auto 147b348bf 15bors: auto merge of #12215 : alexcrichton/rust/test-stdout-capture, r=brson...
[09:27:13] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[09:31:20] *** Joins: Zr40 (zr40@moz-CCFEAB92.adsl.xs4all.nl)
[09:34:29] *** Joins: rca (rcatolino@moz-CFD59DD6.adsl.proxad.net)
[09:40:33] *** Joins: eibwen (kvirc@moz-2A1E42F9.dip0.t-ipconnect.de)
[09:43:56] *** Joins: rca_ (rcatolino@moz-FC4DC909.adsl.proxad.net)
[09:44:37] *** Quits: rca (rcatolino@moz-CFD59DD6.adsl.proxad.net) (Ping timeout)
[09:44:44] <eddyb> png load 'test/mozilla-dinosaur-head-logo.png': 1139585460 ns/iter (+/- 38641083)
[09:44:56] <eddyb> that took minutes...
[09:45:38] <eddyb> huon: when you fixed the bench runner for slow benchmarks... didn't you do something to make it run less times?
[09:46:11] <eddyb> I remember slower benchmarks taking < 60s to run fully
[09:52:26] <eddyb>  88,82%  png-inflate  png-inflate         [.] inflate::InflateStream::run_len_dist::h0749685d29ab02a1::v0.1
[09:52:36] <eddyb> err, wrong channel
[09:54:58] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[09:57:09] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[09:57:09] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/M18IEA
[09:57:09] <ghrust> 13rust/06auto 145f79bd4 15Alex Crichton: Include compiler-rt in the distribution tarballs
[09:57:09] <ghrust> 13rust/06auto 14c0d2b81 15bors: auto merge of #12217 : alexcrichton/rust/dist-compiler-rt, r=brson
[09:57:10] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[09:57:11] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[09:57:11] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 147b348bf to 1458eeb07: 02http://git.io/N3iJvQ
[09:57:11] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[10:00:45] <huon> eddyb: no, it runs 50 times to begin
[10:00:53] <huon> so that's gonna take rather a long time :P
[10:08:21] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[10:08:21] *** ChanServ sets mode: +ao dherman dherman
[10:08:23] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[10:09:58] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Connection reset by peer)
[10:10:12] *** Joins: Jesse_ (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[10:10:15] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Ping timeout)
[10:12:06] *** Quits: Jesse_ (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Ping timeout)
[10:13:15] *** Joins: sanxiyn (tinuviel@B4104EBB.3CC170B1.1E14B209.IP)
[10:13:34] <sanxiyn> What's going on on the queue?
[10:14:01] <huon> sanxiyn: android is unhappy
[10:14:11] <sanxiyn> Why?
[10:14:31] <huon> no idea
[10:17:15] *** Quits: sanxiyn (tinuviel@B4104EBB.3CC170B1.1E14B209.IP) (Quit: Leaving)
[10:22:37] *** Joins: doener (bs@moz-AA189A5A.unitymedia.biz)
[10:32:09] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[10:32:09] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/EXflXg
[10:32:09] <ghrust> 13rust/06auto 141cf76f9 15lpy: return value/use extra::test::black_box in benchmarks
[10:32:09] <ghrust> 13rust/06auto 140d5db1a 15bors: auto merge of #12212 : lpy/rust/issue12118, r=huonw...
[10:32:10] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[10:32:12] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[10:32:12] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14c0d2b81 to 1458eeb07: 02http://git.io/N3iJvQ
[10:32:12] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[10:45:06] *** Joins: doomlord_ (servitor@moz-9B2006BF.range109-151.btcentralplus.com)
[10:56:50] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[11:02:12] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[11:02:12] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Xv0Xjw
[11:02:12] <ghrust> 13rust/06auto 14e4688d5 15Felix S. Klock II: Remove a source of O(n^2) running time in bigints....
[11:02:12] <ghrust> 13rust/06auto 14e9bb975 15bors: auto merge of #12209 : pnkfelix/rust/fsk-bigint-perf-improvements, r=huonw...
[11:02:13] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[11:05:38] <nmatsakis> eddyb: sorry :)
[11:05:45] <nmatsakis> I know I promised.
[11:06:32] <eddyb> don't be sorry, I'm currently working on the inflate stuff. there's a chance of beating zlib at this
[11:09:36] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[11:11:19] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Ping timeout)
[11:16:08] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[11:18:30] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[11:19:52] *** Quits: zimbabao (rajaram@47769425.AE842F9B.81C3DAA1.IP) (Ping timeout)
[11:22:08] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[11:22:08] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14e9bb975 to 1458eeb07: 02http://git.io/N3iJvQ
[11:22:08] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[11:22:09] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[11:22:09] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/fwu57w
[11:22:09] <ghrust> 13rust/06auto 144f8f577 15Brendan Zabarauskas: Add some missing Show implementations in libstd
[11:22:09] <ghrust> 13rust/06auto 144111a7a 15bors: auto merge of #12218 : bjz/rust/show, r=alexcrichton
[11:22:10] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[11:38:08] <eibwen> how cheap are function calls?
[11:38:32] <eddyb> they vary
[11:38:44] <eddyb> strcat could tell you stories but he's not around
[11:39:47] <huon> eibwen: the function calls themselves are so cheap that you rarely have to worry
[11:40:32] <huon> however a function call that isn't inlined can stop some/many optimisations (like constant propagation)
[11:41:22] <eibwen> that leads me to the following question: does the rustc compiler inline on its own? or only #[inline]d functions?
[11:41:26] <Zr40> if I don't use #[inline], will it still consider inlining small enough functions?
[11:41:34] <eibwen> ^
[11:41:54] <eddyb> rustc barely does anything optimization-related
[11:42:22] <eibwen> kay
[11:42:22] <huon> Zr40: yes
[11:42:23] <eddyb> however, non-generic functions are not *instantiated* across crates without #[inline] on them
[11:42:33] <huon> Zr40: but only within a single crate
[11:42:40] <huon> (it's current crate)
[11:42:43] <huon> if it's not generic
[11:42:48] <Zr40> huon: right. So -Z lto doesn't affect that?
[11:42:50] <eddyb> and without instantiation, LLVM can't see the body of the function (without LTO)
[11:42:56] <huon> Zr40: it does affect taht
[11:43:16] <huon> Zr40: -Z lto is basically "make literally everything available for inlining"
[11:44:02] <huon> eibwen: but, yes, the rust compiler uses LLVM, which does inline functions on its own
[11:44:38] <huon> (it normally does a reasonable job, and #[inline] actually overrides its heuristics somewhat, and so can be a pessimisation sometimes.)
[11:45:12] <eibwen> I just wondered because I usually see #[inline] all over the place
[11:49:37] <nmatsakis> eddyb: btw I'm like 50% through your patch, hopefully finish the rest soon
[11:49:48] <nmatsakis> eddyb: it would be really helpful if you had separated out the rote changes like token::get_ident()
[11:49:52] <nmatsakis> eddyb: from the "meat" of the patch :)
[11:49:54] <huon> eibwen: it's normally just to get cross-crate inlining
[11:49:56] <nmatsakis> eddyb: (but I know you know this)
[11:51:04] *** Quits: carter (carter@moz-58F59B3A.members.linode.com) (Ping timeout)
[11:51:53] <eddyb> nmatsakis: make-this-compile-ASAP + OCD fixes don't mix well
[11:55:37] *** Joins: carter (carter@moz-58F59B3A.members.linode.com)
[11:57:06] *** Joins: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP)
[11:57:07] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 144111a7a to 1458eeb07: 02http://git.io/N3iJvQ
[11:57:07] *** Parts: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP) ()
[11:57:07] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[11:57:07] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/nBk2Fg
[11:57:07] <ghrust> 13rust/06auto 142afb769 15Tobias Bucher: Add documentation for conditional-compilation...
[11:57:07] <ghrust> 13rust/06auto 14d8e19e7 15bors: auto merge of #12220 : tbu-/rust/pr_doc_condb, r=alexcrichton...
[11:57:08] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[12:04:14] *** Quits: rca_ (rcatolino@moz-FC4DC909.adsl.proxad.net) (Ping timeout)
[12:08:49] <pnkfelix> have any of the recent bors merges succeeded?  It seems not for at least 13 hours... how many attempts have failed...
[12:09:17] *** Joins: jdm (jdm@2A21C64.CCE87F86.DDC6F5D1.IP)
[12:09:24] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[12:10:02] <acrichto> pnkfelix: no they're all failing in some android bug
[12:11:19] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Ping timeout)
[12:11:49] <pnkfelix> acrichto: this one was win32 https://github.com/mozilla/rust/pull/12209#commitcomment-5364056 but maybe it just happened before the android bug kicked in.
[12:12:58] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[12:13:15] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[12:14:39] *** Joins: zimbabao (rajaram@12AD50AC.C73AA635.D2D1FAF0.IP)
[12:14:56] <eddyb> huon: copying 8 bytes at once doesn't help
[12:15:09] <eddyb> *dst = *src; ... *dst.offset(7) = *src.offset(7);
[12:15:15] <acrichto> pnkfelix: hm yeah that was the only non-android one I saw, but there were a bunch of android failures before that
[12:15:30] <pnkfelix> acrichto: yeah I think the android problem sounds more pressing
[12:15:37] <pnkfelix> acrichto: (and/or more repeatable...)
[12:15:40] <acrichto> they're probably the same thing
[12:15:43] <nmatsakis> eddyb: (I have this tendency to intermix too, we all do -- if nothing else, you can usually use "git add -i" to pre-sort the hunks...)
[12:15:48] <acrichto> repeating android is incredibly difficult :\
[12:15:50] <nmatsakis> acrichto: you're awake?
[12:16:02] <acrichto> flying from SFO to pittsburgh on a red-eye
[12:16:06] <acrichto> currently sitting in chicago
[12:16:11] <acrichto> I *shouldn't* be awake
[12:16:13] <pnkfelix> acrichto: ugh
[12:16:47] <nmatsakis> acrichto: did we file a bug regarding converting from let to match in debug! macros etc
[12:16:56] <acrichto> nmatsakis: just did
[12:17:06] <acrichto> https://github.com/mozilla/rust/issues/12239
[12:17:25] <nmatsakis> cool
[12:17:32] <acrichto> is that what you were thinking?
[12:17:43] <eddyb> nmatsakis: I use git gui, I guess I could've created a different PR and rebase the ast_map one on top of that one, but making sure that compiles would take even longer
[12:18:21] <eddyb> oh, interesting... it.clone().len() is not O(1) for a vec::Items
[12:18:38] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[12:18:40] <eddyb> it ends up in a tight loop
[12:18:58] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[12:18:59] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[12:18:59] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[12:19:03] <nmatsakis> acrichto: yep
[12:19:09] <acrichto> nmatsakis: cool
[12:19:22] <nmatsakis> pnkfelix: chat this morning in a couple of hours?
[12:19:39] <eddyb> huon: couldn't vec::Items replace .len() to be O(1) (consume the iterator and return the length)?
[12:19:52] <huon> eddyb: maybe
[12:20:08] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[12:20:16] <eddyb> I would like .clone().len() to be O(1) for random access iterators, since it's a nice trick
[12:20:42] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[12:20:42] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[12:20:45] <pnkfelix> nmatsakis: Sure.  My only constraints: i have a call in ~3.5 hours (and then triage in ~5.5 hours).  
[12:20:59] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[12:21:00] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[12:22:26] <nmatsakis> grr triage is not on my calendar
[12:22:32] <nmatsakis> probably invited my alum addr
[12:29:22] <eddyb> does anyone know if unaligned uint-sized loads/stores are faster than byte-by-byte loads/stores?
[12:29:54] <cmr> eddyb: I imagine they're probably equally slow.
[12:30:06] <eddyb> :/
[12:30:31] <cmr> although post sandy bridge, unaligned access doesn't have much penalty.
[12:31:14] <eddyb> https://github.com/madler/zlib/blob/master/inffast.c
[12:32:14] *** Joins: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP)
[12:32:14] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/LJGfIA
[12:32:14] <ghrust> 13rust/06auto 1436bf5b9 15Alex Crichton: Register new snapshots
[12:32:14] <ghrust> 13rust/06auto 1425fe599 15bors: auto merge of #12222 : alexcrichton/rust/snapshots, r=kballard
[12:32:15] *** Parts: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP) ()
[12:32:16] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[12:32:16] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d8e19e7 to 1458eeb07: 02http://git.io/N3iJvQ
[12:32:16] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[12:32:59] *** Joins: rca (rcatolino@moz-FC4DC909.adsl.proxad.net)
[12:33:33] <cmr> (and keep in mind that unaligned accesses aren't allowed on ARM)
[12:35:56] <eddyb> looks like inflate_fast does something similar to what I did, for longer codes
[12:42:34] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[12:47:25] *** Joins: canhtak (canhtak@moz-4D8F0D46.wl.t.ulaval.ca)
[12:48:06] <eddyb> not sure why LLVM moves the addition back into the loop
[12:49:25] <eddyb> mov    0x6(%rsi,%rbx,1),%cl; mov    %cl,0x6(%rsi,%r15,1)
[12:51:26] <eddyb> I don't see zlib doing anything fancy
[12:52:18] *** Quits: rca (rcatolino@moz-FC4DC909.adsl.proxad.net) (Ping timeout)
[12:53:16] <huon> eddyb: are you using .offset or .unsafe_ref?
[12:53:19] <cmr> huon: so are you no longer dbaupp?
[12:53:24] <eddyb> huon: .offset
[12:53:26] <huon> cmr: correct
[12:53:37] <cmr> huon: that's unfortunate, huon isn't colored as pleasantly in my IRC client ;P
[12:53:44] <eddyb>  16,92%  png-inflate  libc-2.18.so        [.] memset
[12:53:53] <eddyb> cmr, huon: both of you are red
[12:54:04] <eddyb> dbaupp was light blue, I think
[12:54:14] <huon> I used to be purpleish
[12:54:19] <huon> cmr: get a better client :P
[12:54:28] <huon> now I'm light green
[12:55:25] *** Joins: rca (rcatolino@moz-7FACA309.adsl.proxad.net)
[12:56:23] <flaper87> acrichto: done :)
[12:59:41] <pnkfelix> huon: why the nick change?
[13:00:22] <huon> pnkfelix: one too many people came in from github asking for huonw
[13:00:50] <eddyb> ohh, changing the loop condition makes for better codegen :D
[13:01:12] <huon> pnkfelix: also good point about https://github.com/mozilla/rust/issues/12242 , I those examples without even thinking about it
[13:01:29] <pnkfelix> huon: I didn't want to single you out or anything
[13:01:34] <huon> pnkfelix: lastly, are you going to be submitting (m)any more bigint fixes in the near future?
[13:02:33] <huon> pnkfelix: nah, it's fine; in hindsight, it's obviously a poor way to write a tutorial but rust-style is too strong a habit, apparently :)
[13:03:01] <pnkfelix> huon: I might hack on it again this weekend.  The main other thing that seemed to be a win when I looked on Sunday was to add something analogous to `x op= y` for op in {+, -, etc}, where it reuses x's internal digits vec rather than reallocating, and then changing the loops that did repeated subtraction to use that.
[13:03:59] <huon> yeah, I experimented with something along those lines too, it required changing the definition of cmp too, but I never quite got it working well enough to pass tests
[13:04:19] <pnkfelix> huon: but that diff was mixed in with a bunch of other experiments (e.g. changing bigint to an enum { U0([digit, ..0]), U1([digit, ..1]), U2([digit, ..2]), Un(~[digit]) }, so I did not isolate it to its own patch
[13:04:30] <huon> I did find rewriting the from_fn loops in add and sub to use iterators gave me a 10-20% speed-up
[13:04:31] <pnkfelix> sed -e s/bigint/biguint/
[13:04:45] <pnkfelix> huon: that's interesting.  I cannot remember if I tried that or not
[13:05:25] <huon> that change left BigUint.clone() at the top of the profile with 15% of the time
[13:05:44] <huon> so I guess using in-place operators is the fix there
[13:05:52] <pnkfelix> huon: yes I think so.
[13:06:20] <pnkfelix> huon: the otehr thing I was thinking of doing
[13:06:33] <pnkfelix> huon: was comparing against the way Larceny implements its bignums
[13:06:52] <pnkfelix> huon: (in terms of structuring the code)
[13:07:05] <cmr> has anyone looked at what julia does?
[13:07:31] <pnkfelix> huon: but I don't think a broad revision is a great plan for the short term.  I'd prefer isolated changes that are obviously semantics preserving, if possible.
[13:09:09] <huon> cmr: use GMP?
[13:09:34] <cmr> oh
[13:10:00] <huon> cmr: (I haven't actually checked, but it seems like the only sensible option for something focusing on numerical work)
[13:10:16] <pnkfelix> huon: Well, unless its a commercial product...
[13:10:21] <huon> cmr: https://github.com/JuliaLang/julia/blob/master/base/gmp.jl
[13:10:37] <pnkfelix> huon: (but I'd rather not stir the GMP pot again...)
[13:10:57] <eddyb> is .push(x) on Vec<T> guaranteed to not modify capacity when it fits?
[13:11:28] <huon> pnkfelix: heh, yup. (However, it appears that julia is MIT but includes GMP)
[13:11:31] <huon> eddyb: yes
[13:11:47] <eddyb> sweet, one more feature I can add :D
[13:11:59] <huon> eddyb: https://github.com/mozilla/rust/blob/master/src/libstd/vec_ng.rs#L126
[13:12:05] <eddyb> and there's no need for memset anymore
[13:12:38] <pnkfelix> huon: yeah, I see, GMP is an external library from their POV ?
[13:13:00] <huon> pnkfelix: seems like it
[13:13:37] <eddyb> I guess this code will go into rust-zlib. I also have the zlib FFI wrapper, I only need some test files... I guess I can implement GZIP headers and use gz files
[13:13:37] <huon> pnkfelix: btw, does Larceny have notably high-performance bigints?
[13:13:48] <eddyb> huon: hehe: import Base: *, +, -, /, <, <<, >>, >>>, <=, ==, >, >=, ^, (~), (&), (|), ($),
[13:13:59] <eddyb> "life without prelude"
[13:14:07] <pnkfelix> huon: well, GMP still beats it when the number of digits is significantly large
[13:14:24] <huon> pnkfelix: that goes without saying :)
[13:14:28] <pnkfelix> huon: but my memory is that the threshold where that occurs is pretty high
[13:14:44] <pnkfelix> huon: will clinger and I discussed this some time back
[13:15:05] <pnkfelix> huon: in terms of whether we should invest effort in some of the more advanced algorithms for sufficiently large numbers
[13:15:34] <huon> pnkfelix: (another thing I noticed looking at the top C program: it multiplies by an uint directly, no allocating a number for the * ten and * k multiplies)
[13:16:08] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[13:16:10] <eddyb> oh yeah, we need specialization for that, it's a pretty good thing to have
[13:16:25] <eddyb> impl Mul<uint, BigInt> for BigInt
[13:16:47] <eddyb> gotta fix multiple trait implementations with different type params
[13:17:10] *** Joins: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP)
[13:17:10] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1425fe599 to 1458eeb07: 02http://git.io/N3iJvQ
[13:17:10] *** Parts: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP) ()
[13:17:11] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[13:17:11] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/lyXjOA
[13:17:11] <ghrust> 13rust/06auto 147ab5911 15Flavio Percoco: Replace `crate` usage with `krate`...
[13:17:11] <ghrust> 13rust/06auto 147c4424f 15Flavio Percoco: Replace `extern mod` with `extern crate`...
[13:17:12] <ghrust> 13rust/06auto 14d418b7d 15Flavio Percoco: Remove obsolete warnings for `extern mod`...
[13:17:14] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[13:17:18] <huon> eddyb: .mul_uint(n: uint) works too :P
[13:17:34] <eddyb> we have traits... *sigh*
[13:18:27] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[13:22:12] <eddyb> hah, I don't even need the buffer to have a capacity that is a power of two
[13:24:52] <pnkfelix> huon: actually, maybe I am mistaken about how competitive Larceny is.  Will spent some time bumming the code back some years back, https://github.com/larcenists/larceny/issues/414
[13:25:49] <pnkfelix> huon: or rather https://github.com/larcenists/larceny/wiki/WhyBignumsAreSlow
[13:28:16] <pnkfelix> huon: (but the data in the charts there might *precede* some of the changes Will made, e.g. to switch to Karatsuba's algorithm)
[13:33:04] <huon> pnkfelix: from my reading of that it looks like FFI-like concerns are a significant factor too? (which is not a problem for us, and so it may be a reasonable model for us to follow, initially at least)
[13:33:23] *** kimundi is now known as zz_kimundi
[13:33:39] <pnkfelix> huon: yeah, I was just reviewing the notes I had made about the FFI issues there (namely the allocation call) 
[13:34:37] *** Joins: edwardw (Mibbit@E761717E.1B2F6624.7F41E82D.IP)
[13:35:37] <pnkfelix> huon: Anyway, it may or may not be a useful design to look at.  I just remember looking at how the code was structured, where it shifts to a bigit-vector POV at outset and only tags the data as a bignum again at the end, and I wondered whether that would yield a clearer presentation for us.
[13:36:08] <huon> pnkfelix: another possibility is Go's math/big, since it's only 2x slower than the fastest C program on pidigits, and I'd expect Rust code to be faster than Go code by default (given we have an optimising compiler)
[13:36:28] <pnkfelix> huon: let me go look at that.
[13:36:44] <huon> it may be written in C/asm internally, I haven't looked in detail
[13:37:17] <pnkfelix> huon: can we adapt BSD-licensed stuff and put it under our MIT/Apache license?
[13:37:25] <huon> don't know
[13:38:12] <pnkfelix> huon: anyway, you opened by asking if I was planning to put up any PR's against bigint.  Why do you ask, were you thinking of hacking on it?
[13:38:13] <cmr> I think we can.
[13:38:32] <cmr> I remember asking brson about it, at the very least.
[13:40:41] <huon> pnkfelix: I've been experimenting a little with bits and pieces, so just wanted to know if I should wait before making any attempt to get it into a PR-able state.
[13:41:13] <pnkfelix> huon: no, don't wait for me.  Anything I actually do with an intent to land will be isolated simple patches that should be hopefully easy to rebase
[13:41:47] <pnkfelix> huon: (and if it turns out that you end up doing a global rewrite, well, them's the breaks for me.  ;) )
[13:42:12] <huon> pnkfelix: src/etc/licenseck.py includes some exceptions for BSD licensed things, so it seems to be ok
[13:42:31] <huon> heh, I'm not going to be doing a global rewrite in the near future, don't worry about that
[13:43:07] <pnkfelix> huon: okay, I see, great, good to see that there are documented exceptions.
[13:47:11] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[13:47:11] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14ee34073 to 1458eeb07: 02http://git.io/N3iJvQ
[13:47:11] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[13:47:13] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[13:47:13] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/oF5XwA
[13:47:13] <ghrust> 13rust/06auto 14da73827 15Huon Wilson: std::comm: replace Handle.id with a method....
[13:47:13] <ghrust> 13rust/06auto 1473f4619 15bors: auto merge of #12225 : huonw/rust/handle-id, r=alexcrichton...
[13:47:13] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[13:48:10] *** Quits: jdm (jdm@2A21C64.CCE87F86.DDC6F5D1.IP) (Quit: Lost terminal)
[13:51:20] *** Quits: wycats (sid79@moz-5F4AA75A.irccloud.com) (Ping timeout)
[13:58:58] <nmatsakis> eddyb: just r+'d your ast_map patch
[13:59:06] <eddyb> thanks :)
[13:59:15] <nmatsakis> I had one question tho
[13:59:23] <nmatsakis> you had various methods that took closures like with_path()
[13:59:29] <nmatsakis> it wasn't clear to me why that should be necessary
[13:59:37] <nmatsakis> it seems like you could return an iterator
[13:59:48] <eddyb> the iterator is constructed on the stack :)
[14:00:04] <nmatsakis> I think you could return it, though
[14:00:12] <nmatsakis> maybe i'm missing something, have to look again
[14:00:24] <eddyb> in reverse order, starting from the node itself, and adding one parent at a time, as it recurses
[14:00:32] *** Quits: mawuli (mawuli@moz-5ADAB167.com.gh) (Ping timeout)
[14:00:46] <eddyb> I need one function scope per linked list node
[14:00:47] <nmatsakis> ah, wait, I see
[14:01:05] <nmatsakis> because you otherwise would need a stack in memory and not on the stack
[14:01:06] <nmatsakis> ok
[14:01:36] <pnkfelix> huon: ping
[14:03:13] <pnkfelix> huon: nm
[14:07:21] *** Quits: canhtak (canhtak@moz-4D8F0D46.wl.t.ulaval.ca) (Quit: canhtak)
[14:10:13] *** Quits: zimbabao (rajaram@12AD50AC.C73AA635.D2D1FAF0.IP) (Connection reset by peer)
[14:11:05] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[14:11:08] <nmatsakis> pnkfelix: ping
[14:11:34] <eddyb> nmatsakis: 2h => 1d => 2d => 3w?
[14:11:44] <eddyb> though the last one is an overestimation
[14:11:57] <nmatsakis> eddyb: I used to know a guy who said, to get an accurate estimate, double the number and up the unit
[14:12:00] <nmatsakis> eddyb: 2h => 4 days
[14:12:13] <eddyb> not bad
[14:13:02] <pnkfelix> nmatsakis: pong
[14:13:25] <nmatsakis> pnkfelix: I'm around now, whenever you want to chat
[14:13:45] <pnkfelix> nmatsakis: okay let me migrate to isolated area.
[14:15:27] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Ping timeout)
[14:15:59] <cmr> you know you were tired when you have 5 typos in as many lines of code.
[14:18:03] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[14:18:53] <pnkfelix> nmatsakis: k i'm hanging in your vidyo room
[14:19:53] <nmatsakis> pnkfelix: coming.
[14:24:33] *** Joins: canhtak (canhtak@moz-4D8F0D46.wl.t.ulaval.ca)
[14:26:44] *** Joins: zimbabao (rajaram@805776ED.C59C8B9A.D2D1FAF0.IP)
[14:32:18] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[14:32:19] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1473f4619 to 1458eeb07: 02http://git.io/N3iJvQ
[14:32:19] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[14:44:41] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[14:45:24] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[14:46:55] *** Quits: edwardw (Mibbit@E761717E.1B2F6624.7F41E82D.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[14:47:17] *** Joins: edwardw (Mibbit@E761717E.1B2F6624.7F41E82D.IP)
[14:50:42] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Ping timeout)
[14:51:00] *** zz_kimundi is now known as kimundi
[14:51:17] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[14:52:30] *** Joins: larsberg (larsberg@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net)
[15:00:06] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[15:00:57] *** Quits: edwardw (Mibbit@E761717E.1B2F6624.7F41E82D.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[15:01:02] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Connection reset by peer)
[15:01:38] *** Joins: edwardw (Mibbit@E761717E.1B2F6624.7F41E82D.IP)
[15:02:15] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[15:02:15] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1424a5745 to 1458eeb07: 02http://git.io/N3iJvQ
[15:02:15] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[15:02:16] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[15:02:16] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/rLxFxg
[15:02:16] <ghrust> 13rust/06auto 14ad69b1f 15Alex Crichton: Relax an assertion in start_selection()...
[15:02:16] <ghrust> 13rust/06auto 14881741e 15bors: auto merge of #12227 : alexcrichton/rust/chan-select-bug, r=kballard...
[15:02:17] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[15:03:27] *** Quits: zimbabao (rajaram@805776ED.C59C8B9A.D2D1FAF0.IP) (Ping timeout)
[15:07:11] <eddyb>     [run-pass] run-pass/issue-9188.rs
[15:07:18] <eddyb> but it worked fine in try...
[15:11:59] *** Joins: wycats (sid79@moz-5F4AA75A.irccloud.com)
[15:14:12] <eddyb> ooh, I did screw up. the two symbols names are now identical
[15:16:10] *** Joins: erickt_ (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[15:18:37] *** Quits: erickt_ (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[15:20:35] <eddyb> why would I compare with 1 and not 0? no idea how I've made that mistake
[15:21:56] *** Quits: Kxepal (Miranda@moz-9E323D1A.pppoe.mtu-net.ru) (Ping timeout)
[15:25:19] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[15:30:57] <eddyb> r=nmatsakis? https://github.com/mozilla/rust/pull/12162 (fixed the bogus condition)
[15:32:39] <nmatsakis> eddyb: done.
[15:33:29] <eddyb> right, you're around :)
[15:37:12] *** Joins: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP)
[15:37:12] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/E231uQ
[15:37:12] <ghrust> 13rust/06auto 146cba0c1 15Eduard Burtescu: Refactored ast_map and friends, mainly to have Paths without storing them.
[15:37:12] <ghrust> 13rust/06auto 142450c5a 15bors: auto merge of #12162 : eddyb/rust/ast-map-cheap-path, r=nikomatsakis
[15:37:13] *** Parts: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP) ()
[15:37:16] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[15:37:16] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14881741e to 1458eeb07: 02http://git.io/N3iJvQ
[15:37:16] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[15:37:29] <nmatsakis> bors must be bored.
[15:43:00] *** Joins: aurynj (Eon@BF507CFB.1CEEC774.4C51A5AE.IP)
[15:43:14] *** kimundi is now known as zz_kimundi
[15:44:45] *** zz_kimundi is now known as kimundi
[15:45:23] *** Joins: Kxepal (Miranda@moz-D87D4BA.pppoe.mtu-net.ru)
[15:48:17] <eddyb> https://github.com/mozilla/rust/pull/12237 sweet
[15:48:44] <cmr> much good
[15:52:01] <eddyb> pfft, my fix might not be working
[15:55:51] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[15:57:02] *** Joins: zimbabao (rajaram@891F4AA0.E11C2288.D2D1FAF0.IP)
[16:00:32] <eddyb> hah, but why does the test pass?
[16:00:39] * eddyb is a bit confused
[16:00:47] <cmr> test passes, :shipit:
[16:01:29] <eddyb> cmr: I identified a difference, tried to correct it, the test passes now but the difference is still there
[16:01:47] <cmr> :shipit:
[16:02:06] <eddyb> cmr: bors is taking care of that
[16:02:14] <cmr> \o/
[16:03:38] <nmatsakis> eddyb: what difference exactly?
[16:04:07] <eddyb> src/test/auxiliary/issue_9188.rs has two foo::a symbols
[16:04:25] *** Quits: doener (bs@moz-AA189A5A.unitymedia.biz) (Quit: leaving)
[16:04:29] <eddyb> stage0 names them @foo::a::h3c4b5c0e669126a8ak::v0.0 and @foo::a::h3c4b5c0e669126a8au::v0.0
[16:05:04] <eddyb> while stage1 uses @foo::a::h3c4b5c0e669126a8::v0.0 for both
[16:05:15] <acrichto> eddyb: I explicitly added that test for that reason
[16:05:20] <acrichto> they need different names
[16:05:33] <acrichto> it comes up in format strings a lot as well
[16:06:02] <acrichto> eddyb: did you remove the path_pretty_name ?
[16:06:05] <acrichto> or whatever it was called
[16:06:09] <eddyb> try with xfail succeeded :/
[16:06:12] <eddyb> acrichto: yupp
[16:06:23] <eddyb> thought I don't see how that would be relevant in this case, there's no impl
[16:06:24] <acrichto> I don't think you can remove that for this reason
[16:06:31] <acrichto> same-name statics in different scopes need different symbols
[16:06:31] *** Joins: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net)
[16:06:41] * nmatsakis feels guilty for r+'ing something he didn't fully understand the purpose of
[16:06:57] <acrichto> there really needs to be an assertion in trans that we're not adding the same name twice
[16:07:06] <acrichto> llvm will silently rename symbols if you add the same one twice
[16:07:09] <nmatsakis> yeah
[16:07:10] <nmatsakis> it's a pain
[16:07:14] *** Joins: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP)
[16:07:14] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 142450c5a to 1458eeb07: 02http://git.io/N3iJvQ
[16:07:14] *** Parts: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP) ()
[16:07:15] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[16:07:15] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/FrZR_g
[16:07:15] <ghrust> 13rust/06auto 14d6e3722 15Huon Wilson: mk: make NO_REBUILD more forceful and more general....
[16:07:15] <ghrust> 13rust/06auto 141c1a95b 15bors: auto merge of #12237 : huonw/rust/norebuild++, r=alexcrichton...
[16:07:16] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[16:07:22] <nmatsakis> useful (on lLVM's part), when that's what you want :)
[16:07:25] <acrichto> this is also th ereason that our symbols change if you restructure the ast
[16:07:42] <acrichto> the node ids change and then the pretty_names for the statics all change
[16:07:50] <acrichto> there should be like a global counter per-function in theory
[16:07:50] <eddyb> statics don't have pretty names
[16:07:52] <nmatsakis> eddyb: so wait, the test passed but the problem is still there?
[16:08:11] <acrichto> they used to have some path component which factored in the ast::NodeId of the static
[16:08:13] <eddyb> only impls have those, and only because they were __extensions__ before
[16:08:13] <nmatsakis> acrichto: "pretty name" seems like a misnomer for something that embeds the node-id
[16:08:16] <acrichto> it generated 2 hex characters at the end
[16:08:22] <nmatsakis> acrichto: when reading that code, I thought it was some kind of pretty printer
[16:08:22] <acrichto> it's true
[16:08:25] <acrichto> it was an awful name on my part
[16:08:34] <nmatsakis> hence not being particularly worried about what it did :)
[16:08:40] <eddyb> acrichto: wait, something other than impls was using it?
[16:08:45] <acrichto> when we first transitioned to format!() there were dozens of bugs with symbol names
[16:08:55] <acrichto> eddyb: let me check
[16:09:27] <acrichto> eddyb: yeah PathPrettyName is what statics use
[16:09:34] <acrichto> statics inside of functions that is
[16:09:43] <eddyb> hang on
[16:09:45] <acrichto> they get a PathPrettyName where the identifier is the name and the hash is the node id
[16:09:46] <eddyb> http://buildbot.rust-lang.org/builders/auto-linux-64-nopt-t/builds/3316/steps/test/logs/stdio/text
[16:09:57] <eddyb> same failure, again, but I CNR locally
[16:10:15] <eddyb> test [run-pass] run-pass/issue-9188.rs ... ok
[16:10:35] <acrichto> that is a little odd....
[16:11:51] <eddyb> maybe the test isn't thorough enough
[16:12:08] <eddyb> PathPrettyName is a silly hack IMO
[16:12:10] <acrichto> there should be a whole bunch of tests for this...
[16:12:14] <acrichto> it is indeed
[16:12:25] <acrichto> this iwas from when I cleaned up our symbol names a long time ago
[16:12:41] <eddyb> can't we just put more things into the hash?
[16:12:57] <eddyb> we do have a hash...
[16:13:09] <acrichto> you need to hash the location relative to other statics in each function
[16:13:24] <acrichto> two statics with the same name need different symbols
[16:13:30] <acrichto> ah trans is where this happened
[16:13:36] <acrichto> it created the PathPrettyName for statics
[16:13:51] <eddyb> for all items, it seems
[16:14:07] <eddyb> there was no comment explaining it, I thought it was __extension__-related
[16:14:10] <acrichto> if you do any printing via format!() you should be seeing lots of weird bugs
[16:14:22] <acrichto> format!() generates lots of statics of the same name
[16:14:28] <eddyb> stage2 rustc compiles fine
[16:14:31] <acrichto> and then when inlined in other crates they all get mismatched and you get the wrong one
[16:14:41] <acrichto> there should be a whole bunch of tests for this...
[16:15:02] <eddyb> I don't think this is just about statics
[16:15:19] <eddyb> can't you get a similar situation with functions inside of functions?
[16:15:22] <acrichto> hm it also may be for same named functions inside of an ourter function
[16:15:23] <acrichto> yeah
[16:15:31] <acrichto> I swear I added tests for all this
[16:15:49] *** Quits: edwardw (Mibbit@E761717E.1B2F6624.7F41E82D.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[16:16:12] *** Joins: edwardw (Mibbit@96E7298D.3E260003.B9C6B12A.IP)
[16:17:13] <eddyb> acrichto: what if we hash the ID of the item as well?
[16:17:39] <eddyb> can't have duplicates of (NodeId, type)
[16:17:43] <acrichto> eddyb: that should do the trick, that's basicaly waht it was doing before
[16:17:53] <acrichto> except I wanted to touch as little code as possible
[16:17:57] <acrichto> this is also not at all what we should be doing
[16:18:07] <acrichto> symbol names should not be dependent on your location in the AST
[16:18:46] <eddyb> dupe resolution mechanic?
[16:18:58] <eddyb> doesn't sound simple
[16:19:22] <acrichto> yeah a true solution is not easy at all
[16:19:28] <acrichto> I'm fine with maintaining the hack we have now
[16:19:36] <eddyb> but generalizing it?
[16:19:41] <acrichto> our current story is that your library has a new ABI per sha commit on the git repo
[16:19:46] <acrichto> I think that'd be ok
[16:20:04] <nmatsakis> acrichto: it's unclear that there IS a better solution...unless we could assign each crate a UUID,
[16:20:12] <nmatsakis> and then hash with relative path + that UUID or something,
[16:20:26] <acrichto> this is only a problem with inner functions though
[16:20:27] <nmatsakis> otherwise it seems like we're bound for collisions? maybe I'm not understanding the full space
[16:20:31] <acrichto> you can have two inner functions of the same name
[16:20:38] <eddyb> this time I'll wait for the IR to say "fixed" before asking for r+
[16:20:38] <acrichto> otherwise you have the module system to guarantee uniqueness
[16:20:40] <nmatsakis> sure, but there is a path
[16:20:48] <acrichto> they'd have the same path though
[16:20:57] <acrichto> fn foo() { { fn a() {} } { fn a() {} } }
[16:20:57] <nmatsakis> ah I see,
[16:20:57] <nmatsakis> scoping
[16:20:59] <nmatsakis> yes yes
[16:21:12] <acrichto> they have different positions relative to the enclosing function though
[16:21:16] <acrichto> which I think is what we care about
[16:21:22] <nmatsakis> yeah we'd want to encode the actual blocks
[16:21:25] <acrichto> and that's the one where if you add a comment elsewhere they wont' change
[16:21:27] <nmatsakis> that is, it's not that we don't want to use the AST
[16:21:31] <nmatsakis> we just don't want to use the *node id*
[16:21:41] <acrichto> yeah that sums it up well
[16:21:53] <acrichto> argh I'm trying to reproduce this android failure
[16:21:59] <acrichto> I can't even get the tests to run :\
[16:21:59] <cmr> why not just a pseudo-path, path to their parent plus its name?
[16:22:24] <acrichto> we could even add a path element per scope
[16:22:28] <acrichto> ::s1::s2::s3
[16:22:31] <cmr> the symbol doesn't need to be exported, does it?
[16:22:36] <acrichto> or rather use that to factor into the hash
[16:22:39] <acrichto> some of them do
[16:22:46] <cmr> why?
[16:22:49] <acrichto> format strings in generic functions need to be exported
[16:22:58] <acrichto> when instantiating you link against hte format string in the upstream crate
[16:23:03] <acrichto> but you instantiate all the code for your crate
[16:23:14] <acrichto> the magic of reachability!
[16:23:14] <cmr> ah
[16:23:16] <cmr> what a pain.
[16:23:38] <eddyb> base::exported_name looks like a good insertion point
[16:23:43] <acrichto> man you should take a look at how we handle available_externally for statics
[16:23:48] <acrichto> it's godawful, but it works!
[16:25:33] <acrichto> brb, working on a bus apparently doesn't agree as much as working on a train with me
[16:25:48] <cmr> yikes
[16:29:46] *** Joins: arrdem (arrdem@moz-2E1DB1F9.ece.utexas.edu)
[16:29:55] *** Quits: Zr40 (zr40@moz-CCFEAB92.adsl.xs4all.nl) (Quit: leaving)
[16:31:02] <eddyb> acrichto: we were doing it wrong before... the first character would always be "a" because NodeId's are only 32 bits :P
[16:51:39] *** Joins: doener (doener@moz-C68F600D.unity-media.net)
[16:53:44] <eddyb> @foo::a::h3c4b5c0e669126a8al::v0.0 = constant i64 4
[16:53:50] <eddyb> @foo::a::h3c4b5c0e669126a8av::v0.0 = constant i64 5
[16:57:15] *** Quits: edwardw (Mibbit@96E7298D.3E260003.B9C6B12A.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[16:57:42] *** Joins: edwardw (Mibbit@96E7298D.3E260003.B9C6B12A.IP)
[16:58:24] *** Quits: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net) (Client exited)
[17:01:23] *** Quits: mrmonday (mrmonday@moz-C7DC1A73.lin.openzula.org) (Ping timeout)
[17:01:41] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Ping timeout)
[17:05:12] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[17:09:44] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Ping timeout)
[17:09:56] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[17:09:57] *** ChanServ sets mode: +ao pcwalton pcwalton
[17:10:17] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[17:12:15] <eddyb> nmatsakis, acrichto: https://github.com/mozilla/rust/pull/12162 I put back the unique-chars-from-id code and used for all symbols with an ID
[17:13:42] <eddyb> I actually rewrote it so instead of having a 10 bit hole between two characters, it can now handle 62 * 62 * 62 combinations, ~18 lowest bits of a NodeId
[17:15:06] <eddyb> std gets up to only about 2^17 nodes, so we're safe to say a collision can't occur unless you have two libstd's in one function. or something to that effect
[17:15:29] <cmr> heh
[17:15:43] <cmr> I suspect many other things would die before it got to that point..
[17:16:02] <eddyb> unlike previously, where two nodes at a node ID distance multiple of 62 would conflict
[17:16:10] *** Joins: erickt_ (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[17:17:14] <eddyb> (with --pretty expanded,identified, I can see a testcase being constructed for that scenario, albeit somewhat volatile)
[17:18:08] <bstrie> do we still have segmented stack stuff mucking things up?
[17:18:12] <cmr> no.
[17:18:19] <bstrie> so no more __morestack?
[17:18:29] <cmr> well
[17:18:31] <cmr> it's still there.
[17:18:32] *** Quits: erickt_ (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[17:18:34] <eddyb> don't we still use it for stack overflow checks?
[17:18:37] <cmr> but all it does is check stack size.
[17:18:44] <cmr> it doesn't actually do the segmented stack thing.
[17:18:56] <bstrie> ok, so it's just not going away for other reasons :)
[17:18:59] <bstrie> that's all I wanted to know
[17:20:55] *** Quits: canhtak (canhtak@moz-4D8F0D46.wl.t.ulaval.ca) (Quit: canhtak)
[17:21:54] <eddyb> no r=nmatsakis?
[17:22:41] <eddyb> well, it's in reverse lexicographic order, but who cares, rustfilt strips hashes anyways :P
[17:23:43] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[17:28:11] *** Joins: erickt_ (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[17:30:55] *** Quits: edwardw (Mibbit@96E7298D.3E260003.B9C6B12A.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[17:31:25] <eddyb> cmr: mind giving me an r=nmatsakis on https://github.com/mozilla/rust/pull/12162? it looks pretty good here
[17:32:12] <eddyb> git checkout parent/master works o_O
[17:32:20] <cmr> did you expect it not to?
[17:32:28] <eddyb> and compilation starts with libsyntax \o/
[17:32:36] <acrichto> eddyb: is there a comment about why node_id is also mangled?
[17:32:37] <cmr> ah
[17:32:48] <acrichto> oh yes, there is
[17:33:04] <eddyb> I should've done this every time instead of checking out the local master :/
[17:33:05] <bstrie> hahaha, what are these "oxidize:" lines in the output of make :P
[17:33:13] <eddyb> compile_and_link
[17:33:22] <bstrie> I approve
[17:36:44] <eddyb> nmatsakis: I wish trans::expr would be better fitted for returning SSA values :/
[17:43:15] *** Joins: canhtak (canhtak@moz-4D8F0D46.wl.t.ulaval.ca)
[17:44:12] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: rcirc on GNU Emacs 24.3.1)
[17:45:47] *** Quits: erickt_ (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[17:45:48] <eddyb> nmatsakis: any idea what's up in trans::meth::trans_trait_callee?     // Translate self_datum and take ownership of the value by converting to an rvalue.
[17:46:34] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[17:46:34] *** ChanServ sets mode: +ao pcwalton pcwalton
[17:46:49] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[17:47:59] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[17:49:10] <eddyb> let's assume we have tests for this and I won't break anything
[17:51:57] *** kimundi is now known as zz_kimundi
[17:53:04] *** Quits: benh (ben@moz-4A0366D2.org) (Ping timeout)
[17:56:50] *** Joins: benh (ben@moz-4A0366D2.org)
[18:01:21] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[18:02:57] *** Quits: doener (doener@moz-C68F600D.unity-media.net) (Quit: leaving)
[18:03:50] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:03:50] *** ChanServ sets mode: +qo brson brson
[18:05:02] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[18:05:17] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[18:05:34] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:05:34] *** ChanServ sets mode: +qo brson brson
[18:07:07] *** Joins: jensnockert (jensnocker@moz-60DC2EAC.mobileonline.telia.com)
[18:10:05] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[18:10:21] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: rcirc on GNU Emacs 24.3.50.1)
[18:12:34] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[18:14:28] *** zz_kimundi is now known as kimundi
[18:32:18] *** Joins: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP)
[18:32:18] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 141c1a95b to 1458eeb07: 02http://git.io/N3iJvQ
[18:32:18] *** Parts: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP) ()
[18:32:19] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[18:32:20] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/IKD4pA
[18:32:20] <ghrust> 13rust/06auto 144f72c01 15Matthijs van der Vleuten: doc: rename 'nil' to 'unit' when describing `()`
[18:32:20] <ghrust> 13rust/06auto 14cfb87f1 15bors: auto merge of #12210 : zr40/rust/patch-1, r=cmr...
[18:32:20] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[18:35:06] *** Quits: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Client exited)
[18:38:04] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[18:38:28] *** Quits: benh (ben@moz-4A0366D2.org) (Ping timeout)
[18:40:40] <eddyb> so we have &Trait, &mut Trait and ~Trait
[18:40:51] <cmr> indeed we do
[18:43:29] <eddyb> &Trait and &mut Trait shouldn't care about cleanups
[18:46:53] <eddyb> hang on, how come there's no r=nmatsakis on my PR?
[18:47:14] <eddyb> acrichto: I forgot to check right after you asked about the comment >_>
[18:47:28] *** Joins: benh (ben@moz-4A0366D2.org)
[18:52:13] <eddyb> cmr: please? https://github.com/mozilla/rust/pull/12162
[18:52:58] <cmr> eddyb: done
[18:53:12] <eddyb> you're a hero :)
[18:59:32] <nmatsakis> eddyb: what do you mean by "&Trait" doesn't care about cleanups? (just that dropping it has no effect? or some larger conclusion?)
[19:02:25] <eddyb> scheduled cleanups, yeah, dropping
[19:03:18] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: rcirc on GNU Emacs 24.3.50.1)
[19:04:37] <acrichto> brson: for the future, how'd you restart the android bot?
[19:04:41] <acrichto> it doesn't seem to have died so quickly
[19:04:46] <acrichto> so perhaps that was all it needed
[19:04:50] <eddyb> nmatsakis: I can't tell from just looking at the code whether I'll break ~self methods called on ~Trait
[19:05:38] *** Joins: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[19:07:09] *** Quits: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Connection reset by peer)
[19:07:24] *** Joins: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[19:09:25] *** Quits: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Ping timeout)
[19:12:19] <eddyb> need a snapshot for --emit=ir...
[19:14:09] <Luqman> also, is there any point in keeping -C android-cross-path ?
[19:14:18] <Luqman> we don't do that for any other target
[19:15:38] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[19:16:18] <brson> Luqman: should be genericized
[19:16:45] <brson> acrichto: i sshd into rustbuild@rust-android1.local, kill -9 emulator64-arm, then `emulator @test2 -no-window &`
[19:17:14] <brson> could possibly do this as part of the buildbot script
[19:18:43] <acrichto> brson: ok cool, look like it succeeded
[19:19:01] <acrichto> brson: thanks!
[19:19:29] <Eridius> is it safe to start retrying failed PRs?
[19:19:54] <acrichto> @bors: retry for everyone
[19:19:55] <acrichto> !
[19:19:57] <acrichto> I'll go through
[19:20:00] <acrichto> some of them are legit failures
[19:20:08] <Eridius> well I'm kicking off my own rustdoc one again then
[19:24:11] <eddyb> nmatsakis: one way to do this cleanly would be to zero out (to cancel cleanup) *after* loading the actual self and function pointers from *(vtable, data)
[19:24:53] <eddyb> without copying the tuple to an rvalue
[19:25:10] <eddyb> but then... what happens with the arg_clean_scope?
[19:26:43] <eddyb> I guess I'll have to put an if around the old code and use it only for ~Trait
[19:27:00] *** Joins: edwardw (Mibbit@96E7298D.3E260003.B9C6B12A.IP)
[19:28:33] <nmatsakis> eddyb: sorry I'm not sure precisely what prob you're trying to solve
[19:28:50] <eddyb> don't copy &Trait to a temporary alloca
[19:29:06] <eddyb> for every call to one of its methods
[19:31:28] <nmatsakis> right right, I was lazy ;)
[19:31:56] <nmatsakis> I considered having "if ~, do rvalue, else", I guess thats best for now anyway
[19:35:44] <eddyb> let's consider this done and move on to closures :D
[19:36:36] <eddyb> hmm, those look fine already
[19:39:56] *** Joins: mawuli (mawuli@moz-5ADAB167.com.gh)
[19:39:56] *** Quits: mawuli (mawuli@moz-5ADAB167.com.gh) (Quit: mawuli)
[19:40:40] *** Joins: mawuli (mawuli@moz-5ADAB167.com.gh)
[19:41:19] *** Quits: whitglint (uid15486@moz-31ABA2C0.irccloud.com) (Ping timeout)
[19:42:21] *** Joins: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP)
[19:42:21] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/IKD4pA
[19:42:21] *** Parts: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP) ()
[19:46:16] <eddyb> nmatsakis: https://github.com/mozilla/rust/pull/12246 testing right now locally to make sure I didn't break ~Trait
[19:46:44] <cmr> nmatsakis: add tests for it if the suite doesn't have them..
[19:46:46] <cmr> erm
[19:46:51] <cmr> eddyb: *you* add tests :P
[19:46:55] <eddyb> for what?
[19:47:05] <cmr> whatever you maybe-broke with ~Trait
[19:47:09] <acrichto> r? https://github.com/mozilla/rust/pull/12207
[19:47:19] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[19:47:19] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/4YoRCA
[19:47:19] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[19:47:21] *** Joins: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP)
[19:47:21] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/HtXxSA
[19:47:21] <ghrust> 13rust/06auto 145e6841f 15Eduard Burtescu: Refactored ast_map and friends, mainly to have Paths without storing them.
[19:47:21] <ghrust> 13rust/06auto 148ff8dee 15bors: auto merge of #12162 : eddyb/rust/ast-map-cheap-path, r=nikomatsakis
[19:47:21] *** Parts: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP) ()
[19:47:47] <nmatsakis> cmr: I was just wondering, I think there are tests, but not sure which they are. 
[19:48:00] <nmatsakis> eddyb: I'd appreciate citations of tests in the test suite that already exist, but the patch looks good
[19:48:32] <eddyb> cmr: ah, I didn't run check-rpass before I fixed it. I doubt things would work normally, extra cleanups tend to trigger double frees
[19:49:05] <eddyb> or uncancelled cleanups, that is
[19:49:44] *** Joins: sunfish (chatzilla@moz-C06D9702.mtv1.mozilla.com)
[19:49:50] <eddyb> I originally wanted to remove allocas for immutable copyable primitives, this evening. might do that tomorrow, I guess
[19:49:51] *** Quits: cluelessperson (cluelesspe@moz-617B0E16.tx.res.rr.com) (Quit: Leaving)
[19:51:52] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[19:51:56] <eddyb> cmr: I'll look now, there should be something for calling a method on ~Trait
[19:52:01] <Luqman> eddyb: am i missing something or is the else on 380 missing a } ?
[19:52:16] <eddyb> did I push before I fixed that?
[19:52:34] <Luqman> that's what i see
[19:53:16] <eddyb> Luqman: poof. you didn't see anything :P
[19:53:48] <eddyb> (seriously now, thanks, I forgot to push after I fixed that little mistake)
[19:54:44] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[19:55:22] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[19:55:22] *** ChanServ sets mode: +qo brson brson
[19:59:48] *** Joins: jdm (jdm@E595D12E.1196002C.7DBB297B.IP)
[20:00:21] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Quit: ChatZilla 0.9.90.1 [Firefox 30.0a1/20140210030201])
[20:00:45] <eddyb> cmr: okay, found one, run-pass/objects-owned-object-owned-method would trigger a double free, quite visible with glibc
[20:00:46] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[20:01:24] <eddyb> it doesn't actually use Drop to test for that :/
[20:03:24] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[20:03:49] *** kimundi is now known as zz_kimundi
[20:04:41] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: rcirc on GNU Emacs 24.3.50.1)
[20:05:07] *** Quits: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net) (Ping timeout)
[20:06:06] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[20:06:09] <eddyb> I know there are tests that do fancy things with Drop to count the number of times a destructor has been called, but I have no idea where those are
[20:06:18] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[20:07:13] <flaper87> eddyb: I added one recently
[20:07:40] <flaper87> eddyb: it was to make sure that temporaries are freed for if and while conditions
[20:07:58] <flaper87> eddyb: 2 secs
[20:08:10] *** Joins: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[20:09:54] * flaper87 can't find it
[20:10:13] *** Quits: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Ping timeout)
[20:10:16] <flaper87> eddyb: ah here it is, nmatsakis changed the name: https://github.com/mozilla/rust/blob/master/src/test/run-pass/cleanup-rvalue-during-if-and-while.rs
[20:10:23] <flaper87> not sure if that's what you were looking for
[20:10:46] <eddyb> cleanup-*, thanks :)
[20:12:31] <eddyb> doesn't seem to be anything for ~Trait
[20:12:45] <eddyb> cmr: wish you said it earlier, when I had something buggy compiled :P
[20:12:59] <cmr> sorry :(
[20:13:03] <cmr> eddyb: but tests!
[20:13:07] *** Quits: canhtak (canhtak@moz-4D8F0D46.wl.t.ulaval.ca) (Quit: canhtak)
[20:13:09] <cmr> never fix a bug without writing a test
[20:13:15] <cmr> how do you know if it's fixed otherwise?
[20:13:23] <eddyb> I didn't fix a bug...
[20:13:30] <cmr> you made a bug, then fixed it :P
[20:13:58] <eddyb> I stared at the code for half an hour, decided to try it anyway, knowing it might not do the right thing for ~Trait, then came up with a solution
[20:15:01] <eddyb> rusti: let x = ~5 as ~Clone; let y: &Clone = y; x
[20:15:02] -rusti- <anon>:10:47: 10:48 error: unresolved name `y`. Did you mean `x`?
[20:15:02] -rusti- <anon>:10         let x = ~5 as ~Clone; let y: &Clone = y; x
[20:15:02] -rusti-                                                         ^
[20:15:02] -rusti- error: aborting due to previous error
[20:15:02] -rusti- application terminated with error code 101
[20:15:09] <eddyb> rusti: let x = ~5 as ~Clone; let y: &Clone = x; x
[20:15:12] -rusti- pastebinned 8 lines of output: http://ix.io/aud
[20:16:05] <eddyb> rusti: let x = ~5 as ~Clone; {let y: &Clone = x; let z: ~Clone = unsafe {::std::cast::transmute(y)};} 42
[20:16:07] -rusti- <anon>:10:55: 10:56 warning: unused variable: `z`, #[warn(unused_variable)] on by default
[20:16:07] -rusti- <anon>:10         let x = ~5 as ~Clone; {let y: &Clone = x; let z: ~Clone = unsafe {::std::cast::transmute(y)};} 42
[20:16:07] -rusti-                                                                 ^
[20:16:07] -rusti- 42
[20:16:24] *** Quits: edwardw (Mibbit@96E7298D.3E260003.B9C6B12A.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[20:16:38] <eddyb> hmm, why is that not screaming in agony?
[20:17:01] <eddyb> rusti: let x = ~5 as ~Clone; {let y: &Clone = x; let _z: ~Clone = unsafe {::std::cast::transmute(y)};let _z: ~Clone = unsafe {::std::cast::transmute(y)};} 42
[20:17:02] -rusti- 42
[20:17:35] <eddyb> rusti: let x = ~5; {let y: &int = x; let _z: ~int = unsafe {::std::cast::transmute(y)};let _z: ~int = unsafe {::std::cast::transmute(y)};} 42
[20:17:36] -rusti- 42
[20:17:49] <eddyb> rusti: let x = ~5; {let y: &int = x; let _z: ~int = unsafe {::std::cast::transmute(y)};let _z: ~int = unsafe {::std::cast::transmute(y)};} *x
[20:17:54] *** Joins: canhtak (canhtak@moz-4D8F0D46.wl.t.ulaval.ca)
[20:17:55] -rusti- timeout triggered!
[20:18:00] <eddyb> rusti: let x = ~5; {let y: &int = x; let _z: ~int = unsafe {::std::cast::transmute(y)};let _z: ~int = unsafe {::std::cast::transmute(y)};} *x
[20:18:06] -rusti- timeout triggered!
[20:18:08] * eddyb is now confused
[20:18:08] <cmr> eddyb: try dropping one of them?
[20:18:41] <eddyb> rusti: let x = ~5; {let y: &int = x; drop(unsafe {::std::cast::transmute(y)});drop(unsafe {::std::cast::transmute(y)})} ""
[20:18:42] -rusti- <anon>:10:44: 10:78 error: cannot determine a type for this expression: unconstrained type
[20:18:42] -rusti- <anon>:10         let x = ~5; {let y: &int = x; drop(unsafe {::std::cast::transmute(y)});drop(unsafe {::std::cast::transmute(y)})} ""
[20:18:42] -rusti-                                                      ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[20:18:42] -rusti- error: aborting due to previous error
[20:18:43] -rusti- application terminated with error code 101
[20:19:13] <eddyb> rusti: let x = ~5; {let y: &int = x; let _z: ~int = unsafe {::std::cast::transmute(y)};drop(_z);let _z: ~int = unsafe {::std::cast::transmute(y)};drop(_z);}drop(x);""
[20:19:15] -rusti- ""
[20:19:37] <eddyb> cmr: the dereference behavior is interesting
[20:19:43] <eddyb> rusti: let x = ~5; {let y: &int = x; let _z: ~int = unsafe {::std::cast::transmute(y)};drop(_z);let _z: ~int = unsafe {::std::cast::transmute(y)};drop(_z);}*x
[20:19:49] -rusti- timeout triggered!
[20:20:02] <flaper87> r? https://github.com/mozilla/rust/pull/12247
[20:21:08] <flaper87> eddyb: and then you ask why rusti hates you?
[20:21:10] <flaper87> :D
[20:21:17] <eddyb> cmr: I was going to prove to you that it's hard to get a double free past glibc...
[20:21:41] <cmr> eddyb: :P
[20:23:18] *** Quits: steveklabnik (uid17044@moz-A42E5B7B.irccloud.com) (NickServ (GHOST command used by steev))
[20:23:29] *** Joins: steveklabnik_ (uid17044@moz-A42E5B7B.irccloud.com)
[20:23:49] <eddyb> rusti: unsafe{let x: uint = ::std::cast::transmute_copy(~[0u8, 0, 0, 0]); let y: ~str = ::std::cast::transmute(x); let z: ~str = ::std::cast::transmute(x); (x, y, z)}
[20:23:51] -rusti- pastebinned 5 lines of output: http://ix.io/auf
[20:23:51] *** Joins: steveklabnik (steev@B1BA5385.27F34CF7.5670445F.IP)
[20:24:31] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[20:24:32] <eddyb> rusti: let x = ~[0u8, 0, 0, 0]; unsafe{let x: uint = ::std::cast::transmute_copy(&x); let y: ~str = ::std::cast::transmute(x); let z: ~str = ::std::cast::transmute(x); (x, y, z)}
[20:24:37] -rusti- task '<main>' failed at 'assertion failed: (w != 0)', /home/strcat/projects/rust/src/libstd/str.rs:2303
[20:24:37] -rusti- timeout triggered!
[20:24:54] <eddyb> rusti: let x = ~[0u8, 0, 0, 0]; unsafe{let x: uint = ::std::cast::transmute_copy(&x); let y: ~str = ::std::cast::transmute(x); let z: ~str = ::std::cast::transmute(x); 42}
[20:24:57] -rusti- pastebinned 7 lines of output: http://ix.io/aug
[20:25:15] <eddyb> rusti: let x = ~[0u8, 0, 0, 0]; unsafe{let x: uint = ::std::cast::transmute_copy(&x); let _y: ~str = ::std::cast::transmute(x); let _z: ~str = ::std::cast::transmute(x); 42}
[20:25:16] -rusti- 42
[20:25:40] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[20:25:41] *** ChanServ sets mode: +ao pcwalton pcwalton
[20:25:49] <eddyb> something like this totally broke everything, with my first massive trans PR
[20:25:51] *** Quits: larsberg (larsberg@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net) (Quit: Leaving.)
[20:26:37] <eddyb> I tried passing more argument types by value, found out the sad story with cancelling lvalue cleanups
[20:26:52] * flaper87 is still trying to find a reasonable way to get the Variant out of the expresion to then get its type contents
[20:27:23] <flaper87> I'm almost there but...
[20:27:28] <eddyb> cmr: *** Error in `./test': free(): invalid pointer: 0x0000000002012450 ***
[20:27:40] <eddyb> that same code above that rusti handles gracefully
[20:27:58] <eddyb> I'm starting to suspect strcat isn't running regular glibc
[20:28:23] <Luqman> flaper87: context?
[20:28:34] <flaper87> Luqman: https://github.com/mozilla/rust/pull/11979
[20:28:56] <eddyb> echo 'fn main(){let x = ~5 as ~Clone; {let y: &Clone = x; let _z: ~Clone = unsafe {::std::cast::transmute(y)};}}' | ./x*/stage1/bin/rustc - -o test; ./test
[20:29:01] <eddyb> cmr: ^^ totally aborts
[20:29:03] <cmr> eddyb: it is according to the script.
[20:30:55] <Luqman> flaper87: oh, to allow None::<T> even if T has a destructor?
[20:31:32] <flaper87> mmh, I guess matching the `ExprPath` is the way to go. I can match DefVariant there which gives me what I need
[20:31:34] <flaper87> Luqman: yeah :)
[20:31:54] <eddyb> flaper87: no luck stealing code from check_consts?
[20:32:08] <flaper87> eddyb: unless I'm blind, nope! 
[20:32:08] <eddyb> that should have all the variant-specific resulution you might need
[20:32:19] <eddyb> or maybe it's somewhere else
[20:32:57] <eddyb> rusti: static x: Option<int> = Some(5); static y: Option<int> = from_str("boo");
[20:32:58] -rusti- <anon>:10:66: 10:81 error: function calls in constants are limited to struct and enum constructors
[20:32:58] -rusti- <anon>:10         static x: Option<int> = Some(5); static y: Option<int> = from_str("boo");
[20:32:58] -rusti-                                                                            ^~~~~~~~~~~~~~~
[20:32:58] -rusti- error: aborting due to previous error
[20:33:00] -rusti- application terminated with error code 101
[20:33:12] <eddyb> flaper87: did you look for that error? ^^
[20:33:48] <Luqman> just matches on the expr and outputs that for ExprCall
[20:33:50] <flaper87> eddyb: yeah, but that just checks if the expr type is an enum
[20:34:09] <eddyb> ahh, okay
[20:34:17] <eddyb> cmr: i | glibc                        | package    | 2.18-4.7.1  | x86_64 | openSUSE-13.1-Update                             
[20:34:53] <cmr> eddyb: arch is on 2.19 right now.
[20:34:57] <eddyb> 2.18-4.11.1 is available, though I doubt the extra versions make sense outside the distro's build service
[20:35:05] <eddyb> cmr: is that what strcat has?
[20:35:10] <cmr> I assume so.
[20:35:19] <cmr> it's certainly not older than 2.18
[20:35:42] <eddyb> I was thinking the sandbox might be affecting
[20:36:28] <flaper87> so my current plan is, get the variant, check if it accepts args, if it does make sure each one of them is safe for static
[20:36:49] <cmr> rusti: #[link(name="libc")] extern "C" { fn gnu_get_libc_version() -> *std::libc::c_char; }  unsafe { std::str::raw::from_c_str(gnu_get_libc_version()) }
[20:36:53] -rusti- pastebinned 7 lines of output: http://ix.io/aui
[20:37:02] <cmr> rusti: #[link(name="c")] extern "C" { fn gnu_get_libc_version() -> *std::libc::c_char; }  unsafe { std::str::raw::from_c_str(gnu_get_libc_version()) }
[20:37:04] -rusti- ~"2.18"
[20:37:06] <eddyb> cmr: Factory is on 2.19, and there's an user's branch for 13.1... but. omg I was thinking of that, didn't expect it to be possible o_O
[20:37:24] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[20:37:24] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 148ff8dee to 14cfb87f1: 02http://git.io/N3iJvQ
[20:37:24] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[20:37:26] <eddyb> anything more precise than the get_libc_version?
[20:37:38] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Ping timeout)
[20:37:51] <cmr> rusti: #[link(name="c")] extern "C" { fn gnu_get_libc_release() -> *std::libc::c_char; }  unsafe { std::str::raw::from_c_str(gnu_get_libc_release()) }
[20:37:53] -rusti- ~"stable"
[20:37:56] <cmr> heh
[20:38:00] <flaper87> :P
[20:38:02] <eddyb> http://buildbot.rust-lang.org/builders/auto-linux-64-nopt-t/builds/3319/steps/test/logs/stdio/text
[20:38:09] <eddyb> but that worked in try!
[20:38:18] <eddyb> or does try not test it? I'm confused
[20:38:26] <cmr> eddyb: that's all the information it exposes.
[20:39:09] <acrichto> eddyb: try doesn't run all the tests
[20:39:18] <acrichto> I don't think it runs syntaxtest or rustctest
[20:40:01] <eddyb> lovely!
[20:41:37] *** Quits: zimbabao (rajaram@891F4AA0.E11C2288.D2D1FAF0.IP) (Ping timeout)
[20:47:34] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[20:49:47] <eddyb> // good lord, you can't make a path with 0 segments, can you?
[20:49:53] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[20:49:58] <eddyb> at least the tests make up for themselves
[20:50:24] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[20:52:31] *** Joins: tjc (tjc@9AB07901.2D024FDB.284344F5.IP)
[20:52:31] *** ChanServ sets mode: +o tjc
[20:52:34] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[20:58:47] *** Quits: eddyb (eddy@688E9026.F7C96DA2.FCAAE698.IP) (Ping timeout)
[20:59:11] *** Joins: eddyb (eddy@688E9026.F7C96DA2.FCAAE698.IP)
[20:59:39] *** Joins: larsberg (larsberg@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net)
[21:01:48] *** zz_kimundi is now known as kimundi
[21:02:12] *** Quits: eddyb (eddy@688E9026.F7C96DA2.FCAAE698.IP) (Ping timeout)
[21:02:35] *** Joins: eddyb (eddy@688E9026.F7C96DA2.FCAAE698.IP)
[21:06:15] *** Quits: doomlord_ (servitor@moz-9B2006BF.range109-151.btcentralplus.com) (Client exited)
[21:08:31] <eddyb> wonder what my reconnects were about? time: 554.598 s translation
[21:08:40] <eddyb> (it takes 30s if I'm lucky)
[21:08:54] *** Joins: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[21:08:58] <eddyb> that's a sign I should just give up and buy more RAM. if I still have funds
[21:10:05] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[21:10:58] *** Quits: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Ping timeout)
[21:19:58] <eddyb> huon: did you fix NO_REBUILD=1 for syntaxtest?
[21:21:21] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Quit: ChatZilla 0.9.90.1 [Firefox 30.0a1/20140213030201])
[21:21:23] <huon> eddyb: if my PR landed, yes
[21:21:34] <eddyb> not yet :(
[21:26:21] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[21:26:23] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[21:29:12] <eddyb> huon: at least I had some decent progress with inflate today, I guess :)
[21:30:09] *** Quits: aurynj (Eon@BF507CFB.1CEEC774.4C51A5AE.IP) (Ping timeout)
[21:30:42] *** Quits: sunfish (chatzilla@moz-C06D9702.mtv1.mozilla.com) (Ping timeout)
[21:30:45] *** Quits: tjc (tjc@9AB07901.2D024FDB.284344F5.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[21:32:19] *** Joins: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP)
[21:32:19] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14fdefb05 to 14cfb87f1: 02http://git.io/N3iJvQ
[21:32:19] *** Parts: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP) ()
[21:32:21] *** Joins: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP)
[21:32:21] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/TxzDlQ
[21:32:21] <ghrust> 13rust/06auto 147355904 15Alex Crichton: Tweak how preference factors into linkage...
[21:32:21] <ghrust> 13rust/06auto 14b4e5ee3 15Alex Crichton: Re-work loading crates with nicer errors...
[21:32:21] <ghrust> 13rust/06auto 14b9234cf 15bors: auto merge of #12164 : alexcrichton/rust/rlibs-and-dylibs, r=cmr...
[21:32:23] *** Parts: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP) ()
[21:32:36] <eddyb> https://github.com/mozilla/rust/issues/11765#issuecomment-33225236 gotta love bstrie
[21:33:17] <eddyb> <3 TX/RX
[21:33:47] <eddyb> why haven't we done that yet?
[21:34:07] <nmatsakis> flaper87: do you really need to look at the variant?
[21:34:21] <eddyb> oh, he does not
[21:34:31] <flaper87> nmatsakis: I'm starting to think I don't, after spending some time into it
[21:34:33] <flaper87> :D
[21:34:47] <nmatsakis> flaper87: ok. I think it's enough to look at the argument expressions,
[21:34:55] <nmatsakis> flaper87: after all the whole point of this is NOT to consider the types alone,
[21:35:00] <nmatsakis> flaper87: but the expressions themselves.
[21:35:01] <eddyb> wish I remembered earlier, flaper87: you have to look at the expression's type but not its type's contents' type_contents
[21:35:20] <nmatsakis> I'm not even sure you care about the expression's type
[21:35:22] <eddyb> I think I thought of it yesterday, but didn't fully express it
[21:35:28] <nmatsakis> I don't see why, anyhow.
[21:35:30] <flaper87> I don't care about the expresion type
[21:35:31] <eddyb> nmatsakis: it shouldn't implement Drop
[21:35:37] <nmatsakis> well,
[21:35:47] <nmatsakis> that's true,
[21:35:49] <nmatsakis> but that's not specific to variants
[21:36:06] <nmatsakis> that is, you don't care what variant it is,
[21:36:06] <flaper87> exactly!
[21:36:09] <nmatsakis> ok
[21:36:15] <eddyb> that is, UnaryEnumVariant could pertain to an Enum that implements Drop, but you wouldn't recurse like in type_contents
[21:36:26] <nmatsakis> basically when you see an ExprPath,
[21:36:33] <nmatsakis> you still want to check the defmap,
[21:36:41] <nmatsakis> but just so you can till it's an enum or struct constructor,
[21:36:47] <nmatsakis> in which case you check whether that enum/struct type defines drop
[21:36:55] <nmatsakis> same with a struct literal
[21:37:03] <nmatsakis> sound right?
[21:37:23] <eddyb> rustctest is not a thing?
[21:38:12] <flaper87> nmatsakis: it does, well, that works for `MyVariant` however, `MyVariant(~"")` is not an `ExprPath` in which case I just need to check the args
[21:38:28] <eddyb> flaper87: sorry for not explaining this thoughts earlier
[21:38:36] <nmatsakis> flaper87: sorry, I didn't mean that was the entirety of the rules:
[21:38:44] <nmatsakis> flaper87: for an ExprCall, you must recurse to arguments etc
[21:38:52] <flaper87> nmatsakis: oh ok, then it does make sense
[21:39:01] <eddyb> you can use an AST Visitor, couldn't you?
[21:39:04] <nmatsakis> yes
[21:39:07] <eddyb> s/can/could/
[21:39:14] <nmatsakis> I would expect you to do so :)
[21:39:33] * flaper87 acts like he is doing so
[21:39:36] <flaper87> :P
[21:39:48] *** Joins: sunfish (chatzilla@moz-C06D9702.mtv1.mozilla.com)
[21:40:23] <flaper87> I wasn't doing so because I was figuring out this bits out
[21:41:28] <nmatsakis> flaper87: sounds like you're on the right track
[21:43:18] <acrichto> whoa, libextra is tiny right now
[21:43:30] <flaper87> w000t
[21:43:31] <eddyb> dissolution imminent
[21:43:35] <acrichto> had no idea it got so small so quickly!
[21:43:56] <eddyb> check-stage1-rustctest doesn't work :/
[21:44:05] <acrichto> check-stage1-rustc ?
[21:44:07] <flaper87> that crate patch will take forever
[21:44:10] <flaper87> :D
[21:44:19] * flaper87 drinks a glass of patience and keeps coding
[21:44:32] <acrichto> flaper87: you're earning your "50+ bors attempts on one patch" badge
[21:44:43] <eddyb> acrichto: I think I'm an idiot
[21:44:58] <acrichto> eddyb: I think you're an excellent contributor!
[21:45:14] <flaper87> acrichto: :D that sounds like an honor :D
[21:45:22] <flaper87> eddyb: and I agree with acrichto 
[21:45:24] <flaper87> :D
[21:45:53] <acrichto> I wonder if we could get a histogram of bors tries on a PR
[21:46:12] <acrichto> if it could factor in false-negatives as well that'd be awesome
[21:46:14] <acrichto> but hard to do...
[21:46:22] <eddyb> and I was ashamed of my occasional 4 retries...
[21:46:40] <acrichto> oh don't worry about it
[21:46:46] <acrichto> someone's gotta keep brson warm in the winter
[21:46:48] <eddyb> I did run check-stage1-syntax and not syntaxtest, not sure why I didn't try check-stage1-rustc
[21:47:10] <eddyb> well, it's type checking, rustctest was fine
[21:47:30] <eddyb> *it's past
[21:48:34] <eddyb> acrichto: there, fire wood https://github.com/mozilla/rust/pull/12162
[21:49:12] <acrichto> foo$$UP$$VEC$int::foo => ~[int].foo::foo
[21:49:13] <acrichto> \o/
[21:49:50] <brson> acrichto: nice. is that for your backtrace demangler?
[21:49:58] <eddyb> acrichto: it will be mangled to something similar, but rustfilt can un-mangle it
[21:50:03] <acrichto> that's what eddyb did for printing in errors
[21:50:16] <acrichto> I will add it to the backtrace demangler once it lands though
[21:50:17] <eddyb> it's just impl "pretty" names in general
[21:50:19] <acrichto> I'm sure it's systematic
[21:50:33] <brson> eddyb: nice
[21:50:55] <eddyb> https://gist.github.com/eddyb/3a233c4709018e92b866
[21:51:00] <brson> what is $UP?
[21:51:06] <eddyb> unique pointer, ~
[21:51:30] <acrichto> brson: speaking of backtraces...
[21:51:39] <eddyb> I could probably remove $BPmut$, that isn't used anymore (the back::link mangler would output $BP$mut)
[21:52:22] <eddyb> (just updated it)
[21:52:34] <eddyb> brson: you can put that script above in ~/bin/rustfilt and use it almost like c++filt
[21:53:08] <eddyb> this line removes the hash and version, I should make it optional https://gist.github.com/eddyb/3a233c4709018e92b866#file-rustfilt-sh-L17
[21:53:42] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[21:54:16] <eddyb> there's probably a better way to do all that than the way I'm using tr and $PLACEHOLDER$ to allow de-mangling more symbols
[21:54:58] <acrichto> flaper87: you ok if I try to land https://github.com/mozilla/rust/pull/12248 before the 'extern mod' change?
[21:55:05] <acrichto> I don't think there will be many conflicts
[21:55:10] <acrichto> think being the operative word
[21:55:28] <flaper87> acrichto: sure, go ahead
[21:55:38] <flaper87> acrichto: and if it fails that's fine, I want that badge now
[21:55:41] <flaper87> :D
[21:55:44] <acrichto> lol
[21:56:05] <acrichto> there was some talk of an "official badge board"
[21:56:09] <acrichto> not sure where those talks went though
[21:57:01] <eddyb> there's a site for it
[21:57:09] <acrichto> oh do tell
[21:57:28] <eddyb> I had this open for a while https://badges.mozilla.org/en-US/badges/badge/Friend-of-the-Tree
[21:58:25] <eddyb> https://badges.mozilla.org/en-US/badges/badge/Friend-of-the-Tree/awards whaa, too many pages
[21:58:36] <acrichto> there are many friends of many trees!
[22:02:16] <flaper87> oh I didn't know that page existed
[22:03:03] <eddyb> acrichto: hmm, I forgot to thank you for your remark and to dismiss it in some way or another
[22:04:14] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[22:05:21] <eddyb> it's been months and I've barely done a handful of things
[22:07:17] <acrichto> each "handful" of yours is like a 6k loc change though lol
[22:07:33] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[22:07:33] *** ChanServ sets mode: +ao pcwalton pcwalton
[22:07:58] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[22:07:58] *** ChanServ sets mode: +o tjc
[22:08:11] <aatch> eddyb, heh. At least you didn't introduce massive performance issues
[22:08:13] *** Joins: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net)
[22:09:39] *** Joins: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[22:11:16] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Ping timeout)
[22:11:37] <eddyb> aatch: that's not very positive :P
[22:11:41] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[22:11:42] *** Quits: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Ping timeout)
[22:12:17] <eddyb> acrichto: most of those are made up of slow compulsive edits
[22:12:19] <aatch> eddyb, I did, twice. I mean, I fixed it later
[22:13:15] <eddyb> I actually improved performance, and I really want to continue doing that
[22:13:33] <eddyb> cmr: did you find an interactive visualization for the perf data?
[22:13:54] <eddyb> or maybe a way to bundle the binary and the perf data so I can check perf report... but you've been so helpful already :)
[22:15:30] *** Quits: bytbox (s@moz-54E13927.washdc.fios.verizon.net) (Ping timeout)
[22:15:52] <cmr> eddyb: I found no interactive visualization :(
[22:16:54] <cmr> eddyb: let me just grab the binaries :P
[22:17:09] <eddyb> not sure where perf expects them to be
[22:18:22] <eddyb> acrichto: all the work done to please bors and the lengthy compilations times feel exhausting
[22:18:50] <huon> bow before our robot master
[22:18:51] <cmr> eddyb: I'm checkint strings.
[22:18:59] <eddyb> combine that with a short excitement lifetime after every success
[22:19:41] <cmr> eddyb: it looks like it's just embedding the full path to the binary.
[22:19:57] <eddyb> can't provide a different path to perf report?
[22:20:04] <cmr> you can
[22:20:07] <cmr> I'm saying in perf.data
[22:20:30] <eddyb> acrichto: and I can't keep doing this forever, however good at it I may have made myself look
[22:20:34] <eddyb> (that was a mouthful)
[22:20:48] <cmr> meh I'll just zip up stage1
[22:21:13] <eddyb> is rustc itself enough?
[22:21:21] <cmr> I don't think so.
[22:21:31] <cmr> the debug symbols are going to be in std etc, yeah?
[22:21:48] <eddyb> ohh, right
[22:22:06] <eddyb> as long as you can provide a perf report commandline, I'll be happy :)
[22:22:41] <eddyb> huon: makes me wonder what would happen if someone were to take control of bors
[22:24:49] *** Quits: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net) (Ping timeout)
[22:25:09] *** Quits: canhtak (canhtak@moz-4D8F0D46.wl.t.ulaval.ca) (Connection reset by peer)
[22:26:56] <eddyb> do I pick the quietest moments to make random mentions not meant to go unnoticed :/
[22:27:02] <eddyb> nmatsakis: sup?
[22:38:57] <nmatsakis> eddyb: howdy.
[22:39:20] <eddyb> I see pcwalton is doing tangential work
[22:40:17] *** Quits: jdm (jdm@E595D12E.1196002C.7DBB297B.IP) (Quit: Lost terminal)
[22:40:31] <cmr> eddyb: http://octayn.net/benches/stage1.tar.xz
[22:40:49] <cmr> eddyb: seems it needs to be extracted exactly into /home/cmr/hacking/rust3/build/x86_64-unknown-linux-gnu for perf to work correctly.
[22:40:54] <eddyb> pffft
[22:41:24] <eddyb> inb4 ssh cmr@totally-public-IP-because-moznet-doesn't-do-cloaks
[22:41:45] <cmr> bouncer :)
[22:41:55] <cmr> (and it does)
[22:42:06] <eddyb> like unaffiliated/eddyb?
[22:42:11] <cmr> well no
[22:42:27] <cmr> it seems it does mask full hostnames though.
[22:44:20] *** Quits: japaric (japaric@61A78F7A.839FBF92.95AFB88D.IP) (Ping timeout)
[22:45:02] *** bstrie is now known as bstrie_vanished
[22:46:44] <eddyb> nmatsakis: maybe tomorrow morning I may be delighted by some DST plans
[22:46:46] <eddyb> good night :)
[22:47:52] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[22:47:53] *** Quits: jensnockert (jensnocker@moz-60DC2EAC.mobileonline.telia.com) (Connection reset by peer)
[22:48:30] <nmatsakis> eddyb: ok :)
[22:48:40] *** Quits: eddyb (eddy@688E9026.F7C96DA2.FCAAE698.IP) (Ping timeout)
[22:49:18] *** Joins: japaric (japaric@8C26A633.8C2993CE.5C7588CA.IP)
[22:58:48] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[22:58:48] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Ping timeout)
[23:00:19] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[23:01:49] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[23:04:43] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[23:10:23] *** Joins: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[23:12:11] *** Joins: lpy_ (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP)
[23:12:31] *** Quits: lpy (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Ping timeout)
[23:13:37] <Luqman> re-r? https://github.com/mozilla/rust/pull/12192
[23:13:41] <Luqman> acrichto: ^
[23:14:13] *** Quits: lpy_ (lpy@F864F9BC.9B88FD1B.E99F7FDB.IP) (Ping timeout)
[23:17:12] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[23:17:23] *** Joins: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP)
[23:17:23] <ghrust> 01[13rust01] 15bors pushed 15 new commits to 06auto: 02http://git.io/3GQHSw
[23:17:23] <ghrust> 13rust/06auto 146b429d0 15Steven Fackler: Stop unloading syntax libraries...
[23:17:23] <ghrust> 13rust/06auto 14745aa74 15Alex Crichton: Include compiler-rt in the distribution tarballs
[23:17:24] <ghrust> 13rust/06auto 14606c23a 15Seo Sanghyeon: Resolve type variables when checking casting to char
[23:17:26] *** Parts: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP) ()
[23:19:50] *** Quits: eibwen (kvirc@moz-2A1E42F9.dip0.t-ipconnect.de) (Ping timeout)
[23:22:59] *** kimundi is now known as zz_kimundi
[23:34:44] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[23:36:40] <cmr> acrichto: can we print stack traces on failure by default/
[23:36:49] <cmr> acrichto: if you don't want it, plug in a different stderr logger.
[23:41:54] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[23:42:31] <aatch> that would be nice
[23:43:03] <aatch> Especially since there isn't a central rust_begin_unwind to break on anymore
[23:43:14] <cmr> aatch: yes there is
[23:43:17] <cmr> rust_fail
[23:43:18] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[23:43:25] <aatch> Ugh, goddamit
[23:44:11] <aatch> Bah, hidden inside another function!
[23:44:24] <nrc> can someone explain glue_take and glue_drop please? Or point me towards somewhere it is explained
[23:44:36] <cmr> nrc: the glue is the secret sauce.
[23:44:48] <cmr> now, this knowledge might be out of date...
[23:44:56] <cmr> glue_take is used for moves
[23:46:00] <cmr> drop for dropping (calling destructors) of course
[23:46:07] <aatch> well, technically glue_take is for assignment, since it also did the refcounting for '@', I believe
[23:46:37] <cmr> or maybe that was all it did?
[23:46:57] <cmr> that seems to be all it does now.
[23:47:34] <aatch> cmr, I dunno. The glue is... special
[23:47:48] <cmr> yeah
[23:47:53] <cmr> nrc: I don't think it's explained anywhere.
[23:48:09] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[23:48:15] <cmr> nrc: strcat probably has the best understanding of it *right now*, since he mucked around with it most, most recently.
[23:48:58] <nrc> all take does now is refcounting or move?
[23:49:42] <cmr> I don't even know if it does moves now.
[23:49:56] <nrc> ok
[23:50:02] <cmr> it doesn't seem to be?
[23:52:18] <aatch> it doesn't seem to do moves, only the refcounting
[23:52:27] <cmr> ok.
[23:52:43] <cmr> by experimenting with https://gist.github.com/8986495
[23:52:55] <cmr> it seems that only moving a @T creates take glue.
[23:53:04] <cmr> ("moving", since it's just a refbump)
[23:54:28] <nrc> thanks cmr, aatch
[23:54:48] *** Quits: sunfish (chatzilla@moz-C06D9702.mtv1.mozilla.com) (Client exited)
[23:56:23] *** Joins: sunfish (chatzilla@moz-C06D9702.mtv1.mozilla.com)
[23:58:58] <aatch> stupid merge artifacts breaking code
