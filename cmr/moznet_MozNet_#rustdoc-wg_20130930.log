[00:05:08] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Bye!)
[00:05:19] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[02:50:59] *** Joins: doomlord__ (servitor@moz-728E30A7.range109-151.btcentralplus.com)
[05:02:03] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[05:02:04] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[05:17:58] *** ChanServ changes topic to 'rustdoc_ng is now the official rustdoc!'
[05:18:44] <cmr> acrichto: Seldaek: links in the body of documentation are too visually heavy, IMO: http://i.imgur.com/SRHLl0a.png
[05:19:01] <cmr> To the point of being hard to read, for me.
[05:22:27] <acrichto> hmm I wonder if a good overview at the top of all the methods listed would work
[05:23:59] <cmr> What do you mean?
[05:25:16] <acrichto> just a brief listing of all the methods
[05:25:19] <acrichto> an index of sorts
[05:25:20] <cmr> Ah
[05:25:23] <acrichto> not with documentation
[05:27:03] <dbaupp> if it was like traits (http://static.rust-lang.org/doc/master/std/iter/trait.Iterator.html) that'd be useful
[05:27:28] <cmr> Yeah, I was envisioning a similar kinda of short summary
[05:27:52] <acrichto> I don't think we necessarily need the types in the summary
[05:27:58] <acrichto> just the names
[05:29:12] <cmr> Once I'm done this project I'm going to try and get 1. cross crate hyperlinking, 2. html from json, 3. json from metadata done.
[05:31:48] <acrichto> json from metadata would be pretty sweet
[05:32:12] <cmr> I really want https://github.com/mozilla/rust/issues/1642
[05:32:24] <dbaupp> cmr: while you're at it, could you rewrite metadata to be sane? :P
[05:32:32] <cmr> dbaupp: nope
[05:32:42] <cmr> 3 is a tenuous "look and see what's possible" :P
[05:32:54] <cmr> I don't even know if the metadata includes spans
[05:33:07] <dbaupp> probably not
[05:33:08] <acrichto> metadata doesn't have attributes right now I think
[05:33:15] <dbaupp> acrichto: #[attributes]?
[05:33:19] <acrichto> yeah
[05:33:20] <dbaupp> it does for somethings
[05:33:26] <acrichto> oh, nvmd then
[05:33:34] <cmr> Do you know if it has doc attrs?
[05:33:37] <dbaupp> e.g. #[packed] and #[deprecated] (etc) all just read the attributes straight out of the metadata
[05:33:40] <cmr> If it doesn't the whole venture is pointless :p
[05:33:50] <dbaupp> without having to explicitly write them
[05:33:59] <dbaupp> so I assume #[doc] gets written automatically too
[05:34:28] <acrichto> huh
[05:34:51] <dbaupp> huh?
[05:35:20] <acrichto> oh I dunno
[05:35:34] <acrichto> I'd be a little surprised if doc was written into metadata currently
[05:35:40] <acrichto> I guess it is compressed though...
[05:35:52] <dbaupp> I thought we disabled compression?
[05:36:04] <cmr> No, that caused failures on mac iirc
[05:36:13] <cmr> The section got too big
[05:36:14] <acrichto> we wanted to hbut haven't yet
[05:36:25] <dbaupp> oh ok
[05:37:31] <dbaupp> https://github.com/mozilla/rust/blob/master/src/librustc/metadata/encoder.rs#L361
[05:37:45] <dbaupp> https://github.com/mozilla/rust/blob/master/src/librustc/metadata/encoder.rs#L1470
[05:37:59] <dbaupp> so yes, appears to just encode all the attributes, including #[doc]
[05:39:10] <cmr> Exciting
[05:39:20] <acrichto> interesting
[05:39:25] <acrichto> how convenient!
[05:39:28] <dbaupp> there's probably some things that need an encode_attributes call
[05:39:43] <dbaupp> (I know I had to add one to enum variants for #[deprecated])
[05:39:58] <cmr> I wonder if there's an ebml->xml converter somewhere, to make poking at metadata easy.
[05:40:07] <cmr> (easier)
[05:40:20] <dbaupp> we need a way to dump it uncompressed too
[05:40:34] <acrichto> isn't that what rustc --ls is
[05:40:42] <cmr> rustc --ls has been broken since 0.6
[05:40:52] <dbaupp> http://stackoverflow.com/questions/10453832/are-there-any-tools-to-convert-matroska-mkv-to-from-text-files
[05:41:14] <dbaupp> presumably that relies on us generating valid ebml
[05:41:43] <acrichto> I thought we just did some sort of random type of ebml
[05:41:47] <acrichto> not necessarily standard, not sure though
[05:41:59] <cmr> I think we're standardish
[05:42:07] <cmr> *shrug*
[05:42:14] <acrichto> we create various meanings for the integer tags
[05:42:23] <acrichto> we're the only ones who know the mapping of integer => meaning
[05:42:27] <cmr> Oh, do those have standard meanings in ebml?
[05:42:36] <acrichto> they probably do, but not necessarily all of them
[05:42:40] <cmr> mmm
[05:42:54] <acrichto> doesn't mean we couldn't use it though
[05:43:00] <acrichto> rustc --create-ebml-mapping-file
[05:43:03] <acrichto> or something like that
[05:43:39] <dbaupp> would it be ridiculous to write the metadata as json and compress it? (or is not compressing at all a useful goal?)
[05:43:57] <acrichto> there have been murmurs of putting metadata in a separate file
[05:44:04] <acrichto> next to the libraries
[05:44:08] <cmr> decoding json would be slower I'd think
[05:44:11] <acrichto> .ebml.gz would be interesting vs .jzon.gz
[05:44:18] <acrichto> oh good point
[05:44:26] <cmr> acrichto: it'd be super easy to implement, I'm pretty sure.
[05:44:41] <cmr> objcopy can extract the section
[05:44:41] <acrichto> although extraction I think would be for omitting compression
[05:45:02] <acrichto> although if we could omit the section entirely we could forgo compression
[05:45:54] <cmr> I'm not too hot on separating metadata, since it means rust would need foo-dev/foo-devel packages :(
[05:45:55] <dbaupp> ah, part of the point of avoiding compression is so we can mmap the metadata and read it without having to suck/decode the whole thing into memory, right? (i.e making small crates faster?)
[05:46:10] <acrichto> we'd have to always ship it
[05:46:14] <acrichto> metadata is required for compilation
[05:46:19] <cmr> yes
[05:46:30] <acrichto> dbaupp: yeah decompression was a large thing in small program profiles I believe
[05:47:07] <cmr> 33.48%
[05:47:24] <cmr> Hah!
[05:47:28] <acrichto> ?
[05:47:30] <dbaupp> are you sure it wasn't 33.49%? :P
[05:47:31] <cmr> The kernel zeroing pages is 7.02%
[05:47:39] <acrichto> :(
[05:47:41] <cmr> I'm looking at a perf report now.
[05:47:42] <dbaupp> what!?
[05:47:47] <cmr> on fn main() {}
[05:48:15] <cmr> Oh I bet it's because of pcwalton's lazy resolve things
[05:48:16] <acrichto> 33.48% of the time is decompressing metadata?
[05:48:22] <cmr> acrichto: yup
[05:48:28] <acrichto> interesting...
[05:48:35] <cmr> http://i.imgur.com/5TDeDwh.png
[05:48:58] <cmr> This is actually really good.
[05:49:13] <cmr> A lot better than it used to be.
[05:49:22] <acrichto> yeah I think that's all metadata
[05:50:04] <cmr> Look at how much time ld spends linking our program compared to how long it actually runs :p
[05:50:15] <cmr> Oh wait
[05:50:16] <cmr> We run ld
[05:50:20] <cmr> nevermind >_<
[05:50:31] <cmr> Hm, lld was designed for speed.
[05:50:40] <cmr> Someone should really look into it
[05:50:52] <acrichto> is it "ready ready"
[05:50:53] * cmr pushes rustpkg futher down the todo list
[05:51:22] <cmr> AFAICT lld is mostly done
[05:51:25] <acrichto> it'd be interesting to have an option to use it
[05:51:33] <acrichto> and maybe just not on by default
[05:52:55] <cmr> sigh, and I was hoping I'd get to play video games this break.
[05:52:59] <cmr> too much rust stuff to do!
[05:53:24] <acrichto> there's always so many rust things to do!
[05:53:58] <dbaupp> fwiw, call graph for clear_page: https://gist.github.com/huonw/a86a741755db099d5270
[05:54:09] <dbaupp> 13% or so is from vec::from_fn too
[05:54:35] <dbaupp> cmr: rust is better than video games anyway :P
[05:54:43] <cmr> dbaupp: I know, that's why I do it :p
[05:54:45] <acrichto> it's all inflation!
[05:55:34] <dbaupp> apparently bfd_link_hash_traverse is getting called 30% of the time by `0`
[05:55:45] <cmr> I'd be interested in seeing http://blosc.pytables.org/trac used for compression
[05:56:02] <cmr> Since we're talking about not compressing at all, its not-so-good compression ratio shouldn't matter
[05:56:43] <dbaupp> I imagine mmaping and only reading exactly what we need will almost always be faster
[05:57:01] <cmr> I'm pretty sure the clear_page is from mmap
[05:57:37] <dbaupp> are we mmaping something now?
[05:58:21] <cmr> llvm mmap's in the metadata section, and jemalloc uses mmap for most things
[05:59:24] <cmr> I wonder if linux will let us not zero pages
[06:00:08] <dbaupp> unlikely if it's an entirely new page
[06:00:40] <cmr> It'd also be a security vulnerability
[06:01:13] * cmr -> bed
[06:01:14] <dbaupp> right, that's what I mean
[07:13:06] *** flaper87|afk is now known as flaper87
[08:14:34] *** flaper87 is now known as flaper87|afk
[08:21:53] *** flaper87|afk is now known as flaper87
[13:55:23] *** flaper87 is now known as flaper87|afk
[14:21:39] *** Joins: doomlord___ (servitor@moz-728E30A7.range109-151.btcentralplus.com)
[14:21:56] *** Quits: doomlord___ (servitor@moz-728E30A7.range109-151.btcentralplus.com) (Client exited)
[16:14:19] *** flaper87|afk is now known as flaper87
[16:19:54] *** Quits: doomlord__ (servitor@moz-728E30A7.range109-151.btcentralplus.com) (Quit: Leaving)
[17:48:58] *** flaper87 is now known as flaper87|afk
[17:53:57] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[17:54:06] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[17:57:20] *** Joins: doomlord__ (servitor@moz-728E30A7.range109-151.btcentralplus.com)
[22:37:25] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[22:56:38] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[23:12:50] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
