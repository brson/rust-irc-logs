[00:15:23] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Connection closed)
[00:18:51] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[02:25:37] *** Quits: bluss (bluss@moz-rip51k.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[02:38:17] *** Quits: kimundi (kimundi@moz-d29tad.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:40:08] *** Joins: kimundi (kimundi@moz-jppfl0.aq82.95ei.4fe2.2002.IP)
[05:59:18] <Gankro> acrichto: it seems like the discussion of single-pass algorithms fizzled out - was that settled on irc or something?
[06:00:37] <Gankro> measured to be negligable?
[06:01:51] <acrichto> Gankro: ?
[06:02:04] <Gankro> acrichto: not needing to call finish or whatever
[06:02:15] <acrichto> I think I'm forgetting the context
[06:02:37] <Gankro> acrichto: strcat wanted, as far as I can tell hash_slice(&[u8]) -> u64
[06:02:56] <Gankro> because maintaining the state to finalize was potentially harmful
[06:03:12] <acrichto> that was both retained and jettisoned
[06:03:20] <acrichto> hashing &[u8] literally is indeed a "one pass" thing
[06:03:27] <acrichto> but we also want the ability to hash composite structures
[06:03:34] <acrichto> this all had to do with the trait design
[06:03:36] <acrichto> which was settled long ago
[06:03:40] <acrichto> e.g. is the signature of hash:
[06:03:44] <acrichto> fn hash(&self) -> u64;
[06:03:45] <acrichto> or 
[06:03:52] <acrichto> fn hash<H: Hasher>(&self, h: &mut H)
[06:04:12] <acrichto> the first is the "single pass" style, but it's not flexible in that it doesn't allow different hashing algorithms
[06:04:23] <acrichto> the second is not "single pass" but can often optimized to such and is far more flexible
[06:04:27] <acrichto> aka it works for composite structures
[06:05:05] <Gankro> acrichto: was the "can often optimize" actually experimentally determined, or just a "sufficiently smart compiler" argument?
[06:05:33] <acrichto> it was largely unbased claims both ways
[06:05:36] <acrichto> there's no real great benchmark here
[06:06:08] <acrichto> which is to say there was nothing really to measure
[06:06:11] <acrichto> so nothing was measured
[06:06:27] <acrichto> but the "smart compiler" argument can't also just be cast aside
[06:06:33] <acrichto> there's a real reason it's generic and not a trait object
[06:06:43] <Gankro> hmm. I really wish we had some shootouts against boost/stl
[06:07:21] <acrichto> the problem there is that the hash algorithms are very different
[06:07:29] <acrichto> you'd just be comparing rust siphash to whatever boost has
[06:07:46] <acrichto> but regardless this doesn't affect these extra methods
[06:07:49] <acrichto> this has already been stabilized
[06:08:00] <acrichto> the extra methods are just getting some extra speed if necessary
[06:08:06] <Gankro> acrichto: I'd still like to see them even if they're apples to oranges :)
[06:08:19] <Gankro> If only to demonstrate how rice'd out our hashmap is :P
[06:09:00] <Gankro> acrichto: Do we leverage these specializations at all?
[06:09:09] <acrichto> yes
[06:09:15] <acrichto> impl Hash for [T] uses hash_slice
[06:09:23] <acrichto> and Hash for all the primitives uses the appropriate write_foo method
[06:12:15] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[06:14:37] <Gankro> acrichto: I meant in the hashers themselves
[06:14:47] <Gankro> e.g. can Sip/Fnv do anything notably interesting?
[06:14:53] <acrichto> Sip used to in the past and currently doesn't
[06:14:57] <acrichto> fnv can't do anything intrsting
[06:15:04] <acrichto> hash_slic is definitely used by both
[06:15:24] <Gankro> Hmm, that seems like a hint that it doesn't matter?
[06:15:38] <acrichto> right, and neither does clone_from
[06:15:52] <acrichto> we can't just have hundreds of unstable things
[06:15:56] <acrichto> we need to remove or stabilize them
[06:16:09] <acrichto> like sure we shouldn't be too aggressive
[06:16:10] <Gankro> Right, but it sounds like we only have motive to remove them?
[06:16:23] <acrichto> not really, b/c that means we should remove basically everything unstable
[06:16:27] <Gankro> lol
[06:16:34] <acrichto> but seriously, we don't have that much pressure
[06:16:40] <acrichto> we haven't stabilized an api in like a month now
[06:16:42] <acrichto> maybe more
[06:16:53] <acrichto> that doesn't mean we shouldn't stabilize anything
[06:17:00] <Gankro> I'm just saying we have some experimental evidence that hash_slice isn't actually useful for the two fns we maintain
[06:17:10] <acrichto> you shouldn't say "how do I do this in rust?" and we respond "oh! now we can stabilized that, just wait 3 months for it to be on stable"
[06:17:30] <acrichto> other way around, we definitely have evidence that hash_slice is useful
[06:17:39] <Gankro> Wait what
[06:17:40] <acrichto> the write_* methods don't have implementors
[06:17:57] <acrichto> if we don't have hash_slice then hashing a 1MB block of [u8] is 1 million calls to write()
[06:18:06] <acrichto> whereas with hash_slice it is one call to write()
[06:18:12] <Gankro> Uhhhh ok
[06:18:14] <Gankro> shipit
[06:29:51] <acrichto> sip 0.008484706 seconds
[06:29:51] <acrichto> fnv 0.013891863 seconds
[06:29:51] <acrichto> c++ 0.00149667 seconds
[06:29:54] <acrichto> Gankro: ^
[06:30:03] <acrichto> https://gist.github.com/1a47c7414b8640735ccb
[06:30:04] <Gankro> acrichto: :((((
[06:31:05] <Gankro> That seems really really bad
[06:31:16] <Gankro> oh wait
[06:31:20] <Gankro> You're hashing huge things
[06:31:52] <Gankro> I don't think we should really care about that -- throughput of small to medium things seems more critical
[06:32:12] <Gankro> medium being, like, max 1k
[06:32:25] <Gankro> small being like a pointer
[06:32:27] <acrichto> sip 0.000001741 seconds
[06:32:27] <acrichto> fnv 0.000015347 seconds
[06:32:27] <acrichto> c++ 3.87e-07 seconds
[06:32:30] <acrichto> 1024 block
[06:32:41] <acrichto> not sure how to get C++ to print nicely
[06:32:53] <Gankro> wtf why is fnv falling over?
[06:33:03] <acrichto> multiplication is hard
[06:33:07] <acrichto> and that's what fnv does
[06:33:19] <Gankro> I thought fnv was suppose to be like an order of magnitude faster
[06:33:43] <acrichto> for tiny things I think so
[06:33:58] <acrichto> it may also be not inlined well across librustc
[06:34:05] <acrichto> whereas sip may be?
[06:34:20] <acrichto> it does seem slow though: 
[06:34:20] <acrichto> sip 0.000000231 seconds
[06:34:21] <acrichto> fnv 0.000007482 seconds
[06:34:23] <acrichto> that's a 10 byte block
[06:34:37] <Gankro> I'd believe if it wasn't marked inline
[06:34:42] <acrichto> sip 0.000000043 seconds
[06:34:42] <acrichto> fnv 0.000007798 seconds
[06:34:44] <acrichto> that's just a byte
[06:34:48] <Gankro> Actually no I don't believe that
[06:35:03] <Gankro> Everyhting is always inline everywhere
[06:35:25] <acrichto> write for FnvHasher isn't inline
[06:35:35] <acrichto> nor is dfault
[06:35:44] <acrichto> otherwise a bunch of this could just be constant folded
[06:36:13] <Gankro> wait, default?
[06:36:33] <acrichto> Default for FnvHasher
[06:36:39] <acrichto> (the only current constructor)
[06:36:56] <Gankro> Ah
[06:37:08] <Gankro> I'm surprised... isn't it defined in a seperate crate from its use?
[06:37:29] <Gankro> e.g. it's in crate librustc_collections or whatever
[06:37:35] <acrichto> nah it's in rustc
[06:37:43] <acrichto> not sure where that is in the hierarchy any more...
[06:38:50] <Gankro> acrichto: servo has an Fnv crate 
[06:39:17] <Gankro> https://libraries.io/cargo/fnv
[06:39:30] <Gankro> wait what the shit is libraries.io
[06:39:34] <Gankro> google you're drunk
[06:40:01] <Gankro> Wiat you're the author
[06:40:09] <acrichto> wut
[06:40:35] <Gankro> lmao: https://crates.io/crates/fnv/
[06:40:41] <Gankro> SimonSapin ultimate troll
[06:40:57] <acrichto> sip 0.000000050 seconds
[06:40:57] <acrichto> fnv 0.000000023 seconds
[06:40:58] <acrichto> 1 byte
[06:41:13] <acrichto> sip 0.000001125 seconds
[06:41:13] <acrichto> fnv 0.000000028 seconds
[06:41:16] <acrichto> 1024 block
[06:41:27] <acrichto> sip 0.000893936 seconds
[06:41:27] <acrichto> fnv 0.000000025 seconds
[06:41:29] <acrichto> megabyte
[06:41:31] <acrichto> someone's cheating
[06:41:50] <Gankro> acrichto: nono fnv is just optimal
[06:42:05] <acrichto> how do I random string in rust
[06:42:09] <Gankro> acrichto: black_box?
[06:42:36] <acrichto> sip 0.000948279 seconds
[06:42:36] <acrichto> fnv 0.000000023 seconds
[06:42:51] <Gankro> Shout-outs to optimal code
[06:42:53] <acrichto> oh wait
[06:43:05] <acrichto> yeah it was just all dead code
[06:43:07] <acrichto> result wasn't being used
[06:43:43] <acrichto> sip 0.000000041 seconds
[06:43:44] <acrichto> fnv 0.000000026 seconds
[06:43:56] <acrichto> sip 0.000001403 seconds
[06:43:56] <acrichto> fnv 0.000001572 seconds
[06:44:05] <acrichto> sip 0.000921989 seconds
[06:44:05] <acrichto> fnv 0.001213184 seconds
[06:44:10] <acrichto> 1 byte - 1024 bytes - 1MB
[06:44:14] <Gankro> fnv is a joke
[06:44:19] <Gankro> Get out of here fnv you're trash
[06:45:31] * acrichto sleeps
[06:46:49] <Gankro> acrichto: this tho https://github.com/shepmaster/twox-hash/blob/master/README.md
[07:53:18] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[08:39:32] *** Joins: killercup (killercup@moz-4u70ka.dip0.t-ipconnect.de)
[09:05:24] *** Joins: bluss (bluss@moz-rip51k.cust.bredbandsbolaget.se)
[09:11:08] *** Joins: aatch (james@moz-tr6.omt.54.210.IP)
[09:38:13] <SimonSapin> wat
[09:38:36] <SimonSapin> Gankro: blame cgaebel https://github.com/servo/servo/commit/acd83ff47b30049fcd43a334f40bfbc27e7fbfd3#diff-165cec1c3d5ed5414bf2961a73872f6b
[09:38:40] <SimonSapin> I just moved it to a crate
[10:29:18] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[10:44:41] *** Quits: aatch (james@moz-tr6.omt.54.210.IP) (Ping timeout: 121 seconds)
[10:47:54] *** Quits: rustbot (havvy@moz-epv20b.wa.comcast.net) (Ping timeout: 121 seconds)
[11:49:33] *** Joins: rustbot (havvy@moz-epv20b.wa.comcast.net)
[12:25:54] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[13:47:42] *** Quits: bluss (bluss@moz-rip51k.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[13:52:13] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[13:57:37] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[14:00:35] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Ping timeout: 121 seconds)
[14:00:50] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[14:05:10] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Ping timeout: 121 seconds)
[14:05:19] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[14:36:09] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[14:51:23] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[14:57:43] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Ping timeout: 121 seconds)
[14:58:16] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[15:02:07] *** Quits: rdgawdzi (sid91768@moz-mt7qcd.highgate.irccloud.com) (Connection closed)
[15:02:34] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Ping timeout: 121 seconds)
[15:16:58] *** Joins: canhtak (jeremy@moz-kcs.u0t.149.5.IP)
[15:21:14] *** Quits: canhtak (jeremy@moz-kcs.u0t.149.5.IP) (Client exited)
[15:30:38] *** Quits: killercup (killercup@moz-4u70ka.dip0.t-ipconnect.de) (Quit: My Mac has gone to sleep. ZZZzzz‚Ä¶)
[15:36:49] *** Joins: brson (brson@moz-u3dg2t.sfo1.mozilla.com)
[15:36:49] *** ChanServ sets mode: +qo brson brson
[15:38:39] <brson> acrichto: can we talk about the no_std rfc today?
[16:02:22] <acrichto> brson: sure
[16:04:55] <gleb> acrichto: does the gcc crate need the winapi dependencies when used with gcc?
[16:05:17] <acrichto> gleb: nah it's only for msvc targets
[16:05:36] <gleb> Cargo.toml might need fixing then
[16:05:59] <gleb> acrichto: https://github.com/alexcrichton/gcc-rs/blob/master/Cargo.toml#L16-27
[16:06:07] <acrichto> how so?
[16:06:23] <gleb> the gnu targets
[16:06:57] <acrichto> you can cross to msvc from a gnu host
[16:07:00] <acrichto> in which case those will be needed
[16:07:09] <gleb> I see...
[16:08:15] <gleb> well the winapi crate has broke recently and I don't actually have Windows handy to find out why :(
[16:08:43] <acrichto> gleb: how so?
[16:08:46] <acrichto> (e.g. do you have logs?)
[16:09:02] <gleb> https://ci.appveyor.com/project/GuillaumeGomez/cairo/build/1.0.61/job/sludq510rrulo6s7#L66
[16:09:53] <acrichto> gleb: winapi 0.2 requires rust 1.1, but looks like you're using 1.0
[16:10:29] <gleb> that's too bad
[16:10:48] <gleb> bu thanks for a definite answer :)
[16:33:22] *** Quits: WindowsBunny (Peter@moz-vlal7g.east.verizon.net) (Ping timeout: 121 seconds)
[16:37:41] *** Joins: WindowsBunny (Peter@moz-vlal7g.east.verizon.net)
[17:09:04] <Gankro> SimonSapin: You were the original introducer of rc_counts, right?
[17:09:18] <Gankro> or was it sfackler...
[17:09:29] <SimonSapin> Gankro: not that I remember
[17:09:34] <sfackler> nope
[17:09:35] <SimonSapin> but I used it yesterday
[17:09:43] <Gankro> SimonSapin: Oh really?
[17:10:10] *** Joins: rdgawdzi (sid91768@moz-mt7qcd.highgate.irccloud.com)
[17:11:37] <Gankro> SimonSapin: Like, you actually got the count, or you were just checking for uniqueness?
[17:12:27] <SimonSapin> checking `Rc::strong_count(‚Ä¶) == 1`
[17:12:46] <Gankro> SimonSapin: Why not .is_unique?
[17:12:56] <SimonSapin> that also checks weak_count() == 0
[17:13:01] <Gankro> Aha
[17:13:08] <Gankro> I... disagree with that design
[17:13:49] <Gankro> I'm trying to figure out if it's worth having the ref counts -- like if anyone ever cares about anything but uniqueness
[17:13:55] <Gankro> on the other hand it's fairly harmless
[17:14:06] <Gankro> And maybe you care if there's like 7 or something
[17:14:35] <SimonSapin> It‚Äôs what you want for get_mut and make_unique, those weak refs could be upgraded while you‚Äôre holding &mut T
[17:15:13] <Gankro> hmm
[17:15:21] <Gankro> yes
[17:15:33] <SimonSapin> What I cared about in this case was "is T gonna be dropped when I drop this Rc<T>"
[17:55:27] *** Joins: bluss (bluss@moz-rip51k.cust.bredbandsbolaget.se)
[18:05:30] *** Joins: sigma (sigma@moz-ennbau.range86-141.btcentralplus.com)
[18:07:46] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[18:22:59] *** Quits: bluss (bluss@moz-rip51k.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[18:33:22] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[18:34:32] *** Joins: bluss (bluss@moz-rip51k.cust.bredbandsbolaget.se)
[18:39:30] *** Quits: kimundi (kimundi@moz-jppfl0.aq82.95ei.4fe2.2002.IP) (Ping timeout: 121 seconds)
[18:39:53] *** Joins: kimundi (kimundi@moz-jppfl0.aq82.95ei.4fe2.2002.IP)
[19:04:46] *** Quits: brson (brson@moz-u3dg2t.sfo1.mozilla.com) (Quit: leaving)
[19:11:16] <aturon> early draft of rust-lang crates RFC: https://gist.github.com/aturon/334a9f328658b34c3420
[19:11:27] <aturon> i need to finish out the last couple of sections, but wanted to get this to you folks before the meeting
[19:11:33] <aturon> (and have to go to lunch now :)
[19:14:03] <kimundi> acrichto: Short question about the allocator RFC: Why are there both reallocate and reallocate_inplace?
[19:36:08] *** Joins: apasel422 (Mibbit@moz-6ga37r.ma.comcast.net)
[19:55:52] <sfackler> aturon: triage today?
[19:57:32] <aturon> sfackler: yep
[19:59:00] *** Joins: brson (brson@moz-u3dg2t.sfo1.mozilla.com)
[19:59:00] *** ChanServ sets mode: +qo brson brson
[19:59:19] <acrichto> kimundi: I think it's basically just a performance optimization, e.g. reallocate_inplace will only ever reallocate inplace
[19:59:23] <acrichto> where reallocate will try as hard as it can
[19:59:41] <kimundi> ah, okay
[19:59:43] <sfackler> vidyeo seems to be working - there or hangouts?
[20:00:05] <acrichto> sfackler: hangouts
[20:00:53] <aturon> https://plus.google.com/hangouts/_/mozilla.com/rust-libs?authuser=1&hceid=YXR1cm9uQG1vemlsbGEuY29t.569bo6bnpd5d0ipi5c0he2gceg
[20:03:38] <Gankro> aturon: link seems busted
[20:03:57] <aturon> Gankro: hmm... worked for me -- how did other people get in?
[20:04:11] <burntsushi> Gankro: try https://plus.google.com/hangouts/_/mozilla.com/rust-libs
[20:05:04] <Gankro> burntsushi: üëç
[20:27:07] *** Quits: sigma (sigma@moz-ennbau.range86-141.btcentralplus.com) (Connection closed)
[20:49:27] *** Quits: apasel422 (Mibbit@moz-6ga37r.ma.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[21:02:44] <SimonSapin> aturon: Unicode released version 8 last month (and is planning to release a new one every year or so, I think). Between std, https://github.com/unicode-rs , and others, we have many crates that could (should?) update for it. Would it make sense to centralize this? Maybe have a single crate that provides all of the character database
[21:03:24] <SimonSapin> do giant `static` items get removed from the final binary if they‚Äôre (transitively) unused?
[21:05:18] <Gankro> SimonSapin: what's up with your stable version of rc?
[21:08:15] <Gankro> SimonSapin: would you accept a patch to have a nightly flag that makes it exactly std::rc?
[21:09:47] <SimonSapin> Gankro: what do you mean what‚Äôs up? It gets you Weak on stable rust.
[21:09:47] <aturon> SimonSapin: centralization would be really good imo
[21:09:49] <SimonSapin> I didn‚Äôt think that flag was necessary, but I‚Äôm not against it
[21:10:07] <aturon> SimonSapin: i'm pretty sure the static would be removed, but acrichto would know for sure
[21:10:08] <Gankro> SimonSapin: We're planning it murder-death-kill Weak I think
[21:10:26] <SimonSapin> Gankro: oh noes
[21:10:43] <Gankro> SimonSapin: It's not zero-cost, and causes tricky semantic issues on the question of uniqueness
[21:10:48] <Gankro> But we want them to live on in crates
[21:10:51] <SimonSapin> I definitely want weak references to avoid cycles in my trees
[21:11:06] <Gankro> SimonSapin: I'm gonna RFC it though
[21:11:10] <Gankro> So feel free to dissent
[21:11:12] <acrichto> SimonSapin: yes unused statics should be removed from the final compile
[21:12:06] <SimonSapin> If they‚Äôre removed from std::rc, the rc crate will become a long-term thing rather than just a stop gap. Maybe it should be renamed then.
[21:12:21] <Gankro> SimonSapin: Why renamed?
[21:12:25] <SimonSapin> acrichto: So it‚Äôs fine to have lots of giant tables in rustc_unicode?
[21:12:34] <SimonSapin> Gankro: to avoid confusion with std::rc, if they do different things?
[21:13:41] <bluss> Gankro: given that Servo needs weak pointers, do you think it's realistic to remove them?
[21:14:05] <acrichto> SimonSapin: yeah I don't think it'd be the end of the world, but I'd want to verify it
[21:14:05] <Gankro> bluss: servo is more than happy to have All The Dependencies already
[21:14:17] <Gankro> SimonSapin: `counted`?
[21:14:42] <bluss> Gankro: I think rust should provide an Rc that's adequate for Servo
[21:14:46] <bluss> Gankro: (and Arc)
[21:14:55] <Gankro> bluss: fwiw they only use Weak on Arc
[21:15:00] <Gankro> to my knowledge
[21:15:07] <bluss> right I suspect as much
[21:15:25] <SimonSapin> acrichto: the idea is having all of http://www.unicode.org/Public/UCD/latest/ucd/ in one place. (Not sure if that place should be std or crates.io)
[21:15:52] <Gankro> bluss: I wouldn't be opposed to eventually bring the back (as seperate types), but in my experience Weak isn't all that common to use
[21:15:56] <aturon> bluss: i'm personally somewhat sympathetic to that -- weak refs are certainly an important use case for Arc. but i would also be OK having distinct types in std.
[21:16:25] <Gankro> bluss: And we certainly don't include things just because they have a usecase
[21:16:25] <SimonSapin> bluss: Servo doesn‚Äôt need weak pointers, Kuchiki and the unit tests of html5ever do.
[21:16:29] <bluss> my old idea would be to have weak be opt-in with a type parameter or separate type
[21:16:40] <bluss> Arc<T> = Arc<T, NoWeak> etc
[21:16:43] <SimonSapin> (Servo uses JavaScript‚Äôs tracing GC)
[21:16:45] <Gankro> bluss: there are semantic consequences for uniqueness, though
[21:17:01] <bluss> SimonSapin: I know servo uses Weak though
[21:17:04] <acrichto> SimonSapin: yeah I'm not sure that I'd want literally all the unicode data in a crate inside of the main distribution, but it seems relatively plausible
[21:17:24] <Gankro> bluss: Also it affects the atomic algos a fair amount
[21:17:44] <bluss> Gankro: yes, why it should be opt-in
[21:18:32] <SimonSapin> bluss: (looking‚Ä¶) right, not in DOM trees, but it does use arc::Weak. (Not rc::Weak as far as I can tell.)
[21:20:15] <SimonSapin> acrichto: It‚Äôs probably better on crates.io. But then what about the subset that std wants to use? Duplicating just that is probably ok, better than the status quo. We‚Äôd have two things to update instead of N when Unicode releases a new version.
[21:25:24] <acrichto> SimonSapin: yeah that'd be nice to not have to worry about so much
[21:28:46] <SimonSapin> Are https://github.com/unicode-rs crates good candidates for rust-lang-nursery ?
[21:29:16] <SimonSapin> I suppose it boils down to who wants to maintain them
[21:31:58] <SimonSapin> Gankro: I‚Äôll be ok if weak pointers end up on crates.io, but the code duplication is kinda unfortunate.
[21:32:39] <SimonSapin> I‚Äôll be four combinations of weakref support and atomicity
[21:32:42] <Gankro> aturon: I have a feeling that removing weak ptrs actually results in substantial code changes to Arc, is this the case?
[21:32:43] <aturon> Gankro: it'd be interesting to know if anyone has experienced a significant space penalty due to weak pointers
[21:32:53] <bluss> SimonSapin: the drawbacks are too great right now (16 byte Rc<T> and no DST)
[21:33:00] <aturon> Gankro: yes, for the uniqueness stuff
[21:33:32] <aturon> Gankro: (re: space penalty, i mean in practice in an app or library; if even Servo isn't suffering much...)
[21:34:09] <Gankro> aturon: I've never heard any substantiated claims ever about space consumption in Rust
[21:34:15] <SimonSapin> bluss: drawbacks of the rc crate v.s. std::rc? That‚Äôs why I recommend conditional usage: https://github.com/SimonSapin/rust-rc#recommended-usage
[21:34:39] <bluss> right, and effectively then recomment using Weak from libstd
[21:34:56] <bluss> when possible
[21:34:58] <SimonSapin> right
[21:35:28] <aturon> Gankro: so, to be clear, while there's some code complexity in Arc to deal with both make_unique and weak refs, there should be essentially no perf penalty (except perhaps if you use them together)
[21:35:35] <SimonSapin> if std::rc::Weak is remove, I‚Äôd like to have stable NonZero in exchange :)
[21:35:54] <Gankro> SimonSapin: I'm getting you ptr::Shared as a compromise
[21:36:23] <SimonSapin> Gankro: what‚Äôs that?
[21:36:38] <Gankro> SimonSapin: ptr::Unique but Arc and Rc can use it
[21:36:53] <bluss> sounds good
[21:36:57] <Gankro> (doesn't imply Send/Sync)
[21:37:27] <SimonSapin> Gankro: so it‚Äôs just struct Shared<T>(NonZero<*mut T>)?
[21:37:43] <Gankro> SimonSapin: It should have PhantomData<T> too for dropck
[21:37:56] <SimonSapin> uhm, ok
[21:38:11] <Gankro> SimonSapin: Also it's *const T for variance
[21:38:17] <SimonSapin> sounds good
[21:38:24] <bluss> oh right, Unique is based on *const T
[21:38:35] <SimonSapin> but there‚Äôs also drop flags
[21:38:36] <Gankro> Compiler ~magic~
[21:38:59] <Gankro> SimonSapin: ?
[21:39:15] <SimonSapin> drop flags make non-std Rc<T> 16 bytes instead of 8
[21:39:34] <Gankro> SimonSapin: use unsafe_no_drop_flags?
[21:39:47] <SimonSapin> not on stable
[21:40:06] <SimonSapin> though I suppose the crate could also have an `unstable` cargo feature
[21:45:54] <Gankro> SimonSapin: Yeah
[21:46:15] <Gankro> unsafe_no_drop_flag should be dead by the time Shared stabilizes
[21:47:48] <SimonSapin> so‚Ä¶ not before a lot more work is done?
[21:48:00] <SimonSapin> based on how Felix makes it sound
[21:48:11] <Gankro> drop hints just landed! :D
[21:49:01] <Gankro> sorry in meeting
[21:51:38] <bluss> yep the next step in that landed yesterday
[22:23:07] *** Quits: brson (brson@moz-u3dg2t.sfo1.mozilla.com) (Quit: leaving)
[22:25:25] <SimonSapin> Alright, updated https://github.com/SimonSapin/rust-rc#supporting-both-stable-and-unstable-rust
[22:25:36] <SimonSapin> to conditionally reexport std::rc
[22:26:59] <SimonSapin> TIL that multiple doc attributes (including desugared from doc-comments) are concatenated: https://github.com/SimonSapin/rust-rc/blob/2ada2bc2ec/src/lib.rs#L93-L95
[22:43:52] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[22:48:18] *** Joins: killercup (killercup@moz-4u70ka.dip0.t-ipconnect.de)
[22:56:56] <ChrisMorgan> SimonSapin: have you checked what rustdoc is outputting for that?
[22:57:16] <ChrisMorgan> You‚Äôre lacking a leading space, as I recall it, so it‚Äôll mess up the leading space detection.
[22:57:43] <ChrisMorgan> I did mention this very sort of thing in http://chrismorgan.info/blog/rust-cfg_attr.html ‚ò∫
[23:25:39] *** Quits: killercup (killercup@moz-4u70ka.dip0.t-ipconnect.de) (Quit: Bye)
[23:34:37] <bluss> SimonSapin: cool hack!
