[14:38:29] *** Joins: cmr (cmr@moz-35s2fm.members.linode.com)
[14:41:30] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[14:42:47] *** Quits: dstrbad_ (dstrbad@moz-avh.p6n.217.31.IP) (Ping timeout: 121 seconds)
[14:45:04] *** Joins: dstrbad (dstrbad@moz-avh.p6n.217.31.IP)
[14:45:48] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[14:49:04] *** Joins: dstrbad_ (dstrbad@moz-spcrsu.cable.xnet.hr)
[14:52:13] *** Quits: dstrbad (dstrbad@moz-avh.p6n.217.31.IP) (Ping timeout: 121 seconds)
[14:52:36] *** Joins: bjz (bjz@moz-puppgq.tpgi.com.au)
[14:53:20] *** Quits: zoosha (gmunoz@moz-e0j.3sr.79.167.IP) (Connection closed)
[14:54:29] *** Joins: evanfarrar (evanfarrar@moz-7vs.bl6.251.207.IP)
[14:55:51] *** Quits: evanfarrar (evanfarrar@moz-7vs.bl6.251.207.IP) (Connection closed)
[14:55:59] *** Joins: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at)
[14:55:59] *** Quits: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at) (Connection closed)
[14:56:06] *** Joins: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at)
[14:56:24] *** Joins: evanfarrar (evanfarrar@moz-7vs.bl6.251.207.IP)
[14:57:09] *** Joins: cakecatz (cakecatz@moz-rqfnlo.sannet.ne.jp)
[14:57:58] *** darkowlzz|afk is now known as darkowlzz
[15:00:08] *** Quits: fabrice (fabrice@moz-r84lgh.ca.comcast.net) (Ping timeout: 121 seconds)
[15:03:27] *** Quits: Pierre (Pierre@moz-lmh.0pq.89.116.IP) (Ping timeout: 121 seconds)
[15:03:28] *** Joins: Pierre_ (Pierre@moz-dof.4a8.48.199.IP)
[15:10:10] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[15:10:10] *** ChanServ sets mode: +o pcwalton
[15:12:19] *** Quits: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at) (Connection closed)
[15:13:04] <mmatyas> Hi, jdm, are you around?
[15:14:13] <jdm> mmatyas: yes
[15:15:09] *** Joins: findowxc (Mibbit@moz-juv.9o3.252.72.IP)
[15:15:23] <mmatyas> jdm, I have some issues regarding #4891. I'd like to use some structs defined in canvas/canvas_paint_task.rs for a [dom_struct] in script/dom/canvasgradient.rs, but they have to be jstraced for that.
[15:15:23] <crowbot1> Issue #4891: Implement canvas gradient - https://github.com/servo/servo/pull/4891
[15:16:07] <mmatyas> Is it possible to do do that, or how it should be handled?
[15:16:24] <jdm> mmatyas: you can add them to the list of no_jsmanaged_fields in http://mxr.mozilla.org/servo/source/components/script/dom/bindings/trace.rs#210
[15:16:54] <mmatyas> oh, ok
[15:17:56] *** Joins: ghservo (ghservo@moz-m9l.5u0.30.192.IP)
[15:17:56] -ghservo- [13servo] 15jdm opened issue #5187: Implement drop-shadow filter 02http://git.io/pRmp
[15:17:56] *** Parts: ghservo (ghservo@moz-m9l.5u0.30.192.IP) ()
[15:17:57] *** Quits: bogdan_maris (Instantbird@moz-662.esi.231.62.IP) (Client exited)
[15:19:36] *** Quits: je_julie (uid29643@moz-2q4j9e.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[15:22:07] *** Quits: findowxc (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[15:26:59] *** Joins: zoosha (gmunoz@moz-e0j.3sr.79.167.IP)
[15:34:30] *** Joins: gretchexd (Mibbit@moz-juv.9o3.252.72.IP)
[15:35:39] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[15:39:59] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[15:40:47] <mbrubeck> SimonSapin: Shouldn't this be `x = self.start.i - self.size.inline` ? https://github.com/servo/servo/blob/d31e80f89490afe4863574c062f34b2a0df43bae/components/util/logical_geometry.rs#L863
[15:40:56] *** Joins: fabrice (fabrice@moz-rlpj85.mh2d.1ibb.0101.2620.IP)
[15:41:05] <mbrubeck> No, wait, I see what it should be.
[15:41:45] <mbrubeck> We need to do `self.start.to_physical(container_size)` and *then* subtract `self.size`
[15:43:05] * mbrubeck double-checks whether the current code is equivalent to that
[15:43:56] <mbrubeck> it is
[15:44:13] *** Joins: MrZeus (Orestes@moz-n8pa5v.skybroadband.com)
[15:44:16] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[15:44:44] <mbrubeck> But these results still seem weird to me... https://pastebin.mozilla.org/8825004
[15:44:48] *** Joins: fabrice1 (fabrice@moz-7ftklp.ujol.1ibb.0101.2620.IP)
[15:44:58] *** Quits: fabrice (fabrice@moz-rlpj85.mh2d.1ibb.0101.2620.IP) (Ping timeout: 121 seconds)
[15:45:22] <mbrubeck> ah, the value of `rect.start.i` is the problem.
[15:45:51] *** Joins: ghservo (ghservo@moz-0l2.5u0.30.192.IP)
[15:45:51] -ghservo- [13servo] 15bors-servo pushed 2 new commits to 06auto: 02http://git.io/pRB2
[15:45:51] -ghservo- 13servo/06auto 14c98bca6 15M√°ty√°s Mustoha: Canvas: added arc().
[15:45:51] -ghservo- 13servo/06auto 14e8f1a04 15bors-servo: auto merge of #5185 : mmatyas/servo/canvas_arc, r=pcwalton...
[15:45:51] *** Parts: ghservo (ghservo@moz-0l2.5u0.30.192.IP) ()
[15:45:51] <mbrubeck> IRC is my rubber duckie
[15:46:14] *** Quits: jdm (jdm@moz-ilbt2e.cable.teksavvy.com) (Quit: )
[15:47:01] *** Quits: gretchexd (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[15:48:31] <tomaka> Hello
[15:48:34] * tomaka waves hand
[15:48:42] <Manishearth> o/ tomaka 
[15:48:58] <Manishearth> > IRC is my rubber duckie
[15:48:59] <tomaka> Are there plans to upload servo/rust-cocoa and servo/rust-core-foundation on crates.io?
[15:49:01] <Manishearth> this happens to me so often
[15:49:20] <Manishearth> tomaka: The unofficial policy is that we upload anything that others want to use
[15:49:23] <Manishearth> cc SimonSapin 
[15:49:39] *** AutomatedTester is now known as AutomatedTester|AFK
[15:49:49] <tomaka> the reason why I ask that is that they are dependencies of glutin
[15:50:14] <tomaka> I'm currently using a small script to upload glutin on crates.io by removing the support for OS/X
[15:50:31] <jack> tomaka: No one is signed up to do it, but I think the answer is that yes, we'll do it since several people want it.
[15:50:44] <tomaka> \o/
[15:51:06] <jack> Manishearth: have they been travisified?
[15:51:15] <Manishearth> jack: they are osx only ,right?
[15:51:22] <Manishearth> I'll have to get osx enabled for them
[15:51:34] <jack> Manishearth: correct.
[15:53:59] *** Joins: gandalf (zbraniecki@moz-cp7c4m.ca.comcast.net)
[15:54:02] *** Joins: azita (Azita@moz-cfhap5.mtv2.mozilla.com)
[15:54:46] *** Quits: caitp- (caitp@moz-lmogh4.cable.rogers.com) (Quit: Leaving)
[15:55:42] *** Joins: ghservo (ghservo@moz-l7j.5u0.30.192.IP)
[15:55:42] -ghservo- [13rust-cocoa] 15Manishearth created 06travis (+1 new commit): 02http://git.io/pR2O
[15:55:42] -ghservo- 13rust-cocoa/06travis 149b0108d 15Manish Goregaokar: Travisify
[15:55:42] *** Parts: ghservo (ghservo@moz-l7j.5u0.30.192.IP) ()
[15:55:52] *** Joins: ghservo (ghservo@moz-l7j.5u0.30.192.IP)
[15:55:52] -ghservo- [13rust-cocoa] 15Manishearth opened pull request #79: Travisify (06master...06travis) 02http://git.io/pR2n
[15:55:52] *** Parts: ghservo (ghservo@moz-l7j.5u0.30.192.IP) ()
[15:55:52] <Manishearth> jack: r?
[15:57:17] *** Joins: ghservo (ghservo@moz-abh.5u0.30.192.IP)
[15:57:17] -ghservo- [13rust-cocoa] 15Manishearth 04force-pushed 06travis from 149b0108d to 14bfdcf8b: 02http://git.io/pRaf
[15:57:17] -ghservo- 13rust-cocoa/06travis 14bfdcf8b 15Manish Goregaokar: Travisify
[15:57:17] *** Parts: ghservo (ghservo@moz-abh.5u0.30.192.IP) ()
[15:57:46] <SimonSapin> mbrubeck: that cool looks correct to me, and matches https://dxr.mozilla.org/mozilla-central/source/layout/generic/WritingModes.h#1690
[15:57:51] <tomaka> the problem with uploading rust-cocoa and rust-core-foundation on crates.io is that the names are already taken
[15:57:56] <Manishearth> huh
[15:57:58] <Manishearth> how?
[15:58:01] *** Joins: caitp- (caitp@moz-lmogh4.cable.rogers.com)
[15:58:19] <tomaka> https://crates.io/crates/cocoa
[15:58:26] <tomaka> https://crates.io/crates/core-foundation
[15:58:35] <tomaka> it's squatting, the crates are actually empty
[15:58:38] <Manishearth> oh!
[15:58:42] <Manishearth> that should be dealt with
[15:58:52] *** Joins: bholley (bholley@moz-qpv0dk.ca.comcast.net)
[15:59:17] <jack> Manishearth: why are there two commits?
[15:59:19] <jack> Was it a force push?
[15:59:42] <SimonSapin> Manishearth, tomaka: if we do that we should have someone who deals with keeping them running on nightly
[15:59:43] <Manishearth> jack: yes
[16:00:20] <jack> Manishearth: I r+ed, but will let you merge since travis failed.
[16:00:59] <Manishearth> jack: it's using the linux box, I need to ask them for osx to be enabled
[16:01:24] <tomaka> isn't the travis os/x queue full?
[16:02:12] <Manishearth> as in?
[16:02:27] <tomaka> I don't remember exactly, but they said that they are no long accepting new repos for the os/x builds
[16:02:53] <tomaka> but maybe that can be solved with an email, I don't know
[16:03:08] *** Quits: jviereck (Adium@moz-p826q4.ethz.ch) (Quit: Leaving.)
[16:03:16] <Manishearth> yeah, I'm trying
[16:03:42] *** Quits: acgtyrant (acgtyrant@moz-3kd.b79.160.124.IP) (Ping timeout: 121 seconds)
[16:05:38] *** Joins: eibwen (eibwen@moz-l622e8.dip0.t-ipconnect.de)
[16:06:43] *** Joins: hoverbear (hoverbear@moz-5n2fkb.cs.uvic.ca)
[16:07:38] *** Quits: hoverbear (hoverbear@moz-5n2fkb.cs.uvic.ca) (Connection closed)
[16:07:54] *** Joins: hoverbear (hoverbear@moz-5n2fkb.cs.uvic.ca)
[16:10:37] *** Joins: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at)
[16:11:00] *** Joins: sp3d (sp3d@moz-ik970v.enn1.s22b.000d.2601.IP)
[16:11:00] *** Quits: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at) (Connection closed)
[16:11:03] <Manishearth> jack: think we should email the squatter  or something?
[16:11:05] *** Joins: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at)
[16:11:35] <Manishearth> I've also pinged acrichto to see if there's any way to deal with this
[16:11:47] <Manishearth> it's not as malicious as it looks, it's only those three libraries that are squatted
[16:11:56] *** Quits: hoverbear (hoverbear@moz-5n2fkb.cs.uvic.ca) (Ping timeout: 121 seconds)
[16:12:06] <Manishearth> (somehow he couldn't find a descriotion for cocoa so he copied the one from wikipedia)
[16:20:07] <Manishearth> jack: acrichto says we need to reach out to him
[16:20:26] <jack> I can do that after this call
[16:20:59] <Manishearth> awesome
[16:22:00] *** Quits: caitp (caitp@moz-lmogh4.cable.rogers.com) (Quit: Leaving)
[16:22:33] *** Quits: gandalf (zbraniecki@moz-cp7c4m.ca.comcast.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[16:24:18] *** Joins: caitp (caitp@moz-mpt.s6m.112.174.IP)
[16:26:24] *** Joins: jviereck (Adium@moz-427efu.97ug.g469.067c.2001.IP)
[16:27:51] *** Joins: ghservo (ghservo@moz-abh.5u0.30.192.IP)
[16:27:51] -ghservo- [13servo] 15bors-servo closed pull request #5185: Canvas: added arc() support. (06master...06canvas_arc) 02http://git.io/pWKS
[16:27:51] *** Parts: ghservo (ghservo@moz-abh.5u0.30.192.IP) ()
[16:28:23] *** Joins: pcwalton (pcwalton@moz-u92.384.6.71.IP)
[16:28:23] *** ChanServ sets mode: +o pcwalton
[16:29:29] *** Joins: Doppp (Doppp@moz-89u.bf9.127.101.IP)
[16:29:49] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[16:30:37] *** Quits: Doppp (Doppp@moz-89u.bf9.127.101.IP) (Quit: leaving)
[16:34:09] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[16:38:00] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[16:39:33] *** ahal is now known as ahal|lunch
[16:40:29] *** Quits: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at) (Connection closed)
[16:40:31] * pcwalton rolls up his sleeves and goes to implement border-collapse
[16:41:22] *** Quits: dstrbad_ (dstrbad@moz-spcrsu.cable.xnet.hr) (A TLS packet with unexpected length was received.)
[16:42:25] *** Joins: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at)
[16:42:37] *** Quits: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at) (Connection closed)
[16:42:53] *** Joins: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at)
[16:48:20] *** Joins: dstrbad (dstrbad@moz-dpnt80.dsl.iskon.hr)
[16:48:43] *** Joins: Savago (Savago@moz-8hd.3b6.246.162.IP)
[16:50:52] <tomaka> While I'm at it, I planned to change the way the android glue works
[16:51:15] <tomaka> instead of providing a custom linker that outputs an .apk, it would be a wrapper around Cargo
[16:51:24] <tomaka> you'd have to call "cargo android build" for example
[16:51:41] <tomaka> would that be ok for servo? (I don't know anything about your build system)
[16:51:49] *** Joins: dstrbad_ (dstrbad@moz-kigcb1.dsl.iskon.hr)
[16:53:42] <mbrubeck> tomaka: Yeah, we can handle that.
[16:53:55] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[16:54:04] <tomaka> ok
[16:54:07] *** Quits: Savago (Savago@moz-8hd.3b6.246.162.IP) (Client exited)
[16:54:13] *** Joins: Savago (Savago@moz-8hd.3b6.246.162.IP)
[16:54:23] *** Quits: dstrbad (dstrbad@moz-dpnt80.dsl.iskon.hr) (Ping timeout: 121 seconds)
[16:54:47] <tomaka> But that's not going to happen soon, just a plan
[16:54:55] <Savago> Good morning.
[16:55:07] <tomaka> If I don't do that, there's no way to handle things like library name, API version, etc.
[16:55:15] <mbrubeck> tomaka: Right now if you set the `--android` option in Servo's build system, we run an extra command to build apkbuilder and then set some extra cargo options: https://github.com/servo/servo/blob/master/python/servo/build_commands.py#L64-L70
[16:55:31] <tomaka> Ok
[16:56:06] <mbrubeck> tomaka: By the way, for Firefox we find it invaluable to have the AndroidManifest.xml be preprocessed, so that you can set versions and package names and stuff at build time.
[16:56:20] <tomaka> yeah that's the reason for this change
[16:56:24] <mbrubeck> Cool.
[16:56:24] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Quit: Leaving...)
[16:56:30] *** Joins: wldcordeiro (wldcordeiro@moz-863roc.hfc.comcastbusiness.net)
[16:56:38] <SimonSapin>  tomaka: we already have mach that wraps cargo
[16:56:40] <SimonSapin> (kind of)
[16:56:51] *** Quits: evanfarrar (evanfarrar@moz-7vs.bl6.251.207.IP) (Connection closed)
[16:58:18] *** Joins: ProgramFOX (ProgramFOX@moz-6g2.vu0.180.91.IP)
[16:58:20] <tomaka> The emscripten crate that was posted yesterday on /r/rust already works like that
[16:58:24] <tomaka> it's a wrapper around Cargo
[16:58:29] *** Joins: evanfarrar (evanfarrar@moz-7vs.bl6.251.207.IP)
[16:59:43] <tomaka> by the way I'm surprised how well that emscripten thing works
[16:59:54] <tomaka> it could really be easy to compile servo for emscripten
[17:00:03] <tomaka> could be really easy*
[17:00:16] *** jandem is now known as jandem-away
[17:00:29] <eddyb> tomaka: are you trying to win the internet?
[17:00:36] <tomaka> :o)
[17:00:52] * tomaka wants to run Servo inside Servo
[17:01:03] <SimonSapin> tomaka: I heard that those who say it‚Äôs easy are those we should assign the task to ;)
[17:01:09] *** Joins: mccr8 (mccr8@moz-cfhap5.mtv2.mozilla.com)
[17:01:12] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[17:01:19] <tomaka> well, for the moment it's incredibly hacky
[17:01:38] <tomaka> I mean, setting up your environment
[17:01:48] <tomaka> you have to compile a fork of rust's stdlib and stuff
[17:03:12] <tomaka> What I mean by "really easy" is that you shouldn't get any weird error or such
[17:03:18] <tomaka> but it's not accessible
[17:05:37] *** Quits: jviereck (Adium@moz-427efu.97ug.g469.067c.2001.IP) (Quit: Leaving.)
[17:08:03] *** Quits: azita (Azita@moz-cfhap5.mtv2.mozilla.com) (Client exited)
[17:10:10] *** Quits: dstrbad_ (dstrbad@moz-kigcb1.dsl.iskon.hr) (A TLS packet with unexpected length was received.)
[17:10:52] *** Joins: azita (Azita@moz-cfhap5.mtv2.mozilla.com)
[17:10:53] *** Quits: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at) (Connection closed)
[17:11:12] *** Quits: bholley (bholley@moz-qpv0dk.ca.comcast.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzz‚Ä¶)
[17:12:52] <Manishearth> eddyb: visit chrome://browser/content/browser.xul
[17:12:55] <Manishearth> in firefox
[17:13:09] <eddyb> yeah, but that's how firefox is implemented
[17:13:17] <Manishearth> heh
[17:13:26] <eddyb> it's not running the C++ code in JS
[17:13:31] <Manishearth> I know, I know
[17:14:35] *** Joins: jviereck (Adium@moz-p826q4.ethz.ch)
[17:20:39] *** Joins: gozala (uid5923@moz-ftm4af.brockwell.irccloud.com)
[17:21:20] *** Quits: pcwalton (pcwalton@moz-u92.384.6.71.IP) (Client exited)
[17:23:11] *** Quits: evanfarrar (evanfarrar@moz-7vs.bl6.251.207.IP) (Connection closed)
[17:24:01] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[17:28:18] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[17:29:23] *** Joins: hoverbear (hoverbear@moz-0u6m5b.wireless.uvic.ca)
[17:29:41] *** Joins: mahdi (mahdi@moz-r6u.rt1.244.151.IP)
[17:31:52] *** Joins: mib_g0618v (Mibbit@moz-juv.9o3.252.72.IP)
[17:33:40] *** Joins: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at)
[17:33:40] *** Quits: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at) (Connection closed)
[17:33:41] *** Joins: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at)
[17:34:09] *** Quits: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at) (Connection closed)
[17:34:09] *** Joins: dinfuehr_ (dinfuehr@moz-l21rck.highway.telekom.at)
[17:38:39] *** Quits: hoverbear (hoverbear@moz-0u6m5b.wireless.uvic.ca) (Quit: Time to hibernate.... ZzZz...)
[17:38:42] *** ahal|lunch is now known as ahal
[17:40:26] *** Quits: cakecatz (cakecatz@moz-rqfnlo.sannet.ne.jp) (Quit: My Mac has gone to sleep. ZZZzzz‚Ä¶)
[17:40:30] *** Quits: dinfuehr_ (dinfuehr@moz-l21rck.highway.telekom.at) (Connection closed)
[17:40:44] *** Joins: dbaron (dbaron@moz-rb4k89.dynamic.fusionbroadband.com)
[17:42:07] <mbrubeck> Wait, Hacker News user "gw" is a Rust programmer who is not our gw? https://news.ycombinator.com/user?id=gw
[17:42:25] *** Quits: mib_g0618v (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[17:43:48] *** Joins: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at)
[17:43:48] *** Quits: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at) (Connection closed)
[17:43:50] *** Joins: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at)
[17:44:00] *** Quits: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at) (Connection closed)
[17:44:16] *** Joins: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at)
[17:49:19] *** Joins: hoverbear (hoverbear@moz-0u6m5b.wireless.uvic.ca)
[17:49:50] <Manishearth> nice
[17:50:03] <Manishearth> I suspect they're the same person
[17:50:11] <Manishearth> its all a conspiracy
[17:50:37] *** Joins: bholley (bholley@moz-qpv0dk.ca.comcast.net)
[17:55:14] *** Joins: chmanchester (Chris@moz-jf6c0f.2rkg.9kg1.0101.2620.IP)
[17:55:21] <larsberg> ms2ger: a rust shapsnhot for d3c49d2140fc65e8bb7d7cf25bfe74dda6ce5ecf is now available
[17:59:21] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[17:59:21] *** ChanServ sets mode: +o pcwalton
[17:59:51] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[18:00:02] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[18:00:02] *** ChanServ sets mode: +o pcwalton
[18:01:33] *** Joins: brson (brson@moz-obm.e0n.56.172.IP)
[18:01:34] *** ChanServ sets mode: +o brson
[18:04:56] *** Joins: Jackneill (Jackneill@moz-t0gd1f.pool.digikabel.hu)
[18:05:10] *** Joins: jdm (jdm@moz-i5m.05u.207.66.IP)
[18:05:10] *** ChanServ sets mode: +qo jdm jdm
[18:07:10] *** Quits: caitp (caitp@moz-mpt.s6m.112.174.IP) (Ping timeout: 121 seconds)
[18:09:03] *** Joins: curmetx (Mibbit@moz-juv.9o3.252.72.IP)
[18:11:06] *** Quits: curmetx (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[18:14:14] *** Joins: Nefzaoui (nefzaoui_@moz-upt.01b.0.197.IP)
[18:17:55] *** Quits: hoverbear (hoverbear@moz-0u6m5b.wireless.uvic.ca) (Quit: Time to hibernate.... ZzZz...)
[18:18:09] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[18:22:29] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[18:22:39] *** Joins: hoverbear (hoverbear@moz-0u6m5b.wireless.uvic.ca)
[18:23:14] *** Quits: Heavensrevenge (Eric@moz-sn8mv3.abhsia.telus.net) (Quit: Leaving)
[18:28:47] *** Quits: jviereck (Adium@moz-p826q4.ethz.ch) (Quit: Leaving.)
[18:30:52] *** Quits: bholley (bholley@moz-qpv0dk.ca.comcast.net) (Quit: Textual IRC Client: www.textualapp.com)
[18:31:10] *** Joins: njn (chatzilla@moz-i76q70.iinet.net.au)
[18:33:32] *** Joins: evanfarrar (evanfarrar@moz-56vd31.res.rr.com)
[18:33:38] <njn> jdm: I'm guessing that the `Node` type is the most important one to measure in the ScriptTask, in terms of bytes consumed?
[18:34:53] <njn> jdm: and I get to them via ScriptTask::page::frame::document::node
[18:34:55] <njn> ?
[18:35:39] <jdm> njn: more or less, yes
[18:36:07] <njn> jdm: I'm also guessing that from my P.o.v., JS<T> is much like Box<T>?
[18:36:25] <jdm> njn: I mean, Document is a Node, so we would want to measure the size of the concrete type of each Node-derived object
[18:36:50] <jdm> njn: yes.
[18:36:51] <njn> "document is a node"?
[18:37:09] <jdm> njn: the Node field of Document is equivalent to class Node : public Document in C++
[18:37:22] <njn> poor man's inheritance, sure
[18:37:38] <njn> what other such node-derived objects are there?
[18:37:41] *** Quits: evanfarrar (evanfarrar@moz-56vd31.res.rr.com) (Ping timeout: 121 seconds)
[18:38:09] <jdm> njn: http://mxr.mozilla.org/servo/search?string=%3A+node&find=\.webidl&findi=&filter=^[^\0]*%24&hitlimit=&tree=servo
[18:38:39] <njn> jdm: great, thank you
[18:38:44] <jdm> njn: and then HTMLElement derives from Element, and all of the specific html elements derive from that
[18:39:24] <jdm> njn: http://mxr.mozilla.org/servo/source/components/script/dom/node.rs#263 accurately represents the full hierarchy
[18:40:09] <njn> jdm: I don't understand the Simple vs. Children dichotomy for NodeList
[18:40:18] <njn> *NodeListType
[18:40:48] <jdm> njn: Simple is a straight up list of arbitrary nodes, Children is a live list of children of a particular parent
[18:41:03] *** Quits: brson (brson@moz-obm.e0n.56.172.IP) (Ping timeout: 121 seconds)
[18:41:32] *** Joins: brson (brson@moz-obm.e0n.56.172.IP)
[18:41:32] *** ChanServ sets mode: +o brson
[18:41:53] * njn scratches head
[18:42:33] <njn> jdm: I figure that, again from my P.O.V., I just traverse and measure them in the obvious way?
[18:42:40] *** Joins: mib_b8cthl (Mibbit@moz-juv.9o3.252.72.IP)
[18:42:40] <njn> i.e. it's just a tree, really
[18:43:12] <jdm> njn: yes, but you won't want to measure the Children variant or you'll get cycles :)
[18:43:27] <jdm> oh wait
[18:43:33] <jdm> njn: sorry, JS<T> != Box<T>
[18:43:37] <jdm> since Box is unique
[18:43:53] <jdm> JS<T> == Rc<T>
[18:44:02] <njn> ah, ok
[18:44:05] <jdm> it's basically just SpiderMonkey's Heap pointers
[18:44:06] *** Quits: dinfuehr (dinfuehr@moz-l21rck.highway.telekom.at) (Connection closed)
[18:44:16] *** Quits: capella (chatzilla@moz-a6lqme.res.rr.com) (Ping timeout: 121 seconds)
[18:44:22] <njn> so deciding which referent is the "owner" is a big part of measuring this stuff?
[18:44:30] <jdm> right
[18:44:40] <njn> is there an easy way to tell in general?
[18:44:45] <jdm> so the pointers in Node are definitely the owners
[18:44:47] *** Quits: dbaron (dbaron@moz-rb4k89.dynamic.fusionbroadband.com) (Ping timeout: 121 seconds)
[18:44:49] <jdm> in general? no.
[18:44:56] * kmc just finished reading http://aosabook.org/en/posa/memshrink.html :)
[18:45:32] <jdm> njn: I mean, we could add annotations that could be used for automatically deriving these things
[18:45:37] <njn> jdm: so Node::child_list ?
[18:45:47] <njn> jdm: just recursively go through that?
[18:46:50] <jdm> njn: counting the nodes in that will double-count the children of that node
[18:47:47] <njn> jdm: I still don't understand NodeListType, then :
[18:47:49] <njn> :(
[18:48:23] <jdm> njn: NodeList is used in weird ways. It's either a list of particular nodes, or just a reference to a particular node for which it acts as a proxy to its children
[18:48:26] *** Joins: caitp (caitp@moz-lmogh4.cable.rogers.com)
[18:48:41] <jdm> so in the former, it might end up being the owner of a node if there are no other references to it left
[18:48:43] <jack> njn!
[18:48:55] <njn> jack!
[18:48:58] <jdm> in the second case, it is really just an intermediary to the parent node
[18:49:09] <jack> njn: I am unable to reproduce your memory leaks so far, so I was hoping you could assist me in making them appear.
[18:49:23] *** Joins: mkcp (mkcp@moz-5ln.0t9.55.68.IP)
[18:49:49] <jack> I was curious how you built/ran servo and what massif commandline you used. I figured I would start there.
[18:50:21] <njn> jack: run Servo with -m 1;  load the GotG page from servo-static-suite;  move the mouse cursor around a bunch within the window;  watch the jemalloc numbers in the -m 1 output skyrocket
[18:50:43] <njn> jack: default builds reproduce it for me, as do -r builds
[18:51:40] <njn> jack: the default massif command (e.g. `valgrind --tool=massif`) should suffice, though if you can't reproduce there's not much point looking at its output
[18:51:53] <jack> Ok. Trying that now
[18:51:55] <njn> jdm: that's all a bit confusing
[18:52:26] <njn> jack: I'm pretty sure I could repro on Mac and Linux, though I haven't tried Mac for a while
[18:52:45] <jdm> njn: can you clarify what's confusing about it?
[18:53:10] <njn> jdm: I just want to traverse the nodes, measuring each one once
[18:53:26] <njn> jdm: your text above makes it sound like that is difficult, but maybe I misunderstood
[18:54:04] <jdm> njn: in the general case, I suspect that ensuring that each node is measured once is challenging
[18:55:02] <jdm> I mean, in the case of Node::child_list, measuring the size of the NodeList is valuable, but measuring the node contained within the Children variant will cause the node to be measured at least twice
[18:55:16] <jdm> since the contained node is the node that owns the NodeList in this case
[18:55:33] <njn> jdm: so just ignore the Children variant, but measure Simple in the obvious way?
[18:55:59] <jdm> njn: that would work in this case
[18:56:58] <jdm> njn: I mean, the problem with measuring Simple in the obvious way is that the NodeList may not be the "owner" of said nodes
[18:57:12] <jdm> so if they're also nodes in the tree, they'll be double-counted
[18:57:26] * jdm can't imagine that gecko has solved this problem either
[18:58:05] <jdm> so the upside here is that there are no other NodeList fields in servo right now
[18:58:08] <jdm> so it's kind of a moot point
[18:58:10] *** Quits: mib_b8cthl (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[18:59:41] <njn> jdm: Gecko appears to do just fine
[18:59:50] *** Joins: jviereck (Adium@moz-q6h9e7.dynamic.hispeed.ch)
[18:59:53] * jdm isn't sure what that means
[19:00:09] <jdm> Gecko doesn't have unique pointers either
[19:00:39] <kmc> really?
[19:00:40] *** Quits: Nefzaoui (nefzaoui_@moz-upt.01b.0.197.IP) (Connection closed)
[19:01:29] <jdm> kmc: yeah, gecko uses an inversion of our design - everything is a refcounted pointer to a C++ object, with JS reflectors acting as an additional strong reference
[19:01:53] *** Joins: Nefzaoui (nefzaoui_@moz-bqi.88t.0.197.IP)
[19:02:38] <Manishearth> bahaha
[19:02:39] *** mdoglio is now known as mdoglio|bbl
[19:02:47] <Manishearth> inversion of our design
[19:02:56] <Manishearth> that sounds like a disaster waiting to happen
[19:03:01] <Manishearth> or a disaster that happened years ago
[19:03:03] <larsberg> servo = gecko^{-1}
[19:03:09] *** Quits: hoverbear (hoverbear@moz-0u6m5b.wireless.uvic.ca) (Quit: Time to hibernate.... ZzZz...)
[19:03:21] <Manishearth> servo = o√ä¬û√â¬î√á¬ù√Ü¬É
[19:03:23] <Manishearth> bah
[19:04:59] <njn> jack: reproducing?
[19:05:26] <kmc> jdm: is that just for the DOM or are there really no uniquely-owned heap allocations in gecko?
[19:05:37] <jdm> kmc: just the DOM
[19:05:53] <jdm> and anything XPCOM
[19:06:21] *** Joins: hoverbear (hoverbear@moz-0u6m5b.wireless.uvic.ca)
[19:07:05] <njn> jdm: what I  mean is that Gecko measures its DOM nodes without problem, plus it has DMD to verify that it's not double-counting anything
[19:10:06] <Manishearth> jdm: so...everything?
[19:10:19] <jdm> Manishearth: no, there are a couple nsAutoPtr values :)
[19:10:22] <Manishearth> haha
[19:12:18] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[19:12:51] *** Joins: eddyb_ (eddyb@moz-76s.sgj.26.188.IP)
[19:12:55] *** Joins: mudpitxc (Mibbit@moz-juv.9o3.252.72.IP)
[19:15:13] *** Quits: mudpitxc (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[19:15:21] *** Quits: eddyb (eddyb@moz-1i0.6n6.26.188.IP) (Ping timeout: 121 seconds)
[19:15:42] <jack> njn: I see the numbers increasing.
[19:16:04] <jack> up to 5GiB so far
[19:16:09] <njn> jack: yeah, that's it :)
[19:16:25] <jack> I stopped wiggling the mouse a while ago and it continues to climb
[19:16:36] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[19:16:43] <jack> 8GiB now
[19:16:45] <njn> jack: in my experience it plateaus eventually once you stop wiggling
[19:17:02] <jdm> doctor, it hurts when I wiggle
[19:17:17] <jdm> let's just remove mouse input
[19:17:30] <jack> 10GiB and still going up. Having touched it :(
[19:17:39] <jack> There it goes. It just went below 10
[19:17:47] <njn> jack: I haven't seen it go down
[19:18:54] <jack> it peaked at 9999 or so and fell back to 9600
[19:19:15] <jack> Do you get a leak at all if you don't wiggle the mouse?
[19:19:21] <njn> jack: I don't think so
[19:19:34] *** Joins: isra17 (isra17@moz-ghn.p5r.63.137.IP)
[19:19:38] <jack> Ok, I might have been trying without that assumign that any reflow would cause the problem.
[19:19:52] <jack> (It reflows for every image loaded, so there are multiple without moving the mouse)
[19:20:09] <njn> jack: yeah, just starting the GotG page and not interacting with it, my memory usage is flat (after the initial rendering spike)
[19:20:15] <njn> flat at about 450 MiB
[19:20:26] <jack> But does massif show a leak there?
[19:20:39] <njn> 450 mapped; 330 allocated, that is
[19:20:46] <njn> jack: define leak?
[19:20:49] <jack> I put a bunch of debugging around some of the leaking structures and couldn't find a mismatched alloc/free pair.
[19:21:14] <jack> Basically during reflow, tons would get alloced and then at the end they were all freed as expected.
[19:21:16] *** Quits: jviereck (Adium@moz-q6h9e7.dynamic.hispeed.ch) (Quit: Leaving.)
[19:21:18] <njn> massif just takes snapshots of the live heap
[19:21:54] <jack> I logged all the allocs and frees and their pointer values and then sorted/awked everything and it all lined up.
[19:22:01] <njn> and jemalloc-heap-allocated is similar; if it's going up, it means you have more live allocations
[19:22:25] <njn> jack: how did you log them?
[19:22:49] <jack> impl Drop for LineBreaker and then in the one place linebreaker is allocated I put a println!
[19:23:14] <jack> I also put a println! at the end of LineBreaker's scope just to make sure it was getting freed where I expected.
[19:23:23] <jack> Just a sec, I'll send you the patch
[19:23:56] <jack> https://www.irccloud.com/pastebin/3RbHozxx
[19:26:32] <njn> jack: ok, so LineBreaker isn't leaking... something else must be
[19:26:34] <jack> I used grep, sort, and awk to put the logging into a form you coudl check and verified everythign was divisible by 3 (for the three lines of logging for each pointer value)
[19:26:48] <jack> That worked out
[19:28:17] <njn> jack: sure. These data structures are complicated. You've analyzed one small part of them.
[19:28:20] <jack> You're right of course. I got so focused on this I forgot the reported leak is one level down.
[19:28:42] <jack> LineBreaker::new_fragments is the actual leaked thing.
[19:28:52] *** Quits: yusukesuzuki (yusukesuzuk@moz-dt1lc7.t-com.ne.jp) (Ping timeout: 121 seconds)
[19:28:55] <jack> It *should* be freed when linebreaker is freed. But it's not happening.
[19:29:57] *** Joins: nrc (nrc@moz-4bhi2i.xtra.co.nz)
[19:31:12] <njn> jack: new_fragments gets transferred to old_fragments
[19:31:26] <njn> jack: which ends up in flow.fragments
[19:31:28] <jack> Or maybe even that assumption is wrong. The line in your stack trace is 12.37% (416,066,304B) 0x4C4D59: inline::LineBreaker::push_fragment_to_line::h8427161d01247e36aBm (inline.rs:690)
[19:31:50] <jack> So I assume it must be the vector that is leaking, not the actual fragments themselves
[19:32:00] *** Joins: yusukesuzuki (yusukesuzuk@moz-dt1lc7.t-com.ne.jp)
[19:32:47] <njn> jack: yes, I believe it's the vector elements that are showing up
[19:32:53] <jack> Because Vec::push only allocates when it needs a bigger size.
[19:32:58] <njn> but if that's leaking, the elements could well be too
[19:36:02] *** Quits: hoverbear (hoverbear@moz-0u6m5b.wireless.uvic.ca) (Quit: Time to hibernate.... ZzZz...)
[19:36:43] <jack> Looks like I can do the same debugging on InlineFragments now which is the new owner.
[19:36:51] *** Joins: dstrbad (dstrbad@moz-kigcb1.dsl.iskon.hr)
[19:37:07] *** Quits: dstrbad (dstrbad@moz-kigcb1.dsl.iskon.hr) (A TLS packet with unexpected length was received.)
[19:38:42] *** Quits: garvank (Garvan@moz-1fp.d2n.140.24.IP) (Quit: )
[19:38:52] *** Joins: garvank (Garvan@moz-1fp.d2n.140.24.IP)
[19:39:19] <njn> jack: the reason I chose to measure the flow tree first was because I was hoping to catch some of this stuff. But I get 13 MiB for the flow tree for the GotG page and it doesn't go up
[19:39:32] <njn> jack: it's possible I'm missing relevant parts of the flow tree
[19:40:03] <jack> Flow tree is ref counted though right?
[19:40:26] <jack> So if it's a leak then you wouldn't have a pointer to the leaked node but it's refcount may still be nonzero
[19:40:41] <jack> I'm assuming that flows are disappearing somewhere
[19:41:50] <larsberg> http://i.imgur.com/wXUCyQh.jpg
[19:42:33] *** Joins: gw (uid31717@moz-hcr55a.charlton.irccloud.com)
[19:42:33] *** ChanServ sets mode: +o gw
[19:44:59] <njn> which thread owns the display list? how can I get access to the its root?
[19:45:19] *** AutomatedTester|AFK is now known as AutomatedTester
[19:45:19] <njn> DisplayList::new() is called from several places
[19:46:20] <jack> It's built in parallel.
[19:46:25] <njn> looks like the DisplayList is within the Flow tree?
[19:46:38] <jack> At some point it is passed to the render threads.
[19:46:49] <jack> I can't remember if it's cached
[19:46:52] *** Quits: ProgramFOX (ProgramFOX@moz-6g2.vu0.180.91.IP) (Quit: ChatZilla 0.9.91.1 [Firefox 36.0.1/20150305021524])
[19:47:38] <njn> "show me your code and I will be mystified; show me your data structures and you won't need to show me your code because it will be self-evident"
[19:47:56] <larsberg> kmc: from that article, there was a definition of clownshoes, "Ironically the instrumentation needed to keep track of memory consumption ends up doubling consumption while causing significant underreporting. We refer to these sorts of bugs as ‚Äúclownshoes‚Äù because they are both comically bad and result in lots of wasted empty space, just like a clown‚Äôs
[19:47:57] <larsberg> shoes."
[19:47:58] * njn can barely find Servo's data structures ATM
[19:48:03] * larsberg has been using it wrong all this time...
[19:48:12] <kmc> yeah I liked that :)
[19:48:20] <njn> larsberg: https://blog.mozilla.org/nnethercote/2011/08/05/clownshoes-available-in-sizes-2101-and-up/
[19:48:21] <cmr> njn: I also have that problem
[19:48:30] <njn> larsberg: that's a narrowing of the general term
[19:48:47] *** Joins: jviereck (Adium@moz-q6h9e7.dynamic.hispeed.ch)
[19:48:51] <njn> larsberg: see the last paragraph of the blog post
[19:49:20] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[19:49:26] <jack> njn: layout_task:711 seems to be right after it's built
[19:49:47] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[19:49:47] *** ChanServ sets mode: +o pcwalton
[19:49:56] <jack> It allocs a DisplayList and then copies the displaylist result it built in parallel into that list
[19:50:43] <njn> jack: it ends up in the stacking_context?
[19:50:48] <njn> which is in the rw_data
[19:50:54] <jack> Then it creates a stacking context and appears to cache it, and then send the original over to the renderers on line 736
[19:52:07] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Ping timeout: 121 seconds)
[19:52:07] <njn> jack: if I can measure it from LayoutTask::rw_data, that doesn't look too hard
[19:52:14] <njn> s/from/via/
[19:52:22] *** Quits: psd (psd@moz-acc.mpg.78.202.IP) (Quit: Leaving)
[19:52:33] *** Joins: dbaron (dbaron@moz-opoj56.2rkg.9kg1.0101.2620.IP)
[19:52:55] <jack> yeah, it appears to be cached there.
[19:53:09] <njn> jack: great, thank you;  I will try that
[19:53:17] * njn will have to disappear for a couple of hours very soon
[19:53:19] *** Quits: sav (e@moz-9u3te2.cc) (Ping timeout: 121 seconds)
[19:53:23] *** Joins: dstrbad (dstrbad@moz-kigcb1.dsl.iskon.hr)
[19:53:36] <larsberg> njn: Thanks for the pointer :-)
[19:56:40] *** Joins: sav (e@moz-9u3te2.cc)
[19:58:12] *** Quits: ttaubert (uid2620@moz-6d2u0s.uxbridge.irccloud.com) (Quit: )
[19:59:38] <jack> https://www.irccloud.com/pastebin/MJE0F5AE
[20:00:03] <jack> Why can't I move out of a struct that impls Drop?
[20:00:51] <jack> Because Drop logic might want to access those fields?
[20:03:04] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[20:06:30] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[20:09:55] *** Quits: dstrbad (dstrbad@moz-kigcb1.dsl.iskon.hr) (A TLS packet with unexpected length was received.)
[20:10:05] *** Quits: isra17 (isra17@moz-ghn.p5r.63.137.IP) (Client exited)
[20:10:48] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[20:19:06] *** Joins: mib_ojfhzb (Mibbit@moz-juv.9o3.252.72.IP)
[20:22:19] *** darkowlzz is now known as darkowlzz|afk
[20:23:10] *** Quits: mib_ojfhzb (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[20:24:02] <kmc> jack: yes
[20:24:41] *** Quits: Jackneill (Jackneill@moz-t0gd1f.pool.digikabel.hu) (A TLS packet with unexpected length was received.)
[20:25:23] *** Joins: hoverbear (hoverbear@moz-a97.b2m.54.96.IP)
[20:25:28] *** chmanchester is now known as chmanchester|lunch
[20:25:47] *** Joins: chc4 (chc4@moz-pdo0at.ma.comcast.net)
[20:26:49] <kmc> typical solution is to make it an Option<T> field and call .take()
[20:27:08] <kmc> if the destructor needs to explicitly check whether the field was moved, it can
[20:30:45] *** darkowlzz|afk is now known as darkowlzz
[20:31:24] *** darkowlzz is now known as darkowlzz|afk
[20:31:29] <larsberg> the option dance returns
[20:32:45] <kmc> for a Vec you can also replace it with empty
[20:35:50] *** Joins: laumann_ (thomas@moz-n9e72h.0.fullrate.dk)
[20:36:00] <jack> yeah. that's what happens elsewhere currently.
[20:36:57] * jdm has been using the option dance with unusually often recently
[20:37:03] <jdm> s/with//
[20:38:36] <jdm> Manishearth: do you feel like reviewing the async networking stuff?
[20:43:37] *** Joins: gsingh93 (gulshan@moz-3fu4am.mi.comcast.net)
[20:46:56] *** Quits: palodequeso (quassel@moz-ebjt83.hfc.comcastbusiness.net) (Ping timeout: 121 seconds)
[20:49:57] *** Joins: crowbot (nodebot@moz-c6copg.compute-1.amazonaws.com)
[20:49:58] *** Quits: crowbot1 (nodebot@moz-uhl85r.compute-1.amazonaws.com) (Connection closed)
[20:54:31] *** Joins: capella (chatzilla@moz-a6lqme.res.rr.com)
[20:56:10] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[20:59:40] <gw> jdm: do you know if it's spec'ed what happens to navigation history if iframe.src is changed multiple times very quickly? should a pending iframe load that gets overridden be added to the history?
[21:00:34] <jdm> :))))))))
[21:00:38] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[21:00:44] * jdm finds some links
[21:01:14] *** Quits: capella (chatzilla@moz-a6lqme.res.rr.com) (Ping timeout: 121 seconds)
[21:01:16] *** Quits: zoosha (gmunoz@moz-e0j.3sr.79.167.IP) (Quit: leaving)
[21:02:33] *** Quits: ahal (ahal@moz-blga2k.cpe.pppoe.ca) (Quit: Leaving)
[21:02:49] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[21:02:49] *** ChanServ sets mode: +o pcwalton
[21:03:00] <jdm> gw: see https://html.spec.whatwg.org/multipage/embedded-content.html#process-the-iframe-attributes starting at "Any navigation required of the user agent in the process the iframe attributes"
[21:03:23] <gw> jdm: thanks!
[21:03:36] <jdm> gw: similarly, that links to https://html.spec.whatwg.org/multipage/browsers.html#navigate which includes step 4 which seems relevant
[21:04:56] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[21:05:10] <jdm> https://html.spec.whatwg.org/multipage/browsers.html#concept-navigate-mature :D
[21:06:10] <jdm> gw: also https://html.spec.whatwg.org/multipage/browsers.html#update-the-session-history-with-the-new-page is very relevant
[21:06:44] <jdm> as is https://html.spec.whatwg.org/multipage/browsers.html#history-traversal
[21:07:02] <jdm> and https://html.spec.whatwg.org/multipage/browsers.html#history-traversal
[21:08:45] <pcwalton> jdm: does the async networking essentially make the interface of net production quality in that it won't change much more in the future?
[21:09:16] <jdm> pcwalton: hopefully!
[21:09:42] <pcwalton> i.e. can I make it sandbox-safe?
[21:11:19] <jdm> pcwalton: I believe so. Could you take a look at the design to identify any sandboxing problems?
[21:11:36] <pcwalton> jdm: no problem, I'll take a look later today :)
[21:11:46] <jdm> pcwalton: I'll link to the privileged code and sandboxed code if you'd like
[21:11:54] <pcwalton> that'd be really helpful
[21:12:59] <larsberg> pcwalton: fyi, I'm picking up two of the layout reviews from SimonSapin and will finish them off tomorrow
[21:13:06] <pcwalton> larsberg: oh, cool
[21:13:08] <pcwalton> thanks!
[21:13:25] <larsberg> np, sorry for the delay!
[21:16:49] *** kimundi is now known as zz_kimundi
[21:18:24] *** Joins: capella (chatzilla@moz-20t.a68.87.66.IP)
[21:18:49] *** eddyb_ is now known as eddyb
[21:18:54] *** Joins: PolloLoco (Mibbit@moz-0ft.ur1.206.74.IP)
[21:21:03] *** Joins: brendan (brendaneich@moz-0gq.0rd.102.38.IP)
[21:21:10] <jdm> pcwalton: ok, added a comment with links to the PR
[21:21:18] <pcwalton> jdm: cool, thanks
[21:23:23] *** Joins: dinfuehr (dinfuehr@moz-6jjoqr.highway.telekom.at)
[21:28:11] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[21:31:03] *** Quits: PolloLoco (Mibbit@moz-0ft.ur1.206.74.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[21:35:14] *** Quits: capella (chatzilla@moz-20t.a68.87.66.IP) (Ping timeout: 121 seconds)
[21:38:00] *** Quits: mahdi (mahdi@moz-r6u.rt1.244.151.IP) (Connection closed)
[21:38:38] *** Quits: wldcordeiro_ (wldcordeiro@moz-863roc.hfc.comcastbusiness.net) (Connection closed)
[21:39:21] *** Joins: wldcordeiro_ (wldcordeiro@moz-863roc.hfc.comcastbusiness.net)
[21:39:50] * njn realizes that "manis-hearth" is probably actually "manish-earth"
[21:40:56] <pcwalton> yes, it is
[21:40:59] * jdm had that realization at one point too
[21:41:00] <pcwalton> everyone gets confused with that :)
[21:42:25] *** Quits: wldcordeiro (wldcordeiro@moz-863roc.hfc.comcastbusiness.net) (Ping timeout: 121 seconds)
[21:42:59] * njn waits for manishmars
[21:44:35] *** Joins: zoosha (gmunoz@moz-e0j.3sr.79.167.IP)
[21:47:04] *** Joins: eddyb_ (eddyb@moz-mmq.pug.25.188.IP)
[21:47:29] *** Quits: eddyb (eddyb@moz-76s.sgj.26.188.IP) (Ping timeout: 121 seconds)
[21:47:31] *** Joins: capella (chatzilla@moz-20t.a68.87.66.IP)
[21:49:16] <njn> pcwalton: does "display list" really mean "multiple DisplayLists within StackingContexts"?
[21:49:25] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[21:49:52] <pcwalton> njn: each StackingContext contains a DisplayList, which can itself contain child StackingContexts
[21:49:55] <pcwalton> the root of the whole tree is StackingContext
[21:50:16] <njn> pcwalton: so if I say "I want to measure the display list" I should really measure all the children, too?
[21:50:49] <pcwalton> yeah, you should
[21:50:58] <njn> pcwalton: StackingContext has this field:
[21:51:00] <njn>     pub layer: Option<Arc<PaintLayer>>,
[21:51:08] <njn> is that part of the "display list"?
[21:51:21] <njn> or is it a non-owning reference?
[21:51:30] <pcwalton> yeah, I'd count that too. that describes information needed to create the hardware layer for that stacking context
[21:51:32] <pcwalton> if there is one
[21:52:36] <njn> pcwalton: ok, thank you
[21:52:52] <cmr> memshrink already? ;)
[21:53:11] <jdm> it'll be memshrunk by the time we launch
[21:53:14] <njn> cmr: #4915
[21:53:14] <crowbot> Issue #4915: Arbitrarily high physical memory usage while scrolling - https://github.com/servo/servo/issues/4915
[21:53:43] <njn> cmr: so yeah, I've been badgering everyone here about this stuff for weeks now
[21:53:55] <njn> one day I might even land some code
[21:54:33] <cmr> relevent: http://servomemes.tumblr.com/post/79357480162/eddyb-has-feelings-about-how-long-servo-goes
[21:56:41] <njn> pcwalton: I'm trying to understand the locking of LayoutTask::rw_data
[21:56:59] <pcwalton> I don't fully understand it myself
[21:57:06] <pcwalton> I want to rewrite that stuff :)
[21:58:23] <njn> pcwalton: O_o
[21:58:33] * njn just wants to traverse that data structure
[21:59:41] * njn starts cargo-culting
[22:03:21] *** Quits: laumann_ (thomas@moz-n9e72h.0.fullrate.dk) (Quit: leaving)
[22:04:45] *** Quits: mccr8 (mccr8@moz-cfhap5.mtv2.mozilla.com) (Connection closed)
[22:04:57] *** Joins: mccr8 (mccr8@moz-cfhap5.mtv2.mozilla.com)
[22:09:28] *** Joins: gandalf (zbraniecki@moz-cp7c4m.ca.comcast.net)
[22:10:49] *** Quits: hoverbear (hoverbear@moz-a97.b2m.54.96.IP) (Quit: Time to hibernate.... ZzZz...)
[22:11:02] *** Quits: jviereck (Adium@moz-q6h9e7.dynamic.hispeed.ch) (Quit: Leaving.)
[22:14:09] *** Joins: hoverbear (hoverbear@moz-a97.b2m.54.96.IP)
[22:18:10] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[22:20:22] *** Quits: gozala (uid5923@moz-ftm4af.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[22:21:06] <larsberg> cmr: we have a snapshot, but everybody's got a lot going on and we're trying to land all the things first :)
[22:21:12] <njn> pcwalton: within DisplayList are there any tricky bits? e.g. sharing of DisplayItems or anything like that? doesn't look like it...
[22:21:48] *** Joins: stompercx (Mibbit@moz-juv.9o3.252.72.IP)
[22:22:04] *** Quits: stompercx (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:22:08] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Connection closed)
[22:22:17] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[22:22:36] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Connection closed)
[22:26:21] * njn will one day touch a file that doesn't cause all of Servo to be rebuilt from scratch
[22:26:29] *** Quits: dinfuehr (dinfuehr@moz-6jjoqr.highway.telekom.at) (Connection closed)
[22:26:58] *** Joins: dinfuehr (dinfuehr@moz-6jjoqr.highway.telekom.at)
[22:27:17] <Savago> njn: if you need to traverse through all the Display items in a stacking context (and its children) it may be useful to check the code that dumps the display lists into terminal for debugging.
[22:27:32] <njn> Savago: cool, thank you
[22:27:41] *** Quits: jdm (jdm@moz-i5m.05u.207.66.IP) (Connection closed)
[22:27:56] *** Joins: jdm (jdm@moz-ak9a3r.ckpj.s0pt.0450.2001.IP)
[22:27:56] *** ChanServ sets mode: +qo jdm jdm
[22:28:24] <Savago> njn: it is in components/gfx/display_list/mod.rs, look for print_items().
[22:29:20] <Savago> njn: perhaps all_display_items() may be useful too.
[22:31:05] *** Quits: dinfuehr (dinfuehr@moz-6jjoqr.highway.telekom.at) (Ping timeout: 121 seconds)
[22:35:41] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[22:35:41] *** ChanServ sets mode: +o pcwalton
[22:38:25] *** Joins: adu (ajr@moz-0foa9t.md.comcast.net)
[22:40:09] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Connection closed)
[22:46:24] *** mdoglio|bbl is now known as mdoglio|afk
[22:47:34] *** Joins: ghservo (ghservo@moz-0l2.5u0.30.192.IP)
[22:47:34] -ghservo- [13servo] 15glennw opened pull request #5188: Perform reflow if load events dirty any nodes. (06master...06reflow-events) 02http://git.io/pzfi
[22:47:34] *** Parts: ghservo (ghservo@moz-0l2.5u0.30.192.IP) ()
[22:48:08] *** Quits: kmicu (kmicu@moz-uga.edn.218.91.IP) (Client exited)
[22:49:28] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[22:49:41] *** Quits: mccr8 (mccr8@moz-cfhap5.mtv2.mozilla.com) (Connection closed)
[22:49:43] *** Joins: mccr8 (mccr8@moz-cfhap5.mtv2.mozilla.com)
[22:50:33] <Savago> yay! Just got blur filter working!
[22:50:35] <Savago> http://imgbin.org/index.php?page=image&id=22767
[22:52:01] <njn> pcwalton: any idea about https://pastebin.mozilla.org/8825184 ?
[22:52:29] <njn> pcwalton:, https://pastebin.mozilla.org/8825185 is better
[22:53:07] <pcwalton> njn: you may need a .as_ref().map_or() there
[22:53:21] <pcwalton> doing map() over an option will try to move out of the option
[22:53:29] <jack> Savago: nice
[22:53:30] <pcwalton> Option<SomethingNotCopyable>
[22:53:36] <pcwalton> so you can do Option<&SomethingNotCopyable> instead
[22:53:55] <njn> pcwalton: seems to work, thanks
[22:54:00] <pcwalton> no problem :)
[22:54:06] <pcwalton> the error really should be better, saying the type
[22:55:12] *** Joins: mystor_ (mystor@moz-rrn.r78.15.130.IP)
[22:55:49] *** Joins: ghservo (ghservo@moz-l7j.5u0.30.192.IP)
[22:55:49] -ghservo- [13servo] 15glennw opened pull request #5189: Make change page url message consistent with other compositor messages. (06master...06page-url) 02http://git.io/pzkG
[22:55:49] *** Parts: ghservo (ghservo@moz-l7j.5u0.30.192.IP) ()
[22:57:48] *** Joins: ghservo (ghservo@moz-0l2.5u0.30.192.IP)
[22:57:48] -ghservo- [13servo] 15bors-servo pushed 0 new commits to 06auto: 02http://git.io/pzk5
[22:57:48] *** Parts: ghservo (ghservo@moz-0l2.5u0.30.192.IP) ()
[22:57:49] *** Joins: ghservo (ghservo@moz-l7j.5u0.30.192.IP)
[22:57:49] -ghservo- [13servo] 15bors-servo pushed 2 new commits to 06auto: 02http://git.io/pzkd
[22:57:49] -ghservo- 13servo/06auto 1433829c0 15Glenn Watson: Perform reflow if load events dirty any nodes....
[22:57:49] -ghservo- 13servo/06auto 141982765 15bors-servo: auto merge of #5188 : glennw/servo/reflow-events, r=jdm...
[22:57:49] *** Parts: ghservo (ghservo@moz-l7j.5u0.30.192.IP) ()
[22:58:32] <jack> gw: Does that prevent extra reflows, or add more reflows?
[22:59:25] <gw> jack: well, it adds more reflows... :) but, window.reflow only does work if there are dirty nodes, so it should only add reflows if they were actually needed
[22:59:46] *** Quits: kaksmet (kaksmet@moz-ismsth.se.alltele.net) (Quit: )
[23:02:37] <gw> jack: the extra reflows that you are looking into probably occur due to (unnecessary?) calls to force_reflow() which marks all nodes as dirty before calling window.reflow. 
[23:02:59] *** Joins: kaksmet (kaksmet@moz-ismsth.se.alltele.net)
[23:04:32] <njn> did DList get renamed as LinkedList?
[23:04:38] <mbrubeck> njn: yes
[23:04:41] <njn> mbrubeck: thank you
[23:05:19] <mbrubeck> njn: If you want docs from the library versions that Servo master is using, you can search http://doc.servo.org/servo/index.html?search=DList
[23:06:53] <njn> hmm, implementing SizeOf for DList will be interesting
[23:10:27] *** Joins: dstrbad (dstrbad@moz-kigcb1.dsl.iskon.hr)
[23:11:34] *** Quits: bjz (bjz@moz-puppgq.tpgi.com.au) (Quit: My Mac has gone to sleep. ZZZzzz‚Ä¶)
[23:14:46] *** Quits: dstrbad (dstrbad@moz-kigcb1.dsl.iskon.hr) (Ping timeout: 121 seconds)
[23:18:04] *** Quits: jschuster (schuster@moz-n100gq.ma.comcast.net) (Ping timeout: 121 seconds)
[23:18:41] <njn> or maybe even impossible
[23:18:57] *** Joins: jschuster (schuster@moz-n100gq.ma.comcast.net)
[23:22:18] <njn> pcwalton: ^^^ I was afraid of this. In Firefox we have our own containers so we can add container-specific SizeOf methods as necessary
[23:22:46] <pcwalton> you can implement traits that you defined for types not in your module
[23:22:52] <pcwalton> why can't you do that for DList?
[23:22:53] <njn> with DList/LinkedList we can write a SizeOf impl that will measure everything hanging off the DList, but we can't measure the nodes themselves
[23:23:13] <pcwalton> oh, because they're private
[23:23:14] <njn> it requires seeing details of the DList implementation that aren't exposed
[23:23:14] <pcwalton> yeah
[23:23:33] <pcwalton> well, let's file an RFC or something to get it added to Rust
[23:23:43] <pcwalton> and just guess for now
[23:23:52] * njn 's Q1 goal is getting further away
[23:23:53] <pcwalton> IMO Servo should not be reinventing our own containers just because Rust doesn't have the functionality
[23:23:54] <jdm> you could duplicate the definition and transmute to your custom type :)
[23:24:02] <pcwalton> we control Rust too
[23:24:18] <cmr> having accurate memory accounting is useful in more than just servo, too.
[23:24:26] <pcwalton> agreed
[23:24:54] <pcwalton> jdm's approach is probably the best one
[23:24:57] <pcwalton> pending the fix in Rust
[23:25:19] <njn> how... pragmatic :)
[23:25:21] <jdm> the compiler will even yell if the original definition of DList changes in a way such that the two struct's sizes differ
[23:25:37] <jdm> mmm, only if you transmute Dlist to ReferenceDlist, though
[23:25:40] <jdm> not via pointers
[23:25:52] <pcwalton> you can add a function that isn't called just to trigger that error
[23:25:58] <pcwalton> just comment that that's what you're doing
[23:26:00] <pcwalton> I've done that before
[23:26:05] <jdm> ooh, right
[23:26:08] <njn> ReferenceDList?
[23:26:15] <jdm> njn: yeah, the duplicated definition
[23:26:22] <njn> oh
[23:28:04] *** Joins: dinfuehr (dinfuehr@moz-6jjoqr.highway.telekom.at)
[23:32:07] *** Quits: dinfuehr (dinfuehr@moz-6jjoqr.highway.telekom.at) (Ping timeout: 121 seconds)
[23:34:58] *** Quits: brendan (brendaneich@moz-0gq.0rd.102.38.IP) (Client exited)
[23:39:34] *** Joins: mib_dojqa9 (Mibbit@moz-juv.9o3.252.72.IP)
[23:42:47] *** Joins: ghservo (ghservo@moz-l7j.5u0.30.192.IP)
[23:42:47] -ghservo- [13servo] 15bors-servo merged 06auto into 06master: 02http://git.io/pzkd
[23:42:47] *** Parts: ghservo (ghservo@moz-l7j.5u0.30.192.IP) ()
[23:42:48] *** Joins: ghservo (ghservo@moz-ij9.5u0.30.192.IP)
[23:42:48] -ghservo- [13servo] 15bors-servo closed pull request #5188: Perform reflow if load events dirty any nodes. (06master...06reflow-events) 02http://git.io/pzfi
[23:42:48] *** Parts: ghservo (ghservo@moz-ij9.5u0.30.192.IP) ()
[23:45:20] *** Quits: mib_dojqa9 (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[23:45:49] *** Joins: ghservo (ghservo@moz-m9l.5u0.30.192.IP)
[23:45:49] -ghservo- [13servo] 15bors-servo pushed 2 new commits to 06auto: 02http://git.io/pzWn
[23:45:49] -ghservo- 13servo/06auto 143befc8c 15Glenn Watson: Make change page url message consistent with other compositor messages....
[23:45:49] -ghservo- 13servo/06auto 14a072e40 15bors-servo: auto merge of #5189 : glennw/servo/page-url, r=larsbergstrom...
[23:45:49] *** Parts: ghservo (ghservo@moz-m9l.5u0.30.192.IP) ()
[23:46:14] *** Quits: capella (chatzilla@moz-20t.a68.87.66.IP) (Ping timeout: 121 seconds)
[23:46:49] *** Quits: MrZeus (Orestes@moz-n8pa5v.skybroadband.com) (Ping timeout: 121 seconds)
[23:48:44] *** Quits: azita (Azita@moz-cfhap5.mtv2.mozilla.com) (Client exited)
[23:51:24] *** Quits: mccr8 (mccr8@moz-cfhap5.mtv2.mozilla.com) (Quit: computer sleep)
[23:52:14] *** Joins: bjz (bjz@moz-4l6.mjm.52.113.IP)
[23:56:41] *** Quits: hoverbear (hoverbear@moz-a97.b2m.54.96.IP) (Quit: Time to hibernate.... ZzZz...)
[23:56:45] <njn> jdm, pcwalton: I can implement size_of_excluding_this recursively for MyDList, but I'm having trouble with an iterative version; borrow checker problems
[23:57:10] <jdm> oh?
[23:57:34] <njn> https://pastebin.mozilla.org/8825197
[23:57:52] * njn should really learn Rust one day
[23:58:41] *** Quits: bjz (bjz@moz-4l6.mjm.52.113.IP) (Quit: My Mac has gone to sleep. ZZZzzz‚Ä¶)
[23:59:21] <pcwalton> njn: same problem; try curr.as_ref().unwrap().next ?
[23:59:40] <njn> pcwalton: lol, yep
[23:59:42] <njn> thank yoiu
[23:59:48] *** Joins: bjz (bjz@moz-4l6.mjm.52.113.IP)
[23:59:57] *** Joins: ghservo (ghservo@moz-l7j.5u0.30.192.IP)
[23:59:57] -ghservo- [13servo] 15Adenilson opened pull request #5190: Implementing blur filter. (06master...06blurFilter01) 02http://git.io/pzBS
[23:59:57] *** Parts: ghservo (ghservo@moz-l7j.5u0.30.192.IP) ()
