[00:00:31] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[00:01:59] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[00:01:59] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[00:02:15] <Eridius> nmatsakis: how much stack does #[fixed_stack_segment] give?
[00:03:37] *** Quits: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[00:03:57] <nmatsakis> Eridius: I believe it gives 2MB? pcwalton brson ^
[00:05:58] <brson> Eridius: it requests 2MB but if the stack needs to grow it gets 3MB
[00:06:28] <brson> so that subsequent requests don't continue to reallocate
[00:09:02] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[00:09:02] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/d9hYtw
[00:09:02] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[00:09:51] *** Joins: maik (maik___@moz-B0F3393.dip0.t-ipconnect.de)
[00:10:50] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[00:10:50] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/atJOgQ
[00:10:50] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[00:10:51] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[00:10:51] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/Xj_BPQ
[00:10:51] <ghrust> 13rust/06auto 140dceabd 15Daniel Micay: Revert "Turn off jemalloc"...
[00:10:51] <ghrust> 13rust/06auto 142c71645 15Graydon Hoare: rt: make jemalloc header conform to android signature.
[00:10:52] <ghrust> 13rust/06auto 14d6caddf 15bors: auto merge of #8628 : graydon/rust/2013-08-19-jemalloc-enable, r=thestinger...
[00:10:54] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[00:11:08] <mihneadb> dbaupp: after check-stage2-extra NO_REBUILD=1, how would I go about make install without rebuilding stuff?
[00:11:14] <bblum> alrighty, i have triaged ALL THE BUGS.
[00:11:24] <mihneadb> make install NO_REBUILD=1 ?
[00:11:46] <toddaaro> mihneadb: I think that should do the trick, not certain
[00:11:52] <mihneadb> seems to
[00:11:57] <mihneadb> but I wasn't sure it was correct :)
[00:12:03] <flaper87> bblum: ok, pushed the final version
[00:12:12] <mihneadb> thanks toddaaro
[00:12:17] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[00:12:42] *** Quits: indutny (indutny@moz-49D42D15.c.ircrelay.com) (Ping timeout)
[00:12:50] *** Quits: strmpnk (strmpnk@moz-49D42D15.c.ircrelay.com) (Ping timeout)
[00:13:30] <flaper87> I'm off to bed now!
[00:13:36] <flaper87> bblum: thanks for your help and patience!
[00:13:41] *** Joins: strmpnk (strmpnk@moz-49D42D15.c.ircrelay.com)
[00:14:00] <bblum> flaper87: no prob, glad you were likewise patient with my draconian assertions :P
[00:14:14] *** flaper87 is now known as flaper87|afk
[00:15:18] *** Quits: Florob (Florob@moz-39532932.de) (Client exited)
[00:15:56] <mihneadb> cmr: filed https://github.com/mozilla/rust/pull/8630
[00:16:58] *** Joins: azita_ (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[00:18:28] <dbaupp> mihneadb: https://github.com/mozilla/rust/pull/8616
[00:18:44] *** Quits: maik (maik___@moz-B0F3393.dip0.t-ipconnect.de) (Ping timeout)
[00:18:52] *** Quits: azita_ (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Ping timeout)
[00:20:32] *** Quits: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net) (Quit: ozten)
[00:21:20] *** Joins: indutny (indutny@moz-49D42D15.c.ircrelay.com)
[00:21:24] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[00:21:25] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[00:21:38] <mihneadb> dbaupp: ah, damn :D
[00:22:25] <nmatsakis> bblum: https://github.com/mozilla/rust/pull/8562#issuecomment-22914487
[00:22:37] <nmatsakis> sorry it took me a while
[00:23:13] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[00:23:32] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[00:23:58] <graydon> acrichto: ping
[00:24:19] <bblum> nmatsakis: yeah, i have rebased and am waiting for it to rebuild
[00:24:27] <bblum> somebody went and updated the visitor interface on me :P
[00:24:29] <acrichto> graydon: pong
[00:24:37] <graydon> acrichto: you're working on redoing run:: yes?
[00:24:41] <acrichto> graydon: yes
[00:24:48] <bblum> nmatsakis: yeah, i will probably have some questions about ty_self for you tomorrow
[00:24:50] <graydon> acrichto: what can I do to help you along in that?
[00:25:26] <nmatsakis> bblum: ok cool (you have the bors authority to r=nmatsakis, right?)
[00:25:31] <bblum> yeah i do
[00:25:41] <bblum> thanks :)
[00:26:13] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[00:26:17] <acrichto> graydon: there's a few things. First it requires an upgrade of libuv with a new build system and everything. I think it works for unixes now, not tested on windows. Other than that though, I've got all the bindings written and right now I get into a situation where compiletest wedges. It's not taking up cpu or anything, and no assertions have tripped, it just sits forever. I *think* that it has to do with process I/O, but I'm not sure. I was try
[00:26:52] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[00:27:09] <bblum> nmatsakis: namely, i noticed a fixme in the ty_self case of type_contents() and was wondering if to fix the default methods case in this project would need to fix that fixme as well
[00:27:23] <graydon> acrichto: guessing it has to do with reading all of stdout and stderr interleaved
[00:27:27] <acrichto> graydon: this program https://gist.github.com/alexcrichton/6275756 is the small example which wedges. Even if I disable all I/O completely, the rust program wedges. I was trying to reduce it down to a c program to see if it's a libuv bug but I wasn't able to reproduce in just C, so I think it's something wrong with the bindings I've been writing in rust
[00:27:33] <graydon> acrichto: that's usually how we've managed to wedge it before
[00:27:51] <nmatsakis> bblum: I don't think you have to fix the fixme, fixing the fixme would mean that there was no ty_self case at all
[00:27:57] <acrichto> graydon: yeah that's what I'm suspecting, but it's weird that it shows up even when the process I'm running has no stdout/stderr and if I completely ignore child stdout/stderr
[00:27:59] <nmatsakis> bblum: but that's a bit more involved than I think is warranted :)
[00:28:08] <bblum> oh i see, ok
[00:28:27] <nmatsakis> bblum: I'm not sure what's the right fn name, but the ty_self() tells you the trait def-id, so we should be able to just lookup its defn and extract the builtin bounds that way
[00:28:44] <bblum> yep
[00:28:48] <bblum> ok, seems straightforward enough
[00:28:55] <graydon> acrichto: :((
[00:29:04] <acrichto> graydon: I just pushed my current tree to https://github.com/alexcrichton/rust/tree/issue-6436-run-non-blocking
[00:29:29] <ecr> brson: r? https://github.com/mozilla/rust/pull/8631
[00:29:30] <acrichto> graydon: basically I think that this needs another night of debugging, but things are working in the basic sense (you can bootstrap)
[00:29:39] *** Quits: snerd (motk@moz-E535583C.nonstopcrunchy.net) (Quit: leaving)
[00:29:50] *** Joins: snerd (motk@moz-E535583C.nonstopcrunchy.net)
[00:29:51] <graydon> acrichto: ok. compiletest is the main thing :)
[00:29:56] <acrichto> yeah
[00:30:08] <acrichto> and all tests pass in isolation
[00:30:09] <ecr> That's the thread safe IO PR if anyone wants to check it out.
[00:30:13] <acrichto> it's just in stress that things go wrong
[00:30:20] <strcat> ecr: ooo
[00:30:35] <strcat> ecr: I'm not familiar with any of that code, otherwise I'd review it :)
[00:30:45] <graydon> can someone r? https://github.com/mozilla/rust/pull/8500 ? it'll knock probably 20 min off cycle time
[00:30:54] <graydon> just the final commit. the others are already reviewed.
[00:31:00] <graydon> oh, already was, nm
[00:31:10] *** Quits: RMF (RMF@moz-BE8171F5.dsl.telepac.pt) (Ping timeout)
[00:31:11] <cmr> was going to say :)
[00:31:50] <ecr> strcat: I'm pretty sure it's thread safe. I figure it's better to get people using it so bugs get spotted sooner.
[00:32:31] *** Joins: RMF (RMF@moz-BE8171F5.dsl.telepac.pt)
[00:32:59] <strcat> graydon: nooo, it failed again :(
[00:33:01] <strcat> the jemalloc one
[00:33:02] <ecr> strcat: There's a lot of potential to optimize too. This version is basically the minimum necessary to get it safe.
[00:33:19] <strcat> graydon: don't understand why
[00:34:09] <graydon> strcat: I'll try to debug further here.
[00:35:35] <ecr> I think I'm done for the day
[00:36:15] <strcat> graydon: that gcc error is really bad, it should print the signatures :s
[00:37:03] <strcat> foo.c:2:5: error: conflicting types for â€˜fooâ€™
[00:37:05] <strcat>  int foo(int, double);
[00:37:07] <strcat>      ^
[00:37:09] <strcat> foo.c:1:5: note: previous declaration of â€˜fooâ€™ was here
[00:37:11] <strcat>  int foo(int, int);
[00:37:13] <strcat>      ^
[00:37:15] <strcat> gcc 4.8
[00:37:17] * strcat shrugs
[00:37:35] <strcat> heh it's nearly identical to clang now
[00:37:49] *** Joins: tikue (tkuehn@98F87495.1E1F6C0.AF6F698.IP)
[00:37:50] <strcat> just missing colour and slightly differently wording
[00:38:08] <aatch> strcat, a bad one in gc is ambiguous overloads
[00:38:10] <aatch> gcc*
[00:38:22] <strcat> well it's a lot better than it used to be
[00:38:28] <aatch> When one function is extern "C" and another isn't
[00:38:45] <aatch> Or, more accurately, where there is a prototype in extern "C" and the impl isn't
[00:38:56] <graydon> strcat: it's because configure is checked in
[00:39:08] <strcat> graydon: ah
[00:39:29] <strcat> good old autotools problems
[00:40:44] <strcat> graydon: what are these little graphs from some of the tests? the ratcheting?
[00:40:48] <strcat> (min=1, q1=6, med=19, q3=31, max=108)
[00:40:50] <strcat> 1 |[--**#***----------------]                 | 200
[00:40:57] *** Quits: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com) (Quit: ecr)
[00:40:58] <strcat> is the # how it performed this time?
[00:41:05] <graydon> those are just boxplots from the stats module. nothing's using them at the moment.
[00:41:13] <graydon> it's just testing that it can do basic stats properly.
[00:41:15] <strcat> oh
[00:41:45] <graydon> (against test vectors I generated from R)
[00:41:54] <graydon> (I assume R does stats properly. goodness knows I don't!)
[00:42:26] <graydon> think it's a problem if I autoconf with 2.68 rather than 2.69 as the previous configure was checked in with?
[00:42:36] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[00:42:36] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d6caddf to 14e6e678f: 02http://git.io/N3iJvQ
[00:42:36] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[00:42:37] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[00:42:37] <ghrust> 01[13rust01] 15bors pushed 6 new commits to 06auto: 02http://git.io/p--wkg
[00:42:37] <ghrust> 13rust/06auto 148c78311 15Graydon Hoare: test: un-xfail now working run-pass/foreign-struct.rs, close #2334.
[00:42:37] <ghrust> 13rust/06auto 14eaa3780 15Graydon Hoare: test: add testcase, close #4929 which was already fixed.
[00:42:38] <ghrust> 13rust/06auto 1429a449a 15Graydon Hoare: Add tests for cross-crate condition handling. Close #5446.
[00:42:40] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[00:43:27] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[00:43:29] *** Quits: mihneadb (mihneadb@moz-BBE3ABD.mv.mozilla.com) (Input/output error)
[00:43:43] <graydon> seems to work
[00:44:55] <strcat> how do you run just the doc tests again?
[00:44:58] <strcat> without rebulding
[00:45:00] <strcat> rebuilding*
[00:45:01] <graydon> strcat: refreshed the jemalloc PR with autoreconf, want to r+ it?
[00:45:06] <strcat> graydon: sec
[00:45:36] *** Quits: RMF (RMF@moz-BE8171F5.dsl.telepac.pt) (Quit: Textual IRC Client: www.textualapp.com)
[00:45:46] <graydon> give it reasonably high priority too, as it should help build times
[00:45:48] <strcat> graydon: hm, how about I do it with 2.69? just to make it less noisy
[00:45:59] <graydon> strcat: you're welcome to. r=me if you prefer to do that.
[00:46:03] <strcat> k
[00:46:11] <graydon> I can't figure out how to get a backport of that into this machine.
[00:46:21] *** Joins: RMF (RMF@moz-BE8171F5.dsl.telepac.pt)
[00:46:44] <strcat> graydon: a different distro in a chroot ;p
[00:46:56] <graydon> yeah I guess
[00:47:28] *** Quits: tikue (tkuehn@98F87495.1E1F6C0.AF6F698.IP) (Quit: tikue)
[00:49:02] <strcat> wow github is weird
[00:49:04] *** Quits: heftig (heftig@moz-2875B7D7.dip0.t-ipconnect.de) (Ping timeout)
[00:49:12] <strcat> even though I deleted/recreated the branch, I am allowed to reopen the old PR
[00:49:26] <strcat> graydon: https://github.com/thestinger/rust/commit/517e6112710a8b0d107a847c862c3114d67d4b7a#commitcomment-3895668 cleaner now :)
[00:49:54] *** Joins: eholk (eholk@moz-BE8C0E3E.tmodns.net)
[00:50:05] <graydon> huh. it won't surprise me if the change to $(AR) there makes it fail when doing cross builds
[00:50:12] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[00:50:12] <graydon> but go for it :)
[00:50:14] <strcat> hm
[00:50:24] <strcat> I wonder if it was manually edited to $(AR)
[00:50:55] <strcat> graydon: yep, 474bd60c1bc242664bff876804e8fa4c5b27214d
[00:50:59] <strcat> let me fix that
[00:51:44] <graydon> poke it in configure.ac as well of course :)
[00:51:51] <strcat> yeah
[00:51:57] *** Quits: eholk (eholk@moz-BE8C0E3E.tmodns.net) (Quit: eholk)
[00:52:04] <graydon> again, r=me. go go jemalloc!
[00:52:23] <graydon> I gotta head out. back in later tonight.
[00:52:53] <strcat> almost forget to generate it agani
[00:53:02] <graydon> autoconf rules
[00:54:12] <strcat> graydon: not 100% sure it will actually speed up the build overall since it has to build jemalloc 3 times - but iirc from last time it was a little bit faster
[00:54:45] *** Joins: tiffnya (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[00:55:06] <graydon> hmph
[00:55:10] <cmr> Is there any way to avoid building it 3 times? Staging doesn't affect it at all.
[00:55:13] *** Joins: z0w0 (zack@moz-7E6DC3A.lnse2.woo.bigpond.net.au)
[00:55:30] <graydon> well, I suspect it'll be a little nicer about memory contention between cores. might make newrt happier.
[00:55:30] *** Joins: heftig (heftig@moz-2A9BA790.dip0.t-ipconnect.de)
[00:55:37] *** Quits: dew (Instantbir@moz-D2FA52B6.static.stls.mo.charter.com) (Ping timeout)
[00:55:44] <graydon> and in any case, use less memory. which we need to keep pushing on.
[00:55:46] *** Joins: dew (Instantbir@moz-D2FA52B6.static.stls.mo.charter.com)
[00:55:58] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[00:56:46] <graydon> anyway, gtg. good luck! looks like maybe the valgrind thread-disabler thing is sticking. hope hope.
[00:56:50] *** Quits: graydon (Adium@A5087023.2354C43D.D8E68FF6.IP) (Quit: Leaving.)
[00:57:07] *** Quits: tiffnya (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Connection reset by peer)
[00:57:11] <dbaupp> cmr: speaking of memory usage, is there a reason for no data after the 10th?
[00:57:24] *** Joins: tiffnya (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[00:58:10] <cmr> dbaupp: hm, the stepper might be wedged
[01:00:29] *** Quits: tiffnya (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[01:03:28] <cmr> lots of build failures, looks like
[01:03:34] <cmr> I'll babysit it for a while
[01:04:27] *** Quits: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP) (Quit: carllerche)
[01:04:29] <dbaupp> there's still quite a few bad jsons too, iirc
[01:04:32] <dbaupp> (thanks)
[01:05:08] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[01:05:08] <cmr> ugh
[01:05:11] <dbaupp> http://ix.io/7pL
[01:06:02] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[01:06:48] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[01:07:12] <strcat> dbaupp: https://github.com/mozilla/rust/pull/8582 r? graydon already r+'ed all but the last 3
[01:07:35] <strcat> although feel free to look at the already reviewed ones ;p
[01:08:02] <dbaupp> ooh, reverse_ is cool!
[01:08:23] <dbaupp> (I assume that you checked the tests passed after enabling them?)
[01:08:30] <strcat> dbaupp: doing that now ;p
[01:08:49] <strcat> it has to rebuild everything unless I figure out a way to just run the doc tests
[01:09:04] <dbaupp> does NO_REBUILD=1 not work?
[01:09:08] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[01:09:30] <strcat> dbaupp: also I want to tweak the 2nd last commit a bit anyway
[01:09:31] *** Joins: mihneadb (mihneadb@moz-903DB49B.tmodns.net)
[01:09:34] <strcat> dbaupp: yeah but I don't know the target
[01:09:38] <strcat> and make check rebuilds the whole thing
[01:10:22] <dbaupp> make check-stage2-docs?
[01:10:37] <dbaupp> (possibly without the s, I don't know.)
[01:12:33] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[01:12:34] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[01:13:46] *** Quits: mihneadb (mihneadb@moz-903DB49B.tmodns.net) (Ping timeout)
[01:15:03] *** Joins: mihneadb (mihneadb@moz-903DB49B.tmodns.net)
[01:15:38] *** Joins: recrack (Mibbit@B4104EBB.3CC170B1.1E14B209.IP)
[01:15:48] <pcwalton> my patch bounced again for the 5th? time
[01:15:50] <pcwalton> merge conflicts
[01:16:16] <strcat> dbaupp: yeah, without the s
[01:16:32] <strcat> it's still rebuilding everything with NO_REBUILD=1
[01:16:51] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[01:17:08] <Eridius> strcat: `make check-stage2-H-[host triple]-doc
[01:17:09] <Eridius> try that
[01:17:10] <Eridius> `
[01:17:17] <Eridius> possibly with NO_REBUILD
[01:17:20] *** Quits: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[01:17:41] <strcat> still rebuilding everything ;p
[01:17:50] <Eridius> bah
[01:17:54] <dbaupp> Eridius, strcat: I vaguely recall NO_REBUILD only being set up for std and extra
[01:18:02] *** Quits: mihneadb (mihneadb@moz-903DB49B.tmodns.net) (Input/output error)
[01:18:02] *** Joins: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com)
[01:18:14] <strcat> yeah I'm used to just doing this myself but I don't know how the tests are extracted
[01:18:22] <strcat> I can figure it out before make check gets there
[01:18:25] <dbaupp> etc/*.py I guess
[01:18:38] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[01:18:44] <dbaupp> extract-tests.py
[01:19:19] *** Quits: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[01:19:41] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[01:19:52] <strcat> now I have a dir of tests
[01:19:54] <strcat> ;p
[01:20:06] *** Joins: m_kato (m_kato@moz-C286AD9A.bitcat.net)
[01:20:30] <dbaupp> compiletest --mode run-pass <something>
[01:20:35] <strcat> 1 broken
[01:21:13] <engla> carleastlund: I wrote on your bug report
[01:21:27] <carleastlund> engla: Saw that, just responded.
[01:21:43] <engla> carleastlund: I can't even get rustc to compile something using ~Iterator<A> (it says internal compiler error)
[01:21:46] <strcat> FromIterator isn't in prelude
[01:22:08] <strcat> carleastlund: you don't want to use trait objects
[01:22:12] <strcat> you want to use generic functions
[01:22:29] <dbaupp> engla: I've used ~Iterator<uint> and it works
[01:22:38] <strcat> trait objects are for rare edge cases, and they'd be awfully slow with Iterator
[01:22:49] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[01:22:59] <strcat> rusti: fn foo<A, B: Iterator<A>>(x: &mut B) {}
[01:23:00] -rusti- <anon>:5:35: 5:36 warning: unused variable: `x` [-W unused-variable (default)]
[01:23:00] -rusti- <anon>:5          fn foo<A, B: Iterator<A>>(x: &mut B) {}
[01:23:01] -rusti-                                             ^
[01:23:01] -rusti- ()
[01:23:12] <carleastlund> Oh, I see, okay.
[01:23:20] *** Quits: lmandel (lmandel@moz-BBE3ABD.mv.mozilla.com) (Quit: lmandel)
[01:23:32] <dbaupp> does [&@~]Iterator even implement Iterator?
[01:23:48] <strcat> rusti: fn foo<A: Iterator<int>>(xs: &mut B) -> int { for xs.map(|x| x * 2).fold(0, |a, b| a + b) }
[01:23:49] -rusti- <anon>:5:61: 5:62 error: expected `in`, found `.`
[01:23:49] -rusti- <anon>:5          fn foo<A: Iterator<int>>(xs: &mut B) -> int { for xs.map(|x| x * 2).fold(0, |a, b| a + b) }
[01:23:49] -rusti-                                                                       ^
[01:23:49] -rusti- application terminated with error code 101
[01:23:50] <engla> dbaupp, how?  this is ICE: let it = ~range(0,10) as ~Iterator<int>;
[01:23:50] <toddaaro> brson: you around?
[01:23:53] <strcat> rusti: fn foo<A: Iterator<int>>(xs: &mut B) -> int { xs.map(|x| x * 2).fold(0, |a, b| a + b) }
[01:23:53] -rusti- <anon>:5:43: 5:44 error: use of undeclared type name `B`
[01:23:53] -rusti- <anon>:5          fn foo<A: Iterator<int>>(xs: &mut B) -> int { xs.map(|x| x * 2).fold(0, |a, b| a + b) }
[01:23:54] -rusti-                                                     ^
[01:23:55] -rusti- error: aborting due to previous error
[01:23:57] -rusti- application terminated with error code 101
[01:23:59] <strcat> rusti: fn foo<A: Iterator<int>>(xs: &mut A) -> int { xs.map(|x| x * 2).fold(0, |a, b| a + b) }
[01:23:59] -rusti- <anon>:5:55: 5:57 error: cannot move out of dereference of & pointer
[01:24:00] -rusti- <anon>:5          fn foo<A: Iterator<int>>(xs: &mut A) -> int { xs.map(|x| x * 2).fold(0, |a, b| a + b) }
[01:24:02] * strcat sighs
[01:24:03] -rusti-                                                                 ^~
[01:24:05] -rusti- error: aborting due to previous error
[01:24:07] -rusti- application terminated with error code 101
[01:24:08] <strcat> rusti: fn foo<A: Iterator<int>>(xs: A) -> int { xs.map(|x| x * 2).fold(0, |a, b| a + b) }
[01:24:08] -rusti- ()
[01:24:20] <strcat> weechat needs a less crappy line editor
[01:24:39] <engla> no ~Iterator does not implement Iterator.
[01:24:55] <dbaupp> rusti: let it = ~range(0,10) as ~Iterator<int>; it.next()
[01:24:55] -rusti- <anon>:5:50: 5:52 error: cannot borrow immutable dereference of ~ pointer as mutable
[01:24:56] -rusti- <anon>:5          let it = ~range(0,10) as ~Iterator<int>; it.next()
[01:24:56] -rusti-                                                            ^~
[01:24:56] -rusti- error: aborting due to previous error
[01:24:56] -rusti- application terminated with error code 101
[01:25:04] <dbaupp> rusti: let mut it = ~range(0,10) as ~Iterator<int>; it.next()
[01:25:05] -rusti- error: internal compiler error: unexpected failure
[01:25:05] -rusti- note: the compiler hit an unexpected failure path. this is a bug
[01:25:05] -rusti- note: try running with RUST_LOG=rustc=1 to get further details and report the results to github.com/mozilla/rust/issues
[01:25:05] -rusti- application terminated with error code 101
[01:25:24] <brson> toddaaro: yes
[01:26:08] <dbaupp> engla: https://gist.github.com/huonw/5a5dd2c960211311c22c#file-primes-trait-object-rs (this was from a few weeks ago)
[01:27:24] <toddaaro> brson: how do you feel about an AtomicBool for indicating whether or not a scheduler is "hot"
[01:27:49] <toddaaro> brson: idea is that we pass it in by creating a closure to give our callbacks closing over it
[01:28:19] <toddaaro> brson: then the wrapper closure sets / unsets the flag on hot/cold, and on hitting cold runs code to check stuff
[01:28:40] <toddaaro> an example being messages, if you send a message to a scheduler that is hot receipt should be guarenteed, so after going cold it checks the message queue
[01:28:46] *** zz_kimundi is now known as kimundi
[01:29:07] <strcat> /home/strcat/projects/rust/src/etc/output/iterators_1.rs:1: incorrect license
[01:29:07] <toddaaro> I think the ability to tell whether or not a scheduler is hot reliably will have uses
[01:29:09] <strcat> dbaupp: ha
[01:29:11] <strcat> ;p
[01:29:23] <toddaaro> the main one for me right now is that singleton async callbacks are very tricky in the destructors
[01:29:29] <strcat> that's what I get for all my stray files
[01:29:41] <toddaaro> and I think it would be much easier if we had this hot/cold bool
[01:29:43] <strcat> dbaupp: https://github.com/mozilla/rust/pull/8582 r? should be good now
[01:29:45] *** Quits: b (b@moz-55CA322E.org) (Client exited)
[01:29:45] <strcat> at least I hope so.
[01:29:57] <toddaaro> there is also the free optimization of "if hot, don't async ping"
[01:30:07] <dbaupp> strcat: what did you change about reverse_?
[01:30:07] *** Joins: maik (maik___@moz-B0F3393.dip0.t-ipconnect.de)
[01:30:15] <strcat> dbaupp: just the implementation
[01:30:17] <strcat> cleaner
[01:30:20] <strcat> removed the temporaries
[01:30:56] <strcat> I thought it wouldn't borrowck before
[01:31:09] <strcat> but it's much more clever than ages ago
[01:31:11] <dbaupp> r+
[01:31:16] <dbaupp> <3 the new borrowck
[01:31:21] <strcat> "new" ;p
[01:31:31] <toddaaro> brson: the tricky bit of singleton async callback destruction is that the "safe" time to destruct is when the reference count hits one, but only if the scheduler is "cold"
[01:31:46] <dbaupp> strcat: it's newer than the old one :P
[01:31:49] <toddaaro> brson: if the scheduler is hot and the refcount hits one it is still possible that the scheduler will create a handle using the local value
[01:31:53] *** Quits: maik (maik___@moz-B0F3393.dip0.t-ipconnect.de) (Ping timeout)
[01:32:28] *** Quits: mschifer1 (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[01:32:59] <toddaaro> but if the scheduler is cold and the refcount is one we have the same case as we had previously, which would result in the end of the program, except now because there is a libuv watcher in the "origin" callback stored inside the scheduler, run will never terminate
[01:33:26] <toddaaro> well, "same case as previous" is sort of different as previously it would be zero because there was no "origin" callback to clone
[01:34:27] <toddaaro> this utility wrapper could also be a good place to put "skip event loop if no IO"
[01:35:45] <brson> toddaaro: what does 'singleton async callback destruction' mean here?
[01:36:02] <toddaaro> go_hot(); while io_count == 0 { run_sched_once }; go_cold(); cleanup_check();
[01:36:16] <toddaaro> brson: right now we have a zillion async callback handles floating around
[01:36:26] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[01:36:42] <toddaaro> brson: so to convert to a singleton refcounted callback would be great, use a simple atomic to ensure safety as duplicate pings aren't necessary
[01:37:05] <toddaaro> brson: but it becomes hard to destruct the thing, as you always have one in the sched struct acting as the "origin" callback to clone and get new ones
[01:37:37] *** Quits: fyolnish (fyolnish@moz-90CA7366.uqwimax.jp) (Ping timeout)
[01:39:53] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[01:40:25] *** Joins: fyolnish (fyolnish@moz-90CA7366.uqwimax.jp)
[01:41:08] <brson> toddaaro: what does it mean to be hot?
[01:42:13] <mm> How can I "sleep" a task in the new rt?
[01:42:19] <toddaaro> brson: "if a scheduler is hot any work enqueued to it via messages is guarenteed to be processed before the scheduler sleeps"
[01:42:22] <mm> I assume using libc sleep is bad.
[01:42:48] <brson> mm: rt::io::timer::Timer::new().sleep(msec)
[01:42:56] <mm> Thanks.
[01:43:06] <toddaaro> brson: I think that is the goal definition, and thinking about it that way returning from a callback, hitting the event loop, and going into another callback would be fine
[01:43:28] *** recrack is now known as sanxiyn
[01:43:30] *** Quits: carleastlund (cce@moz-C8071335.c3-0.smr-ubr1.sbo-smr.ma.cable.rcn.com) (Quit: carleastlund)
[01:43:59] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Client exited)
[01:44:17] <dbaupp> mm: you might need ...::new().unwrap().sleep(msec)
[01:44:20] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[01:44:37] *** Quits: echristo (echristo@DCF57675.D6CCE4AE.77834EAA.IP) (Quit: echristo)
[01:44:41] <brson> sleep should have a standalone fn
[01:44:52] <mm> dbaupp: haha, even more of a mouthful
[01:44:56] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Connection reset by peer)
[01:45:09] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[01:45:23] <mm> so should I have "extern mod rt;"?  Because that seems to not work
[01:45:36] <brson> mm: std::rt::io:timer::Timer::new()
[01:45:53] <cmr> mm: no, the runtime is part of libstd.
[01:46:09] <mm> k.
[01:46:32] <brson> toddaaro: is the scheduler responsible for destroying the singleton async handle?
[01:47:28] <toddaaro> brson: I think it needs to be to avoid races, but logically no I don't think so
[01:48:19] *** Quits: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP) (Quit: carllerche)
[01:48:52] *** sanxiyn is now known as recrack
[01:48:58] <toddaaro> brson: the race is if a scheduler is about to make a new handle, but the refcount bounces to 1 first then the remote thread can destruct the origin callback making the scheduler fail when it creates one
[01:49:10] <toddaaro> s/one/a clone
[01:49:43] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[01:50:04] <toddaaro> a very very different approach to this (really unrelated) is to change how shutdown is implemented
[01:50:14] <toddaaro> to *not* depend on handles in any way
[01:50:23] <mm> Grr, I don't understand Rust's crate/namespace stuff.  How do I get sleep() in scope?
[01:50:24] <toddaaro> and instead keep a global count of how many oustanding tasks there are
[01:50:39] <mm> ype `std::rt::io::timer::Timer` does not implement any method in scope named `sleep`
[01:50:47] <mm> I see it in the timer.rs though.
[01:51:11] <dbaupp> ah, you'll need to import the RtioTimer trait
[01:51:32] <dbaupp> std::rt::rtio::RtioTimer
[01:51:44] <toddaaro> brson: my advisor at IU pointed me to the "Scalable Non Zero Indicator" or SNZI data structure
[01:51:48] <toddaaro> that could be useful for this
[01:52:30] *** Joins: ross (ross@moz-8A84103E.br.br.cox.net)
[01:52:47] <mm> dbaupp: Okay, thanks.  Now I've got an ICE :p
[01:52:59] <dbaupp> mm: awesome! :P
[01:53:03] <mm> also, man writing rust feels like java sometimes.  (in verbosity).
[01:53:24] <mm> Need eclipse to fill in the tax forms for me.
[01:53:45] <dbaupp> what's the code?
[01:53:47] <cmr> it's usually fine, it's just that the new stuff isn't in the prelude yet.
[01:53:55] *** Quits: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: My lid went down)
[01:54:00] <cmr> Imports are a small price to pay for the awesome module system
[01:54:24] *** Quits: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[01:54:35] <mm> cmr: I'm sure.  Part of it is also my unfamiliarity slowing me down compared to writing other languages.
[01:54:46] <SiegeLord> Just import using ::* ;)
[01:55:01] *** Quits: azakai (alon@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[01:55:23] <mm> Some better suggestions when the compiler can't find a name could also be nice.
[01:55:30] <SiegeLord> People spend so much time implementing that functionality, it's almost insulting not to use it
[01:55:45] <cmr> mm: it's tons better than it used to be
[01:55:50] *** Joins: azakai (alon@moz-BBE3ABD.mv.mozilla.com)
[01:55:59] <mm> cmr: Oh I know, I've used rust on and off for a while now
[01:56:00] * cmr added the suggestions
[01:56:03] <mm> Since .. 0.3ish?
[01:56:09] *** Joins: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net)
[01:56:36] *** Quits: fyolnish (fyolnish@moz-90CA7366.uqwimax.jp) (Client exited)
[01:56:49] <mm> Just been a while and I'm ... rusty.
[01:56:57] <mm> ba-du-tish.
[01:57:50] *** Quits: azakai (alon@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[01:57:54] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Quit: Leaving)
[01:59:20] <brson> toddaaro: if the scheduler is repsonsible for destroying the async handle, what role does hotness play in that destruction? there's no race where the refcount can get bumped
[02:01:36] <toddaaro> brson: I guess if we make the scheduler do the destructing maybe not
[02:02:00] *** Quits: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: My lid went down)
[02:05:30] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[02:07:55] *** Quits: tedh (tedh@moz-D8911C58.public.wayport.net) (Client exited)
[02:08:48] <strcat> dbaupp: missing a make_dir ;[
[02:09:08] *** Quits: z0w0 (zack@moz-7E6DC3A.lnse2.woo.bigpond.net.au) (Client exited)
[02:09:13] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[02:09:25] <dbaupp> strcat: ?
[02:11:07] *** Quits: goffrie (goffrie@moz-FBDA8B99.dsl.ncf.ca) (Quit: Lost terminal)
[02:11:17] <strcat> dbaupp: oh well my usual touch solution works
[02:11:30] <strcat> touch -m -d 2011-01-01 file_you_messed_with
[02:11:32] <strcat> ;p
[02:12:45] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[02:12:45] *** ChanServ sets mode: +o dherman
[02:13:04] <geomyidae> Who's doing awesome stuff with rust-http already? (yes, I know what state it's in ;))
[02:13:28] <brson> geomyidae: servo is going to start using it in a web browser this week
[02:13:37] <brson> it's not yet though
[02:13:46] <geomyidae> brson: yeah, I saw hints of that in the rust-http docs. That's very exciting.
[02:14:03] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[02:14:10] * brson dinner
[02:14:17] <geomyidae> Was that the plan from the beginning? I'd been excited about what ChrisMorgan was working on, but I didn't expect it'd wind up in Servo. That's cool, seems like the project will have that much more momentum
[02:14:26] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[02:14:33] <geomyidae> (And testing, usage, etc)
[02:15:19] <ChrisMorgan> geomyidae: are you using it for anything?
[02:15:42] <geomyidae> ChrisMorgan: Well, I just ordered dinner and started up sublime, so we'll see if I stay focused this evening.
[02:16:02] <ChrisMorgan> Whatcha gonna try?
[02:16:51] <geomyidae> Well, I'm not exactly 100% of the limitations and how they'll affect what I'd like to do, but hopefully simple things. I'd like to do something very simple as a step towards a camlistore client for rust.
[02:16:56] *** Joins: fyolnish (fyolnish@moz-BE2BAE5B.miinet.jp)
[02:17:06] <geomyidae> And/or just make a simple query against TVDB (tv database)
[02:17:21] *** Quits: olsonjeffery (pf@B8927AE1.CFEFA148.239A1A9E.IP) (Ping timeout)
[02:18:36] <ChrisMorgan> Is that server or client?
[02:19:01] <geomyidae> There is a Go implementation of camlistore server and there are a few different clients.
[02:19:14] <geomyidae> And there are currently storage backends for Google Storage and Drive and S3 I believe.
[02:19:57] <ChrisMorgan> I mean, HTTP client or server? (Will you be using http::client or http::server?)
[02:20:09] <geomyidae> My mistake, http::client.
[02:20:47] *** Joins: b (b@moz-55CA322E.org)
[02:23:00] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Quit: Leaving.)
[02:23:21] *** Joins: kimundi_ (kimundi@moz-53B106B9.dip0.t-ipconnect.de)
[02:24:25] *** Quits: kimundi (kimundi@moz-2DCB16B8.dip0.t-ipconnect.de) (Ping timeout)
[02:24:25] *** kimundi_ is now known as kimundi
[02:26:10] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[02:27:04] *** Joins: olsonjeffery (pf@B8927AE1.CFEFA148.239A1A9E.IP)
[02:27:49] <strcat> pcwalton: btw, I'd like to hear what you think about https://github.com/mozilla/rust/issues/8622
[02:27:51] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[02:28:14] *** Joins: Sergio965 (sergiobz@moz-8D9DFEEF.hsd1.ma.comcast.net)
[02:28:17] <pcwalton> not until rust 2.0
[02:28:31] <strcat> dynamically sized types?
[02:28:46] <pcwalton> no, function bounds on traits
[02:28:56] <strcat> ah
[02:29:28] <pcwalton> too risky at this stage I think
[02:30:25] <strcat> pcwalton: I think it would be backwards compatible with the current &fn at least, so it would be fine to put it off (unless &fn becomes fn)
[02:30:33] <pcwalton> &fn will become fn
[02:30:35] <strcat> hm
[02:30:44] *** Quits: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net) (Ping timeout)
[02:30:52] <strcat> well, this would essentially make `fn(int, int)` a trait, so &fn would be a trait object
[02:31:10] <pcwalton> ah I see
[02:31:19] <pcwalton> maybe &fn should be left the way it is
[02:31:26] <pcwalton> that's a good point
[02:31:31] <pcwalton> less I have to do anyway
[02:31:46] *** Quits: bytewise (bytewise@moz-4A801D04.unitymediagroup.de) (Quit: Leaving)
[02:32:27] <pcwalton> yeah, I like that idea more the more I think about it.
[02:32:39] <strcat> since you can move the env, you'd hit a lot fewer issues
[02:32:45] *** kimundi is now known as zz_kimundi
[02:34:07] *** Quits: Sergio965 (sergiobz@moz-8D9DFEEF.hsd1.ma.comcast.net) (Ping timeout)
[02:35:34] <strcat> you could capture by-ptr, and live as long as that ptr instead of a stack frame
[02:35:43] <strcat> that's an issue I always hit
[02:35:49] <strcat> with iterators
[02:37:52] <strcat> although, I guess you'd have &mut fn
[02:38:40] <strcat> pcwalton: would it make sense to make &fn copyable again, but freeze the env? and have &mut fn
[02:39:39] * strcat shrugs
[02:44:01] <pcwalton> well hmm
[02:44:05] <pcwalton> i'm not sure
[02:44:07] <pcwalton> will have to sleep on it
[02:44:09] *** Quits: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com) (Quit: pcwalton)
[02:47:27] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[02:48:33] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[02:50:15] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[02:50:42] <strcat> rusti: let x = &mut 5;
[02:50:46] -rusti- <anon>:5:13: 5:14 warning: unused variable: `x` [-W unused-variable (default)]
[02:50:46] -rusti- <anon>:5          let x = &mut 5;
[02:50:46] -rusti-                       ^
[02:50:46] -rusti- ()
[02:50:53] <strcat> rusti: let x = &mut 5; let y: &int = x;
[02:50:53] -rusti- <anon>:5:29: 5:30 warning: unused variable: `y` [-W unused-variable (default)]
[02:50:54] -rusti- <anon>:5          let x = &mut 5; let y: &int = x;
[02:50:54] -rusti-                                       ^
[02:50:54] -rusti- ()
[02:52:02] *** Quits: Earnestly (earnest@B0BDF733.8FDE20A.5411983D.IP) (Ping timeout)
[02:53:04] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[02:54:53] <dbaupp> strcat: wouldn't &mut fn be backwards? i.e. it should be &fn:mut() or something
[02:55:24] <strcat> dbaupp: don't think so
[02:55:28] <strcat> since there's ~fn, @fn
[02:55:44] <strcat> dbaupp: https://github.com/mozilla/rust/issues/8622
[02:55:53] <strcat> anyway not sure if it's good idea, but it appears to be a good one to me :P
[02:56:02] <strcat> it would make functions a special version of traits
[02:56:30] <dbaupp> I mean, the mutability is a property of the environment, not the fn itself
[02:56:45] <strcat> the function itself is the environment
[02:56:47] *** Quits: jfbk (textual@moz-EEA9CFB3.nyc.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[02:56:59] <strcat> the function pointer is part of the trait
[02:57:05] <strcat> (in this scheme)
[02:57:35] <dbaupp> rusti: let f: @mut fn() = || {}; (f,)
[02:57:38] -rusti- pastebinned 6 lines of output: http://ix.io/7pV
[02:57:54] <strcat> in the new scheme, @mut fn would exist
[02:58:54] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Ping timeout)
[02:59:04] *** Joins: echristo (echristo@moz-1892C634.hsd1.ca.comcast.net)
[03:01:49] <strcat> dbaupp: function bounds wouldn't exist
[03:01:53] <strcat> T: fn(int, int) + Send
[03:02:27] *** Joins: mr_evil (Mibbit@6B025944.C9FBF4CE.F88C4A2.IP)
[03:02:30] <strcat> trait Foo: (fn(int, f64) -> bool) + Clone
[03:02:30] <dbaupp> that'd be neater
[03:02:49] <strcat> I think you'd have to require they be in parentheses in trait bounds
[03:03:10] <dbaupp> do combined trait-object work?
[03:03:59] <strcat> as in trait inheritance + trait objects? it should work
[03:04:04] <strcat> by the time this would be implemented, it would
[03:04:40] <dbaupp> rusti: let x: ~(Vector<int>+Container) = ~(~[1]) as ~(Vector<int>+Container); x.len()
[03:04:40] -rusti- <anon>:5:29: 5:30 error: expected `)` but found `+`
[03:04:40] -rusti- <anon>:5          let x: ~(Vector<int>+Container) = ~(~[1]) as ~(Vector<int>+Container); x.len()
[03:04:40] -rusti-                                       ^
[03:04:40] -rusti- application terminated with error code 101
[03:05:30] <dbaupp> I mean a trait object with multiple traits^
[03:05:50] <strcat> oh, no
[03:05:59] <strcat> you have to define one inheriting
[03:06:22] <strcat> "anonymous trait inheritance" would probably be too annoying, since it ends up more verbose
[03:06:26] <strcat> since each use has to say Foo + Bar
[03:06:37] <dbaupp> yuck; things like &fn:Freeze(int, int) would then be tricky & annoying
[03:07:03] <strcat> you wouldn't often want &fn
[03:07:06] *** Quits: KindOne (KindOne@moz-F45181B8.dynamic.ip.windstream.net) (Ping timeout)
[03:07:06] <strcat> you'd want by-value
[03:07:08] <strcat> that's how it is in C++
[03:07:17] <strcat> dbaupp: you can capture by-ptr
[03:07:21] <strcat> and have the lifetime of that ptr
[03:07:28] <dbaupp> ~fn:Send+Clone() then
[03:07:32] <strcat> dbaupp: no ~ either ;p
[03:07:36] <strcat> just fn
[03:07:50] <strcat> well
[03:07:52] <dbaupp> right, but how do you write the equivalent of that?
[03:08:04] <strcat> you wouldn't be able to have fn objects
[03:08:09] <strcat> it would be the raw trait
[03:08:13] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[03:08:19] <strcat> fn foo<T: Send + fn(int)>() {}
[03:08:26] <dbaupp> so everything would get monomorphised and we'd have a code-size explosion?
[03:08:29] <strcat> no
[03:08:41] <strcat> you can box it whenever you want
[03:08:55] <dbaupp> and maintain the Send bound?
[03:08:57] <strcat> most uses of closures are small functions
[03:09:02] <strcat> dbaupp: sure
[03:09:05] <strcat> dynamically sized types
[03:09:23] <strcat> dbaupp: not sure what you mean though
[03:09:25] <dbaupp> wouldn't that box to ~(fn(int) + Send) ?
[03:09:37] <strcat> trait Foo: ~fn(int) + Send
[03:09:44] <strcat> dbaupp: atm ~fn is going to be removed
[03:09:47] <strcat> &fn isn't sendable
[03:09:57] <strcat> that's what was on the table before this
[03:10:17] <dbaupp> is it possible to have multiple-trait trait-objects?
[03:10:29] <strcat> dbaupp: not anonymously atm
[03:10:35] <strcat> in theory, sure
[03:10:40] <strcat> but then you have to use that *everywhere*
[03:10:40] <dbaupp> ok
[03:10:47] <strcat> you need to write Foo + Bar every time you pass them, etc.
[03:10:55] <dbaupp> yes
[03:11:02] <dbaupp> type FooBar =  Foo + Bar
[03:11:11] <dbaupp> generalise type defs a bit for DSTs.
[03:11:18] <strcat> dbaupp: but you can just write 'trait FooBar: Foo + Bar {}' ;p
[03:11:27] *** Quits: mr_evil (Mibbit@6B025944.C9FBF4CE.F88C4A2.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[03:11:27] *** Joins: KindOne (KindOne@8704F4CB.B7D17EEE.EC6A1518.IP)
[03:11:31] <strcat> although you have to impl it
[03:11:36] <dbaupp> but then you also need the impl of FooBar
[03:11:37] <dbaupp> yes
[03:11:47] <strcat> dbaupp: you should open an issue about that
[03:11:57] * dbaupp does so
[03:11:59] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[03:11:59] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/p--wkg
[03:11:59] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[03:13:29] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Client exited)
[03:13:30] *** Joins: mark_edward (quassel@68BC8414.F49EBFF0.CC1A2609.IP)
[03:13:50] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[03:15:30] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[03:15:50] <dbaupp> strcat: https://github.com/mozilla/rust/issues/8634
[03:21:59] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[03:21:59] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Ii4NaA
[03:21:59] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[03:22:01] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[03:22:01] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/qoX3pQ
[03:22:01] <ghrust> 13rust/06auto 140dceabd 15Daniel Micay: Revert "Turn off jemalloc"...
[03:22:01] <ghrust> 13rust/06auto 142c71645 15Graydon Hoare: rt: make jemalloc header conform to android signature.
[03:22:01] <ghrust> 13rust/06auto 14517e611 15Graydon Hoare: regenerate configure
[03:22:02] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[03:22:44] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[03:27:52] *** Joins: echristo_ (echristo@60A74940.D6CCE4AE.77834EAA.IP)
[03:28:16] *** Quits: echristo (echristo@moz-1892C634.hsd1.ca.comcast.net) (Ping timeout)
[03:28:16] *** echristo_ is now known as echristo
[03:31:12] <dbaupp> wahoo, I think I found a default method bug
[03:33:11] <olsonjeffery> brson: i was *this* close to successfully adding `fn get_str_ref<'r>(&'r self) -> &'r str` to the PathLike trait.
[03:33:32] <olsonjeffery> but the internals of Path impls drug me down :/
[03:33:51] <dbaupp> rusti: trait Foo { fn foo() -> uint {0} } Foo::foo()
[03:33:53] -rusti- error: internal compiler error: unexpected failure
[03:33:53] -rusti- note: the compiler hit an unexpected failure path. this is a bug
[03:33:54] -rusti- note: try running with RUST_LOG=rustc=1 to get further details and report the results to github.com/mozilla/rust/issues
[03:33:54] -rusti- application terminated with error code 101
[03:34:07] <dbaupp> strcat, sully: have either of you seen that one?^
[03:34:14] <olsonjeffery> path_as_str() is feels "old rust". but with the internals of Paths, not much way around.
[03:34:21] <sully> seen what?
[03:34:42] <dbaupp> sully: the ICE with default methods I just threw at rusti.
[03:34:59] <dbaupp> sully: the output is "task <unnamed> failed at 'No entry found for key: &10', /home/huon/rust/src/libstd/hashmap.rs:415"
[03:35:26] <sully> ok, hm
[03:35:28] <sully> interesting
[03:35:46] <dbaupp> rusti: trait Foo { fn foo() {} } Foo::foo()
[03:35:48] -rusti- error: internal compiler error: unexpected failure
[03:35:48] -rusti- note: the compiler hit an unexpected failure path. this is a bug
[03:35:48] -rusti- note: try running with RUST_LOG=rustc=1 to get further details and report the results to github.com/mozilla/rust/issues
[03:35:48] -rusti- application terminated with error code 101
[03:36:16] <dbaupp> rusti: trait Foo { fn foo() {} } impl Foo for uint { fn foo(){println("uint")} } Foo::foo::<uint>()
[03:36:17] -rusti- uint
[03:36:17] -rusti- ()
[03:37:00] <dbaupp> oh, that works; there are some instances where the explicit params are rejected with "this doesn't take type parameters"
[03:37:10] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Quit: Leaving.)
[03:37:53] <dbaupp> rusti: trait Foo { fn foo() { Foo::foo::<Self>() } }
[03:37:54] -rusti- <anon>:5:32: 5:48 error: this item does not take type parameters
[03:37:54] -rusti- <anon>:5          trait Foo { fn foo() { Foo::foo::<Self>() } }
[03:37:54] -rusti-                                          ^~~~~~~~~~~~~~~~
[03:37:54] -rusti- error: aborting due to previous error
[03:37:54] -rusti- application terminated with error code 101
[03:39:11] *** Joins: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net)
[03:40:29] *** Joins: lmandel (lmandel@moz-9CE00FC0.holiday-inn-express.mozilla.hq)
[03:42:28] <aatch> dbaupp, if I remember correctly, pcwalton made a recent change with regards to the Self param in associated functions (though it may not have landed)
[03:43:30] <dbaupp> aatch: yeah, it hasn't landed (at least, Foo::<Self>::foo() doesn't even parse)
[03:43:43] *** Joins: nsf (nsf@moz-EEF3238A.convex.ru)
[03:58:55] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[04:00:56] <olsonjeffery> brson: ping
[04:03:15] *** Joins: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net)
[04:06:37] *** Quits: tcr (tcr@moz-EE576D3C.hsd1.ma.comcast.net) (Ping timeout)
[04:09:40] <brson> olsonjeffery: pong
[04:12:12] <ChrisMorgan> brson: does Servo supports GET only at present?
[04:12:39] <brson> ChrisMorgan: yes
[04:13:02] <ChrisMorgan> Good. GET is easy :-)
[04:14:29] <dbaupp> ChrisMorgan: out of interested, have you experimented with ragel yet?
[04:14:33] <ChrisMorgan> No,
[04:15:10] *** Quits: boredomist (user@moz-63CF9F31.res-cmts.sesp.ptd.net) (Ping timeout)
[04:15:26] <strcat> brson: is debug! actually compiled out of regular programs too?
[04:15:30] <strcat> without enable debugging
[04:15:32] <strcat> hm
[04:15:51] <ChrisMorgan> rusti: debug!(foo)
[04:15:53] -rusti- pastebinned 11 lines of output: http://ix.io/7q9
[04:15:54] * strcat is unsure how to make a function with a side effect that's not annoying now
[04:15:59] <strcat> for benchmarking
[04:16:30] *** Quits: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net) (Quit: eatkinson)
[04:16:32] <dbaupp> strcat: yes
[04:16:41] <dbaupp> strcat: `info!`
[04:17:00] <strcat> ughhh LLVM is being too clever
[04:17:08] <ChrisMorgan> Looks like it is at the least checked.
[04:17:19] <strcat> dbaupp: ok that works
[04:18:11] <olsonjeffery> brson: the Seek trait isn't relevant for a FileStream built atop libuv
[04:18:18] <olsonjeffery> can i punt.. or just leave the fail!() stubs in place
[04:18:23] <olsonjeffery> ?
[04:18:37] <dbaupp> ChrisMorgan: it is, it expands to `if false { <actual debug! output> }`
[04:19:00] <olsonjeffery> ChrisMorgan: saw you published to github.. congrats!
[04:19:07] <ChrisMorgan> :-)
[04:19:30] <aatch> End then there's explicit dce that optimizes out the if false { ... } completely.
[04:19:37] <aatch> and*
[04:20:29] <olsonjeffery> brson: or i guess just push the stubs into RtioFileDescriptor..
[04:20:43] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[04:21:29] <brson> olsonjeffery: fail! is fine for now
[04:21:32] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[04:21:34] <brson> olsonjeffery: libuv doesn't support seek?
[04:22:04] *** Joins: alisdair (textual@1697D94C.7742FB18.FBC8476D.IP)
[04:22:21] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[04:22:34] <ChrisMorgan> brson: seeing mozilla-servo/rust-http makes me happy :-)
[04:22:41] <brson> ChrisMorgan: :)
[04:22:56] <brson> ChrisMorgan: still haven't really gotten started on integration yet. keep getting distracted
[04:23:07] * brson pretty much always distracted
[04:23:08] <olsonjeffery> brson: no seek, no tell, no flush...
[04:23:18] <brson> olsonjeffery: that's alarming
[04:23:54] <brson> people like to do that stuff!
[04:25:55] <strcat> I'm convinced it's impossible to write a benchmark of wrapping vs checked overflow + condition without xcrate trickery
[04:25:58] <strcat> we need volatile
[04:26:11] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[04:26:32] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[04:26:57] <bjz_> jeaye: eh, can't post on #concatenative :P
[04:27:13] <jeaye> bjz_: Can you help? :D
[04:27:42] <jeaye> You probably need to register. /msg nickserv help register
[04:27:47] <bjz_> jeaye: oh, was just posting this: https://github.com/mozilla/rust/wiki/Proposal-for-effects
[04:27:51] <dbaupp> strcat: why?
[04:27:56] <bjz_> brb
[04:27:57] <jeaye> bjz_: Ah, nice.
[04:27:58] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Bye!)
[04:28:04] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[04:28:13] <olsonjeffery> didn't one of the interns make an effects pitch at the beginning of summer?
[04:28:30] <dbaupp> olsonjeffery: that's bblum's effects proposal, yes
[04:28:30] <olsonjeffery> is this the same proposal?
[04:29:10] <olsonjeffery> ah, it is. nm.
[04:29:12] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[04:29:20] <strcat> dbaupp: because you can't write benchmarks right now
[04:29:21] <olsonjeffery> i misread.. i thought that wiki was a new proposal. sorry for butting in.
[04:29:29] <strcat> all the existing benchmarks are incorrect
[04:29:40] <dbaupp> strcat: more details? :)
[04:29:41] <bjz> olsonjeffery: butt in all you like :P
[04:29:43] <strcat> if you look at the IR, many aren't benchmarking what they're supposed to be benchmarking
[04:29:48] <strcat> dbaupp: LLVM is an optimizing compiler
[04:29:56] <dbaupp> oh, *that* problem
[04:30:02] <strcat> time is not considered a side effect ;p
[04:30:08] <strcat> anyway even with
[04:30:24] <strcat> #[inline(never)] fn opaque<T>(x: T) { info!("foo"); x }
[04:30:31] <strcat> it still optimizes through it
[04:30:33] <strcat> :|
[04:30:57] * strcat gives up
[04:31:13] <dbaupp> even if opaque is in a different crate?
[04:31:14] <engla> does it work to just put an assert on the result?
[04:31:56] <olsonjeffery> brson: *motions to bnoordhuis's response in #libuv*
[04:35:37] * strcat hopes building jemalloc 3 times won't slow it down noticeably
[04:39:19] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[04:42:40] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[04:43:08] *** Joins: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com)
[04:45:39] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[04:45:46] <olsonjeffery> brson: ok. i just need to do some polish on read() based on that conversation, add more tests and i'll have a PR.
[04:46:04] <brson> olsonjeffery: cool
[04:49:20] *** Quits: KindOne (KindOne@8704F4CB.B7D17EEE.EC6A1518.IP) (Ping timeout)
[04:52:10] <dbaupp> jeaye: one answer to your ML email is to remove @mut from your codebase entirely.
[04:52:53] <jeaye> I'd have to trade them for infectious lifetimes though, yes?
[04:53:37] <dbaupp> quite possibly
[04:53:40] *** Joins: KindOne (KindOne@8704F4CB.B7D17EEE.EC6A1518.IP)
[04:53:40] <jeaye> (though I'd probably rather manage lifetimes than borrow assertions) >.<
[04:54:02] *** Quits: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP) (Quit: carllerche)
[04:54:04] <dbaupp> using @ less will make concurrency easier too
[04:54:20] <jeaye> dbaupp: I'm hoping to save that as a last resort, honestly. I've several thousand lines now and @mut is... everywhere.
[04:54:37] <jeaye> It'd be a good idea to cut back though, no doubt.
[04:55:02] <dbaupp> i don't think this solves the direct problem of appending to the stack while iterating: it won't work at compile-time, rather than runtime.
[04:57:02] <jack> jeaye: perhaps you can split iterator state with the rest of the mutable state, so that pointers to each can exist at the same time.
[04:57:15] *** Quits: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[04:57:21] <strcat> jeaye: @mut is what you should regard as infectious, not lifetimes
[04:57:23] <jack> just getting rid of @mut won't help you, it will just manifest the error at compile time instead of runtime.
[04:57:36] <strcat> lifetimes clearly represent ownership, and statically guarantee that there are no mutability/borrowing errors
[04:58:25] *** Quits: valenting (Thunderbir@8758046C.84D5EFD5.FB866788.IP) (Ping timeout)
[04:58:59] <jeaye> strcat: Fair point.
[04:59:22] <strcat> (and @mut loses out on many benefits of rust, compared to say scala/nimrod)
[04:59:43] <dbaupp> (and C++)
[04:59:54] <jeaye> jack: I tried adding the states to another internal struct that was @mut, so the binding would be on that, not the Director; it didn't work, since the Director still was locked -- I'm probably missing something.
[05:00:19] <dbaupp> jeaye: if you destructor Director is should work
[05:00:22] <dbaupp> *it
[05:00:23] <strcat> I'm fairly sure the borrow sugar for @mut will be removed and replaced with explicit freeze scopes
[05:00:34] <strcat> it's a really bad thing to have in the core lang
[05:01:01] <strcat> (so is a runtime-dependent feature but... that's not as big of a deal)
[05:01:03] <dbaupp> jeaye: i.e. `let Director { states: ref mut states, stack: ref mut stack, _ } = my_director;`
[05:01:23] <dbaupp> strcat: isn't @ entirely runtime dependent anyway?
[05:01:37] <jack> jeaye: the director is locked but the other parts of director aren't.
[05:01:38] <strcat> dbaupp: that's what I mean by runtime-dependent
[05:01:42] <jeaye> dbaupp: I'm not familiar with that pattern. Is it documented somwhere?
[05:01:51] <strcat> as in, @ should be a compiler-support library feature rather than a language feature
[05:01:57] <strcat> like CheckedAdd/CheckedSub/CheckedMul
[05:02:18] <strcat> compiler-supported*
[05:02:23] <jack> if you decompose a &mut into two &muts that are distinct, the toplevel poitner is frozen, but you can still mutate all the data.
[05:02:28] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[05:02:56] <dbaupp> jeaye: it's the same as a `match my_director { Director {...} => ... }`, and as jack says, it's taking &mut's to two separate parts of the Director struct, so the compiler knows they don't alias and so they can be mutated together
[05:03:26] <dbaupp> as for documentation; probably not in any detail.
[05:05:22] <jeaye> jack: I was adding the deferred like so: https://gist.github.com/Jeaye/ab6d08dc26071932b73e
[05:06:47] * dbaupp shudders from the two @mut's in as many lines :P
[05:07:06] <jeaye> Don't look at q3 at all then. >.<
[05:07:40] <dbaupp> haha
[05:08:08] *** Joins: valenting (Thunderbir@8758046C.84D5EFD5.FB866788.IP)
[05:08:11] <jack> jeaye: yeah. so you'll need to split deferreds out from the piece that handles .push()
[05:08:20] <strcat> dbaupp: so, all that's really missing for iterators now is the random-access stuff
[05:09:06] <strcat> sorting, binary search, boyer-moore
[05:09:09] <jack> jeaye: another thing you could do is take the director's vector as a closure arg
[05:09:30] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[05:09:40] <jack> deferreds.push(|dir_state| { .... dir_state.push(game_state); })
[05:10:32] <jack> the director can certainly pass in a piece of itself for mutation without any problems.
[05:10:41] <dbaupp> strcat: yeah; I imagine the trickiest part will be making the ones handling &mut safe
[05:10:41] <jeaye> jack: I'm still not grasping how you suggest I can push to deferreds.
[05:10:52] <strcat> dbaupp: well it needs a swap fn
[05:11:06] <strcat> you just need to get 2 immutable refs, compare, and then swap
[05:11:10] <strcat> for sort
[05:11:13] <dbaupp> right
[05:11:29] <dbaupp> is there anything else that'd be useful for RAI?
[05:11:40] <strcat> it could expose a way to do &'self mut self -> &'self mut A
[05:11:40] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[05:11:42] *** Quits: lerc (quassel@B2E8CAD3.A8D14E52.788638A4.IP) (Ping timeout)
[05:11:46] <strcat> it's not incredibly important
[05:12:00] <strcat> dbaupp: http://dlang.org/phobos/std_algorithm.html http://dlang.org/phobos/std_range.html
[05:12:11] <strcat> dbaupp: http://en.cppreference.com/w/cpp/header/algorithm
[05:12:16] <strcat> for an idea of what could be implemented
[05:12:30] <strcat> lots of little gaps, but nothing huge is missing
[05:12:37] <jack> jeaye: can't you pass a mutable vec to the commands? they can push onto that.
[05:12:41] *** Joins: jaen (jaen@moz-28CE5B76.play-internet.pl)
[05:13:19] <jack> fn load_map(_: &str, params: &str, actions: @fn())
[05:13:31] <jeaye> jack: Ah, pass deferreds to load_map, basically?
[05:13:32] <jack> sorry, that's &mut [@fn()]
[05:13:48] *** Joins: lerc (quassel@B2E8CAD3.A8D14E52.788638A4.IP)
[05:13:50] <jack> so director is only giving out partial access to itself
[05:14:25] <jack> then after the events are fully processed, it runs thorugh deferreds passing in a differnet partial &mut
[05:15:13] <jeaye> That's a bummer, since 99% of the functions won't care about adding actions for Director. Sounds like it could work though.
[05:15:30] <jack> if you can split Director well you could even do it without deferreds maybe
[05:15:54] <jack> it's hard to be more specific without a bigger example.
[05:16:01] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[05:16:43] <jack> i'll note that your C++ example is not totally safe either because now you've created potential for non-termination
[05:16:54] <dbaupp> strcat: ah, a lot of little helpers, yeah.
[05:17:26] <jeaye> jack: That's true, but, in the general case, it's entirely _valid_ at least.
[05:17:39] <strcat> dbaupp: http://www.boost.org/doc/libs/1_54_0/libs/range/doc/html/range/headers/algorithm.html and a few more there
[05:17:54] <strcat> swap_ranges
[05:19:00] <dbaupp> I've had several places where Iterator<&mut A>.assign(Iterator<A>) would've been useful, fwiw
[05:19:18] <dbaupp> (it'd obliviate the need for .fill which someone (you?) where discussing earlier.)
[05:19:25] <dbaupp> *were
[05:19:43] <jeaye> I've a lot more information now. Thanks so much for all the help, jack, strcat, and dbaupp.
[05:19:51] <dbaupp> also, ones like .par_map would be *very* cool.
[05:19:56] <strcat> dbaupp: fill is pretty useless though so it's easy to write
[05:20:06] <strcat> reverse is at the point where it's much cleaner to call a method
[05:20:16] <strcat> since it's*
[05:20:18] * strcat sighs
[05:20:23] <strcat> typing after 10pm. it's a lost cause
[05:20:35] <strcat> s/10pm/1am/
[05:20:57] <dbaupp> for (rhs,lhs) in mut_iter.zip(iter) { *rhs = lhs; } is would be cool to be `mut_iter.assign(iter)`
[05:21:21] <dbaupp> and then fill would be mut_iter.assign(Repeat::new(x))
[05:21:32] *** Quits: KindOne (KindOne@8704F4CB.B7D17EEE.EC6A1518.IP) (Ping timeout)
[05:22:06] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[05:22:06] *** ChanServ sets mode: +o dherman
[05:23:07] *** Quits: valenting (Thunderbir@8758046C.84D5EFD5.FB866788.IP) (Ping timeout)
[05:26:19] <jeaye> I think I'll scrap this right now and just remove everything @mut. After that, better design with the Director will hopefully be more clear. Thanks again, folks.
[05:27:22] <Eridius> jeaye: I just got back to my computer, so hopefully someone already told you why pushing onto the stack when you're already iterating over it is dangerous
[05:27:43] <dbaupp> jeaye: good luck :)
[05:28:54] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Quit: Konversation terminated!)
[05:29:19] <jeaye> Eridius: Yes, I see how it could be dangerous. It could be managed though, which was my point. My problem stems from the overabundance of @mut throughout my entire codebase; I'll tackle that first. :)
[05:29:44] <Eridius> well the danger I'm thinking of is the push may need to reallocate, which would invalidate any outstanding borrows you have on elements in the stack
[05:30:12] <jeaye> In C++, and using indices (like I mentioned), reallocation is not a problem.
[05:30:46] <jeaye> In Rust, it's an entirely different beast that I totally see is not worth tempting.
[05:31:00] *** Joins: ab (alex@BC9D99CC.37C1012D.FE617B51.IP)
[05:31:01] <Eridius> if you always access everything via index into the stack, why do you have outstanding borrows preventing the push?
[05:32:34] <dbaupp> rusti: fn foo<A>(v: &mut [A]) { match v { [ref mut head, .. tail] => {} _ => {} } }
[05:32:36] -rusti- pastebinned 8 lines of output: http://ix.io/7qn
[05:32:40] <strcat> jeaye: it's not a different beast
[05:32:41] <dbaupp> that should be valid, shouldn't it? ^
[05:33:02] <strcat> jeaye: rust isn't going to throw any errors you wouldn't get in C++ if you don't borrow from a vector
[05:33:21] <strcat> and iterators are invalidated in C++ on a push to a vector
[05:33:23] <jeaye> strcat: Yeah, I'm just realizing that now that Eridius asks these questions.
[05:33:23] <dbaupp> (with `v` in accessible as long as head/tail are in scope.)
[05:33:30] *** Quits: cdidd (cdidd@moz-F91A9E76.broadband.corbina.ru) (Input/output error)
[05:33:42] <jeaye> The problem is how I'm iterating, with mutable iterators.
[05:33:43] <Eridius> dbaupp: tail moves out of v
[05:33:49] <ChrisMorgan> dbaupp: you'd want `ref tail`, surely?
[05:34:03] <jeaye> strcat: Right. I removed iterators from the equation in C++, but left them in Rust.
[05:34:06] <jeaye> Unfair.
[05:34:34] <jeaye> Sorry for the misunderstanding.
[05:34:59] *** Joins: KindOne (KindOne@moz-2A62ED07.dynamic.ip.windstream.net)
[05:35:34] <dbaupp> Eridius: I don't think so
[05:35:40] <dbaupp> Eridius: it's a slice
[05:36:30] <dbaupp> rusti: fn foo<A>(v: &mut [A]) { match v { [ref mut head, .. ref mut tail] => { (*tail)[0] = *head; } _ => {} } }
[05:36:33] -rusti- pastebinned 11 lines of output: http://ix.io/7qp
[05:36:34] <Eridius> dbaupp: it is? then the compiler is wrong
[05:36:59] <dbaupp> (that failures is correct, ignore it.)
[05:37:24] <dbaupp> rusti: fn foo<A: Clone>(v: &mut [A]) { match v { [ref mut head, .. ref mut tail] => { (*tail)[0] = head.clone(); } _ => {} } }
[05:37:27] <Eridius> dbaupp: you should probably file an issue about tail being considered by-move, if it's really just a slice
[05:37:30] -rusti- pastebinned 8 lines of output: http://ix.io/7qq
[05:37:46] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[05:37:56] <jeaye> rusti: for x in range(0, 0) { 1 }
[05:37:57] -rusti- <anon>:5:9: 6:5 error: mismatched types: expected `()` but found `<VI2>` (expected () but found integral variable)
[05:37:57] -rusti- <anon>:5          for x in range(0, 0) { 1 }
[05:37:57] -rusti- <anon>:6     };
[05:37:57] -rusti- error: aborting due to previous error
[05:37:57] -rusti- application terminated with error code 101
[05:38:14] <jeaye> rusti: for x in range(0, 0) { printf("1"); }
[05:38:15] -rusti- <anon>:5:32: 5:38 error: unresolved name `printf`. Did you mean `i`?
[05:38:15] -rusti- <anon>:5          for x in range(0, 0) { printf("1"); }
[05:38:15] -rusti-                                          ^~~~~~
[05:38:15] -rusti- error: aborting due to previous error
[05:38:15] -rusti- application terminated with error code 101
[05:38:21] <jeaye> gah
[05:38:27] <jeaye> rusti: for x in range(0, 0) { print("1"); }
[05:38:28] -rusti- <anon>:5:13: 5:14 warning: unused variable: `x` [-W unused-variable (default)]
[05:38:28] -rusti- <anon>:5          for x in range(0, 0) { print("1"); }
[05:38:28] -rusti-                       ^
[05:38:28] -rusti- ()
[05:38:32] *** Joins: zozed (Mibbit@FA17B8B7.6F607646.85BF2EFC.IP)
[05:38:47] <nsf> error: unresolved name `printf`. Did you mean `i`?
[05:38:49] <nsf> lol
[05:38:53] <nsf> yes, compiler, just a typo, sorry
[05:38:55] <nsf> :D
[05:38:58] <jeaye> haha
[05:39:26] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Ping timeout)
[05:39:32] <Eridius> rusti: for x in range(0,0) { printfln!(()) }
[05:39:33] -rusti- <anon>:5:13: 5:14 warning: unused variable: `x` [-W unused-variable (default)]
[05:39:33] -rusti- <anon>:5          for x in range(0,0) { printfln!(()) }
[05:39:33] -rusti-                       ^
[05:39:33] -rusti- ()
[05:39:41] <zozed> Rust will never likely be a jited langauge and remain a compiled language like C/C++. Am I right?
[05:39:52] <Eridius> zozed: go tell that to rusti ;)
[05:40:09] <Ralith> zozed: rust is a language, not an implementation.
[05:40:13] <nsf> zozed: JIT compilation is still a compilation
[05:40:32] <zozed> I mean the refrence rustc
[05:40:44] <Ralith> there's a reference rustc?
[05:40:55] <dbaupp> zozed: rusti-the-program does JIT compilation
[05:40:59] <mm> Well there's only one rustc
[05:41:07] <mm> and thus it is the reference
[05:41:09] <Eridius> zozed: the binary rustc that gets installed when you install the canonical rust implementation will, yes, probably always produce a statically compiled binary, and not a binary that uses JIT compilation
[05:41:13] <zozed> rustc is the refrence implimentation 
[05:41:15] <strcat> JIT compilers aren't useful for a language like Rust, at least until a decade or so from now
[05:41:22] <Eridius> although that's just my opinion
[05:41:40] <strcat> ahead-of-time compilation with a low optimization level is faster than the JIT startup time and generates better code
[05:41:50] <strcat> :s
[05:41:58] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[05:41:59] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/qoX3pQ
[05:41:59] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[05:42:04] *** Quits: lmandel (lmandel@moz-9CE00FC0.holiday-inn-express.mozilla.hq) (Quit: lmandel)
[05:42:27] <strcat> LLVM's JIT still has to compile every single function initially, just not well
[05:42:42] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[05:42:43] <strcat> so it can't be faster than -O0 done ahead-of-time, and ends up a bit slower than -O1
[05:42:59] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[05:43:00] *** ChanServ sets mode: +o dherman
[05:43:15] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[05:43:21] <strcat> and then it has to do a bunch of measuring to figure out what to optimize, so there's overhead and a limit to what you can do
[05:43:22] *** Joins: cdidd (cdidd@moz-52759E87.broadband.corbina.ru)
[05:43:43] <zozed> ok :)
[05:43:47] <strcat> can do reasonable well in microbenchmarks at least since you're just hitting a single inner loop
[05:44:06] *** Quits: zozed (Mibbit@FA17B8B7.6F607646.85BF2EFC.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[05:44:23] * strcat wants PGO for rust
[05:44:33] <strcat> I don't think LLVM implements it yet ;[
[05:46:38] <dbaupp> strcat: doesn't clang have PGO?
[05:46:42] <strcat> don't think so
[05:46:46] <strcat> gcc does
[05:47:03] <jeaye> rusti: for x in range(3, 0) { printf!("%? ", x); }
[05:47:04] -rusti- ()
[05:47:26] <jeaye> rusti: for x in rev_range(3, 0) { printf!("%? ", x); }
[05:47:26] -rusti- <anon>:5:18: 5:27 error: unresolved name `rev_range`.
[05:47:26] -rusti- <anon>:5          for x in rev_range(3, 0) { printf!("%? ", x); }
[05:47:26] -rusti-                            ^~~~~~~~~
[05:47:26] -rusti- error: aborting due to previous error
[05:47:27] -rusti- application terminated with error code 101
[05:47:29] <Eridius> PGO?
[05:47:37] <Eridius> jeaye: range().invert()
[05:47:43] <Eridius> rusti: for x in range(0, 3).invert() { printfln!(x) }
[05:47:44] -rusti- 2
[05:47:45] -rusti- 1
[05:47:45] -rusti- 0
[05:47:45] -rusti- ()
[05:47:45] <strcat> profile-guided optimization
[05:48:01] <jeaye> Eridius: Odd it doesn't assert 3 < 0 in my case
[05:48:05] <strcat> it inserts stat generating code to profile it, and you run it through a profile representing the workload
[05:48:14] <Eridius> jeaye: why bother asserting? range(3,0) is simply empty
[05:48:23] <strcat> and then you recompile using that information, and it magically knows where all the cold/hot code is, which branches are cold/hot and so on
[05:48:27] <Eridius> strcat: neat
[05:48:44] <strcat> Eridius: with gcc, gcc -fprofile-generate -O3 foo.c, run ./a.out, and recompile with -fprofile-use -O3
[05:48:46] <jeaye> rusti: for x in rev_range(0, 0).invert() { printf!("%? ", x); }
[05:48:47] -rusti- <anon>:5:18: 5:27 error: unresolved name `rev_range`.
[05:48:47] -rusti- <anon>:5          for x in rev_range(0, 0).invert() { printf!("%? ", x); }
[05:48:48] -rusti-                            ^~~~~~~~~
[05:48:48] -rusti- error: aborting due to previous error
[05:48:48] -rusti- application terminated with error code 101
[05:48:53] <jeaye> rusti: for x in range(0, 0).invert() { printf!("%? ", x); }
[05:48:55] -rusti- ()
[05:49:10] <strcat> Eridius: much better with large programs like firefox. makes them much smaller/faster
[05:49:21] <strcat> oh hey, 99% of this code is cold.
[05:49:38] <Eridius> strcat: so basically it can be a lot smarter about when it inlines?
[05:49:44] <strcat> Eridius: well not just that
[05:49:56] <strcat> there are many size vs performance tradeoffs it can make
[05:50:00] <strcat> and how it orders branches/tables
[05:50:00] <Eridius> true
[05:50:13] <strcat> how much it unrolls
[05:50:15] <strcat> vectorizes
[05:50:34] <strcat> PGO is the biggest optimization switch available with gcc
[05:50:52] <Eridius> but of course you need to give it a real workload that's representative for it to be effective
[05:50:56] *** Quits: jaen (jaen@moz-28CE5B76.play-internet.pl) (Ping timeout)
[05:51:05] <strcat> Eridius: right, firefox has a whole profiling suite
[05:51:25] <strcat> the official builds use PGO, and at the very least the distro I use does in the package ;]
[05:51:39] <strcat> for a small program it's easy
[05:51:52] <strcat> Eridius: it would be trivial to do for rustc
[05:51:55] <strcat> you just run the test suite
[05:51:57] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[05:51:57] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/CG3FhA
[05:51:57] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[05:52:00] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[05:52:00] <ghrust> 01[13rust01] 15bors pushed 9 new commits to 06auto: 02http://git.io/A69OWQ
[05:52:00] <ghrust> 13rust/06auto 142f34cf8 15Patrick Walton: librustc: Remove `&const` and `*const` from the language....
[05:52:00] <ghrust> 13rust/06auto 148237add 15Patrick Walton: librustc: Add support for type parameters in the middle of paths....
[05:52:00] <ghrust> 13rust/06auto 143cca6e5 15Patrick Walton: librustc: Ensure that type parameters are in the right positions in paths....
[05:52:02] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[05:52:03] <strcat> or a tiny subset of it
[05:52:22] <strcat> in fact you could probably profile in stage2 and use the info in stage3
[05:53:45] <dbaupp> strcat: I guess there are many lower-hanging fruit for rustc's performance still
[05:53:58] <Eridius> strcat: well, assuming that the test suite is actually representative
[05:54:39] <strcat> dbaupp: well, if LLVM actually had PGO it would be the lowest hanging fruit
[05:54:43] <strcat> Eridius: it is
[05:54:52] <dbaupp> strcat: true, but since it doesn't....
[05:55:11] <strcat> Eridius: it doesn't have to be perfect anyway, only has to exercise most of the code a bit
[05:55:28] <Eridius> strcat: it is? The test suite is designed to try to test all APIs, rather than being a representative real-world codebase. For example, the test suite isn't going to have much complicated logic, or particularly deep callstacks
[05:55:37] <Eridius> strcat: I would suggest that compiling rustc itself is a much better test
[05:55:42] <strcat> Eridius: it doesn't have to be perfect though
[05:56:05] <dbaupp> Eridius: presumably compiling the stdlib/rustc itself could be included, yes.
[05:56:07] <strcat> the important part is hitting most of the codebase you care about
[05:56:21] <Eridius> strcat: I would wager that profiling rustc while it compiles the testsuite would actually be counterproductive, because it would be optimizing for the wrong thing
[05:56:32] <strcat> Eridius: I don't think it would
[05:56:49] <strcat> keep in mind it's not a really high-level optimization, it's making low-level decisions
[05:57:01] <Eridius> eh, maybe. I don't know enough about what it would actually decide
[05:57:06] <strcat> even a poorly represented workload is better than no workload 90% of the time
[05:57:07] <Eridius> I suppose we'd just have to turn it on and see what happens
[05:57:12] <strcat> representative*
[05:57:44] *** Quits: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com) (Ping timeout)
[05:58:22] <dbaupp> strcat: http://llvm.org/OpenProjects.html#profileguided
[05:59:39] *** Quits: jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net) (Quit: zzz)
[06:02:20] *** Joins: mihneadb (mihneadb@moz-329F29A3.lightspeed.sntcca.sbcglobal.net)
[06:02:33] *** Joins: sankha94 (Instantbir@7061CD01.D6BD0D91.22D41759.IP)
[06:02:53] *** Quits: saml (sam@moz-14C16814.cst.lightpath.net) (Ping timeout)
[06:04:15] *** Joins: saml (sam@moz-14C16814.cst.lightpath.net)
[06:04:32] <bjz> cmr: struct-style loader is done!
[06:04:48] <dbaupp> Eridius: https://github.com/mozilla/rust/issues/8636 btw
[06:04:51] <bjz> cmr: now I need to update the readme
[06:06:38] <strcat> and... we use jemalloc again
[06:09:09] <dbaupp> \o/
[06:11:49] *** Joins: untwisted (untwisted@moz-D29D1803.reverse.softlayer.com)
[06:13:42] <strcat> locally, there's no real impact on compiles (due to building it 3 times) and a minor test speedup
[06:13:55] <strcat> but rustc doesn't use parallelism or small allocs
[06:14:18] <strcat> treemap is reasonably fast again :)
[06:16:06] *** Joins: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com)
[06:16:21] <dbaupp> can we hack the make files to not compile jemalloc several times?
[06:16:28] <dbaupp> (does libuv get compiled several tiems?)
[06:17:18] <strcat> libuv does now afaict
[06:17:28] <strcat> dbaupp: it would involve a total reorganization of the build system
[06:17:46] <strcat> building multiple times is just what it does - there are no output dirs for non-staged binaries
[06:17:53] <strcat> you could have it copy over the old ones
[06:18:01] <strcat> like it does for some stuff
[06:18:23] <dbaupp> that's what I was going to suggest :P
[06:22:13] *** sankha94 is now known as sankha93_
[06:27:11] *** Joins: HollyRain (HollyRain@moz-50A83091.dyn.user.ono.com)
[06:27:23] *** Joins: robertknight (robertknig@moz-731801B5.range86-144.btcentralplus.com)
[06:29:23] <dbaupp> strcat: your github thing changed from being upside down :'(
[06:29:33] <strcat> dbaupp: because github killed those default avatars
[06:29:42] <strcat> so I removed by upside-down one
[06:30:04] <strcat> a sad day. :P
[06:30:13] <dbaupp> haha
[06:30:29] <strcat> and found out that gravatar accounts cannot be deleted
[06:30:34] <strcat> it exists for all eternity
[06:30:45] *** Quits: robn (robn@moz-76B0302C.static.internode.on.net) (Ping timeout)
[06:31:01] <dbaupp> really?
[06:31:18] <strcat> yep
[06:31:27] *** Joins: robn (robn@moz-76B0302C.static.internode.on.net)
[06:31:35] <bjz> hah, yikes
[06:31:40] <strcat> and for people who care, it reveals your email address through the name of the profile img
[06:31:46] <strcat> it's a direct md5 of your email
[06:32:23] <strcat> not that it really matters. but it means it's associated with your real name, if your email is
[06:32:37] * strcat doesn't think people would realize that
[06:32:49] <strcat> and they can never fix it without breaking all the links, so they won't
[06:32:57] <dbaupp> :(
[06:33:19] <dbaupp> ... they could have a v2 api or something, surely.
[06:34:02] <ChrisMorgan> It's still got to be a direct function of your email address. Sure, MD5 will make it a little faster to associate if you care about such things.
[06:34:02] <strcat> dbaupp: but all the existing links have to remain for sites that used it
[06:34:26] <strcat> ChrisMorgan: it doesn't - it can be a key into a table on their server
[06:34:38] *** Parts: HollyRain (HollyRain@moz-50A83091.dyn.user.ono.com) (bye)
[06:34:59] <strcat> if they made you authorize sites
[06:35:02] <strcat> but they don't
[06:35:05] <strcat> ;\
[06:35:12] <ChrisMorgan> And that's a feature.
[06:35:13] <bjz> you'd think they wouldn't use gravatar directly
[06:35:22] <dbaupp> strcat: yes, they can just leave it unsupported, but still around.
[06:35:41] <bjz> sounds like they did a pretty hacky implementation (github)
[06:35:44] <mm> fortunately (at least for github), my email is already exposed in all my commits ;)
[06:35:54] <strcat> ChrisMorgan: a feature they should make clear when you register for an account you can't delete :P
[06:36:10] <strcat> mm: sure, but it means you can't use your real email account on any site where you want to keep your identity separate
[06:36:19] <strcat> because one day they might start using gravatar
[06:36:38] <mm> strcat: I agree that in general it sucks
[06:36:59] <bjz> strcat: so you can't change your gravatar now?
[06:37:00] *** Joins: sebcrozet (sebcrozet@moz-C27D92D8.w193-252.abo.wanadoo.fr)
[06:37:20] <strcat> bjz: you can, it just defaults to a weird auto-generated img if you don't have one
[06:37:39] <strcat> mm: I also hate not being able to make per-site avatars, since ofc they won't provide the option anymore
[06:37:41] * strcat sighs
[06:37:46] *** Joins: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP)
[06:37:55] * doy just uses per-site email addresses
[06:38:14] <bjz> strcat: oh, so you can overwrite the gravatar github set for you
[06:38:21] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[06:38:27] <mm> I tend to do service@<my domain> when I sign up for things
[06:38:51] <strcat> you can actually do emailaddress+tag@foo.tld to make the gravatar unique per-site if you plan ahead ;p
[06:39:03] <strcat> but who does that! :)
[06:39:12] * dbaupp does that
[06:39:40] <dbaupp> (although I only use gravatar for github, so I guess it's almost-vacuously true.)
[06:40:01] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Ping timeout)
[06:40:11] *** flaper87|afk is now known as flaper87
[06:40:13] <strcat> dbaupp: but if your email was used elsewhere, it would automatically use the gravatar ;p
[06:40:49] <dbaupp> strcat: well, it's ..+github@gmail.com :P
[06:40:55] <strcat> ah
[06:41:10] <strcat> dbaupp: just wait until gravatar learns to parse that
[06:41:19] <dbaupp> haha
[06:41:53] <dbaupp> strcat: also, I was thinking (dangerous stuff), is there any particular reason we shouldn't convert &[] to be (start ptr, end ptr)?
[06:41:57] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[06:41:57] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 146b4c43a to 145034792: 02http://git.io/N3iJvQ
[06:41:57] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[06:41:59] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[06:41:59] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Quptug
[06:41:59] <ghrust> 13rust/06auto 14d9293d1 15Tim Chevalier: rustpkg: Un-ignore most of the remaining tests...
[06:41:59] <ghrust> 13rust/06auto 14c099242 15bors: auto merge of #8548 : catamorphism/rust/unignore-rustpkg-tests, r=catamorphism...
[06:42:00] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[06:42:01] <dbaupp> (other than the effort it requires.)
[06:42:34] *** Joins: Ms2ger (Ms2ger@moz-590E79FE.adsl-dyn.isp.belgacom.be)
[06:43:22] <bjz> dbaupp: what is it now? (start ptr, len)?
[06:43:41] <strcat> dbaupp: dunno
[06:43:45] <strcat> I don't really care anymore ;p
[06:43:51] *** Joins: tgummerer (tgummerer@B864C03E.A5F114BE.8465EFE9.IP)
[06:44:04] <dbaupp> bjz: yes
[06:44:06] <strcat> we *could* eliminate the difference between iterators/slices for vectors
[06:44:10] <strcat> by doing that
[06:44:18] <dbaupp> and str
[06:44:49] <dbaupp> I guess it's a far-future/cleanup thing.
[06:50:58] <ChrisMorgan> std::rt::io::Stream is misleading. It's `trait Stream: Reader + Writer;`, but it's not *equivalent* to Reader + Writer: one must still `impl Stream for MyType;`, which doesn't seem to be done much. I guess the real solution without modifying the compiler is `impl<T: Reader + Writer> Stream for T;`?
[06:52:22] *** Quits: mihneadb (mihneadb@moz-329F29A3.lightspeed.sntcca.sbcglobal.net) (Input/output error)
[06:54:02] <dbaupp> ChrisMorgan: https://github.com/mozilla/rust/issues/8634 would also solve it
[06:56:02] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[06:59:02] *** Quits: robertknight (robertknig@moz-731801B5.range86-144.btcentralplus.com) (Ping timeout)
[06:59:59] *** Quits: alisdair (textual@1697D94C.7742FB18.FBC8476D.IP) (Quit: Textual IRC Client: www.textualapp.com)
[07:00:24] *** Quits: ab (alex@BC9D99CC.37C1012D.FE617B51.IP) (Connection reset by peer)
[07:01:11] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[07:02:07] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[07:04:28] *** Joins: ab (alex@BC9D99CC.37C1012D.FE617B51.IP)
[07:05:46] <dbaupp> ChrisMorgan: how did you get the macro to work? https://news.ycombinator.com/item?id=6240437
[07:05:53] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[07:06:18] <ChrisMorgan> dbaupp: that's code generation
[07:07:07] <ChrisMorgan> branchify! is just syntax sugar with no real value.
[07:07:11] <dbaupp> ChrisMorgan: oh, right, it's expanding to something that prints out the actual source
[07:07:15] <ChrisMorgan> Yep.
[07:07:24] <ChrisMorgan> See src/libhttp/codegen/{branchify,read_method}.rs
[07:15:44] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[07:17:05] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[07:24:27] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[07:24:44] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[07:30:26] *** Joins: rovar (rovar@moz-203658CB.nycmny.fios.verizon.net)
[07:30:29] *** Quits: rovar_ (rovar@moz-203658CB.nycmny.fios.verizon.net) (Ping timeout)
[07:32:28] *** Joins: squiddy (squiddy@moz-FC1DD794.adsl.alicedsl.de)
[07:33:22] *** Quits: sankha93_ (Instantbir@7061CD01.D6BD0D91.22D41759.IP) (Ping timeout)
[07:38:17] *** Quits: sebcrozet (sebcrozet@moz-C27D92D8.w193-252.abo.wanadoo.fr) (Ping timeout)
[07:38:43] *** Joins: sebcrozet (sebcrozet@moz-D8879CC3.w80-13.abo.wanadoo.fr)
[07:38:48] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[07:39:25] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[07:40:29] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Ping timeout)
[07:42:08] *** Quits: ross (ross@moz-8A84103E.br.br.cox.net) (Quit: )
[07:43:19] *** Quits: igl (igl@moz-52A8F9AD.adsl.alicedsl.de) (Ping timeout)
[07:43:38] *** Joins: igl (igl@moz-DF191522.adsl.alicedsl.de)
[07:47:13] <bjz> cmr: would you prefer gl::Viewport/gl::RED_BITS or glViewport/GL_RED_BITS ?
[07:52:51] <dbaupp> bjz: as a complete outsider, the former
[07:53:04] <bjz> dbaupp: mmk
[07:53:40] <bjz> dbaupp: the challenge is that the types that opengl use are prefixed by `GL`
[07:53:50] <bjz> GLfloat etc
[07:54:21] <bjz> so I have to have people do: use gl; use gl::types::*;
[07:55:43] *** Joins: sankha93_ (Instantbir@7061CD01.D6BD0D91.22D41759.IP)
[07:56:20] <bjz> rusti: extern mod extra; mod { fn f() { extra::treemap::TreeSet::new::<int>(); } }
[07:56:25] -rusti- pastebinned 7 lines of output: http://ix.io/7qv
[07:57:29] <dbaupp> rusti: imports extra by default, btw
[07:57:30] -rusti- <anon>:5:17: 5:22 error: expected one of `; }` but found `extra`
[07:57:30] -rusti- <anon>:5          imports extra by default, btw
[07:57:30] -rusti-                           ^~~~~
[07:57:30] -rusti- application terminated with error code 101
[07:57:34] <dbaupp> er, oops.
[07:57:59] <bjz> dbaupp: if I do `extern mod foo` is foo::bar() accessable everywhere?
[07:58:12] <bjz> or do I need use foo;
[07:58:15] <dbaupp> no, yes
[07:58:25] <bjz> mmk
[07:58:40] <dbaupp> (and the extern mod has to be at the top level, for `use foo;` to work as you expect)
[07:59:21] <bjz> mm
[07:59:31] *** Joins: squiddy_ (squiddy@moz-98BAD2FA.adsl.alicedsl.de)
[07:59:34] <bjz> okiedokie
[08:00:28] *** Quits: squiddy (squiddy@moz-FC1DD794.adsl.alicedsl.de) (Ping timeout)
[08:01:17] <bjz> dbaupp: yeah, annoying about the gl type names
[08:01:23] *** Joins: fabiand (fabiand@moz-121185FF.adsl.alicedsl.de)
[08:02:10] <bjz> dbaupp: can't do gl::float
[08:02:15] <dbaupp> bjz: yeah, you're forced to be inconsistent because shadowing float would be bad
[08:02:17] <dbaupp> yeah
[08:02:46] <dbaupp> (or, just have a GL prefix on everything, but I'd say that's worse... so much unnecessary noise.)
[08:03:31] <mm> bjz: the number of "bonus" hilights I get in this channel is too damn high ;)
[08:03:51] <bjz> rusti: mod gl { pub type float = std::libc::c_float; } let x: gl::float = 3.5; x
[08:03:53] -rusti- pastebinned 11 lines of output: http://ix.io/7qw
[08:04:00] <dbaupp> mm: haha
[08:04:11] <bjz> mm: haha, sorry
[08:04:20] <dbaupp> rusti: mod gl { pub type float = ::std::libc::c_float; } let x: gl::float = 3.5; x
[08:04:22] -rusti- 3.5
[08:04:22] <mm> The funny thing is I do it to myself :P
[08:04:24] <dbaupp> bjz: be less pensive :P
[08:04:41] <bjz> dbaupp: hey that's not actually too bad
[08:05:16] <bjz> I think?
[08:05:23] <Ms2ger> A lot nicer than it looks like C++
[08:05:37] <dbaupp> bjz: I'm sure you'll enjoy debugging `use gl::*; ... -> float { ... }` :P
[08:05:46] <bjz> dbaupp: yeah
[08:06:00] <bjz> dbaupp: that would be a pain
[08:06:10] <Ms2ger> (Is use x::* deprecated already?)
[08:07:08] <bjz> rusti: mod gl { pub type float = ::std::libc::c_float; pub static X: float = 3.5; } let x: float = gl::X; x
[08:07:09] -rusti- 3.5
[08:07:11] <dbaupp> Ms2ger: no?
[08:07:23] <bjz> heh
[08:07:31] <dbaupp> bjz: c_float is a typedef for rust::float
[08:07:42] <dbaupp> wait... that doesn't make sense
[08:07:51] <dbaupp> surely it should be a typedef for f32
[08:08:08] <bjz> :[
[08:08:10] <dbaupp> it is.
[08:08:12] * dbaupp is confused
[08:08:25] <dbaupp> wait, no I'm not.
[08:08:28] <bjz> yeah, exactly why shadowing is confusing
[08:08:43] <bjz> rusti: mod gl { pub type float = ::std::libc::c_float; pub static X: ::gl::float = 3.5; } let x: float = gl::X; x
[08:08:45] -rusti- pastebinned 11 lines of output: http://ix.io/7qy
[08:08:50] <dbaupp> rusti: mod gl { pub type float = ::std::libc::c_float; pub static X: float = 3.5; } let x: gl::float = gl::X; x
[08:08:51] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[08:08:51] -rusti- <anon>:5:105: 5:110 error: mismatched types: expected `f32` but found `float` (expected f32 but found float)
[08:08:51] -rusti- <anon>:5          mod gl { pub type float = ::std::libc::c_float; pub static X: float = 3.5; } let x: gl::float = gl::X; x
[08:08:51] -rusti-                                                                                                                   ^~~~~
[08:08:52] -rusti- error: aborting due to previous error
[08:08:53] -rusti- application terminated with error code 101
[08:09:15] <bjz> mm
[08:09:20] <bjz> oh
[08:09:23] <bjz> woops :P
[08:09:24] <dbaupp> bjz: (rusti can't use-ing from inside modules you defined, it's inside a function.)
[08:09:35] <dbaupp> but yeah, the problem was that there was no shadowing :P
[08:09:57] <dbaupp> (and the use-ing restriction includes global paths like ::gl::float)
[08:10:31] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Ping timeout)
[08:10:39] <bjz> dbaupp: so I'm guessing I should stay away from typedefing float :P
[08:11:33] <bjz> dbaupp: these are the painful typedefs I have to deal with: https://github.com/bjz/gl-rs/blob/master/generator/ty.rs#L9
[08:12:12] <dbaupp> bjz: yeah, you should `type int = ::std::libc::c_float`, to avoid people confusing the two different "float"s :P
[08:12:17] <mm> error: internal compiler error: drop_ty_immediate: non-box ty
[08:12:20] <mm> :-(
[08:12:30] <bjz> ?
[08:12:46] <bjz> dbaupp: whu?
[08:13:07] * dbaupp was joking
[08:13:11] <bjz> oh
[08:13:13] <bjz> hah
[08:13:15] <bjz> funny
[08:13:18] <bjz> is dbaupp
[08:13:22] <dbaupp> heh :P
[08:13:33] <dbaupp> btw, both the allocations on https://github.com/bjz/gl-rs/blob/master/generator/ty.rs#L4 are unnecessary
[08:13:49] <dbaupp> rusti: let ty = "GLenum"; " -> " + ty
[08:13:50] -rusti- ~" -> GLenum"
[08:14:33] <bjz> ahh, neat!
[08:14:43] <dbaupp> and you could have `to_rust_ty(ty: &str) -> &'static str { ... }` with each arm of the match returning `"..."` rather than `~"..."`; if you're feeling like micro-optimising the code generator :P
[08:14:59] * dbaupp has developed a repulsion to allocations
[08:15:13] <bjz> neat
[08:15:18] *** Quits: igl (igl@moz-DF191522.adsl.alicedsl.de) (Ping timeout)
[08:15:22] <bjz> still learning this stuff
[08:16:58] *** Joins: igl (igl@moz-2C40A1FA.adsl.alicedsl.de)
[08:17:24] <bjz> dbaupp: my generator is horrible at allocations
[08:19:12] <dbaupp> bjz: it doesn't matter... presumably the speed/memory usage of the generator isn't a problem at all :)
[08:19:18] <bjz> yeah
[08:19:36] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[08:20:10] <dbaupp> pnkfelix: only one visitor-pr to go! :)
[08:20:22] *** Quits: KindOne (KindOne@moz-2A62ED07.dynamic.ip.windstream.net) (Ping timeout)
[08:20:34] <bjz> still, I like to keep a light footprint
[08:21:06] <dbaupp> you can have the slimmest gl -> rust code generator in the west.
[08:23:13] <bjz> dbaupp: you should look at the horribleness of ./generator/registry.rs
[08:23:30] <bjz> dbaupp: clone clone clone
[08:23:52] <bjz> doesn't seem to affect perf too much though
[08:23:56] <bjz> but still
[08:24:31] *** Quits: recrack (Mibbit@B4104EBB.3CC170B1.1E14B209.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[08:24:49] *** Joins: KindOne (KindOne@moz-1503D710.dynamic.ip.windstream.net)
[08:26:54] <bjz> dbaupp: oki, done: https://github.com/bjz/gl-rs/commit/fd9177e909bc8d26893cd2591b1d94d6ea2e80ff
[08:27:29] <bjz> dbaupp: at least in rust you get a clear idea of when you are copying
[08:27:44] *** Joins: SingingBoyo (brandon@4DF3381A.51F4D838.4F048BDC.IP)
[08:28:19] *** Joins: CarpNet (ac@moz-FD24B77.sohonet.co.uk)
[08:28:44] <pnkfelix> dbaupp: yeah exciting.  But that's the lint.rs rewrite
[08:29:45] <pnkfelix> dbaupp: wait, are you someone who's done lint.rs work in the past?  I was waiting for niko to give the lint.rs mods another once-over, but if there's someone else who's comfortable sanity-checking it...
[08:30:22] *** Joins: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP)
[08:31:11] <dbaupp> pnkfelix: yeah, I did lint.rs for aatch's visitor rewrite
[08:31:26] <dbaupp> (I'm happy do sanity check it, but I'll be away for a little while.)
[08:31:29] <dbaupp> *to
[08:32:02] <pnkfelix> dbaupp: That's okay, we've got time.  I'll make a PR and put both your and niko's username's on it.
[08:32:11] <dbaupp> bjz: \o/
[08:33:02] <dbaupp> pnkfelix: coolio, if you do it in the next few hours I should be able to have a look tonight or tomorrow. :)
[08:34:31] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Quit: Leaving.)
[08:35:33] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[08:40:10] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[08:40:42] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[08:42:42] *** Quits: KindOne (KindOne@moz-1503D710.dynamic.ip.windstream.net) (Ping timeout)
[08:46:55] *** Joins: KindOne (KindOne@61104893.EA06E3F.34F73994.IP)
[08:48:23] <SingingBoyo> whoops.  managed to pull into a branch I had an r+'d PR on.  sigh.
[08:48:44] *** AutomatedTester|AFK is now known as AutomatedTester
[08:52:07] *** Quits: Ms2ger (Ms2ger@moz-590E79FE.adsl-dyn.isp.belgacom.be) (Ping timeout)
[08:52:39] *** Joins: z0w0 (zack@moz-7E6DC3A.lnse2.woo.bigpond.net.au)
[08:52:44] *** Quits: m_kato (m_kato@moz-C286AD9A.bitcat.net) (Quit: Leaving...)
[08:53:56] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[08:55:55] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[08:56:04] *** Joins: igl1 (igl@moz-CF72C8A0.adsl.alicedsl.de)
[08:56:08] *** Quits: igl (igl@moz-2C40A1FA.adsl.alicedsl.de) (Ping timeout)
[08:57:22] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[08:58:16] *** Quits: sankha93_ (Instantbir@7061CD01.D6BD0D91.22D41759.IP) (Ping timeout)
[09:03:47] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[09:03:52] *** Joins: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk)
[09:08:13] *** Joins: igl (igl@moz-4EE4D871.adsl.alicedsl.de)
[09:08:15] *** Quits: Mowah (Mowah@moz-436C35C5.cust.bredbandsbolaget.se) (Ping timeout)
[09:08:19] *** Joins: Ms2ger (Ms2ger@moz-BFA74791.ugent.be)
[09:08:34] *** Quits: igl1 (igl@moz-CF72C8A0.adsl.alicedsl.de) (Ping timeout)
[09:09:23] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[09:11:04] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Ping timeout)
[09:11:05] *** Joins: Mowah (Mowah@moz-436C35C5.cust.bredbandsbolaget.se)
[09:11:57] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[09:11:57] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Quptug
[09:11:57] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[09:12:23] *** Quits: igl (igl@moz-4EE4D871.adsl.alicedsl.de) (Ping timeout)
[09:12:26] *** Joins: igl (igl@moz-6C3168E1.adsl.alicedsl.de)
[09:14:14] *** Quits: sebcrozet (sebcrozet@moz-D8879CC3.w80-13.abo.wanadoo.fr) (Ping timeout)
[09:20:36] *** Joins: sankha93_ (Instantbir@7061CD01.D6BD0D91.22D41759.IP)
[09:22:01] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[09:22:01] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/9mIWQg
[09:22:01] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[09:22:01] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[09:22:01] <ghrust> 01[13rust01] 15bors pushed 9 new commits to 06auto: 02http://git.io/mOQLbw
[09:22:01] <ghrust> 13rust/06auto 142f34cf8 15Patrick Walton: librustc: Remove `&const` and `*const` from the language....
[09:22:01] <ghrust> 13rust/06auto 148237add 15Patrick Walton: librustc: Add support for type parameters in the middle of paths....
[09:22:02] <ghrust> 13rust/06auto 143cca6e5 15Patrick Walton: librustc: Ensure that type parameters are in the right positions in paths....
[09:22:04] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[09:26:35] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[09:34:59] *** Joins: maik (maik___@moz-B0F3393.dip0.t-ipconnect.de)
[09:41:28] *** Quits: KindOne (KindOne@61104893.EA06E3F.34F73994.IP) (Ping timeout)
[09:45:26] *** Joins: KindOne (KindOne@E205CAB3.E114B4AE.EC6A1518.IP)
[09:45:46] <maik> bjz, ping
[09:49:14] <maik> bjz, has it landed yet? :)
[09:51:30] *** Joins: jaen (jaen@moz-57D09167.neoplus.adsl.tpnet.pl)
[09:55:53] *** Joins: fyolnish_ (fyolnish@moz-BE2BAE5B.miinet.jp)
[09:56:12] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[09:56:56] *** Quits: fyolnish (fyolnish@moz-BE2BAE5B.miinet.jp) (Ping timeout)
[09:57:33] *** Quits: fyolnish_ (fyolnish@moz-BE2BAE5B.miinet.jp) (Ping timeout)
[09:59:20] *** Joins: whidgle (Mibbit@moz-993E0FAA.v4.ngi.it)
[09:59:41] *** Quits: whidgle (Mibbit@moz-993E0FAA.v4.ngi.it) (Quit: http://www.mibbit.com ajax IRC Client)
[10:00:43] *** Quits: wilsonk-laptop (kvirc@moz-8E86F35A.cg.shawcable.net) (Connection reset by peer)
[10:01:19] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Quit: Leaving.)
[10:01:32] *** Quits: fzzzy (fzzzy@A5CBE5CF.A81CC6E.44FA8ED.IP) (Ping timeout)
[10:02:12] *** Quits: telotortium (rmi1@moz-90BFA359.dhcp.mdsn.wi.charter.com) (Ping timeout)
[10:02:23] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[10:02:38] *** Quits: ldlework (ldlework@6AEB83D1.B92A0FC.176AC772.IP) (Ping timeout)
[10:03:18] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Quit: Leaving.)
[10:03:39] *** Joins: wilsonk-laptop (kvirc@moz-8E86F35A.cg.shawcable.net)
[10:04:20] *** Joins: ldlework (ldlework@6AEB83D1.B92A0FC.176AC772.IP)
[10:05:11] *** Joins: telotortium (rmi1@moz-90BFA359.dhcp.mdsn.wi.charter.com)
[10:05:22] *** Joins: fzzzy (fzzzy@A5CBE5CF.A81CC6E.44FA8ED.IP)
[10:08:15] <bjz> maik: no
[10:08:30] <bjz> maikL I finised the struct-style loader though
[10:08:45] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[10:09:52] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[10:10:52] <maik> bjz, btw I have problems with your generator
[10:11:19] <maik> bjz, "task <unnamed> failed at 'Could not get a new parse result, the parser has already finished!" I am currently investigating 
[10:11:32] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Ping timeout)
[10:11:59] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[10:11:59] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 143227d9b to 14c099242: 02http://git.io/N3iJvQ
[10:11:59] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[10:12:02] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[10:12:02] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/WuNXng
[10:12:02] <ghrust> 13rust/06auto 14d1e4815 15Alex Crichton: Upgrade llvm to current HEAD...
[10:12:02] <ghrust> 13rust/06auto 149434410 15Alex Crichton: Fix LLVM compilation issues and use the new attrs...
[10:12:02] <ghrust> 13rust/06auto 14fac33ae 15bors: auto merge of #8328 : alexcrichton/rust/llvm-head, r=brson...
[10:12:04] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[10:12:14] <nmatsakis> pnkfelix: can you resend me the link
[10:12:19] <nmatsakis> pnkfelix: for the lint.rs stuff
[10:12:23] <maik> bjz, is there a guarantee that the message will be there? "self.port.try_recv().expect..." line 140 in sax.rs
[10:12:27] <pnkfelix> nmatsakis: there's a new PR up for it
[10:12:34] <bjz> maik: hm
[10:12:35] <nmatsakis> pnkfelix: oh, ok. still going through e-mail this morning.
[10:12:51] <bjz> maik: you have the gl.xml file right?
[10:13:00] <pnkfelix> nmatsakis: dbaupp said he'd look at it
[10:13:03] <maik> bjz, I tried it with all files
[10:13:14] <nmatsakis> pnkfelix: ah, I see it now
[10:13:33] <pnkfelix> nmatsakis: so unless you're raring to go over it, I figure you have other important work to attack
[10:13:35] <maik> bjz, they are in the same folder
[10:13:36] <dbaupp> (just looking at it now! :) )
[10:14:03] <dbaupp> pnkfelix: lint's use of visitors is so ugly :(
[10:14:16] <pnkfelix> nmatsakis: ^
[10:14:21] <maik> bjz, could it be possible that the message is still "traveling" when you do "self.port.try_recv().expect"?
[10:14:41] <pnkfelix> dbaupp: Yes.  It would be good to revisit the design of lint.rs
[10:14:47] <bjz> maik: possibly
[10:15:07] <dbaupp> pnkfelix: yeah (I understand that this pr isn't trying to do that.)
[10:16:08] <bjz> maik: it's weird because I don't get that error :/
[10:16:22] <dbaupp> pnkfelix: I don't quite understand why the default implementations of visit_{fn,item} don't call OVERRIDE_* rather than being empty?
[10:16:38] <bjz> maik: perf related?
[10:16:42] <dbaupp> pnkfelix: oh, wit
[10:16:45] <dbaupp> *wait
[10:17:00] <dbaupp> several different traits flying all over the place.
[10:17:23] <nmatsakis> pnkfelix: dbaupp: ok, but I'm happy to let dbaupp inspect. I looked briefly before. My main thought was "this looks sane but dear god there must be a better way to do it"
[10:17:34] <pnkfelix> dbaupp: I think I did try to put *overriding* default implementations of visit_item and visit_fn into SubitemStoppableVisitor, but that did not work, and thus I adopted this pattern instead.
[10:18:03] <dbaupp> nmatsakis++
[10:18:24] *** Quits: KindOne (KindOne@E205CAB3.E114B4AE.EC6A1518.IP) (Ping timeout)
[10:18:24] <maik> bjz, what is perf?
[10:18:36] <bjz> maik: performance
[10:18:39] <dbaupp> pnkfelix: the indentation is strange in quite a few spots, btw.
[10:18:59] <maik> bjz, dunno 
[10:19:02] <dbaupp> pnkfelix: e.g. https://github.com/mozilla/rust/pull/8638/files#L0R1381
[10:19:41] <pnkfelix> dbaupp: okay, please put comments on the commit and I'll revisit.  (Note that Some of the cases where the indentation is strange may be a cut-and-paste artifact of old code.)
[10:19:47] <maik> bjz, the problem is that you do .try_recv on a closed channel, at least on my machine
[10:20:01] <bjz> maik: yeah
[10:20:12] <bjz> maik: any idea how to fix that?
[10:20:27] <maik> bjz, I am reading though the source code
[10:20:37] <pnkfelix> dbaupp: e.g. in that particular case, if you scan down, you can see that it was cut-and-pasted â€¦ some times the diffs made this apparent, but obviously not in this case.
[10:20:39] <dbaupp> pnkfelix: yup; it's only that syntactic stuff; the body looks "fine", especially if a "rearchitecture lint" bug is filed.
[10:21:06] <maik> bjz, one sec :)
[10:21:17] <dbaupp> pnkfelix: ah, right. I see. Should I r+ and that stuff can be fixed later?
[10:21:20] <bjz> maik: registry.rs in gl-rs is... ugly :P
[10:21:49] <pnkfelix> dbaupp: yeah, that's my hope.  Fixing indentation properly everywhere is ilkely to pollute the diff and make the refactoring nature less clear. 
[10:22:29] <pnkfelix> dbaupp: (though of course I could make the indentation fixes a separate commitâ€¦ but my plan was to go through and do that across the board for all the visitors.)
[10:22:39] *** Joins: KindOne (KindOne@B82601D0.2171A688.34F73994.IP)
[10:22:41] <dbaupp> sounds good
[10:23:42] <pnkfelix> dbaupp: but wait, if you haven't r+'ed yet
[10:23:50] * dbaupp waits
[10:23:53] <pnkfelix> dbaupp: I can at least address the case you noted that was not a cut-and-paste
[10:23:55] *** Joins: Florob (Florob@moz-39532932.de)
[10:24:06] <pnkfelix> dbaupp: ("} wants a line break)
[10:24:18] <dbaupp> ok
[10:26:26] <pnkfelix> dbaupp: Okay, pushed update to same PR
[10:29:03] <dbaupp> pnkfelix: r+ (when's the "delete oldvisit" PR? :) )
[10:29:18] <pnkfelix> dbaupp: there's still one more client that needs to be fixed.
[10:29:51] <pnkfelix> dbaupp: but my attempts to apply my mechanical transformation exposes bugs during make check.
[10:29:56] <dbaupp> oh, really? which?
[10:30:46] <pnkfelix> writeback.rs, I think
[10:30:59] <pnkfelix> dbaupp: Actually, looking at the situation now, it seems like there is more than 1.
[10:31:06] *** Joins: maik_ (maik___@moz-31CCDD8A.dip0.t-ipconnect.de)
[10:31:10] *** Quits: cdidd (cdidd@moz-52759E87.broadband.corbina.ru) (Input/output error)
[10:31:27] <pnkfelix> dbaupp: More than 1 case left, that is.  I don't know whether I made a mistake somewhere in my PR'sâ€¦ I'll have to review.
[10:31:38] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[10:31:59] *** Quits: maik (maik___@moz-B0F3393.dip0.t-ipconnect.de) (Ping timeout)
[10:33:37] *** Joins: cdidd (cdidd@moz-C975955C.broadband.corbina.ru)
[10:33:58] <dbaupp> Ah, I see some in moves, typeck::check::{vtable, writeback} and creader
[10:34:09] <dbaupp> oh, and stack_check
[10:34:28] *** Joins: fyolnish (fyolnish@moz-393725D7.uqwimax.jp)
[10:35:38] <pnkfelix> dbaupp: so weird, i thought I had finished all of the cases, but I clearly left out creader.  I don't see any sign of a commit for it in any of my local clones.
[10:36:03] <dbaupp> ah :(
[10:36:08] <pnkfelix> dbaupp: (clearly left out others too, but I *remember* working on porting creader, sometime early on.  Maybe I put it aside.)
[10:36:43] <pnkfelix> dbaupp: well, okay, this just means there's a few more passes to port.  writeback.rs is the one I'm most worried about, because I didn't understand the failure I saw with it on make check.
[10:36:52] *** Quits: ab (alex@BC9D99CC.37C1012D.FE617B51.IP) (Ping timeout)
[10:37:48] *** Quits: fyolnish (fyolnish@moz-393725D7.uqwimax.jp) (Ping timeout)
[10:38:51] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Ping timeout)
[10:39:46] <dbaupp> pnkfelix: that's annoying
[10:40:03] <maik_> bjz, the chan goes out of scope when "xmlSAXUserParseMemory" has finished right?
[10:40:06] *** Quits: cdidd (cdidd@moz-C975955C.broadband.corbina.ru) (Input/output error)
[10:41:29] *** Joins: ab (alex@BC9D99CC.37C1012D.FE617B51.IP)
[10:42:38] *** Joins: sebcrozet (sebcrozet@moz-2517AE39.w80-13.abo.wanadoo.fr)
[10:42:39] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[10:42:41] *** Joins: cdidd (cdidd@moz-B69D8D91.broadband.corbina.ru)
[10:42:43] <maik_> how do I debug a rust application? with gdm?
[10:43:27] <maik_> ups :D
[10:44:45] * maik_ realized that it was gdb not gdm
[10:46:47] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Client exited)
[10:48:07] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[10:50:15] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[10:52:02] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[10:52:02] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14fac33ae to 14c099242: 02http://git.io/N3iJvQ
[10:52:02] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[10:52:03] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[10:52:03] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/l-BmTQ
[10:52:03] <ghrust> 13rust/06auto 14c709c0a 15Felix S. Klock II: Port lint.rs from oldvisit to <V:Visit> trait API.  Less mechanical port....
[10:52:03] <ghrust> 13rust/06auto 14213d89b 15Felix S. Klock II: remove trailing whitespace to placate make tidy.
[10:52:04] <ghrust> 13rust/06auto 149b82d50 15Felix S. Klock II: add line break post dbaupp review.
[10:52:06] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[10:53:13] <maik_> bjz, it's hard to tell, I need to have a look later today
[10:53:14] *** Joins: novabyte (Instantbir@moz-13747D88.mullvad.net)
[10:58:35] *** Quits: mark_edward (quassel@68BC8414.F49EBFF0.CC1A2609.IP) (Ping timeout)
[10:59:38] *** Joins: mark_edward (quassel@68BC8414.F49EBFF0.CC1A2609.IP)
[11:01:09] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[11:02:36] *** Quits: maik_ (maik___@moz-31CCDD8A.dip0.t-ipconnect.de) (Ping timeout)
[11:04:24] *** Quits: novabyte (Instantbir@moz-13747D88.mullvad.net) (Ping timeout)
[11:07:18] *** Quits: mark_edward (quassel@68BC8414.F49EBFF0.CC1A2609.IP) (Ping timeout)
[11:10:22] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[11:12:02] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Ping timeout)
[11:13:13] *** Joins: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com)
[11:15:07] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[11:32:03] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[11:33:34] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Connection reset by peer)
[11:33:56] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[11:34:08] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[11:34:23] *** Quits: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com) (Ping timeout)
[11:35:08] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[11:35:12] *** Joins: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net)
[11:37:53] *** Joins: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com)
[11:42:16] *** Joins: jfbk (textual@moz-EEA9CFB3.nyc.res.rr.com)
[11:42:52] *** Quits: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com) (Ping timeout)
[11:43:09] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[11:43:49] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[11:44:03] *** Joins: maik_ (maik___@moz-31CCDD8A.dip0.t-ipconnect.de)
[11:44:59] *** Joins: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com)
[11:52:35] <myname> what is the new syntax if you make an iterator with more than one variable?
[11:52:49] <myname> for x,y in Foo.iter()?
[11:52:56] <cmr> for (x, y)
[11:53:02] <cmr> it's a pattern
[11:55:24] <dbaupp> rusti: let v = ~[1,2,3] for (i,x) in count(0, 1).zip(v.iter()) { printfln!("%? %?", i, x); }
[11:55:24] -rusti- <anon>:5:26: 5:29 error: expected `;` but found `for`
[11:55:25] -rusti- <anon>:5          let v = ~[1,2,3] for (i,x) in count(0, 1).zip(v.iter()) { printfln!("%? %?", i, x); }
[11:55:25] -rusti-                                    ^~~
[11:55:25] -rusti- application terminated with error code 101
[11:55:29] <dbaupp> rusti: let v = ~[1,2,3]; for (i,x) in count(0, 1).zip(v.iter()) { printfln!("%? %?", i, x); }
[11:55:30] -rusti- <anon>:5:40: 5:45 error: unresolved name `count`. Did you mean `v`?
[11:55:30] -rusti- <anon>:5          let v = ~[1,2,3]; for (i,x) in count(0, 1).zip(v.iter()) { printfln!("%? %?", i, x); }
[11:55:30] -rusti-                                                  ^~~~~
[11:55:30] -rusti- error: aborting due to previous error
[11:55:32] -rusti- application terminated with error code 101
[11:55:43] *** Joins: threecreepio (jdp@moz-1A9F0A3C.cust.bredband2.com)
[11:56:06] <myname> i like these "did you mean v/a/whatever" messages
[11:56:32] <dbaupp> rusti: let v = ~[1,2,3]; for (i,x) in std::iterator::count(0, 1).zip(v.iter()) { printfln!("%? %?", i, x); }
[11:56:33] -rusti- 0 &1
[11:56:33] -rusti- 1 &2
[11:56:33] -rusti- 2 &3
[11:56:33] -rusti- ()
[11:56:59] <dbaupp> rusti: let v = ~[10, 20, 30]; for (i,x) in std::iterator::count(0, 1).zip(v.iter()) { printfln!("%? %?", i, x); }
[11:57:00] -rusti- 0 &10
[11:57:00] -rusti- 1 &20
[11:57:00] -rusti- 2 &30
[11:57:00] -rusti- ()
[11:59:25] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[12:00:35] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[12:02:19] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[12:04:24] *** Quits: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com) (Client exited)
[12:07:50] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[12:10:55] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[12:11:06] *** Joins: maxli (maxli@13F2CEC5.7672369.D8E68FF6.IP)
[12:12:36] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Ping timeout)
[12:13:49] <maik_> rusti: let v = ~[(1,2),(3,4)]; for (x,y) in v.iter() {printfln!(x+y);}
[12:13:50] -rusti- <anon>:5:37: 5:42 error: mismatched types: expected `&(<VI2>,<VI3>)` but found tuple (types differ)
[12:13:50] -rusti- <anon>:5          let v = ~[(1,2),(3,4)]; for (x,y) in v.iter() {printfln!(x+y);}
[12:13:50] -rusti-                                               ^~~~~
[12:13:50] -rusti- error: aborting due to previous error
[12:13:51] -rusti- application terminated with error code 101
[12:14:13] <myname> lol
[12:14:21] <maik_> rusti: let v: ~[(int,int)] = ~[(1,2),(3,4)]; for (x,y) in v.iter() {printfln!(x+y);}
[12:14:22] -rusti- <anon>:5:51: 5:56 error: mismatched types: expected `&(int,int)` but found tuple (types differ)
[12:14:22] -rusti- <anon>:5          let v: ~[(int,int)] = ~[(1,2),(3,4)]; for (x,y) in v.iter() {printfln!(x+y);}
[12:14:22] -rusti-                                                             ^~~~~
[12:14:22] -rusti- error: aborting due to previous error
[12:14:23] -rusti- application terminated with error code 101
[12:15:34] <myname> i don't think this should behave this way
[12:16:17] <cmr> rusti: let v: ~[(int,int)] = ~[(1,2),(3,4)]; for &(x,y) in v.iter() {printfln!(x+y);}
[12:16:18] -rusti- 3
[12:16:19] -rusti- 7
[12:16:19] -rusti- ()
[12:17:37] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[12:19:05] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[12:20:06] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[12:23:49] *** zz_kimundi is now known as kimundi
[12:28:41] *** Quits: sebcrozet (sebcrozet@moz-2517AE39.w80-13.abo.wanadoo.fr) (Ping timeout)
[12:28:46] *** Parts: z0w0 (zack@moz-7E6DC3A.lnse2.woo.bigpond.net.au) ()
[12:32:02] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[12:48:23] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[12:49:17] *** Quits: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net) (Ping timeout)
[12:54:00] *** Quits: maik_ (maik___@moz-31CCDD8A.dip0.t-ipconnect.de) (Ping timeout)
[12:54:34] *** Joins: sebcrozet (sebcrozet@moz-6DA639AF.w80-13.abo.wanadoo.fr)
[12:54:35] *** Joins: doomlord__ (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[13:00:07] *** Quits: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com) (Quit: bye bye)
[13:05:59] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[13:06:26] *** Joins: bytewise (bytewise@moz-4A801D04.unitymediagroup.de)
[13:08:10] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[13:09:53] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[13:10:04] *** Joins: sigma-pc (sigma@moz-C2B7BE7A.range86-151.btcentralplus.com)
[13:12:00] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[13:12:00] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/l-BmTQ
[13:12:00] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[13:14:23] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[13:14:27] *** Quits: Liothen (liothen@moz-80EF0CD7.spkn.qwest.net) (Quit: Textual IRC Client: www.textualapp.com)
[13:17:46] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Quit: Leaving.)
[13:21:57] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[13:21:57] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/0qhjPQ
[13:21:57] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[13:21:58] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[13:21:58] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/gS8rAQ
[13:21:58] <ghrust> 13rust/06auto 149bc3324 15Florian Zeitz: Add Unicode decomposition mappings to std::unicode
[13:21:58] <ghrust> 13rust/06auto 140cc772c 15Florian Zeitz: Add canonical combining class to std::unicode
[13:21:58] <ghrust> 13rust/06auto 14ce1ea30 15Florian Zeitz: Add support for performing NFD and NFKD on strings
[13:22:00] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[13:22:43] *** Quits: jfbk (textual@moz-EEA9CFB3.nyc.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[13:30:52] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[13:31:10] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[13:33:55] *** Joins: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl)
[13:34:47] *** AutomatedTester is now known as AutomatedTester|AFK
[13:35:06] *** Quits: sigma-pc (sigma@moz-C2B7BE7A.range86-151.btcentralplus.com) (Ping timeout)
[13:35:19] *** Quits: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl) (Client exited)
[13:35:21] *** AutomatedTester|AFK is now known as AutomatedTester
[13:35:23] *** Joins: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl)
[13:35:53] *** Joins: sigma-pc (sigma@moz-C2B7BE7A.range86-151.btcentralplus.com)
[13:37:10] *** Joins: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP)
[13:37:41] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[13:37:42] *** ChanServ sets mode: +o dherman
[13:38:06] *** Joins: boredomist (user@moz-63CF9F31.res-cmts.sesp.ptd.net)
[13:42:00] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[13:42:00] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 140c2c008 to 145e9dff9: 02http://git.io/N3iJvQ
[13:42:00] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[13:42:02] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[13:42:02] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/1PAsmw
[13:42:02] <ghrust> 13rust/06auto 140f9ab93 15Brian Anderson: std: Restore dynamic borrow tracking
[13:42:02] <ghrust> 13rust/06auto 147f26812 15bors: auto merge of #8463 : brson/rust/borrowck, r=nmatsakis,nikomatsakis...
[13:42:03] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[13:47:00] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[13:47:21] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[13:48:02] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[13:49:01] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[13:49:05] *** Joins: newbie (Mibbit@moz-814C464D.static.netvigator.com)
[13:50:31] *** Quits: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl) (Client exited)
[13:51:33] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[13:52:23] <newbie> Is there a couple of projects someone can point me to that are a good example of rust-0.7 code? I'm looking for something between the out of date 3-4 line example programs in tutorials and the thousands of lines in the compiler.
[13:53:27] <hoelzro> newbie: I have a program I wrote a few months ago for 0.6
[13:53:34] <hoelzro> I have a 0.7 port of it sitting around somewhere...
[13:54:43] *** Quits: KindOne (KindOne@B82601D0.2171A688.34F73994.IP) (Ping timeout)
[13:55:52] <Florob> ðŸ™€
[13:56:00] <hoelzro> I think it's my home machine =/
[13:56:24] <hoelzro> newbie: if you're willing to stick around, I'll paste it when I get home
[13:57:20] <newbie> Sadly I have to log off soon, Hong Kong timezone and need to go to bed.
[13:57:54] <newbie> Can you email to mleeming@hotmail.com ? Would greatly appreciate it.
[13:57:57] <darkf> newbie: any reason you're not using 0.8-pre?
[13:58:07] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Connection reset by peer)
[13:58:29] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[13:58:39] <newbie> I wanted something that's stable and won't change while I'm developing it.
[13:59:23] *** Joins: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP)
[13:59:24] <darkf> ah
[13:59:30] <bjz> newbie: you'll experience greater pain updating from 0.7 to 0.8 than incrementally updating as the compiler changes
[13:59:41] <bjz> at least that's my experience
[13:59:52] <newbie> Hmm, okay. Thanks for the advice.
[13:59:52] <darkf> I agree, a lot of stuff has changed already :)
[14:00:10] <bjz> and it's usually all good stuff that you want
[14:00:39] <newbie> I guess it's not really suitable for application development until 1.0, more just experimental projects ?
[14:00:46] <darkf> yeah
[14:00:50] <bjz> it can be a pain, but that's the price of working on the bleeding edge
[14:00:56] *** Joins: KindOne (KindOne@moz-62743C51.dynamic.ip.windstream.net)
[14:01:20] <bjz> yeah, I would say hobby or experimental projects with an unbounded timeframe
[14:01:25] <darkf> I use it for most of my personal projects just because I enjoy it, but it does have a lot of sharp edges, so I'd wait until 1.0 to put anything in production
[14:01:51] <bjz> for serious production, with deadlines and a need for stability, no
[14:01:52] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[14:01:53] <newbie> Yeah, have been waiting a while for some Haskell-style features in a programming language that doesn't need header files.
[14:01:58] *** Joins: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com)
[14:01:59] <newbie> Gotcha.
[14:02:29] <newbie> Anyone got any opinions on when that 1.0 release might happen? Seems like development has sped up a bit recently.
[14:02:50] <bjz> newbie: it's not as elegant as haskell an many respects, but it's still a pretty awesome language
[14:02:52] <darkf> it's always been quite fast
[14:03:11] <bjz> they've iterated quite a lot
[14:04:30] <bjz> adding and removing features, changing, simplifying. it's stabalised quite a bit in that respect though
[14:04:44] <newbie> Yeah, I'm more familiar with imperative programming than functional. Rust seems like it might be the set of features I'm looking for.
[14:05:05] <newbie> I noticed that a lot of libraries and functions got renamed and moved around between 0.6 and 0.7
[14:05:18] <darkf> they did again for 0.8 too!
[14:05:20] <darkf> :)
[14:05:23] <bjz> yeah, was basically core->std
[14:05:31] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[14:05:35] <newbie> Heh, okay.
[14:05:39] <bjz> also the numerics got an update
[14:06:04] <bjz> in this cycle we also have external iterators
[14:06:33] <bjz> so that's something you won't find in 0.7
[14:06:52] <newbie> How is library support at the moment? For example, if I want shared memory, or sockets, or a parser or whatever?
[14:07:09] <newbie> Or GUI libraries.
[14:07:11] <bjz> shared memory in what respect?
[14:07:20] <bjz> gui, no, not yet
[14:07:30] <newbie> Interprocess shared memory.
[14:07:38] <sp3d> GUI libraries are basically nonexistent... I'm trying to get some activity going on GTK bindings but there's much work left
[14:07:50] <newbie> Ok, gotcha.
[14:08:02] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[14:08:29] <bjz> newbie: if you want to get a head start in starting projects, now is the time.
[14:08:34] <bjz> but yeah
[14:08:46] *** Joins: q66_ (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[14:08:50] <bjz> that can take a bit of work if you just 'want to build an app'
[14:08:50] *** Quits: q66_ (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Client exited)
[14:09:11] <newbie> Thought it might.
[14:09:27] <bjz> more pure rust libs would be awesome
[14:09:41] <bjz> but thankfully the C fffi is excellent
[14:09:42] <darkf> i'm trying to work towards writing more libs as well
[14:09:46] <newbie> Yeah, of course. That's the dream.
[14:10:18] <bjz> bootstrapping the ecosystem is easier because of that
[14:10:18] <newbie> Pure rust code would tend to have a more rusty interface than just FFI bindings.
[14:10:34] <bjz> yeah, I make wrappers
[14:11:10] <bjz> luckily these can be compiled down and inlined by llvm so you don't get as much overhead
[14:11:18] <newbie> Some of the bindings to the C library have "free" calls that I imagine could be part of a destructor if done differently?
[14:11:25] <bjz> yep
[14:11:37] <bjz> that's the Drop trait
[14:11:38] *** Quits: Florob (Florob@moz-39532932.de) (Client exited)
[14:11:59] *** Joins: sk (sk@61A494B3.BA40E8A.AAC02D62.IP)
[14:12:18] <newbie> I guess the longer term goal would be to change the bindings to have the Drop trait, that sort of thing.
[14:12:25] <bjz> newbie: http://static.rust-lang.org/doc/tutorial-ffi.html
[14:12:33] <newbie> Thanks for that.
[14:12:43] <bjz> newbie: that's what I do with glfwrs
[14:12:49] <bjz> *glfw-rs
[14:13:49] <newbie> Ok, nice.
[14:14:10] <newbie> Thanks for your help!
[14:14:16] <bjz> newbie: things are a little more complex than they used to be because you have to put attribute on thingd that call foriegn functions
[14:15:05] <bjz> basically because rust's default stack works differently to C's (not sure if I explained that right)
[14:15:08] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[14:15:31] <newbie> Yeah, I can imagine that it could do some optimizations or something differently.
[14:15:40] <newbie> Anyway, got to go sadly.
[14:15:49] <newbie> They're closing this internet cafe.
[14:15:51] <bjz> ok, hope to see you again
[14:15:52] <bjz> :)
[14:15:56] *** Quits: jaen (jaen@moz-57D09167.neoplus.adsl.tpnet.pl) (Ping timeout)
[14:16:06] *** Quits: newbie (Mibbit@moz-814C464D.static.netvigator.com) (Quit: http://www.mibbit.com ajax IRC Client)
[14:16:48] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[14:17:09] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[14:18:49] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Ping timeout)
[14:18:53] <ChrisMorgan> Wow. 28 months ago, pcwalton said at http://pcwalton.blogspot.com/ of the absolutely new self-hosted compiler that "Currently, it takes 15 minutes on an Opteron for rustc to compile itself. That's far too slow to be practical. We should be at least 50Ã— faster."
[14:19:17] *** Quits: KindOne (KindOne@moz-62743C51.dynamic.ip.windstream.net) (Ping timeout)
[14:19:44] <darkf> now it's still slow! :)
[14:22:23] <bstrie> ChrisMorgan: dammit, I keep thinking that you're cmr
[14:22:38] <ChrisMorgan> what, ChrisMoRgan?
[14:22:48] <bstrie> I'm like... those initials are almost the same, they must be the same person :|
[14:22:51] <darkf> me too
[14:23:08] <ChrisMorgan> Well, they ain't. I'm much cooler than cmr ;-)
[14:23:12] <ChrisMorgan> (But don't tell him.)
[14:23:16] <bstrie> also hello folks, I'm back from dancing in a field with hippies for a week
[14:23:26] <darkf> was it fun?
[14:23:27] <bstrie> I see that niko's FFI stuff landed
[14:23:39] <bstrie> darkf: actually the most fun that I've had since college
[14:23:46] <darkf> great!
[14:24:07] <bstrie> fun enough that now I'm actually depressed to be back at work :P
[14:25:21] <ChrisMorgan> I tend to go by my full name (comparatively full, anyway) everywhere. Used to use chrism primarily, but now I tend to go for the full form: chrismorgan, ChrisMorgan, Chris Morgan, chris-morgan, etc.
[14:25:25] <bstrie> ah well. soon enough I will be jaded again to the mundanity of employment
[14:25:45] * ChrisMorgan is spending more time on rust-http than he should be, as far as his Uni work is concerned
[14:25:58] <ChrisMorgan> LOTS more time, frankly.
[14:26:06] <bstrie> wait, is cmr also starting school soon?
[14:26:16] *** Joins: KindTwo (KindOne@CAA28FF2.B2471F87.34F73994.IP)
[14:26:23] *** KindTwo is now known as KindOne
[14:26:27] <bstrie> maybe if you two aren't the same person, maybe I can treat you as the same person for all intents and purposes
[14:26:57] <bstrie> also excuse my rambling, dancing in a field with hippies doesn't leave much time for sleep.
[14:28:22] <ChrisMorgan> There's a differenceâ€”in Australia, "school" means primary and secondary exclusively; "Uni" or "University" means tertiary.
[14:29:00] <ChrisMorgan> If you asked someone what school they went to, they'd answer for their primary or secondary education.
[14:29:56] *** Quits: ab (alex@BC9D99CC.37C1012D.FE617B51.IP) (Ping timeout)
[14:30:05] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[14:30:34] <bjz> ChrisMorgan: sometimes I say 'schoolwork' when referring to uni work (I'm Aussie)
[14:31:34] <bstrie> if you said "uni" over here people would probably think you were referring to unicycles
[14:31:44] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[14:31:45] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Ping timeout)
[14:31:54] * bstrie opens gmail
[14:32:05] * bstrie "Rust Issues (359)"
[14:32:08] * bstrie closes gmail
[14:33:40] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[14:33:54] <bjz> bstrie: where is 'here'?
[14:33:55] *** Quits: lbergstrom (Adium@1C05CC21.246E5E69.4AE11518.IP) (Quit: Leaving.)
[14:34:11] <bstrie> bjz: stateside
[14:34:37] <bstrie> "uni" is one of those quintessential britishisms that we don't cotton to
[14:34:53] <bjz> :P
[14:35:17] <bjz> <3 britishisms :)
[14:36:30] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[14:36:50] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[14:37:15] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[14:37:26] <bjz> just found a great subreddit: http://www.reddit.com/r/softwaregore
[14:37:33] <bjz> :P
[14:38:55] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[14:39:42] *** Parts: sigma-pc (sigma@moz-C2B7BE7A.range86-151.btcentralplus.com) ()
[14:40:58] <sigma> the US use of "college" to mean university rather than the thing immediately preceding university always makes me do a double take
[14:42:32] <bstrie> I thought that, outside of the us, "college" was the physical place (i.e. campus) and "university" was the overall institution. am I wrong?
[14:43:12] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Ping timeout)
[14:44:40] *** Joins: maik_ (maik___@moz-31CCDD8A.dip0.t-ipconnect.de)
[14:45:19] <sigma> at least in the UK college usually refers to where people go to do A Levels, which is the optional qualifications you can do when you're 17/18
[14:45:55] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[14:46:17] <ChrisMorgan> In Australia, "college" could refer to certain Universities, certain secondary or combined primary and secondary schools, or sometimes other things. It's not a standardised term.
[14:46:23] <sigma> You can leave at 16 when you've done your GCSEs, and some schools also do A levels, so it's all a bit complicated
[14:46:41] <bstrie> I really have no idea what A-levels are. I never even knew they existed until they got parodied by harry potter
[14:48:56] <sigma> In the UK the majority go through: ages 5-11 = primary school, 12-16 = secondary school, 17/18 = sixth form, after that: university
[14:49:37] <bstrie> sixth form... I think that's mace windu's lightsaber style
[14:50:05] *** Quits: markluffel (markluffel@179F0C2A.5C4C7C24.8354FB35.IP) (Ping timeout)
[14:50:20] <sigma> heh, it's from the old syster of referring to year 8-12 as first-fifth form
[14:50:24] <sigma> system*
[14:50:51] <sigma> Thats still the case in a lot of schools, it always takes me a while to work out wtf "year 10" actually means
[14:51:07] <nmatsakis> bstrie: where were you now?
[14:52:01] <bstrie> nmatsakis: philadelphia folk festival, I was a volunteer on the crew that sets up the lighting and electricity for the whole event. which also means I get automatic access to anywhere I want, at any time. really fun
[14:52:07] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[14:52:11] <bstrie> and I wore my rust shirt!
[14:52:12] <nmatsakis> very cool
[14:52:16] <bstrie> sadly there were no rusties there to notice it
[14:52:25] <nmatsakis> even cooler
[14:52:37] <nmatsakis> bjz: btw, that PR for changing the type of extern fns should be up today
[14:52:43] <nmatsakis> bjz: had to fix a few wacko and scary bugs along the way
[14:52:49] <nmatsakis> as usual
[14:53:07] *** Joins: orshem (orshem@C5E06B1E.A5B6B765.E3D28531.IP)
[14:53:07] * nmatsakis so sick of extern fns
[14:53:24] <bjz> np
[14:53:35] <bjz> maik_: ^
[14:57:00] *** Joins: bent (chatzilla@moz-932324BF.hsd1.ca.comcast.net)
[14:59:06] *** Quits: maik_ (maik___@moz-31CCDD8A.dip0.t-ipconnect.de) (Ping timeout)
[15:00:42] *** Quits: tgummerer (tgummerer@B864C03E.A5F114BE.8465EFE9.IP) (Ping timeout)
[15:00:46] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Connection reset by peer)
[15:01:42] *** Joins: Sergio965 (sergiobz@moz-BB21156B.dynamic.csail.mit.edu)
[15:05:04] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Connection reset by peer)
[15:05:05] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[15:07:19] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Client exited)
[15:09:40] *** Joins: nano (nano@moz-74CAD1CA.superkabel.de)
[15:09:41] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[15:10:10] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[15:11:51] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[15:13:53] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[15:14:02] *** Joins: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com)
[15:32:40] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[15:33:21] <olsonjeffery> did homing io land, yet?
[15:34:05] <SimonSapin> Does rustc have any introspection feature? Like listing the things exported by a module
[15:34:21] <SimonSapin> at compile time
[15:35:03] <bjz> I think there are some macros that generate strings
[15:36:03] <bjz> rusti: file!()
[15:36:04] -rusti- "<anon>"
[15:36:16] *** Joins: dylukes (textual@moz-A7BEAA7D.wireless.pitt.edu)
[15:36:18] <dylukes> hey all.
[15:36:22] <bjz> rusti: module_path!()
[15:36:23] -rusti- ""
[15:36:27] <dylukes> Quick question, what's the proper structure for a library package?
[15:36:28] <bjz> :/
[15:36:47] <dylukes> I'm mildly confused with how rustpkg works. 
[15:36:47] <dylukes> "Build the given package ID if specified. With no package ID argument,
[15:36:48] <dylukes> build the package in the current directory. In that case, the current
[15:36:48] <dylukes> directory must be a direct child of an `src` directory in a workspace."
[15:36:50] <dylukes> Whoops...
[15:37:06] <dylukes> is the pkg-id the uuid or the short name? And *child* of src...?
[15:37:20] <pauls> bjz: but a macro cannot examine the environment (if you're responding to SimonSapin)
[15:37:41] <bjz> pauls: ahh
[15:37:48] <pauls> ...and it'd be hard to even write a syntax extension to do that, since expansion takes place before resolve.
[15:37:56] <bjz> yep
[15:38:07] <pauls> (and furthermore, *must* do so, since macros can expand to binding structures)
[15:38:33] <pauls> You could incrementally resolve and expand at the same time...
[15:38:35] <bjz> rusti: (line!(), col!(), file!())
[15:38:36] -rusti- (5, 19, "<anon>")
[15:39:02] <pauls> ...but that's seriously unknown territory. I've never heard of a macro system with that kind of power.
[15:39:20] <dylukes> It's like the human macropede.
[15:39:26] <bjz> HA
[15:39:30] <dylukes> *ba dum tsh*
[15:40:01] <dylukes> Or more like Macrobouros. The legendary meta-syntactic wyrm that resolves its own tail.
[15:41:04] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[15:41:08] *** Quits: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[15:41:24] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[15:41:34] <pauls> Actually, come to think of it, my current research is all about making resolution happen prior to expansion.
[15:43:01] *** Quits: orshem (orshem@C5E06B1E.A5B6B765.E3D28531.IP) (Quit: Leaving)
[15:43:05] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Ping timeout)
[15:44:20] <dylukes> But really
[15:44:22] <dylukes> Pacage structure?
[15:44:36] <dylukes> pauls: did you forget about your current research :p?
[15:44:55] *** Quits: dylukes (textual@moz-A7BEAA7D.wireless.pitt.edu) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[15:45:00] <pauls> dylukes: well, usually I don't think of it that way.
[15:45:42] <Ms2ger> There's research, and then there's actual languages? :)
[15:46:27] *** Quits: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP) (Ping timeout)
[15:46:35] <pauls> Usually, I think of it as "The symbols on this paper don't entitle me to make a nice little square symbol at the end!"
[15:46:51] <pauls> "I tried scribbling more symbols all over the page, but it didn't help!"
[15:47:21] *** Joins: saneyuki (Mibbit@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[15:47:43] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[15:48:06] <pauls> http://xkcd.com/722/
[15:48:26] *** Joins: jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net)
[15:48:51] <Sergio965> Is there any way to transmute into a vector of a fixed size where the size is determined at runtime?
[15:49:40] <SimonSapin> Sergio965: fixed size pretty much means that the size is known at compile time. What are you trying to do?
[15:49:56] <Sergio965> I'm writing an OS.
[15:50:12] <Sergio965> And I have a pointer to a table whose size is determined on boot
[15:50:40] <Sergio965> I'd like to transmute that table to a &[Struct, ..size] type.
[15:51:12] <SimonSapin> why?
[15:51:36] <Sergio965> Because then I can index into it safely.
[15:51:47] <Sergio965> And I can pass it around safely.
[15:51:50] *** Quits: sk (sk@61A494B3.BA40E8A.AAC02D62.IP) (Quit: Leaving)
[15:52:36] <SimonSapin> I donâ€™t see how that would help with safety
[15:52:41] *** Joins: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com)
[15:52:44] <Sergio965> ?
[15:53:12] <Sergio965> It would guarantee an out of bounds exception if I were to index out of bounds...
[15:53:43] <SimonSapin> do you mean bound checks at runtime? Thatâ€™s what slices do
[15:53:47] <SimonSapin> &[Struct]
[15:54:10] <Sergio965> Constant size arrays do, too.
[15:54:39] <SimonSapin> (although itâ€™s a task failure, rust doesnâ€™t have exceptions)
[15:55:00] *** Joins: Guest (textual@34641662.FB4DE631.66C78B76.IP)
[15:55:13] <olsonjeffery> rusti: let v = [0, 1, 2, 3, 4, 5, 6, 7]; v.slice(4, 8)
[15:55:16] -rusti- pastebinned 16 lines of output: http://ix.io/7qS
[15:55:22] <SimonSapin> I still donâ€™t see how this "dynamic fixed size vector" (whatever that means) helps you more than a normal vector
[15:55:32] *** Joins: maik_ (maik___@moz-31CCDD8A.dip0.t-ipconnect.de)
[15:55:50] <olsonjeffery> rusti: let v = [0, 1, 2, 3, 4, 5, 6, 7]; io::println(fmt!("%?",v.slice(4, 8)
[15:55:51] -rusti- <anon>:6:4: 6:5 error: incorrect close delimiter: `}`
[15:55:51] -rusti- <anon>:6     };
[15:55:51] -rusti-              ^
[15:55:51] -rusti- application terminated with error code 101
[15:55:56] <olsonjeffery> rusti: let v = [0, 1, 2, 3, 4, 5, 6, 7]; io::println(fmt!("%?",v.slice(4, 8)));
[15:55:58] -rusti- pastebinned 11 lines of output: http://ix.io/7qT
[15:56:30] <olsonjeffery> rusti: use io; let v = [0, 1, 2, 3, 4, 5, 6, 7]; io::println(fmt!("%?",v.slice(4, 8)));
[15:56:32] -rusti- pastebinned 8 lines of output: http://ix.io/7qU
[15:56:34] <olsonjeffery> ugh.
[15:57:01] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[15:57:22] <olsonjeffery> rusti: use io; let v = [0, 1, 2, 3, 4, 5, 6, 7]; v.slice(4,8).to_owned()
[15:57:24] *** Joins: dylukes (textual@moz-A7BEAA7D.wireless.pitt.edu)
[15:57:24] -rusti- pastebinned 8 lines of output: http://ix.io/7qV
[15:57:29] <Sergio965> SimonSapin: Where is the size information stored on a normal vector?
[15:57:54] <olsonjeffery> rusti: let v = [0, 1, 2, 3, 4, 5, 6, 7]; v.slice(4,8).to_owned()
[15:57:55] -rusti- ~[4, 5, 6, 7]
[15:58:00] <olsonjeffery> finally.
[15:58:11] <SimonSapin> A slice &[T] is represented in memory as (*T, uint), a pointer and a size
[15:59:17] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[15:59:18] *** Joins: tgummerer (tgummerer@51D3B54.FEF996EA.EA6FEF3D.IP)
[15:59:37] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[15:59:39] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[16:00:35] *** Joins: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net)
[16:01:12] <Sergio965> Not (uint, *T)?
[16:01:32] <SimonSapin> Iâ€™m not sure. Does it matter
[16:01:35] <SimonSapin> ?
[16:01:57] <Sergio965> Yes.
[16:02:07] <Sergio965> I need to transmute from that to the array.
[16:02:17] <SimonSapin> again, why?
[16:02:21] <Sergio965> ...
[16:02:27] <Sergio965> So I can get a safe representation of the structure.
[16:02:37] <dylukes> Sorry disconnected.
[16:03:09] <Luqman> Sergio965: in that case using trasmute should be fine
[16:03:13] <dylukes> So, how should I structure a library package?
[16:04:04] *** Joins: graydon (graydon@moz-F14EE0DB.cable.teksavvy.com)
[16:04:04] *** ChanServ sets mode: +qo graydon graydon
[16:04:09] <SimonSapin> Sergio965: I really donâ€™t think this is what you want, but see: https://github.com/mozilla/rust/blob/5e9dff90c9d2f6a1ac97a5b121505819f13d86d8/src/libstd/vec.rs#L1065
[16:04:11] <olsonjeffery> nmatsakis: so how does the fixed stack segment stuff work for externs?
[16:04:11] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[16:04:16] <olsonjeffery> hitting it in a bunch of fns in my branch
[16:04:17] *** Joins: Florob (Florob@moz-39532932.de)
[16:04:19] <graydon> https://etherpad.mozilla.org/Meeting-weekly-2013-08-20
[16:04:36] <olsonjeffery> where do i apply it? at the extern mod decl location?
[16:04:40] <olsonjeffery> or at the invocation site?
[16:04:53] <SimonSapin> Sergio965: *T is an unsafe pointer
[16:05:20] <Sergio965> SimonSapin: I do believe that's what I want. I don't see where it doesn't make sense.
[16:05:35] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[16:05:35] *** ChanServ sets mode: +o brson
[16:05:46] <SimonSapin> &[T] slices are already safe, indexing them does bound checking
[16:06:01] <Sergio965> I don't have a &T.
[16:06:04] <Sergio965> I have a *T.
[16:06:09] <Luqman> SimonSapin: I think what Sergio965 wants to do is sound. There's some unsafe pointer s/he has and a known size and wants a &[T]
[16:06:10] <Sergio965> That I want to convert to a &[T].
[16:06:19] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[16:06:19] *** ChanServ sets mode: +o tjc
[16:06:27] <Sergio965> Thanks, Luqman.
[16:06:40] <SimonSapin> oh, sorry, so you want the opposite of what I thought
[16:06:46] <Sergio965> Gotta head out to lunch. I'll read through the code in a bit. Thanks for the help, Luqman, SimonSapin.
[16:06:49] <Sergio965> SimonSapin: No worries.
[16:06:56] <Luqman> Sergio965: you'd do std::cast::transmute::<(*T, uint), &[T]>((ptr, sz))
[16:06:56] *** Quits: fabiand (fabiand@moz-121185FF.adsl.alicedsl.de) (Quit: Verlassend)
[16:07:03] <SimonSapin> Sergio965: see vec::from_buf
[16:07:17] <olsonjeffery> nm, i see where it goes..
[16:07:25] *** Joins: glennsl (textual@moz-5D7B804F.getinternet.no)
[16:08:13] <SimonSapin> Sergio965: the size in a slice is counted in bytes, not number of elements
[16:08:42] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[16:09:18] *** Joins: tedh_ (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[16:09:22] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Ping timeout)
[16:10:29] *** Joins: lmandel (lmandel@moz-BBE3ABD.mv.mozilla.com)
[16:12:05] *** Joins: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com)
[16:12:05] *** ChanServ sets mode: +o pcwalton
[16:13:14] <dcrewi> new to rust here. how bad an idea is it to configure with --enable-local-rust ?
[16:13:49] *** Joins: mihneadb (mihneadb@moz-BE33DA21.fw1.sfo1.mozilla.net)
[16:14:18] *** Joins: reyre (reyre@moz-C5FDC8CD.airyork.yorku.ca)
[16:14:43] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[16:14:47] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[16:15:05] *** Quits: jhark (jhark@moz-B9920504.jhark.net) (Ping timeout)
[16:15:16] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[16:15:29] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[16:16:07] <bstrie> dcrewi: no idea what that even does!
[16:16:19] <bstrie> dcrewi: the default configuration should suffice for most things, I think...
[16:16:32] <bstrie> can't even think of a single config option that I've used before
[16:17:23] *** Quits: bent (chatzilla@moz-932324BF.hsd1.ca.comcast.net) (Quit: ChatZilla 0.9.90.1-rdmsoft [XULRunner 22.0/20130619132145])
[16:17:55] <SimonSapin> I use --enable-ccache
[16:18:12] <dcrewi> bstrie: it uses an already-installed version of rust for the stage0 (or maybe stage1?) compile, rather than downloading a snapshot from somewhere over the internet
[16:18:14] <bstrie> I guess I don't really recompile llvm enough to make ccache worth it
[16:18:37] <bstrie> I feel like llvm would use like a million gigs of ccache anyway
[16:19:01] <SimonSapin> I do when servoâ€™s build system messes up
[16:19:08] <bstrie> fair
[16:19:15] <bstrie> I've never tried building servo :)
[16:20:18] <bstrie> dcrewi: interesting, I wonder if that ever actually worked
[16:20:27] <kmc> SimonSapin: me too :/
[16:20:53] *** Quits: threecreepio (jdp@moz-1A9F0A3C.cust.bredband2.com) (Quit: threecreepio)
[16:21:10] <SimonSapin> just today: git pull, make, ICE. Nuke the build directory and start over, successful build
[16:21:12] *** Joins: huseby (huseby@moz-4E8C421A.husebyhome.com)
[16:21:52] *** Joins: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl)
[16:23:40] *** Quits: huseby (huseby@moz-4E8C421A.husebyhome.com) (Connection reset by peer)
[16:25:24] <cmr> bstrie: if it makes your life easier, you can pretend we're the same person
[16:26:01] *** Joins: huseby (huseby@moz-4E8C421A.husebyhome.com)
[16:27:29] *** Quits: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP) (Quit: buildmaster reconfigured: bot disconnecting)
[16:27:30] *** Joins: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP)
[16:28:08] <bstrie> cmr: well I am always looking to make my life easier, so I think I'll take you up on that offer
[16:28:23] *** Quits: maik_ (maik___@moz-31CCDD8A.dip0.t-ipconnect.de) (Ping timeout)
[16:29:45] *** Joins: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com)
[16:30:28] *** Quits: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl) (Client exited)
[16:32:03] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[16:32:03] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/1PAsmw
[16:32:03] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[16:35:06] *** AutomatedTester is now known as AutomatedTester|AFK
[16:36:51] *** Quits: joone (joone@E10A1781.2160464A.A34EC3BB.IP) (Client exited)
[16:39:50] *** Joins: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net)
[16:42:01] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[16:42:01] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/2sRNqA
[16:42:01] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[16:42:03] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[16:42:03] <ghrust> 01[13rust01] 15bors pushed 7 new commits to 06auto: 02http://git.io/vqG8nA
[16:42:03] <ghrust> 13rust/06auto 14066ca17 15toddaaro: an attempt at a singleton pausible idle callback for each scheduler. suffers from nondeterministic deadlock and also pending scheduler messages on scheduler shutdown.
[16:42:03] <ghrust> 13rust/06auto 14bd382ee 15Brian Anderson: std::rt: Touch up idle logic
[16:42:04] <ghrust> 13rust/06auto 1488d8baa 15Brian Anderson: std::rt: Fix a race in UvRemoteCallback's dtor that misses callbacks...
[16:42:06] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[16:42:07] *** Joins: vosen (vosen@moz-266BA656.icpnet.pl)
[16:44:13] <toddaaro> yay, no more idle calback allocation spam in master
[16:45:04] <brson> toddaaro: \o/
[16:45:05] *** Joins: azakai (alon@moz-BBE3ABD.mv.mozilla.com)
[16:45:22] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[16:48:32] *** Quits: dylukes (textual@moz-A7BEAA7D.wireless.pitt.edu) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[16:49:16] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[16:55:56] *** Joins: dylukes (textual@moz-A7BEAA7D.wireless.pitt.edu)
[16:57:44] *** Quits: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com) (Quit: ecr)
[16:58:18] <hoelzro> can anyone provide me some insight into this error? https://gist.github.com/hoelzro/6284158
[16:58:30] <hoelzro> I'm porting a program I wrote on 0.6 to 0.7
[16:58:52] <hoelzro> and I'm getting this odd error, but I don't quite understand it...
[16:58:58] *** Joins: joone (joone@moz-6D49DCEA.jf.intel.com)
[16:59:14] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[16:59:48] <brson> graydon: Can I work on the decompression perf?
[17:00:04] <erickt> hoelzro: first off, I suggest you work against the master branch instead of 0.7
[17:00:05] *** Quits: squiddy_ (squiddy@moz-98BAD2FA.adsl.alicedsl.de) (Input/output error)
[17:00:05] <brson> I'll also work on the process spawning
[17:00:12] <hoelzro> I'm guessing it's because I'm calling it from a do block?
[17:00:26] <toddaaro> how is alexcrighton's libuv-based spawn going?
[17:00:27] <erickt> hoelzro: there's been a lot of backwards incompatible changes since we cut 0.7
[17:00:30] <acrichto> brson: would process spawning help from uv bindings?
[17:00:31] <toddaaro> did he put up a PR?
[17:00:41] <acrichto> toddaaro: not yet, let me get the link real quick
[17:00:42] *** Quits: reyre (reyre@moz-C5FDC8CD.airyork.yorku.ca) (Client exited)
[17:00:48] <graydon> brson: absolutely. there are two separate angles to it that I'll point out in the email I'm writing up.
[17:00:57] <hoelzro> erickt: you mean from 0.7 to tip?
[17:01:02] <hoelzro> or 0.6 to 0.7?
[17:01:02] <acrichto> toddaaro: https://github.com/alexcrichton/rust/tree/issue-6436-run-non-blocking
[17:01:05] <erickt> hoelzro: yeah
[17:01:07] <hoelzro> (probably both...)
[17:01:12] <erickt> even more from 0.6 :)
[17:01:13] <brson> acrichto: yes, that's the solution. forgot that you were working on it
[17:01:20] <acrichto> still can't get past 'make check', wanted to run on valgrind
[17:01:22] <brson> acrichto: we also need libuv-based stdin/out/err bindings
[17:01:34] <brson> acrichto: we're working around blocking issues by spawning three threads per subprocess
[17:01:41] <acrichto> brson: olsonjeffery was working on those file bindings, right?
[17:01:45] <brson> acrichto: yes
[17:01:51] <erickt> hoelzro: for example, str::as_c_str was replaced with a method `.with_c_str`
[17:01:56] <acrichto> I can see where three threads per subprocess is bad...
[17:02:11] <hoelzro> ah, I see
[17:02:13] <toddaaro> how hard would the libuv bindings for those be?
[17:02:25] <hoelzro> well, someone was here earlier asking for an example program for use with 0.7
[17:02:32] <hoelzro> so I'm trying to bring it up to speed
[17:02:39] <toddaaro> with ecr's PR up I think they should be fairly straightforward?
[17:02:40] <hoelzro> I can try it with rust-git afterwards
[17:03:03] *** Quits: maxli (maxli@13F2CEC5.7672369.D8E68FF6.IP) (Quit: Leaving.)
[17:03:08] *** Quits: dylukes (textual@moz-A7BEAA7D.wireless.pitt.edu) (Quit: Textual IRC Client: www.textualapp.com)
[17:03:17] <erickt> hoelzro: second, the reason why you are hitting that error is because of the closure getting passed to str::as_c_str. Lemme try to port it to HEAD...
[17:04:16] <hoelzro> that raises a separate question: why is Rust in Git when other Mozilla projects are in Hg?
[17:04:43] <erickt> hoelzro: graydon started the project in git
[17:04:50] *** Joins: bent (chatzilla@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:04:51] <brson> hoelzro: because github
[17:04:58] <erickt> hoelzro: plus, git is way better than hg :)
[17:05:11] <Ms2ger> Boo
[17:05:16] <hoelzro> I'm more familiar with Git myself, but I was curious =)
[17:05:30] <Ms2ger> Though of course, Mozilla uses at least five VCSs
[17:05:34] *** Joins: maxli (maxli@13F2CEC5.7672369.D8E68FF6.IP)
[17:06:56] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[17:07:20] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[17:07:37] <erickt> hoelzro: see https://gist.github.com/erickt/6284265
[17:07:57] *** Quits: a__ (a__@moz-250D9B4.nycmny.fios.verizon.net) (Client exited)
[17:08:05] <hoelzro> ah ha
[17:08:12] <hoelzro> so, that works
[17:08:18] <hoelzro> but why did my code error?
[17:08:23] *** Quits: StarLight (StarLight@moz-637E2651.dynamic.avangarddsl.ru) (Ping timeout)
[17:08:27] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[17:08:29] <hoelzro> I can tell it's angry about trying to capture cb
[17:08:41] <erickt> hoelzro: it's all because rust can't tell if a closure will get called multiple times or not
[17:08:54] <joelteon> can't we do something about that
[17:09:01] *** Joins: a__ (a__@moz-250D9B4.nycmny.fios.verizon.net)
[17:09:01] <joelteon> the Cell thing feels like a hack
[17:09:01] <acrichto> brson: I'm getting fairly close to libuv bindings to processes actually working, do you want me to put a pull request up to get initial review to make sure I'm not doing anything horribly wrong?
[17:09:13] <strcat> joelteon: it is a hack
[17:09:16] <joelteon> right
[17:09:29] <erickt> does anyone know if once functions got implemented?
[17:09:37] <strcat> erickt: yes but it's behind a flag
[17:09:48] <strcat> and closures really suck right now, so they need to be fixed overall
[17:10:15] *** Quits: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[17:10:43] <strcat> it's much saner to use traits if you can
[17:11:33] <erickt> strcat: I don't think hoelzro can really avoid closures at the moment
[17:12:05] <hoelzro> erickt: that works, thanks!
[17:12:08] <hoelzro> now to work on HEAD =)
[17:12:34] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[17:12:45] *** Joins: StarLight (StarLight@7A2D5F01.505A3D91.F1EF1E39.IP)
[17:13:05] <erickt> hoelzro: btw, it's super dangerous to use my technique on 0.7 and below because the raw_str may be pointing at temporary memory
[17:13:24] <hoelzro> ah, *that's* why I didn't do that =)
[17:13:25] *** Joins: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:13:35] <brson> acrichto: yes, please
[17:13:38] <erickt> hoelzro: it may also get super dangerous in the future as we might be adding back that temporary
[17:13:45] *** Joins: valenting (Thunderbir@662B8DC.3F30A7E5.FB866788.IP)
[17:13:59] * strcat hopes libuv knows how to use posix_spawn
[17:14:00] <erickt> hoelzro: for the method `.with_c_str`
[17:14:11] <strcat> it'd help a lot if spawning the linker used vfork like that does
[17:16:15] *** Quits: nielsle (nielsle@moz-5CE8ECCD.boa.fiberby.dk) (Quit: Ex-Chat)
[17:16:50] *** Joins: nawfel (Mibbit@CDAD3BA1.3801790B.DFAB1F33.IP)
[17:16:58] <erickt> hrm, emails like https://mail.mozilla.org/pipermail/rust-dev/2013-August/005281.html are starting to make me wonder if we should try to get yield iterators working before 1.0
[17:17:01] <ion> I suppose iâ€™ll start writing my first rust project. Iâ€™m able to develop it on x86(_64) for now, but iâ€™ll need to run it on armhf at some point. :-) It seems armhf support it so close i donâ€™t need to worry about that.
[17:17:19] <strcat> erickt: it's way too hard to do properly
[17:17:28] <erickt> strcat: creating iterators?
[17:17:32] <strcat> yes
[17:17:38] <strcat> you have to implement a whole different sub-language
[17:17:41] <erickt> strcat: totally agree
[17:17:54] <strcat> erickt: no I mean implementing yield ;p
[17:18:03] <strcat> creating recursive iterators is also too hard
[17:18:08] <erickt> strcat: oh, heh :)
[17:18:19] *** Quits: saneyuki (Mibbit@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Quit: http://www.mibbit.com ajax IRC Client)
[17:18:22] <strcat> it's really hard to figure out how to put the state on a stack
[17:18:26] <strcat> requires brain contortions
[17:18:35] <strcat> even though it ends up pretty simple code-wise
[17:18:53] <strcat> but `yield` is a *big* feature
[17:18:57] <strcat> bigger than closures
[17:19:12] <strcat> because you're going to need to teach the compiler a whole set of semantics for yield fns
[17:19:18] <strcat> new liveness/borrowck stuff
[17:19:32] <strcat> you could implement it as desugaring but the errors would be incomprehensible
[17:19:45] <strcat> and you'd need to desugar *after* typeck
[17:19:54] <strcat> so you'll be going around and modifying a bunch of tables
[17:20:51] <strcat> erickt: in a generator, 'x = y' is really sugar for state.x = state.y
[17:21:01] <erickt> strcat: yeah. I just worry about the onslaught of complaints about someone trying to store a `~[1,2,3].rev_iter().filter(|x| x > 2).map(|x| x.to_str())` in a structure. That type is horrendous
[17:21:02] <strcat> so that changes all the rules - you can't do a partial move from it
[17:21:14] <strcat> erickt: C++ and D both use external iterators and have no generators, people get by
[17:21:19] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[17:21:33] <acrichto> brson: https://github.com/mozilla/rust/pull/8645
[17:21:43] <strcat> erickt: also those types are essentially private details atm
[17:21:45] <strcat> they aren't stable
[17:21:57] <strcat> you want to store them in structure generically
[17:22:03] <erickt> strcat: but I think those languages take more advantage of inheritance then we do
[17:22:15] *** Quits: CarpNet (ac@moz-FD24B77.sohonet.co.uk) (Quit: Leaving)
[17:22:17] <strcat> erickt: C++ doesn't use inheritance in the stdlib
[17:22:29] <strcat> containers/iterators are just templates
[17:22:52] <strcat> there are no virtual fn calls beyond exceptions afaik
[17:23:06] <strcat> well and iostreams, but those are ancient
[17:23:21] <erickt> strcat: well c++ templates allow you to avoid writing the full type in a lot of cases
[17:23:27] <strcat> erickt: so do rust generics
[17:23:48] *** Quits: nawfel (Mibbit@CDAD3BA1.3801790B.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[17:23:48] <strcat> rusti: struct Foo<A> { iter: A } Foo { iter: range(10, 20).map(|x| x * 2) }
[17:23:49] -rusti- {iter: {iter: {state: 10, stop: 20, one: 1}, f: }}
[17:24:17] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[17:24:18] <strcat> rusti: struct Foo<A> { iter: A } Foo { iter: range(10, 20).map(|x| x * 2) } impl<T, A: Iterator<T>> Foo<A> { }
[17:24:19] -rusti- <anon>:5:78: 5:82 error: expected one of `; }` but found `impl`
[17:24:19] -rusti- <anon>:5          struct Foo<A> { iter: A } Foo { iter: range(10, 20).map(|x| x * 2) } impl<T, A: Iterator<T>> Foo<A> { }
[17:24:19] -rusti-                                                                                        ^~~~
[17:24:19] -rusti- application terminated with error code 101
[17:24:34] <strcat> rusti: struct Foo<A> { iter: A }  impl<T, A: Iterator<T>> Foo<A> { }
[17:24:35] -rusti- ()
[17:25:06] <strcat> I think it would be almost always wrong to write an iterator type except if you're implementing an adaptor in terms of other adaptors
[17:25:09] *** Joins: hjr3 (hradtke@374E545A.3A8E9B0C.F9D9C60E.IP)
[17:25:16] *** Quits: bent (chatzilla@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: ChatZilla 0.9.90.1-rdmsoft [XULRunner 22.0/20130619132145])
[17:25:19] <strcat> application/library code that's not implementing an adaptor wants to work for any iterator
[17:25:40] *** Joins: maik_ (maik___@moz-31CCDD8A.dip0.t-ipconnect.de)
[17:25:49] <strcat> you'd take <A: Clone + ToStr, T: Iterator<A>> or <T: Iterator<int>>
[17:25:50] <erickt> strcat: I know what you mean. My problem though was recently trying to convert extra::serialize into an iterator and it was quite complicated trying to keep track of all the type constraints and regions
[17:25:53] *** Joins: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP)
[17:26:08] *** Quits: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk) (Client exited)
[17:26:29] <erickt> especially when I tried to step through a recursive structure
[17:26:36] <strcat> yeah it's hard to do recursion
[17:26:49] <strcat> unless it's simple like a binary tree
[17:27:02] <strcat> but recursion you can pause isn't really simple
[17:28:36] <erickt> totally agree. I suppose I'll try a crack at not specifying the iterator types. That would at least clean up some things...
[17:28:56] *** Joins: bent (chatzilla@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:28:59] <brson> graydon: the valgrind bot still seems to be regressed. didn't your fix land?
[17:30:10] <graydon> brson: it landed and seems that it made it _worse_
[17:30:14] <strcat> erickt: https://github.com/thestinger/rust/commit/32728883df5fd41697dd8f0ff99de9e721d4facc#L1R587 it's the trick the adaptors themselves use
[17:30:48] <strcat> traits <3
[17:30:50] <graydon> brson: which I don't understand. maybe I fixed wrong. I changed it to avoid spawn(SingleThreaded) there when on valgrind. was that a mistake?
[17:31:10] <graydon> brson: in particular should it spawn(somethingelse) instead of just avoiding the spawn, as my fix did?
[17:31:50] *** Quits: maik_ (maik___@moz-31CCDD8A.dip0.t-ipconnect.de) (Ping timeout)
[17:32:05] *** Quits: valenting (Thunderbir@662B8DC.3F30A7E5.FB866788.IP) (Ping timeout)
[17:32:12] <brson> graydon: no, no other type of spawn will help there. thinking
[17:32:33] <brson> graydon: have a meeting just now. bbiab
[17:32:38] <strcat> yay, mesa made llvm a runtime dep
[17:32:57] * strcat doesn't need 2 copies of llvm for a driver he doesn't use anymore...
[17:33:48] <strcat> hrm
[17:33:51] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[17:33:56] <strcat> oh no they just consolidated it
[17:35:12] <erickt> strcat: regarding converting generators into iterators, I'm not sure if we'd have to do *that* many contortions to get them into the compiler. At the most basic level we transform each stack variable into a Cell-like value that may or may not be initialized
[17:35:33] <strcat> I don't think you'd want to do it that way
[17:35:36] <strcat> it would be too slow
[17:35:50] <strcat> if it's not as fast as writing it by hand it won't be used
[17:35:56] *** Joins: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca)
[17:36:15] <erickt> strcat: I don't think that's true
[17:36:21] <strcat> you can't have failure paths in iterators
[17:36:24] <strcat> or they don't optimize
[17:36:43] *** Quits: nano (nano@moz-74CAD1CA.superkabel.de) (Connection reset by peer)
[17:36:44] <strcat> LLVM can rarely prove it won't happen
[17:37:13] <erickt> strcat: that's why these stack variables would have to be Cell-like. They could be optimized away during trans
[17:37:21] <strcat> erickt: but Cell uses fail!()
[17:37:27] <strcat> it won't optimize out
[17:37:39] <erickt> Cell-*like* :)
[17:37:52] <strcat> I think all locals would be field-like
[17:37:52] <erickt> I don't think we could actually use Cell
[17:38:01] <strcat> moving from a local would be equivalent to a partial move
[17:38:05] <strcat> so you just can't allow it
[17:38:35] *** Quits: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[17:39:08] <strcat> I think that's the only difference semantically for what you can write, but it probably involves a lot of work to make the errors sane
[17:39:23] <strcat> you'll get weird move/borrow errors
[17:39:43] <erickt> strcat: once we're inside the compiler we can cheat with these generator stack variables. we wouldn't have partial moving because the inside of a generator is an opaque box
[17:40:07] <strcat> yeah but it still has to forbid the move
[17:40:09] *** flaper87 is now known as flaper87|afk
[17:40:21] <erickt> why?
[17:40:26] <strcat> because you can't move from your state
[17:40:33] <strcat> or it's invalid on the next iteration
[17:40:34] <ion> Is it safe to build new git versions without cleaning first?
[17:40:40] <cmr> ion: yes
[17:40:41] *** Joins: steven_is_false (user@C5B76363.1FF1EBF8.1ECA502.IP)
[17:40:44] <ion> Ok, thanks
[17:40:44] <strcat> erickt: state is preserved between iterations
[17:40:49] <cmr> Is anyone working on a snapshot?
[17:40:59] * strcat shrugs
[17:41:13] <strcat> cmr: no, do we need one?
[17:41:14] *** Quits: Ms2ger (Ms2ger@moz-BFA74791.ugent.be) (Connection reset by peer)
[17:41:22] *** Joins: Ms2ger (Ms2ger@moz-590E79FE.adsl-dyn.isp.belgacom.be)
[17:41:26] *** Joins: threecreepio (jdp@moz-71E164C9.cust.bredbandsbolaget.se)
[17:41:28] <cmr> strcat: there's some weirdness with the externfn macro it seems
[17:42:15] <cmr> plus I'd like to snapshot the rt optimizations
[17:42:23] <erickt> strcat: I would expect the standard "can't move stack variables twice checker" would work in this case
[17:42:56] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[17:42:58] <strcat> erickt: well if you don't count yield as a return
[17:43:05] <steven_is_false> Hello, I've been busy exploring Java's security model lately, and so have missed some of the news on the recent updates lately. Now my project doesn't build anymore (it doesn't can't link in a library I'm using.)
[17:44:08] *** Joins: Earnestly (earnest@B0BDF733.8FDE20A.5411983D.IP)
[17:44:41] *** Joins: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:44:51] <cmr> steven_is_false: details?
[17:44:58] <cmr> error message? what library? rustc hash?
[17:45:42] <steven_is_false> error: can't find crate for `sdl` (Note that I've modified my version of rust-sdl to compile succesfully.)
[17:46:07] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[17:46:16] <cmr> rustc -Z print-link-args have what you expect?
[17:46:20] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[17:46:28] <steven_is_false> cmr: Yep.
[17:46:46] <steven_is_false> But that gives me an idea that I'd like to try, give me a second.
[17:46:58] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:47:41] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: zzzzzzzzzz)
[17:47:59] <steven_is_false> cmr: Yep. The problem was that I was passing in some linker flags which don't work with Rust.
[17:48:19] <ecr> brson: tried replacing all uses of run_in_newsched_task with run_in_mt_newsched_task in the IO system. causes a deadlock if run with RUST_THREADS=0 and is usually fine with RUST_THREADS=1, but failed one time. going to try test by test now and figure out the problem.
[17:48:38] <steven_is_false> cmr: --link-args=-Wl,-O1,--sort-common,--as-needed,--hash-style,gnu,-z,combreloc,--gc-sections,-z,relro Now I have to figure out which ones caused the problem
[17:48:42] <erickt> strcat: the way I envision it is that generators would act like functions up until trans. yields would act like return in regards to moves, but won't trigger the unreachable error state
[17:49:02] <strcat> erickt: you can't yield by-move from a local though
[17:49:10] <strcat> if it acts as return
[17:49:29] <erickt> strcat: what do you mean?
[17:49:49] <strcat> yield can't act like return because the state is still used after
[17:50:23] <graydon> fyi I have turned off the -all and -vg builders. cycle time should be closer to 1h now. sending email concerning priorities about this.
[17:50:25] <strcat> if it was ignored by liveness/borrowck, it would work
[17:50:39] <strcat> like if it just pretended it wasn't there
[17:51:02] <strcat> yield foo -> ignore(foo)
[17:51:18] <cmr> graydon: r? https://github.com/mozilla/rust/pull/8646
[17:51:19] <erickt> strcat: yeah. I agree this would be illegal: `gen foo() -> Option<int> { let x = ~[1,2,3]; yield x; yield x }`
[17:51:36] <cmr> graydon: I have two concerns with it
[17:51:42] <cmr> First, I have no idea how https://github.com/cmr/rust/commit/c4cf58af6f29611d788e8f82ba78cfea490cf470#L1R161 compiles and runs
[17:52:01] <cmr> That line looks nonsensical. unwrap should be returning a &mut Metric, which has no inc method
[17:52:06] <cmr> but... it works
[17:52:23] <Ms2ger> Heh
[17:52:53] <cmr> Secondly, using an enum for metrics causes some bloatage due to matches. Not sure any way to fix it really, just a minor grievance
[17:53:01] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[17:53:07] <erickt> strcat: but this should be okay `gen foo() -> Option<&~[int]> { let x = ~[1,2,3]; yield &x; yield &x; }`
[17:53:10] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[17:53:24] <strcat> erickt: but not &mut
[17:53:46] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[17:53:48] <erickt> strcat: hrm, good point, I wonder how that would work
[17:53:56] <strcat> if you ignored yield in liveness/borrowck ;p
[17:54:03] <strcat> it doesn't end the control flow
[17:54:07] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[17:54:11] <strcat> (it does, but not in the virtual generator sense)
[17:54:39] <strcat> and by "ignore" I mean treating it as a by-value pass of the value
[17:54:49] <erickt> strcat: can I avoid the issue and say we can't return &mut types for now? :)
[17:55:28] <strcat> erickt: well there are more issues than that
[17:55:36] <strcat> it's just the one I thought of ;p
[17:55:47] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Ping timeout)
[17:55:59] <erickt> strcat: right. and my answer to all those hard problems is to not support them yet too :)
[17:56:47] <graydon> cmr: I suspect given the small number of concrete metrics types it might make sense to hide the enum inside the module and make the public interface to MetricsGroup be something like mg.get_counter("test.counter").inc()
[17:57:22] <cmr> graydon: yeah, seems fine
[17:57:25] <erickt> strcat: I got to admit I'm not too familiar with the innards of liveness/borrowck, so I'm sure I'm completely underestimating the impact of generators
[17:57:44] <graydon> cmr: that is, a single .get() method that creates a metric if it's not already existing, of a given type, and returns it. maybe clobbering or raising a signal if you try to reuse a metric name for a metric of a different type.
[17:58:17] *** Joins: guitsaru (guitsaru@10BE83CF.5DF68D0E.4C2245EF.IP)
[17:58:18] <graydon> cmr: and also, as I mentioned, a macro for declaring a metricsgroup that prefixes its path name with module_path()
[17:58:21] <graydon> module_path!() rather
[17:58:28] *** Quits: guitsaru (guitsaru@10BE83CF.5DF68D0E.4C2245EF.IP) (Quit: Leaving...)
[17:58:55] <cmr> right, this is just groundwork
[17:59:05] *** Quits: lmandel (lmandel@moz-BBE3ABD.mv.mozilla.com) (Quit: lmandel)
[17:59:33] <graydon> ideally produces a static one. so then the hashtable would be reified at runtime in TLS, but there'd be a per-module static that user can call to directly to hang new metrics off of
[17:59:34] <graydon> ok
[17:59:42] *** Joins: guitsaru (guitsaru@10BE83CF.5DF68D0E.4C2245EF.IP)
[17:59:42] *** Quits: guitsaru (guitsaru@10BE83CF.5DF68D0E.4C2245EF.IP) (Quit: guitsaru)
[17:59:47] <graydon> moving in the right direction though. nice first cut!
[17:59:49] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[17:59:54] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[18:00:02] *** Joins: robarnold (rob@BD56354E.DB510C09.6E370BFC.IP)
[18:00:02] *** Joins: lmandel (lmandel@moz-BBE3ABD.mv.mozilla.com)
[18:01:58] *** Joins: dylukes (textual@moz-2016988D.wireless.pitt.edu)
[18:02:02] <dylukes> Okay so...
[18:02:14] <dylukes> If I want to have a struct with a pointer to a CharIterator in it, is this proper lifetime wise?
[18:02:29] <dylukes> rusti: struct Foo<'self> { foo: &'self CharIterator<'self> }
[18:02:31] *** Joins: lizzard (ehenry@C0559334.C30B3942.8DDCAE07.IP)
[18:02:32] -rusti- <anon>:5:41: 5:60 error: use of undeclared type name `CharIterator`
[18:02:32] -rusti- <anon>:5          struct Foo<'self> { foo: &'self CharIterator<'self> }
[18:02:32] -rusti-                                                   ^~~~~~~~~~~~~~~~~~~
[18:02:32] -rusti- error: aborting due to previous error
[18:02:32] -rusti- application terminated with error code 101
[18:02:42] <strcat> dylukes: why not just put the CharIterator in it by-value?
[18:02:42] <dylukes> rusti: use std::str::{CharIterator};; struct Foo<'self> { foo: &'self CharIterator<'self> }
[18:02:44] -rusti- ()
[18:02:48] <strcat> you won't be able to use it that way
[18:03:00] <strcat> you have to mutate the iterator to iterate it
[18:03:19] <dylukes> okay so what would the proper typing be for an iterator in the structure that's to be used as a state structure?
[18:03:48] <strcat> struct Foo<'self> { foo: CharIterator<'self> } or just struct Foo<T> { iter: T }
[18:04:11] <dylukes> then type it in?
[18:04:20] <strcat> hm?
[18:04:20] <dylukes> The generalization isn't really warranted here.
[18:04:45] <dylukes> I'm mildly confused by lifetimes occupying the same slot as traits?...
[18:04:53] <dylukes> but sometimes not and being on pointers?...
[18:05:00] *** Quits: mihneadb (mihneadb@moz-BE33DA21.fw1.sfo1.mozilla.net) (Input/output error)
[18:05:10] <strcat> a type can have a lifetime parameter
[18:05:17] <cmr> It's lifetime parameterization, just like type parameters.
[18:05:21] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[18:05:23] <strcat> <> is for lifetime/type parameters
[18:05:26] *** Joins: fiirhok (fiirhok@EEC1213C.4468D718.41AEFB3C.IP)
[18:05:33] <strcat> not traits, although a type parameter can have a trait bound
[18:05:39] <dylukes> Okay.
[18:05:41] <dylukes> So second question
[18:05:57] <dylukes> say I want to have a struct with a field that is a pointer to something with two trait bounds.
[18:06:06] <dylukes> how would I do this?
[18:06:24] <dylukes> &'self FooTrait works for one I believe.
[18:06:30] <cmr> What kind of pointer?
[18:06:36] <cmr> Borrowed pointer?
[18:06:47] <steven_is_false> How can I make gcc use a different linker?
[18:07:02] <strcat> which linker?
[18:07:20] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[18:07:21] <dylukes> Well the context is this is a state structure for a recursive descent parser.
[18:07:26] *** Joins: mib_464cyu (Mibbit@moz-48B8832A.dynamic.qsc.de)
[18:07:46] <dylukes> Ostensibly it's an owned pointer.
[18:07:51] <strcat> I think it needs a linker plugin to use a linker, so usually that gives you the choice between bfd/gold
[18:08:15] <dylukes> Perhaps I'm mired in C-isms a bit?
[18:08:16] <strcat> -fuse-ld=gold
[18:08:25] <dylukes> I'm used to large struct items being pointers heh.
[18:08:26] <sully> hm
[18:08:34] <sully> does ::rt::backtrace not work anymore?
[18:08:43] <cmr> dylukes: just include it by value or use ~, yes.
[18:08:45] <cmr> sully: correct
[18:09:06] <dylukes> If it's included by value, I assume this shunts the responsibility of its allocation location up.
[18:09:11] *** Quits: huseby (huseby@moz-4E8C421A.husebyhome.com) (Quit: Leaving)
[18:09:23] <dylukes> So if the containing struct is heap allocated, so will be the Iterator (within it)
[18:09:42] <cmr> It will be part of that struct on the heap.
[18:09:45] *** Quits: lizzard (ehenry@C0559334.C30B3942.8DDCAE07.IP) (Ping timeout)
[18:09:48] <dylukes> mmk
[18:09:48] <cmr> They aren't separate allocations
[18:09:56] <dylukes> so what about pointers with multiple trait bounds?
[18:09:57] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[18:10:15] <cmr> &Foo<A, B, C> works fine
[18:10:38] <dylukes> No I mean, you can do @A right? using the trait as a type.
[18:10:42] *** Joins: mihneadb (mihneadb@moz-BE33DA21.fw1.sfo1.mozilla.net)
[18:10:46] <cmr> Yes.
[18:10:48] <strcat> an iterator over a vector/string is already a reference
[18:10:48] <dylukes> But what if you want to say "a pointer to something that has traits A and B"
[18:10:51] <cmr> Trait objects
[18:10:56] *** Joins: fabiand (fabiand@moz-121185FF.adsl.alicedsl.de)
[18:10:58] <strcat> it iterates by mutating the reference to point to a different spot
[18:11:02] <cmr> Not possible at the moment, you need to construct a new trait that has those traits as parents.
[18:11:08] <strcat> so there's not much point in making it a double-ref
[18:11:08] <dylukes> mmk.
[18:11:17] <cmr> ...but trait object inheritance is still broken afaik
[18:11:38] <sully> ok, I am weirded out
[18:11:39] <strcat> iterators don't really work as trait objects
[18:11:40] <dylukes> So if the CharIterator is in there,
[18:11:42] <strcat> they use by-value self
[18:11:47] <sully> somebody reported a default method ICE to me yesterday
[18:11:48] <dylukes> I assume the containing struct needs to be instantiated mut?
[18:11:53] <dylukes> Otherwise it won't work?
[18:12:03] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[18:12:04] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/vqG8nA
[18:12:04] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[18:12:05] <strcat> dylukes: whether it's by-value or by-reference, yes
[18:12:14] <sully> and I am investigating and it is ICEing in trans and I am super confused because I have no understanding at all how it could ever make it past typechecking
[18:12:25] <strcat> although by-reference would really be a pain
[18:12:43] <strcat> unless you use &mut
[18:13:03] * strcat thinks if you used & you would have to clone it
[18:13:08] <dylukes> mmk
[18:13:14] <dylukes> It's a complex system to try to grok all at once ^^.
[18:13:21] <dylukes> Well, not complex, just requires reasoning.
[18:13:50] <Ms2ger> "Non-trivial"?
[18:13:54] <dylukes> heh
[18:14:06] <dylukes> Also hey sully, I'm back to UPitt now heh.
[18:14:41] *** Quits: sankha93_ (Instantbir@7061CD01.D6BD0D91.22D41759.IP) (Ping timeout)
[18:14:44] <sully> cool
[18:15:04] *** Joins: sankha93_ (Instantbir@7061CD01.D6BD0D91.22D41759.IP)
[18:15:53] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[18:15:55] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[18:15:55] <ghrust> 01[13rust01] 15cmr merged 06auto into 06snap-stage3: 02http://git.io/A2yFMg
[18:15:55] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[18:16:02] <cmr> uhh
[18:16:12] <strcat> because master == auto atm
[18:16:14] <strcat> it's fine
[18:16:15] <cmr> well, if that's what github thinks, I guess that's ok
[18:16:32] <strcat> cmr: it's what git thinks ;p
[18:16:44] <strcat> afaik it's just saying auto because 'a' comes before 'm'
[18:16:45] <cmr> So when I say 'master:snap-stage3', what does git see?
[18:16:52] <cmr> Just the hashes?
[18:17:00] <cmr> (ie, rev-parse on the names)
[18:17:12] <strcat> cmr: I think it translates the ref to the hash
[18:17:15] <strcat> asap
[18:20:05] <cmr> Alright, next on my list is seeing if rust works with a musl/libcxx/libcxxabi toolchain
[18:20:33] <strcat> cmr: it doesn't
[18:20:35] <strcat> ;D
[18:20:45] <cmr> Now to fix it!
[18:20:47] <strcat> the exception symbols in the runtime don't resolve
[18:20:49] <strcat> cmr: good luck :)
[18:20:51] <strcat> port it to libunwind
[18:21:14] <cmr> instead of using stdc++'s unwinding stuff?
[18:21:17] <strcat> yes
[18:21:26] <strcat> we hardcode the libsupc++ exception ABI
[18:21:32] <cmr> hm
[18:21:37] <cmr> that part of the codebase is probably scary
[18:21:47] <dylukes> How do I get a peekable iterator from a string?
[18:21:54] <strcat> peekable?
[18:21:59] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[18:21:59] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/ANEfUA
[18:21:59] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[18:22:00] *** Parts: steven_is_false (user@C5B76363.1FF1EBF8.1ECA502.IP) (ERC Version 5.3 (IRC client for Emacs))
[18:24:54] *** Quits: a__ (a__@moz-250D9B4.nycmny.fios.verizon.net) (Ping timeout)
[18:26:34] <dylukes> the docs are rather difficult to work with...
[18:26:38] <dylukes> I'll manage heh.
[18:26:59] <dylukes> Best way to learn is to just struggle through and figure things out.
[18:27:07] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[18:27:31] *** Joins: a__ (a__@moz-250D9B4.nycmny.fios.verizon.net)
[18:27:34] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[18:29:25] <sfackler> new docs are coming soon(ish?)
[18:29:31] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[18:30:31] <graydon> I wonder if I ought to rough out support for "mod N" testsuite execution
[18:31:06] <graydon> that is, change compiletest and such to run 1/N of the tests so we can split into N parallel builders
[18:31:24] <dylukes> gah
[18:31:34] <dylukes> I want to enforce that parameter should be Peekable AND an Iterator
[18:31:35] <dylukes> :\
[18:31:46] <cmr>  <T: Foo+Bar>
[18:31:52] <dylukes> +?
[18:32:00] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[18:32:00] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/ANEfUA
[18:32:00] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[18:32:04] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[18:32:04] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/sKx86A
[18:32:04] <ghrust> 13rust/06auto 14d1e4815 15Alex Crichton: Upgrade llvm to current HEAD...
[18:32:04] <ghrust> 13rust/06auto 147f91e77 15Alex Crichton: Fix LLVM compilation issues and use the new attrs...
[18:32:05] <ghrust> 13rust/06auto 14a8c3fe4 15bors: auto merge of #8328 : alexcrichton/rust/llvm-head, r=brson...
[18:32:07] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[18:32:11] <cmr> plus, takes the intersection of the traits
[18:32:23] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[18:32:24] <cmr> objects which implement both
[18:32:47] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[18:32:47] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[18:32:47] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[18:32:58] <dylukes> So how would I write the function?
[18:33:04] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:33:04] *** ChanServ sets mode: +o brson
[18:33:12] <cmr> fn foo<T: Foo+bar>(x: T) { ... }
[18:33:21] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[18:33:36] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[18:34:12] <dylukes> fn accept<T: Peekable<char>+Iterator<char>>(it: &T, c: char) -> bool
[18:34:12] <dylukes> :\
[18:34:29] <dylukes> Is that right?...
[18:35:33] <dylukes> ah wait gah
[18:35:38] <dylukes> it was inferring std::comm::Peekable
[18:35:39] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[18:35:41] <acrichto> dylukes: I think you'd want something along the lines of "fn accept<T: Iterator<char>>(it: &mut Peekable<char, t>)"
[18:35:50] <dylukes> Ah!
[18:36:23] <acrichto> dylukes: or you'd just take an iterator and call `peekable` on it
[18:36:36] <dylukes> I'd like the peek-state to persist between calls.
[18:36:59] *** Quits: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP) (Connection reset by peer)
[18:37:08] <dylukes> this seems to be right
[18:37:09] <dylukes> fn accept<T: Iterator<char>>(it: &mut Peekable<char, T>, c: char) -> bool
[18:37:32] *** Joins: bytbox (s@moz-2D36DB45.wireless.umd.edu)
[18:37:34] <acrichto> yeah that looks about right
[18:37:52] <dylukes> I feel like fn accept(it: &mut Peekable<char, char>, c: char) -> bool should work...
[18:38:01] <dylukes> ah wait no
[18:39:42] <sfackler> I think you want accept<I: Iterator<char>, P: Peekable<I, char>>(x: P) -> bool
[18:39:46] <sfackler> or something like that
[18:39:49] *** Joins: tjc (tjc@moz-A138B67E.lightspeed.sntcca.sbcglobal.net)
[18:39:49] *** ChanServ sets mode: +o tjc
[18:40:47] <dylukes> fn accept<T: Iterator<char>>(it: &mut Peekable<char, T>, c: char) -> bool works as is.
[18:40:52] <dylukes> But that seems nicer.
[18:40:57] <acrichto> sfackler: peekable isn't a trait, it's a struct
[18:41:03] <sfackler> oh
[18:41:06] *** Joins: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP)
[18:41:06] *** Quits: bytbox (s@moz-2D36DB45.wireless.umd.edu) (Quit: Lost terminal)
[18:41:13] <dylukes> https://gist.github.com/DylanLukes/6285468
[18:41:16] <acrichto> which kinda makes sense to do it generically
[18:41:16] <dylukes> well this works (seemingly)
[18:41:30] <sfackler> i was wondering why yours had a trait object, but if it isn't a trait, that explains a lot
[18:41:42] <dylukes> Now all I need is some sort of do-notation monad syntax :p.
[18:42:31] <dylukes> then I can string these together nicely and get RD parsers.
[18:42:43] <SimonSapin> It would be nice to have something like this: type Foo = typeof!(bar().peekable())
[18:42:54] *** Quits: Florob (Florob@moz-39532932.de) (Client exited)
[18:43:07] <cmr> macros run before typecheck
[18:43:14] <cmr> but I agree
[18:43:29] <cmr> it'd be a very handy language feature
[18:43:31] <dylukes> okay refresh that...
[18:43:33] <SimonSapin> cmr: even fmt!()?
[18:43:35] <dylukes> does it look kosher?
[18:43:38] <cmr> SimonSapin: yes
[18:43:54] <cmr> It emits code that depends on the types of the things you pass it
[18:44:07] <brson> ecr: I have no idea what RUST_THREADS=0 does!
[18:44:29] <strcat> graydon: we could get rid of libextra ;p
[18:44:37] <ecr> brson: I just meant w/o RUST_THREADS=1 
[18:44:40] <strcat> although that's probably not a big chunk of the time
[18:44:48] <graydon> no
[18:44:55] <graydon> it's pretty small and it contains critical bits
[18:45:07] <ecr> brson: it probably makes everything explode and then deletes the repo just for kicks.
[18:45:07] <cmr> like the test runner
[18:45:07] <strcat> we can move everything in libextra used by the compiler to libstd and compile it once at the end
[18:45:11] <strcat> like rustpkg, etc.
[18:45:19] <strcat> cmr: yeah, but that's a language feature
[18:45:29] <strcat> it doesn't *really* make sense for a language feature to be supported by libextra
[18:45:40] <strcat> brings in question what the divide is there for
[18:45:43] <cmr> I don't see it as a language feature at all.
[18:45:45] <dylukes> What about RUST_THREAD=-1
[18:45:50] <cmr> Sure it hangs off an attribute
[18:45:51] <dylukes> what am I supposed to do if I need negative thread count?
[18:45:59] <cmr> but those will eventually hopefully be pluggable
[18:46:15] <ecr> dylukes: that only works if you installed an anti-cpu
[18:46:21] <dylukes> you mean a nega-CPU.
[18:46:36] <dylukes> anti-CPU is for antithreads, which upon yielding to a thread (or vice versa) blow up your computer.
[18:46:43] <graydon> strcat: the divide is that a language standard often includes a standard-library API spec
[18:46:46] <dylukes> negathreads just cancel out and result in 0.
[18:46:53] <graydon> strcat: and we don't want to commit to the surface of libextra
[18:47:42] *** Quits: dylukes (textual@moz-2016988D.wireless.pitt.edu) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[18:48:02] *** Joins: josedonizetti (josedonize@DF22210B.35D9DDB.8EF76F75.IP)
[18:48:10] <strcat> graydon: we could put it in libstd/unstable though
[18:48:17] <strcat> if we use it ourselves
[18:48:28] <graydon> strcat: we could. that was a recent innovation.
[18:48:36] <strcat> if it's a public API, we're committing to documenting it, fixing bugs in it, testing it, etc.
[18:48:45] <strcat> if it's internal it only has to be correct for what we use it for
[18:49:09] <graydon> the other part is that libextra is intended to be (eventually) a curated collection of re-exported packages from the rustpkg ecosystem (eventually)
[18:49:37] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Client exited)
[18:50:37] <cmr> Is all unwinding done by rust_begin_unwind in rt/rust_builtin.cpp?
[18:50:50] <cmr> It just calls abort afaict :\
[18:50:50] <graydon> so that we can pull in a "platform" that's a little more QA'ed than the average github repo during each release, but not necessarily subject those libs to the same development scrutiny during their own evolution (just during the times we choose to upgrade them)
[18:50:54] <doomlord__> I haven't worked through an example on this, could a sort of multiple-dispatch emulate C++ style overloading ; you'd need to implement a trait for each parameter and sucessively dispatch to more specific functions (each with an associatted trait) for all but one parameter (the first i gues.. for c++ stylecalls)
[18:51:07] <strcat> graydon: well that's why I think it makes sense to only build it on the end
[18:51:11] <strcat> if it's in another repo we can't depend on it
[18:51:48] * strcat shrugs
[18:53:09] <doomlord__> like Foo::collide(Bar&) Foo::collide(Baz&) --->    trait Collide { fn collide<T>(&self)}   impl Collide for Foo {  fn collide(&self,other:&T){ other.collide_foo(self);}     trait CollideFoo {..}   impl CollideFoo for Bar{ ....}  impl CollideFoo for Baz { ...}
[18:53:32] <graydon> strcat: "on the end" meaning .. when we finish bootstrapping? maybe. we're not there yet, but we could move in that direction.
[18:53:50] <strcat> graydon: yeah I mean like what we do with rusti/rustpkg
[18:53:55] <strcat> they aren't built in the early stages
[18:54:06] <strcat> and you can change them without breaking anything in the compiler
[18:54:49] *** Joins: dylukes (textual@moz-2016988D.wireless.pitt.edu)
[18:55:09] <strcat> life would be easier if the majority of the libraries (http, xml, json) were in libextra and we didn't use them ourselves ;p
[18:55:24] *** Quits: Earnestly (earnest@B0BDF733.8FDE20A.5411983D.IP) (Connection reset by peer)
[18:55:41] <strcat> although I understand that part of the divide is about what we want to commit to supporting well
[18:56:02] *** Joins: Earnestly (earnest@B0BDF733.8FDE20A.5411983D.IP)
[18:56:04] <Ms2ger> Why libextra? Throw them all into their own library :)
[18:56:16] <cmr> libextra will be a conglomeration of crates
[18:56:22] <strcat> because we can't export template instantiations yet
[18:56:27] <strcat> so it would make massive bloat
[18:56:34] <strcat> s/template/generic/
[18:57:17] <strcat> and if you split it more you increase the total compilation time
[18:57:21] <josedonizetti> hey all, not sure if I should post this question here but I willing to learn more about rush compiler and help out if possible, any resource I can look into to start down this path?
[18:57:24] <graydon> also some stuff like serialize or test are actually requirements of the build, and are public enough that burying them in unstable:: seems a little weird to me, API-wise
[18:57:51] <strcat> graydon: we could tag API stability we metadata and show it in rustdoc
[18:57:55] <strcat> with metadata*
[18:58:40] <brson> graydon: I'll dig into the valgrind regression when I get back from lunch
[18:58:44] <josedonizetti> rust*, btw sorry for the typo
[18:59:10] <cmr> josedonizetti: http://cmr.github.io/blog/2013/06/23/how-i-got-started-with-rust/
[18:59:29] <josedonizetti> cmr: Thanks!
[18:59:31] <cmr> josedonizetti: https://github.com/mozilla/rust/wiki/Note-guide-for-new-contributors
[18:59:47] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[18:59:53] <graydon> strcat: perhaps
[19:00:12] <brson> https://github.com/mozilla/rust/wiki/Meeting-weekly-2013-08-20
[19:00:55] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[19:02:06] *** Quits: fabiand (fabiand@moz-121185FF.adsl.alicedsl.de) (Quit: Verlassend)
[19:02:06] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[19:04:06] *** Joins: Diamond (dick@moz-C01E1CD1.ks.ks.cox.net)
[19:04:20] *** Quits: mihneadb (mihneadb@moz-BE33DA21.fw1.sfo1.mozilla.net) (Ping timeout)
[19:04:33] <dylukes> "trait bounds are not allowed in structure definitions"
[19:04:34] <dylukes> curses
[19:04:53] <cmr> dylukes: just use T and bound the implementation
[19:04:55] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[19:05:03] <dylukes> explain?
[19:05:08] <dylukes> I'm trying to abstract the ugly type out heh.
[19:05:17] <cmr> http://www.haskell.org/haskellwiki/Data_declaration_with_constraint
[19:05:22] <dylukes> first thought
[19:05:22] <dylukes> struct State<T: Iterator<char>> { it: Peekable<char, T> }
[19:05:27] <cmr> can't do that
[19:05:39] <cmr> struct State<T> { it: Peekable<char, T> }, I think
[19:05:39] <kmc> the Haskell one is near useless
[19:05:48] <cmr> and then impl State<T: Iterator<char>> { ... }
[19:06:06] <dylukes> what does in ...?
[19:06:10] <dylukes> impl for a struct?...
[19:06:11] <dylukes> confuse.
[19:06:12] <cmr> methods
[19:06:18] <dylukes> there are none, it's a struct
[19:06:23] <cmr> inherent methods, associated with the struct, not a trait
[19:06:26] <cmr> Yes, structs have methods too
[19:06:38] <dylukes> this one doesn't :\
[19:06:43] <dylukes> at least none I've defined.
[19:06:49] <dylukes> Okay basically I have
[19:06:49] <dylukes> pub fn accept<T: Iterator<char>>(it: &mut Peekable<char, T>, c: char) -> bool
[19:06:51] <dylukes> I'd like 
[19:06:52] <cmr> then bound the thing that uses the state
[19:06:59] <dylukes> pub fn accept(s: State, c: char) -> bool
[19:07:18] <cmr> can't ereally have that, sorry.
[19:07:20] <dylukes> There's no way to wrap the bounds in?
[19:08:37] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[19:09:29] <cmr> graydon: I think strcat and sully have added codegen tests
[19:09:37] <cmr> might have been acrichto?
[19:09:37] <strcat> I don't think I did
[19:09:39] <strcat> I added benchmarks
[19:09:40] <sully> I haven't
[19:09:42] <cmr> I thought someone did
[19:09:51] <acrichto> I didn't :(
[19:10:03] <cmr> Oh! It was doener
[19:10:06] <cmr> Doing trans work
[19:10:10] <strcat> when I start working on trans again I will add them
[19:10:21] <cmr> I refused to r+ until there was some sort of benchmark in place, codegen test was easiest
[19:10:45] * strcat has just been doing little iterative library changes lately
[19:11:25] <cmr> iterative iterator changes!
[19:11:27] <cmr> heh
[19:11:37] <graydon> cmr: yeah, I'm sorry, I was speaking really ... angrily in that meeting, I apologize for the tone
[19:11:59] <strcat> the iterator API is approaching the point where a lot is "finished"
[19:12:02] <strcat> except the ones using closures
[19:12:12] <graydon> everyone's doing good work. I just wanted to convey that I think the balance between features and perf-tightening is set wrong
[19:12:47] <strcat> imo the two biggest codegen problems are intrinsics and closures
[19:12:51] <cmr> I wouldn't even know where to begin to do non-library perf work, all I can do is read profiles
[19:13:13] *** Quits: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[19:13:23] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[19:13:29] *** Quits: mib_464cyu (Mibbit@moz-48B8832A.dynamic.qsc.de) (Quit: http://www.mibbit.com ajax IRC Client)
[19:13:58] <dylukes> Can I do an anaphoric closure?
[19:14:39] *** Joins: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net)
[19:15:12] <bjz> dylukes: do you have any example code?
[19:15:19] <dylukes> actually give me a moment
[19:15:37] *** Quits: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com) (Quit: bye bye)
[19:15:42] <bjz> ie. of the generics issue you were having before?
[19:16:30] *** Joins: tiffnya (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[19:16:42] *** Joins: bytbox (s@moz-2D36DB45.wireless.umd.edu)
[19:16:57] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[19:17:53] *** Joins: lkuper (lkuper@7B3806F8.D3FA0837.51B6877.IP)
[19:18:10] <dylukes> Well basically I'm wondering if there's a way to have a function taking a closure which is executed with additional functions added into the scope
[19:18:23] <josedonizetti> anyone from the rust team works from the Toronto officer?
[19:18:52] <tjc> josedonizetti: not at this point
[19:19:18] <ecr> dylukes: something like: 1) make a closure, 2) extend it's environment with more stuff, 3) run it?
[19:19:18] <dylukes> I wish I had pmods :\
[19:19:22] <dylukes> yep basically
[19:19:32] *** Joins: orshem (orshem@C5E06B1E.A5B6B765.E3D28531.IP)
[19:19:33] <dylukes> or accept a closure by argument, then 2, 3
[19:19:39] <sully> how we use our type tables is really unclear
[19:19:43] *** Quits: lkuper (lkuper@7B3806F8.D3FA0837.51B6877.IP) (Ping timeout)
[19:19:45] <ecr> hm
[19:19:50] <dylukes> if closures had lexical scoping of their parent scopes, it'd work
[19:19:57] *** Quits: tiffnya (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[19:20:05] <dylukes> or if you could get them to close over their execution contexts
[19:20:08] <dylukes> I may need a macro
[19:21:04] <cmr> dylukes: closure environments are static
[19:21:30] <cmr> you'd need something that isn't a closure that does environment lookup in some dynamic data structure
[19:21:48] <dylukes> I'm basically trying to replicate the effects of simple monads
[19:22:00] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[19:22:05] <dylukes> that is, of introducing stuff in scope lexically
[19:22:06] <toddaaro> does anyone know what 
[19:22:09] <toddaaro> bah
[19:22:28] <toddaaro> does anyone know what ""free(): corrupted unsorted chunks" actually means?
[19:22:33] <toddaaro> google just returns people who see the error
[19:22:48] <cmr> toddaaro: grep the glibc source for that string?
[19:22:49] *** Quits: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP) (Ping timeout)
[19:22:52] <strcat> well it means you went out-of-bounds and corrupted the heap somehow
[19:22:54] <cmr> I imagine it's heap corruption
[19:23:04] <strcat> or you have an allocator mismatch
[19:23:10] <strcat> or you're passing an invalid ptr to free
[19:23:12] <strcat> ;p
[19:23:30] <ecr> dylukes: yeah, you won't be able to extend a closure's environment
[19:23:32] <toddaaro> hm, how does one debug this sort of thing in rust?
[19:23:33] <dylukes> even dynamic partial application would work
[19:23:41] <dylukes> or pmods would solve this too
[19:23:46] <toddaaro> I'm expecting "issues" with what I'm doing, but that one seems odd
[19:23:47] <dylukes> I just don't want to use macros haha
[19:24:08] <ecr> dylukes: could you just make the closure take those functions as extra arguments?
[19:24:15] <dylukes> unsustaintable.
[19:24:19] <dylukes> could end up with a shitton of them
[19:24:22] <dylukes> Essentially I want, rather than foo(it, â€¦); bar(it, â€¦); â€¦ 
[19:24:33] <dylukes> with(it) { foo(â€¦); bar(â€¦); }
[19:24:51] <dylukes> with(it, || { â€¦ }) rather
[19:24:59] <ecr> hm
[19:25:03] <dylukes> basically just insert partially applied versions into the context of the closure.
[19:25:03] * strcat wants closures to be trait implementations eventually
[19:25:12] <dylukes> dynamically.
[19:25:28] <ecr> yeah, nothing like that exists right now
[19:25:41] <dylukes> The issue is I need a closure with a (dynamic) lexical scope.
[19:25:57] <dylukes> but that's not particularly easy impl wise
[19:26:05] <ecr> best thing I can think of is passing an argument struct to the closure (so you can extend it w/o changing the function sig)
[19:26:14] <dylukes> yeah, same thought here, but then I have
[19:26:20] <dylukes> x.foo(); x.bar(); ...
[19:26:25] <dylukes> which isn't much better.
[19:26:27] <ecr> and then you can dress it up with macros if you like
[19:26:35] <dylukes> I could just use macros as it is.
[19:26:46] <dylukes> insert the term as first argument of calls within 
[19:26:53] <dylukes> but they're not nice to users.
[19:27:09] <dylukes> I could just redo this in a dot-chain style.
[19:27:28] <dylukes> I was hoping I could use a functional style for implicit state butâ€¦ oh well.
[19:27:32] <ecr> someday when we get higher kinded types we'll get proper monads
[19:27:37] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[19:28:11] <dylukes> monads still aren't very useful if you can't have implicit stuff, like what I'm trying to do.
[19:28:45] *** Joins: maik_ (maik___@moz-31CCDD8A.dip0.t-ipconnect.de)
[19:28:57] <ecr> type wise, Rust with HKTs is basically Haskell w/ affine pointers
[19:29:09] <strcat> dylukes: closures aren't very nice right now, that's a known issue
[19:29:11] <ecr> so anything you could express in Haskell 98 would be expressible in Rust
[19:29:12] <dylukes> affine pointers?
[19:29:14] <strcat> there are various proposals for reforming them
[19:29:17] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[19:29:34] <ecr> yeah, ~ and &mut are affine types (like linear types, but you have the option of not using them).
[19:29:40] *** Quits: vadimcn (chatzilla@A2267643.76F9E272.DA40C4B3.IP) (Ping timeout)
[19:29:46] <dylukes> I'm not familiar with the term.
[19:29:47] <strcat> you currently can't have unboxed movable closures like C++, or accept generic closure types, or implement callable objects on your own
[19:30:21] <ecr> basically, a linear type is consumed when it's used and you don't have it anymore. it's like ownership
[19:30:29] <dylukes> ah okay right
[19:30:33] <dylukes> that I'm familiar with.
[19:31:14] <ecr> so we should be able to express what haskell can, but since we don't have partial application we need to write it out in full
[19:31:23] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[19:31:35] <ecr> which is a little annoying
[19:31:40] <ecr> but you can hide it with macros
[19:32:08] <dylukes> I'd like a syntax like let papped_fun = some_function(14, ?, 45, ? ?)
[19:32:14] <dylukes> should be doable with a macro actually.
[19:32:15] *** Joins: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP)
[19:32:29] <dylukes> pap!(some_fun, 14, ?, 45, ?, ?)) for example.
[19:32:33] <ecr> preaching to the choir buddy.
[19:32:37] <dylukes> That'd be a fun project.
[19:32:39] *** Quits: orshem (orshem@C5E06B1E.A5B6B765.E3D28531.IP) (Ping timeout)
[19:32:43] <dylukes> I'll try to write it, if possible.
[19:32:52] <kmc> ecr: there are still a lot of other differences between the Rust and Haskell type systems
[19:34:10] <dylukes> can someone link me to some actual example macors?
[19:34:10] <ecr> kmc: what's the difference aside from the addition of affine pointers / regions and the lack of HKTs?
[19:34:18] <dylukes> there aren't any in 4.1.1 Macro by Example heh
[19:34:45] <cmr> it's the name of what the macros are, not a section title
[19:35:09] <dylukes> ah
[19:35:17] <dylukes> where might I find some examples :p?
[19:35:30] <sfackler> there's a macro tutorial
[19:35:36] <dylukes> ah here we are
[19:35:39] <dylukes> found some in the stdlib
[19:35:45] <sfackler> http://static.rust-lang.org/doc/tutorial-macros.html
[19:35:52] <cmr> https://github.com/mozilla/rust/blob/master/src/libsyntax/ext/expand.rs#L728
[19:36:15] <acrichto> sfackler: whoat I have never seen that before, I wish I had seen that awhile ago
[19:36:25] *** Joins: vadimcn (chatzilla@A2267643.76F9E272.DA40C4B3.IP)
[19:36:32] *** Joins: lkuper (lkuper@7B3806F8.D3FA0837.51B6877.IP)
[19:36:50] <ecr> kmc: enum = data. struct = records. traits = typeclasses with the ability to do dynamic dispatch too. generics are the same.
[19:36:55] <sfackler> the only place it's linked is the bottom of the rust tutorial along with a couple of others
[19:37:49] *** Joins: Jesin (Jessin_@moz-5654D37.washdc.fios.verizon.net)
[19:38:28] *** Quits: lkuper (lkuper@7B3806F8.D3FA0837.51B6877.IP) (Ping timeout)
[19:38:32] <dylukes> hrm
[19:38:35] *** Joins: valenting (Thunderbir@8758046C.84D5EFD5.FB866788.IP)
[19:38:41] <dylukes> no way to macro match parentheses?...
[19:38:53] <pauls> dylukes: yes. They just have to match.
[19:39:06] <cmr> dylukes: https://github.com/mozilla/rust/blob/master/src/libsyntax/ext/expand.rs#L985 as an example of it
[19:39:12] *** Quits: lenstr (lenstr@E0E80B8D.ED45D46B.DFEAE789.IP) (Client exited)
[19:39:44] <pauls> `($e1:expr $e2:expr]` is illegal, but using two square brackets or two parens would be okay.
[19:39:49] <cmr> strcat: do you know where any of the code that actually does the unwinding is?
[19:39:50] <dylukes> No I mean
[19:39:56] <dylukes> I want to match the arguments to a function call
[19:40:05] <dylukes> like say, how would I write a macro that transposes arguments of a binary fcall?
[19:40:10] <dylukes> foo(a, b) => foo(b, a)
[19:41:21] <sfackler> there isn't any way iirc
[19:41:27] <ecr> `($fnc:ident($a:expr, $b:expr))` I think? (not an expert on macros)
[19:41:38] <ecr> could be entirely wrong
[19:41:51] <pauls> ecr: sounds right
[19:42:22] <ecr> I've only written one macro and it was just straight up text substitution.
[19:42:42] <ecr> I spend all my time in IO land
[19:42:43] *** Quits: bytbox (s@moz-2D36DB45.wireless.umd.edu) (Ping timeout)
[19:43:29] *** Joins: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com)
[19:43:29] <maik_> does anyone know a functional language with an incremental or concurrent gc? (beside OCaml)
[19:43:33] <kmc> ecr: "affine pointers / regions" is two things, but there are many other differences
[19:43:43] <kmc> "typeclasses with the ability to do dynamic dispatch too" doesn't have a clear analog in Haskell 98
[19:44:19] <kmc> also Haskell 98 has only single-param typeclasses; Rust supports multi-param in a weird way where the last param is special; and GHC Haskell supports multi-param in a systematic way
[19:44:35] <ecr> right
[19:44:49] <dylukes> oh hrm
[19:45:02] <dylukes> so I can't really use the macro system to selectively transcribe into two locations?
[19:45:03] <ecr> my point was mostly anything you could do in Haskell 98 (i.e. monads) you should be able to do in Rust once we get HKTs. is that not correct?
[19:45:04] <dylukes> there's no "or" 
[19:45:24] <bstrie> ecr: "once" we get them? :)
[19:45:39] <dylukes> Say I want
[19:45:49] <bstrie> I know that we'd consider a patch to add them, but that's a far cry from saying it's a certainty
[19:45:53] <dylukes> foo(_, _, 2) => |a, b| { foo(a, b, 2); }
[19:46:00] <dylukes> er, drop the semicolon
[19:46:07] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Ping timeout)
[19:46:14] <dylukes> anyhow, I'm not sure this'd be done as it necessitates generating names.
[19:46:18] <kmc> ecr: certainly some things are much harder in Rust because you can't assume uniform representation -- for example that's why the type of every function in Rust returning an iterator exposes the implementation details of how that iterator was constructed
[19:46:23] <ecr> bstrie: people have told me they're on the list of things to do eventually. it's backwards compatible so we can add them after 1.0
[19:46:38] <pauls> dylukes: once hygiene lands, you'll be able to do it.
[19:46:42] <kmc> fn iter(&self) -> Map< Chain< Enumerate< Blah > > >
[19:46:53] <dylukes> pauls I can make the user provide names for the moment I guess.
[19:47:08] <dylukes> it doesn't really matter if it's hygienic anyhow
[19:47:09] <pauls> dylukes: you'll just use any old names (like `a` and `b`), and they won't collide with anything.
[19:47:22] <pauls> dylukes: yeah, that'll suffice until then.
[19:47:30] <dylukes> No I mean, they won't collide here anyways. 
[19:47:36] <dylukes> I just don't know how I'd generate them xD.
[19:47:41] <kmc> I would expect similar problems with monads in Rust, given that list comprehensions are a special case of monadic code
[19:47:44] <dylukes> _ => a, _ => b
[19:47:49] <dylukes> hardly "by example"
[19:49:15] *** Joins: brendan (brendaneic@B1A04851.559FC6D5.439315E1.IP)
[19:49:19] *** Quits: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[19:49:33] <dylukes> I need a special symbol (say _) to designate an un-applied argument position
[19:49:40] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[19:49:43] *** Joins: mr_evil (Mibbit@moz-57A99207.hsd1.il.comcast.net)
[19:49:58] <dylukes> I guess I could recursive curry the function macrowise first?...
[19:50:13] <mr_evil> hi, rust looks pretty interesting, was curious if it uses per task heaps like erlang?
[19:50:23] <cmr> mr_evil: yes
[19:50:23] <ecr> kmc: I'm not sure how that differs from Haskell (aside from requiring the function type be written down). If you want a monad tower you need to write it out...
[19:50:29] <cmr> mr_evil: ...kinda
[19:50:30] <mr_evil> does it do preemptive scheduling of those tasks like erlang?
[19:50:33] <cmr> mr_evil: no
[19:50:42] <mr_evil> sigh
[19:50:44] <mr_evil> thanks
[19:51:12] <cmr> (we have per-task GC, and the ability to have per-task normal allocs, but we don't exploit that atm)
[19:51:18] <kmc> ecr: in Haskell the *type* of your function does not include details about how many times you called map and filter etc. within that function
[19:51:22] <cmr> mr_evil: Why do you desire preemptive scheduling of tasks?
[19:51:43] *** Joins: orshem (orshem@C5E06B1E.A5B6B765.E3D28531.IP)
[19:51:45] <mr_evil> when you have millions of connections to your websocket box, have you seen what happens to latency when not using preemptive?
[19:51:45] <maik_> does anyone here has experience with arcs? Is it possible to have an arc where 1 task can write to it and the other tasks can read from it? (non blocking)
[19:51:49] *** Joins: huseby (huseby@moz-4E8C421A.husebyhome.com)
[19:52:06] <ecr> kmc: sure, but that's only true with iterators because you're encoding functions calls as data structures
[19:52:14] <kmc> ecr: that's because in Haskell you can bundle up all those closures into managed boxes and the user of that function doesn't need to care how big the boxes are
[19:52:33] <cmr> mr_evil: IO is a yield point and tasks are mapped N:M to OS threads which *are* preempted
[19:52:37] <dylukes> This naming issue is frustrating.
[19:52:40] <dylukes> Ohey kmc
[19:52:44] <mr_evil> but you still have to do stuff
[19:52:46] <kmc> and you could do this in Rust with @fn and an alternative @-based iterator API, but it would be non-idiomatic and everyone would be grossed out by it
[19:52:48] *** Quits: joone (joone@moz-6D49DCEA.jf.intel.com) (Client exited)
[19:52:49] <kmc> hi dylukes!
[19:52:59] <dylukes> I'm trying to work out a papp macro ...
[19:53:08] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[19:53:12] <cmr> mr_evil: rust's scheduler is, in theory, pluggable.
[19:53:19] <dylukes> hangup is creating names/selectively transcribing into different locations :\
[19:53:20] <kmc> ecr: whereas standard Haskell doesn't even give you the tools to talk about values separate from their heap boxes -- that's an implementation detail
[19:53:25] <kmc> so that's another big type system difference
[19:53:29] <ecr> kmc: right
[19:53:35] <cmr> it's a latency vs throughput thing, afaict
[19:53:42] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[19:53:43] <ecr> all the memory control is certainly different
[19:53:48] <kmc> and it makes sense because Rust is aiming at a very different niche
[19:53:53] <ecr> agreed
[19:54:01] <ecr> I just want monads :(
[19:54:17] <kimundi> mr_evil: what do you mean with that?
[19:54:59] <mr_evil> I'd argue latency matters a great deal more than throughput 99% of the time, overall latency and overall throughput can still go up by adding more boxes, more cpus, etc, you can't fix weird 99.9% latency problems as easy without preemptive scheduling
[19:55:32] *** Quits: sankha93_ (Instantbir@7061CD01.D6BD0D91.22D41759.IP) (Quit: Gone to save the world!)
[19:55:42] *** Joins: bytbox (s@moz-2D36DB45.wireless.umd.edu)
[19:55:57] *** Joins: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP)
[19:56:40] <kimundi> mr_evil: Mind explaining how preemptive sheduling solves those problems? I have no experience with that, just curios :)
[19:56:44] <cmr> I don't know why the decision that was made was made, you'd need to talk to brson or the other runtime people
[19:57:07] *** Joins: mihneadb (mihneadb@moz-BE33DA21.fw1.sfo1.mozilla.net)
[19:57:16] <dylukes> aha!
[19:57:17] <mr_evil> kimundi: its the same reason why your modern box doesn't lock up like an old windows 3.11 box did when running something intensive
[19:57:18] <dylukes> pattern matching.
[19:57:20] <dylukes> this can be done.
[19:57:21] <dylukes> :)
[19:57:27] <cmr> kimundi: rather than one thread running to a yield point before control being handed to a task, you can interrupt the task mid-processing and run another one
[19:57:38] <dylukes> â€¦maybe :\
[19:57:54] <dylukes> anyhow g2g
[19:57:55] *** Quits: dylukes (textual@moz-2016988D.wireless.pitt.edu) (Quit: Textual IRC Client: www.textualapp.com)
[19:58:08] <toddaaro> mr_evil: no premption in this usecase is a concern, but we haven't quite made it far enough for it to be on the shortlist of things to do
[19:58:26] <mr_evil> toddaaro: thats cool that it is a concern though
[19:58:43] <toddaaro> mr_evil: haskell/akka/etc. don't really do proper premption, it is mostly a question of "what sort of hacks are actually necessary"
[19:58:46] <ecr> mr_evil: following up on what toddaaro said, we're just trying to get a runtime to exist first
[19:59:00] <kmc> GHC does preemption in a stronger sense than Rust, though
[19:59:04] <ecr> e.g. we don't have file IO yet
[19:59:18] <olsonjeffery> file io is close!
[19:59:20] <toddaaro> kmc: yea, they picked more hacks than the current runtime's zero
[19:59:24] *** Quits: lmandel (lmandel@moz-BBE3ABD.mv.mozilla.com) (Quit: lmandel)
[19:59:27] <kmc> in GHC Haskell any point where you might allocate is a preemption point, and almost all Haskell code allocates like it's going out of style
[19:59:31] <kmc> yep
[19:59:39] <toddaaro> that is what hurts us, we can do rust code that doesn't allocate
[19:59:44] <toddaaro> and we can do loops
[19:59:54] <toddaaro> so uh, sort of out of hacks
[20:00:04] <kmc> I don't think that's precisely it
[20:00:12] <toddaaro> compiler-inserted yield is an idea
[20:00:32] <cmr> sounds like an awful idea to me
[20:00:36] <toddaaro> well, what do you do about a non-allocating loop?
[20:00:38] <cmr> I mean, maybe it's not worse than the alternatives
[20:00:45] <toddaaro> it certainly shouldn't be default
[20:00:51] <kmc> the core issue is that you can't stop some compiled code at any random machine instruction and reverse out the abstract machine state that needs to be saved for a green thread context switch
[20:00:59] <kmc> that doesn't really have anything to do with allocation
[20:01:13] <ecr> right now there's a horrible bit in the TCP IO that causes everything accepted on that socket to have to use the same thread for IO on the socket. mostly because we aren't working on moving libuv handles between event loops until after we've achieved thread safety
[20:01:13] <toddaaro> well yea, that is why we can't do general premption
[20:01:13] <kmc> if you have a GC, allocation is a convenient place to put a preemption point, because you need to have the abstract state *anyway* for GC roots
[20:01:50] <cmr> And yet idiomatic rust uses very little to zero GC allocations
[20:02:11] <kmc> but there are other solutions, e.g. deriving the abstract state from the machine state using debug information
[20:02:28] <toddaaro> go apparently sets the stack to zero so next function call triggers the SO handler allowing a prempt
[20:02:36] <toddaaro> but that doesn't save loops
[20:02:41] <strcat> go1.2 will have pre-emption
[20:02:45] <toddaaro> or self/sibling call optimization
[20:02:50] <toddaaro> strcat: implemented how?
[20:02:51] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[20:02:53] <strcat> don't know
[20:02:58] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[20:03:03] <kmc> it's easy enough for one OS thread to make another OS thread stop right where it is and jump to some other function
[20:03:08] <kmc> that's not the tricky part
[20:03:13] *** Joins: lmandel (lmandel@moz-BBE3ABD.mv.mozilla.com)
[20:03:29] <toddaaro> kmc: is this easy?
[20:03:30] <strcat> hm
[20:03:46] <strcat> toddaaro: oh maybe they abandoned their plans to do it more aggressively than calls
[20:03:48] <kmc> toddaaro: yes, eg using ptrace
[20:03:49] <strcat> for now
[20:04:01] <toddaaro> kmc: what is the implementation?
[20:04:16] <kmc> and that's sufficient if the only thing you want to save/restore is the machine level state (i.e. all the machine registers)
[20:04:33] <graydon> sully: to what extent do you think https://github.com/mozilla/rust/issues/2794 is done?
[20:04:36] <ecr> kmc: is that going to be portable though? (i.e. windows)
[20:04:50] <kmc> ecr: don't know
[20:05:22] *** Joins: robertknight (robertknig@moz-731801B5.range86-144.btcentralplus.com)
[20:06:46] *** Quits: brendan (brendaneic@B1A04851.559FC6D5.439315E1.IP) (Quit: brendan)
[20:07:00] <kmc> there is some overhead and so you would only want to do this as a watchdog on loops which go a long time without yielding
[20:07:02] *** Joins: brendan (brendaneic@B1A04851.559FC6D5.439315E1.IP)
[20:07:56] *** Quits: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:07:56] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Quit: WeeChat 0.4.1)
[20:08:57] *** Joins: eholk (eholk@moz-3CD157D3.tmodns.net)
[20:09:03] <kmc> but the problem (in GHC anyway) is that you can't stop a thread just anywhere and save its state coherently, knowing only what's in the machine registers
[20:10:09] *** Quits: eholk (eholk@moz-3CD157D3.tmodns.net) (Quit: eholk)
[20:10:30] <kmc> it may be that Rust (and Go) are low-level enough that the machine state is sufficient
[20:10:39] <graydon> sully: do we reuse non-type-dependent instances of default methods?
[20:11:46] <graydon> kmc: I believe the plan with preemption is just to keep enough spare threads around that if there's work to be done, it will get stolen to a thread. IOW let an ilooping thread iloop on a single task to its heart's content.
[20:11:57] <kmc> ok
[20:12:00] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[20:12:01] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/sKx86A
[20:12:01] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[20:12:14] <kmc> here is the haskell bug btw http://ghc.haskell.org/trac/ghc/ticket/367
[20:12:19] <graydon> mr_evil toddaaro etc: ^^
[20:12:27] <graydon> (stealing rather than preemption)
[20:13:07] *** Quits: brendan (brendaneic@B1A04851.559FC6D5.439315E1.IP) (Quit: brendan)
[20:13:20] <toddaaro> graydon: yea, the cost to an iloop is one lost scheduler
[20:14:07] *** Quits: alex-abreu (alex@moz-7421D6C9.mc.videotron.ca) (Ping timeout)
[20:14:24] <toddaaro> losing a scheduler with our libuv setup could be ...bad
[20:14:38] <toddaaro> I'm sure we'll have something that works fine eventually
[20:14:45] <graydon> bad why?
[20:14:49] *** Joins: joone (joone@E10A1781.2160464A.A34EC3BB.IP)
[20:15:00] <graydon> IO can't go home to it?
[20:15:25] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[20:15:31] <toddaaro> yes
[20:17:10] <graydon> hm. definitely less cool.
[20:17:26] *** Quits: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP) (Client exited)
[20:21:09] *** Quits: maxli (maxli@13F2CEC5.7672369.D8E68FF6.IP) (Quit: Leaving.)
[20:21:15] *** Joins: jgilbert (jgilbert@moz-4C088FCE.hsd1.ca.comcast.net)
[20:22:00] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[20:22:00] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/R8wX2g
[20:22:00] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[20:24:18] *** Joins: brendan (brendaneic@B1A04851.559FC6D5.439315E1.IP)
[20:25:54] *** Quits: nsf (nsf@moz-EEF3238A.convex.ru) (Quit: WeeChat 0.4.1)
[20:26:40] *** Joins: lkuper (lkuper@7B3806F8.D3FA0837.51B6877.IP)
[20:26:58] <cmr> Hm
[20:27:21] *** Quits: Ms2ger (Ms2ger@moz-590E79FE.adsl-dyn.isp.belgacom.be) (Quit: nn)
[20:27:33] <cmr> So, am I understanding correctly that all tasks go through rust_try (from rt/rust_builtin.cpp), which unconditionally catches the exception thrown by rust_begin_unwind?
[20:27:44] <sully> graydon: probably not
[20:28:20] *** Quits: lkuper (lkuper@7B3806F8.D3FA0837.51B6877.IP) (Ping timeout)
[20:30:35] <graydon> sully: shall I open a bug on that?
[20:31:10] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[20:31:46] <sully> I mean, our whole type_use system is a complete mess
[20:31:53] *** Quits: bytbox (s@moz-2D36DB45.wireless.umd.edu) (Ping timeout)
[20:32:03] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[20:32:03] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/R8wX2g
[20:32:03] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[20:32:03] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[20:32:03] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/omFIag
[20:32:03] <ghrust> 13rust/06auto 14dc9b3e3 15Michael Sullivan: Rangechange the log message truncation limit.
[20:32:03] <ghrust> 13rust/06auto 146a6d3b6 15Michael Sullivan: Make supertrait methods callable on object types....
[20:32:04] <ghrust> 13rust/06auto 14293660d 15bors: auto merge of #8519 : msullivan/rust/objects, r=catamorphism...
[20:32:06] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[20:32:26] <sully> so, sure, but I think really the bug is mostly "completely overhaul type_use"
[20:32:51] <graydon> yeah
[20:32:56] <sully> I will confess that every time I have dealt with type_use, I have basically just said "don't bother trying to share with whatever feature I am adding"
[20:33:14] <graydon> yeah, this is a widely reported feeling
[20:33:24] <graydon> is there a "completely overhaul type_use" bug? I can't see one
[20:33:36] <sully> type_use basically never actually merges nontrivial things, I think
[20:33:41] <graydon> yeah
[20:33:45] *** Quits: brendan (brendaneic@B1A04851.559FC6D5.439315E1.IP) (Quit: brendan)
[20:33:55] <graydon> I'm getting that feeling, looking at the number of function copies we have
[20:33:56] <sully> but there are also a bunch of bugs in it that would cause it to merge things that shouldn't, I think
[20:34:28] <tjc> graydon: https://github.com/mozilla/rust/issues/6819 has a couple of type_use issues listed in it
[20:34:32] <sully> if it wasn't for the fact that it gets covered up by being overly conservative in other places
[20:34:42] <strcat> I think it's broken on destructors
[20:34:46] <graydon> tjc: I know, I'm editing that. I'll make a new one to cover "rewrite type_use entirely"
[20:34:47] <strcat> generic destructors
[20:37:53] <maik_> do we have RWArc examples somewhere?
[20:38:29] <bstrie> graydon: I was skimming the mozilla summit attendee document and saw that you were registered for the toronto event. maybe we'll have to meet up :)
[20:39:01] <graydon> could anyone who's been inside metadata recently and knows something that horrifies them about it please file a bug related to it and link into https://github.com/mozilla/rust/issues/8652
[20:39:12] <graydon> bstrie: yes, I'll be in toronto then. you're there?
[20:39:35] <bstrie> graydon: toronto's the nearest event to me, yes. assuming I can figure out where my passport is hiding...
[20:39:44] <graydon> bstrie: where are you?
[20:39:55] <bstrie> graydon: pittsburgh PA, four hours south
[20:40:06] *** Joins: lbergstrom (Adium@moz-BBE3ABD.mv.mozilla.com)
[20:40:48] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[20:40:48] *** ChanServ sets mode: +o brson
[20:40:58] <bstrie> graydon: I sort of thought that you'd be heading to the california event instead, given the proximity to vancouver
[20:40:59] <pcwalton> strcat: go 1.2's "preemption" is just on function calls
[20:41:04] <cmr> brson: ping
[20:41:19] <bstrie> or at least relative proximity...
[20:41:20] <graydon> bstrie: I have a lot of family and friends in toronto I don't visit often enough
[20:41:22] *** Joins: tburdick (tburdick@moz-3D8544DC.members.linode.com)
[20:41:22] <pcwalton> go has a habit of saying they've done things they haven't, e.g. "precise GC" which was still conservative on stack
[20:41:23] <strcat> pcwalton: yeah I noticed that when I looked at the bug, I expected from hearing one of them say they were implementing it that they did it for real
[20:41:23] *** tburdick is now known as bfrog
[20:41:26] <graydon> bstrie: grew up there
[20:41:46] *** Quits: robertknight (robertknig@moz-731801B5.range86-144.btcentralplus.com) (Ping timeout)
[20:42:03] <bstrie> graydon: awesome, it will be well worth the drive then :) maybe I'll find some CMU rusties to carpool with, who knows
[20:42:06] <pcwalton> 300 people in #rust :)
[20:42:10] <brson> \o/
[20:42:12] <graydon> hah!
[20:42:13] <brson> we win
[20:42:23] <bfrog> libuv integration is an interesting idea
[20:42:29] <brson> cmr: pong
[20:42:31] <bfrog> saw that in there
[20:43:15] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[20:43:34] <cmr> brson: Do you know how unwinding works at all? In particular I'd like to eliminate the dependency on a C++ runtime, at least for non-win32 where libunwind works
[20:44:49] <cmr> I'm looking at rust_upcall.cpp and rust_builtins.cpp, but that doesn't give me any insight into what goes on in the compiler to make things work.
[20:45:11] *** Quits: paulproteus (quassel@rose.makesad.us) (Ping timeout)
[20:45:21] *** Joins: michael_rb (michael_rb@moz-985E1E74.sw.biz.rr.com)
[20:45:33] *** Joins: paulproteus (quassel@moz-E86A3B42.makesad.us)
[20:46:08] *** Quits: tjc (tjc@moz-A138B67E.lightspeed.sntcca.sbcglobal.net) (Ping timeout)
[20:48:22] <erickt> bstrie: are you at/were at CMU? I went there :)
[20:49:09] <jack> there seem to be a lot of CMU people around rust :)
[20:49:35] <brson> cmr: it basically amounts to a few library calls (to libc++ or presumably libunwind), some of which are generated by llvm and some by our C++ code. There are basically three aspects: throw, UnwindResume, and whatever it is that terminates unwinding and cleans up the exception value (don't remember offhand)
[20:50:03] <bstrie> erickt: I'm basically the only person in this channel who 1) lives vaguely in pittsburgh and 2) did not go to CMU :P
[20:50:04] <brson> cmr: The obvious thing to do first is to replace the C++ 'throw' with whatever library call initiates unwinding
[20:50:12] <bstrie> bblum is another CMUer, I believe
[20:50:13] <erickt> bstrie: lol
[20:50:28] <brson> cmr: llvm won't do that part on its own, so it will require researching how C++ unwinding and libunwind works
[20:50:48] <cmr> brson: well the problem is that libunwind will unwind your stack frame, but doesn't do the rest of the stuff the itanium ABI requires like entering landing pads and such
[20:51:00] <graydon> rust is CMU central, yeah
[20:51:15] <brson> cmr: libunwind should have the functionality to stop at landing pads
[20:51:51] <graydon> it's the ML angle I guess. also maybe they want to rename it steel bank.
[20:51:57] <brson> cmr: i believe that the gcc c++ unwinding impl *is* libunwind
[20:52:07] <cmr> brson: not by default, no.
[20:53:29] <cmr> Part of my interest comes from wanting to run on top of a libc++/libcxxabi environment.
[20:55:17] <michael_rb> I go to UT, but I also just  found out about this and joined the mailing list. I haven't even gotten through the documentation yet
[20:56:06] *** Joins: tjc (tjc@moz-A138B67E.lightspeed.sntcca.sbcglobal.net)
[20:56:07] *** ChanServ sets mode: +o tjc
[20:56:15] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[20:56:41] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[20:56:55] <brson> cmr: you know more about it than i
[20:57:01] <SingingBoyo> michael_rb: UofT?  As in toronto?
[20:57:38] <michael_rb> Oh, no, UT Austin (sorry, should've been more specific)
[20:58:21] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[20:58:28] *** Quits: josedonizetti (josedonize@DF22210B.35D9DDB.8EF76F75.IP) (Ping timeout)
[20:58:34] *** Joins: brendan (brendaneic@moz-78B60485.public.wayport.net)
[20:59:20] <SingingBoyo> and here I thought I'd found another Canadian.  ah well.
[20:59:26] *** Joins: lizzard (ehenry@moz-5A4BE8E8.dsl.static.sonic.net)
[20:59:54] *** Quits: tgummerer (tgummerer@51D3B54.FEF996EA.EA6FEF3D.IP) (Ping timeout)
[21:00:24] * strcat is canadian
[21:00:26] <Luqman> SingingBoyo: plenty of canadians lurking here :P
[21:00:35] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[21:00:37] <graydon> SingingBoyo: I went to U of Toronto
[21:00:53] <tjc> Does anyone have a hack to keep oneself from accidentally adding changes to the src/llvm directory by doing `git add -A`?
[21:00:57] <graydon> (the mozilla toronto office is the largest outside the bay area, IIRC)
[21:00:59] <bstrie> SingingBoyo: rust is a canadian language! welcome home
[21:01:05] <tjc> (I don't know how git gets convinced in the first place that the src/llvm dir has changed)
[21:01:09] <tjc> I've done it too many times
[21:02:19] <acrichto> tjc: some submodule command will bring src/llvm back up to date, I normally let ./configure take of the submodule command
[21:02:31] <strcat> git submodule update
[21:02:40] <tjc> acrichto: Yeah, I'd rather not accidentally capture the src/llvm change in a commit to begin with, though
[21:02:46] <tjc> if you see what I mean
[21:03:21] <strcat> tjc: I think you can probably put a few lines in the pre-commit hook
[21:03:26] <strcat> not sure exactly how
[21:03:29] <erickt> brson: do you know if all of the SF rusters will be going to the california event? If not, I *could* travel up to canada if that's where everyone else is going to be
[21:03:59] <tjc> erickt: we're spready out
[21:04:01] <tjc> er
[21:04:05] <tjc> spread out, about equally in the 3 locations
[21:04:19] <erickt> glad to hear
[21:04:21] <tjc> graydon and I will be in Toronto, not sure about the others
[21:04:36] <graydon> by that measure go is also canadian, or partly. rob pike is anyway.
[21:05:13] <erickt> tjc: did you end up moving permanently to Canada?
[21:05:24] <graydon> (I used to hang out with some toronto unix folks who went to school with him. maybe waterloo? I don't remember exactly, there was some connection)
[21:05:28] <tjc> erickt: not yet, I'm in Mountain View for now
[21:06:40] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[21:07:25] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[21:07:57] <erickt> brson: ping
[21:08:00] <brson> erickt: i'm in brussels
[21:08:02] <brson> erickt: ping
[21:08:04] <brson> -ong
[21:08:23] *** Joins: Kruppe (user@moz-543303A0.cable.teksavvy.com)
[21:08:35] <erickt> brson: brussels would be fun :)
[21:09:42] *** Joins: eholk (eholk@moz-D0157C52.public.wayport.net)
[21:10:04] <strcat> tjc: https://github.com/chaitanyagupta/gitutils/blob/master/submodule-hooks/pre-commit I found the thing I once used ;]
[21:10:12] <strcat> just need to put it in .git/pre-commit
[21:10:13] <tjc> strcat: oh, thanks!
[21:10:15] <brson> i'm not at all looking forward to the flight
[21:10:24] <tjc> that looks great
[21:10:31] <erickt> brson: anywho, I vaguely remember you mentioning something about creating a lower level version of a task that's independent of threading. Did you have plans to do something like that?
[21:11:01] <Luqman> brson: cool! me too!
[21:11:14] *** Quits: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net) (Quit: msingle)
[21:12:20] <olsonjeffery> rusti: struct Foo() impl Foo { fn bar() { 0 } }
[21:12:21] -rusti- <anon>:5:22: 5:26 error: expected `;` but found `impl`
[21:12:22] -rusti- <anon>:5          struct Foo() impl Foo { fn bar() { 0 } }
[21:12:22] -rusti-                                ^~~~
[21:12:22] -rusti- application terminated with error code 101
[21:12:26] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[21:13:02] <brson> erickt: i won't get to it personally for a long time, but the basic idea is to extend the TaskType enum (which defines the Task subtypes) with a new ThreadTask (or something), move parts of Task that don't make sense for non-coroutines into the subtypes, then start fixing stuff that doesn't work with the new task type
[21:13:20] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[21:13:46] <brson> erickt: this task would be run via a stack closure, like `do task.run { ... }` and all the task-local services would be available for the duration
[21:14:14] <brson> then you can create a green-thread-less std profile that boots into a ThreadTask instead of a GreenTask
[21:14:18] <brson> then write emscripten
[21:14:23] <brson> er, compile to-
[21:19:56] <erickt> brson: neat. Would you think that if we do want to create generators we would want to leverage your coroutine code? Or would it be too heavyweight?
[21:20:36] <sully> sigh, our type tables are such a mess
[21:21:46] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[21:21:57] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[21:21:57] <jack> why does debug! and friends output the string literal form?
[21:22:05] <strcat> jack: because it uses %? in fmt!
[21:22:07] <cmr> jack: because they use fmt
[21:22:16] <jack> can we fix that? :)
[21:22:27] <strcat> well afaik fmt! is on the way out soon
[21:22:36] <sully> is it really?
[21:22:38] <strcat> so we can do it right the second time around
[21:22:45] <strcat> rusti: ifmt!("{}", 2)
[21:22:46] <sully> like, we have a proposal and somebody who is implementing it?
[21:22:47] -rusti- ~"2"
[21:22:47] <jack> ok. as long as someone is wokring on it :)
[21:22:52] <cmr> sully: already implemented, even!
[21:22:52] <strcat> sully: it's sort of implemented
[21:22:55] <strcat> acrichto is doing it
[21:23:00] <strcat> it's not 100% complete though afaik
[21:23:03] <sully> ok
[21:23:12] <strcat> rusti: ifmt!("{}", "foo")
[21:23:12] -rusti- ~"foo"
[21:23:18] <sully> so, I also think that answer isn't quite right
[21:23:24] <strcat> rusti: print(ifmt!("{}", "foo"))
[21:23:25] -rusti- foo()
[21:23:29] <strcat> rusti: println(ifmt!("{}", "foo"))
[21:23:30] -rusti- foo
[21:23:30] -rusti- ()
[21:23:30] <brson> erickt: for the type of generators necessary for iterators it will be too heavy, but I would like to experiment more with coroutines - the coroutine type is factored out to accomodate this
[21:23:31] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[21:23:32] <sully> rusti: fmt!("foo")
[21:23:33] -rusti- ~"foo"
[21:23:36] <sully> er
[21:23:39] <sully> rusti: debug!("foo")
[21:23:40] -rusti- ()
[21:23:42] <sully> argh.
[21:23:45] <strcat> ;]
[21:23:53] <sully> well, so, I think if you just give it a string, it gets formatted twice
[21:23:53] <cmr> rusti: error!("foo")
[21:23:55] -rusti- ~"\"foo\""
[21:23:55] -rusti- ()
[21:23:58] <sully> yeah.
[21:24:14] <cmr> it's running fmt on the output of fmt
[21:24:18] <cmr> iirc
[21:24:20] <sully> because it gets formatted once by fmt("%?")
[21:24:48] <sully> and then I think the underlying log infrastructure does the equivalent of fmt("%?") in order to print things
[21:25:04] <cmr> graydon: when did you turn off valgrind?
[21:25:11] <graydon> cmr: this morning
[21:25:13] <cmr> because we already have a valgrind failure on snap3-linux :\
[21:25:23] <cmr> http://buildbot.rust-lang.org/builders/snap3-linux/builds/504/steps/test/logs/stdio
[21:25:52] <jack> cmr, graydon: well that answers part of "how often will that happen?"
[21:25:55] <cmr> like, a lot
[21:26:00] <cmr> toddaaro: I think your patch was bad.
[21:26:03] <erickt> brson: cool. I'll have to poke around in the coroutine code. thanks
[21:26:03] <cmr> the idle opt
[21:26:04] <graydon> :(
[21:26:23] *** Quits: michael_rb (michael_rb@moz-985E1E74.sw.biz.rr.com) (Quit: ChatZilla 0.9.90.1 [Firefox 23.0.1/20130814063812])
[21:26:25] <cmr> https://gist.github.com/cmr/613c5ac6a08b42542502
[21:26:32] <acrichto> brson: is there a way to force 'spawn' to spawn a thread in the current event loop?
[21:26:34] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[21:27:06] <erickt> brson: and who knows, if we grow language-level support for coroutines/generators it may also simplify things in std::rt
[21:27:45] <strcat> erickt: the problem with a coroutine based on is that you'd pay for a context switch on each iteration
[21:28:01] <strcat> and even lack of inlining or an indirect call would be bad
[21:28:04] <strcat> for an iterator
[21:28:18] <brson> graydon: shall I revert?
[21:28:29] <strcat> for I/O iterators it would probably be fine but those are easy to write :)
[21:28:36] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[21:28:36] <erickt> brson: one neat thing we had in felix was we could sometimes optimize our green threads into generators. that got us in trouble in the language shootout we ended up compiling one of the thread tests into a loop and we were accused of cheating :)
[21:28:49] <kmc> haha
[21:28:51] <cmr> `return new uv_idle_t;`
[21:28:59] <cmr> And apparently it's just never getting free'd
[21:29:21] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[21:29:27] <graydon> brson: the thing that broke V?
[21:29:29] <cmr> I see rust_uv_idle_delete  called once
[21:29:29] <strcat> graydon: how long does the linux 64-bit valgrind bot take?
[21:29:33] <strcat> optimized
[21:29:34] <brson> graydon: yeah
[21:29:38] <graydon> strcat: 2 hours
[21:29:41] <strcat> oh
[21:29:48] <strcat> I wonder if we can make that less awful...
[21:29:53] *** Joins: reyre|away (reyre@moz-9002CDDA.cpe.net.cable.rogers.com)
[21:29:55] <graydon> brson: assuming it's blocking snapshots
[21:30:03] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[21:30:12] <cmr> Well the only reason I really wanted the snapshot was for the rt optimizations.
[21:30:17] <cmr> So...
[21:30:17] <graydon> strcat: I just sent an email about this. rather lengthy one.
[21:30:25] *** reyre|away is now known as reyre_
[21:30:27] *** reyre_ is now known as reyre__
[21:30:27] <strcat> aha :)
[21:30:30] *** reyre__ is now known as reyre___
[21:30:31] <mihneadb> so.. building servo, internal compiler error - https://pastebin.mozilla.org/2889945
[21:30:40] <mihneadb> want more data on this
[21:30:42] <strcat> graydon: which version of vg is it btw?
[21:30:48] <mihneadb> or should I just ignore and try recloning?
[21:30:54] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[21:30:54] <graydon> strcat: pretty new, I think
[21:31:03] <graydon> I tend to upgrade it every release or two
[21:31:20] <strcat> I think 3.8 was the one where they sped things up and it's probably at least that
[21:31:50] <graydon> 3.7.0 on linux1
[21:31:59] *** Quits: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net) (Ping timeout)
[21:32:01] <graydon> and linux2
[21:32:10] <graydon> 3.8.0 on my laptop
[21:32:16] <graydon> I'll check the speed difference
[21:32:19] <strcat>    - Performance of memory leak check has been improved, especially in
[21:32:21] <strcat>     cases where there are many leaked blocks and/or many suppression
[21:32:23] <strcat>     rules used to suppress leak reports.
[21:32:40] <brson> acrichto: i'm not sure exactly what you want so here are several anwsers. a thread can't be spawned into the current event loop. a new task by default will run on the current event loop but might migrate away. there's no way currently to spawn a task and also pin it to the current event loop, but such a thing is easy to add; i'd be curious about the use case though
[21:32:44] <strcat> we seem to have a lot of suppressions, but who knows if it's really a lot relative to what they're comparing :)
[21:32:50] *** reyre___ is now known as reyre
[21:33:12] <mihneadb> https://pastebin.mozilla.org/2889946 there
[21:33:22] *** Joins: dave1629 (dave@107C2269.1CA5FEA3.DDE5D3F6.IP)
[21:33:43] <erickt> strcat: definitely. My little bit of googling around on this subject suggest people have implemented coroutines with state machines. Perhaps if we implemented support for state machines it could help speed up tasks
[21:34:07] <acrichto> brson: ok, that kinda answers my question. I'm still hitting a deadlock in process bindings, and I think it's when you're attempting to capture the output. The way it works is it spawns two tasks to read the stdout/stderr libuv pipes, and I was worried about those going to different event loops. I'll keep investigating though b/c it may not even be related to that problem
[21:35:21] <brson> acrichto: that definitely may be if you are doing multithreading. you need ecr's threadsafe I/O stuff: https://github.com/mozilla/rust/pull/8631, which unfortunately also has some problems still I think
[21:35:30] <olsonjeffery> ok. getting no fixed-stack-segment attrib errors until stage1 is annoying.
[21:36:51] <cmr> olsonjeffery: I'm making a snapshot asap, currently investigating a memory leak
[21:37:09] <acrichto> brson: oh I think this is the problem, I made a small test case and everything is working fine with RUST_THREADS=1 but it's routinely wedging with multiple threads
[21:37:32] <brson> pretty funny that as soon as we disabled test coverage we have a fire drill :-/
[21:37:44] <acrichto> brson: would you be opposed to p=N on the threadsafe io pull request?
[21:38:10] <cmr> brson: at least we caught it quickly, rather than weeks or a month later
[21:38:40] <brson> acrichto: sure, but ecr was reporting some problems with it yet, so it may not be fully baked
[21:38:45] <brson> ecr: what's the status of threadsafe i/o?
[21:39:24] <ecr> brson: I'm running into nondeterministic deadlocks when converting the tests to use run_in_mt_newsched_task
[21:39:28] <cmr> toddaaro: I'm not familiar with the code, but idle_delete *is* called in close_cb, so either we're confusing valgrind or libuv is never calling the callback.
[21:39:42] <brson> testing the revert now
[21:39:44] <olsonjeffery> rusti: let mut foo = 0; foo = 1; assert!(foo == 1);
[21:39:45] -rusti- <anon>:5:17: 5:20 warning: value assigned to `foo` is never read [-W dead-assignment (default)]
[21:39:45] -rusti- <anon>:5          let mut foo = 0; foo = 1; assert!(foo == 1);
[21:39:45] -rusti-                           ^~~
[21:39:45] -rusti- ()
[21:39:50] <olsonjeffery> nice.
[21:39:56] <strcat> cmr: valgrind is likely right if it's just from `new`
[21:39:56] <toddaaro> cmr: is that the commit that did it?
[21:40:00] *** Joins: Liothen (liothen@moz-80EF0CD7.spkn.qwest.net)
[21:40:15] <ecr> brson: I think I'm going to run it through valgrind and see if it can figure out what's going on
[21:40:20] <strcat> unless libuv is supposed to cache them and doesn't bother dropping them
[21:40:35] <cmr> toddaaro: I'm 90% sure, what other commit changed idle handling that landed today?
[21:40:41] <strcat> (*cough* glib)
[21:40:47] * strcat recommends never to use glib/gtk ;P
[21:40:47] <cmr> but brson is testing the revert, so, we'll see
[21:40:57] <brson> ecr: ok. should we hold off on landing the pr, or should we land it and follow up with fixes later? does the current suite ever deadlock with e.g. RUST_THREADS=1?
[21:41:08] <acrichto> graydon: would it be possible to alter bors to read things like "r+ valgrind=true" for running valgrind/all only on specific pull requests?
[21:41:29] <graydon> acrichto: possible, yes. difficult and a lot of work though.
[21:41:50] <strcat> probably easier to just reduce mem usage a ton
[21:41:52] <graydon> lots of moving pieces, would break landing for a while while I worked out how to do it
[21:42:02] <graydon> imo yes all the other avenues are more fruitful
[21:42:03] <acrichto> graydon: yeah probably not worth it if it's lots of extra work
[21:42:32] <graydon> the one thing I'm most-willing to experiment with in bors land is dividing the testsuite into N pieces and running the 1/N subsets on different builders
[21:42:37] <brson> ecr: I'm going to hold off while you investigate
[21:42:45] <graydon> that won't get rid of the 30-minute lump of core compile time
[21:42:47] <ecr> brson: probably a good idea
[21:42:59] <graydon> but it should be relatively easy to split the testsuite
[21:43:08] <ecr> brson: the current PR version has never deadlocked, but it's all using run_in_newsched_task
[21:43:10] <strcat> olsonjeffery: that dead assignment error is actually because of = 0
[21:43:15] <acrichto> graydon: < 1hr cycle time would be awesome
[21:43:16] <strcat> olsonjeffery: it knows that foo = 1 always sets it
[21:43:25] <strcat> rusti: let mut foo = 0; foo = 1; assert!(foo == 1);
[21:43:26] -rusti- <anon>:5:17: 5:20 warning: value assigned to `foo` is never read [-W dead-assignment (default)]
[21:43:26] -rusti- <anon>:5          let mut foo = 0; foo = 1; assert!(foo == 1);
[21:43:26] -rusti-                           ^~~
[21:43:26] -rusti- ()
[21:43:28] <strcat> rusti: let mut foo; foo = 1; assert!(foo == 1);
[21:43:29] <Seldaek> graydon: is faster hardware an option to speed up the build?
[21:43:30] -rusti- ()
[21:43:36] <graydon> Seldaek: not realistically
[21:44:03] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[21:44:28] <graydon> Seldaek: I mean, faster hw does exist. but this is on 8 way xeon E31220 / 3.10GHz
[21:44:28] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[21:44:35] <graydon> we'd be chasing scraps
[21:44:39] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[21:44:40] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[21:44:42] <Seldaek> graydon: yeah ok if it's already good enough it's already good enough :)
[21:44:46] <olsonjeffery> strcat: huh.. i see.. and the error is technically correct
[21:44:58] <graydon> I did point out quite a few productive avenues in that email
[21:45:00] <olsonjeffery> (which is the best kind of correct)
[21:45:01] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[21:45:10] <jack> graydon: ec2 i/o is notoriously slow. so raw metal might be a *lot* faster.
[21:45:22] <graydon> jack: V is situated on real hardware
[21:45:27] <brson> toddaaro: can you investigate the valgrind errors?
[21:45:32] <graydon> it sits next to my desk in vancouver. very noisy fan.
[21:45:35] <toddaaro> brson: I can look into it
[21:45:36] <jack> graydon: :)
[21:45:39] <brson> toddaaro: I'm going to work on a revert to get the bots green again
[21:45:51] <pcwalton> ok, coherence checking change looks like it's bootstrapping
[21:45:52] <jack> keeps you warm in winter i guess :)
[21:45:55] <erickt> brson / strcat: do we really need a context switch for a coroutine? I *think* we could get away with having a state machine for reentrance, an env map for the coroutine's local vars, and reusing the callee's stack for the stack
[21:45:57] <pcwalton> this may not be a huge win
[21:46:00] <toddaaro> brson: it looks like the design for closing the idle callback after the loop finishes doesn't work, as libuv doesn't actually call the close callback
[21:46:07] <graydon> on a machine spec'ed by andrew sutherland, if that helps :)
[21:46:09] *** Quits: eholk (eholk@moz-D0157C52.public.wayport.net) (Quit: eholk)
[21:46:15] <Seldaek> jack: hah, "send more PRs, graydon is cold!"
[21:46:22] <pcwalton> 0.434s -> 0.324s in librustc
[21:46:24] <toddaaro> brson: might be a trivial fix to just call the equivilant of the close callback in the cleanup section of sched.run
[21:46:25] <dbaupp> graydon: btw, I think doener/dotdash has added a few codegen tests in his IR work. (I saw you lamented the fact that people weren't adding them in the meeting.)
[21:46:29] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[21:46:30] <pcwalton> but it may win more on small crates, who knows
[21:46:41] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Ping timeout)
[21:46:47] <erickt> brson / strcat: tasks would need the stack switch of course, but that could happen outside of the task's coroutine
[21:46:49] <graydon> pcwalton: you were thinking .. because it reads 1x each_path rather then 2x?
[21:47:04] <pcwalton> well, the compiler does now
[21:47:15] <pcwalton> I should check small crates
[21:47:21] <strcat> erickt: well if it didn't have the switch, it would essentially be the same as a generator for iterators
[21:47:26] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[21:47:34] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[21:47:37] <strcat> erickt: you could have something like next() taking a param
[21:47:40] <strcat> like python's next()
[21:47:44] <erickt> strcat: that's where I'm going :)
[21:47:45] <graydon> pcwalton: right. but each_path does tend to crawl across the whole metadata segment, yes?
[21:47:58] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[21:48:24] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[21:48:24] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[21:48:29] <erickt> strcat: a generator would just be a special case of our state machine-driven corroutine
[21:48:35] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[21:48:44] <strcat> erickt: ah, yeah - that'd be cool
[21:48:57] <strcat> I'm not familiar enough with C# to know what they do there ;[
[21:49:05] <olsonjeffery> its magic.
[21:49:09] <strcat> just that they use a state machine compiler
[21:49:12] *** Quits: mr_evil (Mibbit@moz-57A99207.hsd1.il.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[21:49:20] <strcat> but I dunno if you can pass in parameters
[21:49:24] <olsonjeffery> depending on the runtime it goes async in the main thread or pushes it into a threadpool (does this in ASP.NET)
[21:49:28] *** Quits: saml (sam@moz-14C16814.cst.lightpath.net) (Quit: Leaving)
[21:49:44] <strcat> olsonjeffery: I just mean yield though
[21:50:01] <strcat> which they implement with a really simple transformation, maybe even in the bytecode compiler
[21:50:22] <brson> toddaaro: what do you mean 'after the loop finishes'? I didn't think we were doing that
[21:50:38] <toddaaro> brson: that is when we call .close on the idle callback
[21:50:41] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[21:50:45] <pcwalton> graydon: yes, coherence will unavoidably do that still to some extent though
[21:50:55] <pcwalton> we could be smarter and only look up type impls during method lookup
[21:51:04] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[21:51:05] <pcwalton> I don't really want to do that right now though, probably a small win compared to resolve
[21:51:09] <graydon> pcwalton: mhm
[21:51:14] <strcat> pcwalton: is it indexed in any way?
[21:51:18] <brson> toddaaro: after event_loop.run returns?
[21:51:20] <pcwalton> it is now
[21:51:23] <toddaaro> brson: yes
[21:51:27] <strcat> pcwalton: aha :)
[21:51:46] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[21:51:58] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[21:51:59] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/omFIag
[21:51:59] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[21:52:35] <brson> toddaaro: the idle callback holds an event loop ref so how does the event loop exit?
[21:52:35] <graydon> brson: if I were to install a mechanism for splitting testsuite in pieces, do you have a strong preference for a command line flag vs. an env var? the env var is easier for me to thread through automation.
[21:52:40] *** Quits: rossm (rossm@moz-EE3BB1DC.br.br.cox.net) (Quit: )
[21:52:51] <toddaaro> brson: that one doesn't count for shutdown
[21:52:58] <toddaaro> brson: it is just toggleable idle behavior
[21:53:10] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[21:53:17] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[21:53:20] <pcwalton> ok, coherence checking goes from 0.115 s to 0.091 s
[21:53:22] <pcwalton> not great
[21:53:35] <pcwalton> probably need to do method lookup changes to get a huge improvement
[21:53:35] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[21:53:53] <erickt> strcat: here's a video about how to implement c#'s await from scratch: http://www.youtube.com/watch?v=HpA2x_JvLD4
[21:53:59] <brson> graydon: no pref. what is the purpose of splitting the test suite, to spread it across more builders?
[21:54:11] <graydon> brson: yes
[21:54:12] *** Quits: Kruppe (user@moz-543303A0.cable.teksavvy.com) (Ping timeout)
[21:54:35] <graydon> brson: if you think it worthwhile, I think it'd be the easiest short term thing I can do, aside from random stabs at metadata or glue emitting.
[21:54:42] <graydon> maybe I'll go after glue / type_use
[21:54:48] <graydon> does anyone know their way around that code?
[21:54:52] <pcwalton> yes
[21:55:15] <graydon> any non-patricks :)
[21:55:29] <pcwalton> ugh, &const/paths bitrotted *again*
[21:55:30] <brson> graydon: it may be worth trying, but not sure that the cost of spinning up more parallel builders won't outweigh the savings of splitting up the tests
[21:55:46] <brson> 50% of the build is dedicated to just making the compiler
[21:56:06] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[21:56:13] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[21:56:28] *** Quits: dave1629 (dave@107C2269.1CA5FEA3.DDE5D3F6.IP) (Quit: dave1629)
[21:56:29] <brson> maybe we've still got hard ware spare though
[21:56:32] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[21:56:33] <pnkfelix> brson: well if nothing else it will address the concerns dherman was raising at the mtg.  As graydon said, Moore's law *should* apply trivially to the testsuite.
[21:56:35] <graydon> brson: on non-V, that's true. on V it's more like 30/70 compile/test
[21:56:47] <doomlord__> https://github.com/dobkeratops/geany/tree/rust <<< added some highlighting support to geany
[21:56:53] <graydon> but yeah. I would like to focus on compiler stuff if I can find anything I know how to do :(
[21:56:55] <erickt> graydon: you asked about doing a patent search on c#'s generator/await technology. As best as I can tell, Knuth talked about implementing coroutines with a state machine in The Art of Computer Programming. Unfortunately I don't have a copy to verify this though
[21:57:11] <strcat> erickt: they only have a patent on some flattening optimization
[21:57:13] <strcat> afaict
[21:57:58] <strcat> flattening nested iterators
[21:57:58] <erickt> strcat: hrm. Kind of like python 3.x's "yield from iterator"?
[21:58:03] *** Joins: rossm (rossm@moz-EE3BB1DC.br.br.cox.net)
[21:58:12] *** Joins: dave1629 (dave@107C2269.1CA5FEA3.DDE5D3F6.IP)
[21:58:13] <strcat> erickt: https://www.google.com/patents/US7937694 yes
[21:58:28] <strcat> it's too verbose to actually read
[21:58:28] <toddaaro> brson: oh, yea the idle callback is *stopped* which is what derefs the event loop
[21:58:33] <toddaaro> brson: it just isn't destructed
[21:58:34] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[21:58:50] <strcat> erickt: explains what a computer mouse is
[21:59:01] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[21:59:04] <erickt> heh
[21:59:05] <strcat> well an input device
[21:59:07] <strcat> ;p
[21:59:19] <strcat> they have to define 'computer
[21:59:50] <erickt> strcat: I wonder how that patent is different from http://www.python.org/dev/peps/pep-0380/
[22:00:01] <strcat> erickt: python doesn't flatten them though
[22:00:17] <strcat> C# actually turns it into a single state machine, rather than nested ones
[22:00:23] *** Quits: huseby (huseby@moz-4E8C421A.husebyhome.com) (Ping timeout)
[22:00:30] <strcat> at least afaict - it's really, really hard to read it without falling asleep
[22:00:32] <strcat> ;p
[22:00:36] <erickt> strcat: ah, neat, so like state machine inlining?
[22:00:39] <strcat> erickt: yeah
[22:00:59] <strcat> erickt: so they have a bunch of nested ones, and since they delegate to each other they can unwrap it all into one
[22:01:04] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[22:01:15] <strcat> python will still just have a bunch of generator objects and do context switches
[22:01:27] <pcwalton> again, please stop landing things that use explicit self type parameters
[22:01:31] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[22:01:33] <strcat> maybe pypy could be clever enough to optimize it optimistically
[22:01:38] <pcwalton> my patch has bitrotted for the 7th time because more stuff landed that uses this
[22:01:56] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[22:01:57] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/U_dOFw
[22:01:57] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[22:01:59] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[22:01:59] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/3schnw
[22:01:59] <ghrust> 13rust/06auto 14ef5d537 15Graydon Hoare: doc: add condition tutorial
[22:01:59] <ghrust> 13rust/06auto 143cd978f 15bors: auto merge of #8563 : graydon/rust/2013-08-16-condition-tutorial, r=catamorphism...
[22:02:00] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[22:02:06] <bblum> pcwalton: um, does this count? https://github.com/bblum/rust/commit/5796e9e
[22:02:22] <toddaaro> I think we need to get better at using priorities
[22:02:27] <pcwalton> that's fine
[22:02:39] *** Joins: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com)
[22:02:47] <graydon> pcwalton: what's an explicit self type parameter?
[22:02:47] <bblum> pcwalton: thanks
[22:03:09] <pcwalton> Local::take::<Scheduler>() is the usual culprit
[22:03:09] <strcat> toddaaro: like r+'ing a chain of known good ones? *shrug*
[22:03:18] <pcwalton> please write that as "let sched: ~Scheduler = Local::take();"
[22:03:35] <toddaaro> pcwalton: huh, what is wrong with that
[22:03:37] *** Quits: dcrewi (david@moz-AB8667CE.gyrae.net) (Ping timeout)
[22:03:43] <pcwalton> it is supplying Self
[22:03:54] <toddaaro> I guess I don't know what supplying Self means
[22:03:56] <pcwalton> that is no longer allowed
[22:03:58] <strcat> oh so that's a use case for type ascription
[22:04:16] <pcwalton> trait Local { fn take() -> Self { ... } }
[22:04:25] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[22:04:25] <pcwalton> it's supplying the explicit "Self" type parameter explicitly
[22:05:10] <erickt> strcat: I wonder if llvm can optimize inlining of state machines
[22:05:17] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[22:05:25] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[22:05:28] <strcat> erickt: with good alias analysis + llvm.invariant maybe
[22:05:32] <strcat> it really hates pointers.
[22:05:44] <erickt> strcat: I saw that at least in 2009 it bails on inlining when you use computed gotos
[22:05:50] <strcat> like it  was silly enough to add 2 compares to the iterator loop
[22:05:54] <strcat> vec iterators
[22:05:55] <SingingBoyo> is there something in the makefile to remove old versions of libstd/libextra/librusti etc?
[22:06:03] <strcat> because we didn't guarantee the offset was inbounds
[22:06:12] <strcat> so it thought it might wrap and become null
[22:06:23] <strcat> and since Option<&T> optimizes to null, the None check is a null check
[22:06:28] <strcat> so it left the check.
[22:06:29] <Seldaek> SingingBoyo: make uninstall I believe, but you probably have to run that *before* you make a new build
[22:06:35] <erickt> mozilla should hire one of the llvm devs to make it faster for rust :)
[22:06:45] <sully> ok, sigh
[22:06:53] *** Quits: dave1629 (dave@107C2269.1CA5FEA3.DDE5D3F6.IP) (Quit: dave1629)
[22:06:54] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[22:06:54] <sully> I am getting failures running the rustpkg tests
[22:07:00] <strcat> erickt: I don't think it would be that hard to start on TBAA
[22:07:19] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[22:07:27] <cmr> erickt: https://careers.mozilla.org/en-US/position/o3VZWfwD
[22:07:59] <erickt> cmr: that was fast!
[22:08:05] <erickt> lol
[22:08:08] <brson> lol
[22:08:11] <cmr> it has been there for a while
[22:08:17] <bjz> pcwalton: Is that because you're trying to merge `Local::<Scheduler>::take()`?
[22:08:21] <strcat> you know the really annoying thing about TBAA is that we have 20000 Loads ;[
[22:08:23] <erickt> the mozilla recruitment team is amazing!
[22:08:23] <cmr> "a while" being "more than a week"
[22:08:29] <strcat> need to go and update every Load/Store call to pass a ty
[22:08:33] <brson> the llvm opening is more emscripten-oriented than rust
[22:08:35] <ecr> brson: valgrind seems happy with the current version of the PR (run_in_newsched_task only). Converting uv/uvio.rs to run_in_mt_newsched_task and we'll see what happens.
[22:08:42] <pnkfelix> erickt: If you want to see Knuth's treatment of coroutines, you can basically find the updated version of that section in Fascicle 1, pages 66 â€” 72
[22:08:44] <strcat> and it's not always obvious which is the actual type without being familiar with it
[22:09:08] <strcat> although to_value_llval is one easy place to get
[22:09:10] <pnkfelix> erickt: see http://www.cs.utsa.edu/~wagner/knuth/ for a PDF download of Pre-Fascicle 1.  (the one labelled 1.3-4. MMIX)
[22:09:22] <erickt> pnkfelix: thanks!
[22:09:24] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[22:09:46] <brson> ecr: ok
[22:09:48] <pnkfelix> erickt:  its a prettyâ€¦ low-level treatment of the subject matter.  At the level of assembly language call sequence protocols.
[22:09:52] <toddaaro> brson: I don't see a way to close the idle callback without going through the event loop, and the only way to tell that it is safe to close the idle callback is to inspect the loop refcount
[22:09:59] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[22:10:23] <pnkfelix> erickt: (and I suspect its not actually going to be directly relevant to the subject matter at hand.)
[22:10:25] <toddaaro> brson: so the options are add bindings r viewing that and check every "pause", or just close normally and run the event loop again during cleanup
[22:10:25] <erickt> pnkfelix: yeah, I never quite managed to wrap my head around Knuth's assembly language
[22:10:33] <toddaaro> brson: the latter seems way easier
[22:10:40] <strcat> erickt: I have a good idea of how to do the TBAA stuff :P, the most annoying part is the build system
[22:10:45] <strcat> need to build a little C++ shim
[22:10:47] <strcat> for LLVM to load dynamically
[22:10:52] <strcat> so you need to put it in the right place
[22:10:54] <pnkfelix> erickt: Well MMIX is an improvement over MIX.  But its too big an instruction set for me to keep in my head.
[22:11:31] <strcat> + decide what we are ready to enforce
[22:11:34] <pnkfelix> erickt: anyway, Section 1.4.2 is dedicated to Coroutines.
[22:11:43] <erickt> strcat: hopefully we'll be able to shift over to rustpkg when tjc finishes it :)
[22:11:53] <strcat> yeah because I can't read our makefile *at all* :)
[22:12:05] <erickt> thanks for the pointers pnkfelix!
[22:12:15] <strcat> at least we don't have to build IR by hand
[22:12:20] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[22:13:17] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[22:13:26] <erickt> tjc: speaking of rustpkg, did you have plans to implement a central repository, ala cargo-central?
[22:15:01] <brson> toddaaro: i don't understand the problem here. what is going wrong?
[22:15:14] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[22:15:19] <toddaaro> brson: there is no reliable way to tell when it is time to close the idle callback
[22:15:32] <toddaaro> brson: so I figured we just clean it up when run returns, as that is easy to trigger
[22:15:39] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Connection reset by peer)
[22:15:47] <toddaaro> brson: but we can't do that after all, as a handle close requires a callback that fires in the loop
[22:15:51] *** Joins: josh_ (josh@moz-348C4790.hsd1.mn.comcast.net)
[22:16:40] <toddaaro> brson: so either we come up with a way to identify scheduler termination other than run returning, or we just call run a second time to run that close callback
[22:17:13] <toddaaro> I think I have a patch for the latter ready
[22:17:18] <brson> toddaaro: why is there not a reliable way to tell when it is time to close the idle callback?
[22:17:45] <toddaaro> brson: unless the async_callback total is zero, it isn't safe to shutdown
[22:17:49] <toddaaro> as we might need it again
[22:17:57] <toddaaro> but we can't see a count of outstanding async handles
[22:18:10] <toddaaro> we rely on the libuv provided refcounting for that
[22:18:36] <sully> sigh
[22:18:47] <sully> I pulled again, before diving in to diagnose my weird failure
[22:18:52] <sully> and llvm updated
[22:18:56] <sully> gonna be a while
[22:19:28] *** Joins: huseby (huseby@moz-4E8C421A.husebyhome.com)
[22:20:08] <strcat> the built-in TBAA is incredibly weird, you have to make a tree
[22:20:15] <strcat> so at least it could cover @ not aliasing ~
[22:20:32] <strcat> I'm not sure what else...
[22:20:39] <toddaaro> brson: I'm valgrinding the patch now, if it ever finishes I'll put up a PR
[22:20:46] <toddaaro> brson: or is there a better way
[22:20:52] * strcat has it outputting nodes
[22:21:29] <brson> toddaaro: this is a patch for the valgrind failures on master? is this seperate from the issue of closing the idle cb?
[22:21:36] <toddaaro> brson: no, same issue
[22:21:39] <strcat> 'A type is considered to alias all of its descendants and all of its ancestors in the tree.'
[22:21:53] <strcat> well figuring out how to make a bug-free alias tree is going to be a fun problem
[22:21:55] <strcat> ;p
[22:22:00] <erickt> strcat: is the TBAA api exposed in llvm-c? If so, maybe we could implement the library in rust
[22:22:10] <strcat> erickt: it's just the metadata API
[22:22:22] <strcat> LLVMSetMetadata + LLVMMDNodeInContext
[22:22:32] <strcat> erickt: you actually don't necessarily need to make a pass
[22:22:39] <strcat> if we can make the existing tbaa pass work for us
[22:23:03] <strcat> it doesn't seem like it's a great fit though
[22:23:09] <strcat> it can't express &mut not aliasing &mut, for example
[22:23:37] <strcat> it can express ~ not aliasing @, you make 1 branch with ~ types and another with @
[22:24:02] <strcat> also can't express ~ not aliasing other ~, and that's important
[22:24:54] *** Joins: mib_1d77lo (Mibbit@7F8F4F4.41876DEC.DFAB1F33.IP)
[22:25:10] *** Quits: Sergio965 (sergiobz@moz-BB21156B.dynamic.csail.mit.edu) (Ping timeout)
[22:25:15] <brson> toddaaro: i still don't see the full picture here. why is valgrind failing?
[22:25:20] <tjc> erickt: Not sure yet
[22:25:33] <strcat> erickt: If the third field is present, itâ€™s an integer which if equal to 1 indicates that the type is â€œconstantâ€ (meaning pointsToConstantMemory should return true
[22:25:36] <strcat> now *that* is useful.
[22:25:44] <strcat> that can actually express all of our & guarantees
[22:25:48] <strcat> for T: Freeze
[22:26:09] <strcat> but that's the hardest thing to fix in our unsafe blocks ;p
[22:27:40] *** Joins: dcrewi (david@moz-AB8667CE.gyrae.net)
[22:28:12] <toddaaro> brson: I'm pretty sure it is failure to call delete on the idle callback handle
[22:28:42] <toddaaro> brson: because the close() call was after the loop returned, so the callback never went
[22:28:54] <toddaaro> but a handful of tests are still leaking, so I'm looking into it more
[22:28:59] *** Quits: marc (marc@E31B39DA.F9D61A8.416A0103.IP) (Quit: leaving)
[22:29:50] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Client exited)
[22:29:57] *** Quits: mib_1d77lo (Mibbit@7F8F4F4.41876DEC.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:30:02] *** Joins: marc (marc@E31B39DA.F9D61A8.416A0103.IP)
[22:30:10] *** Joins: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[22:30:52] *** Joins: tcr_ (tcr@D26BCFC9.C2203064.EDCE493E.IP)
[22:30:52] *** Quits: tcr (tcr@D26BCFC9.C2203064.EDCE493E.IP) (Connection reset by peer)
[22:32:18] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[22:33:19] *** Quits: josh_ (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh_)
[22:33:34] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[22:34:02] <brson> toddaaro: I didn't realize close was called after the scheduler runs. Yeah that's not going to work. It's not what I expected, nor did I think that `stop` would deref the event loop, but apparently it does.
[22:34:56] *** Quits: hjr3 (hradtke@374E545A.3A8E9B0C.F9D9C60E.IP) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[22:35:36] <toddaaro> brson: my patch seems to work in almost all the cases, I think the failures are when we never call run on the scheduler
[22:36:13] <toddaaro> brson: so I should be able to shuffle the initialization into bootstrap and add another option and be done
[22:37:27] *** Quits: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net) (Ping timeout)
[22:39:27] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[22:41:04] <bblum> hmm
[22:41:30] <bblum> it occurs to me that the && operator is redundant with nested if blocks, but the || operator cannot be expressed alternatively
[22:41:35] <bblum> i dunno why i never realized that before
[22:42:07] <toddaaro> well, you can express it with not right
[22:42:16] <ecr> yeah, apply DeMorgan
[22:42:27] <graydon> nmatsakis: ping
[22:42:29] <bblum> however, ! can also not be expressed alternatively
[22:42:40] <cmr> bblum: else?
[22:42:43] <pnkfelix> bblum: do nested if blocks not include else?
[22:42:50] <bblum> you are allowed to use else
[22:42:51] <bblum> however
[22:42:58] <bblum> what i mean is say you have a piece of logic foo(), and you want to avoid writing foo() twice
[22:43:20] <bblum> you can't write if a || b { foo() } without using || without writing foo() twice
[22:43:20] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[22:43:42] <ecr> if !a && !b { foo() }
[22:44:03] <bblum> that's not the same
[22:44:07] <ecr> of course it is
[22:44:14] <ecr> it's just DeMorgan's law
[22:44:30] <bblum> you have missed a step
[22:44:33] <toddaaro> brson: ok, patch is ready, what is preferred delivery method in this situation?
[22:44:38] *** Quits: tjc (tjc@moz-A138B67E.lightspeed.sntcca.sbcglobal.net) (Quit: zzzzzzzzzz)
[22:44:42] <bblum> what you wrote is the same as if !(a || b)
[22:44:50] <ecr> oh right
[22:45:11] <ecr> so it's just if !a && !b { nop } else { foo() }
[22:45:11] <toddaaro> brson: shifted initialization into bootstrap via optioning the spot, added a second call to sched.run() that just processes the shutdown callback and returns immediately
[22:45:38] <bblum> ecr: alright, well, ok, you can write "if !(!a && !b) { foo() }"
[22:45:49] <ecr> that works too
[22:45:54] <myname> that's pretty ugly
[22:45:56] <bblum>  i guess what i mean is, you can't rephrase it to use *no* logical operators
[22:46:01] <bblum> and just control flow
[22:46:02] <cmr> bblum: not the point :P
[22:46:06] <cmr> erm, @myname
[22:46:49] <bblum> whereas you can write "if a && b { foo() }" as "if a { if b { foo() } }"
[22:47:03] *** Joins: josh (josh@moz-348C4790.hsd1.mn.comcast.net)
[22:47:06] <ecr> hm
[22:47:20] *** Quits: josh (josh@moz-348C4790.hsd1.mn.comcast.net) (Quit: josh)
[22:47:23] <myname> why should you want to do that with ||?
[22:47:24] <ecr> well you can get not from the else branch
[22:47:26] *** Quits: igl (igl@moz-6C3168E1.adsl.alicedsl.de) (Ping timeout)
[22:47:34] <ecr> and && + ! is boolean-complete
[22:47:40] <ecr> so you should be able to encode ||
[22:47:45] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[22:47:53] <bblum> ecr: if you allow yourself to duplicate foo()
[22:47:55] <myname> ecr: you are, but you need to have 2 foo()s
[22:47:55] <cmr> not without duplicating the expression, is his point
[22:48:02] <ecr> oh
[22:48:07] *** Joins: igl (igl@moz-FEE0DC16.adsl.alicedsl.de)
[22:48:25] <myname> what's the problem with using ||? that what it's for
[22:48:35] <bblum> myname: well, for example, here i have an enormous line of code "if very_long_a || very_long_b { foo() }"
[22:48:36] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[22:48:45] <bblum> and i would rather reflow it onto multiple lines
[22:48:59] <bblum> but i don't like putting line breaks next to connectives if i can avoid it
[22:49:15] <ecr> use shorter names then
[22:49:28] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[22:49:33] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[22:49:33] <toddaaro> brson: commit pushed to my idle-opt+cleaning branch
[22:49:34] <myname> i won't make that with nested ifs in case of && tbh
[22:49:48] *** Quits: igl (igl@moz-FEE0DC16.adsl.alicedsl.de) (Ping timeout)
[22:49:55] *** Joins: igl (igl@moz-FADE4594.adsl.alicedsl.de)
[22:50:01] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[22:50:02] <olsonjeffery> brson graydon : https://github.com/mozilla/rust/pull/8655
[22:50:23] <cmr> olsonjeffery: you won the race!
[22:50:41] <pcwalton> src/rustllvm/RustWrapper.cpp: In function â€˜void LLVMRustAddPrintModulePass(LLVMOpaquePassManager*, LLVMOpaqueModule*, const char*)â€™:
[22:50:46] <cmr> actually no you didn't.
[22:50:49] <pcwalton> src/rustllvm/RustWrapper.cpp:46: error: â€˜llvm::sys::fsâ€™ has not been declared
[22:50:51] <olsonjeffery> eh heh heh
[22:51:45] *** Joins: jclements (jclements@moz-37891906.dsl.snlo01.pacbell.net)
[22:52:00] <pcwalton> any ideas?
[22:52:05] <graydon> olsonjeffery: \o/
[22:52:15] <ecr> olsonjeffery: woo!
[22:52:39] <bblum> CRUD functionality!
[22:53:34] <toddaaro> https://github.com/mozilla/rust/pull/8656 PR to fix the valgrind failure in master
[22:54:44] *** Joins: engla (engla@moz-9B69FE7C.selucle.dyn.perspektivbredband.net)
[22:54:46] *** Quits: maik_ (maik___@moz-31CCDD8A.dip0.t-ipconnect.de) (Ping timeout)
[22:57:36] <pcwalton> graydon: r? https://github.com/mozilla/rust/pull/8657
[22:57:55] <toddaaro> did we really put up three new PRs in a 5 period
[22:58:01] <toddaaro> s/5/5m
[22:58:08] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[22:58:52] <graydon> olsonjeffery: I'm not entirely sure about the seek/tell stuff but it looks great!
[22:59:13] <brson> toddaaro: thanks. I r+'d. We can do this better eventually though. I talked with tjfontaine in #libuv and he clarified my understanding of how handle refs work. I thought that handles maintained an event loop ref while they were alive, but actually handles have their own ref count that can increase or decrease during the life of the handle, so handles can be dereffed to zero and cause the event loop to exit
[22:59:29] <brson> toddaaro: in the case of idle `stop` and `close` are actually the exact same thing - deref and call a callback
[22:59:36] <olsonjeffery> graydon: yeah. libuv was built with concurrent readers/writers in mind so they don't expose any seek/tell functionality
[22:59:39] <graydon> pcwalton: there's some other stuff in that PR, but I think it's all r+'ed already?
[22:59:42] <toddaaro> brson: hmm interesting
[22:59:43] <pcwalton> yes it is
[22:59:49] <toddaaro> brson: I'll hop over and read that in my scrollback
[22:59:56] <brson> toddaaro: our `close` operations in the bindings are conflated with `delete` though, so `close` means 'deref and destroy'
[23:00:01] <cmr> 10% win or so for small crates.
[23:00:02] <cmr> nice!
[23:00:07] <olsonjeffery> but we have the raw fd.. so i used lseek(2) in the *libuv impl* .. so that detail wouldn't neccesarily apply to other impls in other io frameworks
[23:00:10] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[23:00:13] <olsonjeffery> its just that libuv is set up that way, so it's what i did
[23:00:22] <cmr> that's already beating the perf win from using lz4
[23:00:23] <olsonjeffery> dunno if lseek is in mingw..
[23:00:37] <brson> toddaaro: we can potentially seperate close and delete in the bindings so that we can destroy the idle handle without re-pumping the event loop
[23:00:41] <brson> but nbd right now
[23:00:49] <graydon> pcwalton: r+ thanks
[23:01:39] <olsonjeffery> graydon: the only other alternatives are: keeping cursor state internal in the UvFileStream and having all reads/writes be positional or fail!()'ing any calls to the Seek trait on FileStream..
[23:01:43] <graydon> olsonjeffery: interesting. so .. should we just not seek-on-fds at all, and only hold the position in our own code? I can't quite tell if that's what your PR does
[23:01:58] <graydon> ah, yeah, that was what I was thinking. maybe we should keep cursor ourselves.
[23:01:59] <olsonjeffery> graydon: i punted to libc on seek/tell
[23:02:02] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[23:02:04] <graydon> mhm
[23:02:29] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[23:02:37] <toddaaro> brson: ok, great
[23:03:03] <toddaaro> brson: I don't like how this fix works, so knowing that it will be less ugly in the future is wonderful
[23:03:18] *** Quits: Flibo (Flibo@moz-40397852.org.aalto.fi) (Ping timeout)
[23:03:21] *** Joins: Flibo (Flibo@moz-40397852.org.aalto.fi)
[23:03:30] <toddaaro> brson: the other thing I've been working on, the singleton async callbacks, are really tricky
[23:03:42] <enix> how can I get rustc to print out a debug!()? Does -Z verbose do that?
[23:04:09] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[23:04:24] <acrichto> enix: pass --cfg debug to rustc
[23:04:26] <pnkfelix> enix: 1. Make sure you built with â€”enable-debug, 2. Use RUST_LOG=rustc ?
[23:04:43] <enix> ah, cool, thanks
[23:05:06] <pnkfelix> enix: (I guess I'm not clear on whether you're trying to see debug! output from rustc's own source, or from code that rustc is compiling)
[23:05:33] <enix> ah, i'm trying to see debug! from rustc's own source
[23:05:39] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[23:05:39] *** Quits: aatch (aatch@moz-B437F499.pocketrent.com) (Ping timeout)
[23:05:59] <enix> i'm attempting to figure out why #[simd] types can't be static variables
[23:06:28] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[23:06:48] <cmr> enix: --enable-debug to the configure script does it
[23:06:49] <toddaaro> brson: I think what I'm going to do is scale way back on the goal for now and move on. The issue, again, is the shutdown process. It just gets really finicky as suddenly there is no simple "just close when the handles are all gone" as there is one permanent handle inside the sched struct and the others are just copies. So games need to be played to identify when to destruct that "origin" callback and make sure the scheduler receives a signal that it must d
[23:06:56] <toddaaro> brson: blah, that probably chopped
[23:06:57] <enix> ok, cool, thanks all
[23:07:00] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Ping timeout)
[23:07:13] <cmr> enix: is it a compiler error, ICE, runtime failure?
[23:07:25] <brson> toddaaro: "signal that it must d" -
[23:07:34] <enix> just a normal compiler error: function calls in constants are limited to struct and enum constructors
[23:07:45] *** Joins: aatch (aatch@moz-B437F499.pocketrent.com)
[23:07:52] <toddaaro> brson: it must do so. I think I have the dance restricted to something fairly  simple, but as a result I think the performance actually got *worse* than it was before. So I'm just going to table it and make the  async-optimization for now be a stored sleeper handle so we do a little less work there.
[23:07:56] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[23:08:11] <cmr> ahhh that isn't going to be fun to fix
[23:08:12] *** Quits: threecreepio (jdp@moz-71E164C9.cust.bredbandsbolaget.se) (Quit: threecreepio)
[23:08:28] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[23:08:37] <cmr> contexprs/const checking is hairy, as will be figuring out why it thinks there is a non-constructor function call
[23:08:44] <toddaaro> brson: if we get the hang of the libuv refcounting stuff a better approach will likely appear, hopefully making this somewhat easy
[23:08:46] <cmr> jensnockert and sanxiyn have touched that code
[23:08:55] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[23:10:35] <toddaaro> brson: my plan for the last three days is going to be the chase-lev
[23:11:19] <olsonjeffery> woo chase-lev
[23:11:35] <enix> ah, ok. yeah, i don't understand that code at all. its unclear to me why the simd types don't count as structures. I figured i'd poke at it for a bit and if I get no where i'll open up an issue
[23:12:43] <bblum> brson: i believe i have figured out a way to fix the cleanup-job-vs-killer race that you will approve of; i am working on it presently
[23:13:01] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[23:13:35] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[23:13:37] <jmgrosen> any progress on file io in the new runtime yet?
[23:13:53] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Quit: Leaving.)
[23:14:28] *** Joins: igl1 (igl@moz-184377F8.adsl.alicedsl.de)
[23:14:38] <cmr> jmgrosen: olsonjeffery just sent the PR
[23:14:56] *** Quits: igl (igl@moz-FADE4594.adsl.alicedsl.de) (Ping timeout)
[23:15:00] <jmgrosen> cmr, oh, wow, awesome!
[23:15:57] <jmgrosen> "Because libuv explicitly does not support seek/tell" why doesn't it?
[23:16:14] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[23:17:01] <Luqman> enix: do you have an example? this seems to work https://gist.github.com/luqmana/6288561
[23:17:42] <kmc> do only trait impls end up named like ::__extensions__::, or also normal methods?
[23:18:15] <brson> acrichto olsonjeffery: thanks for all the I/O! It feels like Christmas, and I will review this as soon as I can.
[23:18:31] *** Quits: thesnowdog (doug@9842E8BA.8E46834.6F17036B.IP) (Ping timeout)
[23:18:39] *** Quits: igl1 (igl@moz-184377F8.adsl.alicedsl.de) (Ping timeout)
[23:18:45] *** Joins: igl (igl@moz-7EEA338D.adsl.alicedsl.de)
[23:19:07] <sully> hm, wtf
[23:19:16] <sully> rustpkg stuff is failing locally for me
[23:19:18] <brson> toddaaro: k. looking forward to the chase-lev deque
[23:19:21] <sully> is this happening to anybody else?
[23:19:28] <brson> bblum: beautiful
[23:19:33] <acrichto> brson: :) it looks like olsonjeffery knows more about what he's doing with I/O, so feel free to review that first and then I'll try to clone as much as possible style-wise back into processes
[23:20:03] <enix> Luqman: this doesn't work for me: https://gist.github.com/DaGenix/6288591
[23:20:16] <enix> the only difference seems to be that i'm using a pre-defined simd type from std::unstable::simd
[23:21:33] *** Quits: brendan (brendaneic@moz-78B60485.public.wayport.net) (Quit: brendan)
[23:21:34] <Luqman> enix: odd
[23:21:40] <enix> yeah, it works fine if I declare the #[simd] type at the top of the file; fails if i try to use one from std.
[23:21:58] <enix> well, it fails because check_const thinks that the structure constructor is a function
[23:22:06] *** Quits: igl (igl@moz-7EEA338D.adsl.alicedsl.de) (Ping timeout)
[23:22:12] <enix> my guess is that that has to do with how type constructors are exported between crates
[23:22:20] *** Joins: igl (igl@moz-A5A2141C.adsl.alicedsl.de)
[23:22:45] <enix> well, structure constructors
[23:23:56] <olsonjeffery> ecr: how far are you from a homing io PR?
[23:24:37] <olsonjeffery> nm i see #8631
[23:24:46] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Quit: Leaving.)
[23:25:25] <ecr> olsonjeffery: yeah, figuring out some deadlocking issues
[23:25:42] <ecr> actually I think I just found one (might be what's causing them all)
[23:25:44] <ecr> brson: ping
[23:26:31] *** Quits: SingingBoyo (brandon@4DF3381A.51F4D838.4F048BDC.IP) (Ping timeout)
[23:26:36] <brson> ecr: pong
[23:27:44] *** Joins: igl1 (igl@moz-3042A17A.adsl.alicedsl.de)
[23:27:53] <ecr> brson: looks like at least one of the deadlocks (uvio::test_read_read_read) is from the client trying to connect before the server starts listening and stops with an error. server just tries to accept forever.
[23:27:59] <sully> hey, just submitted a PR fixing a handful of minor default method problems
[23:28:06] <sully> could somebody take a look: https://github.com/mozilla/rust/pull/8659
[23:28:11] *** Quits: igl (igl@moz-A5A2141C.adsl.alicedsl.de) (Ping timeout)
[23:28:26] <olsonjeffery> ecr brson: i noticed a bunch of those server/client tests did `do spawn {}` one right after another and went hmm..
[23:28:32] <brson> ecr: aha! yeah that makes sense. some of those single threaded tests depend on the scheduler scheduling tasks in a specific order
[23:28:40] <brson> bad hazard
[23:28:42] <ecr> yep
[23:29:02] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[23:29:08] <brson> ecr: we're going to need multithreaded server tests though. is there an obvious way to restructure this kind of test
[23:29:22] <ecr> we could probably just solve it by having the client loop on trying to connect until it succeeds
[23:29:24] *** Quits: igl1 (igl@moz-3042A17A.adsl.alicedsl.de) (Ping timeout)
[23:29:27] *** Joins: igl (igl@moz-C8D56603.adsl.alicedsl.de)
[23:29:54] <ecr> or make a one shot channel that the server sends a token to the client once it's set up
[23:30:03] <ecr> so the client doesn't try to connect until the server is ready
[23:30:08] <brson> ecr: ok. i'm convinced this is the problem. I'm going to re-r+ your pr with priority while you think about it more
[23:30:13] <brson> ecr: yeah, the pipe solution sounds good
[23:30:17] <brson> thanks
[23:30:21] <ecr> yep :)
[23:30:23] <toddaaro> yea, pipes are great for this
[23:30:27] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[23:30:28] <toddaaro> I do that in a few places to order initialization
[23:31:11] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[23:33:13] *** Quits: glennsl (textual@moz-5D7B804F.getinternet.no) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[23:33:38] <sully> graydon: the buildbots run the full "make check", right? including the rustpkg stuff?
[23:33:44] <graydon> sully: yes
[23:33:54] <sully> ok, hm....
[23:34:13] <sully> I am having one of the rustpkg tests fail on master and am baffled
[23:34:25] <cmr> could be spurious?
[23:34:32] <sully> happens every time
[23:34:37] <cmr> ok, probably not then!
[23:34:46] *** Joins: brendan (brendaneic@moz-68B19832.public.wayport.net)
[23:35:01] <toddaaro> is make check supposed to rebuild llvm?
[23:35:02] <sully> yeah :P
[23:35:07] <sully> toddaaro: when llvm gets updated
[23:35:18] *** Quits: igl (igl@moz-C8D56603.adsl.alicedsl.de) (Ping timeout)
[23:35:25] <toddaaro> hm, I don't think llvm version changed but away it went rebuilding
[23:35:30] *** Joins: igl (igl@moz-63733429.adsl.alicedsl.de)
[23:35:33] <toddaaro> I guess it was probably right
[23:35:39] <sully> did you recently pull?
[23:35:46] <sully> there was an llvm change in the last day or two, it seems
[23:36:23] *** Quits: orshem (orshem@C5E06B1E.A5B6B765.E3D28531.IP) (Quit: Leaving)
[23:36:57] <toddaaro> maybe that is doing it
[23:37:08] <toddaaro> I was perplexed as I built check-stage0-std a few times without it doing this
[23:38:14] *** Quits: engla (engla@moz-9B69FE7C.selucle.dyn.perspektivbredband.net) (Ping timeout)
[23:39:49] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[23:42:02] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[23:42:02] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/3schnw
[23:42:02] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[23:42:43] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Client exited)
[23:43:05] *** Joins: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com)
[23:44:45] *** Quits: wilmoore (wilmoore@moz-7EE4D9D6.mystrotv.com) (Ping timeout)
[23:47:58] <sully> sigh
[23:48:06] <sully> one of the things I don't like about rust being agressively multithreaded
[23:48:10] <sully> is that it is hard to strace
[23:49:09] <bblum> RUST_THREADS=1 ?
[23:50:19] <sully> is that still a thing?
[23:50:24] <bblum> yeah
[23:50:48] <sully> well, it is not a thing that seems to result in their actually not being any threads created :P
[23:50:54] <bblum> there
[23:51:01] <sully> christ.
[23:51:08] <ecr> brson: hm. so now the server sends on a oneshot pipe after setting up the listener and the client doesn't do anything until it recvs on the pipe, but I'm still getting a deadlock from a ConnectionRefused on this test. looks like it's time to dig back into the rtdebug messages.
[23:51:12] * sully bad
[23:51:22] <bblum> odd, i thought that forbade any thread forks at all
[23:51:33] <bblum> it certainly should make there only be one scheduler though
[23:52:01] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[23:52:01] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/BrzpaA
[23:52:01] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[23:52:03] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[23:52:03] <ghrust> 01[13rust01] 15bors pushed 10 new commits to 06auto: 02http://git.io/7a1dOw
[23:52:03] <ghrust> 13rust/06auto 14b08a4b0 15Patrick Walton: librustc: Remove `&const` and `*const` from the language....
[23:52:03] <ghrust> 13rust/06auto 14d8d8c54 15Patrick Walton: librustc: Add support for type parameters in the middle of paths....
[23:52:03] <ghrust> 13rust/06auto 14ea64d18 15Patrick Walton: librustc: Ensure that type parameters are in the right positions in paths....
[23:52:03] <Luqman> er, so i passed --enable-debug to configure am I missing something to see debug! messages ?
[23:52:05] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[23:53:03] <brson> ecr: I think the listener doesn't begin accepting until the first call to `accept`, so if you are doing `Listener::new(), send(), accept()`, then the server isn't actually set up yet
[23:53:04] <kmc> you need to pass --cfg debug to rustc (maybe that configure flag arranges it) and you also need to name the crates/modules in the RUST_LOG environment variable
[23:53:17] <kmc> run your program with RUST_LOG=? to see the available modules
[23:53:22] <ecr> brson: ah right. derp
[23:53:27] <brson> ecr: maybe the Listener should start listening immediately after creation, or there should be an explicit `listen`
[23:53:32] <brson> probably the latter
[23:53:41] <ecr> explicit listen sounds better
[23:53:43] <brson> or maybe there's some missing design element here not sure
[23:54:25] <brson> Listener is awfully stateful. Ideally it would give you a new type after `listen`, but that kind of typestatey API is kind of daring
[23:54:43] <ecr> hm
[23:54:48] *** Quits: kimundi (kimundi@moz-53B106B9.dip0.t-ipconnect.de) (Ping timeout)
[23:55:06] <ecr> I'll ponder it for a bit and get back to you
[23:55:20] *** Joins: ofeldt- (ofeldt@moz-390582E3.dip0.t-ipconnect.de)
[23:55:59] <Luqman> kmc: nope, still nothing
[23:56:05] *** Quits: ofeldt (ofeldt@moz-1BA89DD9.dip0.t-ipconnect.de) (Ping timeout)
[23:57:29] <pcwalton> Undefined symbols:
[23:57:29] <pcwalton>   "_set_curterm", referenced from:
[23:57:30] <pcwalton>       terminalHasColors(int)   in libLLVMSupport.a(Process.o)
[23:57:31] <pcwalton> wat
[23:58:00] *** Quits: relrod (relrod@moz-AABB5D31.redhat.com) (Ping timeout)
[23:59:12] <acrichto> pcwalton: I saw that a few times, if you rebuild llvm once or twice or maybe a reconfigure it goes away, not sure why it comes up :(
[23:59:23] <acrichto> make clean-llvm will definitely make it go away
[23:59:55] <pcwalton> ok
