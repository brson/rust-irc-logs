[00:16:31] *** Joins: aatch (james@moz-4tpcve.pd7t.fvcm.e000.2406.IP)
[00:40:00] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[01:11:30] *** Joins: unwound (bkoropoff@moz-kthi5c.wa.comcast.net)
[01:43:01] <unwound> nmatsakis: ping
[02:09:07] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[02:38:38] *** Quits: zz_kimundi (kimundi@moz-cie3b9.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:40:13] *** Joins: zz_kimundi (kimundi@moz-j9v5l3.dip0.t-ipconnect.de)
[02:40:15] *** zz_kimundi is now known as kimundi
[02:53:09] *** Joins: brson (brson@moz-nr3.c9m.56.172.IP)
[02:53:09] *** ChanServ sets mode: +qo brson brson
[03:48:28] *** Joins: quantheory (quantheory@moz-dsb104.crel.jtvf.0001.2601.IP)
[04:02:58] *** Joins: Unwound_ (bkoropoff@moz-kthi5c.wa.comcast.net)
[04:04:17] *** Quits: unwound (bkoropoff@moz-kthi5c.wa.comcast.net) (Ping timeout: 121 seconds)
[04:07:47] *** Unwound_ is now known as unwound
[04:57:40] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[05:20:48] *** c74d3 is now known as c74d
[05:37:11] *** Quits: brson (brson@moz-nr3.c9m.56.172.IP) (Quit: leaving)
[05:46:22] *** Joins: p1start (p1start@moz-nftjhe.org)
[06:08:07] *** Joins: Unwound_ (bkoropoff@moz-kthi5c.wa.comcast.net)
[06:09:22] *** Quits: unwound (bkoropoff@moz-kthi5c.wa.comcast.net) (Ping timeout: 121 seconds)
[06:25:27] *** Unwound_ is now known as unwound
[06:48:51] *** Quits: quantheory (quantheory@moz-dsb104.crel.jtvf.0001.2601.IP) (Quit: Leaving)
[07:15:13] *** Quits: doener (bs@moz-c061a3.saltation.de) (Quit: leaving)
[07:30:46] *** Joins: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net)
[07:30:46] *** ChanServ sets mode: +o pnkfelix
[07:36:26] *** Quits: unwound (bkoropoff@moz-kthi5c.wa.comcast.net) (Ping timeout: 121 seconds)
[08:15:38] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[08:26:19] *** Joins: bstrie (ben@moz-avu3ju.members.linode.com)
[09:16:30] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Quit: Leaving.)
[09:24:35] *** Quits: blank_name (blank_name@moz-sct.ivp.36.50.IP) (Ping timeout: 121 seconds)
[09:25:36] *** Joins: blank_name (blank_name@moz-sct.ivp.36.50.IP)
[09:44:44] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Ping timeout: 121 seconds)
[10:14:14] *** Joins: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP)
[10:14:14] *** ChanServ sets mode: +o pnkfelix
[11:30:48] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[13:20:48] *** Joins: arielb1 (Mibbit@moz-2l2rdl.tau.ac.il)
[13:20:52] <arielb1> nmatsakis: ping
[13:37:36] *** Quits: arielb1 (Mibbit@moz-2l2rdl.tau.ac.il) (Quit: http://www.mibbit.com ajax IRC Client)
[14:00:31] *** Quits: nrc (nrc@moz-4bhi2i.xtra.co.nz) (Ping timeout: 121 seconds)
[14:13:34] *** Quits: [o__o] ([o__o]@moz-4s2t5k.compute-1.amazonaws.com) (Ping timeout: 121 seconds)
[14:43:15] *** Joins: Rym (y@moz-g4dip9.range86-187.btcentralplus.com)
[14:53:05] *** Joins: mkpankov (mkpankov@moz-hej.971.220.91.IP)
[14:59:10] *** Joins: AndChat|17289 (mkpankov@moz-crg.70f.16.195.IP)
[15:02:05] *** Quits: mkpankov (mkpankov@moz-hej.971.220.91.IP) (Ping timeout: 121 seconds)
[15:02:26] *** Quits: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP) (Connection closed)
[15:03:09] *** Quits: AndChat|17289 (mkpankov@moz-crg.70f.16.195.IP) (Quit: Bye)
[15:18:29] *** Joins: arielb1 (Mibbit@moz-lcu.ri7.19.46.IP)
[15:20:26] <arielb1> nmatsakis: ping
[15:22:56] *** Quits: flaper87 (flaper87@moz-fnn.1e9.132.209.IP) (Ping timeout: 121 seconds)
[15:23:26] *** Joins: unwound (bkoropoff@moz-kthi5c.wa.comcast.net)
[15:26:37] *** Joins: flaper87 (flaper87@moz-fnn.1e9.132.209.IP)
[15:26:50] *** Quits: arielb1 (Mibbit@moz-lcu.ri7.19.46.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[15:52:23] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[15:52:58] *** Quits: unwound (bkoropoff@moz-kthi5c.wa.comcast.net) (Quit: Ex-Chat)
[16:03:18] *** Quits: Rym (y@moz-g4dip9.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[16:07:22] *** Joins: Rym (y@moz-g4dip9.range86-187.btcentralplus.com)
[16:11:07] *** Joins: bombless (_@moz-sjpreg.0v2u.0v40.0da8.2001.IP)
[16:18:37] *** Joins: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP)
[16:18:37] *** ChanServ sets mode: +o pnkfelix
[16:32:46] *** Joins: arielb1 (Ariel@moz-9minqr.red.bezeqint.net)
[16:45:03] *** Quits: Rym (y@moz-g4dip9.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[16:50:41] *** Joins: [o__o] ([o__o]@moz-4s2t5k.compute-1.amazonaws.com)
[17:02:37] *** Quits: pnkfelix (pnkfelix@moz-6v5.3nd.202.89.IP) (Ping timeout: 121 seconds)
[17:03:56] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[17:12:09] *** Joins: apoelstra (username@moz-pvbasl.net)
[17:12:26] *** Joins: Rym (y@moz-g4dip9.range86-187.btcentralplus.com)
[17:14:02] <apoelstra> from a syntax extension, can i iterate over all the #[test] functions in the current mod and submodules?
[17:16:40] *** Quits: Rym (y@moz-g4dip9.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[17:17:33] *** Quits: bombless (_@moz-sjpreg.0v2u.0v40.0da8.2001.IP) (Quit: Leaving)
[17:20:19] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[17:27:01] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[17:27:01] *** ChanServ sets mode: +qo brson brson
[17:39:27] <sfackler> apoelstra: look at the AST folder that libsyntax/test.rs uses: https://github.com/rust-lang/rust/blob/master/src/libsyntax/test.rs#L101
[17:42:53] <apoelstra> thx
[17:43:16] <apoelstra> also, does it sound right that i've gotta clone a bajillion things to modify the AST "in-place" because of all the ast::P's?
[17:46:59] <apoelstra> err syntax::ptr::P
[17:55:41] <nmatsakis> arielb1: pong
[17:56:21] <arielb1> nmatsakis: I think I found a bug in freshen
[17:56:26] <arielb1> gh24353
[17:56:31] <arielb1> wrong bug
[17:56:40] <arielb1> gh24352
[17:56:55] <arielb1> freshen turns both IntVid and FloatVid into FreshIntTy
[17:57:00] <arielb1> but there is no subtype relationship
[17:58:16] *** Joins: Rym (y@moz-g4dip9.range86-187.btcentralplus.com)
[17:59:25] <arielb1> I mean, the rule is that φ(freshen(T), U_1 .. U_n) = φ(T, U_1 .. U_n), for every property φ and types U_1 .. U_n that don't share inference variables with T
[17:59:50] <arielb1> but IntVar does not unify with f64
[17:59:54] <arielb1> and FreshIntTy does
[18:00:14] <nmatsakis> arielb1: yes, I follow. I'm pondering; might be that the bug is actually a bit bigger than that.
[18:00:26] <nmatsakis> the question isn't so much whether there is a subtyping relationship between them
[18:00:36] <nmatsakis> as it is whether they unify 
[18:00:49] <nmatsakis> that is, whether those type variables
[18:00:58] <nmatsakis> would unify under the same conditions
[18:01:15] <nmatsakis> ah, well, no I guess the other cases work ok
[18:01:27] <nmatsakis> in particular I was concerned about
[18:01:30] <nmatsakis> FreshTy in general
[18:01:44] <nmatsakis> that is, you could have two ty_infer that are "entangled" -- meaning that we know that $0 <: $1, but not what $0 and $1 are
[18:01:52] <nmatsakis> so when we instantiate one of them
[18:01:56] <nmatsakis> it indirectly instantiates the other
[18:02:06] <nmatsakis> I think there IS a latent bug in freshen I've been meaning to make a test case for
[18:02:11] <nmatsakis> that this entanglement is not represented
[18:02:32] *** Quits: Rym (y@moz-g4dip9.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[18:02:35] <nmatsakis> i.e., if you have Foo<$0,$1>
[18:02:43] <nmatsakis> and we know that $0 <: $1
[18:02:49] <nmatsakis> then Foo<i32,u32> would fail to unify
[18:03:00] <nmatsakis> but Foo<$2,$3> (where $2,$3 are not entangled)
[18:03:03] <nmatsakis> would succeed to unify
[18:03:26] <nmatsakis> this matter of FreshIntTy/Float is a similar case
[18:04:04] *** Joins: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net)
[18:04:05] *** ChanServ sets mode: +o pnkfelix
[18:04:13] <nmatsakis> i've been wanting to revisit the caching strategy, actually, and see whether we'd be better off trying to do something more narrow but optimizing the way that we traverse impls
[18:04:20] <nmatsakis> (for example forming a decision tree based on the simplifed types)
[18:04:41] <nmatsakis> (well, not just a tree, we'd want hashing too)
[18:05:39] <nmatsakis> in any case, I agree with you that in this particular case, introducing a FreshFloatTy would fix it
[18:07:03] <arielb1> what's the deal with the caching strategy?
[18:11:14] <arielb1> nmatsakis: now you have made traits invariant
[18:11:20] <arielb1> I don't think you can get subtyping
[18:20:05] <nmatsakis> arielb1: sorry, it's not so much about subtyping due to the trait matching, as it is that the way our unifier works you can wind up with subtyping between trait variables from other sources; I suspect we can mess up the caching scheme if we fail to capture this. I'd like to do some measurements actually, it may be that we can just fail to freshen (or avoid caching) in such cases, which may well occur very rarely in practice. 
[18:20:11] <nmatsakis> also
[18:20:26] <nmatsakis> this interacts with https://github.com/rust-lang/rust/issues/21974
[18:20:33] <nmatsakis> basically I think there is a simple scheme we could do today
[18:20:46] <nmatsakis> but it wouldn't necessarily work so great if we try to reason better about regions
[18:20:48] <arielb1>  I know about 21974
[18:21:08] <arielb1> and that fixing it would require typesystem reform
[18:27:09] <arielb1> nmatsakis: how can unification create subtyping?
[18:43:22] <nmatsakis> arielb1: we don't really unify, is the thing. So if you have e.g. Option<$0> <: Option<$1>, that manifests as "entangling" $0 and $1 with a constraint that $0 <: $1
[18:43:33] <nmatsakis> arielb1: if later $0 is unified with i32, then $1 will become i32
[18:43:42] <arielb1> nmatsakis: sure
[18:43:59] <arielb1> but doesn't trait matching only do equality?
[18:44:04] <nmatsakis> arielb1: but if $0 is unified with (say) `&'x i32`, then $1 is instantiated with `&'$2 i32` and we add the constraint that `'x : '$2`
[18:44:17] <nmatsakis> arielb1: yes, but -- what if that subtyping has already (separately) occurred 
[18:44:20] <nmatsakis> and then we have an obligation
[18:44:22] <nmatsakis> Foo<$0,$1>
[18:44:31] <nmatsakis> if there is an impl of Foo<i32,u32>
[18:44:38] <nmatsakis> it can fail to match
[18:44:45] <nmatsakis> there are various ways to fix this though
[18:46:13] <arielb1> do the freshening *before* selection?
[18:46:19] <arielb1> actually that might be a good idea anyway
[18:47:02] <nmatsakis> we do that
[18:47:12] <nmatsakis> that's how we do caching
[18:47:17] <nmatsakis> so, at the moment,
[18:47:52] <nmatsakis> we could just freshen entangled variables to the same fresh-type I believe; this would be ok for caching purposes, but that's where gh21974 comes in -- it wouldn't be enough later on
[18:48:07] <nmatsakis> (well, i'm not sure what you mean by "before selection")
[18:48:19] <nmatsakis> what I meant is it's one of the first things we do when selecting
[18:49:39] <arielb1> nmatsakis: currently we select, cache the freshened variables, and then unify
[18:49:49] <arielb1> the freshened variables with the originals
[18:50:31] <arielb1> I'm thinking about first freshening, doing selection on the freshened variables, and then confirming on the originals
[18:52:26] *** Joins: Rym (y@moz-g4dip9.range86-187.btcentralplus.com)
[18:56:42] *** Quits: Rym (y@moz-g4dip9.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[19:06:11] <nmatsakis> arielb1: I see. currently waht we do, actually, is freshen, check cache, then select if nothing is present
[19:06:28] <nmatsakis> arielb1: but yes we might do the selection based on a different matching process rather than just re-using the existing unification 
[19:06:47] <nmatsakis> arielb1: this was another solution I was considering (when I said "many ways....")
[19:07:16] <nmatsakis> I think we have room to maneuver here, but we should fix this bug for sure, and probably file an issue describing a lot of this
[19:11:11] *** Joins: nrc (nrc@moz-4bhi2i.xtra.co.nz)
[19:11:11] *** ChanServ sets mode: +qo nrc nrc
[19:12:53] <arielb1> nmatsakis: associated types do kind of require a new trait reform, anyway
[19:13:55] *** Quits: arielb1 (Ariel@moz-9minqr.red.bezeqint.net) (Quit: Ex-Chat)
[19:46:14] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[19:46:23] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[19:46:23] *** ChanServ sets mode: +qo brson brson
[19:46:35] *** Joins: Rym (y@moz-g4dip9.range86-187.btcentralplus.com)
[19:50:50] *** Quits: Rym (y@moz-g4dip9.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[20:02:19] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[20:07:47] *** Joins: p1start (p1start@moz-nftjhe.org)
[20:07:56] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[20:24:55] *** Joins: sigma (sigma@moz-ohog4c.range86-135.btcentralplus.com)
[20:40:45] *** Joins: Rym (y@moz-g4dip9.range86-187.btcentralplus.com)
[20:45:00] *** Quits: Rym (y@moz-g4dip9.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[20:53:09] *** Quits: sigma (sigma@moz-ohog4c.range86-135.btcentralplus.com) (Ping timeout: 121 seconds)
[20:56:18] *** Joins: Rym (y@moz-g4dip9.range86-187.btcentralplus.com)
[20:59:53] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[21:02:13] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Ping timeout: 121 seconds)
[21:40:54] *** Quits: Rym (y@moz-g4dip9.range86-187.btcentralplus.com) (Connection closed)
[21:41:40] *** Joins: Rym (y@moz-g4dip9.range86-187.btcentralplus.com)
[21:48:26] *** Joins: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net)
[21:48:26] *** ChanServ sets mode: +o pnkfelix
[21:50:16] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Quit: leaving)
[22:29:29] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Ping timeout: 121 seconds)
[22:32:57] *** kimundi is now known as zz_kimundi
[23:05:05] *** Joins: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net)
[23:05:05] *** ChanServ sets mode: +o pnkfelix
