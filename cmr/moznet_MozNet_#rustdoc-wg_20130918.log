[00:21:33] <acrichto> Seldaek: what's the url of the docs you've got right nwo?
[00:27:42] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Bye!)
[00:30:50] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[00:37:56] <acrichto> cmr Seldaek: ping
[00:58:28] <cmr> acrichto: pong
[00:58:35] <cmr> acrichto: Uhh, hm.
[00:58:44] <cmr> acrichto: Is it hardcoded into rustdoc? I recall hardcoding it.
[01:12:16] <acrichto> ah yeah I saw that
[01:12:21] <acrichto> how do I generate std/extra docs?
[01:12:29] <acrichto> rustdoc_ng over src/libstd/std.rs doesn't seem to generate everything
[01:12:37] <acrichto> it generates the main index page, and some sub-index pages, but nowhere near all of them
[01:13:39] <cmr> rustdoc_ng or rustdoc_web ?
[01:13:46] <cmr> I just run rustdoc_ng libstd/std.rs
[01:14:04] <acrichto> yeah and I then passed that to rustdoc_web
[01:14:13] <acrichto> which also didn't pick up `extra`, but that's a separate issue
[01:14:20] <cmr> Yeah, I've never actually gotten rustdoc_web to generate everything yet either
[01:14:34] <acrichto> like build/0.8-pre/std/fmt/index.html doesn't exist
[01:14:38] <acrichto> hmm...
[01:14:44] <acrichto> I suppose I'll wait for Seldaek to come back
[01:15:19] <acrichto> cmr: also, in the docs currently at seld.be, everything private is visible
[01:15:26] <cmr> acrichto: That is on purpose.
[01:15:26] <acrichto> has that been fixed or is it still an issue?
[01:15:29] <acrichto> really?
[01:15:39] <cmr> It won't be fixed until usage of private items is fixed in rustc.
[01:15:40] <acrichto> seems like that should be filtered...
[01:15:44] <acrichto> how so?
[01:15:59] <acrichto> or rather is there a bug open for this?
[01:16:04] <cmr> Sec, I'll get ane xample
[01:18:05] <acrichto> cmr: another thing I've noticed is that /*! Documentation */ shows up as "/*! Documentation" on the web
[01:18:27] <cmr> acrichto: std::local_data::abort()
[01:18:30] <cmr> Notice that that's not a pub fn
[01:18:35] <cmr> Yet you can call it with no issue.
[01:19:00] <acrichto> but that seems unrelated to it showing up in the docs
[01:19:04] <acrichto> we don't want to encourage people to call that
[01:19:12] <acrichto> it's a bug in the compiler that you can right now
[01:19:17] <acrichto> I had a patch to fix this awhile back...
[01:19:18] <cmr> Yes, but everything in extra::arc is private.
[01:19:20] <cmr> iirc
[01:19:32] <acrichto> that's sad :(
[01:19:34] <cmr> It needs to be fixed, I agree.
[01:19:34] <acrichto> would need to change though
[01:19:47] <cmr> extra::arc was the motivation behind not hiding priv items.
[01:19:54] <acrichto> it seems weird that when you first look at the documentation you see all the imports where very few of them are necessary
[01:19:55] <cmr> Same with #[doc(hidden)]
[01:20:10] <acrichto> #[doc(hidden)] isn't hidden?
[01:20:18] <cmr> No
[01:20:24] <cmr> std::rt is marked #[doc(hidden)]
[01:20:39] <cmr> Which is an insanely useful thing to have docs for.
[01:20:50] <cmr> Considering it's really the only useful io interface we have
[01:20:54] <acrichto> wait why is #[doc(hidden)] not hidden again?
[01:21:17] <cmr> because there are things marked #[doc(hidden)] that shouldn't be and it didn't occur to me to fix that at the source.
[01:21:48] <acrichto> seems like if you say doc(hidden), then you should hide the docs...
[01:21:59] <acrichto> and if you're not getting enough docs that's a bug
[01:22:03] <cmr> yes
[01:22:09] <cmr> I also disagree with doc(hidden) in general, though.
[01:22:28] <cmr> As someone who works on the stdlib and compiler, I want to see everything there is, not just the "public" APIs
[01:22:44] <cmr> So it should be a frontend thing, not a pass enabled by default in rustdoc_ng
[01:23:16] <acrichto> oh there's a pass to enable this feature?
[01:23:22] <acrichto> the hiding that is
[01:23:43] <cmr> Yes, strip-hidden
[01:24:02] <cmr> There should be one for strip-private too
[01:24:35] <acrichto> what's clean-comments ?
[01:24:42] <cmr> Removes the 
[01:24:44] <cmr> //
[01:24:46] <cmr> /* */
[01:24:48] <cmr> /*! */
[01:24:50] <cmr> And soforth
[01:24:51] <acrichto> ?
[01:24:52] <cmr> rustc includes those.
[01:24:55] <cmr> In the doc attributes
[01:25:05] <cmr>  ///
[01:25:07] <cmr> Not //
[01:25:10] <acrichto> huh
[01:25:21] <acrichto> seems like these should all be on-by-default
[01:25:46] <cmr> collapse_docs and collapse_privacy and clean_comments are the default passes.
[01:26:05] <cmr> line 69 of rustdoc_ng.rs
[01:26:08] <acrichto> collapse-privacy?
[01:26:25] <cmr> For inherited privacy, it does the computation to decide whether it's actually private or public.
[01:26:41] <cmr> And replace the inherited with that one.
[01:26:55] <acrichto> that's unfortunate
[01:27:03] <cmr> Why?
[01:27:14] <acrichto> in theory it's computed in middle/privacy.rs and nowhere else
[01:27:19] <cmr> Oh
[01:27:25] <cmr> Well, it's in the ast I get
[01:27:42] <acrichto> so stripping by privacy just isn't implemented yet?
[01:27:45] <cmr> Is there a map middle::privacy creates I should be looking it up in?
[01:27:47] <cmr> Correct.
[01:28:05] <acrichto> nah middle::privacy isn't that usable right now
[02:21:50] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[02:23:31] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[02:43:20] <acrichto> is there a rustdoc metabug or metalabel?
[02:43:29] <acrichto> or both...
[02:43:47] <cmr> A-rustdoc
[02:43:54] <cmr> rustdoc_ng metabug is #8125
[02:44:14] <acrichto> cool thanks
[07:46:59] <Seldaek> acrichto: can I help?
[07:47:25] <acrichto> Seldaek: how do you generate libstd/libextra docs?
[07:48:27] <Seldaek> it's in the readme, though I admit it's a bit obscure :p
[07:49:08] <Seldaek> I don't know how best to put it though
[07:49:11] <Seldaek> - place rustdoc_ng output files in input/<version>/<crate>.json where version must match tags on your git repo
[07:50:35] <Seldaek> acrichto: also I just pushed changes from last night, might not build without those
[07:51:37] <acrichto> Seldaek: yeah the problem I'm seeing is that half the crates are missing
[07:51:39] <acrichto> like build/0.8-pre/std/fmt/index.html
[07:51:41] <acrichto> doesn't exist
[07:52:34] <Seldaek> let me see here
[07:53:19] <Seldaek> I get that one build alright
[07:53:54] <Seldaek> $ find build/ | wc -l
[07:53:55] <Seldaek> 2394
[07:54:06] <Seldaek> that's a build of std + extra 
[07:54:52] <acrichto> one sec
[07:56:11] <acrichto> https://gist.github.com/alexcrichton/6606003
[07:56:53] <acrichto> my head for rustdoc_web is f24a30b6bef82db4303752f62d87dec75f7d4a94
[07:56:58] <acrichto> and rustdoc_ng was built recently
[07:57:45] <Seldaek> want to share those json files?
[07:59:18] <acrichto> http://www.contrib.andrew.cmu.edu/~acrichto/
[07:59:24] <acrichto> std.json/extra.json are in there
[08:00:21] <Seldaek> acrichto: did you maybe enable the doc(hidden) and other passes that cmr had disabled?
[08:00:41] <acrichto> I just ran rustdoc_ng
[08:00:43] <acrichto> no other arguments
[08:01:00] <Seldaek> ok I never ran it myself so not sure how it works :)
[08:01:18] <acrichto> which is collapse-docs, clean-comments, and collapse-privacy
[08:05:42] <Seldaek> acrichto: ok weird http://pastie.org/8335244
[08:06:00] <Seldaek> 0.8-dev is your json files
[08:06:29] <acrichto> wait, so you took my json files, and ran `grunt`?
[08:06:33] <acrichto> and it spit out more things?
[08:06:51] <Seldaek> yes
[08:06:57] <acrichto> what
[08:06:59] <Seldaek> it appears so :)
[08:07:04] <acrichto> you're using master, right?
[08:07:12] <acrichto> and npm make sure we have the same dependencies?
[08:07:21] <Seldaek> more or less
[08:07:39] <Seldaek> I do have some uncommitted changes but nothing that should affect the amount of files
[08:07:45] <Seldaek> I'll try to stash & see
[08:08:30] <Seldaek> acrichto: you can maybe show me your `npm ls` output, I can diff with mine see if there is anything up
[08:09:08] <acrichto> https://gist.github.com/alexcrichton/6606098
[08:10:13] <Seldaek> $ find build/ | wc -l
[08:10:14] <Seldaek> 2394
[08:10:23] <Seldaek> clean build from master 
[08:10:53] <acrichto> :(
[08:11:11] <acrichto> what's the md5 of std.json?
[08:11:24] <acrichto> 50847d5a7dfd94307b23633483373aed
[08:12:02] <Seldaek> yeah that matches
[08:12:10] <Seldaek> and 6a7b877536f70f4d51c5ca48ff7c4ac6 extra
[08:12:26] <Seldaek> you do indeed have slightly newer npm dependencies
[08:12:26] <acrichto> [~/code/rustdoc_web[master]] $ find input         [alex@rhea] 
[08:12:26] <acrichto> input                                                         
[08:12:27] <acrichto> input/0.8-pre                                                 
[08:12:27] <acrichto> input/0.8-pre/extra.json                                      
[08:12:27] <acrichto> input/0.8-pre/std.json                                        
[08:12:30] <acrichto> so that's normal
[08:12:31] <Seldaek> I'll try updating to see
[08:12:33] <acrichto> ?
[08:12:36] <acrichto> directory structure
[08:12:51] <Seldaek> I have the exact same yes
[08:13:04] <Seldaek> I really don't get what's up :)
[08:13:23] <acrichto> I'm confused lol
[08:15:44] <Seldaek> $ find build/ | wc -l
[08:15:44] <Seldaek> 2387
[08:16:01] <Seldaek> a few files missing it seems after updating dependencies, and it seems grunt segfaults while building sass 
[08:16:11] <Seldaek> yay nodejs 
[08:17:19] <acrichto> so if you blow away the whole build/ directory
[08:17:21] <acrichto> it all comes back?
[08:17:29] <Seldaek> yes 
[08:17:39] <Seldaek> well the html files anyway
[08:17:42] <acrichto> what in the world
[08:17:55] <acrichto> I mean this shoudln't have anything to do with grunt
[08:17:59] <acrichto> it's just rustdoc.js
[08:18:23] <Seldaek> yes pretty much
[08:18:43] <Seldaek> either I did something very dumb that makes it fail miserably on nix, or I don't know wtf is up
[08:18:53] <acrichto> are you onl inux?
[08:18:59] <Seldaek> nope windows
[08:19:05] <acrichto> ah I'm on osx
[08:21:03] <Seldaek> so if I call node-sass myself it works
[08:21:18] <Seldaek> but through grunt the process just gets killed off without any output
[08:21:34] <Seldaek> I think I'm gonna have to say fuck it and get back to work
[08:21:39] <Seldaek> really have to deliver something today
[08:21:50] <Seldaek> hopefully I'll have time tonight to dig deeper into this mess :/
[08:22:10] <acrichto> maybe this is a good point to rewrite it in rust lol
[08:23:20] <Seldaek> it'd be nice but I really won't have time before 0.8 :/
[08:23:52] <acrichto> oh yeah that'd be up to me
[08:25:37] <acrichto> interesting
[08:25:49] <acrichto> function renderTemplate
[08:25:56] <acrichto> I printed out the file it writes
[08:25:58] <acrichto> no mention of std
[08:32:27] <Seldaek> acrichto: can you pull the latest commit, then run `rm -rf node_modules && npm install && ./build.sh`
[08:32:50] <Seldaek> hopefully taking grunt out of the picture helps
[08:34:11] <acrichto> haha it went down
[08:34:14] <acrichto> 595 files now
[08:34:40] <Seldaek> gee :p
[08:34:48] <Seldaek> 2391 here
[08:35:26] <acrichto> there's a lot of directories
[08:35:29] <acrichto> but most of them are just empty
[08:35:36] <acrichto> but others are full
[08:35:47] <acrichto> how many extra files do you have?
[08:35:48] <acrichto> libextra
[08:36:16] <Seldaek> $ find build/0.8-dev/std/ | wc -l
[08:36:20] <Seldaek> 1713
[08:36:21] <Seldaek> Âµ$ find build/0.8-dev/extra/ | wc -l
[08:36:21] <Seldaek> 668
[08:36:55] <acrichto> 270/315 for me...
[08:37:23] <Seldaek> acrichto: which node version do you have?
[08:37:33] <Seldaek> 0.10.15 here
[08:38:14] <acrichto> 10.18
[08:39:04] <Seldaek> meh
[08:39:27] <Seldaek> I'll update to 0.10.18 just in case
[08:39:33] <Seldaek> but I doubt that'd be it
[08:39:42] <acrichto> probably not worth it
[08:42:27] <Seldaek> nah, still 2391
[08:42:42] <Seldaek> this is highly disturbing :)
[08:43:30] <Seldaek> acrichto: how long does it take to run btw?
[08:43:49] <acrichto> very fast
[08:43:57] <Seldaek> can you time? 
[08:44:02] <acrichto> 1.961s
[08:44:19] <Seldaek> is this a beefy machine or is it just because it doesn't render half? :)
[08:44:25] <Seldaek> here it takes ~15sec
[08:44:52] <Seldaek> on a not so fast laptop
[08:44:55] <acrichto> fairly normal machine
[08:44:57] <acrichto> ssd though
[08:45:08] <Seldaek> yeah me too, this is 2013 :p
[08:45:18] <acrichto> so this Twig.renderFile function
[08:45:22] <Seldaek> yeah
[08:45:25] <acrichto> it's invoking the callback for all "extra" files
[08:45:27] <acrichto> not for any "std" files
[08:45:44] <acrichto> it's getting called for all of them
[08:45:47] <Seldaek> yeah most likely it fails somehow and doesn't give you any output.. I had this problem at some point
[08:46:04] <Seldaek> I think there is a weird ass race condition in there when firing off too many render calls at once
[08:46:05] <acrichto> can you tell node "stop for a bit and go process events" ?
[08:46:17] <acrichto> like this is firing off *all* the render calls
[08:46:23] <acrichto> which looks to be thousands
[08:46:30] <Seldaek> well yeah one per html page
[08:46:33] <acrichto> and *then* it processes all of them
[08:47:22] <Seldaek> it just calls render on everything, and since it has an async API that's what you get.. it starts billions and then waits until it's all done
[08:47:27] <Seldaek> except the waiting part seems shaky
[08:47:54] <Seldaek> I'll double check but I don't think there is a sync render method on twig
[08:48:41] <Seldaek> sometimes I hate JS :p
[08:49:40] <acrichto> anyway, I need sleep now
[08:49:48] <acrichto> I'll keep trying to get this working tomorrow
[08:49:52] <acrichto> thanks for your help though!
[08:49:59] <Seldaek> yeah sure
[08:50:05] <Seldaek> I need to work so I guess I'll put it on hold oto
[08:50:07] <Seldaek> too*
[08:50:22] <Seldaek> cya on the other end 
[09:18:29] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[09:18:45] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[09:40:52] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[09:40:54] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[20:38:23] *** Joins: obk (Mibbit@56A7885C.6849BFB2.CB858787.IP)
[21:07:42] *** Quits: obk (Mibbit@56A7885C.6849BFB2.CB858787.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:16:21] <acrichto> cmr: so I'm rewriting rustdoc_web in rust now
[22:16:29] <acrichto> and I'm getting "task <unnamed> failed at 'index out of bounds: the len is 1 but the index is 2', rustdoc_ng.rs:1"
[22:16:35] <acrichto> when documenting src/libstd/std.rs
[22:16:43] <acrichto> looks like the actual failure came from passes::clean_comment_body
[22:16:48] <acrichto> have you had problems like this before?
[22:17:03] <cmr> Hrmph
[22:17:07] <cmr> I got that on librustc
[22:17:19] <acrichto> lines[0].slice_from(2).trim().to_owned()
[22:17:25] <acrichto> that's probably where it's dying
[22:17:40] <cmr> yeah
[22:18:04] <acrichto> ah yes that fixed it
[22:18:10] <acrichto> so I'm changing the command slightly
[22:18:17] <acrichto> rustdoc_ng <format> <crate>
[22:18:19] <cmr> What was the fix? I thought I had fixed that bug before.
[22:18:22] <acrichto> where format = json | html
[22:18:38] <acrichto> oh I just changed it to lines[0].trim().to_owned()
[22:18:42] <acrichto> probably not right, but works for now
[22:20:28] <acrichto> also I'm removing lots of command line arguments
[22:20:32] <acrichto> and moving them to crate attributes
[22:20:44] <acrichto> #[doc(no_default_passes, passes = "foo bar baz")] etc
[22:20:55] <acrichto> also #[doc(html_favicon_url = "...")] etc
[22:21:04] <cmr> "lots", when there were only four to start with? :P
[22:21:45] <acrichto> you get the point :P
[22:23:44] <cmr> acrichto: I'm not sure how I feel about the passes being a crate attribute
[22:24:00] <cmr> as long as a command line arg can override it
[22:24:26] <acrichto> rust in general doesn't like command line arguments
[22:24:39] <acrichto> and I think it's cleaner to put these things in the crate attributes
[22:24:43] <acrichto> kinda like lint levels
[22:24:51] <acrichto> you can define them in crates, but also command line
[22:27:29] <cmr> Yeah, I suppose doc passes are just like lints.
[22:32:12] <acrichto> woohoo I created an index file
[22:33:08] <cmr> acrichto: Anything I can do to help?
[22:33:28] <acrichto> the work is about to get highly parallel
[22:33:34] <acrichto> as I just start slurping things in from rustdoc_web
[22:34:20] <cmr> Ok!
[22:34:32] * acrichto create a temporary repo
[22:35:14] <acrichto> cmr: https://github.com/alexcrichton/rustdoc_ng-tmp
[22:35:50] <acrichto> so almost all of html is entirely unimplemented
[22:36:54] <cmr> acrichto: It's not really correct for this to be using the output from `clean`, but it's acceptable for now.
[22:37:25] <acrichto> ?
[22:37:26] <cmr> (since plugins generate json)
[22:37:36] <acrichto> I dunno what plugins even do
[22:37:37] <cmr> You're usine clean::Crate rather than its encoded json
[22:37:42] <acrichto> yeah
[22:38:03] <acrichto> we don't have any working plugins now, though, right?
[22:38:26] <cmr> Besides the toy ones to test it's working that exist somewhere on my filesystem, no.
[22:38:51] <acrichto> what do they do?
[22:38:56] <acrichto> or supposed to do?
[22:39:16] <acrichto> b/c having a plugin means that we're defining and abi/struct layout/such
[22:40:00] <cmr> They're loaded at rustdoc runtime with dlopen, they're given the clean::Crate, and return a Json that is included in the json output.
[22:40:19] <acrichto> they're passed the crate by value?
[22:40:29] <cmr> Yes
[22:40:43] <cmr> And return the crate!
[22:40:44] <acrichto> oh but they return it
[22:40:49] <cmr> (They're allowed to mutate it)
[22:41:07] <cmr> This is how eg all the stuff in passes.rs would be pluginified.
[22:41:18] <acrichto> hmm, I'm not sure whether we want to keep this for 1.0
[22:41:30] <acrichto> there's a lot of magic going on that's not documented
[22:42:19] <cmr> It's how dbp was going to implement rustle's index.
[22:42:57] <acrichto> this is a really really unsafe thing to do though
[22:43:03] <acrichto> what if the abi changes?
[22:43:06] <acrichto> what if the compiler changes?
[22:43:10] <acrichto> right now it's silent segfaults
[22:43:28] <cmr> Well rust doesn't have a stable abi so it doesn't matter. If you have a plugin built separately from rustdoc, all bets are off.
[22:43:39] <cmr> But it'd be semver'd
[22:44:09] <acrichto> but we'd need like crate metadata
[22:44:14] <acrichto> saying whether it's compatible or not
[22:44:20] <acrichto> and then checks to make sure that it is indeed compatible
[22:44:24] <acrichto> and none of that currently exists
[22:44:30] <cmr> Right
[22:44:42] <cmr> It's a prototype of dynamic module loading.
[22:45:13] <cmr> I also have some opinions on crate metadata that are cooking, there's a lengthy ML post being formulated.
[22:45:31] <acrichto> hmm ok
[22:45:39] <acrichto> this may just be an "experimental feature" for now
[23:05:09] <acrichto> I wish we could depend on a sass compiler
[23:05:14] <acrichto> it's *so* much nicer than css
