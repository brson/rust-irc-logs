[00:03:38] <pcwalton> jack: did you have anything you wanted to ask me at the meeting?
[00:05:45] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[00:07:34] *** Quits: jaeman (Mibbit@B4104EBB.3CC170B1.1E14B209.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[00:09:05] *** Joins: jaeman (Mibbit@B4104EBB.3CC170B1.1E14B209.IP)
[00:11:00] <jack> pcwalton: there was some open discussion of Critic
[00:11:08] <pcwalton> ah
[00:11:15] <pcwalton> I saw some stuff in github about it but really know nothing about it
[00:11:41] <jgraham> BTW, re: critic, if you want to try it out you should set up filters on the homepage, so that you are automatically assigned as reviewers for the code you own
[00:12:25] <jgraham> Note that directory names must have a trailing slash, but no leading slash or badness will happen (this is an old bug, I am currently upgrading the critic install)
[00:13:09] <jack> jgraham: most of us own all of it :)
[00:13:23] <jgraham> jack: Then "/" is a good filter :)
[00:13:41] <jack> jgraham: You've thought of everything :)
[00:14:37] <jgraham> But hypothetically if I wanted to get reviews of only DOM code I might add "src/components/script/dom/" (or whatever the path is) as the filter 
[00:15:02] <jgraham> s/the/a/
[00:15:09] * jgraham -> sleep
[00:15:21] <jack> pcwalton: I saw on blink-dev that they use nss but use openssl on android? do you know whY?
[00:15:27] <pcwalton> huh
[00:15:28] <pcwalton> no idea
[00:15:31] <pcwalton> maybe openssl is the system library?
[00:15:32] <jack> It is just because they ship opensll as part of android platform already?
[00:18:18] *** Joins: deokjinkim (Mibbit@B4104EBB.3CC170B1.1E14B209.IP)
[00:19:17] <pcwalton> I guess so.
[00:23:32] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[00:24:56] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[00:28:39] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[00:29:48] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[00:29:56] *** Quits: bholley (bholley@moz-BBE3ABD.mv.mozilla.com) (Quit: bholley)
[00:30:28] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[00:31:25] *** Quits: eholk (eholk@moz-BA312F07.crest.iu.edu) (Quit: eholk)
[00:32:22] *** Quits: ^emi (glenlivet@moz-9FE842F.cpe.net.cable.rogers.com) (Ping timeout)
[00:32:22] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Ping timeout)
[00:35:20] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[00:36:50] *** Quits: dbaron (dbaron@moz-347D5952.phlapa.fios.verizon.net) (Quit: 8403864 bytes have been tenured, next gc will be global.)
[00:39:38] *** Joins: ^emi (glenlivet@moz-9FE842F.cpe.net.cable.rogers.com)
[00:45:21] *** Quits: CaseyBecking (CaseyBecki@ED8170C4.82E507D6.C334098E.IP) (Ping timeout)
[00:46:57] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[00:47:43] <dhedlund> Anyone able to review my PR in rust-png?  more specifically, pull over my backport_* branch and update the servo submodule to point to it?  with that fix, tests run reliably under Linux now inc check-ref.  not everything passes, but that's for actual broken-ness.  and there's still some issues w/ sub-processes not propagating their errors out to the harnesses, but I'm working on it...just...
[00:47:45] <dhedlund> ...nothing more tonight.  thanks!
[00:48:36] *** Joins: jet (jet@moz-79F891EE.hsd1.ca.comcast.net)
[00:49:30] *** Joins: eholk (eholk@moz-F70D5031.hsd1.in.comcast.net)
[00:55:07] *** Joins: luser0 (chatzilla@C3726E1B.C47A1025.859058FB.IP)
[01:01:58] *** Quits: hoverbear (hoverbear@EBFA78B5.F19E5E7B.E74D50F2.IP) (Quit: Hibernating, be back soon.)
[01:05:35] *** Quits: jet (jet@moz-79F891EE.hsd1.ca.comcast.net) (Quit: jet)
[01:08:01] *** Quits: jensnock_ (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[01:08:32] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[01:10:13] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[01:14:29] *** Quits: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca) (Quit: canhtak)
[01:16:16] *** Joins: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca)
[01:17:59] *** Joins: CaseyBecking (CaseyBecki@moz-29F30CC3.lsanca.fios.verizon.net)
[01:20:23] <larsberg> dhedlund: that's great news! Jack is currently doing a rust upgrade, which will touch all the sub modules and servo master, so if we can our sub module updates should wait for his sweeping changes (my nvidia fixes, too)
[01:21:19] <larsberg> Thanks for getting those. We were just chatting in the servo meeting today about how getting content and ref tests fixed on both platforms were the next thing on our list.
[01:22:24] <jack> dhedlund++
[01:22:54] *** Quits: ivan (ivan@moz-531C3EC9.members.linode.com) (Ping timeout)
[01:24:57] *** Joins: ivan (ivan@moz-531C3EC9.members.linode.com)
[01:28:46] *** Joins: hoverbear (hoverbear@moz-86FCBF4B.gv.shawcable.net)
[01:30:21] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[01:32:07] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Ping timeout)
[01:37:22] <pcwalton>  22 files changed, 381 insertions(+), 522 deletions(-)
[01:37:23] <pcwalton> seems to work!
[01:37:26] <pcwalton> less generic trees
[01:39:19] *** Quits: hoverbear (hoverbear@moz-86FCBF4B.gv.shawcable.net) (Quit: Looking for honey.)
[01:41:06] *** Quits: harth (heather@moz-C07D5168.p2p.sfo1.mozilla.com) (Client exited)
[01:44:12] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[02:05:05] *** Quits: CaseyBecking (CaseyBecki@moz-29F30CC3.lsanca.fios.verizon.net) (Quit: Leaving...)
[02:07:17] *** Joins: pradeep (pradeep@5AB4884B.FCC4549.14D5B978.IP)
[02:07:56] <jack> pcwalton: you removed TreeUtils?
[02:07:59] <jack> or whatever that is called
[02:08:01] <pcwalton> jack: yup
[02:08:09] <jack> pcwalton: huzzah!
[02:08:20] <pcwalton> also getting rid of the unused "prune" traversal functions as layout does that now
[02:08:40] <pcwalton> so what I'm thinking of is getting rid of the View phantom type on AbstractNode, and the reasoning is this:
[02:09:02] <pcwalton> layout lifetime rules are kind of incompatible with script lifetime rules for getting at the guts of nodes
[02:09:17] <pcwalton> while layout is running, the script GC is turned off entirely, because layout cannot root nodes.
[02:09:51] <pcwalton> therefore the right thing to do is to have struct LayoutNode<'self> { node: AbstractNode, dummy: &'self () }
[02:09:56] <pcwalton> which enforces that LayoutNodes cannot escape
[02:10:01] <pcwalton> and allows looking into abstract nodes
[02:10:18] <pcwalton> however, script lifetime rules are quite different: nodes must be rooted before you can look into them, because the script GC is generally *not* turned off while script is running
[02:10:34] <pcwalton> so the only way to look into a script node is to root it -- the lifetime system doesn't play here
[02:11:19] *** Joins: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP)
[02:11:19] <ghservo> [13servo] 15pcwalton opened pull request #1422: script: Make trees less generic (06master...06less-generic-trees) 02http://git.io/-0jZzQ
[02:11:19] *** Parts: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP) ()
[02:12:08] <jack> so that is going to kill simultaneous script and layout :(
[02:12:27] <pcwalton> I don't think so
[02:12:29] <jdm> why can't layout root nodes?
[02:12:35] <pcwalton> jdm: because it's in a separate thread
[02:12:52] <jdm> at least, why couldn't we trace both the dirty and clean pointers?
[02:13:04] <jack> jdm: that's not threadsafe.
[02:13:31] <pcwalton> well, it is thread safe, but we have to ensure that the JS GC won't try to move the clean objects if we do COW DOM
[02:13:35] <jack> unless we make those dirty pointers atomic or something
[02:13:40] <jack> but even then you might see a partial state
[02:13:43] <pcwalton> the only way I know of to do that is to turn off the JS GC entirely while layout is running
[02:14:07] <pcwalton> basically, we have to root all objects of a certain class (all the clean nodes) because the JS GC is not thread safe
[02:14:12] <jack> ie, you might trace first_child and then alst_child might be NULL or something still
[02:14:48] <jack> pcwalton: i don't understand the dummy: &'self ()
[02:15:02] <pcwalton> jack: the point is to make it so that layout can't do something evil like stash a LayoutNode into TLS
[02:15:16] <pcwalton> because then the JS GC could move that node before the next go round
[02:15:19] <pcwalton> in between layouts
[02:15:45] <jack> so the &'self is just a lifetime bound to prevent escape?
[02:15:48] <pcwalton> yeah
[02:15:50] <pcwalton> that's all it is
[02:16:05] <pcwalton> in general there should be one root node, which script hands to layout, and everything should be lifetime bounded to that root
[02:16:05] <jack> why not use noncopyable or something? or make it non-send, or does that not prevent TLS?
[02:16:39] <pcwalton> nonsend doesn't prevent TLS
[02:16:42] <jack> I suppose noncopy and noclone and nosend doesn't prevent you from moving.
[02:16:46] <pcwalton> yeah, you can move it.
[02:16:49] <pcwalton> in particular
[02:17:08] <jack> but &'self doesnt' prevent it either, though i guess you can't move it very far.
[02:17:13] <pcwalton> you can ask for first_child() and then move *that*
[02:17:22] <pcwalton> &'self does prevent it if it's always lifetime bounded to its parent
[02:17:55] <pcwalton> all layout code is ultimately lifetime bounded to the handle_reflow() method, which does the transmute of the node that script handed it and then passes it down
[02:18:01] *** Quits: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP) (Input/output error)
[02:18:35] <pcwalton> jack: r? https://github.com/mozilla/servo/pull/1422
[02:18:43] <jack> why do you have to remove the phantom type to achieve this? can't the Node<LayoutVIew> have an &'self ()?
[02:18:59] <pcwalton> the phantom type is a phantom because it doesn't affect the structure of the type
[02:19:14] <pcwalton> you can't put anything different in a AbstractNode<ScriptView> compared to an AbstractNode<LayoutView>
[02:19:40] <pcwalton> maybe if you could say "maybe_noncopyable: View::T" inside the struct
[02:19:46] <pcwalton> but that would be associated types which Rust doesn't have
[02:20:03] <jack> &'self () is a zero sized type
[02:20:14] <pcwalton> doesn't matter
[02:20:15] <jack> so can't it be &'static () on one side and &'self () on the toher?
[02:20:35] <pcwalton> you still have to define the struct in one place
[02:20:40] <pcwalton> and in that place you have to list all the parameters
[02:20:44] <pcwalton> all the members rather
[02:20:45] <pcwalton> you can't say
[02:20:52] <pcwalton> struct AbstractNode<ScriptView> { â€¦ one thing â€¦ }
[02:21:01] <pcwalton> struct AbstractNode<LayoutView> { â€¦ something else â€¦ }
[02:21:04] <pcwalton> even if they have identical size
[02:21:35] <jack> do we want script nodes in TLS? :)
[02:21:46] <jack> perhaps this would work in both of them
[02:22:11] <pcwalton> that will be solved by making them noncopyable and allowing copy only via root!()
[02:22:15] <jack> i'm not super attached to the phantom types. the stuff we have no is stupid anyway. i'm just trying to understand all the ins and outs
[02:22:26] <pcwalton> script is even more restrictive than layout in a way
[02:22:34] <pcwalton> because you cannot even safely *look inside* a JSManaged
[02:22:36] <pcwalton> without rooting it
[02:22:51] <pcwalton> in script
[02:22:55] <pcwalton> JSManaged == AbstractNode
[02:23:05] <pcwalton> in layout, because the JS GC is off, you can look inside a LayoutNode
[02:23:11] <pcwalton> but script can't assume that
[02:23:26] <jack> jsgc is not runnign when script is running though is it?
[02:23:35] <jack> unless we call it i mean
[02:23:45] <pcwalton> I think the JS GC can run at fairly arbitrary times
[02:23:47] <jdm> jack: any operation that touches the JSAPI could trigger a GC, basically
[02:23:49] <jack> so how would a pointer on our stack ever go back?
[02:23:51] <pcwalton> like even looking up a property
[02:24:02] <jack> and the issue is that we don't trace our stack?
[02:24:20] <pcwalton> yeah, the issue is that we don't trace our stack
[02:24:27] <jack> i suppose that would require us to known which things were jsmanaged pointers on our stack. but that is a knowable thing
[02:24:31] <jdm> the JS pointer also isn't on the stack most of the time
[02:24:38] <pcwalton> the way to do manual stack tracing is with the Rooted<T> stuff
[02:24:43] <pcwalton> which we can make safe via macros
[02:24:46] <jack> if i have a node in scope, it's on the stack no?
[02:24:52] <jdm> jack: not in the current design.
[02:25:02] <jdm> JSManaged knows nothing about the reflectors
[02:25:20] <jack> oh. there are no back pointers? 
[02:25:34] <pcwalton> we don't trace the Rust stack in moving-GC-spidermonkey though, so it doesn't matter
[02:25:36] <jdm> only inside the Reflector
[02:25:51] <jack> pcwalton: we could though right?
[02:26:01] <pcwalton> maybe if Rust used the LLVM gcroot stuff we could hook it up, but that would require a lot of work to both Rust and SpiderMonkey
[02:26:12] <pcwalton> better IMO to just use the C++ Rooted<T> hooks and make them safe
[02:26:12] <jack> ah
[02:26:19] <pcwalton> it's more code on our part but should be no less safe
[02:26:34] <pcwalton> later on if we want to improve the aesthetics of Servo code we can look into gcroot
[02:26:35] <jack> so every time we want to touch a JSManaged we have to root it? is ther ea way to make sure that always happens?
[02:26:44] <pcwalton> jack: yup, just make it totally opaque until you root it
[02:26:50] <pcwalton> privacy ftw :)
[02:27:06] <jack> ok. starting to grok this.
[02:27:27] <jack> will we still need placement new for this?
[02:27:29] <pcwalton> I'm working on removing View from AbstractNodeâ€¦ I think layout is getting pretty clean now that OpaqueNode has landed
[02:27:46] <pcwalton> maybe, it's probably not critical since all it does is save a stack copy
[02:27:53] *** Quits: ibnc (ibnc@moz-718F3037.client.mchsi.com) (Client exited)
[02:27:57] <pcwalton> i.e. you can just use JSManaged::new() and move in the value
[02:28:03] <jack> isn't the node unrooted for that stack copy though?
[02:28:11] <pcwalton> yeah, it'd have to begin life rooted
[02:28:47] <jack> on a different note, can you give me the high level of this TNode patch so I know what i'm looking at?
[02:28:49] <pcwalton> the one tricky thing is how to store a rooted value back into the heapâ€¦ I think we may need to get rustc to start generating setters for each field
[02:29:06] <pcwalton> so I basically renamed TreeNodeRef/TreeNode into TNode and ElementLike into TElement
[02:29:28] <pcwalton> and stuffed them into style instead of util since all they're really used for at this point is to break the otherwise-cyclic dependency between script and style
[02:29:47] <jack> how is that less generic?
[02:29:47] <pcwalton> I am working on a followup to further reduce their use so that they will *only* be used in style and layout
[02:30:13] <jdm> jack: well, there's one less trait involved
[02:30:14] <pcwalton> the pointer stitching code (add_child, remove_child) are inlined directly into Node
[02:30:21] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[02:30:27] <pcwalton> and therefore TNode only needs accessors, not mutators
[02:30:43] <pcwalton> reducing the amount of code in the trait
[02:30:43] <pcwalton> (which incidentally improves safety of style)
[02:30:46] <jack> you mean TreeNodeRefElementLike?
[02:30:57] <jack> or whatever that monstrosity was
[02:31:01] <jdm> heh
[02:31:04] <pcwalton> I think that was part of it, yeah
[02:31:16] <pcwalton> basically it's only as generic as style needs now to break its cross crate dependency
[02:32:26] * jdm needs to eat dinner
[02:32:38] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Ping timeout)
[02:38:12] *** Quits: eholk (eholk@moz-F70D5031.hsd1.in.comcast.net) (Quit: eholk)
[02:38:31] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[02:39:45] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[02:43:02] *** Joins: eholk (eholk@moz-F70D5031.hsd1.in.comcast.net)
[02:46:41] *** Joins: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP)
[02:46:41] <ghservo> [13servo] 15kmcallister opened issue #1423: Task failure in DOM method causes segfault 02http://git.io/knOdpQ
[02:46:41] *** Parts: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP) ()
[02:51:26] *** Joins: harth (heather@moz-42412102.hsd1.ca.comcast.net)
[02:51:41] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[02:55:57] *** Quits: harth (heather@moz-42412102.hsd1.ca.comcast.net) (Ping timeout)
[03:03:53] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:04:58] *** Quits: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com) (Quit: pcwalton)
[03:05:19] *** Quits: luser0 (chatzilla@C3726E1B.C47A1025.859058FB.IP) (Quit: ChatZilla 0.9.90.1 [Iceweasel 17.0.10/20131030035318])
[03:06:19] *** Quits: yury (yury@moz-86474802.ok.ok.cox.net) (Ping timeout)
[03:06:22] *** Joins: yury (yury@moz-86474802.ok.ok.cox.net)
[03:06:36] *** Quits: eholk (eholk@moz-F70D5031.hsd1.in.comcast.net) (Quit: eholk)
[03:13:38] *** Quits: azakai (alon@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[03:27:38] *** Quits: doomlord_ (servitor@moz-D40D68D6.range86-184.btcentralplus.com) (Ping timeout)
[03:30:21] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[03:32:06] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Ping timeout)
[03:34:35] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[03:34:36] *** ChanServ sets mode: +o jdm
[03:44:47] *** Joins: doomlord_ (servitor@moz-D40D68D6.range86-184.btcentralplus.com)
[03:48:17] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[03:49:29] *** Joins: vk (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net)
[03:49:49] *** vk is now known as vky
[03:50:10] *** vky is now known as vk
[03:50:24] *** vk is now known as vky
[03:55:43] *** Joins: zz_kimundi (kimundi@moz-9170C40C.dip0.t-ipconnect.de)
[03:57:10] *** Quits: kimundi (kimundi@moz-258BDDE9.dip0.t-ipconnect.de) (Ping timeout)
[03:57:11] *** zz_kimundi is now known as kimundi
[04:07:54] *** Quits: maxli (maxli@moz-4D28BA20.student.cs.uwaterloo.ca) (Quit: Leaving.)
[04:07:58] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[04:14:23] *** Joins: eholk (eholk@moz-F70D5031.hsd1.in.comcast.net)
[04:20:39] *** Joins: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP)
[04:23:32] *** Quits: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP) (Client exited)
[04:23:37] *** Joins: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP)
[04:28:40] *** Joins: jet (jet@moz-79F891EE.hsd1.ca.comcast.net)
[04:30:06] *** Joins: Debloper (debloper@moz-88FF8AE8.redhat.com)
[04:30:20] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[04:32:35] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Ping timeout)
[04:37:08] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[04:39:23] *** Quits: toshok (toshok@moz-43741342.cat) (Quit: Coyote finally caught me)
[04:39:45] *** Joins: toshok (toshok@moz-43741342.cat)
[04:40:50] *** Quits: toshok (toshok@moz-43741342.cat) (Quit: Coyote finally caught me)
[04:41:12] *** Joins: toshok (toshok@moz-43741342.cat)
[04:45:51] *** Quits: eholk (eholk@moz-F70D5031.hsd1.in.comcast.net) (Quit: eholk)
[04:50:58] *** Joins: eholk (eholk@moz-F70D5031.hsd1.in.comcast.net)
[04:54:12] *** Quits: jet (jet@moz-79F891EE.hsd1.ca.comcast.net) (Quit: jet)
[05:10:31] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[05:17:14] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[05:30:20] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[05:32:02] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Ping timeout)
[05:44:06] *** Joins: gandalf (zbraniecki@moz-B6E035E9.hsd1.ca.comcast.net)
[05:54:32] *** Quits: miketaylr (mtaylor@moz-8ACC7131.dyn.grandenetworks.net) (Quit: Linkinus - http://linkinus.com)
[05:54:59] *** Quits: eholk (eholk@moz-F70D5031.hsd1.in.comcast.net) (Quit: eholk)
[06:03:28] *** Joins: hoverbear (hoverbear@moz-86FCBF4B.gv.shawcable.net)
[06:12:33] *** Quits: hoverbear (hoverbear@moz-86FCBF4B.gv.shawcable.net) (Quit: Looking for honey.)
[06:12:40] *** Joins: hoverbear (hoverbear@moz-86FCBF4B.gv.shawcable.net)
[06:24:47] *** Joins: bholley (bholley@moz-FCAF9AAB.hsd1.ca.comcast.net)
[06:27:42] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[06:27:42] *** ChanServ sets mode: +o pcwalton
[06:27:49] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[06:29:09] *** Joins: ghservo (ghservo@C8693FCB.6A2AE50.F3114085.IP)
[06:29:10] <ghservo> [13servo] 15pcwalton opened pull request #1424: Harden layout (06master...06harden-layout) 02http://git.io/o4cApQ
[06:29:10] *** Parts: ghservo (ghservo@C8693FCB.6A2AE50.F3114085.IP) ()
[06:30:20] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[06:31:28] *** Quits: ivan (ivan@moz-531C3EC9.members.linode.com) (Ping timeout)
[06:32:39] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Ping timeout)
[06:34:16] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[06:34:46] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[06:35:52] *** Joins: ivan (ivan@moz-531C3EC9.members.linode.com)
[06:45:25] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[06:47:16] <eddyb> jack, jdm: not sure which of you were talking with Ms2ger a few days ago about GC, but I feel stupid now, I think there is a simple way to solve this
[06:47:24] <jdm> oh?
[06:47:35] <eddyb> AddRoot creates a non-collectible strong ref, right?
[06:47:47] <eddyb> ignore the strong there, it's my terminology :P
[06:47:56] <jdm> as far as I know, yes
[06:48:07] <eddyb> mkay. just remove the root when the refcount is 1
[06:48:29] <eddyb> then it's only held alive by non-cyclic JS references
[06:49:00] <eddyb> and you use a finalizer callback or something to null the pointer and make further accesses invalid
[06:49:08] <jdm> I am unclear on a couple things here
[06:49:13] *** Quits: patrickkim (Mibbit@B4104EBB.3CC170B1.1E14B209.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[06:49:23] <jdm> some Rust object is being refcounted, right?
[06:49:42] *** Joins: patrickkim (Mibbit@B4104EBB.3CC170B1.1E14B209.IP)
[06:50:04] <eddyb> JSManaged would have a refcount for each JS object it can point to
[06:50:30] <jdm> so JSManaged contains a reference count?
[06:50:41] <eddyb> maybe. depends how it's handled
[06:51:06] <eddyb> well, I'm also unclear on the details, but what I remembered was that we thought SM didn't have a strong/weak ref system when the answer was obvious :P
[06:51:09] <jdm> I'm not sure I see the connection with the refocunt being 1
[06:51:28] <jdm> refcount
[06:51:29] <jdm> awkward
[06:51:36] * jdm thinks
[06:51:45] <eddyb> jdm: well, v8
[06:51:49] <eddyb> dammit, enter
[06:51:57] <jdm> oh right, we're also using tracehooks
[06:52:22] <eddyb> v8's Persistent works even when it's in a mostly-JS-refs cycle. i.e. it gets collected
[06:52:40] <jdm> are you saying that when the refcount reaches 1, it should no longer be accessible from rust code via JSManaged?
[06:52:45] <eddyb> and until now, I didn't understand why it was saying that it's weak when the refcount is 1
[06:52:56] <eddyb> jdm: the access might fail
[06:53:00] *** Quits: patrickkim (Mibbit@B4104EBB.3CC170B1.1E14B209.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[06:53:15] <eddyb> or you can have it return an Option<&T>, I don't know
[06:53:38] <jdm> I don't think we want JSManaged to be equivalent to weak references
[06:53:44] <eddyb> the point is, you add the root when refcount > 1
[06:54:10] <eddyb> *however* I just realized it might not work when you also have branching cycles through Rust code
[06:54:19] <eddyb> so Traceable might work better in the end
[06:55:23] <eddyb> jdm: well, I mostly wanted to note that I thought that strong/weak needed more support when the presence of the root was enough -i.e. I was being stupid
[06:56:58] <jdm> maybe I should look at v8's design at some point
[06:57:04] * jdm adds it to the ever-growing todo list
[06:57:08] *** Joins: victorporof (victorporo@C8C495F5.E3195F0D.9B1E38F4.IP)
[06:57:50] *** Quits: dbaupp (Thunderbir@1D1B1F7A.D5A1DCF.37681C44.IP) (Ping timeout)
[06:58:32] *** Quits: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP) (Client exited)
[06:58:36] *** Joins: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP)
[07:05:19] *** Quits: bholley (bholley@moz-FCAF9AAB.hsd1.ca.comcast.net) (Quit: bholley)
[07:05:35] *** Joins: bholley (bholley@moz-FCAF9AAB.hsd1.ca.comcast.net)
[07:06:17] *** Quits: bholley (bholley@moz-FCAF9AAB.hsd1.ca.comcast.net) (Quit: bholley)
[07:06:37] *** Quits: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca) (Quit: canhtak)
[07:06:56] *** Joins: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca)
[07:20:04] *** Joins: alex-abreu (alex@moz-AB5B21A9.w109-212.abo.wanadoo.fr)
[07:25:21] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Ping timeout)
[07:29:21] *** Joins: alex_abreu (alex@moz-2FFBA6CC.w92-137.abo.wanadoo.fr)
[07:29:22] *** Quits: alex-abreu (alex@moz-AB5B21A9.w109-212.abo.wanadoo.fr) (Ping timeout)
[07:29:52] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[07:30:20] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[07:30:21] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[07:32:02] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Ping timeout)
[07:35:35] *** Joins: jet (jet@moz-79F891EE.hsd1.ca.comcast.net)
[07:44:35] *** Joins: Ms2ger (Ms2ger@BB191E51.D97EE64B.F15B0BB3.IP)
[07:47:01] *** Joins: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP)
[07:47:01] <ghservo> [13rust-azure] 15hyunjunekim opened pull request #65: add some functions which set options on DrawOptions (06master...06drawoptions) 02http://git.io/8Y1MOQ
[07:47:01] *** Parts: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP) ()
[07:48:27] *** Quits: gandalf (zbraniecki@moz-B6E035E9.hsd1.ca.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[07:48:35] *** Quits: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net) (Quit: ChatZilla 0.9.90.1 [Firefox 27.0/20131209204824])
[07:48:35] *** Joins: jackneill (jackneill@moz-B6F27E42.pool.digikabel.hu)
[07:49:32] *** Quits: hoverbear (hoverbear@moz-86FCBF4B.gv.shawcable.net) (Quit: Hibernating, be back soon.)
[07:58:22] *** Quits: ^emi (glenlivet@moz-9FE842F.cpe.net.cable.rogers.com) (Ping timeout)
[07:59:01] *** Quits: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca) (Quit: canhtak)
[08:07:16] *** Joins: ^emi (glenlivet@moz-9FE842F.cpe.net.cable.rogers.com)
[08:11:41] *** Joins: dbaupp (Thunderbir@moz-EB2EFE6F.lns20.syd6.internode.on.net)
[08:19:57] *** Quits: victorporof (victorporo@C8C495F5.E3195F0D.9B1E38F4.IP) (Quit: victorporof)
[08:20:07] *** Joins: victorporof (victorporo@C8C495F5.E3195F0D.9B1E38F4.IP)
[08:30:20] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[08:32:31] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Ping timeout)
[08:51:00] *** Quits: deokjinkim (Mibbit@B4104EBB.3CC170B1.1E14B209.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[08:54:45] *** Quits: pradeep (pradeep@5AB4884B.FCC4549.14D5B978.IP) (Quit: leaving)
[08:54:52] *** Joins: gandalf (zbraniecki@moz-B6E035E9.hsd1.ca.comcast.net)
[09:12:01] *** Quits: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP) (Client exited)
[09:15:13] *** Joins: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP)
[09:30:20] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[09:32:08] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Ping timeout)
[09:33:19] *** Quits: yury (yury@moz-86474802.ok.ok.cox.net) (Ping timeout)
[09:33:23] *** Joins: yury (yury@moz-86474802.ok.ok.cox.net)
[09:53:14] *** Quits: jet (jet@moz-79F891EE.hsd1.ca.comcast.net) (Quit: jet)
[09:57:39] *** Quits: gandalf (zbraniecki@moz-B6E035E9.hsd1.ca.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[10:01:19] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[10:06:38] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[10:13:58] *** Quits: ^emi (glenlivet@moz-9FE842F.cpe.net.cable.rogers.com) (Ping timeout)
[10:20:23] *** Joins: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[10:24:11] *** Joins: jaebaek (jaebaek@4D10E9F2.E551553C.7544CABF.IP)
[10:26:04] *** Joins: ^emi (glenlivet@moz-9FE842F.cpe.net.cable.rogers.com)
[10:32:45] *** Quits: jaebaek (jaebaek@4D10E9F2.E551553C.7544CABF.IP) (Ping timeout)
[10:48:11] *** Quits: ^emi (glenlivet@moz-9FE842F.cpe.net.cable.rogers.com) (Ping timeout)
[10:51:50] *** Joins: ^emi (glenlivet@moz-9FE842F.cpe.net.cable.rogers.com)
[11:22:15] *** Quits: alex_abreu (alex@moz-2FFBA6CC.w92-137.abo.wanadoo.fr) (Ping timeout)
[11:23:46] *** Joins: alex_abreu (alex@moz-627DE554.w92-144.abo.wanadoo.fr)
[11:26:22] *** Quits: ^emi (glenlivet@moz-9FE842F.cpe.net.cable.rogers.com) (Ping timeout)
[11:32:50] *** Quits: alex_abreu (alex@moz-627DE554.w92-144.abo.wanadoo.fr) (Ping timeout)
[11:37:46] *** Joins: alex_abreu (alex@moz-A5A47EDD.w92-137.abo.wanadoo.fr)
[11:38:52] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[11:49:47] *** Joins: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP)
[11:49:47] <ghservo> [13servo] 15saneyuki opened pull request #1425: Clean up compositor codes (06master...06compositor) 02http://git.io/YB1-Sg
[11:49:47] *** Parts: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP) ()
[11:54:22] *** Quits: Debloper (debloper@moz-88FF8AE8.redhat.com) (Quit: Leaving.)
[11:54:55] *** Quits: tetsuharu (tetsuharu@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Quit: )
[11:57:06] *** Joins: ^emi (glenlivet@moz-9FE842F.cpe.net.cable.rogers.com)
[12:06:11] *** Joins: brendan (brendaneic@35E90EE3.B8B12C49.396B22AD.IP)
[12:33:59] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[12:57:52] *** Quits: brendan (brendaneic@35E90EE3.B8B12C49.396B22AD.IP) (Ping timeout)
[13:00:48] *** Joins: maxli (maxli@moz-4D28BA20.student.cs.uwaterloo.ca)
[13:06:46] *** Joins: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca)
[13:35:30] *** Joins: sankha93 (Instantbir@484A1B28.36E1639E.EFB84E89.IP)
[13:47:15] *** bhearsum|afk is now known as bhearsum
[13:57:47] *** Joins: dbaron (dbaron@moz-347D5952.phlapa.fios.verizon.net)
[14:03:01] *** Quits: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca) (Quit: canhtak)
[14:04:23] *** Joins: mihneadb (mihneadb@B3BF1920.5A83FA76.501A7953.IP)
[14:05:28] *** Quits: victorporof (victorporo@C8C495F5.E3195F0D.9B1E38F4.IP) (Quit: victorporof)
[14:06:12] *** Joins: ahal (ahal@moz-7DE89BF0.cable.teksavvy.com)
[14:19:38] *** Joins: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca)
[14:26:14] *** Quits: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca) (Quit: canhtak)
[14:28:15] *** Joins: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca)
[14:53:55] *** Quits: mihneadb (mihneadb@B3BF1920.5A83FA76.501A7953.IP) (Quit: Bye)
[15:16:34] *** Joins: miketaylr (mtaylor@moz-8ACC7131.dyn.grandenetworks.net)
[15:16:53] *** Joins: hoverbear (hoverbear@moz-86FCBF4B.gv.shawcable.net)
[15:22:22] *** Quits: hoverbear (hoverbear@moz-86FCBF4B.gv.shawcable.net) (Quit: Hibernating, be back soon.)
[15:41:45] *** Quits: yusukesuzuki (yusukesuzu@moz-FEE44B6.net220148245.t-com.ne.jp) (Connection reset by peer)
[15:43:44] *** Quits: Ms2ger (Ms2ger@BB191E51.D97EE64B.F15B0BB3.IP) (Input/output error)
[15:45:26] *** Joins: Ms2ger (Ms2ger@BB191E51.D97EE64B.F15B0BB3.IP)
[16:13:53] <jack> jgraham: ping
[16:15:15] <jgraham> jack: Hej
[16:15:35] <jack> jgraham: I want to try a review on critic, but the one i want to do doesn't have a link
[16:15:46] <jack> did you turn off the bot or is there a way to browse to a PR?
[16:16:02] <jgraham> jack: I didn't change anything
[16:16:14] <jgraham> jack: Which PR?
[16:16:25] <jack> jgraham: https://github.com/mozilla/servo/pull/1422
[16:17:28] *** Joins: victorporof (victorporo@C8C495F5.E3195F0D.9B1E38F4.IP)
[16:18:11] <jgraham> jack: Hmm, not sure why there isn't a review for that one, let me check the logs
[16:27:01] *** Joins: jet (jet@moz-79F891EE.hsd1.ca.comcast.net)
[16:27:02] <jgraham> jack: I can't see anything. If you can you could try closing and reopening the review, that would cause it to try again.
[16:33:29] <jack> Ms2ger: good catch on the visibility change
[16:37:20] <jgraham> jack: Hmm, maybe https://critic.hoppipolla.co.uk/r/466 is the same change?
[16:39:15] <jgraham> Although that seems to be https://github.com/mozilla/servo/pull/1424
[16:40:07] * jgraham doesn't understand the relationship between those PRs
[16:40:34] <jack> pcwalton often piggybacks his PRs
[16:40:42] <jack> so the first PR is some change, and the next PR builds on it.
[16:41:36] <jack> jgraham: i can't find a list of reviews anywhere
[16:41:51] <jgraham> jack: You aren't subscribed to any
[16:42:08] <jack> isn't ther ea giant list of servo reviews I can browse?
[16:42:08] <jgraham> You need to set up a filter for the servo repo on the homepage
[16:42:57] <jgraham> jack: Not until I finish the upgrade to the latest version
[16:43:13] <jgraham> But you need to set up a filter anyway otherwise you won't be a reviewer
[16:43:34] <jack> jgraham: now i see some. there are 2 correct?
[16:45:38] <SimonSapin> jack: what parts of the style crate are marked as dead?
[16:46:36] <jgraham> jack: 2 open 2 closed
[16:50:32] <jack> SimonSapin: one sec I'll find it.
[16:51:06] <jack> pub static STYLE_ATTRIBUTE_SPECIFICITY: u32 = 1 << 31;
[16:51:09] <jack> for example
[16:51:23] *** Joins: ibnc (ibnc@moz-718F3037.client.mchsi.com)
[16:51:24] <jack> since selectors isn't public, that has no visibility and isnt' used internally
[16:51:33] <jack> struct PerOriginRules also
[16:52:08] <jack> get_rules, get_mock_rules (which i assume the latter is used in cfg(test))
[16:52:36] <jack> in common_types parse is unused, which I think is ok since it might get used by later additions to properties.rs.mako?
[16:52:55] *** Joins: eholk (eholk@moz-BA312F07.crest.iu.edu)
[16:53:02] <SimonSapin> STYLE_ATTRIBUTE_SPECIFICITY is dead (I though I would need it, but the cascade impl doesnâ€™t use specificity)
[16:56:49] <SimonSapin> get_mock_rules should be in a #[cfg(test)] module
[16:57:10] <SimonSapin> I donâ€™t know or remember about PerOriginRules
[16:59:43] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[16:59:44] *** ChanServ sets mode: +o jdm
[17:01:37] <SimonSapin> as to common_types, possibly some combination of length/percentage/auto and whole range/non-negative are not actually used. They may be later when we add more properties
[17:02:26] <SimonSapin> if itâ€™s a one-liner thatâ€™s unused just remove it
[17:02:32] <SimonSapin> itâ€™ll be easy enough to add back
[17:04:26] *** Quits: miketaylr (mtaylor@moz-8ACC7131.dyn.grandenetworks.net) (Ping timeout)
[17:04:29] *** Joins: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP)
[17:04:29] <ghservo> 01[13servo01] 15bors-servo pushed 0 new commits to 06auto: 02http://git.io/-8taHw
[17:04:29] *** Parts: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP) ()
[17:04:33] *** Joins: ghservo (ghservo@79968228.6A2AE50.F3114085.IP)
[17:04:33] <ghservo> 01[13servo01] 15bors-servo pushed 7 new commits to 06auto: 02http://git.io/3OJqsg
[17:04:33] <ghservo> 13servo/06auto 14bc36ca8 15Simon Sapin: Remove obsolete makefile lines about Netsurfâ€™s libcss.
[17:04:33] <ghservo> 13servo/06auto 14b98acc2 15Simon Sapin: Add rust-encoding as a submodule....
[17:04:33] <ghservo> 13servo/06auto 142d6ac33 15Simon Sapin: Add support for non-UTF8 CSS stylesheets, with rust-encoding.
[17:04:35] *** Parts: ghservo (ghservo@79968228.6A2AE50.F3114085.IP) ()
[17:04:48] *** Joins: miketaylr (mtaylor@moz-8ACC7131.dyn.grandenetworks.net)
[17:06:28] <SimonSapin> jack: and PerOriginRules looks like itâ€™s left over from when it was replaced with PerOriginSelectorMap
[17:07:13] <jack> SimonSapin: cool. all fixed now, thanks
[17:08:12] *** Joins: jaebaek (jaebaek@4D10E9F2.E551553C.7544CABF.IP)
[17:08:14] <SimonSapin> jack: https://github.com/mozilla/servo/pull/1377 may also conflict with the upgrade, as it touches submodules
[17:08:24] *** Quits: robn (robn@moz-76B0302C.static.internode.on.net) (Ping timeout)
[17:10:43] *** Quits: miketaylr (mtaylor@moz-8ACC7131.dyn.grandenetworks.net) (Ping timeout)
[17:13:02] *** Joins: robn (robn@moz-76B0302C.static.internode.on.net)
[17:13:08] *** Joins: hoverbear (hoverbear@EBFA78B5.F19E5E7B.E74D50F2.IP)
[17:14:57] *** Joins: miketaylr (mtaylor@moz-8ACC7131.dyn.grandenetworks.net)
[17:21:02] *** Quits: sankha93 (Instantbir@484A1B28.36E1639E.EFB84E89.IP) (Ping timeout)
[17:24:31] *** Quits: alex_abreu (alex@moz-A5A47EDD.w92-137.abo.wanadoo.fr) (Ping timeout)
[17:25:16] *** Joins: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP)
[17:25:16] <ghservo> 01[13servo01] 15bors-servo merged 06auto into 06master: 02http://git.io/3OJqsg
[17:25:16] *** Parts: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP) ()
[17:25:17] *** Joins: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP)
[17:25:17] <ghservo> [13servo] 15bors-servo closed pull request #1377: Add support for non-UTF8 CSS stylesheets, with rust-encoding. (06master...06encoding) 02http://git.io/8PS_oQ
[17:25:17] *** Parts: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP) ()
[17:26:29] <jgraham> Critic is having a little downtime
[17:26:49] <jgraham> The upgrade wasn't entirely trouble-free
[17:27:39] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[17:28:05] *** Joins: azakai (alon@moz-BBE3ABD.mv.mozilla.com)
[17:28:56] *** Quits: jet (jet@moz-79F891EE.hsd1.ca.comcast.net) (Quit: jet)
[17:30:12] *** Quits: miketaylr (mtaylor@moz-8ACC7131.dyn.grandenetworks.net) (Ping timeout)
[17:31:48] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[17:32:20] *** Joins: jet (jet@moz-79F891EE.hsd1.ca.comcast.net)
[17:32:27] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[17:32:27] *** ChanServ sets mode: +qo dherman dherman
[17:34:07] *** Joins: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net)
[17:34:31] *** Quits: azakai (alon@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[17:34:54] *** Joins: miketaylr (mtaylor@moz-8ACC7131.dyn.grandenetworks.net)
[17:36:09] *** ahal is now known as ahal|lunch
[17:36:46] *** Joins: abinader (abinader@D8B9C081.E820043D.D4C04133.IP)
[17:38:32] *** Joins: alex-abreu (alex@moz-FCCF99D0.w80-9.abo.wanadoo.fr)
[17:41:10] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[17:41:11] *** ChanServ sets mode: +o pcwalton
[17:41:45] <pcwalton> going through the process of hardening layout to make nodes non copyable actually exposed a memory safety problem
[17:41:46] <pcwalton> yay!
[17:41:47] <pcwalton> NodeRange is not using OpaqueNode like it should
[17:47:11] *** Joins: bholley (bholley@moz-FCAF9AAB.hsd1.ca.comcast.net)
[17:55:25] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[17:55:25] <ghservo> [13servo] 15pcwalton opened pull request #1426: layout: Make `NodeRange` use `OpaqueNode` for memory safety. (06master...06opaque-node-range) 02http://git.io/grC7Uw
[17:55:26] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[17:55:29] <pcwalton> larsberg: r? https://github.com/mozilla/servo/pull/1426
[17:56:22] <larsberg> pcwalton: I am doing an interview in a couple of minutes, but can get it after that, if that's OK
[17:56:26] <pcwalton> ok, sure
[17:57:32] <larsberg> oh, nm, it's short and awesome :-)
[17:58:49] *** Quits: jaebaek (jaebaek@4D10E9F2.E551553C.7544CABF.IP) (Ping timeout)
[18:01:23] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[18:01:23] <ghservo> 01[13servo01] 15bors-servo pushed 2 new commits to 06auto: 02http://git.io/tyGqow
[18:01:23] <ghservo> 13servo/06auto 14423f5b8 15Patrick Walton: layout: Make `NodeRange` use `OpaqueNode` for memory safety....
[18:01:23] <ghservo> 13servo/06auto 140e14745 15bors-servo: auto merge of #1426 : pcwalton/servo/opaque-node-range, r=larsbergstrom...
[18:01:23] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[18:01:26] *** Joins: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP)
[18:01:26] <ghservo> 01[13servo01] 15bors-servo pushed 0 new commits to 06auto: 02http://git.io/T5M9IA
[18:01:26] *** Parts: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP) ()
[18:05:02] *** Quits: miketaylr (mtaylor@moz-8ACC7131.dyn.grandenetworks.net) (Ping timeout)
[18:10:30] <pcwalton> sweet, servo just compiled with a lifetime-bounded LayoutNode
[18:11:13] <pcwalton> so now layout cannot put nodes in evil places and cause memory safety problems
[18:14:15] *** Quits: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca) (Quit: canhtak)
[18:17:47] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[18:22:37] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[18:22:38] *** ChanServ sets mode: +qo dherman dherman
[18:23:44] *** ahal|lunch is now known as ahal
[18:26:13] *** Joins: ghservo (ghservo@79968228.6A2AE50.F3114085.IP)
[18:26:13] <ghservo> [13servo] 15bors-servo closed pull request #1426: layout: Make `NodeRange` use `OpaqueNode` for memory safety. (06master...06opaque-node-range) 02http://git.io/grC7Uw
[18:26:13] *** Parts: ghservo (ghservo@79968228.6A2AE50.F3114085.IP) ()
[18:26:14] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[18:26:14] <ghservo> 01[13servo01] 15bors-servo merged 06auto into 06master: 02http://git.io/tyGqow
[18:26:14] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[18:34:30] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:34:30] *** ChanServ sets mode: +o brson
[18:35:50] *** kimundi is now known as zz_kimundi
[18:39:35] *** zz_kimundi is now known as kimundi
[18:46:26] *** Quits: abinader (abinader@D8B9C081.E820043D.D4C04133.IP) (Ping timeout)
[18:47:02] *** kimundi is now known as zz_kimundi
[18:49:27] *** Joins: abinader (abinader@FAC83DD0.505FA95.B9657DD5.IP)
[18:50:17] *** Joins: azita (Azita@moz-C07D5168.p2p.sfo1.mozilla.com)
[18:54:28] *** Quits: victorporof (victorporo@C8C495F5.E3195F0D.9B1E38F4.IP) (Ping timeout)
[19:01:43] *** Quits: jet (jet@moz-79F891EE.hsd1.ca.comcast.net) (Quit: jet)
[19:10:50] *** Joins: txdv (quassel@966F3542.3BA477DA.14C26596.IP)
[19:22:15] *** Joins: abinader_ (uid21713@moz-A42E5B7B.irccloud.com)
[19:24:01] <pcwalton> kmc: r? https://github.com/mozilla/servo/pull/1424
[19:24:20] <pcwalton> jack: jdm: ^ you might be interested too. this hardens layout so that I believe it's memory safe w/r/t DOM objects now
[19:24:39] <jdm> oh yeah, I looked through that last night
[19:24:47] <jdm> no, lies
[19:24:48] <jdm> that's new
[19:24:50] <Ms2ger> I had a quick look, but it somehow seemed brittle
[19:24:58] <jdm> you and your building on unmerged PRs
[19:25:09] <pcwalton> oh oops, I need to fix the Element stuff too.
[19:25:10] <kmc> yeah i'm a little confused, bors already merged some of this?
[19:25:11] <Ms2ger> And a lot of `use`s moving around
[19:25:21] <pcwalton> yeah, sorry, I have a tendency to sort "use"
[19:25:21] <kmc> pcwalton: should I look at those last 3 commits?
[19:25:24] <pcwalton> kmc: yeah
[19:25:31] <pcwalton> eventually rustfmt will automatically do it
[19:25:46] <kmc> cool, looking now
[19:26:08] <pcwalton> basically the idea is to whitelist everything layout has access to
[19:26:36] <jdm> I'm a bit sad that LayoutNode is sitting in script/dom/node.rs
[19:26:45] <pcwalton> yes, I think that should probably move out
[19:26:55] <pcwalton> script/dom/node/layout.rs or something
[19:27:03] <Ms2ger> jdm, btw, was I right about JSManaged-on-stack not being safe right now?
[19:27:04] <jdm> does it have to sit in script/?
[19:27:15] <jdm> Ms2ger: for sure
[19:27:17] * pcwalton thinks
[19:27:18] <pcwalton> possibly not
[19:27:18] <abinader_> hi guys :-)
[19:27:20] <pcwalton> I can look
[19:27:32] <pcwalton> into moving it
[19:27:42] <abinader_> I have a question: is there any reason behind using iterators to access Option<T> contents?
[19:27:51] <abinader_> I mean, when it's a single object
[19:28:05] <Ms2ger> I think it's silly :)
[19:28:13] <jdm> Ms2ger: maybe we can incrementally improve by making JSManaged contain Rc<Inner> instead of ~Inner
[19:28:28] <jdm> that should be safe for the same reasons that @ is safe
[19:28:31] *** Quits: joone (joone@moz-8E88FB0F.jf.intel.com) (Ping timeout)
[19:28:46] *** Quits: abinader (abinader@FAC83DD0.505FA95.B9657DD5.IP) (Quit: Fui!)
[19:28:51] <Ms2ger> Hmm
[19:28:55] <jdm> abinader_: mostly for the do syntax sugar
[19:28:59] *** Joins: joone (joone@D8B92C88.BF10F841.A34EC3BB.IP)
[19:29:02] <Ms2ger> I think that might make me less scared
[19:29:04] *** abinader_ is now known as abinader
[19:29:22] <Ms2ger> (So Rc is a pointer?)
[19:29:51] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[19:30:25] *** Joins: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca)
[19:30:59] <abinader> jdm: I see
[19:31:40] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[19:32:08] <abinader> jdm: I'm thinking performance-wise, if this wouldn't bring us a penalty by avoiding simple reference getter (i.e. if value.is_some() { value.get_ref()... }
[19:32:37] <jdm> abinader: the other thing is that it avoids any problem with checking for is_some or not
[19:32:51] <jdm> Ms2ger: Rc is nsRefPtr, basically
[19:33:05] <Ms2ger> Okay
[19:33:09] <Ms2ger> I like nsRefPtr
[19:33:22] <abinader> jdm: yep, definitely makes life easier in that sense
[19:33:52] <Ms2ger> match is cleaner, imo
[19:34:28] <Ms2ger> Hmm, *Immutable* reference counted pointer type?
[19:34:32] <jdm> Ms2ger: RcMut
[19:35:02] <cmr> no, Rc<RefCell<T>>
[19:35:20] <jdm> that too
[19:35:32] <Ms2ger> That sounds like fun
[19:36:07] <jdm> chain: &HEAVY_IRON_BALL
[19:36:11] <jdm> nice
[19:37:33] *** Quits: azita (Azita@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: azita)
[19:40:51] <Ms2ger> jdm, so I guess RefCell also fixes the runtime borrow-checking issue?
[19:41:05] * jdm isn't sure, having never looked at RefCell
[19:41:33] <jdm> http://static.rust-lang.org/doc/master/std/cell/struct.RefCell.html makes it sound like it
[19:42:03] <jdm> I guess that's a design change for JSManaged
[19:42:14] <jdm> since currently it just stores a pointer to the raw DOM type
[19:42:21] <jdm> so now there would be a layer of indirection
[19:42:21] <Ms2ger> Well, a design flaw in the current implementation, no? :)
[19:42:24] <jdm> yeah
[19:42:40] *** Joins: azita (Azita@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[19:42:56] <Ms2ger> And we could get rid of the weird @int too?
[19:44:43] *** Joins: miketaylr (mtaylor@moz-8ACC7131.dyn.grandenetworks.net)
[19:45:29] <jdm> hmm, we may have to move from @ to Rc all at once in that case
[19:45:37] * jdm forgot about that restriction
[19:45:38] <jdm> fun times
[19:45:47] <Ms2ger> Bah
[19:50:51] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[19:50:51] <ghservo> [13servo] 15brunoabinader opened pull request #1427: Make Node::is_in_doc O(1) (06master...06is-in-doc) 02http://git.io/U6IgWA
[19:50:51] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[19:51:55] <Ms2ger> bz will approve
[19:59:34] <eddyb> what about bz2?
[20:01:18] <jdm> s/bz2/dzbarsky
[20:04:20] *** Joins: jet (jet@moz-79F891EE.hsd1.ca.comcast.net)
[20:05:02] <abinader> guys, is there any issue on github related to implementing Document.webidl commented stuff?
[20:05:35] <jdm> abinader: maybe about specific items
[20:05:40] <jdm> not in general, though
[20:06:39] <abinader> jdm: ack :-) I'm interested in implementing document.{head,body...} attributes
[20:07:02] <jdm> abinader: go ahead and file an issue; I don't think those are listed anywhere.
[20:07:29] <abinader> jdm: right! thanks
[20:09:05] <Ms2ger> jdm, hmm, has bz2 worked on Servo?
[20:09:21] <jdm> nope
[20:09:30] <jdm> we should lure him in
[20:09:37] <Ms2ger> We shou... Exactly!
[20:09:44] *** Quits: bholley (bholley@moz-FCAF9AAB.hsd1.ca.comcast.net) (Quit: bholley)
[20:11:09] <abinader> jdm: about your comment, good catch :-) we could check for disconnected trees by checking if parent is also in doc, what do you think?
[20:11:44] <jdm> abinader: I would just set the member to the parent's value
[20:11:55] <jdm> and make sure that the Document node always has a true value
[20:12:01] <Ms2ger> This is why I stuck with the easy approach :)
[20:12:04] <abinader> jdm: yes
[20:12:56] *** Quits: Ms2ger (Ms2ger@BB191E51.D97EE64B.F15B0BB3.IP) (Quit: nn)
[20:13:06] <abinader> jdm: great, I'll update the patch with this logic
[20:15:20] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[20:15:31] *** Joins: victorporof (victorporo@18CBE5E4.20A86B53.2B3D3D4.IP)
[20:15:54] *** Joins: bholley (bholley@moz-FCAF9AAB.hsd1.ca.comcast.net)
[20:18:01] <eddyb> hmm, what?
[20:18:43] <eddyb> I thought Ms2ger meant to say bjz and forgot a letter, so I said "bz2" (bzip, ofc). I'm confused now
[20:22:50] <jdm> bz has a younger brother
[20:22:55] <jdm> who has done a lot of gecko work
[20:23:07] <jdm> and bz is a long-time gecko hacker
[20:27:22] *** Quits: bholley (bholley@moz-FCAF9AAB.hsd1.ca.comcast.net) (Quit: bholley)
[20:34:46] <abinader> jdm: patch is now updated :-) I propagate type_id to NodeFlags::new() so I can set is_in_doc to true if type_id is DocumentNodeTypeId(_)
[20:38:11] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[20:41:08] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[20:41:08] <ghservo> 01[13servo01] 15bors-servo pushed 0 new commits to 06auto: 02http://git.io/7_2MjQ
[20:41:08] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[20:41:11] *** Joins: ghservo (ghservo@F6EE6DE3.6A2AE50.F3114085.IP)
[20:41:11] <ghservo> 01[13servo01] 15bors-servo pushed 2 new commits to 06auto: 02http://git.io/Yc5nwQ
[20:41:11] <ghservo> 13servo/06auto 14cfb73ed 15Bruno de Oliveira Abinader: Make Node::is_in_doc O(1)...
[20:41:11] <ghservo> 13servo/06auto 1444a8b09 15bors-servo: auto merge of #1427 : brunoabinader/servo/is-in-doc, r=jdm...
[20:41:12] *** Parts: ghservo (ghservo@F6EE6DE3.6A2AE50.F3114085.IP) ()
[20:47:32] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[20:47:32] *** ChanServ sets mode: +qo dherman dherman
[21:03:42] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[21:04:58] *** Joins: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP)
[21:04:58] <ghservo> 01[13servo01] 15bors-servo merged 06auto into 06master: 02http://git.io/Yc5nwQ
[21:04:58] *** Quits: hoverbear (hoverbear@EBFA78B5.F19E5E7B.E74D50F2.IP) (Quit: Hibernating, be back soon.)
[21:04:58] *** Parts: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP) ()
[21:05:01] *** Joins: ghservo (ghservo@79968228.6A2AE50.F3114085.IP)
[21:05:01] <ghservo> [13servo] 15bors-servo closed pull request #1427: Make Node::is_in_doc O(1) (06master...06is-in-doc) 02http://git.io/U6IgWA
[21:05:01] *** Parts: ghservo (ghservo@79968228.6A2AE50.F3114085.IP) ()
[21:08:42] *** Quits: alex-abreu (alex@moz-FCCF99D0.w80-9.abo.wanadoo.fr) (Ping timeout)
[21:21:27] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[21:24:31] <jack> pcwalton: can you address hte privacy bits on yoru PR and then rebase your other one?
[21:28:46] *** Joins: hoverbear (hoverbear@EBFA78B5.F19E5E7B.E74D50F2.IP)
[21:29:31] *** Quits: hoverbear (hoverbear@EBFA78B5.F19E5E7B.E74D50F2.IP) (Quit: Hibernating, be back soon.)
[21:30:50] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[21:30:50] *** ChanServ sets mode: +o pcwalton
[21:32:16] <jack> pcwalton: can you address hte privacy bits on yoru PR and then rebase your other one?
[21:33:17] <pcwalton> jack: which PRs?
[21:33:40] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[21:34:00] <jack> 1422 was reviewed but needs privacy changes
[21:34:13] <jack> 1424 i'm reivewing now but will need rebasing if you modify 1422
[21:34:38] <pcwalton> ok
[21:35:34] <jack> pcwalton: why did you change this to a bare impl from the impl TNode? https://github.com/pcwalton/servo/commit/d58c2ece7cc3440e84c56fa35293438b247e1942#diff-02fea8678d0cba8673c67b8750cd478cR317
[21:37:21] <pcwalton> eventually it's going to have to be different because of exact rooting reasons
[21:37:27] <pcwalton> it'll have to return Rooted<AbstractNode>
[21:39:39] <jack> so if TNode only exists to appease style, why impl it at all in script?
[21:40:10] <jack> oh . layoutnode has to implement it obviously
[21:40:21] <jack> and you basically did what i am now suggesting. i see.
[21:40:56] <pcwalton> I'm working on moving LayoutNode to layout
[21:40:58] <pcwalton> it has no users in script
[21:43:09] *** Joins: valenting (Thunderbir@9A1975C1.39CE2EE.E400A05F.IP)
[21:43:16] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[21:43:47] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[21:44:48] <jack> that sounds good too.
[21:45:35] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[21:46:52] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[21:46:57] <pcwalton> jack: updated 1422
[21:47:40] <pcwalton> I'm slightly uncomfortable with using a simple whitelist to harden layout
[21:47:50] <pcwalton> but if it makes layout simpler by restricting what it can do then hey, that's a good thing
[21:48:15] *** Joins: ghservo (ghservo@79968228.6A2AE50.F3114085.IP)
[21:48:15] <ghservo> [13servo] 15brunoabinader opened issue #1428: Implement Document's missing attributes/methods 02http://git.io/Y32-xQ
[21:48:15] *** Parts: ghservo (ghservo@79968228.6A2AE50.F3114085.IP) ()
[21:48:17] <pcwalton> and I think our situation is complex enough that a whitelist is really the simplest solution
[21:48:25] <pcwalton> our memory management situation for the DOM
[21:48:58] <jack> whitelisting how?
[21:49:19] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[21:49:19] <ghservo> 01[13servo01] 15bors-servo pushed 2 new commits to 06auto: 02http://git.io/4hYf6Q
[21:49:19] <ghservo> 13servo/06auto 14199ca33 15Patrick Walton: script: Make trees less generic
[21:49:19] <ghservo> 13servo/06auto 14e449545 15bors-servo: auto merge of #1422 : pcwalton/servo/less-generic-trees, r=metajack...
[21:49:19] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[21:50:56] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[21:52:17] *** Joins: vodik (simon@AB4CFA9A.7B706B64.578F951C.IP)
[22:02:27] *** bhearsum is now known as bhearsum|afk
[22:04:44] *** Quits: jet (jet@moz-79F891EE.hsd1.ca.comcast.net) (Quit: jet)
[22:05:09] *** Joins: jet (jet@moz-79F891EE.hsd1.ca.comcast.net)
[22:06:42] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[22:09:07] <jack> pcwalton: i am assuming you mean moving abstract node access functions into the implementation instead of exposing with_element typ emethods
[22:09:16] <pcwalton> jack: oh, sorry, missed that
[22:09:37] <jack> pcwalton: r+ on 1424 once it's rebased.
[22:09:49] <pcwalton> what I mean is that LayoutNode explicitly exposes only the functions that layout is allowed to call instead of having a View phantom type
[22:10:05] <pcwalton> and just saying that layout is not allowed to access anything in script directly, full stop
[22:10:44] *** Joins: ghservo (ghservo@79968228.6A2AE50.F3114085.IP)
[22:10:45] <ghservo> 01[13servo01] 15bors-servo merged 06auto into 06master: 02http://git.io/4hYf6Q
[22:10:45] *** Parts: ghservo (ghservo@79968228.6A2AE50.F3114085.IP) ()
[22:10:47] *** Joins: ghservo (ghservo@79968228.6A2AE50.F3114085.IP)
[22:10:47] <ghservo> [13servo] 15bors-servo closed pull request #1422: script: Make trees less generic (06master...06less-generic-trees) 02http://git.io/-0jZzQ
[22:10:47] *** Parts: ghservo (ghservo@79968228.6A2AE50.F3114085.IP) ()
[22:13:18] <jack> i'm so used to rust integration now that servo seems ridiculously fast
[22:13:37] <cmr> hm?
[22:13:39] <pcwalton> :)
[22:13:46] <cmr> the build?
[22:13:47] <pcwalton> oh, this Element thing may be easier than I thought
[22:13:54] <pcwalton> we're close to totally memory safe layout...
[22:14:07] <jack> cmr: yes. 3+ hours compared to 10-12 minutes.
[22:15:18] *** Quits: jackneill (jackneill@moz-B6F27E42.pool.digikabel.hu) (Ping timeout)
[22:16:29] <jack> jgraham: Critic totally down?
[22:17:49] *** Quits: jet (jet@moz-79F891EE.hsd1.ca.comcast.net) (Quit: jet)
[22:25:37] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[22:31:28] *** Joins: pradeep (pradeep@5AB4884B.FCC4549.14D5B978.IP)
[22:31:41] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Quit: brendan)
[22:33:44] <jgraham> jack: It was, but should be up again now
[22:33:50] <jgraham> Like in the last 60 seconds :)
[22:34:42] <jgraham> Sorry for the service interuption. In good news, we get a newer version
[22:35:33] <jgraham> (it is possible that things are still broken, particularly with the github integration.)
[22:35:59] *** Joins: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com)
[22:37:10] *** Quits: brendan (brendaneic@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[22:37:16] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[22:42:19] <jack> jgraham: does it not handle renames?
[22:42:35] <jack> i shows added on one file, and deleted on the other, and it's lost the diff entirely
[22:42:41] <jgraham> jack: You mean when a commit renames a file?
[22:42:57] <jgraham> It handles them in the same way that git does
[22:43:08] <jgraham> By heuristic detection of moved code
[22:43:09] <jack> github i think shows me the diff at least
[22:43:24] <jgraham> You have to press the "m" key to see it though
[22:44:11] <jack> hmm.
[22:44:16] <jack> github is also failing here.
[22:44:20] <jack> mabye i misread something
[22:44:29] <jgraham> jack: Which review?
[22:44:43] <jgraham> In https://critic.hoppipolla.co.uk/servo/369c5b8329414411200ab0d638e73f203a278dfc?review=468 I see files deleted and files added
[22:45:06] <jgraham> and the moved code detection confirms that they are just renames
[22:46:05] <jack> jgraham: i hit m and it appears now to show me a two column view
[22:46:13] <cmr> in critic?
[22:46:14] <jack> and now i can't review code anymore and i'm not sure how to get back
[22:46:16] <jack> yes
[22:46:22] <cmr> ohh that's nice
[22:47:19] <jack> back button goes back, but aparently i can't actually do a review in that 'm' screen that i get after detecting renames
[22:47:25] <jgraham> jack: Hmm
[22:47:36] <jgraham> I'm not sure why, but it's the same for me
[22:48:01] <jack> also space cycles through the whole window over and over
[22:48:06] <jack> maybe there's a javascript bug?
[22:49:09] <jack> the seal of approval is humorous :)
[22:49:39] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[22:49:39] *** ChanServ sets mode: +o pcwalton
[22:49:55] <jgraham> jack: Yeah, the space thing sounds like a bug
[22:50:12] <jack> jgraham: other than that it was quite pleasant actually
[22:50:32] <jgraham> jack: https://github.com/jensl/critic/issues for bug reports
[22:52:22] <jgraham> https://github.com/jensl/critic/issues/52 seems to be a general issue for better moved file detection
[22:52:56] <jack> jgraham: what's your github username?
[22:53:51] <jgraham> jack: jgraham
[22:54:33] <jack> stupid github. wouldn't autocomplete, but that is what i trie.d
[22:56:20] *** Joins: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP)
[22:56:20] <ghservo> 01[13servo01] 15bors-servo pushed 0 new commits to 06auto: 02http://git.io/d9AqOw
[22:56:20] *** Parts: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP) ()
[22:56:26] *** Joins: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP)
[22:56:26] <ghservo> 01[13servo01] 15bors-servo pushed 5 new commits to 06auto: 02http://git.io/VD0GTw
[22:56:26] <ghservo> 13servo/06auto 14513ff02 15Tetsuharu OHZEKI: Remove the needless comment.
[22:56:26] <ghservo> 13servo/06auto 1456ba7fc 15Tetsuharu OHZEKI: Introduce 'NullCompositor'.
[22:56:27] <ghservo> 13servo/06auto 1445b297b 15Tetsuharu OHZEKI: Rename main/compositing/mod.rs to main/compositing/compositor_task.rs.
[22:56:29] *** Parts: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP) ()
[22:58:10] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[23:02:09] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[23:05:09] <jack> error: cannot implement a destructor on a structure that does not satisfy Send
[23:05:22] <pcwalton> jack: just use #[unsafe_destructor]. this will be lifted eventually
[23:05:23] <jack> wat?
[23:05:31] <jack> why is that a limitation?
[23:05:42] <jack> Why is Send related to dtors?
[23:05:50] <pcwalton> because GC will invoke destructors in arbitrary order
[23:05:57] <pcwalton> and if there are cycles you could access dead memory
[23:06:06] <pcwalton> eventually I think we will fix this with Hans Boehm's suggestion
[23:06:11] <jack> oh so send is a proxy for no-cycles
[23:06:14] <pcwalton> yeah
[23:06:21] <cmr> what did he suggest?
[23:06:40] <pcwalton> don't kill ANY objects until ALL condemned objects have their destructors run
[23:06:48] <pcwalton> in a single GC cycle
[23:06:53] <jack> oh my gosh. i love lifetimes sometimes.
[23:07:00] <pcwalton> kind of obvious, but it's amazing how many languages get this wrong...
[23:07:19] <cmr> Does that actually work? You're going to be trying to call methods on something that could have already been destroyed.
[23:07:33] <pcwalton> nope, the beauty of it is that nothing is yet dead!
[23:07:36] <jack> cmr: you can set a flag :)
[23:07:39] <pcwalton> I mean, something might be *finalized*
[23:07:40] <jack> for example
[23:07:43] <pcwalton> but it won't be *destroyed*
[23:07:53] <cmr> well by destroyed I just mean had the destructor run.
[23:08:12] <cmr> jack: the drop flag already 
[23:08:17] <cmr> makes me sad
[23:08:26] <pcwalton> yeah, I guess it's not quite that simple because of unique pointers
[23:08:46] <pcwalton> e.g. if an object is holding onto some externally managed resource and drops it in its destructor
[23:09:12] <cmr> but for instance say you have a cycle and one of the objects in that cycle is a file. it's closed when its destructor is run, and then another things' destructor tries to read from the now-closed file...
[23:09:17] <strcat> pcwalton: we won't have drop flags
[23:09:23] <strcat> it doesn't really make sense to me
[23:09:26] <pcwalton> yes, I know
[23:09:39] <strcat> hm
[23:09:39] <cmr> so I don't see how it can work
[23:10:09] <pcwalton> cmr: well, that isn't a memory safety problem
[23:10:10] <pcwalton> with files
[23:10:19] <strcat> pcwalton: fclose on a file twice is UB
[23:10:35] <strcat> or do you mean because you can't take refs
[23:10:35] <pcwalton> yeah, the problem is externally memory managed junk
[23:10:57] <cmr> pcwalton: it's a pretty serious correctness problem.
[23:11:08] <cmr> but my response is just "don't make cycles like that" ;p
[23:11:13] <pcwalton> yes, of course it is, but we have to decide what to do
[23:11:23] <pcwalton> I wonder if we should just fail the task and set a taint bit
[23:11:35] <pcwalton> Python and Go just silently leak
[23:11:43] <pcwalton> I would rather do something better, taint bits may be good for this
[23:14:01] *** Quits: miketaylr (mtaylor@moz-8ACC7131.dyn.grandenetworks.net) (Connection reset by peer)
[23:14:05] *** Joins: miketaylrrrr (mtaylor@moz-8ACC7131.dyn.grandenetworks.net)
[23:17:46] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[23:18:21] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[23:18:49] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[23:19:15] *** Quits: k4nar (quassel@moz-F5EFF779.kimsufi.com) (Ping timeout)
[23:19:16] *** Joins: k4nar (quassel@moz-F5EFF779.kimsufi.com)
[23:20:35] <strcat> pcwalton: what would taint bits actually do?
[23:20:39] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[23:20:51] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[23:21:30] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[23:21:30] <ghservo> 01[13servo01] 15bors-servo merged 06auto into 06master: 02http://git.io/VD0GTw
[23:21:30] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[23:21:31] *** Joins: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP)
[23:21:31] <ghservo> [13servo] 15bors-servo closed pull request #1425: Clean up compositor codes (06master...06compositor) 02http://git.io/YB1-Sg
[23:21:31] *** Parts: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP) ()
[23:23:19] <jack> the borrow checkeri s mad at me
[23:23:56] *** Quits: valenting (Thunderbir@9A1975C1.39CE2EE.E400A05F.IP) (Quit: valenting)
[23:24:37] * strcat just wants to be able to turn off that #[unsafe_destructor] thing for programs without gc
[23:26:23] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[23:27:01] <jack> error: type `std::cell::RefCell<msg::constellation_msg::SubpageId>` does not implement any method in scope named `get`
[23:27:09] <jack> come on rustc. give me a break.
[23:27:50] <jack> oh. of course this is added in an even later rust commit than i'm using
[23:28:12] *** Joins: valenting (Thunderbir@9A1975C1.39CE2EE.E400A05F.IP)
[23:28:36] <pcwalton> strcat: basically what the taint bits do in the linux kernel
[23:28:44] <pcwalton> just something for you to add to your crash reports ;)
[23:29:06] <strcat> pcwalton: wouldn't it be the end of saying rust is memory safe then? I don't really get it
[23:29:10] *** Quits: txdv (quassel@966F3542.3BA477DA.14C26596.IP) (Ping timeout)
[23:29:13] <pcwalton> I was envisioning popping up a "door hanger" notification in a servo-based browser saying "A problem has been detected, I suggest saving your work and restarting"
[23:29:21] <pcwalton> no it wouldn't be memory unsafe
[23:29:25] <pcwalton> what I mean is, leak the objects
[23:29:26] <pcwalton> and set a taint bit
[23:29:28] <strcat> oh
[23:29:33] <pcwalton> saying "hey, there are leaks, user, you might want to restart"
[23:29:43] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[23:29:56] <strcat> if you're going to have to worry about cycles yourself, why use gc though?
[23:30:06] <pcwalton> just cycles with custom destructors
[23:30:26] <strcat> so, vectors
[23:30:47] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[23:30:47] *** ChanServ sets mode: +o brson
[23:30:52] *** Joins: txdv (quassel@966F3542.3BA477DA.14C26596.IP)
[23:31:13] <strcat> dtors are really common ;\
[23:31:20] <strcat> pcwalton: does it apply to unique ptrs too?
[23:31:25] <pcwalton> hmm
[23:31:30] <pcwalton> I haven't thought too deeply about it
[23:32:15] <jack> pcwalton, nmatsakis: any idea why this fails with a double mutable borrow? https://gist.github.com/metajack/8014725#file-hubbub_html_parser-rs-L525
[23:32:39] <jack> it claims set_tree_handler is the second mutable borrow (by which i think it means the first one?)
[23:32:57] <jack> there are ~4 calls to &mut self methods here, so i'm not sure why it's yelling about this particular call.
[23:33:16] <strcat> it seems like there's the naive solution of just running the mark+sweep twice
[23:33:31] <strcat> one to call dtors, again to free managed ptrs? *shrug*
[23:33:42] *** Quits: eholk (eholk@moz-BA312F07.crest.iu.edu) (Quit: eholk)
[23:33:45] <pcwalton> that's what hans boehm suggests
[23:33:56] <nmatsakis> jack: is it a dynamic failure?
[23:34:04] <jack> nmatsakis: no. compile time.
[23:34:26] <jack> the parser TreeHandlers used to be ~fn() but I changed it to stack closures
[23:34:39] <nmatsakis> jack: can you tell me what the errors are
[23:35:26] <nmatsakis> jack: might be related to the loop, possibly a bug
[23:35:52] <jack> I'll tell you as soon as this compile of rust finishes. I upgraded before I captured the exact error message
[23:36:17] <jack> nmatsakis: I can try to scope it in the loop I suppose
[23:41:55] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[23:43:55] <pcwalton> jack: r? https://github.com/mozilla/servo/pull/1424
[23:46:39] <jack> some of this is new?
[23:47:03] *** Quits: valenting (Thunderbir@9A1975C1.39CE2EE.E400A05F.IP) (Ping timeout)
[23:48:19] <pcwalton> jack: yeah, it's more complete and safer
[23:48:25] <pcwalton> since it doesn't expose Element
[23:48:35] <pcwalton> I think this makes layout treatment of DOM nodes totally memory safe
[23:49:22] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[23:51:28] *** Joins: deokjinkim (Mibbit@B4104EBB.3CC170B1.1E14B209.IP)
[23:52:37] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[23:52:37] *** ChanServ sets mode: +o brson
[23:53:41] <jack> pcwalton :do i need to rereview the whole thing, or were their only additons?
[23:53:44] *** Quits: pauls (pauls@moz-7140CF01.ccs.neu.edu) (Client exited)
[23:53:58] *** Quits: vodik (simon@AB4CFA9A.7B706B64.578F951C.IP) (Ping timeout)
[23:55:07] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[23:56:34] <pcwalton> jack: only additions
[23:59:05] <jack> ah. i see. some of this was in another pull request right?
[23:59:17] <jack> or did kmc just comment only on the later commits?
