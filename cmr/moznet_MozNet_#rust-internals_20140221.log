[00:01:35] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[00:04:23] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[00:05:27] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[00:16:49] *** Joins: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP)
[00:16:49] <ghrust> [13rust] 15bors 04force-pushed 06auto from 148b76893 to 146532d2f: 02http://git.io/N3iJvQ
[00:16:49] *** Parts: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP) ()
[00:16:50] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[00:16:50] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/evvmdw
[00:16:50] <ghrust> 13rust/06auto 1413cd66b 15mr.Shu: Changed NonCamelCaseTypes lint to warn by default...
[00:16:50] <ghrust> 13rust/06auto 1432d64e1 15bors: auto merge of #12290 : mrshu/rust/lint-warn-by-default, r=alexcrichton...
[00:16:50] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[00:18:06] *** Quits: jdm (jdm@CC0122E6.8F96AEA7.2D179A7D.IP) (Quit: Lost terminal)
[00:37:13] *** Joins: DEIRDRE811 (DEIRDRE811@moz-69FD5C10.pools.arcor-ip.net)
[00:39:05] <DEIRDRE811> take part in    distinguished browser fun game   http://is.gd/magego
[00:39:15] *** Quits: DEIRDRE811 (DEIRDRE811@moz-69FD5C10.pools.arcor-ip.net) (Client exited)
[00:51:27] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[00:51:27] *** ChanServ sets mode: +ao dherman dherman
[00:56:53] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[00:56:53] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/QeRN7w
[00:56:53] <ghrust> 13rust/06auto 147bb498b 15Alex Crichton: Mass rename if_ok! to try!...
[00:56:53] <ghrust> 13rust/06auto 147e9bcc5 15bors: auto merge of #12401 : alexcrichton/rust/if-ok-2-try, r=brson...
[00:56:53] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[00:57:37] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[00:58:03] *** Joins: erickt (Adium@moz-BDF423C7.hfc.comcastbusiness.net)
[01:06:53] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[01:08:57] <ChrisMorgan> Is @mut T replaced by Gc<Cell<T>>?
[01:09:54] <ChrisMorgan> Or is it more generally Gc<RefCell<T>>?
[01:10:40] <acrichto> Gc<RefCell<T>>
[01:10:48] <acrichto> Cell<T> -> T: Pod
[01:11:07] <ChrisMorgan> Yeah, that's what I discovered.
[01:11:28] <strcat> ChrisMorgan: you should probably use Rc for now though
[01:11:35] <strcat> Gc is not really implemented yet.
[01:11:37] <ChrisMorgan> Hmm. How does `let x = box(GC) RefCell::new(obj)` look?
[01:11:53] <strcat> it's just a slower refcounting ptr without weak ptrs + it holds onto data too long
[01:11:54] <ChrisMorgan> (Just wondering so I can provide an alternative in http://stackoverflow.com/questions/21922991/how-do-i-make-my-struct-fields-mutable-when-accessing-through-a-shared-box-ptr/21923159#21923159.)
[01:12:34] * ChrisMorgan mistypes "aroudn" four times in a row before finally going slow enough to get it right
[01:16:31] <ChrisMorgan> Eww, you've got to use with_mut to modify it? â˜¹
[01:19:16] <strcat> ChrisMorgan: you can use the RAII methods
[01:19:21] <strcat> ChrisMorgan: they return a reference-like object
[01:19:42] <strcat> acrichto: btw, going to go ahead and switch Eq/Ord to officially being a total order...
[01:19:51] <strcat> floats can be considered buggy for now
[01:20:03] <strcat> until the IEEE754 ordering is implemented...
[01:20:10] <strcat> need to add intrinsics for the weak order
[01:20:15] <acrichto> strcat: I haven't been following the issue, but I remember niko requesting a formal RFC, which you may wish to do
[01:20:30] <strcat> acrichto: yeah, I will write it up
[01:21:01] <ChrisMorgan> OK, .with_mut(|x| â€¦) â†’ x = .borrow_mut().get(). Lots of borrow and stuff here â˜¹
[01:21:35] <strcat> acrichto: I think the solution is something everyone will agree on though
[01:22:13] <brson> strcat: +1 on fixing Eq/Ord
[01:22:15] <strcat> IEEE754 defines both the weak order and the total order, so we can implement Eq/Ord for floats with a total order
[01:22:21] <strcat> Eq will be as fast
[01:22:25] <strcat> Ord will be a bit slower
[01:22:35] <strcat> but we'll still provide the weak ordering via intrinsics + methods
[01:22:43] <strcat> they can just be on the Float trait
[01:23:05] <strcat> Eq just ends up being a bitwise comparison
[01:23:13] <strcat> since -0.0 and 0.0 are supposed to be non-equal in the total order
[01:23:24] <strcat> and different kinds of NaNs are supposed to be non-equal
[01:23:44] <strcat> the comparison is a bit trickier, and I need to get my hands on the IEEE754 standard to see how NaNs are supposed to be ordered...
[01:23:54] <strcat> order comparison*
[01:24:44] <strcat> x < y and x > y might remain the same speed
[01:24:50] <strcat> but <= and >= would be slower
[01:25:18] <strcat> not sure about NaNs though...
[01:25:21] * strcat sighs
[01:25:51] <erickt> Hey folks. I'm trying to debug a doctest, but it's kind of hard without actually seeing the source file it's trying to build. Does anyone know how to generate them?
[01:26:01] <strcat> erickt: some python extract script?
[01:26:03] * strcat shrugs
[01:26:06] <strcat> I'd look in src/etc
[01:28:39] *** Joins: ktt3ja (ktt3ja@moz-85E2770C.hsd1.va.comcast.net)
[01:29:44] <strcat> it's not possible to have a sane PartialOrd trait anyway
[01:29:58] <strcat> because you'd expect any type with a total ordering to implement it... but floats have 2 ways of doing comparisons
[01:30:13] <strcat> so screw it, floats can live in their own messed up world with a Float trait ;\
[01:30:40] <acrichto> erickt: the name of the test is related to the module that it's in
[01:30:44] <acrichto> erickt: what's the name of the test?
[01:30:47] <acrichto> the failing one
[01:31:03] <erickt> acrichto: it's in my hash PR
[01:31:06] <strcat> so many derivings to fix
[01:31:27] <erickt> acrichto: https://github.com/mozilla/rust/pull/11863/files#diff-9e428a5cf51eac3927c751434d4d16eeR19
[01:31:48] <acrichto> erickt: what's the error?
[01:32:00] <erickt> acrichto: it's complaining about the collision between the old hash_old::Hash and the new Hash being in scope at the same time
[01:32:10] <acrichto> ah, hurray preludes!
[01:32:29] <acrichto> I think you can probably remove Hash from the prelude
[01:32:35] <erickt> ok
[01:32:40] <acrichto> I don't actually think there's a reason for it to be in there
[01:32:42] <acrichto> (I could be wrong)
[01:32:46] * strcat is happy that debian/ubuntu are switching to systemd
[01:33:08] <strcat> I can switch playpen to the sane cgroup API ;)
[01:33:10] <erickt> acrichto: no reason I think but convenience
[01:34:19] <brson> acrichto: how do you feel about dump!?
[01:34:48] <strcat> how do you feel about dumpâ€½ *
[01:34:55] <strcat> rust needs interrobang macros
[01:35:08] <acrichto> brson: more in the negative direction than the positive
[01:35:15] <strcat> rusti: fn fooâ€½() {}
[01:35:15] -rusti- <anon>:10:15: 10:15 error: unknown start of token: \u203d
[01:35:15] -rusti- <anon>:10         fn fooâ€½() {}
[01:35:16] -rusti-                         ^
[01:35:16] -rusti- application terminated with error code 101
[01:35:20] <strcat> :(
[01:35:30] <brson> i'm also not all that enthusiastic
[01:35:54] <brson> a little worried that log is atrophied, everybody using println debugging
[01:35:57] <acrichto> if we were sure of the fate of {:?} I would feel better, but we are unsure about its fate
[01:36:10] <strcat> it's much less useful now that it can't print vectors
[01:36:11] <brson> in fact, doesn't `debug!(anything)` work?
[01:36:19] <acrichto> no
[01:36:27] <brson> are you sure!?
[01:36:31] <strcat> hm, odd.
[01:36:33] <acrichto> rusti: debug!(1)
[01:36:34] -rusti- <anon>:10:16: 10:17 error: format argument must be a string literal.
[01:36:34] -rusti- <anon>:10         debug!(1)
[01:36:34] -rusti-                          ^
[01:36:34] -rusti- error: aborting due to previous error
[01:36:34] -rusti- application terminated with error code 101
[01:36:37] <strcat> an a.cmp(b) comparison broke
[01:36:41] <strcat> but the signature is the same...
[01:36:43] <strcat> wut.
[01:36:49] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[01:37:03] <acrichto> brson: debugging a generic value is hard because debug!("foo") should still print as `foo`
[01:37:06] <acrichto> not `"foo"`
[01:37:11] <strcat> aha, I think it's calling the borrowed ptr one now
[01:37:14] <strcat> that must be it
[01:37:22] <strcat> yeah
[01:37:26] <strcat> auto-deref quirk.
[01:37:29] <strcat> a.cmp(b)
[01:37:43] <strcat> &T implements cmp, so if a is &T, then it expects &&T for other
[01:37:45] * strcat sighs
[01:38:08] <strcat> I don't know why it worked with TotalOrd.
[01:38:23] *** Joins: zimbabao (rajaram@79767624.B67BB2DC.D2D1FAF0.IP)
[01:39:23] <strcat> silly issue
[01:40:01] <acrichto> brson: how much do you know about auxilary + compiletest on android?
[01:40:22] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[01:40:50] <brson> acrichto: not much. I can't imagine off hand that it even works. does it?
[01:41:42] <acrichto> brson: I finally figured out why my PR for rlibs-and-dylibs was never working, and it's because it's testing the case that there are two libraries with the same name in two locations. To accomplish this I created a blank libcollections, but on android everything is uploaded to the same path so they overwrite each other
[01:41:56] <acrichto> I added // ignore-android to the test, but it still failed for the same reason
[01:42:02] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[01:42:07] <acrichto> I was curious if android forcibly uploads builds of all aux-build things
[01:44:09] <brson> acrichto: the code is in arm_push_aux_shared_library in compiletest::runtest
[01:44:20] <brson> it *looks* like it pushes a specific dylib
[01:44:30] <brson> oh, actually, it looks like it pushes all dylibs
[01:44:49] <acrichto> hm, I'll need to add a way for it to ignore a dylib
[01:45:09] <brson> that code looks pretty sketchy anyway
[01:45:19] <brson> there's no real reason it should push *all* aux libs on every test
[01:45:38] <acrichto> it surely doesn't do it for every test
[01:45:52] <brson> that's what it looks like to me
[01:46:09] <acrichto> that's terrifying
[01:46:20] <brson> maybe `adb push` is short-circuited when the file's already there
[01:46:40] <acrichto> oh no aux_output_dir_name is per test
[01:46:42] * strcat hates adb
[01:46:52] <strcat> mtp is even worse though
[01:46:52] <sfackler> it's pretty bad
[01:46:57] <brson> acrichto: ah
[01:47:03] <strcat> sfackler: have you used mtp? it's far worse ;p
[01:47:18] <acrichto> brson: android tests start out by cleaning /data/tmp, right?
[01:47:18] <strcat> it's pretty much guaranteed to corrupt the file and fail
[01:47:27] <brson> acrichto: yes?
[01:47:32] <strcat> at least with a 10GiB video...
[01:47:36] *** Quits: zimbabao (rajaram@79767624.B67BB2DC.D2D1FAF0.IP) (Ping timeout)
[01:47:41] <acrichto> brson: hm, maybe I did something wrong then
[01:48:12] <acrichto> brson: welp. I added two tests and only ignored one
[01:48:52] <brson> acrichto: well, I know those files get deleted at some point, but I don't see the code that does it offhand
[01:49:33] <acrichto> $(shell $(CFG_ADB) shell rm -r $(CFG_ADB_TEST_DIR) >/dev/null)
[01:49:36] <acrichto> I'd guess that does it
[01:49:44] <acrichto> mk/tests.mk:157
[01:51:26] <acrichto> brson: r? https://github.com/mozilla/rust/pull/11603
[02:00:01] *** Joins: andrew-__ (andrew-d_w@moz-5A92CAFF.dsl.static.sonic.net)
[02:00:18] *** Joins: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP)
[02:00:18] <ghrust> [13rust] 15alexcrichton 04force-pushed 06try from 147c98d8e to 1423c3770: 02http://git.io/k471pw
[02:00:18] <ghrust> 13rust/06try 1423c3770 15Alex Crichton: Roll std::run into std::io::process...
[02:00:18] *** Parts: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP) ()
[02:00:41] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Ping timeout)
[02:01:44] *** Quits: andrew-__ (andrew-d_w@moz-5A92CAFF.dsl.static.sonic.net) (Ping timeout)
[02:04:40] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[02:05:59] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Ping timeout)
[02:08:30] *** Joins: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP)
[02:11:54] *** Joins: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP)
[02:11:55] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/QeRN7w
[02:11:55] *** Parts: ghrust (ghrust@4BC7FFDD.6A2AE50.F3114085.IP) ()
[02:12:20] <strcat> ah right I need to teach deriving about cmp so it derives an efficient impl
[02:12:44] *** Quits: cgaebel (clark@ADA4DDE2.290DF317.EE6E63A5.IP) (Quit: ChatZilla 0.9.90.1 [Firefox 27.0.1/20140218135856])
[02:12:58] *** Quits: sunfish (chatzilla@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[02:16:55] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[02:16:55] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/VRijEQ
[02:16:55] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[02:16:57] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[02:16:57] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/IsOkrg
[02:16:57] <ghrust> 13rust/06auto 14fb4b8e9 15Alex Crichton: Force all lang items to be reachable...
[02:16:57] <ghrust> 13rust/06auto 148dae40d 15bors: auto merge of #11603 : alexcrichton/rust/issue-11591, r=brson...
[02:16:57] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[02:28:54] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[02:30:47] <enix> Is there a target that just makes the tests extracted from the code comments?
[02:30:53] <enix> make check-doc doesn't seem to do it
[02:34:26] *** Joins: lpy (lpy@12172131.F09091A8.1348A864.IP)
[02:39:49] <acrichto> enix: rustdoc --test foo.rs
[02:41:34] <enix> cool. I think make check-stage2-T-x86_64-unknown-linux-gnu-H-x86_64-unknown-linux-gnu-doc-std-exec NO_REBUILD=1
[02:41:47] <enix> also works, but rustdoc --test foo.rs looks much easier to remember
[02:42:00] <enix> thanks!
[02:43:55] *** Joins: zimbabao (rajaram@79767624.B67BB2DC.D2D1FAF0.IP)
[02:50:05] <erickt> acrichto: other than us deciding whether or not `#[deriving(Hash)]` should be internally using `#[allow(default_type_param_usage)]`, I think with my latest push I'm done: https://github.com/mozilla/rust/pull/11863 :)
[02:51:58] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[02:51:58] <ghrust> [13rust] 15bors 04force-pushed 06auto from 148dae40d to 147e9bcc5: 02http://git.io/N3iJvQ
[02:51:58] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[02:51:58] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[02:51:58] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/zzO4EA
[02:51:58] <ghrust> 13rust/06auto 14afa5f57 15Alex Crichton: Re-work loading crates with nicer errors...
[02:51:58] <ghrust> 13rust/06auto 14d70f909 15bors: auto merge of #12164 : alexcrichton/rust/rlibs-and-dylibs, r=cmr...
[02:51:59] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[02:53:47] *** Quits: lpy (lpy@12172131.F09091A8.1348A864.IP) (Client exited)
[02:56:01] *** Joins: mawuli (mawuli@moz-36C70B7D.com.gh)
[02:58:22] <acrichto> erickt: looks awesome!
[02:58:27] *** Quits: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net) (Quit: Textual IRC Client: www.textualapp.com)
[03:00:05] *** Joins: lpy (lpy@12172131.F09091A8.1348A864.IP)
[03:01:29] *** Quits: zxcdw (r-a@5F0EDB29.B543C4DE.3933CC16.IP) (Ping timeout)
[03:02:17] <erickt> woo
[03:03:18] <acrichto> erickt: https://github.com/mozilla/rust/issues/12423 
[03:03:32] <acrichto> if that's a valid issue, then I think you should remove the attribute
[03:03:38] <acrichto> if it's not a valid issue, the attribute can stay
[03:04:10] *** Joins: zxcdw (r-a@5F0EDB29.B543C4DE.3933CC16.IP)
[03:04:32] <erickt> acrichto: I cced eddyb on that issue. I'm not sure
[03:05:23] <erickt> acrichto: unfortunately I need to go to bed to catch an early flight. I can remove it tomorrow, or we could land this now and I can fix it tomorrow :)
[03:06:07] *** Joins: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net)
[03:06:51] <acrichto> hm, I want this
[03:06:55] <acrichto> r+ for yoouuuuuuuuuu
[03:07:04] <erickt> hehe ok!
[03:08:22] <erickt> i'll also fix up my post-snapshot patch so we can kill off hash_old.rs :)
[03:08:35] <erickt> anywho gnight all! thanks acrichto for the help!
[03:09:34] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[03:12:01] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[03:16:00] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[03:18:14] *** Quits: erickt (Adium@moz-BDF423C7.hfc.comcastbusiness.net) (Quit: Leaving.)
[03:19:23] *** Quits: lpy (lpy@12172131.F09091A8.1348A864.IP) (Ping timeout)
[03:24:13] *** Quits: Diamond (dick@moz-80556682.ks.ks.cox.net) (Client exited)
[03:27:38] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[03:48:34] *** Quits: zz_kimundi (kimundi@moz-767272DB.dip0.t-ipconnect.de) (Ping timeout)
[03:52:14] *** Joins: zz_kimundi (kimundi@moz-3202B743.dip0.t-ipconnect.de)
[03:52:16] *** zz_kimundi is now known as kimundi
[04:11:52] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[04:14:09] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[04:21:14] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[04:36:35] <sfackler> acrichto: ping
[04:36:42] <acrichto> sfackler: pong
[04:37:15] <sfackler> now that we can write generic destructors (yay!), what should the behavior of BufferedWriter's be if the flush fails?
[04:37:26] <sfackler> I was thinking fail unless already failing
[04:37:44] <acrichto> hm, this is one of the same problems with TempFile
[04:37:52] <acrichto> what to do if removal of the temporary directory fails
[04:37:58] <sfackler> yeah
[04:37:59] <acrichto> I would be tempted to ignore it
[04:38:05] <acrichto> but fail unless failing is an interesting option
[04:38:16] <sfackler> what I've been doing in my own stuff is to fail in the Drop impl and have a separate method that takes self by value and returns a Result
[04:38:41] <sfackler> so you can handle it if you want, and you won't lose stuff without knowing in the easy case
[04:39:03] *** Joins: lpy (lpy@7360AA58.F09091A8.1348A864.IP)
[04:39:16] <acrichto> we're generally trying to avoid failure in the stdlib though, so I wonder if failing if not failing is the best idea
[04:39:26] <acrichto> it is pretty easy to sweep under the rug by accident
[04:40:26] <sfackler> I think this is one of the few places where the only thing to do is to fail
[04:40:48] <sfackler> the other method is an out for code that wants to avoid the failure bloat
[04:41:26] <acrichto> it does make it easy to silently introduce failure by accident though
[04:42:07] <sfackler> yeah
[04:42:07] *** Joins: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP)
[04:42:07] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/zzO4EA
[04:42:07] *** Parts: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP) ()
[04:42:17] *** Joins: brson_ (brson@E02A6CDD.75598729.B6A3AE99.IP)
[04:42:18] *** Quits: brson_ (brson@E02A6CDD.75598729.B6A3AE99.IP) (Quit: brson_)
[04:42:26] *** Joins: brson_ (brson@E02A6CDD.75598729.B6A3AE99.IP)
[04:42:47] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[04:42:48] *** Quits: brson_ (brson@E02A6CDD.75598729.B6A3AE99.IP) (Quit: leaving)
[04:42:53] *** Joins: brson (brson@E02A6CDD.75598729.B6A3AE99.IP)
[04:42:54] *** ChanServ sets mode: +qo brson brson
[04:43:31] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[04:45:27] <acrichto> brson: interestingly enough, looks like we can run at least some things on travis in what appears to be a very reasonable amount of time: https://github.com/alexcrichton/rust/compare/89ad6fa0a6dd...a439d60d0fb1
[04:46:12] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[04:46:50] <brson> acrichto: interesting. so we are compatible with stock llvm 3.5?
[04:46:56] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[04:46:56] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/kwBhOQ
[04:46:56] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[04:47:16] <acrichto> brson: we are indeed, although we can only codegen for intel platforms, and probably only for linux/darwin
[04:47:22] <acrichto> https://travis-ci.org/alexcrichton/rust/builds/19310162
[04:47:30] <acrichto> 23 minutes for that build
[04:47:50] <acrichto> it didn't build libs like rustdoc/fourcc, nor did it run the doc tests
[04:48:00] <acrichto> it also didn't test anything other than libstd
[04:48:25] <brson> why "RUSTFLAGS="-C link-args='-lffi -lncurses'"?
[04:48:29] <brson> that's odd
[04:48:35] <acrichto> we disable that stuff when we configure llvm
[04:48:44] <acrichto> but apparently the stock LLVM brings it in by default
[04:49:10] <acrichto> brson: https://travis-ci.org/alexcrichton/rust/builds/19302482
[04:49:29] <acrichto> which is kinda annoying...
[04:49:38] <brson> how would this integrate with our prs?
[04:49:54] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[04:50:00] <acrichto> I believe we would enable this on travis
[04:50:06] <acrichto> we would then merge a .travis.yml into master
[04:50:15] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[04:50:15] <acrichto> and then travis will start testing all PRs against the repo
[04:50:29] <acrichto> I believe travis will email the contributor if tests fail
[04:50:51] <brson> are you sure travis does precommit testing?
[04:50:54] <acrichto> and then in theory bors will come along much later, update the statuses again, and then merge if tests pass
[04:50:57] <acrichto> yes
[04:51:11] <acrichto> there's an option in travis for turning off/on testing PRs
[04:51:21] <brson> can travis not update the pr status?
[04:51:32] <brson> not sure if that will interfere with bors or not
[04:51:43] <acrichto> I think travis will always do that
[04:51:52] <acrichto> we should definitely make sure it doesn't interfere with bors
[04:51:56] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[04:52:11] <brson> bors could even refuse to integrate if travis fails
[04:52:24] <brson> that could take a lot of the load off
[04:52:39] <acrichto> bors shouldn't see a successful travis though and then merge
[04:52:53] <acrichto> it would have to understand that buildbot is always necessary to merge
[04:53:30] <brson> i like that this forces us to be compatible with stock llvm
[04:53:51] <acrichto> i like that we don't block on travis, it's just an optimistic test
[04:53:56] <acrichto> plus it's like 0 maintenance for us
[04:54:13] <acrichto> I was actually really surprised that we "just worked" with stock LLVM
[04:54:14] <brson> hopefully
[04:55:47] <brson> acrichto: this is looking very promising. nice work
[04:58:02] *** Quits: zimbabao (rajaram@79767624.B67BB2DC.D2D1FAF0.IP) (Ping timeout)
[04:58:15] <acrichto> brson: looking at bors, it definitely writes to the state of the PR, but I'm not sure I see any reads of the state
[04:58:28] <acrichto> which makes me think that it may not interfere with travis
[04:58:39] <acrichto> unless travis sees the modification in status and then attempts to go off and do its thing again
[05:06:40] <acrichto> brson: aha! travis will indeed not mess with bors because bors filters statuses that only bors wrote
[05:07:17] <brson> bors is so forward-thinking
[05:07:31] <acrichto> I suppose security-wise that mildly makes sense
[05:07:37] <acrichto> b/c I think that anyone can make a status on a PR
[05:08:16] <brson> bors still has that one glaring security hole where the pr submitter can change comments to 'r+'
[05:08:26] <brson> nobody ever do that
[05:08:55] <acrichto> shhhh
[05:08:57] <acrichto> don't tell anyone
[05:09:07] <ChrisMorgan> It's public knowledge, discussed on the mailing list before.
[05:09:52] <acrichto> sshhhhh 
[05:09:54] <acrichto> don't remind anyone
[05:10:22] <brson> lol
[05:10:24] <Eridius> if we're worried we could switch over to putting the r+ on the PR itself, and requiring the commit SHA be included in the message, but that's annoying
[05:10:54] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[05:13:36] *** Quits: new_one (new_one@F2527D37.1DF5627.B3C0173E.IP) (Quit: leaving)
[05:16:55] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[05:16:55] <ghrust> [13rust] 15bors pushed 6 new commits to 06auto: 02http://git.io/91ZFIQ
[05:16:55] <ghrust> 13rust/06auto 14b29879f 15Erick Tryzelaar: extra: rename Uuid::to_bytes() to as_bytes()
[05:16:55] <ghrust> 13rust/06auto 1439733bd 15Erick Tryzelaar: std: minor whitespace cleanup
[05:16:55] <ghrust> 13rust/06auto 14476d501 15Erick Tryzelaar: syntax: Allow syntax extensions to have attributes
[05:16:57] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[05:20:28] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:29:01] <strcat> brson: http://ix.io/aDt here's the float total order thing from IEEE754
[05:29:04] <strcat> ugh
[05:29:18] <strcat> why can't floats just make sense ;p
[05:30:02] <strcat> I don't understand this anyway
[05:30:08] <strcat> how can it return a bool?
[05:30:23] <Eridius> strcat: I assume it's implementing the < operator
[05:30:33] <strcat> ah, right
[05:30:39] *** Joins: jdm (jdm@moz-E41E4269.dsl.teksavvy.com)
[05:30:55] <Eridius> I'm still not comfortable with the idea that -0 != 0
[05:30:57] *** Quits: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net) (Ping timeout)
[05:31:08] <strcat> Eridius: we'll have both
[05:31:28] <Eridius> strcat: I get that we'll have intrinsics to use the weak ordering, but nobody's going to know about them unless they go investigating
[05:31:59] <strcat> Eridius: but sort/TreeMap/HashMap need the total ordering
[05:32:11] <strcat> people will be really sad if they can't sort floats
[05:32:23] <Eridius> yes, and I think there must be some solution that doesn't involve changing the meaning of the < operator
[05:32:36] <strcat> but I don't think having two sets of traits is workable
[05:33:01] <Eridius> if Rust supported implementing a trait in terms of another trait _and_ implementing it for concrete types, it would be
[05:33:14] <strcat> if you have TotalOrd and PartialOrd, (lets pretend there's no Ord to be clearer), then I would expect PartialOrd to always be the same as TotalOrd for a type implementing it
[05:33:23] <Eridius> because then we could say `impl<T: Ord> PartialOrd for T { fn lt(&self, other: &Self) -> bool { self.cmp(other) == whatever } }`
[05:33:27] <strcat> otherwise it seems really weird
[05:33:37] <strcat> Eridius: but floats will want to impl both, differently
[05:33:48] <Eridius> it does seem weird, but I'm not sure it's any weirder than having <, ==, etc behave differently in Rust than in every other language that has floats
[05:34:03] <strcat> Eridius: SML doesn't implement the normal comparison ops for floats
[05:34:07] <Eridius> how does Haskell handle this?
[05:34:25] <strcat> Eridius: it says NaN is Greater than NaN
[05:34:31] <strcat> but in other cases it says it's not equal
[05:34:34] <strcat> it's messed up.
[05:34:43] <Eridius> really? wow. it must be implementing > in terms of < and ==
[05:34:50] <Eridius> or < and <=, or something like that
[05:35:07] <Eridius> ghci says `0/0 > 0/0` is False
[05:36:07] <strcat> Eridius: look at cmp
[05:36:35] <Eridius> hah, compare says GT
[05:36:39] <Eridius> that's.. interesting
[05:37:12] <Eridius> ok, so Haskell's compare disagrees with the > operator
[05:37:15] <Eridius> boom, precedent ;)
[05:37:31] <strcat> Eridius: http://hackage.haskell.org/package/base-4.6.0.1/docs/Data-Ord.html it's magic though
[05:37:38] <strcat> Eridius: yeah but haskellers view it as a mistake
[05:37:45] <strcat> haskell's prelude is not regarded in a good light
[05:37:50] <Eridius> :/
[05:39:42] <Eridius> I guess what we should do is implement total ordering for floats and then see how that affects math-heavy computation
[05:39:48] <Eridius> get some actual benchmarks
[05:40:43] <strcat> imo, we only have two sane choices
[05:40:57] <strcat> well
[05:41:06] <strcat> if Eq/Ord require a total ordering, floats can't implement them
[05:41:17] <strcat> if Eq/Ord require a strict weak ordering, then I don't think floats can implement them either
[05:41:55] <strcat> C++ just considers it undefined to put a NaN in a set/map (either ordered or unordered)
[05:42:13] <strcat> we could do that too
[05:42:15] <strcat> but I don't like it
[05:42:47] <strcat> so I think the choices are 1) no requirements, 2) weak ordering, 3) total ordering
[05:43:02] <strcat> and to have floats impl it, we need 1, because they don't implement any sensible definition of them
[05:43:10] <strcat> when x == x isn't always true, there's a problem in pretty much any generic code
[05:43:43] <strcat> that's for the traits themselves though - there are other choices involving operators
[05:44:25] <strcat> we could disallow overloading those operators via the traits (I think that'd be awful), we could have floats implement the operators but not the traits (but then we can't provide the IEEE754 total ordering)
[05:44:28] * strcat shrugs
[05:44:56] <strcat> really seems like the best solution is to say Eq/Ord are a total order, provide cmp on Ord, make Ord inherit from Eq and deal with the horrific float weak ordering elsewhere
[05:45:42] <Eridius> I think that in order to do that, we really need to benchmark the total ordering performance first
[05:45:49] <Eridius> because the vast majority of Rust code that handles floats is going to use that
[05:46:15] <strcat> Eridius: are comparisons really that common in floating point code?
[05:46:20] <strcat> especially equality
[05:46:33] <Eridius> maybe not equality, but < and > can be used a lot. Depends on what you're doing
[05:47:04] <Eridius> for example, in Cocoa, any sort of UI work does a lot with floats, because floats are used for everything relating to layout (well, doubles on 64-bit platforms)
[05:47:35] <Eridius> the question is, how much of a difference will totalOrd make in general, and how much impact will that have on arbitrary code
[05:48:01] <strcat> I think we do need to provide both the total ordering and the partial ordering for floats anyway
[05:48:22] <strcat> can make a sensible total ordering trait, but I really don't think you can make a sensible partial ordering one
[05:48:29] <strcat> and I don't think any generic code would use it
[05:48:36] <Eridius> sure, I think we need both, I'm just not convinced that making total ordering the standard way to compare floats is a good idea
[05:48:49] <strcat> the question is whether < is the total ordering or not
[05:48:56] <Eridius> right
[05:49:55] <strcat> atm we have Eq/Ord (overloading) and TotalEq/TotalOrd (generic code)
[05:50:02] <strcat> so generic code doesn't get the operator overloading sugar
[05:50:07] <Eridius> right
[05:50:27] <strcat> but yeah, I'll admit there is no really good solution
[05:50:39] <strcat> but I think what we do now is really terrible ;p
[05:50:42] <Eridius> heh
[05:50:56] <strcat> atm, min/max/clamp work on floats since they use ORd
[05:50:58] <strcat> but they're not right
[05:50:59] <Eridius> honestly, the more I think about it, the less I'm bothered by the idea that cmp() and < disagree
[05:51:41] <strcat> we'll have min/max/clamp using the total ordering for floats (and working for other types)
[05:51:50] <strcat> but we'll also have min/max/clamp respecting the IEEE754 rules
[05:52:15] <strcat> and defining them with PartialOrd (Ord atm) doesn't really make sense, because the nonsense you need to do only really makes sense for floats
[05:53:08] <Eridius> it's plausible that other types could be created that can be partially ordered but not totally ordered, although I admit I can't think of any off the top of my head (beyond looking at a wikipedia page and finding examples from e.g. set theory)
[05:53:24] <strcat> I don't think floats are partially ordered though
[05:53:28] <strcat> they don't meet the partial order definition
[05:54:13] <strcat> because of the x == x issue
[05:54:13] <Eridius> in a partially ordered set, only certain pairs of elements need to support the < relation
[05:54:40] <Eridius> I thought partial order only concerns itself with <?
[05:54:42] <strcat> !(a < b) && !(b < a) doesn't need to imply a == b, but afaik a == a has to be true
[05:54:55] <Eridius> strictly speaking, PartialOrd could only provide .lt()
[05:55:11] <strcat> Eridius: yes but atm it provides <=, >=, ==, != ;p
[05:55:23] <Eridius> hrm, actually wikipedia lists the formal definition as using <= and not <
[05:55:36] <Eridius> oh damn, it does say that a <= b and b <= a means a == b
[05:55:37] <Eridius> >_<
[05:55:39] <strcat> Eridius: yeah in fact it looks like IEEE754 uses <=
[05:55:53] <strcat> for totalOrder
[05:55:57] <strcat> Neither signaling NaNs nor quiet NaNs signal an exception. For canonical x and y, totalOrder(x, y) and
[05:56:00] <strcat> totalOrder( y, x) are both true if x and y are bitwise identical.
[05:56:01] <strcat> I was wondering how this made sense
[05:56:04] <strcat> with <
[05:56:12] <Eridius> yeah
[05:56:26] <strcat> anyway it's a real pain
[05:56:27] <Eridius> the description of poset says that not every pair of elements needs to be related
[05:56:28] <strcat> stupid NaN...
[05:56:36] <Eridius> but that seems to disagree with the formal definition saying that for all a, b, and c
[05:56:42] <strcat> they could have made life so much saner if they'd left out stupid NaN
[05:56:57] *** Joins: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP)
[05:56:57] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14e22f94c to 14d70f909: 02http://git.io/N3iJvQ
[05:56:57] *** Parts: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP) ()
[05:56:58] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[05:56:58] <ghrust> [13rust] 15bors pushed 5 new commits to 06auto: 02http://git.io/4NQffg
[05:56:58] <ghrust> 13rust/06auto 147e50c77 15Palmer Cox: Rename all variables that have uppercase characters in their names to use only lowercase characters
[05:56:58] <ghrust> 13rust/06auto 14149716a 15Palmer Cox: Add lint for variable names that contain uppercase characters
[05:56:58] <ghrust> 13rust/06auto 14dcdccf8 15Palmer Cox: Rename struct fields with uppercase characters in their names to use lowercase
[05:57:00] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[05:57:04] <strcat> sqrt -> Option<f32.
[05:57:05] <strcat> ;p
[05:57:21] <Eridius> hrm, no it then goes on to imply that you can have two elements that are incomparable
[05:57:40] <Eridius> I guess the problem is that, for floats to work, NaN should not be comparable to anything, but since we can't actually enforce that, it returns false
[05:57:55] <Eridius> well, I mean a signalling NaN would presumably enforce that (at runtime)
[05:57:58] <Eridius> but a quiet NaN can't
[06:00:38] <strcat> their description of total ordering at least makes it really trivial to write tests
[06:02:41] <Eridius> anyway, I wish we could say `impl<T: Ord> PartialOrd for T` and `impl PartialOrd for f64` and have that work
[06:03:05] <Eridius> because then I'd say the best idea is to make Ord total and derivable, have everyone implement that, and then just re-implement PartialOrd for floating types
[06:04:37] <strcat> but what about user-defined floats?
[06:04:41] <strcat> f128
[06:05:14] <strcat> Eridius: I'd rather just have the weird float ordering as part of Float
[06:05:21] <strcat> and have *all* the weird IEEE754 math there
[06:05:28] <strcat> no attempt at a numeric hierarchy including them
[06:07:02] <strcat> Eridius: we can tell LLVM the NaN comparison is unlikely so it will order the blocks for 100% correct branch prediction
[06:07:16] <strcat> so it will bloat the code and maybe push stuff out of cache
[06:07:23] <strcat> can comparisons we vectorized?
[06:07:57] <strcat> ah they can
[06:08:03] <strcat> so it might hurt auto-vectorization in some cases
[06:08:27] *** Joins: eibwen (kvirc@moz-544A7ACB.dip0.t-ipconnect.de)
[06:10:21] <strcat> Eridius: floats are just so messed up as a whole
[06:10:33] <strcat> Eridius: as a bonus, overflowing integer <-> float conversions are UB in LLVM
[06:10:47] <strcat> Eridius: because it varies across archs so they just say it's undefined and use it to optimize more
[06:11:01] <strcat> and as an extra bonus, LLVM doesn't support signalling NaN
[06:11:19] <strcat> I think you can assume they act as a quiet NaN but anything else is undefined behaviour
[06:11:47] <strcat> and LLVM doesn't support setting the floating point rounding mode
[06:12:31] <strcat> and to actually get floating point to vectorize well, you need to mark ops with how much error you can tolerate + enable the algebraic transformations forbidden by strict IEEE754 semantics
[06:12:55] * strcat sighs
[06:13:03] *** Joins: jsonnull (Thunderbir@26C8A295.45ABBC25.494A0F8B.IP)
[06:15:42] *** Joins: zimbabao (rajaram@47769425.AE842F9B.81C3DAA1.IP)
[06:16:54] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[06:16:55] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14e66d710 to 14d70f909: 02http://git.io/N3iJvQ
[06:16:55] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[06:16:56] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[06:16:56] <ghrust> [13rust] 15bors pushed 1 new commit to 06auto: 02http://git.io/lNuumA
[06:16:56] <ghrust> 13rust/06auto 147b89354 15bors: auto merge of #12380 : alexcrichton/rust/run-rewrite, r=brson...
[06:16:56] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[06:17:51] <Eridius> strcat: floats are messed up
[06:17:57] *** Parts: jsonnull (Thunderbir@26C8A295.45ABBC25.494A0F8B.IP) ()
[06:18:21] <strcat> the whole concept of a numeric type denser in some ranges and sparse in others is weird
[06:18:27] <Eridius> indeed
[06:18:52] <Eridius> the fact that float works at all is neat though
[06:19:16] <strcat> I guess :)
[06:19:20] *** Joins: edwardw (Mibbit@CBC31673.351D1665.B9C6B12A.IP)
[06:19:36] <strcat> Eridius: oh and extra bonus -> the LLVM intrinsics have undefined behaviour when the libc sets errno
[06:19:43] <strcat> glibc sets errno.
[06:19:47] <Eridius> oh? curious
[06:19:58] <strcat> Eridius: they consider them to be free of effects
[06:20:02] <strcat> Eridius: so lets say you do...
[06:20:15] <strcat> foo(); check_errno(); x / y
[06:20:25] <strcat> LLVM might reorder x / y between foo() and check_errno()
[06:20:28] <strcat> because it considers it pure
[06:20:40] <Eridius> I thought errno was volatile and therefore LLVM couldn't make any assumptions about it?
[06:21:09] <strcat> Eridius: errno is just a thread-local variable
[06:21:28] <strcat> Eridius: the problem isn't really errno itself
[06:21:35] <strcat> the problem is that it considers floating point intrinsics pure
[06:21:50] <strcat> but they aren't pure - they can set floating point exceptions, and on some platforms they can set errno
[06:21:59] <Eridius> setting errno seems really weird to me
[06:22:03] <strcat> clang deals with this by having -fno-math-errno and -fmath-errno
[06:22:25] <strcat> -fmath-errno -> uses intrinsics, -fno-math-errno -> no vectorization, etc. for you
[06:25:31] <strcat> glibc is dumb
[06:25:57] <strcat> I think it's okay to not worry about it, we can ship our own math library if we care
[06:28:23] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Ping timeout)
[06:30:17] <Eridius> strcat: I am unfamiliar with how the visit glue works. Any chance that could also be put into a libdebug?
[06:30:25] <Eridius> oops, that was cmr that commented, not you
[06:30:28] * Eridius needs to read more carefully
[06:30:29] <Eridius> cmr: ^
[06:30:37] <strcat> Eridius: visit glue is a real pain
[06:30:40] <strcat> Eridius: it's generated per type
[06:30:43] <strcat> so it can't be in a libdebug
[06:30:51] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[06:30:54] <Eridius> :/
[06:31:01] <strcat> Eridius: visit glue is generated when you call get_tydesc
[06:31:11] <strcat> it outputs a whole tree of functions for walking that type
[06:31:14] <strcat> whether or not the fields are privatre
[06:31:16] <strcat> private*
[06:31:17] <Eridius> strcat: could the compiler call into libdebug to generate it, at compilation time?
[06:31:29] <Eridius> e.g. libdebug takes the type and emits the AST for the functions to generate?
[06:31:39] <strcat> not sure exactly what you mean
[06:31:57] <strcat> Eridius: so what happens is that get_tydesc::<T>() outputs a TyDesc struct for T
[06:32:06] <strcat> and doing that requires generating the whole horrible visit glue tree
[06:32:10] <strcat> which violates privacy
[06:32:23] <strcat> since the caller may not be in the same crate the type was defined, or some private field deep in the type
[06:40:35] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[06:40:56] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[06:42:37] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[06:46:08] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[06:49:20] *** Quits: brson (brson@E02A6CDD.75598729.B6A3AE99.IP) (Ping timeout)
[06:55:17] *** Joins: newbie (kvirc@moz-C86BB367.dip0.t-ipconnect.de)
[06:55:50] *** Quits: eibwen (kvirc@moz-544A7ACB.dip0.t-ipconnect.de) (Ping timeout)
[06:57:42] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[07:00:14] *** Quits: jdm (jdm@moz-E41E4269.dsl.teksavvy.com) (Quit: Lost terminal)
[07:02:05] <cmr> The crappy part about JS's "module pattern" is that there's no simple way to debug inner functions :|
[07:03:34] <strcat> cmr: use dart with dartium and compile to js ;p
[07:03:38] * strcat runs
[07:04:06] <cmr> eugh
[07:04:29] * cmr has an extreme distaste for the web
[07:05:19] <strcat> I hate dart though
[07:05:39] <strcat> it's better than js, but not enough of an improvement
[07:06:52] <ChrisMorgan> cmr: I intend to make the web Rust powered. (Well, probably not all of it, but at least to *let* you use Rust for the entire stack.)
[07:07:16] <cmr> ChrisMorgan: a pig with lipstick is still a pig
[07:07:26] <cmr> or however that idiom goes
[07:07:37] <strcat> ChrisMorgan: but you won't have threads.
[07:08:14] <strcat> or 64-bit integers
[07:08:19] <strcat> or single-precision floats
[07:08:28] <strcat> or vector types to map #[simd] to
[07:08:33] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[07:08:38] <strcat> irc.
[07:11:17] *** Joins: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro)
[07:12:24] <strcat> cmr: pnacl is nice ;p
[07:13:03] *** Quits: ktt3ja (ktt3ja@moz-85E2770C.hsd1.va.comcast.net) (Quit: Leaving)
[07:13:21] <strcat> ~5% overhead over unsandboxed code, and you can use pthreads, etc.
[07:13:28] <strcat> but only works in chrome/chromium and opera ;\
[07:13:57] <strcat> there's pepper.js to make it work via emscripten but then you're going to take a huge performance/compatibility hit
[07:14:07] <strcat> kinda pointless imo
[07:14:15] <strcat> since if you needed the performance, the fallback isn't going to save you
[07:15:45] <eddyb> strcat: hi :)
[07:16:14] <cmr> https://github.com/mozilla/rust/pull/12439 r?
[07:16:57] *** Joins: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP)
[07:16:57] <ghrust> [13rust] 15bors 04force-pushed 06auto from 147b89354 to 14d70f909: 02http://git.io/N3iJvQ
[07:16:57] *** Parts: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP) ()
[07:16:58] *** Joins: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP)
[07:16:58] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/gvePiQ
[07:16:58] <ghrust> 13rust/06auto 14fda6716 15Alex Crichton: Upgrade LLVM for segmented stacks on thumb...
[07:16:58] <ghrust> 13rust/06auto 14ca41bbb 15bors: auto merge of #12407 : alexcrichton/rust/up-llvm, r=sfackler...
[07:16:58] *** Parts: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP) ()
[07:17:01] * strcat really dislikes jquery :(
[07:17:14] <strcat> it makes dom access so much slower than without it
[07:19:33] <cmr> strcat: thanks.
[07:20:01] <edwardw> strcat = thestinger?
[07:20:05] <strcat> yes
[07:20:14] <edwardw> ah
[07:22:06] <strcat> cmr: http://jsperf.com/jquery-vs-javascript-performance-comparison/30
[07:22:15] * edwardw writes it down on a sticker
[07:22:19] <strcat> gets worse on bigger pages though
[07:23:12] <cmr> yeah I know all about the perils of jquery
[07:23:21] <cmr> I am glad I don't have to care anymore
[07:23:59] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[07:24:22] <strcat> cmr: https://github.com/mozilla/rust/issues/12440
[07:24:25] * strcat shrugs
[07:24:32] <strcat> don't really feel like investigating the exact cause
[07:26:13] <eddyb> strcat: I've thought about it, and TypedArena shouldn't require the #4252 fix
[07:26:28] <strcat> eddyb: look at that bug ^
[07:26:32] <strcat> :(
[07:26:45] <Yurume> strcat: I like jquery as long as the users understand its consequence.
[07:27:15] <strcat> Yurume: but why? ;p
[07:27:58] <Yurume> well, why did people use ruby even when it was very slow (ruby is *now* much faster, but in the past...)
[07:27:58] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[07:28:10] <eddyb> all it (TypedArena) has to do is trigger the drop glue for T, pretty much like the dtor for move_iter, no?
[07:29:00] <eddyb> and Arena can do some juggling with a ~T as ~DummyTrait to get the drop glue from the first vtable slot
[07:29:02] <strcat> Yurume: it's not much of an improvement over plain js though.
[07:29:15] <strcat> Yurume: it is if you really have to support ie6/ie8/ie9
[07:29:23] <strcat> ie6/ie7/ie8/ie9 *
[07:29:40] <eddyb> jQuery 2 doesn't even support those
[07:29:46] <Yurume> it at least grossly improves the number of keystrokes if it fails to improve others.
[07:30:29] <strcat> Yurume: var $ = document.querySelector;
[07:30:31] <strcat> ?
[07:30:42] * strcat shrugs
[07:30:49] <eddyb> try getting an attribute :P
[07:31:09] <eddyb> or using XHR manually
[07:31:10] <strcat> getAttribute?
[07:31:37] *** Quits: newbie (kvirc@moz-C86BB367.dip0.t-ipconnect.de) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[07:31:38] <strcat> eddyb: really not that bad either.
[07:31:56] <eddyb> I think I once spent an hour fiddling with one such thing
[07:31:56] <strcat> in some ways, nicer than dealing with jquery's ajax method
[07:32:10] <strcat> eddyb: XHR even supports auto-parsing json
[07:32:15] <Yurume> strcat: does NodeList allow for ordinary Array methods? (e.g. does document.querySelectorAll('foo').forEach(...) work?)
[07:32:33] <eddyb> why do they even used a list?
[07:32:44] <eddyb> s/do/did/ s/used/use/
[07:32:52] <eddyb> anyways, screw DOM, I have things to do
[07:32:55] <Yurume> yeah
[07:34:34] * strcat shrugs
[07:34:44] <Yurume> jquery is good for getting things done very fast. if you want to get things fast you certainly have to avoid jquery though.
[07:35:26] <eddyb> my biggest perf problem with JS is GC :(
[07:35:36] <strcat> eddyb: and jquery creates objects everywhere so...
[07:35:42] <eddyb> lol
[07:35:53] <strcat> pretty sure doing $("") creates a hundred or more
[07:36:07] <strcat> there's a reason it's 10-20x slower
[07:36:22] <strcat> gets really bad for ones with a lot of results
[07:36:30] <Yurume> we need javascript macros that receives jquery syntax and returns fully expanded DOM boilerplates :p
[07:36:32] <strcat> and in ffx, the whole UX freezes ;s
[07:36:57] <eddyb> I tried making a web IDE with jQuery and flex boxes
[07:37:06] <strcat> ugh
[07:37:08] <strcat> sounds like hell
[07:37:48] <strcat> eddyb: the worst part is really that you have no good containers or anything though
[07:37:54] <eddyb> ended up writing the editor update code in pure DOM and simplifying it as much as possible
[07:38:00] <strcat> want big integers? well... there are some really terrible libs for it
[07:38:11] <eddyb> there's no deque
[07:38:16] <eddyb> just huge arrays
[07:38:36] <strcat> eddyb: not really arrays
[07:38:46] <strcat> just arrays until you make them not arrays, and they have to second-guess whether they are an array
[07:39:13] <strcat> the only container type is really an unordered string->value map
[07:39:42] <strcat> anything else is an optimization by the VM, like optimizing the array pattern (but not completely)
[07:39:48] <eddyb> v8 has ropes and slices for strings, but I'm pretty sure all arrays are contiguous in memory
[07:39:53] <eddyb> ah, that's what you are talking about
[07:40:17] <eddyb> you can store non-numeric keys in an array without deprecating its array performance
[07:40:30] <strcat> eddyb: in firefox?
[07:40:42] <eddyb> does SM break this? lol
[07:40:54] * strcat shrugs
[07:41:35] <strcat> I also don't get why browsers need so much memory
[07:41:56] <eddyb> GC *sigh*
[07:42:04] <strcat> yeah, gnome-shell is like that too because it uses spidermonkey
[07:42:13] <strcat> it starts at 120MiB and goes up to ~500MiB
[07:42:32] <eddyb> I think both pnkfelix and huon went OOM in a modified rustc with GC support
[07:42:34] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[07:42:34] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[07:42:41] <strcat> meanwhile, a more featureful window manager like i3 uses 4MiB
[07:43:17] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[07:43:26] <strcat> (well gnome-shell isn't really a wm... mutter doesn't use much memory, it's just the panel/overview - making it even sadder)
[07:43:47] <nrc> the root reason is because users want fast rather than not using much memory, so that is what browsers optimise for. Also users want shiny.
[07:44:10] <strcat> nrc: but using a lot of memory makes it slow.
[07:44:41] <strcat> TLB misses, cache misses, tracing the tenured heap causes huge pauses (ffx isn't there quite yet, so everything causes huge pauses ;p)
[07:45:05] <nrc> Well, you hit that point of diminishing returns, but it would probably be even slower if we avoided some of the optimisations we do
[07:45:06] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[07:45:20] <strcat> nrc: compare web apps vs. qt5 though
[07:45:45] <eddyb> I, for one, welcome the rusty art of achieving high perf and low mem
[07:45:58] *** Joins: Zr40 (zr40@EE4BB9F5.926C319A.BE2F4011.IP)
[07:46:03] <eddyb> though we suck a bit, compared to unsafe C tricks
[07:46:14] <nrc> for example, we cache everything we can  - textures, gradients, images, text runs, text shapes, and so forth. We could use much less memory without that, but it would be much, much slower
[07:46:20] <eddyb> strcat: were you around when we discussed a few ways to do negative field offsets?
[07:46:26] <strcat> eddyb: no
[07:47:08] <nrc> where possible we try to use as little memory as possible - we have several engineers whose full time job is to reduce memory use and everyone tries to be low-mem - we got really badly burned by the Firefox is a memory hog meme
[07:47:38] <eddyb> basically, struct RcBox<T> {weak: uint, rc: uint, #[ptr_base] data: T} and then *RcBox<T> => *T is a noop
[07:47:45] <strcat> nrc: browsers are memory hogs, it's not a firefox problem :)
[07:48:26] <eddyb> it's a funny feature to implement, because of all the corner cases it might hit
[07:48:44] <nrc> strcat: not sure about the web app vs qt comparison - qt is pretty good though, I'd be ahppy to be comparable
[07:48:55] <nrc> strcat: true, true
[07:49:39] <strcat> nrc: just that a qt app is insanely more responsive, and it's a nicer API to use (more features, higher-level)
[07:50:11] * strcat shrugs
[07:50:22] <strcat> the problem isn't really specific browsers, it's what they have to implement
[07:50:42] <eddyb> https://community.kde.org/Frameworks/Epics
[07:50:53] <eddyb> they're going to do a release this soon o_O?
[07:51:01] <nrc> yes the API of the web is HUGE and has some awful corner cases :-(
[07:51:03] <strcat> nrc: I expect that if ffx did sandboxing like chromium, it'd be a pretty big memory hog though :)
[07:52:06] <nrc> probably - I have no idea of that end of things
[07:52:45] <strcat> nrc: chromium spawns a process per extension and process per site instance (so, per-tab, but respawning on loading a new site) so it can sandbox them
[07:53:26] <strcat> so each one has a gc heap
[07:53:31] <strcat> and each one has a tcmalloc heap
[07:54:25] <strcat> on windows the sandbox isn't that great, but on linux it's awesome ;p
[07:54:56] <nrc> yeah, it is a very memory hungry architecture - the Firefox plan is to use one process for chrome and one for content, but of course you don't get the security benefits, just the responsiveness/stability
[07:55:03] <nrc> (and not as much stability)
[07:55:22] <strcat> nrc: yeah, similar to plugins
[07:55:30] <strcat> firefox does out-of-process flash, but it's not sandboxed
[07:55:34] <nrc> we should just hurry up and finish servo really :-p
[07:55:40] <strcat> chrome's flash can't do anything a web page can't do
[07:55:53] <strcat> which is sadly the main reason I recently switched to chromium
[07:55:54] <strcat> paranoia.
[07:56:12] <strcat> and adobe stopped updating linux flash (stuck at 11.2 with security updates) but google makes their own flash now ;s
[07:56:26] <nrc> yeah, the whole Flash thing sucks
[07:56:35] <nrc> it can't die quickly enough
[07:56:40] * strcat despises flash
[07:56:49] * nrc too
[07:56:52] <strcat> pepper flash is a whole lot better though...
[07:57:03] <strcat> since it runs in the nacl sandbox and can't touch anything
[07:57:16] <strcat> they don't break on every tab when it crashes
[07:57:19] <eddyb> they weren't kidding... since I last checked, there's like 40 libKF5*
[07:57:28] *** flaper87|afk is now known as flaper87
[07:57:31] <nrc> its kind of like keeping a dangerous animal in a cage though - I would prefer not to have the dangerous animal in my house at all
[07:57:43] <eddyb> nrc: that's what servo is for :P
[07:57:48] <strcat> nrc: well, it's no more dangerous than shumway
[07:58:05] <strcat> it runs in the same sandbox they have to secure for sites
[07:58:40] <strcat> which makes me tolerate that it's still closed-source crud
[07:58:41] <eddyb> KF5 is so tiny!
[07:58:57] <nrc> I have heard convincing arguments in favour of Shmway - I don't know enough about the subject to try and re-make them though
[07:59:12] <strcat> nrc: well, pepper flash certainly isn't normal flash
[07:59:15] <nrc> eddyb: quite
[07:59:29] <strcat> shumway is a much better idea than normal flash, security-wise
[07:59:54] <eddyb> too bad we'll have to wait for qt6 and kf6 to try to get them rewritten in Rust :P
[08:00:00] <strcat> good luck with that
[08:00:08] <nrc> strcat: yes, if we had as much money to through at Adobe as Google has, we'd have a much better Linux solution :-p
[08:00:27] <strcat> nrc: *shrug*, firefox could use pepper flash
[08:00:39] <nrc> we'd have to implement pepper first
[08:00:41] <eddyb> strcat: for a lot of stuff, all I need is high-level bindings to libclang
[08:00:43] <strcat> nacl is open-source, and implementing the subset of pepper it uses can't be that hard
[08:01:08] <nrc> that would probably take more development effort than the entire Firefox engineering team
[08:01:16] * strcat shrugs
[08:01:25] <nrc> Flash uses a _super_set of the nacl/pepper APIs
[08:01:31] <eddyb> the C++ that Qt5 and KF5 use should be easier to transpile to safe Rust code than decades old C
[08:02:17] <nrc> ncal is kind of cool, but pepper makes me sad
[08:02:28] <strcat> nrc: imo mozilla could implement it without a massive effort
[08:02:28] <nrc> *nacl
[08:02:48] <strcat> but they won't because firefox doesn't do sandboxing anyway, and pepper flash is only desperately needed on linux
[08:02:56] <strcat> and linux in firefox is not a first-class platform at all
[08:03:20] <strcat> in chromium linux is the first class platform - it has the best hardware acceleration and sandboxing
[08:03:23] <strcat> which is why I bailed.
[08:03:54] <eddyb> strcat: wait till servo starts doing parallel layout on the GPU :P
[08:04:11] <nrc> we have considered it - but it would be a massive effort - pepper basically duplicates the entire dom and the spec is poor and closely tied to the webkit implementation. Also there is plenty of 'private' API the at Flash uses which we'd have to reverse engineer and then Google could change. Lots of not fun :-(
[08:04:22] <strcat> nrc: s/webkit/blink/ :)
[08:04:24] <nrc> strcat: sadly you are very right about Firefox/Linus
[08:04:30] <nrc> * Linux :-(
[08:04:40] <nrc> heh, yeah
[08:04:50] <strcat> nrc: well, it just makes me sad
[08:05:15] <strcat> because I really like firefox/mozilla from an ideology perspective
[08:05:24] <eddyb> Rust has taught me how to not be sad
[08:05:33] *** Parts: edwardw (Mibbit@CBC31673.351D1665.B9C6B12A.IP) ()
[08:05:37] <strcat> but google is honestly going to win
[08:05:42] <strcat> they'll shove chrome advertisements everywhere
[08:05:51] <strcat> and they'll pour money into stuff like nacl/dart
[08:05:54] <eddyb> Google is the new Microsoft
[08:06:04] <nrc> it makes a lot of Mozilla devs a bit sad too - because lots of us use Linux as our main platform but don't have the time to make the browser awesome on that platform
[08:06:49] <nrc> strcat: they already are - if they had to pay for those ads, there marketing budget would be insane!
[08:06:54] <nrc> *their
[08:06:59] <strcat> nrc: well they run ads on TV here
[08:07:06] <strcat> iirc they even ran superbowl ads
[08:07:16] <nrc> oh really? Wow
[08:07:44] <strcat> most people have no idea about the sandboxing advantages, and most people are not on linux, so imo the only reason chrome has the marketshare it does is those advertisements
[08:07:47] <nrc> I remember seeing lots of billboard ads in London. NZ obviously too important a market for them :-)
[08:08:12] <strcat> nrc: http://gs.statcounter.com/ ;s
[08:08:29] <nrc> yeah, I agree - Google really pushes the Chrome ads across all their sites
[08:09:09] <strcat> statcounter stopped counting the prefetching so it's actually an accurate picture in terms of page views
[08:09:28] <strcat> (not in terms of unique visitors, but advertisers don't care)
[08:09:40] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[08:09:50] <nrc> well, at least IE is still falling...
[08:10:34] <strcat> and opera == chrome now
[08:10:37] <pnkfelix> acrichto: ping
[08:10:38] <strcat> pretty much
[08:10:58] <strcat> chrome is chromium + branding, and the sandboxed pdf/flash plugins (which you can use in chromium anyway)
[08:11:08] <eddyb> fish: Job 1, 'systemsettings' terminated by signal SIGSEGV (Address boundary error)
[08:11:08] <strcat> opera is chromium + branding and some UX tweaks ;p
[08:11:14] <acrichto> pnkfelix: pong
[08:11:16] <eddyb> bleah, kf5 is still a bit problematic
[08:11:27] <eddyb> acrichto: did we get a snapshot?
[08:11:42] <pnkfelix> acrichto: just a heads up, I realized on the way home last night that delaying until the next call to bdwgc.alloc(..) doesn't work
[08:11:48] <acrichto> eddyb: we did indeed
[08:11:55] <eddyb> \o/
[08:12:04] <eddyb> strcat: allocators pls
[08:12:15] <strcat> lets fix some code bloat before adding more with allocators
[08:12:30] <pnkfelix> acrichto: in particular for the case when a Task does alloc, is descheduled, then is rescheduled onto a different pthread, but does not do any alloc
[08:12:44] <pnkfelix> acrichto: at least not before a diffferent task on a different thread causes a GC
[08:13:09] <pnkfelix> acrichto: Its okay though, I have ideas on how to deal with this.  Hopefully the ones that don't involve adding overhead to the scheduler will pan out.
[08:13:22] <strcat> pnkfelix: can you make gc use thread-local (scheduler) storage instead of task-local storage?
[08:13:24] <acrichto> hm interesting
[08:13:35] <pnkfelix> strcat: BDW does internally
[08:13:47] <strcat> pnkfelix: you can use thread-local storage in rust too though
[08:13:58] <strcat> or does migrating ruin that?
[08:13:58] <acrichto> isn't this all done through a task-local LocalHeap instance?
[08:13:59] <pnkfelix> strcat: the issue here is that BDW wants to know the stack extent for every thread
[08:14:04] <strcat> pnkfelix: ah
[08:14:07] <strcat> for roots
[08:14:10] <pnkfelix> acrichto: Not in this case, not in the system I'm hacking up
[08:14:19] <acrichto> hm
[08:14:24] <strcat> yeah I guess that won't work
[08:14:25] <pnkfelix> acrichto: its not feasible to make BDW work in a thread-local manner, not in the short term
[08:14:40] <pnkfelix> acrichto: My current plan is to hack BDW to let us pass in a fcn ptr
[08:14:46] <pnkfelix> acrichto: for extracting one's own stack extent
[08:15:14] <eddyb> strcat: gaah, same stupid thing as last time, kf5 apps segfault in QXcbKeyboard::updateVModToRModMapping at qxcbkeyboard.cpp:1134
[08:15:21] <pnkfelix> acrichto: And then the Rust integration can pass in a fcn that queries its own thread-local storage to find what task it has and what stack extent is associate with it
[08:15:53] <pnkfelix> acrichto: Does that sound semi-plausible?  (The main place where I think it won't work is when a library fires up pthreads that are not part of the Rust runtime)
[08:15:55] *** Joins: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net)
[08:16:13] <acrichto> seems like that could work yeah
[08:16:48] <strcat> what does vmkit use?
[08:17:11] <pnkfelix> acrichto: (the advantage of the approach I was outlining yesterday is that it is easier to prove sound.  E.g. it re-establishes BDW's notion of each thread's stack extent basically as-soon-as-it-possibly-can/could
[08:17:51] <pnkfelix> acrichto: but I agree that it is bad-news-bears to add more overhead to the scheduler.  Even for a proof of concept toy like this that would never be deployed for production.)
[08:19:10] <strcat> vmkit uses mmtk which has the crappy eclipse license ;s
[08:19:31] <strcat> which seems to be like the apache license but it's gpl incompatible
[08:19:44] <strcat> woo, licenses
[08:19:58] <strcat> so we couldn't statically link it
[08:22:42] <pnkfelix> strcat: you meant the issues discussed here: https://www.gnu.org/licenses/license-list.html#CommonPublicLicense10 (Eclipse PL is two items down but the issues are discussed with the CPL)
[08:22:53] <pnkfelix> strcat: ?
[08:23:40] <eddyb> wha. someone screwed up and kf5 packages conflict with regular kde4
[08:23:48] * pnkfelix has no idea what a "choice of law clause" is
[08:23:59] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[08:24:33] <strcat> pnkfelix: yeah, it's still GPL incompatible
[08:24:46] <strcat> pnkfelix: well, the GPL forbids adding restrictions
[08:24:59] <pnkfelix> this is interesting: http://lists.gnu.org/archive/html/gnu-misc-discuss/2009-08/msg00050.html
[08:25:02] <strcat> so there are other licenses the FSF considers 'free' that are GPL incompatible because they do copyleft another way
[08:25:20] <strcat> and ones with the patent indemnification clause are incompatible with GPL2 but not GPL3 (since it adds that)
[08:26:00] <Zr40> doesn't GPL2 allow using GPL3 instead, removing the incompatibility?
[08:26:18] <strcat> Zr40: some projects like the linux kernel are GPL2 without the 'or later' wording
[08:28:09] <strcat> Zr40: the 'or later' clause is not at all appealing to a corporation or a control freak like linus ;)
[08:28:29] <strcat> because who knows what the FSF will do in the future
[08:28:52] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[08:29:06] <strcat> they could get taken over via board elections or whatever they do and make the GPL a permissive license ;p
[08:29:32] <strcat> and the linux kernel is basically gpl2 forever
[08:30:21] <strcat> good luck getting over 10k people assign copyright (some copyright holders might be bankrupt companies, etc.)
[08:33:05] <huon> acrichto: ping
[08:36:35] <acrichto> huon: pong
[08:38:40] <huon> acrichto: what's the purpose of this? https://github.com/mozilla/rust/blob/master/src/libgreen/context.rs#L58-L61 (the comment just says what's happening, not why)
[08:39:02] <acrichto> oh I meant to try to remove that
[08:39:09] <acrichto> I have no idea why that's there
[08:39:22] <acrichto> that's in theory initializing regs with the current regs
[08:39:30] <acrichto> but that's a silly thing to do because you don't need any of the registers
[08:39:52] * huon tries deleting it
[08:40:51] <acrichto> I wonder how ancient that code is
[08:41:10] <huon> from a time before written records
[08:41:21] <acrichto> wow
[08:41:31] <huon> such history
[08:41:43] <Zr40> much commit
[08:41:58] <eddyb> "records"
[08:42:01] <huon> it's probably a heritage piece now, protected by local laws, so we can't delete it :'(
[08:42:02] <eddyb> hehe I see what you did there
[08:42:15] <pnkfelix> acrichto: is your claim here that initialize_call_frame will setup all of the state that will be needed in `regs` in the future?
[08:42:34] <acrichto> pnkfelix: it's a fresh new 'regs', they should all be 0
[08:42:46] <acrichto> the specific relevant fields are initialized after that
[08:42:55] <acrichto> initializing with the current register set doesn't make much sense
[08:43:34] <pnkfelix> acrichto: the only initialization I see is the call to initialize_call_frame
[08:43:41] <huon> are we still spending a lot of time copying around metadata?
[08:44:06] <acrichto> pnkfelix: oh sorry I was looking at the wrong thin, yes initialize_call_frame does all necessary init
[08:44:07] <acrichto> huon: no
[08:44:08] <pnkfelix> acrichto: which may, for all I know, be sufficient.  I imagine capturing the current register state might have been a "better safe than sorry" mentality...
[08:44:17] <huon> acrichto: :'(
[08:44:20] <acrichto> huon: unless we only have a dylib on hand in which case we need to deflate
[08:44:49] <acrichto> pnkfelix: there's nothing usable out of the current register state though, it's all pretty much undefined anyway
[08:44:53] <huon> (I'm changing flate to return CVec<u8>, which saves a memcpy.)
[08:45:01] * huon will not be optimiser-of-the-day
[08:46:30] <eddyb> http://api.kde.org/frameworks-api/frameworks5-apidocs/ hmm, not sure if I have seen this tier model anywhere else
[08:46:56] <pnkfelix> acrichto: Yeah, the only thing I could think of was some hypothetical piece of state that libgreen is ignorant of but nonetheless needs to be restored when the context gets swapped in.  But that is wishy-washy.
[08:47:38] <acrichto> huon: yeah looks like that swap registers code has been in there since the beginning
[08:47:49] <acrichto> huon: although I didn't trace it back into the C++ runtime
[08:48:07] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[08:52:02] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[08:52:02] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/gvePiQ
[08:52:02] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[08:52:16] <huon> acrichto: cool... it's bootstrapping fine if I remove it (but the compiler doesn't do many context switches... what're good context-switching tests to run?)
[08:52:52] <acrichto> huon: stdtest
[08:53:07] <acrichto> synctest as well
[08:55:05] <huon> ok
[08:56:47] <acrichto> sleep now
[08:56:57] * strcat switches off acrichto
[08:56:59] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[08:56:59] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/1bxdrQ
[08:56:59] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[09:13:37] *** lpy is now known as lpy|afk
[09:17:23] *** Joins: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP)
[09:18:00] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[09:40:57] *** Quits: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro) (Ping timeout)
[09:44:08] *** Joins: jensnock_ (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[09:46:00] *** Quits: jensnock_ (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[09:55:09] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[09:55:31] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[09:57:12] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[10:00:16] *** Joins: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro)
[10:03:19] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[10:05:37] *** lpy|afk is now known as lpy
[10:08:11] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Quit: ChatZilla 0.9.90.1 [Firefox 30.0a1/20140219030203])
[10:11:26] *** Joins: bjz_ (bjz@B398BE78.F804C29E.D35A31DF.IP)
[10:11:49] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[10:11:58] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[10:11:58] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/VyJDdw
[10:11:58] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[10:12:41] <eddyb> strcat: OMG OMG
[10:12:44] <eddyb> HYPE HYPE HYPE
[10:13:01] <eddyb> I started plasma-shell, it is absolutely beautiful
[10:13:02] <strcat> hm?
[10:13:18] <strcat> what is plasma-shell?
[10:13:27] <eddyb> the kf5 plasma
[10:14:28] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[10:14:32] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[10:14:47] <strcat> eddyb: ah
[10:15:50] <strcat> eddyb: kde would be a lot more popular if their default theme wasn't so hideous
[10:16:59] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[10:16:59] <ghrust> [13rust] 15bors pushed 1 new commit to 06auto: 02http://git.io/sjgKSA
[10:16:59] <ghrust> 13rust/06auto 14646cdab 15bors: auto merge of #12380 : alexcrichton/rust/run-rewrite, r=brson...
[10:16:59] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[10:17:01] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[10:17:01] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/9khMsA
[10:17:01] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[10:45:34] *** Joins: erickt (Adium@moz-BDF423C7.hfc.comcastbusiness.net)
[11:01:43] <pnkfelix> huon: ping
[11:04:29] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[11:14:52] *** Quits: erickt (Adium@moz-BDF423C7.hfc.comcastbusiness.net) (Quit: Leaving.)
[11:17:37] <huon> pnkfelix: pong
[11:18:18] <pnkfelix> huon: I think I've resolved the most immediate problems with building/running the bdw branch
[11:18:46] <pnkfelix> huon: its on bdw-bootstrapped-fixups-rebasing-2014feb20 (sic)
[11:18:57] <huon> pnkfelix: including the mem use?
[11:19:01] <pnkfelix> huon: maybe
[11:19:13] <huon> (I'm in the middle of something else, so I'll build it in a bit.)
[11:19:23] <pnkfelix> huon: it *seems* like the mem use went down, not sure
[11:19:50] <pnkfelix> huon: no rush, there's still some instrumentation in there that makes the build pretty noisy
[11:20:45] <pnkfelix> huon: (and I still have to follow-up on alex's advice to not add extra computation to the context switching)
[11:21:25] <huon> pnkfelix: ah, so you're calling into BDW to inform it of the stack top on every context switch?
[11:21:51] *** Joins: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP)
[11:21:51] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14646cdab to 1437903cb: 02http://git.io/N3iJvQ
[11:21:51] *** Parts: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP) ()
[11:21:53] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[11:21:53] <ghrust> [13rust] 15bors pushed 6 new commits to 06auto: 02http://git.io/NLQpHA
[11:21:53] <ghrust> 13rust/06auto 147fcfc1a 15Erick Tryzelaar: extra: rename Uuid::to_bytes() to as_bytes()
[11:21:53] <ghrust> 13rust/06auto 14ac3dd8a 15Erick Tryzelaar: std: minor whitespace cleanup
[11:21:54] <ghrust> 13rust/06auto 14db89f72 15Erick Tryzelaar: syntax: Allow syntax extensions to have attributes
[11:21:55] <pnkfelix> huon: yeah, currently
[11:21:56] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[11:22:04] <pnkfelix> huon: its a hack but the whole thing is a hack
[11:22:25] <strcat> better than nothing (which is what we have now)
[11:22:44] <strcat> at least as long as we pretend we have a Gc type
[11:22:47] <strcat> ;p
[11:23:20] <pnkfelix> strcat: Don't get too excited: I'm not using it for collection yet, either.
[11:23:34] <strcat> so it just leaks? or there's still refcounting
[11:23:35] <pnkfelix> strcat: that comes after I can be confident that the whole runtime holds together
[11:23:48] <pnkfelix> strcat: there's still ref-counting
[11:24:08] <pnkfelix> strcat: with periodic GC's that should do nothing
[11:24:23] <pnkfelix> strcat: (since the list of all the @T's should be keeping them all alive)
[11:25:10] <huon> so currently BDW is just being used as plain `malloc`?
[11:25:20] <pnkfelix> strcat: so I won't be putting up PR's for any of this until I resolve all that.
[11:25:39] <pnkfelix> huon: that's right.  Well, I am forcibly calling GC_collect, as you know
[11:25:40] <strcat> pnkfelix: I just put together a complete hack for something else too ;)
[11:25:45] <pnkfelix> huon: but only as sanity checks.
[11:25:49] <strcat> tor-as-a-library
[11:26:11] <strcat> tor is completely non-thread-safe + is meant to run as a process
[11:26:21] <strcat> but that doesn't really work for deploying some binary/application
[11:26:43] <strcat> so.... I shoved their source tree into mine and run it in a thread, and talk to it via IPC as if it's a separate process
[11:26:45] <strcat> woo
[11:27:23] * eddyb throws an onion at strcat
[11:27:29] <strcat> pnkfelix: so does it have the ability to do a dry run or something?
[11:27:50] <strcat> how are you running a collection without collecting? ;p
[11:28:06] <pnkfelix> strcat: It is *attempting* to collect
[11:28:10] <pnkfelix> strcat: its just not reclaiming anything
[11:28:13] <strcat> ah
[11:28:22] <pnkfelix> strcat: because all the @T stuff is still reachable
[11:28:59] <pnkfelix> (i may be lying a little here, because the periodic GC's sometimes report non-zero deltas in the heap size)
[11:29:12] <pnkfelix> and I haven't yet figured out how that could possibly be happening
[11:29:36] <pnkfelix> but there are other oddities in that reporting, so I've been leaving investigating it for later.
[11:30:30] <strcat> eddyb: onions are an important part of my world domination plan, k.
[11:31:31] <strcat> (actually, I just want to make a secure tor browser atm)
[11:31:37] <pnkfelix> huon: mm, maybe i didn't resolve the memory usage issues.  I cannot remember what the peak was last time we talked
[11:32:46] <pnkfelix> huon: (well, maybe I did and maybe I didn't.  I just realized this run is using `make -j2` again...)
[11:33:28] *** Quits: zimbabao (rajaram@47769425.AE842F9B.81C3DAA1.IP) (Ping timeout)
[11:35:43] <huon> it crashed for me forking the linker when building stage1 librustc
[11:36:58] <huon> (last time)
[11:40:02] <pnkfelix> huon: that sounds familiar.  Was that with clang?
[11:41:58] <huon> pnkfelix: yeah
[11:42:47] <huon> pnkfelix: (it normally crashes on the linker because, iirc, that fork duplicates the whole RES of the original process, doubling the total memory usage.)
[11:43:14] <pnkfelix> huon: hmm. That's interesting
[11:43:32] <eddyb> ptr::read(self.borrow()); // destroy the contained object
[11:43:43] <pnkfelix> huon: that sounds like something we might try to address independently, anyway, no?
[11:43:46] <eddyb> so this is how TypedArena should be dropping elements
[11:44:45] <strcat> eddyb: but the old arena is still there :(
[11:44:50] <huon> pnkfelix: apparently we should be using vfork or something
[11:45:06] <eddyb> strcat: did I not tell you how to make that one work?
[11:45:08] <strcat> huon: don't use vfork, it's deprecated ;s
[11:45:14] *** Joins: jensnock_ (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[11:45:18] <strcat> huon: use posix_spawn
[11:45:19] <huon> pnkfelix: (I've just picked these things up off strcat, no idea of the details ;P )
[11:45:32] <huon> strcat: oh, I misremembered
[11:45:51] <strcat> POSIX has vfork and posix_spawn, and vfork is deprecated
[11:45:56] <strcat> linux has clone and vfork syscalls
[11:46:04] <strcat> pthread_create/fork/posix_spawn use clone
[11:46:14] <eddyb> let p: ~T = transmute(0); let (_, &dtor): (*T, &fn(*T)) = transmute(p as ~DummyTrait); dtor
[11:46:16] <strcat> (vfork is deprecated in both cases ;p)
[11:46:22] <eddyb> strcat: there, no TyDesc :D
[11:46:41] <strcat> eddyb: ah, clever
[11:46:59] <huon> eddyb: or just... add a get_dtor::<T>() intrinsic to the compiler :P
[11:47:00] *** Quits: jensnock_ (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[11:47:06] <eddyb> huon: that's harder
[11:47:15] <strcat> well it's trivial now
[11:47:16] <huon> eddyb: barely
[11:47:16] <eddyb> (but yeah, the proper solution)
[11:47:19] <strcat> I added a get_dtor function
[11:47:25] <eddyb> ah heh
[11:47:36] <strcat> look in glue.rs now
[11:47:59] <strcat> it makes it so that tydescs aren't created just to call a dtor
[11:48:10] <strcat> before, let x = ~5; made a tydesc for ~int and int ;s
[11:48:19] <strcat> well s/int/i8/
[11:48:22] <strcat> since it simplified
[11:48:24] <eddyb> should we remove borrow from Rc and get from Ref/RefMut?
[11:48:34] <strcat> hrm?
[11:48:48] *** Quits: luz (lucy@moz-CD18B14B.customer.cdi.no) (Input/output error)
[11:48:59] <eddyb> I feel like something that would've been .get().get() with Ref might be ambiguous once the deref traits work completely
[11:49:05] *** Joins: luz (lucy@moz-CD18B14B.customer.cdi.no)
[11:49:37] <eddyb> s/like/that/?
[11:51:11] <huon> eddyb: what would replace Rc.borrow?
[11:51:37] <strcat> giverefplz
[11:52:04] <eddyb> x.deref() or *x or working with x as if it were x.borrow() in a lot of ways
[11:52:57] <huon> .suchref_soborrow()
[11:53:22] <huon> eddyb: ah, well, maybe we should wait until those work before removing borrow ;)
[11:53:52] <eddyb> I'm asking because I see no downside to making those traits available even at stage0
[11:54:13] <huon> eh?
[11:54:14] <eddyb> but .deref() everywhere might lower code quality
[11:54:39] <huon> why would we disable certain traits in stage0??
[11:54:39] <eddyb> huon: DerefImm/DerefMut without them being lang items
[11:55:06] <strcat> eddyb: pub fn get_drop_glue(ccx: @CrateContext, t: ty::t) -> ValueRef {
[11:55:10] <strcat> trivial to make an intrinsic ;p
[11:55:24] <huon> oh... you mean: "when we are adding the deref traits, we can use the trait methods directly until a snapshot gives us the nice sugar"
[11:55:33] <strcat> read subst type -> get glue
[11:55:41] <eddyb> huon: s/when//
[11:55:53] <strcat> but...
[11:55:58] <strcat> that other arena has other weird crap
[11:56:01] <huon> eddyb: um. no.
[11:56:21] <huon> eddyb: it wasn't "if we are adding ..." ;)
[11:56:41] <eddyb> it sounded like it was in the future
[11:56:56] <eddyb> I'm mentioning it because I've already added the traits and implemented them for Rc/Ref/RefMut
[11:56:57] <huon> is someone actively working on the deref traits now?
[11:57:05] <huon> no compiler work, though?
[11:57:07] <eddyb> I was supposed to be working on them a week ago
[11:57:24] <eddyb> and I then I got sick and you know all about that
[11:57:30] <eddyb> s/and I/and
[11:58:28] <eddyb> lets_do_this! // how appropriate
[12:01:59] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[12:01:59] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/f02R4A
[12:01:59] <ghrust> 13rust/06auto 14bb6fc34 15Palmer Cox: Update comments in the prelude...
[12:01:59] <ghrust> 13rust/06auto 14c9864ce 15bors: auto merge of #12410 : DaGenix/rust/fix-incorrect-comment, r=alexcrichton...
[12:01:59] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[12:02:01] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[12:02:01] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14b9d1bec to 1437903cb: 02http://git.io/N3iJvQ
[12:02:01] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[12:04:46] <eddyb> "the type of this value must be known in this context"
[12:04:48] <eddyb> great :/
[12:05:19] <eddyb> not sure why the function name is "structurally_resolved_type"
[12:21:39] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[12:21:58] <strcat> eddyb: there was a time before monomorphization...
[12:22:25] *** Quits: mawuli (mawuli@moz-36C70B7D.com.gh) (Ping timeout)
[12:22:42] <eddyb> contemporary history pls
[12:22:58] <strcat> ok no more tydesc in typedarena
[12:23:14] <strcat> but I don't want to deal with Arena so there was no point
[12:23:29] <eddyb> does it use anything other than the dtor?
[12:23:33] <strcat> yes
[12:23:40] <huon> alignment and size, right?
[12:23:40] <strcat> it uses all the things
[12:23:43] <strcat> yeah
[12:23:44] <eddyb> >_>
[12:23:58] <eddyb> strcat: but it can get those things with intrinsics and store them, can't it?
[12:24:06] <huon> should be able to get them from the generic constructor, and squirrel them away somewhere, yeah
[12:24:34] *** Joins: jdm (jdm@moz-E41E4269.dsl.teksavvy.com)
[12:25:24] <strcat> meh
[12:27:11] <huon> The nice thing about the tydesc is it's in static storage, and doesn't have to be duplicated for every instance of the type in the Arena...
[12:27:27] *** Joins: doomlord_ (servitor@moz-9B2006BF.range109-151.btcentralplus.com)
[12:27:33] <eddyb> associated items pls
[12:28:16] <strcat> huon: but the new function is generic anyway
[12:28:22] <strcat> and the functions are all #[inline]
[12:28:40] <strcat> huon: making a tydesc makes visit glue ;s
[12:29:50] <huon> strcat: I was thinking about the storage space of storign size alignment and dtor for every entry in an arena (rather than just the tydesc pointer)
[12:29:59] <strcat> ah
[12:30:05] <huon> but... this is definitely not a reason to keep the tydesc in it's current form :)
[12:30:57] <strcat> huon: https://github.com/mozilla/rust/pull/12444 r?
[12:32:43] <huon> TypedArena uses a linked list? ick
[12:33:20] <strcat> a chunked list
[12:33:52] <huon> yeah, a list of chunks
[12:34:01] * huon rephrases :P
[12:34:18] <eddyb> Hash landed?
[12:37:51] <huon> eddyb: no
[12:38:02] *** Joins: mawuli (mawuli@moz-36C70B7D.com.gh)
[13:13:11] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[13:14:22] <huon> r? https://github.com/mozilla/rust/pull/12445
[13:16:20] *** Quits: jdm (jdm@moz-E41E4269.dsl.teksavvy.com) (Quit: Lost terminal)
[13:16:56] *** Joins: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP)
[13:16:56] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/f02R4A
[13:16:56] *** Parts: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP) ()
[13:21:57] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[13:21:57] <eddyb> huon: do you need a commit/PR range to update the irsy graph, or is it global?
[13:21:57] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/XdMt3g
[13:21:57] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[13:23:52] <huon> eddyb: list of individual commits
[13:23:56] * huon -> bed
[13:24:10] <eddyb> ahh
[13:26:50] *** Joins: zimbabao (rajaram@AA2D34A6.32AF4EDF.D2D1FAF0.IP)
[13:27:00] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[13:27:00] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/guW9HA
[13:27:00] <ghrust> 13rust/06auto 145bf8d32 15HeroesGrave: move enum_set to libcollections. #8784
[13:27:00] <ghrust> 13rust/06auto 142fa7d6b 15bors: auto merge of #12415 : HeroesGrave/rust/move-enum-set, r=alexcrichton...
[13:27:00] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[13:27:03] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[13:27:03] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/XdMt3g
[13:27:03] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[13:35:28] *** Joins: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net)
[13:45:33] *** Quits: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[13:46:02] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[13:47:52] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[13:56:35] *** Quits: lpy (lpy@7360AA58.F09091A8.1348A864.IP) (Ping timeout)
[13:56:40] <eddyb> println!("{:?}", *Rc::new(5));
[13:56:44] <eddyb> &5
[13:57:12] <eddyb> that was the easy part
[13:59:05] <eddyb> let x = Rc::new(RefCell::new(5)); println!("{:?}", *(*x).borrow());
[14:04:11] <kimundi> eddyb Oh, ImmutableDeref working so far?
[14:04:22] <eddyb> DerefImm, but yeah
[14:04:46] <eddyb> this a nasty bunch of typeck code I have to deal with
[14:10:40] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[14:18:26] <eddyb> fn foo<T: DerefImm<()>>(x: T){*x;} // ok, enough toying around... time to do actual dereference
[14:22:27] *** Joins: edwardw (edwardw@CBC31673.351D1665.B9C6B12A.IP)
[14:26:15] *** Joins: jdm (jdm@CC0122E6.8F96AEA7.2D179A7D.IP)
[14:29:26] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[14:41:55] *** Joins: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP)
[14:41:55] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/guW9HA
[14:41:55] *** Parts: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP) ()
[14:43:58] <eddyb> Refused to evaluate a string as JavaScript because 'unsafe-eval' is not an allowed source of script in the following Content Security Policy directive: "script-src 'self' chrome-extension-resource:".
[14:44:10] <eddyb> strcat: bah, chrome is sabotaging itself
[14:44:19] <strcat> hm? ;p
[14:44:26] <eddyb> it may be my fault, but I don't know what in about:flags could cause this
[14:44:37] <strcat> still using --single-process?
[14:44:52] <strcat> might break something, dunno ;p
[14:45:02] <eddyb> that's not it, had these problems before
[14:45:58] <eddyb> previously with GitHub, now I've opened this PDF http://insider.osr.com/2014/ntinsider_2014_01.pdf
[14:46:12] <strcat> works here ;p
[14:46:27] <eddyb> because you didn't break it
[14:46:54] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[14:46:54] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/bJDJcw
[14:46:54] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[14:46:54] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[14:46:54] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/CldICw
[14:46:54] <ghrust> 13rust/06auto 14984c893 15Alex Crichton: rustdoc: Add syntax highlighting...
[14:46:54] <ghrust> 13rust/06auto 14880acfb 15bors: auto merge of #12416 : alexcrichton/rust/highlight, r=huonw...
[14:46:55] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[14:47:04] <eddyb> "Enable the out of process PDF plugin." I hope it's not that, because that doesn't explain why GitHub would break
[14:47:30] <strcat> eddyb: github has flash... maybe you broke your plugins somehow?
[14:47:41] <strcat> github uses flash for the copy-to-clipboard button
[14:47:46] <eddyb> flash works fine, github just doesn't run JS
[14:48:04] <strcat> eddyb: disabled in permissions?
[14:48:25] * strcat shrugs
[14:48:35] <eddyb> but I don't use permissions!
[14:48:37] <eddyb> :)))
[14:48:46] <strcat> could do it by accident somehow
[14:49:12] <eddyb> just checked, still using the defaults
[14:49:31] <strcat> no idea then
[14:51:13] <eddyb> I can only assume some of my about:flags settings are breaking everything
[14:51:35] <eddyb> #enable-html-imports hmm, that's relevant
[14:52:47] *** Quits: Zr40 (zr40@EE4BB9F5.926C319A.BE2F4011.IP) (Quit: leaving)
[14:56:46] <eddyb> what the heck did I disable
[14:56:51] <eddyb> gist looks normal again
[14:57:06] <eddyb> i.e. it no longer has a broken viewport
[14:57:12] <eddyb> and github works fine
[15:00:10] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[15:01:04] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[15:01:54] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[15:02:03] <eddyb> oh wow
[15:02:27] <eddyb> the viewport meta tag was breaking gist, reddit and a few other sites
[15:02:40] <eddyb> should've figured that was it since it was changing the viewport
[15:06:51] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[15:06:51] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14880acfb to 142fa7d6b: 02http://git.io/N3iJvQ
[15:06:52] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[15:06:52] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[15:06:52] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/BiUYig
[15:06:52] <ghrust> 13rust/06auto 145ec1183 15Huon Wilson: rustc: avoid compiler generated `unsafe` blocks leaking....
[15:06:52] <ghrust> 13rust/06auto 14c6aaf2c 15bors: auto merge of #12419 : huonw/rust/compiler-unsafe, r=alexcrichton...
[15:06:53] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[15:11:20] *** Quits: zimbabao (rajaram@AA2D34A6.32AF4EDF.D2D1FAF0.IP) (Ping timeout)
[15:12:34] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[15:12:57] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[15:12:59] *** Quits: steveklabnik_ (uid17044@moz-A42E5B7B.irccloud.com) (Quit: Connection closed for inactivity)
[15:14:39] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[15:26:27] *** Joins: zimbabao (rajaram@F47A8EB5.977C920F.D5D59AD9.IP)
[15:36:52] *** Quits: Kxepal (Miranda@moz-D1BCA7F1.pppoe.mtu-net.ru) (Ping timeout)
[15:38:58] *** Joins: Kxepal (Miranda@moz-C530D784.pppoe.mtu-net.ru)
[15:40:31] *** Joins: lpy (lpy@12172131.F09091A8.1348A864.IP)
[15:42:05] *** flaper87 is now known as flaper87|afk
[15:42:37] *** Quits: angdev (uid7041@moz-E77DEB21.irccloud.com) (Quit: Connection closed for inactivity)
[15:44:42] *** Quits: Kxepal (Miranda@moz-C530D784.pppoe.mtu-net.ru) (Quit: Kxepal)
[15:45:07] *** Joins: Kxepal (Miranda@moz-C530D784.pppoe.mtu-net.ru)
[15:46:16] *** flaper87|afk is now known as flaper87
[15:46:47] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[15:47:06] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[15:48:47] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[15:48:54] *** Quits: zimbabao (rajaram@F47A8EB5.977C920F.D5D59AD9.IP) (Ping timeout)
[15:50:53] *** Joins: glaebhoerl (glaebhoerl@moz-B5B88D72.catv.broadband.hu)
[16:03:11] *** Quits: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro) (Ping timeout)
[16:03:27] *** Quits: jdm (jdm@CC0122E6.8F96AEA7.2D179A7D.IP) (Ping timeout)
[16:08:49] <bjz_> acrichto: rebased the integer formatting
[16:09:12] <bjz_> acrichto: also moving Integer to libnum
[16:09:35] <bjz_> https://github.com/mozilla/rust/pull/12382
[16:09:58] <bjz_> https://github.com/mozilla/rust/pull/12326
[16:15:11] <flaper87> bjz_: cool stuff!
[16:16:05] <bjz_> flaper87: :)
[16:16:17] <bjz_> I thought it was pretty cool
[16:16:19] <bjz_> :)
[16:16:46] *** darnuria is now known as darnuria|afk
[16:21:51] *** Joins: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP)
[16:21:51] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/BiUYig
[16:21:51] *** Parts: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP) ()
[16:26:50] *** Joins: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP)
[16:26:51] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/46LhWA
[16:26:51] *** Parts: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP) ()
[16:26:51] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[16:26:51] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/9XugnQ
[16:26:51] <ghrust> 13rust/06auto 14e2f99b9 15Felix S. Klock II: ptr::RawPtr, spell out units used for the `offset` argument....
[16:26:51] <ghrust> 13rust/06auto 14f8893ed 15bors: auto merge of #12420 : pnkfelix/rust/fsk-improve-doc-for-ptr-offset, r=alexcrichton...
[16:26:52] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[16:31:17] *** Joins: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP)
[16:40:35] *** Quits: japaric (japaric@5A3C0563.4F37C8B4.BFC118EE.IP) (Ping timeout)
[16:43:35] *** Joins: japaric (japaric@D3362D12.54A02F38.BFC118EE.IP)
[16:51:51] *** Quits: mawuli (mawuli@moz-36C70B7D.com.gh) (Ping timeout)
[16:52:54] *** Joins: mawuli (mawuli@moz-36C70B7D.com.gh)
[17:03:36] <flaper87> Eridius: I'm rebasing that patch, btw
[17:04:37] <bjz_> acrichto: cleaned up the integer formatting commits
[17:19:21] *** Joins: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net)
[17:19:21] *** ChanServ sets mode: +ao dherman dherman
[17:22:22] <Eridius> flaper87: ok. I'm trying to review it now, but I'm also sitting in the courthouse (jury duty), so we'll see how productive I am
[17:25:00] *** Quits: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net) (Ping timeout)
[17:41:54] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[17:41:54] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/9XugnQ
[17:41:54] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[17:42:34] *** Quits: lpy (lpy@12172131.F09091A8.1348A864.IP) (Client exited)
[17:46:52] *** Joins: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP)
[17:46:52] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/owunKw
[17:46:52] *** Parts: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP) ()
[17:46:54] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[17:46:54] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/YVBrjg
[17:46:54] <ghrust> 13rust/06auto 143a9eca3 15Brendan Zabarauskas: Move std::num::Integer to libnum
[17:46:54] <ghrust> 13rust/06auto 14b5995b4 15bors: auto merge of #12326 : bjz/rust/integer, r=alexcrichton...
[17:46:55] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[17:54:08] <flaper87> Eridius: no worries, take your time and thanks!
[17:59:21] *** darnuria|afk is now known as darnuria
[17:59:40] *** Quits: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP) (Quit: Lost terminal)
[18:03:19] *** Joins: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP)
[18:12:28] *** Quits: mawuli (mawuli@moz-36C70B7D.com.gh) (Ping timeout)
[18:16:18] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[18:16:18] *** ChanServ sets mode: +ao pcwalton pcwalton
[18:34:40] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[18:36:24] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: rcirc on GNU Emacs 24.3.1)
[18:40:57] *** Joins: doener (doener@moz-C68F600D.unity-media.net)
[18:50:31] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[18:50:56] *** Joins: andrew-__ (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[18:52:12] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Ping timeout)
[18:56:57] *** Joins: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP)
[18:56:57] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/YVBrjg
[18:56:57] *** Parts: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP) ()
[18:57:01] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Connection reset by peer)
[18:57:14] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[19:01:53] *** Joins: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP)
[19:01:53] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/4vYodw
[19:01:53] *** Parts: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP) ()
[19:01:53] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[19:01:53] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/-WCMPg
[19:01:53] <ghrust> 13rust/06auto 1445ab08f 15Alex Crichton: Force all lang items to be reachable...
[19:01:53] <ghrust> 13rust/06auto 14fc11c30 15bors: auto merge of #11603 : alexcrichton/rust/issue-11591, r=brson...
[19:01:54] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[19:17:21] *** Joins: jensnock_ (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[19:17:21] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Connection reset by peer)
[19:28:35] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[19:28:36] *** Quits: jensnock_ (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Connection reset by peer)
[19:29:21] *** Joins: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro)
[19:31:32] <eddyb> pcwalton: what's with your comment about allocas?
[19:33:29] <eddyb> SROA (and probably other passes as well) spend time analyzing allocas and ripping them out, so LLVM can do actual optimizations
[19:37:25] <pcwalton> eddyb: well, the issue is that in debug mode you want to have the allocas there
[19:37:39] <pcwalton> because debugging information really doesn't like Values
[19:37:41] <pcwalton> it likes allocas
[19:38:20] <eddyb> that's just debug mode
[19:38:53] <pcwalton> sure
[19:38:59] <pcwalton> I'm just saying it's easier for the front end to emit allocas in general
[19:39:05] <pcwalton> and then have LLVM be responsible for stripping them out
[19:39:13] <pcwalton> instead of having a more complicated front end
[19:39:38] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[19:39:38] *** ChanServ sets mode: +qo brson brson
[19:39:52] <eddyb> this and all my previous attempts (including one that is still kicking, for non-immediate byval arguments) are disabled when debuginfo is generated
[19:40:20] <eddyb> trans::debuginfo would ICE anyway if it weren't, it's hardwired that way
[19:40:29] <pcwalton> ok
[19:40:45] <eddyb> it's also easier to implement virtual-only calls
[19:40:53] <eddyb> does that mean we shouldn't monomorphize :P?
[19:41:13] <pcwalton> it's not easier to implement virtual only calls
[19:41:17] <pcwalton> monomorphizing is not about calls
[19:41:26] <eddyb> bad analogy, sorry >_>
[19:41:40] <pcwalton> it's about layout of types that are opaque
[19:41:52] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[19:41:52] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14fc11c30 to 14b5995b4: 02http://git.io/N3iJvQ
[19:41:52] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[19:41:52] *** Joins: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP)
[19:41:53] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/M_2W1A
[19:41:53] <ghrust> 13rust/06auto 1403b7910 15Patrick Walton: libstd: Implement some convenience methods on vectors
[19:41:53] <ghrust> 13rust/06auto 1478d4bf8 15bors: auto merge of #12253 : pcwalton/rust/more-vec-ng, r=alexcrichton...
[19:41:53] *** Parts: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP) ()
[19:41:55] <pcwalton> anyway I think we should do what clang does
[19:41:59] <pcwalton> nothing more, nothing less
[19:42:08] <eddyb> clang doesn't output allocas for constants
[19:42:13] <pcwalton> ok
[19:42:19] <pcwalton> then it's fine to have that optimization IMO
[19:43:19] <eddyb> and LLVM can't do trivial optimizations on the code without first doing *alias analysis* and whatnot, that's ridiculous in my book and my book is merciless :P
[19:43:54] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[19:44:19] <eddyb> (x, y) is 4 (6 with the alloca and the final load) instructions, all working with pointers, instead of 1 { %x, %y }
[19:44:51] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Input/output error)
[19:45:10] <eddyb> I think FCA (first class aggregates) is part of SROA. what it does? it changes such structural constructions back into a high-level form
[19:46:04] <eddyb> it would be nice to lower the optimization threshold for decent performance out of Rust code
[19:47:05] <eddyb> pcwalton: anyways, what this started from was your comment, just wanted to clarify (as I've suspected) that it was about debuginfo
[19:48:13] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[19:48:13] *** ChanServ sets mode: +o tjc
[19:48:46] <pcwalton> eddyb: ok
[19:48:50] <pcwalton> yup, it's just about debug info
[19:50:42] <eddyb> doener: so what was the last news about the EH stuff in LLVM? kinda hard to deal with the mailing list
[19:51:01] <brson> acrichto: when we do link to a dylib do we still read the uncompressed metadata from the rlib?
[19:52:09] <acrichto> brson: yes, if an rlib is available
[19:53:36] <brson> acrichto: out of curiosity, how do we verify they are the same build?
[19:53:54] <acrichto> brson: we don't :(
[19:54:04] <acrichto> https://github.com/mozilla/rust/issues/10786
[19:56:28] *** Quits: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP) (Ping timeout)
[19:56:29] <flaper87> nmatsakis: updated the patch. It now checks that immutable static items are Freeze 
[19:56:45] <eddyb> lovely :D
[19:57:06] <eddyb> brson: why were atomics made non-freeze again?
[19:57:09] <nmatsakis> flaper87: k
[19:57:14] <eddyb> I didn't really understood that patch
[19:59:17] <flaper87> eddyb: what patch? I added NonFreeze on atomics as part of the NonCopyable patch but then removed that to keep the patch isolated from other changes
[19:59:38] <eddyb> flaper87: not yours, brson's
[19:59:41] *** Joins: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP)
[20:00:02] <eddyb> he made atomics take &self and not be freeze
[20:00:08] <flaper87> eddyb: exactly, what patch ?
[20:00:17] <flaper87> eddyb: atomics are suppose to mutate
[20:00:56] <brson> eddyb: they are non-freeze because they are mutable
[20:01:09] <flaper87> supposed*
[20:01:19] <eddyb> https://github.com/mozilla/rust/issues/11583
[20:01:41] <brson> Freeze and Share aren't the same, and I suspect that Freeze does continue to have a role
[20:01:58] <eddyb> aaah, they are supposed to be shared, so making them more like Cell makes sense
[20:02:02] <brson> Freeze is what tells you that something behind an "immutable" pointer actually is immutable
[20:02:16] *** Joins: ktt3ja (ktt3ja@moz-85E2770C.hsd1.va.comcast.net)
[20:02:28] <flaper87> brson: btw, I already started working on the Share kind
[20:02:34] <flaper87> glad you're preparing the field for it :D
[20:03:22] <flaper87> and I agree that Freeze continue to have a role
[20:03:39] <flaper87> continues*
[20:03:45] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[20:04:14] <eddyb> Arc<AtomicCell<T>> as the thread-safe equivalent of Rc<Cell<T>> would be cool
[20:04:22] <brson> flaper87: :thumbsup:
[20:04:33] <eddyb> abstraction <3
[20:04:49] <eddyb> Rc<Cell<T, Atomic>, Atomic> pls
[20:05:09] *** Joins: geoffhill (geoffhill@moz-95FF7399.members.linode.com)
[20:06:56] <edwardw> r? https://github.com/mozilla/rust/pull/12451
[20:07:55] <edwardw> it blocks https://github.com/mozilla/rust/pull/12338
[20:08:29] <cmr> edwardw: can you just rebase 12338 on top of that commit?
[20:08:36] <cmr> no real point to having two PRs for it
[20:08:50] <edwardw> cmr: #12338 is not ready yet
[20:09:16] <nmatsakis> flaper87: https://github.com/mozilla/rust/pull/11979#issuecomment-35768249
[20:09:35] <edwardw> cmr: #12338 still needs fairly substantial work to do after this one
[20:09:40] <flaper87> nmatsakis: thanks, will read
[20:10:02] *** Quits: glaebhoerl (glaebhoerl@moz-B5B88D72.catv.broadband.hu) (Quit: )
[20:10:24] <edwardw> so I figured get this one in first
[20:11:02] <edwardw> thanks
[20:11:03] <brson> huon: what do we still need to do to get more metrics reported usefully?
[20:11:27] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[20:11:32] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[20:12:46] <brson> acrichto: how worried are you about bors' queue size?
[20:17:18] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[20:25:19] *** Quits: edwardw (edwardw@CBC31673.351D1665.B9C6B12A.IP) (Quit: Leaving...)
[20:26:51] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[20:29:44] *** Joins: new_one (new_one@moz-24744649.rice.edu)
[20:33:52] <brson> acrichto: i wonder if we don't have to be so ambitious with library stability. 'unstable' still means that we'll try not to break APIs
[20:34:14] <brson> there may be a lot that we can be *reasonably* confident about
[20:34:36] <brson> start everything at experimental - that's the dangerous one
[20:34:59] <cmr> I'm not very comfortable with putting #[stable] on anything except maybe std::mem
[20:35:22] <brson> cmr: are you comfortable release 1.0 without #[stable] on anything but std::mem?
[20:35:47] <cmr> not really
[20:36:10] <cmr> I still feel like it's being rushed. What API hasn't changed in the last two months?
[20:36:41] <brson> not many
[20:37:01] <brson> but if we don't start calling API's stable now, we're not going to have many stable API's this year
[20:37:06] <cmr> yeah
[20:37:50] *** Joins: gimpf (gimpf@moz-A6C745E1.adsl.highway.telekom.at)
[20:37:52] <cmr> I just don't want to be in a situation, like java or python, where we have this stable but crusty stdlib that's not nice to use.
[20:38:22] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[20:38:39] <cmr> we're still figuring out what is good and bad, better ways to do things etc
[20:39:26] <brson> maybe for 1.0 all people can hope for is to use unstable libraries and avoid experimental
[20:40:00] <brson> still, there *are* functions that haven't changed in a long time
[20:40:03] <cmr> yeah
[20:40:04] <cmr> Clone
[20:40:05] <brson> surely we can start making progress
[20:40:06] <cmr> local_data
[20:40:16] <cmr> option
[20:40:20] <cmr> well
[20:40:22] <brson> omg local_data is experimental forever
[20:40:24] <cmr> option likes to renamed
[20:40:29] <brson> local_data is a mess
[20:40:48] <eddyb> I know we wanted to rename unwrap to get at one point
[20:40:55] <cmr> the api seems pretty sane to me
[20:41:04] <cmr> get, set, get_mut, modify
[20:41:31] <brson> cmr: the implementation is too slow, and I'm not sure the api will survive a reimplementation
[20:41:36] <cmr> ok
[20:41:45] <brson> local_data may end up folded into the language
[20:42:13] <cmr> default
[20:43:08] <cmr> I find myself idly wondering if std::io could be put in an `io` crate.
[20:43:09] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[20:43:32] <brson> cmr: I think it can
[20:43:48] <brson> a lot of std can probably be teased apart
[20:43:59] <brson> libc and os hopefully
[20:44:14] <cmr> run, too
[20:44:20] <brson> comm and task *could* but I like having them in the prelude
[20:44:27] <brson> of course io really should be in the prelude too
[20:45:22] <cmr> I still think we should have a mechanism whereby crate can inject their traits into some sort of prelude.
[20:45:30] <cmr> jeez my writing today
[20:46:05] <cmr> potentially non-traits too
[20:46:21] <cmr> and you can say `#[no_prelude] extern crate foo;` to avoid it
[20:46:55] <brson> interesting idea. that would sort of rationalize the existing prelude as just taking advantage of another language feature
[20:46:56] <cmr> using any crate which defines its own traits is super obnoxious, since you're going to be having `use`s of the traits in every module.
[20:47:08] <brson> kind of spooky to have arbitrary items come into scope though based on your crates
[20:47:29] <cmr> I'm thinking just traits and not other items, to limit the impact.
[20:47:56] <cmr> it's less convenient, but I feel like arbitrary items might be going too far
[20:48:24] <bjz_> cmr: maybe you could have: struct Vec<T>: Vector<T> + Collection<T> {}  or something
[20:48:38] <bjz_> that injects the traits
[20:48:44] <bjz_> dunno
[20:48:49] <cmr> bjz_: what is that read as?
[20:49:26] <bjz_> it would make the methods available for that type, without having to import them
[20:49:40] <bjz_> but it could negate some of the benefits of traits
[20:49:42] <bjz_> dunno
[20:50:23] <bjz_> the Haskellers would probably hate us :D
[20:50:46] <kimundi> maybe we could just have a special "prelude" form of a use statement, that applies to all modules below
[20:51:23] <cmr> hm, that's certainly a less magical solution.
[20:51:25] <cmr> probably better.
[20:51:47] <kimundi> rustc would inject something like this at a crate root per default: "extern crate std; use all std::prelude;", but people could write the same thing manually as today
[20:52:26] <cmr> well it'd have to be std::prelude::* to match the current behavior.
[20:52:32] <cmr> I really like that idea
[20:52:42] <cmr> I can't come up with good syntax for it though
[20:53:12] <bjz_> I wonder if it is even good form to make the std prelude magic in the eyes of the compiler
[20:53:18] <kimundi> "all" could also just imply * if we end up removing * imports - but yeah if we keep it, better be specific
[20:53:44] <bjz_> It kind of feels like we're cheating
[20:54:02] <bjz_> using stuff that users of the language can't use
[20:54:44] *** Quits: gimpf (gimpf@moz-A6C745E1.adsl.highway.telekom.at) (Quit: Leaving.)
[20:55:05] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[20:55:56] <kimundi> we could also combine "extern mod" and a hypotetical use prelude::* - "extern mod foo" would automatically import everything in a submodule marked with #[prelude]
[20:56:04] <bjz_> extern prelude crate std;
[20:56:12] <bjz_> ugh
[20:56:41] <bjz_> #[prelude] extern crate std;
[20:56:43] <kimundi> "extern crate std;" vs "#[no_prelude] extern crate std;" ?
[20:56:54] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[20:56:55] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/M_2W1A
[20:56:55] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[21:01:13] <bjz_> brson: it would be nice to keep moving to reducing the amount of magic we 'privileged' rust developers can take advantage of
[21:01:59] *** Joins: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP)
[21:01:59] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/zufzTw
[21:01:59] <ghrust> 13rust/06auto 144e9df9a 15Liigo Zhuang: insignificant fix to rust manual and tutorial
[21:01:59] <ghrust> 13rust/06auto 1400982c4 15bors: auto merge of #12362 : liigo/rust/update-rust-manual, r=alexcrichton...
[21:02:00] *** Parts: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP) ()
[21:02:02] <bjz_> brson: it insulates us from what users have to deal with
[21:02:59] <bjz_> although most of us still write our own rust code, so it's not like we are completely blind
[21:03:03] <SiegeLord> I'll give the compiler as much privilege as it helps the code look good
[21:03:43] <SiegeLord> Adding #[prelude] extern crate std; to every program is a non-starter for me
[21:06:50] <bjz_> yeah :(
[21:07:28] <bjz_> Which might make `#[no_prelude] extern crate std;` more appealing
[21:08:31] <bjz_> just seems opposite to the normal rustic thing - we usually do 'opt-in' as opposed to 'opt-out'
[21:08:54] <bjz_> mut and pub for example
[21:09:17] <bjz_> (thinks priv is ugly because of that)
[21:09:31] <SiegeLord> Well, we don't opt in main :P
[21:09:50] <bjz_> true
[21:10:33] <bjz_> maybe we should :P
[21:11:19] <bjz_> i dunno, just musing is all
[21:12:08] <bjz_> these are issues for the consistency of the design of the language
[21:12:26] <bjz_> but then rules are meant to be broken :P
[21:13:18] <bjz_> the other thing is, "where do all the attributes come from"
[21:13:50] <bjz_> which is a line of thought that leads to even more potential ugliness for a user
[21:13:52] <bjz_> :P
[21:14:28] <bjz_> there has to be some magical bottom turtle at some point :)
[21:32:25] <eddyb> http://llvm.org/docs/Passes.html hmm, I didn't know about this
[21:34:11] <ktt3ja> is there a way to check if a lifetime name is already taken in the current scope?
[21:38:10] *** kimundi is now known as zz_kimundi
[21:40:40] *** Quits: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net) (Quit: dherman)
[21:43:11] <acrichto> brson: I'm getting a little worried about the queue size, it's getting to the point where you have to wait multiple days after an r+ to get tested
[21:43:47] <acrichto> brson: I don't think we need to be *super* ambitious about libraries, but I think we should support writing a "fairly substantial" program in stable code
[21:44:02] <acrichto> we should probably define the "fairly substantial" piece of code though
[21:45:06] <eddyb> ktt3ja: check resolve or resolve_lifetime for that
[21:45:36] <eddyb> hmm, if we add -lowerinvoke as a pass, we basically drop EH. -Z no-eh maybe?
[21:50:11] <acrichto> eddyb: that's what -Z no-landing-pads is for
[21:50:15] <acrichto> (no exception handling)
[21:52:20] <eddyb> hmm, right, not sure what strcat was complaining about, then
[21:53:58] *** zz_kimundi is now known as kimundi
[21:54:12] *** Quits: Axord (xord@moz-C0D5F15A.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[21:56:53] *** Joins: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP)
[21:56:54] <ghrust> [13rust] 15bors 04force-pushed 06auto from 1400982c4 to 1478d4bf8: 02http://git.io/N3iJvQ
[21:56:54] *** Parts: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP) ()
[21:56:54] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[21:56:54] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/N1gwNg
[21:56:54] <ghrust> 13rust/06auto 144e9df9a 15Liigo Zhuang: insignificant fix to rust manual and tutorial
[21:56:54] <ghrust> 13rust/06auto 1487c7e15 15bors: auto merge of #12362 : liigo/rust/update-rust-manual, r=alexcrichton...
[21:56:55] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[22:04:17] <eddyb> https://github.com/kripken/emscripten/wiki/LLVM-Backend
[22:04:21] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[22:04:21] *** ChanServ sets mode: +ao dherman dherman
[22:04:25] <eddyb> a bit sad that it's not written in Rust
[22:05:19] <cmr> ... why would it be.
[22:05:34] <cmr> you can't even write a backend in Rust
[22:06:01] <tjc> cmr: why?
[22:06:06] <tjc> (I mean, why can't you write a back-end in Rust?)
[22:06:55] <cmr> aiui you need to inherit from some base classes
[22:07:20] <pcwalton> anything is possible with enough unsafe code :)
[22:07:33] <cmr> fair enough
[22:07:42] * cmr would not want to write out vtables
[22:11:38] *** Joins: sunfish (chatzilla@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[22:14:22] <eddyb> cmr: macros!
[22:19:27] *** Quits: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net) (Ping timeout)
[22:20:10] *** Joins: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net)
[22:20:11] *** ChanServ sets mode: +o tjc
[22:23:39] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[22:30:59] *** Quits: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro) (Ping timeout)
[22:38:40] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[22:57:31] *** Quits: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP) (Quit: Lost terminal)
[23:11:55] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[23:11:55] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/N1gwNg
[23:11:55] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[23:16:53] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[23:16:53] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/lFRiEg
[23:16:53] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[23:16:55] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[23:16:55] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/mssPfg
[23:16:55] <ghrust> 13rust/06auto 14adc1095 15Alex Crichton: Force all lang items to be reachable...
[23:16:55] <ghrust> 13rust/06auto 140296403 15bors: auto merge of #11603 : alexcrichton/rust/issue-11591, r=brson...
[23:16:55] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[23:19:30] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[23:22:34] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[23:22:34] *** ChanServ sets mode: +ao pcwalton pcwalton
[23:22:42] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[23:56:35] *** Joins: cmr (moznet@moz-EC676DFE.members.linode.com)
[23:56:53] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[23:56:53] <ghrust> [13rust] 15bors 04force-pushed 06auto from 140296403 to 1487c7e15: 02http://git.io/N3iJvQ
[23:56:53] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[23:56:54] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[23:56:54] <ghrust> [13rust] 15bors pushed 1 new commit to 06auto: 02http://git.io/qa6RVg
[23:56:54] <ghrust> 13rust/06auto 14d2332bf 15bors: auto merge of #12380 : alexcrichton/rust/run-rewrite, r=brson...
[23:56:54] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[23:57:13] *** Joins: c74d (c74d@moz-E2EAC718.oc.oc.cox.net)
