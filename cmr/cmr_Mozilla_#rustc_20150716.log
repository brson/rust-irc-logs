[00:02:23] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[00:02:58] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[00:44:52] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Ping timeout: 121 seconds)
[00:47:01] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[00:47:02] *** ChanServ sets mode: +qo brson brson
[02:07:08] *** Quits: kimundi (kimundi@moz-ffdgkl.n3fm.urnq.57bc.2002.IP) (Ping timeout: 121 seconds)
[02:12:17] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[02:13:59] *** Joins: kimundi (kimundi@moz-n8b1ro.df0m.cne4.57bc.2002.IP)
[02:34:00] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Server shutdown)
[02:34:00] *** Quits: eddyb (eddyb@moz-v6d.q07.26.188.IP) (Server shutdown)
[02:34:00] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Server shutdown)
[02:34:00] *** Quits: doener (doener@moz-fnh.n4j.147.5.IP) (Server shutdown)
[02:34:00] *** Quits: Manishearth (manishearth@moz-uc30rq.anapnea.net) (Server shutdown)
[02:34:00] *** Quits: stl (stl@moz-al5.8pf.15.176.IP) (Server shutdown)
[02:34:00] *** Quits: Guest1111 (manishearth@moz-uc30rq.anapnea.net) (Server shutdown)
[02:34:00] *** Quits: klutzy (not@moz-0t8.piq.68.115.IP) (Server shutdown)
[02:34:00] *** Quits: delma (aopkarja@moz-a058nh.cs.helsinki.fi) (Server shutdown)
[02:34:00] *** Quits: Eridius (kevin@moz-6opvqs.us) (Server shutdown)
[02:36:07] *** Joins: Elaine (Elaine@moz-35s2fm.members.linode.com)
[02:36:07] *** Joins: tekacs (tekacs@moz-q64vt8.com)
[02:36:14] *** Joins: huon (huon@moz-hj272o.8rnv.rggd.6180.2400.IP)
[02:36:34] *** Joins: rdgawdzi (sid91768@moz-36ps68.ealing.irccloud.com)
[02:36:45] *** Joins: jroesch (sid26078@moz-o13a59.charlton.irccloud.com)
[02:37:00] *** Joins: reem (sid78397@moz-octfcu.brockwell.irccloud.com)
[02:37:14] *** Joins: frewsxcv (sid86219@moz-dneii9.brockwell.irccloud.com)
[02:37:17] *** Joins: mystor (sid79584@moz-761b3h.charlton.irccloud.com)
[02:39:01] *** Joins: globin (globin@moz-isrgf8.de)
[02:39:03] *** Joins: Manishearth (manishearth@moz-uc30rq.anapnea.net)
[02:39:04] *** Joins: doener (doener@moz-fnh.n4j.147.5.IP)
[02:39:04] *** Joins: delma (aopkarja@moz-a058nh.cs.helsinki.fi)
[02:42:42] *** Joins: aturon (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP)
[02:42:58] *** Joins: nrc (sid365@moz-3taf2s.0j4i.jtu0.0101.2620.IP)
[02:43:03] *** Joins: nmatsakis (sid381@moz-32a8b5.0j4i.jtu0.0101.2620.IP)
[02:44:26] *** Joins: pnkfelix (sid344@moz-nnnecs.0j4i.jtu0.0101.2620.IP)
[02:44:53] *** Joins: stl (stl@moz-al5.8pf.15.176.IP)
[02:49:02] *** ChanServ sets mode: +qo huon huon
[03:33:39] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[03:44:45] *** Quits: rdgawdzi (sid91768@moz-36ps68.ealing.irccloud.com) (Ping timeout: 121 seconds)
[03:44:53] *** Quits: jroesch (sid26078@moz-o13a59.charlton.irccloud.com) (Ping timeout: 121 seconds)
[03:45:11] *** Quits: frewsxcv (sid86219@moz-dneii9.brockwell.irccloud.com) (Connection closed)
[03:45:20] *** Quits: mystor (sid79584@moz-761b3h.charlton.irccloud.com) (Ping timeout: 121 seconds)
[03:46:30] *** Quits: reem (sid78397@moz-octfcu.brockwell.irccloud.com) (Ping timeout: 121 seconds)
[03:49:51] *** Joins: frewsxcv (sid86219@moz-dneii9.brockwell.irccloud.com)
[04:06:21] *** Joins: reem (sid78397@moz-octfcu.brockwell.irccloud.com)
[04:14:20] *** Joins: mystor (sid79584@moz-761b3h.charlton.irccloud.com)
[04:21:22] *** Quits: mystor (sid79584@moz-761b3h.charlton.irccloud.com) (Quit: )
[04:24:50] *** ChanServ sets mode: +qo nrc nrc
[04:26:18] *** Joins: jroesch (sid26078@moz-o13a59.charlton.irccloud.com)
[04:31:10] *** Joins: rdgawdzi (sid91768@moz-36ps68.ealing.irccloud.com)
[04:33:11] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[04:34:08] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[04:54:09] *** Joins: manishea1th (manishearth@moz-uc30rq.anapnea.net)
[05:05:52] *** Manishearth is now known as Guest11988
[05:05:52] *** manishea1th is now known as Manishearth
[05:05:59] *** Manishearth is now known as manishearth
[05:32:55] *** Joins: mystor (sid79584@moz-761b3h.charlton.irccloud.com)
[05:39:32] *** manishearth is now known as Manishearth
[06:29:19] *** Joins: eddyb_ (eddyb@moz-mch.eg8.166.109.IP)
[06:32:04] <eddyb_> pnkfelix: so there's a way to augment defaults so that my Unsize-based box desugaring can handle (box x): Box<T>, (box x): Box<Trait> and (box x): Box<_>
[06:33:48] <eddyb_> however, that Box<_> case won't become Box<T> until defaulting, which means you can get errors because the type is not known
[06:34:28] <eddyb_> and the whole thing feels a bit hacky
[06:36:00] <eddyb_> if we still make the compromise of tracking potential sizedness of inference variables, there might be something we can do
[06:36:38] <eddyb_> or maybe compute possible coercion sources from expectations
[06:37:13] <eddyb_> for Box<Trait> that would be Box<_>
[06:38:15] <eddyb_> take all CoerceUnsized<Expected> impls and produce a supertype out of their Selves
[06:38:23] <eddyb_> or just handle a single impl
[06:41:30] <eddyb_> and the Self type has to be a supertype of Expected
[06:45:32] *** Quits: eddyb_ (eddyb@moz-mch.eg8.166.109.IP) (Ping timeout: 121 seconds)
[07:14:42] *** Joins: laumann (thomas@moz-3m6.3kq.109.2.IP)
[07:15:28] *** Quits: richo (richo@moz-0r0.lsm.199.198.IP) (Connection closed)
[07:15:45] *** Joins: richo (richo@moz-slrmp8.fs1g.619c.a880.2604.IP)
[08:04:18] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Connection closed)
[08:04:32] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[08:24:38] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[08:39:14] *** ChanServ sets mode: +ao Manishearth Manishearth
[08:57:23] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Quit: Leaving.)
[08:57:44] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[09:11:08] *** Quits: Sergio (Sergio@moz-g1j.0qd.199.198.IP) (Quit: All done. :))
[09:17:46] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[09:49:54] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[10:20:08] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[10:24:04] *** Joins: marcusklaas (marcus@moz-1risto.dynamic.ziggo.nl)
[10:24:32] <marcusklaas> What command runs a specific compile-fail test?
[10:31:21] <doener> make check-stage2-cfail TESTNAME=yourtesthere
[10:32:40] *** Joins: arielb1 (Ariel@moz-b95g78.red.bezeqint.net)
[10:36:43] <marcusklaas> Thanks!
[11:27:08] *** Quits: marcusklaas (marcus@moz-1risto.dynamic.ziggo.nl) (Client exited)
[11:29:12] *** Quits: laumann (thomas@moz-3m6.3kq.109.2.IP) (Ping timeout: 121 seconds)
[12:36:12] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[12:55:17] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[12:58:27] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[13:00:11] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[13:36:40] <nmatsakis> how can this code for constant closures be right ? https://github.com/rust-lang/rust/blob/master/src/librustc_trans/trans/consts.rs#L882-L888
[13:36:44] <nmatsakis> it seems to always yield NULL?
[13:36:53] <nmatsakis> pnkfelix: eddyb ^?
[13:37:01] <nmatsakis> notably the last line
[13:37:19] * nmatsakis is overhauling closures -- sort of
[13:41:44] <eddyb> nmatsakis: that's correct :D
[13:42:00] <eddyb> nmatsakis: unless C_null is the wrong thing to use for zero-sized types
[13:42:07] * nmatsakis ponders
[13:42:16] <nmatsakis> eddyb: ok, I see. That makes sense.
[13:42:29] <nmatsakis> I wondered if it had to do with having no upvars
[13:42:38] <nmatsakis> but I kept thinking we'd want to produce a fat poitner
[13:42:41] <nmatsakis> but of course we don't, or at least, not here
[13:43:04] <nmatsakis> thanks eddyb 
[13:43:34] <eddyb> yeah, fat pointers are all at https://github.com/rust-lang/rust/blob/master/src/librustc_trans/trans/consts.rs#L354
[13:44:04] *** Quits: arielb1 (Ariel@moz-b95g78.red.bezeqint.net) (Connection closed)
[13:45:58] * nmatsakis holds his breath as stage1 builds
[13:46:08] <nmatsakis> I cut a lot of random code from trans regarding to closures
[13:46:10] <nmatsakis> that didn't seem very useful
[13:46:13] <nmatsakis> so far it seems I was right ;)
[13:46:27] <nmatsakis> I think if I was wrong stuff would have fallen over very badly by now
[13:46:47] *** ChanServ sets mode: +o nmatsakis
[13:50:35] *** Joins: marcusklaas (marcus@moz-1risto.dynamic.ziggo.nl)
[13:57:01] <eddyb> nmatsakis: trampolines?
[13:57:23] <nmatsakis> eddyb: sorry, what?
[13:57:53] <eddyb> there's like 2 or 3 different ugly functions in trans manually constructing trampolines for something closure-related
[13:58:00] <eddyb> like Fn* impls for fn pointers
[14:10:09] <nmatsakis> oh, yes. those are still needed afaik.
[14:10:23] <nmatsakis> there's only one
[14:10:28] <nmatsakis> iirc
[14:17:33] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[14:17:34] *** ChanServ sets mode: +qo brson brson
[14:23:29] *** Joins: Rym (uid91135@moz-n2i7qm.charlton.irccloud.com)
[15:17:19] *** Quits: marcusklaas (marcus@moz-1risto.dynamic.ziggo.nl) (Client exited)
[15:40:34] *** Joins: laumann (thomas@moz-3m6.3kq.109.2.IP)
[15:56:04] *** Quits: laumann (thomas@moz-3m6.3kq.109.2.IP) (Quit: leaving)
[16:33:50] *** Joins: arielb1 (Ariel@moz-b95g78.red.bezeqint.net)
[16:49:48] *** Quits: doener (doener@moz-fnh.n4j.147.5.IP) (Quit: leaving)
[16:58:07] *** Joins: marcusklaas (marcus@moz-1risto.dynamic.ziggo.nl)
[17:05:56] *** Quits: marcusklaas (marcus@moz-1risto.dynamic.ziggo.nl) (Client exited)
[17:32:44] <brson> here's a rewrite of pattern match trans
[17:32:47] <brson> https://github.com/rust-lang/rust/pull/27050
[17:33:01] <brson> assigning to pnkfelix
[17:34:13] <brson> it leans on the optimizer heavily to magically produce switch statements...
[17:38:55] *** Joins: killercup (killercup@moz-dgo0k0.dip0.t-ipconnect.de)
[17:43:49] *** Joins: marcusklaas (marcus@moz-1risto.dynamic.ziggo.nl)
[17:46:51] *** Joins: eddyb_ (eddyb@moz-0op.2f0.121.86.IP)
[17:49:35] *** Quits: eddyb (eddyb@moz-v6d.q07.26.188.IP) (Ping timeout: 121 seconds)
[18:00:55] <nagisa> donâ€™t we lean on optimiser pretty much always to produce code that resembles anything reasonable?
[18:01:37] *** Quits: marcusklaas (marcus@moz-1risto.dynamic.ziggo.nl) (Client exited)
[18:07:23] *** ChanServ sets mode: +o aturon
[18:11:45] *** Quits: killercup (killercup@moz-dgo0k0.dip0.t-ipconnect.de) (Connection closed)
[18:12:42] *** Joins: killercup (killercup@moz-dgo0k0.dip0.t-ipconnect.de)
[18:19:02] <eddyb_> brson: you have an avatar now! :D
[18:19:05] <eddyb_> or a new one, at least
[18:19:26] <brson> eddyb_: yep!
[18:20:28] <eddyb_> rewriting trans::_match is a good thing
[18:20:48] <eddyb_> but I'm not sure how much of it is going to be obsoleted by/lifted into the MIR
[18:21:21] <eddyb_> since the MIR encodes more or less what you can do with LLVM conditional branches and switches
[18:21:53] <eddyb_> I don't think that diff is even readable without side-by-side
[18:21:56] <huon> brson: I always thought you were a frog... you've smashed that illusion
[18:24:35] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[18:32:52] *** Quits: aturon (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP) (Quit: )
[18:33:02] *** Joins: aturon (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP)
[18:33:02] *** ChanServ sets mode: +o aturon
[18:33:35] *** Quits: killercup (killercup@moz-dgo0k0.dip0.t-ipconnect.de) (Connection closed)
[18:35:55] <arielb1> eddyb_: _match requires a rewrite anyway
[18:36:19] <eddyb_> arielb1: definitely
[18:36:19] <arielb1> I think eefriedman's rewrite is less buggy than the current one
[18:36:24] <arielb1> so if there are no performance regressions
[18:36:31] <arielb1> it should be merged
[18:36:44] <eddyb_> arielb1: having read through it, it can be lifted up wholesale to the MIR
[18:36:54] <eddyb_> it uses primitives that should be available in the MIR
[18:37:06] <arielb1> eddyb_: the MIR plan has an old-style implementation in the lowering step
[18:37:33] <arielb1> we may use a "simple" implementation there too if that works out
[18:38:11] <eddyb_> https://github.com/nikomatsakis/rust/tree/mir/src/librustc_mir/build/matches I guess this is it
[18:38:49] <eddyb_> arielb1: we could have a "simple" implementation with some transformations to clean it up before handing it over to LLVM. we'll have to see what tradeoffs there are
[18:39:19] <arielb1> eddyb_: a decision-tree implementation shouldn't be so hard
[18:39:37] <eddyb_> this looks really simple https://github.com/nikomatsakis/rust/blob/mir/src/librustc_mir/build/matches/mod.rs
[18:40:04] <arielb1> I think it would be easier than "optimizing" the result of a simple/"backtracking" impl
[18:40:20] *** Joins: killercup (killercup@moz-dgo0k0.dip0.t-ipconnect.de)
[18:40:39] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Connection closed)
[18:41:01] <eddyb_> arielb1: possibly, I don't know too much about how the old code worked
[18:41:13] <arielb1> eddyb_: the old code has become rotten and radioactive
[18:41:27] <arielb1> there are papers that describe its principle through
[18:41:44] <eddyb_> Fallout: rustc_trans
[18:42:22] <arielb1> I think  there's a pretty clear INRIA paper
[18:42:22] <arielb1> http://moscova.inria.fr/~maranget/papers/ml05e-maranget.pdf
[18:43:03] <eddyb_> it's going to be better on a typed MIR than LLVM ValueRef's
[18:44:59] <arielb1> eddyb_: *everything* is going to be better than current _match
[18:47:53] <arielb1> eddyb_: nmatsakis's seems to be a decision-tree impl
[18:47:58] <arielb1> but he doesn't do any deduplication
[18:48:05] <eddyb_> arielb1: it has that "simplify" module
[18:48:09] <eddyb_> not sure what that does
[18:48:19] <arielb1> eddyb_: deals with irrefutable patterns
[18:48:25] <eddyb_> ah
[18:49:28] <arielb1> I don't think he implements slice patterns at all
[18:51:31] *** Quits: arielb1 (Ariel@moz-b95g78.red.bezeqint.net) (Quit: Ex-Chat)
[18:59:48] *** Quits: killercup (killercup@moz-dgo0k0.dip0.t-ipconnect.de) (Connection closed)
[19:00:50] *** Joins: killercup (killercup@moz-dgo0k0.dip0.t-ipconnect.de)
[19:19:47] *** Quits: killercup (killercup@moz-dgo0k0.dip0.t-ipconnect.de) (Connection closed)
[19:20:33] *** Joins: killercup (killercup@moz-dgo0k0.dip0.t-ipconnect.de)
[19:27:56] <jroesch> My final parts just came in for my Rust build machine, now(after I finish putting it together) I have an 8 core server processor dedicated to building rustc
[19:29:31] *** Quits: killercup (killercup@moz-dgo0k0.dip0.t-ipconnect.de) (Connection closed)
[19:30:00] *** Joins: killercup (killercup@moz-dgo0k0.dip0.t-ipconnect.de)
[19:31:48] *** Quits: killercup (killercup@moz-dgo0k0.dip0.t-ipconnect.de) (Quit: Bye)
[20:11:06] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[20:19:56] <jroesch> eddyb_: I finally am finishing this error reporting is there a way to get a path from a def_id 
[20:20:11] <eddyb_> jroesch: sure
[20:20:19] <eddyb_> jroesch: technically... using {} with a DefId might work
[20:20:31] <eddyb_> but there is something more specific
[20:20:51] <eddyb_> jroesch: tcx.item_path_str
[20:24:47] <jroesch> cool thanks
[20:30:59] <jroesch> in order to make everything easier I just ended up adding to the ast_map yesterday  
[20:50:20] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[21:21:09] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[21:21:28] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[21:32:52] *** Quits: Rym (uid91135@moz-n2i7qm.charlton.irccloud.com) (Quit: Connection closed for inactivity)
[21:44:01] <eddyb_> jroesch: https://github.com/eddyb/rust/commit/e46adf899b2f7807607ad9d69975e6f9c131a840#diff-39fd9762d3b383e2029bfcf4e1b73e53R140
[21:44:18] <eddyb_> jroesch: this is the Box<_> stuff that might be solved by a very hacky defaulting scheme
[21:44:49] <eddyb_> jroesch: but I don't think I want to do it that way anymore, just a test subject
[21:52:24] *** eddyb_ is now known as eddyb
[22:09:04] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[22:13:09] *** Joins: Rym (uid91135@moz-n2i7qm.charlton.irccloud.com)
[22:20:34] <eddyb> oh I don't even need to screw around with typeck too much
[22:21:19] <eddyb> nmatsakis: I want selecting _: CoerceUnsized<Box<_>> to result in picking the Box impl instead of being ambiguous
[22:22:20] <eddyb> nmatsakis: both the source and the target have to be defined in the same crate as the impl - well, they have to match structurally, too
[22:28:17] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[22:28:17] *** ChanServ sets mode: +qo brson brson
[22:40:00] <eddyb> > DEBUG:rustc::middle::traits::select: candidate set contains ambig
[22:41:10] <eddyb> nmatsakis: so I have just one candidate, the impl, but ambiguities from both object and projection candidate selection
[22:41:44] <eddyb> object types don't make sense here, could whitelist this trait there
[22:43:49] <eddyb> nmatsakis: shouldn't we say that _: Trait is ambiguous wrt projections iff there are no other candidates?
[22:44:06] <eddyb> I'm not sure though, I just want to get this thing to work :/
