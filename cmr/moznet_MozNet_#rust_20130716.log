[00:00:05] <strcat> engla: extern fn + environment ptr shouldn't ever be more useful
[00:00:12] <strcat> it means the stack closures aren't implemented properly
[00:00:17] <cmr> dbaupp: how old is it though ;(
[00:00:17] <engla> right
[00:00:30] <dbaupp> cmr: very, like everything
[00:00:30] <engla> strcat: I'm asking if you know if this can work
[00:00:35] <strcat> engla: the lifetime on the stack closure is *only* talking about the environment pointer
[00:00:39] <strcat> so yes it should work
[00:00:42] <ChrisMorgan> cmr: I had no trouble with itâ€”except when I had two methods (parse_crlf_line and parse_header_line) both containing an enum called State and both containing a member Normal... that surfaced https://github.com/mozilla/rust/issues/7770
[00:00:43] * dbaupp loves how things are out-of-date within 2 weeks in Rust-land
[00:00:57] <strcat> &fn should work exactly like an &mut T environment
[00:01:01] <tjc> Right - "It was written back in the Stone Ageâ€¦ a year ago..."
[00:01:01] <engla> it doesn't
[00:01:12] <strcat> so it's probably a bug
[00:01:16] <tikue> rusti: struct Foo { bar: uint, baz: uint }; match &Foo { bar: 0, baz: 1 } { &Foo {bar : bar, _} => bar }
[00:01:17] -rusti- 0
[00:01:21] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[00:01:22] <cmr> tjc: I always feel bad for calling 0.5 code "ancient"... it was only 6 months ago!
[00:01:23] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[00:01:23] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/u22nCw
[00:01:23] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[00:01:39] <strcat> closures and traits don't really work well
[00:01:40] <tjc> cmr: :-D It's what happens when you're on the cutting edge
[00:01:53] <strcat> I'm not surprised there are bugs
[00:02:01] <strcat> iterators couldn't be written at all before 0.6
[00:02:03] <cmr> dbaupp: I have no way to verify, but afaik the bench server should be chugging away at historical commits?
[00:02:16] <dbaupp> cmr: probably?
[00:02:18] <strcat> cmr: well it looks denser ;p
[00:02:28] <dbaupp> cmr: unless the python script is crashing from lack of network?
[00:02:35] * dbaupp thinks that is quite possible
[00:02:48] <cmr> dbaupp: maybe. don't think it would be, unless it's barfing on non-successful git pulls
[00:03:15] <cmr> if we have another outage I'll test and verify that it does work with no internet access...
[00:03:28] <dbaupp> cmr: yeah, does plumbum throw an exception for non-successful calls?
[00:03:36] <strcat> tjc: any idea if I can build a compiler from stage0 libs that's usable on small examples? x86_64-unknown-linux-gnu/stage1/bin/rustc isn't without having the stage1 libstd/etc.
[00:03:44] <cmr> dbaupp: oh, yes it does
[00:03:47] * strcat doesn't understand how it manages to bootstrap stage1
[00:04:00] *** Joins: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP)
[00:04:02] <dbaupp> cmr: (because IIRC the pull calls aren't wrapped in a try-except)
[00:04:02] <engla> strcat: I'm just frustrated to know that this issue that we've discussed before -- you never tried it, you're just talking out of what you think should work. fair enough, but I've always worked with experiments with code
[00:04:07] <tjc> strcat: Hmm, well, you can use examples that don't depend on any of the libs
[00:04:14] <tjc> obviously you can't write much with that
[00:04:14] <dbaupp> cmr: so :'( we're wasting days
[00:04:22] * dbaupp should've thought of this before
[00:04:22] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[00:04:22] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/yIV04w
[00:04:22] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[00:04:25] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[00:04:25] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/m8Qe6g
[00:04:25] <ghrust> 13rust/06auto 143385e79 15blake2-ppc: ringbuf: Implement DoubleEndedIterator
[00:04:25] <ghrust> 13rust/06auto 1498c1654 15bors: auto merge of #7808 : blake2-ppc/rust/ringbuf, r=thestinger
[00:04:25] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[00:04:33] <cmr> dbaupp: bors was idle all weekend too though!
[00:04:40] <strcat> engla: the & in &fn corresponds to the environment
[00:04:43] <dbaupp> cmr: true!
[00:04:53] <tjc> strcat: hmm, maybe with the right -L flags, you could run stage1/bin/rustc and point it to the stage0 libs that are bundled with the snapshot?
[00:04:54] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[00:04:58] <engla> strcat: I know closures have environments
[00:05:12] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[00:05:16] <strcat> as far as the borrowck pass is concerned, closures are just an environment
[00:05:25] <strcat> the function pointer is always immutable and lives forever
[00:05:36] <strcat> so if it doesn't work as an explicit environment, it's a bug
[00:05:39] <strcat> there are lots of closure bugs
[00:05:49] <strcat> I've run into lots of them
[00:06:30] <engla> the custom filter iterator works fine
[00:06:49] <engla> and will be able to convert all the hashset difference etc operations
[00:07:10] <ChrisMorgan> It's kinda cool having the order of items in a HashMap _not_ being consistent. Makes it obvious that you can't depend on it!
[00:07:26] *** Joins: ronny (ronnypfa@moz-E7EE6ABE.uberspace.de)
[00:07:36] <strcat> ChrisMorgan: if you know a language where it's consistent, they're vulnerable to DoS attacks
[00:07:50] <ChrisMorgan> How so?
[00:08:00] <strcat> because their hash tables aren't keyed
[00:08:15] <sully> oh, darn, I think I might not be able to get rid of one of the maps that I wanted to eliminate :(
[00:09:00] <ChrisMorgan> strcat: I don't get where the vulnerability would be.
[00:09:05] <strcat> hash tables use a small keyspace
[00:09:10] <strcat> 32-bit, 64-bit, 128-bit
[00:09:24] <strcat> ChrisMorgan: because it becomes O(n)
[00:09:35] <strcat> and plenty of stuff parses every incoming request using hash tables, and so on
[00:09:42] <strcat> turning http headers into a hash table
[00:10:07] <cmr> ChrisMorgan: http://events.ccc.de/congress/2011/Fahrplan/events/4680.en.html
[00:10:16] <cmr> there's a video somewhere
[00:10:19] <cmr> it's a good watch
[00:10:29] <ChrisMorgan> If I have a HashMap<~str, ~str>, how can I sort it by key in iteration?
[00:10:38] <strcat> ChrisMorgan: you can't
[00:10:45] <strcat> if you need a sorted map, you want a TreeMap
[00:11:08] <strcat> otherwise, you'd have to put them all in a vector and sort it
[00:11:38] <ChrisMorgan> How would I do that latter?
[00:12:41] <strcat> just iterate over it with iter() and copy it into a vector (by-ref or by-value) and sort
[00:12:48] *** Quits: dwhyte (dwhyte@ED9190FB.B72E355F.7BF4A4B0.IP) (Quit: Leaving.)
[00:12:48] <strcat> you could probably just use iter and collect
[00:13:16] <ChrisMorgan> I mean the sort part, actually. Don't see any sort method immediately on vectors.
[00:13:24] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[00:13:29] <strcat> extra::sort
[00:14:48] <ChrisMorgan> Ah, good; thanks.
[00:14:53] <strcat> or just change HashMap -> TreeMap and it will be sorted already
[00:15:07] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[00:16:01] *** Joins: dwhyte (dwhyte@ED9190FB.B72E355F.7BF4A4B0.IP)
[00:16:32] *** Quits: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[00:16:51] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[00:17:23] <strcat> tjc: sadly won't actually work atm due to stage0 being called 0.7 and it having a bunch of lang items missing ;[
[00:17:27] <strcat> hm
[00:17:42] <strcat> it's hard to debug a broken trans ;p
[00:18:00] *** Quits: jdm (jdm@F2D29657.F60B0462.67AC9B1.IP) (Input/output error)
[00:18:06] <tjc> strcat: yeah, I'm not sure how to get around that. trying to think about bootstrapping makes my brain tie itself into knots :-(
[00:18:15] <strcat> yep that's what's happening to my brain atm :)
[00:18:47] <strcat> probably easier to just keep grepping and find this evil place making a vector wrong
[00:18:51] <jensnockert> strcat: `x86_64-apple-darwin/stage1/bin/rustc simd-test/lvalues.rs -o x86_64-apple-darwin/test/simd-test/lvalues.stage1-x86_64-apple-darwin -L x86_64-apple-darwin/test/simd-test -L x86_64-apple-darwin/test/simd-test/lvalues.libaux --cfg debug --target=x86_64-apple-darwin --emit-llvm -S` works for me.
[00:19:30] <strcat> jensnockert: try clearing out your existing stage1 libs
[00:19:31] <strcat> like libstd
[00:19:33] <jensnockert> Oh, you said stage0 libsâ€¦
[00:19:48] <strcat> like, pretend stage0 libs build fine and you get a stage1 compiler
[00:19:52] <jensnockert> strcat: Yeah, that will epically fail.
[00:19:52] *** Joins: jdm (jdm@F2D29657.F60B0462.67AC9B1.IP)
[00:19:54] <strcat> but have no stage1 libs and can't build them
[00:19:55] <strcat> jensnockert: yep :(
[00:19:58] <strcat> foo.rs:1:0: 1:0 error: can't find crate for `std`
[00:20:05] <strcat> I could use zero.rs
[00:20:07] <strcat> ;p
[00:20:13] <sigma> do that!
[00:20:17] <jensnockert> Complicate all the things!
[00:20:17] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[00:20:20] <sigma> cya in a week
[00:20:47] *** Quits: bnicholson (bnicholson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[00:20:58] <jensnockert> strcat: Tell me about debugging a broken transâ€¦
[00:21:02] <strcat> all I need is the ability to try some things with unique vectors and figure out where it interprets them as having a header
[00:21:09] <strcat> so zero.rs seems perfect
[00:21:48] <bblum> ah!
[00:21:53] <bblum> sudden glimmer of hope
[00:22:07] <strcat> except I think zero.rs has broken strings
[00:22:09] <bblum> my 1-in-100 race condition repros 1-in-1 times when i set RUST_THREADS=1.
[00:22:09] <dbaupp> strcat: the zero.rs from my malloc thingo is up-to-date wrt lang-items etc.
[00:22:14] <strcat> dbaupp: oh
[00:22:19] <strcat> dbaupp: link?
[00:22:41] <dbaupp> strcat: https://github.com/huonw/rust-malloc/blob/master/zero.rs
[00:22:45] <bblum> hmm, is that necessarily good? maybe not
[00:22:49] <strcat> at least I don't have to debug races like bblum 
[00:22:52] *** Quits: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving)
[00:22:56] <bblum> hmm
[00:22:58] <bblum> hmmmmm
[00:23:00] <bblum> strcat: ;)
[00:23:12] <dbaupp> strcat: (I did replace all the mallocs with abort, so you might have to fix that ;P )
[00:23:25] <strcat> dbaupp: doesn't really matter
[00:23:28] <strcat> it just has to find the lang items
[00:23:34] <dbaupp> strcat: oh, good
[00:23:36] <strcat> until I get past LLVM asserts and onto memory corruption
[00:23:40] <zslayton> I have a variable that implements Div, but I need to divide it by an integer. Since the variable might not be an integer, what's the idiomatic approach?
[00:23:41] <ChrisMorgan> cmr: would TreeMap be subject to that vulnerability? What would its performance characteristics be in comparison with HashMap for things like HTTP headers and POST values?
[00:23:46] * strcat longs for heap corruption errors
[00:23:59] <strcat> ChrisMorgan: worse-case O(logn) search/delete/insert
[00:24:09] <strcat> so, lets say you put 2**32 elements in it
[00:24:19] <strcat> the worst case is ~32 comparisons
[00:24:40] <ChrisMorgan> Yeah, whoops, I meant strcat rather than cmr. cmr just showed me the paper that explained it :-)
[00:24:42] <cmr> ChrisMorgan: the problem with hashmap (which rust doesn't have) is collisions and chaining in the case of collision aiui
[00:24:52] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[00:25:01] <cmr> haven't looked at it since it was released.
[00:25:04] *** Quits: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net) (Quit: ozten)
[00:25:05] <cmr> could misremember
[00:25:16] <sigma> huh, rust doesn't have a hashmap anywhere?
[00:25:25] <strcat> core::hashmap
[00:25:27] <strcat> there's a map and set
[00:25:27] <graydon> it certainly does!
[00:25:29] <cmr> sigma: no, it doesn't have the problems with collision because it's keyed
[00:25:30] <ChrisMorgan> sigma: std::hashmap
[00:25:31] *** Joins: jgilbert (jgilbert@moz-7B0110AD.mv.mozilla.com)
[00:25:31] <sigma> ahh
[00:25:46] * strcat broke strings
[00:26:00] <strcat> it's fun trying to debug stuff when you don't have strings
[00:26:02] <strcat> hm
[00:26:16] <cmr> So you can't generate a malicious request which totally kills the hashmap
[00:26:27] <graydon> not unless you're real clever
[00:26:30] <graydon> _real_ clever
[00:26:33] <sigma> hmm, now I'm amazed that I havn't needed a hashmap for anything... coming from python I used them for everything. interesting
[00:26:44] * jensnockert hugs strcat "No one wanted those silly strings anyhow"
[00:26:45] <cmr> graydon: is SIP broken?
[00:26:53] <cmr> I was under the impression it was a secure hash
[00:27:02] <strcat> that's good
[00:27:04] <dbaupp> zslayton: you can `impl Div<int, MyType> for MyType`
[00:27:07] <cmr> maybe I'm misremembering the requirements of a secure hash
[00:27:15] <graydon> it's a secure short-input keyed hash, yes
[00:27:39] <graydon> I'm just saying, y'know. if you're the NSA, well ... I bet you can waltz through any old thing we put in our stdlib :)
[00:27:42] <cmr> well, maybe
[00:27:46] <cmr> I can see a timing attack
[00:27:50] <zslayton> dbaupp: I'm trying to write the generic code, so I don't know what MyType will be. I just know it implements some collection of traits.
[00:27:50] <cmr> but it's going to be quite elaborate
[00:27:50] <strcat> cmr: it has a small key so it's not collision resistant, it's just resistant to finding *many* collisions to the same bucket
[00:27:56] <graydon> dogs with bees, etc.
[00:28:05] <dbaupp> it's probably worth having a FastHashmap that uses a faster hash for non-exploitable uses
[00:28:10] <strcat> cmr: it's not vulnerable to timing attacks, because knowing you're causing collisions doesn't help you find more
[00:28:12] <cmr> and if the hashmap is rekeyed  etc... you'd have to be _real_ _real_ clever
[00:28:23] <zslayton> dbaupp: I could make my integer a floating-point type, but it's just a counter so the CS101 student in me doesn't want to do that
[00:28:26] <graydon> the hashmap is rekeyed as it expands IIRC
[00:28:31] <graydon> (if not there's a bug on that)
[00:28:32] <dbaupp> zslayton: ah
[00:28:34] <engla> siphash is a new hash function, so of course it can happen that it is broken
[00:28:35] <strcat> graydon: it doesn't
[00:28:38] <graydon> awww
[00:28:40] <graydon> it was supposed to!
[00:28:48] <jdm> I am so excited for mw's debuginfo work
[00:28:50] <strcat> graydon: it's definitely supposed to reseed on clone and it doesn't ;[
[00:28:51] <jdm> the most recent pull request is gold
[00:28:52] <jdm> goooooooold
[00:28:53] <cmr> jdm: me too!
[00:28:59] <dbaupp> zslayton: I could be more help with code ;)
[00:29:07] <zslayton> dbaupp: You got it!
[00:29:08] <jdm> there are approximately one million tests
[00:29:16] <jdm> it will never break due to neglect ever again
[00:29:21] <cmr> awesome
[00:29:24] <strcat> graydon: it doesn't seem like it's very important on resize but I could be wrong.
[00:29:54] <bblum> dammit. infinite looping test case made me start swapping.
[00:30:00] <bblum> goodbye, disk cache; i hardly knew ye
[00:30:03] <strcat> because in the worst case you'll have the same # of collisions when you expand it
[00:30:13] <graydon> engla: yeah, but it's also a pretty plain arx hash, ought to be similarly strong to several of the non-broken sha3 candidates
[00:30:28] <strcat> rustc: /home/strcat/projects/rust/src/llvm/lib/IR/Instructions.cpp:276: void llvm::CallInst::init(llvm::Value*, llvm::ArrayRef<llvm::Value*>, const llvm::Twine&): Assertion `(Args.size() == FTy->getNumParams() || (FTy->isVarArg() && Args.size() > FTy->getNumParams())) && "Calling a function with bad signature!"' failed.
[00:30:28] <graydon> assuming there are no egregious flaws
[00:30:30] <strcat> heh
[00:30:42] * strcat wonders how he caused this
[00:30:58] <zslayton> dbaupp: http://pastebin.com/8eaX6Vg9
[00:31:18] <engla> graydon: I've read the spec, so I know that they don't promise to be near as strong
[00:31:34] <engla> it's much simpler and much faster
[00:31:40] <strcat> uh..... I broke the allocation lang item somehow
[00:31:41] <graydon> engla: fair
[00:31:54] <sigma> when you resize the hash can you not just use an extra bit of the existing hash? thought that would take care of the collisions nicely
[00:31:55] <graydon> not "as strong", I meant more like .. similar strategy to attack. just much less work to spend.
[00:32:05] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[00:32:06] * sigma vaguely remembers how dicts are implemented in python
[00:32:07] <dbaupp> zslayton: (just btw, the egyptian braces are the normal for Rust code, `if foo {\n ...\n} else {\n ... \n}`.)
[00:32:08] <jensnockert> On the other hand, SIP only needs to be collision resistant for as long as the app is running.
[00:32:09] <strcat> dbaupp: your code isn't updated for master ;p
[00:32:15] <dbaupp> strcat: really?
[00:32:19] <strcat> dbaupp: exchange_malloc takes 1 param now
[00:32:32] *** Joins: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com)
[00:32:35] <dbaupp> strcat: that must've happened overnight or something?
[00:32:42] <dbaupp> (my night..)
[00:32:45] <strcat> dbaupp: no, happened a while ago
[00:32:52] <strcat> not sure how you were succeeding in compiling ;\
[00:33:07] <dbaupp> oh, right, I'm using a Rust from the 12th
[00:33:15] <strcat> Date:   Mon Jul 8 13:27:55 2013 -0400
[00:33:15] <dbaupp> strcat: that's how
[00:33:16] <zslayton> dbaupp: Old habits die hard
[00:33:17] <strcat>     remove the unused exchange_malloc `align` parameter
[00:33:30] <dbaupp> hm, what?
[00:33:33] <dbaupp> that's pretty strange
[00:33:33] <strcat> anyway now I get the error I expected
[00:33:41] <strcat> dbaupp: are you using... stage0?
[00:33:43] <strcat> ;p
[00:33:44] <dbaupp> strcat: no
[00:33:48] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[00:33:49] <dbaupp> strcat: what hash is that commit?
[00:33:55] <dbaupp> strcat: (and when did it actually get merged?)
[00:34:18] <pcwalton> is there an append_consume
[00:34:26] *** Joins: rusti_ (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[00:34:38] <dbaupp> pcwalton: push_all_move, IIRC
[00:34:47] <pcwalton> thanks, that needs a better name :)
[00:34:53] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[00:34:56] *** Joins: victorporof (victorporo@864CC037.542EA61F.70D60F75.IP)
[00:34:58] <cmr> http://rustlog.octayn.net/post/55556576145/status-update, 'night all.
[00:35:13] <dbaupp> zslayton: also the `let x1 = x.clone(); if self.running_min.gt(&x1)` could probably be `if self.running_min.gt(&x)`
[00:35:29] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[00:35:34] *** Joins: strcat1 (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[00:35:37] <zslayton> dbaupp: I was getting errors about borrowing
[00:35:49] <dbaupp> zslayton: I'd be surprised...
[00:35:50] <zslayton> dbaupp: I'll try that out and see what I get
[00:35:51] <strcat1> dbaupp: 90f1db10fa29eb6b91e22037f13130f854da1401
[00:35:59] <strcat1> rusti: 2
[00:36:00] *** Quits: rusti_ (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[00:36:02] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[00:36:03] <strcat1> rusti: 2
[00:36:04] -rusti- 2
[00:36:07] <strcat1> rusti: unsafe { std::rt::global_heap::exchange_malloc(5) }
[00:36:08] -rusti- 140111968733440
[00:36:17] <dbaupp> zslayton: but anyway, if self.running_min > x { .. } should also work?
[00:36:26] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[00:36:54] <dbaupp> zslayton: (also, the let x = y.clone(); shouldn't be required because you've got other clones... I don't really know.)
[00:37:02] *** Quits: victorporof (victorporo@864CC037.542EA61F.70D60F75.IP) (Ping timeout)
[00:37:06] <strcat1> rusti: let p = ~5; let p: *int; unsafe { p = cast::transmute(p) }; *p
[00:37:07] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/SPNL
[00:37:15] <strcat1> rusti: let p = ~5; let p: *int; unsafe { p = std::cast::transmute(p) }; *p
[00:37:16] -rusti- <anon>:7:74: 7:76 error: dereference of unsafe pointer requires unsafe function or block
[00:37:16] -rusti- <anon>:7          let p = ~5; let p: *int; unsafe { p = std::cast::transmute(p) }; *p
[00:37:16] -rusti-                                                                                    ^~
[00:37:16] -rusti- error: aborting due to previous error
[00:37:18] -rusti- application terminated with error code 101
[00:37:25] <strcat1> anyway
[00:37:28] <strcat1> shouldn't work ;p
[00:37:29] <dbaupp> zslayton: anyway, the IntConvertible trait would allow you to go R -> int
[00:37:29] *** strcat1 is now known as strcat
[00:37:56] <zslayton> dbaupp: Yup, that worked! (Simplifying gt) I've gone through so many experimental iterations I can't recall what I have and haven't tried.
[00:38:17] <dbaupp> zslayton: yeah, it's always hard to keep track of stuff like that :)
[00:38:25] * dbaupp has written some very very horrible Rust code
[00:38:33] <strcat> I guess trans_uniq_or_managed_vstore is just wrong
[00:38:48] <zslayton> dbaupp: Is ">" supported on a compiler level? So the Ord trait lets me use >, <, etc?
[00:38:57] <dbaupp> zslayton: yeah
[00:38:58] * strcat wanted to blame something he didn't just write
[00:39:02] <goffrie> rusti: let h = ~[1,2,3]; do std::task::try { println!("%?", h); }; do std::task::try { println!("%?", h); }
[00:39:03] -rusti- <anon>:7:47: 7:54 error: macro undefined: 'println'
[00:39:03] -rusti- <anon>:7          let h = ~[1,2,3]; do std::task::try { println!("%?", h); }; do std::task::try { println!("%?", h); }
[00:39:03] -rusti-                                                         ^~~~~~~
[00:39:03] -rusti- application terminated with error code 101
[00:39:07] <goffrie> oops
[00:39:08] <dbaupp> zslayton: same with Add/Sub/Div/Mul for + etc
[00:39:14] <strcat> seriously this code makes no sense to me
[00:39:18] <zslayton> dbaupp: Great to know, thanks!
[00:39:22] <goffrie> rusti: let h = ~[1,2,3]; do std::task::try { println(fmt!("%?", h)); }; do std::task::try { println(fmt!("%?", h)); }
[00:39:23] -rusti- ~[1, 2, 3]
[00:39:23] -rusti- application terminated abnormally with signal 11 (Segmentation fault)
[00:39:25] <goffrie> ^ is that a known bug?
[00:39:52] <strcat> goffrie: don't think spo
[00:39:53] <strcat> so*
[00:39:55] <strcat> looks bad
[00:39:59] <bjz> jensnockert: how goes the conversions?
[00:40:01] <strcat> I guess it's a closure bug
[00:40:05] <dbaupp> zslayton: if you look at the appropriate file (std/cmp.rs for Ord) you'll see a #[lang_item="lt"] on the declaration of lt (etc) which is how Rust knows what to call for </> etc.
[00:40:10] <zslayton> dbaupp: This may not apply any longer, but I was trying to use the match keyword for the sum, min, and max methods
[00:40:26] <zslayton> dbaupp: And it was arguing with me about what could follow match, so I fell back to if/else
[00:40:31] <jensnockert> bjz: I think it works, as long as you're not counting that LLVM crashes half way through compilation.
[00:40:37] <dbaupp> zslayton: did you need a ;?
[00:40:38] <zslayton> dbaupp: What's allowed to follow match, exactly?
[00:41:08] <goffrie> reported as #7810, then
[00:41:12] * bjz still thinks it's wierd you can use the operators inside the operator traits :/
[00:41:13] <dbaupp> zslayton: I'd guess it's a normal expression (like println("foo")), so if it's not last in a block then it needs a ;
[00:41:23] <klutzy> goffrie: like this? https://github.com/mozilla/rust/issues/6653
[00:41:28] <dbaupp> zslayton: where as `if` is special
[00:41:40] <dbaupp> rusti: match 1 { _ => () } 1
[00:41:41] -rusti- 1
[00:41:45] <bjz> dbaupp: jensnockert is going to push a change sometime that adds numeric conversions
[00:41:46] <Luqman> zslayton: any exression
[00:41:46] <dbaupp> hm, maybe not
[00:41:47] <zslayton> dbaupp: Hm, at the time I don't know that that was a problem. But that was lifetime ago, heh
[00:42:00] <jensnockert> bjz: Oh, that, I was thinking about SIMD.
[00:42:04] <dbaupp> zslayton: yeh, i'm wrong, if the match returns ()
[00:42:07] <jensnockert> bjz: Completely forgot about that.
[00:42:14] <bjz> jensnockert: oh
[00:42:28] * dbaupp hugs jensnockert 
[00:42:32] *** Joins: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net)
[00:42:43] * jensnockert hugs dbaupp, bjz and anyone who feels they deserve one.
[00:42:51] <goffrie> klutzy: no idea :p not sure about how all this stuff works
[00:42:53] <dbaupp> jensnockert: thank you for the numbers! :P
[00:42:55] <zslayton> dbaupp: I just realized -- I was cloning and stuff before because this used to iterate over borrowed variables instead of stack variables
[00:43:02] <dbaupp> zslayton: aha!
[00:43:10] <zslayton> dbaupp: the stack variable way is infinitely easier
[00:43:18] <zslayton> dbaupp: I have so much to learn about lifetimes
[00:43:24] <dbaupp> zslayton: also, the Zero trait provides .is_zero()
[00:43:35] <strcat> meh
[00:43:43] <zslayton> dbaupp: Oh! Good call
[00:43:53] <strcat> can't see how this could be wrong..
[00:44:52] <dbaupp> zslayton: and... the accessors could possibly be `fn min<'a>(&'a self) -> Option<&'a R>`, if you're feeling like exercising your lifetimes :)
[00:44:58] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[00:45:35] <zslayton> dbaupp: Hm! What would you say is more idiomatic?
[00:45:44] <zslayton> dbaupp: I guess avoiding allocation wherever possible is always nice
[00:45:48] <dbaupp> zslayton: avoiding the .clone call is nice, yeah
[00:45:57] <strcat> oh yay figured it out
[00:46:02] <klutzy> goffrie: it seems that closure does not borrow variables in a right way, so illegal move are not detected and causes crash
[00:46:19] <zslayton> dbaupp: I'll have to run through all this again to see what kluges and cruft I can rework since I'm not doing the complicated way any more
[00:46:22] <dbaupp> zslayton: (.clone doesn't necessarily allocate, btw, e.g. int.clone() = int)
[00:46:46] <dbaupp> but it does in some instances, e.g. bigint, so it's convenient to avoid.
[00:46:59] <zslayton> dbaupp: That's what I suspected. I think almost all uses of this code will use primitives,
[00:47:00] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Connection reset by peer)
[00:47:15] <zslayton> dbaupp: but this is as much a learning experience as an attempt to build something functional
[00:47:24] <dbaupp> zslayton: sure
[00:47:31] <zslayton> dbaupp: So I'll try to avoid the extra clone()
[00:48:27] <zslayton> dbaupp: What's the style guideline for 'self vs 'a?
[00:48:35] <zslayton> dbaupp: (Or 'static for that matter?)
[00:48:49] <dbaupp> zslayton: that's not really a style guideline... more of a compiler explodes if you don't guideline :P
[00:49:10] <dbaupp> zslayton: essentially 'self in types and trait headers, 'a for standalone lifetimes on functions and methods
[00:49:17] <zslayton> dbaupp: ha, noted!
[00:49:34] <dbaupp> zslayton: and 'static when the data is static, e.g. string literals, references to `static`-ly declared variables
[00:50:05] <zslayton> dbaupp: Makes sense. I haven't run into a need for static yet. I'm sure I'll trip over it one of these days
[00:50:51] <dbaupp> it's pretty hard to describe the exact rules (especially for me, since I don't know them precisely)... I only know things from trying various permutations of things until rustc stopped ICE-ing/complaining :P
[00:51:13] <zslayton> dbaupp: haha, that's my usual MO
[00:51:14] <strcat> zslayton: clone is a copy as shallow as can be btw
[00:51:27] <strcat> which means, a copy of what the type owns directly
[00:51:43] <zslayton> strcat: Is there another DeepCopy trait or similar?
[00:51:50] <dbaupp> zslayton: DeepClone
[00:51:51] <strcat> yes, DeepClone traverses @/Rc
[00:52:00] <strcat> Clone does a shallow copy of &, Rc and @
[00:52:11] <strcat> (there's no DeepClone for &, it can't really do that ;p)
[00:52:19] <zslayton> strcat: Good to know, thank you
[00:53:00] *** Quits: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP) (Client exited)
[00:53:05] <strcat> DeepClone requires a T: Const bound for @/@mut though, to make sure it's not cyclic (or was it T: Send? either works, but I forget what I did)
[00:53:21] * strcat wishes we have !Trait ;p
[00:53:25] <strcat> s/have/had/
[00:53:55] <zslayton> strcat: What's the Const trait do?
[00:54:07] <strcat> zslayton: err, it's called Freeze now actually
[00:54:10] <zslayton> strcat: (Since variables are const/final by default)
[00:54:15] <strcat> but it means things that are a) immutable or b) inherit mutability
[00:54:25] <strcat> so, *not* cell/RcMut/@mut/RWARC
[00:54:53] <strcat> since @ is immutable and you can't create a cycle unless something doesn't respect the usual mutability rules
[00:55:22] *** Quits: alisdair (textual@moz-EA60A466.dedicated.allstream.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[00:55:33] <zslayton> strcat: Oh, it's cool that there's a trait that expresses that. Useful!
[00:55:39] *** Quits: BitPuffin (quassel@moz-49828767.cust.tele2.se) (Ping timeout)
[00:55:59] <strcat> mostly useful for making unsafe code have a safe external interface
[00:56:02] <strcat> same with Send
[00:56:43] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Quit: Leaving.)
[00:56:52] <zslayton> zomg, I just remembered that I don't have to put parens around my conditionals
[00:56:59] <zslayton> Rust is wonderful
[00:57:25] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[00:57:27] <dbaupp> zslayton: for that code, I'd leave it as R btw.
[00:57:35] <dbaupp> (the counter)
[00:57:40] *** Quits: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com) (Quit: ecr)
[00:58:29] <zslayton> dbaupp: Ok, cool. That was my plan until I figured something else out. Dunno what the real answer would be -- an IntDiv trait or something, maybe
[00:58:55] <dbaupp> hm, actually maybe not...
[00:58:56] <strcat> oh wow
[00:59:00] <strcat> I made it past stage1
[00:59:02] <dbaupp> rusti: 1e8f32 + 1.0
[00:59:03] -rusti- 100000000
[00:59:05] * strcat prepares for memory corruption
[00:59:17] *** Joins: jeff (jeff@moz-D700CD97.nycmny.east.verizon.net)
[00:59:22] <dbaupp> zslayton: ^ it's easily possible to have 100 million f32's
[01:00:00] <strcat> rusti: 1e200f32
[01:00:00] -rusti- inf
[01:00:12] <dbaupp> rusti: 1.8e7f32 + 1.0
[01:00:13] -rusti- 18000000
[01:00:27] <dbaupp> and 18 million is even more concievable
[01:00:39] <strcat> oh wow it's compiling stage2
[01:00:43] <dbaupp> strcat: \o/
[01:01:00] <zslayton> dbaupp: You mean that the counter can reach 100m while using an f32, so it's not a huge deal?
[01:01:02] <strcat> if I actually managed to remove ~[] headers without hitting memory corruption anywhere I'll be impressed with myself ;p
[01:01:04] <dbaupp> strcat: I thought you said this would be hard :P
[01:01:11] <strcat> dbaupp: well I know I broke %?
[01:01:15] <strcat> but that doesn't count because I know ;p
[01:01:29] <dbaupp> zslayton: yeah, if you tried to use it on a stream of 18 million f32's, then the counter would eventually stop incrementing
[01:01:42] <strcat> dbaupp: well working on trans isn't hard anymore :)
[01:01:53] <strcat> removing ~T headers taught me how
[01:01:59] <jdm> heh
[01:02:03] <dbaupp> zslayton: since floating point means that the 1 is below the precision
[01:02:16] <strcat> dbaupp: https://github.com/thestinger/rust/commit/1023754ab2032b0a7bb7d2defc78f5cc5f7b2201
[01:03:20] <dbaupp> strcat: oh, the code in vec doesn't look too bad?
[01:03:28] <strcat> dbaupp: yeah I thought it'd be worse
[01:03:30] <zslayton> dbaupp: Hrm. 18m is a lot, but not outside the realm of possibility. I guess I should revisit it later.
[01:03:39] <dbaupp> zslayton: yeah
[01:03:40] <strcat> then I realized I *already* needed stage0/not(stage0) just to deal with removing the headers
[01:03:43] <ChrisMorgan> Anything special about the uuid in a module? I presume it's fine to just use `uuidgen` to make one.
[01:03:45] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[01:03:46] <strcat> so I don't actually need contains_managed snapshotted.
[01:03:50] <ChrisMorgan> s/module/crate/
[01:04:05] <dbaupp> ChrisMorgan: yeah that's fine, I think it's up for removal too
[01:04:18] <dbaupp> strcat: oh, cool!
[01:04:38] <dbaupp> (speaking of snapshots... does someone know how to do one, or are we avoiding it because of the leak?)
[01:04:54] <strcat> dbaupp: I thought it'd be a lot harder than it was though, the ~T one honestly took me hours of debugging - this has been maybe 15 mins of work and tons of waiting for builds ;p
[01:05:08] <strcat> too early to know it actually works though
[01:05:12] <dbaupp> strcat: you're getting practiced at header removal
[01:05:22] <strcat> dbaupp: but there aren't really any more to remove :)
[01:05:30] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[01:05:32] <dbaupp> strcat: we can call you "the guillotine"
[01:05:37] <strcat> heh
[01:05:47] <strcat> zapping managed ones will be easy since all the relevant code paths now have contains_managed in them branching for ~
[01:05:53] <strcat> one graydon's gc lands
[01:05:58] <dbaupp> strcat: psh, just make some new ones, to keep your skills honed.
[01:06:19] <strcat> finished `make` successfully
[01:06:22] <strcat> now onto tests
[01:06:29] <strcat> but I do still have to fix repr...
[01:06:32] <graydon> strcat: what variant are you testing?
[01:06:46] <strcat> graydon: removing ~str and non-managed ~[] headers now
[01:07:09] *** Quits: jeff (jeff@moz-D700CD97.nycmny.east.verizon.net) (Ping timeout)
[01:07:12] <sp3d> strcat: you're a hero <3
[01:07:22] <strcat> graydon: far easier than I expected... I should have done it with ~T ;p
[01:07:30] <strcat> I was worried vec.rs would need a ton of work
[01:07:47] <SiegeLord> strcat: Just curious, are you an intern or a concerned hacker?
[01:07:56] <strcat> SiegeLord: the latter
[01:08:12] <SiegeLord> Rust is really attracting some dedicated and talented non-Mozilla people
[01:08:13] <strcat> but I wouldn't say concerned ;p
[01:09:01] <SiegeLord> Psh, you sound concerned everytime IR is discussed... or non-canonical bools ;)
[01:09:03] <tjc> SiegeLord: Yes, it is! I've never worked at someplace before where someone might come out of nowhere to do my job for me :-)
[01:09:45] <strcat> error: test run failed!
[01:09:47] <strcat> command: x86_64-unknown-linux-gnu/test/run-pass/log-str.stage2-x86_64-unknown-linux-gnu 
[01:09:49] <strcat> dbaupp: as expected :)
[01:10:17] <strcat> everything else passed, we have pretty bad test coverage on fmt! ;p
[01:10:19] *** Joins: jeff (jeff@moz-D700CD97.nycmny.east.verizon.net)
[01:10:29] *** Quits: eholk (eholk@moz-39F1DC8F.uconnect.utah.edu) (Quit: eholk)
[01:10:33] <dbaupp> SiegeLord: non-canonical bools aren't concerning... they're just setting us up for a underhanded Rust contest :P
[01:11:23] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[01:11:35] <dbaupp> someone add Rust to https://github.com/mame/quine-relay!
[01:11:37] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[01:13:51] *** Quits: donri (dag@moz-9BB61102.tbcn.telia.com) (Client exited)
[01:15:27] <zslayton> Silly question: Do vector iterators reset after they hit the end of the vector? That is, return None at the end and then return the first item when next asked?
[01:15:32] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[01:15:32] *** ChanServ sets mode: +o dherman
[01:15:39] <Eridius> zslayton: no
[01:16:06] <Eridius> zslayton: once an Iterator returns None, you shouldn't ever call .next() again. The Iterator contract does not define what happens after a None is returned
[01:16:06] <zslayton> Eridius: Huh. Then this shouldn't have worked at all. Ha.
[01:16:14] <Eridius> some iterators will return None forever, some will behave differently
[01:16:19] <ChrisMorgan> Alas, when I try putting my HTTP server into a separate crate, it's back to failing in my stream_po.try_recv(), "option::unwrap none". Now why on earth would that be? It works fine when built as part of the main program.
[01:16:24] <zslayton> Eridius: Noted, thank you
[01:16:24] <Eridius> a VecIterator should return None forever
[01:16:41] <strcat> zslayton: VecIterator should implement Clone (it doesn't yet)
[01:16:45] <strcat> the mutable ones can't
[01:17:03] <dbaupp> rusti: let v = &[]; let mut it = v.iter(); (it.next(), it.next(), it.next())
[01:17:05] -rusti- <anon>:7:35: 7:36 error: internal compiler error: borrow-vec associated with bad sty: &ty_err
[01:17:05] -rusti- <anon>:7          let v = &[]; let mut it = v.iter(); (it.next(), it.next(), it.next())
[01:17:05] -rusti-                                             ^
[01:17:05] -rusti- application terminated with error code 101
[01:17:14] <dbaupp> rusti: let v = &[1i]; let mut it = v.iter(); (it.next(), it.next(), it.next())
[01:17:16] -rusti- (Some(&1), None, None)
[01:17:40] * dbaupp files a bug
[01:20:31] <ChrisMorgan> I presume that it's somehow losing its endpoint (a SharedChan) again. But why would that happen when it's in a different crate?
[01:20:57] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[01:21:54] <dbaupp> ChrisMorgan: does it work cross-crate with a very small example?
[01:22:28] <ChrisMorgan> Alas, bringing things down to minimal test cases is becoming steadily harder. This is, of course, to be expected!
[01:22:51] *** Joins: Nisstyre (wes@moz-FD86289.netflash.net)
[01:23:30] *** Quits: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[01:24:05] *** Quits: jgilbert (jgilbert@moz-7B0110AD.mv.mozilla.com) (Quit: Leaving)
[01:24:26] *** Joins: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com)
[01:31:45] <strcat> heh
[01:31:54] <strcat> I think ~str still works with %?
[01:32:00] <strcat> I only broke managed ~[]
[01:33:45] * ChrisMorgan is a dill. He still had the old version of his server running, and hadn't taken full care of the bind failure case. Thus, no cross-crate bug after all. :-)
[01:34:44] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[01:35:18] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:35:24] *** Joins: victorporof (victorporo@864CC037.542EA61F.70D60F75.IP)
[01:35:32] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[01:35:57] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:36:54] <jdm> ChrisMorgan: nice :D
[01:37:36] *** Quits: victorporof (victorporo@864CC037.542EA61F.70D60F75.IP) (Ping timeout)
[01:39:35] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[01:39:56] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[01:41:59] *** Quits: jeff (jeff@moz-D700CD97.nycmny.east.verizon.net) (Ping timeout)
[01:43:23] *** Joins: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP)
[01:43:23] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/m8Qe6g
[01:43:23] *** Parts: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP) ()
[01:44:50] *** Joins: jeff (jeff@moz-BF5C129D.nycmny.east.verizon.net)
[01:45:11] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[01:45:40] <strcat> Luqman: close... ;p
[01:45:51] <strcat> could be done now
[01:46:25] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[01:46:25] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/rAPyjg
[01:46:25] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[01:46:28] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[01:46:28] <ghrust> 01[13rust01] 15bors pushed 11 new commits to 06auto: 02http://git.io/fGSSAA
[01:46:28] <ghrust> 13rust/06auto 14f0dbca6 15Tim Chevalier: std: change XXX to NOTE
[01:46:28] <ghrust> 13rust/06auto 1439d98ca 15Tim Chevalier: std: Remove XXX, this doesn't seem to need fixing
[01:46:28] <ghrust> 13rust/06auto 1447ff7b3 15Tim Chevalier: std: get rid of awkward Either thing...
[01:46:29] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[01:50:54] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[01:50:56] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:54:03] *** Joins: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net)
[01:54:28] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[01:54:28] *** ChanServ sets mode: +o dherman
[01:54:45] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[01:55:03] <tikue> i want syntax like: do tree.replace_child_node NewStruct {
[01:55:06] <tikue>   foo: foo,
[01:55:06] <tikue> }
[01:55:16] <tikue> lol
[01:55:32] <tikue> *generalize do sugar*
[01:56:24] *** Quits: azakai (alon@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[01:56:51] <Luqman> strcat: \o/
[01:56:59] *** Quits: seth (seth@moz-42C5FAA8.nc.res.rr.com) (Input/output error)
[01:56:59] <Luqman> kinda forgot it was compiling since i
[01:57:05] <Luqman> m also working on other things now :P
[01:57:22] <strcat> Luqman: I think it'll at least make it past run-pass this time
[01:57:24] <strcat> 3 failures last time
[01:57:48] <strcat> 32 bytes cut off every string should help *something* ;p
[01:57:55] <strcat> every ~str
[01:58:09] <strcat> I wonder if we put headers on any other weird things
[01:58:14] <strcat> I know they're on stack closures
[01:58:19] <Luqman> that's awesome
[01:58:37] <Luqman> so what will ~str look like now?
[01:58:52] <strcat> Luqman: well it goes from VecRepr -> UnboxedVecRepr
[01:58:57] <strcat> for unique ~[] and ~str
[01:59:07] <strcat> and VecRepr is { four_word_box_header, UnboxedVecRepr }
[01:59:45] <dbaupp> strcat: almost all strings in Rust are @str
[01:59:58] <strcat> Luqman: unboxed it's |fill|alloc|data|
[02:00:05] <strcat> so 2 words + the actual data
[02:00:16] <dbaupp> *in rustc
[02:00:20] <strcat> and it will just have 16-byte alignment inherited from malloc
[02:00:45] <strcat> since malloc has to align for long double, etc.
[02:01:05] <sp3d> what does .. mean in struct initialization?
[02:01:31] <strcat> sp3d: it's for updating a few fields and copying the rest
[02:01:34] <dbaupp> sp3d: it copies the fields that aren't listed in the initialisation
[02:01:40] <sp3d> ah, thanks
[02:01:50] <sp3d> is that in the tutorial anywhere? I totally don't remember it...
[02:02:07] <strcat> doubt it is
[02:02:10] <dbaupp> rusti: struct Foo { a: int, b: int } let x = Foo {a : 1, b: 2}; Foo { a: 1000, .. x }
[02:02:13] -rusti- {a: 1000, b: 2}
[02:02:14] <strcat> I didn't know about it for a long time ;p
[02:02:28] <sp3d> answer: no
[02:02:46] *** Joins: vk (vk@858480B7.B568D26C.93B001FA.IP)
[02:02:57] *** Joins: pnathan (Adium@B9840254.2CD8A5F8.477B877D.IP)
[02:03:07] <dbaupp> there is a paragraph in the manual
[02:03:21] <sp3d> how does one contribute to things like the manual and tutorial? are they in the repo?
[02:03:25] <dbaupp> at the end of http://static.rust-lang.org/doc/rust.html#structure-expressions
[02:03:31] <dbaupp> sp3d: yeah, doc/*.md
[02:03:47] <sp3d> oh, I was looking in src/ for a doc/ :|
[02:04:05] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[02:04:35] *** Quits: vk (vk@858480B7.B568D26C.93B001FA.IP) (Ping timeout)
[02:05:27] <tikue> what does "can't find crate for `std`" mean
[02:05:54] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[02:06:14] <dbaupp> tikue: it means that the crate called 'std' can't be found ;P
[02:06:21] <dbaupp> tikue: whats causing that error?
[02:06:25] <tikue> dbaupp: oh, thanks! that fixed the problem
[02:06:42] <tikue> dbaupp: in all seriousness though, I had to cd .. and do bin/rustc and it was fine. idk why
[02:06:54] <dbaupp> haha, strange
[02:08:58] *** Quits: pnathan (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[02:10:58] <jensnockert> I think adding another layer of indirection in my SIMD patch may have finally worked out \o/
[02:11:00] <strcat> Luqman: done run-pass :)
[02:11:39] <jensnockert> This code should generate code that codifies the code I want it to be. Except that it has a few extra Load/Store/Load/Store in between.
[02:11:57] <engla> dbaupp: thanks for the quick feeback, had to repush that, forgot to mark 3 methods pub ..
[02:12:03] <Luqman> strcat: yay! so pretty much works then?
[02:12:08] <Luqman> time to push!
[02:13:03] <strcat> Luqman: yep just waiting to see if {std,extra}test make it
[02:13:24] *** Quits: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP) (Ping timeout)
[02:13:28] * Luqman crosses fingers
[02:13:55] <strcat>     str::tests::test_as_bytes_with_null
[02:13:57] <strcat> ;[
[02:14:08] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[02:14:08] *** ChanServ sets mode: +o dherman
[02:14:15] * jensnockert hugs strcat
[02:14:24] <strcat> hrm
[02:14:26] *** Joins: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP)
[02:14:38] *** Quits: geomyidae (geomyidae@DD6F7E3A.21468E9A.30200F38.IP) (Client exited)
[02:14:56] <strcat> it looks to me like that should still work.
[02:15:32] <mark_edward> rusti: fn strcat(s: &str, s2: &str) -> ~str { s + s2} strcat("strcat","strcat")
[02:15:35] -rusti- ~"strcatstrcat"
[02:15:45] <dbaupp> strcat: as_bytes_with_null is implemented on ~str and @str
[02:15:45] <Luqman> strcat: which assert is it failing on?
[02:15:54] <strcat> oh
[02:15:57] <strcat> it's failing on @str
[02:15:59] *** Joins: geomyidae (geomyidae@DD6F7E3A.21468E9A.30200F38.IP)
[02:16:03] <strcat> it transmute it to &~[u8]
[02:16:14] * dbaupp takes the blame
[02:16:15] <strcat> simple fix, can use @@[u8]
[02:16:45] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[02:17:02] <Luqman> ah, the transmute hammer
[02:17:24] * strcat likes when these fixes are obvious
[02:17:57] *** Quits: nonehaxor (nonehaxor@BA9CBAE.4C3B0355.EE6E63A5.IP) (Ping timeout)
[02:18:10] <dbaupp> engla: are you blake2-ppc?
[02:18:19] <engla> yes
[02:18:22] <dbaupp> ok, cool :)
[02:18:27] * dbaupp is huonw
[02:18:30] <strcat> I have a fairly good idea how to remove them from @T, @[T] and managed-unique now too, that should be easy.
[02:18:34] <strcat> test result: ok. 1000 passed; 0 failed; 17 ignored, 0 benchmarked
[02:18:36] <strcat> now extratest
[02:18:37] <engla> I knew
[02:18:43] <dbaupp> oh, awesome :)
[02:18:58] <engla> it's consistent when everyone has a different gh name than irc name
[02:19:09] <dbaupp> haha
[02:19:12] *** Quits: Amanieu (amanieu@CB5576F2.F4BF8C9A.9510F13D.IP) (Client exited)
[02:19:22] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[02:19:22] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1441fd895 to 1498c1654: 02http://git.io/N3iJvQ
[02:19:22] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[02:19:25] *** Joins: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP)
[02:19:25] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/Wq4izQ
[02:19:25] <ghrust> 13rust/06auto 14cf4127f 15blake2-ppc: hashmap: Remove .mutate_values() which is replaced by .mut_iter()
[02:19:25] <ghrust> 13rust/06auto 14750f32d 15blake2-ppc: hashmap: Iterators for hashset diff, sym. diff, intersec, union...
[02:19:25] <ghrust> 13rust/06auto 1447ba458 15bors: auto merge of #7815 : blake2-ppc/rust/hashmap-iterators, r=huonw...
[02:19:25] *** Quits: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com) (Client exited)
[02:19:27] *** Parts: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP) ()
[02:19:31] *** Joins: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com)
[02:19:35] <dbaupp> engla: just in time!
[02:19:46] *** Joins: Amanieu (amanieu@CB5576F2.F4BF8C9A.9510F13D.IP)
[02:19:49] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[02:19:55] *** Quits: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com) (Client exited)
[02:20:08] <engla> dizzying speed of bors nowadays
[02:20:14] <engla> might be because it's slowadays
[02:20:19] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Quit: Leaving)
[02:20:33] *** Joins: nonehaxor (nonehaxor@BA9CBAE.4C3B0355.EE6E63A5.IP)
[02:20:35] <dbaupp> yup, somehow bors has actually got to the front of the queue
[02:20:43] <strcat> dbaupp: an extra test failed >.<
[02:20:49] <strcat>     time::tests::run_tests
[02:20:50] <dbaupp> strcat: which?
[02:20:55] <dbaupp> where?
[02:21:00] <strcat> I bet C++ is still using a unique vec header
[02:21:03] <strcat> the runtime
[02:21:08] <dbaupp> oh, ew.
[02:21:34] <dbaupp> did you have to fix the runtime for ~T?
[02:21:37] <strcat> no
[02:21:46] *** Joins: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com)
[02:21:50] <strcat> dbaupp: well I had to fix it for ~[T] but I actually did it in the ~T PR
[02:22:03] <strcat> dbaupp: I had to teach rust to not call into C++ for unique vecs
[02:22:09] <strcat> was the easiest fix
[02:22:13] <strcat> anyway I know exactly where the issue is
[02:22:27] <strcat> there was 1 usage of the unique vector alloc left in C++, for a time function
[02:22:29] <dbaupp> yay easy fixes!
[02:22:32] <strcat> don't even need to grep
[02:22:50] <dbaupp> haha nice
[02:22:54] <strcat> void tm_to_rust_tm(tm* in_tm, rust_tm* out_tm, int32_t gmtoff,
[02:22:57] <strcat> has
[02:22:59] <strcat>         reserve_vec_exact(&out_tm->tm_zone, size + 1);
[02:23:01] <strcat> and that uses a header
[02:23:01] <dbaupp> (yay tests too!)
[02:23:28] <strcat> no tests and it's guaranteed to break if it uses unsafe ;p
[02:23:53] <dbaupp> yup
[02:23:56] <strcat> yep
[02:23:58] <strcat> there it is
[02:24:00] <strcat>             .realloc(*vpp, size + sizeof(rust_vec_box));
[02:24:03] <strcat> ->             .realloc(*vpp, size);
[02:24:10] <jensnockert> Haha, this seems to almost work \o/
[02:24:11] *** Quits: lmandel (lmandel@8B192B20.1F93A08E.ADB88A9.IP) (Quit: lmandel)
[02:24:18] *** Joins: eatkinson (eatkinson@moz-AD233F1B.dia.static.qwest.net)
[02:24:21] <dbaupp> jensnockert: yay! ("almost"?)
[02:24:22] *** Joins: sankha93 (Instantbir@BDA3DC61.465E20BB.27560D6E.IP)
[02:24:36] <jensnockert> dbaupp: It works inside of a function, but not main, for some reason.
[02:24:40] <jensnockert> No idea why.
[02:24:43] <strcat> dbaupp: https://github.com/mozilla/rust/pull/7816 r? I expect it to work now
[02:24:50] <jensnockert> Might be that I botched the recompiles.
[02:25:19] <dbaupp> jensnockert: main might get inlined into start and that breaks things, or something?
[02:25:41] <jensnockert> No, I don't think so.
[02:25:57] *** Joins: lmandel (lmandel@8B192B20.1F93A08E.ADB88A9.IP)
[02:26:03] <dbaupp> oh
[02:26:08] * dbaupp was entirely guessing
[02:26:28] <jensnockert> We'll see after the full recompile.
[02:26:48] <jensnockert> It may have just been my special snowflake build script forgetting to rebuild the test files.
[02:27:04] <dbaupp> rusti: "foo" + "bar"
[02:27:06] -rusti- ~"foobar"
[02:27:19] <dbaupp> strcat: ~"foo" + "bar" does 2 allocations
[02:27:25] <dbaupp> (just btw.)
[02:27:31] <strcat> I might as well zap those
[02:27:39] <pcwalton> I really wonder how much our cycle time will drop if we make debug!() only compile in for -g
[02:27:48] <pcwalton> if anyone wants to try it it'd be entertaining
[02:28:05] <dbaupp> pcwalton: we can test by making debug! a noop, right?
[02:28:07] <pcwalton> I see so much code in the disassembly which is just debug!() goop
[02:28:08] <pcwalton> yup
[02:28:14] <strcat> dbaupp: meh it might as well be done later
[02:28:18] <strcat> dbaupp: there are 100 in that file ;p
[02:28:20] <dbaupp> strcat: yeah
[02:28:27] <dbaupp> strcat: i'm r+ing anyway :)
[02:28:36] <pcwalton> really when I start working on rustc performance I want to do two things:
[02:28:46] <pcwalton> (1) debug! a noop; (2) turn off unwinding in rustc
[02:28:55] <jensnockert> (3) hug random people.
[02:28:56] <pcwalton> I bet that'll be 2x-3x 
[02:29:03] <pcwalton> maybe more
[02:29:10] <pcwalton> if someone wants to do one of those I'll r+ it instantly :)
[02:29:24] * dbaupp hugs jensnockert 
[02:29:38] * jensnockert squees.
[02:29:39] * strcat thinks dbaupp's RNG is rigged
[02:29:48] <dbaupp> pcwalton: we've actually got conditional macro definitions, so I'll do that now
[02:29:57] <dbaupp> (the debug! one.)
[02:30:24] <dbaupp> strcat: hm?
[02:30:27] <strcat> pcwalton: I think we should just plain remove a lot of the debug!, I find it distracting when I actually want to debug something
[02:30:31] *** Joins: seth (seth@moz-42C5FAA8.nc.res.rr.com)
[02:30:41] <strcat> dbaupp: because jensnockert said hug people randomly ;p, it's too late to be funny now
[02:30:51] * dbaupp is slow
[02:30:55] <strcat> pcwalton: I already removed the hashmap ones ;)
[02:31:16] <pcwalton> btw, I saw some next_power_of_twos getting inlined
[02:31:21] <pcwalton> I inline(never)'d that at one point
[02:31:46] *** Joins: stack_ (urb@moz-884BA95F.retail.telecomitalia.it)
[02:31:57] *** Quits: stack (urb@moz-27F55522.retail.telecomitalia.it) (Ping timeout)
[02:32:32] *** Quits: seth (seth@moz-42C5FAA8.nc.res.rr.com) (Ping timeout)
[02:33:22] <strcat> dbaupp: I think this should really help for ~str, at the very least
[02:33:26] * dbaupp has a feeling this won't work
[02:34:18] *** Joins: strcat1 (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[02:34:33] <strcat1> most ~str will now be in the 32-byte allocator size class
[02:34:37] <strcat1> instead of 64-byte
[02:34:48] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (NickServ (GHOST command used by strcat1))
[02:34:51] *** strcat1 is now known as strcat
[02:35:00] *** Joins: rusti_ (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[02:35:24] <strcat> vectors have bigger elements and are generally bigger so it doesn't matter as much
[02:35:31] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[02:35:37] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[02:35:41] <dbaupp> pcwalton: it's now got just plain #[inline]
[02:35:54] *** Joins: victorporof (victorporo@864CC037.542EA61F.70D60F75.IP)
[02:36:12] <strcat> #[inline] will pretty much always inline though
[02:36:16] <strcat> unless it's huge
[02:36:29] <pcwalton> next_power_of_two used to be spread out everywhere
[02:36:39] <pcwalton> btw, is push_slow still inlined?
[02:36:43] <pcwalton> still inline(never) that is
[02:36:50] <strcat> pcwalton: don't think so
[02:36:55] <dbaupp> that area of code was changd
[02:37:08] <strcat> pcwalton: but exchange allocs are small in IR now
[02:37:25] <strcat> there's just a call to malloc with a size and a branch with an abort, no header stuff
[02:37:28] <pcwalton> LLVM's inlining heuristics did a very poor job of not inlining that before and you would have push_slow, as well as next_power_of_two (!) into every push
[02:37:35] <strcat> ah
[02:38:00] <dbaupp> pcwalton: changed so that there was a inline(never) wrapper around reserve and push_slow was merged with push
[02:38:02] *** Quits: jeff (jeff@moz-BF5C129D.nycmny.east.verizon.net) (Ping timeout)
[02:38:02] *** Quits: victorporof (victorporo@864CC037.542EA61F.70D60F75.IP) (Ping timeout)
[02:38:05] <pcwalton> ah ok
[02:38:10] <dbaupp> it was possibly changed again.
[02:38:19] <strcat> dbaupp: I just removed #[inline] from reserve
[02:38:37] <strcat> don't need inline(never) if you just remove the hint from the inner one that's too big
[02:38:54] <dbaupp> strcat: does it actually not get inlined within the crate though
[02:38:56] <dbaupp> ?
[02:39:02] <strcat> dbaupp: if it's not #[inline]
[02:39:07] <strcat> I really want to figure out how to get linkonce_odr + available_externally working
[02:39:15] <strcat> then we can have inlining without forcing inlines into the crate
[02:39:48] *** Joins: jeff (jeff@moz-BF5C129D.nycmny.east.verizon.net)
[02:39:54] <strcat>     Globals with â€œavailable_externallyâ€ linkage are never emitted into the object file corresponding to the LLVM module. They exist to allow inlining and other optimizations to take place given knowledge of the definition of the global, which is known to be somewhere outside the module. Globals with available_externally linkage are allowed to be discarded at will, and are otherwise the same as
[02:39:55] <strcat> linkonce_odr. This linkage type is only allowed on definitions, not declarations.
[02:39:57] <dbaupp> strcat: we could have #[linkage(foo, bar)] fn blah() ... that gets passed to LLVM
[02:40:22] <dbaupp> (some one else was wanting dll{export,import}.)
[02:40:32] <strcat> so I think we'd just have to emit inlinable functions, and make them available externally
[02:40:38] *** Quits: jeff (jeff@moz-BF5C129D.nycmny.east.verizon.net) (Quit: jeff)
[02:40:41] <strcat> so we'd use the same symbol as what they use in their actual crate
[02:40:51] <strcat> and then if LLVM doesn't inline it, it will discard
[02:41:02] <strcat> we could use it for exporting generic instantiations too
[02:41:23] <strcat> for example libstd makes HashMap<int, int> and so on, so it might as well throw them in metadata as available_externally + export them
[02:41:34] *** Quits: xymostech (xymostech@22A34502.AFC2BCFF.2CFD4520.IP) (Ping timeout)
[02:41:42] <strcat> there's a lot of gains we can get
[02:42:24] <dbaupp> oh, ew... making debug! a noop makes the bootstrap fail because some variables are only used in debug! invocations :'(
[02:42:38] <pcwalton> ugh
[02:42:39] <pcwalton> should _ them
[02:42:40] <dbaupp> strcat: yeah
[02:42:43] *** Joins: xymostech (xymostech@22A34502.AFC2BCFF.2CFD4520.IP)
[02:43:09] <dbaupp> pcwalton: yeah, or make debug! expand to `if false { original_debug!(...) }`, or is that too horrible?
[02:43:22] <dbaupp> (it'd fix the possible problem of bitrotting debug! statements.)
[02:43:52] <pcwalton> dbaupp: I'd rather not because then we'd still codegen it
[02:43:58] <pcwalton> unless we special case "if false" in codegen
[02:44:01] <pcwalton> which maybe we should do.
[02:44:08] <strcat> dbaupp: need output "iterators" now ;p
[02:44:19] <strcat> and then we can base conversions to text/bytes on that
[02:45:04] <strcat> fn to_stream<S: OutputStream>(&self, s: &mut S) { s.size_hint(5); s.write(self.foo) }
[02:45:11] <strcat> strings/vectors/files can all implement it
[02:45:39] <strcat> fmt!("%s %s %s %s", 1, 2, 3, 4) with 1 alloc, or printf!("%s %s %s %s", 1, 2, 3, 4) with 0
[02:45:45] <strcat> well
[02:45:52] <strcat> depends on how clever the size hints are for the former
[02:45:54] <dbaupp> hm, it appears this doesn't work. :'(
[02:46:29] <dbaupp> strcat: how is that different to Writer?
[02:46:29] <strcat> I guess they could expose a size hint and then to_stream
[02:46:39] <strcat> dbaupp: no seeks and other weird stuff strings can't do
[02:46:49] <strcat> + it needs a method to optionally tell it how much you're going to write
[02:46:59] <dbaupp> strcat: (I think newrt Writer is essentially like that)
[02:46:59] <strcat> for reserve/fallocate to use
[02:47:05] <strcat> dbaupp: haven't looked yet, I will
[02:47:06] <dbaupp> although the size_hint would be nice
[02:47:19] <dbaupp> strcat: it just has write and flush, iirc
[02:47:38] <strcat> also random access ranges, so we can have generic sort/gallop/binary_search on vec, deque, mmap'ed memory, etc.
[02:47:53] <dbaupp> yup
[02:48:07] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[02:48:07] *** ChanServ sets mode: +o dherman
[02:48:09] <strcat> the double-ended ones work well already :)
[02:48:19] *** Quits: rusti_ (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[02:48:27] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[02:48:38] <dbaupp> ok, it looks like the easiest solution to this will be injecting core-macros at the same time that we inject to the prelude
[02:48:45] *** Quits: kimundi (kimundi@moz-A033AA7.dip0.t-ipconnect.de) (Ping timeout)
[02:48:45] <dbaupp> maybe...
[02:48:47] <dbaupp> :S
[02:48:51] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[02:48:59] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[02:49:04] <dbaupp> pcwalton: this is looking to be non-trivial.
[02:49:10] <strcat> dbaupp: essentially in D there's no Reader/Write
[02:49:12] <strcat> r
[02:49:19] <strcat> you just use InputRange (our Iterator) and OutputRange
[02:49:34] <strcat> I have to look into how they handle seeks
[02:49:45] <pcwalton> dbaupp: something other than the unused variable issue?
[02:50:09] <strcat> dbaupp: just make it use the variables
[02:50:14] <strcat> when it's on no-debug
[02:50:21] <strcat> ignore(x)
[02:50:21] <dbaupp> pcwalton: yeah, the core-macros injection technique doesn't ever go through cfg stripping, so just putting a #[cfg(debug)] on things doesn't work
[02:50:27] <pcwalton> oh
[02:50:28] <dbaupp> strcat: that's not the problem
[02:50:32] <strcat> dbaupp: ah
[02:50:56] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Ping timeout)
[02:51:01] <dbaupp> yeah, ok, I'll just put a "pass" that injects a core-macros module at the top of every crate.
[02:51:17] <strcat> pcwalton: I think we might have hidden wins from running a function pass too, we really don
[02:51:20] <dbaupp> (unless there's some reason not too?)
[02:51:20] <strcat> don't seem to do it*
[02:51:30] *** Joins: seth (seth@moz-42C5FAA8.nc.res.rr.com)
[02:51:44] <pcwalton> strcat: a function pass?
[02:51:45] <dbaupp> strcat: "function pass"?
[02:51:53] <strcat> pcwalton: we run a "module pass" for optimizations
[02:51:54] <pcwalton> like running function passes separately from module passes?
[02:51:57] <strcat> pcwalton: yes
[02:52:00] <strcat> clang does this
[02:52:02] <pcwalton> I suggested that earlier but you said it wouldn't help :P
[02:52:02] <strcat> Pass Arguments:  -datalayout -notti -basictti -x86tti -targetlibinfo -no-aa -tbaa -basicaa -simplifycfg -domtree -sroa -early-cse -lower-expect
[02:52:07] *** Joins: kimundi (kimundi@moz-D9C2E0F6.dip0.t-ipconnect.de)
[02:52:12] <strcat> pcwalton: well it won't help performance ;p
[02:52:19] *** Joins: mib_g1ff5u (Mibbit@moz-79923F91.rcmdva.fios.verizon.net)
[02:52:28] <strcat> that's clang at -O3, it does that before the module one
[02:52:46] <strcat> Pass Arguments:  -datalayout -notti -basictti -x86tti -targetlibinfo -no-aa -tbaa -basicaa -simplifycfg -domtree -sroa -early-cse -lower-expect
[02:52:47] <strcat> -O1
[02:53:09] <strcat> they don't do anything at -O0 though
[02:53:13] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[02:53:30] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[02:53:34] <dbaupp> strcat: what's it for then? to reduce the amount of IR that later passes deal with?
[02:53:38] <strcat> they just do the dead code elimination in clang - because it has to understand constants already, so they just fold them and don't bother emitting dead if statements and so on
[02:53:47] <strcat> dbaupp: yes, it's for early-cse afaik
[02:54:01] <strcat> + they slip an sroa in there
[02:54:23] *** kimundi is now known as zz_kimundi
[02:54:37] <pcwalton> we could avoid codegen-ing if false
[02:54:40] <pcwalton> and other things like that
[02:54:45] <pcwalton> I'm not sure how much it would help thougj
[02:54:46] <pcwalton> though
[02:55:11] <strcat> pcwalton: well if we emitted intrinsics directly instead of turning them into functions, we'd have a lot to strip based on contains_managed, size_of, etc.
[02:55:11] <pcwalton> I'm more concerned about the "too many allocas in general" and "match makes too many allocas" problems
[02:55:35] <strcat> I've added a lot of dead branches with contains_managed in inlined functions ;p
[02:55:40] <mib_g1ff5u> I'm making an academic cryptocurrency from scratch.  I'm currently looking into whether I should go with Go, Rust, or Python.  I'm currently leaning towards Go because of its emphasis on concurrency, but I haven't ruled out Rust.  Yet programming on Rust seems like I'd be running on unstable ground.  Is anyone writing programs in Rust besides Servo?
[02:55:46] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[02:56:22] <strcat> mib_g1ff5u: we don't have good networking libraries yet, that's what you'll run into
[02:56:23] <pcwalton> Rust is much less stable than Go, so use that if it has to be stable
[02:56:44] <pcwalton> however I do take issue with the idea that Go has more emphasis on concurrency than Rust
[02:58:26] <strcat> pcwalton: they also have some other backend pass that I think we're missing out on... not entirely sure
[02:58:47] <strcat> but they run loop-simplift, scalar-evolution, etc. an extra time
[02:58:50] <strcat> loop-simplify*
[02:59:45] <jensnockert> Ah, now I see.
[02:59:48] <mib_g1ff5u> I didn't say more emphasis, I'm just saying it has a focus on concurrency.  I like actors, which is what I understand tasks to be, more than channels anyway.
[03:00:05] <jensnockert> I broke using vectors as rhs, when I fixed using vectors as lhsâ€¦
[03:00:05] <pcwalton> sorry, I'm just grumpy debugging a windows issue
[03:00:12] <strcat> mib_g1ff5u: tasks and goroutines are pretty much the same thing
[03:00:50] <pcwalton> the concurrency models are very similar, the only difference really is that Rust makes you declare (by using the right types) when you're sharing memory whereas everything in shared in Go
[03:01:06] <mib_g1ff5u> strcat: Are you sure?  I thought it uses a version of CSP?  hmm.
[03:01:10] <strcat> rust accepts some extra complexity in order to avoid data races, gc, etc.
[03:01:57] <eevee> what's the current state of networking anyway?  iirc there was something done with the libuv bindings in 0.7
[03:02:11] <strcat> mib_g1ff5u: Go's concurrency isn't formally based on CSP, it's just continued from the plan9 concurrency stuff
[03:02:24] <pcwalton> eevee: TCP (and UDP I think) work in newsched
[03:02:26] <pcwalton> but only in newsched
[03:02:34] <pcwalton> newsched is missing disk I/O still which is why it isn't default
[03:02:53] <strcat> mib_g1ff5u: although, I guess it's based on CSP through that.
[03:02:54] <mib_g1ff5u> if I chose Rust, do you think I'd be unhappy with that decision for the project I have in mind, if Rust's networking is pretty immature....?
[03:03:05] <eevee> does that mean it still relies on threads, no nonblocking async
[03:03:20] <eevee> mib_g1ff5u: you could always yakshave rust's networking support  :D
[03:03:33] <dbaupp> jensnockert: so if you had 2 rustcs, one with each fix, then you'll be fine! ;D
[03:03:50] <jensnockert> dbaupp: I should consider that!
[03:04:07] <jensnockert> No, I know what the error is.
[03:04:14] <dbaupp> and the fix?
[03:04:24] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[03:04:30] <jensnockert> Not pass the wrong pointer type to LLVM :S
[03:04:50] <strcat> jensnockert: well you can get a stack trace from gdb for LLVM asserts
[03:04:53] <mib_g1ff5u> eevee: what a curious term, I've never heard that before.  Yakshaving?  Haha what.
[03:04:57] *** Quits: seth (seth@moz-42C5FAA8.nc.res.rr.com) (Input/output error)
[03:04:58] *** Joins: vk (vk@moz-D9647D2A.tmodns.net)
[03:05:13] <jensnockert> strcat: Never managed to get it working with gdb, but lldb works awesome.
[03:05:23] <jensnockert> Probably first time I said that about lldb.
[03:05:37] <strcat> jensnockert: are you on OS X?
[03:05:47] <jensnockert> Yeah, and my GDB is too old.
[03:05:49] <eevee> mib_g1ff5u: http://sethgodin.typepad.com/seths_blog/2005/03/dont_shave_that.html is a good explanation
[03:05:52] <strcat> lldb is still really terrible on linux ;p
[03:06:07] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[03:06:11] <jensnockert> strcat: To be honest, it was terrible on OS X until just a short while ago.
[03:06:12] <dbaupp> mib_g1ff5u: http://catb.org/jargon/html/Y/yak-shaving.html also
[03:06:35] <mib_g1ff5u> aha that's great!
[03:06:53] <Luqman> jensnockert: default gdb worked of for me on mac. though i've also isntalled a newer one through brew
[03:07:05] <strcat> jensnockert: if only they'd finish lld
[03:07:16] <jensnockert> Luqman: It works across __morestack ?
[03:07:28] <Luqman> oh nooo :P
[03:07:42] <Luqman> i have to hope i'm on the right side of __morestack
[03:07:50] *** Quits: Earnestly (earnest@2AB30F53.FB5005.2BCC804A.IP) (Ping timeout)
[03:07:57] <Luqman> or use the env variable that i'm forgetting right now
[03:08:00] <jensnockert> Yeah, GDB works that well for me too.
[03:08:01] <strcat> or use RUST_MIN_STACK
[03:08:14] <strcat> the stacks are 4MiB on 64-bit by default atm though
[03:08:27] <strcat> there are still silly __morestack calls everywhere
[03:08:49] <jensnockert> My backtraces seem __morestack-free.
[03:09:02] <strcat> well it won't actually call it if there's enough stack space
[03:09:06] <strcat> but there are checks
[03:09:08] *** Joins: seth (seth@moz-42C5FAA8.nc.res.rr.com)
[03:09:37] <mib_g1ff5u> well, I'm disappointed to say that I think I'll go with Go after all... I don't think I have time to fiddle with a library.  I'll check out Rust again once it reaches v1.0
[03:09:40] *** Quits: seth (seth@moz-42C5FAA8.nc.res.rr.com) (Input/output error)
[03:09:44] <strcat> ideally it would do something like emit a 4K or 8K guard at the end, and then add checks *only* on functions doing more than 4K/8K of stack allocs
[03:10:00] <strcat> and we could just catch the signal for hitting the guard
[03:10:03] <strcat> with sigaltstack
[03:10:57] <strcat> that would essentially be cost-free stack safety
[03:11:31] <strcat> rusti: 1 + 1
[03:11:35] -rusti- 2
[03:12:16] <strcat> rusti: print(std::str::from_bytes(std::run::process_output("env", []).output))
[03:12:18] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/XgLh
[03:12:29] *** Quits: noam (noam@F6B530A7.720527A7.416762B.IP) (Connection reset by peer)
[03:12:40] *** Quits: LU324 (stuff@moz-A17E9A7B.dyn.embarqhsd.net) (Ping timeout)
[03:12:41] *** Quits: mib_g1ff5u (Mibbit@moz-79923F91.rcmdva.fios.verizon.net) (Quit: http://www.mibbit.com ajax IRC Client)
[03:13:03] <strcat> dbaupp: heh that time test still failed ;[
[03:13:06] *** Joins: noam (noam@F6B530A7.720527A7.416762B.IP)
[03:13:09] *** Quits: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net) (Client exited)
[03:13:12] *** Quits: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP) (Ping timeout)
[03:13:13] <dbaupp> strcat: :(
[03:13:33] <ChrisMorgan> Ah, yak shaving. I have a sound idea in mind for a web framework, and that idea needs a language like Rust to work... so I need to implement a solid HTTP server first :-)
[03:13:39] <strcat> ugh why does it put them all in a run_tests wrapper
[03:13:47] *** Joins: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net)
[03:14:06] <jensnockert> Okay, now it almost almost almost works.
[03:14:07] <ChrisMorgan> How do I enable the new scheduler, to try out std::rt::io::net::tcp?
[03:14:18] *** Joins: yichoi (yichoi@5AB4884B.FCC4549.14D5B978.IP)
[03:14:26] *** Joins: eholk (eholk@moz-9AB4D52F.hsd1.ut.comcast.net)
[03:14:38] <jensnockert> Just the teensy bit of getting x.even = y.odd, and similar expressions to work.
[03:14:49] <strcat> dbaupp: oh I messed up
[03:14:53] <Luqman> strcat: do you at least know which assert?
[03:15:01] <strcat> I think I removed the full header
[03:15:04] <strcat> not just the box part.
[03:15:04] *** Quits: eholk (eholk@moz-9AB4D52F.hsd1.ut.comcast.net) (Quit: eholk)
[03:15:27] <strcat> yep
[03:15:45] *** Quits: jdm (jdm@F2D29657.F60B0462.67AC9B1.IP) (Quit: Lost terminal)
[03:15:45] <dbaupp> ChrisMorgan: RUST_NEWRT=1
[03:15:55] <dbaupp> jensnockert: \o/
[03:16:02] <strcat> dbaupp: should be good now.. we'll see
[03:16:11] <dbaupp> strcat: threadsafety
[03:16:17] <strcat> Luqman: yeah and I'm 99% sure I fixed the issue, I just fixed it wrong :)
[03:16:22] <dbaupp> (is the run-tests problem.)
[03:16:34] <strcat> why wouldn't time stuff be thread-safe?
[03:16:40] <strcat> are we really using non-thread-safe time fns?
[03:16:48] <strcat> they do have _r versions of them all...
[03:17:00] * strcat looks
[03:17:19] <strcat> time is already screwed up though so we can't make things much worse
[03:17:45] <strcat> dbaupp: ah because we use setenv
[03:18:30] <strcat> we do use the thread-safe gmtime_r, localtime_r, etc.
[03:18:38] <dbaupp>         // The tests race on tzset. So instead of having many independent
[03:18:38] <dbaupp>         // tests, we will just call the functions now.
[03:19:09] <strcat> dbaupp: well and they use setenv
[03:19:16] * ChrisMorgan is still reloading http://127.0.0.1:8001/ from time to time, knowing it won't change, just because it's not crashing
[03:19:53] <engla> localtime is unsafe just for the simple fact that it uses an internal static buffer and returns a pointer into it. so obviously it's not reentrant
[03:20:11] <mark_edward> dbaupp: what happens when you break in a match clause?
[03:20:19] <strcat> engla: there are a lot of screwups like that ;p
[03:20:26] <strcat> all the locale stuff and user stuff is full of _r functions now
[03:20:32] <dbaupp> mark_edward: hm, example?
[03:20:37] <dbaupp> ChrisMorgan: \o/
[03:21:07] <engla> yeah it's all down to practices from the earliest days of C
[03:21:09] <dbaupp> ChrisMorgan: oh, wait... I get "Firefox can't establish a connection to the server at 127.0.0.1:8001." so something is broken. :P
[03:21:15] <strcat> and useless functions like atoi with undefined behaviour on invalid input
[03:21:29] *** Joins: seth (seth@moz-42C5FAA8.nc.res.rr.com)
[03:21:30] <ChrisMorgan> dbaupp: that's probably because I was recompiling it. Try again now.
[03:21:34] <strcat> engla: still horrible C strings everywhere too ;p
[03:21:41] <dbaupp> ChrisMorgan: nope, still nothing
[03:21:51] <ChrisMorgan> Aw, how tragic.
[03:21:52] <mark_edward> rusti: let x = Some(1); loop { match x { None => {println(None.to_str())} Some(v) => { break; } } }
[03:21:53] -rusti- <anon>:7:60: 7:74 error: type `std::option::Option<<V11>>` does not implement any method in scope named `to_str`
[03:21:53] -rusti- <anon>:7          let x = Some(1); loop { match x { None => {println(None.to_str())} Some(v) => { break; } } }
[03:21:53] -rusti-                                                                      ^~~~~~~~~~~~~~
[03:21:53] -rusti- error: aborting due to previous error
[03:21:54] -rusti- application terminated with error code 101
[03:21:57] *** Quits: seth (seth@moz-42C5FAA8.nc.res.rr.com) (Input/output error)
[03:22:00] <dbaupp> haha
[03:22:08] <mark_edward> rusti: let x = Some(1i); loop { match x { None => {println(None.to_str())} Some(v) => { break; } } }
[03:22:08] -rusti- <anon>:7:61: 7:75 error: type `std::option::Option<<V11>>` does not implement any method in scope named `to_str`
[03:22:08] -rusti- <anon>:7          let x = Some(1i); loop { match x { None => {println(None.to_str())} Some(v) => { break; } } }
[03:22:09] -rusti-                                                                       ^~~~~~~~~~~~~~
[03:22:09] -rusti- error: aborting due to previous error
[03:22:09] <jensnockert> dbaupp: If I want to do something I can best describe as (0 .. n).map { |i| something something } and get back an ~[T}, do you have any tips?
[03:22:10] -rusti- application terminated with error code 101
[03:22:15] <dbaupp> rusti: let x = Some(1); loop { match x { None => {println(None::<int>.to_str())} Some(v) => { break; } } }
[03:22:15] -rusti- <anon>:7:60: 7:81 error: type `std::option::Option<int>` does not implement any method in scope named `to_str`
[03:22:16] -rusti- <anon>:7          let x = Some(1); loop { match x { None => {println(None::<int>.to_str())} Some(v) => { break; } } }
[03:22:17] -rusti-                                                                      ^~~~~~~~~~~~~~~~~~~~~
[03:22:17] *** concrete.mozilla.org sets mode: +M 
[03:22:20] -rusti- error: aborting due to previous error
[03:22:22] -rusti- application terminated with error code 101
[03:22:34] <ChrisMorgan> Wow, I am surprised! I flipped the switch in my code to use std::rt::io::net::tcp rather than my adapter to extra::net::tcp and ran it with RUST_NEWRT=1... and it WORKED! First time!
[03:23:00] *** Quits: RMF (RMF@moz-F40FCF19.dsl.telepac.pt) (Quit: Textual IRC Client: www.textualapp.com)
[03:24:15] *** Quits: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Ping timeout)
[03:26:48] *** Joins: RMF (RMF@moz-F40FCF19.dsl.telepac.pt)
[03:27:20] *** concrete.mozilla.org sets mode: -M 
[03:27:20] <mark_edward> dbaupp: any ideas?
[03:28:27] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[03:28:29] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[03:28:34] <dbaupp> rusti: let x = Some(1); loop { match x { None => {} Some(v) => { break; } } }
[03:28:35] -rusti- <anon>:7:59: 7:60 warning: unused variable: `v` [-W unused-variable (default)]
[03:28:36] -rusti- <anon>:7          let x = Some(1); loop { match x { None => {} Some(v) => { break; } } }
[03:28:36] -rusti-                                                                     ^
[03:28:36] -rusti- ()
[03:28:52] *** Joins: MaikKlein1 (maik@moz-5867653C.dip0.t-ipconnect.de)
[03:28:53] <dbaupp> mark_edward: the problem there is the println(None.to_str()), not the break?
[03:29:03] <dbaupp> jensnockert: vec::from_fn
[03:29:20] <dbaupp> jensnockert: (uint, &fn(uint) -> T) -> ~[T]
[03:29:33] *** Quits: eatkinson (eatkinson@moz-AD233F1B.dia.static.qwest.net) (Quit: eatkinson)
[03:29:39] <jensnockert> Ohm nice.
[03:29:40] <mark_edward> seems to work fine in a compiled .rs file
[03:30:24] <dbaupp> mark_edward: exactly that code?
[03:30:40] <mark_edward> dbaupp: oh you're right, it's the None
[03:31:05] <mark_edward> rusti: None<int>
[03:31:06] -rusti- <anon>:8:4: 8:5 error: unexpected token: `}`
[03:31:06] -rusti- <anon>:8     };
[03:31:07] -rusti-              ^
[03:31:07] -rusti- application terminated with error code 101
[03:31:20] <dbaupp> rusti: None::<int>
[03:31:22] -rusti- None
[03:31:26] <mark_edward> ah i see
[03:31:47] <graydon> aww yeah
[03:31:53] <graydon> metrics saved to: tmp/check-stage2-T-x86_64-unknown-linux-gnu-H-x86_64-unknown-linux-gnu-extra-metrics.json
[03:32:20] <dbaupp> graydon: \o/
[03:32:22] *** Joins: seth (seth@moz-42C5FAA8.nc.res.rr.com)
[03:32:40] <dbaupp> graydon: (also, I'm happy to be added to the triage emails, if you need more people.)
[03:32:56] <graydon> dbaupp: ok. might do. how many you want?
[03:33:20] <dbaupp> graydon: however many is fine... just what's normal, I guess.
[03:33:36] <jensnockert> Haha, I win!
[03:33:44] * dbaupp hugs jensnockert
[03:33:49] <dbaupp> it all works?
[03:33:54] <jensnockert> I think so.
[03:34:04] <jensnockert> Wellâ€¦ it doesn't do proper error checking, I think.
[03:34:23] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[03:34:24] <jensnockert> But generally, it should work.
[03:35:01] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[03:35:01] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[03:36:20] <jensnockert> I have of course managed to get out-of-bounds indices into my tests more than a few times etc.
[03:36:29] *** Joins: victorporof (victorporo@864CC037.542EA61F.70D60F75.IP)
[03:36:50] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[03:38:33] *** Quits: victorporof (victorporo@864CC037.542EA61F.70D60F75.IP) (Ping timeout)
[03:38:57] *** Quits: Sorella (queen@78575561.924F2739.95C8B7C6.IP) (Quit: (quit))
[03:39:02] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[03:39:09] <acrichto> pcwalton: I edited trans to omit all debug! statements, and compile time for rustc went from 3:37 to 2:57, not a bad improvement...
[03:39:37] <pcwalton> acrichto: you removed the debug statements from trans or you made trans not trans debug statements? :)
[03:39:49] <acrichto> pcwalton: the second
[03:39:51] *** Quits: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com) (Ping timeout)
[03:39:53] <pcwalton> ah
[03:40:13] <dbaupp> pcwalton, acrichto: conditional debug works!
[03:40:13] *** Joins: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com)
[03:40:17] <acrichto> I'll try to put it behind a flag and maybe we can do it during optimized builds
[03:40:34] *** Quits: MaikKlein1 (maik@moz-5867653C.dip0.t-ipconnect.de) (Ping timeout)
[03:40:46] <pcwalton> so that's a ~20% improvement, nice
[03:40:49] <dbaupp> passing --cfg debug or not makes debug! expand to log(fmt!(..)) or {} appropriately
[03:41:00] * dbaupp will submit a pr
[03:41:29] <dbaupp> (once I remove all the unused variable warnings.)
[03:41:30] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:41:35] <acrichto> dbaupp: wait no we still want typechecking on debug! statements
[03:41:45] <pcwalton> I like the "if false" idea
[03:41:49] <pcwalton> and then making trans stop trans-ing "if false"
[03:41:50] <dbaupp> acrichto: ah, ok, if false it is then
[03:42:34] <acrichto> dbaupp: https://github.com/alexcrichton/rust/commit/c11c865b196e6b76d2decd119140d9619b781de9
[03:42:48] <jensnockert> Now I need to write something fancy to the mailing list \o/
[03:43:37] <dbaupp> acrichto: cool, shorter than my fix :)
[03:43:50] <dbaupp> acrichto: except mine allows all the core-macros to have conditional definitions
[03:44:16] <graydon> \o/
[03:44:17] <acrichto> dbaupp: oh cool! although it is super convenient to be able to run rustc normally and get logging info without having to recompile
[03:44:44] <dbaupp> acrichto: yeah, it only touches debug!, so info! warn! etc still work.
[03:44:45] <acrichto> dbaupp: although if it's just as easy to toggle all of them, then it's probably not that bad either
[03:45:34] <graydon> dbaupp: added to the triage set. you'll get 10/wk starting next week
[03:45:42] *** Quits: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com) (Ping timeout)
[03:45:43] <dbaupp> graydon: awesome!
[03:45:44] <dbaupp> thanks
[03:46:14] *** Joins: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com)
[03:46:25] <dbaupp> now... how to I make ./configure --enable-debug pass --cfg debug to rustc?
[03:46:46] <graydon> if I just deposit a bunch of .json files on static.rust-lang.org after each build for tracking metrics, is that sufficient?
[03:46:52] <graydon> (I mean, if you want to graph them)
[03:46:54] <ChrisMorgan> dbaupp: it did when I was trying to make it -Z debug-info
[03:47:25] <ChrisMorgan> dbaupp: see Makefile.in, CFG_ENABLE_DEBUG
[03:47:29] <dbaupp> graydon: yeah, will they be keyed by hash somehow?
[03:47:51] <graydon> dbaupp: sure. maybe date-hash or something
[03:48:09] <dbaupp> graydon: oh... plain hash is nicer :)
[03:48:19] <graydon> really?
[03:48:20] <graydon> ok
[03:48:20] <ChrisMorgan> My code is currently only handling a single request at a time, but across 10,000 non-concurrent requests, it's handling over 1,300 very simple requests per second. Not too bad for a first attempt on an untuned surface. (Apache httpd is doing around 2,900 on the same load, though it'll be doing somewhat more, mine being a purely static response.)
[03:48:35] <graydon> ChrisMorgan: which IO subsystem?
[03:48:41] <ChrisMorgan> New
[03:48:44] <strcat> dbaupp: ugh, failed again.
[03:48:44] <graydon> nice
[03:48:56] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[03:48:59] *** Joins: mindginative (mindginati@moz-9C555AF3.spmconsultants.co.nz)
[03:48:59] *** Quits: mindginative (mindginati@moz-9C555AF3.spmconsultants.co.nz) (Quit: mindginative)
[03:49:02] <dbaupp> graydon: yeah, it means it's just scrolling through the git history, rather than trying to work out the date
[03:49:02] <jensnockert> And now arithmetics works on SIMD vectors too \o/
[03:49:04] <ChrisMorgan> Haven't benchmarked the old through my adapter just yet. Lunch time.
[03:49:16] <dbaupp> graydon: although, thinking about it... it's probably not that bad.
[03:49:24] <dbaupp> so whatever is nicest for you.
[03:49:31] <dbaupp> jensnockert: \o/
[03:49:40] <graydon> dbaupp: just thought it'd be nicer for sorting
[03:49:42] <strcat> hm, where does it put extratest
[03:49:43] <dbaupp> ChrisMorgan: oh, thanks
[03:49:44] <ChrisMorgan> Any way I can change code based on an environment variable or something passed to rustc?
[03:49:51] <graydon> for people who don't want to bother running git on each change :)
[03:50:02] <strcat> graydon: 'git describe;
[03:50:05] <graydon> `git describe` also produces nice enough numbers
[03:50:06] <graydon> yeah
[03:50:34] <strcat> it's ever-increasing as long as we do proper versions and you use version comparison on it
[03:51:07] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:51:07] <dbaupp> graydon: yeah, that's nicer (what would be even nicer is essentially dumping a trimmed output of git show to a txt file in a directory by hash so that all the info necessary is there)
[03:51:45] <strcat> git describe also has the nice property of being accepted as an id by git commands
[03:51:54] <dbaupp> graydon: e.g. http://ix.io/6Gb
[03:52:23] <dbaupp> graydon: so that one can check for bors commits & which pull request without having to hit git at all.
[03:52:43] <dbaupp> (although that is a bit of a hack.)
[03:53:35] <graydon> well, I'll wire it up .. tomorrow or such. if time permits. today was all paperwork and nonsense. I'm still at the office. eek.
[03:53:41] <graydon> looks like the harness works though
[03:53:43] <graydon> yay
[03:54:27] <dbaupp> yay, more data!
[03:54:31] <strcat> dbaupp: heh it was still being cast the wrong thing
[03:54:41] <brendanc> graydon: why not upload the json as a log file directly into buildbot?
[03:54:43] *** Quits: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com) (Client exited)
[03:55:01] <graydon> brendanc: I will. I just think I'll also move it from there to s3, for safer keeping
[03:55:02] <dbaupp> graydon: (also, different bots are slower/faster, so recording which bot ran it would be convienent, as a wishlist item)
[03:55:08] <graydon> dbaupp: of course
[03:55:11] <dbaupp> cool
[03:55:18] <brendanc> (I wired up a similar flot perf thing for our work buildbot that crawls perf logs on builds)
[03:55:49] * dbaupp should convert his old buildbot graphs to use d3 now that he knows how to use it
[03:56:29] <strcat> d3?
[03:56:55] <graydon> running 1 test
[03:56:56] <graydon> test [codegen] codegen/hello.rs ... metric: clang-codegen-ratio: 1.368421 (+/- 0)
[03:56:57] <graydon> woo!
[03:57:06] <brendanc> nice
[03:57:17] <dbaupp> strcat: http://d3js.org/
[03:57:25] <pcwalton> graydon: is it a C++ translation of the rust?
[03:57:30] <dbaupp> strcat: what the mem graphs use
[03:57:39] <graydon> pcwalton: manual "should do the same thing" test, yeah
[03:57:44] <pcwalton> cool
[03:57:53] <graydon> pcwalton: write one in rust, one in C++. tells you the ratio of .ll extracts.
[03:57:53] <dbaupp> strcat: I'll make them zoomable etc.
[03:57:57] *** Joins: igl (igl@moz-EC5E6BFB.adsl.alicedsl.de)
[03:58:00] <strcat> dbaupp: neat
[03:58:04] *** Quits: igl1 (igl@moz-48D03918.adsl.alicedsl.de) (Ping timeout)
[03:58:18] * strcat thinks it is finally fixed
[03:58:24] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[03:58:25] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Wq4izQ
[03:58:25] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[03:58:29] <strcat> there was a typedef of rust_str to rust_vec_box too
[03:58:45] <strcat> there's a single user of that silly C++ reserve_vec_exact + unique vecs and rust_str
[03:58:49] <strcat> that time function that fails ;p
[03:58:56] <strcat> could just port it to rust
[03:59:15] <dbaupp> strcat: do I need to re-review?
[03:59:22] <strcat> dbaupp: it's small, I just did r=
[03:59:27] <dbaupp> ok, cool
[03:59:34] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[03:59:43] <strcat> -typedef rust_vec_box rust_str;
[03:59:43] *** Quits: igl (igl@moz-EC5E6BFB.adsl.alicedsl.de) (Ping timeout)
[03:59:44] *** Quits: zslayton (Mibbit@moz-14AA87A9.nyc.res.rr.com) (Quit: http://www.mibbit.com ajax IRC Client)
[03:59:45] <strcat> +typedef rust_vec rust_str;
[03:59:53] <strcat> + fixing some ->body.fill to ->fill
[04:00:30] <strcat> it was clobbering the actual data with the size/capacity
[04:01:14] *** Joins: igl (igl@moz-2E34ADEF.adsl.alicedsl.de)
[04:01:22] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[04:01:22] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Rt1yqg
[04:01:22] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[04:01:24] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[04:01:24] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/4In1IA
[04:01:24] <ghrust> 13rust/06auto 14e118555 15Daniel Micay: remove headers from unique vectors
[04:01:24] <ghrust> 13rust/06auto 14274e7a4 15bors: auto merge of #7816 : thestinger/rust/header, r=huonw...
[04:01:24] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[04:01:57] <dbaupp> strcat: ah, cool.
[04:02:12] <dbaupp> ... hm, how do I test whether debug! prints or not?
[04:02:19] *** Quits: bytewise (bytewise@moz-649C630D.unitymediagroup.de) (Quit: Leaving)
[04:02:44] <acrichto> dbaupp: RUST_LOG=foo rust run foo.rs
[04:02:55] <dbaupp> acrichto: I mean, a src/test test
[04:03:23] <dbaupp> I know it works... I just want to make sure it keeps working.
[04:03:28] <acrichto> dbaupp: debug!("%?", { fail!() })
[04:03:35] *** Joins: igl1 (igl@moz-391B774E.adsl.alicedsl.de)
[04:03:35] <acrichto> dbaupp: debug!("%?", (|| { fail!() })())
[04:03:43] <acrichto> or something like that
[04:03:50] <dbaupp> right, yup.
[04:03:59] *** Quits: igl (igl@moz-2E34ADEF.adsl.alicedsl.de) (Ping timeout)
[04:04:05] <acrichto> doesn't actually guarantee printing, but at least it's kinda close
[04:04:23] <pcwalton> ok, I've repro'd the OOM problem on windows on mac and I can get stack traces
[04:04:30] <pcwalton> can't believe this has taken me the whole weekend :(
[04:04:45] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[04:06:05] <dbaupp> can I set the logging level for a test?
[04:06:33] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[04:07:50] *** Quits: igl1 (igl@moz-391B774E.adsl.alicedsl.de) (Ping timeout)
[04:07:50] <strcat> dbaupp: and Rc only has a 1 word header ;p
[04:07:52] *** Joins: pnathan (Adium@B9840254.2CD8A5F8.477B877D.IP)
[04:07:56] <strcat> RcMut uses 2 but could use 1
[04:07:57] *** Quits: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com) (Ping timeout)
[04:08:05] *** Joins: igl (igl@moz-8B01064C.adsl.alicedsl.de)
[04:08:07] * brendanc hopes windows isn't ooming from large stacks
[04:08:10] <strcat> need to jam the freeze state into the high bits of the count
[04:08:16] <strcat> brendanc: rustc doesn't really use tasks, no worries
[04:08:23] <brendanc> phew
[04:08:23] <strcat> although maybe you broke it in tests ;p
[04:08:47] <brendanc> there is apparently a way to overcommit on windows too
[04:08:53] <strcat> brendanc: it was a 1.6GiB vector alloc or something along those lines anyway
[04:08:57] <strcat> with @[]
[04:08:59] <brendanc> ah
[04:09:23] <dbaupp> strcat: just have the count as an int, and toggle +/- for borrowed/unborrowed
[04:09:32] <strcat> dbaupp: well it has 3 borrow states
[04:09:39] <strcat> unborrowed, borrow, mut borrow
[04:09:45] <strcat> 2 bits can be stolen though.
[04:09:47] <dbaupp> strcat: ah, um, complex numbers... ?: P
[04:09:51] <dbaupp> *:P
[04:10:02] <strcat> int can address all the memory, because intptr_t can
[04:10:27] <strcat> and Rc is 2 words so you're nowhere close to being able to have as many as bytes of memory ;p
[04:10:40] <ChrisMorgan> Any way I can change code based on an environment variable or something passed to rustc?
[04:10:43] <strcat> so it can easily steal 2 bits 
[04:10:50] <strcat> ChrisMorgan: there's something like env!
[04:10:51] *** Quits: vk (vk@moz-D9647D2A.tmodns.net) (Ping timeout)
[04:10:57] <strcat> rusti: env!("LOGNAME")
[04:11:00] -rusti- "rust"
[04:11:08] <strcat> yep!
[04:11:23] <ChrisMorgan> strcat: I need to toggle between a couple of `use` statements
[04:11:36] <strcat> ChrisMorgan: ah you can use cfg for that, and pass --attr
[04:11:39] <strcat> I think.
[04:11:48] <strcat> #[cfg(foo)] and pass --attr foo
[04:11:55] <strcat> or #[cfg(not(foo))]
[04:12:03] <strcat> #[cfg(foo, not(bar), baz)]
[04:12:41] <strcat> ChrisMorgan: s/--attr/--cfg/
[04:13:00] <ChrisMorgan> Ah yes. That fits in well, thanks.
[04:14:05] *** Quits: pnathan (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[04:14:05] <graydon> ok, home for real
[04:14:12] *** Quits: graydon (Adium@A5087023.2354C43D.D8E68FF6.IP) (Quit: Leaving.)
[04:15:13] <dbaupp> ChrisMorgan: in theory you can do things like `--cfg foo="bar"` and test `#[cfg(foo="bar")]`, I think
[04:16:07] *** Joins: eatkinson (eatkinson@moz-AD233F1B.dia.static.qwest.net)
[04:16:38] <ChrisMorgan> Well, I think having this server only using 3MB of RAM is fairly good.
[04:17:01] <ChrisMorgan> ... but I dare say I could get it even lower than that.
[04:18:11] *** Joins: fread2282 (Mibbit@F7A156AC.AD1795A.A6C6D82E.IP)
[04:18:30] <dbaupp> ChrisMorgan: with that speed test... where you compiling with -O?
[04:18:35] <dbaupp> *were
[04:18:36] <ChrisMorgan> No
[04:18:41] *** Quits: sankha93 (Instantbir@BDA3DC61.465E20BB.27560D6E.IP) (Ping timeout)
[04:18:43] <ChrisMorgan> Hadn't even thought about that...
[04:19:06] <fread2282> how do I get the equivalent of casting NULL to something for extern C functions?
[04:19:13] <dbaupp> ChrisMorgan: I dare you to do it :P
[04:19:16] <dbaupp> fread2282: transmute
[04:19:28] <dbaupp> fread2282: wait, now, you can just cast raw pointers with as
[04:19:30] <dbaupp> *no
[04:19:30] <Eridius> fread2282: you want a *T that happens to be null?
[04:19:34] <Eridius> fread2282: std::ptr::null()
[04:20:00] <dbaupp> rusti: let x: *u8 = std::ptr::null(); let y: *uint = x as *uint; (x, y)
[04:20:01] -rusti- ((0x0 as *()), (0x0 as *()))
[04:20:51] <ChrisMorgan> Well, still without -O, extra::net::tcp uses a tad more memory than std::rt::io::net, but gets throughput of just under 200 requests per second (about 1/8). Doesn't surprise me it performs abysmally, with the way I coded that adapter, with read and write being intertask comm... and read being one byte at a time...
[04:21:39] *** Quits: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net) (Client exited)
[04:22:12] <strcat> dbaupp: test result: ok. 493 passed; 0 failed; 38 ignored, 0 benchmarked
[04:22:14] <strcat> it'll be fine
[04:22:16] <strcat> :]
[04:22:22] <strcat> assuming some benchmark doesn't do anything horrible
[04:22:27] * strcat would not be surprised
[04:23:18] <jensnockert> It is 6AM and I need a native English speaker to check if I make sense before I send something to the mailing list *offers hugs*
[04:23:23] *** Quits: seth (seth@moz-42C5FAA8.nc.res.rr.com) (Input/output error)
[04:23:40] <jensnockert> https://gist.github.com/jensnockert/6005746
[04:23:46] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Connection reset by peer)
[04:26:00] <fread2282> jensnockert: seems fine to me, but I don't know about the technical part of it that much
[04:26:01] <doy> looks fine to me
[04:26:09] <jensnockert> <3
[04:26:11] <sp3d> maybe "Rust Devs" instead of "Dev"?
[04:26:23] <sp3d> you have some comma splices but native speakers use those too :P
[04:26:37] <sp3d> you might have forgotten to add a word at the end of the third paragraph?
[04:26:44] <sp3d> "LLVM (something)."
[04:27:11] <jensnockert> sp3d: Oh, yes, Github squashed that.
[04:27:15] <sp3d> looks fine overall though
[04:27:23] * jensnockert hugs sp3d, doy and fread2282.
[04:28:05] <dbaupp> jensnockert: (don't worry about your english, it's native-speaker level. :) )
[04:28:10] <sp3d> ^
[04:28:16] <jensnockert> dbaupp: Depends on what time it is.
[04:28:16] <ChrisMorgan> dbaupp: -O boosts a mean of ~1,300 to 1380 on first run and 1550 on second run (10,000 requests, again). Call it 10-20%.
[04:28:25] <jensnockert> dbaupp: Not at 6AM.
[04:28:28] <steven_is_false> jensnockert: I understood it.
[04:28:41] <jensnockert> My Swedish isn't native speaker level at this time of day.
[04:28:50] <dbaupp> hahaha
[04:29:04] <ChrisMorgan> dbaupp: and still holding at 3.0 MB of RAM :-)
[04:29:10] <dbaupp> ChrisMorgan: awesome!
[04:29:47] <strcat> dbaupp: I wonder what the next low-hanging fruit to tackle is :)
[04:30:03] <dbaupp> strcat: not trans-ing `if false`
[04:30:14] <dbaupp> (although acrichto may be working on that.)
[04:30:19] <strcat> dbaupp: maybe, but we need to get intrinsics expanding directly before that's great
[04:30:32] <steven_is_false> dbaupp: So like the Java guarantee for final booleans?
[04:30:39] <acrichto> dbaupp: I am?
[04:30:51] <steven_is_false> dbaupp: That'd actually be nice to prevent bit rot.
[04:30:53] <dbaupp> acrichto: "may be"... I didn't know :)
[04:31:02] <strcat> steven_is_false: it's already guaranteed
[04:31:06] <strcat> it will just speed up compiles
[04:31:08] <dbaupp> strcat: mainly for debug!, which will soon expand to if false { ... } by default
[04:31:09] <strcat> because LLVM won't do as much
[04:31:25] <acrichto> dbaupp: you sounded like you had made better progress than I had
[04:31:30] <dbaupp> strcat: so even just for direct ast-literal false's it makes rustc compile faster
[04:31:31] <strcat> and will speed up no-opt, but to me no-opt is just a way to gauge the workload we're giving LLVM
[04:31:33] <steven_is_false> strcat: Okay, I get it. It's more just moving stuff earlier back in the pipeline.
[04:31:42] <strcat> steven_is_false: yeah
[04:32:05] <dbaupp> acrichto: yeah, I've added a whole new compiler pass
[04:32:06] <strcat> steven_is_false: rather than generating a bunch of code + having LLVM inline it and optimize it away
[04:32:10] <steven_is_false> Given that this stuff is being moved back up earlier in the pipeline will that allow the AST to be simplified later on?
[04:32:35] <strcat> dbaupp: windows passed ;p
[04:32:40] * strcat breathes a sigh of relief
[04:32:42] <strcat> should be all good now
[04:32:53] <dbaupp> acrichto: well, "pass", it just goes to the crate's top-level module and inserts a secret module there
[04:32:57] <strcat> unless there's an evil mac code path
[04:33:01] <Luqman> strcat: \o/
[04:33:12] <steven_is_false> I should really get WINE setup so I can try testing Windows code under it.
[04:33:38] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[04:33:39] *** ChanServ sets mode: +o dherman
[04:34:14] *** Joins: strcat1 (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[04:34:32] <sp3d> is there an example of a lifetime'd loop expression somewhere I could see?
[04:34:44] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[04:34:52] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[04:35:03] *** strcat1 is now known as strcat
[04:35:15] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[04:35:17] <dbaupp> rusti: 'lifetime: loop { loop { println("sp3d: yes"); break 'lifetime; } }
[04:35:18] -rusti- sp3d: yes
[04:35:18] -rusti- ()
[04:35:25] <sp3d> heh
[04:35:27] <sp3d> thanks
[04:35:37] <dbaupp> it works on while too
[04:35:46] <dbaupp> but not for until the new for-loop comes into effect
[04:35:54] <sp3d> trying to improve the gtksourceview highlighter some, and I'm not sure when to trust the manual and when not to ;)
[04:36:05] <dbaupp> never and always :P
[04:36:18] <sp3d> haha
[04:36:51] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[04:36:54] *** Joins: victorporof (victorporo@864CC037.542EA61F.70D60F75.IP)
[04:39:02] *** Quits: victorporof (victorporo@864CC037.542EA61F.70D60F75.IP) (Ping timeout)
[04:41:03] *** Joins: vodik_ (simon@moz-CBE4BB13.cable.teksavvy.com)
[04:43:07] *** vodik_ is now known as vodik
[04:44:20] <steven_is_false> Okay, so I downloaded WINE from my package manager. How would I compile Rust for Windows using WINE?
[04:44:54] <strcat> steven_is_false: you could try just using the windows installer with wine if you wanted it to painless
[04:44:59] <strcat> you'll need mingw in wine though anyway
[04:45:29] <steven_is_false> Oh, that'll be a bit more complicated then.
[04:46:57] <steven_is_false> I'll try the installer
[04:51:03] <jensnockert> This makes me interested, why WINE?
[04:51:37] <strcat> we could have a buildbot running the full make check in wine ;p
[04:51:49] <strcat> because it's not so slow at spawning processes, etc.
[04:51:50] <steven_is_false> jensnockert: Because it's evil, and bad, and strcat ninja'd me.
[04:52:16] <jensnockert> Let us all blame strcat.
[04:52:23] <jensnockert> Blame with hugs!
[04:52:26] * jensnockert hugs strcat.
[04:52:30] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[04:52:54] <strcat> ;p
[04:53:41] <brendanc> windows buildbots are not the bottleneck?
[04:53:51] <brendanc> oh, full make check
[04:55:28] <ChrisMorgan> Warning about Wine: Windows has extremely slow process spawning, Wine has utterly appalling process spawning speed. As in, 1-2 *seconds* is the speed I tended to get a year or two ago.
[04:55:37] *** Quits: lmandel (lmandel@8B192B20.1F93A08E.ADB88A9.IP) (Quit: lmandel)
[04:55:49] <ChrisMorgan> Sometimes even slower than that. Yeah, _really_.
[04:55:57] <jensnockert> Ouch.
[04:56:23] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[04:56:23] *** ChanServ sets mode: +o dherman
[04:56:59] <ChrisMorgan> I had something I was doing which spawned lots of processes and on Windows it took half a minuteâ€”under Wine it took something like an hour and a half, as I recall it.
[04:57:13] <steven_is_false> ChrisMorgan: That's really strange.
[04:57:38] <ChrisMorgan> It actually became faster to reduce my memory usage and spin up a fairly slow Windows VM than to run it under Wine...
[04:57:54] <ChrisMorgan> Yeah, it is. Hopefully things have improved since then, but I wouldn't be particularly hopeful.
[04:58:30] *** Quits: fread2282 (Mibbit@F7A156AC.AD1795A.A6C6D82E.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[04:58:54] <strcat> ChrisMorgan: it's slow at spawning the first process
[04:58:56] *** zz_kimundi is now known as kimundi
[04:58:59] <strcat> because it has to start up wine
[04:59:07] <strcat> but as long as you keep at least one running, it's faster than windows
[04:59:31] <strcat> it has to start up the silly services for stuff to talk to over IPC
[05:00:14] <ChrisMorgan> strcat: my case had a master process running the whole time, spawning all the others. Perhaps there was some element of misconfiguration somewhere, but it really redefined "slow" on such process-spawning-heavy workloads.
[05:00:35] <strcat> it definitely depends on what they're doing
[05:00:44] <strcat> some wine code paths run as fast as windows, some faster, some much much slower
[05:00:49] <Jesse> hehe https://twitter.com/sankha93/statuses/356795103236468737
[05:01:37] *** Quits: igl (igl@moz-8B01064C.adsl.alicedsl.de) (Ping timeout)
[05:01:44] <ChrisMorgan> dbaupp: a trivial equivalent in Go using net/http gets a mean of 3100 (double my rate), and ends up using only 2.0 MB of RAM (mine sits at 3.0 MB). It looks like it's got a minuscule memory leak, tooâ€”"minuscule" meaning about one byte for every hundred requests.
[05:01:44] <ChrisMorgan> Then I did `ab -n 10000000 -c 100` and it hit 5100 requests per second (Core 2 Duo, two cores) but memory usage skyrocketed up to 14 MB by the end of it, and stayed there afterwards. Tut, tut.
[05:01:57] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[05:02:05] <dbaupp> ChrisMorgan: ah
[05:02:33] <dbaupp> ChrisMorgan: I guess newrt is calling in to C, rather than doing it all in rust/with syscalls directly
[05:02:40] *** Quits: sp3d (a@moz-49806493.dhcp.stls.mo.charter.com) (Ping timeout)
[05:02:42] <ChrisMorgan> I *am* glad to see that the Rust one stayed absolutely solid on its memory usageâ€”there was no increase _at all_ after it had started serving.
[05:02:47] <strcat> ChrisMorgan: well their gc isn't precise so it does leak, rust will too with @ when the gc lands and before it bcomes precise ;p
[05:02:51] <strcat> becomes*
[05:03:02] <dbaupp> strcat: but our @ won't be necessary ;P
[05:03:05] <strcat> right
[05:03:55] *** Joins: igl (igl@moz-CB70EB10.adsl.alicedsl.de)
[05:04:45] <ChrisMorgan> dbaupp: then too, the request reading system I'm using will be slowing my version down. Requests are read one byte at a time, at present: `let mut buf = ~[0]; stream.read(buf);`
[05:04:57] <ChrisMorgan> Feel free to shudder. It was easier that way.
[05:05:05] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[05:05:08] * dbaupp shudders
[05:05:45] <dbaupp> ChrisMorgan: yeah, I guess that'd be worse part.
[05:06:21] <steven_is_false> Ugh, I'm having trouble installing MingW under WINE.
[05:06:53] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[05:07:13] <ChrisMorgan> extra::net::tcp::socket_buf has a read_byte method. The new TcpStream only has read(&mut [u8]).
[05:07:38] * ChrisMorgan hasn't profiled his code; doesn't know how to at present, for that matter
[05:08:55] <strcat> ChrisMorgan: which platform?
[05:09:04] <ChrisMorgan> Ubuntu 13.04, 64-bit.
[05:09:20] <strcat> ChrisMorgan: install perf, and do 'perf record ./foo' and then 'perf report'
[05:09:53] <dbaupp> steven_is_false: you're putting a unix in your unix so you can unix while you unix?
[05:09:57] <strcat> it has a bunch of other tools though
[05:10:05] * dbaupp ignores the bit where mingw isn't really a unix
[05:10:14] <dbaupp> *isn't at all a unix
[05:10:40] <steven_is_false> dbaupp: It's for Valgrinding Rust under the Windows config.
[05:11:05] <ChrisMorgan> strcat: getting linux-tools-common... thanks
[05:11:22] <dbaupp> ChrisMorgan: you could make `buf` larger and read `n` chars at a time, right?
[05:11:38] <ChrisMorgan> dbaupp: sure, but then you've got to mess with buffering.
[05:12:00] <ChrisMorgan> Single byte at a time was significantly easier to start with.
[05:12:12] <dbaupp> ChrisMorgan: e.g. `let mut buf = [0, .. 1_000_000]; loop { stream.read(buf) { for buf.iter().advance |b| { <your single byte code here> } }`
[05:12:32] * dbaupp thinks that's a very good way to not use a ton of memory
[05:12:33] <dbaupp> :P
[05:12:42] <strcat> when you have really big arrays you should ideally make them 64-byte aligned too, and we lack a way to do that
[05:12:58] <strcat> 64-byte aligned -> memcpy/memcmp are 2x as fast
[05:13:10] <jensnockert> Why is that?
[05:13:17] <jensnockert> Wouldn't 16-byte be enough?
[05:13:20] <dbaupp> ChrisMorgan: (you probably need `let n = stream.read(buf); for stream.slice(0, buf).iter().advance ..`)
[05:13:24] <strcat> jensnockert: if it uses sse copies
[05:13:27] <strcat> needs 32-byte for avx
[05:13:28] <dbaupp> .slice(0, n)
[05:13:33] <strcat> but intel has an actual instruction for memcpy
[05:13:39] <strcat> and it special cases 64-byte in microcode
[05:13:42] <jensnockert> strcat: Both SSE and AVX need only 16-byte alignment?
[05:13:48] <ChrisMorgan> strcat: uh oh... that won't work. That's what happens when you run a mainline kernel.
[05:13:55] <strcat> jensnockert: avx needs 32-byte, doesn't it?
[05:14:03] <strcat> ChrisMorgan: hm?
[05:14:39] <jensnockert> strcat: Well, technically there is such an instruction, but on all current processors, the 16-byte version is just as fast.
[05:14:46] <ChrisMorgan> `perf` from linux-tools-common requires, before it will work, another package, kernel specific, which isn't produced for the kernel build I'm running
[05:14:52] <strcat> ChrisMorgan: ah
[05:16:15] <ChrisMorgan> dbaupp: I'll play round with it and see what I end up with. What I really need there is a simple generator. "loop: for byte in read(1_000_000): yield byte"
[05:16:20] <jensnockert> strcat: Not counting split cache-lines.
[05:16:38] <dbaupp> ChrisMorgan: it'd be pretty easy to write that
[05:17:09] <ChrisMorgan> dbaupp: but not that elegantly, I fancy?
[05:17:10] <jensnockert> strcat: Still, Rust does not enable AVX, does it?
[05:17:18] <strcat> jensnockert: you can enable it
[05:17:21] <strcat> jensnockert: but it's broken
[05:17:26] <strcat> because we don't do context switches right
[05:17:41] <strcat> jensnockert: the kernel/glibc will do whatever though
[05:17:58] <jensnockert> That would mean that we break glibc :(
[05:18:06] <jensnockert> If they are using AVX instructions.
[05:18:12] <strcat> jensnockert: possible.
[05:18:15] <dbaupp> ChrisMorgan: using an internal iterator would mean it's essentially that elegantly
[05:18:27] <strcat> jensnockert: we never context-switch while in C though
[05:18:30] <strcat> so probably unlikely
[05:18:41] <strcat> as in our own context-switch
[05:18:43] <jensnockert> strcat: Oh, right, then that is fine.
[05:19:00] <strcat> jensnockert: the linux kernel just uses rep movs
[05:19:01] <ChrisMorgan> dbaupp: I also need to be able to poke a single byte backâ€”you can't be sure an HTTP header is completed before reading the byte after the CR LF (if it's SP or HT, you're still goingâ€”it was linear white space)
[05:19:12] <strcat> jensnockert: they benchmarked sse/avx and decided to stick with it
[05:19:35] <dbaupp> ChrisMorgan: oh, well, that's trickier
[05:19:41] <jensnockert> strcat: As in decided not to implement AVX context switches?
[05:19:58] <strcat> jensnockert: no, as in the kernel's own memcpy
[05:20:14] <jensnockert> strcat: Yeah, AVX probably gives no advantage.
[05:20:27] * dbaupp ventures into trans
[05:21:24] * jensnockert binds a rope around dbaupp, so he can be extracted when he doesn't respond anymore.
[05:21:46] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Ping timeout)
[05:21:51] <steven_is_false> Ugh what's the name of the program that starts the MingGW shell?
[05:22:19] <Amanieu> msys?
[05:22:42] <steven_is_false> Amanieu: What I'd type to wine, as in wine mingw-shell
[05:23:03] * dbaupp hugs the rope
[05:23:46] *** Quits: noam (noam@F6B530A7.720527A7.416762B.IP) (Ping timeout)
[05:24:07] <ChrisMorgan> There, just boosted it up to almost 2,000 requests per second by allocating that ~[0u8] once, in the constructor, rather than each time read_byte was called.
[05:24:13] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[05:24:35] *** Joins: noam (noam@F6B530A7.720527A7.416762B.IP)
[05:25:36] <steven_is_false> Hoorah! I got the shell up!
[05:25:55] <strcat> ChrisMorgan: can it just be a fixed-size array?
[05:26:15] <ChrisMorgan> strcat: sorry, read() takes [u8], not [u8, ..1].
[05:26:34] <strcat> ChrisMorgan: does it actually take ~[u8]? I'd expect &mut [u8]
[05:26:42] <strcat> and you can slice any kind of vector
[05:26:55] <ChrisMorgan> Sorry, &mut [u8]
[05:27:01] <strcat> ChrisMorgan: that will work with a fixed-size one
[05:27:17] <strcat> rusti: let mut x = [1, 2, 3]; let y: &mut [int] = x; y[0]
[05:27:18] -rusti- 1
[05:27:24] <strcat> rusti: let mut x: [int, ..3] = [1, 2, 3]; let y: &mut [int] = x; y[0]
[05:27:25] -rusti- 1
[05:28:07] <jensnockert> Good night.
[05:28:11] <strcat> \o
[05:29:28] *** Quits: steven_is_false (user@moz-144077DE.bchsia.telus.net) (Ping timeout)
[05:29:35] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[05:33:22] *** Joins: rooo (jesse@moz-84BC20C1.dynamic.ip.windstream.net)
[05:34:27] *** Quits: roo_ (jesse@moz-BFD3E12.dynamic.ip.windstream.net) (Ping timeout)
[05:34:45] *** Joins: strcat1 (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:34:54] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[05:34:58] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[05:35:45] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:38:43] *** strcat1 is now known as strcat
[05:39:06] *** Quits: rooo (jesse@moz-84BC20C1.dynamic.ip.windstream.net) (Quit: Leaving)
[05:39:57] <strcat> merge!
[05:40:22] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[05:40:22] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/4In1IA
[05:40:22] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[05:41:03] *** Quits: wilsonk|2 (kvirc@moz-8E86F35A.cg.shawcable.net) (Ping timeout)
[05:41:21] *** Joins: wilsonk-laptop (kvirc@moz-8E86F35A.cg.shawcable.net)
[05:45:46] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[05:47:37] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[05:50:19] *** Quits: paulproteus (quassel@rose.makesad.us) (Ping timeout)
[05:50:30] *** Quits: echristo (echristo@60A74940.D6CCE4AE.77834EAA.IP) (Quit: echristo)
[05:51:30] *** Joins: victorporof (victorporo@864CC037.542EA61F.70D60F75.IP)
[05:52:17] *** Joins: paulproteus (quassel@moz-E86A3B42.makesad.us)
[05:53:13] <ChrisMorgan> strcat: I'm failing to get that to work in a struct
[05:53:44] <dbaupp> ChrisMorgan: code?
[05:55:25] <ChrisMorgan> rusti: struct A { b: ~[int, ..1] } fn foo(bar: &mut [int]) {} let mut a = A { b: ~[0i] }; foo(a.b); a
[05:55:27] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/FaLU
[05:55:44] <dbaupp> ChrisMorgan: remove the ~
[05:55:48] *** Joins: jaen (jaen@moz-6EB2CCD9.neoplus.adsl.tpnet.pl)
[05:56:03] <dbaupp> rusti: struct A { b: ~[int, ..1] } fn foo(bar: &mut [int]) {} let mut a = A { b: ~([0i]) }; foo(*a.b); a
[05:56:04] -rusti- <anon>:7:44: 7:47 warning: unused variable: `bar` [-W unused-variable (default)]
[05:56:04] -rusti- <anon>:7          struct A { b: ~[int, ..1] } fn foo(bar: &mut [int]) {} let mut a = A { b: ~([0i]) }; foo(*a.b); a
[05:56:04] -rusti-                                                      ^~~
[05:56:04] -rusti- {b: ~[0]}
[05:56:15] <dbaupp> rusti: struct A { b: [int, ..1] } fn foo(bar: &mut [int]) {} let mut a = A { b: [0i] }; foo(a.b); a
[05:56:16] -rusti- <anon>:7:43: 7:46 warning: unused variable: `bar` [-W unused-variable (default)]
[05:56:16] -rusti- <anon>:7          struct A { b: [int, ..1] } fn foo(bar: &mut [int]) {} let mut a = A { b: [0i] }; foo(a.b); a
[05:56:18] -rusti-                                                     ^~~
[05:56:18] <ChrisMorgan> Ah!
[05:56:20] -rusti- {b: [0]}
[05:56:27] <dbaupp> ChrisMorgan: (you want the second one.)
[05:56:35] <dbaupp> no need for an allocation there.
[05:57:11] <ChrisMorgan> Yep, I see exactly why this is. Just still not quite used to dealing with the non-"box-everything" ways.
[05:57:47] <dbaupp> it's easy: sed -i 's/[~@]//'
[05:57:48] <dbaupp> :P
[05:57:55] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[05:59:01] <ChrisMorgan> That's made it sit at about 2,000 requests per second, now. :-)
[06:00:43] <dbaupp> yay!
[06:05:25] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[06:06:40] *** Quits: victorporof (victorporo@864CC037.542EA61F.70D60F75.IP) (Quit: victorporof)
[06:07:15] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[06:08:42] *** Quits: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net) (Ping timeout)
[06:09:07] *** Joins: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net)
[06:11:21] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[06:12:49] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[06:14:10] *** Joins: sankha93 (Instantbir@E564052F.CB9FA3BE.25B273F5.IP)
[06:14:24] <dbaupp> llvm assertions \o/
[06:18:05] *** Quits: mitsuhiko (mitsuhiko-@moz-BC29B73E.srv.pocoo.org) (Ping timeout)
[06:18:55] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[06:19:09] *** Quits: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com) (Ping timeout)
[06:19:23] *** Joins: mitsuhiko (mitsuhiko-@moz-BC29B73E.srv.pocoo.org)
[06:20:22] *** Joins: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com)
[06:23:23] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[06:24:17] *** Quits: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com) (Ping timeout)
[06:25:06] *** Joins: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com)
[06:29:15] *** Joins: echristo (echristo@60A74940.D6CCE4AE.77834EAA.IP)
[06:29:17] <strcat> dbaupp: http://www.reddit.com/r/rust/comments/1ieaw5/the_end_of_unique_stringvector_headers/ ;p
[06:29:32] * strcat never posted anything about ~T so this can be for both :)
[06:29:41] * dbaupp upvotes
[06:31:58] *** Quits: kemurphy (kemurphy@moz-7332FD74.hsd1.pa.comcast.net) (Ping timeout)
[06:31:59] <shachaf> Hmm, I got the latest trunk and ./configure - make - make installed, and now rustc is saying "error: multiple matching crates for `std`"
[06:32:08] <shachaf> Was there something I should have done?
[06:33:00] <strcat> shachaf: it's supposed to handle it itself, but maybe you need make clean
[06:33:09] <shachaf> Uh oh.
[06:33:13] <strcat> the build system is not the greatest :)
[06:33:15] <shachaf> I need to compile it all over again?
[06:33:19] <strcat> shachaf: not LLVM
[06:33:24] <dbaupp> shachaf: possibly `make uninstall`, `make install`
[06:33:33] <shachaf> dbaupp: Hmm, let me try.
[06:33:45] <shachaf> Aha, that worked.
[06:33:47] <shachaf> Thanks!
[06:34:18] <shachaf> Do I need to do that every time?
[06:34:45] *** Joins: strcat1 (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[06:34:50] <strcat1> my wifi really hates me today
[06:34:57] <dbaupp> shachaf: it'll work more reliably, yes
[06:35:05] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (NickServ (GHOST command used by strcat1))
[06:35:08] *** strcat1 is now known as strcat
[06:35:25] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[06:35:33] *** Joins: kemurphy (kemurphy@moz-7332FD74.hsd1.pa.comcast.net)
[06:35:39] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[06:36:06] <shachaf> Is there a fast build for testing compiler changes?
[06:36:34] <shachaf> I suppose --disable-docs and maybe --disable-optimize etc. would do it.
[06:36:44] <strcat> shachaf: disabling optimization will likely take longer
[06:36:51] <dbaupp> shachaf: where are your changes?
[06:36:52] *** Quits: dwhyte (dwhyte@ED9190FB.B72E355F.7BF4A4B0.IP) (Quit: Leaving.)
[06:36:59] <strcat> shachaf: make check-stage1 lets you skip a stage
[06:37:23] <strcat> if you made actual changes to the compiler you'll want make check though
[06:37:31] <strcat> stdlib stuff just needs make check-stage1
[06:38:15] <strcat> since if you broke the compiler's ability to compile itself, you need stage2 to know ;p
[06:39:14] *** Quits: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[06:40:43] <shachaf> dbaupp: In this case libsyntax.
[06:41:40] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[06:41:43] <dbaupp> shachaf: yeah, you'll probably need a full make, unfortunately
[06:41:56] <shachaf> What if I'm OK with a compiler that can't compile itself?
[06:42:06] <shachaf> (For temporary tests etc.)
[06:42:11] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[06:42:11] <dbaupp> um, make rustc-stage1
[06:42:48] <dbaupp> what sort of changes are you making?
[06:43:19] <strcat> our make install target needs a lot of work ;p
[06:43:29] <strcat> my arch package has to do a bunch of extra work
[06:43:44] <shachaf> Just trying various things out to see what happens.
[06:44:02] <strcat> the makefiles are less comprehensible than the fiery depths of trans though
[06:44:15] <shachaf> Are the build targets documented somewhere?
[06:44:23] <strcat> don't think so
[06:44:36] <strcat> and the makefiles are a real mess of metaprogramming so it's hard to find them
[06:44:36] <mark_edward> strcat: nice work on that header stuff. saw the Reddit post
[06:44:37] <dbaupp> shachaf: there's a pile here https://github.com/mozilla/rust/wiki/Note-testsuite
[06:44:43] <strcat> mark_edward: thanks :)
[06:44:58] <shachaf> Thanks!
[06:45:16] <mark_edward> i wish i could throw a party for the Rust contributors when it hits 1.0
[06:45:20] <dbaupp> shachaf: and https://github.com/mozilla/rust/wiki/Note-build-system
[06:45:22] *** Joins: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au)
[06:45:26] <strcat> https://github.com/thestinger/packages/blob/master/rust-git/PKGBUILD#L41 I wish make install did that ;p
[06:45:36] *** Quits: KindOne (KindOne@moz-AAA86A99.dynamic.ip.windstream.net) (Ping timeout)
[06:45:40] <strcat> although I guess distros put that stuff in different places
[06:45:44] <mark_edward> i'll do it when I'm rich from the sales of my all Rust OS
[06:45:44] * strcat shrugs
[06:45:57] *** Joins: Ms2ger (Ms2ger@moz-D6466908.adsl-dyn.isp.belgacom.be)
[06:47:41] <gavinb> I'm trying to convert some Haskell code to Rust. I'm having trouble finding equivalents to standard functions, such as foldr, map et al. Yet I've found mention of these in various places, just not in the current docs/libs. Are these things in limbo while the iterator dust settles or something?
[06:48:21] <dbaupp> gavinb: iterators have them all
[06:48:44] <dbaupp> gavinb: foldr = a reverse iterator.fold(init, func), map = iterator.transform(func)
[06:49:18] <dbaupp> gavinb: http://static.rust-lang.org/doc/std/iterator.html#trait-iteratorutil
[06:49:36] <gavinb> dbaupp: aha, thank you! I was looking in vdc, at_vec, tier, and everywhere butâ€¦!
[06:49:45] <gavinb> er vdc -> vec
[06:49:45] <dbaupp> gavinb: also, http://static.rust-lang.org/doc/tutorial-container.html#iterators
[06:50:00] *** Joins: KindOne (KindOne@moz-E3637F00.dynamic.ip.windstream.net)
[06:50:25] *** Quits: eatkinson (eatkinson@moz-AD233F1B.dia.static.qwest.net) (Quit: eatkinson)
[06:50:28] <gavinb> dbaupp: thanks much!
[06:51:08] * mark_edward hugs dbaupp because he is always so helpful, even to annoying people like himself
[06:52:48] <dbaupp> :)
[06:57:32] *** Quits: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net) (Quit: zzz)
[07:02:18] <dbaupp> there is is a single `if true` in the whole code base... and it caught a bugs
[07:02:21] * dbaupp is lucky
[07:02:27] <dbaupp> *a bug
[07:02:39] * dbaupp are bad at plural
[07:04:16] *** Quits: KindOne (KindOne@moz-E3637F00.dynamic.ip.windstream.net) (Ping timeout)
[07:04:27] *** Joins: igl1 (igl@moz-CB70EB10.adsl.alicedsl.de)
[07:04:45] *** Quits: jaen (jaen@moz-6EB2CCD9.neoplus.adsl.tpnet.pl) (Ping timeout)
[07:05:00] *** Quits: igl (igl@moz-CB70EB10.adsl.alicedsl.de) (Ping timeout)
[07:05:45] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[07:06:26] *** Joins: jaen (jaen@moz-6EB2CCD9.neoplus.adsl.tpnet.pl)
[07:07:24] *** Quits: aatch (aatch@moz-B437F499.pocketrent.com) (Client exited)
[07:07:28] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[07:08:03] *** Joins: KindOne (KindOne@698375B8.8E36DE4.EC6A1518.IP)
[07:09:42] *** Quits: Ms2ger (Ms2ger@moz-D6466908.adsl-dyn.isp.belgacom.be) (Quit: bbl)
[07:10:17] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[07:14:05] <dbaupp> strcat: what's the best way to debug trans changes?
[07:14:29] <dbaupp> (specifically it'd be useful to print an ast::block...)
[07:19:01] *** Quits: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP) (Quit: ëžœë¤ì€ ì‡ í‡´í–ˆìŠµë‹ˆë‹¤.)
[07:20:03] *** Quits: heftig (heftig@moz-F0A5AD7E.dip0.t-ipconnect.de) (Ping timeout)
[07:21:11] *** Joins: heftig (heftig@moz-F0A5AD7E.dip0.t-ipconnect.de)
[07:22:03] *** Quits: jpf (jan@moz-A8C26A15.org) (Quit: Lost terminal)
[07:22:27] *** Joins: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP)
[07:22:41] *** Joins: jpf (jan@moz-A8C26A15.org)
[07:22:56] *** Quits: etw (john@moz-B2936CAB.nyc.res.rr.com) (Quit: etw)
[07:24:23] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[07:25:48] <heftig> rusti: std::iterator::Counter { state: 0, step: 1 }.filter_map(|x| if x % 2 == 0 {Some(x*3)} else {None}).take_(10).collect::<~[int]>()
[07:25:49] -rusti- ~[0, 6, 12, 18, 24, 30, 36, 42, 48, 54]
[07:30:25] <shachaf> Hmm, make rustc-stage1 still fails when I break part of the compiler, since it's used to compile the standard library.
[07:34:00] <kimundi> woho, my rust shirt arrived!
[07:34:42] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[07:34:56] <Luqman> dbaupp: an expr_block?
[07:35:06] <dbaupp> Luqman: yeah
[07:35:08] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[07:35:09] <dbaupp> kimundi: \o/
[07:36:05] <dbaupp> Luqman: actually, it's probably not that helpful
[07:36:18] <dbaupp> (and I mean, no, an ast::blk_)
[07:36:37] <Luqman> ah
[07:37:32] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[07:37:32] *** Quits: sankha93 (Instantbir@E564052F.CB9FA3BE.25B273F5.IP) (Ping timeout)
[07:37:51] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[07:38:53] <dbaupp> Luqman: https://github.com/huonw/rust/commit/777be90d087f7126961974bc23563875411a6d3f#L0R72
[07:39:14] <dbaupp> Luqman: the lit_bool(false) arm works fine, but the lit_bool(true) one doesn't.
[07:40:19] <Luqman> broken how so?
[07:40:32] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[07:40:51] <strcat> dbaupp: heh, I haven't really dealt with ast - just stuff further towards the backend ;p
[07:41:37] <dbaupp> rustc: /home/huon/rust/src/llvm/include/llvm/Support/Casting.h:231: typename llvm::enable_if<llvm::is_same<Y, typename llvm::simplify_type<From>::SimpleType>, typename llvm::cast_retty<X, Y*>::ret_type>::type llvm::cast(Y*) [with X = llvm
[07:41:37] <dbaupp> ::SequentialType; Y = llvm::Type; typename llvm::enable_if<llvm::is_same<Y, typename llvm::simplify_type<From>::SimpleType>, typename llvm::cast_retty<X, Y*>::ret_type>::type = llvm::SequentialType*]: Assertion `isa<X>(Val) && "cast<Ty>()
[07:41:38] <dbaupp>  argument of incompatible type!"' failed.
[07:41:56] <strcat> dbaupp: so, use gdb to get a stack trace so you know where it comes from
[07:42:03] <strcat> and then you can use bcx.val_to_str(value_ref)
[07:42:07] <strcat> to get a printable string
[07:42:28] <strcat> and ty_to_str(t) on the rust-level type
[07:42:29] * dbaupp tries
[07:42:43] <strcat> er
[07:42:53] <strcat> dbaupp: bcx.tcx().val_to_str() maybe
[07:42:57] <strcat> I don't remember example
[07:42:59] <strcat> example*
[07:43:01] <strcat> er
[07:43:03] <strcat> brain needs a patch
[07:43:06] <strcat> exactly* ;p
[07:43:45] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[07:44:12] <dbaupp> there appears to be a val_to_str on block_, so I guess that's it.
[07:44:13] <Luqman> it's bcx.val_to_str() & bcx.ty_to_str()
[07:45:24] <strcat> there are several versions of those things though
[07:45:35] <strcat> librustc suffers from free-functionitis even more than libstd
[07:45:52] <shachaf> It's pretty odd that enums and structs are treated as entirely different things everywhere in the compiler.
[07:45:57] * strcat can never remember where things come from because they come from everywhere
[07:46:04] <shachaf> Seems like a lot of code duplication...
[07:46:07] <dbaupp> shachaf: unlike Haskell, you mean?
[07:46:12] <shachaf> For instance.
[07:46:22] <Luqman> shachaf: yea, though trans::Adt tries to unify them a bit
[07:46:32] <shachaf> I know structs give you a stronger guarantee (memory layout like C, or something like that).
[07:46:40] <dbaupp> shachaf: they have different motivations & semantics
[07:46:41] <dbaupp> yeah
[07:46:49] <shachaf> But it seems odd both from user perspective and from compiler-writer perspective.
[07:47:10] <dbaupp> enums are free to be optimised however, but structs must match C.
[07:47:14] <shachaf> dbaupp: If that's the motivation then I bet most places where people use structs they should be using 1-variant enums.
[07:47:26] <shachaf> But the language makes that very awkward too. :-)
[07:47:34] <dbaupp> shachaf: yeah, maybe. but structs give you x.foo, and enums don't :(
[07:47:37] <strcat> enums can't have private data atm
[07:47:49] <shachaf> Well, they should!
[07:47:52] <strcat> neither can tuple structs :(
[07:48:03] <dbaupp> strcat: (rusti's disappeared?)
[07:48:16] <shachaf> Haskell also has something vaguely like this -- data vs. newtype -- but other than the keyword used, and restrictions with newtype, they behave exactly the same.
[07:48:17] <strcat> dbaupp: it doesn't like what my router is doing ;p
[07:48:25] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[07:48:38] <strcat> usually it reconnects but the router is sending a TCP RST
[07:48:39] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[07:48:40] <dbaupp> rusti: enum Foo { A { priv a: uint } }
[07:48:41] -rusti- ()
[07:48:53] <strcat> strangely it doesn't happen over a wired conn
[07:49:04] <dbaupp> rusti: mod X { pub enum Foo { A { priv a: uint } } } X::A { a : 1 }
[07:49:05] -rusti- <anon>:7:55: 7:59 error: field `a` is private
[07:49:05] -rusti- <anon>:7          mod X { pub enum Foo { A { priv a: uint } } } X::A { a : 1 }
[07:49:05] -rusti-                                                                 ^~~~
[07:49:05] -rusti- error: aborting due to previous error
[07:49:05] -rusti- application terminated with error code 101
[07:49:12] <shachaf> Is "M-b, M-f, etc. don't work in the REPL" a known bug, by the way?
[07:49:15] <dbaupp> strcat: they do have private fields
[07:49:20] <strcat> dbaupp: ah so they just inherit the limitations of tuple structs
[07:49:33] <dbaupp> shachaf: it just binds straight to liblinenoise
[07:49:40] <dbaupp> (fwiw)
[07:49:54] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[07:49:56] <shachaf> Oh, it doesn't use readline? For some reason I thought it did.
[07:50:46] *** Joins: mye (mye@moz-D545C334.dip0.t-ipconnect.de)
[07:51:17] <dbaupp> oh, maybe it does...
[07:51:23] <strcat> it doesn't
[07:51:41] <strcat> it uses that silly linenoise thing in src/rt
[07:51:48] <dbaupp> haha, how strange, it's extra::rl, but it binds to linenoise
[07:52:00] <strcat> libedit/readline are better but they're enormous in comparison
[07:52:31] <shachaf> Are keybindings for things like moving by word available?
[07:52:46] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[07:52:58] <strcat> shachaf: some emacs-like bindings work
[07:52:59] <strcat> hm
[07:53:15] * strcat shrugs
[07:53:32] <strcat> I dislike libedit/readline but linenoise is a step far down from those ;p
[07:53:41] * strcat likes zsh's line editor ;)
[07:53:47] <shachaf> Eh. The REPL is so slow that moving around to edit isn't the bottleneck anyway. :-)
[07:54:15] <shachaf> But still frustrating to hold down a key and wait.
[07:55:26] <strcat> rusti: 2
[07:55:26] -rusti- 2
[07:55:27] <strcat> rusti: 2
[07:55:28] -rusti- 2
[07:55:45] <strcat> rustc with a round-trip over a network is faster than actual rusti
[07:55:47] <strcat> ;p
[07:57:02] <strcat> \o
[07:57:03] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[08:00:04] *** Quits: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au) (Quit: gavinb)
[08:00:13] *** Joins: SimonSapin (simon@moz-D0C2F181.zone2.bethere.co.uk)
[08:01:39] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[08:02:14] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[08:02:57] *** Joins: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au)
[08:05:59] *** Joins: engla (engla@moz-9B69FE7C.selucle.dyn.perspektivbredband.net)
[08:07:16] *** Joins: doener (bs@moz-AA189A5A.unitymedia.biz)
[08:07:37] *** Quits: doener (bs@moz-AA189A5A.unitymedia.biz) (Quit: leaving)
[08:07:38] *** Joins: doener (bs@moz-AA189A5A.unitymedia.biz)
[08:07:53] *** Quits: doener (bs@moz-AA189A5A.unitymedia.biz) (Quit: leaving)
[08:08:35] *** Joins: doener (bs@moz-AA189A5A.unitymedia.biz)
[08:08:50] *** Quits: doener (bs@moz-AA189A5A.unitymedia.biz) (Quit: leaving)
[08:08:52] *** Joins: doener (bs@moz-AA189A5A.unitymedia.biz)
[08:09:10] *** Joins: jdm (jdm@92FB48CA.8B5E9DF.9A8C35B4.IP)
[08:09:11] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[08:09:53] <gavinb> So is the REPL slow because it is saving the input as a file and invoking the compiler?
[08:10:09] <dbaupp> Luqman: it's the same assertion as https://github.com/mozilla/rust/issues/7344
[08:12:32] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[08:13:26] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[08:14:08] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[08:14:13] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[08:17:44] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[08:19:28] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[08:24:35] <kimundi> gavinb: I'm not sure about the details, but afaik the main problem is that the REPL can't do anything faster than the regular compiler.
[08:24:57] <kimundi> No shortcuts it can take
[08:25:43] <gavinb> kimundi: Ahm so it can't simply generate some LLVM IR and run it from memory?
[08:26:03] <kimundi> well it does that afaik
[08:26:14] *** Joins: snadon_ (chatzilla@moz-3BC727E8.mc.videotron.ca)
[08:26:22] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[08:26:25] *** snadon_ is now known as snadon
[08:28:29] <kimundi> But it also does things like serializing prior inputs and recompiling them so that it remebers the current state etc...
[08:28:39] <kimundi> I don't really know
[08:29:32] * dbaupp has found the problem
[08:29:40] <dbaupp> ... now I just have to work out how to fix it
[08:33:27] *** Joins: CarpNet (ac@moz-FD24B77.sohonet.co.uk)
[08:34:56] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:37:10] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[08:39:35] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[08:40:25] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[08:42:09] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[08:47:56] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[08:48:10] *** Joins: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP)
[08:49:18] *** Quits: mcclurmc (mcclurmc@moz-8D61EFD1.cable.virginmedia.com) (Ping timeout)
[08:49:26] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[08:49:31] *** Quits: igl1 (igl@moz-CB70EB10.adsl.alicedsl.de) (Ping timeout)
[08:49:47] *** Joins: igl (igl@moz-58FFAB39.adsl.alicedsl.de)
[08:50:01] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[08:53:57] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[08:54:35] *** Joins: rca (rca@60B6E135.54AF2F32.CFA7DC0F.IP)
[08:54:48] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[09:01:29] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[09:01:50] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[09:06:23] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[09:06:59] *** Quits: SimonSapin (simon@moz-D0C2F181.zone2.bethere.co.uk) (Ping timeout)
[09:08:07] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[09:13:23] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[09:13:46] *** Quits: cr (anonymous@moz-970B27D8.dip0.t-ipconnect.de) (Ping timeout)
[09:14:01] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[09:15:39] <cmr> kimundi: rusti is *slower* than rustc though
[09:16:06] <kimundi> yes?
[09:16:56] <kimundi> What I meant was: rusti can't do anything faster than rustc, so it's either equally fist or slower
[09:17:05] <kimundi> fast*
[09:17:24] <cmr> yeah but it's like ~2x-3x slower ;(
[09:17:35] *** Joins: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl)
[09:22:10] *** Joins: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk)
[09:23:01] *** Joins: BitPuffin (quassel@moz-49828767.cust.tele2.se)
[09:23:15] *** Quits: echristo (echristo@60A74940.D6CCE4AE.77834EAA.IP) (Quit: echristo)
[09:24:08] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[09:24:54] <cmr> smvv: did you decide about https://github.com/mozilla/rust/issues/6750 ?
[09:25:34] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[09:25:59] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[09:29:26] *** Joins: fabiand (fabiand@moz-316DCBFB.pool.mediaways.net)
[09:35:15] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[09:35:32] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[09:37:28] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[09:38:11] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[09:38:43] *** Joins: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca)
[09:39:34] *** Joins: z0w0 (zack@A76ECE44.E8D776F0.D76C0449.IP)
[09:41:01] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[09:42:13] <smvv> cmr: i did not decide yet. I haven't talked with strcat about it so I've no idea if it's possible in a month
[09:42:44] <cmr> smvv: I wouldn't think it'd take more than a week or so, unless the LLVM API is very difficult to access from C
[09:42:54] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[09:44:22] <smvv> cmr: ok that's good to know. i've to write a small report about what i did as well (otherwise it's just implementation and that's less interesting for a university)
[09:44:59] <cmr> smvv: right. rust's semantics make tbaa kinda trivial, might want to pick a different issue?
[09:47:20] <smvv> you means because ~ are no aliases by default, and similar rules for &. makes sense. It's just that it's important that i finish the project on time, otherwise its hard to give a grade and that will cause a delay (i'm about to finish my bsc)
[09:47:39] <cmr> yeah
[09:50:25] *** Quits: fabiand (fabiand@moz-316DCBFB.pool.mediaways.net) (Quit: Verlassend)
[09:52:21] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[09:52:42] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[09:55:03] *** Quits: igl (igl@moz-58FFAB39.adsl.alicedsl.de) (Ping timeout)
[09:55:41] *** Joins: igl (igl@moz-BFB97778.adsl.alicedsl.de)
[10:04:51] *** Joins: SimonSapin (simon@88F51059.F3BBB17D.144F44FA.IP)
[10:05:27] *** Quits: jld (jld@moz-B94C75AD.xlerb.net) (Ping timeout)
[10:05:38] *** Quits: BigEndian (hurp@moz-1B6DD81E.members.linode.com) (Ping timeout)
[10:05:52] *** Quits: ziad (ziad@moz-5003F925.members.linode.com) (Ping timeout)
[10:06:01] *** Quits: balpert (balpert@moz-7E5ED302.members.linode.com) (Ping timeout)
[10:06:44] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[10:06:54] *** Quits: shachaf (shachaf@moz-F37E0395.members.linode.com) (Ping timeout)
[10:07:22] *** Quits: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com) (Ping timeout)
[10:07:22] *** Quits: Eridius (kevin@moz-533B0DB4.us) (Ping timeout)
[10:07:36] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[10:08:16] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[10:08:26] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[10:09:06] *** Joins: jld (jld@moz-B94C75AD.xlerb.net)
[10:09:14] *** Joins: BigEndian (hurp@moz-1B6DD81E.members.linode.com)
[10:09:27] *** Joins: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com)
[10:09:28] *** Joins: balpert (balpert@moz-7E5ED302.members.linode.com)
[10:09:42] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[10:10:09] *** Quits: jaen (jaen@moz-6EB2CCD9.neoplus.adsl.tpnet.pl) (Ping timeout)
[10:10:11] *** Joins: shachaf (shachaf@moz-F37E0395.members.linode.com)
[10:10:45] *** Joins: Eridius (kevin@moz-533B0DB4.us)
[10:11:24] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[10:12:19] *** Quits: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au) (Quit: gavinb)
[10:13:07] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[10:14:37] <smvv> cmr: perhaps I'll add bug #6600 to it. It's always easier to expand a research project than to reduce it. So I'll just rewrite a small proposal and if the uni accepts it i'll start working on it. Once it's done, i will see how much time is left and see what can be done in that time span
[10:14:55] <smvv> s/rewrite/write/
[10:18:37] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[10:19:28] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[10:20:07] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[10:23:42] *** Joins: Earnestly (earnest@2AB30F53.FB5005.2BCC804A.IP)
[10:26:25] <doomlord> working with clang/ast and libsyntax/ast a little  is making me think of how great lisp macros were :)
[10:32:00] *** Joins: snadon_ (chatzilla@moz-3BC727E8.mc.videotron.ca)
[10:32:18] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[10:32:27] *** snadon_ is now known as snadon
[10:36:55] *** Joins: etw (john@moz-B2936CAB.nyc.res.rr.com)
[10:37:49] *** Quits: etw (john@moz-B2936CAB.nyc.res.rr.com) (Client exited)
[10:41:01] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[10:43:23] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[10:44:26] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[10:52:33] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[10:53:20] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[10:53:47] *** Joins: sk (sk@A298A44C.54A580E3.78DD174B.IP)
[10:54:05] *** Quits: Earnestly (earnest@2AB30F53.FB5005.2BCC804A.IP) (Quit: WeeChat 0.4.2-dev)
[10:54:41] *** Quits: Luqman (laden@moz-DCEF6040.csclub.uwaterloo.ca) (Ping timeout)
[10:54:51] *** Quits: jj2baile (jon@moz-DCEF6040.csclub.uwaterloo.ca) (Ping timeout)
[10:54:55] *** Quits: ssalbiz_ (ssalbiz@moz-DCEF6040.csclub.uwaterloo.ca) (Ping timeout)
[10:55:21] *** Quits: mcpherrin (mimcpher@moz-345B5EBA.csclub.uwaterloo.ca) (Ping timeout)
[10:55:34] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[10:56:10] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[10:57:05] *** Joins: ssalbiz (ssalbiz@moz-DCEF6040.csclub.uwaterloo.ca)
[10:57:18] *** Joins: jj2baile (jon@moz-DCEF6040.csclub.uwaterloo.ca)
[10:57:24] *** Joins: Luqman (laden@moz-DCEF6040.csclub.uwaterloo.ca)
[10:57:38] *** Joins: mcpherrin (mimcpher@moz-345B5EBA.csclub.uwaterloo.ca)
[11:01:47] *** Joins: MaikKlein1 (maik@moz-5867653C.dip0.t-ipconnect.de)
[11:04:10] *** Quits: doomlord_ (servitor@moz-13E69BC8.range86-180.btcentralplus.com) (Client exited)
[11:05:44] *** Joins: jaen (jaen@moz-6EB2CCD9.neoplus.adsl.tpnet.pl)
[11:06:11] *** Joins: doomlord_ (servitor@moz-13E69BC8.range86-180.btcentralplus.com)
[11:06:19] *** Quits: jj2baile (jon@moz-DCEF6040.csclub.uwaterloo.ca) (Ping timeout)
[11:06:34] *** Quits: Luqman (laden@moz-DCEF6040.csclub.uwaterloo.ca) (Ping timeout)
[11:07:04] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[11:07:24] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[11:07:32] *** Joins: Earnestly (earnest@2AB30F53.FB5005.2BCC804A.IP)
[11:07:45] *** Quits: mcpherrin (mimcpher@moz-345B5EBA.csclub.uwaterloo.ca) (Ping timeout)
[11:07:46] *** Joins: mcpherrin (mimcpher@moz-345B5EBA.csclub.uwaterloo.ca)
[11:08:44] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[11:11:56] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[11:12:37] *** Joins: jj2baile (jon@moz-DCEF6040.csclub.uwaterloo.ca)
[11:12:39] *** Joins: Luqman (laden@moz-DCEF6040.csclub.uwaterloo.ca)
[11:13:03] <dbaupp> nmatsakis: ping
[11:13:43] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[11:16:32] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[11:18:10] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[11:21:12] *** Quits: z0w0 (zack@A76ECE44.E8D776F0.D76C0449.IP) (Client exited)
[11:22:18] *** Joins: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP)
[11:22:54] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[11:25:24] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[11:25:34] *** Quits: MaikKlein1 (maik@moz-5867653C.dip0.t-ipconnect.de) (Ping timeout)
[11:28:35] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[11:29:56] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[11:34:39] *** Joins: jensnockert (jensnocker@moz-EF95FD94.astro.lu.se)
[11:36:23] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[11:36:41] *** Quits: slaren (slaren@moz-A50C76EA.red-88-26-56.staticip.rima-tde.net) (Ping timeout)
[11:40:30] *** Quits: jensnockert (jensnocker@moz-EF95FD94.astro.lu.se) (Input/output error)
[11:42:44] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[11:42:47] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[11:44:31] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[11:54:28] *** Joins: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP)
[11:58:42] <Yoric> I'll be on semi-vacations for a few days next week.
[11:58:49] <Yoric> What should I bring with me to brush up on Rust?
[11:58:54] * Yoric hasn't used Rust since 0.3.
[11:59:11] <Yoric> (this may include one or two low-priority bugs)
[12:01:19] *** Joins: jfbk (textual@moz-EEA9CFB3.nyc.res.rr.com)
[12:03:15] <bstrie> Yoric: here's what google recommends: http://www.amazon.com/home-improvement/dp/B000RNPGKO
[12:03:56] <bstrie> Yoric: have you been following all of nmatsakis' blog posts since 0.3?
[12:04:10] <Yoric> Remotely.
[12:04:23] <Yoric> I have been following some of the versions of region-based memory management, but not all.
[12:04:24] *** Joins: ziad (ziad@moz-5003F925.members.linode.com)
[12:05:13] *** Quits: _Vi (vi@527C345F.497AA854.B16B3BE6.IP) (Ping timeout)
[12:05:35] <bstrie> Yoric: go to http://smallcultfollowing.com/babysteps/blog/categories/rust/ and basically read every article from "Associated items" and up
[12:06:19] <Yoric> Thanks.
[12:06:20] *** Joins: fabiand (fabiand@moz-FCBBAF15.adsl.alicedsl.de)
[12:06:29] *** Quits: noam (noam@F6B530A7.720527A7.416762B.IP) (Ping timeout)
[12:09:14] <bstrie> Yoric: also read http://pcwalton.github.io/blog/2013/06/02/removing-garbage-collection-from-the-rust-language/
[12:09:26] <Yoric> Yes, I've read that one already.
[12:10:42] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Ping timeout)
[12:12:11] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[12:12:47] *** Quits: Nisstyre (wes@moz-FD86289.netflash.net) (Quit: Leaving)
[12:13:07] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[12:14:51] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[12:15:50] <engla> look at iterators too
[12:16:00] <bstrie> ah yes, just read the iterator lib
[12:16:02] *** Joins: LU324 (stuff@moz-A17E9A7B.dyn.embarqhsd.net)
[12:16:24] <engla> it should be pretty simple. http://static.rust-lang.org/doc/tutorial-container.html has a very small summary
[12:16:53] *** Joins: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com)
[12:16:53] *** Quits: LU324 (stuff@moz-A17E9A7B.dyn.embarqhsd.net) (Connection reset by peer)
[12:17:08] *** Joins: LU324 (stuff@moz-A17E9A7B.dyn.embarqhsd.net)
[12:18:19] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[12:19:18] <Yoric> Added to my reading list.
[12:19:28] *** Joins: noam (noam@F6B530A7.720527A7.416762B.IP)
[12:22:10] <cmr> https://f.cloud.github.com/assets/5021563/804434/07bf71c8-ee0e-11e2-9517-9af4aa197fe3.png
[12:22:48] <cmr> Just *look* at that beauty.
[12:23:15] <dbaupp> cmr: is that rustdoc_ng?
[12:23:26] <ion> FSVO beauty. The font rendering is very blurry. :-P
[12:24:10] <cmr> dbaupp: it's a mockup somone made, but yes, if at all possible that is what it will look like!
[12:24:32] <engla> can you click the methods to see the parameters?
[12:24:34] <dbaupp> cmr: :'( that it doesn't exist yet. :P
[12:24:50] <engla> or maybe something mystery-meat-y
[12:25:03] <Seldaek> cmr: implementation is no problem really (granted you ship enough data in the json:)
[12:25:14] *** Joins: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl)
[12:25:35] <Seldaek> ion: that's photoshop antialiasing weirdness, it'll look different in browser
[12:26:10] <ion> aye
[12:26:29] <leonvv> What does this error message mean: "cannot move out of dereference of & pointer" ?
[12:26:56] <cmr> leonvv: it means you're trying to do like "foo = *bar", but bar is a borrowed pointer, you can't move out of it because you can't own it.
[12:26:56] <Seldaek> engla: clicking on the methods would lead you to a method detail page with full docs and signature etc, not sure yet if we want to show the signatures in the method listings or not, it'd make it quite a bit longer but it has some value as well..
[12:27:39] <dbaupp> Seldaek: does each method get it's own page?
[12:27:40] <cmr> Seldaek: I have some thoughts for interaction with that but I'm busy atm
[12:27:41] <leonvv> cmr: So how can you change self in a method?
[12:28:03] <dbaupp> leonvv: fn my_method(&mut self) gives you a mutable reference to self
[12:28:05] <cmr> leonvv: mutate self or literally replace self?
[12:28:08] <engla> new pages would make it hard to find the right method among several similar ones
[12:28:19] <dbaupp> engla: yeah, I agree.
[12:28:40] <leonvv> cmr: just mutable, I think dbaupp already answered, thanks both
[12:28:51] <Seldaek> dbaupp, engla: I think they should have their own page, once we get proper docs it probably makes more sense than those 3km long pages, but granted given that rust typically has a few variants of each method with suffixes it might be a pain
[12:29:11] <cmr> ok. I don't know if you wanted something like C++'s *this = ...
[12:29:27] <dbaupp> Seldaek: yeah, putting each impl on it's own page (rather than each method) might be a nice balance
[12:29:35] <dbaupp> cmr: &mut self should still work for that
[12:29:38] <Seldaek> dbaupp, engla: in any case it's not set in stone, but I'd like to try it as is and see how it feels, because having one page per entity can allow you to do a bit more stuff, and you'd still have the sidebar to quickly switch to neighbor methods
[12:29:55] <cmr> I think what it has now is quite good with some accordion boxes and keyboard shortcuts to expand them
[12:30:08] <cmr> plus search bar a la erldoc
[12:30:12] <cmr> (http://erldocs.com/)
[12:30:18] <dbaupp> Seldaek: yup (I'll stop trying to bike shed now :) )
[12:30:23] <Seldaek> oh yeah we forgot the search bar in there :)
[12:31:12] <dbaupp> (having it still usable without js would be pretty awesome ;) )
[12:31:28] <Seldaek> should be feasible really
[12:31:38] <Seldaek> well, not the search 
[12:31:43] <Seldaek> but the rest is just links
[12:33:43] <dbaupp> okaay... I appear to be a making progress... LLVM is now asserting 4 lines later \o/
[12:34:59] <cyndis> i made something similar: http://cyndis.org:4567/core::str back in the dark ages
[12:35:17] <cyndis> it was a horrible hack though
[12:35:22] <cmr> dark ages indeed
[12:35:26] <cyndis> yes
[12:35:48] <km> I'm back to working on my Rust wrapper for libusb and trying to figure out how to map USB onto Rust memory management and concurrency paradigms.
[12:36:14] <km> I have Context, DeviceHandle, and Endpoint structs, each of which wrap a C type. An Endpoint needs to keep its associated DeviceHandle alive, and a DeviceHandle needs to keep a Context alive. I want to be able to use different Endpoints on different Rust tasks.
[12:36:43] <km> Libusb is fully thread-safe, so I don't want Rust do do any locking.
[12:37:07] *** Joins: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au)
[12:37:08] <cmr> km: as long as you don't want to share Endpoints across tasks, you should be fine
[12:37:44] <cmr> or, between tasks
[12:37:47] *** Quits: jdm (jdm@92FB48CA.8B5E9DF.9A8C35B4.IP) (Quit: Lost terminal)
[12:37:47] <dbaupp> km: are you using lifetimes to associate the Endpoint/DeviceHandle/Context's with their parents?
[12:37:49] <cmr> silly prepositions
[12:38:41] <km> I've been trying to use extra::arc:ARC which is kind of what I want, but doesn't allow mutability (and RWARC enforces locking).
[12:39:00] <km> I've seen lifetimes with iterators. How do they work across tasks?
[12:39:19] *** Quits: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com) (Client exited)
[12:39:28] <cmr> km: is there any reason you can't *send* the Endpoint to a different task, rather than sharing?
[12:40:28] *** Joins: _Vi (vi@527C345F.497AA854.B16B3BE6.IP)
[12:40:31] <km> I want to send the Endpoints to different tasks, and the DeviceHandle needs to stay alive until all the Endpoints are dead.
[12:40:55] <cmr> Do multiple Endpoints use a single DeviceHandle?
[12:41:29] <km> Yes, a DeviceHandle is basically collection of Endpoints.
[12:43:45] <km> In libusb, the actions on endpoints just take a libusb_device_handle*, but I think I want to break endpoints out as separate objects for Rust so they can be owned by different tasks. But if the DeviceHandle manages the destruction of the libusb_device_handle, I need to make sure it outlives all the Endpoints.
[12:43:56] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[12:44:44] <cmr> Yeah, that doesn't fit well into the task model.
[12:44:57] <cmr> You might need to write your own unsafe code for this
[12:45:18] <cmr> I'd imagine you'd want reference counting for the DeviceHandle, which the Endpoint decrements when it is destructed.
[12:45:47] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[12:47:22] <km> Yeah. I read the source code for ARC and it mostly makes sense.
[12:48:02] <km> I could use ARC and unsafely transmute it to mutable, maybe.
[12:48:39] <cmr> Or maybe keep an unsafe pointer to the DeviceHandle?
[12:49:06] * cmr not familiar with writing unsafe rust code
[12:50:33] <km> Yeah, I could keep an unsafe pointer to a DeviceHandleData backend struct with a refcount in it, and free it when that drops to 0. That's basically what ARC does.
[12:52:00] <km> Ok, I'll go play with unsafe code. Just wanted to make sure there wasn't something easier I was missing.
[12:52:52] <bjz> Seldaek: commented: https://github.com/cmr/rustdoc_ng/issues/5#issuecomment-21039129
[12:53:30] *** Joins: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP)
[12:53:38] <doomlord_> https://github.com/dobkeratops/rust-bindgen <<< trying to add limited CPP method support to bindgen. my intention is to emit classname_method wrappers in a shim cpp, and rust side  impls' that call the methods
[12:55:10] <Seldaek> bjz: answered, regarding the colors I'll defer judgement to the lady because I don't want to get involved there :p but AFAIK she just picked up random colors to get started it wasn't really thought out yet so your suggestion sounds good although maybe not enough contrasted
[12:55:21] <doomlord_> i dont know what other approaches people may have / be trying for C++ binding ... and i doubt i'll handle much of cpp here
[12:55:36] <bjz> Seldaek: yeah no worries, just a start ofc
[12:56:12] <Seldaek> bjz: but I think a lot of small things will be easier to tweak once we can look at the actual thing 
[12:57:03] <cmr> doomlord_: might look at getting rust support into SWIG, it can do a lot.
[12:57:12] <bjz> Seldaek: are you working with a designer?
[12:59:59] <Seldaek> bjz: sort of, I'm abusing my girlfriend's skills for my nerdy endeavours :p
[13:00:07] <bjz> Seldaek: no worries
[13:00:08] <doomlord_> i guess breaking the cpp->C  and C->rust into 2 seperate stages is more manageable
[13:00:12] *** Joins: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net)
[13:02:06] <bjz> Seldaek: how much have you discussed the problem before hand?
[13:02:42] <bjz> Seldaek: The difficulty with the docs at the moment is method discovery, and figuring out what exports where
[13:03:01] <bjz> Seldaek: also what traits are in scope in what modules
[13:03:06] <Seldaek> bjz: quite a bit of talking and drawing things, but it's hard to go into the gory details like those impls questions because she has no clue what I'm talking about and I am not even sure myself sometimes given my knowledge of rust
[13:03:40] <bjz> Seldaek: are you the melbourne fellow?
[13:03:50] <Seldaek> no no zurich, .ch
[13:03:51] <bjz> (I might be thinking of somebody else)
[13:04:59] <Seldaek> anyway yes method discovery I hope we address by grouping everything on the struct page
[13:05:17] <Seldaek> re-exports should be listed on module pages if that's what you're talking about
[13:06:11] <Seldaek> as for the traits in scope, I'm not sure I get what you mean, is there anything special to trait?
[13:07:44] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[13:09:30] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[13:10:34] <Seldaek> bjz: that said, not much of this has any impact on the design, and it has little impact on how we create the html output as well, so it'll be fairly easy to change this stuff once we can play with it if we notice it's not working out
[13:10:47] <bjz> SeldaekL yeah agreed
[13:10:55] <Seldaek> bjz: at this piont I'm more interested in ironing out critical issues in the design or overall concept
[13:11:41] *** Joins: mib_khcz0n (Mibbit@34B89D1F.D1AE8978.36AE428F.IP)
[13:11:42] <Seldaek> that said, I should really get work done :)
[13:11:54] <bjz> yeah the focus should be on the structure of the information - how to divide it up, what to show on what page
[13:11:58] <mib_khcz0n> ??
[13:12:00] <bjz> what links to what
[13:12:33] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[13:12:48] *** Quits: mib_khcz0n (Mibbit@34B89D1F.D1AE8978.36AE428F.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[13:13:48] *** Quits: engla (engla@moz-9B69FE7C.selucle.dyn.perspektivbredband.net) (Ping timeout)
[13:14:44] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[13:14:49] <leonvv> What does this mean: "cannot move out of captured outer variable" ?
[13:15:12] *** Joins: mudpit (Mibbit@34B89D1F.D1AE8978.36AE428F.IP)
[13:15:13] <bjz> leonvv: what is the contex?
[13:15:17] <bjz> code?
[13:16:01] <dbaupp> leonvv: https://github.com/mozilla/rust/wiki/Doc-under-construction-FAQ#once-functions
[13:16:28] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[13:16:51] <leonvv> Inside a closure, I will read that page
[13:17:47] <mudpit> Hello.
[13:20:10] <dbaupp> mudpit: hi!
[13:20:33] <bjz> mudpit: hurro
[13:22:15] *** Joins: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net)
[13:23:23] <mudpit> sorry to interrupt.I started  rust and I plan to make calculator using rust. I already read tutorial. but I think it is not enough for a beginner. Can I get a any help..I want to get more examples..
[13:24:33] *** Quits: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net) (Client exited)
[13:26:10] <mudpit> Or any match table for generic C api.. I want to get more info for rust..but I dont know what to do,...
[13:26:53] <dbaupp> mudpit: what is a "match table"?
[13:27:42] *** Quits: jfbk (textual@moz-EEA9CFB3.nyc.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[13:28:42] <kimundi> mudpit: Feel free to ask any question here :)
[13:28:46] <mudpit> for example , I want to use rust api like scanf 
[13:29:14] <mudpit> thank you..
[13:29:52] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[13:31:21] <mudpit> I wonder where a beginner can get more api info and examples..
[13:31:51] *** Joins: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP)
[13:32:06] <kimundi> At this point, the only major source of code examples and api docmuntatiaons is the rust sourcecode itself
[13:32:25] <cmr> and even that isn't very good :(
[13:32:32] <kimundi> There is also rust for rubyists, but that still needs to be updated to the current state of the language
[13:33:28] *** Joins: bytewise (bytewise@moz-649C630D.unitymediagroup.de)
[13:35:21] <mudpit> you mean "rust / src / libstd /" 
[13:35:50] *** Joins: sp3d (a@moz-49806493.dhcp.stls.mo.charter.com)
[13:35:58] <kimundi> yeah
[13:36:28] <kimundi> The tutuorials are also kinda useful
[13:36:29] <cmr> mudpit: http://www.rustforrubyists.com/book/index.html is good, but the code examples aren't up to date yet (they're mostly minor renaming things)
[13:37:06] *** Joins: saml (sam@moz-14C16814.cst.lightpath.net)
[13:37:49] <mudpit> oh thank you :)
[13:38:26] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[13:38:27] *** ChanServ sets mode: +o dherman
[13:39:45] *** Joins: Azdle (Azdle@moz-B334B496.hfc.comcastbusiness.net)
[13:40:33] <kimundi> mudpit: Re your calculator: If you want to read a line of input from, stdin you probably want std::io::stdin().read_line() (But I'm not sure if that's the current correct way to do this)
[13:41:07] <cmr> you'd want to do like `let in = std::io::stdin();` and then call `in.read_line()` when you want a new line
[13:41:16] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[13:41:27] <dbaupp> (if you're reading all the lines one after the other, `for std::io::stdin().each_line |line| { .. }` is more convenient.)
[13:42:07] <kimundi> As far as I know we don't have an equivalent of scanf yet
[13:42:53] <kimundi> so you'd have to parse the numbers and operators yourself. 
[13:44:23] <kimundi> Well, you don't need to parse the actual numbers, that we have functions for
[13:44:46] <mudpit> oh..
[13:45:24] *** Quits: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au) (Quit: gavinb)
[13:45:29] <dbaupp> \o/ it looks like I've fixed my first trans bug.
[13:45:30] <kimundi> I think you can get it to do what you want easily anyway
[13:45:35] *** Joins: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP)
[13:45:35] * dbaupp is happy
[13:46:32] <mudpit> thank you for your information, I think I need to make more efforts..
[13:46:42] <kimundi> If you can life with the restriction that all distinct elemnts of your input need to be seperated by white space you can use the word iterator
[13:47:13] <kimundi> "1 + 3" => "1", "+", "3"
[13:47:24] *** Quits: erickt (erickt@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[13:47:43] <mudpit> oh
[13:47:48] <mark_edward> dpes rust have variadic function args or templates
[13:47:57] <cmr> mark_edward: nope
[13:48:21] <mudpit> what is dpes rust?
[13:48:32] <cmr> a typo
[13:49:01] <dbaupp> mark_edward: you can "simulate" variadic args with stack vectors (i.e. &[])
[13:49:02] <mark_edward> *does
[13:49:55] *** Joins: engla (engla@moz-14524F0F.selucle.dyn.perspektivbredband.net)
[13:50:07] <mark_edward> dbaupp: how? it can't hold differen types
[13:50:27] <kimundi> something like ... ' let s = stdin().read_line(); let mut it = s.word_iter(); let tokens: ~[&str] = it.collect(); // do something with the tokens'
[13:51:05] <cmr> mark_edward: neither can variadic args, not safely.
[13:51:06] <dbaupp> mark_edward: yeah, you have to either use trait objects, or something like Either<onetype, anothertype>
[13:51:10] <cmr> mark_edward: you'd use an enum.
[13:51:25] <dbaupp> mark_edward: it's type-safe variadic args
[13:51:30] <dbaupp> (sort of.)
[13:51:44] <mark_edward> doesn't C++ have typesafe varargs?
[13:51:57] <doomlord_> c++11 yes
[13:52:09] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[13:52:10] <cmr> not on functions
[13:52:19] <cmr> templates, yes.
[13:52:59] <dbaupp> http://en.cppreference.com/w/cpp/utility/variadic
[13:53:06] <dbaupp> " If all variable arguments share a common type, a std::initializer_list provides a convenient mechanism (albeit with a different syntax) for accessing variable arguments."
[13:53:27] <dbaupp> also, " Variadic templates can also be used to create functions that take variable number of arguments. They are often the better choice because they do not impose restrictions on the types of the arguments, do not perform integral and floating-point promotions, and are type safe. (since C++11) "
[13:53:41] *** Quits: ssbr (ssbr@moz-141F89C6.block0.gvtc.com) (Ping timeout)
[13:53:49] <dbaupp> http://en.cppreference.com/w/cpp/language/parameter_pack
[13:56:09] <doomlord_> i'm seeing ... local functions, a pleasant surprise!.. something i've always missed in C and a use case for C macros.. ... is that closure sugar ?
[13:57:13] <engla> functions nested inside functions are not closures
[13:57:16] <engla> just functions
[13:57:39] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[13:57:57] <doomlord_> oh just a namespace anti-pollutant i guess
[13:58:44] <engla> I don't know exactly why
[13:58:49] <kimundi> doomlord_: Yeah, the same way you can write 'use', 'mod', 'struct', 'enum' etc in a function body
[14:00:04] <mark_edward> are rust strs null terminaed?
[14:00:12] <cmr> mark_edward: unspecified
[14:00:23] <dbaupp> mark_edward: yes currently, but I'm hoping that it'll be removed
[14:00:28] <cmr> Currently I think they are but someone is working on removing them
[14:00:36] <mark_edward> dbaupp: why is that a bad thing?
[14:00:45] <kimundi> (well, not sure if mod and/or use still works...)
[14:00:50] *** Quits: jaen (jaen@moz-6EB2CCD9.neoplus.adsl.tpnet.pl) (Ping timeout)
[14:00:50] *** Quits: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl) (Client exited)
[14:00:57] <dbaupp> (that is, ~str, @str and a literal like "abc" are null terminated, not necessarily slices.)
[14:01:02] <cmr> mark_edward: it's not bad per se, but there are a lot of idiosyncracies it creates.
[14:01:13] <mark_edward> cmr: like what?
[14:01:18] <cmr> is s.len() the length of the string, or the length of the string plus the null terminator?
[14:01:39] <dbaupp> mark_edward: there was some technical ones about the behaviour of from_bytes
[14:01:42] <kimundi> mark_edward: It's a good thing in theory, but in praxis it caused a lot of problem when converting to/from othe types like [u8]
[14:01:44] <dbaupp> (and as_bytes)
[14:01:59] <doomlord_> i just had a bug with that sort of thing myself yesterday. although i would have guessed c-like strings was more convinient overall
[14:02:19] <cmr> there was a long discussion about it somewhere
[14:02:21] <dbaupp> mark_edward: i.e. currently all &str's are actually secretly 1 byte longer, so it's *always* valid to access one past the end (to check for a null)
[14:02:25] <cmr> might have been a meeting a few weeks ago?
[14:02:30] <kimundi> mark_edward: The new rule is going to be that a string is not explicitly null terminated, wich is no problem because all safe rust code uses len fields
[14:02:49] <doomlord_> i think i'd agree starting from scratch a string being a char vector is  cleaner
[14:02:50] <mark_edward> kimundi: ok
[14:03:05] <dbaupp> mark_edward: but this means that you can't have str::from_bytes(&'a [u8]) -> &'a str without "dropping" the last byte of the vector (confusing)
[14:03:30] <doomlord_> no need for a seperate set of concat functions etc..
[14:03:37] <kimundi> mark_edward: if you want to pass a string to C code that expects a null terminator you're going to have to either copy, or embedded a 0 ints the string yourself and call a wrapper that reuses that
[14:03:44] <dbaupp> mark_edward: which then means that str::from_bytes().as_bytes() isn't a noop, unless as_bytes returns a null terminated vector
[14:03:45] *** Joins: igl1 (igl@moz-F36E59E8.adsl.alicedsl.de)
[14:04:13] *** Quits: igl (igl@moz-BFB97778.adsl.alicedsl.de) (Ping timeout)
[14:04:20] <kimundi> The nice thing is that embedded nulls are totally legal in utf8, so no problem with "pass this string to C code please\0"
[14:04:21] <dbaupp> mark_edward: well a "null terminated" vector, since the hidden byte of slice isn't necessarily null
[14:04:57] <dbaupp> mark_edward: and so if as_bytes returned this byte, you now have an extra byte magically appearing... also confusing!
[14:05:11] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[14:05:32] <mark_edward> dbaupp:  i see what you mean
[14:06:10] <kimundi> plus i think it could've caused subtl memory races
[14:06:15] <dbaupp> (fwiw, erickt is the one working on it.)
[14:06:37] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[14:06:59] <kimundi> &mut"foobar" -split-> &mut"foo", &mut"bar" would actually be  &mut"foob" and &mut"bar\0" 
[14:07:06] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[14:08:57] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[14:10:44] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[14:11:06] <dbaupp> doomlord_: you mean {~&@}[char]?
[14:11:09] *** Joins: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net)
[14:11:41] <doomlord_> string as vector of char, yes
[14:12:06] <dbaupp> the problem with ucs4 (which that is) is it makes text big: 4 bytes for each ascii byte.
[14:12:07] <kimundi> making str a would offer only disadvantages [char] 
[14:12:17] <kimundi> whoops
[14:12:44] <doomlord_> how come
[14:12:55] <doomlord_> you need to pad vector elemets out ?
[14:13:10] <dbaupp> doomlord_: what do you mean?
[14:13:46] <doomlord_> " is it makes text big: 4 bytes for each ascii byte. <<<" ... to do [char] you'd have to pad the chars out ?
[14:14:04] <dbaupp> char is fixed size: 4 bytes.
[14:14:05] <kimundi> well, anyway: regular strs would be four times as large (most data will probably be in the ascii range of utf8) and it offers no O(1) index advantages for graphemes (there are still combining codepoints)
[14:14:25] <doomlord_> i didn't realise. i mean [u8] :)
[14:14:37] *** Quits: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net) (Client exited)
[14:14:40] <dbaupp> oh
[14:14:45] <dbaupp> well str is [u8]
[14:15:07] <dbaupp> (under the hood.)
[14:15:35] *** Joins: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net)
[14:17:42] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[14:20:11] *** Quits: engla (engla@moz-14524F0F.selucle.dyn.perspektivbredband.net) (Ping timeout)
[14:24:35] *** Joins: engla (engla@moz-BFD53D48.selucle.dyn.perspektivbredband.net)
[14:28:31] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[14:28:57] <mark_edward> is there anyway to have a heap closure move capture a variable?
[14:28:58] <nmatsakis> dbaupp: pong (long delayed)
[14:30:13] <dbaupp> nmatsakis: doesn't matter :) I worked it out... eventually. (it was a question about some code you were `git blame`d for in trans, but the problem was elsewhere anyway.)
[14:30:51] <dbaupp> mark_edward: the Cell solution of https://github.com/mozilla/rust/wiki/Doc-under-construction-FAQ#once-functions?
[14:31:42] *** Joins: lmandel (lmandel@8B192B20.1F93A08E.ADB88A9.IP)
[14:34:01] *** Joins: devinus (devinus@DAEC7122.372FE49C.29F95E0F.IP)
[14:34:15] *** Joins: slaren (slaren@moz-254A8D7B.red-79-153-227.dynamicip.rima-tde.net)
[14:34:18] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[14:34:18] *** ChanServ sets mode: +o dherman
[14:34:45] *** Quits: bytewise (bytewise@moz-649C630D.unitymediagroup.de) (Quit: Leaving)
[14:35:34] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[14:36:59] <mark_edward> dbaupp: thanks!
[14:37:18] *** Joins: bytewise (bytewise@moz-649C630D.unitymediagroup.de)
[14:39:33] *** Quits: cowboyd (cowboyd@moz-DD0FF83.lightspeed.austtx.sbcglobal.net) (Client exited)
[14:41:29] *** Joins: ssbr (ssbr@moz-141F89C6.block0.gvtc.com)
[14:41:36] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[14:41:52] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[14:42:45] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Connection reset by peer)
[14:44:43] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[14:44:44] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[14:46:36] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[14:46:50] *** Quits: engla (engla@moz-BFD53D48.selucle.dyn.perspektivbredband.net) (Ping timeout)
[14:46:53] <mark_edward> dbaupp: i'm getting a weird unreachable pattern error while matching on an enum
[14:47:09] <dbaupp> mark_edward: code?
[14:47:14] <mark_edward> it makes no sense, i can only have one arm for one variant, if i add any others it says unreachable
[14:47:17] <mark_edward> dbaupp: sure
[14:49:11] <mark_edward> dbaupp: https://github.com/MarkJr94/RustActors/blob/master/director.rs#L53-L69
[14:49:28] <mark_edward> dbaupp: i get director.rs:63:20: 63:23 error: unreachable pattern
[14:49:28] <mark_edward> director.rs:63                     Die => {
[14:49:28] <mark_edward>                                    ^~~
[14:49:28] <mark_edward> director.rs:67:20: 67:21 error: unreachable pattern
[14:49:28] <mark_edward> director.rs:67                     _ => { act.exec(&msg); }
[14:49:29] <mark_edward>                                    ^
[14:49:53] <dbaupp> mark_edward: Noop isn't a variant of the enum
[14:50:03] <dbaupp> (where is it defined?)
[14:50:25] <mark_edward> dbaupp: https://github.com/MarkJr94/RustActors/blob/master/message.rs#L2-L16
[14:50:30] <dbaupp> mark_edward: oh, it is
[14:50:42] <dbaupp> mark_edward: well, then, you need to import the variants
[14:51:27] <kimundi> mark_edward: Why do you need more arms for one varient?
[14:51:44] <mark_edward> kimundi: what do you mean?
[14:52:17] <dbaupp> mark_edward: what's currently happening is the 'Noop' in the first arm doesn't match any static constant or enum/struct name, so it is just a variable name
[14:52:35] <mark_edward> dbaupp: ah, i see! that's a confusing error
[14:52:37] <dbaupp> mark_edward: i.e. it matches everything, same as `match 10 { a => a + 1 }`
[14:53:06] <dbaupp> mark_edward: yeah, it is
[14:53:13] <kimundi> mark_edward: Ah I had this error too :)
[14:53:31] <mark_edward> thanks for the help guys! invaluable as always
[14:53:52] <bstrie> is there an issue filed for the huge regression shown on isrustfastyet?
[14:54:16] <dbaupp> bstrie: the memory one?
[14:54:22] <bstrie> yeah
[14:54:22] <mark_edward> why is a task exiting reported as failure?
[14:54:24] <bstrie> from a while ago
[14:54:44] <dbaupp> bstrie: https://github.com/mozilla/rust/pull/7644
[14:55:05] <dbaupp> bstrie: so ... not really?
[14:55:14] <bstrie> well as long as that fixes it
[14:55:21] <bstrie> just wanted to make sure it was documented somewhere
[14:55:24] <bstrie> why is that failing?
[14:55:30] <dbaupp> no idea
[14:55:57] <dbaupp> I can't remember why the previous ones failed
[14:56:17] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[14:56:44] <dbaupp> have to wait until aatch shows up, I guess.
[14:58:46] *** Joins: sankha93 (Instantbir@E7C34868.9EE147E0.25B273F5.IP)
[15:00:02] <pnkfelix> does anyone know offhand what incantation, if any, will attempt to compile+run the doc snippets embedded in rust.md and the tutorials ?
[15:01:51] <pnkfelix> ah, I think i found it
[15:02:12] *** Joins: frogmella (Mibbit@A9949C7D.CA13F84.F35DA1C6.IP)
[15:02:30] <bstrie> try "rustc --klaatu-barata-nikto
[15:03:14] <kimundi> doesn't that just summon evil!nmatsakis ?
[15:03:51] <bstrie> only one way to find out
[15:03:52] <nmatsakis> pnkfelix: make check-doc or something like htat
[15:03:58] <nmatsakis> pnkfelix: check mk/tests.mk
[15:04:02] <nmatsakis> pnkfelix: or rather check-stage2-doc
[15:04:17] <nmatsakis> pnkfelix: but I think that's just rust.md, you probably need check-stage2-tutorial?
[15:04:27] <pnkfelix> nmatsakis: that's okay, rust.md will cover my needs for now
[15:04:45] <pnkfelix> considering how much grunging I've done in the Makefile, you'd think I'd know this
[15:05:00] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[15:05:16] <nmatsakis> pnkfelix: it is non-trivial to extract the names of the targets from the makefile :)
[15:05:29] <pnkfelix> nmatsakis: yeah, GNU remake can help with that a litlte
[15:05:38] <nmatsakis> not familiar with that
[15:05:44] <pnkfelix> nmatsakis: but the fact that we generate the names dynamically means that its still tricky
[15:05:50] <pnkfelix> nmatsakis: its vital for Make debugging
[15:06:01] <pnkfelix> nmatsakis: http://bashdb.sourceforge.net/remake/
[15:06:30] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[15:06:48] <nmatsakis> interesting
[15:06:54] *** Joins: mreedell (mreedell@moz-CA456699.hsd1.vt.comcast.net)
[15:10:04] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[15:11:47] *** Joins: victorporof (victorporo@8255EF0D.E934E1A1.4A6B528C.IP)
[15:11:53] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[15:11:53] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[15:13:04] *** Joins: victorporof_ (victorporo@8255EF0D.E934E1A1.4A6B528C.IP)
[15:14:23] *** Quits: victorporof (victorporo@8255EF0D.E934E1A1.4A6B528C.IP) (Ping timeout)
[15:15:35] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[15:16:08] <pnkfelix> nmatsakis: this seems to work, but its way uglier than what you suggested: make check-stage2-T-x86_64-apple-darwin-H-x86_64-apple-darwin-doc-exec
[15:16:19] <nmatsakis> pnkfelix: that is the fully explicit form,
[15:16:23] <nmatsakis> pnkfelix: but there is a shorter form.
[15:16:34] <pnkfelix> nmatsakis: yeah I just have failed to find the shorter form
[15:17:03] <dbaupp> https://github.com/mozilla/rust/pull/7822 r?
[15:17:46] *** Quits: jasom_ (aidenn@moz-5F6FC7B3.sb.sd.cox.net) (Ping timeout)
[15:18:13] <nmatsakis> dbaupp: does that modify the makefiles too?
[15:18:22] <nmatsakis> dbaupp: in particular the configure script?
[15:18:30] <dbaupp> nmatsakis: for --enable-debug?
[15:18:31] <nmatsakis> doesn't look like it
[15:18:34] <nmatsakis> but maybe I missed it
[15:18:35] <nmatsakis> yes
[15:18:47] <dbaupp> nmatsakis: enable-debug already sets --cfg debug
[15:18:52] <nmatsakis> oh, ok
[15:19:03] * dbaupp double checks
[15:19:23] *** Quits: mudpit (Mibbit@34B89D1F.D1AE8978.36AE428F.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[15:19:35] <nmatsakis> one new thing to learn for my configure incantation I guess
[15:20:00] <dbaupp> nmatsakis: https://github.com/mozilla/rust/blob/master/Makefile.in#L104
[15:20:04] <nmatsakis> the debug! compilation seems to have been in fact fairly cheap
[15:20:28] <nmatsakis> as one would hope
[15:20:29] <Seldaek> I realize we're past syntax changes mostly but has there been some thought given to having named arguments (as caller, like python)? or does that make not much sense given there are no optional args (also sad but so it goes)?
[15:21:15] <nmatsakis> pnkfelix: did you try check-stage2-doc?
[15:21:27] <pnkfelix> nmatsakis: yes, that did not work for me
[15:21:34] <nmatsakis> pnkfelix: huh. it's in the makefile, odd.
[15:22:01] <nmatsakis> Seldaek: those may come, but it's a post Rust 1.0 thing
[15:22:08] <pnkfelix> nmatsakis: let me look again
[15:22:09] *** Joins: jdm (jdm@92FB48CA.8B5E9DF.9A8C35B4.IP)
[15:22:17] <pnkfelix> nmatsakis: I only looked at Makefile.in and in the files in mk/*
[15:22:26] <nmatsakis> pnkfelix: it's in mk/tests.mk,
[15:22:29] <pnkfelix> nmatsakis: (and I thought I had tried running it)
[15:22:32] <nmatsakis> pnkfelix: but it's a generated target name
[15:22:36] <Seldaek> nmatsakis: alright thanks
[15:23:08] <pnkfelix> nmatsakis: hm, I'm just wrong, it does seem to do something
[15:23:15] *** Quits: rca (rca@60B6E135.54AF2F32.CFA7DC0F.IP) (Quit: WeeChat 0.4.1)
[15:23:26] <pnkfelix> nmatsakis: oh, I ran "make check-stage2-doc-exec" before
[15:23:57] <pnkfelix> nmatsakis: don't know where the heck I came up with that...
[15:25:40] <pnkfelix> nmatsakis: I see, I must have skimmed the file and seen the entires with "â€¦-doc-exec: â€¦"; I should have just trusted you
[15:28:52] *** Joins: Nawfel (Mibbit@808FF32F.824CB9F2.DFAB1F33.IP)
[15:29:43] *** Joins: jasom (aidenn@moz-5F6FC7B3.sb.sd.cox.net)
[15:30:14] *** Joins: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[15:30:18] <Nawfel> hello, are cycles containing RC<T> prevented by the type system?
[15:31:32] <dbaupp> Nawfel: yes
[15:32:04] <kimundi> At the moment at least. 
[15:32:14] *** Joins: nano (nano@moz-972880B.superkabel.de)
[15:32:41] <Nawfel> must T be immutable ?
[15:34:10] <dbaupp> Nawfel: yeah, T has to be either Send or Freeze
[15:34:10] <kimundi> T must either be Sendable or Freezable
[15:34:52] <Nawfel> does Const removed from the language ?
[15:35:03] <Nawfel> is Const ...
[15:35:08] <kimundi> Freeze F Const, it got renamed
[15:35:25] <dbaupp> (and Send used to be called Owned)
[15:37:18] <pnkfelix> Nit-picky grammatical-type bike shed: What do you call the direct object to which an attribute applies?  The manual currently always uses the phrasing "an attribute applies to an entity"; I want to know what word to use to refer to that entity.  So far I have the ugly phrase "The entity to which the attribute applies."
[15:37:43] <bstrie> pnkfelix: don't attributes always apply to items?
[15:37:50] <kimundi> items + struct fields?
[15:38:08] <dbaupp> and methods
[15:38:24] <pnkfelix> bstrie: no, the manual says its more general: static entity == crates, modules, and items
[15:38:37] <dbaupp> (although with associated items, all items might be allowed in traits/impls.)
[15:38:38] *** Joins: eholk (eholk@moz-E3082F2B.uconnect.utah.edu)
[15:38:49] <pnkfelix> but my question is arguably about english, or at least technical documentation, and not about Rust itself
[15:38:51] <kimundi> isn't crate==module==item?
[15:39:05] <dbaupp> kimundi: mod = item, crate is separate
[15:39:07] <kimundi> at least syntactically
[15:39:39] <kimundi> isn't a crate juost the toplevel module?
[15:39:54] <doomlord_> constructing an AST node for a function call - expr_call(@expr, ~[@expr]) ... i'm assuming the first is the function to call. How do i create a node to reference a function, i can't see an 'expr_identifier' or something
[15:40:48] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[15:41:21] <kimundi> not all modules are crates, not all items are modules, but all items can have attributes - correct?
[15:41:32] <dbaupp> doomlord_: expr_path, otoh
[15:41:43] <dbaupp> doomlord_: are you writing a syntax extension?
[15:41:50] <doomlord_> 'path' being an 'identifier path' .. ok
[15:41:59] <dbaupp> doomlord_: essentially yes.
[15:42:09] <doomlord_> dbaupp - i'm having a bash at adding some rudimentry C++ support to rust-bindgen
[15:42:10] <Nawfel> please, where can i find documentation about Freeze?
[15:42:28] <doomlord_> i'm making an "impl" to call c++ methods that call their C wrappers
[15:42:30] <dbaupp> doomlord_: (if you haven't seen it already, syntax::ext::build::AstBuilder has a pile of helpers.)
[15:42:38] <kimundi> Nawfel: In this channel :P The docs are mostly crappy atm
[15:43:03] <doomlord_> ok
[15:43:04] <dbaupp> Nawfel: http://static.rust-lang.org/doc/std/kinds.html
[15:43:53] <kimundi> Nawfel: Freeze means that the type is deeply immutable if put into an immutable location. It exists because some types are not completly immutable even if put in such a location
[15:44:32] <Nawfel> ok
[15:44:55] *** Quits: mreedell (mreedell@moz-CA456699.hsd1.vt.comcast.net) (Quit: Computer has gone to sleep.)
[15:44:55] <pnkfelix> kimundi: my interpretation of the manual is that any crate and item can have an attribute applied to it; that's how I read its introduction of the term "static entity" in the attributes section of the manual
[15:45:56] <kimundi> pnkfelix: Sure, all I'm saying is that that is reducible to "any item can have attributes applied to them"
[15:45:59] <Nawfel> i don't understand how can we construct RcMut object from Freeze, isn't RcMut for mutable data ?
[15:46:06] <pnkfelix> kimundi: not if crates are not items
[15:46:19] <dbaupp> pnkfelix: (don't forget struct fields, enum variants and trait/impl methods)
[15:46:21] <kimundi> what IS a crate?
[15:46:34] <pnkfelix> kimundi: I don't know, I'm just going with what the manual says here
[15:46:39] <kimundi> As far as I know it's just the toplevel module
[15:46:44] *** Quits: frogmella (Mibbit@A9949C7D.CA13F84.F35DA1C6.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[15:47:04] <pnkfelix> dbaupp:  you make a good point, maybe the point should be actually define what static entities are, and make them include those substructural entities as well
[15:47:11] <dbaupp> pnkfelix: and view items
[15:47:18] * dbaupp is reading ast.rs
[15:47:36] <dbaupp> and extern mod's
[15:47:40] <dbaupp> (that's all)
[15:47:59] <pnkfelix> dbaupp: You can attach attributes to particular view_items ?
[15:48:13] <dbaupp> pnkfelix: yeah, e.g. #[cfg(test)] use foo;
[15:48:19] <pnkfelix> dbaupp: ah, true
[15:48:41] <pnkfelix> dbaupp: but a view_item â€¦ is a kind of item...
[15:49:05] <dbaupp> kimundi: the ast represents the crate as struct crate { attributes, mod } essentially
[15:49:25] <dbaupp> pnkfelix: and extern mod's are "foreign_items"
[15:49:36] *** Joins: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net)
[15:50:03] <dbaupp> pnkfelix: (although items and {foreign,view}_items are entirely distinct in the ast.)
[15:50:16] <pnkfelix> don't get me wrong, I have no immediate objection to trying to reduce this text down to "attributes apply to items" (though that still does not answer my original question about English)
[15:50:41] <pnkfelix> I'm just trying to avoid injecting errors in the midst of this doc addition I'm doing.  I can work on a rewrite of that other part later.
[15:50:49] <dbaupp> "attributal item" or something?
[15:50:57] * dbaupp thinks that sounds stupid
[15:51:17] <dbaupp> "attributable"
[15:52:03] <dbaupp> cmr: ping
[15:52:12] *** Quits: Nawfel (Mibbit@808FF32F.824CB9F2.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[15:52:26] <pnkfelix> "The attributed entity blah blah"
[15:52:40] <pnkfelix> that's not much better than "The applicand blah blah"
[15:52:56] <dbaupp> at least it's clear we're talking about attributes?
[15:53:24] <pnkfelix> The sentence in question is
[15:53:31] <pnkfelix> "A lint check names a potentially undesirable coding pattern, such as omitting documentation or unreachable code, for the static entity to which the attribute applies."
[15:53:33] *** Joins: graydon (Adium@A5087023.2354C43D.D8E68FF6.IP)
[15:53:33] *** ChanServ sets mode: +qo graydon graydon
[15:54:13] <pnkfelix> I want to get rid of that ugliness at the end, and get something succinct, like "â€¦, for the attributed item."
[15:54:16] <pnkfelix> Maybe that's not so bad.
[15:54:44] <pnkfelix> or rather, "for the attributed entity.", for consistency with the current usage of the term "entity", for better or for worse
[15:55:42] <pnkfelix> The verb "tag" seems like it could be applied here.  Attributes tag entities.  (Or attributes tag items, if you prefer.)  Then I could say "â€¦, for the tagged entity."
[15:55:56] <jdm> any new information about snapshotting?
[15:56:05] <graydon> https://etherpad.mozilla.org/Meeting-weekly-2013-07-16
[15:56:05] * dbaupp prefers "entity"
[15:56:07] <jdm> I'm trying to decide whether to wait to merge mw's debuginfo changes
[15:56:11] <graydon> jdm: are we blocked / awaiting snap?
[15:56:34] <jdm> graydon: there's a relatively large stage0/!stage0 code duplication in the PR right now
[15:56:49] *** Joins: Nawfel (Mibbit@808FF32F.824CB9F2.DFAB1F33.IP)
[15:57:06] <jdm> so if we believe we'll be snapshotting in the next day or two, I'd hold off merging
[15:57:11] <jdm> otherwise I'd just suck it up
[15:58:34] *** Joins: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net)
[15:58:59] <graydon> I see. we can certainly snapshot, I've no objection.
[15:59:10] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[15:59:17] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[15:59:43] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[15:59:59] *** Joins: pnathan (Adium@B9840254.2CD8A5F8.477B877D.IP)
[16:00:02] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Connection reset by peer)
[16:00:05] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[16:00:45] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[16:01:43] *** Joins: mark_edward_mobile (AndChat437@moz-43E149D0.dynamic.utc.edu)
[16:02:09] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[16:02:23] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[16:02:27] <pnkfelix> before snapshotting, should we first try to land that fix for the memory regression ?
[16:02:35] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[16:02:35] <ghrust> 01[13rust01] 15graydon 04force-pushed 06try from 14b806dd0 to 1481f8789: 02http://git.io/k471pw
[16:02:35] <ghrust> 13rust/06try 14d3a6bd4 15Graydon Hoare: extra: add tests for test::MetricMap, MetricDiff, ratchet.
[16:02:35] <ghrust> 13rust/06try 145612823 15Graydon Hoare: extra: Add metrics functions to test.
[16:02:36] <ghrust> 13rust/06try 142405482 15Graydon Hoare: compiletest: Add support for metrics and ratchet modes.
[16:02:37] <smvv> just out of curiosity: how hard is it to revert to a previous snapshot? let's say a snapshot produces invalid output, then I would assume that a checkout of a working commit would fix it. Or is the snapshot only related to windows because windows requires an installer?
[16:02:39] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[16:02:39] <graydon> oh, is there a fix in the queue?
[16:02:55] <pnkfelix> graydon: https://github.com/mozilla/rust/pull/7644
[16:03:11] <graydon> smvv: we just go back to a previous one. the old ones persist, as do all the old snapshot IDs and git trees that point to them.
[16:03:57] <graydon> smvv: the only problem would occur if we only noticed badness in a snapshot after the enclosing host environments (build operating systems and toolchains) had advanced to the point where they could no longer execute old snapshots
[16:04:13] <graydon> old snapshots do eventually bitrot relative to the current environment. but very slowly.
[16:04:20] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[16:04:34] <smvv> i see. that makes sense
[16:04:51] <graydon> https://etherpad.mozilla.org/Meeting-weekly-2013-07-16
[16:05:06] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[16:05:40] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[16:06:00] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[16:06:00] *** ChanServ sets mode: +o tjc
[16:06:23] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[16:06:29] <mark_edward_mobile> Graydon is reference counted
[16:07:19] *** Joins: cowboyd (cowboyd@moz-1BD02A1E.sw.biz.rr.com)
[16:08:11] <doomlord_> is |&x| the same as infering |x:&T|, or does it mean something else
[16:08:55] <jack> it destructures, putting a T in x instead of an &T
[16:10:00] <dbaupp> doomlord_: it's the same as `|tmp| { let x = *tmp; ... }`
[16:10:15] <doomlord_> thanks
[16:12:05] <jdm> what the deuce
[16:12:15] <jdm> the commit I see in git log is not what's ending up on github when I push
[16:12:32] <bstrie> jdm: github orders commits terribly, is that the culprit?
[16:12:54] *** Quits: eholk (eholk@moz-E3082F2B.uconnect.utah.edu) (Quit: eholk)
[16:12:55] <jdm> bstrie: no, there is only one commit
[16:13:17] <jdm> bstrie: and the one on github is an older version of the one I have locally
[16:13:27] <jdm> doesn't matter how often I delete the remote branch and push the local one
[16:13:35] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[16:14:01] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[16:14:04] <graydon> jdm: different remote?
[16:14:21] <jdm> graydon: good idea, but I don't think so.
[16:14:27] <jdm> I'm pushing to my jdm repo
[16:14:45] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[16:15:08] *** Quits: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[16:15:39] <jdm> yeah, definitely right remote
[16:15:50] <jdm> I deleted the remote branch and github doesn't show it
[16:17:13] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[16:17:16] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[16:19:00] *** Quits: mark_edward_mobile (AndChat437@moz-43E149D0.dynamic.utc.edu) (Ping timeout)
[16:19:28] *** Joins: mark_edward_mobile (AndChat437@moz-43E149D0.dynamic.utc.edu)
[16:20:39] *** Quits: eevee (eevee@moz-58058235.evrt.wa.frontiernet.net) (Ping timeout)
[16:20:52] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Ping timeout)
[16:21:25] *** Quits: glinscott (garylinsco@789A6618.53EB7C1.FFFE3AA.IP) (Quit: glinscott)
[16:21:29] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[16:21:43] *** Joins: glinscott (garylinsco@789A6618.53EB7C1.FFFE3AA.IP)
[16:25:01] *** Joins: eevee (eevee@moz-58058235.evrt.wa.frontiernet.net)
[16:25:31] *** Joins: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com)
[16:25:31] *** ChanServ sets mode: +o pcwalton
[16:25:51] <pcwalton> ok, I have something to discuss
[16:26:21] *** Joins: seth (seth@moz-42C5FAA8.nc.res.rr.com)
[16:26:28] <graydon> pcwalton: ?
[16:26:43] <pcwalton> this PR: https://github.com/mozilla/rust/pull/7822 is the core team OK with this?
[16:27:02] <graydon> oh yeah, we did actually briefly discuss that in the meeting, didn't mention in minutes. I'll write it down.
[16:27:05] <pcwalton> I personally requested it because I think it's more in line with what other people do and I see lots of logging stuff
[16:27:13] <pcwalton> what other projects do
[16:27:25] <pcwalton> I see lots of logging stuff in the disassembly and format strings make a lot of IR
[16:27:39] <graydon> short form: I think it's fine, niko uses debug! a lot but is fine with --enable-debug
[16:27:48] <graydon> nobody had any major objections
[16:28:09] <dbaupp> (don't r+ it yet btw, I broke all the rustdoc tests :'( )
[16:28:28] <pcwalton> dbaupp: ok
[16:28:43] <pcwalton> ok, great
[16:28:54] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[16:29:13] <pcwalton> my rationale is that we have info!() if you want something to be present in release as well
[16:29:19] <pcwalton> and nobody uses info!() right now
[16:29:23] <pcwalton> this seems like a good use case
[16:30:12] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[16:31:05] *** Quits: Nawfel (Mibbit@808FF32F.824CB9F2.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[16:31:30] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[16:31:30] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/JZyB2w
[16:31:30] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[16:31:35] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[16:31:35] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/qjfHIg
[16:31:35] <ghrust> 13rust/06auto 149ba32f3 15OGINO Masanori: Update the ordering algorithm to semver 2.0.0....
[16:31:35] <ghrust> 13rust/06auto 1431d29d3 15OGINO Masanori: Add more tests for build metadata.
[16:31:35] <ghrust> 13rust/06auto 14a317584 15bors: auto merge of #7726 : omasanori/rust/semver-2.0.0, r=graydon...
[16:31:37] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[16:32:05] *** Quits: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com) (Ping timeout)
[16:32:06] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[16:32:45] *** Quits: mark_edward_mobile (AndChat437@moz-43E149D0.dynamic.utc.edu) (Ping timeout)
[16:32:49] <graydon> pcwalton: yeah. even as it is, I think nobody uses warn! and even error! is rare
[16:33:03] <pcwalton> I use both in Servo sometimes
[16:33:08] <graydon> ok
[16:33:35] *** Quits: SimonSapin (simon@88F51059.F3BBB17D.144F44FA.IP) (Quit: Leaving.)
[16:33:57] *** Joins: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com)
[16:33:57] *** Joins: SimonSapin (simon@88F51059.F3BBB17D.144F44FA.IP)
[16:34:05] *** Joins: mark_edward_mobile (AndChat437@moz-43E149D0.dynamic.utc.edu)
[16:35:10] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[16:35:41] *** Joins: eholk (eholk@moz-E3082F2B.uconnect.utah.edu)
[16:35:51] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[16:35:55] <bstrie> if error! is rarely used, perhaps that's a good data point for https://github.com/mozilla/rust/issues/7386
[16:36:15] <dbaupp> graydon: I deleted your r+... I'm running around fixing tests now :)
[16:36:26] <graydon> dbaupp: oh, on which one?
[16:36:36] *** Quits: devinus (devinus@DAEC7122.372FE49C.29F95E0F.IP) (Quit: Computer has gone to sleep.)
[16:36:44] <dbaupp> graydon: https://github.com/huonw/rust/commit/aaf42a3659d099af26de51e7140fa95e0389c11c
[16:36:51] *** Joins: devinus (devinus@DAEC7122.372FE49C.29F95E0F.IP)
[16:38:06] <toddaaro> anyone who knows details of the old runtime internals around?
[16:38:39] <bblum> me
[16:38:45] <bblum> depends on the part
[16:38:50] <toddaaro> I can't figure out what context()
[16:38:56] <toddaaro> the implementation is a single assert statement?
[16:39:04] <toddaaro> or at least the only one I could find is
[16:39:11] <toddaaro> in rt/arch/*/context.cpp
[16:39:26] *** ozten is now known as ozten|afk
[16:39:36] <toddaaro> and the stacktrace doesn't show assert, it shows exists
[16:41:06] <bblum> odd, that context() looks like dead-code
[16:41:47] <bblum> what is exists
[16:41:53] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[16:42:05] <toddaaro> I think it is just part of local::borrow
[16:42:17] <toddaaro> so the stacktrace is direct context -> borrow failure
[16:42:25] *** abacus is now known as [a]bacus
[16:42:37] <toddaaro> shouldn't context() be off the stack when f() is evaluated?
[16:42:57] <bblum> yes, what is f()
[16:43:06] <bblum> uh
[16:43:19] <bblum> are you sure you don't mean libstd::rt::context 
[16:43:22] <toddaaro> the provided function way back up in the work_queue, which is actually doing the enqueue
[16:43:42] *** Quits: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com) (Ping timeout)
[16:43:47] <bblum> libstd/rt/mod.rs
[16:43:49] <bblum> fn context
[16:44:14] <toddaaro> ah that looks more like it
[16:44:39] <toddaaro> "use rt::context" is... not enough information
[16:44:44] *** Quits: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net) (Ping timeout)
[16:44:49] <toddaaro> when you have multiple rt::context definitions
[16:45:29] *** Quits: mark_edward (quassel@moz-4A9A2F15.dynamic.utc.edu) (Ping timeout)
[16:45:39] *** Joins: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com)
[16:46:54] *** Quits: mark_edward_mobile (AndChat437@moz-43E149D0.dynamic.utc.edu) (Ping timeout)
[16:47:01] *** Joins: mark_edward_mobile (AndChat437@moz-43E149D0.dynamic.utc.edu)
[16:47:41] *** Joins: AndChat|437241 (AndChat437@4BAAAAC6.44661D26.3F5355D8.IP)
[16:47:59] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[16:48:10] <bblum> the rt/rt thing is a problem
[16:48:56] <bblum> toddaaro: i wonder if you could fix the atomically problem by editing context() to work even if the task or sched is already borrowed
[16:48:57] *** Quits: mark_edward_mobile (AndChat437@moz-43E149D0.dynamic.utc.edu) (Ping timeout)
[16:49:17] <toddaaro> so I just tried commenting out the whole method, except the check to see if it is the old type
[16:49:21] <toddaaro> and it worked
[16:49:40] <toddaaro> there are two types, and you check if you are old, if not, you must be new
[16:49:47] <bblum> hold on, it looks like it should work
[16:49:51] <bblum> it does a local exists check
[16:49:57] *** Quits: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com) (Ping timeout)
[16:50:53] <bblum> and it should return global context just fine
[16:51:03] <toddaaro> really
[16:51:05] <toddaaro> hm
[16:51:50] *** Joins: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com)
[16:52:37] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[16:52:57] *** Quits: doener (bs@moz-AA189A5A.unitymedia.biz) (Quit: leaving)
[16:53:16] <bblum> oh wait, i bet i know what the problem is
[16:53:28] <bblum> you changed it so the scheduler is inside the task, right, and not the other way around?
[16:53:34] <toddaaro> yea
[16:53:37] <toddaaro> is exists just wrong
[16:53:47] <toddaaro> that could be it, I wasn't paying a huge amount of attention to the port
[16:53:57] <bblum> and so whenever you Local::borrow Scheduler, that is implemented by first borrowing task
[16:54:07] <toddaaro> (nothing uses exists)
[16:54:16] <bblum> whereas before you, it was Local::borrow Task that first  borrowed scheduler?
[16:54:27] <toddaaro> yes
[16:54:32] <bblum> :P
[16:54:40] <toddaaro> so exists *should* be swapped, but it might be borked
[16:54:54] *** Quits: AndChat|437241 (AndChat437@4BAAAAC6.44661D26.3F5355D8.IP) (Ping timeout)
[16:54:55] <toddaaro> my code is on my github page in the tls branch if you want to take a look
[16:55:00] <toddaaro> in all the "does not compile" glory
[16:55:11] <bblum> no, i know exactly what the fix should be
[16:55:33] *** Joins: mark_edward_mobile (AndChat437@moz-4A5B1251.wisolt4.epbfi.com)
[16:55:38] <doomlord_> in syntax, is the name of the string of a variable called an 'identifier' or a 'symbol'.. or what
[16:55:42] <doomlord_> ^best called..
[16:55:46] <bblum> identifier
[16:58:08] *** Quits: mark_edward_mobile (AndChat437@moz-4A5B1251.wisolt4.epbfi.com) (Ping timeout)
[16:58:26] *** Joins: mark_edward_mobile (AndChat437@moz-4A5B1251.wisolt4.epbfi.com)
[16:58:40] *** Joins: mark_edward (quassel@moz-4A5B1251.wisolt4.epbfi.com)
[17:00:30] *** ozten|afk is now known as ozten
[17:00:52] *** Quits: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk) (Client exited)
[17:01:04] *** Quits: novabyte (Instantbir@moz-3E0F9699.cable.virginmedia.com) (Quit: bye bye)
[17:04:09] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[17:06:01] *** Joins: Nawfel (Mibbit@808FF32F.824CB9F2.DFAB1F33.IP)
[17:08:36] *** Joins: bnicholson (bnicholson@moz-BBE3ABD.mv.mozilla.com)
[17:08:47] *** Joins: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net)
[17:08:48] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[17:08:49] *** Quits: mark_edward_mobile (AndChat437@moz-4A5B1251.wisolt4.epbfi.com) (Quit: Bye)
[17:09:03] *** Quits: dew (Instantbir@moz-2C6F2E2.dhcp.stls.mo.charter.com) (Ping timeout)
[17:09:16] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[17:10:08] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[17:11:00] *** Quits: bnicholson (bnicholson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[17:13:20] *** Joins: azakai (alon@moz-BBE3ABD.mv.mozilla.com)
[17:13:25] <doomlord_> Some progress with my cpp extention to rust bind gen ...
[17:13:44] *** Joins: radekm (Mibbit@moz-82A37B48.net.upcbroadband.cz)
[17:13:45] <bstrie> doomlord_: what are you trying to add?
[17:13:58] <doomlord_> http://pastebin.com/ta0yhqKs   <<<  from code here https://github.com/dobkeratops/rust-bindgen
[17:13:59] *** Quits: devinus (devinus@DAEC7122.372FE49C.29F95E0F.IP) (Quit: Computer has gone to sleep.)
[17:14:01] *** Joins: bnicholson (bnicholson@moz-BBE3ABD.mv.mozilla.com)
[17:14:05] <doomlord_> impls for methods
[17:14:35] *** Quits: sk (sk@A298A44C.54A580E3.78DD174B.IP) (Input/output error)
[17:15:05] <strcat> but how will it actually call them?
[17:15:06] *** Quits: radekm (Mibbit@moz-82A37B48.net.upcbroadband.cz) (Quit: http://www.mibbit.com ajax IRC Client)
[17:15:10] <doomlord_> I have a C++ sourcebase, i figure I can modify it to be friendly to whatever subset of cpp i can get in  'rust-bindgen' ...
[17:15:34] <strcat> different calling convention for methods
[17:15:52] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[17:15:57] <doomlord_> so now i need to make it emit a C++ source file that does the opposite calls,    Foo_getBaz(Foo* self, src) { return self->getBaz(src); }
[17:16:04] <kmc> aiui you basically need to write extern "C" wrappers if you want to call C++ from any other language
[17:16:12] *** Joins: devinus (devinus@DAEC7122.372FE49C.29F95E0F.IP)
[17:16:15] <doomlord_> right
[17:16:23] <kmc> on *some* platforms you can just call the mangled names as if they were C functions, but on other platforms the C++ method ABI differs
[17:16:38] <strcat> afaik it differs on linux
[17:16:43] <strcat> the way 'this' is passed
[17:16:54] <doomlord_> so i have to add one more step,     generating the extern "C" Foo_...(Foo* ) wrappers from my extention to rust-bindgen
[17:17:19] <doomlord_> right, name mangling differences is why i'm not counting on name mangling
[17:17:37] <strcat> you'd also have to stick to POD structs
[17:17:39] <strcat> in C++
[17:17:44] <dbaupp> graydon: https://github.com/mozilla/rust/pull/7822 is ready now. (the 2nd commit (e4f7561) are all the changes I just made.)
[17:17:46] <strcat> or you don't have a way to store them in rust
[17:18:07] <doomlord_> oh yes :) i realise there are many limitations. (my C++ code avoids virtuals)
[17:18:32] *** Quits: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com) (Ping timeout)
[17:19:08] <strcat> http://en.cppreference.com/w/cpp/types/is_pod
[17:19:11] <strcat> doomlord_: it's more than that
[17:19:13] <kmc> yeah for anything non-POD you would want to write accessors, I think
[17:19:31] <kmc> strcat: that's handy :)
[17:19:35] <strcat> kmc: but you also need PIMPL
[17:19:39] <doomlord_> isnt' the vtable the only real difference ?
[17:19:46] <strcat> rust can't store it on the stack
[17:19:49] <strcat> doomlord_: nop
[17:19:50] <strcat> e
[17:19:55] <kmc> what's PIMPL?
[17:20:01] *** Joins: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com)
[17:20:02] <strcat> kmc: pointer to implementation
[17:20:04] <strcat> like FILE *
[17:20:18] <strcat> you can never actually get one, and it's always malloc'ed
[17:20:26] <Nawfel> Hello, will Rust provide a niver way to borrow Rc, RcMut [and Gc... in the future], i think that     rc_obj.borrow().with_mut_ref || { ... }     is heavy
[17:20:33] <Nawfel> ?
[17:20:45] <strcat> Nawfel: definitely not RcMut
[17:20:46] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[17:20:48] <doomlord_> hmm,
[17:20:59] <strcat> Nawfel: and the @mut sugar for borrows could go away
[17:21:03] <strcat> because it can fail dynamically
[17:21:04] <doomlord_> why does struct 'B' not conform to POD
[17:21:09] <strcat> doomlord_: private field
[17:21:21] <strcat> private field means it no longer has to be laid out as a C struct
[17:21:27] *** Joins: doener (doener@moz-121949B3.unitymediagroup.de)
[17:21:29] <kmc> huh I did not know that
[17:21:51] <strcat> one thing it might actually do is reorder members how it pleases
[17:22:03] <doomlord_> that i did not know, but I can avoid 'private' in my code
[17:22:05] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[17:22:10] <doomlord_> any other gotchas ?
[17:22:19] *** Joins: hjr3 (hradtke@374E545A.3A8E9B0C.F9D9C60E.IP)
[17:22:20] <strcat> well just use is_pod ;p
[17:22:22] <strcat> it will tell you
[17:22:40] <strcat> if you want to have a rust struct definition representing it, that should evaluate to true
[17:22:43] <doomlord_> in some syntax situations a constructor seems to make it "non pod"
[17:23:02] <strcat> doomlord_: they have some rule about how trivial the constructor is
[17:23:09] <doomlord_> but i've always used C++ classes as simply "fancy structs" .. including constructors ... have i just been lucky with compilers :)
[17:23:12] <strcat> if you only use an initialization list it might not make it non-pod
[17:23:37] <strcat> doomlord_: well gcc/clang aren't very clever with this stuff yet
[17:23:44] <strcat> lots of it would involve changing the ABI
[17:23:53] <strcat> kind of like how they only default to -fshort-enums on newish platforms
[17:23:56] *** Quits: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP) (Input/output error)
[17:24:28] <doomlord_> i hope if they do start changing class layout there is some pragma that can be used to keep POD layout for the data-elements
[17:24:52] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[17:24:52] <ghrust> 01[13rust01] 15graydon 04force-pushed 06try from 1481f8789 to 148e58a27: 02http://git.io/k471pw
[17:24:52] <ghrust> 13rust/06try 1477823c9 15Graydon Hoare: extra: add tests for test::MetricMap, MetricDiff, ratchet.
[17:24:52] <ghrust> 13rust/06try 14f2f7fb3 15Graydon Hoare: extra: Add metrics functions to test.
[17:24:54] <ghrust> 13rust/06try 14bc4c89c 15Graydon Hoare: compiletest: Add support for metrics and ratchet modes.
[17:24:55] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[17:25:12] <Nawfel> strcat:  So, no sugar for Rc and Gc borrowing ? and is RcMut going to be removed ?
[17:25:13] <strcat> doomlord_: there's also http://en.cppreference.com/w/cpp/types/is_standard_layout but I don't know what it actually means in terms of layout guarantees
[17:25:28] <doomlord_> well I only expect I can bind to a tiny subset of C++ ... but working with my own sourcebases, i can stick to it :)
[17:25:34] <strcat> Nawfel: there isn't sugar for it right now but there likely will be
[17:25:44] <dbaupp> Nawfel: there will be sugar for immutable borrowing
[17:25:47] <strcat> but there won't be sugar for types unable to implement borrowing without dynamic checks
[17:25:50] <dbaupp> (hopefully)
[17:25:55] <strcat> dbaupp: and mutable borrowing on unique pointers
[17:26:06] *** Joins: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:26:14] <dbaupp> strcat: will that move to a library?
[17:26:29] <strcat> dbaupp: well I mean library unique pointers
[17:26:35] <strcat> there are reasons you would have other unique ptr types
[17:26:35] <Nawfel> ok, i thought that RcMut is going to be removed
[17:26:36] <dbaupp> strcat: right.
[17:26:43] <strcat> you'd need one to interact with glib
[17:26:45] <doomlord_> my experience of C++ has often been "c with fancy structs" and has included manual re-ordering for alignment optimizations - its possible the console compilers were 'extra-friendly' to that specific use, and they had "__restrict" which i'm told isn't "standard c++"
[17:26:56] <strcat> Nawfel: RcMut and @mut both have dynamic failure cases on borrows
[17:27:13] *** Joins: engla (engla@moz-BFD53D48.selucle.dyn.perspektivbredband.net)
[17:27:18] <doomlord_> POD/Non-POD is an issue i've only really encountered what you can and can't do with syntax, r.e. construtors
[17:27:19] <strcat> they'd both be removed, if it was decided that isn't the way to solve it - but it hasn't been decided'
[17:28:01] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[17:28:10] <gps> I'm interested in chatting with someone about build system implications of rust, specifically as it relates to servo. i'm interested in dependencies, etc. who's a good person to track down?
[17:29:04] <strcat> doomlord_: for example they know a private field is inaccessible outside the compilation unit
[17:29:09] <strcat> so they can reorder fields
[17:29:14] <dbaupp> gps: tjc (aka catamorphism) is writing rustpkg (rust's build system), not sure if that's the sort of info you're looking for?
[17:29:28] *** Quits: CarpNet (ac@moz-FD24B77.sohonet.co.uk) (Quit: Leaving)
[17:29:46] <strcat> doomlord_: they likely can't reorder public ones, because it's part of the platform ABI (there needs to be some form of consistent ordering, whether or not it's the order you list them)
[17:29:51] <gps> dbaupp: I'm mostly interested in helping to ensure that the way Rust code is compiled facilitates reasonable building practices (e.g. reducing recompilation)
[17:30:06] <gps> some languages (e.g. scala) have made choices that don't scale well
[17:30:12] <doomlord_> I can make it spit out an error message if private is used perhaps
[17:30:25] <dbaupp> gps: https://github.com/mozilla/rust/issues/2369
[17:30:55] <strcat> doomlord_: or just add static_assert with is_pod
[17:30:55] <gps> that's nice!
[17:31:05] <doomlord_> perhaps some compiletime assert could be created to ensure the compiler is making POD layout
[17:31:45] <strcat> static_assert(std::is_pod<Foo>::value, "not pod");
[17:31:47] <doomlord_> ^POD compatible layout .. i realise this may not work with everything possible in the standard ... but every time i've used C++, precise C-like control over data-layuot was assumed
[17:32:10] <gps> since I am the build system module owner for Firefox, I would like to chat with someone eventually - just so I have a good idea what's going to happen when servo comes along
[17:32:32] <strcat> gps: there's #servo btw
[17:32:51] <gps> well, I figured this was more of a core language thing
[17:33:09] <gps> since i'm talking about the behavior of the compiler
[17:33:52] <dbaupp> gps: I guess graydon, tjc or pcwalton are the people to talk to. (But I don't really know.)
[17:34:04] <sp3d> the most problematic thing I can think of is crates being the unit of compilation; in most other respects Rust seems pretty similar to C w/r/t buildsystems (but I'm not an expert)
[17:35:01] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[17:35:38] <dbaupp> sp3d: in theory, you don't lose much by having many small crates (especially so when we have a decent build system), so it's probably not too much of a problem.
[17:35:50] <sp3d> right
[17:35:55] *** Joins: mschifer1 (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:36:00] *** Quits: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[17:36:19] *** Quits: mschifer1 (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[17:36:22] <dbaupp> (if you can break the project up into relatively independent components, that is.)
[17:36:22] *** Joins: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:36:29] <gps> ok. I just want to confirm some things and make sure the "infrastructure" is there on the Rust side before it causes a fire drill :)
[17:36:48] *** Quits: Nawfel (Mibbit@808FF32F.824CB9F2.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[17:36:51] <gps> I'll track down one of the people you mentioned
[17:37:27] <gps> thanks for the info!
[17:37:45] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[17:38:24] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[17:39:57] <jasom> rust: task failed at 'explicit failure', /export/jmiller/home/src/rust-0.7/src/librustc/rustc.rs:354
[17:40:07] *** Quits: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[17:40:09] *** Joins: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:40:11] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[17:40:23] *** Quits: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[17:40:44] *** Joins: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:42:45] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[17:42:57] * jasom can't figure out how to search github issues to see if its already been reported
[17:43:18] <bstrie> jasom: there's a generic search box at the top of the page
[17:43:25] *** Quits: dbaupp (Thunderbir@moz-712A1135.lns20.syd6.internode.on.net) (Ping timeout)
[17:43:29] <bstrie> do a search and then click on "issues" on the left
[17:43:35] <bstrie> yeah it's bad
[17:43:36] <strcat> and then click on open
[17:43:38] <strcat> ;p
[17:43:48] *** Quits: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com) (Ping timeout)
[17:44:02] <bstrie> github's combined search box is a case of minimalism gone too far
[17:44:35] <strcat> it's not minimalism ;p
[17:45:42] *** Joins: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com)
[17:46:00] <jasom> well that tells me that there are lots of bugs related to unexpected failure ICEs
[17:47:25] <kmc> if I want to enable RUSTRT_TRACK_ALLOCATIONS, I just edit memory_region.h before I build rust, right?
[17:47:29] <jedestep> cmr: ping
[17:48:24] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[17:49:18] *** Quits: sankha93 (Instantbir@E7C34868.9EE147E0.25B273F5.IP) (Ping timeout)
[17:49:23] <jasom> aha, it's this one: https://github.com/mozilla/rust/issues/3895
[17:49:51] <jasom> or not, since that's fixed; but the same assertion is failing
[17:49:53] *** Quits: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com) (Quit: pcwalton)
[17:53:19] <kmc> it's closed as a dup of #2869 which is closed as a dup of #3121 which is open: https://github.com/mozilla/rust/issues/3121
[17:53:24] *** Joins: MaikKlein1 (maik@moz-5867653C.dip0.t-ipconnect.de)
[17:54:26] *** Quits: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com) (Ping timeout)
[17:56:15] <bblum> c.c
[17:56:21] <bblum> ""// Need lazy init? Whatever. This code will be obsolete soon."
[17:56:23] *** Joins: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com)
[17:56:43] *** Quits: Azdle (Azdle@moz-B334B496.hfc.comcastbusiness.net) (Ping timeout)
[17:56:47] *** Joins: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com)
[17:58:02] <MaikKlein1> do we have lazy in rust?
[17:58:12] <bblum> if you write it yourself :P
[17:58:22] <MaikKlein1> no i am to lazy
[17:58:26] <MaikKlein1> too*
[17:58:36] <bblum> well that's gonna be a problem then
[17:58:40] <MaikKlein1> :(
[17:58:44] *** Joins: Azdle (Azdle@moz-B334B496.hfc.comcastbusiness.net)
[17:59:20] *** Joins: nawfel (Mibbit@808FF32F.824CB9F2.DFAB1F33.IP)
[18:00:34] *** Quits: mye (mye@moz-D545C334.dip0.t-ipconnect.de) (Quit: mye)
[18:03:19] *** Quits: SimonSapin (simon@88F51059.F3BBB17D.144F44FA.IP) (Ping timeout)
[18:03:29] <nawfel> rusti: once fn (x: int) -> int { x }
[18:03:30] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/gbLg
[18:04:54] <nawfel> rusti: once fn add(x: int) -> int { x }
[18:04:55] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/aSTC
[18:05:07] *** Joins: alisdair (textual@moz-EBE9F394.bchsia.telus.net)
[18:05:18] *** Joins: SimonSapin (simon@514D186.F3BBB17D.144F44FA.IP)
[18:05:53] <doener> yay, unoptimized builds like shrunken inlined intrinsics :-)
[18:06:04] <nawfel> rusti: fn id(x: int) -> int { x }
[18:06:05] -rusti- ()
[18:06:09] <bblum> nawfel: once only makes sense on closures, not on item functions
[18:06:11] <graydon> wow. these are _hopelessly_ noisy
[18:06:39] <graydon> test bitv::tests::bench_bitv_big_union ... bench: 3094 ns/iter (+/- 2038)
[18:06:49] <doener> woah
[18:06:50] <nawfel> thx bblum 
[18:06:51] *** Joins: sankha93 (Instantbir@C7CDA546.253678E8.27560D6E.IP)
[18:06:59] <graydon> on the buildbot. I mean .. makes some sense.
[18:07:10] <graydon> that's a heavily loaded machine.
[18:07:17] <strcat> doener: we have way too much #[inline] but...
[18:07:33] <strcat> we need it at -O because inlining can't happen at all without it, cross-crate
[18:07:41] <strcat> should really redo it
[18:08:21] <doener> strcat: shouldn't at least generic functions work without? They have their ast exported anyway
[18:08:41] <strcat> doener: generic functions will, yeah - at the moment
[18:08:47] <nawfel> fn so_things(f: &once fn (int) -> ()) -> () {  }
[18:08:54] <nawfel> rusti:  fn so_things(f: &once fn (int) -> ()) -> () {  }
[18:08:55] -rusti- <anon>:7:23: 7:24 warning: unused variable: `f` [-W unused-variable (default)]
[18:08:55] -rusti- <anon>:7           fn so_things(f: &once fn (int) -> ()) -> () {  }
[18:08:55] -rusti-                                 ^
[18:08:55] -rusti- ()
[18:08:59] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[18:09:00] <strcat> doener: our implementation of both inlining and generics is very sub-par
[18:09:18] <brendanc> graydon: are you running it a trillion times and taking the fastest?
[18:09:20] <strcat> doener: we should be able to export instantiations
[18:09:26] <graydon> brendanc: no
[18:09:39] <graydon> brendanc: "take the fastest" is ... plausible, I guess?
[18:09:41] <strcat> doener: and for inlining, we should be able to use available_externally to let LLVM choose *without* forcing inlining into the crate
[18:10:20] *** Quits: nawfel (Mibbit@808FF32F.824CB9F2.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[18:10:34] <doener> strcat: that aside, the intrinsics are mostly down to either just "ret $const" or "call ...; ret void", thus inlining actually reduces the code size, because they're called through a wrapper function anyway.
[18:10:39] <graydon> brendanc: it's difficult to do actually, because the loops are short. we have to calibrate a loop to run for a "reasonable amount of time" to get a real signal that's not timer-noise
[18:10:39] *** Joins: mib_pvemks (Mibbit@BBE7C46A.B4F11D08.8612FA94.IP)
[18:11:11] <graydon> brendanc: and once we've determined that .. well, we could take min, but at the moment we take median. possibly mode would be better, hmm
[18:11:17] <doener> I've made the llretptr for immediate values optional, so intrinsics don't need the allocas + branch anymore. 
[18:11:17] <brendanc> yes. I think you can still get rid of a lot of noise if you run the bigger loop and take the fastest
[18:11:32] <brendanc> the faster runs are always going to be more accurate than the slower ones right?
[18:11:45] <doener> also helps the optimizer to generate better code on some code paths
[18:11:50] <brendanc> anything slower than the fastest seems like it's definitionally inaccurate
[18:11:55] <doomlord_> was therer a way to make rustc compile and link c source itself.. i seem to remember seeing something like that but can't find it (in my own code , i was compiling a c library and bringing that in)
[18:12:07] *** Quits: SimonSapin (simon@514D186.F3BBB17D.144F44FA.IP) (Ping timeout)
[18:12:15] <graydon> brendanc: I talked to brian o sullivan about this and he ... got very angry when I suggested using minimums
[18:12:26] <brendanc> hmm
[18:12:36] <brendanc> he has spent a while on benchmarking
[18:12:45] <brendanc> but I wonder what he was angry about
[18:12:54] <graydon> I think he has a  bit of a point. if you have a benchmark that "sometimes" runs real fast but only when the moon lines up, it's pretty deceptive to say that it runs real fast
[18:13:01] <doener> strcat: it's just a small step towards direct inline translation of the intrinsics. We should get rid of the wrappers as well at some point
[18:13:11] <strcat> doener: yeah, that'd be nice
[18:13:11] <brendanc> I think it depends on the benchmark
[18:13:17] <strcat> doener: especially for ones like contains_managed ans size_of
[18:13:20] <kmc> bos wrote http://hackage.haskell.org/package/criterion which is really nice
[18:13:28] <strcat> doener: it'd be very nice if we didn't omit the branch for 'if false {}'
[18:13:31] <strcat> emit*
[18:13:43] <strcat> yet another meaning-flipping typo
[18:13:52] * strcat is good at making those
[18:13:54] * brendanc is tempted to pull bos out from behind this #mercurial movie poster
[18:14:01] *** Joins: echristo (echristo@moz-1892C634.hsd1.ca.comcast.net)
[18:14:13] <brendanc> for micro stuff I think fastest is pretty good
[18:14:18] <brendanc> maybe less fair for macro
[18:14:36] <brendanc> median is just throwing more noise into the result
[18:14:38] <graydon> brendanc: so .. there are 2 loops involved, there's a loop that does a "spin f() N times to get a time-per-f()-iteration count" loop
[18:14:39] <sp3d> seems like a question of determinism or not; for a deterministic test, fastest is the one with least environmental interference
[18:14:55] <doener> strcat: think we could replace some of the wrappers with a "pub use std::unstable::intrinsics::foo"?
[18:15:00] <strcat> I wonder how hard it would be to remove headers from stack closures
[18:15:06] <graydon> brendanc: then there's a "run that inner loop K times to get a bunch of samples that are per-iteration estimates for f(), and do some stats on them" loop
[18:15:06] <strcat> doener: we should
[18:15:23] <strcat> doener: another thing that would be nice is putting #[lang = "exchange_malloc"] directly on malloc_raw now
[18:15:31] *** Quits: jesse98 (jjones@6251EDC2.15651213.B46B86FA.IP) (Connection reset by peer)
[18:15:32] <kmc> sp3d: but almost nothing is deterministic to that standard
[18:15:33] <doener> ok, I'll try that next (the pub use thing)
[18:15:35] <engla> strcat: good job, it looks like a plain ~[] executes faster now. of course.
[18:15:40] <strcat> engla: :)
[18:15:43] <kmc> there are caches, OS memory management behavior, etc.
[18:15:43] <strcat> engla: and ~str, and ~T
[18:15:48] <strcat> engla: 32 bytes smaller
[18:15:50] <graydon> brendanc: calibrating N is a bit tricky. go doesn't even _bother_ with k, it just calibrates N to "1 second" and then reports a single sample.
[18:16:03] <strcat> anyway the stack closure headers always confuse me
[18:16:10] <strcat> they initialize refcount to 123456...
[18:16:11] <brendanc> wonder how go does on a loaded buildslave
[18:16:15] <graydon> brendanc: I have an outer loop that calibrates K and tries to get the signal good. on quiet machines it works ... reasonably well
[18:16:17] <kmc> if I make a change that increases the odds of a cache miss by 50%, but we filter the data with min to the cases where there was no cache miss, then my change looks fine
[18:16:19] <doener> hm, does rustdoc support documentation on external functions?
[18:16:28] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[18:16:28] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/qjfHIg
[18:16:28] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[18:16:34] <doener> or on "pub use"?
[18:16:47] *** Joins: bytbox (s@moz-A9059E76.wireless.umd.edu)
[18:16:56] <mib_pvemks> any tips for how to debug "pointer being freed was not allocated" errors?
[18:17:10] <brendanc> does K make a difference on microbenchmarks on an unloaded machine?
[18:17:21] *** Parts: LimeBurst (me@247D1419.D73964AC.27A8748.IP) ()
[18:17:36] <brendanc> wonder if go does as well under those conditions :)
[18:18:14] <graydon> brendanc: my initial impetus was to get per-benchmark steps that move along faster than 1s-per
[18:18:16] *** Quits: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP) (Connection reset by peer)
[18:18:20] *** Joins: LimeBurst (me@247D1419.D73964AC.27A8748.IP)
[18:18:26] <graydon> brendanc: also "some measure of the quality of the signal"
[18:18:30] <strcat> mib_pvemks: what code does it happen with?
[18:18:46] <graydon> brendanc: particularly since I want to use this as a performance ratchet (i.e. "no regressions" policy)
[18:19:20] *** Quits: MaikKlein1 (maik@moz-5867653C.dip0.t-ipconnect.de) (Ping timeout)
[18:19:21] <mib_pvemks> strcat: it's really complicated... I'm guessing something problematic with managed pointers but that's why I was wondering if there were any general tips
[18:19:22] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[18:19:22] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/NDy6pw
[18:19:22] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[18:19:24] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[18:19:24] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/D_Kqzw
[18:19:24] <ghrust> 13rust/06auto 14b48e37e 15Huon Wilson: syntax: make a macros-injection pass; conditionally define debug! to a noop based on cfg(debug)....
[18:19:24] <ghrust> 13rust/06auto 14e4f7561 15Huon Wilson: Clean-up tests after debug!/std-macros change....
[18:19:24] <ghrust> 13rust/06auto 14e252277 15Huon Wilson: rustc: handle allocas and LoadRangeAsserts in unreachable blocks correctly....
[18:19:26] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[18:19:42] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[18:19:45] <mib_pvemks> strcat since breaking at malloc_error_break doesn't really show much
[18:19:50] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[18:19:54] <strcat> mib_pvemks: valgrind?
[18:19:55] <graydon> brendanc: I know python's benchmark tool just takes the minimum, and argues eloquently that this is the right thing. but I .. don't know.
[18:20:14] <brendanc> well, I think it depends on the benchmark, but you can usually look at a micro bench and convince yourself that the fastest time is always going to be more correct
[18:20:26] <mib_pvemks> strcat: alright, I'd been using gdb but I'll try that, thanks
[18:20:31] <brendanc> so tuning is just giving yourself enough time to find the fastest time :)
[18:20:56] <graydon> hm. on the linux buildhost the numbers aren't noisy.
[18:20:59] <graydon> maybe it's just the mac.
[18:21:08] <graydon> test bitv::tests::bench_bitv_big_union ... bench: 1095 ns/iter (+/- 6)
[18:21:20] <graydon> that's more like I was seeing while I was doing development (on linux)
[18:21:35] <graydon> maybe the mac _timer_ is not very accurate?
[18:22:39] <strcat> https://github.com/mozilla/rust/commit/4797dd4087104246b5d5c2d3edf1623acfbc06e5#commitcomment-3646805 oh nice
[18:22:50] * strcat was just thinking about that
[18:23:10] <strcat> ideally it wouldn't be AST-based though
[18:23:39] *** Joins: jesse98 (jjones@6251EDC2.15651213.B46B86FA.IP)
[18:24:05] <strcat> graydon: how do you actually ask the OS for the time?
[18:24:16] <graydon> on OSX? lemme check
[18:24:42] *** Joins: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP)
[18:24:59] <graydon> it hits gettimeofday on OSX
[18:25:07] <graydon> clock_gettime(CLOCK_REALTIME) on linux
[18:25:09] <strcat> doesn't OS X have clock_gettime + clock_getres?
[18:25:15] <graydon> I should check
[18:25:45] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[18:25:46] <brendanc> http://stackoverflow.com/questions/11680461/monotonic-clock-on-osx
[18:25:56] <strcat> graydon: btw you should use CLOCK_MONOTONIC_RAW on linux
[18:26:04] <graydon> really?
[18:26:09] <strcat> CLOCK_REALTIME/CLOCK_MONOTONIC are affected by skew
[18:26:14] <strcat> and CLOCK_REALTIME by actual adjustments
[18:26:49] <graydon> oh, wait
[18:27:00] <graydon> on linux I should actually be using CLOCK_THREAD_CPUTIME_ID
[18:27:13] <strcat> ah I forgot about the other ones
[18:27:21] <strcat> graydon: might want to measure time in blocking calls too though
[18:27:27] <strcat> for I/O benchmarks
[18:27:44] <vladimir-lu> quick question - in macros when you have an ident, should it work with auto-dereferenced paths i.e. 'my.struct.field'?
[18:27:46] <mib_pvemks> strcat actually I'm on MacOS 10.8, and valgrind is experimental and mostly broken for that... any other tips? :P
[18:27:56] <graydon> hm
[18:27:58] <vladimir-lu> because currently it complains about the '.'s
[18:28:02] <strcat> mib_pvemks: a linux VM? ;p
[18:28:10] <mib_pvemks> aaaah I wish...
[18:28:14] <graydon> sounds like CLOCK_THREAD_CPUTIME_ID is also TSC so I'd need to pin it to a core. never mind.
[18:28:40] <mib_pvemks> OK nvm if there isn't a straightforward way, thanks anyway
[18:28:47] <brendanc> maybe turn off scaling at least during benchmarking?
[18:29:04] <strcat> graydon: they basically screwed up the CLOCK_MONOTONIC implementation by making it still use skew
[18:29:10] <strcat> so they had to add _RAW to keep compatibility
[18:29:11] <strcat> ;p
[18:29:30] <graydon> sigh
[18:29:33] <strcat> ntp speeds up or slows down the rate time advances and... it will affect your benchmarks with MONOTONIC alone
[18:29:39] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[18:29:40] <graydon> yeah
[18:29:55] <graydon> I keep thinking maybe I should figure out an API for pinning-to-a-core and use TSC
[18:31:50] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[18:32:08] *** Joins: Uther (Instantbir@moz-1B244B05.hfc.dyn.abo.bbox.fr)
[18:32:48] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[18:32:56] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[18:33:24] <brendanc> probably diminishing returns at some point. but replacing gettimeofday on osx might be a good idea
[18:33:37] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[18:33:53] <graydon> looks like I can set affinity on all platforms
[18:34:19] *** Quits: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP) (Ping timeout)
[18:34:22] <graydon> if so, and if TSC is actually fixed in recent chips to not get messed up by dynamic clock control, maybe I should go back to that
[18:34:52] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[18:34:55] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[18:35:39] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[18:35:39] <ghrust> 01[13rust01] 15graydon 04deleted 06codegen-compiletests at 1473de811: 02http://git.io/kVU7fQ
[18:35:39] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[18:35:43] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[18:36:00] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[18:36:19] *** Joins: MaikKlein1 (maik@moz-4C6F98CE.dip0.t-ipconnect.de)
[18:38:31] *** Joins: sinma (seb@moz-6A11C47C.fbx.proxad.net)
[18:38:37] <sinma> Hi
[18:38:53] <sinma> Since 0.7 I canâ€™t use io::println, I must use std::io::println
[18:39:04] <strcat> or just 'println'
[18:39:13] <sinma> How to come back to the old behavior? Itâ€™s with import or something like that
[18:39:20] <strcat> use std::io;
[18:39:31] <strcat> but for that specific function, it's already in scope
[18:39:34] <strcat> as just println
[18:39:38] <sinma> ok
[18:40:16] <sinma> And for int::for_str itâ€™s the same thing
[18:40:49] *** Quits: paulproteus (quassel@rose.makesad.us) (Ping timeout)
[18:42:25] *** Joins: cr (anonymous@moz-312F633D.dip0.t-ipconnect.de)
[18:42:56] *** Joins: paulproteus (quassel@moz-E86A3B42.makesad.us)
[18:44:16] *** Quits: MaikKlein1 (maik@moz-4C6F98CE.dip0.t-ipconnect.de) (Ping timeout)
[18:44:39] <graydon> do we have a special trick for calling llvm intrinsics directly these days, or do we just go through unstable::intrinics?
[18:45:03] <olsonjeffery> oh boy: http://www.quora.com/Computer-Programming/What-kind-of-programming-language-do-we-need-in-the-future
[18:46:45] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[18:48:02] <kmc> graydon: some of the clocks are based on TSC but the kernel (and the vDSO code) correct for the differences between cores, I believe
[18:48:03] <vladimir-lu> i can't actually get past the page because of its stupid sign-in rule
[18:48:13] <vladimir-lu> but you mean the "Sounds a lot like Go" comment? :P
[18:48:17] <doener> graydon: AFAIK it's the latter. I'm working on optimizing the code generated for those functions
[18:48:29] <kmc> http://www.quora.com/Computer-Programming/What-kind-of-programming-language-do-we-need-in-the-future?share=1
[18:48:54] <graydon> kmc: do you mean .. if I use the linux clock advertized as "implemented on top of TSC" it will correct for CPU migration?
[18:49:10] <graydon> kmc: I'm tempted to set affinity to a specific core during benchmarking anyways. much more stable numbers.
[18:49:22] <graydon> (and if I do that, I can just use llvm.readcyclecounter)
[18:50:10] <vladimir-lu> kmc: that's nice - will keep in mind
[18:52:34] *** Parts: sinma (seb@moz-6A11C47C.fbx.proxad.net) (Konversation terminated!)
[18:53:09] *** Quits: bytbox (s@moz-A9059E76.wireless.umd.edu) (Ping timeout)
[18:53:37] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[18:54:40] *** Joins: SimonSapin (simon@moz-D0C2F181.zone2.bethere.co.uk)
[18:55:05] *** Joins: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com)
[18:55:05] *** ChanServ sets mode: +o pcwalton
[18:56:01] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[18:56:01] *** Quits: nano (nano@moz-972880B.superkabel.de) (Connection reset by peer)
[18:57:08] *** Joins: nano (nano@moz-972880B.superkabel.de)
[18:58:40] <kmc> graydon: that's what I mean but I'm not certain it's true
[18:59:58] <bblum> hmm this line is too long
[19:00:04] <bblum> let ancestors = AncestorList(spawner_group.chain_ref(|group_ref| group_ref.ancestors.map(|x| x.clone())));
[19:01:08] <graydon> kmc: ok. I'll hook up the rdtsc and affinity support anyway. worth checking.
[19:01:37] *** Joins: StarLight (StarLight@moz-BF46EBCA.dynamic.avangarddsl.ru)
[19:01:50] <graydon> r? someone https://github.com/mozilla/rust/pull/7829
[19:01:54] <kmc> graydon: http://lxr.linux.no/#linux+v3.10/arch/x86/vdso/vclock_gettime.c#L193 it's reading a kernel-maintained data structure (gtod) and then applies an offset based on the TSC difference since the process was last scheduled
[19:02:17] <kmc> and that's protected by a seqlock in case the process is scheduled out during that calculation
[19:02:25] <graydon> kmc: huh, neat. so that should be pretty solid.
[19:02:40] <kmc> yeah
[19:02:47] <graydon> I wonder if TSC is worse after all. I mean, the downside of TSC is I have no idea how many nanoseconds a tick represents.
[19:02:50] <strcat> and it manages to do clock_gettime/gettimeofday without syscalls
[19:02:55] <strcat> yay vdso
[19:03:03] <kmc> of course on other kernels (and Linux platforms that don't have the vDSO) clock_gettime() will be a lot more expensive
[19:03:03] <strcat> it just exposes it in a read-only (from userland) page
[19:04:22] <kmc> anyway CPU is not a bad idea regardless, and it's easy on Linux (sched_setaffinity)
[19:05:30] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Ping timeout)
[19:06:02] *** Quits: _Vi (vi@527C345F.497AA854.B16B3BE6.IP) (Ping timeout)
[19:06:27] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[19:06:41] *** Joins: bytbox (s@moz-A9059E76.wireless.umd.edu)
[19:06:42] <graydon> it appears to be easy on all OSs
[19:06:58] <graydon> and RDTSC is surely faster than an FFI call. less risk of stack boundary cross too.
[19:08:02] <kmc> *nod*
[19:08:15] <kmc> I forgot that FFI calls are expensive in Rust :/
[19:08:19] *** Joins: Ms2ger (Ms2ger@54323780.629A11C5.3773EA9F.IP)
[19:09:08] <strcat> they shouldn't be ;p
[19:09:12] <strcat> sadly they are
[19:10:13] * strcat thinks we could at least get rid of __morestack almost everywhere
[19:10:25] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[19:10:29] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[19:10:29] *** ChanServ sets mode: +o dherman
[19:10:32] <strcat> need to deal with signals though and I get really really confused by signals
[19:11:09] <strcat> thread-safety + signals when you already have some other event loop running...
[19:11:33] *** Quits: sankha93 (Instantbir@C7CDA546.253678E8.27560D6E.IP) (Quit: He will be back!)
[19:12:14] <tikue> strcat: rust has signals?
[19:12:27] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[19:12:29] <strcat> well the OS has signals so in that sense rust has them ;p
[19:12:43] <tikue> strcat: hah but I mean, can you install signal handlers?
[19:12:47] <strcat> I don't think they're exposed in an API anywhere
[19:12:50] <tikue> strcat: without doing elaborate unsafe blocks
[19:12:52] <tikue> ah
[19:12:53] <strcat> they should be, libuv has signal handling
[19:13:25] <kmc> probably the right thing to do is install signal handlers which just feed events into libuv
[19:13:29] <strcat> but I'm thinking we could have a guard page or two, and teach LLVM to omit __morestack for frames smaller than the guards
[19:13:33] <kmc> probably libuv already has a capability to do this
[19:13:51] <strcat> and then handle growth based on hitting it
[19:14:01] <jdm> acrichto: that hello world you posted sure makes rust look attractive :P
[19:14:06] <strcat> kmc: well libuv will use signalfd on linux
[19:14:12] <kmc> the classic trick is to hold both ends of the pipe, have your signal handler write to the pipe, and then the IO event loop incorporates the read end
[19:14:18] <kmc> but yeah signalfd is a nicer solution on linux
[19:14:31] <strcat> it probably uses timerfd too for the timers
[19:14:34] <kmc> both ends of a pipe*
[19:15:13] <Uther> I have a question about separate compilation
[19:15:28] <Uther> I can produce object file with rust -c
[19:15:35] <pcwalton> #[deriving(Clone)]
[19:15:35] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[19:16:05] <Uther> But it seems rustc take only a single .rs file as input
[19:16:16] *** Joins: vodik_ (simon@moz-CBE4BB13.cable.teksavvy.com)
[19:16:18] <Uther> jow can i use them?
[19:16:30] <kmc> Uther: it can refer to other modules and they will be compiled together
[19:18:10] <kmc> the unit of separate compilation is a "crate", which can contain multiple files, and each file is a module but can also contain additional modules
[19:19:34] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Quit: WeeChat 0.4.2-dev)
[19:19:41] <kmc> each library crate will compile into a single .so and then you can use that from another crate with e.g.  extern mod foo;
[19:20:12] <kmc> rustc will go and find the .so; you don't need to pass something like cc -l, althougdh you might need -L for a search path
[19:20:19] *** Joins: MaikKlein1 (maik@moz-4C6F98CE.dip0.t-ipconnect.de)
[19:20:49] <Uther> ok, there is no way to use object files? I have to use dynamic libraries?
[19:20:57] <kmc> the module system needs better docs for sure, but take a look at http://static.rust-lang.org/doc/tutorial.html#modules-and-crates
[19:21:05] *** Quits: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net) (Ping timeout)
[19:21:06] <kmc> Uther: I'm not sure about that, sorry
[19:21:07] *** vodik_ is now known as vodik
[19:21:17] <pcwalton> you can statically link against .a libraries
[19:21:36] <pcwalton> there is not static linking for Rust crates yet
[19:21:56] <graydon> oh, I was reading the wrong stuff
[19:22:03] <Uther> so the -c option has no use yet?
[19:22:04] <graydon> we use mach_timebase_info
[19:22:05] <graydon> hm
[19:22:07] <graydon> (on osx)
[19:22:14] <graydon> and MONOTONIC_RAW on linux
[19:22:18] <graydon> so it's already TSC-ish
[19:22:40] *** Joins: tedh (tedh@moz-F0B37C08.hsd1.il.comcast.net)
[19:29:47] <tikue> pcwalton: you had mentioned the other day an alternative to using a bi-hashmap? I basically am in need of a two-way associative map
[19:30:01] <pcwalton> I would just use a bi-hashmap
[19:30:03] <pcwalton> or well
[19:30:07] <pcwalton> you could just use an array
[19:30:13] <pcwalton> if it's small the memory overhead of a hashmap makes no sense
[19:30:20] <tikue> pcwalton: fair enough
[19:30:31] <tikue> pcwalton: you mean just an array of tuples?
[19:30:34] <pcwalton> yeah
[19:30:36] <tikue> pcwalton: ok
[19:33:19] *** Quits: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP) (Ping timeout)
[19:34:34] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[19:34:36] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[19:34:39] <bblum> boy, i wasn't wrong when i said this feature would not be complicated, but i sure was wrong when i said it would just be a couple of lines of code to add
[19:34:46] <bblum> this is causing massive churn
[19:34:50] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[19:36:12] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[19:37:54] <olsonjeffery> 19
[19:37:57] <olsonjeffery> whoops
[19:40:59] *** Quits: MaikKlein1 (maik@moz-4C6F98CE.dip0.t-ipconnect.de) (Ping timeout)
[19:44:11] *** Quits: BitPuffin (quassel@moz-49828767.cust.tele2.se) (Ping timeout)
[19:47:53] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[19:47:55] *** Quits: cr (anonymous@moz-312F633D.dip0.t-ipconnect.de) (Quit: cr)
[19:50:40] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[19:53:04] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[19:54:42] *** Joins: _Vi (vi@527C345F.497AA854.B16B3BE6.IP)
[19:55:35] *** Joins: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP)
[19:55:35] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/D_Kqzw
[19:55:35] *** Parts: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP) ()
[19:58:05] *** Quits: pnathan (Adium@B9840254.2CD8A5F8.477B877D.IP) (Quit: Leaving.)
[19:58:32] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[19:58:32] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/8u9M_g
[19:58:32] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[19:58:35] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[19:58:35] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/iGHdDQ
[19:58:35] <ghrust> 13rust/06auto 148515abe 15Felix S. Klock II: Add doc and examples for attributes allow/warn/deny/forbid....
[19:58:35] <ghrust> 13rust/06auto 149db1903 15bors: auto merge of #7823 : pnkfelix/rust/issue7821-document-lint-attributes, r=graydon...
[19:58:36] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[19:58:39] *** Joins: nawfel (Mibbit@808FF32F.824CB9F2.DFAB1F33.IP)
[20:00:26] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[20:01:28] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[20:02:41] <bblum> what are you doing git
[20:02:44] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[20:02:45] <bblum> go home git
[20:02:46] <bblum> you are drunk
[20:02:50] <bblum> you could have merged that.
[20:03:14] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[20:03:38] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[20:05:10] <mark_edward> bblum: what feature is that?
[20:05:34] <bblum> mark_edward: "git stahp"
[20:05:56] <mark_edward> ??????
[20:05:58] *** Quits: jasom (aidenn@moz-5F6FC7B3.sb.sd.cox.net) (Quit: leaving)
[20:07:07] <bblum> ?_?
[20:08:17] <bblum> man i am so glad argument modes are gone
[20:08:20] <nawfel> rusti: "stay awake"
[20:08:36] <nawfel> rusti: "where are you"
[20:09:06] <nawfel> bblum: where is rusti ? i need him
[20:09:18] <bblum> i'm no rusti expert but
[20:09:23] <bblum> 16:03:13 -!- rusti [rusti@moz-54F7FD49.cpe.net.cable.rogers.com] has quit [Ping timeout]
[20:09:48] <bblum> and what makes you think rusti is male
[20:09:57] <nawfel> hmmmm
[20:10:39] <nawfel> r+ bblum
[20:10:45] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[20:10:53] *** Quits: nano (nano@moz-972880B.superkabel.de) (Connection reset by peer)
[20:11:06] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[20:13:12] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[20:13:31] *** Joins: jasom (aidenn@moz-5F6FC7B3.sb.sd.cox.net)
[20:13:43] <nawfel> what does "r+" stand for?
[20:13:51] <bblum> review positive
[20:14:00] <nawfel> thx
[20:16:10] <bstrie> r- is the anti-review, and annihilates r+s upon contact
[20:16:42] *** Quits: StarLight (StarLight@moz-BF46EBCA.dynamic.avangarddsl.ru) (Ping timeout)
[20:18:02] *** Quits: devinus (devinus@DAEC7122.372FE49C.29F95E0F.IP) (Ping timeout)
[20:18:12] <nawfel> is     ~once fn()     a valid type in rust
[20:18:56] <engla> only with -Z once-fns
[20:19:06] <engla> compiler flag
[20:19:28] *** Joins: askalski (akuda@2BA4E5A7.CC7751E8.6712E96B.IP)
[20:19:30] <nawfel> why ?
[20:20:12] *** Quits: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP) (Client exited)
[20:20:24] <engla> not set in stone how that thing will be solved eventually
[20:20:32] *** Joins: robertknight_ (robertknig@moz-B6DD6E0B.range86-166.btcentralplus.com)
[20:20:33] *** Quits: askalski (akuda@2BA4E5A7.CC7751E8.6712E96B.IP) (Quit: Wychodzi)
[20:21:48] <Uther> I am trying to compile bindgen from : https://github.com/crabtw/rust-bindgen
[20:22:17] *** Joins: pnathan (Adium@B9840254.2CD8A5F8.477B877D.IP)
[20:22:19] <Uther> but it seems more "export mod" are missing
[20:22:22] *** Quits: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:22:26] <Uther> is it normal?
[20:22:48] <Uther> -more +some
[20:24:12] *** Quits: seth (seth@moz-42C5FAA8.nc.res.rr.com) (Input/output error)
[20:25:47] *** Joins: jgilbert (jgilbert@moz-7B0110AD.mv.mozilla.com)
[20:27:07] *** Joins: seth (seth@moz-42C5FAA8.nc.res.rr.com)
[20:27:54] *** Quits: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com) (Quit: jeff)
[20:28:13] *** Joins: devinus (devinus@DAEC7122.372FE49C.29F95E0F.IP)
[20:29:49] *** Quits: engla (engla@moz-BFD53D48.selucle.dyn.perspektivbredband.net) (Ping timeout)
[20:29:56] <robertknight_> I've encountered an error when using 'x = x + y' vs. 'x += y' - can I confirm this is a bug: https://gist.github.com/robertknight/6cf1ff14cb4a6b26fe69 ?
[20:30:56] <robertknight_> And a related ICE: https://gist.github.com/robertknight/696dd89557955ecc757a
[20:31:21] *** Joins: reyre (reyre@E28B450A.6A6F5F66.47C41102.IP)
[20:31:26] *** Quits: jgilbert (jgilbert@moz-7B0110AD.mv.mozilla.com) (Ping timeout)
[20:31:36] *** Joins: BitPuffin (quassel@moz-49828767.cust.tele2.se)
[20:31:51] *** Quits: bytbox (s@moz-A9059E76.wireless.umd.edu) (Ping timeout)
[20:32:16] <vladimir-lu> rusti: 
[20:32:17] <vladimir-lu> macro_rules! testmacro(($val:expr) => (println("hello"); println($val.to_str()); )); testmacro!(25)
[20:32:21] <Ms2ger> robertknight_, I believe += is not quite in the state it should be in yet
[20:32:25] <bstrie> robertknight_: that's a temporary problem
[20:32:32] <vladimir-lu> rusti: macro_rules! testmacro(($val:expr) => (println("hello"); println($val.to_str()); )); testmacro!(25)
[20:32:39] <vladimir-lu> hmnn i guess he's gone to sleep
[20:32:46] <bstrie> robertknight_: we've removed overloading += in preparation of redoing it better
[20:33:04] <vladimir-lu> why does the macro invocation not print two lines?
[20:33:31] *** Quits: Ms2ger (Ms2ger@54323780.629A11C5.3773EA9F.IP) (Quit: nn)
[20:33:56] <robertknight_> bstrie: Ah, OK. I'd assumed the compiler just rewrote 'x += y' to 'x = x + y'
[20:34:45] <pauls> vladimir-lu: you probably need to wrap the body in `{}`... I'm not sure why it parses without it.
[20:34:55] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Ping timeout)
[20:35:04] <robertknight_> Though I see overloading += separately allows additional optimizations
[20:35:05] <doomlord_> in an unsafe block, whats the rust equiv of  ((size_t) &something) .. i tried &something as uint and various other things
[20:35:12] <bstrie> robertknight_: exactly
[20:35:13] <pauls> (the outermost delims are just for parsing)
[20:35:24] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[20:35:24] *** ChanServ sets mode: +o dherman
[20:35:30] <bstrie> robertknight_: thanks for the report though!
[20:35:38] *** Quits: nawfel (Mibbit@808FF32F.824CB9F2.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[20:35:50] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[20:36:38] <vladimir-lu> pauls: yeah, that works - confusing that it doesn't complain about it more though
[20:36:52] <bblum> pauls: patrick was wondering earlier today how the macro expander works
[20:37:04] <vladimir-lu> i was wondering why i kept getting lots of unused variable decls ;)
[20:39:44] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[20:39:44] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[20:43:50] *** Quits: alisdair (textual@moz-EBE9F394.bchsia.telus.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[20:45:25] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Connection reset by peer)
[20:45:34] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[20:47:18] <jdm> doomlord_: ptr::to_unsafe_ptr(&something) as libc::size_t
[20:47:42] * jdm curses the lack of rusti
[20:47:51] *** Joins: mye (mye@moz-D545C334.dip0.t-ipconnect.de)
[20:48:43] *** Joins: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com)
[20:49:36] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Quit: Leaving.)
[20:53:13] <vladimir-lu> how do you initialise a struct that contains only a single private member?
[20:53:32] <vladimir-lu> rustc doesn't like the name of the struct for some reason
[20:53:45] <Jeaye> struct T { x: int }; T { x: 42 }
[20:54:11] <sigma> hmm, how would I match against any whitespace character? Do I have to put them all in a enum?
[20:55:13] <bstrie> sigma: match foo { ' ' | '\n' => ... }
[20:55:23] <bstrie> use | to match multiple patterns
[20:56:02] <sigma> ok, now how do I match against any character that isn't whitespace? typing those out seems clumsy
[20:56:06] <kimundi> match c { c if c.is_whitespace() => ...}
[20:56:17] <sigma> aha
[20:56:19] <sigma> thanks
[20:56:38] * bstrie wonders if .is_whitespace() is unicode-aware
[20:56:41] <vladimir-lu> Jeaye: it seems to require { } even if they're empty - makes sense
[20:56:42] *** Joins: bnicholson_ (bnicholson@moz-BBE3ABD.mv.mozilla.com)
[20:57:07] <vladimir-lu> oh no wait, you still have to initialise the priv members
[20:57:09] <Jeaye> vladimir-lu: If you've a unit struct, simply use the struct's name
[20:57:24] <kimundi> bstrie: It is
[20:57:29] <Jeaye> Otherwise, initialize everything (as I've shown)
[20:57:57] *** Quits: bnicholson (bnicholson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:58:15] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[20:59:58] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[21:00:21] *** Quits: BitPuffin (quassel@moz-49828767.cust.tele2.se) (Ping timeout)
[21:02:24] *** Quits: victorporof_ (victorporo@8255EF0D.E934E1A1.4A6B528C.IP) (Quit: victorporof_)
[21:02:31] <graydon> doener: ping
[21:02:35] *** Quits: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net) (Quit: msingle)
[21:03:58] <doener> graydon: pong
[21:04:01] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[21:04:03] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[21:04:33] <graydon> doener: hey, did you say you were looking at the codegen of functions that switch on intrinsic names?
[21:04:47] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[21:04:49] <jedestep> bstrie: do you suppose is_whitespace is aware of \f
[21:05:17] *** Joins: Nisstyre (wes@moz-FD86289.netflash.net)
[21:05:46] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[21:06:15] <kimundi> jedestep: If it is in Unicode General Categories 'Zs', 'Zl', 'Zp' or in 'Cc'-category control codes in the range [0x09, 0x0d] then yes.
[21:07:03] *** Quits: robertknight_ (robertknig@moz-B6DD6E0B.range86-166.btcentralplus.com) (Ping timeout)
[21:07:26] <doener> I'm currently cleaning up a patch that improves the code generated for our intrinsics turning them into plain "ret" or "call; ret" functions that get always inlined. After that I'll try to get them directly translated inline, but that looks "complicated", so I don't know whether I'll actually do something about it
[21:07:54] <jedestep> unicode Cc 0x0C
[21:08:05] *** Quits: reyre (reyre@E28B450A.6A6F5F66.47C41102.IP) (Ping timeout)
[21:08:26] <doomlord_> oops did i miss an answer to my quetsion (i was afk)
[21:08:30] <doomlord_> (scrollback)
[21:08:34] <doener> graydon: if it doesn't look like something I feel I'm up to, I'll probably spend some time thinking about improving handling of immediate return values.
[21:08:42] <kimundi> jedestep: Then it seems to fall under whitespace
[21:09:55] <graydon> doener: oh, I thought you were looking at the giant string-switch statements in the stuff that _translates_ intrinsic calls. nm.
[21:10:06] <graydon> doener: in any case, did you see the codegen compiletest mode?
[21:10:11] <graydon> doener: I know you're interested in this stuff :)
[21:10:46] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[21:10:49] *** Quits: mark_edward (quassel@moz-4A5B1251.wisolt4.epbfi.com) (Ping timeout)
[21:11:20] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[21:11:29] *** Parts: gps (gps@moz-DB4A9C19.scl3.mozilla.com) ()
[21:11:39] <jedestep> not all whitespace functions catch it. lost 30% on a compilers assignment by missing it so now i always wonder.
[21:11:53] *** Joins: vosen (vosen@moz-266BA656.icpnet.pl)
[21:12:30] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[21:12:40] <doener> graydon: ah, well, I've been looking at the code generated _for_ that match as well. Inspired me to do the empty block avoidance PRs. Except for not _quite_ optimal landingpad re-use, it seems to be largely "fine" now, for a straight translation that is
[21:12:44] <bblum> hmmmm
[21:12:51] <bblum> should task::unkillable really be unsafe?
[21:12:56] <bblum> i feel like maybe no
[21:12:58] <graydon> doener: is it? it seems ... _immense_
[21:12:59] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[21:12:59] *** ChanServ sets mode: +o tjc
[21:13:16] <doener> graydon: AFAICT, the bloat comes largely from the way we do function calls. There are lots of them hidden in there
[21:13:47] <graydon> doener: yeah, figures. ok.
[21:13:50] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Quit: Leaving.)
[21:13:55] <kimundi> jedestep: Here's the definition if you want to comfirm it with your own eyes ;)  https://github.com/mozilla/rust/blob/master/src/libstd/char.rs#L84
[21:14:07] *** Joins: eschweic1 (Adium@moz-BBE3ABD.mv.mozilla.com)
[21:14:10] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[21:14:12] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[21:14:17] <graydon> doener: if you want to populate some codegen tests (or have me populate some) with idioms that we ought to be doing "as well as clang", let me know
[21:14:24] <graydon> otherwise I'll just start depositing random stuff in there
[21:14:52] <doener> graydon: I'll probably simplify the switch, using an inner function for "simple" intrinsics, that just do a call to some llvm intrinsic, should bring the code size down
[21:15:04] <doener> well, simplify the code in the arms
[21:15:19] <graydon> do we translate enum-switches into jumps reasonably well?
[21:15:40] <doener> graydon: we generate an llvm switch
[21:16:06] <graydon> given that it's a fixed key set, it might make sense to map strings => an enum in a hashmap, and switch on that
[21:16:31] <doener> good point. IIRC there's even a comment about that in there
[21:16:41] <jedestep> kimundi: oh no i believe you :)
[21:16:52] *** Joins: mark_edward (quassel@moz-4A5B1251.wisolt4.epbfi.com)
[21:17:24] <kimundi> ^^
[21:17:47] <bblum> where did the A-unsafe tag go??????
[21:18:46] <kimundi> It had a buffer underflow and overwrote itself
[21:18:56] <bblum> c.c
[21:21:08] <pcwalton> I'm concerned that there may be one too many levels of indirection in match
[21:21:20] <bblum> pcwalton: in codegen?
[21:21:22] <pcwalton> the comment at the end that talks about why we still need an "irrefutable pattern only" version of match concerns me
[21:21:23] <pcwalton> yeah
[21:21:32] <pcwalton> I don't see why such a thing should be needed
[21:21:36] <pcwalton> maybe nmatsakis can fill me in
[21:21:38] * bblum looks
[21:23:22] <bblum> which comment?
[21:23:54] <tikue> is there a better way to do if option.is_some() { option.get() } else { other stuff }
[21:24:02] <pcwalton> tikue: match
[21:24:06] <bblum> haha i love the pasted irc conversation as a comment in the middle of this
[21:24:09] <tikue> pcwalton: lol wow, true
[21:24:13] <tikue> thank you
[21:24:18] <pcwalton> :)
[21:24:19] *** Quits: Ralith (ralith@moz-50F3C77.vc.shawcable.net) (Ping timeout)
[21:24:42] <tjc> pasted IRC conversations are the best comment format
[21:24:51] <cmr> jedestep: pong
[21:24:55] <cmr> jedestep: you are the man!
[21:26:18] <vladimir-lu> pcwalton: is there not getOrElse equivalent?
[21:26:21] <vladimir-lu> *a
[21:26:30] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[21:26:43] <jedestep> cmr: :)
[21:26:51] <pcwalton> vladimir-lu: there's map_default
[21:26:54] <jdm> vladimir-lu: get_or_zero, I think
[21:27:17] <bblum> if you want an option utility function, it is usually there
[21:27:20] <bblum> just look in option.rs
[21:27:27] <cmr> jedestep: re: enum ids, need to use visit_item and match on the item type, that's the only place the enum node_id can be found
[21:27:36] <tikue> pcwalton: doesn't map_default return an option?
[21:27:45] * tikue should just check docs
[21:27:50] <jedestep> ah, i definitely would not have thought to do that lol
[21:28:03] <cmr> yeah, it's obnoxious
[21:28:08] *** Joins: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com)
[21:28:12] <cmr> there might be a good reason for it, but I doubt it ;P
[21:28:17] *** Joins: Jesin (Jessin_@moz-48B48C95.eecs.lehigh.edu)
[21:28:52] <jedestep> also, are there docs to be collected from function bodies? right now it just kind of ignores everything but the function header
[21:29:02] *** Quits: mark_edward (quassel@moz-4A5B1251.wisolt4.epbfi.com) (Ping timeout)
[21:29:22] <cmr> Like, functions defined within the function?
[21:29:36] <pcwalton> https://github.com/cmr/rustdoc_ng/issues/5
[21:29:41] <jedestep> ah right, that would be something
[21:29:41] <pcwalton> that design looks amazing
[21:29:45] <cmr> pcwalton: doesn't it!
[21:29:57] <jedestep> it's really impressive looking
[21:30:00] <vladimir-lu> i can't see anything in std for pretty printing [u8] vectors as hex strings - i can just iterate over the contents and use to_str_radix() or is there a more elegant way?
[21:30:40] <jedestep> vladimir-lu: the way i do that is just iterate over the bytes formatting them with %x
[21:30:44] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[21:30:55] <jedestep> don't think there's explicitly a better way than that sadly
[21:31:00] <vladimir-lu> jedestep: using fmt! ?
[21:31:04] <jedestep> yeah
[21:31:05] <cmr> jedestep: I don't think there's any coherent way to present nested functions, especially since you can't actually use them as part of the API
[21:31:14] <cmr> jedestep: so, function bodies can be safely ignored I think
[21:31:31] <jedestep> that's good
[21:33:30] <cmr> ...uh oh
[21:33:40] <cmr> enum id isn't in my fork of rust, it's too old..
[21:33:49] <jedestep> noooooo
[21:34:11] <doomlord_> unsafe fn adr<T>(a:*T)->uint { a as uint }       adr(&something) ... [1] is that the most concise way to get a ptr as an int [2] does sys already have such a helper
[21:34:13] <cmr> I'll rewrite visit.rs to use the old visitor and we'll move up to master.
[21:34:33] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[21:34:33] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/iGHdDQ
[21:34:33] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[21:34:44] <cmr> doomlord_: `let x: *int = 32; x as uint` should work fine
[21:35:03] <jedestep> kinda sucks, but it does lower the entry barrier a bit if nothing else
[21:35:04] <cmr> doomlord_: plus we have pointer arith now too!
[21:35:41] <doomlord_> that works but i was after something convinient to  put into expressions 
[21:35:47] <cmr> ah
[21:36:01] <cmr> that works too then
[21:36:04] *** Joins: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com)
[21:36:32] <cmr> jedestep: by the way, #rustdoc-wg channel
[21:36:53] <doomlord_> i was trying things like (&something) as *u8 as uint etc
[21:36:55] <jedestep> oh cool
[21:37:19] *** Joins: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl)
[21:37:37] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[21:37:37] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/EzbOew
[21:37:37] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[21:37:38] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[21:37:38] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/2uBtHg
[21:37:38] <ghrust> 13rust/06auto 143c19f1b 15Felix S. Klock II: Refactored int/uint range code in preparation for change to range_rev semantics....
[21:37:38] <ghrust> 13rust/06auto 14db0a13b 15Felix S. Klock II: Switch over to new range_rev semantics; fix #5270.
[21:37:38] <ghrust> 13rust/06auto 143896d46 15Felix S. Klock II: Fix #5270: another test I did not update properly.
[21:37:40] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[21:37:42] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[21:38:11] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Quit: leaving)
[21:38:14] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[21:38:34] <doomlord_> ( i was just writing something to dump struct layout in rust, and struct/class layout in c++ .. )
[21:39:32] <doomlord_> i realize rusts' syntax may make tradeoffs that make pointer arith less natural than in C :) (we always still have C to write programs that are predominantly unsafe..)
[21:39:34] *** Quits: pnathan (Adium@B9840254.2CD8A5F8.477B877D.IP) (Quit: Leaving.)
[21:40:00] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[21:40:55] <cmr> `let x: *Foo = ...; x = x + 1` does what'd you expect, adds sizeof(Foo) to the pointer
[21:41:10] <doomlord_> ok nice
[21:41:26] <doomlord_> i guess even in C turning pointers into ints isn't so common
[21:41:49] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[21:43:14] <doomlord_> unsafe fn offset<A,B>(a:*A,b:*B)->uint {	a as uint  - b as uint  }  <<< etc..
[21:43:44] <tikue> rusti: let mut a = 1; let mut b = 2; let mut c = 3; let mut v = [a, b, c]; let mut x = do v.mut_iter().find_ |num| { num == 1 }; let mut x = x.get(); x += 1; x
[21:44:08] <SiegeLord> doomlord_: I'd use an 'int' return
[21:44:14] *** Joins: mark_edward (quassel@moz-4A9A2F15.dynamic.utc.edu)
[21:44:24] <doomlord_> good point
[21:44:29] <tikue> rusti: 1 + 1 
[21:44:32] <tikue> where is rusti?!?!
[21:44:45] <cmr> out for lunch
[21:44:47] <cmr> ;p
[21:44:54] <tikue> :(
[21:45:16] <tikue> does anyone know if mut_iter().find_ returns a mutable value?
[21:45:29] <engla> tikue: yes
[21:45:33] <tikue> engla: great, ty
[21:46:02] <tjc> graydon: is the unwrap method in workcache private for a reason?
[21:46:12] *** Quits: cowboyd (cowboyd@moz-1BD02A1E.sw.biz.rr.com) (Client exited)
[21:46:36] <engla> tikue: find_ returns an Option<A> where A is the element in the iterator.. so if it's &mut T, you get Option<&mut T>
[21:46:50] <tikue> engla: ah gotcha, that makes sense
[21:47:02] <graydon> tjc: probably not
[21:47:08] <tjc> graydon: ok
[21:47:35] <graydon> also see comment: should be in impl Work
[21:47:38] <graydon> compiler was buggy
[21:49:14] <tjc> butâ€¦ it looks like it is in impl Work?
[21:49:25] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[21:49:54] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[21:50:00] *** Quits: heftig (heftig@moz-F0A5AD7E.dip0.t-ipconnect.de) (Ping timeout)
[21:50:15] <mark_edward> rusti: let flip = |(x,y)| (y, x); flip((-9,0))
[21:50:50] <graydon> tjc: there is no impl Work in my workspace. have you added one?
[21:51:08] *** Joins: heftig (heftig@moz-E56E7873.dip0.t-ipconnect.de)
[21:52:02] <tjc> graydon: well, it has trait bounds, but it's there
[21:52:13] <tjc> I didn't add it recently, anywayâ€¦ maybe I added it while doing a cleanup pass at some point long ago
[21:52:31] <graydon> oh
[21:52:47] <graydon> so in my workspace, I see it now .. yes, there's a rather heavily-bounded impl Work
[21:52:53] <graydon> but unwrap is a free function that follows it
[21:53:18] <mark_edward> can closures be generic?
[21:53:38] <tjc> graydon: nope, it's a method in my workspace, and I don't have unsaved changes to that file
[21:53:38] <tikue> hey guys, if I use option.get_or_default and the argument is some arbitrary block of code, will it be evaluated in advance or only if it needs it?
[21:54:10] <tjc> graydon: oh never mind, I was looking in the wrong workspace >.< I did change it
[21:54:19] <graydon> https://github.com/mozilla/rust/blob/master/src/libextra/workcache.rs#L376
[21:54:20] <graydon> yeah
[21:54:28] <tjc> tikue: in advance
[21:54:41] <tikue> tjc: ah, ok
[21:54:48] <tjc> tikue: I would like to have a method that takes a closure instead that only gets called in the "None" case, but it's not there yet
[21:54:49] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[21:54:51] <tjc> would be simpel to add
[21:55:05] <tikue> tjc: yeah that'd be nice to have
[21:55:28] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[21:55:31] <mark_edward> graydon: does Rust have generic closures? Will it ever?
[21:55:46] <graydon> mark_edward: define "generic closures"
[21:56:10] <graydon> mark_edward: we infer types of closures, and all generics monomorphize during compilation
[21:56:16] <mark_edward> graydon: http://stackoverflow.com/questions/17233547/how-does-generic-lambda-work-in-c14
[21:56:43] *** Joins: Ralith (ralith@moz-99DB1CA1.wireless.sfu.ca)
[21:57:04] *** Quits: bnicholson_ (bnicholson@moz-BBE3ABD.mv.mozilla.com) (Quit: Ex-Chat)
[21:57:09] <graydon> well, that's a little dense with C++-isms but I think I get the point, and if so then yes, that's what our lambdas are
[21:57:13] *** Joins: bnicholson__ (bnicholson@moz-BBE3ABD.mv.mozilla.com)
[21:57:53] *** bnicholson__ is now known as bnicholson
[21:57:56] <graydon> IOW if you have a lambda in a function f that's generic in T, and that lambda is (say) T->int, then for each  instantiation of f you'll get a different instantiation of the lambda
[21:58:01] <graydon> is that what you're asking?
[21:58:14] <mark_edward> I believe so, yes
[21:58:39] <graydon> put another way, all lambdas are implicitly fn<T,U,V,...>(t:T,u:U,v:V,...) { ... }
[21:58:44] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[21:59:01] <graydon> (subject to the constraints of irrefutable patterns in the argument bindings)
[21:59:09] <bblum> it's astonishing that c++ is only in 2014 getting this feature that was invented/discovered in 1972
[21:59:20] <bblum> (sorry, had to channel bob harper for a minute there)
[21:59:26] <mark_edward> cool
[21:59:33] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[21:59:43] <graydon> bblum: *shrug* I'm sure we're leaving out lots of tasty stuff that was known in 1972
[21:59:55] <mark_edward> graydon: why didn't you guys go with the C++ way of compiling away lambdas iinto structs with a call method?
[22:00:16] <graydon> when I read language history it's pretty plain to me that most of the good stuff was discovered by the late 60s
[22:01:00] <bblum> the word procesor was also apparently invented in 1972
[22:01:01] *** Quits: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net) (Ping timeout)
[22:01:14] <echristo> graydon: ping? (when you get a chance, i'm being lazy)
[22:01:15] <graydon> mark_edward: not sure that really changes much. still have to effect the translation.
[22:01:18] <graydon> echristo: pong
[22:01:46] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[22:02:00] <echristo> hey, can i get a view on how you're supporting OpenCL or accelerators in general in rust?
[22:02:14] <mark_edward> graydon: wouldn't it make reasoning about certain characteristics of the closure easier, as then they'd just be structs. you wouldn't need special code in the compiler for closures
[22:02:32] <echristo> a link to some syntax etc would be pretty cool.
[22:03:08] <olsonjeffery> ecr: ping
[22:03:10] <steven_is_false> So this issue is really strange https://github.com/mozilla/rust/issues/7804 . I need to know how to work around it to finish my pull request that refactors sync, and arc https://github.com/mozilla/rust/pull/7701 . Can anyone explain the error to me?
[22:03:11] <graydon> mark_edward: the degree to which that symmetry exists or existed has changed quite a bit over time. at some times that might have worked, others not. anyway I just don't think it winds up changing much.
[22:03:29] <graydon> echristo: at the moment we don't do anything for openCL, I don't think
[22:03:41] <mark_edward> what do you mean by symmetry?
[22:03:42] <graydon> echristo: eholk has a thing that maps onto it
[22:04:19] <echristo> vaguely saw something on the list, was curious.
[22:04:24] <graydon> mark_edward: well, bluntly, we didn't have region pointers for most of the life of the language, so capturing environment by reference wouldn't have been possible. structs couldn't have pointers like that.
[22:04:41] *** Quits: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com) (Quit: jeff)
[22:04:44] <echristo> eholk i've seen has some interesting things coming along.
[22:05:17] <eholk> echristo: there are rust-opencl bindings available for Rust. As of a week or two ago, my fork compiled with the latest Rust: https://github.com/eholk/rust-opencl/tree/fixes
[22:05:22] <mark_edward> graydon: i see. and you don't think that model would be an improvement now, even though you have the wherewithall to do it now?
[22:05:24] <graydon> https://github.com/luqmana/rust-opencl and https://github.com/eholk/RustGPU are the only thigns I know about
[22:05:35] <pcwalton> mark_edward: C++11 lambdas are anonymous structs
[22:05:37] <eholk> this lets you write kernels in OpenCL and call them from Rust, but it's pretty low level
[22:05:43] <pcwalton> there's no existential types in them
[22:05:47] <pcwalton> that's really annoying
[22:05:49] <echristo> eholk: sweet. thanks.
[22:05:54] <mark_edward> pcwalton: i know they're anonymous structs
[22:05:54] <pcwalton> they didn't want to add existential types to the language
[22:05:57] <echristo> eholk: have you seen the halide stuff?
[22:06:00] <pcwalton> isn't that a pain? :)
[22:06:05] <mark_edward> what do you mean by lacking existential types?
[22:06:13] <eholk> as graydon pointed out, there's also the RustGPU work, if you want to stick with NVIDIA GPUs
[22:06:13] <kmc> what do lambdas have to do with existential types?
[22:06:23] <steven_is_false> pcwalton: Aren't classes with virtual functions basically existentials?
[22:06:25] <pcwalton> kmc: lambdas are really existential types
[22:06:31] <pcwalton> steven_is_false: yeah, that's true
[22:06:32] <eholk> It's a bit out of date by now, but I will most likely be updating it this fall
[22:06:36] <pcwalton> yeah, so ignore that :)
[22:06:37] <tjc> kmc: a closure can be thought of as a record with an existentially-typed environment
[22:06:39] *** Quits: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP) (Quit: ëžœë¤ì€ ì‡ í‡´í–ˆìŠµë‹ˆë‹¤.)
[22:06:47] <kmc> ok, sure
[22:06:48] <pcwalton> the closed-over variables are the existential part
[22:06:49] <tjc> that's what allows closures with different environments but the same type to be used interchangeably
[22:06:50] <tjc> yeah
[22:06:53] <eholk> echristo: i've heard a little about halide. I'm planning to read a paper on it tomorrow. It sounds impressive
[22:06:54] <cmr> eholk: LLVM has a backend for the opencl bytecode (spir I think), doesn't it?
[22:06:58] <steven_is_false> kmc: Suppose we have A->B be the type of closures, and A~>B be the type of functions
[22:07:02] <pcwalton> I think it's better to have existential types
[22:07:08] <pcwalton> instead of making anonymous structures
[22:07:15] <cmr> eholk: would we be able to have like #[opencl] that does magic to generate that rather than native code?
[22:07:16] <kmc> yeah I am familiar with this idea
[22:07:30] <steven_is_false> Then âˆƒenv, (env, (env, A) ~> B) is one way to implement closures
[22:07:31] <eholk> cmr: i'm not sure, I know SPIR seems to be an LLVM variant for OpenCL, but i'm not sure it's well supported yet
[22:07:39] <cmr> ok
[22:07:46] <echristo> eholk: i really like the programming model so far.
[22:07:49] <eholk> cmr: yeah, having #[opencl] would be awesome
[22:07:50] <pcwalton> and forcing people to use templates when they want the existential-ness
[22:07:56] <echristo> ah. SPIR is ... going to be interesting.
[22:08:09] <echristo> they've had a hard time getting that in.
[22:08:26] <cmr> also amd's HSAIL thing
[22:08:27] <echristo> eholk: it seems a bit limited at the moment to photo applications, but..
[22:08:35] <eholk> i feel like these virtual ISAs for GPUs are sort of at the wrong level of abstraction
[22:08:39] <cmr> based on llvm, probably not too usable yet
[22:08:50] <eholk> you still rely on the implementation to do autovectorization for you
[22:09:00] <eholk> i'd like a low level gpu system that lets me vectorize my own code
[22:09:11] <bblum> steven_is_false: i'm looking at your updated commit, and (at a glance) it looks like the race condition in sem.wait() is fixed, but i still don't understand why you're rearranging all the internal type structure of everything
[22:09:12] <sully> where does the main function for rustc live?
[22:09:14] <echristo> eholk: i can see that.
[22:09:24] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[22:09:28] <bblum> sully: driver.rs would be a place to start looking
[22:09:33] <cmr> sully: src/librustc/driver/driver.rs
[22:09:35] <cmr> wait no
[22:09:39] <cmr> librustc/rustc.rs
[22:09:47] <sully> yeah, I checked in driver
[22:09:47] <sully> ok
[22:09:49] <cmr> but the entry point doesn't do anything except call into driver
[22:10:07] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[22:10:08] <bblum> steven_is_false: i just don't think it's necessary to refactor all the internals in the way that you're doing it in order to achieve RAII, and there are significant downsides in some places
[22:11:57] <steven_is_false> bblum: I'm still hacking on the code. So the code that's currently on GitHub isn't as good as I have on my computer.
[22:12:07] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[22:12:29] <bblum> steven_is_false: alright, sure. let me know when you'd like another review
[22:12:39] *** Quits: saml (sam@moz-14C16814.cst.lightpath.net) (Quit: Leaving)
[22:12:45] <steven_is_false> bblum: I should actually break this up into smaller commits probable.
[22:12:58] <bblum> that would definitely help
[22:13:45] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[22:14:07] <steven_is_false> bblum: I'll let you know when I want another review. I'm kind of close but just blocked on this one issue https://github.com/mozilla/rust/issues/7804 which prevents me from making the rwarc benchmark compile.
[22:14:26] <bblum> i see
[22:15:07] <steven_is_false> bblum: Thanks for the constructive critiscm on the pull request so far.
[22:15:14] <bblum> no prob
[22:17:40] <pcwalton> I should file a PR on doing const eval and CTFE of intrinsics in the fronend
[22:17:43] <pcwalton> frontend
[22:17:58] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[22:17:59] <pcwalton> size_of() should be CTFE-able anyway
[22:18:50] <echristo> eholk: the advantage to the things like ptx is it makes it easier to target. i agree though, in general. at the object file level i'd like to see us with either a) a way to encode it for run time compilation, or b) have some way to encode it such that we don't need 300 different encodings of the same information.
[22:18:51] <pcwalton> does someone want to implement "note"? you'd be able to close the oldest open issue :)
[22:19:52] <sully> what is note?
[22:19:58] *** Quits: Azdle (Azdle@moz-B334B496.hfc.comcastbusiness.net) (Ping timeout)
[22:20:12] <pcwalton> it's a struct that takes a string and prints that string in its destructor if it's unwinding
[22:20:36] <echristo> eholk: of course, i think we should be targeting jit compilers for all this, but there are likely some times that we might want to precompile.
[22:21:11] <eholk> echristo: why JITs, out of curiosity?
[22:23:38] <echristo> to avoid the heterogenous fleet problem. i.e. i've got a binary i'd like to run on something like, say a fleet of intel processors with sse3 or above, with different gpus, and i'd like to not have 15 versions of every function that i'd like to run either on sse or various gpus.
[22:24:10] <eholk> ah, right. that makes sense
[22:24:25] <echristo> also, i'd like my mac to stop trying to autocorrect gpu
[22:24:31] <echristo> and sse 
[22:25:19] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[22:25:26] <eholk> haha, i think i turned off autocorrect for exactly that reason
[22:25:27] *** Quits: mye (mye@moz-D545C334.dip0.t-ipconnect.de) (Quit: mye)
[22:26:19] <echristo> :)
[22:26:32] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[22:27:29] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[22:28:00] *** Joins: aatch (aatch@moz-B437F499.pocketrent.com)
[22:28:58] <doener> graydon: ok, found something in the generated code for trans_intrinsic that is "not so good". We're creating copies even for temporaries, for example string slices. So foo("Hans") ends up initializes a slice and then copying it before it's passed to the function. We should probably avoid that. Is that something that would fit into a test?
[22:29:19] *** Joins: vk (vk@858480B7.B568D26C.93B001FA.IP)
[22:29:34] <graydon> doener: yes, definitely
[22:29:38] <graydon> I'm sketching more codegen tests now
[22:29:43] <graydon> can I .. tell you how to make them? they're delightful
[22:29:49] <graydon> so fun
[22:30:06] <graydon> you write a .rs file and a .cc file, each containing a non-mangled C-named function called "test"
[22:30:16] <graydon> you put them in test/codegen/somefile.{rs,cc}
[22:30:18] <graydon> and that's it!
[22:30:27] <graydon> the harness compiles both, extracts the 'test' function bitcode
[22:30:33] <graydon> measures the size ratio between the two
[22:30:43] <graydon> and will even prevent regressions on that ratio in the future
[22:30:50] <graydon> all for the low low price of writing 2 little files :)
[22:30:55] <doener> sounds awesome
[22:31:23] <doener> I'll definitely try that tomorrow. Need to get some sleep now, already past midnight here
[22:31:25] <graydon> in passing, it gives you nice little foo-extract.ll and foo-clang-extract.ll files
[22:31:33] <graydon> which you can read over in a text editor to see "what we're doing wrong"
[22:31:41] <graydon> sure sure
[22:31:46] <graydon> I should write this up and send to the mailing list anyway
[22:31:50] <graydon> or maybe post to the wiki
[22:31:55] <graydon> in the testsuite section
[22:32:27] *** Quits: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl) (Client exited)
[22:33:13] *** Quits: doener (doener@moz-121949B3.unitymediagroup.de) (Quit: nighty night)
[22:33:43] *** Quits: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP) (Quit: night)
[22:34:02] <vladimir-lu> i guess you can use that outside of the compiler if you wanted to ensure certain sections of code didn't generate too many instructions?
[22:34:24] *** Joins: nawfel (Mibbit@DC7A41C6.FCA4511C.DFAB1F33.IP)
[22:36:51] *** Quits: donri (dag@moz-9BB61102.tbcn.telia.com) (Client exited)
[22:38:38] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[22:38:46] *** Joins: BitPuffin (quassel@moz-49828767.cust.tele2.se)
[22:39:36] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[22:39:50] *** Joins: pnathan (Adium@B9840254.2CD8A5F8.477B877D.IP)
[22:40:11] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Client exited)
[22:40:52] <nawfel> rusti: "Hello? where are you ?"
[22:40:56] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[22:41:05] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[22:42:21] *** Quits: jdm (jdm@92FB48CA.8B5E9DF.9A8C35B4.IP) (Quit: Lost terminal)
[22:42:50] <graydon> are we still passing task* to each function?
[22:43:07] <bblum> graydon: ...?
[22:43:37] <graydon> https://gist.github.com/graydon/a105f9d7901e989cffe6
[22:43:44] <graydon> what's the first arg being passed there?
[22:43:51] <graydon> { i64, %tydesc*, i8*, i8*, i8 }* undef
[22:44:06] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[22:44:07] <graydon> env ptr?
[22:44:42] <bblum> oh, i've no idea
[22:45:10] *** Quits: pnathan (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[22:45:54] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[22:47:36] *** Quits: devinus (devinus@DAEC7122.372FE49C.29F95E0F.IP) (Quit: Computer has gone to sleep.)
[22:48:05] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[22:48:30] <graydon> bet it's env ptr, ech.
[22:49:25] *** Quits: nawfel (Mibbit@DC7A41C6.FCA4511C.DFAB1F33.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:50:17] *** Joins: dwhyte (dwhyte@ED9190FB.B72E355F.7BF4A4B0.IP)
[22:50:38] <bblum> this Local::borrow stuff is a disaster
[22:50:39] *** Quits: SimonSapin (simon@moz-D0C2F181.zone2.bethere.co.uk) (Ping timeout)
[22:51:24] <toddaaro> welcome to my life
[22:52:07] *** Joins: Archer (Archer@moz-B3C4C551.bb.online.no)
[22:53:47] *** Quits: fabiand (fabiand@moz-FCBBAF15.adsl.alicedsl.de) (Quit: Verlassend)
[22:54:39] <pcwalton> graydon: it's env pointer. niko's FFI stuff will fix that!
[22:54:43] <pcwalton> I think anyway
[22:55:21] <pcwalton> it's quite fixable, just make 'extern "Rust" fn' values not have the environment and when converting an 'extern "Rust" fn' to an &fn add the environment
[22:55:29] <pcwalton> that could shave off a lot
[22:55:50] *** sam113101 is now known as sam113101_afk
[22:56:08] *** Quits: vosen (vosen@moz-266BA656.icpnet.pl) (Quit: Leaving)
[22:56:35] <olsonjeffery> bblum: that's to make up for lack of globals, right?
[22:57:17] <bblum> olsonjeffery: that plus the fact that sometimes the runtime needs to move out of the global storage
[22:57:20] <bblum> well
[22:57:31] <bblum> actually, even better reason is that it has to be per-CPU
[22:58:34] *** Joins: dbaupp (Thunderbir@moz-712A1135.lns20.syd6.internode.on.net)
[22:59:09] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[23:00:04] <ecr> olsonjeffery: the runtime needs to cheat often
[23:00:14] <ecr> it hurts my soul
[23:00:22] *** Quits: ssbr (ssbr@moz-141F89C6.block0.gvtc.com) (Ping timeout)
[23:00:30] <olsonjeffery> ecr: btw.. are you ok with my adding fn timer_init() to IoFactory?
[23:00:58] <olsonjeffery> it seems like that's where the uv_loop_t dependency is sourced from for the other stuff in rt::io
[23:01:06] <olsonjeffery> so just making sure that's not an issue
[23:01:35] *** sam113101_afk is now known as sam113101
[23:01:49] <ecr> olsonjeffery: yeah, that should be fine. That's where all the 'make a new IO handle from nothing' functions go.
[23:02:33] <ecr> opening a file or a pipe will end up there eventually
[23:04:33] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[23:05:52] <cmr> Is std::local_data actually safe now?
[23:06:22] <acrichto> cmr: yes
[23:06:29] <cmr> wonderful
[23:06:35] <acrichto> cmr: well, as far as I know
[23:06:36] <tikue> is there a tree in std that implements Iterator? 
[23:07:04] *** Quits: igl1 (igl@moz-F36E59E8.adsl.alicedsl.de) (Connection reset by peer)
[23:07:50] <olsonjeffery> huh, that's neat.
[23:07:53] <acrichto> cmr: the problem before was that the keys were functions and "fn foo<T>(_: @T) {}" would always monomorphize to the same function and could be used to extract any value of any time from local data
[23:08:09] <acrichto> cmr: statics can't have type parameters so that's no longer a problem
[23:13:20] <bblum> acrichto: if you have two keys for the same type, will llvm compile those to be the same
[23:13:39] <bblum> what i mean is, can you have more than one tls slot of the same type, or do you need to newtype one of them
[23:13:40] *** Quits: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com) (Ping timeout)
[23:13:40] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[23:13:40] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/2uBtHg
[23:13:40] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[23:13:41] <bblum> also
[23:13:43] *** Quits: mib_pvemks (Mibbit@BBE7C46A.B4F11D08.8612FA94.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[23:13:47] <acrichto> bblum: https://github.com/mozilla/rust/blob/master/src/libstd/local_data.rs#L268
[23:13:59] <bblum> acrichto: nice
[23:14:00] <acrichto> not right now, but we'll catch it if we turn on an optimization that does hopefully
[23:14:11] <bblum> perfect
[23:14:35] <tjc> graydon: is there any reason in principle why the workcache context couldn't be made sendable?
[23:14:45] <cmr> I think it's a valid optimizations to merge multiple identical immutable statics into a single one
[23:15:37] <cmr> acrichto: https://github.com/cmr/rustdoc_ng/blob/master/visit.rs#L54
[23:15:46] <cmr> acrichto: is there any easy way to do that with the new local_data?
[23:15:51] *** Joins: ssbr (ssbr@moz-141F89C6.block0.gvtc.com)
[23:16:16] <acrichto> cmr: local_data::key(key, |x| *x.unwrap())
[23:16:30] <acrichto> although that must have a copyable type
[23:16:46] *** Joins: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP)
[23:16:46] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/4A9hpA
[23:16:46] *** Parts: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP) ()
[23:16:56] <acrichto> cmr: oh local_data::get
[23:16:58] <acrichto> not key
[23:17:14] <cmr> Hm
[23:17:23] *** Quits: Ralith (ralith@moz-99DB1CA1.wireless.sfu.ca) (Ping timeout)
[23:17:30] <toddaaro> acrichto: you did the tls rework right?
[23:17:36] <acrichto> toddaaro: yes
[23:17:38] *** Quits: btipling (btipling@moz-D51E0AEB.xen.prgmr.com) (Quit: ZNC - http://znc.sourceforge.net)
[23:17:49] <toddaaro> acrichto: what part of it were you working on?
[23:17:55] <acrichto> toddaaro: all of it
[23:17:59] <bblum> acrichto: by the way thanks
[23:18:08] <acrichto> toddaaro: well, everything above the actual storage of the tls pointer
[23:18:12] <acrichto> bblum: :)
[23:18:15] <bblum> it's not often that i appreciate people tearing out all my old implementation of something and tossing it in the garbage
[23:18:20] <graydon> tjc: checking
[23:18:22] <bblum> but boy was i not proud of the initial TLS implementation
[23:18:34] *** Joins: btipling (btipling@moz-D51E0AEB.xen.prgmr.com)
[23:18:38] <graydon> (we can .. almost put a hashtable in there now for real, can't we?)
[23:18:40] <toddaaro> acrichto: hm, what files?
[23:18:41] <graydon> (not just an alist)
[23:18:57] <acrichto> toddaaro: libstd/task/local_data_priv.rs libstd/local_data.rs
[23:19:06] *** Quits: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl) (Quit: Leaving)
[23:19:12] <graydon> tjc: the workcache context is the non-sendable part
[23:19:24] <graydon> tjc: it shares access to the db
[23:19:38] <toddaaro> acrichto: ok, do you know how that interacts with libstd/rt/local.rs in the newsched stuff? or have you just never looked at that
[23:19:40] <cmr> What is this workcache thing?
[23:19:41] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[23:19:41] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/4A9hpA
[23:19:41] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[23:19:59] <tjc> graydon: then I'm not sure how to use it given that rustpkg installs packages recursively that it infers from `extern mod` directives
[23:20:05] <graydon> tjc: the block gets sent during Prep::exec, but the rest has to stay behind
[23:20:08] <toddaaro> acrichto: I think that assuming you left the API the same things are no different there
[23:20:19] <acrichto> toddaaro: from what I could tell, the Task struct has a field called 'storage' which is where a ~[] object is stored
[23:20:26] <acrichto> toddaaro: the interface changed slightly for get()
[23:20:55] <acrichto> toddaaro: the main new rt thing was the function newsched_map in local_data_priv.rs
[23:20:56] <toddaaro> this is the old runtime's Task struct?
[23:20:59] <tjc> graydon: that is, I want to cache the output of compile_input (function in rustpkg that compiles one crate) but that recursively calls install, which calls compile_input...
[23:21:02] <tjc> is that clear at all?
[23:21:10] <acrichto> toddaaro: both the old and the new runtime have a location for that pointer
[23:22:33] <cmr> the old visitor interface makes my cry.. the new one is so prettyful
[23:22:36] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[23:22:46] *** Quits: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP) (Ping timeout)
[23:22:50] <graydon> tjc: so, wait, it calls install mid-way-through parsing a crate, to install the dependencies?
[23:23:20] <tjc> graydon: yes. maybe that's not the right way to do it, but that's how the code is structured now...
[23:23:32] <graydon> ok
[23:23:41] <graydon> thinking
[23:24:39] <cmr> Ugh this is going to be hard
[23:24:41] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[23:25:08] *** Joins: fabiand (fabiand@moz-FCBBAF15.adsl.alicedsl.de)
[23:26:19] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[23:27:14] <graydon> tjc: if the context could be sent (or indeed, if the db was .. say .. communicated-with via a channel), then writing idiomatic code would be much nicer?
[23:27:28] <cmr> Ok, so am I understanding correctly that the context and the visitor are passed in a tuple as the last argument to a method in Visitor?
[23:27:29] <tikue> do any iterators need a size_hint fn, or is that some kind of optional?
[23:27:50] *** Quits: eholk (eholk@moz-E3082F2B.uconnect.utah.edu) (Quit: eholk)
[23:27:53] <cmr> tikue: there is a default implementation of it that returns (0, None)
[23:27:57] <tjc> graydon: I think soâ€¦ I mean, I could rewrite it to extract the dependencies first, but even with that, the natural way to do it is following the dependency tree rather than by creating a worklist
[23:28:07] <tikue> cmr: default as in, I can just leave it out?
[23:28:12] <cmr> tikue: yes.
[23:28:16] <cmr> default methods
[23:28:17] <tikue> cmr: thanks :)
[23:28:18] <graydon> tjc: right. and I _want_ you to be able to write it in that style
[23:28:27] <tikue> default methods are magical
[23:28:41] <graydon> tjc: I was just a little thick-headed when writing workcache and didn't think through the recursive case, which is likely quite common
[23:29:03] <graydon> tjc: it's coming from a python project, where they just take locks and .. y'know
[23:29:05] <tjc> graydon: also, if the db was communicated with via a channel, that would be good in and of itself, right? Because otherwise, I'd have to write code to lock it or whatever...
[23:29:29] <graydon> it'll need to lock to exclude other-process access anyways
[23:29:42] <graydon> but yeah, there ought to be only one db open per process. hopefully!
[23:29:43] <tjc> yeah
[23:29:58] <tjc> well, not just one db per process, right?
[23:30:11] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[23:30:14] <tjc> I mean, if there are multiple rustpkg processes, they should all write to the same db
[23:30:22] <tjc> but in some coordinated way
[23:30:26] <graydon> one-writer, yeah
[23:30:30] <tjc> right
[23:32:04] *** Joins: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com)
[23:32:49] *** sam113101 is now known as sam113101_afk
[23:33:04] <doomlord_> http://pastebin.com/q0s0wrx2 <<< does this sort of thing exist, attempt at mirroring c++ stuff.. (i'm seeing how far i can get with C++ interop..)
[23:33:49] <cmr> doomlord_: what sort of thing?
[23:34:22] <graydon> tjc: so yeah, I suppose ctxt should be cloneable, prep should be handled w/o @ entirely too (refer back to its ctxt by &) and db and logger should be channels used to talk to singleton tasks set up when you initialize a ctxt
[23:34:44] <Jeaye> Arguments against @mut?
[23:34:51] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[23:34:53] <Jeaye> I'm currently using it everywhere.
[23:35:00] <cmr> Jeaye: dynamic failure
[23:35:03] <graydon> tjc: which is a lot of work to change. I'm happy to do it, or if you want to do it, feel free. I'm sorry, that's not something I foresaw. I did try to do some of it with & at first, but the compiler was too immature
[23:35:13] <doomlord_> mirror of C++ vector in rust . what I'm about to try in my attempt at a C++ binding generator is translating a few cases of standard tempaltes
[23:35:18] *** Quits: dbaupp (Thunderbir@moz-712A1135.lns20.syd6.internode.on.net) (Ping timeout)
[23:35:21] <Jeaye> But, especially with the new local_data changes, I'm intereted in refactoring.
[23:35:28] <tjc> graydon: No problem in re: you not predicting the future perfectly :-)
[23:35:36] <doomlord_> (C++ vector, and other c++ structures.. mimicking the binary layout)
[23:35:43] <tjc> graydon: I can do it if you're busy with other stuff. Or, if you want to, I have other rustpkg things to work on in the meantime
[23:35:54] <tjc> enough to keep me busy for a few days, I think -- this is sort of orthogonal to almost everything else
[23:36:15] <Jeaye> cmr: Isn't it just like std::shared_ptr? 
[23:36:15] <graydon> tjc: ok. I'll get on it. gives me an excuse to learn how comm works again.
[23:36:25] <graydon> tjc: lemme just write up the benchmarking stuff and new testsuite stuff to the wiki
[23:36:28] <tjc> graydon: ha, ok. and then after that, I can learn how comm works for the first time :-)
[23:36:30] <tjc> no rush
[23:36:31] <graydon> then I'll pick it up tomorrow
[23:38:25] <cmr> Jeaye: dunno, but if you try to borrow it as &mut twice, the process aborts
[23:40:32] *** Joins: Ralith (ralith@moz-50F3C77.vc.shawcable.net)
[23:40:43] <pcwalton> @mut is not evil but it should probably not be used if you can use ~ instead
[23:41:17] <cmr> Jeaye: oh and you can't send it across tasks
[23:41:24] <cmr> maybe or maybe not important
[23:41:26] <cmr> depends on usecase
[23:41:43] <pcwalton> just for efficiency's sake and because static checks are better than dynamic checks
[23:44:39] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[23:46:29] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[23:48:36] <pcwalton> ok, no more OOM on windows
[23:48:38] <pcwalton> time to rebase!
[23:49:18] <bblum> pcwalton: you said there were no parse ambiguities right?
[23:49:31] <pcwalton> I don't think so
[23:49:32] <cmr> http://rustlog.octayn.net/post/55643001633/status-update, 'night all
[23:49:38] <bblum> pcwalton: so if the parser fails to parse something that should be parsed a different way, that's a parser bug, right?
[23:49:48] <bblum> and not, like, a real ambiguity
[23:49:48] <pcwalton> yes I think so
[23:50:43] <ChrisMorgan> Is it planned for the new scheduler/std::rt::io::net to be in and extra::net to be out by 0.8?
[23:50:55] <pcwalton> yes but no guarantees of course
[23:51:02] <ChrisMorgan> Naturally.
[23:51:44] <engla> it would be great to get the new io traits in so everything that depends on it can start rolling. Including fmt! for writers
[23:51:54] <pcwalton> the new I/O traits *are* in
[23:51:59] <pcwalton> but what's missing is disk I/O
[23:52:24] <ChrisMorgan> std::rt::io::net will then be shifted to what: std::io::net? std::net? extra::net?
[23:52:33] <pcwalton> I'm not sure
[23:52:34] <engla> there are some parts missing
[23:53:07] <engla> no .write_str() in rt::io
[23:53:41] <ChrisMorgan> Yeah, I *really* feel the need of that. It can have a default implementation of self.write(s.as_bytes().to_owned()).
[23:54:05] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[23:54:57] <Jeaye> pcwalton: I started using it due to its convenience in being captured for closures. I also don't ever have to think about lifetimes. >.<
[23:55:06] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[23:55:18] <pcwalton> Jeaye: oh, I mean, if it works fine for you then by all means keep using it!
[23:55:19] <bblum> oh good, i'm happy that "&&&" is valid syntax, even though "&&&&" is not
[23:55:25] <ChrisMorgan> extra::net has a TcpSocketBuf which takes care of buffering, so that you can do buf.read_byte() conveniently; new IO doesn't have any such thing, meaning that a single-byte read is more like `let buf = [0u8]; stream.read(buf)`, and very probably not efficient.
[23:55:54] <toddaaro> bblum: what are you doing
[23:56:12] <bblum> toddaaro: finding parser bugs
[23:56:16] <bblum> toddaaro: https://github.com/mozilla/rust/issues/7837
[23:56:19] <toddaaro> fun
[23:56:36] <toddaaro> ecr there is some dicussion of IO library stuff here, maybe you have input
[23:57:24] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Connection reset by peer)
[23:57:57] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[23:58:15] <bblum> pcwalton: do you consider that ^ a bug?
[23:58:33] <pcwalton> yeah, it's not ideal
[23:58:48] <pcwalton> if it can be fixed without making the grammar not LL(1) then I'm ok with fixing it.
