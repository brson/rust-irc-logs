[00:05:37] *** kimundi is now known as zz_kimundi
[00:05:43] *** Quits: aepsil0n (eduard@moz-6491ha.mv2h.pepi.8071.2a02.IP) (Connection closed)
[00:08:10] *** Joins: genbattle (genbattle@moz-4v0.gkd.16.182.IP)
[00:15:21] *** chmanchester is now known as chmanchester|afk
[00:17:53] *** Quits: genbattle (genbattle@moz-4v0.gkd.16.182.IP) (Ping timeout: 121 seconds)
[00:18:19] *** Joins: yjv (yjv@moz-v66.hqu.153.50.IP)
[00:18:35] *** Quits: davebettin (textual@moz-hde.5e5.136.67.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[00:18:57] *** Joins: davebettin (textual@moz-hde.5e5.136.67.IP)
[00:20:13] *** Quits: davebettin (textual@moz-hde.5e5.136.67.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[00:21:44] *** Quits: Rusky (russell@moz-tebhci.slkc.qwest.net) (Quit: Leaving.)
[00:22:59] *** Joins: Rusky (russell@moz-tebhci.slkc.qwest.net)
[00:23:24] <brson> acrichto: do you want to update the cargo that pairs with 1.1?
[00:33:18] *** Joins: aatch (james@moz-c6etfk.fosn.r6an.e000.2406.IP)
[00:37:53] <WindowsBunny> brson: hmmmm, it seems you added nightly msvc cargo, but not a regular msvc cargo buildbot
[00:39:30] <brson> acrichto: ^
[00:44:20] <steveklabnik> brson: acrichto and i are in a podcast thing right now
[00:44:25] <steveklabnik> so he might take 15 or 20 to get back to you
[00:45:08] <WindowsBunny> Oh man, I want to listen to this podcast D:
[00:46:07] *** Joins: woboats (tatterdemal@moz-c1pqg7.ca.charter.com)
[00:46:45] *** Joins: dinfuehr (dinfuehr@moz-92ob90.highway.telekom.at)
[00:47:04] *** Joins: brson_ (brson@moz-cfhap5.mtv2.mozilla.com)
[00:48:00] *** Quits: brson (brson@moz-esl.4cu.229.94.IP) (Ping timeout: 121 seconds)
[00:50:52] *** Quits: dinfuehr (dinfuehr@moz-92ob90.highway.telekom.at) (Ping timeout: 121 seconds)
[00:50:53] *** Quits: swgillespie (swgillespie@moz-o29.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[00:54:04] *** Quits: brson_ (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[00:54:13] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[00:54:14] *** ChanServ sets mode: +o brson
[01:01:20] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[01:03:59] *** Quits: Centril (mazdakf@moz-nd3gjf.edstud.chalmers.se) (Ping timeout: 121 seconds)
[01:05:11] *** Quits: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net) (Connection closed)
[01:07:10] *** Joins: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net)
[01:09:00] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[01:10:15] *** Quits: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net) (Connection closed)
[01:15:09] <aatch> eddyb, so my load eliding thing only actually seems to do anything in non-optimised builds, so not really worth the effort.
[01:16:22] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[01:19:21] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[01:23:11] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[01:23:34] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[01:29:58] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[01:30:04] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[01:31:44] *** Quits: erickt (erickt@moz-e9g.jg6.129.64.IP) (Ping timeout: 121 seconds)
[01:32:44] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[01:33:08] *** Joins: Barca (Mibbit@moz-j9a.ns7.133.129.IP)
[01:36:12] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[01:46:51] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[01:47:30] *** Joins: dinfuehr (dinfuehr@moz-92ob90.highway.telekom.at)
[01:49:36] *** Quits: nham (nham@moz-lglsfe.il.comcast.net) (Ping timeout: 121 seconds)
[01:49:46] *** Joins: bkoropoff (bkoropoff@moz-kthi5c.wa.comcast.net)
[01:51:38] *** Quits: dinfuehr (dinfuehr@moz-92ob90.highway.telekom.at) (Ping timeout: 121 seconds)
[01:53:04] *** Joins: genbattle (genbattle@moz-4v0.gkd.16.182.IP)
[01:56:39] *** Joins: zxq9 (ceverett@moz-qsm369.mesh.ad.jp)
[02:08:16] *** Joins: nham (nham@moz-lglsfe.il.comcast.net)
[02:13:43] *** Joins: blaenk (blaenkdenum@moz-ggnkpd.res.rr.com)
[02:24:53] <Luqman> aatch: well, non-optimised build time improvements are good too
[02:29:41] <aatch> Luqman, doesn't really impact build time as it it'd only improve optimisation time due to there being less IR.
[02:30:08] <aatch> Luqman, I guess it'd improve non-opt performance slightly.
[02:30:15] <Luqman> aatch: that's what i meant, less ir -> less time spent in llvm
[02:30:40] <aatch> Luqman, yeah, but if I turn optimisations on, my code doesn't actually get triggered.
[02:31:35] <Luqman> oh? why not
[02:33:14] <aatch> Luqman, probably because of optimisations related to allocas. I'm sure my case would be triggered some of the time, but since it isn't in a ~5Kloc projects suggests that it's not common enough to worry about.
[02:34:48] <aatch> Luqman, chances are that my improvements to handling function calls with immediate returns means that all the previous store/load pairs aren't actually emitted now.
[02:36:35] *** Joins: davebettin (textual@moz-ip635p.or.comcast.net)
[02:48:15] *** Joins: dinfuehr (dinfuehr@moz-92ob90.highway.telekom.at)
[02:50:21] <blaenk> ugggghhh an ice on the stable compiler is killing me cause I can't track it down
[02:52:23] *** Quits: dinfuehr (dinfuehr@moz-92ob90.highway.telekom.at) (Ping timeout: 121 seconds)
[02:57:32] *** Quits: zz_kimundi (kimundi@moz-01l8sd.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:58:40] *** Joins: zz_kimundi (kimundi@moz-cak2a8.dip0.t-ipconnect.de)
[02:58:41] *** zz_kimundi is now known as kimundi
[03:05:19] <kmc> try afl :)
[03:05:50] *** Quits: yjv (yjv@moz-v66.hqu.153.50.IP) (Connection closed)
[03:06:09] *** Quits: noustuff (sid82844@moz-0s5vdk.highgate.irccloud.com) (Connection closed)
[03:06:09] *** Quits: balpert_ (sid15886@moz-lhm6i8.highgate.irccloud.com) (Connection closed)
[03:06:10] *** Quits: jack (sid19593@moz-fhlsm9.highgate.irccloud.com) (Connection closed)
[03:06:10] *** Quits: huhlig (sid17687@moz-mt3sa2.highgate.irccloud.com) (Connection closed)
[03:06:10] *** Quits: pkondzior (sid768@moz-nrgp4s.highgate.irccloud.com) (Connection closed)
[03:06:10] *** Quits: vadimcn (uid46608@moz-0d43u8.highgate.irccloud.com) (Connection closed)
[03:06:10] *** Quits: steshaw (sid30841@moz-mij4a1.highgate.irccloud.com) (Connection closed)
[03:06:50] *** Quits: davebettin (textual@moz-ip635p.or.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[03:07:48] *** Quits: wycats (sid79@moz-b4lrm3.brockwell.irccloud.com) (Connection closed)
[03:07:48] *** Quits: reem (sid78397@moz-octfcu.brockwell.irccloud.com) (Connection closed)
[03:07:48] *** Quits: mno2 (sid33176@moz-nd1l6h.brockwell.irccloud.com) (Connection closed)
[03:07:49] *** Quits: zrl (sid22717@moz-0oej6h.brockwell.irccloud.com) (Connection closed)
[03:07:49] *** Quits: spastorino (sid27384@moz-i6sgse.brockwell.irccloud.com) (Connection closed)
[03:07:49] *** Quits: jvns (sid26231@moz-p7mvuh.brockwell.irccloud.com) (Connection closed)
[03:07:49] *** Quits: thombles (sid25752@moz-4st7e1.brockwell.irccloud.com) (Connection closed)
[03:07:50] *** Quits: carllerche (sid50851@moz-8i75uq.brockwell.irccloud.com) (Connection closed)
[03:07:50] *** Quits: frewsxcv (sid86219@moz-dneii9.brockwell.irccloud.com) (Connection closed)
[03:07:52] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Connection closed)
[03:09:33] *** Quits: aturon (sid36348@moz-n3h4qj.brockwell.irccloud.com) (Quit: X_X)
[03:11:02] *** Joins: p1start (p1start@moz-nftjhe.org)
[03:20:41] <bkoropoff> panics are really cramping my style
[03:22:36] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[03:23:02] *** Quits: Barca (Mibbit@moz-j9a.ns7.133.129.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[03:23:21] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Ping timeout: 121 seconds)
[03:24:00] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[03:27:35] *** Joins: semarie (semarie@moz-ojjbdf.torservers.net)
[03:29:50] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[03:29:50] *** ChanServ sets mode: +ao erickt erickt
[03:33:21] *** Joins: grant (grant@moz-jfh.0nq.187.64.IP)
[03:42:26] *** Quits: Rym (uid91135@moz-n2i7qm.charlton.irccloud.com) (Quit: Connection closed for inactivity)
[03:42:39] *** Joins: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP)
[03:43:01] <grant> How can I get the first char in a &str ?
[03:45:30] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[03:46:45] *** Joins: davebettin (textual@moz-ip635p.or.comcast.net)
[03:48:21] *** Quits: davebettin (textual@moz-ip635p.or.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[03:49:00] *** Joins: dinfuehr (dinfuehr@moz-92ob90.highway.telekom.at)
[03:50:43] <grant> Sorry, wrong channel ;D
[03:53:03] *** Quits: dinfuehr (dinfuehr@moz-92ob90.highway.telekom.at) (Ping timeout: 121 seconds)
[03:55:11] *** Joins: _Vi (vi@moz-bbs.vhj.131.104.IP)
[03:58:24] *** Joins: meteredsection (meteredsect@moz-k1pkr3.wa.comcast.net)
[03:58:39] *** Quits: det (chris@moz-6q2one.lv.cox.net) (Connection closed)
[04:10:22] *** Quits: O01eg (o01eg@moz-ske7gn.t702.4n8f.2698.2a02.IP) (Client exited)
[04:14:44] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[04:14:45] *** Joins: det (chris@moz-6q2one.lv.cox.net)
[04:29:18] *** Joins: mib_kltup1 (Mibbit@moz-g6k.oht.161.46.IP)
[04:31:08] *** Quits: genbattle (genbattle@moz-4v0.gkd.16.182.IP) (Connection closed)
[04:45:50] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[04:49:09] *** Joins: dcb (textual@moz-j72nfe.ca.comcast.net)
[04:49:46] *** Joins: dinfuehr (dinfuehr@moz-92ob90.highway.telekom.at)
[04:53:53] *** Quits: dinfuehr (dinfuehr@moz-92ob90.highway.telekom.at) (Ping timeout: 121 seconds)
[04:59:55] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[05:01:14] *** Quits: Diggsey (diggsey@moz-v5rln7.dsl.pipex.com) (Ping timeout: 121 seconds)
[05:03:01] *** Quits: dcb (textual@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[05:03:43] *** Quits: ytain (ytain@moz-o0gerq.dsl.teksavvy.com) (Quit: Textual IRC Client: www.textualapp.com)
[05:04:22] <blaenk> kmc: afl could help pinpoint something like that?
[05:04:53] <XMPPwocky> blaenk: afl-tmin probably could, yes
[05:05:05] <blaenk> thanks wocky
[05:05:23] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[05:08:24] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[05:23:46] *** Quits: woboats (tatterdemal@moz-c1pqg7.ca.charter.com) (Quit: Leaving)
[05:24:37] *** Quits: Rusky (russell@moz-tebhci.slkc.qwest.net) (Ping timeout: 121 seconds)
[05:26:05] *** Joins: achanda (achanda@moz-6gu.gg6.21.113.IP)
[05:36:54] *** Quits: achanda (achanda@moz-6gu.gg6.21.113.IP) (Connection closed)
[05:38:57] *** Joins: Rusky (russell@moz-guv0b7.slkc.qwest.net)
[05:42:03] *** Joins: James (quassel@moz-8qs8a3.range86-148.btcentralplus.com)
[05:43:21] *** Joins: mib_d6emp4 (Mibbit@moz-hu6.nja.252.72.IP)
[05:48:05] *** Quits: mib_d6emp4 (Mibbit@moz-hu6.nja.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[05:58:13] <SimonSapin> Is this an intermittent failure? https://github.com/rust-lang/rust/pull/26039#issuecomment-110233740
[06:03:26] *** Joins: brandonson (brandonson@moz-sunivd.bchsia.telus.net)
[06:04:32] *** Joins: pkondzior (sid768@moz-nrgp4s.highgate.irccloud.com)
[06:05:57] *** Quits: c0170_ (c0170@moz-4stj9o.cable.virginm.net) (Ping timeout: 121 seconds)
[06:06:05] *** Joins: wycats (sid79@moz-b4lrm3.brockwell.irccloud.com)
[06:06:05] *** ChanServ sets mode: +o wycats
[06:07:27] *** Quits: aatch (james@moz-c6etfk.fosn.r6an.e000.2406.IP) (Connection closed)
[06:08:27] *** Joins: balpert_ (sid15886@moz-lhm6i8.highgate.irccloud.com)
[06:13:51] *** Joins: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP)
[06:15:53] <Murarth> Just a curiosity: What do "opt" and "nopt-t" refer to in the build bot platforms?
[06:17:28] *** Joins: huhlig (sid17687@moz-mt3sa2.highgate.irccloud.com)
[06:20:05] <Manishearth> optimized, no optimized+test
[06:20:08] <Manishearth> i think
[06:21:14] <Murarth> Ah, cool.
[06:22:37] *** Joins: jack (sid19593@moz-fhlsm9.highgate.irccloud.com)
[06:26:27] *** Joins: c0170 (c0170@moz-bb29a4.cambridge.arm.com)
[06:26:31] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[06:26:39] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[06:31:40] *** Joins: Johannes (Johannes@moz-4et8d7.ocn.ne.jp)
[06:32:09] *** Joins: erz (erz@moz-fiq1tl.broadband.corbina.ru)
[06:32:35] *** Quits: zwarich (sid63988@moz-402giv.ealing.irccloud.com) (Ping timeout: 121 seconds)
[06:32:36] *** Joins: zrl (sid22717@moz-0oej6h.brockwell.irccloud.com)
[06:32:50] *** Joins: skeuomorf (skeuomorf@moz-d3l.n1e.32.197.IP)
[06:33:02] *** Quits: stask (sid61294@moz-0bjq4h.ealing.irccloud.com) (Ping timeout: 121 seconds)
[06:33:06] *** Quits: dherman (sid7996@moz-u0jlif.ealing.irccloud.com) (Ping timeout: 121 seconds)
[06:33:43] *** Quits: lkuper (sid44041@moz-7edef8.ealing.irccloud.com) (Ping timeout: 121 seconds)
[06:34:38] *** Quits: joh (uid13099@moz-2c7ap3.ealing.irccloud.com) (Ping timeout: 121 seconds)
[06:37:39] *** Joins: thombles (sid25752@moz-4st7e1.brockwell.irccloud.com)
[06:38:15] *** Joins: jvns (sid26231@moz-p7mvuh.brockwell.irccloud.com)
[06:39:30] *** Joins: spastorino (sid27384@moz-i6sgse.brockwell.irccloud.com)
[06:39:57] *** Joins: squiddy (squiddy@moz-md4.pm3.19.178.IP)
[06:40:01] *** Joins: steshaw (sid30841@moz-mij4a1.highgate.irccloud.com)
[06:40:32] <doener> Murarth, Manishearth: only the nopt-t means that the tests are compiled without optimizations, the compiler is still optimized
[06:40:46] <doener> s/only//
[06:41:36] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[06:45:07] *** Joins: mno2 (sid33176@moz-nd1l6h.brockwell.irccloud.com)
[06:46:41] *** Joins: eibwen (eibwen@moz-slg8kg.dip0.t-ipconnect.de)
[06:47:48] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[06:47:53] *** flaper87_ is now known as flaper87
[06:48:29] *** Joins: aturon (sid36348@moz-n3h4qj.brockwell.irccloud.com)
[06:48:29] *** ChanServ sets mode: +o aturon
[06:49:24] <Mutabah> Anyone know where to look for TLS configuration (i.e. where rustc tells llvm what TLS configuration to use, if such thing exists)
[06:50:59] *** Quits: eibwen (eibwen@moz-slg8kg.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[06:53:24] *** Quits: ggherdov_ (sid11402@moz-u71qnt.charlton.irccloud.com) (Connection closed)
[06:53:24] *** Quits: jroesch (sid26078@moz-o13a59.charlton.irccloud.com) (A TLS packet with unexpected length was received.)
[06:53:24] *** Quits: crail (sid24674@moz-s17jb5.charlton.irccloud.com) (A TLS packet with unexpected length was received.)
[06:53:24] *** Quits: Fenhl (sid30770@moz-oh0hem.charlton.irccloud.com) (A TLS packet with unexpected length was received.)
[06:53:25] *** Quits: Gankro (sid71432@moz-sc2bd6.charlton.irccloud.com) (A TLS packet with unexpected length was received.)
[06:54:34] *** Quits: James (quassel@moz-8qs8a3.range86-148.btcentralplus.com) (Ping timeout: 121 seconds)
[06:55:46] *** Joins: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP)
[06:58:03] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[06:59:06] *** Joins: vadimcn (uid46608@moz-0d43u8.highgate.irccloud.com)
[07:00:19] <aatch> Mutabah, we just tell LLVM that a given global is threadlocal, that's it as far as I know.
[07:00:27] <aatch> Mutabah, the rest is all handled by LLVM
[07:02:56] *** Quits: brandonson (brandonson@moz-sunivd.bchsia.telus.net) (Connection closed)
[07:05:43] *** Quits: elif (chatzilla@moz-ev8m1p.res.rr.com) (Ping timeout: 121 seconds)
[07:08:16] <Manishearth> ah
[07:08:54] *** Joins: carllerche (sid50851@moz-8i75uq.brockwell.irccloud.com)
[07:11:11] *** Quits: c74d (c74d3a4ebb6@moz-0ersgu.oc.cox.net) (Connection closed)
[07:12:17] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[07:12:17] *** Joins: c74d (c74d3a4ebb6@moz-0ersgu.oc.cox.net)
[07:12:49] <Mutabah> aatch: Hmm... thanks
[07:12:57] <Mutabah> Time to go digging through LLVM I guess
[07:13:12] <Mutabah> (It's using FS for the TLS base, I want GS, and it looks like GS is what _should_ be used)
[07:13:52] *** Joins: ggherdov_ (sid11402@moz-u71qnt.charlton.irccloud.com)
[07:15:31] *** Joins: dherman (sid7996@moz-u0jlif.ealing.irccloud.com)
[07:19:55] *** Joins: joh (uid13099@moz-2c7ap3.ealing.irccloud.com)
[07:22:34] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Connection closed)
[07:22:48] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[07:23:25] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[07:26:23] *** Joins: crail (sid24674@moz-s17jb5.charlton.irccloud.com)
[07:27:37] *** Joins: jroesch (sid26078@moz-o13a59.charlton.irccloud.com)
[07:28:11] *** Quits: bkoropoff (bkoropoff@moz-kthi5c.wa.comcast.net) (Ping timeout: 121 seconds)
[07:28:51] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[07:29:00] *** Joins: achanda (achanda@moz-6gu.gg6.21.113.IP)
[07:31:02] *** Joins: Fenhl (sid30770@moz-oh0hem.charlton.irccloud.com)
[07:32:43] *** Joins: reem (sid78397@moz-octfcu.brockwell.irccloud.com)
[07:35:37] *** Quits: meteredsection (meteredsect@moz-k1pkr3.wa.comcast.net) (Ping timeout: 121 seconds)
[07:36:18] *** Joins: noustuff (sid82844@moz-0s5vdk.highgate.irccloud.com)
[07:36:46] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[07:37:17] *** Joins: frewsxcv (sid86219@moz-dneii9.brockwell.irccloud.com)
[07:42:54] *** Joins: lkuper (sid44041@moz-7edef8.ealing.irccloud.com)
[07:51:03] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[07:51:15] *** Quits: erz (erz@moz-fiq1tl.broadband.corbina.ru) (Quit: My Mac has gone to sleep. ZZZzzz…)
[07:54:04] *** Joins: stask (sid61294@moz-0bjq4h.ealing.irccloud.com)
[07:56:26] *** Quits: njn (chatzilla@moz-c6c476.iinet.net.au) (Quit: ChatZilla 0.9.91.1 [Firefox 41.0a1/20150531163607])
[07:58:06] *** Joins: zwarich (sid63988@moz-402giv.ealing.irccloud.com)
[07:58:10] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[07:59:29] *** Joins: Gankro (sid71432@moz-sc2bd6.charlton.irccloud.com)
[07:59:57] *** Quits: grant (grant@moz-jfh.0nq.187.64.IP) (Client exited)
[08:00:14] *** Joins: grant (grant@moz-jfh.0nq.187.64.IP)
[08:00:42] *** Quits: grant (grant@moz-jfh.0nq.187.64.IP) (Client exited)
[08:01:43] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[08:01:43] *** ChanServ sets mode: +ao erickt erickt
[08:02:51] <aatch> nrc, eddyb, ping
[08:03:19] <nrc> aatch: pong
[08:03:46] *** Quits: Kingsquee (kingsley@moz-3fm07c.bchsia.telus.net) (Quit: Konversation terminated!)
[08:03:48] <aatch> nrc, I'm having some issues with CoerceUnsized and/or Unsize
[08:04:02] <aatch> nrc, I'm not sure if it's a missing feature or me doing something wrong.
[08:04:54] *** Joins: imperio (Mibbit@moz-aibeqg.fbx.proxad.net)
[08:04:59] <imperio> steveklabnik: ping
[08:05:13] <nrc> aatch:  you're going to have to tell me more than that :-)
[08:05:35] <aatch> nrc, yep, I just realised that I didn't actually finish writing the exmaple.
[08:05:50] <nrc> heh
[08:05:50] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[08:06:58] <aatch> nrc, so this: https://play.rust-lang.org/?gist=911ba8015e9cccfc1a93&version=nightly
[08:07:25] <aatch> If I don't have the maybe-fat pointer in there, it works as expected.
[08:08:47] <nrc> aatch: this is expected behaviour (although perhaps not forever). Unsizing only tries to unsize a single field, never multiple
[08:08:55] <nrc> this looks like two fields need unsizing
[08:09:49] <aatch> nrc, yeah, well sort of. the first needs "fattening" which is similar I guess.
[08:10:18] <nrc> yeah, I guess I mean any adjustment - only one field can be changed in any way - either fattening or unsizing
[08:10:51] *** Joins: munksgaard (munksgaard@moz-33d.hq0.225.130.IP)
[08:11:11] <aatch> nrc, I'm trying to make a heterogenous linked-list, so each node is an unsized type.
[08:13:41] *** Quits: achanda (achanda@moz-6gu.gg6.21.113.IP) (Connection closed)
[08:14:23] <aatch> I might just hack around it by manually unpacking the trait object, if needed.
[08:14:36] <nrc> I suspect we don't have a good answer for that. We could extend the unsizing adjustments to multiple fields in the future
[08:21:19] <aatch> Hmm, it's really hacky, but I might be able to effectively do the unsizing manually. Since it doesn't complain at me, I assume we'll happy allow a type like I showed to exist, you just can't construct it, right?
[08:21:54] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[08:22:09] *** Quits: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au) (Ping timeout: 121 seconds)
[08:22:36] *** Joins: laumann (thomas@moz-gqpfnm.science.ku.dk)
[08:24:47] <nrc> I think so, yes
[08:30:07] <aatch> Mwahaha! It works!
[08:31:02] <aatch> I can take advantage of the fact I don't need a real pointer for the first field and use a proxy so only one field needs to be adjusted.
[08:31:10] <aatch> It's incredibly hacky, but it works.
[08:31:30] <nrc> that sounds evil :-)
[08:33:19] *** Joins: bjz (bjz@moz-puppgq.tpgi.com.au)
[08:34:05] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[08:34:13] <aatch> nrc, https://play.rust-lang.org/?gist=32c6374f20248da6574e&version=nightly
[08:35:04] <nrc> neat
[08:35:05] <aatch> I'm personally a fan of "is_sized"
[08:35:07] <nrc> but evil
[08:36:48] *** Joins: achanda (achanda@moz-6gu.gg6.21.113.IP)
[08:39:03] <aatch> Ah, phew, the pointer methods work on fat pointers too.
[08:39:45] <aatch> Or not...
[08:40:00] <aatch> at least, `is_null` doesn't.
[08:40:25] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Connection closed)
[08:40:47] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[08:42:38] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[08:44:54] *** Joins: vmx (vmx@moz-785ldp.pools.vodafone-ip.de)
[08:52:12] *** Quits: stl (stl@moz-6r1bf1.broadband.corbina.ru) (Ping timeout: 121 seconds)
[08:53:18] *** Joins: erz (erz@moz-fiq1tl.broadband.corbina.ru)
[08:55:41] <aatch> Hmm, it's kinda annoying that there's no T -> T Unsize impl.
[08:55:47] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[08:59:04] *** Joins: aepsil0n (eduard@moz-gtoi2p.hsi8.kabel-badenwuerttemberg.de)
[08:59:42] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[09:00:03] <aatch> nrc, is there a reason to not allow a no-op Unsize?
[09:00:17] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[09:00:23] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[09:00:35] <aatch> I mean, I guess it technically isn't "unsizing" at that point, but it'd be rather useful.
[09:04:45] <nrc> I think we basically wanted a maximally minimal design, so things like no-op unsize and multiple fields weren't included. I'm not aware of any reason not to have such things in the future
[09:05:42] *** Joins: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP)
[09:07:39] <aatch> nrc, cool, it's just that in my example, you can't actually make a Box<Foo<U>> with a sized U because there's no `T : Unsize<T>`.
[09:08:06] *** Joins: stl (stl@moz-o95.t8r.15.176.IP)
[09:10:04] *** Quits: nham (nham@moz-lglsfe.il.comcast.net) (Quit: leaving)
[09:22:52] *** Quits: _Vi (vi@moz-bbs.vhj.131.104.IP) (Ping timeout: 121 seconds)
[09:26:36] *** Quits: bdero (bran@moz-lbs.91h.47.73.IP) (Connection closed)
[09:36:36] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[09:47:04] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[09:51:00] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[09:56:08] *** Quits: achanda (achanda@moz-6gu.gg6.21.113.IP) (Quit: Leaving...)
[09:58:50] <eddyb> aatch: nice existential type :P
[09:59:34] <eddyb> sadly, substituting T for Trait in your node type doesn't do what you want
[09:59:44] <eddyb> which is exists T: Trait.Node<T>
[10:00:14] <aatch> eddyb, nah, that's not what I'm going for. I want to have different concrete types.
[10:00:19] <eddyb> oh
[10:00:36] <eddyb> but you're using the same T
[10:00:50] <aatch> eddyb, yeah, they all have to share a trait.
[10:01:20] <eddyb> this works http://is.gd/5aDkTM
[10:02:33] <eddyb> http://is.gd/EoTD7n
[10:02:42] <eddyb> how come this needs no feature flags?
[10:03:22] <eddyb> aatch: anyways, you create Foo<Trait, T> and then coerce it to Foo<Trait>
[10:03:57] <eddyb> you just need the "next" field type to remain constant because you can't fatten it
[10:04:15] <eddyb> (without moving data around)
[10:04:33] <aatch> eddyb, yeah, that's basically what i did with my hacky proxy types.
[10:06:37] <eddyb> aatch: but you don't have to be hacky
[10:06:51] *** Quits: skeuomorf (skeuomorf@moz-d3l.n1e.32.197.IP) (Ping timeout: 121 seconds)
[10:07:05] <eddyb> it's just that your Foo definition expressed something which wasn't what you wanted :P
[10:08:06] <aatch> Hmm, since `Foo` is just a placeholder for the Node type, and the Node type is internal anyway, the extra param isn't an issue either.
[10:12:20] <eddyb> aatch: http://is.gd/92Oclz :D
[10:12:31] <eddyb> that is probably closer to what you want
[10:13:27] *** Joins: skeuomorf (skeuomorf@moz-94j.0m1.32.197.IP)
[10:17:11] <aatch> eddyb, sweet, it even works for the doubly-linked case I actually have.
[10:18:23] *** Quits: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP) (Connection closed)
[10:19:28] <eddyb> aatch: between that and bkoropoff's dequeue of unsized values with only one usize of overhead per element...
[10:19:44] <eddyb> aatch: we're starting to have some interesting alternatives to Vec<Box<Trait>> :D
[10:20:16] <aatch> eddyb, heh, that was kinda what prompted me to investigate this.
[10:21:09] <aatch> This has more overhead per element, but you can freely modify it.
[10:21:24] <eddyb> next up, HashMap<K, SmallUnsized<Trait, [u8; 128]>>
[10:23:03] <aatch> The overhead per element here is actually kinda steep, 4 words per node, two for the fat next pointer, two for the fat prev pointer, but there's not really any other way to do it.
[10:23:13] <eddyb> aatch: yes there is :P
[10:23:19] <eddyb> xor lists
[10:23:30] <aatch> eddyb, xor lists?
[10:23:45] <eddyb> (thanks to bkoropoff and cmr, I now know this apparently common data structure)
[10:24:56] <eddyb> aatch: https://en.wikipedia.org/wiki/XOR_linked_list
[10:26:39] *** Quits: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP) (Connection closed)
[10:30:28] <aatch> eddyb, I might look into that then. I could probably apply the same operation to the second word (if there is one) and get the overhead down to two words, which is the same as regular doubly-linked list.
[10:30:50] *** Joins: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP)
[10:37:11] <aatch> heh, pop_{front,back} are tricky to do in a way that doesn't suck for the user. I can't return a `Box<T>` because I don't *have* a Box<T>, I have a Box<Node<T>>.
[10:37:33] *** Joins: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP)
[10:41:26] *** Quits: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP) (Connection closed)
[10:41:46] *** Joins: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP)
[10:42:01] *** Quits: Viewtiful (Viewtiful@moz-eub.afi.30.89.IP) (Quit: Leaving...)
[10:42:01] *** Quits: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP) (Connection closed)
[10:42:19] *** Joins: skeuomor1 (skeuomorf@moz-3l1.21q.32.197.IP)
[10:42:22] *** Joins: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP)
[10:42:39] *** Quits: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP) (Connection closed)
[10:44:14] *** Joins: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP)
[10:44:26] *** Quits: skeuomorf (skeuomorf@moz-94j.0m1.32.197.IP) (Ping timeout: 121 seconds)
[10:46:19] *** Quits: nmatsakis (nmatsakis@moz-no0.93r.245.63.IP) (Ping timeout: 121 seconds)
[10:46:41] <eddyb> aatch: the solution for the dequeue stuff was front/back accessors and drop_{front,back}
[10:46:54] <eddyb> well, I bet he named them pop instead of drop but drop came to me right now
[10:47:06] *** Joins: nmatsakis (nmatsakis@moz-no0.93r.245.63.IP)
[10:47:06] *** ChanServ sets mode: +o nmatsakis
[10:47:10] <eddyb> aatch: if you want you can make a wrapper around Box<Node<T>>
[10:47:15] <aatch> eddyb, I'm returning a custom smart pointer.
[10:47:17] <eddyb> with DerefMut impl
[10:48:07] *** Quits: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP) (Connection closed)
[10:48:09] <aatch> So far I'm impressed, all of the bugs I've run into have been logic errors.
[10:49:25] *** Joins: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP)
[10:51:20] *** Quits: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP) (Connection closed)
[10:56:08] *** Joins: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP)
[10:57:49] <aatch> Well apparently trying to compare two fat pointers just ICEs
[10:59:39] *** Quits: joh (uid13099@moz-2c7ap3.ealing.irccloud.com) (Quit: Connection closed for inactivity)
[11:09:51] *** Joins: ChrisMorgan (ChrisMorgan@moz-mpe2k5.tpgi.com.au)
[11:11:27] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[11:18:19] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[11:23:53] *** Joins: mgottschlag (quassel@moz-7o2mv6.qiv1.bbcb.1398.2a00.IP)
[11:24:57] *** Joins: summerlight (summerlight@moz-99k.2mj.130.121.IP)
[11:28:48] *** Joins: harrisonclarke (harrisoncla@moz-4lq79j.eastlink.ca)
[11:50:32] *** Quits: vmx (vmx@moz-785ldp.pools.vodafone-ip.de) (Quit: Leaving)
[11:54:15] *** Quits: Johannes (Johannes@moz-4et8d7.ocn.ne.jp) (Connection closed)
[11:54:15] *** Quits: harrisonclarke (harrisoncla@moz-4lq79j.eastlink.ca) (Connection closed)
[11:54:36] *** Joins: harrisonclarke (harrisoncla@moz-4lq79j.eastlink.ca)
[11:58:58] *** Quits: harrisonclarke (harrisoncla@moz-4lq79j.eastlink.ca) (Ping timeout: 121 seconds)
[12:13:38] *** Joins: mukilan (mukilan@moz-5ke.d4s.164.122.IP)
[12:16:53] *** Quits: ChrisMorgan (ChrisMorgan@moz-mpe2k5.tpgi.com.au) (Ping timeout: 121 seconds)
[12:16:58] *** Joins: ytain (ytain@moz-o0gerq.dsl.teksavvy.com)
[12:20:51] *** Quits: squiddy (squiddy@moz-md4.pm3.19.178.IP) (Quit: Leaving)
[12:28:27] *** Joins: _Vi (vi@moz-bbs.vhj.131.104.IP)
[12:33:28] *** Joins: Sho (sho@moz-gjv.vr1.28.5.IP)
[12:34:26] *** Joins: vmx (vmx@moz-1r97pt.dip0.t-ipconnect.de)
[12:46:44] *** Joins: bdero (bran@moz-e4f4ei.mit.edu)
[13:00:23] *** Quits: mgottschlag (quassel@moz-7o2mv6.qiv1.bbcb.1398.2a00.IP) (Ping timeout: 121 seconds)
[13:02:54] *** Joins: froglegstew (Mibbit@moz-hu6.nja.252.72.IP)
[13:04:02] <WindowsBunny> buildbot has nothing to do D:
[13:04:09] <WindowsBunny> Someone r+ something
[13:05:59] <eddyb> aatch: yeah, I saw that :/
[13:06:09] <eddyb> aatch: I don't even know how I get the data pointer in Rc
[13:07:05] <eddyb> https://github.com/rust-lang/rust/blob/master/src/liballoc/rc.rs#L423-L424
[13:07:06] <eddyb> hahahaha
[13:07:22] <eddyb> I think I wrote that and nobody thought it was weird or bad
[13:07:32] <aatch> eddyb, that's what I'm doing
[13:07:38] <eddyb> playbot: &() as &Send as *const Send as *const u8
[13:07:39] -playbot- <anon>:9:9: 9:49 error: illegal cast; cast from fat pointer: `*const core::marker::Send` as `*const u8`
[13:07:39] -playbot- <anon>:9         &() as &Send as *const Send as *const u8
[13:07:39] -playbot- output truncated; full output at: http://bit.ly/1FOllxS
[13:07:44] <eddyb> hmm
[13:07:45] <WindowsBunny> eddyb: that code looks hideous :D
[13:07:56] <eddyb> how does ptr as *mut u8 work?
[13:08:00] <eddyb> I don't understand
[13:08:03] <eddyb> oh dear
[13:08:12] <eddyb> this is ariel's fault
[13:08:56] <eddyb> playbot: fn data_ptr<T: ?Sized>(x: &T) -> *const u8 { x as *const _ as *const u8 } data_ptr(&() as &Send)
[13:08:57] -playbot- <anon>:9:54: 9:80 error: illegal cast; cast from fat pointer: `*const T` as `*const u8`
[13:08:58] -playbot- <anon>:9         fn data_ptr<T: ?Sized>(x: &T) -> *const u8 { x as *const _ as *const u8 } data_ptr(&() as &Send)
[13:08:58] -playbot- output truncated; full output at: http://bit.ly/1IBmEao
[13:09:07] <eddyb> wat
[13:09:37] <eddyb> playbot: struct Foo<T: ?Sized>(T); fn data_ptr<T: ?Sized>(x: &T) -> *const u8 { x as *const _ as *const u8 } data_ptr(&Foo(()) as &Foo<Send>)
[13:09:38] -playbot- <anon>:9:80: 9:106 error: illegal cast; cast from fat pointer: `*const T` as `*const u8`
[13:09:38] -playbot- <anon>:9         struct Foo<T: ?Sized>(T); fn data_ptr<T: ?Sized>(x: &T) -> *const u8 { x as *const _ as *const u8 } data_ptr(&Foo(()) as &Foo<Send>)
[13:09:38] -playbot- output truncated; full output at: http://bit.ly/1FOlFNc
[13:09:47] <eddyb> playbot: struct Foo<T: ?Sized>(T); fn data_ptr<T: ?Sized>(x: &Foo<T>) -> *const u8 { x as *const _ as *const u8 } data_ptr(&Foo(()) as &Foo<Send>)
[13:09:47] <aatch> eddyb, you're trying to cast a fat pointer to a regular one.
[13:09:48] -playbot- output truncated; full output at: http://bit.ly/1IBmWht
[13:09:58] <eddyb> aatch: so does Rc's Drop impl
[13:10:03] <eddyb> look at it
[13:10:16] <eddyb> wait
[13:10:27] <eddyb>     _ptr: NonZero<*mut RcBox<T>>,
[13:10:33] <eddyb> yeah, I'm not crazy
[13:10:47] <eddyb> it casts *mut RcBox<T> to *mut u8 where T: ?Sized
[13:10:48] <aatch> eddyb, no, it's casting a &*mut RcBox<T>
[13:11:26] <eddyb> aatch: what?
[13:11:49] <eddyb> ptr: *mut RcBox<T>
[13:12:02] <eddyb> look at the size_of_val and drop_in_place calls
[13:12:12] <aatch> eddyb, `ptr` is *mut RcBox<T>, it does `&ptr as *const _ as *const *const ()`
[13:13:25] <eddyb> aatch: not that
[13:13:34] <eddyb> https://github.com/rust-lang/rust/blob/master/src/liballoc/rc.rs#L435
[13:13:54] <eddyb> and, well
[13:13:56] <eddyb> ptr as *const () as usize != mem::POST_DROP_USIZE
[13:13:59] <eddyb> that also works
[13:14:32] <eddyb> so my hack for is_null shouldn't be needed
[13:14:46] <eddyb> actually, it should be removed because nulling a Rc shouldn't prevent drop anymore
[13:15:11] <eddyb> which is a good thing as far as NonZero is concerned
[13:15:57] <eddyb> OH
[13:16:01] <eddyb> aatch: we've been testing this on stable
[13:16:16] <eddyb> aatch: pointer casts from unsized to sized are allowed now
[13:16:28] <aatch> arglebaraiojgrawefwagoijea!
[13:16:30] <eddyb> playbot should be named playstable
[13:16:58] <eddyb> I personally would like rs-stable and rs-nightly
[13:17:30] <eddyb> and the "lite" mode should be a prefix or something
[13:17:52] <eddyb> playbot: #lite fn main() {}
[13:17:53] -playbot- <anon>:9:10: 9:14 error: expected `[`, found `lite`
[13:17:53] -playbot- <anon>:9         #lite fn main() {}
[13:17:53] -playbot- output truncated; full output at: http://bit.ly/1FOn9ac
[13:17:57] <eddyb> like that
[13:18:49] *** Joins: mgottschlag (quassel@moz-7o2mv6.qiv1.bbcb.1398.2a00.IP)
[13:18:54] <eddyb> aatch, doener: wait, this means we can make NonZero more aggressive now :D
[13:19:06] <eddyb> because the null checks in Rc and Arc's Drop impls are bogus now
[13:19:33] <eddyb> and the Deref impl is terrible, it needs a .get() method
[13:28:59] <eddyb> aatch: http://is.gd/E3KhHD
[13:29:18] <eddyb> aatch: that's interesting
[13:29:39] <eddyb> aatch: do we never emit %Foo = type { %Foo* }?
[13:29:56] *** Quits: mgottschlag (quassel@moz-7o2mv6.qiv1.bbcb.1398.2a00.IP) (Quit: No Ping reply in 180 seconds.)
[13:30:02] <eddyb> because that would simplify the newtype optimization I've wanted for ages now
[13:30:52] <eddyb> which is kind of a pre-requisite for switching Box to a struct and whatnot
[13:30:59] *** Joins: mgottschlag (quassel@moz-7o2mv6.qiv1.bbcb.1398.2a00.IP)
[13:31:13] <aatch> which newtype optimisation would that be?
[13:31:56] <eddyb> a struct with only one field with size != 0 || align != 1 is represented as that field
[13:32:57] <eddyb> the problem was types like struct Foo(Option<Box<Foo>>); because I assumed we'd generate %Foo = type { %Foo* };
[13:33:16] <eddyb> but if we don't...
[13:33:40] <eddyb> aatch: oh http://is.gd/9iPqck
[13:34:47] <eddyb> aatch: this is why I'm waiting on erased pointers :(
[13:35:08] <eddyb> they solve so many problems I'm amazed nobody has thought of them until now
[13:35:40] <Manishearth> erased pointers?
[13:39:46] *** Quits: froglegstew (Mibbit@moz-hu6.nja.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[13:41:20] <eddyb> Manishearth: ptr
[13:41:24] <eddyb> Manishearth: instead of T*
[13:42:02] <eddyb> Manishearth: but progress is slow
[13:42:11] *** Joins: harrisonclarke (harrisoncla@moz-p78oth.eastlink.ca)
[13:43:00] *** Quits: mgottschlag (quassel@moz-7o2mv6.qiv1.bbcb.1398.2a00.IP) (Ping timeout: 121 seconds)
[13:43:50] *** Joins: mgottschlag (quassel@moz-6g76ht.scc.kit.edu)
[13:45:14] <Manishearth> eddyb: what do you mean ptr instead of T*?
[13:47:16] <eddyb> Manishearth: LLVM will remove pointer types
[13:47:23] <eddyb> hopefully sooner than later
[13:47:28] <Manishearth> ah
[13:47:34] <Manishearth> but why?
[13:47:38] <eddyb> instructions have already been modified to take element type
[13:47:47] <eddyb> Manishearth: because it turns out that pointer types suck
[13:47:52] <Manishearth> ah
[13:48:07] <eddyb> the IR doesn't need a type system
[13:48:22] <eddyb> it doesn't need noop conversions
[13:48:26] <Manishearth> but, dereferencing?
[13:48:47] <eddyb> that has always been done with the load instruction
[13:49:05] <eddyb> which will now take ptr instead of T* and you have to specify T in the instruction
[13:49:45] <eddyb> think "load T from ptr %x" instead of "load from T* %x" (not exactly the syntax being used)
[13:50:15] <Manishearth> ah
[13:50:58] <eddyb> getelementptr with arguments that would cause it to add 0, will now just disappear
[13:51:37] <eddyb> also, presumably any noop arguments will also disappear, so it does strictly only arithmetic
[13:53:24] <eddyb> if x: &[[[T; N]; M]; P] then &x[0][0][0] is just x and &x[0][0][1] is an offset of one T from x instead of 0 [[[T; N]; M]; P], 0 [[T; N]; M], 0 [T; N] and one 
[13:53:36] <eddyb> which is how you write GEPi right now
[13:53:42] <eddyb> aatch: am I even correct here :D?
[13:55:29] <eddyb>   %1 = getelementptr inbounds [8 x [8 x [8 x i32]]]* %0, i64 0, i64 0, i64 0, i64 1
[13:55:33] <eddyb> yupp, I am
[13:55:53] <eddyb> Manishearth: look at the IR after optimization http://is.gd/0Ji93z
[13:55:57] <eddyb> that's just ugly
[13:56:10] <eddyb> and doesn't strictly reflect the operation being performed
[13:56:48] <eddyb> aatch, doener: wait, shouldn't a noop GEPi turn into a bitcast?
[13:57:17] <eddyb> the ASM is pretty clean, at least
[13:57:44] <aatch> eddyb, LLVM has a bunch of semantics attached to GEP
[13:58:53] <eddyb> well, that's just dandy
[13:59:05] <eddyb> even more reasons to want erased pointers
[13:59:17] <eddyb> if you want type-checking, do it in the front-end
[14:01:06] <aatch> eddyb, well GEP isn't going away, but we'd have signficantly less bitcasts
[14:05:01] *** Quits: harrisonclarke (harrisoncla@moz-p78oth.eastlink.ca) (Connection closed)
[14:08:30] *** Joins: poorman (poorman@moz-ne2.2ic.131.12.IP)
[14:09:16] *** Quits: poorman_ (poorman@moz-sdl0oq.res.rr.com) (Connection closed)
[14:10:46] *** Quits: jgallagher (john@moz-6ge.dhn.131.24.IP) (Client exited)
[14:12:37] *** Quits: poorman (poorman@moz-ne2.2ic.131.12.IP) (Ping timeout: 121 seconds)
[14:14:15] <steveklabnik> imperio: pong
[14:14:45] *** Joins: poorman (poorman@moz-sdl0oq.res.rr.com)
[14:17:50] *** Quits: vmx (vmx@moz-1r97pt.dip0.t-ipconnect.de) (Quit: Leaving)
[14:17:55] <imperio> steveklabnik: I just saw this PR : gh25751
[14:17:55] <[o__o]> Add community translations.: https://github.com/rust-lang/rust/pull/25751
[14:18:10] <imperio> I created a french rust tutorial (not a translation)
[14:18:17] <imperio> here  : blog.guillaume.gomez/Rust
[14:18:19] <steveklabnik> yeah!
[14:18:27] <steveklabnik> was excited to see it
[14:18:31] <imperio> blog.guillaume.gomez.fr/Rust
[14:18:46] <imperio> so I was wondering if it was possible to add it somewhere ?
[14:19:24] <steveklabnik> well, maybe
[14:19:50] <steveklabnik> we can't link to every single possible tutorial, you know? i'm not sure what the threshold is here
[14:20:03] <imperio> that's why I ask
[14:20:08] <imperio> =D
[14:20:44] <imperio> in this case, maybe it would be possible to create some officialization (not sure of the syntax) process ?
[14:21:02] <steveklabnik> yeah, i'll give it some thought :)
[14:21:13] <imperio> thanks
[14:21:45] *** Quits: mgottschlag (quassel@moz-6g76ht.scc.kit.edu) (Ping timeout: 121 seconds)
[14:22:12] *** Joins: harrisonclarke (harrisoncla@moz-p78oth.eastlink.ca)
[14:29:56] *** Quits: c0170 (c0170@moz-bb29a4.cambridge.arm.com) (Ping timeout: 121 seconds)
[14:38:46] *** Quits: harrisonclarke (harrisoncla@moz-p78oth.eastlink.ca) (Connection closed)
[14:41:36] *** Joins: c0170 (c0170@moz-4stj9o.cable.virginm.net)
[14:47:03] <SimonSapin> Getting an LLVM assertion error in `make check` for a library-only patch :( https://gist.github.com/anonymous/645d052db6c8daa8d9ef
[14:48:45] *** Quits: summerlight (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[14:49:21] <doener> eddyb: GEP with all zeroes gets turned into a bitcast only right before codegen
[14:51:16] *** Joins: brson (brson@moz-jd2.tdl.56.172.IP)
[14:51:16] *** ChanServ sets mode: +o brson
[14:51:46] <brson> today i'll probably prepare release notes for 1.1 and maybe 1.2
[14:52:09] <brson> then maybe post something about changing the relnote process
[14:52:09] <steveklabnik> brson: woot! +1 on 1.2. do you need any help?
[14:52:31] <brson> i wonder if we might have yet-another-tag for pr's that warrant relnotes
[14:52:50] <steveklabnik> hmmmm yeah that sounds interesting
[14:52:58] *** Joins: harrisonclarke (harrisoncla@moz-p78oth.eastlink.ca)
[14:53:51] <brson> steveklabnik: not sure if i need help. i'll ping you to review at least
[14:54:10] <SimonSapin> Why is discriminant_value() unsafe?
[14:54:45] <steveklabnik> brson: cool :)
[14:54:50] *** Quits: harrisonclarke (harrisoncla@moz-p78oth.eastlink.ca) (Connection closed)
[14:54:56] <doener> SimonSapin: aren't all intrinsics unsafe?
[14:56:26] <brson> aturon acrichto: when are the beta nominations going to be reviewed and ported?
[14:56:40] <SimonSapin> doener: apparently the pattern is to have a safe wrapper when there is no actual unsafety. For example size_of: https://github.com/rust-lang/rust/blob/master/src/libcore/mem.rs#L126-L128
[14:57:04] <SimonSapin> Is there a reason not to do this for discriminant_value?
[14:57:18] *** Quits: mib_kltup1 (Mibbit@moz-g6k.oht.161.46.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[14:57:36] <doener> I think there were still some details open, let me check the PR/issue
[14:58:16] <brson> SimonSapin: maybe it has weird behavior when called on not-an-enum?
[14:58:16] <doener> SimonSapin: gh24290
[14:58:17] <[o__o]> default representation for enum discriminant should be i32: https://github.com/rust-lang/rust/issues/24290
[14:58:35] <SimonSapin> brson: the doc says it just returns zero
[14:59:02] <brson> SimonSapin: i bet pnkfelix knows definitively
[15:00:40] *** Quits: Kxepal (Miranda@moz-l8kpna.pppoe.mtu-net.ru) (Ping timeout: 121 seconds)
[15:00:44] *** Joins: Kxepal (Miranda@moz-0e9d1r.pppoe.mtu-net.ru)
[15:00:54] <pnkfelix> SimonSapin: There probably isn't a good reason.  My first reaction is "To give the compiler the freedom to reassign values on non-C style enums without worrying about breaking "safe" code..."
[15:01:25] <pnkfelix> SimonSapin: but nmatsakis  has pointed out to me (multiple times) that this is not an excuse, that the discriminant_value intrinsic could always operate at a higher level than what the compiler does, in theory.
[15:01:26] *** Joins: xilec (Mibbit@moz-g6k.oht.161.46.IP)
[15:02:45] *** Joins: vmx (vmx@moz-1r97pt.dip0.t-ipconnect.de)
[15:03:28] *** Quits: acharles (acharles@moz-ulbdcn.ca.comcast.net) (Ping timeout: 121 seconds)
[15:04:50] <aturon> brson: we've gotten behind, but were planning to deal with them today
[15:06:55] <nmatsakis> SimonSapin: pnkfelix: I have some memory of wanting it to be unsafe
[15:07:03] <nmatsakis> I think because it was so easy to abuse and get incorrect code
[15:07:09] <nmatsakis> but that's not really a great reason for usnafety
[15:08:03] <nmatsakis> in particular we've rejected that reasoning in the past :)
[15:08:13] <nmatsakis> (for good reasons)
[15:08:49] <nmatsakis> pnkfelix: for discriminant_value, did we add some sort of Reflect bound?
[15:09:17] <pnkfelix> nmatsakis: I can't remember now
[15:09:23] <nmatsakis> we should :)
[15:09:28] <nmatsakis> if we didn't
[15:09:54] <nmatsakis> we didn't :)
[15:10:04] *** Joins: jgallagher (john@moz-d5e8oc.hfc.comcastbusiness.net)
[15:11:16] * nmatsakis adjusts https://github.com/rust-lang/rust/issues/24263
[15:13:10] *** Joins: Quxxy_ (chatzilla@moz-efh10q.internode.on.net)
[15:13:43] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[15:14:10] *** Quits: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP) (Ping timeout: 121 seconds)
[15:14:13] *** Quxxy_ is now known as Quxxy
[15:17:03] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[15:17:10] <eddyb> pnkfelix: shouldn't the null check here be removed? https://github.com/rust-lang/rust/blob/master/src/liballoc/rc.rs#L423
[15:18:26] <pnkfelix> eddyb: my memory is that there were cases where things were being zeroed despite the compiler's generating fill-on-drop code
[15:18:29] *** Joins: oli_obk__ (Mibbit@moz-7bq.0sb.52.141.IP)
[15:18:37] <pnkfelix> eddyb: I do not know if that case in Rc is one of those or not
[15:18:40] <eddyb> sounds like a bug to me
[15:18:43] *** Joins: eibwen (eibwen@moz-slg8kg.dip0.t-ipconnect.de)
[15:19:19] <eddyb> why would something be zeroed *unless* there's library code doing it?
[15:20:28] <XMPPwocky> because memory's gotten corrupted somehow? because it was zero-initialized by the OS and not properly initialized by your code?
[15:21:40] <eddyb> XMPPwocky: both of those are memory safety violations in Rust
[15:23:28] <XMPPwocky> true
[15:29:34] <Gankro> aatch: emplace_back?
[15:30:12] *** Joins: davebettin (textual@moz-hde.5e5.136.67.IP)
[15:30:14] *** Quits: dinfuehr (dinfuehr@moz-c25.u8s.112.91.IP) (Connection closed)
[15:31:16] *** Quits: davebettin (textual@moz-hde.5e5.136.67.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[15:33:27] *** Joins: davebettin (textual@moz-hde.5e5.136.67.IP)
[15:38:13] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[15:41:46] *** Quits: Kxepal (Miranda@moz-0e9d1r.pppoe.mtu-net.ru) (Ping timeout: 121 seconds)
[15:44:27] *** Joins: dcb (textual@moz-j72nfe.ca.comcast.net)
[15:47:56] *** Quits: Sho (sho@moz-gjv.vr1.28.5.IP) (Quit: Konversation terminated!)
[15:51:08] *** Joins: Kxepal (Miranda@moz-0e9d1r.pppoe.mtu-net.ru)
[15:51:36] *** Joins: yjv (yjv@moz-j0cdis.fios.verizon.net)
[15:51:55] *** Quits: aepsil0n (eduard@moz-gtoi2p.hsi8.kabel-badenwuerttemberg.de) (Connection closed)
[15:53:07] *** Quits: dcb (textual@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[16:03:43] <eddyb> Gankro: what?
[16:04:10] <Gankro> eddyb: Catching up on backlog got confused with channels
[16:04:23] <Gankro> aatch: Is making a DST Linked List
[16:04:23] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[16:04:23] *** ChanServ sets mode: +ao erickt erickt
[16:05:53] <eddyb> Gankro: and bkoropoff is making a DST deque
[16:06:01] <eddyb> and stable collections :D
[16:06:10] <eddyb> sorry, not stable, monotonic
[16:06:59] <Gankro> eddyb: the hell doesa deque work...?
[16:08:10] <eddyb> well, pushing at either end is trivial
[16:08:21] <eddyb> and popping/iterating in one direction
[16:08:58] <eddyb> bidirectional without wasting space is harder, but he came up with a xor scheme (similar to a xor list, which I didn't know about before)
[16:09:11] <eddyb> so you only store one usize between unsized values
[16:09:48] <Gankro> eddyb: Ah ok, the sizes are all inline
[16:09:49] <eddyb> once you can get the metadata for the "edge" object, you can pass it to either pop or iterate
[16:10:20] <eddyb> Gankro: not just the size, but the entire metadata
[16:10:21] *** Joins: Rym (uid91135@moz-n2i7qm.charlton.irccloud.com)
[16:11:58] <Gankro> eddyb: Sure, yeah
[16:12:29] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[16:13:55] *** Quits: munksgaard (munksgaard@moz-33d.hq0.225.130.IP) (Ping timeout: 121 seconds)
[16:15:37] *** Joins: harrisonclarke (harrisoncla@moz-p78oth.eastlink.ca)
[16:16:24] <acrichto> brson: I will want to update the cargo, yeah
[16:22:02] *** Joins: O01eg (o01eg@moz-vo3rrg.nv60.4n8f.2698.2a02.IP)
[16:22:59] <brson> acrichto: r? https://github.com/rust-lang/rust-packaging/pull/32
[16:27:25] <nmatsakis> aturon: for private communication within a subteam, I think you mentioned you were going to make a google group for lib subteam?
[16:27:35] <nmatsakis> I don't love google groups but I guess they're ok
[16:27:42] <aturon> nmatsakis: i did that, but then brson reminded me that discourse has private tags/groups
[16:27:52] <aturon> which is a much better option :)
[16:27:54] <nmatsakis> ah, yes!
[16:27:57] <nmatsakis> ok, did you set that up?
[16:28:04] <nmatsakis> just for libs? or for others too...?
[16:28:09] <aturon> yeah, alex set it up for libs
[16:28:36] <nmatsakis> under "subteams"
[16:28:36] <nmatsakis> ok
[16:29:04] <acrichto> nmatsakis: ah yeah you'll want to create a new team in the admin page
[16:29:05] <nmatsakis> pain in the neck
[16:29:09] <nmatsakis> yes, that
[16:29:09] <nmatsakis> :0
[16:29:10] <acrichto> for a subteam
[16:29:23] <acrichto> and then give them read access to the "subteams" category, and then make a sub-category and give them read/write access
[16:29:29] <acrichto> for some reason they need access to both...
[16:30:16] *** Quits: bdero (bran@moz-e4f4ei.mit.edu) (Ping timeout: 121 seconds)
[16:31:02] <nmatsakis> ok
[16:32:38] *** Joins: Diggsey (diggsey@moz-v5rln7.dsl.pipex.com)
[16:32:59] *** Joins: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net)
[16:33:16] *** Quits: Diggsey (diggsey@moz-v5rln7.dsl.pipex.com) (Connection closed)
[16:36:12] *** Quits: Quxxy (chatzilla@moz-efh10q.internode.on.net) (Ping timeout: 121 seconds)
[16:36:25] *** Joins: duesenfranz_ (jona@moz-711djm.tirol.surfer.at)
[16:37:14] <acrichto> brson: could https://github.com/rust-lang/rust/pull/26122 be run through crater easily?
[16:38:35] <brson> acrichto: sure. i'll start it when i get into the office
[16:39:14] *** Joins: Kingsquee (kingsley@moz-3fm07c.bchsia.telus.net)
[16:39:17] <acrichto> brson: cool!
[16:39:28] <acrichto> bluss: ^ (running the Borrow impl for Box through crater)
[16:39:40] *** Joins: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP)
[16:41:00] *** Quits: laumann (thomas@moz-gqpfnm.science.ku.dk) (Ping timeout: 121 seconds)
[16:42:42] *** skeuomor1 is now known as skeuomorf
[16:43:41] *** Quits: joneshf-laptop (joneshf@moz-l4h.b5s.208.98.IP) (Ping timeout: 121 seconds)
[16:46:13] *** Joins: bdero (bran@moz-nd2f6b.dyn.mit.edu)
[16:48:18] *** Joins: meteredsection (meteredsect@moz-k1pkr3.wa.comcast.net)
[16:56:52] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Connection closed)
[16:57:24] <SimonSapin> acrichto: I don’t understand your comment in https://github.com/rust-lang/rust/issues/26075#issuecomment-110430279
[16:57:44] <acrichto> SimonSapin: the favicon/logo are just urls, so we just need to make sure there's something at that url
[16:57:51] <acrichto> I don't think we need to change rustdoc to be fancy or anything
[16:58:02] <acrichto> and the contents of the doc/ dir are just uploaded to doc.crates.io
[16:58:26] <SimonSapin> acrichto: if we want relative URLs, we need rustdoc to generate sometimes <img src=../logo.png> sometimes <img src=../../logo.png>, etc.
[16:58:50] <acrichto> there shouldn't need to be a relative url though, an absolute one is fine
[16:58:56] *** Joins: zmack (zmack@moz-htpein.home.aster.pl)
[16:59:31] <SimonSapin> This bug is all about not hitting the internet. What absolute URL does that without being 500 lines long?
[16:59:48] <SimonSapin> absolute http: URLs is the status quo
[17:00:17] <acrichto> oh right, nvmd
[17:00:25] <acrichto> forgot what the bug was about
[17:00:30] *** Quits: davebettin (textual@moz-hde.5e5.136.67.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[17:01:39] <SimonSapin> rustdoc already does that kind of thing: https://github.com/rust-lang/rust/blob/7b0f2af27f/src/librustdoc/html/layout.rs#L50
[17:01:59] <SimonSapin> where root path is ../ or ../../ etc
[17:02:58] *** Quits: zmack (zmack@moz-htpein.home.aster.pl) (Ping timeout: 121 seconds)
[17:03:01] <acrichto> sure
[17:03:05] *** chmanchester|afk is now known as chmanchester
[17:03:17] <acrichto> it's probably fine to change the logic around that slightly
[17:03:57] *** Quits: imperio (Mibbit@moz-aibeqg.fbx.proxad.net) (Quit: http://www.mibbit.com ajax IRC Client)
[17:04:45] <aturon> brson: do you have any sense, from crater, of the proportion of crates that currently compile on stable vs nightly?
[17:05:08] *** Joins: elif (chatzilla@moz-ev8m1p.res.rr.com)
[17:06:42] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[17:07:08] <brson> aturon: 837 stable vs. (837+215) nightly. look here: https://gist.github.com/brson/4fb68f21d294ed135e03
[17:07:10] *** Joins: Binero (jeroen@moz-91joat.69vi.s4ge.1810.2a02.IP)
[17:07:26] <brson> aturon: 'fixed' means 'works on nightly but not stable'
[17:07:38] *** Joins: Simplebrain (Simplebrain@moz-6h4u6b.skybroadband.com)
[17:07:43] <aturon> brson: thank you. might be useful to post to http://www.reddit.com/r/rust/comments/39658b/trying_to_use_a_stable_release/
[17:09:42] *** Quits: oli_obk__ (Mibbit@moz-7bq.0sb.52.141.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[17:10:11] *** Joins: davebettin (textual@moz-hde.5e5.136.67.IP)
[17:10:21] *** Joins: rkruppe_ (chatzilla@moz-3nj.rnu.131.95.IP)
[17:10:46] <WindowsBunny> brson: #[packed] has never worked in stable, right?
[17:11:50] <acrichto> WindowsBunny: it did ages ago, but it was removed before 1.0 was released, so it never did anything on 1.0
[17:12:03] <acrichto> e.g. ages ago it was renamed to repr(packed) I believe
[17:12:09] <WindowsBunny> so those crates were technically broken already
[17:12:14] <WindowsBunny> they just didn't error at compile time
[17:12:32] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[17:12:32] *** rkruppe_ is now known as rkruppe
[17:12:32] <acrichto> right
[17:14:22] <brson> aturon: done http://www.reddit.com/r/rust/comments/39658b/trying_to_use_a_stable_release/cs0rtd8
[17:16:05] <aturon> thanks brson!
[17:19:54] <SimonSapin> brson: so less than half of the  2,303 crates build at all?
[17:20:10] <SimonSapin> or are you testing a subset
[17:20:14] <steveklabnik> SimonSapin: see my reply
[17:20:16] <steveklabnik> it's 80% on stable
[17:20:25] <steveklabnik> basically, only half of crates.io compiles
[17:20:37] <steveklabnik> of the half that compiles, 80% works on stable, and 20% works on nightly only
[17:21:52] *** Quits: Kingsquee (kingsley@moz-3fm07c.bchsia.telus.net) (Quit: Konversation terminated!)
[17:25:11] <brson> SimonSapin: it's unknown how many failing crates are actually broken and how many are being built incorrectly by crater
[17:26:06] *** Joins: James_ (quassel@moz-8qs8a3.range86-148.btcentralplus.com)
[17:26:33] *** Quits: harrisonclarke (harrisoncla@moz-p78oth.eastlink.ca) (Connection closed)
[17:26:33] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Connection closed)
[17:29:32] <WindowsBunny> brson: You can discount the 400 or so -sys crates that I never updated to stable yet
[17:30:15] <carllerche> pnkfelix: is there a way to track the state of non zeroing drops?
[17:30:41] <nmatsakis> I sometimes wish we had made trait items pub
[17:30:54] <nmatsakis> carllerche: I know that pnkfelix had a branch with a limited version he calle "non-zeroing moves" working
[17:31:30] <nmatsakis> but I think he wanted to clean it
[17:31:45] <nmatsakis> anyway it basically kept zeroing as the "official" method, but elides it in some cases
[17:31:55] <nmatsakis> not as effective as we hoped, but still a win
[17:33:13] <rkruppe> Is that intended as stepping stone or are there any road blocks for removing zeroing completely and putting drop flags on the stack?
[17:33:25] <steveklabnik> pnkfelix: ^
[17:33:46] <steveklabnik> oh lol he was mentioned like three times, sigh
[17:34:03] <nmatsakis> rkruppe: stepping stone
[17:41:15] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[17:42:41] *** Quits: brson (brson@moz-jd2.tdl.56.172.IP) (Quit: leaving)
[17:42:41] *** Quits: yjv (yjv@moz-j0cdis.fios.verizon.net) (Connection closed)
[17:42:50] *** Joins: yjv_ (yjv@moz-j0cdis.fios.verizon.net)
[17:43:52] *** Quits: davebettin (textual@moz-hde.5e5.136.67.IP) (Quit: Textual IRC Client: www.textualapp.com)
[17:46:39] *** Quits: Jesin (Jesin@moz-t88s6v.cc.lehigh.edu) (Quit: brb rebooting)
[17:48:08] *** Joins: avikpal (avikpal@moz-g44.36b.194.117.IP)
[17:48:15] *** Joins: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net)
[17:48:23] *** Joins: Jesin (Jesin@moz-t88s6v.cc.lehigh.edu)
[17:48:35] *** Joins: willem (willem@moz-facs2s.dynamic.upc.nl)
[17:49:40] *** Quits: vmx (vmx@moz-1r97pt.dip0.t-ipconnect.de) (Quit: Leaving)
[17:52:06] *** Joins: nham (nham@moz-lglsfe.il.comcast.net)
[17:54:33] *** Quits: KokaKiwi (kokakiwi@moz-cagds5.kokakiwi.net) (Connection closed)
[17:54:42] *** Quits: avikpal (avikpal@moz-g44.36b.194.117.IP) (Connection closed)
[17:56:13] *** Joins: KokaKiwi (kokakiwi@moz-cagds5.kokakiwi.net)
[17:58:34] <eddyb> aatch, doener: have you seen this?! http://compilers.cs.uni-saarland.de/papers/lkh15_cgo.pdf
[17:58:49] <eddyb> just showed up out of (nowhere?)
[17:58:50] *** Quits: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP) (Connection closed)
[18:03:11] *** Joins: avikpal (avikpal@moz-g44.36b.194.117.IP)
[18:06:02] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[18:08:57] *** Quits: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net) (Connection closed)
[18:09:11] *** Joins: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net)
[18:10:07] *** Joins: grant (grant@moz-jfh.0nq.187.64.IP)
[18:11:07] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[18:11:07] *** ChanServ sets mode: +o pcwalton
[18:13:05] *** Quits: Simplebrain (Simplebrain@moz-6h4u6b.skybroadband.com) (Quit: Leaving)
[18:14:10] *** Quits: poorman (poorman@moz-sdl0oq.res.rr.com) (Quit: )
[18:15:03] *** Joins: swgillespie (swgillespie@moz-o29.3un.220.167.IP)
[18:16:43] *** Joins: arielb1 (Ariel@moz-f4qsb4.red.bezeqint.net)
[18:17:44] *** Quits: _Vi (vi@moz-bbs.vhj.131.104.IP) (Ping timeout: 121 seconds)
[18:18:15] *** Quits: xilec (Mibbit@moz-g6k.oht.161.46.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[18:19:23] *** Joins: veedrac (Mibbit@moz-u87knh.cam.ac.uk)
[18:22:02] *** Joins: Diamond (dick@moz-s67uin.ok.cox.net)
[18:22:06] *** Quits: doener (doener@moz-929cn9.unity-media.net) (Ping timeout: 121 seconds)
[18:22:06] <veedrac> If I change libcore/iter.rs, what do I pass to make to get it to rebuild and test it? I've been suggested check-stage2-coretest on #rust but this only seems to rebuild the tests.
[18:22:51] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[18:22:52] *** ChanServ sets mode: +o brson
[18:22:54] *** Joins: doener (doener@moz-929cn9.unity-media.net)
[18:24:33] <nmatsakis> erickt: do you know if we are using the discriminant_value intrinsic to help with deriving partialord etc?
[18:24:34] <aturon> pcwalton: can you open an issue on improving derive codegen with the specifics of what you ran into?
[18:24:38] <nmatsakis> heh :)
[18:24:41] <pcwalton> aturon: already did
[18:24:44] <aturon> thx
[18:24:53] <pcwalton> https://github.com/rust-lang/rust/issues/26128
[18:24:59] *** Quits: veedrac (Mibbit@moz-u87knh.cam.ac.uk) (Quit: http://www.mibbit.com ajax IRC Client)
[18:25:10] *** Joins: veedrac (Mibbit@moz-u87knh.cam.ac.uk)
[18:25:46] <arielb1> nmatsakis: could you please r? gh26055
[18:25:47] <[o__o]> Skip useless recursion in freshening and late-bound-region substitution: https://github.com/rust-lang/rust/pull/26055
[18:26:07] <arielb1> nice perf boost
[18:26:29] <erickt> nmatsakis: howdy!
[18:26:49] <erickt> nmatsakis: I can't remember, let me check...
[18:26:51] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[18:27:13] * pcwalton seconds that review request for nmatsakis ;)
[18:27:26] <arielb1> pcwalton: its only a 3%
[18:27:33] <pcwalton> not bad though
[18:27:35] <pcwalton> erickt: I got a really big perf boost in Servo by manually using derive(PartialEq)
[18:27:37] <pcwalton> err
[18:27:41] <arielb1> but its orthogonal to most stuff I have in my queue
[18:27:49] <pcwalton> by manually replacing derive(PartialEq) with enum_discriminant
[18:27:50] <arielb1> so good enough
[18:27:58] <pcwalton> to avoiding blowing out the i-cache on ARM
[18:28:03] *** Joins: Binero_ (jeroen@moz-9quuoa.access.telenet.be)
[18:28:31] *** Quits: Binero (jeroen@moz-91joat.69vi.s4ge.1810.2a02.IP) (Ping timeout: 121 seconds)
[18:28:32] *** Binero_ is now known as Binero
[18:28:53] * arielb1 prefers to land my bigger perf improvements after parallel codegen works
[18:29:04] <arielb1> *his
[18:30:15] <erickt> nmatsakis: nope, it looks like Partial* ignores the discriminant
[18:30:24] *** Quits: rovar_ (rovar@moz-96effg.dyn.optonline.net) (Connection closed)
[18:30:31] <erickt> pcwalton: not surpising
[18:31:43] *** Joins: ryanhiebert (ryanhiebert@moz-nsd5kl.ks.cox.net)
[18:32:55] *** Joins: Simplebrain (Simplebrain@moz-1hs5ek.rev.poneytelecom.eu)
[18:33:05] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[18:34:25] <SimonSapin> is a timeout on buildbot likely an intermittent issue? https://github.com/rust-lang/rust/pull/26039#issuecomment-110457369
[18:35:41] <erickt> nmatsakis / pcwalton: it seems like this would be a pretty straightforward optimization. Other than for serialization, can't think of a case where using the discriminant would do the wrong thing
[18:36:05] <pcwalton> it may reduce our codegen quite a bit
[18:36:09] <nmatsakis> erickt: how does it do the wrong thing for serialization?
[18:36:21] <nmatsakis> arielb1: what else have you got going on btw? 
[18:36:35] <arielb1> nmatsakis: I kind-of have the ADTDef
[18:36:48] <arielb1> which fixes a few stupidities on the side
[18:36:54] <arielb1> but I am kind of busy right now with other stuff
[18:37:00] <nmatsakis> (i.e., non-rust stuff?)
[18:37:03] <nmatsakis> arielb1: nice.
[18:37:04] <arielb1> yes
[18:37:09] <pcwalton> pnkfelix: just out of curiosity, how is nonzeroing drop going?
[18:37:09] <nmatsakis> ok cool
[18:37:16] <nmatsakis> pcwalton: I think he's afk atm but...
[18:37:22] <eddyb> ADTDef? the thing aatch started?
[18:37:27] <arielb1> eddyb: yes
[18:37:27] <nmatsakis> pcwalton: ...I know that the "non-zeroing moves" stuff was working...
[18:37:31] <eddyb> arielb1: <3
[18:37:33] <nmatsakis> pcwalton: ...though the gains were modest...
[18:37:37] <arielb1> it kind-of got destroyed by conflict damage
[18:37:45] <pcwalton> I wouldn't be surprised if the gains are modest
[18:37:46] <erickt> nmatsakis: oh, just because the user might want to serialize enums as a string in some circumstances, and an integer in other circumstances
[18:37:47] <pcwalton> for now
[18:37:48] *** Quits: veedrac (Mibbit@moz-u87knh.cam.ac.uk) (Quit: http://www.mibbit.com ajax IRC Client)
[18:37:53] <nmatsakis> pcwalton: ...I know he was planning to do some refactoring, you might want to press him to get the PR up :) I think he got distracted by other priorities, but we ought to get it in
[18:38:04] *** Joins: graydon (graydon@moz-dose3e.dyn.novuscom.net)
[18:38:05] <nmatsakis> or I can bug him some more ;)
[18:38:07] <pcwalton> it'll quite possibly be one of those things where each individual piece doesn't help much, but the combination does
[18:38:08] <arielb1> the gains mostly come from fixing bad cache policy
[18:38:11] <pcwalton> I'd definitely like to see that PR
[18:38:15] <eddyb> pcwalton: Rc and Arc's Drop impls check for null still whereas dropping sets a specific value (which is also checked for)
[18:38:45] <eddyb> I'm not sure it's even sound wrt NonZero
[18:39:03] <eddyb> but it may make drops slightly slower than they should be
[18:39:22] <erickt> nmatsakis: serde though has support for serialization annotations, so it wouldn't be hard to be able to annotate an enum to always use the string form or the integer form
[18:40:05] <aturon> pcwalton: i saw a WIP branch from elif on non-zeroing drop
[18:40:21] <aturon> not sure if they've coordinated with pnkfelix or what the overall status is
[18:40:22] <eddyb> elif?
[18:40:24] <WindowsBunny> Can someone update buildbot to point to rust-lang/rust directly rather than mozilla/rust?
[18:40:37] <elif> here
[18:40:44] <elif> what's the question?
[18:41:07] <aturon> eddyb: https://botbot.me/mozilla/rust-internals/2015-06-08/?msg=41280083&page=7
[18:41:26] <nmatsakis> erickt: sorry I don't think I follow
[18:41:31] <aturon> elif: i think the question was: who is this amazing person who showed up with a big branch for non-zeroing drop :)
[18:41:41] *** Joins: eddyb_ (eddyb@moz-7uq.hlc.26.188.IP)
[18:41:47] <erickt> nmatsakis: I get that a lot :)
[18:41:58] <nmatsakis> erickt: I guess I just don't know what that has to do with PartialEq :)
[18:42:03] <nmatsakis> or maybe i'm missing something
[18:42:11] <erickt> it has nothing to do with PartialEq
[18:42:19] <WindowsBunny> whoa, a non-zeroing drop branch?
[18:42:45] <erickt> nmatsakis: we could make the change to use the discriminant for Partial{Eq,Ord} and etc
[18:42:53] <nmatsakis> erickt: well that explains a lot :) are you just saying that using discriminant_value for serde might be tricky?
[18:43:08] *** chmanchester is now known as chmanchester|afk
[18:43:35] <elif> yes, a non-zeroing drop branch; https://github.com/rust-lang/rust/compare/master...eefriedman:dynamic-drop .  it even bootstraps with a bunch of hacks
[18:43:43] <aturon> eddyb: ^
[18:44:02] <eddyb_> elif: o_O
[18:44:12] <eddyb_> I remember seeing some numbers from pnkfelix
[18:44:22] <erickt> nmatsakis: for serde, it's only that I want it to be controllable by the end user if `#[derive(Serialize,Deserialize)]` uses the discriminant_value
[18:44:25] <nmatsakis> elif: you should definitely talk to pnkfelix :)
[18:44:35] *** Quits: grant (grant@moz-jfh.0nq.187.64.IP) (Client exited)
[18:44:36] *** Quits: eddyb (eddyb@moz-2fd.hlc.26.188.IP) (Ping timeout: 121 seconds)
[18:45:42] <eddyb_> erickt: so I tried removing rustc_private from libsyntax and all hell breaks loose because of liblog
[18:45:51] <erickt> hehe
[18:45:59] <eddyb_> erickt: I wonder if I can just comment out the unstable annotation in liblog to avoid this
[18:46:01] *** eddyb_ is now known as eddyb
[18:46:19] <erickt> eddyb: syntex uses the crates.io log crate
[18:49:30] <eddyb> well, yes
[18:49:41] <eddyb> but I need to check in-tree that there isn't a legitimate use of rustc_private
[18:49:53] <eddyb> I'd almost want to rename it to rustc_private_log
[18:50:37] <erickt> eddyb: what are you working on btw?
[18:50:57] <eddyb> just trying to get libsyntax to compile with no feature flags
[18:51:00] *** Quits: Binero (jeroen@moz-9quuoa.access.telenet.be) (Client exited)
[18:51:40] <erickt> eddyb: ah. see https://github.com/erickt/rust-syntex/tree/master/syntex_syntax :)
[18:52:39] <erickt> eddyb: you could do a diff between the master and the rust to see the changes I had to make to get syntax to compile on stable rust
[18:53:01] <eddyb> so I ended up with #![feature(rustc_private_log, rustc_private_serialize, rustc_private_term)]
[18:53:48] <eddyb> #![feature(associated_consts)] huh, where are those used in libsyntax?
[18:55:09] <eddyb> oh, bitflags?
[18:55:57] <eddyb> that's cool, they are more like enums now
[18:56:14] *** Quits: graydon (graydon@moz-dose3e.dyn.novuscom.net) (Quit: Leaving.)
[18:56:39] <pnkfelix> elif: I will have to take a look at it.  Last I saw you discussing it, it sounded like your interpretation differed in how to handle things like `{ let b: Box<(X, Y)> = ...; let x = b.0; ... }`
[18:56:54] *** Joins: eerie_ (eerie@moz-2u3428.red.bezeqint.net)
[18:57:20] *** Joins: graydon (graydon@moz-dose3e.dyn.novuscom.net)
[18:57:43] <pnkfelix> pcwalton: I've been finishing up the cleanup of my own branch for dropflag hints aka non-zeroing moves
[18:59:42] <steveklabnik> hey, can anyone help me clarify https://github.com/rust-lang/rust/issues/25586 ?
[18:59:53] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Ping timeout: 121 seconds)
[19:05:20] <doener> eddyb: got a TL;DR of that paper for me? (I didn't recover from my vacation yet...)
[19:05:47] <kimundi> nmatsakis: r? https://github.com/rust-lang/rust/pull/26058
[19:06:17] <pcwalton> pnkfelix: awesome
[19:06:20] <pcwalton> I'd love to see any WIPs
[19:06:25] *** Joins: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP)
[19:07:50] <graydon> steveklabnik: the bug or the text it's referencing?
[19:08:20] *** Joins: _Vi (vi@moz-bbs.vhj.131.104.IP)
[19:09:50] <steveklabnik> graydon: i would like to fix the bug, and i am unsure how to modify the text to fix the bug :)
[19:12:33] <graydon> so I don't know exactly how rustc actually behaves here, but I _think_ the reporter is confused about the use of "propagate" (in the sense of propagating a note to pass a -L flag to a linker sometime in the future) vs. the inclusion of an object file in a downstream artifact
[19:13:02] *** Joins: Binero (jeroen@moz-9quuoa.access.telenet.be)
[19:13:02] <steveklabnik> i think so as well
[19:13:26] <graydon> ok
[19:13:29] <graydon> then I would change the sentence
[19:13:37] <graydon> "Native dynamic libraries and frameworks are propagated to the final artifact boundary, while static libraries are not propagated at all."
[19:13:46] <graydon> to something like
[19:14:16] <graydon> "Native dynamic library and framework dependencies are propagated to the final artifact boundary, while static library dependencies are not propagated at all."
[19:14:31] <graydon> perhaps with a trailing:
[19:14:50] <graydon> "... because the static libraries are integrated directly into the subsequent artifact."
[19:16:14] * steveklabnik thinks
[19:16:27] <eddyb> doener: a new kind of CPS (FP-like) IR with simpler implementations of interesting optimizations (existing in LLVM)
[19:16:53] <steveklabnik> yeah, i think that should allivate it. let me PR that and see what mkpanov thinks
[19:16:57] <steveklabnik> thanks :) <3
[19:17:00] <eddyb> doener: and tested with a more functional dialect of Rust that looks pretty old
[19:17:31] <elif> pnkfelix: i'm a bit conflicted about how to handle boxes; i mean, you can make boxes field-sensitive, maybe?  it gets a bit complicated to handle the recursive cases
[19:17:54] <doener> eddyb: thanks! I'll keep the tab open and read it later this week
[19:18:07] <zwarich> eddyb: it's SSA extended to support higher order functions, basically
[19:18:45] <graydon> steveklabnik: *shrug* maybe they mean something else or there's some other way to say it, idk
[19:19:22] <elif> pnkfelix: currently box pattern matching allows, for example, moving out of a field of the fourth element of a linked list
[19:26:57] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[19:29:56] *** Quits: eerie_ (eerie@moz-2u3428.red.bezeqint.net) (Ping timeout: 121 seconds)
[19:30:44] *** Quits: untitaker (untitaker@moz-d1qj3q.highway.telekom.at) (Ping timeout: 121 seconds)
[19:32:22] *** Quits: swgillespie (swgillespie@moz-o29.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[19:33:04] *** Joins: untitaker (untitaker@moz-pe2hcg.highway.telekom.at)
[19:37:11] *** Joins: mib_vc22vm (Mibbit@moz-g6k.oht.161.46.IP)
[19:39:27] *** Quits: avikpal (avikpal@moz-g44.36b.194.117.IP) (Connection closed)
[19:43:34] *** chmanchester|afk is now known as chmanchester
[19:43:39] *** Joins: munksgaard (munksgaard@moz-ob0t16.0.fullrate.dk)
[19:45:02] *** Quits: semarie (semarie@moz-ojjbdf.torservers.net) (A TLS packet with unexpected length was received.)
[19:47:31] *** Quits: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP) (Connection closed)
[19:47:46] *** Joins: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP)
[19:50:22] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Connection closed)
[19:54:24] *** Joins: fensterexx (Mibbit@moz-hu6.nja.252.72.IP)
[19:54:54] *** Quits: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP) (Connection closed)
[19:55:00] *** Joins: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP)
[19:55:53] *** Quits: mukilan (mukilan@moz-5ke.d4s.164.122.IP) (A TLS packet with unexpected length was received.)
[19:55:59] <pnkfelix> elif: my plan has been to associate drop-flags with the same sort of static structure that the borrow checker uses
[19:56:45] <pnkfelix> elif: this is why the borrowck::fragments code is still sitting around, rather than being ripped out when we abandoned static drop.
[19:57:22] <pnkfelix> elif: still, I will indeed have to review whether the fragments code properly handles a case like the one you describe (of moving out of the cadddr)
[19:58:19] *** Joins: laumann_ (thomas@moz-n9e72h.0.fullrate.dk)
[19:58:23] <nmatsakis> kimundi: I saw gh26058, I was reading it, seems good
[19:58:24] <[o__o]> Made ref pattern bindings correctly pick Deref or DerefMut: https://github.com/rust-lang/rust/pull/26058
[19:58:35] <nmatsakis> kimundi: oh, I See you addressed the nits...
[19:59:11] <kimundi> nmatsakis: Right, since I technically changed all the code while addressing them I wanted you to take as second look at it :)
[19:59:21] <kimundi> (Though nothing really changed)
[19:59:29] <elif> pnkfelix: oh... that makes sense.  my patch currently just tries to generate a flag for everything which could be an obligation based on the variable type
[19:59:49] <eddyb> erickt: I give up trying to do everything in one PR
[20:00:20] <nmatsakis> ps
[20:00:22] <nmatsakis> oops
[20:01:44] *** Quits: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP) (Connection closed)
[20:01:47] *** Quits: bdero (bran@moz-nd2f6b.dyn.mit.edu) (Ping timeout: 121 seconds)
[20:03:11] <pnkfelix> pcwalton this is the PR: https://github.com/rust-lang/rust/pull/24270
[20:03:31] <pnkfelix> pcwalton: (where i switched PartialOrd to use discriminant_value )
[20:03:49] *** Joins: mcpherrin (mcpherrin@moz-clk6gh.ca.comcast.net)
[20:05:24] <eddyb> erickt: https://github.com/rust-lang/rust/pull/26141
[20:07:14] <eddyb> I think someone (doener?) tried `if discriminant(left) != discriminant(right) { return false; }` for PartialEq at some point, but I don't recall why we're not doing that right now
[20:08:34] <doener> eddyb: I tried a bit more than just that and failed, also the way I integrated the early equality check was kind of a hack... abused the _ match case from the generic deriving code
[20:09:02] <doener> eddyb: I should really have focussed on getting that part done right first and care about the rest later
[20:13:37] *** Joins: larhat1 (Adium@moz-vlo5br.cable.virginm.net)
[20:14:04] *** Joins: dinfuehr (dinfuehr@moz-qat0e8.highway.telekom.at)
[20:15:24] *** Quits: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net) (Connection closed)
[20:19:40] <bstrie> if I have some Rust that calls some C code that calls some Rust code, does the inner Rust code have access to thread locals of the main Rust code?
[20:20:52] <bstrie> or any state of the main Rust code at all
[20:21:17] <WindowsBunny> bstrie: it uses native TLS, so if it is on the same thread, then yes
[20:22:24] <bstrie> WindowsBunny: can you think of any other state that's easily accessible, module unsafe shenanigans?
[20:22:28] <bstrie> *modulo
[20:22:42] <WindowsBunny> Well you should be able to access statics just fine
[20:22:54] <WindowsBunny> Since they're basically absolute addresses
[20:23:44] *** Quits: fensterexx (Mibbit@moz-hu6.nja.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[20:23:46] <WindowsBunny> bstrie: I don't see how the C would interrupt any of Rust's state
[20:23:56] <WindowsBunny> (just don't unwind through the C code)
[20:23:57] <bstrie> well the C could access TLS too
[20:24:19] <bstrie> and it could also scribble all over the stack if it wanted to
[20:24:28] <WindowsBunny> That's unsafe shenanigans
[20:24:37] <WindowsBunny> Where C is overwriting TLS or stack that is isn't supposed to
[20:25:11] <WindowsBunny> Assuming the C code isn't malicious or broken, then your state should be fine
[20:26:37] <bstrie> WindowsBunny: brace for the stupid question, but by saying that the inner rust could access statics do you mean by passing a pointer to static memory through the C code, or is there some more bizarre mechanism
[20:27:29] <WindowsBunny> bstrie: statics are absolute addresses (possibly relative to the process address if using position independent code)
[20:27:31] *** Quits: munksgaard (munksgaard@moz-ob0t16.0.fullrate.dk) (Ping timeout: 121 seconds)
[20:27:52] <WindowsBunny> bstrie: So you can access a static at any time since the address is basically hardcoded in
[20:28:14] <bstrie> WindowsBunny: the question is still how the inner rust code knows what that hardcoded address is. do you mean encoding it in the source?
[20:28:28] <cmr> bstrie: it's hardcoded, there's nothing to "know"!
[20:28:32] <cmr> the compiler/linker baked it in.
[20:28:35] <WindowsBunny> bstrie: When the code is linked to create a binary, the linker allocates a spot for each static, and then fills in the address
[20:29:27] <bstrie> but how could you compile the inner rust binary in the first place if it's referring to `FOO` when that static is not defined in that crate
[20:29:29] <WindowsBunny> bstrie: If you disassemble code that accesses a static you will see it shove a constant address into a register and access memory through that pointer
[20:29:45] <WindowsBunny> bstrie: The linker takes care of everything
[20:30:11] <bstrie> you don't even get to the linking step if your code doesn't compile, and I don't see how you'd get it to compile
[20:30:28] <WindowsBunny> bstrie: the compiler leaves a reference to the statics mangled name
[20:30:52] <WindowsBunny> and then the linker replaces that reference with the address itself
[20:31:12] <bstrie> how would you write the inner rust code such that it references the static
[20:31:33] <sfackler> extern crate the_other_crate; fn foo() { let a = the_other_crate::FOO; } ?
[20:31:34] <WindowsBunny> bstrie: Well, if the static was defined in another crate for example
[20:31:41] <cmr> extern { static FOO: u32; }
[20:32:03] *** Joins: swgillespie (swgillespie@moz-o29.3un.220.167.IP)
[20:32:07] <bstrie> sfackler: this crate is being called from C, it's not linking in the outer rust code directly
[20:32:08] <cmr> sfackler: the "other crate" isn't Rust, it's C.
[20:32:13] <bstrie> again, the calls here are Rust -> C -> Rust
[20:32:13] <sfackler> oh
[20:32:45] <WindowsBunny> bstrie: Ah, you want to know how to access statics from another crate without actually depending on the other crate directly?
[20:33:07] <bstrie> well, my question is what state the inner crate can access
[20:33:21] <bstrie> TLS seems to be one, I was curious if there were others I was overlooking
[20:33:44] <WindowsBunny> if one crate depends on the other crate, it can resolves all the publicly exported statics of the other crate and access them just fine
[20:34:19] <WindowsBunny> If not, then you'll have to resort to other message passing techniques
[20:35:01] <bstrie> I'm not trying to actually enable anything, I'm trying to think about what it's reasonable to infer about unsafe code depending on local properties
[20:35:15] <bstrie> heuristically, obviously
[20:35:58] <WindowsBunny> The only state that can be shared between two rust crates that don't know about each other is their common dependencies
[20:36:10] <WindowsBunny> So libstd mainly
[20:36:43] <WindowsBunny> ignoring the obvious case where unsafe code does malicious/broken things
[20:36:54] <bstrie> my current thoughtstream is about trying to look at local properties of `unsafe` code to try and produce reasonable guesses about the scope of that unsafe code
[20:37:24] <arielb1> WindowsBunny: extern functions, of course
[20:37:50] <bstrie> for example, if you call a C function that takes an int and returns an int, without involving any pointers, then your program at large can still exhibit unsafety but in this case it's reasonable to assume that the unsafety actually is isolated to the C code
[20:38:06] <WindowsBunny> arielb1: That would imply either a common dependency or that the two crates do know about each other
[20:38:16] <bstrie> in contrast to passing a pointer to a Rust object to C code, which can actually corrupt the state of the rust program beyond the C call
[20:38:20] <bstrie> obviously this isn't perfect
[20:38:23] <WindowsBunny> arielb1: Unless they both decide to use a really common name for something and have it unmangled
[20:38:31] <bstrie> but it could be a good first approximation
[20:38:33] <WindowsBunny> arielb1: which is just silly
[20:38:54] <arielb1> #[no_mangle] extern "C" unsafe fn malloc(size: usize) -> *const ()
[20:39:23] <WindowsBunny> bstrie: I typically just assume that a function does what it is documented to do
[20:40:13] <arielb1> bstrie: privacy
[20:40:14] *** Quits: yjv_ (yjv@moz-j0cdis.fios.verizon.net) (Connection closed)
[20:40:24] *** Joins: yjv (yjv@moz-j0cdis.fios.verizon.net)
[20:40:36] <arielb1> I don't think there is an intercrate restriction stronger than privacy
[20:41:12] <WindowsBunny> brson: nightly dist msvc failed because.... it couldn't download an msvc cargo I think
[20:41:13] <arielb1> (there's also coherence, of course)
[20:42:34] <arielb1> bstrie: it is unsafe for other C/Rust/whatever code to access non-public symbols
[20:42:45] <arielb1> or non-public fields of structs (except for swapping/copying)
[20:43:06] <arielb1> or create objects of structs with a private ctor (except by swapping)
[20:43:18] <arielb1> or moving
[20:43:56] <arielb1> it is unsafe for code to do bad things with lifetimes, or violate aliasing restrictions, etc.
[20:45:07] <arielb1> there's also control flow integrity
[20:45:13] <arielb1> of course
[20:46:01] <arielb1> on the "bad things with lifetimes": it is also unsafe to duplicate non-Copy types
[20:50:21] *** Quits: larhat1 (Adium@moz-vlo5br.cable.virginm.net) (Quit: Leaving.)
[20:52:07] *** Quits: Binero (jeroen@moz-9quuoa.access.telenet.be) (Client exited)
[20:52:17] <steveklabnik> brson: ping! http://www.reddit.com/r/rust/comments/3963eu/rust_in_brazil_the_ror_project/cs0p3i3
[20:59:53] *** Joins: Kingsquee (kingsley@moz-3fm07c.bchsia.telus.net)
[21:00:17] *** Joins: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP)
[21:00:24] *** Quits: jgallagher (john@moz-d5e8oc.hfc.comcastbusiness.net) (Client exited)
[21:02:11] <brson> steveklabnik: replied
[21:02:35] <steveklabnik> <3
[21:05:28] *** Quits: dinfuehr (dinfuehr@moz-qat0e8.highway.telekom.at) (Connection closed)
[21:05:49] *** Joins: dinfuehr (dinfuehr@moz-qat0e8.highway.telekom.at)
[21:06:18] *** Quits: eibwen (eibwen@moz-slg8kg.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[21:07:33] <Manishearth> steveklabnik: https://gist.github.com/Manishearth/967bc78db5c751c38d03
[21:07:45] <Manishearth> (I was right about most of our unstable feature usage being convenience.)
[21:08:11] <Manishearth> (I could switch over most of these pretty quickly, and the rest with some extra work, excpet perhaps stuff like fnbox)
[21:09:52] *** Quits: dinfuehr (dinfuehr@moz-qat0e8.highway.telekom.at) (Ping timeout: 121 seconds)
[21:11:50] <steveklabnik> Manishearth: oooh interesting
[21:13:13] <Manishearth> steveklabnik: I think if we removed our plugin dep (NEVER!) we could realistically move to stable Rust given a week or two. (i.e. the effort of one 2014 rustup)
[21:13:27] <Manishearth> not that we will
[21:13:30] <Manishearth> but we could
[21:13:52] <Manishearth> mostly API sedding, plus some restructuring
[21:14:06] <steveklabnik> right
[21:14:13] <Manishearth> And I think almost all of our deps work on stable now
[21:14:18] <steveklabnik> i think overall that would be really cool
[21:14:18] <Manishearth> which is pretty amazing
[21:14:27] <steveklabnik> i might be willing to pitch in on the tedius stuff
[21:14:44] <Manishearth> steveklabnik: no, we are NOT moving to stable rust :)
[21:14:47] <steveklabnik> w;)
[21:14:49] <steveklabnik> hehe
[21:15:40] <Manishearth> this was just a way to get an idea of what stable rust is lacking (weak pointers!) and what low hanging fruit there is for stabilization that could have a high impact
[21:15:41] <steveklabnik> regardless, this is really useful i think
[21:15:49] <steveklabnik> yeah, agreed
[21:15:56] <sfackler> I'd like stable copy_memory too
[21:16:15] *** Joins: bdero (bran@moz-lbs.91h.47.73.IP)
[21:16:45] <Manishearth> yeah, very few deps use it. Mostly macro-y deps (lint deps and h5e+string_cache+phf), and mozjs, ws, skia which just haven't been ported to stable
[21:17:32] *** Quits: willem (willem@moz-facs2s.dynamic.upc.nl) (Quit: leaving)
[21:19:30] *** Quits: erz (erz@moz-fiq1tl.broadband.corbina.ru) (Quit: My Mac has gone to sleep. ZZZzzz…)
[21:25:27] *** Quits: skeuomorf (skeuomorf@moz-3l1.21q.32.197.IP) (Ping timeout: 121 seconds)
[21:28:40] *** Quits: nham (nham@moz-lglsfe.il.comcast.net) (Ping timeout: 121 seconds)
[21:34:28] *** Joins: goyox86 (textual@moz-rvv.00r.255.109.IP)
[21:48:05] <arielb1> does homu prioritize PRs alphabetically?
[21:48:13] <WindowsBunny> arielb1: it does it by PR number
[21:48:35] <WindowsBunny> arielb1: So if your PR number is the lowest, you get to go next
[21:48:57] <WindowsBunny> even if you just got approved 10 seconds earlier and someone else was approved for a week and sitting around
[21:49:14] <arielb1> I guess
[21:49:28] <arielb1> it is just sorted mostly-alphabetically currently
[21:50:19] <brson> no new language features stabilized in 1.1
[21:50:27] <steveklabnik> oh?
[21:50:30] <steveklabnik> i thought str_words made it
[21:50:50] <cmr> that sounds like a library feature
[21:50:53] <brson> yes
[21:50:55] <steveklabnik> oh, right
[21:50:58] <cmr> :P
[21:51:00] <arielb1> its a quality + library release
[21:52:02] <arielb1> what stabilizations are coming for 1.2?
[21:52:59] *** cmr changes topic to '17 days to 1.1.0 | https://botbot.me/mozilla/rust-internals | https://buildbot.rust-lang.org/homu/queue/rust | see also #rustc and #rust-libs'
[21:54:00] <brson> er, librustc_unicode declares that the SplitWhitespace struct became stable in 1.1
[21:54:07] <brson> this seems like it must be a refactoring mistake
[21:54:12] <brson> rustc_unicode has no stable things
[21:55:33] <brson> oh, weird. libcollections linkes to rustc_unicode?
[21:56:02] <brson> i grumble at this new inconsistent crate naming
[21:56:45] *** Joins: mib_w2k67f (Mibbit@moz-hu6.nja.252.72.IP)
[21:57:07] <doener> arielb1: wow, gh26127 is kind of hard to hit considering that the actual bug is quite trivial/obvious
[21:57:08] <[o__o]> LLVM error with struct with a zero-sized associated type: https://github.com/rust-lang/rust/issues/26127
[21:58:46] <arielb1> doener: I accidentally hit it
[21:58:51] <arielb1> while debugging gh25700
[21:58:51] <[o__o]> ICE: projection error while selecting?: https://github.com/rust-lang/rust/issues/25700
[21:58:54] <doener> arielb1: we're just getting an undef of the wrong type (value type instead of pointer type) in trans_named_tuple_constructor, but the error only trigger when the type contents stuff thinks that the type needs a drop which (probably) only happends for projection types
[21:59:33] <doener> that made me look at the wrong code for a while
[22:00:26] *** Quits: ryanhiebert (ryanhiebert@moz-nsd5kl.ks.cox.net) (Quit: Leaving...)
[22:00:27] <arielb1> doener: it was just as crazy for me
[22:00:59] <arielb1> I was chasing type_impls_bound crazyness (not related to my changes)
[22:01:00] *** Quits: c0170 (c0170@moz-4stj9o.cable.virginm.net) (Connection closed)
[22:01:20] <arielb1> but I knew it was type_contents
[22:01:25] <arielb1> should have added that
[22:01:56] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[22:06:10] *** Joins: shmoo (Mibbit@moz-5cq.vkq.36.197.IP)
[22:06:52] *** Quits: shmoo (Mibbit@moz-5cq.vkq.36.197.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:07:20] *** Joins: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au)
[22:11:08] *** Joins: A205B064 (A205B064@moz-rr4.khg.118.75.IP)
[22:11:31] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[22:11:56] <doener> arielb1: gh26153
[22:11:57] <[o__o]> Use the correct type of undef value for ignored return values in trans_named_tuple_constructor: https://github.com/rust-lang/rust/pull/26153
[22:13:14] <arielb1> doener: have you checked there is no similar bug elsewhere?
[22:15:25] <doener> arielb1: yes
[22:15:32] <doener> arielb1: at least for C_undef
[22:16:34] *** Quits: arielb1 (Ariel@moz-f4qsb4.red.bezeqint.net) (Quit: Ex-Chat)
[22:16:54] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Ping timeout: 121 seconds)
[22:20:20] *** Quits: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP) (Connection closed)
[22:20:34] *** Joins: larhat1 (Adium@moz-vlo5br.cable.virginm.net)
[22:23:03] *** kimundi is now known as zz_kimundi
[22:28:13] *** Joins: bombless_ (_@moz-odk.piv.41.59.IP)
[22:29:44] *** Quits: Jesin (Jesin@moz-t88s6v.cc.lehigh.edu) (Quit: Leaving)
[22:30:32] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[22:31:23] *** Quits: bombless (_@moz-s000ci.0v2u.0v40.0da8.2001.IP) (Ping timeout: 121 seconds)
[22:32:58] *** Joins: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP)
[22:39:25] *** Quits: laumann_ (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[22:39:30] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[22:40:05] *** Quits: goyox86 (textual@moz-rvv.00r.255.109.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[22:47:52] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[22:48:20] *** Quits: bjz (bjz@moz-puppgq.tpgi.com.au) (Quit: My Mac has gone to sleep. ZZZzzz…)
[22:48:39] *** Joins: njn (chatzilla@moz-c6c476.iinet.net.au)
[22:49:07] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Connection closed)
[22:50:43] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[22:52:45] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[22:52:54] *** Quits: duesenfranz_ (jona@moz-711djm.tirol.surfer.at) (Client exited)
[22:59:26] *** Joins: Jesin (Jesin@moz-t88s6v.cc.lehigh.edu)
[23:03:53] <brson> aturon: how are you managing library triage?
[23:07:25] *** Quits: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net) (Client exited)
[23:08:06] *** Joins: yjv_ (yjv@moz-j0cdis.fios.verizon.net)
[23:09:51] <aturon> Brson
[23:10:17] *** Quits: yjv (yjv@moz-j0cdis.fios.verizon.net) (Ping timeout: 121 seconds)
[23:10:28] <aturon> brson: sorry on phone. Not too many nominations. Basically using lobs planning doc to guide meaty decisions,
[23:10:46] <aturon> Libs*
[23:11:08] <brson> is there a meeting are are you and acrichto just handling it?
[23:11:18] <aturon> making direct calls with acrichto on the relatively straightforward stuff
[23:11:20] <aturon> Yes
[23:11:44] *** Quits: nicknikolov (nicknikolov@moz-u6h.qr2.219.90.IP) (Connection closed)
[23:11:51] <aturon> Happy to have more attendees if you want to join
[23:12:06] <aturon> It's been a bit ad hoc as we are getting things running
[23:12:28] <aturon> But anything interesting is punted to online team discussion
[23:13:26] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[23:16:07] *** Quits: James_ (quassel@moz-8qs8a3.range86-148.btcentralplus.com) (Ping timeout: 121 seconds)
[23:16:42] <bluss> brson: hi, you linked a regression report that seems broken? only 32 crates tested
[23:16:56] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[23:16:59] <aturon> brson: let me know if you want to take part and I'll set up a more formal meeting
[23:22:32] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[23:25:25] *** Quits: amir (amir@moz-qbf4gg.fiber7.init7.net) (Quit: Have to disappear. Read you later guys!)
[23:25:28] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[23:26:32] *** Joins: amir (amir@moz-jnohkj.3bcq.01f6.0168.2a02.IP)
[23:27:34] <bstrie> Manishearth: this analysis is neat, but I'm not sure what the goal is for removing some but not all unstable features from servo when we could be working on stabilizing those features instead
[23:33:19] <bstrie> though perhaps I'm misunderstanding the initiative here
[23:35:23] *** Quits: larhat1 (Adium@moz-vlo5br.cable.virginm.net) (Quit: Leaving.)
[23:37:21] *** Joins: Johannes (Johannes@moz-4et8d7.ocn.ne.jp)
[23:37:28] *** Quits: Johannes (Johannes@moz-4et8d7.ocn.ne.jp) (Connection closed)
[23:37:29] *** Joins: Johannes (Johannes@moz-4et8d7.ocn.ne.jp)
[23:45:32] *** Quits: yjv_ (yjv@moz-j0cdis.fios.verizon.net) (Connection closed)
[23:51:11] *** Quits: dcb (dcb@moz-4hh.6p3.217.74.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[23:52:21] *** Quits: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au) (Ping timeout: 121 seconds)
[23:52:24] *** Joins: jbomo (dkd@moz-uol4mm.fios.verizon.net)
[23:52:53] *** Joins: dcb (dcb@moz-4hh.6p3.217.74.IP)
[23:53:37] *** Joins: nham (nham@moz-lglsfe.il.comcast.net)
