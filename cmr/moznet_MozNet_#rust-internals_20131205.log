[00:07:02] *** Joins: lkuper (lkuper@87D98E32.4046EB22.428F94DD.IP)
[00:13:29] *** Quits: jdm (jdm@CAB30FBD.8F96AEA7.2D179A7D.IP) (Quit: Lost terminal)
[00:14:30] <sfackler> acrichto: how painful would it be to enable core dumps on the build servers?
[00:16:23] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[00:16:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/PjsC_A
[00:16:23] <ghrust> 13rust/06auto 14e76e83c 15Guillaume Pinot: rewrite of shootout-reverse-complement.rs...
[00:16:24] <ghrust> 13rust/06auto 14d18d114 15bors: auto merge of #10799 : TeXitoi/rust/shootout-reverse-complement-resurected, r=alexcrichton...
[00:16:24] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[00:16:46] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[00:17:27] <acrichto> sfackler: I have no idea how to even do that
[00:19:36] <sfackler> in the easiest case it's just "ulimit -c unlimited"
[00:19:57] <sfackler> and then core dumps may end up in the current directory or somewhere else depending on what the system does
[00:21:01] <acrichto> hmm...
[00:21:07] <acrichto> would this be for diagnosing these weird errors?
[00:21:15] *** kimundi is now known as zz_kimundi
[00:21:26] <sfackler> yep, it'll give you a file you can load into gdb that gives you the state of the process at the point at which it aborted
[00:22:08] <acrichto> I agree that would be very nice
[00:22:11] <acrichto> brson, what do you think?
[00:26:05] <larsberg> that ulimit trick is also nice for locally reproducing an intermittent failure because you can write a script that just runs the test over and over until a file named "core" appears
[00:26:25] <strcat> acrichto: http://buildbot.rust-lang.org/builders/auto-linux-64-nopt-t/builds/1908/steps/test/logs/stdio ;\
[00:26:33] * strcat sighs
[00:27:08] <acrichto> I'm very worried about those deaths
[00:27:17] <acrichto> b/c there's almost no output
[00:30:21] *** Quits: pcwalton (pcwalton@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[00:30:35] <acrichto> sfackler: larsberg: do you know if ulimit -c would have to be run once or each time the bots run?
[00:30:49] <sfackler> you can set it as a systemwide limit
[00:30:52] <sfackler> but I can't remember how
[00:32:04] <larsberg> yeah, I've also always done it per-shell (it is local to the shell and the subprocesses created by it).
[00:32:42] <sfackler> acrichto: possibly in /etc/security/limits.conf
[00:33:28] <larsberg> mainly because I'm also usually doing things like limiting the maximum process execution time (to catch runway deadlock) and that's both broken globally and for most of the limits you can only make them smaller (so you can't turn off / increase limits without restarting the shell)
[00:33:33] *** Joins: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net)
[00:33:42] <acrichto> hmm, we're debating how to get the core files to stick around
[00:35:12] <sfackler> acrichto: there are utilities that will stick them in a certain directory instead of leaving them in the cwd
[00:35:26] <larsberg> they can be big if the program is large - they serialize the entire process heap (at least with "unlimited")
[00:35:29] <sfackler> the GHC machines had it set up iirc, which confused me to no end
[00:35:40] <acrichto> is there a way to also save the binary?
[00:36:11] <sfackler> I don't think so
[00:36:16] <acrichto> hm
[00:36:35] <sfackler> looks like you can customize what you do with the core dump via /proc/sys/kernel/core_pattern though
[00:36:37] <sfackler> http://stackoverflow.com/questions/2065912/core-dumped-but-core-file-is-not-in-current-directory
[00:37:09] <sfackler> see also http://man7.org/linux/man-pages/man5/core.5.html
[00:38:13] <brson> we would need the buildslave to backup the entire build directory to make the core dump useful, since it gets wiped every build
[00:38:55] <sfackler> you could do something dumb like check the core dump directory after running the build to check if there's anything there and save off the build directory
[00:39:23] <brson> yeah, we can
[00:51:24] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[00:51:25] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14d18d114 to 14ad58e2c: 02http://git.io/N3iJvQ
[00:51:25] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[00:51:30] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[00:51:30] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/BzrIog
[00:51:30] <ghrust> 13rust/06auto 14c1eb20b 15Daniel Micay: rewrite part of the tutorial...
[00:51:30] <ghrust> 13rust/06auto 14edb9e85 15bors: auto merge of #10690 : thestinger/rust/doc, r=alexcrichton...
[00:51:30] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[00:54:11] *** Joins: dwrensha (chatzilla@moz-DE44EA45.hsd1.pa.comcast.net)
[01:22:34] *** flaper87 is now known as flaper87|afk
[01:28:32] *** Quits: TimAbraldes (quassel@125EF623.B2666F0E.66399531.IP) (Input/output error)
[01:34:45] *** Quits: Axord (xord@moz-C0D5F15A.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[01:38:52] *** nrc is now known as nrc|afk
[01:45:06] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[01:50:13] *** Joins: Sharp (Sharp@1710C26.8381A41.8725677B.IP)
[01:54:14] *** Quits: tjc (tjc@moz-7EE2AFFC.hfc.comcastbusiness.net) (Quit: Textual IRC Client: www.textualapp.com)
[01:56:21] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[01:56:21] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/BzrIog
[01:56:21] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[02:01:31] *** Quits: lkuper (lkuper@87D98E32.4046EB22.428F94DD.IP) (Quit: lkuper)
[02:01:34] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[02:01:34] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/UeqrLg
[02:01:34] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[02:01:37] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[02:01:37] <ghrust> 01[13rust01] 15bors pushed 7 new commits to 06auto: 02http://git.io/nLjWhA
[02:01:37] <ghrust> 13rust/06auto 146fece11 15Patrick Walton: libextra: Another round of de-`Cell`-ing....
[02:01:37] <ghrust> 13rust/06auto 143e0a28e 15Patrick Walton: librustuv: RAII-ify `Local::borrow`, and remove some 12 Cells.
[02:01:38] <ghrust> 13rust/06auto 1499b30f4 15Patrick Walton: libstd: Remove some cells involved in...
[02:01:40] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[02:24:46] <Eridius> crap. my PR bitrotted already, and I just pushed an updated version, but #10791 is going to bitrot it as well
[02:24:49] <Eridius> >_<
[02:25:52] *** Quits: Sharp (Sharp@1710C26.8381A41.8725677B.IP) (Quit: Sharp)
[02:28:27] *** Joins: lkuper (lkuper@moz-72054E1A.nyc.res.rr.com)
[02:32:21] *** nrc|afk is now known as nrc
[02:34:15] *** Joins: ktt3ja (Mibbit@moz-D69B60E4.hsd1.va.comcast.net)
[02:39:28] *** Quits: dbaupp (Thunderbir@A192CB9D.D5A1DCF.37681C44.IP) (Ping timeout)
[02:42:51] *** Joins: dbaupp (Thunderbir@A192CB9D.D5A1DCF.37681C44.IP)
[02:46:23] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[02:46:23] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14beb7d69 to 14edb9e85: 02http://git.io/N3iJvQ
[02:46:23] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[03:02:33] *** Quits: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP) (Quit: Leaving.)
[03:03:40] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[03:03:40] *** ChanServ sets mode: +ao pcwalton pcwalton
[03:05:35] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[03:05:35] *** ChanServ sets mode: +ao dherman dherman
[03:07:02] *** Quits: Jesse_ (jruderman@moz-5973C6FA.oc.oc.cox.net) (Quit: Jesse_)
[03:10:33] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[03:13:30] *** Quits: zz_kimundi (kimundi@moz-D617C5E3.dip0.t-ipconnect.de) (Ping timeout)
[03:16:54] <acrichto> brson: so I had an idea
[03:17:01] <acrichto> so we could have a flag in the task
[03:17:09] <acrichto> which the other end reads and realizes that the task is still running
[03:17:19] <acrichto> (A) put the task on the backburner and run something else
[03:17:20] *** Joins: zz_kimundi (kimundi@moz-DE2CDAC7.dip0.t-ipconnect.de)
[03:17:21] *** zz_kimundi is now known as kimundi
[03:17:29] <acrichto> (B) the task is all I can deal with and I'm guaranteed it's on another thread, so spin
[03:21:17] <brson> acrichto: this race is rare enough that it may not be worth the effort
[03:21:31] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[03:21:34] <acrichto> brson: it would avoid the lock though
[03:23:29] <brson> yes it would
[03:39:32] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[03:41:02] <acrichto> brson: good news is that a lock fixed the problelm
[03:41:20] <acrichto> 2 files changed, 18 insertions(+), 2 deletions(-)
[03:41:24] <acrichto> (no comments)
[03:42:45] <brson> \o/
[03:43:27] * acrichto is sad to add locks
[03:43:36] <acrichto> I thought I had a way of getting rid of the async handle lock
[03:43:38] <acrichto> then I was wrong
[03:43:56] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Ping timeout)
[03:46:40] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[03:49:07] <acrichto> brson: so one optimization we could do is to set a flag when you're in the deschedule block and only bounce on it if the flag is true on the other end, do you think that's worth it?
[03:49:22] <acrichto> that would reduce calls to mutex_{lock,unlock} in context switching
[03:49:41] <brson> acrichto: i doubt it's worth it
[03:50:04] <acrichto> yeah you're probably right
[03:56:40] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[03:56:58] *** Joins: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP)
[03:57:42] <acrichto> brshttps://github.com/mozilla/rust/pull/10817
[03:57:45] <acrichto> brson: ^
[03:57:52] <acrichto> train wifi == bad
[03:58:32] <cmr> nasty_deschedule_lock
[03:58:33] <dbaupp> acrichto: do you ever work somewhere other than a train or plane? :P
[03:58:52] <acrichto> I can occasionally be found on my bed!
[03:59:11] <cmr> heh
[03:59:23] <acrichto> it's also a nasty lock that I didn't like :(
[03:59:27] <acrichto> don't*
[04:03:12] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[04:03:18] *** Quits: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP) (Ping timeout)
[04:04:20] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[04:04:20] *** ChanServ sets mode: +ao pcwalton pcwalton
[04:06:30] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[04:06:30] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Q_cXZg
[04:06:30] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[04:07:50] *** Quits: dwrensha (chatzilla@moz-DE44EA45.hsd1.pa.comcast.net) (Ping timeout)
[04:11:29] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[04:11:29] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/R1jMHA
[04:11:29] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[04:11:30] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[04:11:30] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/2vi0Iw
[04:11:30] <ghrust> 13rust/06auto 14e0264ff 15Alex Crichton: Don't dup the stdio file descriptors....
[04:11:30] <ghrust> 13rust/06auto 149643e48 15bors: auto merge of #10804 : alexcrichton/rust/less-dup, r=pcwalton...
[04:11:31] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[04:17:18] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[04:22:12] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[04:22:12] *** ChanServ sets mode: +ao pcwalton pcwalton
[04:41:39] <Luqman> hmm, what's the difference between glue called in landing pads vs not from a landing pad?
[04:44:05] <acrichto> glue isn't always called from a landing pad, you could call drop glue from the normal path as well
[04:46:25] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[04:46:25] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/FN32IQ
[04:46:25] <ghrust> 13rust/06auto 14e76e83c 15Guillaume Pinot: rewrite of shootout-reverse-complement.rs...
[04:46:25] <ghrust> 13rust/06auto 14bd5305f 15bors: auto merge of #10799 : TeXitoi/rust/shootout-reverse-complement-resurected, r=alexcrichton...
[04:46:26] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[04:46:27] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[04:46:27] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 149643e48 to 1464bcfd2: 02http://git.io/N3iJvQ
[04:46:27] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[04:47:38] <Luqman> acrichto: https://gist.github.com/luqmana/287609be00cd6869889d so this will trigger an llvm assert if you change the u64 to ~u64. For the working case drop glue seems to be called from a normal path whereas for the broken case it's called from a landing pad.
[04:48:08] <Luqman> and by that point we the ValueRef passed to glue is a slice and not a fixed length vec like the glue fn expects
[04:48:22] <Luqman> { i64**, i64 }* vs [0 x i64*]*
[04:48:48] <acrichto> weird
[04:49:00] <acrichto> I can see where that may be a bug!
[04:50:06] <Luqman> the issue is https://github.com/mozilla/rust/issues/9382 btw
[04:52:03] <Luqman> just using a PointerCast seems to work but presumably we shouldn't need to since we started using concrete types with glue fn's
[05:09:22] *** Joins: jdm (jdm@moz-78156D60.dsl.teksavvy.com)
[05:17:05] <Luqman> acrichto: hmm, so it seems to be calling the drop glue on both the original fixed-sized vec and the slice we auto coerce it to
[05:17:11] <Luqman> https://gist.github.com/luqmana/d372a04ef1a2af7fc370
[05:17:28] <Luqman> (line 38 is the cast i added to get past the assertion)
[05:18:02] <acrichto> that seems... wrong
[05:18:41] <acrichto> is that optimized LLVM?
[05:18:50] <acrichto> or just what we codegen'd?
[05:19:01] <Luqman> not optimized
[05:20:32] <Luqman> here's what it does when you change bar to be just u64 instead of ~u64: https://gist.github.com/luqmana/47be9ac078b542a50051
[05:21:07] <Luqman> and there it does the right thing and only calls drop on the original vec
[05:22:27] <Luqman> (curiously both seem to have a useless GEPi (%4 in the first and %3 in the second)
[05:25:08] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[05:32:33] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[05:33:21] *** Joins: Jesse (jruderman@moz-5973C6FA.oc.oc.cox.net)
[05:36:21] *** Quits: ktt3ja (Mibbit@moz-D69B60E4.hsd1.va.comcast.net) (Quit: http://www.mibbit.com ajax IRC Client)
[05:37:39] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[05:38:40] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[05:41:35] *** Quits: Jesse (jruderman@moz-5973C6FA.oc.oc.cox.net) (Quit: Jesse)
[05:44:49] *** Joins: Jesse (jruderman@moz-5973C6FA.oc.oc.cox.net)
[05:51:16] *** Quits: Jesse (jruderman@moz-5973C6FA.oc.oc.cox.net) (Quit: Jesse)
[05:54:18] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[06:00:54] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[06:01:24] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[06:05:10] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[06:06:16] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[06:06:28] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[06:06:28] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/FN32IQ
[06:06:28] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[06:11:24] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[06:11:24] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/LUuWMQ
[06:11:24] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[06:14:09] *** Joins: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP)
[06:19:07] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[06:22:24] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[06:28:54] *** Quits: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net) (Ping timeout)
[06:44:00] *** Quits: dbaupp (Thunderbir@A192CB9D.D5A1DCF.37681C44.IP) (Ping timeout)
[06:45:40] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[06:47:09] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[06:49:43] *** Quits: bjz (bjz@moz-DD4A2A91.lnse2.cha.bigpond.net.au) (Ping timeout)
[06:50:26] *** Quits: lkuper (lkuper@moz-72054E1A.nyc.res.rr.com) (Quit: lkuper)
[07:10:17] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[07:12:35] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[07:13:43] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Quit: Textual IRC Client: www.textualapp.com)
[07:15:09] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[07:18:57] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[07:21:10] <jdm> 0x0000000101d2e7b0 <dyld_stub_JS_ReportError+0>:jmpq   *0x8ba6a(%rip)        # 0x101dba220
[07:21:20] <jdm> I have never seen the * notation before
[07:21:22] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[07:21:22] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/doZBgg
[07:21:22] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[07:21:23] <jdm> what's it mean?
[07:21:49] *** Joins: notmatt_ (notmatt@moz-9FB2565E.vc.shawcable.net)
[07:21:51] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Connection reset by peer)
[07:22:41] <jdm> aha, it's an absolute jump
[07:26:20] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[07:26:20] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/U-Zvqg
[07:26:20] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[07:26:24] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[07:26:24] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/3QfpMw
[07:26:24] <ghrust> 13rust/06auto 14408dc5a 15Kevin Ballard: Revert "libstd: Change `Path::new` to `Path::init`."...
[07:26:24] <ghrust> 13rust/06auto 142c4a1b5 15Kevin Ballard: Rename extra::json::*::init() constructors to *::new()
[07:26:24] <ghrust> 13rust/06auto 14b170571 15Kevin Ballard: Rename std::rt::deque::*::init() to *::new()
[07:26:26] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[07:29:50] <sfackler> isn't that an indirect jump?
[07:30:14] <jdm> yes
[07:57:57] <eddyb> nmatsakis: my limited knowledge on type systems/theory is biting me again, I'm not sure I can reply to this https://github.com/mozilla/rust/issues/10124#issuecomment-29840556
[07:58:06] *** Joins: dbaupp (Thunderbir@moz-EB2EFE6F.lns20.syd6.internode.on.net)
[08:01:04] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[08:08:43] *** Quits: notmatt_ (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[08:09:53] <eddyb> cmr: interesting, middle::ty::type_contents seems to allocate most of the heap space during trans
[08:10:03] *** Quits: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP) (Ping timeout)
[08:10:20] <eddyb> 67MB just for subst
[08:11:09] *** Joins: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP)
[08:13:54] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[08:14:57] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[08:26:37] *** flaper87|afk is now known as flaper87
[08:30:06] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[08:33:26] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[08:36:22] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[08:36:22] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/3QfpMw
[08:36:22] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[08:36:37] *** Quits: canhtak (canhtak@moz-A53E1151.wl.t.ulaval.ca) (Quit: canhtak)
[08:37:33] *** Quits: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP) (Ping timeout)
[08:39:29] *** Joins: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP)
[08:41:22] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[08:41:22] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Bpmh-Q
[08:41:22] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[08:41:26] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[08:41:26] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/S6cxZg
[08:41:26] <ghrust> 13rust/06auto 14391d811 15Alex Crichton: Update LLVM and jettison jit support...
[08:41:26] <ghrust> 13rust/06auto 14b7a4f47 15Alex Crichton: Remove unused upcalls...
[08:41:26] <ghrust> 13rust/06auto 1488e64b9 15Alex Crichton: Attempting to fix LLVM build issue
[08:41:28] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[08:42:26] <eddyb> cmr: my gdb mmap&mremap script is not good enough :( - feel free to run massif (not overkill anymore) whenever you have time for it
[08:54:35] <Eridius> yay, my PR landed! \o/
[08:56:22] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[08:56:23] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 140b76f79 to 14b5bab85: 02http://git.io/N3iJvQ
[08:56:23] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[09:12:56] *** Quits: jdm (jdm@moz-78156D60.dsl.teksavvy.com) (Quit: Lost terminal)
[09:18:30] <eddyb> cmr: is it just me, or does massif perform better in terms of total visible RAM usage?
[09:19:08] <eddyb> or maybe it's slow enough that I'm seeing down-slopes
[09:30:57] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[09:32:29] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[09:33:47] *** Quits: Kxepal (Miranda@moz-F2C9521E.pppoe.mtu-net.ru) (Ping timeout)
[09:34:30] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[09:34:46] *** Quits: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP) (Ping timeout)
[09:35:06] *** Joins: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP)
[09:35:36] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[09:36:42] *** Joins: Kxepal (Miranda@moz-A1D61FF4.pppoe.mtu-net.ru)
[09:38:09] <dbaupp> Eridius: we're back to `new`?
[09:39:32] *** Quits: bstrie (ben@moz-D5A1D0F5.members.linode.com) (Ping timeout)
[09:39:45] *** Quits: mrmonday (mrmonday@moz-C7DC1A73.lin.openzula.org) (Ping timeout)
[09:39:46] *** Quits: jack (jack@moz-DF5A9AA3.members.linode.com) (Ping timeout)
[09:39:53] *** Quits: dbaupp (Thunderbir@moz-EB2EFE6F.lns20.syd6.internode.on.net) (Ping timeout)
[09:39:58] *** Joins: dbaupp (Thunderbir@moz-EB2EFE6F.lns20.syd6.internode.on.net)
[09:39:59] *** Quits: km (quassel@moz-777F24DE.kevinmehall.com) (Ping timeout)
[09:39:59] *** Quits: benh (ben@moz-4A0366D2.org) (Ping timeout)
[09:40:05] *** Quits: kimundi (kimundi@moz-DE2CDAC7.dip0.t-ipconnect.de) (Ping timeout)
[09:40:05] *** Quits: pcmattman (pcmattman@moz-D9B7D938.net) (Ping timeout)
[09:40:05] *** Quits: friggle (friggle@moz-A607EAFA.members.linode.com) (Ping timeout)
[09:40:05] *** Quits: rhodesd (none@3646D136.4C5731DA.F395EA5B.IP) (Ping timeout)
[09:40:05] *** Joins: bstrie (ben@moz-D5A1D0F5.members.linode.com)
[09:40:06] *** Joins: rhodesd (none@3646D136.4C5731DA.F395EA5B.IP)
[09:40:06] *** Joins: friggle (friggle@moz-A607EAFA.members.linode.com)
[09:40:10] *** Quits: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr) (Ping timeout)
[09:40:16] *** Quits: zol (Zolomon@moz-CE018D85.members.linode.com) (Ping timeout)
[09:40:16] *** Joins: km (quassel@moz-777F24DE.kevinmehall.com)
[09:40:18] *** Quits: cyndis (cyndis@moz-C4357EA7.kapsi.fi) (Ping timeout)
[09:40:20] *** Quits: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk) (Ping timeout)
[09:40:20] *** Quits: zokier` (zokier@moz-C4357EA7.kapsi.fi) (Ping timeout)
[09:41:30] *** Joins: zz_kimundi (kimundi@moz-DE2CDAC7.dip0.t-ipconnect.de)
[09:41:32] *** Joins: zol (Zolomon@moz-CE018D85.members.linode.com)
[09:41:41] *** Joins: nielsle (nielsle@moz-C46DA772.boa.fiberby.dk)
[09:41:49] *** Joins: pcmattman (pcmattman@moz-D9B7D938.net)
[09:41:54] *** zz_kimundi is now known as kimundi
[09:45:23] *** Joins: benh (ben@moz-4A0366D2.org)
[09:46:24] *** Joins: cyndis (cyndis@moz-C4357EA7.kapsi.fi)
[09:46:25] *** Joins: zokier` (zokier@moz-C4357EA7.kapsi.fi)
[09:46:53] *** Joins: mrmonday (mrmonday@moz-C7DC1A73.lin.openzula.org)
[09:46:55] *** Joins: jack (jack@moz-DF5A9AA3.members.linode.com)
[09:48:42] *** Joins: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr)
[09:59:53] <eddyb> 21.56% (218,676,384B) 0x682BC8B: middle::ty::mk_t::h1c2db25e409a61b1aR::v0.9$x2dpre
[10:00:00] <eddyb> that's a lot, but not as much as I thought
[10:05:49] <eddyb> cmr: https://gist.github.com/eddyb/e9020fbcd9fcd444ebf0 - I can't tell too much from that :/
[10:17:21] *** Quits: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP) (Quit: Leaving.)
[10:20:26] *** Joins: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP)
[10:33:09] <nmatsakis> eddyb: to be perfectly honest, i'm a bit nervous too. I've not wanted to discourage you exactly, but I haven't had time to think abou this proposal a lot, and there are always twists and turns.
[10:33:37] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[10:35:07] <nmatsakis> eddyb: still one of the surest ways to find problems is (often) to implement :)
[10:35:38] <eddyb> nmatsakis: about that, check the Clone impl I've added to the examples
[10:35:43] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[10:36:25] <eddyb> it would be trickier to use the C++ model (specialized template to finish the recursion) than pattern-matching
[10:38:38] <eddyb> I'm still not sure I can implement a zip function - where (a, b, c).zip((d, e, f)) == ((a, d), (b, e), (c, f)) 
[10:38:49] *** Quits: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP) (Ping timeout)
[10:39:32] *** Joins: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP)
[10:40:56] <eddyb> oh, look, TypeContents uses 64 bits when 12 would suffice
[10:44:01] <eddyb> OwnsAffine... what is that for?
[10:44:43] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[10:44:54] <eddyb> &mut and @once fn?
[10:46:07] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[10:49:07] <eddyb> nmatsakis: I'm seeing unsized artifacts around middle::ty, almost as if DST is only missing syntactic support :/
[10:50:11] <dbaupp> eddyb: iirc, pnkfelix did a pile of work getting the Unsized idea into the compiler
[10:50:43] <eddyb> dbaupp: more things I missed
[10:51:01] <dbaupp> this was a long time ago
[10:53:10] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[10:54:32] <nmatsakis> actually bblum did most of the existing work,
[10:54:43] <nmatsakis> but it's only a small part of what is required.
[10:55:02] <dbaupp> oh, I misremembered.
[10:55:16] <nmatsakis> the biggest part being making sure that everything makes sense, which is what pnkfelix and I are trying to do atm :)
[10:55:34] * nmatsakis hacks on his executable model of Rust
[10:56:05] <friggle> nmatsakis: an executable model?
[10:57:35] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[10:59:15] <nmatsakis> friggle: based on redex
[10:59:30] <nmatsakis> (very) simplified variant of Rust, basically.
[11:00:33] *** Quits: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP) (Quit: Leaving.)
[11:00:40] <friggle> nmatsakis: neat
[11:01:24] *** Joins: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP)
[11:03:40] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[11:08:25] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Connection reset by peer)
[11:08:41] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[11:10:10] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Connection reset by peer)
[11:10:28] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[11:12:04] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[11:15:17] * eddyb builds rustc-stage2 to see if there's any visible difference
[11:18:16] <eddyb> uhm, can't tell
[11:20:43] *** Quits: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP) (Quit: Leaving.)
[11:33:06] <eddyb> and it doesn't look like it helps my test-case at all
[11:45:02] <eddyb> though, I realized something very peculiar
[11:45:30] <eddyb> cmr: 500 out of 2000 match cases are responsible for 2.8GB out of 3.8GB
[11:47:51] <eddyb> if (b[i] & 0x80) == 0x80.... that doesn't seem significant at all
[11:54:16] <dbaupp> https://github.com/mozilla/rust/pull/10824 r?
[11:54:32] <dbaupp> (it's just docs... although, it's quite a lot of them.)
[11:56:57] <eddyb> ooooh, there's a lot of intermediaries and stuff like this: [_12, _22, _33, _41, _48, _55, _62, _69][(b[i+1] & 7u8)]
[11:58:39] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[11:59:46] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[12:00:14] <eddyb> cmr: for the reference, the "if (((b[i] & 128u8) >> 7u8) & 0x1) == 0x1 {" block starting at 3154 is responsible for most of the bloat
[12:08:21] <eddyb> 600MB with only that block, 1000MB without it... where's the 3.8GB?
[12:10:56] *** Joins: jensnockert (jensnocker@moz-635BD7F5.wireless.lu.se)
[12:12:22] *** Quits: jensnockert (jensnocker@moz-635BD7F5.wireless.lu.se) (Input/output error)
[12:13:18] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[12:15:00] *** Joins: jensnockert (jensnocker@moz-635BD7F5.wireless.lu.se)
[12:15:50] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[12:17:58] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[12:18:35] <eddyb> cmr: are you sure it was 3.8GB? and not 1.8GB? did you have -Z extra-debug-info for that run?
[12:19:30] <eddyb> I just finished compiling the whole testcase
[12:20:16] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[12:27:01] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[12:39:10] <SimonSapin> Is str.insert just missing, or was it omitted on purpose?
[12:48:31] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Quit: Textual IRC Client: www.textualapp.com)
[12:49:14] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[12:59:41] *** Quits: jensnockert (jensnocker@moz-635BD7F5.wireless.lu.se) (Connection reset by peer)
[13:00:02] *** Joins: jensnockert (jensnocker@moz-635BD7F5.wireless.lu.se)
[13:02:03] *** Joins: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP)
[13:14:05] <kimundi> SimonSapin: hm?
[13:16:47] <SimonSapin> kimundi: ~str has method to add stuff at the beggining (unshift), at the end (push) but not in the middle at a given index
[13:16:52] <SimonSapin> is there a reason to not have it?
[13:17:32] <kimundi> Can't think of one other than "It's inefficient", but that is also true for vectors, which have such a method afaik
[13:18:18] <SimonSapin> itâ€™s inefficient yes, but punycode decoding does insertions pretty much by design
[13:20:28] <kimundi> rusti: fn insert<'a>(s: &'a str, is: &'a str, i: uint) -> ~str { let v = [ s.slice_to(i), is, s.slice_from(i) ]; v.concat() } insert("foobar", "baz", 3)
[13:20:29] -rusti- ~"foobazbar"
[13:20:41] <kimundi> writing it is easy enough at least :P
[13:21:14] <kimundi> (Well, I guess a better impl would work on a existing ~str)
[13:24:07] <kimundi> In any case, the String API is still not stable, so if something is missing, that's usually not by design
[13:26:18] <SimonSapin> cool, thanks
[13:32:08] <ChrisMorgan> SimonSapin: is doing it in-place (rather than constructing another string) really going to be best?
[13:32:40] <SimonSapin> ChrisMorgan: I donâ€™t know
[13:33:50] <kimundi> Well, as long as a ~str is growable, in place insertion can be a O(n) operation without allocation, instead of a O(n) operation witk allocation
[13:34:22] <kimundi> Provided the capacity is high enough to fit the inserted string
[13:34:36] <ChrisMorgan> kimundi: but you've got to shift all the other stuff along, which will make it O(nÂ²).
[13:34:52] <eddyb> uhm, no
[13:35:03] <kimundi> No? We'Re not writing a insertion sort here, just a insertion :P
[13:35:04] <eddyb> you don't shift one byte at a time
[13:35:40] <ChrisMorgan> kimundi: you're pairing insertion (O(n)) with traversal (O(n)). At each point, it may wish to insert, hence O(nÂ²).
[13:35:44] <kimundi> gaar, why do I still get link errors??
[13:35:58] <kimundi> ChrisMorgan: Hu?
[13:36:12] <eddyb> memmove to shift the tail into place + memcpy for the actual insertion
[13:36:14] <kimundi> ChrisMorgan: .... which kind of insertion operation are you thinking of here?
[13:36:23] *** Quits: jensnockert (jensnocker@moz-635BD7F5.wireless.lu.se) (Input/output error)
[13:36:42] <kimundi> ChrisMorgan: because I'm thinking of one where you give a byte index and a string to be inserted, and that's O(n) :P
[13:36:56] <ChrisMorgan> memmove must be O(n), right? I can't see how it could be anything other than that.
[13:37:12] <ChrisMorgan> kimundi: we're talking in-place punycode decoding, right?
[13:37:20] <SimonSapin> ChrisMorgan: you only need one memmove per insert
[13:37:24] <eddyb> memmove is O(n) just like memcpy is O(n)
[13:37:35] <eddyb> it might be slower, but that's it
[13:37:35] <kimundi> No, we'Re just talking about inplace insertion of one string into another
[13:37:48] <SimonSapin> oh, yes, punycode overall will have square-ish runtime
[13:37:59] <ChrisMorgan> kimundi: but the *whole operation* of punycode decoding will be O(nÂ²).
[13:37:59] <kimundi> which SimonSapin wants _for_ punycode decoding, but thats not something I was talking about
[13:38:36] <kimundi> Naivly implemented with string insertion, that is likely to happen, yes.
[13:38:38] <ChrisMorgan> That's what I was speaking about, because the alternative of working with a new string is O(n). Of course, then you've got to figure out if the overheads make it more worthwhile anyway.
[13:38:40] <SimonSapin> punycode does some number of inserts, but each insert is O(n)
[13:39:14] <ChrisMorgan> ("it" being the O(nÂ²) in-place operation at the end of my last sentence.)
[13:39:34] *** Joins: canhtak (canhtak@moz-A53E1151.wl.t.ulaval.ca)
[13:39:49] <SimonSapin> punycode being O(nÂ²) is fine, the input is typically small
[13:40:00] <ChrisMorgan> Or you can just assume it'll all be OK and no one will be giving you more than 64 character input anyway.
[13:42:40] <kimundi> You have the option of one short vector allocation, and one allocation of the memory for the finished string, and get a O(n) runtime in return - Or you can just call an inplace insert all the time, which can cause zero or more allocations of the growable string, and has a runtime of O(n)
[13:43:57] <kimundi> the first one is basically t collect all string fragments in a ~[&str] and concatenate them once
[13:44:20] <eddyb> I have the best solution :P
[13:44:42] <eddyb> though I can't remember if someone told me I was reinventing the wheel or not
[13:45:42] <kimundi> eddyb: YOu'Re talking about your idea to use the stack as a temporary storage space?
[13:45:48] <eddyb> kimundi: you remembered!
[13:46:03] <kimundi> I'm not sure if that would work here efficiently without an alloca
[13:46:27] <kimundi> Also, if your inout is to big you get an stack overflow, and the process aborts :P
[13:46:32] <kimundi> input*
[13:47:07] <eddyb> but yeah, same concept. here you can store the byte offsets on the stack, grow the original string at the end (a maximum of one reallocation), then memmove each slice into place, on your way up
[13:48:10] <eddyb> min O(N), max O(2*N) (when the reallocation causes a memcpy)
[13:48:55] <eddyb> and where N is the length of the final string
[13:49:24] <eddyb> kimundi: nah, you don't need to store strings on the stack, just offsets
[13:50:43] <eddyb> there has to be a name for my idea, and there might be a way to implement a generic version of it
[13:52:04] <eddyb> (haskell code might use this trick often, because recursion and whatnot)
[13:54:12] <eddyb> now, I'd be happy to get .move().or_else(|| *self) working
[13:56:32] <kimundi> eddyb: using ~Any ?
[13:56:48] <kimundi> (Or is there something else with a .move() method)
[13:58:16] <eddyb> kimundi: enum Expr<'a, U>::move() would return Option<Expr<'b, U>>, Some(*self) for the variants that have only immediate data, None otherwise (e.g. it has borrowed pointers)
[13:58:36] <eddyb> does "move" make sense, as a name? I asked a few times, nobody replied
[13:59:35] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[13:59:39] <kimundi> uhm, could you sketch that down in a gist? From that explanation, it's still not really clear to me :)
[14:01:04] <eddyb> U16Const(0).move() == Some(U16Const(0)). U16Cast(&some_other_expr).move() == None // the whole point is to allow moving a value up the stack, by changing its lifetime
[14:01:32] <eddyb> I could make a gist, but it will be truncated and without syntax highlighting
[14:04:17] <kimundi> Why would it be truncated? ANd gist has more rust syntax higlinging than IRC :P
[14:04:41] <kimundi> (The trick is to give the gist file a .rs ending, which will automatically aply rust highlining)
[14:05:22] <kimundi> "changing its lifetime" - erm, I'm not sure that is possible
[14:05:32] <eddyb> kimundi: it is when the contents are immediate
[14:05:47] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[14:06:07] <kimundi> The language semantic forbids it though
[14:06:19] <kimundi> You can only shorten a lifetime
[14:06:36] <kimundi> (in safe code at least)
[14:06:38] <eddyb> because the lifetime isn't used. imagine enum Ptr<'a, T> {Null, Immediate(T), Borrowed(&'a T)}
[14:08:16] <kimundi> If by "changing its lifetime" you mean unwraping a value so that the lifetime no longer exists and you have a bare value - sure that works, I wouldn't call it a _change_ though :P
[14:08:54] <eddyb> sorry, it's changing its lifetime parameter
[14:11:54] <kimundi> See, that'S what I need a proper gist for, I'm terrible at understanding explanations ;)
[14:16:01] *** Joins: jdm (jdm@CAB30FBD.8F96AEA7.2D179A7D.IP)
[14:16:55] *** Quits: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP) (Quit: Leaving.)
[14:19:15] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[14:32:52] *** Joins: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP)
[14:38:44] <ChrisMorgan> http://huonw.github.io/isrustfastyet/buildbot/ doesn't seem to be getting updated :-(
[14:38:55] *** Quits: pnkfelix (pnkfelix@1ED7AD9.5831E18D.54C3481B.IP) (Quit: Leaving.)
[14:40:41] <eddyb> ChrisMorgan: cmr doesn't seem to be around, he's responsible :P
[14:50:02] *** Joins: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net)
[14:52:57] *** Quits: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net) (Ping timeout)
[15:03:39] *** Quits: canhtak (canhtak@moz-A53E1151.wl.t.ulaval.ca) (Quit: canhtak)
[15:04:33] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[15:05:15] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[15:05:27] <eddyb> cmr: it doesn't go past 1.6GB now and it usually compiles faster than rustc o_O
[15:08:53] <eddyb> kimundi: https://gist.github.com/eddyb/d584029eaecee09692c5#file-arch-x86_16-just-runtime-rs-L434
[15:09:50] *** Quits: jdm (jdm@CAB30FBD.8F96AEA7.2D179A7D.IP) (Ping timeout)
[15:09:58] <eddyb> and it doesn't seem to work :(
[15:11:33] <eddyb> ah, haha, that's because I forgot something
[15:11:45] *** Joins: jdm (jdm@CAB30FBD.8F96AEA7.2D179A7D.IP)
[15:12:04] <kimundi> eddyb: Right, what you have there can't work, as it says "return a type that is generic over any lifetime 'b that the caller can choose" - something that is not doable right now.
[15:12:20] <kimundi> And which wouldn't make much sense
[15:12:28] <eddyb> no, that part works
[15:12:45] <kimundi> Well, Ig uess depending on situation it can make sense, but it'S not how lifetimes are supoosed to be used
[15:12:48] *** Joins: canhtak (canhtak@moz-A53E1151.wl.t.ulaval.ca)
[15:12:51] <kimundi> It does? hm
[15:12:57] <eddyb> I could put 'static if 'b wouldn't work, same thing
[15:13:26] <eddyb> the point is that the lifetime parameter for the return type doesn't matter, since it's not used in returned values
[15:13:28] <kimundi> well, that would work because 'static does always work
[15:14:01] <kimundi> eddyb: But the kifetime parameter is aproperty of the type, not of the values in the type
[15:14:22] <eddyb> hehehehehehehe. not sure why I feel like laughing
[15:14:51] <kimundi> Because I'm typing like crap right now? :P
[15:15:06] <eddyb> no, because what I'm doing actually makes sense
[15:15:40] <eddyb> imagine "casting" Option<&'a T> to Option<&'b T>. in which cases would that work?
[15:15:56] <SimonSapin> which make target should I use to test I just added to libstd, without doing redundant building?
[15:16:08] <eddyb> it's an env variable, let me check
[15:16:18] <kimundi> Anyway, the lifetimes are part of the type system to prove that something can be safely used - its an approximation
[15:16:23] <kimundi> SimonSapin: make check-stage1-std
[15:16:35] <eddyb> and NO_REBUILD=1
[15:16:59] <eddyb> kimundi: None::<&'a T> can be safely "casted" to None::<&'b T>
[15:17:17] <kimundi> eddyb: In what situation?
[15:17:23] <eddyb> in all situations
[15:17:38] <kimundi> No, I mean, gimme a code example :P
[15:18:07] <eddyb> as long as the values are explicit, you can write a function that maps Option<&'a T> to Option<Option<&'b T>>
[15:18:33] <eddyb> Some(&'a T) => None, None => Some(None)
[15:19:14] <eddyb> it makes less sense in that case (because of the nested Options), maybe with Either or Result I could convince you :P
[15:19:45] <kimundi> eddyb: I have a feeling that I simply don't know enough about the details to really know why stuff like that works, and when it doesn't :P
[15:19:54] <eddyb> kimundi: you can always create a None::<&'x T> for any 'x, it doesn't matter
[15:20:16] *** Joins: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net)
[15:20:25] <eddyb> as long as the value doesn't actually borrow, it can take any lifetime parameter of the type
[15:20:29] <kimundi> Yes, that I know, I think. :P
[15:21:06] <kimundi> I could be completely wrong here - let'S start at the beginning, what doesn'T work in your gist?
[15:21:08] <eddyb> that's what I'm doing, *for some of the variants of an enum*, specifically those that don't have borrowed references
[15:21:22] <eddyb> kimundi: oh, I said already, I messed up somewhere, I know how to fix what doesn't work :P
[15:21:52] <eddyb> it's unrelated to the functionality of move and move_or
[15:24:13] <eddyb> kimundi: sorry for the confusion :)
[15:25:23] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[15:25:52] <eddyb> hopefully I don't get disconnected this compile run
[15:27:26] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[15:27:39] <eddyb> LLVM flatline is at 1.2GB, just 200MB higher than for rustc :D
[15:30:07] <eddyb> rusti: (0x75, 0x5c, 0x15c)
[15:30:07] -rusti- (117, 92, 348)
[15:30:54] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[15:31:02] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[15:31:02] *** ChanServ sets mode: +ao dherman dherman
[15:34:04] <SimonSapin> "error: undefined reference to 'ceil'" and other math stuff when building rust. What could cause this?
[15:36:30] <kimundi> There apparently where a few changes to llvm and the runtime/build system in general the last few days - you might have to re-./configure
[15:39:42] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[15:40:36] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[15:41:22] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[15:42:45] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[15:46:44] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[15:47:28] <SimonSapin> kimundi: same :/
[15:51:56] <eddyb> whoa, my type comparison is totally whacked
[15:57:14] *** Quits: jdm (jdm@CAB30FBD.8F96AEA7.2D179A7D.IP) (Quit: Lost terminal)
[15:57:46] *** Quits: vky (chatzilla@moz-4F2E17BF.dsl.dynamic.sonic.net) (Quit: ChatZilla 0.9.90.1 [Firefox 26.0/20131125215016])
[16:11:36] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Input/output error)
[16:19:06] *** Joins: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net)
[16:19:06] *** ChanServ sets mode: +ao dherman dherman
[16:19:20] <SimonSapin> How can I get a stack trace of task (test) failure? upcall_fail is not there to break on anymore
[16:21:23] <ChrisMorgan> `catch throw` is the easy way in gdb.
[16:21:51] <ChrisMorgan> Or there's rust_begin_unwind.
[16:22:37] *** Joins: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP)
[16:30:42] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[16:37:29] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[16:39:25] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[16:42:40] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[16:50:44] *** Joins: jmbto (jmbto@moz-FE174E29.fbx.proxad.net)
[16:52:46] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[16:53:49] *** Quits: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net) (Quit: Sharp)
[16:56:09] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[16:56:09] *** ChanServ sets mode: +qo brson brson
[16:56:11] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: brson)
[16:56:28] *** Joins: brson (brson@6A848D32.C1B840DD.76F66111.IP)
[16:56:28] *** ChanServ sets mode: +qo brson brson
[17:04:26] *** Joins: Sharp (Sharp@moz-7B61DF4.dsl.static.sonic.net)
[17:09:42] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[17:21:24] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[17:22:24] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[17:23:48] *** Joins: Axord (xord@moz-C0D5F15A.lsanca.dsl-w.verizon.net)
[17:24:31] *** jdm is now known as jdm|f00ding
[17:26:43] *** Joins: ktt3ja (Mibbit@moz-D69B60E4.hsd1.va.comcast.net)
[17:30:09] *** Joins: w3lcome (Mibbit@moz-49575A06.home.otenet.gr)
[17:31:44] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[17:31:44] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/tEuPCA
[17:31:44] <ghrust> 13rust/06auto 146b34ba2 15Alex Crichton: Update LLVM and jettison jit support...
[17:31:44] <ghrust> 13rust/06auto 14bc89034 15Alex Crichton: Remove unused upcalls...
[17:31:44] <ghrust> 13rust/06auto 14b4faf9b 15bors: auto merge of #10758 : alexcrichton/rust/upgrade-llvm, r=thestinger...
[17:31:46] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[17:35:27] <SimonSapin> Is it possible to have a static value of a struct with private fields? The constructor is not allowed in a constant expression
[17:36:20] <eddyb> not without CTFE, and we don't have that
[17:36:59] <SimonSapin> whatâ€™s CTFE?
[17:37:09] <eddyb> compile-time function evaluation
[17:37:44] <eddyb> static FOO: FooBar = FooBar::new();
[17:37:53] <SimonSapin> ok
[17:38:00] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[17:38:04] *** Quits: canhtak (canhtak@moz-A53E1151.wl.t.ulaval.ca) (Quit: canhtak)
[17:41:42] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[17:42:18] *** Quits: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net) (Ping timeout)
[17:44:04] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[17:46:30] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[17:46:30] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14b4faf9b to 14b5bab85: 02http://git.io/N3iJvQ
[17:46:30] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[17:46:34] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[17:46:35] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/2tFp2A
[17:46:35] <ghrust> 13rust/06auto 148257dbd 15Alexandros Tasos: Fix documentation typo (divison operator is not backslash)
[17:46:35] <ghrust> 13rust/06auto 14617ce85 15bors: auto merge of #10825 : octurion/rust/master, r=alexcrichton
[17:46:35] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[17:47:31] *** Joins: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net)
[17:48:09] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[17:48:37] *** Joins: canhtak (canhtak@moz-A53E1151.wl.t.ulaval.ca)
[17:49:53] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[17:50:04] *** Quits: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net) (Ping timeout)
[17:53:52] *** Joins: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net)
[18:01:01] *** Joins: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net)
[18:10:55] <cmr> eddyb: just read logs.
[18:11:16] <cmr> I just got the memory use from /usr/bin/time which is crude but an okish approximation.
[18:11:41] <eddyb> extra-debug-info or not?
[18:11:53] <cmr> probably with.
[18:16:46] <eddyb> cmr: can you try this, with no optimization or debug info? https://gist.github.com/eddyb/b802f5bdc4174e0fbf11
[18:19:18] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[18:20:21] <cmr> eddyb: 1.6G
[18:20:43] <eddyb> mkay, so touching TypeContents did nothing
[18:23:45] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[18:26:04] *** Quits: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au) (Ping timeout)
[18:28:58] *** jdm|f00ding is now known as jdm
[18:35:18] *** Quits: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net) (Ping timeout)
[18:41:34] *** Joins: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net)
[18:41:34] *** ChanServ sets mode: +ao dherman dherman
[18:51:09] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[18:55:59] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[18:55:59] *** ChanServ sets mode: +ao pcwalton pcwalton
[19:03:04] *** Joins: bjz (bjz@moz-C1B1AF2A.lnse2.cha.bigpond.net.au)
[19:16:31] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[19:16:31] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/2tFp2A
[19:16:31] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[19:21:36] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[19:21:36] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/xVGI_g
[19:21:36] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[19:21:38] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[19:21:38] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/a1AluQ
[19:21:38] <ghrust> 13rust/06auto 146b34ba2 15Alex Crichton: Update LLVM and jettison jit support...
[19:21:38] <ghrust> 13rust/06auto 14bc89034 15Alex Crichton: Remove unused upcalls...
[19:21:38] <ghrust> 13rust/06auto 141828dd2 15bors: auto merge of #10758 : alexcrichton/rust/upgrade-llvm, r=thestinger...
[19:21:40] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[19:30:12] *** Quits: canhtak (canhtak@moz-A53E1151.wl.t.ulaval.ca) (Quit: canhtak)
[19:36:33] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[19:36:33] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 141828dd2 to 14617ce85: 02http://git.io/N3iJvQ
[19:36:33] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[19:36:34] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[19:36:34] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/dw9R4Q
[19:36:34] <ghrust> 13rust/06auto 146b34ba2 15Alex Crichton: Update LLVM and jettison jit support...
[19:36:34] <ghrust> 13rust/06auto 14bc89034 15Alex Crichton: Remove unused upcalls...
[19:36:34] <ghrust> 13rust/06auto 14c3e74c1 15bors: auto merge of #10758 : alexcrichton/rust/upgrade-llvm, r=thestinger...
[19:36:36] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[19:39:29] *** Joins: canhtak (canhtak@moz-A53E1151.wl.t.ulaval.ca)
[19:41:44] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[19:43:50] <acrichto> brson: do you have a list of all github icons lying around?!
[19:43:56] <acrichto> you always seem to know how to find the perfect one
[19:44:14] <cmr> they have an api for it actually
[19:44:21] <acrichto> oh really?
[19:44:31] <cmr> yup
[19:44:34] <cmr> but, http://www.emoji-cheat-sheet.com/
[19:44:45] <acrichto> ah!
[19:44:56] <acrichto> lol 4 different rage faces
[19:45:00] <acrichto> b/c 1 isn't good enough
[19:45:24] <cmr> those are from doom
[20:16:32] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[20:16:32] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/iV9K8g
[20:16:32] <ghrust> 13rust/06auto 14be0580b 15Alex Crichton: Solve some nasty deschedulinging races with a lock...
[20:16:32] <ghrust> 13rust/06auto 140c308a3 15bors: auto merge of #10817 : alexcrichton/rust/sched-fix, r=brson...
[20:16:33] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[20:18:21] *** Quits: brson (brson@6A848D32.C1B840DD.76F66111.IP) (Ping timeout)
[20:20:51] *** Joins: geoffhill (geoffhill@moz-738DC0DB.org)
[20:23:03] *** Quits: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net) (Quit: dherman)
[20:32:12] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[20:32:12] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 140c308a3 to 14617ce85: 02http://git.io/N3iJvQ
[20:32:12] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[20:32:16] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[20:32:16] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/uMcG9Q
[20:32:16] <ghrust> 13rust/06auto 14d902e71 15Kiet Tran: Add lru_cache to libextra
[20:32:16] <ghrust> 13rust/06auto 143cc86d8 15bors: auto merge of #10211 : ktt3ja/rust/add-lrucache, r=brson...
[20:32:17] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[20:38:34] *** jdm is now known as jack_
[20:38:57] *** jack_ is now known as jdm
[20:52:09] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[20:57:22] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[21:08:08] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[21:10:52] *** Joins: brson (brson@6A848D32.C1B840DD.76F66111.IP)
[21:10:52] *** ChanServ sets mode: +qo brson brson
[21:11:22] <nmatsakis> pcwalton: I was contemplating our discussion of once fns last night,
[21:11:31] <nmatsakis> pcwalton: I think what's needed to model them using traits,
[21:11:49] <nmatsakis> pcwalton: and also to permit the use case of a slice one can move out of,
[21:12:31] <nmatsakis> pcwalton: is a distinct kind of pointer. Something like `my 'a T` -- basically says, here is some memory that is valid for lifetime 'a, you own the referent, but are not responsible for freeing the memory itself
[21:12:46] <pcwalton> yeah, I was afraid you'd say that :)
[21:12:51] <nmatsakis> I've been wondering if this can be achieved with smart pointers or something
[21:12:58] <nmatsakis> didn't think too hard about it yet
[21:13:03] <nmatsakis> not saying we should add it either,
[21:13:07] <nmatsakis> just saying that's what's happening here
[21:13:12] <pcwalton> sure
[21:13:27] <nmatsakis> we have: "here is memory you don't own" and "here is a block of memory you own" but no way to say "here is some memory whose *contents* you own"
[21:13:42] <nmatsakis> this also pertains to issue #10672
[21:14:01] <nmatsakis> since that's kind of what I was suggesting we could do to permit fn(self) calls on object types, but in a less principled way
[21:14:45] * nmatsakis wonders how many variations on ownership there are in the universe.
[21:16:18] <strcat> closures are weird in regards to mutability too
[21:16:59] <strcat> if &Fn can't mutate the env, you need a way to make a function doing that unable to be &Fn
[21:17:07] * strcat shrugs
[21:19:59] <nmatsakis> strcat: &fn is really &mut fn
[21:20:08] <nmatsakis> strcat: I don't think that particular aspect is troublesome.
[21:20:17] <nmatsakis> except in so far as writing &mut fn() would be annoying.
[21:20:22] <strcat> but if they were traits you could make &Fn
[21:20:27] <nmatsakis> yes, so?
[21:20:29] <strcat> I guess it would take &mut self
[21:20:37] <nmatsakis> there'd be multiple traits, presumably.
[21:21:13] <nmatsakis> I guess the annoying part is that you'd want to be able to use an &Fn where an &mut Fn was permitte,d
[21:21:17] <nmatsakis> there's a subtyping relationship,
[21:21:22] <nmatsakis> which could of course be handled with an adapter,
[21:21:37] <nmatsakis> it's kind of a more general problem.
[21:21:45] <nmatsakis> but basically I think we'd use &mut self and call it a day. ;)
[21:22:06] <nmatsakis> the main use for &self would be some specialized contexts like closures that will execute in parallel
[21:31:33] *** Quits: dbaupp (Thunderbir@moz-EB2EFE6F.lns20.syd6.internode.on.net) (Ping timeout)
[21:40:54] *** Quits: w3lcome (Mibbit@moz-49575A06.home.otenet.gr) (Quit: http://www.mibbit.com ajax IRC Client)
[21:43:08] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[21:44:39] <cmr> nmatsakis:  in the my 'a T situation, how does the owner of the memory know not to call the destructor if you move out of it, or *do* call it if you don't?
[21:45:41] <nmatsakis> cmr: the owner would never call the dtor. you are responsible for doing that.
[21:46:03] <cmr> Ok, so you *always* have to move out of the memory?
[21:46:15] <nmatsakis> cmr: in the act of creating the my ptr, the owner gives over responsibility to you to free (or move) the contents of the memory, but the owner must free the memory itself
[21:46:16] <cmr> I'm having a hard time envisioning a scenario where this would be useful and how it would work.
[21:46:19] <nmatsakis> cmr: so basically yes
[21:46:32] <nmatsakis> I think how it would work is relatively easy
[21:46:33] <cmr> ok.
[21:46:41] <nmatsakis> but it is a bit...surprising maybe?
[21:46:41] <cmr> yeah, I see it now
[21:46:51] <nmatsakis> where it's useful I agree is less obvious, there are 2 cases I know of
[21:47:03] <nmatsakis> (1) modeling a once fn (but that's more complex, leave that aside for now)
[21:47:19] <nmatsakis> (2) having a stack allocated vector you can move out of 
[21:47:33] <nmatsakis> say I stack-allocate a vector: let x = [1, 2, 3];
[21:47:38] <nmatsakis> well wait, maybe:
[21:47:44] <nmatsakis> let x = [~1, ~2, ~3];
[21:47:53] <nmatsakis> and I want to pass a pointer to this to some function so they can move the contents into another data structure:
[21:47:56] <nmatsakis> consume(&x);
[21:48:08] <nmatsakis> problem is, that doesn't work -- the callee can't move from the borowed pointer
[21:48:24] <nmatsakis> of course, if we permitted parameterization over integers, or had some fancier type system,
[21:48:37] <nmatsakis> consume might be defined: fn consume<uint N>(x: [T, ..N]) { ... }
[21:48:41] <nmatsakis> and you could call consume(x)
[21:48:52] <nmatsakis> but the obvious way to do that is very bad from a monomorphization perspective
[21:49:01] <nmatsakis> fn consume(x: my [T]) { ... }
[21:49:06] <nmatsakis> consume(my x)
[21:49:09] <nmatsakis> that would work...
[21:49:22] <cmr> m
[21:49:25] <cmr> *mm
[21:49:35] <nmatsakis> in general though I agree not that imp't
[21:49:40] <cmr> yeah
[21:49:42] <nmatsakis> really only needed to pass ownership of dynamically sized things
[21:49:52] <nmatsakis> which makes me wonder if we can finesse our way around it,
[21:49:56] <nmatsakis> but thinking about it last night, 
[21:50:06] <nmatsakis> it didn't come to me.
[21:50:12] <nmatsakis> I didn't think too hard though.
[21:51:14] <cmr> could use uninit() and swap, with unsafe code.
[21:56:42] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[21:56:42] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/uMcG9Q
[21:56:42] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[21:59:32] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[22:01:48] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[22:01:48] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/fzzAxg
[22:01:48] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[22:01:51] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[22:01:51] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/B-5_UA
[22:01:51] <ghrust> 13rust/06auto 14be0580b 15Alex Crichton: Solve some nasty deschedulinging races with a lock...
[22:01:51] <ghrust> 13rust/06auto 14ad6f6cb 15bors: auto merge of #10817 : alexcrichton/rust/sched-fix, r=brson...
[22:01:52] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[22:02:07] *** Quits: dcrewi (david@moz-AB8667CE.gyrae.net) (Ping timeout)
[22:04:09] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[22:04:09] *** ChanServ sets mode: +ao dherman dherman
[22:07:19] *** Quits: geoffhill (geoffhill@moz-738DC0DB.org) (Ping timeout)
[22:08:15] *** Joins: vfetwnuncszu (david@moz-AB8667CE.gyrae.net)
[22:08:30] *** vfetwnuncszu is now known as dcrewi
[22:15:50] *** Quits: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net) (Connection reset by peer)
[22:15:51] *** Joins: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net)
[22:40:28] *** Joins: dbaupp (Thunderbir@4F13D67D.D5A1DCF.37681C44.IP)
[22:49:56] *** Quits: brson (brson@6A848D32.C1B840DD.76F66111.IP) (Connection reset by peer)
[22:50:33] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[22:50:33] *** ChanServ sets mode: +qo brson brson
[22:52:40] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[22:53:59] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[22:54:42] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[22:54:42] *** ChanServ sets mode: +ao dherman dherman
[22:54:57] <strcat> nmatsakis: how do trait objects work with DST?
[22:55:32] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[22:55:32] *** ChanServ sets mode: +qo brson brson
[22:55:35] *** Joins: dherman_ (dherman@moz-BBE3ABD.mv.mozilla.com)
[22:55:53] <strcat> a trait object has to be a fixed size so what does it do with  ~T where T is [U] ?
[22:56:54] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[22:56:54] *** dherman_ is now known as dherman
[22:58:28] <acrichto> brson: looks like in upgrading LLVM they changed their assembly output format, and windows GAS no longer compiles the assembly LLVM generates
[22:58:47] <acrichto> brson: the problem is that our symbol names have '-' and '.' in them (which windows doesn't like), so LLVM quotes them    "foo": <code>
[22:59:13] <acrichto> I was just going to deny '-' and '.' in the sanitization if we're using the windows platform, but that would mean that our symbols have different values across platforms
[22:59:19] <acrichto> we're not trying to keep them the same, are we?
[22:59:30] <brson> acrichto: let's sanitize them the same way imo
[22:59:32] <strcat> why do we ever end up with - and . in the symbols?
[22:59:37] <acrichto> 0.9-pre
[22:59:38] <brson> yeah, that's surprising
[22:59:48] <acrichto> the crate map and others have the version directly embedded
[22:59:48] <strcat> acrichto: can we just not output that? it's included in the hash
[23:00:01] <acrichto> you need to be able to recompute the hash
[23:00:03] <acrichto> from external crates
[23:00:07] <acrichto> or encode the name I guess
[23:00:11] <strcat> why does it have to be in a symbol name?
[23:00:46] <strcat> can't we just require that the hashed data (name, version) is included in the library using it *or* it looks for the newest one?
[23:00:58] <acrichto> this is the symbol name of the crate map
[23:01:02] <strcat> it doesn't seem like the version ever has to in a symbol
[23:01:25] <acrichto> we currently allow linkage against two libfoo libraries
[23:01:30] <strcat> acrichto: the library linking against it should either know a specific hash or try to use the newest one
[23:01:31] <strcat> I know that
[23:01:31] <acrichto> if they have different versions/authors/whatnot
[23:01:37] <strcat> the hash will be different
[23:01:43] <strcat> why would author get hashed? it's not an ABI issue
[23:01:45] <acrichto> yes, but recomputing the hash doesn't work right now
[23:02:10] * strcat shrugs
[23:02:20] <pcwalton> acrichto: do you mind if I make with_local_io be a function that swaps out the given I/O factory and returns it?
[23:02:26] <pcwalton> from the scheduler
[23:02:29] <pcwalton> and then returns it when you're done
[23:02:34] <pcwalton> that's needed to make it sound around &mut anyway
[23:02:47] <nmatsakis> strcat: I wasn't intending to allow ~T where T is [U]
[23:03:10] <acrichto> pcwalton: I like the soundness aspect
[23:03:12] <strcat> nmatsakis: ah so if you say 'unsized', you'd be unable to cast as a trait
[23:03:14] <nmatsakis> strcat: or rather ~Trait where the abstracted type is DST
[23:03:22] <nmatsakis> strcat: yes
[23:03:24] <acrichto> pcwalton: although I don't think that it should return it back, it should be an RAII thing which on destruction re-inserts it
[23:03:28] <pcwalton> right
[23:03:29] <pcwalton> that's what I mean
[23:03:32] <acrichto> pcwalton: r+
[23:03:34] <pcwalton> ok
[23:03:39] <nmatsakis> strcat: too bad but I don't see any other way to handle that
[23:03:42] <pcwalton> this may make it faster, who knows
[23:03:59] <pcwalton> certainly it will let LLVM devirtualize if it can somehow prove that only native I/O is going on (yay!)
[23:04:01] <strcat> nmatsakis: double-indirection?
[23:04:26] <pcwalton> hmmm, that's pretty cool
[23:04:33] <pcwalton> I wonder if there is some way we could get LLVM to statically know only 1:1 I/O is going on
[23:04:37] <pcwalton> and devirtualize everything
[23:04:40] <strcat> (vtable, ptr -> value) for a non-DST
[23:04:54] <strcat> (vtable, ptr -> DST_pointer) for a DST
[23:05:11] <strcat> with the vtable using wrappers to deref
[23:05:19] <sfackler> is there anything to gain from devirtualizing I/O calls? I can't imagine that the indirect jump is going to be noticable against the system call/deschedule
[23:05:26] <pcwalton> sfackler: it won't
[23:05:35] <pcwalton> it'll make bean counters like strcat happier ;)
[23:05:38] * pcwalton apologizes
[23:05:47] * strcat doesn't care about I/O perf in that regard
[23:05:49] <nmatsakis> strcat: I considered it but I think it doesn't work out. i.e., where is that memory allocated and so on?
[23:06:11] <nmatsakis> strcat: also the caller doesn't know whether there is indirection involved -- but maybe it works out, if you make the virtual methods insret the deref
[23:06:47] <strcat> you'll make me sad if mutexes require an indirect call though ;p
[23:06:57] <strcat> as in for a hash table
[23:07:35] <strcat> pcwalton: LLVM will hopefully get better at devirtualizing
[23:07:38] <strcat> I think they hate having to do it in clang
[23:07:43] <pcwalton> that's good
[23:07:46] <strcat> because it doesn't get to take advantage of the other passes
[23:07:47] <pcwalton> for this it should be already doing it
[23:07:53] <pcwalton> yup
[23:07:57] <strcat> I wouldn't be surprised if it failed though
[23:07:59] <pcwalton> front end optimizations are evil!
[23:08:04] <strcat> LLVM really sucks at devirtualization and eliminating bounds checks
[23:08:28] <strcat> it also doesn't know how to hoist cold code out of a block yet ;\
[23:08:51] <strcat> very relevant to bounds checks
[23:08:55] <pcwalton> yeah
[23:09:53] <aatch> There's a form of devirtualisation that works better as a profile-guided optimization. Where you do checks against the function pointer and insert a static call instead.
[23:10:18] <aatch> Falling back to the indirect call at the end.
[23:11:05] *** Quits: jmbto (jmbto@moz-FE174E29.fbx.proxad.net) (Quit: Leaving)
[23:11:29] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[23:11:29] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/B-5_UA
[23:11:29] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[23:16:26] <acrichto> nmatsakis: ping
[23:16:31] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[23:16:31] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/OglwRA
[23:16:31] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[23:16:32] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[23:16:32] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/RwNGpw
[23:16:32] <ghrust> 13rust/06auto 147304326 15Diego Ongaro: Disable priv in std::comm::Port, etc...
[23:16:32] <ghrust> 13rust/06auto 145535313 15bors: auto merge of #10562 : ongardie/rust/master, r=brson...
[23:16:33] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[23:16:45] <nmatsakis> acrichto: pong
[23:16:55] <acrichto> nmatsakis: are you aware of the code in my comment on https://github.com/mozilla/rust/issues/10829 ?
[23:17:15] <acrichto> basically just moving out of a local into a ~once fn() allows repeated moves if used in a loop
[23:17:44] <nmatsakis> acrichto: I hadn't seen it yet; I'm...not that surprised that they're bugs in once fn
[23:17:55] <acrichto> nmatsakis: cool, I'll rename the title and cc you
[23:20:40] <nmatsakis> acrichto: thanks.
[23:31:51] *** Joins: tikue (tkuehn@4026E6C5.E6CB677E.689607DE.IP)
[23:32:24] *** nrc is now known as nrc|lunch
[23:33:23] *** Joins: Jesse (jruderman@moz-5973C6FA.oc.oc.cox.net)
[23:34:53] *** Quits: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP) (Quit: Lost terminal)
[23:41:10] *** Quits: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net) (Ping timeout)
[23:42:22] *** Quits: tikue (tkuehn@4026E6C5.E6CB677E.689607DE.IP) (Quit: tikue)
[23:42:42] *** Joins: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net)
