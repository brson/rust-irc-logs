[00:00:52] *** Quits: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP) (Quit: Lost terminal)
[00:05:16] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[00:06:00] <brson> gr. buildbot isn't launching new instances
[00:15:54] <brson> acrichto: fyi I had to restart buildbot to get it to reconnect to aws
[00:16:06] *** kimundi is now known as zz_kimundi
[00:16:13] <brson> but it's launching c3.2xlarge instances now
[00:18:43] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[00:37:38] <acrichto> looks like we're back in business
[00:37:40] <acrichto> hopefully
[00:41:58] *** Quits: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net) (Ping timeout)
[00:44:39] <mrmonday> acrichto: any chance you could take a quick look over https://github.com/mozilla/rust/pull/11410 again? (even if you don't give it a proper look over) I just wanna check the final API is ok before I write up the docs for it (at which point it *should* be good to go)
[00:45:21] <acrichto> mrmonday: ok, I'll try take a look today or tomorrow, last I looked though it's getting quite large, possibly approaching RFC or "not in the standard library" territory
[00:52:25] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[00:52:25] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14f219746 to 14891eab9: 02http://git.io/N3iJvQ
[00:52:25] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[00:52:26] *** Joins: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP)
[00:52:26] <ghrust> [13rust] 15bors pushed 23 new commits to 06auto: 02http://git.io/dTOy3A
[00:52:26] <ghrust> 13rust/06auto 141f4c630 15Jorge Aparicio: Make method Vec::remove() public
[00:52:26] <ghrust> 13rust/06auto 141607871 15Corey Richardson: rustc: disallow duplicate methods in trait impls...
[00:52:27] <ghrust> 13rust/06auto 14f9e0baa 15Corey Richardson: remove duplicate methods in impls
[00:52:29] *** Parts: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP) ()
[00:55:55] <mrmonday> acrichto: thanks. if there are some bits which would be easier to get in than others I'm happy to break it up into smaller pull requests etc
[00:58:14] *** Quits: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com) (Quit: pcwalton)
[01:02:00] *** Joins: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com)
[01:02:00] *** ChanServ sets mode: +ao pcwalton pcwalton
[01:10:33] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[01:14:04] <acrichto> brson: these windows builders are gonna need some love
[01:14:07] <acrichto> http://buildbot.rust-lang.org/builders/auto-win-32-nopt-t/builds/3945/steps/configure/logs/stdio
[01:14:28] <brson> acrichto: maybe they will work on the second try?
[01:14:59] <acrichto> that was the second try :(
[01:15:08] <acrichto> that builder needs its git directory cleaned out
[01:15:33] <brson> and we have to do that manually?
[01:15:43] <brson> i've never rdp'd into an ec2 instance ...
[01:15:56] <brson> i wonder if the windows ami was snapshotted with a dirty build directory
[01:16:11] <acrichto> it dies in the first build
[01:16:46] <acrichto> died*
[01:17:02] <acrichto> in the middle of updating LLVM
[01:17:06] <acrichto> which I think corrupted the git directory
[01:17:14] <acrichto> this has happened before on other bots I think
[01:17:34] <brson> oh, then let's just terminate the instance and try again
[01:18:10] <brson> terminated
[01:18:17] <brson> yay vms
[01:20:11] <brson> acrichto: i've started a centos 5 vm on ec2 to see if i can get rust building there
[01:20:28] <acrichto> oh excellent
[01:22:25] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[01:22:25] <ghrust> [13rust] 15bors pushed 23 new commits to 06auto: 02http://git.io/JBit2Q
[01:22:25] <ghrust> 13rust/06auto 141f4c630 15Jorge Aparicio: Make method Vec::remove() public
[01:22:25] <ghrust> 13rust/06auto 141607871 15Corey Richardson: rustc: disallow duplicate methods in trait impls...
[01:22:26] <ghrust> 13rust/06auto 14f9e0baa 15Corey Richardson: remove duplicate methods in impls
[01:22:28] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[01:33:15] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Ping timeout)
[01:36:03] *** Joins: enix_ (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[01:36:14] *** Quits: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com) (Quit: pcwalton)
[01:37:54] *** Joins: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com)
[01:37:54] *** ChanServ sets mode: +ao pcwalton pcwalton
[01:38:16] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Input/output error)
[01:38:46] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[01:38:52] *** Quits: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com) (Quit: pcwalton)
[01:40:39] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[01:42:01] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[01:47:36] <vadimcn> acrichto: are you upgrading to latest LLVM master by any chance?
[01:56:24] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[01:56:40] *** Quits: gimpf (gimpf@moz-DB86CEB0.adsl.highway.telekom.at) (Quit: Leaving.)
[02:04:46] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[02:20:00] <brson> acrichto: this centos 5 machine can't build rust. i'm wondering if maybe our snapshot machines are on centos 6
[02:21:39] <brson> indeed, we're using 6
[02:21:45] <brson> time to try again
[02:22:13] <strcat> vadimcn: LLVM master is C++11 so it will be a problem ;p
[02:23:06] <strcat> we should start building libc++ and clang and shipping them with the snapshot
[02:23:26] <strcat> then it will be able to self-host without an up-to-date compiler
[02:24:58] *** Quits: mawuli (mawuli@F7A4F2ED.68EE7C48.E520B65A.IP) (Ping timeout)
[02:31:13] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[02:32:07] <carter> o/
[02:32:34] <carter> is huon gone?
[02:32:57] <strcat> apparently yes ;p
[02:33:03] <strcat> carter: I would say 'huon isn't here yet'
[02:33:07] <strcat> rather than 'huon is gone'
[02:33:09] <carter> heh
[02:33:10] <strcat> based on time zone
[02:33:11] <carter> :)
[02:33:28] <carter> i just spent the past day hacking on ghc build systemthigns
[02:33:42] <carter> PSA: never couple your compilers CPP like thingy to anothers
[02:33:52] <carter> though i guess rust has its own macro system from the outset
[02:33:54] <carter> so that helps :)
[02:33:54] <strcat> although it's morning in UGT atm
[02:34:19] <carter> i'm crosseyed from "patch then try to build"
[02:34:24] <carter> iterations
[02:36:24] *** Quits: enix_ (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Quit: Konversation terminated!)
[02:37:02] *** Joins: enix_ (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[02:37:14] *** Quits: enix_ (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Quit: Konversation terminated!)
[02:37:46] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[02:40:51] <carter> strcat: anyways, the simd vector syntax proposal seems to have no controversial ideas and gives a nice skelton
[02:40:59] <carter> i've been deep / derp in haskell engineering lately
[02:41:00] <carter> :)
[02:41:08] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[02:41:26] <aatch> carter, thanks
[02:41:33] <carter> aatch: oh? you wrot eit?
[02:41:49] <carter> aatch: i'm meh personally about open CL style syntax :)
[02:42:00] <carter> just because it it doesn't help for what i care about :)
[02:42:03] <carter> (afaik)
[02:42:33] <carter> the real stress test is making sure the shuffle api solution can handle the crazy ass stuff in avx512
[02:42:34] <carter> software.intel.com/sites/landingpage/IntrinsicsGuide/
[02:43:05] <aatch> carter, well the shuffle stuff would, as much as possible, defer to LLVM
[02:43:10] <carter> nope
[02:43:17] <carter> :)
[02:43:27] <carter> that doesn't solve the problem :)
[02:43:43] <aatch> goddammit intel.
[02:44:05] <carter> aatch: i think avx512 has special "shuffle registers" even 
[02:44:22] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Ping timeout)
[02:44:37] <carter> :)
[02:44:38] <carter> idk
[02:44:40] <carter> i'm excite
[02:44:40] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[02:44:45] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[02:45:03] <aatch> `__m512 _mm512_mask_addn_round_ps` who needs this?
[02:45:20] <carter> aatch:  people who want moar flops
[02:45:31] <carter> aatch: also the topology of the shuffles gets funky
[02:45:33] <carter> like
[02:45:44] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Ping timeout)
[02:45:46] <carter> you wind up having these notions of lanes
[02:45:54] <carter> this shows up in avx even
[02:46:59] <carter> aatch: the crazy part is the mmask8 and mmask16 variables
[02:47:03] <carter> those are actually special registers
[02:47:25] <aatch> carter, really? That's mad.
[02:47:46] <carter> aatch: and punting to LLVM == you cna't build dynamicly switched shuffles
[02:47:54] <carter> which strictly limits the types of algs you can write!
[02:48:11] <aatch> carter, yeah, which is why I said "as much as possible"
[02:48:26] <carter> ie "will still have to do the rest for the perf crowd :)"
[02:48:35] <carter> llvm isn't magic
[02:48:44] <carter> it just has lots of hammers that work together well
[02:48:48] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[02:48:53] <carter> unrelatedly: the oneNote on mac is magic
[02:48:54] <carter> :)
[02:49:23] <aatch> carter, at any rate, I left my RFC open-ended on much of that, since I know that there's stuff that you can't express in LLVM anyway.
[02:49:29] <carter> yeah
[02:49:34] <carter> aatch: i like this design
[02:49:42] <carter> and i like how it doesn't block that direction
[02:49:44] *** Joins: lpy (lpy@1834E2CB.F09091A8.1348A864.IP)
[02:50:08] *** Joins: cgaebel (clark@moz-F9D89110.nyc.res.rr.com)
[02:50:10] <carter> "SIMD vectors are their own special data type, lets embrace that"
[02:50:43] <carter> aatch: does my remark about "warn if your'e using a nonstandard size for the target" make sense?
[02:50:54] <aatch> carter, yeah, it does.
[02:50:57] <carter> theres all sort of funny issues with the lowering passes
[02:51:04] <carter> for non target supported sizes
[02:51:08] <carter> BUT they're supposed to work
[02:51:13] <carter> just ... you might get shitty code 
[02:51:26] <carter> aatch: thers also the fact that different vector types aren't noops to cast
[02:52:03] <aatch> carter, elaborate?
[02:52:06] <carter> like <Int32 .. 4>  <--->  <Float32 .. 4> aren't a NOOP cast afaik on modern intel
[02:52:13] <carter> it actually takes like 2-3 cycles
[02:52:19] <aatch> carter, I didn't think they would be.
[02:52:27] <carter> k
[02:52:30] <carter> just pointing it out
[02:52:36] <aatch> As far as I know, the non-vector equivalent isn't a No-op
[02:52:53] <carter> you mean Int32 and Float32?
[02:52:58] <aatch> carter, yeah
[02:53:00] <carter> well
[02:53:04] <carter> thats still using thse simd :)
[02:53:19] <carter> on 64 bit the scalar arith on simd bottomost slot :)
[02:53:24] <carter> i can't grammar
[02:53:25] <carter> but you get the idea
[02:53:32] <carter> hello brson  acrichto 
[02:54:35] <carter> aatch: anyways
[02:54:42] <carter> props on the nice core design
[02:54:50] *** Quits: gwty (gwtypc@36B896FC.BD82C0B5.645B845A.IP) (Ping timeout)
[02:54:56] <carter> i'd be ok with the uglier simd!() types
[02:55:06] <carter> and honestly i think thats a better syntax; )
[02:55:47] <brson> hi carter
[02:55:51] <carter> hello!
[02:56:03] <brson> acrichto: i think i've got a working centos 6 vm now building rust
[02:56:19] <brson> acrichto: tomorrow I'll try to configure it to build snapshots
[02:56:49] <brson> i think the ec2 bots are working correctly again now, but I'm not sure
[02:56:57] <brson> hopefully your rollup lands, at least
[02:57:56] <carter> aatch: what are you using simd for?
[02:58:24] <aatch> carter, nothing really. Just interested and the current state of it makes me sad.
[02:58:35] <carter> aatch: i've an itnerest too
[02:58:38] <carter> just been too busy with life
[02:58:56] <aatch> I'm happy to take direction from those that know more than I.
[02:58:56] <carter> what'd you use it for?
[02:59:02] <carter> i know very very little
[02:59:06] <carter> albei tmore than zero
[02:59:25] <carter> as bjz_  will attest, i'm very easy to reach on #numerical-haskell on freenode :)
[02:59:49] <carter> (i log into the mozilla stuff one a day ish :))
[03:00:08] <aatch> carter, nothing specific, I was toying with the idea of implementing an algorithm I saw the other day about parallelizing state machines
[03:00:15] <carter> huh
[03:00:41] <aatch> carter, I'll try to find the paper.
[03:00:47] <carter> https://github.com/flame/blis/blob/master/kernels/x86_64/avx/3/bli_gemm_opt_8x4_ref_u4_nodupl_avx1.c is cooler :) 
[03:01:04] <carter> thats an avx tuned inner loop for matrix mult :)
[03:01:06] <aatch> carter: http://research.microsoft.com/apps/pubs/default.aspx?id=208237
[03:01:28] <carter> neat
[03:01:43] <carter> i need to work out my type system idea for partial evaluability
[03:01:56] <carter> to have a nice model for type checking the shuffles :)
[03:02:13] *** Quits: brson (brson@moz-62518563.mtv2.mozilla.com) (Quit: leaving)
[03:02:56] *** Quits: lpy (lpy@1834E2CB.F09091A8.1348A864.IP) (Client exited)
[03:02:59] *** Joins: erickt (etryzelaar@49C4075F.3AC15C18.2321E71E.IP)
[03:03:36] <carter> aatch: the fun part of simd is the shuffles mind you :)
[03:03:49] <carter> aatch: that said, you can just have them be normal values
[03:04:03] <carter> youlll just get llvm crashing ifyou -O0 ever
[03:04:36] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Quit: Konversation terminated!)
[03:04:51] <aatch> Woo, I think I got the next part of my SIMD support compiling.
[03:05:14] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[03:05:41] <carter> cool
[03:05:41] <carter> g2g
[03:05:43] <carter> i'm tired 
[03:05:45] <aatch> bye
[03:05:47] <carter> even though its only 11pm!
[03:05:55] <carter> happy hacking
[03:23:41] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[03:32:59] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[03:38:09] <nrc> where/how do we check that type substitution is OK - that is satisfies the given bounds?
[03:40:33] *** Joins: lpy (lpy@8B40CDAC.F09091A8.1348A864.IP)
[03:47:18] *** Joins: dotfelix (dotfelix@8D8F45FE.829DBEF3.40E092AA.IP)
[03:52:04] *** Quits: dotfelix (dotfelix@8D8F45FE.829DBEF3.40E092AA.IP) (Quit: )
[03:54:12] <aatch> nrc, check::vtable I think
[03:55:28] <nrc> that seems like a counter-intuitive hiding place :-(
[03:56:44] *** Quits: cgaebel (clark@moz-F9D89110.nyc.res.rr.com) (Ping timeout)
[03:57:03] *** Quits: zz_kimundi (kimundi@moz-CAFCCD90.dip0.t-ipconnect.de) (Ping timeout)
[04:00:49] *** Joins: zz_kimundi (kimundi@moz-4CD428D2.dip0.t-ipconnect.de)
[04:00:51] *** zz_kimundi is now known as kimundi
[04:01:57] *** Quits: erickt (etryzelaar@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[04:03:27] *** Joins: erickt (etryzelaar@49C4075F.3AC15C18.2321E71E.IP)
[04:07:16] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[04:09:36] <vadimcn> strcat: gcc 4.8.1 supports C++11, so why is that a problem?
[04:11:02] *** Joins: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP)
[04:11:03] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/JBit2Q
[04:11:03] *** Parts: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP) ()
[04:11:34] <acrichto> close all the things!
[04:11:56] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[04:13:37] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[04:13:37] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/xpkuOw
[04:13:37] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[04:16:11] <sfackler> hurray!
[04:16:21] <sfackler> but not my thing :(
[04:16:48] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[04:16:48] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/xpkuOw
[04:16:48] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[04:16:51] *** Joins: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP)
[04:16:51] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/jGTfAw
[04:16:51] <ghrust> 13rust/06auto 14749e527 15Brian Anderson: std: Improve docs for atomics. Fix two bugs...
[04:16:51] <ghrust> 13rust/06auto 14a39c294 15bors: auto merge of #12954 : brson/rust/atomicdocs, r=alexcrichton...
[04:16:52] *** Parts: ghrust (ghrust@C82447D.6A2AE50.F3114085.IP) ()
[04:18:27] <cmr> sfackler: but it's *something*!
[04:18:47] <cmr> acrichto: r? https://github.com/mozilla/rust/pull/13001
[04:19:50] <acrichto> cmr: I'd like niko to weigh in on that, it looks fine to me, but codegen changes like that can be tricky
[04:21:51] <acrichto> sfackler: oh your thing had rebase conflicts
[04:21:55] <acrichto> I meant to go and resolve them...
[04:21:56] <acrichto> :(
[04:22:27] <sfackler> acrichto: are you okay with removing RefCell::{with, with_mut, set}? Now that rvalue lifetimes have been fixed and deref is done, there isn't much of a point to keep these around.
[04:22:36] <aatch> acrichto, chances are it'll make no difference, since LLVM almost always manages to infer nocapture during optimisation
[04:22:36] <acrichto> doit
[04:22:40] <sfackler> it reduces its API to new, unwrap, borrow and borrow_mut
[04:22:52] <acrichto> aatch: I want to make sure we don't incorrectly attach it
[04:22:59] <cmr> aatch: I honestly haven't found a case in which it hasn't
[04:23:40] <cmr> but it came up in triage and I figure (if it's correct, which I believe it to be) it can't hurt?
[04:23:50] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[04:24:31] * sfackler wishes there was a check-stage1 target
[04:24:47] * cmr too
[04:24:58] <cmr> usually check-stage1-{std,cfail,cpass} is adequate thouhg
[04:25:12] <cmr> and travis will catch the rest ;p
[04:25:28] <cmr> well, I actually suppose it won't
[04:26:45] <cmr> is there anyone with a mac that could give https://github.com/mozilla/rust/pull/12526 a swing for me? it's dying right at the start of stage1, so it should be quick
[04:26:51] <cmr> (http://buildbot.rust-lang.org/builders/auto-mac-64-nopt-c/builds/3827/steps/compile/logs/stdio)
[04:27:07] <acrichto> cmr: building
[04:27:12] <acrichto> does arch matter?
[04:27:23] <cmr> shouldn't
[04:27:34] <acrichto> what's the target that fails?
[04:27:39] <cmr> 64-nopt
[04:27:47] <acrichto> make target
[04:28:16] <cmr> oh
[04:28:23] <cmr> just 'make' should kill it
[04:29:09] <acrichto> building
[04:29:26] <cmr> <3
[04:30:40] <sfackler> aww, does the snapshot not have Deref?
[04:30:46] <acrichto> no :(
[04:30:58] <acrichto> we should have a linux snap builder by tomorrow
[04:31:04] <acrichto> brson is preparing one on AWS
[04:31:09] <sfackler> cool
[04:31:12] <acrichto> all our physical machines got hosed in the move for some reason
[04:31:21] <acrichto> except for the minis
[04:31:25] <acrichto> and the android builder
[04:31:35] <acrichto> basically the windows builders and the linux snap builder 
[04:35:45] <acrichto> cmr: https://gist.github.com/anonymous/9635478
[04:35:56] <acrichto> what
[04:37:34] <cmr> hm this might be the opendir/readdir hack being necessary.
[04:37:35] <aatch> Yay, I reached an error I expected to get!
[04:38:02] <acrichto> cmr: ah yes, that would make sense
[04:38:46] <cmr> makes me sad :(
[04:38:49] <acrichto> cmr: you can keep the wrapper functions with #[no_split_stack]
[04:38:52] <cmr> wish I knew what that hack was fixing.
[04:40:46] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[04:41:12] <cmr> acrichto: what's the attribute that lets us set the symbol name? would that also work?
[04:41:56] <acrichto> #[link_name]
[04:42:03] <acrichto> and I think that should work...
[04:42:06] <acrichto> it's used elsewhere at least
[04:42:11] <acrichto> #[link_name = "foo"]
[04:42:17] <cmr> mm
[04:54:13] *** Joins: eddyb (eddy@F8B50789.F33C1089.FB866788.IP)
[05:02:29] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:06:45] *** Joins: dotfelix (dotfelix@DD7ADC91.829DBEF3.40E092AA.IP)
[05:09:39] <cmr> acrichto: r? https://github.com/mozilla/rust/pull/12526
[05:09:43] <cmr> acrichto: of interest is the last commit
[05:09:55] <cmr> oops that cfg slipped back in
[05:10:36] <acrichto> https://github.com/cmr/rust/commit/faf86ed9ddccdc9d1caea1e5d712e9f0e9724918#diff-4c1827e2ef5156ad90c1cef13755f4c8R104
[05:10:37] <acrichto> that one?
[05:10:44] <cmr> yeah
[05:10:56] <acrichto> r=me if you tag the dummy test with #10872
[05:11:11] <cmr> ok
[05:11:41] <cmr> acrichto: as a fixme?
[05:11:44] *** Quits: dotfelix (dotfelix@DD7ADC91.829DBEF3.40E092AA.IP) (Quit: )
[05:11:47] <acrichto> yeah
[05:13:09] *** Quits: lpy (lpy@8B40CDAC.F09091A8.1348A864.IP) (Ping timeout)
[05:22:34] <eddyb> always fun when acrichto goes through your open PRs :P
[05:23:51] *** Quits: erickt (etryzelaar@49C4075F.3AC15C18.2321E71E.IP) (Ping timeout)
[05:28:41] <eddyb> cmr: rebased https://github.com/mozilla/rust/pull/12770
[05:29:44] *** Joins: edwardw (edwardw@E761717E.1B2F6624.7F41E82D.IP)
[05:31:49] *** Joins: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP)
[05:31:49] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/jGTfAw
[05:31:50] *** Parts: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP) ()
[05:33:23] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[05:33:24] *** ChanServ sets mode: +ao pcwalton pcwalton
[05:36:44] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[05:36:44] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/F5bcsw
[05:36:44] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[05:36:45] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[05:36:45] <ghrust> [13rust] 15bors pushed 8 new commits to 06auto: 02http://git.io/_vC9Uw
[05:36:45] <ghrust> 13rust/06auto 143cc569c 15Corey Richardson: Remove libc from std...
[05:36:45] <ghrust> 13rust/06auto 146480355 15Corey Richardson: fix fallout from std::libc separation
[05:36:45] <ghrust> 13rust/06auto 145d661da 15Corey Richardson: Add unrecognized_lint
[05:36:47] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[05:46:31] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Ping timeout)
[05:49:59] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[05:50:21] *** Joins: Axord (xord@moz-BC8E2FBC.static.rvsd.ca.charter.com)
[05:51:48] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[05:51:48] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14433ba48 to 14a39c294: 02http://git.io/N3iJvQ
[05:51:48] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[05:51:49] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[05:51:49] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/UlGV8w
[05:51:49] <ghrust> 13rust/06auto 147180b5d 15James Miller: Modules are either public, or private, so private modules should be stripped out
[05:51:49] <ghrust> 13rust/06auto 14a269c37 15bors: auto merge of #12879 : Aatch/rust/rustdoc-mod-privacy, r=alexcrichton...
[05:51:49] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[05:58:23] *** Quits: bytbox (s@moz-E1E7FAC3.washdc.fios.verizon.net) (Ping timeout)
[06:04:58] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[06:06:06] *** Joins: bytbox (s@moz-E1E7FAC3.washdc.fios.verizon.net)
[06:14:31] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[06:15:03] *** Quits: edwardw (edwardw@E761717E.1B2F6624.7F41E82D.IP) (Ping timeout)
[06:16:22] *** Joins: edwardw (edwardw@3570A9BA.4E6A4251.FAED9FFC.IP)
[06:17:43] *** Quits: eddyb (eddy@F8B50789.F33C1089.FB866788.IP) (Ping timeout)
[06:19:35] <acrichto> rusti: {1} + 1
[06:19:35] -rusti- <anon>:16:13: 16:14 error: unexpected token: `+`
[06:19:35] -rusti- <anon>:16         {1} + 1
[06:19:35] -rusti-                       ^
[06:19:36] -rusti- application terminated with error code 101
[06:20:59] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[06:21:23] <ChrisMorgan> rusti: 1 + {1}
[06:21:24] -rusti- 2
[06:24:42] *** Joins: eddyb (eddy@F8B50789.F33C1089.FB866788.IP)
[06:42:26] *** Joins: huon (Thunderbir@2702835C.D5A1DCF.37681C44.IP)
[06:42:26] *** ChanServ sets mode: +o huon
[06:45:36] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[06:48:21] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Quit: TheHydroImpulse)
[06:48:33] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[06:50:37] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Quit: ChatZilla 0.9.90.1 [Firefox 30.0a1/20140317030202])
[07:14:17] *** flaper87|afk is now known as flaper87
[07:20:44] <edwardw> acrichto: I hope my comment in #12828 makes sense :)
[07:25:32] <eddyb> nmatsakis: oh, the Datum method store_to_dest seems like a decent precedent
[07:27:30] <edwardw> how to mark a test as ignored? there are ignore-test, ignore-fast and ignore-pretty...
[07:27:44] <eddyb> ignore-test
[07:27:51] <edwardw> k
[07:38:52] *** Joins: dotfelix (dotfelix@12393A7E.829DBEF3.40E092AA.IP)
[07:51:29] *** Quits: huon (Thunderbir@2702835C.D5A1DCF.37681C44.IP) (Ping timeout)
[07:51:47] *** Joins: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP)
[07:51:47] <ghrust> [13rust] 15bors 04force-pushed 06auto from 14a269c37 to 14a39c294: 02http://git.io/N3iJvQ
[07:51:47] *** Parts: ghrust (ghrust@94BD74B8.6A2AE50.F3114085.IP) ()
[07:51:48] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[07:51:48] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/ufeMrg
[07:51:48] <ghrust> 13rust/06auto 14b3591bd 15Alex Crichton: rustc: Switch defaults from libgreen to libnative...
[07:51:48] <ghrust> 13rust/06auto 14424733f 15bors: auto merge of #12833 : alexcrichton/rust/libnative, r=thestinger...
[07:51:48] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[07:52:07] *** Joins: huon_ (huon_@moz-2D108DF5.pa.nsw.optusnet.com.au)
[08:03:04] *** Joins: glaebhoerl (glaebhoerl@moz-3590251D.kabelnet.hu)
[08:04:39] *** Quits: huon_ (huon_@moz-2D108DF5.pa.nsw.optusnet.com.au) (Ping timeout)
[08:08:48] *** Joins: gimpf (gimpf@moz-E131F8EC.adsl.highway.telekom.at)
[08:09:40] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[08:19:03] *** Quits: edwardw (edwardw@3570A9BA.4E6A4251.FAED9FFC.IP) (Quit: Leaving...)
[08:22:48] <eddyb> nmatsakis: what did I get myself into... I have to datumize monomorphic_fn
[08:23:46] <eddyb> "mono_ty" there we go :)
[08:32:10] *** Quits: dotfelix (dotfelix@12393A7E.829DBEF3.40E092AA.IP) (Quit: )
[08:35:42] <eddyb> cmr: maybe we should set alwaysinline instead of inlinehint for variants
[08:35:59] <eddyb> cmr: especially when we fix things like Some(true) to be an aggregate
[08:41:46] *** Joins: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP)
[08:41:46] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/04ZCiw
[08:41:46] <ghrust> 13rust/06auto 140f2d46f 15Steven Fackler: Docify std::vec_ng...
[08:41:46] <ghrust> 13rust/06auto 14ff03335 15bors: auto merge of #12955 : sfackler/rust/vec_ng-doc, r=alexcrichton...
[08:41:46] *** Parts: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP) ()
[08:46:51] *** Joins: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net)
[08:46:51] *** ChanServ sets mode: +o huon
[08:51:11] *** Joins: Zr40 (zr40@EE4BB9F5.926C319A.BE2F4011.IP)
[08:53:42] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[08:54:04] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Input/output error)
[08:54:46] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[09:01:32] <klutzy> does backtrack print function names on win32?
[09:05:06] <eddyb> http://buildbot.rust-lang.org/builders/snap3-linux :(
[09:08:33] *** Quits: fhahn (fhahn@moz-7924DB5C.vie.surfer.at) (Ping timeout)
[09:15:27] <eddyb> nmatsakis: oh wow I'm killing mono_param_id
[09:16:46] *** Joins: fhahn (fhahn@moz-7924DB5C.vie.surfer.at)
[09:40:25] <huon> klutzy: theoretically?
[09:42:04] <huon> jensnockert: https://github.com/rust-lang/rfcs/pull/15/files#r10741543 by "on the other hand, should warn" do you mean "anything else should warn"?
[09:42:16] <huon> eddyb: on purpose?
[09:42:27] <eddyb> huon: yupp
[09:42:29] <jensnockert> huon: Yes, that's what I actually mean.
[09:42:45] <eddyb> huon: turns out we still had kinda partial support for mono_any and mono_repr
[09:42:58] <eddyb> who knows what *those* are
[09:43:05] <jensnockert> huon: There was a bit of code that got nommed by markdown before that expression. :S
[09:43:05] <eddyb> were, I should say
[09:43:44] <klutzy> huon: practically, I got "1:   0x632dc5" :p
[09:44:01] <huon> jensnockert: oh
[09:44:19] <jensnockert> huon: I fixed it, I think
[09:44:25] <huon> klutzy: hm :( file a bug?
[09:44:37] <nmatsakis> eddyb: quite the odyssey
[09:44:41] <huon> klutzy: (does it change with debug symbols?)
[09:44:46] <eddyb> nmatsakis: this is nothing :P
[09:44:56] <klutzy> huon: same with -g, but I need more investigation
[09:44:59] <huon> jensnockert: that makes more sense :)
[09:45:43] <jensnockert> Sometimes I like Markdown, sometimes it makes everything I write totally garbled.
[09:48:24] <eddyb> nmatsakis: at this point, I kinda wish I could do BlockAnd<'a, Datum<PodRvalue>, Datum<PodRvalue>>
[09:48:50] *** Joins: lpy (lpy@F3793011.25165A39.3F03179E.IP)
[09:49:30] <nmatsakis> eddyb: what does thta mean and why can't you do it
[09:50:33] <eddyb> packing a &'a Block<'a> with an arbitrary number of types
[09:50:59] <eddyb> (VG)
[09:52:57] <eddyb> hmpf, we should probably do something about let did = if did.krate != ast::LOCAL_CRATE { inline::maybe_instantiate_inline(ccx, did) } else { did };
[09:53:15] <eddyb> maybe move the check inside the function, it's a bit annoying
[10:02:18] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Ping timeout)
[10:03:47] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[10:06:05] <flaper87> huon: r=niko https://github.com/mozilla/rust/pull/12686 ? pls :D (he r+'d it yday but there were some merge conflicts)
[10:06:19] <flaper87> nmatsakis: ah niko is here already
[10:06:20] <flaper87> :D
[10:10:30] <huon> flaper87: out of interest, why does Unsafe need to be a lang item?
[10:10:44] <huon> also, std::ty?
[10:10:49] <eddyb> o_O
[10:11:34] <eddyb> huon: if it's a lang item, it can be checked specifically (allow certain operations only through it) and optimizations can be aware of shallow mutability
[10:11:53] <nmatsakis> flaper87: I'm here
[10:12:02] <huon> flaper87: aha, https://github.com/FlaPer87/rust/commit/c1d8243ee90e459322efbc2dbef0014084cd764a#diff-807bbbef86b78462b44b1f4399d9239dR1300
[10:12:08] <huon> eddyb: I know what lang items do :)
[10:12:21] <huon> I was wondering exactly what the change was, and it's that ^
[10:12:27] <eddyb> ohh
[10:12:31] <nmatsakis> huon: it definitely needs to be a lang item, since it's specially integrated into the type rules. This was a kind of compromise -- another option would have been to mark fields using the unsafe keyword
[10:13:04] <nmatsakis> flaper87: r+ (I didn't read it carefully, I trust you just rebased?)
[10:13:16] <eddyb> woo, so trans can use interior_unsafe directly :D
[10:13:25] * eddyb approves
[10:13:34] <nmatsakis> eddyb: yes that was the idea. We can use interior_unsafe for optimization and so forth
[10:13:38] <huon> nmatsakis: yep, I was just wondering exactly what the special integration was (and I found it)
[10:13:53] <nmatsakis> eddyb: and it's officially disallowed to have interior mutability (that is, an &T where T is mutable) without using Unsafe<T>
[10:13:53] <huon> anyway, why `std::ty`?
[10:14:01] <nmatsakis> well, that's another question, probably we should rename that module
[10:14:10] <nmatsakis> I think nobody had a better suggestion yet
[10:14:12] <nmatsakis> raw?
[10:14:14] *** Joins: jensnock_ (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[10:14:24] <nmatsakis> I think that was our standard "unsafe internals" model name
[10:14:31] <nmatsakis> *module name
[10:14:37] <huon> ah, ok; it's just not been decided...
[10:14:53] * huon gets to bikeshed! \o/
[10:14:57] <nmatsakis> go wild
[10:14:57] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[10:15:00] <huon> but yeah, raw seems to be standard
[10:15:14] <eddyb> keywords as identifiers, pls
[10:15:16] <eddyb> std::unsafe
[10:17:19] <nmatsakis> ha
[10:17:22] <nmatsakis> we used to permit that
[10:17:44] <nmatsakis> it's funny because what to call `unsafe` modules was the one think we argued about forever
[10:17:47] <nmatsakis> and it seems we're still arguing about it
[10:17:58] *** Joins: gwty (gwtypc@643F8048.BC0A3F1F.F64220F6.IP)
[10:18:04] <huon> heh
[10:18:06] <nmatsakis> that is, it was the one thing we argued about, when going to a stricter keyword system
[10:18:30] <nmatsakis> (though the parser is stlil not fully transitioned; that is, keywords aren't special tokens)
[10:18:39] <nmatsakis> (leading to fun bugs like misparsing fn(proc:Send))
[10:18:45] <nmatsakis> though speaking of bikesheds:
[10:18:56] <nmatsakis> I think I'm persuaded we need to drop that syntax, but I don't know what to change it to
[10:19:12] <nmatsakis> that is, Trait:bounds and so on. I guess Trait+bounds is the most obvious thing.
[10:19:35] <nmatsakis> my eye wants a parenthesis ~(MyTrait+Send)
[10:19:49] <eddyb> definitely
[10:19:53] <eddyb> rusti: ~0+1
[10:19:54] -rusti- pastebinned 11 lines of output: http://sprunge.us/PJXV
[10:19:59] <eddyb> rusti: ~(0+1)
[10:19:59] <nmatsakis> ~||+Send
[10:20:00] -rusti- 1
[10:20:16] <nmatsakis> well you wouldn't write the ~ I guess
[10:20:24] <nmatsakis> |int|+Send->int
[10:20:37] <nmatsakis> I guess we could write |int|:Send->int still
[10:20:48] <nmatsakis> but it seems better if we can be consistent
[10:20:52] <nmatsakis> ~MyTrait[Send]
[10:20:57] <eddyb> oh dear
[10:20:57] <nmatsakis> |int|->int [Send]
[10:21:00] <flaper87> huon: ops, sorry, I got distracted. I see you figured it out yourself
[10:21:01] <nmatsakis> oh no that won't work
[10:21:06] <nmatsakis> |int| [Send] -> int
[10:21:12] <eddyb> nmatsakis: ::<> obviously
[10:21:31] * nmatsakis shrugs
[10:21:35] <flaper87> nmatsakis: yeah, just rebased. Conflicts where in the docs
[10:21:41] * nmatsakis up to his ears in rfcs as it is
[10:21:51] <huon> `+` feels commutative, i.e. it feels like `Trait+Send` and `Send+Trait` should work as trait objects; and, it's unintuitive that `Trait1+Trait2` doesn't work (assuming it doesn't work)
[10:22:01] <nmatsakis> it doesn't work today...
[10:22:12] <huon> and, any plan for it?
[10:22:13] <nmatsakis> no fundamental reason we can't make it work though
[10:22:25] <nmatsakis> I wasn't really planning it, but people do ask for it
[10:22:28] <eddyb> nmatsakis: you're lucky I'm not burring you with even more RFCs
[10:22:39] <huon> I know gabor has written some stuff about it
[10:23:10] <nmatsakis> huon: I agree that if we went to a `+` notation, I would want it to work with an arbitrary number of traits and not be limited to builtin traits
[10:23:47] <nmatsakis> it so closely mirrors the T:Bound1+Bound2 syntax,
[10:23:51] <nmatsakis> that it ought to work the same as those
[10:23:57] <eddyb> keep in mind that ty_trait is the largest variant
[10:24:05] <Yurume> will `+` "type-operator" be made the highest priority if it ever lands?
[10:24:10] <nmatsakis> eddyb: indirection solves all ills
[10:24:11] <eddyb> (I was supposed to do something about that)
[10:24:14] <Yurume> (tightest, I meant)
[10:24:17] <eddyb> nmatsakis: ~:P
[10:24:32] <huon> eddyb: why is ty_trait being huge relevant?
[10:24:38] <nmatsakis> Yurume: who knows
[10:24:46] <eddyb> I was thinking how we could represent a sum of traits
[10:24:52] <huon> a vector?
[10:25:01] <eddyb> yeah, no, it's not an issue
[10:25:20] <eddyb> but the thought of inflating the currently largest variant. heh
[10:25:38] <eddyb> oh, and, you may lose the space efficiency for built-in bounds
[10:25:45] <nmatsakis> I... really don't get it. I was actually serious about indirection solves all ills.
[10:25:48] <eddyb> (I mean kinds by that)
[10:25:52] <eddyb> nmatsakis: I was serious too
[10:26:01] <nmatsakis> So why not make it ty_trait(~TyTrait)
[10:26:05] <nmatsakis> then what is the problem
[10:26:08] <eddyb> that's what I'll make it
[10:26:13] <eddyb> whenever I get back to it
[10:26:14] <nmatsakis> ok
[10:26:26] <eddyb> it didn't help that OptVec was 5-6 words instead of 2...
[10:27:49] <huon> it still is
[10:27:58] <huon> (5 words)
[10:28:03] <huon> wait
[10:28:04] <huon> 4 words
[10:28:29] <eddyb> so nobody wants to write a DST ~[T] equivalent in the library?
[10:29:17] <eddyb> huon: want bikeshed? come up with a concise name for "owned/unique slice"
[10:30:43] <huon> eddyb: "owned slice"
[10:30:58] <eddyb> type name. like OptVec
[10:30:59] <huon> eddyb: I was going to write one when I revived my OptVec patch
[10:31:36] <kimundi> OwnedSlice :?
[10:31:44] <bjz_> UniSlice
[10:31:54] <kimundi> Unslice
[10:31:55] <bjz_> OneSlice
[10:32:13] <eddyb> ToRuleThemAll
[10:32:32] <bjz_> ASlice
[10:32:34] <eddyb> huon: oh, I think I actually liked Array
[10:32:56] <eddyb> because who needs proper terminology when you can have a nice type name :P
[10:33:22] <kimundi> [T, ..N] => array, [T] => slice, Vec<T> => vector seems like a nice distinction though
[10:34:55] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[10:35:30] <eddyb> then just Slice<T>
[10:36:12] <kimundi> Slice<T> == [T] ?
[10:36:20] <eddyb> make conversion functions to/from Vec and use it instead of OptVec (and actually Vec, in the AST)
[10:36:33] <eddyb> kimundi: DST ~[T], temporary solution
[10:36:42] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[10:36:43] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/04ZCiw
[10:36:43] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[10:36:48] <eddyb> we just need to lower the ridiculous memory usage
[10:37:11] <eddyb> (I can help with that if you give me a snapshot. I hope brson fixes the bots today)
[10:37:49] <kimundi> eddyb: Ah. If its transitional, I'd call it something like OwnedSlice<T> to not cause more confusion than necessary. :P
[10:38:10] <eddyb> but that's long!
[10:38:33] <eddyb> I guess UniqSlice is not huge. I give up, just use that and make it happen
[10:40:07] *** Quits: gwty (gwtypc@643F8048.BC0A3F1F.F64220F6.IP) (Ping timeout)
[10:40:50] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[10:41:37] <eddyb> also, I bet cmr is sleeping by now. I have to wait for a graph, too
[10:41:43] *** Joins: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP)
[10:41:43] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/SMkzhg
[10:41:43] *** Parts: ghrust (ghrust@4089EBDC.6A2AE50.F3114085.IP) ()
[10:41:45] *** Joins: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP)
[10:41:45] <ghrust> [13rust] 15bors pushed 13 new commits to 06auto: 02http://git.io/fpCmGQ
[10:41:45] <ghrust> 13rust/06auto 1400cb1e5 15Flavio Percoco: Add a Share kind...
[10:41:45] <ghrust> 13rust/06auto 14b8db69d 15Flavio Percoco: Make `Rc`, `Cell` and `RefCell` NoShare
[10:41:45] <ghrust> 13rust/06auto 144993759 15Flavio Percoco: Replace Freeze bounds with Share bounds
[10:41:47] *** Parts: ghrust (ghrust@49477F7E.6A2AE50.F3114085.IP) ()
[10:44:27] * flaper87 crosses fingers
[10:45:16] *** Quits: jensnock_ (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Input/output error)
[10:45:49] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[10:45:59] <eddyb> nmatsakis: I wonder how good of an idea a Datum<PodValue> with mode=ByRef is... you need it to send large arguments to functions... but should that be a thing? it's a bit too complicated for my taste
[10:46:27] <eddyb> nmatsakis: I think only reflect uses ByRef (for &str arguments)
[10:47:04] <nmatsakis> eddyb: should what be a thing, precisely? sending large arguments to functions?
[10:47:13] <nmatsakis> eddyb: or are you saying you could just use normal ByRef instead
[10:47:24] <nmatsakis> that is, normal rvalue by ref
[10:47:34] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[10:48:48] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[10:48:53] <eddyb> nmatsakis: leaving LLVM to decide what to do, that would be nice
[10:48:58] <eddyb> s/leaving/letting
[10:49:37] <eddyb> nmatsakis: in that specific case, it won't be easy to use ByRef, but if it's at the start or at the end of the argument list, there's something I can do
[10:50:30] <eddyb> I also would like to just write Datum<PodValue | Lvalue> and have it work
[10:50:37] * eddyb dreams a lot
[10:51:08] <nmatsakis> eddyb: for Rust fns, we can potentially leave it to LLVM to handle. 
[10:51:15] <nmatsakis> not for extern "C"
[10:51:29] <eddyb> foreign already does dark magic with ValueRef
[10:51:29] <nmatsakis> but that reconciliation happens elsewhere
[10:51:41] <eddyb> it always creates a temporary alloca
[10:51:45] <nmatsakis> yes I know
[10:52:05] <eddyb> so it's not like it could break :P
[10:52:10] <nmatsakis> so, my thought is that,
[10:52:18] <nmatsakis> passing it by explicit reference gives us more license to make this efficient someday
[10:52:28] <nmatsakis> e.g., if you do foo(a.b.c)
[10:52:39] <nmatsakis> where a.b.c is an immutable path that outlives foo
[10:52:45] <nmatsakis> you could pass a pointer directly in there
[10:53:01] <nmatsakis> but if we always load out, that doesn't work
[10:53:13] <nmatsakis> there is also this matter of LLVM's fastisel, which afaik we are currently incompatible with,
[10:53:14] <eddyb> ah, yeah, huon has a nice gist demonstrating that LLVM can't really optimize out all of our copies
[10:53:18] <nmatsakis> but which would lower build times dramatically
[10:53:21] <nmatsakis> (apparently)
[10:53:29] <nmatsakis> and which is incompatible with large structs being passed by vlaue
[10:53:35] <nmatsakis> I know that's been talked about in the past
[10:53:39] <eddyb> strcat says that's fixable in LLVM
[10:53:46] <nmatsakis> (as an option for improving debug build times)
[10:53:54] <nmatsakis> sure, maybe
[10:54:15] <eddyb> given that I can probably make reflect not need ByRef, I'll change PodRvalue to only PodValue
[10:54:19] <nmatsakis> so in the end I care most about trans being readable and obviously correct
[10:54:30] <eddyb> safer to pass around
[10:54:31] <nmatsakis> and secondarily about perf of the fully optimized end product
[10:54:49] <nmatsakis> build times and/or how clean the output is BEFORE optimization ranks third to me
[10:55:31] <nmatsakis> a change like this seems like it'd make trans more readable, so that's good, at the cost of some potential future perf, that's bad, but then we can always optimize later too
[10:55:32] <huon> (I have a compiler that type-checks with ty_trait(~TyTrait), fwiw.)
[10:55:52] <eddyb> huon: I don't think I've actually went through with that. how much does it help?
[10:56:17] <huon> eddyb: don't know, I just hit the linting/LLVM codegen for stage0 then
[10:56:31] <eddyb> I should just open a PR for the code behind https://gist.github.com/eddyb/20fb641bc5e3794049da
[10:56:34] <eddyb> maybe with even more stats
[10:56:36] <nmatsakis> (actually I guess I care about readabiliy of trans and perf of optimized end product about the same)
[10:57:00] *** Joins: gwty (gwtypc@59409F2E.3E0F208F.137C914F.IP)
[10:57:00] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Connection reset by peer)
[10:57:07] <eddyb> nmatsakis: I care about all three, and pick the one that bugs me the most at any given time
[10:57:23] <eddyb> ty_trait and ty_closure are pretty low, so don't be afraid to indirect them
[10:57:40] <eddyb> huon: ty_closure being the second largest variant, after ty_trait, IIRC
[10:57:53] * eddyb gets back to making lunch
[10:59:07] <huon> eddyb: substs is pretty huge too
[10:59:22] <eddyb> yupp. it has two OptVec IIRC
[10:59:43] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[11:01:17] <huon> eddyb: seems to take it from 160 to 116 bytes
[11:01:39] <eddyb> huon: that's like 100MB freed
[11:02:02] <eddyb> well, almost. you can actually compute it from here https://gist.github.com/eddyb/20fb641bc5e3794049da
[11:02:24] <eddyb> rusti: 1209187*44/1024/1024
[11:02:24] -rusti- 50
[11:03:27] *** Joins: cgaebel (clark@moz-F9D89110.nyc.res.rr.com)
[11:03:46] <pnkfelix> nmatsakis: ping
[11:10:01] <huon> eddyb: substs is 10 words
[11:10:05] <huon> (80 bytes)
[11:13:39] <nmatsakis> pnkfelix: pong
[11:14:00] <pnkfelix> nmatsakis: so I figured out what was going on with that `break 'exit` thing I was showing you yesterday
[11:14:38] <pnkfelix> nmatsakis: break was introducing an exit edge between its input pred and the target label
[11:14:56] <pnkfelix> nmatsakis: (rather than between the node generated for break and the target label)
[11:15:19] <pnkfelix> nmatsakis: and in addition, calls to `fn expr()` assume that the CFGIndex returned always falls through
[11:15:46] <pnkfelix> nmatsakis: I've implemented a fix for this
[11:16:00] *** Joins: eibwen (kvirc@moz-6D1D100D.dip0.t-ipconnect.de)
[11:16:29] <pnkfelix> nmatsakis: Where the various expr()/stmt()/... methods all return an enum of { Normal(CFGIndex), Jumped(CFGIndex) }
[11:16:50] <pnkfelix> nmatsakis: it holds together in my head, but I wanted to double-check if you had any immediate counter-arguments before I try to put together a patch for this
[11:17:22] *** flaper87 is now known as flaper87|afk
[11:18:09] <nmatsakis> pnkfelix: I don't quite follow, one sec, but my immediate reaction is... suspicious
[11:18:38] <nmatsakis> pnkfelix: that is, I intentionally designed it that they assume it falls through, if I understand what you mean
[11:18:49] <pnkfelix> nmatsakis: So what should expr(ExprBreak) do then?
[11:19:09] <pnkfelix> nmatsakis: is the idea that it really should jsut be an extra unparented node floating out in space?
[11:19:44] <pnkfelix> nmatsakis: and it is the edge between the pred of the ExprBreak and the target-label that carries the information that this was due to this particular ExprBreak?
[11:20:26] <pnkfelix> nmatsakis: I'm not saying that the latter model is incoherent.  I had thought it was, but this morning I started to convinved myself that it might be sane
[11:20:32] <nmatsakis> pnkfelix: I expect ExprBreak to generate an edge to the exit and return a fresh (disconnected) block
[11:20:51] <pnkfelix> nmatsakis: Okay.  So maybe the problem here is how I am labelling the fresh disconnected block
[11:20:58] <nmatsakis> pnkfelix: so that anything which comes afterwards is clearly dead (not reachable from the entry point)
[11:22:49] <pnkfelix> nmatsakis: but should the exit_map map the ExprBreak's ast::NodeId to that unreachable disconnect block?
[11:23:12] <pnkfelix> nmatsakis: i guess that depends on what the exit_map is actually meant to represent
[11:24:43] <pnkfelix> nmatsakis: Let me take another go at this.  I'll try to preserve the property you want, but still make the output look sane, by having the ExprBreak's ast::NodeId map to a different node from the unreachable disconnected block returned by .expr(ExprBreak, pred)
[11:25:58] <huon> r? https://github.com/mozilla/rust/pull/13013
[11:26:00] <huon> eddyb: ^
[11:26:02] <nmatsakis> pnkfelix: it's not necessarily crazy to have expr() return an Option<>
[11:26:12] <pnkfelix> nmatsakis: I considered that too
[11:26:19] <nmatsakis> pnkfelix: (or the enum you wrote)
[11:26:22] <nmatsakis> pnkfelix: it'd avoid generating spurious nodes
[11:26:29] <nmatsakis> pnkfelix: but I think it's more an optimization than anything else
[11:26:39] <eddyb> huon: now if only it would still be 2013...
[11:26:41] <nmatsakis> pnkfelix: the bigger question is yes what does exit map represent exactly --
[11:26:43] *** Joins: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP)
[11:26:43] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/4vI62g
[11:26:43] <ghrust> 13rust/06auto 140761a6c 15Kevin Cantu: [std::cmp] add missing docs and provide an example
[11:26:43] <ghrust> 13rust/06auto 1488f5281 15bors: auto merge of #12956 : killerswan/rust/docs, r=alexcrichton
[11:26:43] *** Parts: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP) ()
[11:26:56] <nmatsakis> pnkfelix: (and why do we care about exit map anyway? it's clear why we care about something like an entry map)
[11:27:10] <nmatsakis> pnkfelix: that is, when doing analyses, we need to be able to say "what are the set of bits present on entry to the AST node"
[11:27:25] <nmatsakis> pnkfelix: I'm not sure why we need exit map anymore, is it possible we don't? 
[11:27:28] <pnkfelix> nmatsakis: well, the exit_map is all you get from the current CFG builder
[11:27:40] <pnkfelix> nmatsakis: it doesn't hand you an entry map.  We could revise it to do so
[11:27:51] <pnkfelix> nmatsakis: (I shouldn't say *all* you get.)
[11:27:53] <nmatsakis> pnkfelix: right, I know, that's definitely insufficient
[11:28:02] <nmatsakis> pnkfelix: let me try and remember why I made the exit map in the 1st place
[11:28:06] <nmatsakis> pnkfelix: I may have just been confused
[11:28:09] <huon> eddyb: ?
[11:28:16] <eddyb> huon: 13 0 13
[11:28:19] <pnkfelix> nmatsakis: Okay.  I'm going to try to do the revision I described above anyway
[11:28:21] <eddyb> rusti: 1209187*64/1024/1024
[11:28:21] -rusti- 73
[11:28:23] <huon> eddyb: hah
[11:28:27] <pnkfelix> nmatsakis: Since it will, if nothing else, make the diff much smaller
[11:29:29] <pnkfelix> nmatsakis: and avoid introducing new enums.  The flow distinction I was representing in the enum can indeed obviously be encoded as nodes, I guess I didn't think to do that because of the exit_map handling.
[11:30:00] <eddyb> gotta love stats https://github.com/mozilla/rust/pull/13013#issuecomment-38040624
[11:30:12] <pnkfelix> nmatsakis: but its easy to pass DUMMY_ID for the disconnected node, I just didn't think to do so when I started on this path last night.
[11:30:12] <nmatsakis> pnkfelix: I think exit map was supposed to be the "normal exit" (which would be the disconnected node, I guess?) but as I said i can't remember just now why we need it 
[11:30:28] *** Joins: dmsky (dmsky@moz-63A2E3E4.pppoe.spdop.ru)
[11:30:36] <pnkfelix> nmatsakis: okay.
[11:31:10] <pnkfelix> nmatsakis: I would think that exit maps are not a crazy thing to have.  Depending on what they represent.  :)
[11:31:38] <nmatsakis> pnkfelix: no, not crazy, just maybe not needed for borrowck et al.
[11:31:40] <pnkfelix> nmatsakis: (probably depends on whether one is doing forward- or backward-analysis)
[11:31:48] <nmatsakis> right
[11:32:59] <eddyb> I think I understand now. we can easily generate dataflow from CFG, right?
[11:33:08] <eddyb> and borrowck uses dataflow
[11:34:24] <pnkfelix> eddyb: yeah, that's my take on it.
[11:35:22] <eddyb> pnkfelix: can you fold a CFG (yet)?
[11:35:51] <pnkfelix> eddyb: folds on graphs is ... harder to specify than folds on trees
[11:36:57] <pnkfelix> eddyb: e.g. skim this http://www.cs.nott.ac.uk/~bmv/Away_Day/fplad12-talk_henrik.pdf
[11:37:10] <pnkfelix> (or I'm sure I can find something better...)
[11:38:08] <pnkfelix> eddyb: here's the paper I think that slide show is referencing https://www.cs.utexas.edu/~wcook/Drafts/2012/graphs.pdf
[11:38:36] <eddyb> yay Haskell
[11:38:54] <eddyb> (or pseudocode that looks like haskell)
[11:39:35] <eddyb> oh, I see, specific handling for cycles
[11:40:07] <eddyb> I wanted something like that in my decompiler
[11:40:27] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[11:41:17] <eddyb> rusti: let x = ~"a"; while x.len() < 10 {x = x.as_slice() + x;} x
[11:41:18] -rusti- pastebinned 8 lines of output: http://sprunge.us/RIXO
[11:41:26] <eddyb> rusti: let mut x = ~"a"; while x.len() < 10 {x = x.as_slice() + x;} x
[11:41:28] -rusti- aaaaaaaaaaaaaaaa
[11:41:33] <eddyb> okay, so this works. hmpf
[11:41:41] <eddyb> rusti: let mut x = ~"a"; while x.len() < 10 {x = x.as_slice().add(&x);} x
[11:41:42] -rusti- <anon>:16:68: 16:70 error: mismatched types: expected `&&str` but found `&~str` (str storage differs: expected `&` but found `~`)
[11:41:42] -rusti- <anon>:16         let mut x = ~"a"; while x.len() < 10 {x = x.as_slice().add(&x);} x
[11:41:42] -rusti-                                                                              ^~
[11:41:43] -rusti- error: aborting due to previous error
[11:41:44] -rusti- application terminated with error code 101
[11:42:37] <pnkfelix> eddyb: there is also this http://web.engr.oregonstate.edu/~erwig/fpg/ but I have not read any of this stuff so I cannot tell how applicable it is.
[11:42:45] *** Joins: easy_muffin (martin@moz-BCFA3DA1.public.telering.at)
[11:43:34] <eddyb> great, I can't trigger one of those x = f(x); borrowck issues. so I can't point at something that cyclic analysis might fix
[11:50:05] *** Quits: Zr40 (zr40@EE4BB9F5.926C319A.BE2F4011.IP) (Quit: leaving)
[11:58:07] <huon> eddyb: maybe taking an &mut reference from inside another &mut
[12:00:08] <huon> rusti: struct Foo { x: Option<~Foo> } fn go(mut foo: &mut Foo) { loop { match foo.x { None => break, Some(ref mut y) => foo = &mut **y } } }
[12:00:08] -rusti- pastebinned 17 lines of output: http://sprunge.us/TGcg
[12:00:16] <huon> eddyb: like that^ ?
[12:00:49] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[12:01:37] <eddyb> that's more like the scope issue
[12:02:17] <eddyb> struct Cons<T>{v: T, n: Option<~Cons<T>>} let mut x = Cons{v: 0, n: None}; let mut y = &mut x; loop {y = y.n.as_mut().map(|x| &mut **x).unwrap(); if true {break;}}
[12:02:24] <eddyb> and http://sprunge.us/eXQe
[12:02:58] <eddyb> rusti: struct Cons<T>{v: T, n: Option<~Cons<T>>} let mut x = Cons{v: 0, n: None}; let mut y = &mut x; y = y.n.as_mut().map(|x| &mut **x).unwrap();
[12:02:59] -rusti- pastebinned 8 lines of output: http://sprunge.us/BLaT
[12:03:17] <eddyb> okay, so you don't need a loop. I guess this is the RHS order issue
[12:04:07] <eddyb> *LHS (x = ...; or x.foo(...))
[12:04:18] <eddyb> and it's good that we're being conservative here, otherwise (*ahem*, DPS) we could be overwriting the lvalue that we use in the RHS
[12:05:22] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Connection reset by peer)
[12:05:42] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[12:07:25] <eddyb> nmatsakis: but considering the adjustments we insert.... that might not be an issue
[12:08:03] *** flaper87|afk is now known as flaper87
[12:08:23] <eddyb> nmatsakis: could we put the (re)borrow adjustments on the receiver *after* the evaluation of all the arguments, in a CFG?
[12:09:05] <eddyb> (for the x.foo(x.bar()) case)
[12:09:29] <huon> eddyb: isn't anything else incorrect?
[12:11:49] *** Quits: luz (lu.cy@moz-CD18B14B.customer.cdi.no) (Connection reset by peer)
[12:13:06] *** Joins: luz (lu.cy@moz-CD18B14B.customer.cdi.no)
[12:16:33] <huon> pnkfelix: are you keeping up with the LLVM's GC progress? (e.g. http://www.philipreames.com/Blog/2014/03/18/late-safepoint-placement-overview/ was just posted to /r/rust)
[12:16:48] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[12:16:48] <ghrust> [13rust] 15bors 04force-pushed 06auto from 1488f5281 to 14ff03335: 02http://git.io/N3iJvQ
[12:16:48] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[12:16:52] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[12:16:52] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/1xdzLA
[12:16:52] <ghrust> 13rust/06auto 1490cf17d 15Jonathan S: Add fetch_and, fetch_or, fetch_nand, fetch_xor to AtomicInt, AtomicUint
[12:16:52] <ghrust> 13rust/06auto 1474b790f 15bors: auto merge of #12964 : gereeter/rust/extended-atomics, r=alexcrichton...
[12:16:52] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[12:17:20] <pnkfelix> huon: no I haven't been following it.  I guess I will try to do so.
[12:19:13] <huon> pnkfelix: oh, ok. (It seems it's still mostly talk/planning, so not something we can even experiment with yet.)
[12:29:15] <eddyb> huon: we currently apply adjustments immediately
[12:29:58] <eddyb> making v.set(v.len() - 1, x) an error
[12:33:36] <eddyb> is the failed test on #12956 transparent for anyone else? http://buildbot.rust-lang.org/console?branch=auto&refresh=15
[12:34:00] <eddyb> (a rounded corner box, with nothing in it - I expected it to be red)
[12:38:31] <kimundi> eddyb: I see a lot of rounded corners with nothing in it :P
[12:38:48] <eddyb> kimundi: I don't mean white
[12:39:10] <eddyb> but the surrounding background color
[12:39:45] <kimundi> Do you mean the sixt box in the second line?
[12:40:01] <kimundi> Thats indeed background colored for me
[12:41:24] <kimundi> Huh, interesting
[12:42:08] <kimundi> If you create a markdown gist witch checkboxes, you can click them to automatically create a new revision with that box checked/uncecked
[12:43:34] *** Quits: gwty (gwtypc@59409F2E.3E0F208F.137C914F.IP) (Connection reset by peer)
[12:43:35] <pnkfelix> eddyb: do you know if there is a pastebin for svg files, that presents them rednered?  gist.github.com does not
[12:44:03] <eddyb> oh that is sad
[12:44:14] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Connection reset by peer)
[12:44:14] <eddyb> pnkfelix: I think I've only used my own server
[12:44:21] <pnkfelix> (oh I guess part of the problem is that firefox wont' render them in place when I follow the open raw link...  :(  )
[12:45:23] <eddyb> pnkfelix: can I see?
[12:46:04] <pnkfelix> hmm, but it does when I open it from a file url, curiouser and curiouser...
[12:46:11] <eddyb> I know the github.com does something to prevent raw JS files to be executed (i.e. using gist or github as a CDN)
[12:46:35] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[12:46:37] <pnkfelix> eddyb: https://gist.github.com/pnkfelix/9640892
[12:46:42] *** Joins: gwty (gwtypc@5ED33DE6.A6C7EBF9.F099C9FB.IP)
[12:47:20] <pnkfelix> I guess I can tell Firefox to open the downloaded file in firefox
[12:47:24] <pnkfelix> kind of lame
[12:47:46] <pnkfelix> eddyb: hmm, I guess that could be a reason for them to limit this
[12:48:04] <eddyb> view raw downloads it for me (in chrome) :/
[12:48:16] <eddyb> https://gist.githubusercontent.com/pnkfelix/9640892/raw/d9b421851de0c315ed8922ec7e34f07dd6cdf451/l_while_x_break.svg
[12:48:28] <pnkfelix> eddyb: yep, same for me
[12:48:49] * eddyb rubs hands
[12:49:15] <eddyb> pnkfelix: data:text/html,<img src="https://gist.githubusercontent.com/pnkfelix/9640892/raw/d9b421851de0c315ed8922ec7e34f07dd6cdf451/l_while_x_break.svg">
[12:49:26] <eddyb> you can distribute that. not clickable, but hey
[12:49:46] <pnkfelix> eddyb: ah, cute
[12:50:15] <eddyb> for some reason it doesn't work without "> at the end (most HTML stuff does)
[12:51:13] <eddyb> pnkfelix: so that unknown node on the right should not exist at all?
[12:51:29] <pnkfelix> eddyb: it depends on your POV
[12:51:41] <pnkfelix> eddyb: I think that we probably want it to stay
[12:51:43] <eddyb> I wouldn't trans unreachable code
[12:51:53] <pnkfelix> eddyb: right, it might not be trans'ed
[12:51:59] <eddyb> hmpf. can't it just be an error?
[12:52:06] <pnkfelix> eddyb: dead code is not an error
[12:52:24] <eddyb> not potentially dead code. but obviously dead code
[12:52:31] <eddyb> rusti: return; let x = 0;
[12:52:32] -rusti- pastebinned 8 lines of output: http://sprunge.us/gSdS
[12:52:53] <pnkfelix> eddyb: macro expansion can yield dead code
[12:52:58] <eddyb> there's that issue (because inference can't consider ty_bot as a valid type)
[12:52:59] <pnkfelix> eddyb: its a bad idea to outlaw it, IMO
[12:53:03] <eddyb> pnkfelix: okay, makes sense
[12:53:17] <eddyb> but... maybe just not generate CFG nodes for it? unless you want lints to use that
[12:53:30] <pnkfelix> eddyb: yeah, that's something that nmatsakis and I were sort of indirectly discussing earlier
[12:53:53] * eddyb is obviously not paying attention
[12:53:54] <pnkfelix> eddyb: if you look back in the log, we were talking about eliminating spurious nodes up front
[12:54:11] <pnkfelix> eddyb: but the CFG construction interface is a bit simpler if we allow them
[12:54:33] <pnkfelix> eddyb: (but that's not a super-great motivation)
[12:54:58] <eddyb> it's confusing to read right now
[12:55:24] <pnkfelix> eddyb: I might fix the presentation to make it clearer that the disconnected node represents dead code
[12:55:39] <pnkfelix> eddyb: at least on the root of the dead code
[12:55:46] <eddyb> so #27 is the () result from the if?
[12:56:04] <pnkfelix> eddyb: yeah
[12:56:45] <eddyb> is there any specific information about 19 -> 20/27 (related to the if)?
[12:56:55] <eddyb> or just that any of the two paths may be taken?
[12:56:58] *** Quits: gwty (gwtypc@5ED33DE6.A6C7EBF9.F099C9FB.IP) (Ping timeout)
[12:57:05] *** Quits: easy_muffin (martin@moz-BCFA3DA1.public.telering.at) (Quit: Textual IRC Client: www.textualapp.com)
[12:57:56] <pnkfelix> eddyb: you mean like carrying what boolean value the test-condition evaluated to on each edge?
[12:58:08] <eddyb> something like that
[12:58:17] <pnkfelix> eddyb: currently no, the CFG does not carry that level of precision
[12:58:26] <eddyb> I guess it would mean desugaring if into match
[12:58:42] <eddyb> which is something I thought about during my decompiler experiments
[12:58:52] <eddyb> pnkfelix: more about presentation... maybe include the type? and omit "expr" (because it's the most common node type)
[12:58:56] *** Joins: gwty (gwtypc@566515B8.CD98C580.71EA9E17.IP)
[12:59:29] <pnkfelix> hmm I guess the type-checker has run at this point
[12:59:39] <pnkfelix> for some reason I was hestitant to extract information from it
[13:00:05] <eddyb> I'm pretty sure #24 has type ty_bot, for example
[13:00:14] <pnkfelix> maybe because the idea of control-flow-analysis on untyped expressions appealed to the lisper in me
[13:00:37] <eddyb> (and #26, I guess)
[13:00:41] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[13:00:42] <pnkfelix> eddyb: x is bound to (), so ty_unit, no?
[13:00:55] <eddyb> x yes, but not the ExprPath referring to x
[13:01:15] <pnkfelix> eddyb: I'll look into adding it
[13:01:31] <pnkfelix> eddyb: I want to double check that I'm actually handling `break` properly first
[13:01:35] <eddyb> right
[13:01:49] *** Joins: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP)
[13:01:50] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/XuZCRg
[13:01:50] <ghrust> 13rust/06auto 148fcb8dd 15Brian Anderson: std: Improve option docs
[13:01:50] <ghrust> 13rust/06auto 148063450 15bors: auto merge of #12982 : brson/rust/optiondocs, r=alexcrichton...
[13:01:50] *** Parts: ghrust (ghrust@C95C9FF.6A2AE50.F3114085.IP) ()
[13:01:51] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[13:01:51] <ghrust> [13rust] 15bors 04force-pushed 06auto from 1474b790f to 14ff03335: 02http://git.io/N3iJvQ
[13:01:51] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[13:01:57] <eddyb> pnkfelix: in a way, this appeals to me more than --pretty=typed, for "taking a peek". and there's that whole graph thing. I've learned to love them ^_^
[13:02:23] <eddyb> *a peek at the result of typeck
[13:02:53] <eddyb> pnkfelix: does CFG abuse AST IDs badly?
[13:03:21] <pnkfelix> eddyb: another taste data:text/html,<img src="https://gist.githubusercontent.com/pnkfelix/9641160/raw/62a75e9d1676881b2067d2e0a2ce691399c4499c/l_loop_while_v_if_w_and_x_break_l_else_call_z.svg">
[13:04:14] <pnkfelix> eddyb: "abuse ADT IDs" in what sense ?  I am printing the AST ID's in the presentation, but I am not using them to identify nodes in the graph
[13:04:36] <eddyb> so the graph holds references to the AST?
[13:04:37] <pnkfelix> eddyb: (e.g. all the freshly introduced intermediate nodes are assigned DUMMY_ID)
[13:04:53] <eddyb> right, I should've figured
[13:05:04] <eddyb> can't wait to have this thing contain adjustments
[13:05:15] <pnkfelix> eddyb: it holds a map from ast nodes to graph nodes
[13:05:32] <eddyb> that's... okay, I guess
[13:05:56] <eddyb> I can see what's going on with w && x
[13:06:25] <pnkfelix> (or a map from ast NodeId's... a nodemap::NodeMap<CFGIndex>, where CFGIndex is a newtype'd uint mapping into an internal vector in the graph structure)
[13:07:25] *** Quits: lpy (lpy@F3793011.25165A39.3F03179E.IP) (Client exited)
[13:07:31] <pnkfelix> eddyb: the whole input expression tends to be presented in a node towards the bottom, if that was not clear
[13:07:52] <eddyb> I figured that yesterday :))
[13:08:01] <pnkfelix> the fact that the nodes represent exit points rather than entry points continuest to confuse me
[13:08:58] <pnkfelix> e.g. [expr break 'exit] first goes to [expr 'exit: loop { ... }] before it gets to the succeeding node
[13:09:33] <pnkfelix> but I guess this will end up tying into whether we stick with an exit_map or switch to an entry_map (another topic that niko and I discussed earlier)
[13:15:11] *** Joins: edwardw (edwardw@BB690835.D7DB55D8.50B134B9.IP)
[13:18:23] *** Joins: Zr40 (zr40@EE4BB9F5.926C319A.BE2F4011.IP)
[13:24:19] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[13:27:09] *** Quits: gwty (gwtypc@566515B8.CD98C580.71EA9E17.IP) (Ping timeout)
[13:28:58] *** Joins: lpy (lpy@8B40CDAC.F09091A8.1348A864.IP)
[13:29:09] *** Joins: gwty (gwtypc@E28F3FC8.A4938A92.25B273F5.IP)
[13:34:20] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[13:42:15] <eddyb> nmatsakis: aww, there's one case of c_slice (constant &str) where it's not at the start or at the end. now to arbitrarily choose one generic way of solving this
[13:53:02] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[13:54:32] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[13:54:52] *** Quits: lpy (lpy@8B40CDAC.F09091A8.1348A864.IP) (Ping timeout)
[13:58:12] <edwardw> huon: ping
[13:59:13] <huon> edwardw: pong
[13:59:43] <edwardw> https://github.com/edwardw/rust/commit/ebd350b5beaa8ec9b876aa144adbebee1b3651d5 can you think of something off the top your head that there might be LLVM assertion failure?
[14:00:08] <huon> what are you transmuting to?
[14:00:11] <edwardw> I have no idea except throwing in some brutal transmute
[14:00:27] <edwardw> extern fn -> extern "C" fn
[14:00:40] <huon> that... should be a no-op
[14:00:40] <eddyb> bad bad bad
[14:00:54] <eddyb> huon: calling the result is very dangerous
[14:01:14] <huon> rusti: extern fn foo() {} let _: extern "C" fn() = foo;
[14:01:14] -rusti- ()
[14:01:29] <huon> edwardw: are you transmuting Option<extern fn> -> Option<extern "C" fn>
[14:01:36] <huon> or -> extern "C" fn
[14:01:38] <huon> eddyb: huh?
[14:01:45] <edwardw> huon: yes, wrapped in an Option
[14:02:16] <huon> edwardw: then I would think the transmutes are doing literally nothing
[14:02:46] <edwardw> huon: weird
[14:03:03] <huon> edwardw: is it that commit specifically that's causing LLVM assertions?
[14:03:26] <edwardw> huon: that `extern fn` is inside a regular rust fn, any difference?
[14:03:57] <huon> edwardw: nope
[14:03:57] <edwardw> huon: my previous (seemingly irrelevant) commit causes LLVM to complain
[14:04:10] <huon> and the transmutes fix it?
[14:04:16] <edwardw> yes
[14:04:37] <huon> wait, so you're saying that https://github.com/edwardw/rust/commit/c8b81f2a7f8052c9f02b79d3f08fedc935a04528 makes LLVM complain in librustdoc?
[14:05:13] <edwardw> huon: not that, the first two in https://github.com/mozilla/rust/pull/12828/commits
[14:07:12] <huon> edwardw: sounds like you have a bug :)
[14:08:25] *** Joins: edwardw_ (edwardw@FE274C20.C036752E.F5B522C5.IP)
[14:08:37] *** Quits: edwardw (edwardw@BB690835.D7DB55D8.50B134B9.IP) (Ping timeout)
[14:08:46] *** edwardw_ is now known as edwardw
[14:08:59] <eddyb> edwardw: (ignoring special cases) you should never transmute extern "C" fn to extern "Rust" fn or the other way around
[14:09:16] <edwardw> ok
[14:09:19] <eddyb> edwardw: the simplest explanation is that the LLVM assertion comes from *calling* the result
[14:09:52] <eddyb> or maybe the LLVM representation of the function pointer types has a different number of arguments, which is also possible
[14:10:39] <edwardw> it works fine until my commits come along
[14:11:01] * edwardw waves fist to wifi router
[14:11:19] <eddyb> edwardw: just... try to never do it
[14:11:43] <edwardw> :D
[14:12:20] <eddyb> so adding transmutes fixes the problem? I'm still confused
[14:12:29] <eddyb> why do you need transmutes?
[14:12:33] <pnkfelix> eddyb: Wait, I thought `extern fn` was changed to assume `extern "C" fn`
[14:12:34] <edwardw> yes it does, a riddle
[14:12:47] <eddyb> pnkfelix: I read extern "Rust" fn :/
[14:12:56] <eddyb> pnkfelix: or rather, just "fn"
[14:13:11] <eddyb> edwardw: what are the from/to types?
[14:13:26] <eddyb> pnkfelix: that would explain why huon said it would be noop
[14:13:35] <edwardw> eddyb: the expected Option<extern "C" fn(*buf, *buf, *buf, *libc::c_void)>
[14:13:45] <edwardw> eddyb: the actual extern fn block(ob: *buf, text: *buf, lang: *buf, opaque: *libc::c_void)
[14:13:59] <edwardw> well wrapped in Some()
[14:14:02] <eddyb> what happens if you add "C" to the fn?
[14:14:05] <pnkfelix> eddyb: to be fair, I don't know what the current state is
[14:14:13] <eddyb> the extern fn one
[14:14:18] <pnkfelix> eddyb: I know we talked about this recently, but I do not know what's landed since then.
[14:14:28] <eddyb> pnkfelix: I assumed fn -> extern "C" fn which should break things
[14:14:29] <edwardw> eddyb: I can't, it is defined inside a regular fn 
[14:14:49] <eddyb> edwardw: and only top level extern fns can have an ABI?
[14:14:56] <huon> edwardw: `extern "C" fn block(...) { ... }` should be fine
[14:14:58] <pnkfelix> eddyb: ah okay.  I haven't seen edwardw say just `fn` with no extern in the channel.
[14:15:23] <eddyb> extern "C" fn block() {}
[14:15:26] <eddyb> err
[14:15:28] <eddyb> rusti: extern "C" fn block() {}
[14:15:29] -rusti- <anon>:16:9: 16:33 warning: code is never used: `block`, #[warn(dead_code)] on by default
[14:15:29] -rusti- <anon>:16         extern "C" fn block() {}
[14:15:29] -rusti-                   ^~~~~~~~~~~~~~~~~~~~~~~~
[14:15:29] -rusti- ()
[14:15:41] <eddyb> edwardw: ^^
[14:15:45] <edwardw> eddyb: huon: I thought I tried that. But I'll try again just to be sure
[14:16:15] <huon> edwardw: what's the actual assertion, btw?
[14:16:39] <eddyb> (I wonder if we do something very silly and end up with a regular "fn")
[14:16:48] <eddyb> (or extern "Rust" fn I should say)
[14:17:49] <edwardw> huon: pointer must point to a Val, something like that
[14:18:04] <eddyb> with no types?
[14:18:18] <huon> edwardw: it's super weird that you'd introduce a LLVM assertion without touching trans
[14:18:39] <huon> edwardw: have you tried to make a smaller testcase?
[14:18:39] <eddyb> this must be a different bug
[14:18:52] <edwardw> huon: that's puzzled me too
[14:19:06] <edwardw> huon: nope, I didn't try to isolate the issue yet
[14:19:11] <eddyb> rusti: extern fn foo() {} extern fn bar() {} let () = (foo, bar);
[14:19:12] -rusti- <anon>:16:51: 16:53 error: mismatched types: expected `(extern "C" extern fn(),extern "C" extern fn())` but found `()` (expected tuple but found ())
[14:19:12] -rusti- <anon>:16         extern fn foo() {} extern fn bar() {} let () = (foo, bar);
[14:19:12] -rusti-                                                             ^~
[14:19:12] -rusti- error: aborting due to previous error
[14:19:13] -rusti- application terminated with error code 101
[14:19:17] <eddyb> oops
[14:19:23] <eddyb> rusti: extern fn foo() {} extern "C" fn bar() {} let () = (foo, bar);
[14:19:23] -rusti- <anon>:16:55: 16:57 error: mismatched types: expected `(extern "C" extern fn(),extern "C" extern fn())` but found `()` (expected tuple but found ())
[14:19:24] -rusti- <anon>:16         extern fn foo() {} extern "C" fn bar() {} let () = (foo, bar);
[14:19:24] -rusti-                                                                 ^~
[14:19:24] -rusti- error: aborting due to previous error
[14:19:26] -rusti- application terminated with error code 101
[14:19:34] <huon> edwardw: that would be my first port-of-call: making a smaller test case :)
[14:19:36] <eddyb> they look identical :/
[14:20:03] <edwardw> huon: fair enough, I'm doing it now :)
[14:22:14] <eddyb> nmatsakis: I want [a, b].move_iter() *so bad*
[14:22:41] <eddyb> (and with VG you can implement that on a closure with all types the same type)
[14:22:52] <huon> eddyb: Some(a).move_iter().chain(Some(b).move_iter()) is just as slick :P
[14:23:21] <huon> (we already know that VG solves every possible problem :P )
[14:23:28] <eddyb> oh, yeah, that too. why did kimundi not finish making it Some(a).chain(Some(b))?
[14:23:51] <huon> i think it was (correctly) deemed to easy to screw up
[14:23:51] <edwardw> VG = ?
[14:24:10] <eddyb> huon: but I want my chains :(
[14:24:11] <huon> write `for x in some_option { .. }` and then it's `None` afterwards, accidentally
[14:24:16] <huon> edwardw: variadic generics
[14:24:24] <huon> eddyb's favourite thing
[14:24:30] <edwardw> lol
[14:24:31] <eddyb> huon: the solution to that is Iterable, obviously
[14:25:12] <eddyb> but good luck implementing Iterable for both Iterator<T> and Option<T> if Option<T> implements Iterator<T>
[14:30:12] *** Joins: bvssvni (Mibbit@moz-A47B6F8E.bb.online.no)
[14:34:23] *** Joins: lpy (lpy@1834E2CB.F09091A8.1348A864.IP)
[14:42:59] <kimundi> huon, eddyb: Actually I finished that patch and then never decided to submit it because I got second thoughts :P
[14:53:19] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[14:53:19] *** ChanServ sets mode: +ao pcwalton pcwalton
[14:53:22] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Ping timeout)
[14:56:48] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[14:56:48] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/XuZCRg
[14:56:48] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[15:01:47] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[15:01:47] <ghrust> [13rust] 15bors pushed 14 new commits to 06auto: 02http://git.io/hFZZHQ
[15:01:48] <ghrust> 13rust/06auto 1400cb1e5 15Flavio Percoco: Add a Share kind...
[15:01:48] <ghrust> 13rust/06auto 14b8db69d 15Flavio Percoco: Make `Rc`, `Cell` and `RefCell` NoShare
[15:01:48] <ghrust> 13rust/06auto 144993759 15Flavio Percoco: Replace Freeze bounds with Share bounds
[15:01:50] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[15:01:51] *** Joins: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP)
[15:01:51] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/lCgDrQ
[15:01:51] *** Parts: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP) ()
[15:02:03] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[15:05:09] <kimundi> eddyb: I hate it if rusti triggers spam protection and I suddenly can not answer anymore :P
[15:11:43] *** flaper87 is now known as flaper87|afk
[15:14:43] <eddyb> apparently... jobs are coming to me. kinda. time to start questioning my professional stance >_>
[15:18:11] *** flaper87|afk is now known as flaper87
[15:19:44] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Connection reset by peer)
[15:22:42] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[15:28:13] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[15:28:34] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[15:30:17] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[15:34:44] *** Quits: gimpf (gimpf@moz-E131F8EC.adsl.highway.telekom.at) (Quit: Leaving.)
[15:36:18] <eddyb> edwardw: now I'm wasting time debugging your code >_>
[15:36:36] <edwardw> please!
[15:36:50] <eddyb> it's likely this https://github.com/edwardw/rust/commit/4c51634df1099946c62beb17983a8b1c261b7a2f#diff-37d4d3558a7095b36c3d81fa05d3885aL370
[15:37:18] <eddyb> rusti: extern fn foo(){} let () = foo;
[15:37:18] -rusti- <anon>:16:31: 16:33 error: mismatched types: expected `extern "C" extern fn()` but found `()` (expected extern fn but found ())
[15:37:19] -rusti- <anon>:16         extern fn foo(){} let () = foo;
[15:37:19] -rusti-                                         ^~
[15:37:19] -rusti- error: aborting due to previous error
[15:37:19] -rusti- application terminated with error code 101
[15:37:22] <edwardw> the mk_subty vs. mk_eqty? not that
[15:37:33] <edwardw> that's the first suspect I checked
[15:37:44] <eddyb> then https://github.com/edwardw/rust/commit/133a7d74bcb0307a1fd70e19e400eb54fa0a1537?w=0
[15:38:08] <edwardw> should be there somewhere
[15:39:43] <eddyb> I don't understand how the line above is possible
[15:39:49] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[15:40:32] <edwardw> no?
[15:40:37] <eddyb> this comment confused me // EXTERN FUNCTION ITEM
[15:41:17] <eddyb> edwardw: okay, one sane solution is to remove ExternFn from the AST
[15:41:45] <edwardw> no extern?
[15:41:57] <eddyb> we already have ABIs
[15:42:08] <eddyb> ExternFn is not really handled anywhere
[15:42:08] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[15:42:13] <eddyb> the ABI is important
[15:42:46] <eddyb> rusti: extern "C" fn foo(){} let _: extern "system" fn() = foo;
[15:42:46] -rusti- pastebinned 5 lines of output: http://sprunge.us/iIVb
[15:42:53] <edwardw> what bugs me the most is I still don't understand why my changes trigger all these
[15:43:09] <eddyb> edwardw: inference
[15:43:40] <eddyb> I can't really explain it, but the ExternFn propagates in a different way with your change
[15:43:46] <eddyb> it doesn't look like it could ever work :/
[15:43:53] *** Joins: lkuper (lkuper@moz-AD4C50F5.dhcp-bl.indiana.edu)
[15:43:57] <eddyb> rusti: extern "C" fn foo(){} let _: extern "C" fn() = foo;
[15:43:57] -rusti- ()
[15:43:58] <edwardw> that bad hmm
[15:44:12] <eddyb> rusti: extern "C" fn foo(){} let _: (extern "C" fn(),) = (foo,);
[15:44:13] -rusti- ()
[15:44:30] <eddyb> it's luck that ^^ doesn't break
[15:44:47] <eddyb> rusti: struct Foo<T>(T); extern "C" fn foo(){} let _: Foo<extern "C" fn()> = Foo(foo);
[15:44:48] -rusti- ()
[15:44:58] <eddyb> the types just happen to match
[15:45:04] <eddyb> touch inference, it all goes boom
[15:45:12] <edwardw> k
[15:45:18] <eddyb> rusti: struct Foo<T>(T); extern "system" fn foo(){} let _: Foo<extern "C" fn()> = Foo(foo);
[15:45:19] -rusti- pastebinned 5 lines of output: http://sprunge.us/LXJQ
[15:45:31] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[15:46:20] <eddyb> edwardw: the good thing is that we can now allow extern "C" unsafe fn
[15:46:31] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[15:47:16] <eddyb> and so LLVM doesn't break again, I'd suggest giving that the extern "C" fn type repr (you can have the type different, for whatever reason)
[15:47:26] *** Quits: lkuper (lkuper@moz-AD4C50F5.dhcp-bl.indiana.edu) (Quit: lkuper)
[15:47:46] <eddyb> maybe we should get rid of UnsafeFn as well and have an UnsafeRust ABI
[15:47:51] *** Joins: lkuper (lkuper@moz-AD4C50F5.dhcp-bl.indiana.edu)
[15:48:04] <edwardw> how big will this change be?
[15:48:08] <eddyb> then you can put extern "C" fn on your methods to make them C++ compatible
[15:48:20] <eddyb> edwardw: not that big. mostly removing ExternFn from everywhere
[15:49:02] <eddyb> only 20 occurences in the code base, more than half of them are imports and exhaustive matches
[15:49:31] <edwardw> does that also mean keyword `extern` is gone?
[15:50:28] <eddyb> edwardw: has little to do with the keyword
[15:50:35] <edwardw> k
[15:50:38] <eddyb> ExternFn is a Purity variant
[15:50:52] <edwardw> ah ok
[15:51:36] <eddyb> unsafe can be sugar for an unsafe block inside the function and a different ABI when it's Rust
[15:51:52] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[15:51:52] <ghrust> [13rust] 15bors pushed 3 new commits to 06auto: 02http://git.io/fGGkRg
[15:51:52] <ghrust> 13rust/06auto 147437995 15klutzy: rustc: Fix x86 ffi for struct arguments...
[15:51:52] <ghrust> 13rust/06auto 142d31bca 15klutzy: rustc: Fix x86 ffi for empty struct arguments
[15:51:52] <ghrust> 13rust/06auto 1461d5bc5 15bors: auto merge of #12762 : klutzy/rust/win-struct-abi, r=alexcrichton...
[15:51:54] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[15:52:05] *** Quits: Zr40 (zr40@EE4BB9F5.926C319A.BE2F4011.IP) (Quit: leaving)
[15:52:13] <eddyb> hah I wonder how many people hit those issues
[15:52:42] <eddyb> does it mean I can stop saying "never pass structs by value from/to C code"?
[15:53:25] * eddyb goes back to his own stuff
[15:55:47] <eddyb> huon: hehe look at ty_of_closure
[15:56:07] <eddyb> its arguments, to be precise
[15:59:01] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[15:59:43] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[16:02:02] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[16:11:12] *** flaper87 is now known as flaper87|afk
[16:11:58] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[16:20:10] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[16:23:13] *** Quits: japaric (japaric@7433ECC4.8FD1E798.5C7588CA.IP) (Ping timeout)
[16:23:23] *** Joins: japaric (japaric@1B985D9E.C4F72AE.F29ED47E.IP)
[16:29:03] *** Parts: aepsil0n (ebopp@moz-EF530DCB.ita.uni-heidelberg.de) ()
[16:40:52] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[16:52:08] *** Joins: brson (brson@moz-62518563.mtv2.mozilla.com)
[16:52:08] *** ChanServ sets mode: +qo brson brson
[16:53:20] <eddyb> brson: how are the snapshot bots coming along :D?
[16:55:07] *** Quits: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net) (Input/output error)
[16:55:58] *** Quits: Kxepal (Miranda@moz-1110A3C3.pppoe.mtu-net.ru) (Ping timeout)
[17:00:15] *** Joins: Kxepal (Miranda@moz-5876CFFD.pppoe.mtu-net.ru)
[17:04:03] <brson> eddyb: the old machines are no closer to coming back. i'm setting up a new vm today that should be able to make linux snapshots
[17:06:56] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[17:06:56] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/fGGkRg
[17:06:56] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[17:09:32] *** Quits: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net) (Ping timeout)
[17:09:35] <cmr> eddyb: sorry, was sleeping :\
[17:10:38] <cmr> benching now
[17:11:56] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[17:11:56] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/HW8XKg
[17:11:56] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[17:13:07] <eddyb> let name = Datum(name.val, name.ty, RvalueExpr(Rvalue(name.kind.mode))); Some(name).move_iter().chain(extra.iter().map(|arg| arg.to_expr_datum()))
[17:13:13] <eddyb> this doesn't look so good :/
[17:13:38] <eddyb> it would be simpler if I didn't care about the efficiency of generating visit_glue :P
[17:23:26] *** Quits: [o__o] (~o__o@604A2740.DB688352.F4ADE383.IP) (Ping timeout)
[17:32:19] *** Joins: [o__o] (~o__o@604A2740.DB688352.F4ADE383.IP)
[17:33:51] *** Joins: TimAbraldes (quassel@moz-BF4D134B.hsd1.or.comcast.net)
[17:35:54] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Client exited)
[17:36:15] *** Joins: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp)
[17:37:56] *** Quits: ssira (ssira@moz-F6206352.kanagawa.ocn.ne.jp) (Ping timeout)
[17:39:06] <eddyb> how did this take me so long :(?
[17:39:15] <eddyb> I've done like nothing today
[17:45:39] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[17:46:56] *** Quits: glaebhoerl (glaebhoerl@moz-3590251D.kabelnet.hu) (Ping timeout)
[17:47:26] <cmr> eddyb: do you want a comparison graph or just a graph?
[17:47:51] <eddyb> cmr: comparison would be nice
[17:47:59] <eddyb> seeing how things change every other day now
[17:48:12] <cmr> will do
[17:50:15] <eddyb> thanks :D
[17:50:33] <eddyb> do I dare run make? oh the mess I've made
[17:50:46] * eddyb tries to not puke all over trans::reflect
[17:50:49] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[17:52:33] <eddyb> this would be a lot easier if I could, you know, change things, without duplicating definitions all over std
[17:52:51] <cmr> staging is such a pain
[17:53:14] <eddyb> instead I have to chain iterators
[17:53:27] <eddyb> and really, std::iter::one(x) -> Some(x).move_iter() pls
[17:55:44] <sfackler> I'd like iter::one(x) and iter::none() as well
[17:55:47] *** Quits: lpy (lpy@1834E2CB.F09091A8.1348A864.IP) (Client exited)
[17:56:36] *** Joins: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com)
[17:56:36] *** ChanServ sets mode: +ao pcwalton pcwalton
[17:57:30] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[17:57:32] <eddyb> sfackler: none? what for?
[17:57:40] <eddyb> I guess I could've used it once or twice
[17:58:46] <sfackler> yeah, it's come up a couple of times for me
[17:59:52] <eddyb> nmatsakis: hmpf, it would be nice if by the type we reach trans, all types have the has_type_contents flag set (which indicates that a Cell *within* the type has been set with the appropriate type contents) so I can look up something like pod-ness without tcx
[18:00:43] <nmatsakis> eddyb: that can't be guaranteed because trans / monomorphization creates types we may not yet have seen
[18:01:06] *** Joins: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP)
[18:04:35] <eddyb> nmatsakis: *sigh* true
[18:08:41] *** Quits: gwty (gwtypc@E28F3FC8.A4938A92.25B273F5.IP) (Quit: No Ping reply in 180 seconds.)
[18:09:33] *** Joins: gwty (gwtypc@E28F3FC8.A4938A92.25B273F5.IP)
[18:10:11] *** Quits: Sharp (Sharp@moz-633F3606.hsd1.ca.comcast.net) (Quit: Sharp)
[18:13:21] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[18:13:44] *** Joins: dotfelix (dotfelix@BFB0E868.AB3AC796.40E092AA.IP)
[18:19:31] <brson> acrichto: new win bots are finishing in about 1 hour
[18:19:33] <brson> is that good?
[18:19:45] <brson> (i guess i can look up the old times)
[18:19:59] *** Joins: Sharp (Sharp@19388942.6B775EBE.DC877F3B.IP)
[18:20:05] <acrichto> it's not terrible
[18:20:06] <brson> actually i can't
[18:20:09] <acrichto> I think they're still the slowest though
[18:20:14] <acrichto> it could be that we're only using one bot
[18:20:16] <acrichto> for all the builds
[18:20:24] <brson> hm
[18:20:27] <brson> we can fix that
[18:20:35] <brson> though these are 8 core machines
[18:20:52] <acrichto> they're only slower by ~5 min
[18:20:54] <brson> we could try spinning up more
[18:21:02] <brson> i want to -j2 the bots still
[18:21:08] <acrichto> what was that about costs :P
[18:21:20] <brson> oh well
[18:21:35] <brson> everybody wants us to switch to vms, so we're going to do it in a blaze of expensive glory
[18:21:56] <acrichto> "you asked for this"
[18:27:51] <acrichto> brson: the aws machines are faster
[18:27:56] <acrichto> than the physical machines
[18:28:10] <acrichto> by ~15 mins
[18:28:22] *** Quits: wycats (sid79@moz-5F4AA75A.irccloud.com) (Ping timeout)
[18:28:26] <eddyb> the cloud is a magical place
[18:29:21] *** Quits: jack (sid19593@moz-A42E5B7B.irccloud.com) (Ping timeout)
[18:29:21] *** Joins: wycats (sid79@moz-5F4AA75A.irccloud.com)
[18:29:47] *** Quits: bjz_ (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[18:33:34] *** Joins: jack_ (sid19593@moz-A42E5B7B.irccloud.com)
[18:36:17] <brson> acrichto: woo!
[18:38:41] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[18:39:04] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[18:44:11] *** Joins: Jesse (jruderman@moz-62518563.mtv2.mozilla.com)
[18:50:40] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[18:51:35] *** Joins: japaric1 (japaric@2AF8646A.4B327FDB.F29ED47E.IP)
[18:52:01] *** Quits: japaric (japaric@1B985D9E.C4F72AE.F29ED47E.IP) (Ping timeout)
[18:53:43] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[18:59:53] *** Quits: lkuper (lkuper@moz-AD4C50F5.dhcp-bl.indiana.edu) (Quit: lkuper)
[19:04:09] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[19:06:48] *** Joins: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP)
[19:06:48] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/jS7I5A
[19:06:48] *** Parts: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP) ()
[19:07:29] *** jack_ is now known as jack
[19:09:06] *** Quits: dotfelix (dotfelix@BFB0E868.AB3AC796.40E092AA.IP) (Quit: )
[19:09:24] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[19:09:54] <eddyb> nmatsakis: ohhh I think I know how to call what I want
[19:10:00] <eddyb> nmatsakis: monadic Datums
[19:10:12] * eddyb has officially gone full insane
[19:10:20] <nmatsakis> :)
[19:10:57] <eddyb> datum_block.map(|p| PointerCast(p, other_type))
[19:11:01] <eddyb> but it doesn't work *that* well
[19:11:37] <eddyb> nmatsakis: I guess we should just wrap some of the LLVM operations in Datum
[19:11:51] *** Joins: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP)
[19:11:51] <ghrust> [13rust] 15bors pushed 14 new commits to 06auto: 02https://github.com/mozilla/rust/compare/7532d20a17dc...66acd5086e02
[19:11:51] <ghrust> 13rust/06auto 1450d3d18 15Flavio Percoco: Add a Share kind...
[19:11:51] <ghrust> 13rust/06auto 1473abdda 15Flavio Percoco: Make `Rc`, `Cell` and `RefCell` NoShare
[19:11:51] <ghrust> 13rust/06auto 14d009dfc 15Flavio Percoco: Replace Freeze bounds with Share bounds
[19:11:53] *** Parts: ghrust (ghrust@B750D19A.6A2AE50.F3114085.IP) ()
[19:15:11] <kimundi> arg, can't answer in #rust again
[19:15:32] <kimundi> huon: could you -M ?
[19:18:11] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[19:19:50] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[19:20:12] *** Quits: luz (lu.cy@moz-CD18B14B.customer.cdi.no) (Connection reset by peer)
[19:20:27] *** Joins: luz (lu.cy@moz-CD18B14B.customer.cdi.no)
[19:25:25] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Connection reset by peer)
[19:27:25] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[19:27:52] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[19:30:34] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[19:31:33] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[19:35:54] *** Joins: dotfelix (dotfelix@BFB0E868.AB3AC796.40E092AA.IP)
[19:36:43] *** Quits: dotfelix (dotfelix@BFB0E868.AB3AC796.40E092AA.IP) (Quit: )
[19:38:42] *** Joins: Transformer (Transforme@moz-83357A1F.dyn.optonline.net)
[19:41:23] <cmr> eddyb: good news: http://i.imgur.com/5HzL6w4.png
[19:42:00] <eddyb> oh wow
[19:42:21] <eddyb> r?
[19:42:33] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[19:42:34] *** Parts: Transformer (Transforme@moz-83357A1F.dyn.optonline.net) ()
[19:43:46] <cmr> r+
[19:43:57] <cmr> was there something else I was supposed to bench?
[19:43:58] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[19:44:06] <eddyb> cmr: hmpf, I don't think so. thanks :)
[19:47:50] <sfackler> cmr: which change is that?
[19:48:09] <cmr> sfackler: https://github.com/mozilla/rust/pull/12770
[19:48:30] <sfackler> sweet
[19:48:45] <sfackler> is the build speedup part of that as well or just noise?
[19:50:54] <cmr> not really sur
[19:51:00] <cmr> I imagine it is noise
[19:51:22] <cmr> freeing things takes time
[19:51:58] <cmr> on the other hand further mallocs would have an existing pool of free memory to use
[19:52:04] <cmr> so who knows
[19:52:16] <eddyb> ^^ universal answer
[19:52:24] <eddyb> cmr: you could always also try with jemalloc
[19:52:30] <cmr> meh
[19:52:33] <eddyb> since that is bound to be slightly more deterministic
[19:52:39] <eddyb> but I won't ask that from you
[19:52:41] <eddyb> cmr: OHH silly me
[19:52:49] <eddyb> so I'm complaining about ridiculous memory usage
[19:53:03] <eddyb> why... why don't I LD_PRELOAD jemalloc all the time?
[19:53:09] <sfackler> http://static.tumblr.com/dftvzpr/ynumbaig4/itisamystery.png
[19:53:10] <cmr> that's a good question
[19:53:12] <cmr> I assumed you were
[19:55:36] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[19:57:31] *** Joins: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP)
[19:57:31] <ghrust> [13rust] 15cmr 04force-pushed 06try from 1415c6bd1 to 14359de9e: 02http://git.io/k471pw
[19:57:31] <ghrust> 13rust/06try 143cc569c 15Corey Richardson: Remove libc from std...
[19:57:31] <ghrust> 13rust/06try 146480355 15Corey Richardson: fix fallout from std::libc separation
[19:57:32] <ghrust> 13rust/06try 145d661da 15Corey Richardson: Add unrecognized_lint
[19:57:34] *** Parts: ghrust (ghrust@2DCF43EA.6A2AE50.F3114085.IP) ()
[20:01:50] *** Joins: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP)
[20:01:50] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/9it6mA
[20:01:50] <ghrust> 13rust/06auto 14c04d484 15Eduard Burtescu: Discard MTWT & interner tables from TLD after they stop being useful.
[20:01:50] <ghrust> 13rust/06auto 144ca51ae 15bors: auto merge of #12770 : eddyb/rust/drop-tld, r=cmr...
[20:01:51] *** Parts: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP) ()
[20:01:54] *** Joins: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP)
[20:01:54] <ghrust> [13rust] 15bors 04force-pushed 06auto from 1466acd50 to 147532d20: 02http://git.io/N3iJvQ
[20:01:54] *** Parts: ghrust (ghrust@99CAE845.6A2AE50.F3114085.IP) ()
[20:04:32] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[20:16:09] *** Quits: bytbox (s@moz-E1E7FAC3.washdc.fios.verizon.net) (Ping timeout)
[20:16:28] *** Joins: bytbox (s@moz-E1E7FAC3.washdc.fios.verizon.net)
[20:19:43] <cmr> acrichto: r? https://github.com/mozilla/rust/pull/12961
[20:20:01] <cmr> acrichto: I removed all the accordion stuff. I think it's probably more harmful than beneficial.
[20:20:26] <cmr> and after experimenting with it it's not really a big win, IMO
[20:23:51] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[20:26:53] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[20:27:34] *** Quits: edwardw (edwardw@FE274C20.C036752E.F5B522C5.IP) (Quit: Leaving...)
[20:28:14] *** Joins: lkuper (lkuper@moz-AD4C50F5.dhcp-bl.indiana.edu)
[20:31:16] *** Joins: japaric2 (japaric@5264F756.A8CC9503.F29ED47E.IP)
[20:31:21] *** Quits: japaric1 (japaric@2AF8646A.4B327FDB.F29ED47E.IP) (Ping timeout)
[20:31:33] *** Quits: TimAbraldes (quassel@moz-BF4D134B.hsd1.or.comcast.net) (Input/output error)
[20:32:03] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[20:32:44] <eddyb> cmr: so what will we see?
[20:33:11] <eddyb> I was going to complain, earlier, that default methods are too noisy
[20:36:01] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[20:37:46] *** Joins: edwardw (edwardw@FE274C20.C036752E.F5B522C5.IP)
[20:43:59] <cmr> nothing changes except that derived impls are at the bottom of the page and separate
[20:44:49] <eddyb> cmr: well, it's better, so I'll take it :)
[20:44:56] <edwardw> the new doc?
[20:45:04] <cmr> https://github.com/mozilla/rust/pull/12961
[20:45:17] <cmr> eddyb: any ideas on how to make default methods less noisy?
[20:45:26] <eddyb> remove things from them?
[20:45:58] <eddyb> maybe link to the trait methods instead of displaying full inline doc comments (from the trait)
[20:46:04] <cmr> I almost want to not show them at all
[20:46:16] <eddyb> maybe just list them?
[20:46:23] <cmr> And just say "There are default methods unchanged from the trait."
[20:46:31] <eddyb> ah, sure
[20:46:48] <edwardw> oh dear, usually programmers make poor designer
[20:46:51] * edwardw runs
[20:47:03] <cmr> but then you don't have a list of all the methods on a type :(
[20:47:20] <eddyb> cmr: show them like in the accordion view
[20:47:26] <eddyb> and have them be links to the trait
[20:47:30] <eddyb> would that work?
[20:47:53] <eddyb> cmr: ohh this https://github.com/mozilla/rust/pull/13013
[20:48:01] <eddyb> cmr: (you asked if there was something else to bench)
[20:49:10] <cmr> eddyb: I can make anything work, the question is whether or not it's nice to use :P
[20:50:19] *** Quits: edwardw (edwardw@FE274C20.C036752E.F5B522C5.IP) (Quit: Leaving...)
[20:50:26] <nrc> vtable.rs - we do two passes trying to resolve, if I find an error where we pass twice what should I do? span_error means the error gets reported twice, span_fatal means we stop checking, neither seem ideal
[20:50:32] *** Quits: eddyb (eddy@F8B50789.F33C1089.FB866788.IP) (Ping timeout)
[20:53:56] *** Joins: glaebhoerl (glaebhoerl@moz-B5B88D72.catv.broadband.hu)
[21:00:17] *** Quits: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com) (Quit: pcwalton)
[21:02:18] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Client exited)
[21:03:17] *** Joins: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com)
[21:03:17] *** ChanServ sets mode: +ao pcwalton pcwalton
[21:04:35] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[21:04:55] *** Quits: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net) (Connection reset by peer)
[21:05:08] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[21:06:06] *** Joins: dherman (dherman@moz-62518563.mtv2.mozilla.com)
[21:06:06] *** ChanServ sets mode: +ao dherman dherman
[21:06:50] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[21:06:54] *** Joins: TheHydroImpulse (TheHydroIm@moz-A9FB1B83.ed.shawcable.net)
[21:07:55] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[21:14:27] *** Joins: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net)
[21:15:05] *** Quits: lkuper (lkuper@moz-AD4C50F5.dhcp-bl.indiana.edu) (Quit: lkuper)
[21:17:48] *** Joins: lkuper (lkuper@moz-AD4C50F5.dhcp-bl.indiana.edu)
[21:18:30] <acrichto> ugh, can we turn off the ~[] lint?
[21:18:38] <acrichto> it's essentially useless because no libraries are updated
[21:18:52] <sfackler> +1
[21:18:57] <sfackler> I have no idea why it's warn by default
[21:19:23] <strcat> acrichto: it's being used to update the libraries and keep them updated though
[21:19:45] <sfackler> strcat: so those libraries can #[warn(deprecated_owned_vector)]
[21:19:49] <acrichto> strcat: no it's not, right now all libraries still use ~[]
[21:19:58] <acrichto> when we update the standard libraries we can turn it back on
[21:19:59] <strcat> acrichto: libsyntax, librustc, etc. were ported
[21:20:01] <acrichto> it's just way too noisy now
[21:20:06] <acrichto> well, no one's using those
[21:20:09] <acrichto> everyone's using libstd
[21:20:12] <strcat> acrichto: it encourages people to port them, there have been a lot of PRs
[21:20:13] <acrichto> and libstd is not ported
[21:20:54] <brson> acrichto: i've add -j2 to the make command on the bots (not make check)
[21:21:06] <acrichto> brson: hurray!
[21:22:42] <brson> i'm also about to change the max builds per machine from 3 to 2
[21:25:21] <strcat> I would have worked on Vec more, but I've been waiting 11 days for my last PR related to that
[21:28:08] *** Quits: gwty (gwtypc@E28F3FC8.A4938A92.25B273F5.IP) (Ping timeout)
[21:29:09] <huon> cmr: https://github.com/mozilla/rust/pull/13013 and https://github.com/mozilla/rust/pull/13016 would like benches :)
[21:30:45] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[21:37:17] *** Quits: glaebhoerl (glaebhoerl@moz-B5B88D72.catv.broadband.hu) (Ping timeout)
[21:38:34] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[21:38:56] *** Joins: glaebhoerl (glaebhoerl@moz-B5B88D72.catv.broadband.hu)
[21:45:11] *** Quits: dherman (dherman@moz-62518563.mtv2.mozilla.com) (Quit: dherman)
[21:46:06] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[21:46:51] *** Joins: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP)
[21:46:51] <ghrust> [13rust] 15bors merged 06auto into 06master: 02http://git.io/9it6mA
[21:46:51] *** Parts: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP) ()
[21:47:57] *** Joins: Transformer (Transforme@moz-83357A1F.dyn.optonline.net)
[21:49:37] *** Quits: glaebhoerl (glaebhoerl@moz-B5B88D72.catv.broadband.hu) (Quit: )
[21:49:42] *** Quits: lkuper (lkuper@moz-AD4C50F5.dhcp-bl.indiana.edu) (Quit: lkuper)
[21:50:39] *** Quits: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com) (Quit: pcwalton)
[21:51:38] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[21:51:46] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[21:51:46] <ghrust> [13rust] 15bors pushed 0 new commits to 06auto: 02http://git.io/asBGBQ
[21:51:46] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[21:51:48] *** Joins: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP)
[21:51:48] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/omgZ7Q
[21:51:48] <ghrust> 13rust/06auto 14a0891b9 15Huon Wilson: syntax: allow `trace_macros!` and `log_syntax!` in item position....
[21:51:48] <ghrust> 13rust/06auto 14b6e1c6a 15bors: auto merge of #12998 : huonw/rust/log_syntax, r=alexcrichton...
[21:51:49] *** Parts: ghrust (ghrust@38D6F008.6A2AE50.F3114085.IP) ()
[21:52:34] *** Parts: Transformer (Transforme@moz-83357A1F.dyn.optonline.net) ()
[21:53:36] <acrichto> huon: r? https://github.com/mozilla/rust/pull/13020
[21:54:40] *** Quits: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net) (Ping timeout)
[21:54:53] *** Joins: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com)
[21:54:54] *** ChanServ sets mode: +ao pcwalton pcwalton
[21:59:37] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[21:59:46] *** Quits: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com) (Quit: pcwalton)
[22:01:10] *** Joins: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com)
[22:01:10] *** ChanServ sets mode: +ao pcwalton pcwalton
[22:05:31] *** Joins: mawuli (mawuli@F7A4F2ED.68EE7C48.E520B65A.IP)
[22:08:10] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[22:10:58] *** Joins: dotfelix (dotfelix@A85169A3.829DBEF3.40E092AA.IP)
[22:12:18] *** Joins: Transformer (Transforme@moz-83357A1F.dyn.optonline.net)
[22:12:34] *** Parts: Transformer (Transforme@moz-83357A1F.dyn.optonline.net) ()
[22:13:19] *** Quits: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP) (Quit: Lost terminal)
[22:14:32] *** Quits: dotfelix (dotfelix@A85169A3.829DBEF3.40E092AA.IP) (Ping timeout)
[22:17:59] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[22:18:31] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Quit: Leaving)
[22:18:38] *** Quits: sigma (sigma@moz-55097A0B.range86-163.btcentralplus.com) (Ping timeout)
[22:19:07] *** Quits: doomlord_ (servitor@moz-99BE89EC.range86-184.btcentralplus.com) (Ping timeout)
[22:19:34] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[22:21:49] *** Joins: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP)
[22:21:49] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/inRTYA
[22:21:49] <ghrust> 13rust/06auto 149b588a9 15Tobias Bucher: Remove std::cast::transmute_immut_unsafe...
[22:21:49] <ghrust> 13rust/06auto 144dbc1f1 15bors: auto merge of #13015 : tbu-/rust/pr_remove_immut, r=alexcrichton...
[22:21:50] *** Parts: ghrust (ghrust@2E45E35D.6A2AE50.F3114085.IP) ()
[22:23:26] <nrc> nmatsakis: are you still around? I have a DST question
[22:23:42] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[22:23:45] *** Joins: Transformer (Transforme@moz-83357A1F.dyn.optonline.net)
[22:24:46] *** Joins: sigma (sigma@moz-55097A0B.range86-163.btcentralplus.com)
[22:25:29] *** Joins: doomlord_ (servitor@moz-99BE89EC.range86-184.btcentralplus.com)
[22:27:34] *** Parts: Transformer (Transforme@moz-83357A1F.dyn.optonline.net) ()
[22:28:10] *** Joins: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP)
[22:30:58] *** Joins: dotfelix (dotfelix@6110F704.AB3AC796.40E092AA.IP)
[22:36:23] *** Quits: dotfelix (dotfelix@6110F704.AB3AC796.40E092AA.IP) (Ping timeout)
[22:43:18] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[22:47:40] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[22:51:31] *** Quits: Jesse (jruderman@moz-62518563.mtv2.mozilla.com) (Quit: Jesse)
[22:51:35] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[22:53:27] <cmr> whoaaa
[22:53:29] <cmr> http://i.imgur.com/pdP2Cqe.png
[22:53:33] <cmr> the red one is --emit bc
[22:53:44] <cmr> are we really spending that much time in native codegen and linking?
[22:53:54] <strcat> yes
[22:54:37] *** Joins: Jesse (jruderman@moz-62518563.mtv2.mozilla.com)
[22:55:04] <cmr> when almost half of our compiletime is linking, I think we have a problem.
[22:55:28] <strcat> it's not linking
[22:55:31] <strcat> it's optimization + codegen
[22:55:43] <cmr> the bumpy bit after 80s is linking
[22:55:44] <strcat> cmr: we've known about this for a long time
[22:56:01] <strcat> cmr: *just* linking?
[22:56:03] <cmr> yes.
[22:56:13] <cmr> I'll have an --emit asm for comparison in a sec
[22:56:15] <strcat> time-passes says linking is taking that long?
[22:56:21] <strcat> cmr: are you still optimizing?
[22:56:29] <cmr> strcat: this is without opts
[22:56:44] <strcat> without optimizations that's not surprising, it's a ridiculous amount of code
[22:56:58] <strcat> I don't think any of that is surprising, and I don't think we can blame LLVM or the linker
[22:57:02] <cmr> http://i.imgur.com/seyIBsn.png is --emit asm
[22:57:03] <strcat> look at how much code it generates
[22:57:08] <cmr> I'll turn on -O
[22:57:19] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[22:57:22] <cmr> lol
[22:57:25] <cmr> it's 111M of assembl
[22:57:27] <cmr> y
[22:57:34] <cmr> that's pretty absurd
[22:58:06] <strcat> sure, and it's getting worse
[22:58:23] <strcat> more layers of abstraction/functions keep getting added to widely used generic code
[22:58:57] <strcat> rustc gets faster, and generates better code
[22:59:02] <strcat> and parts of the stdlib get optimized
[22:59:05] <strcat> but compilation gets slower
[22:59:14] *** Quits: bvssvni (Mibbit@moz-A47B6F8E.bb.online.no) (Quit: http://www.mibbit.com ajax IRC Client)
[23:00:20] <strcat> there's code (text) reuse and then there's code (instruction) reuse ;p
[23:00:21] *** Quits: NiccosSystem (NiccosSyst@AB1AFDE.FC7B0C35.A7597CB6.IP) (Ping timeout)
[23:00:29] <strcat> and we don't do much of the latter
[23:00:52] <cmr> is boost this bad too?
[23:00:56] <strcat> no
[23:01:04] <strcat> some boost libs are pretty bad
[23:01:13] * cmr tried using spirit once
[23:01:13] <strcat> but they do way higher level metaprogramming than we're doing
[23:01:35] <strcat> I don't really think rustc is much slower than clang
[23:01:39] <strcat> it's the library design
[23:01:50] *** Joins: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP)
[23:01:50] <ghrust> [13rust] 15bors 04force-pushed 06auto from 144dbc1f1 to 144ca51ae: 02http://git.io/N3iJvQ
[23:01:50] *** Parts: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP) ()
[23:01:52] *** Joins: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP)
[23:01:52] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/lYs_0g
[23:01:52] <ghrust> 13rust/06auto 149b588a9 15Tobias Bucher: Remove std::cast::transmute_immut_unsafe...
[23:01:52] <ghrust> 13rust/06auto 141a51ea7 15bors: auto merge of #13015 : tbu-/rust/pr_remove_immut, r=alexcrichton...
[23:01:52] *** Parts: ghrust (ghrust@5AC7F92B.6A2AE50.F3114085.IP) ()
[23:02:02] <strcat> we also don't have much in the way of metaprogramming
[23:02:10] *** Quits: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com) (Quit: pcwalton)
[23:02:10] <strcat> so we do things that generate code and expect it to be optimized ou
[23:02:12] <strcat> t
[23:02:21] <strcat> which it will be, but it takes a while
[23:02:40] <strcat> C++ and D do metaprogramming/specialization instead
[23:03:47] <sinistersnare> random question, where is the source for the rustc pretty printer? (rustc --pretty)
[23:03:48] *** Quits: brson (brson@moz-62518563.mtv2.mozilla.com) (Ping timeout)
[23:04:11] <ChrisMorgan> sinistersnare: various places, mostly http://static.rust-lang.org/doc/master/syntax/print/index.html
[23:04:33] <cmr> ChrisMorgan: what do you mean "various" places?
[23:04:42] <cmr> that's the only pretty printer used for --pretty
[23:04:48] <strcat> cmr: removing those old contains_managed things helped a lot
[23:04:55] <cmr> librustc has its own pretty printer that does some stuff
[23:04:55] <strcat> watch it all get added back + more for gc ;p
[23:05:01] <cmr> and librustdoc also has its own just for items
[23:05:08] <sinistersnare> oh libsyntax
[23:05:13] <sinistersnare> thanks!
[23:05:31] <cmr> (librustc's being for error messages)
[23:05:52] <strcat> cmr: would need a major culture shift where compile-time was viewed as important to fix it imo
[23:06:03] <ChrisMorgan> cmr: I was meaning the bits that activate it. The actual functinoality is syntax::print.
[23:06:28] <strcat> --opt-level=0/--opt-level=1 performance falls under the same thing
[23:06:40] *** Joins: brson (brson@moz-62518563.mtv2.mozilla.com)
[23:06:40] *** ChanServ sets mode: +qo brson brson
[23:06:54] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[23:07:41] *** Quits: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca) (Quit: canhtak)
[23:07:50] <cmr> strcat: do you have any concrete things that will make it better? do we just need to use less generic code?
[23:07:58] <brson> ok, creating a new ami for linux snaps
[23:08:49] <strcat> cmr: we are making function calls that are going through 5+ layers of calls to do things that are built-in primitives in C - can't expect it to compile quickly ;s
[23:09:17] *** Quits: Jesse (jruderman@moz-62518563.mtv2.mozilla.com) (Quit: Jesse)
[23:10:15] <strcat> cmr: in C++, people do complain about the compile-time of stuff like boost
[23:10:24] <strcat> lets say, boost::optional
[23:10:39] <strcat> we're using the same kind of abstractions upon abstractions but *everywhere*
[23:10:44] *** Quits: cgaebel (clark@moz-F9D89110.nyc.res.rr.com) (Client exited)
[23:11:13] *** Joins: cgaebel (clark@moz-F9D89110.nyc.res.rr.com)
[23:11:22] <strcat> maybe fiddling with rustc can make it 10% or 20% better
[23:11:33] <strcat> won't drastically change it, the IR really isn't *that* bad
[23:12:25] <strcat> cmr: use #[no_std] and autogenerate a bunch of rust/C functions and compare
[23:12:31] <strcat> I bet it's not significantly slower than clang
[23:13:01] <cmr> no, we're on par with clang for that, I've measured before
[23:13:17] <cmr> nmatsakis: r? https://github.com/mozilla/rust/pull/13001
[23:14:00] <strcat> a simple example happens with vector iterators
[23:14:07] <strcat> they have to do an if mem::size_of::<T>() == 0 check
[23:14:28] <strcat> in C++/D, that would be done with metaprogramming
[23:14:45] <strcat> you wouldn't actually generate the code to handle both ways for each type
[23:15:18] <strcat> we don't have SFINAE or static if so we do a lot of this
[23:15:36] <strcat> not the worst example since it's not a lot of code
[23:15:40] *** Quits: luz (lu.cy@moz-CD18B14B.customer.cdi.no) (Ping timeout)
[23:15:52] <strcat> kind of thing that really hurts -O0/-O1 perf though
[23:17:21] *** Joins: pcwalton (pcwalton@moz-24157589.mtv2.mozilla.com)
[23:17:21] *** ChanServ sets mode: +ao pcwalton pcwalton
[23:19:49] <strcat> cmr: ah and closures. that's a big issue
[23:20:15] <strcat> although the safe alternatives usually involve generating more code ;)
[23:20:34] <strcat> but I think a lot of these cases are going through inlining and *then* the closure has to be eliminated
[23:21:01] <cmr> pass ordering is hard, let's go shopping
[23:21:24] <strcat> not really about pass ordering
[23:21:28] <strcat> has to be inlined to be eliminated
[23:21:51] <strcat> unboxed closures would be faster to compile with small functions and slower with large functions
[23:21:59] *** Joins: luz (lu.cy@moz-CD18B14B.customer.cdi.no)
[23:22:22] *** Quits: dmsky (dmsky@moz-63A2E3E4.pppoe.spdop.ru) (Input/output error)
[23:22:23] <strcat> since with a small function, it's inlined anyway, so it's going to be a *lot* better if it's a static call from the start with no fn ptr
[23:22:31] <strcat> but with a large one, you'll be generating more code
[23:23:50] *** Joins: dmsky (dmsky@moz-63A2E3E4.pppoe.spdop.ru)
[23:25:12] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[23:25:38] *** Quits: dmsky (dmsky@moz-63A2E3E4.pppoe.spdop.ru) (Ping timeout)
[23:30:31] <brson> acrichto: linux-snap is the new ec2 buildslave for linux snapshots
[23:30:40] <brson> testing it now
[23:30:46] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[23:30:46] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Input/output error)
[23:30:55] *** Joins: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP)
[23:30:55] <ghrust> [13rust] 15brson merged 06master into 06snap-stage3: 02http://git.io/RQt6xQ
[23:30:55] *** Parts: ghrust (ghrust@88C0CBA2.6A2AE50.F3114085.IP) ()
[23:31:13] <acrichto> brson: you are a buildbot wizard
[23:31:15] *** Joins: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com)
[23:31:48] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[23:33:07] *** Quits: jensnockert (jensnocker@moz-9353D75F.e0f8471ae7fa.afb.bredband2.com) (Ping timeout)
[23:36:21] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[23:39:59] *** Joins: dotfelix (dotfelix@193B523.829DBEF3.40E092AA.IP)
[23:40:58] *** Joins: canhtak (canhtak@moz-2C382DC9.wl.t.ulaval.ca)
[23:41:55] *** Joins: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP)
[23:41:55] <ghrust> [13rust] 15cmr pushed 2 new commits to 06try: 02http://git.io/azwEgQ
[23:41:55] <ghrust> 13rust/06try 14708a959 15Corey Richardson: fix more fallout
[23:41:55] <ghrust> 13rust/06try 14b26a7f9 15Corey Richardson: how does that keep sneaking in
[23:41:55] *** Parts: ghrust (ghrust@23EC81EC.6A2AE50.F3114085.IP) ()
[23:45:20] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[23:47:16] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[23:52:57] <acrichto> brson: a linux builder just died during fetching the LLVM submodule
[23:53:01] <acrichto> which likely means that it's corrupt now
[23:53:17] *** Joins: dmsky (dmsky@moz-63A2E3E4.pppoe.spdop.ru)
[23:54:58] *** Quits: dmsky (dmsky@moz-63A2E3E4.pppoe.spdop.ru) (Ping timeout)
[23:55:35] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[23:55:41] <brson> i just terminated all the vm's anyway
[23:56:20] <brson> 60s seems like it may not be long enough to wait for the llvm submodule
[23:56:43] <brson> oh that's not 60s
[23:56:46] <brson> that's a lot of s
[23:56:47] *** Joins: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP)
[23:56:47] <ghrust> [13rust] 15bors 04force-pushed 06auto from 141a51ea7 to 144ca51ae: 02http://git.io/N3iJvQ
[23:56:47] *** Parts: ghrust (ghrust@7BEB6F9D.6A2AE50.F3114085.IP) ()
[23:56:48] *** Joins: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP)
[23:56:48] <ghrust> [13rust] 15bors pushed 2 new commits to 06auto: 02http://git.io/rcJaGA
[23:56:48] <ghrust> 13rust/06auto 149b588a9 15Tobias Bucher: Remove std::cast::transmute_immut_unsafe...
[23:56:48] <ghrust> 13rust/06auto 1413d3571 15bors: auto merge of #13015 : tbu-/rust/pr_remove_immut, r=alexcrichton...
[23:56:48] *** Parts: ghrust (ghrust@511FAEBD.6A2AE50.F3114085.IP) ()
[23:57:18] <acrichto> yeah :\
[23:59:12] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
