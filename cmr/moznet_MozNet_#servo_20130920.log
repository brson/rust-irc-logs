[00:00:15] <jdm> addEventListener is very close, I can feel it
[00:00:54] <jdm> this is going to be a pain in the ass to review
[00:12:29] <tikue_> i think i prefer match option { } to `for thing in option.iter()` 
[00:12:44] <tikue_> iterating over an option is never as intuitive when i'm reading code as when i'm writing it
[00:13:12] <cmr> I agree
[00:13:19] <cmr> Though I do like option.map
[00:15:53] <tikue_> cmr: yeah, though i don't like suppressing the output so much
[00:16:22] <cmr> Well I don't use it for supressing a warning, I use it when None is a legitimate value, not the result of something I want.
[00:16:31] <tikue_> the thing is that you lose a column with match {} 
[00:16:32] <tikue_> bah
[00:17:02] <tikue_> i wish there was an option.in or something
[00:17:07] <tikue_> that is the same as map but without a return value
[00:17:41] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[00:21:52] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[00:22:20] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[00:22:33] *** Quits: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP) (Quit: Lost terminal)
[00:26:22] *** Joins: CaseyBecking (CaseyBecki@moz-7EBF4B5D.lsanca.fios.verizon.net)
[00:30:32] *** Joins: CaseyBec_ (CaseyBecki@moz-7EBF4B5D.lsanca.fios.verizon.net)
[00:31:25] *** Joins: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP)
[00:31:25] <ghservo> [13servo] 15kmcallister opened issue #960: Graphics glitching with changing image size  02http://git.io/8ziKbQ
[00:31:25] *** Parts: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP) ()
[00:31:27] *** Quits: CaseyBecking (CaseyBecki@moz-7EBF4B5D.lsanca.fios.verizon.net) (Ping timeout)
[00:35:17] <pcwalton> kmc: cpu rendering patch rebased and r+'d
[00:35:19] <pcwalton> trying to land
[00:35:31] <tikue_> GL
[00:35:55] <kmc> nice
[00:36:10] <pcwalton> going to try to optimize layout a bit
[00:36:40] <tikue_> i fixed the profiler so that it doesn't activate when -p isn't passed in
[00:36:47] <kmc> excellent
[00:36:50] *** Joins: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP)
[00:36:50] <ghservo> 01[13servo01] 15bors-servo pushed 0 new commits to 06auto: 02http://git.io/j6vItQ
[00:36:50] *** Parts: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP) ()
[00:36:51] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[00:36:51] <ghservo> 01[13servo01] 15bors-servo pushed 4 new commits to 06auto: 02http://git.io/6xhh1g
[00:36:51] <ghservo> 13servo/06auto 1431b5792 15Patrick Walton: main: Implement pinch zooming on Mac
[00:36:51] <ghservo> 13servo/06auto 141918335 15Patrick Walton: main: Share textures, not draw targets, to reduce jank.
[00:36:51] <ghservo> 13servo/06auto 144b614ff 15Patrick Walton: gfx: Implement CPU painting with texture upload on the painting side.
[00:36:53] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[00:36:57] <tikue_> there are still two messages involved with each profiler() call though...
[00:39:07] *** Joins: annevk (annevk@D371F92B.DA6F7616.F83D3F11.IP)
[00:40:46] <pcwalton> tikue_: I'm going to try send_deferred on them
[00:42:31] <tikue_> pcwalton: what is the win there? it doesn't block on a response or anything right
[00:42:37] <tikue_> oh wait
[00:42:38] <tikue_> opposite right
[00:42:43] <tikue_> deferred means you don't context switch?
[00:42:46] <pcwalton> it doesn't switch to the task
[00:42:46] <pcwalton> yeah
[00:48:31] <pcwalton> yeah, OK, LLVM is not inlining the each_preorder_prune and friends correctly
[00:48:35] <pcwalton> I'll try to traitify it
[00:48:43] <pcwalton> so we can get monomorphization goodness
[00:48:48] <pcwalton> that oughta get us closer to WebKit
[00:48:57] <tikue_> kmc: any intuition on what the graphics glitching might be caused by? it seems pretty worrisome. some kind of race going on
[00:50:39] <kmc> no, I don't know
[00:50:40] <pcwalton> send_deferred drops profile time dramatically
[00:50:43] <kmc> can anyone else reproduce it?
[00:50:44] <pcwalton> <1%
[00:51:02] <pcwalton> sendin' a PR
[00:51:21] <tikue_> pcwalton: I figure my patch might make up the rest of that
[00:51:26] <tikue_> :)
[00:55:57] <pcwalton> I'm getting severe glitching with resizes
[01:04:14] *** Quits: dbaron (dbaron@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: 8403864 bytes have been tenured, next gc will be global.)
[01:05:53] <tikue_> pcwalton: with any kind of content ?
[01:05:57] <pcwalton> yeah
[01:06:01] <pcwalton> but that may be related to my cpu rendering patch?
[01:06:10] <pcwalton> also only with CPU rendering on
[01:06:13] <pcwalton> may not happen with GPU rendering
[01:06:16] <pcwalton> IOW I should verify
[01:07:35] *** Quits: silverroots (uid10556@moz-31ABA2C0.irccloud.com) (Ping timeout)
[01:07:35] *** Quits: arpitab_ (uid10516@moz-31ABA2C0.irccloud.com) (Ping timeout)
[01:09:00] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[01:10:41] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[01:37:48] *** Quits: fabrice (fabrice@moz-7B0110AD.mv.mozilla.com) (Quit: Leaving.)
[01:39:05] *** Quits: eatkinson (eatkinson@moz-E57448EF.airbears2.berkeley.edu) (Quit: eatkinson)
[01:42:32] <tikue_> how do i debug servo ICE's when compiling? gdb is little help
[01:43:03] <kmc> often they're caused by stale metadata; try a clean build
[01:43:05] *** Joins: dbaron (dbaron@moz-C566053C.dsl.dynamic.sonic.net)
[01:43:15] <kmc> otherwise I don't have a general solution
[01:43:57] <kmc> I've had them before from putting the wrong number of type arguments on something, for example
[01:44:06] <kmc> I had to look at my changes and guess what might cause a crash in the typechecker
[01:44:44] <tikue_> thanks kmc
[01:49:27] <tikue_> make clean didn't do the trick unfortunately
[01:49:58] <tikue_> is there a way to get a printout of everything it's compiling or something
[01:53:10] *** Joins: eatkinson (eatkinson@moz-E57448EF.airbears2.berkeley.edu)
[01:54:38] *** Joins: sankha93 (Instantbir@7061CD01.D6BD0D91.22D41759.IP)
[02:06:15] <jack> so does longcat always crash right now? only on linux?
[02:06:19] <jack> i am doing a demo tomorrow afternoon and i want to make sure i don't show something embarassing
[02:06:53] <tikue_> jack: it gets kinda funky on my macbook if you resize or stuff
[02:07:31] <tikue_> what command is Makefile running when it just says `compile: servo`? i'm trying to debug this ice
[02:08:15] *** Quits: brendan (brendaneic@45A3491F.A5FB4ABA.FE58E87C.IP) (Quit: brendan)
[02:09:15] *** Quits: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: My lid went down)
[02:12:38] *** Quits: eatkinson (eatkinson@moz-E57448EF.airbears2.berkeley.edu) (Quit: eatkinson)
[02:13:11] <pcwalton> I have some measurements of reflow
[02:13:17] <pcwalton> I went to http://en.wikipedia.org/wiki/Nero
[02:13:35] <pcwalton> with my devirtualization patches, I have:
[02:14:28] <pcwalton> 60.0% flow tree construction, 15.6% height assignment, 7.5% width bubbling, 6.8% display list construction, 5.8% flow tree *de*struction, 1.7% width assignment
[02:14:41] <pcwalton> total reflow time 293.0 ms
[02:15:47] <pcwalton> interestingly, damage propagation is 0.3% which is a traversal of the tree
[02:15:58] <pcwalton> indicating that traversal of the tree takes at most 0.3% (1 ms)
[02:16:03] <pcwalton> now it does anyway
[02:20:15] *** Quits: valenting (Thunderbir@F8AEB5FE.ECBF5C84.FB866788.IP) (Ping timeout)
[02:20:40] <tikue_> how do you make `make` as verbose as possible?
[02:22:00] <bz> pcwalton: interesting
[02:22:13] <bz> pcwalton: Does "flow tree construction" include style computation?
[02:22:22] <pcwalton> I'm going to try to optimize traversals some more
[02:22:29] <pcwalton> the asm says they are not as optimized as they could be at the moment
[02:22:34] <pcwalton> this is just some quick numbers
[02:22:59] <bz> pcwalton: Because in Gecko usually frame construction is a bit cheaper than this on a percentage basis, even including style computations...
[02:23:05] <pcwalton> bz: it includes shaping
[02:23:12] <bz> pcwalton: but it might be that your reflow is way faster than Gecko's (not unlikely)
[02:23:15] <pcwalton> which we basically have no caches for
[02:23:17] <bz> pcwalton: ah, I see
[02:23:23] <bz> pcwalton: gotcha
[02:23:41] <bz> pcwalton: I'm curious how other engines compare on your hardware on that page, btw
[02:23:45] <pcwalton> I'm going to try to microoptimize and start benchmarking against Gecko and WK
[02:23:49] <bz> pcwalton: just to get a ballpark feel
[02:23:54] <pcwalton> yup, that's my goal for tomorrow :)
[02:23:57] <bz> ok
[02:24:00] <pcwalton> I want to cut shaping out for my first test
[02:24:03] <bz> Sweet.  ;)
[02:24:03] <pcwalton> no text, just blocks
[02:24:13] <pcwalton> there should be no reason we are not competitive on that
[02:24:17] *** Joins: valenting (Thunderbir@C6866972.77435D89.FB866788.IP)
[02:24:20] <pcwalton> once I microoptimize a bit
[02:28:12] *** Quits: pcwalton (pcwalton@moz-7B0110AD.mv.mozilla.com) (Quit: pcwalton)
[02:33:47] *** Joins: mihneadb (mihneadb@moz-CFFC9266.residential.rdsnet.ro)
[02:35:31] *** Quits: mihneadb (mihneadb@moz-CFFC9266.residential.rdsnet.ro) (Ping timeout)
[02:39:23] *** Quits: sankha93 (Instantbir@7061CD01.D6BD0D91.22D41759.IP) (Quit: Gone to save the world!)
[02:40:04] *** Joins: fabrice (fabrice@moz-94F028C6.hsd1.ca.comcast.net)
[02:40:18] *** Quits: CaseyBec_ (CaseyBecki@moz-7EBF4B5D.lsanca.fios.verizon.net) (Client exited)
[02:42:11] *** Quits: zz_kimundi (kimundi@moz-2B3B2A0D.dip0.t-ipconnect.de) (Ping timeout)
[02:46:02] *** Joins: zz_kimundi (kimundi@moz-C673AE05.dip0.t-ipconnect.de)
[02:46:04] *** zz_kimundi is now known as kimundi
[02:50:37] *** Quits: annevk (annevk@D371F92B.DA6F7616.F83D3F11.IP) (Input/output error)
[02:51:03] *** Joins: annevk (annevk@D371F92B.DA6F7616.F83D3F11.IP)
[02:52:49] *** Quits: annevk (annevk@D371F92B.DA6F7616.F83D3F11.IP) (Ping timeout)
[02:53:18] <tikue_> anyone have a clue what could be causing this? task <unnamed> failed at 'assertion failed: `(left == right) && (right == left)` (left: `13`, right: `0`)', /Users/tkuehn/servo/src/compiler/rust/src/librustc/middle/trans/callee.rs:385
[02:54:59] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[02:55:08] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[02:58:14] *** Joins: CaseyBecking (CaseyBecki@moz-7EBF4B5D.lsanca.fios.verizon.net)
[03:00:22] <tikue_>         assert_eq!(def_id.crate, ast::LOCAL_CRATE);
[03:00:28] <tikue_> what is this?
[03:01:13] <jack> tikue: V=1 make
[03:01:16] <jack> or VERBOSE=1 make
[03:01:18] <jack> something like that.
[03:02:08] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[03:02:39] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[03:02:45] <tikue_> jack: ahhhh perfect! exactly what i was looking for
[03:03:31] <jack> test_sandboxed_iframe doesn't appear to work anymore.
[03:03:37] <jack> oh dear :(
[03:03:43] <jack> it was just black until the computation finished.
[03:04:00] <tikue_> jack: that's what it's looked like for me every time i've tried it. i just assumed it wasn't finished yet
[03:04:09] <tikue_> going back at least a week and a half i think
[03:04:31] <jack> we saw it working in MTV, so i dunno if something broke it or what.
[03:04:59] <jack> kmc, lbergstrom, pcwalton: do any of you have this working?
[03:05:41] <jack> oh, you have to load test_sandboxed.
[03:05:50] <jack> the _iframe is the inner content
[03:05:59] <tikue_> ahh
[03:08:53] *** Joins: arpitab_ (uid10516@moz-31ABA2C0.irccloud.com)
[03:09:38] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[03:12:47] *** Joins: silverroots (uid10556@moz-31ABA2C0.irccloud.com)
[03:15:16] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[03:15:28] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[03:23:54] *** Quits: arpitab_ (uid10516@moz-31ABA2C0.irccloud.com) (Ping timeout)
[03:24:27] *** Quits: silverroots (uid10556@moz-31ABA2C0.irccloud.com) (Ping timeout)
[03:26:01] <tikue_> i identified where the ICE is coming from but it makes no sense to me
[03:26:06] <tikue_> someone wanna look at this gist?
[03:26:25] <tikue_> https://gist.github.com/tikue/65d3ae01bc2f3a3ca946
[03:41:13] <jack> http://imgur.com/oPIeUdI
[03:49:33] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[03:50:01] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[03:51:00] <tikue_> jack: nice background
[03:51:17] <tikue_> https://gist.github.com/tikue/65d3ae01bc2f3a3ca946
[03:51:26] <tikue_> the ICE is caused by these 6 lines. what could it be i wonder?
[03:54:44] *** Quits: CaseyBecking (CaseyBecki@moz-7EBF4B5D.lsanca.fios.verizon.net) (Client exited)
[03:55:04] *** Quits: valenting (Thunderbir@C6866972.77435D89.FB866788.IP) (Ping timeout)
[03:57:15] <dbaupp> tikue_: is it cross crate?
[03:57:55] <tikue_> dbaupp: are you asking if it's used in multiple crates?
[03:58:28] <dbaupp> tikue_: well, generic newtype structs don't work cross-crate (i.e. using struct Foo<T>(T) in another crate ICEs)
[03:58:43] <tikue_> dbaupp: oh, then yes. :) that's why
[03:59:37] <dbaupp> using RenderChan<T> { chan: SharedChan<Chan<T>> } should be ok
[04:02:10] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[04:02:42] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[04:02:48] <tikue_> dbaupp: any idea what it'll take to fix this?
[04:04:28] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[04:09:13] *** Joins: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP)
[04:09:13] <ghservo> 01[13servo01] 15bors-servo 04force-pushed 06auto from 14415617f to 140ca4c19: 02http://git.io/c8GovQ
[04:09:13] *** Parts: ghservo (ghservo@2EE61FCC.6A2AE50.F3114085.IP) ()
[04:09:16] *** Joins: ghservo (ghservo@79968228.6A2AE50.F3114085.IP)
[04:09:16] <ghservo> 01[13servo01] 15bors-servo pushed 3 new commits to 06auto: 02http://git.io/Oo8jiA
[04:09:16] <ghservo> 13servo/06auto 142dbd065 15Luis de Bethencourt: Rename the element field of the DOM Node hierarchy...
[04:09:16] <ghservo> 13servo/06auto 14cfd726f 15Luis de Bethencourt: Rename the node field of the DOM node hierarchy...
[04:09:17] <ghservo> 13servo/06auto 14dafb2c3 15bors-servo: auto merge of #959 : luisbg/servo/master, r=jdm...
[04:09:19] *** Parts: ghservo (ghservo@79968228.6A2AE50.F3114085.IP) ()
[04:13:33] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[04:14:08] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[04:17:26] <dbaupp> tikue_: the first step would be to stop dropping out :P
[04:17:38] <tikue_> dbaupp: idk what's wrong with my internet :(
[04:17:49] <dbaupp> but, just using a normal non-newtype struct would be a work around
[04:17:49] <tikue_> college campuses >_<
[04:17:57] * dbaupp knows the pain
[04:17:57] <tikue_> dbaupp: yes, that's what i'm currently doing
[04:18:19] <dbaupp> https://github.com/mozilla/rust/issues/9155 is (an) issue btw
[04:19:37] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[04:20:42] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[04:23:14] *** Joins: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP)
[04:23:14] <ghservo> [13servo] 15tikue opened pull request #961: Fix profiler usage when not flagged (06master...06master)  02http://git.io/ebpbpg
[04:23:14] *** Parts: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP) ()
[04:34:11] *** Joins: ghservo (ghservo@C8693FCB.6A2AE50.F3114085.IP)
[04:34:11] <ghservo> 01[13servo01] 15bors-servo merged 06auto into 06master: 02http://git.io/Oo8jiA
[04:34:11] *** Parts: ghservo (ghservo@C8693FCB.6A2AE50.F3114085.IP) ()
[04:39:15] <tikue_> dbaupp: ah thank you for the issue
[04:42:21] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[04:48:26] <jack> does filmstrip.html not work in an iframe in firefox?
[04:48:27] <jack> that seems odd
[04:50:02] <jack> hmm. seem the sandbox prevents it from running
[04:50:48] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[04:52:33] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[04:53:32] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[04:56:46] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[04:57:16] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[04:57:54] *** Joins: jdm (jdm@92FB48CA.8B5E9DF.9A8C35B4.IP)
[04:57:54] *** ChanServ sets mode: +o jdm
[04:58:10] <jdm> jack: the sandbox needs to have allow-scripts
[04:59:03] *** Quits: dzbarsky (Adium@moz-95579A41.wlan.wireless-resnet.upenn.edu) (Quit: Leaving.)
[04:59:53] <jack> it does.
[05:00:03] <jack> firefox and chrome both refuse to excute the js
[05:00:09] <jack> but if i remove sandbox it works.
[05:00:31] <jdm> um
[05:01:06] <jdm> and yet test_sandboxed.html executed scripts fine?
[05:01:22] <jack> http://metajack.im/tmp/demo.html
[05:01:26] <jack> does that work for you?
[05:02:16] <jdm> jack: not frame two
[05:02:28] <jdm> also Image corrupt or truncated: http://metajack.im/tmp/rust-45.png
[05:02:35] <jack> oh.
[05:02:41] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:02:44] <jack> so if you have those same files at file:/// they don't run at all.
[05:02:48] <jdm> and demo-two.html has no source
[05:03:07] <jdm> I would not be too surprised if sandboxing and file:// interacted poorly
[05:03:13] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:03:33] <jack> yes, demo-two is empty
[05:03:56] <jack> damnit. there's no wifi at hte conference. so i guess i will have to cheat and make them not sandboxed
[05:04:06] <jack> oh. i guess i can install a local nginx.
[05:04:13] <jdm> jack: python -m SimpleHTTPServer
[05:04:56] <jack> better than this ;) https://github.com/metajack/tape
[05:04:58] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:05:05] <jack> i wrote that a long time ago but it also does proxying 
[05:05:17] <jdm> oh my
[05:05:42] <jack> that works perfectly :)
[05:05:42] <jack> yay
[05:05:56] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:06:10] <jdm> jack: you could event have cross-origin by running two python servers on different ports from the same dir :)
[05:07:37] <jack> reload the demo
[05:07:43] <jack> matrix mult is there now
[05:07:49] <jack> going to make that prettier.
[05:08:05] <jack> btw, servo is like 10x slower than firefox on that JS
[05:08:32] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:08:43] <jdm> yeah, I noticed that
[05:09:03] <jdm> granted, I don't think we have the baseline jit
[05:09:20] <jdm> and it's straight JS execution; no DOM stuff
[05:09:39] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[05:10:01] <jdm> nice, look at it go
[05:10:56] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:11:22] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[05:11:28] <jack> does negative array indexing work in JS?
[05:11:44] <tikue_> jdm: that's clever
[05:12:16] <jdm> jack: a[-1] == undefined in my very simple test
[05:12:49] <jdm> jack: and if I do a["-1"] = "bar", then a[-1] == "bar"
[05:13:03] <jdm> which is... interesting
[05:13:23] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:14:00] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:16:12] *** Quits: dbaron (dbaron@moz-C566053C.dsl.dynamic.sonic.net) (Quit: 8403864 bytes have been tenured, next gc will be global.)
[05:16:31] <jack> oh no
[05:16:38] <jack> servo can't resolve localhost
[05:16:46] <jack> GET http://localhost/demo.html HTTP/1.0" 404 -
[05:16:53] <jack> or rather, it resolves, then sends the wrong url :)
[05:17:09] <jack> i like how it omits the port
[05:17:13] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:17:55] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:18:02] <jack> and adding more logging crashes it now
[05:18:09] <jack> crahses rust i should say
[05:19:39] <jdm> heh
[05:21:28] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:22:14] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:22:17] <bz> jack: define "work"?
[05:22:36] <bz> jack: [][-1] works just like []["foopy"]
[05:23:16] *** Joins: arpitab_ (uid10516@moz-31ABA2C0.irccloud.com)
[05:23:29] <bz> It doesn't work like in Python, say
[05:25:00] <jack> bz: like in python is what i wanted.
[05:25:37] <jack> odd. if i setTimeout(..., lowInteger) it won't run layout in gecko
[05:25:44] <jack> if it's 500-1000 then it will run it.
[05:26:39] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:27:30] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:27:47] <jack> $ ./servo ./demo.html 
[05:27:48] <jack> ~"\"error reading buffer\""
[05:27:48] <jack> ~"Is a directory"
[05:27:49] <jack>  
[05:27:53] <jack> that's a new one
[05:27:55] *** Joins: silverroots (uid10556@moz-31ABA2C0.irccloud.com)
[05:28:57] <jack> oh man. dont' try to surf in the same firefox that runs that demo :)
[05:29:15] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:30:40] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:31:05] <jack> ah, that's <img src="">
[05:31:50] <jdm> heh
[05:33:15] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:34:20] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:35:01] *** Quits: lbergstrom (Adium@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net) (Ping timeout)
[05:35:26] <jack> crap. the iframe glitches in servo :(
[05:35:33] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[05:35:34] <jack> i wonder what is causing that.
[05:36:31] <jack> tikue: you up?
[05:36:56] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:37:08] *** Joins: lbergstrom (Adium@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net)
[05:37:48] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:38:18] <jdm> <jack> tikue: you up?
[05:38:26] <tikue_> jdm: yessir
[05:38:33] <tikue_> wait
[05:38:36] <tikue_> what is <jack>
[05:38:37] <jdm> jack: ^
[05:38:51] <jdm> it's a message from jack
[05:38:57] <tikue_> ah, yes I am up, jack
[05:39:13] <jack> tikue: try http://metajack.im/tmp/demo.html in servo
[05:39:26] <jack> see if you get any visual glitches
[05:39:43] <jack> it looks liek it's painting the iframes all over the place.
[05:40:36] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:40:39] <jdm> jack: no glitches here
[05:40:50] <jack> and it hangs sometimes.
[05:41:07] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:41:08] <jdm> jack: if I zoom in and move around then I start seeing the glitching
[05:41:16] <tikue_> my internet is being very spotty
[05:41:32] <jdm> oh man, it's going crazy
[05:41:35] <jack> i never got it until a few mintues ago
[05:41:41] <jack> now it always happens
[05:41:42] <jdm> however, default zoom level works fine
[05:41:50] <jdm> maybe you pinchzoomed?
[05:42:02] <jack> it doesn't remember zoom levels
[05:42:09] <jack> it happens every time i start
[05:42:33] <jdm> huh
[05:42:55] <jack> i need to find a workaround :(
[05:44:01] <jack> it also wont' print the js
[05:44:07] <jack> i'm not sure if that's related or not
[05:44:10] <jdm> print the js?
[05:44:45] <jack> print the messages dynamically
[05:45:04] <jack> or at elast i don't see the text . but i do see text if i just write foo there staticly
[05:45:12] <jdm> I was seeing text on mine
[05:46:11] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:46:38] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:46:48] <jack> ok. that seems to work now.
[05:46:50] <jack> still glitches though
[05:48:44] <jack> if i call run it won't print. if i leave off run it will.
[05:48:51] <jdm> oof
[05:49:24] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[05:49:41] <tikue_> gah
[05:50:28] <jack> it seems to be the image rotation that messes with it.
[05:50:56] <jack> if i hide that i don't get glitches.
[05:51:13] <jack> if i set both iframes to demo-one, then glitches
[05:51:29] <jdm> presumably longcat has the same effect, since they're doing the same thing
[05:52:22] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:52:27] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[05:54:42] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[05:56:22] <jack> wow. it seems unable to multiple the matrices anymore
[05:56:30] <jack> all i did was delete some code
[05:56:33] <jdm> wat
[05:56:37] <jack> it just crashes with a bus error
[05:56:54] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[05:57:12] <jack> http://metajack.im/tmp/demo-two.html is what i'm using
[05:57:32] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[05:57:35] <dbaupp> is it infinite recursion?
[05:58:25] <jack> i guess. but no idea why
[05:58:58] <jack> jdm: did i introduce some weird bug?
[05:59:27] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[05:59:32] <jdm> I can't find it yet, but I can reproduce weird behaviour running that page in servo
[06:00:08] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[06:01:19] <jdm> jack: it doesn't even look like you changed anything in it; what does git diff show?
[06:01:39] <jack> #3  js::GetPropertyOperation (cx=<optimized out>, pc=<optimized out>, lval=..., vp=...) at /Users/jack/src/servo-demo/src/support/spidermonkey/mozjs/js/src/jsinterpinlines.h:267
[06:01:40] <jack> #4  0x000000010164a93e in js::Interpret (cx=0x10233fb20, entryFrame=<optimized out>, interpMode=<error reading variable: Cannot access memory at address 0x2>)
[06:02:20] <jack> it has somethign to do with teh timers it appears.
[06:02:33] <jdm> correct
[06:02:40] * jdm wishes he had a debug spidermonkey build set up
[06:03:38] <jack> jdm: here's the diff https://gist.github.com/metajack/6633838
[06:04:29] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[06:04:50] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[06:05:51] <jdm> boo, mxr doesn't index our submodules
[06:07:03] <jack> why did it work fine before and always fails now? that's what i don't get.
[06:07:29] <jdm> could be a gc hazard
[06:07:42] <jdm> I mean, that's pretty likely since the stuff gdb is showing me is bogus
[06:08:24] <jack> i removed setTimeout and it still buserrors
[06:09:25] <jack> if i remove the logging stuff it works.
[06:10:18] <jdm> bisect logging? :/
[06:11:21] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Ping timeout)
[06:11:36] <jack> i i call log() inside setTimeout, it crashes.
[06:11:41] <jack> if it's outside, it works.
[06:11:53] <jack> so appears to be an appendChild or something bug
[06:12:20] <jdm> boo
[06:12:27] *** Joins: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP)
[06:12:45] <jack> that is also what's cuasing the glitches.
[06:12:59] <jack> without the logging inside setTiemout, no glitches.
[06:13:17] <jack> wait, that's not true.
[06:13:24] <jack> glitches come back with flimstrip
[06:13:28] <jack> sigh
[06:14:26] <jack> jdm: your blocking on layout made it in right?
[06:14:34] <jdm> yes
[06:14:51] <jdm> oh, so, um.
[06:15:03] <jdm> all the finalizers for the DOM nodes on the page run
[06:15:06] <jdm> and then we crash, obviously
[06:15:09] <jdm> that would be problematic
[06:15:33] <jdm> jack: here's your workaround: comment out the bit in the codegen that makes finalizers :)
[06:15:38] <jack> iframes not getting traced or somethign?
[06:15:50] <jdm> jack: I'm seeing this outside of an iframe
[06:15:54] <jdm> just running the framed page
[06:16:26] <jack> got a line number of codegenrust.py?
[06:17:16] <jdm> jack: def finalizeHook
[06:17:30] <jdm> just comment out the let _ line
[06:17:41] <jdm> that might be enough to pull through
[06:18:00] <jdm> for some reason we're not tracing through the document
[06:18:35] <jack> trying now
[06:19:26] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[06:20:14] <tikue_> what is tracing
[06:20:56] <jdm> tikue_: marking JS values reachable from some arbitrary native code
[06:21:21] <tikue_> ah ok. 
[06:21:41] <jack> tikue: the result of not doing it is that the JS GC frees the rust structs :)
[06:22:42] <tikue_> ohh i get it
[06:22:46] * tikue_ gets it
[06:23:03] <jack> jdm: that did not help.
[06:23:07] <jdm> hmm
[06:24:39] <jack> tikue: have you tried confirming those glitches with demo-one.html?
[06:24:55] <jack> er, with demo.html but with both set to demo-one.htlm
[06:25:09] <jack> or maybe they are related...
[06:25:43] <jdm> grr, I can trigger it just throwing a gc() in the main script execution
[06:26:39] <tikue_> jack: i'll try now
[06:26:51] <jack> ~"\"tracing window\""
[06:26:52] <jack> ~"\"tracing document\""
[06:26:52] <jack> ~"HTMLHtmlElement finalize: 0x7fbf43c3cf70"
[06:28:01] <jdm> exactly
[06:28:10] <jdm> we should see a message from Document::trace
[06:28:14] <tikue_> jack: what do you mean "both set to demo-one" ? 
[06:28:16] <jdm> but it doesn't apear to run
[06:29:05] <jack> tikue: edit dmeo.html and change both iframe srcs to demo-one.html
[06:29:22] <tikue_> jack: what directory? i don't see demon-one.html
[06:29:37] <tikue_> and I don't see iframes in demo.html either?
[06:30:29] * jdm starts printing pointers
[06:30:34] <jack> tikue: http://metajack.im/tmp/demo.tar.gz
[06:30:51] <jack> jdm: seems like document.root must be invalid.
[06:31:00] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[06:31:02] <jdm> jack: no, because we don't even run the trace function in dociument
[06:31:08] <jack> it runs here.
[06:31:09] <jdm> or I would see a message saying it was tracing the root
[06:31:12] <jack> but it never getst to root
[06:31:19] <jack> oh i see what you mean
[06:31:22] <jdm>                 debug!("tracing root node");
[06:31:41] <jack> window is called but not document's trace
[06:32:07] <jdm> yep
[06:32:57] *** kimundi is now known as zz_kimundi
[06:34:34] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[06:35:10] *** bz is now known as bz_sleep
[06:35:13] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[06:35:26] <tikue_> jack: yes I see the same glitches. :(
[06:36:19] <jack> jdm: did the Box<T> stuff cause this?
[06:36:41] <jack> we moved from rust_box<T> to Box<T>
[06:37:09] <jdm> I would be surprised, but it's probably worth bisecting back to a revision that should be well-tested
[06:37:48] <jdm> why is my debug code not executing :<
[06:38:31] * jack rebuilding before Box<T> and DOMString changes.
[06:38:42] <jdm> there we go
[06:39:57] *** zz_kimundi is now known as kimundi
[06:39:58] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[06:40:00] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[06:40:16] <tikue_> i'll be back in a bit. gotta go home
[06:40:20] *** Quits: tikue_ (tkuehn@787D2D52.F3E8A984.689607DE.IP) (Quit: tikue_)
[06:43:06] <jack> jdm: wasn't keegan's changes.
[06:43:18] <jdm> too much to hope for
[06:45:04] <jdm> ~"doc wrapper is 0x7fffee54a040"
[06:45:09] <jdm> ~"tracing document 0x7fffee54a040"
[06:45:18] * jdm is baffled
[06:45:31] <jdm> I have seen this work correctly in the past
[06:45:42] <jack> it's not supposed to be the same?
[06:45:49] <jdm> it is supposed to be the same
[06:45:53] <jdm> that is a JSObject pointer
[06:46:04] <jdm> and we tell the tracer to trace it as an object
[06:46:58] <jdm> oh, wait
[06:47:05] <jdm> I wonder if it messes up because it's a proxy
[06:51:19] <jdm> jack: so, quick fix: re-add the explicit rooting that I took out in my gc changes commit
[06:51:57] <jdm> jack: https://github.com/mozilla/servo/commit/636c30affeec0578a9ecb36adf9b6ec702d56bb9#L3L92
[06:53:02] <jdm> I'm not sure how this snuck through, but more effort is definitely needed to get the document trace hook actually executing
[06:55:24] <jack> rebuilding now
[07:01:02] <jdm> I dun get it
[07:01:11] <jdm> this seems like a fundamental issue with the proxy API
[07:01:38] <jack> ok. rooting it works.
[07:01:42] <jdm> all the trace handler does is mark three slots; there's nowhere for us to run arbitrary tracing
[07:01:57] <jdm> jack: any chance that fixes the glitches too :)
[07:02:46] <jack> jdm: ha!
[07:03:20] <jdm> I mean, if layout was reading stuff from freed memory...
[07:03:31] <jack> at least i'm down to a single issue
[07:04:35] * jack goes to find where the iframes get their positions
[07:06:44] *** kimundi is now known as zz_kimundi
[07:07:57] *** zz_kimundi is now known as kimundi
[07:11:08] <jack> tikue: this is  afun one
[07:11:18] <jack>             // TODO(tkuehn): In fact, this kind of message might be provably
[07:11:19] <jack>             // impossible to occur.
[07:11:19] <jack>  
[07:11:22] <jack> that's what's triggering every repaint ;)
[07:11:25] <jdm> haha
[07:15:06] <jack> pipelien ones seems to call pain 3x per iteration 
[07:15:29] <jack> that seems odd
[07:15:32] *** Joins: tikue_ (tkuehn@moz-FEADCD38.hsd1.pa.comcast.net)
[07:15:44] <tikue_> how are you guys doing
[07:15:50] <jack> RUST_LOG=servo::constellation ./servo demo.html
[07:15:58] <jack> and with setTimeout in demo-one.html set to 5000
[07:16:19] <jack> you can see it repeating for some reason even though only one source changes
[07:17:56] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[07:20:22] <jack> tikue: well demo-two is fixed. but this iframe paint glitch is still there.
[07:20:47] <tikue_> jack: which is demo two?
[07:20:50] <jack> did you see backlog where you're possibly provably impossible message is triggering a lot? :)
[07:21:07] <jack> demo-two.html is the matrix multiply
[07:21:16] <jack> demo-one.html is the rotating rust logo
[07:21:22] <jack> demo.html + demo-one.html is still broken.
[07:21:41] <jack> switching img.src forces a relayout and that seems to mess up the iframe.
[07:21:54] <tikue_> jack: i've known about that for a while, just never changed the comment :P was it causing problems?
[07:22:39] <jack> i dunno if that's the problem. i was just looking at the code and saw that. every img.src change causes that early return path to be taken.
[07:22:53] <jack> ~"Renderer msg::constellation_msg::PipelineId(2u) ready to send paint msg"
[07:22:54] <jack> ~"\"early return\""
[07:22:54] <jack> ~"Renderer msg::constellation_msg::PipelineId(1u) ready to send paint msg"
[07:22:55] <jack> ~"\"early return\""
[07:22:57] <jack> ~"Renderer msg::constellation_msg::PipelineId(1u) ready to send paint msg"
[07:23:00] <jack> ~"\"early return\""
[07:23:04] <jack> ~"Renderer msg::constellation_msg::PipelineId(1u) ready to send paint msg"
[07:23:07] <jack> ~"\"early return\""
[07:23:07] <jack> ~"Renderer msg::constellation_msg::PipelineId(1u) ready to send paint msg"
[07:23:10] <jack> ~"\"early return\""
[07:23:14] <jack>  
[07:23:17] <jack> that's for a single img.src change.
[07:24:01] <tikue_> the alternative wasn't something i wanted to swallow
[07:24:11] <tikue_> having another point of coordination with permissions
[07:24:27] <jack> wat?
[07:24:28] <jack> ~"navigating to @mut constellation::FrameTree{pipeline: @mut pipeline::Pipeline{id:
[07:24:36] <jack> why is it navigating
[07:24:51] <tikue_> jack: what demo is that
[07:25:02] <jack> the demo i sent you earlier
[07:25:10] <jack> i'm just running ./servo demo.html
[07:25:10] <tikue_> demo.html?
[07:25:42] <jack> with RUST_LOG=servo::constellation and upping the timeout in demo-one.html so that i can see a single img.src update
[07:25:47] <tikue_> how did you get it to navigate ??
[07:25:56] <jack> i didn't do anything to navigate.
[07:26:06] <jack> it apears changin img.src causes a navigation message?
[07:26:27] <tikue_> jack: if it loads an image 
[07:26:30] <tikue_> or rather
[07:26:33] <tikue_> if it sends a load message
[07:26:48] <jack> but you only navigate on iframe and page loads right?
[07:26:55] <jack> is there just a bug triggering this?
[07:27:06] <tikue_> i could believe that
[07:27:10] * tikue_ looks
[07:27:22] <tikue_> navigation happens in grant_paint_permission
[07:27:40] <tikue_> it checks the navigation type to determine if it should load or not
[07:27:49] <tikue_> perhaps the navigation type isn't being updated correctly
[07:27:56] <tikue_> or perhaps that logic is wrong
[07:29:35] <tikue_> hmmm
[07:29:40] <jack> where does that happen?
[07:30:18] <tikue_> where does what happen?
[07:30:37] <jack> i set a img src attr. 
[07:30:42] <jack> how does that generate a navigation?
[07:31:03] <tikue_> jack: what is involved with setting an img src attr?
[07:31:08] <tikue_> does the script send messages?
[07:31:53] <jack> it sends to image_cache
[07:32:31] <tikue_> where does that happen?
[07:32:35] <tikue_> in script_task?
[07:34:19] <jack> htmlimagelement.rs
[07:34:31] <jack> in AfterSetAttr which calls update_image
[07:35:06] <jack> so setting src forces a relayout
[07:35:13] <jack> os it's probably something to do with that.
[07:35:34] <tikue_> reflow triggers renderer ready
[07:35:49] <tikue_> i think that
[07:35:59] <jack> and it shouldn't?
[07:36:03] <tikue_> maybe the script should send those renderer ready messages to the renderer itself or something
[07:36:07] <tikue_> jack: it's not that it shouldn't
[07:36:11] <tikue_> it's that the script has no way to know
[07:36:18] <tikue_> so it _has_ to right now
[07:36:53] <jack> is ther ea quick workaround?
[07:37:57] <tikue_> thinking
[07:38:22] <tikue_> don't have the script send renderer ready
[07:38:31] <tikue_> have the renderer send it if it is ready and doesn't have permission
[07:38:44] <tikue_> it just needs to be initialized with a handle to the constellation
[07:38:48] <tikue_> that should work
[07:38:53] <tikue_> let me throw it together
[07:38:54] <tikue_> and see 
[07:41:37] *** Joins: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP)
[07:41:37] <ghservo> [13servo] 15jdm opened issue #962: Figure out how to use trace hooks in conjunction with proxy objects  02http://git.io/zABgpA
[07:41:37] *** Parts: ghservo (ghservo@24260B07.6A2AE50.F3114085.IP) ()
[07:42:54] *** kimundi is now known as zz_kimundi
[07:44:52] <tikue_> compiling now
[07:46:10] <tikue_> is that actually causing issues i wonder? i would have thought it'd be a no-op basically
[07:46:12] <tikue_> but idk
[07:46:47] <jack> you don't think it's that?
[07:46:58] <tikue_> i hope it is that
[07:47:01] <tikue_> but i can't say
[07:48:11] <tikue_> (until it compiles and i run it)
[07:56:41] <jack> tikue any luck?
[07:56:52] <tikue_> jack: had to recompile, still waiting
[07:57:13] <tikue_> jack: yes
[07:57:22] <tikue_> jack: yes you're in luck
[07:57:36] <tikue_> eventually i get bus error: 10
[07:57:39] <tikue_> but until that happens it works
[07:58:26] <tikue_> jack: is bus error normal
[07:59:02] <jdm> that's probably the GC problem
[07:59:07] <tikue_> ok
[07:59:08] <jdm> therefore, with our powers combined
[07:59:09] <tikue_> i have a PR open
[07:59:39] <tikue_> unfortunately i *already* had a pr open
[07:59:48] <jack> yes
[07:59:48] <jack> that' the demo-two bug i have a local aptch for
[07:59:50] <jack> send me a diff?
[07:59:52] <jack> or is this smoethign that hsould go into servo?
[08:00:16] <tikue_> by somethign you mean my other pr from earlier?
[08:00:25] <tikue_> it fixes the profiler always being active even when unused
[08:00:32] <tikue_> and cleans up some other code for readability
[08:01:07] <tikue_> longcat works for me now
[08:01:15] <tikue_> in an iframe too
[08:01:19] <jdm> niice
[08:01:39] <jack> a diff is fine. you can do the real PR later :)
[08:01:43] <jack> will your current diff not apply without that?
[08:01:44] *** Joins: victorporof (victorporo@D5C23157.DA9DCE7D.79933D60.IP)
[08:01:52] <tikue_> jack: i think it should work, one sec
[08:02:20] <tikue_> this commit jack https://github.com/tikue/servo/commit/b434ddf6d5a1aab6ba9a862a1e4730d8b2d67114
[08:10:20] <tikue_> you guys having the same luck as me?
[08:12:17] <jack> thankfully, yes
[08:12:44] <jack> segfault on exit, but i can live iwth that.
[08:12:58] <tikue_> is that new?
[08:13:48] <jack> i didn't see it earlier.
[08:13:57] <tikue_> weird
[08:14:06] <jack> thanks jdm and tikue. you have saved my demo!
[08:14:12] <jdm> woo!
[08:14:18] <tikue_> jack: sorry for the scare D:
[08:15:02] <tikue_> jack: the rust logo stops rotating for me nondeterministically
[08:16:05] <jack> seems to happen on less than half the runs.
[08:16:09] <jack> not sure what i can do about that.
[08:16:26] <jack> it's 3:15am and i need to sleep.
[08:16:26] *** zz_kimundi is now known as kimundi
[08:16:36] <jack> thanks again guys.
[08:16:43] <tikue_> no problem. good luck
[08:17:04] <tikue_> jack: who is your demo for?
[08:17:46] <jdm> strange loop
[08:17:53] <tikue_> ahh right right
[08:18:24] * jdm -> bed
[08:18:57] *** Quits: jdm (jdm@92FB48CA.8B5E9DF.9A8C35B4.IP) (Quit: Lost terminal)
[08:39:48] *** Joins: brendan (brendaneic@45A3491F.A5FB4ABA.FE58E87C.IP)
[08:41:58] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[08:45:24] *** Joins: sankha93 (Instantbir@7061CD01.D6BD0D91.22D41759.IP)
[08:49:43] *** Quits: tikue_ (tkuehn@moz-FEADCD38.hsd1.pa.comcast.net) (Quit: tikue_)
[08:50:18] *** Quits: harth (heather@moz-A0276582.hsd1.ca.comcast.net) (Client exited)
[08:50:19] *** Quits: brendan (brendaneic@45A3491F.A5FB4ABA.FE58E87C.IP) (Quit: brendan)
[08:50:38] *** Joins: harth (heather@moz-A0276582.hsd1.ca.comcast.net)
[08:52:29] *** Quits: harth (heather@moz-A0276582.hsd1.ca.comcast.net) (Ping timeout)
[09:02:51] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[09:43:26] *** Quits: six600110 (six600110@moz-2FA48202.neo.res.rr.com) (Connection timed out)
[09:43:50] *** Joins: six600110 (six600110@moz-2FA48202.neo.res.rr.com)
[09:49:17] <jgraham> (oh and we also need some subset of window.location for testharness.js)
[09:55:29] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[10:09:07] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Ping timeout)
[10:10:13] *** Quits: six600110 (six600110@moz-2FA48202.neo.res.rr.com) (Ping timeout)
[10:12:02] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[10:16:22] *** Joins: six600110 (six600110@moz-2FA48202.neo.res.rr.com)
[10:37:07] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[10:38:04] *** Joins: brendan (brendaneic@9E9221B0.60D98710.CE12DF22.IP)
[10:41:10] *** Quits: nathan7 (nathan@86F860FE.3CD03790.F113998C.IP) (Ping timeout)
[11:12:49] *** Joins: Kostic (marko@C4D4CB5C.58A2DD99.2168A69F.IP)
[11:13:30] *** Joins: nathan7 (nathan@86F860FE.3CD03790.F113998C.IP)
[11:18:06] *** Joins: jensnockert (jensnocker@moz-CB012ADC.wireless.lu.se)
[11:19:27] *** Quits: jensnockert (jensnocker@moz-CB012ADC.wireless.lu.se) (Input/output error)
[11:26:26] *** Quits: brendan (brendaneic@9E9221B0.60D98710.CE12DF22.IP) (Quit: brendan)
[11:32:33] *** Joins: brendan (brendaneic@9E9221B0.60D98710.CE12DF22.IP)
[11:35:27] *** Quits: sankha93 (Instantbir@7061CD01.D6BD0D91.22D41759.IP) (Ping timeout)
[11:47:10] *** Quits: brendan (brendaneic@9E9221B0.60D98710.CE12DF22.IP) (Quit: brendan)
[12:34:01] *** Joins: annevk (annevk@D371F92B.DA6F7616.F83D3F11.IP)
[12:34:33] *** Joins: jensnockert (jensnocker@moz-CB012ADC.wireless.lu.se)
[12:37:56] *** Joins: mihneadb (mihneadb@moz-CFFC9266.residential.rdsnet.ro)
[12:42:23] *** Quits: jensnockert (jensnocker@moz-CB012ADC.wireless.lu.se) (Input/output error)
[12:51:01] *** Joins: harth (heather@moz-A0276582.hsd1.ca.comcast.net)
[12:52:52] *** Quits: harth (heather@moz-A0276582.hsd1.ca.comcast.net) (Ping timeout)
[12:56:49] *** Joins: MauricioC (mauricioc@moz-2CFCD404.impa.br)
[13:08:10] *** Joins: ahal (ahal@F77132FB.12EEDBD3.6BEEAEBD.IP)
[13:08:41] *** Joins: jensnockert (jensnocker@moz-56980B81.wireless.lu.se)
[13:09:13] *** Quits: lbergstrom (Adium@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net) (Quit: Leaving.)
[13:09:18] *** Joins: lbergstrom (Adium@moz-5D8E4B14.lightspeed.cicril.sbcglobal.net)
[13:26:34] *** Quits: jensnockert (jensnocker@moz-56980B81.wireless.lu.se) (Input/output error)
[13:40:22] *** Joins: sankha93 (Instantbir@7061CD01.D6BD0D91.22D41759.IP)
[13:42:50] *** Quits: ahal (ahal@F77132FB.12EEDBD3.6BEEAEBD.IP) (Ping timeout)
[13:43:06] *** Joins: ahal (ahal@F77132FB.12EEDBD3.6BEEAEBD.IP)
[13:59:26] *** Quits: lmandel (lmandel@moz-76CE9D51.cable.teksavvy.com) (Quit: lmandel)
[14:10:42] *** Quits: sankha93 (Instantbir@7061CD01.D6BD0D91.22D41759.IP) (Quit: Gone to save the world!)
[14:15:13] *** Quits: mihneadb (mihneadb@moz-CFFC9266.residential.rdsnet.ro) (Input/output error)
[14:26:06] *** Joins: CaseyBecking (CaseyBecki@moz-7EBF4B5D.lsanca.fios.verizon.net)
[14:27:59] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[14:28:14] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[14:31:03] *** Quits: CaseyBecking (CaseyBecki@moz-7EBF4B5D.lsanca.fios.verizon.net) (Client exited)
[14:43:22] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[14:43:25] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[14:54:05] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Ping timeout)
[14:57:01] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[14:59:44] *** Quits: fabrice (fabrice@moz-94F028C6.hsd1.ca.comcast.net) (Quit: Leaving.)
[15:05:56] *** Quits: MauricioC (mauricioc@moz-2CFCD404.impa.br) (Ping timeout)
[15:06:56] *** Joins: CaseyBecking (CaseyBecki@ED8170C4.82E507D6.C334098E.IP)
[15:09:45] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[15:22:34] *** Quits: CaseyBecking (CaseyBecki@ED8170C4.82E507D6.C334098E.IP) (Quit: Leaving...)
[15:31:59] *** Quits: annevk (annevk@D371F92B.DA6F7616.F83D3F11.IP) (Input/output error)
[15:32:27] *** Joins: annevk (annevk@D371F92B.DA6F7616.F83D3F11.IP)
[15:34:11] *** Quits: annevk (annevk@D371F92B.DA6F7616.F83D3F11.IP) (Ping timeout)
[15:34:49] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Ping timeout)
[15:36:32] *** Joins: fabrice (fabrice@moz-BBE3ABD.mv.mozilla.com)
[15:43:41] *** Joins: dbaron (dbaron@moz-C566053C.dsl.dynamic.sonic.net)
[15:58:02] *** bz_sleep is now known as bz
[16:22:08] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[16:28:11] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[16:31:46] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[16:36:01] *** Joins: annevk (annevk@D58D87DD.9F7BDBDF.8B824544.IP)
[16:37:26] *** Joins: alp (alp@moz-D1CEC204.com)
[16:40:45] *** Quits: alp (alp@moz-D1CEC204.com) (Quit: FLAG_FIN)
[16:41:36] *** Joins: alp (alp@moz-D1CEC204.com)
[16:41:53] *** Joins: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP)
[16:41:53] <ghservo> [13servo] 15larsbergstrom opened pull request #963: Start pulling together summit demo elements (06master...06summit)  02http://git.io/kat5qw
[16:41:53] *** Parts: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP) ()
[16:46:50] *** Quits: fabrice (fabrice@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[16:51:39] *** Joins: jdm (jdm@92FB48CA.8B5E9DF.9A8C35B4.IP)
[16:51:39] *** ChanServ sets mode: +o jdm
[16:51:46] *** Joins: bholley (anonymous@moz-FCAF9AAB.hsd1.ca.comcast.net)
[16:51:57] *** Joins: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP)
[16:51:57] <ghservo> 01[13servo01] 15bors-servo pushed 0 new commits to 06auto: 02http://git.io/sOaqIg
[16:51:57] *** Parts: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP) ()
[16:51:59] *** Joins: ghservo (ghservo@79968228.6A2AE50.F3114085.IP)
[16:51:59] <ghservo> 01[13servo01] 15bors-servo pushed 2 new commits to 06auto: 02http://git.io/nbIDfQ
[16:51:59] <ghservo> 13servo/06auto 14ee4a468 15Lars Bergstrom: Start pulling together summit demo elements
[16:51:59] <ghservo> 13servo/06auto 1417864cb 15bors-servo: auto merge of #963 : larsbergstrom/servo/summit, r=jdm...
[16:52:00] *** Parts: ghservo (ghservo@79968228.6A2AE50.F3114085.IP) ()
[16:52:42] <lbergstrom> jdm: ty
[16:52:55] <lbergstrom> After I grab some lunch, I may start logging some summit issues
[16:53:01] <lbergstrom> perf needs work
[16:53:05] <jdm> excellent
[16:53:19] <lbergstrom> and we only have display:block iframes, so we can't do the nifty four-up display that we wanted
[16:53:34] <lbergstrom> I was thinking of just implementing display:inline support for now
[16:55:02] *** Quits: annevk (annevk@D58D87DD.9F7BDBDF.8B824544.IP) (Input/output error)
[16:56:36] <jdm> I didn't know we didn't have that
[16:56:57] <jdm> we could also fix the thing that makes iframes default to not-inline
[16:57:15] <lbergstrom> yeah, I figured I would just tackle that issue and do both at the same time
[16:57:27] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[16:57:35] <lbergstrom> right now, I think they already default to inline but since we don't render iframes if they were laid out inline, they don't show up
[16:57:56] *** Joins: fabrice (fabrice@moz-BBE3ABD.mv.mozilla.com)
[17:02:17] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Ping timeout)
[17:02:29] *** Joins: lmandel (lmandel@moz-76CE9D51.cable.teksavvy.com)
[17:05:56] *** Joins: jet (jet@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:08:29] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[17:13:36] *** Joins: dherman (dherman@E3D7CBA.E815F8FA.2326E556.IP)
[17:13:36] *** ChanServ sets mode: +qo dherman dherman
[17:15:47] *** Quits: dherman (dherman@E3D7CBA.E815F8FA.2326E556.IP) (Quit: dherman)
[17:16:02] *** Joins: ghservo (ghservo@F6EE6DE3.6A2AE50.F3114085.IP)
[17:16:02] <ghservo> 01[13servo01] 15bors-servo merged 06auto into 06master: 02http://git.io/nbIDfQ
[17:16:02] *** Parts: ghservo (ghservo@F6EE6DE3.6A2AE50.F3114085.IP) ()
[17:16:02] *** Joins: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP)
[17:16:02] <ghservo> [13servo] 15bors-servo closed pull request #963: Start pulling together summit demo elements (06master...06summit)  02http://git.io/kat5qw
[17:16:02] *** Parts: ghservo (ghservo@DE823A67.6A2AE50.F3114085.IP) ()
[17:16:42] *** Joins: annevk (annevk@D58D87DD.9F7BDBDF.8B824544.IP)
[17:28:01] *** Joins: valenting (Thunderbir@C6866972.77435D89.FB866788.IP)
[17:29:33] *** Joins: harth (heather@moz-A0276582.hsd1.ca.comcast.net)
[17:34:40] *** Quits: dbaron (dbaron@moz-C566053C.dsl.dynamic.sonic.net) (Ping timeout)
[17:50:16] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[17:59:24] *** Quits: jet (jet@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: jet)
[18:04:02] <kmc> tikue: there's make VERBOSE=1
[18:06:36] *** Joins: jet (jet@moz-BE33DA21.fw1.sfo1.mozilla.net)
[18:07:52] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[18:11:44] *** Joins: dbaron (dbaron@moz-BE33DA21.fw1.sfo1.mozilla.net)
[18:21:12] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[18:22:55] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[18:24:07] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[18:27:50] *** Joins: pcwalton (pcwalton@moz-BE33DA21.fw1.sfo1.mozilla.net)
[18:27:50] *** ChanServ sets mode: +o pcwalton
[18:28:18] <pcwalton> so I did some preliminary measurements on the caltrain
[18:28:23] <pcwalton> we're 15x slower than gecko at reflow
[18:28:28] <pcwalton> primary culprit is rust-css + netsurfcss
[18:28:46] <pcwalton> I am trying to optimize them some but we really need SimonSapin's stuff to not make style accessing so slow
[18:29:51] <pcwalton> the with_mut_base stuff, by the way, costs about 10% of performance
[18:29:54] <pcwalton> I am removing it
[18:30:36] <kmc> interesting
[18:30:57] <pcwalton> I'm aggressively marking rust-css and netsurf stuff as inlinable
[18:31:01] <pcwalton> will see what that does
[18:31:16] <pcwalton> almost none of it was inlinable before and it's quite perf critical
[18:31:57] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[18:32:09] <pcwalton> lesson learned: abstraction taxes on CSS computed style are very bad. it's very important to optimize style queries to be lightning fast
[18:34:23] <kmc> I was thinking about whether we want to mock up some hardcoded style structs and use that to benchmark stuff further down the pipeline, while we work on good selector matching
[18:35:40] <pcwalton> kmc: I wonder if we should just hardcode the struct layout that netsurf uses into rust-netsurfcss
[18:35:44] <pcwalton> instead of using their C accessors
[18:35:55] <pcwalton> then theoretically if you inline all the way down it should just turn it into a grab
[18:35:59] <pcwalton> a grab from a fixed offset
[18:36:06] <kmc> hm
[18:36:12] <pcwalton> lots of work for LLVM to do, it's like 3-5 frames deep
[18:36:17] <pcwalton> the amount of overhead that we have is *absurd*
[18:36:33] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:36:34] *** ChanServ sets mode: +o brson
[18:36:52] <pcwalton> brson: there you are
[18:37:03] <pcwalton> so the amount of overhead that netsurfcss + rust-css induces is absurd
[18:37:09] <pcwalton> 15x slowdown over gecko due to it
[18:37:41] <brson> pcwalton: comparing what? all layout?
[18:37:47] <pcwalton> just constraint solving
[18:37:50] <pcwalton> no shaping
[18:37:55] <pcwalton> the primary culprit is looking up styles
[18:38:01] <pcwalton> and that involves like 3-5 frames deep
[18:38:05] <pcwalton> in gecko it's just a field offset
[18:38:17] <pcwalton> but due to our abstractions it's a ridiculous amount of code in servo
[18:38:32] <pcwalton> I think the rust-css abstraction approach is untenable
[18:39:14] *** Joins: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net)
[18:39:43] <lbergstrom> is the rust inliner just not picking this up? I've worked on inlining (both expansive and non-expansive) a lot in the past and would be happy to help fix things. or do we rely on llvm for inlining?
[18:39:58] <pcwalton> I'm adding inline to a bunch of places
[18:40:08] <pcwalton> but fundamentally there's a C-Rust boundary there
[18:40:12] <pcwalton> and we can't inline across that (at the moment)
[18:40:30] <kmc> I believe there's no Rust inline pass, just LLVM
[18:40:32] <pcwalton> but even so, I think the notion that we can abstract across CSS libraries is just flawed
[18:40:35] <pcwalton> that's right
[18:40:51] <pcwalton> we need tight control over memory layout for CSS computed style
[18:40:55] <pcwalton> because it is just that performance critical
[18:46:34] <jdm> pcwalton: removing with_mut_base how?
[18:46:57] <pcwalton> jdm: introducing a MutableInteriorRef<'self,T> type that allows references to the inside of @ to be passed around
[18:47:01] <pcwalton> and just make a .mut_base()
[18:47:07] <jdm> hmm
[18:47:17] <pcwalton>     pub fn mut_base(&self) -> MutableInteriorRef<RenderBoxBase>
[18:47:23] <pcwalton> improves perf by 10%
[18:47:41] <jdm> I thought that the closures were inlined away back when you wrote that stuff originally
[18:47:49] <pcwalton> you'd think :)
[18:47:55] <pcwalton> they got big
[18:48:00] <jdm> heh
[18:48:08] <pcwalton> plus the rightward drift is miserable
[18:48:12] <jdm> true
[19:04:39] *** Quits: six600110 (six600110@moz-2FA48202.neo.res.rr.com) (Ping timeout)
[19:13:49] *** Quits: jet (jet@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: jet)
[19:15:03] *** Quits: Kostic (marko@C4D4CB5C.58A2DD99.2168A69F.IP) (Ping timeout)
[19:15:53] <pcwalton> inlining squeezed out about 6%
[19:16:07] <pcwalton> going to inline harder, there's still a fair amount of overhead
[19:16:23] <luisbg> https://github.com/mozilla/servo/issues/896
[19:16:33] <luisbg> why does it show in the list of open issues
[19:16:42] <luisbg> but once you go in, it says clearly closed
[19:16:53] <luisbg> https://github.com/mozilla/servo/issues?labels=E-easy&state=open <-- 5th one there
[19:17:32] <cmr> luisbg: I don't see it in that list
[19:18:38] <luisbg> cmr, strange, a clean refresh removed it from the list
[19:18:42] <luisbg> cmr, sorry about that
[19:18:52] *** Joins: vodik (simon@moz-2D668626.cpe.net.cable.rogers.com)
[19:21:29] <pcwalton> yikes, none of the Au functions are inline
[19:21:32] <pcwalton> they show up in the profile
[19:22:02] <jdm> ouch
[19:22:14] *** Joins: six600110 (six600110@moz-2FA48202.neo.res.rr.com)
[19:22:36] <pcwalton> ok, I think I need to implement an LLVM pass here
[19:22:51] <pcwalton> there are way too many switches that get compiled into jump tables that really should be a lookup in a table
[19:24:12] *** Joins: jet (jet@moz-BE33DA21.fw1.sfo1.mozilla.net)
[19:30:46] <jdm> huh, it might be time to try writing a DispatchEvent implementation
[19:30:48] <jdm> how exciting
[19:31:06] <jdm>  18 files changed, 1912 insertions(+), 62 deletions(-)
[19:34:31] <luisbg> jdm, O_O
[19:39:36] *** Quits: annevk (annevk@D58D87DD.9F7BDBDF.8B824544.IP) (Input/output error)
[19:41:54] *** Quits: bz (bzbarsky@moz-EA9A3995.bstnma.fios.verizon.net) (Ping timeout)
[19:46:33] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[19:55:33] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[19:57:27] *** Joins: ghservo (ghservo@C8693FCB.6A2AE50.F3114085.IP)
[19:57:27] <ghservo> [13servo] 15luisbg opened issue #964: Add a URL prompt in Linux  02http://git.io/wqkJzQ
[19:57:27] *** Parts: ghservo (ghservo@C8693FCB.6A2AE50.F3114085.IP) ()
[19:57:57] <luisbg> that guy ^, right?
[20:12:46] <jdm> woooooooooooooooooooooooooooo
[20:12:58] <jdm> I dispatched an event to the window's event handler
[20:13:00] <jdm> this is awesome
[20:13:54] <fabrice> jdm: you clearly live in the future!
[20:14:22] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[20:15:02] <pcwalton> jack: do you know why my cpu rendering patch bounced?
[20:15:15] *** Quits: ahal (ahal@F77132FB.12EEDBD3.6BEEAEBD.IP) (Quit: Leaving)
[20:15:25] <pcwalton> this is the patch that refuses to stick :(
[20:17:45] <jdm> pcwalton: so glfw had problems building; not sure if you played with that at all
[20:17:52] <pcwalton> I did fix that, I thought
[20:18:24] <jdm> I pasted the build failure as a comment
[20:18:29] <pcwalton> ok
[20:18:33] <pcwalton> I'll look
[20:21:32] <jdm> pcwalton: 17:38:03     INFO -  +738b78899bb271258f55ae842e180de2c5ec87db src/support/glfw/glfw (3.0.1-31-g738b788)
[20:21:39] <jdm> that doesn't seem to match the hash in your commit
[20:21:40] <jdm> which is weird
[20:21:55] <pcwalton> yay, we're only 14x slower than Gecko now
[20:22:01] <jdm> oh wait
[20:22:03] <jdm> later it does
[20:22:04] <jdm> ignore me
[20:22:54] *** Joins: tjc (tjc@moz-61292EE3.static.cruzio.com)
[20:22:54] *** ChanServ sets mode: +o tjc
[20:23:23] <pcwalton> I wonder if I should just modify rust-css to eagerly convert from netsurfcss to rust-css
[20:23:27] <pcwalton> for all computed styles
[20:23:33] <pcwalton> that will fix these issues I think
[20:23:40] <pcwalton> of course it'll make CSS selector matching slower
[20:23:46] <pcwalton> but dog slow + slow = dog slow
[20:23:50] <pcwalton> so whatever
[20:24:16] <luisbg> is there a way to configure servo to load a default URL if none is given in the command line?
[20:24:26] <cmr> Is servo running into rust-imposed perf problems or is it naive/incomplete implementation?
[20:24:34] <pcwalton> cmr: both but primarily the latter
[20:24:40] <pcwalton> all the Rust problems are fixable
[20:24:46] <pcwalton> there is no need to panic
[20:24:57] <luisbg> remain calm and keep going
[20:25:04] <cmr> I'm not worried, just curious about the problems servo faces.
[20:25:40] <pcwalton> we are having problems with @mut but they're fixed by eliminating with_ref
[20:25:59] <pcwalton> right now the biggest problem is "we used an off the shelf CSS library that is slow and has an impedance mismatch with Servo's 'native' CSS implementation"
[20:26:22] <pcwalton> "and we're trying to paper over the fundamental problem here until our custom CSS implementation is done"
[20:26:46] <jdm> luisbg: it would require code changes, and wouldn't really make sense I think
[20:27:56] <luisbg> jdm, just wondering :)
[20:33:37] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[20:46:07] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[20:46:07] *** Joins: Kostic (marko@moz-6A631AA6.mbb.telenor.rs)
[20:47:43] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[20:48:34] <kmc> regarding rust-imposed perf problems, I see it as not absolute perf but perf/safety tradeoff
[20:49:05] <kmc> the hope is that *unsafe* Rust code will always be as fast as equivalent C++ (modulo maturity of implementation differences of rustc vs. g++)
[20:49:43] <kmc> and so the more interesting question is, how much do we have to use unsafe code to reach performance parity; hopefully not very much
[20:58:55] *** Quits: dbaron (dbaron@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: 8403864 bytes have been tenured, next gc will be global.)
[20:59:17] *** Joins: dbaron (dbaron@moz-BE33DA21.fw1.sfo1.mozilla.net)
[20:59:30] *** Quits: Kostic (marko@moz-6A631AA6.mbb.telenor.rs) (Ping timeout)
[21:05:56] <pcwalton> bleh, rust-css and rust-netsurfcss are such a mess
[21:06:21] <pcwalton> not sure what the quickest way to improve perf here is...
[21:06:53] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[21:10:30] <kmc> cheat and write a thing which precompiles style structs for all our test html pages :D
[21:12:03] <pcwalton> well, yeah
[21:12:20] <kmc> one of my tests yesterday produced http://i.imgur.com/WfdTBWz.png which I quite like
[21:12:31] <pcwalton> haha
[21:12:36] <pcwalton> well, hmm
[21:12:50] <pcwalton> I guess the fundamental problem here is that we just aren't done with layout
[21:12:58] <pcwalton> we don't have a CSS engine and we're limping along without one
[21:13:08] <pcwalton> we won't know what our numbers are like until SimonSapin is done
[21:13:25] <pcwalton> CSS selector matching
[21:14:17] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[21:15:02] <pcwalton> until sticking the profiler at it I wasn't aware just how badly this hurts us
[21:15:10] *** Joins: Kostic (marko@moz-6A631AA6.mbb.telenor.rs)
[21:15:19] <pcwalton> well, we did learn one thing: rust-css is a dead end
[21:16:42] *** Quits: vodik (simon@moz-2D668626.cpe.net.cable.rogers.com) (Ping timeout)
[21:19:37] *** Quits: Kostic (marko@moz-6A631AA6.mbb.telenor.rs) (Quit: Kostic)
[21:24:17] *** Joins: tikue_ (tkuehn@E004E0C5.B9B3942C.689607DE.IP)
[21:26:58] *** Joins: khodzha (khodzha@DFA1592C.2AEE264E.CA6E2165.IP)
[21:27:16] *** Quits: khodzha (khodzha@DFA1592C.2AEE264E.CA6E2165.IP) (Quit: leaving)
[21:30:43] <tikue_> kmc: does servo get glitchy when you run longcat in an iframe
[21:31:34] <kmc> is there a html file for that alread
[21:31:36] <kmc> y
[21:32:08] <lbergstrom> kmc: not individually; the src/test/html/summit.html file has all of the demos in separate iframes
[21:32:13] <kmc> ok
[21:33:24] <tikue_> kmc: sorry no i just made one myself
[21:33:43] <tikue_> i ask because i have a pr that fixes problems jack was having yesterday
[21:33:53] <tikue_> and i'm wondering if they were the same problems that cpu rendering fixed or orthogonal 
[21:34:50] <kmc> I don't see any glitching on longcat in an iframe with the CPU rendering patch
[21:34:58] <kmc> it does segfault after a little while, though :/
[21:35:01] <tikue_> hmm, that's very interesting
[21:35:10] <tikue_> kmc: are you on master
[21:35:35] <kmc> no, CPU rendering didn't hit master yet
[21:35:37] <kmc> I'm on https://github.com/mozilla/servo/pull/553
[21:35:53] <tikue_> ok
[21:36:23] <tikue_> do you want to r? my pr? it fixes profiling and  constellation being inundated by renderer ready msgs by switching the sender from script --> render task
[21:36:41] <kmc> sure
[21:37:27] <tikue_> kmc: cool, https://github.com/mozilla/servo/pull/961
[21:38:28] <tikue_> additions : deletions < 1
[21:38:31] <tikue_> :P
[21:39:12] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[21:39:39] <kmc> hooray!
[21:40:17] <tikue_> jdm: any new info on the bus error?
[21:40:27] <jdm> tikue_: nope.
[21:40:33] <jdm> thanks for reminding me to talk to #jsapi
[21:40:46] <pcwalton> how do I turn off the --cfg debug?
[21:40:50] <pcwalton> rt::debug_borrow hurts ussss
[21:41:23] <tikue_> damn.  i hope it's not something more sinister -- for example, what if there was a loop somewhere between tasks that caused an exponentially increasing number of messages sent / received, until one task's port was over-inundated, causing failure
[21:41:28] <pcwalton> jack: ^
[21:41:46] <tikue_> bus error represents stack overflow right?
[21:42:02] <tikue_> at least in some cases?
[21:43:40] <kmc> pcwalton: I think just edit Makefile.in and re-run configure
[21:43:48] <pcwalton> ew
[21:43:48] <pcwalton> ok
[21:44:11] <kmc> we should move --cfg debug -Z debug-info into --enable-debug eventually
[21:44:22] <pcwalton> yeah, keep in mind this is making it hard to measure perf
[21:44:23] <pcwalton> be
[21:44:29] <pcwalton> because if you have debug on you start recording runtime borrows!
[21:44:36] <pcwalton> and there are a lot of @muts in servo
[21:44:40] <kmc> perhaps it would be fine to do so now, since --enable-debug no longer implies Skia debugging
[21:44:58] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[21:45:02] <pcwalton> debug borrow recording of @mut are 50% of some hot functions
[21:45:09] <tikue_> pcwalton: i'm starting a patch to remove most if not all @mut from constellation
[21:45:18] <pcwalton> cool
[21:45:20] <kmc> excellent
[21:45:35] <tikue_> just gotta figure out how to use rc mut
[21:46:47] <tikue_> bb in a bit
[21:46:48] *** Quits: tikue_ (tkuehn@E004E0C5.B9B3942C.689607DE.IP) (Quit: tikue_)
[21:48:54] <pcwalton> hmph
[21:49:02] <pcwalton> LLVM is inlining free glue for @RenderBox
[21:49:06] <pcwalton> which is... not what I want it to do, that's cold
[21:49:10] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[21:49:30] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[21:50:45] *** Joins: tikue_ (tkuehn@E004E0C5.B9B3942C.689607DE.IP)
[21:50:52] <cmr> We don't have PGO yet, it doesn't really know what not to inline besides size, does it?
[21:52:02] <pcwalton> it just guesses based on size
[21:52:09] <pcwalton> the debug borrow is messing everything up though
[21:52:23] *** Joins: joshua_ (joshua@moz-45967CBE.emarhavil.com)
[21:52:23] *** Quits: joshua_ (joshua@moz-45967CBE.emarhavil.com) (Quit: joshua_)
[21:52:25] *** Joins: joshua_ (joshua@moz-45967CBE.emarhavil.com)
[21:52:51] <pcwalton> one line functions turn into over 2K of code
[21:53:00] <pcwalton> because of inlining + destructors + debug borrows
[21:53:26] <jdm> heh
[21:53:54] *** Joins: bz (bzbarsky@moz-EA9A3995.bstnma.fios.verizon.net)
[21:55:25] *** Quits: harth (heather@moz-A0276582.hsd1.ca.comcast.net) (Client exited)
[21:55:45] *** Joins: harth (heather@moz-A0276582.hsd1.ca.comcast.net)
[21:57:35] *** Quits: harth (heather@moz-A0276582.hsd1.ca.comcast.net) (Ping timeout)
[21:58:49] <luisbg> what are good simple websites to test against?
[21:59:03] *** Quits: gandalf (zbraniecki@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: I feel so disconnected now	)
[21:59:05] <luisbg> www.mozilla.com just announces a redirect
[22:01:51] <jdm> wikipedia pages tend to work well
[22:01:58] <jdm> reddit pages
[22:05:29] <cmr> I'm actually starting my revamp of extra::url to conform with http://url.spec.whatwg.org/
[22:05:40] <cmr> Is taking a &str acceptable for servo?
[22:08:33] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[22:09:13] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[22:09:13] <ghservo> [13rust-alert] 15luisbg opened pull request #10: Take prompt from console from Linux (06master...06master)  02http://git.io/urJzWw
[22:09:13] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[22:09:37] *** Joins: harth (heather@moz-A0276582.hsd1.ca.comcast.net)
[22:10:07] <luisbg> jdm, the PR above ^ doesn't show in the issue thread because the PR request is to an other module
[22:10:14] <luisbg> is there anyway to pull it over to the issue?
[22:10:34] <luisbg> or just copy-paste the link to the PR?
[22:11:07] <jdm> luisbg: you can just mention the issue number in a PR comment or the PR number in an issue comment.
[22:11:23] *** Quits: harth (heather@moz-A0276582.hsd1.ca.comcast.net) (Ping timeout)
[22:11:34] <luisbg> jdm, I mentioned the Servo issue number in the PR description
[22:12:00] <jdm> oh, right, you can drop a link in a comment and github will do the right thing
[22:12:00] <luisbg> oooh, it wasn't parsed as an issue number
[22:12:48] <luisbg> jdm, :) thanks
[22:13:29] <kmc> cmr: eventually we will need to be using quasi-UCS-2 strings instead of Unicode strings for some things, but I think we're pretty far from knowing exactly what we want there
[22:13:37] <kmc> so I would say that &str is fine for now
[22:13:39] <cmr> ok
[22:14:51] *** Joins: harth (heather@moz-A0276582.hsd1.ca.comcast.net)
[22:14:52] <pcwalton> oh oops, I was counting display list building against Servo but not Gecko
[22:16:10] <pcwalton> ok, we're 12x slower than gecko
[22:16:37] <jdm> these numbers keep getting better
[22:16:42] <luisbg> pcwalton, :S 12x slower
[22:16:49] <pcwalton> luisbg: yes, I know it's bad
[22:16:56] <pcwalton> I know what the problems are, again there is no need to panic
[22:17:09] <luisbg> pcwalton, sorry, didn't meant for it to come out as pressure
[22:17:15] <pcwalton> our markDirty() is pretty expensive
[22:17:17] *** bz is now known as bz_dinner
[22:17:22] <luisbg> Servo is doing amazing things for how young the project is
[22:17:25] <pcwalton> I wonder if Gecko Reflow() includes markDirty() ?
[22:17:28] <pcwalton> maybe I shouldn't count that
[22:17:43] <luisbg> pcwalton, including writing so many modules that Rust is benefiting from :)
[22:17:57] <pcwalton> the biggest problem is not having a real css library and using netsurf's
[22:18:03] <pcwalton> that's responsible for a huge slowdown.
[22:18:41] <luisbg> pcwalton, the idea being writing a css library from scratch in Rust in the long term?
[22:18:44] <pcwalton> yes
[22:18:47] <pcwalton> SimonSapin is working on it
[22:18:50] <luisbg> awesome
[22:19:00] <luisbg> that is why Servo is so cool, so much potential for interesting contributions
[22:19:28] <luisbg> and no legacy clutter :P
[22:20:00] <kmc> no legacy clutter on the implementation side
[22:20:12] <kmc> the problem we're solving is still mostly legacy clutter ;P
[22:20:15] <pcwalton> heh, I think we are mallocing up an array of floats for every block even if there are no floats 
[22:20:17] <luisbg> kmc, yeah heh
[22:20:24] <pcwalton> that should be easily fixable
[22:20:58] *** Joins: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl)
[22:21:00] <luisbg> pcwalton, report it and mark it as E-easy
[22:21:04] <pcwalton> no, I'm just fixing it :P
[22:21:13] <luisbg> pcwalton, hogger :P
[22:21:24] <luisbg> let the external contributors have easy stuff as well!
[22:21:29] * luisbg raises fist
[22:21:41] <luisbg> just kidding, thanks for the work
[22:25:43] <jdm> pcwalton: what's markDirty?
[22:25:50] <pcwalton> jdm: propagating dirty bits around the tree
[22:25:53] <jdm> ah
[22:25:54] <pcwalton> that's what Gecko calls it
[22:27:41] <pcwalton> when we use so many enums it's important to inline
[22:27:43] <pcwalton> so that SROA takes place
[22:27:55] <pcwalton> non-inlined functions tend to create a lot of mov traffic
[22:28:13] *** Quits: tikue_ (tkuehn@E004E0C5.B9B3942C.689607DE.IP) (Quit: tikue_)
[22:29:54] <pcwalton> PSA: for now don't use style.font_size() over and over if you need the font size
[22:30:04] <pcwalton> cache it in a local
[22:30:12] <pcwalton> our very inefficient style system is far too much for LLVM's little brain
[22:30:20] <pcwalton> and rustc's present lack of aliasing info
[22:31:41] *** Joins: tikue_ (tkuehn@E004E0C5.B9B3942C.689607DE.IP)
[22:34:09] <jdm> heh
[22:37:00] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[22:39:47] *** Joins: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP)
[22:39:47] <ghservo> 01[13servo01] 15bors-servo pushed 0 new commits to 06auto: 02http://git.io/qQHESQ
[22:39:47] *** Parts: ghservo (ghservo@1E8607E8.6A2AE50.F3114085.IP) ()
[22:39:48] *** Joins: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP)
[22:39:48] <ghservo> 01[13servo01] 15bors-servo pushed 5 new commits to 06auto: 02http://git.io/o_vgNA
[22:39:48] <ghservo> 13servo/06auto 14c804db0 15Tim Kuehn: deactive profiler when not in use; use newtype structs for task chans
[22:39:48] <ghservo> 13servo/06auto 149df66ff 15Tim Kuehn: workaround for broken cross-crate generic newtype structs...
[22:39:48] <ghservo> 13servo/06auto 1484d7317 15Tim Kuehn: cleaned up code in constellation to make it more maintainable
[22:39:50] *** Parts: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP) ()
[22:40:12] <pcwalton> ok, without debug borrows it's 11x slower than gecko
[22:42:08] <lbergstrom> pcwalton: great work closing the gap!
[22:42:11] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Ping timeout)
[22:42:19] <pcwalton> we really need to cross crate inline newtype structs
[22:42:26] <pcwalton> this is hurting LLVM's optimizations a lot
[22:42:37] <pcwalton> aaaargh! why is debug_borrow still in here?
[22:42:44] <pcwalton> the Servo makefiles are terrible
[22:44:20] *** Quits: dbaron (dbaron@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: 8403864 bytes have been tenured, next gc will be global.)
[22:44:41] *** Joins: dbaron (dbaron@moz-BE33DA21.fw1.sfo1.mozilla.net)
[22:44:42] <pcwalton> also I can't use deriving for Eq because it doesn't inline it
[22:44:43] <pcwalton> grrrrr
[22:45:18] <kmc> is the issue that things have to be marked for cross-crate inlining, or does this hold even within a crate?
[22:47:22] <pcwalton> it's the former
[22:47:28] <pcwalton> Au lives in gfx but layout lives in main
[22:47:36] <pcwalton> so lots of stuff is not cross crate inlined
[22:47:42] <pcwalton> and we didn't notice
[22:47:55] <kmc> i see
[22:49:17] <pcwalton> can someone tell me if there are special optimizations in Gecko for computing min and pref widths?
[22:50:31] <pcwalton> hmm
[22:52:56] <pcwalton> there's this function guess_width which is quite hot and the comment says "this is NOT reasonable"
[22:53:02] <pcwalton> I wonder whether Gecko is doing something faster?
[22:59:19] <pcwalton> ok, not counting markDirty with a few other optimizations it's 10x slower than Gecko
[23:00:15] * jdm tries to figure out the reponsibilities of Gecko's nsEventListenerManager, nsEventListenerService, and nsEventDispatcher
[23:03:45] *** Joins: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP)
[23:03:45] <ghservo> 01[13servo01] 15bors-servo merged 06auto into 06master: 02http://git.io/o_vgNA
[23:03:45] *** Parts: ghservo (ghservo@9C8B94D4.6A2AE50.F3114085.IP) ()
[23:10:29] *** Joins: annevk (annevk@moz-451D5EF9.nyc.res.rr.com)
[23:12:56] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[23:14:43] <kmc> pcwalton: so now rust-layers is responsible for deleting textures, rather than skia?
[23:15:04] <pcwalton> yes
[23:15:09] <pcwalton> I hadn't considered the ramifications of that
[23:15:14] <pcwalton> I guess that's why it's crashing eh? :)
[23:15:15] <kmc> anyway I'm seeing a problem like we saw with Skia before; the dtor for layers::texturegl::Texture can run on different threads, and some don't have a GL context
[23:15:19] <pcwalton> yeah
[23:15:29] <kmc> and we don't have the X stuff around to call glXMakeCurrent :/
[23:15:52] <pcwalton> this would be so much easier if it were COM
[23:15:57] <pcwalton> that's the only time in my life I will say that
[23:16:01] <jdm> I was going to say
[23:16:02] <kmc> hahaha
[23:16:03] <pcwalton> I think Direct3D does this right
[23:16:12] <pcwalton> AddRef() and Release() are threadsafe
[23:16:21] <pcwalton> and textures are COM objects
[23:24:46] *** Quits: tjc (tjc@moz-61292EE3.static.cruzio.com) (Quit: Places to go, people to annoy)
[23:28:53] *** Quits: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl) (Client exited)
[23:32:52] *** Quits: dbaupp (Thunderbir@moz-EAA09AEF.lns20.syd7.internode.on.net) (Ping timeout)
[23:35:59] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: Lost terminal)
[23:36:26] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[23:36:26] *** ChanServ sets mode: +o brson
[23:46:19] *** Quits: annevk (annevk@moz-451D5EF9.nyc.res.rr.com) (Input/output error)
[23:49:05] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
