[00:03:30] *** Joins: chc4 (chc4@moz-mjph4c.ma.comcast.net)
[00:04:20] <WindowsBunny> okay, well I think I can assume that HeapAlloc is at least 16 bytes on 64-bit
[00:05:02] <WindowsBunny> but gah, I'll basically have to over-allocate, and store a pointer before the aligned address to point to the beginning of the allocation
[00:05:05] *** Quits: Quxxy (chatzilla@moz-efh10q.internode.on.net) (Ping timeout: 121 seconds)
[00:06:31] <rkruppe> Hacking alignment on top of a memory allocator is gross
[00:06:49] <rkruppe> Is jemalloc broken on Windows or why do you have to go straight to HeapAlloc?
[00:07:10] <WindowsBunny> rkruppe: This is for the msvc version of rust
[00:07:27] <WindowsBunny> which doesn't have jemalloc at the moment, and I'm trying to see if I can get rid of our dependence on the CRT
[00:07:47] <rkruppe> Okay, ew
[00:10:26] *** Quits: chc4 (chc4@moz-mjph4c.ma.comcast.net) (Ping timeout: 121 seconds)
[00:11:15] *** Quits: andrew-d_w (andrew-d_w@moz-f7k.iq2.247.50.IP) (Quit: Leaving...)
[00:16:09] <WindowsBunny> okay, GetProcessHeap only takes about 2ns, so I don't have to concern myself too much with caching that
[00:18:18] *** Joins: chc4 (chc4@moz-mjph4c.ma.comcast.net)
[00:24:25] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[00:33:34] *** Quits: chc4 (chc4@moz-mjph4c.ma.comcast.net) (Ping timeout: 121 seconds)
[00:48:39] *** Joins: chc4 (chc4@moz-mjph4c.ma.comcast.net)
[00:54:25] <reem> Is there a way to concat idents in a macro?
[00:55:10] <Dabo> concat_idents!() exists, isn't that useful though
[00:55:23] <reem> why not?
[00:55:28] <WindowsBunny> it doesn't actually create an ident
[00:55:39] <WindowsBunny> So you can't use it in situations where you really need an ident
[00:55:43] <reem> Can I do a tt -> ident hack to make it work?
[00:56:11] <reem> e.g. macro_rules! tt_as_ident { ($x:ident) => $x } and you pass it a tt
[00:56:12] <WindowsBunny> reem: If you figure out a way to make it produce a genuine ident that can be used as a type name, I will love you
[00:56:36] <WindowsBunny> but I'm pretty sure that won't work
[00:56:39] <reem> I am replacing a C++ code generator with macros and I already killed like 500 LOC with 20 lines of macros
[00:56:53] <reem> this language is great
[00:56:56] <reem> I will try to make it work
[00:57:35] *** Quits: chc4 (chc4@moz-mjph4c.ma.comcast.net) (Ping timeout: 121 seconds)
[00:58:29] <reem> It looks like the problem is with actually invoking a macro in ident position
[00:58:45] <reem> e.g. struct macro!(x) { } fails with a parse error, regardless of what macro! is
[00:59:09] <reem> that sucks
[00:59:11] <reem> a lot
[01:02:16] *** Joins: chc4 (chc4@moz-mjph4c.ma.comcast.net)
[01:03:21] <WindowsBunny> reem: Now write an RFC to fix that
[01:04:03] <reem> WindowsBunny: I might actually do that
[01:05:17] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[01:07:15] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Ping timeout: 121 seconds)
[01:12:18] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Quit: ChatZilla 0.9.91.1 [Firefox 38.0.5/20150525141253])
[01:12:35] <eddyb> reem: there was a suggestion by someone
[01:12:47] <eddyb> reem: inside a macro, struct macro $!(macro!(x))
[01:12:53] <eddyb> (early expansion)
[01:13:05] <eddyb> err
[01:13:18] <eddyb> struct $!(macro!(x)) { ... }
[01:13:27] * eddyb is not really awake
[01:17:47] <WindowsBunny> Can someone check my aligned allocation logic to make sure it is correct?
[01:20:03] *** Quits: Jesin (Jesin@moz-4jre1i.eecs.lehigh.edu) (Quit: Leaving)
[01:20:08] <WindowsBunny> https://gist.github.com/retep998/4e9d815249a6602c2999
[01:20:33] <WindowsBunny> I'm storing the pointer to the actual allocation in the pointer sized slot directly before the aligned address that I return
[01:24:48] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[01:27:01] *** Joins: sprang (sprang@moz-d0kmvi.12d9.sm5v.0009.2601.IP)
[01:27:25] *** Joins: p1start (p1start@moz-nftjhe.org)
[01:30:39] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[01:33:41] *** Quits: Simplebrain (Simplebrain@moz-1hs5ek.rev.poneytelecom.eu) (Ping timeout: 121 seconds)
[01:41:09] *** Joins: Jesin (Jesin@moz-t88s6v.cc.lehigh.edu)
[01:41:17] *** Quits: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au) (Ping timeout: 121 seconds)
[01:56:17] *** Joins: Simplebrain (Simplebrain@moz-1hs5ek.rev.poneytelecom.eu)
[02:06:02] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[02:14:34] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[02:17:08] <WindowsBunny> acrichto: https://github.com/rust-lang/rust/pull/26265
[02:23:07] *** Quits: Murarth (Murarth@moz-2kf.78t.166.46.IP) (Quit: Mani Mani is always Mani Mani at Mani Mani with all Mani Mani Mani)
[02:23:22] *** Joins: Murarth (Murarth@moz-jpotpi.phnx.qwest.net)
[02:27:06] *** kimundi is now known as zz_kimundi
[02:50:21] *** Quits: Sho (sho@moz-doej59.cust.telecolumbus.net) (Quit: Konversation terminated!)
[02:51:48] *** Quits: zz_kimundi (kimundi@moz-vprdic.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:54:34] *** Joins: zz_kimundi (kimundi@moz-qgou9j.dip0.t-ipconnect.de)
[02:54:35] *** zz_kimundi is now known as kimundi
[03:10:19] *** Joins: jgallagher (john@moz-6ge.dhn.131.24.IP)
[03:11:34] *** Joins: dcb (textual@moz-j72nfe.ca.comcast.net)
[03:11:57] *** Joins: James_ (quassel@moz-8qs8a3.range86-148.btcentralplus.com)
[03:15:10] *** Quits: dcb (textual@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[03:27:47] *** Joins: semarie (semarie@moz-m7316u.ip-37-59-41.eu)
[03:38:41] *** Quits: swgillespie (swgillespie@moz-apj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[03:39:00] *** Joins: jincreator (Thunderbird@moz-588.igi.7.59.IP)
[03:42:54] *** Quits: ytain (ytain@moz-o0gerq.dsl.teksavvy.com) (Quit: Textual IRC Client: www.textualapp.com)
[03:56:15] *** Quits: ryanhiebert (ryanhiebert@moz-nsd5kl.ks.cox.net) (Quit: Leaving...)
[03:58:57] *** Quits: James_ (quassel@moz-8qs8a3.range86-148.btcentralplus.com) (Ping timeout: 121 seconds)
[04:17:22] *** Quits: sprang (sprang@moz-d0kmvi.12d9.sm5v.0009.2601.IP) (Connection closed)
[04:19:10] *** Quits: joneshf-laptop (joneshf@moz-l4h.b5s.208.98.IP) (Connection closed)
[04:20:04] *** Joins: joneshf-laptop (joneshf@moz-l4h.b5s.208.98.IP)
[04:33:45] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Connection closed)
[04:36:07] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[04:47:48] *** Joins: nxnfufunezn (nxnfufunezn@moz-dv4.g8t.242.117.IP)
[04:50:05] *** Quits: nxnfufunezn (nxnfufunezn@moz-dv4.g8t.242.117.IP) (Quit: WeeChat 1.2)
[04:58:52] *** Joins: avikpal (avikpal@moz-7f3.7kk.227.117.IP)
[04:59:17] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[05:05:07] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[05:06:12] *** Quits: bjz (bjz@moz-puppgq.tpgi.com.au) (Quit: My Mac has gone to sleep. ZZZzzz…)
[05:11:30] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[05:17:38] *** Joins: Quxxy (chatzilla@moz-efh10q.internode.on.net)
[05:18:44] *** Quits: avikpal (avikpal@moz-7f3.7kk.227.117.IP) (Ping timeout: 121 seconds)
[05:21:11] *** Joins: avikpal (avikpal@moz-u5o.qnm.227.117.IP)
[05:22:12] *** Joins: Feyn (aram@moz-88k.k93.115.42.IP)
[05:22:21] *** Quits: chc4 (chc4@moz-mjph4c.ma.comcast.net) (Quit: AHHHHH BEES)
[05:28:37] *** Joins: Quxxy_ (chatzilla@moz-efh10q.internode.on.net)
[05:30:10] *** Quits: Quxxy (chatzilla@moz-efh10q.internode.on.net) (Ping timeout: 121 seconds)
[05:30:11] *** Quxxy_ is now known as Quxxy
[05:31:17] *** Quits: phynx (chatzilla@moz-b3u.tp7.235.62.IP) (Ping timeout: 121 seconds)
[05:35:44] *** Joins: bjz (bjz@moz-puppgq.tpgi.com.au)
[05:39:06] *** Joins: jevin (jevin@moz-sra.ovp.12.72.IP)
[05:41:43] *** Quits: jevin_ (jevin@moz-sra.ovp.12.72.IP) (Ping timeout: 121 seconds)
[05:45:16] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[05:48:11] *** Joins: woboats (tatterdemal@moz-drj4d9.sndgca.sbcglobal.net)
[05:55:19] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[06:00:25] *** Joins: eerie (eerie@moz-qld.8t4.67.109.IP)
[06:05:21] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[06:07:37] *** Quits: avikpal (avikpal@moz-u5o.qnm.227.117.IP) (Connection closed)
[06:11:57] *** Quits: eerie (eerie@moz-qld.8t4.67.109.IP) (Connection closed)
[06:11:59] *** Quits: zxq9 (ceverett@moz-qsm369.mesh.ad.jp) (Quit: Konversation terminated!)
[06:18:06] *** Quits: Quxxy (chatzilla@moz-efh10q.internode.on.net) (Connection closed)
[06:22:03] *** Joins: avikpal (avikpal@moz-u5o.qnm.227.117.IP)
[06:24:00] *** Quits: avikpal (avikpal@moz-u5o.qnm.227.117.IP) (Quit: )
[06:28:23] *** Joins: avikpal (avikpal@moz-f6l.pjb.194.117.IP)
[06:34:20] *** Quits: avikpal (avikpal@moz-f6l.pjb.194.117.IP) (Ping timeout: 121 seconds)
[06:34:56] *** Joins: avikpal (avikpal@moz-71t.kva.227.117.IP)
[06:38:16] *** Joins: eerie (eerie@moz-qld.8t4.67.109.IP)
[06:40:06] *** Quits: brandonson (brandonson@moz-04bj5s.cs.ubc.ca) (Ping timeout: 121 seconds)
[06:43:02] *** Quits: avikpal (avikpal@moz-71t.kva.227.117.IP) (Quit: )
[06:43:53] *** Joins: Skyler (Skyler@moz-dgl2bi.fios.verizon.net)
[06:45:32] *** Joins: eataix (uid37918@moz-79aeif.ealing.irccloud.com)
[06:47:41] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[06:52:46] *** Joins: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au)
[06:58:04] *** Joins: avikpal (avikpal@moz-moa.6dt.249.117.IP)
[06:58:40] *** Joins: erz (erz@moz-fiq1tl.broadband.corbina.ru)
[07:02:26] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[07:17:31] *** Quits: avikpal (avikpal@moz-moa.6dt.249.117.IP) (Connection closed)
[07:19:58] *** Joins: avikpal (avikpal@moz-moa.6dt.249.117.IP)
[07:22:02] *** Joins: summerlight (summerlight@moz-99k.2mj.130.121.IP)
[07:27:37] *** Joins: phynx (chatzilla@moz-4oe.tp7.235.62.IP)
[07:28:35] *** Quits: avikpal (avikpal@moz-moa.6dt.249.117.IP) (Quit: )
[07:36:51] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[07:44:27] *** Quits: bjz (bjz@moz-puppgq.tpgi.com.au) (Quit: My Mac has gone to sleep. ZZZzzz…)
[07:44:58] *** Joins: bjz (bjz@moz-puppgq.tpgi.com.au)
[07:46:58] *** Quits: nham (nham@moz-lglsfe.il.comcast.net) (Quit: leaving)
[07:52:26] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[07:53:08] *** Quits: Skyler (Skyler@moz-dgl2bi.fios.verizon.net) (Client exited)
[08:00:07] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[08:29:22] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[08:34:10] *** Quits: phynx (chatzilla@moz-4oe.tp7.235.62.IP) (Ping timeout: 121 seconds)
[08:36:50] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[08:37:37] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[08:59:00] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[09:01:04] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[09:03:53] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[09:08:13] *** Quits: elif (chatzilla@moz-ev8m1p.res.rr.com) (Ping timeout: 121 seconds)
[09:30:45] *** Joins: dinfuehr (dinfuehr@moz-4ce95a.highway.telekom.at)
[09:33:03] *** Joins: Skyler (Skyler@moz-dgl2bi.fios.verizon.net)
[09:37:24] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[09:41:25] *** Quits: brain (brain@moz-ake53i.rcsntx.sbcglobal.net) (Ping timeout: 121 seconds)
[09:42:07] *** Joins: brain (brain@moz-ake53i.rcsntx.sbcglobal.net)
[09:47:11] *** Quits: summerlight (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[09:53:23] *** Quits: erz (erz@moz-fiq1tl.broadband.corbina.ru) (Quit: My Mac has gone to sleep. ZZZzzz…)
[09:57:47] *** Quits: dinfuehr (dinfuehr@moz-4ce95a.highway.telekom.at) (Connection closed)
[10:11:36] *** Quits: eerie (eerie@moz-qld.8t4.67.109.IP) (Connection closed)
[10:16:26] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[10:27:06] *** Joins: mukilan (mukilan@moz-5ke.d4s.164.122.IP)
[10:30:25] <eddyb> whoa
[10:30:55] *** Joins: phynx (chatzilla@moz-0n9bp5.dsl.scarlet.be)
[10:31:05] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[10:32:32] *** Joins: Quxxy (chatzilla@moz-efh10q.internode.on.net)
[10:32:45] <eddyb> nmatsakis, Quxxy: trait GiveMe { type What; fn give<F: Fn(Self::What)>(&self, F); } impl GiveMe for Vec<i32> { type What = impl Iterator<f32>; fn give<F: Fn(Self::What)>(&self, f: F) { f(self.iter().map(|&x| x as f32) } }
[10:33:21] *** Quits: Kxepal (Miranda@moz-5p74si.pppoe.mtu-net.ru) (Ping timeout: 121 seconds)
[10:33:58] *** Joins: nodweber_ (nodweber@moz-knt.fgq.178.5.IP)
[10:34:20] * Quxxy 's brain melts out of his ears
[10:34:29] <Quxxy> You've... put anon types in function arguments
[10:34:37] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Connection closed)
[10:34:47] <eddyb> ast_map::with_path has a weird fixed iterator thing and middle::ty::with_path does the external crate thing by
[10:34:48] <eddyb>         f(csearch::get_item_path(cx, id).iter().cloned().chain(LinkedPath::empty()))
[10:35:16] <eddyb> which isn't very pretty
[10:35:41] <eddyb> it's also not very efficient
[10:36:40] * Quxxy cries
[10:36:51] <Quxxy> It takes a closure which takes a concrete argument whose type the caller doesn't know
[10:37:23] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[10:37:53] <Quxxy> eddyb: https://media.giphy.com/media/IvcwXzJ1HiTTi/giphy.gif
[10:40:44] <Quxxy> eddyb: I am tempted to post this to the subreddit, because this is wacky and awesome
[10:42:22] <bluss> not a nice gif
[10:43:08] *** Joins: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net)
[10:45:10] <Quxxy> bluss: Hey, I not only got dragged, *dragged* I say, into this channel, my back hurts, so there
[10:46:24] <bluss> maybe because you always talk rust stuff in #rust-offtopic
[10:46:42] <bluss> which is borderline offtopic
[10:47:14] <Quxxy> Exactly; offtopic stuff goes in offtopic
[10:50:58] *** Quits: nodweber_ (nodweber@moz-knt.fgq.178.5.IP) (A TLS packet with unexpected length was received.)
[11:03:39] <bluss> does bors try take away any resources from the buildbot?
[11:05:01] <bluss> do you think I can use try on gh26252
[11:05:01] <[o__o]> mk: Build crates with relative paths to rustc: https://github.com/rust-lang/rust/pull/26252
[11:16:27] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Connection closed)
[11:17:36] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[11:17:37] *** Quits: Defaultti (Defaultti@moz-bmdn13.kapsi.fi) (Quit: Quitting.)
[11:19:45] *** Joins: Defaultti (Defaultti@moz-bmdn13.kapsi.fi)
[11:51:01] *** Joins: summerlight (summerlight@moz-99k.2mj.130.121.IP)
[11:52:01] *** Quits: summerlight (summerlight@moz-99k.2mj.130.121.IP) (Quit: Leaving)
[11:53:54] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[11:59:03] *** Joins: zmack (zmack@moz-qdq.e19.24.188.IP)
[11:59:53] *** Joins: summerlight (summerlight@moz-99k.2mj.130.121.IP)
[12:02:22] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[12:05:01] *** Quits: zmack (zmack@moz-qdq.e19.24.188.IP) (Connection closed)
[12:11:44] *** Joins: James_ (quassel@moz-8qs8a3.range86-148.btcentralplus.com)
[12:17:30] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[12:27:51] *** Joins: ytain (ytain@moz-o0gerq.dsl.teksavvy.com)
[12:32:08] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Connection closed)
[12:49:18] *** Quits: Simplebrain (Simplebrain@moz-1hs5ek.rev.poneytelecom.eu) (Quit: Leaving)
[12:52:55] *** Joins: zmack (zmack@moz-qdq.e19.24.188.IP)
[12:53:40] *** Quits: zmack (zmack@moz-qdq.e19.24.188.IP) (Connection closed)
[12:58:11] *** Quits: Kingsquee (kingsley@moz-3fm07c.bchsia.telus.net) (Quit: Konversation terminated!)
[13:01:22] *** Joins: Simplebrain (Simplebrain@moz-9h5lcb.skybroadband.com)
[13:16:37] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[13:20:22] *** Joins: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP)
[13:27:44] *** Joins: munksgaard (munksgaard@moz-urnkl5.u.parknet.dk)
[13:29:28] *** Joins: Rym (uid91135@moz-n2i7qm.charlton.irccloud.com)
[13:32:28] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[13:32:48] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[13:33:37] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[13:36:34] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[13:37:19] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Ping timeout: 121 seconds)
[13:39:14] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[13:42:36] *** Quits: ytain (ytain@moz-o0gerq.dsl.teksavvy.com) (Ping timeout: 121 seconds)
[13:45:15] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[13:46:48] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[13:47:20] *** Quits: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net) (Ping timeout: 121 seconds)
[13:59:50] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[14:17:13] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[14:22:50] *** Quits: Feyn (aram@moz-88k.k93.115.42.IP) (Quit: Leaving)
[14:32:42] *** Joins: avikpal (avikpal@moz-lme.sp7.98.59.IP)
[14:33:44] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[14:38:11] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Ping timeout: 121 seconds)
[14:41:06] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[14:42:54] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Connection closed)
[14:44:55] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[14:45:10] *** Quits: Quxxy (chatzilla@moz-efh10q.internode.on.net) (Ping timeout: 121 seconds)
[14:46:06] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[14:57:35] *** Quits: avikpal (avikpal@moz-lme.sp7.98.59.IP) (Connection closed)
[14:59:08] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[14:59:33] *** Joins: chc4 (chc4@moz-mjph4c.ma.comcast.net)
[14:59:58] *** Joins: avikpal (avikpal@moz-v8s.nmd.238.117.IP)
[15:03:10] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[15:07:19] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[15:20:55] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[15:20:55] *** ChanServ sets mode: +ao erickt erickt
[15:25:38] *** Joins: brandonson (brandonson@moz-04bj5s.cs.ubc.ca)
[15:31:25] *** Quits: avikpal (avikpal@moz-v8s.nmd.238.117.IP) (Connection closed)
[15:31:26] *** Joins: avikpal_ (avikpal@moz-v8s.nmd.238.117.IP)
[15:34:15] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[15:34:29] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[15:34:30] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[15:38:38] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Ping timeout: 121 seconds)
[15:51:01] <kimundi> Anyone here who can help me navigate around inside the compiler source? I want to try hacking in a feature and roughly know how to do it, but I have no idea where anything is :)
[15:54:09] *** Joins: zmack (zmack@moz-qdq.e19.24.188.IP)
[15:54:45] *** Joins: jn (nope@moz-f7bqt1.hsi08.unitymediagroup.de)
[15:54:50] *** Parts: jn (nope@moz-f7bqt1.hsi08.unitymediagroup.de) ()
[15:56:43] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[15:58:11] *** Quits: zmack (zmack@moz-qdq.e19.24.188.IP) (Ping timeout: 121 seconds)
[16:00:36] <cmr> kimundi: sure
[16:03:44] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[16:03:52] <eddyb> kimundi: don't ask to ask :D
[16:05:39] <kimundi> cmr, eddyb: Alright. :) So, what I want rustc to do is to generate a static array/slice that contains (TypeId, &str, functionpointer) tuples that contain for each public function of the crate its functionpointer, the typeid of its functionpointer, and the unmangled crate local module path to it
[16:06:01] <cmr> I already like the sound of this.
[16:06:05] <sp3d> smells like tooling :)
[16:06:10] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[16:06:22] <kimundi> And, well I'm wondering how to gather all those things, and where I'd have to do that ;)
[16:06:46] *** Joins: mib_n8eb3s (Mibbit@moz-hu6.nja.252.72.IP)
[16:07:15] <eddyb> kimundi: monomorphic functions?
[16:07:30] <kimundi> eddyb: Not sure what you mean
[16:07:31] <cmr> if you look at the definition of the type_id intrinsic in librustc_trans/trans/intrinsic.rs:350, you can see how you fetch a TypeId.
[16:07:36] <eddyb> as in, not generic functions
[16:07:36] <kimundi> Non-generic ones
[16:07:39] <kimundi> yes 
[16:07:56] <eddyb> there's a table of publicly reachable items
[16:08:05] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[16:08:41] <eddyb> you should be able to iterate that, filter functions you can use, use get_item_val to obtain the pointer and a function in middle::ty to get the type_id
[16:08:53] <eddyb> then there's the C_* family of functions for building constants
[16:09:15] <eddyb> you would use C_struct for the tuple and C_array for the whole thing
[16:09:35] <eddyb> I think trans::consts has something to create a global easily
[16:10:47] <kimundi> Okay, that sounds very helpful :) Where would I start writing code for this though? (Which compiler pass, and good location for it?)
[16:10:55] <eddyb> you have to do it in trans
[16:10:59] <cmr> kimundi: I'd add it as an intrinsic
[16:11:05] <eddyb> oh
[16:11:10] <cmr> that returns the pointer to the slice.
[16:11:11] <eddyb> that's not a bad idea :D
[16:11:44] <eddyb> you'd cache it in trans::context::LocalCrateContext, I guess (Cell<Option<ValueRef>> or something)
[16:12:05] <kimundi> cmr: As in, it would return a static slice?
[16:12:07] <eddyb> for adding an intrinsic... I usually grep for an existing intrinsic's name :D
[16:12:10] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Connection closed)
[16:12:12] <cmr> kimundi: right, yeah
[16:12:18] <eddyb> and modify all the places it shows up in
[16:12:37] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[16:12:41] <kimundi> okay, that sounds doable. I'D probably need to add more instrisics later anyway
[16:12:56] <kimundi> So... What intrinsic do I copy...
[16:13:01] <cmr> Are you working on anything concrete or just playing around with reflection?
[16:13:17] <cmr> on a concrete design I mean
[16:13:23] <kimundi> cmr: I want to enable runtime typechecking for loading dynamic library symbols
[16:13:56] <kimundi> mykrate.load_symbol::<fn(u32) -> bool>("foo::bar")
[16:14:22] <cmr> Mm. I guess the array would be a good first pass, but you'd want to take a hint from the runtime linker and use a hash map for actually doing the symbol -> typeid lookup.
[16:14:23] <kimundi> For that I need type information that I can read in at runtime with a dlopen
[16:14:23] <eddyb> yeah, that's not going to work with an intrinsic :P
[16:14:45] <cmr> eddyb: what do you mean?
[16:14:59] <Mutabah> eddyb: How not?
[16:15:08] <eddyb> how are you going to call the intrinsic from a const/static?
[16:15:14] <Mutabah> eddyb: the intrinisic could return the mangled tail (without the hash)
[16:15:16] <kimundi> I guess the issue is that the intrisic would not actually get called
[16:15:29] <cmr> well you don't do it in a const/static :P
[16:15:35] <eddyb> cmr: how else
[16:15:50] <eddyb> you need to generate a fixed named symbol in a plugin crate
[16:15:58] <eddyb> this is why I originally thought it would be a good idea to just stash it in trans_crate
[16:16:05] <kimundi> eddyb: I guess for now it would just have to be called anywhere in the library so that the compiler generates the static
[16:16:16] *** Quits: mib_n8eb3s (Mibbit@moz-hu6.nja.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[16:16:20] <eddyb> kimundi: that's just a hack
[16:16:21] <cmr> Oh I see what the problem is.
[16:16:30] <eddyb> #[crate_type = "plugin"] pls :D
[16:16:36] <kimundi> eddyb: Right, so where would be a good place in trans_Crate?
[16:16:40] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Ping timeout: 121 seconds)
[16:16:54] <kimundi> eddyb: right right. that is planned :)
[16:17:07] <eddyb> kimundi: anywhere in the middle :D
[16:17:15] <eddyb> just after write_metadata, for example
[16:17:19] <kimundi> Okay, the middle of what in what source file ;)
[16:17:25] <eddyb> trans_crate is a function
[16:18:17] <kimundi> in rustc_trans::base ?
[16:19:01] <eddyb> rustc_trans::trans::... yeah, likely base
[16:19:18] <kimundi> okay, found the write_metadata line, gonna start there then
[16:19:50] *** Joins: ytain (ytain@moz-pum3eh.dsl.teksavvy.com)
[16:20:08] *** Joins: harrisonclarke (harrisoncla@moz-th044a.ns.bellaliant.net)
[16:21:06] <kimundi> So, which of the many locals in that function is my entry point for accessing stuff here?
[16:21:30] <eddyb> hmm, good question
[16:21:36] <eddyb> kimundi: you know what?
[16:21:43] * eddyb thinks
[16:21:51] <eddyb> kimundi: maybe this should go in write_metadata
[16:22:11] <eddyb> which already creates a symbol for a blob containing the compressed metadata, in shared libs
[16:22:51] <eddyb> I guess it's a bit tricky because you don't have a "local context", just the shared one
[16:23:07] <eddyb> or... you could pick the first local context and go with it
[16:23:35] <eddyb> (everything works with the "local context" which is what the "parallel codegen" shards over)
[16:24:23] <eddyb> N codegen units results in N "local contexts", each working on an LLVM module disjoint from the others (and you can't share values between them)
[16:24:43] <kimundi> eddyb: You mean, write it into the metadata, or just use all the machinery already prepared fro writing the metadat symbold to also write my symbol?
[16:25:05] <eddyb> the latter
[16:25:08] <kimundi> okay
[16:25:18] <eddyb> I'm not sure though, it does some unsafe things
[16:25:23] *** Quits: avikpal_ (avikpal@moz-v8s.nmd.238.117.IP) (Ping timeout: 121 seconds)
[16:25:36] <eddyb> talking directly to LLVM instead of using wrappers
[16:26:11] <eddyb>     let llmeta = C_bytes_in_context(cx.metadata_llcx(), &compressed[..]);
[16:26:15] <eddyb> oh I guess it's not *that* bad
[16:27:00] *** Joins: avikpal (avikpal@moz-v8s.nmd.238.117.IP)
[16:27:08] <kimundi> eddyb: Okay, so what does the SharedCrateContext represent, exactly?
[16:27:19] <eddyb> trans context for the entire crate
[16:27:38] <kimundi> so, I'd be able to reach the list of all public items with that?
[16:27:52] <eddyb> oh, right, it's split off before my path
[16:27:54] <eddyb> *patch
[16:28:02] <eddyb> kimundi: look at crate_ctxt_to_encode_parms
[16:28:10] <eddyb> reachable: cx.reachable()
[16:28:38] <kimundi> okay
[16:28:39] <eddyb> I *think* that's what you want
[16:31:03] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[16:31:05] <kimundi> eddyb: Okay, thats a HashSet of NodeId. WHat Is  nodeId, and how do I handle them? :)
[16:31:15] <kimundi> is a NodeId*
[16:31:56] <eddyb> :D
[16:32:01] <kimundi> I guess its a u32 key into some other may?
[16:32:03] <eddyb> kimundi: each node in the AST gets an ID
[16:32:06] <kimundi> okay
[16:32:19] <eddyb> it's more than just an u32. it should be newtype'd but nobody bothered to
[16:32:34] <eddyb> kimundi: in this case, it's the ID of an item
[16:32:44] <kimundi> ok
[16:32:53] *** Joins: xilec (Mibbit@moz-g6k.oht.161.46.IP)
[16:33:03] <eddyb> tcx.map is the ast_map which you can query about any ID registered in the map (most of them are)
[16:33:18] <eddyb> you get a tcx from cx.tcx(), I believe
[16:33:24] *** Joins: larhat1 (Adium@moz-vlo5br.cable.virginm.net)
[16:33:27] <kimundi> So I have the the Id of all reachable items, and access them through tcx.map. 
[16:35:01] <WindowsBunny> hey eddyb, what's an easy way to format numbers into strings in liballoc?
[16:39:15] <eddyb> WindowsBunny: hmm
[16:39:22] <eddyb> WindowsBunny: look in core::fmt
[16:39:46] <eddyb> technically you could impl fmt::Write
[16:40:05] <WindowsBunny> That seems.... a bit heavy though
[16:40:05] <eddyb> that's kinda what std::rt::util does. if it's still around
[16:40:10] <eddyb> WindowsBunny: why?
[16:40:18] <eddyb> it means you can use the write! macro to do anything you want
[16:40:23] <WindowsBunny> true....
[16:40:37] <eddyb> it's just one function, to output a &str
[16:43:09] <WindowsBunny> wut
[16:43:11] <WindowsBunny> ERROR_INVALID_PARAMETER
[16:43:19] <WindowsBunny> How am I supposed to call HeapSummary? o_0
[16:46:24] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Quit: ChatZilla 0.9.91.1 [Firefox 38.0.5/20150525141253])
[16:48:02] *** Quits: avikpal (avikpal@moz-v8s.nmd.238.117.IP) (Connection closed)
[16:48:51] * WindowsBunny disassembles HeapSummary
[16:49:18] *** Quits: harrisonclarke (harrisoncla@moz-th044a.ns.bellaliant.net) (Connection closed)
[16:51:59] <kimundi> eddyb / cmr: What is a NodeForeignItem vs a NodeItem?
[16:52:35] <kimundi> (in ast_map::Node)
[16:52:51] <kimundi> Or rather, Item vs FOreignItem
[16:54:58] <kimundi> ah, extern block ones
[16:57:10] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[16:57:34] *** Joins: harrisonclarke (harrisoncla@moz-th044a.ns.bellaliant.net)
[16:59:24] <eddyb> WindowsBunny: lol
[16:59:33] <kimundi> eddyb / cmr: How do I recognize a monomorphic ItemFn ?
[16:59:45] <eddyb> kimundi: no generics
[17:00:01] <eddyb> kimundi: uhm, there should be a function around for this
[17:00:37] <eddyb>         let needs_inline = tps_len > 0 || attr::requests_inline(&item.attrs);
[17:00:49] <eddyb>         let tps_len = generics.ty_params.len();
[17:00:52] <eddyb>       ast::ItemFn(ref decl, _, constness, _, ref generics, _) => {
[17:00:59] <eddyb> kimundi: in reverse order :D
[17:01:14] <eddyb> (there's no function, just check generics.ty_params)
[17:01:34] <kimundi> eddyb: okay, thanks :)
[17:05:45] <kimundi> eddyb: okay, maybe I took a wrong turn somewhere
[17:06:00] <kimundi> eddyb: I've got the ast item and check if its a non-generic function
[17:07:34] <kimundi> but now I'm syntax territory of course, so how do I get from the NodeId to the to-be-translated function pointer and its typeid...
[17:12:27] <eddyb> kimundi: get_item_val to get the function pointer
[17:13:04] <kimundi> eddyb: on what is that defined?
[17:13:19] <eddyb>                 let llfn = get_item_val(ccx, item.id);
[17:13:22] <eddyb> just like that
[17:13:32] <eddyb> oh but you n- crap :D
[17:13:58] <eddyb> you need an "extern" of some sort
[17:14:07] <kimundi> hm?
[17:14:11] <eddyb> because the function could be in any of the LLVM modules
[17:14:57] <kimundi> So I need to access all parallele CrateContexts?
[17:15:04] <kimundi> And search through them?
[17:15:39] <eddyb> no
[17:15:46] <kimundi> ok
[17:15:51] <eddyb> so you get the type with ty::node_id_to_type(tcx, id);
[17:16:41] <eddyb> that's pretty easy. to get the "TypeId" hash, you need to convert TyBareFn(Some(_), x) into TyBareFn(None, x)
[17:17:05] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Connection closed)
[17:17:33] <eddyb>  match ty.sty { ty::TyBareFn(Some(_), b) => ty::mk_bare_fn(cx, None, b)
[17:17:37] <eddyb> pretty much that
[17:19:56] <kimundi> eddyb: Okay, let me do that...
[17:20:56] <eddyb> to get the function pointer, we have to work backwards...
[17:21:23] *** Joins: eerie (eerie@moz-2u3428.red.bezeqint.net)
[17:22:58] <eddyb> kimundi: basically, declare::declare_fn
[17:23:22] <eddyb> but you can't really call it
[17:23:45] <eddyb> kimundi: you really only need a tiny bit of it
[17:23:47] <eddyb>         llvm::LLVMGetOrInsertFunction(ccx.llmod(), namebuf.as_ptr(), ty.to_ref())
[17:23:58] *** Joins: avikpal (avikpal@moz-v8s.nmd.238.117.IP)
[17:23:59] <eddyb> the llmod you already have, the rest is a bit trickier
[17:28:43] *** Quits: jincreator (Thunderbird@moz-588.igi.7.59.IP) (Ping timeout: 121 seconds)
[17:34:39] <kimundi> eddyb: So, I catched up in my code to your explanations :). I'm not sure what you want me to do in regard to declare_fn
[17:35:41] <kimundi> I'D call LLVMGetOrInsertFunction with my function type to get the function pointer?
[17:36:55] <kimundi> And for that I have to get the symbol name first?
[17:37:28] <kimundi> And gte a ty::FnOutput somehwo?
[17:41:42] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[17:43:16] <eddyb> kimundi: sorry, had to go for a bit
[17:43:30] <eddyb> kimundi: you need to run LLVMGetOrInsertFunction to create an "extern" declaration
[17:44:11] <eddyb>     let (sig, abi) = match fn_type.sty { ty::TyBareFn(_, ref f) => (&f.sig, f.abi)
[17:44:18] <kimundi> eddyb: And that would not happen automatically for the function?
[17:44:37] <eddyb> kimundi: you're in a module that cannot see any of the existing functions
[17:44:42] <eddyb> so you're "importing" them
[17:44:48] <kimundi> ah, okay
[17:44:55] <eddyb>     let llfty = type_of::type_of_rust_fn(ccx, None, &sig, abi);
[17:44:59] <eddyb> grr, this needs ccx, too
[17:45:25] <eddyb> kimundi: you might just have to make a LocalCrateContext for metadata and live with it :D
[17:45:48] <eddyb> but you have to be careful not to instantiate functions in it :/
[17:46:10] *** Joins: arielb1 (Ariel@moz-tiqc2l.red.bezeqint.net)
[17:46:28] *** Joins: elif (chatzilla@moz-ev8m1p.res.rr.com)
[17:46:28] <eddyb> OH
[17:46:44] <eddyb> kimundi: I know where to get the symbol name (the item_symbols map =)))
[17:47:00] <kimundi> eddyb: Okay, now I have to go for a few minutes, but please keep the help coming :)
[17:47:12] <eddyb> so you're left with only the LLVM type to figure out
[17:47:14] <kimundi> Ah, so its already saved somewhere?
[17:47:20] <eddyb> yes
[17:47:36] <kimundi> item_sybols is where?
[17:47:43] <eddyb> same crate_ctxt_to_encode_parms
[17:47:58] <kimundi> ah
[17:51:14] <kimundi> eddyb: Hm, theoretically I could probably just store the symbol name in the static, but having the function pointer directly is probably better :P
[17:54:23] *** Quits: harrisonclarke (harrisoncla@moz-th044a.ns.bellaliant.net) (Connection closed)
[17:56:53] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[17:59:55] *** Joins: dinfuehr (dinfuehr@moz-4ce95a.highway.telekom.at)
[18:05:39] <cmr> It'd be nice of `while let` and `if let` had an `else` that could bind a name to the temporary.
[18:07:02] <eddyb> kimundi: okay, so
[18:07:11] <eddyb> kimundi: technically you don't need the LLVM type
[18:07:29] <eddyb> you also don't need the "reachable" set or the ast_map, I don't think
[18:07:46] *** Quits: avikpal (avikpal@moz-v8s.nmd.238.117.IP) (Connection closed)
[18:07:54] <eddyb> kimundi: what you can do is iterate the item_symbols map
[18:08:24] <eddyb> which gets you symbol names and IDs. you can use the ID to get the type (from which you get the TypeId. still need to do match ty.sty { ty::TyBareFn(Some(_), b) => ty::mk_bare_fn(cx, None, b))
[18:09:12] <eddyb>         llvm::LLVMGetOrInsertGlobal(ccx.llmod(), namebuf.as_ptr(), ty.to_ref())
[18:11:05] <eddyb> kimundi: can just use llvm::LLVMInt8TypeInContext(llcx) for the last argument (without the to_ref call)
[18:12:03] <kimundi> eddyb: SO you put in a wrong type there, but it doesn't matter because that symbol should already exist?
[18:12:14] <eddyb> kimundi: no, it doesn't matter because it's an import
[18:12:19] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[18:12:23] <eddyb> and the linker doesn't care about the type
[18:12:35] <eddyb> you need a common type for all the tuples *anyways* :D
[18:12:55] <eddyb> and *const u8 felt like a good choice
[18:14:29] <kimundi> eddyb: So, what does LLVMGetOrInsertGlobal actually do?
[18:15:23] <eddyb> think extern { static FOO; }
[18:15:59] <kimundi> Is this for defining the static, or for accessing the individual function pointer?
[18:17:06] <kimundi> eddyb: Got to go for half an hour, but I'll definitely still have question what do when I get back :) 
[18:17:15] *** Quits: James_ (quassel@moz-8qs8a3.range86-148.btcentralplus.com) (Ping timeout: 121 seconds)
[18:17:22] *** Quits: eerie (eerie@moz-2u3428.red.bezeqint.net) (Connection closed)
[18:19:29] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[18:22:37] *** Quits: Rym (uid91135@moz-n2i7qm.charlton.irccloud.com) (Quit: Connection closed for inactivity)
[18:23:50] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[18:25:29] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[18:25:29] *** ChanServ sets mode: +ao erickt erickt
[18:26:56] <eddyb> kimundi: no, it's for getting an individual *import* pointer. it will work for statics and functions alike
[18:29:48] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[18:32:15] *** Quits: mukilan (mukilan@moz-5ke.d4s.164.122.IP) (A TLS packet with unexpected length was received.)
[18:33:37] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[18:39:25] *** Joins: eerie (eerie@moz-qld.8t4.67.109.IP)
[18:40:35] <WindowsBunny> acrichto: Actually, I'm going to push a really cool implementation of print_stats to my PR first
[18:40:42] <WindowsBunny> I just need to test it to make sure it works
[18:41:17] <acrichto> WindowsBunny: ok, but if it's like 1kloc it may not be worth it (this funciton is highly unlikely to ever survive stabilization in its current form)
[18:41:22] *** Quits: eerie (eerie@moz-qld.8t4.67.109.IP) (Connection closed)
[18:41:44] <WindowsBunny> acrichto: 32 lines of code
[18:41:48] <acrichto> nice
[18:41:58] <WindowsBunny> most of it is just hacking up a way to write to the console
[18:51:57] *** Joins: harrisonclarke (harrisoncla@moz-4oc07n.ns.bellaliant.net)
[18:54:22] *** Quits: dinfuehr (dinfuehr@moz-4ce95a.highway.telekom.at) (Connection closed)
[19:02:26] *** Quits: harrisonclarke (harrisoncla@moz-4oc07n.ns.bellaliant.net) (Connection closed)
[19:05:55] <WindowsBunny> acrichto: http://i.imgur.com/DboTSkc.png
[19:05:56] <WindowsBunny> :D
[19:07:34] <WindowsBunny> acrichto: nits addressed and stats_print implemented
[19:08:57] <WindowsBunny> Actually, I should probably use WriteFile
[19:09:04] <WindowsBunny> in case it's not a console but a pipe
[19:11:49] *** Joins: eerie (eerie@moz-qld.8t4.67.109.IP)
[19:11:59] <kimundi> eddyb: I'm back. What is "llcx"?
[19:12:40] *** Joins: harrisonclarke (harrisoncla@moz-4oc07n.ns.bellaliant.net)
[19:13:48] <eddyb> kimundi: there's a llcx and a llmod
[19:13:56] <eddyb> kimundi: you have both in write_metadata
[19:14:11] <WindowsBunny> acrichto: okay, now it should be good to go
[19:14:16] <eddyb> cx means "context" and mod means "module" and the ll prefix indicates they're LLVM things
[19:14:42] <kimundi> eddyb: Ah, cx.metadata_llcx() ?
[19:15:11] *** Joins: harrison_ (harrisoncla@moz-4oc07n.ns.bellaliant.net)
[19:15:15] *** Quits: harrisonclarke (harrisoncla@moz-4oc07n.ns.bellaliant.net) (Connection closed)
[19:15:47] *** Quits: harrison_ (harrisoncla@moz-4oc07n.ns.bellaliant.net) (Connection closed)
[19:15:51] <eddyb> kimundi: yupp
[19:16:01] *** Joins: harrisonclarke (harrisoncla@moz-4oc07n.ns.bellaliant.net)
[19:16:04] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[19:18:38] *** Quits: harrisonclarke (harrisoncla@moz-4oc07n.ns.bellaliant.net) (Connection closed)
[19:24:19] <kimundi> eddyb: Okay, now I presuambly have the llvm ValueRef for that function pointer, and the u64 that is the function pointers type_id. Now I need to find out the crate local path of the function item and start putting it into a array
[19:25:37] <kimundi> I assume that ValueRef is a placeholder for the actual generated value, and I'll use that with other llvm function for creating the array directly?
[19:26:05] <kimundi> (As in, I don't need to turn the ValueRef into something else first?)
[19:27:34] *** Joins: dinfuehr (dinfuehr@moz-4ce95a.highway.telekom.at)
[19:28:24] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Connection closed)
[19:28:35] *** Quits: chc4 (chc4@moz-mjph4c.ma.comcast.net) (Ping timeout: 121 seconds)
[19:29:59] <eddyb> ValueRef is the LLVM value handle that you pass off to C_struct or whatever
[19:30:34] <eddyb> ah, that's what you mean by "placeholder". I used "handle" above. but yeah, same thing :P
[19:30:46] <eddyb> kimundi: the path is the easiest of all 3
[19:30:54] <kimundi> I bet :)
[19:31:00] <kimundi> since its syntax stuff
[19:31:05] *** Quits: untitaker (untitaker@moz-naaq3a.highway.telekom.at) (Ping timeout: 121 seconds)
[19:31:10] <kimundi> I think?
[19:31:10] <eddyb> item_path_str(tcx, local_def(id))
[19:32:16] <eddyb> for the local crate case, yeah it is
[19:33:05] *** Joins: untitaker (untitaker@moz-hopl8n.highway.telekom.at)
[19:34:44] *** Joins: S1mplebrain (Simplebrain@moz-9h5lcb.skybroadband.com)
[19:35:05] *** Quits: summerlight (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[19:35:52] <kimundi> eddyb: Okay, now I have the three tuple components. How do I generate a static array of them?
[19:36:02] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[19:36:25] <eddyb> kimundi: have you used C_struct to create a ValueRef for the tuple?
[19:36:27] <kimundi> eddyb: Also, I get a type_id hashing problem later due to function pointers that contain TyInfer
[19:36:33] <kimundi> No
[19:36:45] <eddyb> uhm
[19:37:01] <eddyb> nothing in item_symbols should have TyInfer inside
[19:37:14] <kimundi> eddyb: let me reproduce...
[19:37:36] *** Quits: Simplebrain (Simplebrain@moz-9h5lcb.skybroadband.com) (Ping timeout: 121 seconds)
[19:38:56] <kimundi> eddyb: Heh, it chokes on u_str::Graphemes<'a>.Iterator::next
[19:39:15] <eddyb> hmm
[19:39:25] <eddyb> so it's the lifetime?
[19:39:28] <kimundi> internal compiler error: unexpected region found when hashing a type
[19:39:33] *** Quits: larhat1 (Adium@moz-vlo5br.cable.virginm.net) (Quit: Leaving.)
[19:39:47] <eddyb> yeah
[19:40:12] <eddyb> kimundi: try calling ty::erase_late_bound_regions on the type first
[19:42:37] <kimundi> eddyb: Not sure where to get the &Binder
[19:43:00] <eddyb> you could create it
[19:43:20] <eddyb> wait
[19:43:31] <eddyb> kimundi: there's also     let fn_type = monomorphize::normalize_associated_type(ccx.tcx(), &fn_type);
[19:43:38] <eddyb> maybe this is enough to clean that up
[19:45:02] *** Quits: semarie (semarie@moz-m7316u.ip-37-59-41.eu) (A TLS packet with unexpected length was received.)
[19:45:41] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Connection closed)
[19:47:00] *** Joins: erz (erz@moz-fiq1tl.broadband.corbina.ru)
[19:48:51] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[19:49:48] <kimundi> eddyb: Okay, that seems to work. Well, I'm not sure if it actaually works, but the ice gets not triggered anymore
[19:50:43] <kimundi> eddyb: Now I'm building me my array with the C_... functions. Can you tell me how I would turn the final ValueRef into a public reachable symbol?
[19:51:08] <eddyb> kimundi: write_metadata already does it :D
[19:51:33] <kimundi> ah, yeah can just copy that :D
[19:51:48] <eddyb> that uses its own section, fwiw
[19:52:09] <kimundi> I don't know the implications of that
[19:52:11] <eddyb> but it's pretty much LLVMAddGlobal and LLVMSetInitializer
[19:55:28] *** Quits: eerie (eerie@moz-qld.8t4.67.109.IP) (Connection closed)
[19:56:01] <eddyb> kimundi: you don't need to touch it, I don't think
[19:56:46] <kimundi> eddyb: So, it just goes together in the metadata section, which doesn't matter much for the dylib symbol itself?
[19:57:16] <eddyb> kimundi: I don't think you should touch the metadata section
[19:57:31] <kimundi> okay, then I misunderstood what you meant
[19:57:55] <eddyb> kimundi: for the metadata blob, it calls         llvm::LLVMSetSection(llglobal, name.as_ptr())
[19:57:59] <eddyb> kimundi: I think you shouldn't do that
[19:59:45] <kimundi> ah, okay
[20:03:42] *** Quits: dinfuehr (dinfuehr@moz-4ce95a.highway.telekom.at) (Connection closed)
[20:08:31] *** Joins: harrisonclarke (harrisoncla@moz-g1kp2c.ns.bellaliant.net)
[20:12:49] <kimundi> eddyb: Hm, how do I get a CrateContext if I just have the SharedCrateContext?
[20:13:31] <kimundi> ah wait, metadata__llcx and C_..._in_context, rigth?
[20:15:59] <kimundi> eddyb: Except that doesn'T work for anything but struct...
[20:16:26] <eddyb> struct and bytes and, well
[20:16:38] <eddyb> kimundi: you cand add versions of these for any kind of constant data you need
[20:16:45] <eddyb> *can add
[20:16:46] <kimundi> even u64 wants a CrateContext
[20:17:03] <kimundi> C_integral(Type::i64(ccx), i, false)
[20:17:29] <kimundi> not sure how to make that ccx just a llcx
[20:18:07] <eddyb> C_integral_in_context
[20:18:15] <eddyb> and then get the type yourself
[20:18:42] <eddyb> i64 is llvm::LLVMInt64TypeInContext(ccx.llcx())
[20:18:47] *** Joins: tamird (textual@moz-lat.dkr.14.50.IP)
[20:20:11] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[20:21:16] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[20:21:16] *** ChanServ sets mode: +o brson
[20:22:40] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[20:24:32] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[20:38:49] *** Quits: ytain (ytain@moz-pum3eh.dsl.teksavvy.com) (Quit: Textual IRC Client: www.textualapp.com)
[20:39:30] *** Quits: S1mplebrain (Simplebrain@moz-9h5lcb.skybroadband.com) (Quit: Leaving)
[20:40:53] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[20:48:21] *** Joins: nodweber (nodweber@moz-knt.fgq.178.5.IP)
[20:54:42] <kimundi> eddyb: Duplicating all thise C_ functions into in_context variants is not fun :(
[20:55:10] <kimundi> eddyb: Also, I'm uncovering more code that does not like not getting a CrateContext
[20:55:20] <kimundi> eddyb: How would you call C_uint?
[20:55:55] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[20:55:59] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[20:56:06] <kimundi> eddyb: It seems to terminate in a llvm::LLVMSizeOfTypeInBits(ccx.td().lltd, ty.to_ref()) and a ccx.int_type() call on
[20:57:06] *** Joins: larhat1 (Adium@moz-vlo5br.cable.virginm.net)
[20:59:12] *** Joins: Kingsquee (kingsley@moz-3fm07c.bchsia.telus.net)
[21:04:01] *** Joins: nodweber_ (nodweber@moz-knt.fgq.178.5.IP)
[21:07:19] *** Quits: nodweber (nodweber@moz-knt.fgq.178.5.IP) (Ping timeout: 121 seconds)
[21:08:34] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[21:08:41] *** Joins: bvssvni (sven@moz-8nopqv.bb.online.no)
[21:09:20] *** Joins: Layl (Layl@moz-65hqmf.direct-adsl.nl)
[21:13:10] <bvssvni> I have a question related to this http://is.gd/cf5iDO
[21:14:03] <bvssvni> one problem is that removing the type annotation as commented at the end triggers a “unused code” warning
[21:15:24] <bvssvni> another problem is that “pub trait Associated: OfBackend” and “impl<T> OfBackend for T where T: Associated” seems to be circular logic, which is correct either it compiles or not
[21:15:56] *** Quits: dcrewi (david@moz-3u3d5k.gyrae.net) (Ping timeout: 121 seconds)
[21:16:41] *** Quits: woboats (tatterdemal@moz-drj4d9.sndgca.sbcglobal.net) (Connection closed)
[21:20:48] *** Joins: p1start (p1start@moz-nftjhe.org)
[21:28:25] <arielb1> bvssvni: the dead_code warning is a known problem which I am working on fixing
[21:28:34] <arielb1> (it has more serious consequences)
[21:28:50] <bvssvni> arielb1: dead code elimination?
[21:28:55] <arielb1> no
[21:29:08] <arielb1> it is because we don't check associated types for well-formedness
[21:29:24] <arielb1> it's a bad bug
[21:29:38] <arielb1> the "circular logic" problem is how trait matching works
[21:29:47] <arielb1> trait matching is coinductive, not inductive
[21:30:01] <arielb1> this is required for Send/Sync to work with recursive ADT-s
[21:30:18] <eddyb> kimundi: why would you touch that?
[21:30:22] <eddyb> kimundi: C_str?
[21:30:29] <kimundi> eddyb: yes
[21:30:34] <eddyb> cah
[21:30:57] <eddyb> kimundi: you could make a dummy_ccx just for write_metadata
[21:30:59] <kimundi> eddyb: I just now realized that SHaredCrateContext has a get_ccx() -> CrateContext. Can I use that?
[21:30:59] <bvssvni> arielb1: thanks for the response, I was surprised there is a word for that
[21:31:06] <eddyb> but you have to be careful
[21:32:47] <kimundi> eddyb: Or does that jsut return one of the shards?
[21:33:13] <eddyb> kimundi: I'm not sure
[21:33:41] <eddyb>             local_ccx.int_type = Type::int(&local_ccx.dummy_ccx(shared));
[21:33:42] <eddyb> interesting
[21:34:23] <eddyb> kimundi: so, well
[21:34:31] <arielb1> bvssvni: https://en.wikipedia.org/wiki/Coinduction
[21:34:43] <bvssvni> arielb1: reading that now :)
[21:34:47] <arielb1> actually that's a bad article
[21:36:03] <eddyb> kimundi: look at the changes I made here https://github.com/rust-lang/rust/pull/26234
[21:36:18] <eddyb> kimundi: the part where the metadata llcx and llmod are created inside write_metadata
[21:36:53] <eddyb> kimundi: I think you should do LocalCrateContext::new(cx, "metadata").dummy_ccx()
[21:37:05] <arielb1> bvssvni: http://www.cs.cornell.edu/~kozen/papers/Structural.pdf is better but much longer
[21:37:10] <eddyb> kimundi: that will make your life much easier, but remember not to call anything that could instantiate functions
[21:37:30] <eddyb> kimundi: though you might now be able to use functions in trans::declare
[21:37:40] <bvssvni> arielb1: thanks!
[21:37:58] <eddyb> and, ofc, all the direct constant constructors and whatnot
[21:40:15] <kimundi> eddyb: So, should I do let (llcx, llmod) = context::create_context_and_module(&tcx.sess, "metadata"); as well, or just LocalCrateContext::new(cx, "metadata").dummy_ccx() for the C_ functions?
[21:40:34] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[21:44:54] <brson> is there any mode in rustc where it adds additional information to symbol names, such as type substitutions?
[22:02:48] *** Quits: xilec (Mibbit@moz-g6k.oht.161.46.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:07:41] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[22:08:24] <bluss> there is --pretty typed but I'm not sure how useful it is
[22:08:32] <bluss> every variable gets its type written out
[22:09:10] <bluss> every subexpression
[22:09:18] <eddyb> kimundi: the latter and remove the metadata_ll* stuff from trans::context
[22:10:00] <eddyb> kimundi: see how in my PR I made write_metadata return that ModuleTranslation thing?
[22:10:18] <kimundi> eddyb: yeah?
[22:10:36] <eddyb> I think you should maybe do that
[22:10:41] <eddyb> it might just work :D
[22:11:24] <eddyb> may want to put restructuring in its own commit. removing the C_*_in_context functions and whatnot
[22:12:38] <kimundi> eddyb: Do what, exactly? Refactor everything to use a ModuleTranslation-like abstraction like you and make all the C... functions take that instead of a crate context?
[22:13:15] *** Joins: bytewise (bytewise@moz-mkh5h4.hsi16.unitymediagroup.de)
[22:13:18] <eddyb> kimundi: nono
[22:13:24] <eddyb> kimundi: that's just what write_metadata returns
[22:13:42] <eddyb> kimundi: but the fact that SharedCrateContext knows nothing about metadata_ll*
[22:14:04] <eddyb> kimundi: so you can control the whole thing with a nice LocalCrateContext and a dummy_ccx from that, in write_metadata
[22:14:19] *** Joins: chc4 (chc4@moz-mjph4c.ma.comcast.net)
[22:14:43] <kimundi> <eddyb> kimundi: see how in my PR I made write_metadata return that ModuleTranslation thing?
[22:14:47] <kimundi> eddyb> I think you should maybe do that
[22:14:57] <kimundi> Not sure how to understand that :)
[22:15:22] <eddyb> kimundi: right now write_metadata modified the metadata_ll* stuff held by SharedCrateContext
[22:15:26] <kimundi> Or did that just refer to the "remove metadata_ll..." stuff?
[22:15:26] <eddyb> *modifies
[22:15:33] <eddyb> which means you can't replace it
[22:16:00] <kimundi> "replace it"?
[22:16:03] <eddyb> yeah
[22:16:07] <kimundi> replace what?
[22:16:21] <eddyb> replace metadat_ll{cx,mod} with a proper LocalCrateContext
[22:17:37] <kimundi> So, err still confused
[22:18:02] <eddyb> remove metadata_ll* from trans::context
[22:18:37] <kimundi> And then useh the "metadata" LocalContext instead?
[22:18:41] <eddyb> in write_metadata, create a LocalCrateContext and use its llcx and llmod instead
[22:18:45] <kimundi> okay
[22:18:59] <eddyb> it doesn't exist outside write_metadata. it doesn't already exist
[22:19:13] <eddyb> and either return it or return ModuleTranslation
[22:19:42] <eddyb> but you have to return something alongisde Vec<u8>, otherwise trans_crate doesn't have what to put in CrateTranslation
[22:20:23] *** bvssvni is now known as bvssvni_
[22:21:05] *** Quits: Skyler (Skyler@moz-dgl2bi.fios.verizon.net) (Client exited)
[22:23:14] *** Quits: chc4 (chc4@moz-mjph4c.ma.comcast.net) (Ping timeout: 121 seconds)
[22:24:59] *** Parts: Layl (Layl@moz-65hqmf.direct-adsl.nl) ("Leaving")
[22:31:38] *** Joins: chc4 (chc4@moz-mjph4c.ma.comcast.net)
[22:33:39] *** Joins: ryanhiebert (ryanhiebert@moz-nsd5kl.ks.cox.net)
[22:35:51] *** Quits: Jesin (Jesin@moz-t88s6v.cc.lehigh.edu) (Quit: Leaving)
[22:36:50] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[22:36:51] *** ChanServ sets mode: +ao erickt erickt
[22:41:49] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[22:43:20] <bstrie> aturon: ping
[22:47:04] *** Quits: munksgaard (munksgaard@moz-urnkl5.u.parknet.dk) (Ping timeout: 121 seconds)
[22:54:19] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[22:54:28] *** Quits: larhat1 (Adium@moz-vlo5br.cable.virginm.net) (Quit: Leaving.)
[22:57:37] *** Quits: rovar_ (rovar@moz-6iq.47m.88.38.IP) (Ping timeout: 121 seconds)
[23:04:22] *** Joins: Jesin (Jesin@moz-t88s6v.cc.lehigh.edu)
[23:07:34] <elif> issue report inspired by the coinduction discussion: https://github.com/rust-lang/rust/issues/26283
[23:08:03] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[23:19:06] <kimundi> eddyb: Hm, LocalCrateContext::new is a private function though... Is it meant to be constructed through some other emans?
[23:24:21] *** Quits: chc4 (chc4@moz-mjph4c.ma.comcast.net) (Ping timeout: 121 seconds)
[23:26:07] *** Joins: chc4 (chc4@moz-mjph4c.ma.comcast.net)
[23:27:42] *** Quits: arielb1 (Ariel@moz-tiqc2l.red.bezeqint.net) (Quit: Ex-Chat)
[23:30:15] *** Quits: chc4 (chc4@moz-mjph4c.ma.comcast.net) (Ping timeout: 121 seconds)
[23:35:03] *** Joins: capella-s32 (capella-s3@moz-vcqob4.res.rr.com)
[23:35:28] <eddyb> kimundi: ouch
[23:36:43] *** Quits: capella-s3 (capella-s3@moz-vcqob4.res.rr.com) (Ping timeout: 121 seconds)
[23:37:43] * kimundi has the feeling he went from bending the existing code to breaking it :P
[23:37:54] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[23:37:54] *** ChanServ sets mode: +ao erickt erickt
[23:38:04] <eddyb> kimundi: in that case, I'm not sure. maybe create a local context for metadata instead of llcx and llmod while still keeping it in SharedCrateContext
[23:38:32] *** Joins: capella-s3 (capella-s3@moz-sia.30o.87.66.IP)
[23:39:05] *** Quits: capella-s32 (capella-s3@moz-vcqob4.res.rr.com) (Ping timeout: 121 seconds)
[23:39:19] <kimundi> eddyb: Hm, that sounds a bit more sane
[23:39:36] <eddyb> I guess... :)
[23:40:38] *** Joins: Quxxy (chatzilla@moz-efh10q.internode.on.net)
[23:42:38] <kimundi> eddyb: Wheew, I got it to compile again... Right now just by making new() and dummy_ctx public
[23:42:41] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[23:42:48] <kimundi> ...though
[23:43:26] <kimundi> let see what happens during bootstrap...
[23:43:55] *** Quits: erz (erz@moz-fiq1tl.broadband.corbina.ru) (Quit: My Mac has gone to sleep. ZZZzzz…)
[23:45:41] *** Quits: capella-s3 (capella-s3@moz-sia.30o.87.66.IP) (Connection closed)
[23:46:39] *** Joins: capella-s3 (capella-s3@moz-sia.30o.87.66.IP)
[23:46:57] <kimundi> eddyb: Btw, while converting TyBareFn from Some(_) to None I also get functions in item_symbols that are function pointers to begin with
[23:47:35] <kimundi> eddyb: Should I just keep those unchanged?
[23:47:43] <kimundi> I guess so, but I'm not sure...
[23:47:46] <eddyb> that's odd
[23:47:59] <eddyb> kimundi: are they statics, by any chance?
[23:48:08] *** Joins: chc4 (chc4@moz-mjph4c.ma.comcast.net)
[23:50:41] *** Quits: capella-s3 (capella-s3@moz-sia.30o.87.66.IP) (Connection closed)
[23:50:43] *** Joins: capella-s3 (capella-s3@moz-sia.30o.87.66.IP)
[23:54:33] *** Quits: capella-s3 (capella-s3@moz-sia.30o.87.66.IP) (Connection closed)
[23:54:52] *** Joins: capella-s3 (capella-s3@moz-sia.30o.87.66.IP)
[23:56:06] *** Quits: chc4 (chc4@moz-mjph4c.ma.comcast.net) (Ping timeout: 121 seconds)
[23:58:55] *** Joins: capella-s32 (capella-s3@moz-sia.30o.87.66.IP)
[23:58:55] *** Quits: capella-s3 (capella-s3@moz-sia.30o.87.66.IP) (Error in the push function.)
[23:59:08] *** Quits: bytewise (bytewise@moz-mkh5h4.hsi16.unitymediagroup.de) (Quit: Quit)
