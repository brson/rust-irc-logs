[00:00:26] <arrrrrrrrr> reem: you can do it for Vec<T> which is pretty good already
[00:00:46] <huon> &out has *always* been used to describe write-only (or write-once) references
[00:00:48] <reem> It only works for types like Box
[00:00:53] <huon> in discussions about Rust
[00:01:02] <reem> which have a drain-like operation
[00:01:21] <arrrrrrrrr> huon: We've already renamed it to "&own" for now. Just haven't pushed yet.
[00:01:38] <arrrrrrrrr> huon: &move is problematic because &move || ..
[00:01:57] <arrrrrrrrr> reem: I guess most types that give you slices are like that?
[00:01:58] <huon> we can always have a special case ;P
[00:02:10] <huon> write &move (|| ... ) if you want that
[00:02:17] <arrrrrrrrr> ugh please no
[00:02:33] <arrrrrrrrr> ah, you mean in the move case
[00:02:34] <reem> arrrrrrrrr: I think the fundamental operation is &'a out Box<T> -> &'a out T and everything else can either be built safely atop that or unsafely but with those semantics under the hood
[00:02:42] <arrrrrrrrr> I thought you meant for moving closures in general
[00:02:58] <huon> &move || ... would be parsed as `&(move || ...)`
[00:03:08] <arrrrrrrrr> sounds reasonable
[00:04:42] <arrrrrrrrr> I've renamed the issue title three times now. this is getting ridiculous. damn bikeshedding
[00:10:57] <reem> I'd suggest just running with &own or &move and coming back to it once we've settled the semantics
[00:11:00] *** Joins: erickt (erickt@moz-lmug77.client.dsl.net)
[00:11:01] *** Quits: sprang (sprang@moz-d0kmvi.12d9.sm5v.0009.2601.IP) (Ping timeout: 121 seconds)
[00:12:25] <arrrrrrrrr> so the only downside right now is that you can't create &own slices with the convenient &out vec[..] syntax
[00:12:51] <arrrrrrrrr> I guess something like that is to be expected as long as Box has to be a special type
[00:13:11] *** Joins: sprang (sprang@moz-d0kmvi.12d9.sm5v.0009.2601.IP)
[00:14:04] *** Quits: mystor (mystor@moz-vpa.r78.15.130.IP) (Connection closed)
[00:14:30] *** Joins: mystor (mystor@moz-vpa.r78.15.130.IP)
[00:16:00] *** Joins: mib_s4rpd5 (Mibbit@moz-juv.9o3.252.72.IP)
[00:16:38] *** Quits: mib_s4rpd5 (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[00:19:35] <reem> arrrrrrrrr: I actually don't see why &'a own self -> &'a own T is problematic
[00:20:13] <reem> the cleanup desugaring will cleanup &'a own self at the end of 'a, after the &'a own T will be cleaned up
[00:21:02] *** Quits: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com) (Client exited)
[00:21:11] <reem> And then the only (original) safe source of &out T is from Box<T>
[00:25:00] <arrrrrrrrr> reem: you mean struct X { field: T } .. fn f(&own self) -> &own T ?
[00:25:16] <reem> yes
[00:25:33] <arrrrrrrrr> reem: that's not possible for the same reason it's not possible to move a single field out of a type with a destructor
[00:25:41] <arrrrrrrrr> reem: the destructor of X might try to access field
[00:25:51] <arrrrrrrrr> reem: it works if X does not have a destructor
[00:25:57] <reem> arrrrrrrrr: Ok, yes.
[00:26:18] <reem> arrrrrrrrr: Then you require a drain-like action from type with Drop
[00:26:23] <reem> which is really a take-like action
[00:27:49] <reem> arrrrrrrrr: I personally do not view it as a problem if you can't write a &own self -> &own T for types were you couldn't write self -> T
[00:28:11] <reem> excluding the whole DST story, which is different
[00:30:11] *** nrc|afk is now known as nrc
[00:30:12] *** Joins: violaceae (violaceae@moz-s3vd4e.u4is.n1v0.0007.2601.IP)
[00:30:14] *** Joins: mib_hczfzs (Mibbit@moz-juv.9o3.252.72.IP)
[00:30:29] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[00:30:30] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[00:30:43] *** Quits: mib_hczfzs (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[00:34:41] *** Joins: panitaliemom (Mibbit@moz-juv.9o3.252.72.IP)
[00:35:23] *** Quits: panitaliemom (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[00:36:32] <arrrrrrrrr> reem: it's just like you can't write &own self -> &own T
[00:36:36] <arrrrrrrrr> you just have to use unsafe code
[00:36:42] *** Quits: swgillespie (swgillespie@moz-upj.3un.220.167.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[00:37:30] <arrrrrrrrr> you have to manually run the parts of the destructor that don't touch your field and then forget the &own self
[00:40:21] *** Joins: sinclair (chatzilla@moz-o36q4q.xnet.co.nz)
[00:41:50] *** Quits: mystor (mystor@moz-vpa.r78.15.130.IP) (Connection closed)
[00:45:30] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Connection closed)
[00:47:35] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[00:49:29] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[00:49:33] *** Quits: erickt (erickt@moz-lmug77.client.dsl.net) (Ping timeout: 121 seconds)
[00:52:52] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[00:56:49] <brson> getting the doc tests to correctly declare the features they use is going to be a nightmare
[00:58:57] *** Quits: sinclair (chatzilla@moz-o36q4q.xnet.co.nz) (Quit: ChatZilla 0.9.91.1 [Firefox 36.0.1/20150305021524])
[00:59:14] <steveklabnik> heh :(
[00:59:27] <steveklabnik> brson: do you want help with that?
[01:00:31] *** Quits: kmcguire (kmcguire@moz-pg1gb9.biz.rr.com) (Ping timeout: 121 seconds)
[01:02:25] <brson> steveklabnik: hm, not yet. i still haven't figured out how to make it work at all. can't seem to add crate attributes to doc tests
[01:02:31] <steveklabnik> hmmm
[01:02:50] <steveklabnik> so
[01:02:55] <steveklabnik> there are many tests that have some variant of
[01:03:02] <steveklabnik> /// # #![allow(unused_must_use)]
[01:03:03] <steveklabnik> etc
[01:03:14] <steveklabnik> src/libstd/process.rs even has
[01:03:20] <steveklabnik> /// # #![feature(process)]
[01:03:23] <steveklabnik> so i'm assuming that works
[01:03:24] <brson> steveklabnik: i believe those do not map to crate attributes, but attributes on the main function
[01:04:02] <steveklabnik> huh
[01:04:09] <sfackler> brson: if you define your own main functino you can do it
[01:04:14] <steveklabnik> ahhh yes
[01:04:25] <steveklabnik> well
[01:04:28] <steveklabnik> even without it
[01:04:36] <steveklabnik> check out that process.rs
[01:05:00] <brson> sfackler: i don't think that's true either. frow what rustdoc is doing i think i have to write 'extern crate std' somewhere to keep it from injecting that as the first line of the output source
[01:05:07] <brson> these heuristics are pretty gnarly
[01:05:13] <steveklabnik> rustdoc could really use love
[01:05:28] <sfackler> oh yeah that oo
[01:05:29] <sfackler> too
[01:05:38] <huon> http://doc.rust-lang.org/nightly/book/documentation.html has the algorithm
[01:05:39] <brson> i'll probably update rustdoc to skip the first X lines that begin with #!
[01:05:42] <huon> "Here's the full algorithm:"
[01:07:22] *** Joins: alexchandel (Adium@moz-t0cgjo.sub-174-251-129.myvzw.com)
[01:09:00] <brson> hm, skipping X crate attributes only makes sense if there's a fn main and the entire thing doesn't get wrapped in main
[01:09:52] <brson> just unilateraly skipping #! attributes before inserting the main function will probably not break anything..
[01:10:19] <huon> I can't think of anything it would break
[01:10:20] <brson> we could also not wrap everything in main, and just insert main after the rest of the text
[01:10:50] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[01:11:15] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[01:11:34] <brson> oh, no we can't
[01:17:36] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[01:19:28] <bstrie> eddyb: given that types can (and *should*, ideally) be inferred, I'm wary about any proposal that would put type parameters in the same list as argument parameters
[01:31:04] *** Quits: brson (brson@moz-cfhap5.mtv2.mozilla.com) (Quit: leaving)
[01:31:20] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[01:31:20] *** ChanServ sets mode: +o pcwalton
[01:31:27] *** Joins: brson (brson@moz-ib4.pdv.48.37.IP)
[01:31:27] *** ChanServ sets mode: +o brson
[01:31:33] *** Joins: evanfarrar (evanfarrar@moz-dncs33.east.verizon.net)
[01:31:40] *** Quits: violaceae (violaceae@moz-s3vd4e.u4is.n1v0.0007.2601.IP) (Quit: Leaving)
[01:38:27] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[01:42:06] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[01:48:47] *** Quits: evanfarrar (evanfarrar@moz-dncs33.east.verizon.net) (Connection closed)
[01:48:52] *** Quits: Nekit1234007 (nekit@moz-vfr.64q.51.84.IP) (Quit: leaving)
[01:54:17] *** Quits: James (quassel@moz-5qldmp.range109-148.btcentralplus.com) (Ping timeout: 121 seconds)
[01:54:48] <arrrrrrrrr> is a module an "Item"?
[01:54:49] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Ping timeout: 121 seconds)
[01:54:51] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[01:58:23] *** Joins: evanfarrar (evanfarrar@moz-dncs33.east.verizon.net)
[01:58:40] <steveklabnik> http://doc.rust-lang.org/reference.html#items
[02:00:46] *** Quits: Diggsey (diggsey@moz-u3erf7.dsl.pipex.com) (Ping timeout: 121 seconds)
[02:13:08] *** Joins: umbridge (Mibbit@moz-juv.9o3.252.72.IP)
[02:13:39] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Connection closed)
[02:14:16] *** Quits: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt) (Ping timeout: 121 seconds)
[02:14:45] *** Quits: umbridge (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[02:16:28] *** Joins: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt)
[02:18:11] *** Quits: arrrrrrrrr (arrrrrrrrs@moz-6p13k2.dynamic.qsc.de) (Ping timeout: 121 seconds)
[02:21:00] *** Quits: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt) (Ping timeout: 121 seconds)
[02:21:01] *** Quits: {0}grant ({0}grant@moz-63ubas.in.charter.com) (Connection closed)
[02:22:11] *** Quits: brson (brson@moz-ib4.pdv.48.37.IP) (Quit: leaving)
[02:23:58] *** Joins: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt)
[02:28:48] *** Quits: evanfarrar (evanfarrar@moz-dncs33.east.verizon.net) (Connection closed)
[02:29:22] *** Quits: empoZ (empoZ@moz-ccitnk.priv.bahnhof.se) (Connection closed)
[02:34:42] *** Joins: kushal (kdas@moz-uootr6.redhat.com)
[02:34:55] *** Joins: evanfarrar (evanfarrar@moz-dncs33.east.verizon.net)
[02:35:13] *** Joins: reem (reem@moz-ujiea5.coob.q2h1.0009.2601.IP)
[02:35:29] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[02:35:29] *** ChanServ sets mode: +o pcwalton
[02:43:48] *** Quits: huseby (huseby@moz-3oh5i4.linuxprogrammer.org) (Ping timeout: 121 seconds)
[02:43:51] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[02:46:39] *** Quits: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt) (Ping timeout: 121 seconds)
[02:48:30] *** Joins: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt)
[02:48:50] *** Quits: zxq9 (ceverett@moz-c1f1em.asahi-net.or.jp) (Quit: Konversation terminated!)
[02:52:51] *** Joins: zxq9 (ceverett@moz-c1f1em.asahi-net.or.jp)
[02:55:03] *** Quits: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt) (Ping timeout: 121 seconds)
[02:56:24] *** Joins: ferminter (Mibbit@moz-juv.9o3.252.72.IP)
[02:56:30] *** Joins: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt)
[02:56:45] *** Quits: ferminter (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[03:02:25] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[03:02:25] *** ChanServ sets mode: +o pcwalton
[03:04:43] *** sunfish is now known as sunfish-away
[03:09:36] *** Quits: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt) (Ping timeout: 121 seconds)
[03:10:33] *** Quits: zeiris (zeiris@moz-8jbmam.letter.agency) (Ping timeout: 121 seconds)
[03:11:32] *** Joins: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt)
[03:14:28] *** Joins: zeiris (zeiris@moz-8jbmam.letter.agency)
[03:15:56] *** Quits: ^BR (br@moz-egk.dm6.194.78.IP) (Client exited)
[03:16:56] *** Joins: sinclair (chatzilla@moz-o36q4q.xnet.co.nz)
[03:17:46] *** Quits: reem (reem@moz-ujiea5.coob.q2h1.0009.2601.IP) (Connection closed)
[03:18:05] *** Quits: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt) (Ping timeout: 121 seconds)
[03:18:24] *** Joins: _zxq9_ (ceverett@moz-qsm369.mesh.ad.jp)
[03:19:33] *** Joins: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt)
[03:21:05] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[03:22:24] *** Quits: evanfarrar (evanfarrar@moz-dncs33.east.verizon.net) (Connection closed)
[03:24:15] *** Joins: evanfarrar (evanfarrar@moz-dncs33.east.verizon.net)
[03:24:18] *** Joins: ^BR (br@moz-egk.dm6.194.78.IP)
[03:25:13] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Ping timeout: 121 seconds)
[03:27:42] *** Quits: evanfarrar (evanfarrar@moz-dncs33.east.verizon.net) (Connection closed)
[03:29:12] *** Joins: evanfarrar (evanfarrar@moz-dncs33.east.verizon.net)
[03:34:40] *** Quits: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt) (Ping timeout: 121 seconds)
[03:36:34] *** Joins: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt)
[03:39:16] *** Joins: joneshf-laptop (joneshf@moz-l4h.b5s.208.98.IP)
[03:41:59] *** Quits: kimundi (kimundi@moz-sbftss.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[03:42:40] *** Joins: lfairy (lfairy@moz-l99gu1.vf.net.nz)
[03:43:28] *** Joins: kimundi (kimundi@moz-ere.cfn.188.87.IP)
[03:47:27] *** kimundi is now known as zz_kimundi
[03:48:45] *** Joins: jdm (jdm@moz-6sq.tjp.175.184.IP)
[03:49:52] *** Quits: evanfarrar (evanfarrar@moz-dncs33.east.verizon.net) (Connection closed)
[03:50:36] *** Joins: evanfarrar (evanfarrar@moz-dncs33.east.verizon.net)
[03:52:08] *** Quits: japaric (japaric@moz-663.3tp.232.190.IP) (Ping timeout: 121 seconds)
[03:54:23] *** zz_kimundi is now known as kimundi
[03:57:51] *** Quits: ^BR (br@moz-egk.dm6.194.78.IP) (Client exited)
[04:01:46] *** Quits: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt) (Ping timeout: 121 seconds)
[04:03:36] *** Joins: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt)
[04:08:21] *** Joins: japaric (japaric@moz-663.3tp.232.190.IP)
[04:12:40] *** Quits: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt) (Ping timeout: 121 seconds)
[04:14:37] *** Joins: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt)
[04:19:09] *** Quits: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt) (Ping timeout: 121 seconds)
[04:19:54] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[04:21:37] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[04:21:37] *** Joins: jxs (joaoxsouls@moz-odlbq5.fcsh.unl.pt)
[04:22:32] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[04:27:34] *** Joins: semarie (semarie@moz-slkb3c.torproxy-readme-arachnide-fr-35.fr)
[04:30:28] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[04:33:01] <sfackler> this seems like a spurious error, right? http://buildbot.rust-lang.org/builders/auto-linux-32-nopt-t/builds/4031/steps/test/logs/stdio
[04:41:10] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[04:44:37] *** Quits: evanfarrar (evanfarrar@moz-dncs33.east.verizon.net) (Ping timeout: 121 seconds)
[04:47:25] *** Quits: alexchandel (Adium@moz-t0cgjo.sub-174-251-129.myvzw.com) (Ping timeout: 121 seconds)
[04:49:20] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Connection closed)
[04:52:54] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[04:53:29] *** Joins: alexchandel (Adium@moz-g08lia.sub-174-251-128.myvzw.com)
[04:55:18] *** Quits: alexchandel (Adium@moz-g08lia.sub-174-251-128.myvzw.com) (Quit: Leaving.)
[05:06:44] *** Joins: p1start (p1start@moz-nftjhe.org)
[05:09:00] *** Joins: mystor_ (mystor@moz-ldavpp.home3.cgocable.net)
[05:09:00] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Connection closed)
[05:18:48] <eddyb> bstrie: did you not read the whole thing
[05:18:57] <eddyb> bstrie: anything that can be inferred is optional
[05:19:20] <eddyb> bstrie: nor is it a serious Rust 1.x proposal
[05:20:40] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[05:21:06] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Connection closed)
[05:24:58] *** Quits: O01eg (o01eg@moz-lg9g0t.f537.4n8f.2698.2a02.IP) (Client exited)
[05:25:55] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[05:26:52] *** Quits: mortisha (Mibbit@moz-g6k.oht.161.46.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[05:32:24] *** Quits: mystor_ (mystor@moz-ldavpp.home3.cgocable.net) (Connection closed)
[05:32:48] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Connection closed)
[05:34:26] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[05:34:57] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[05:40:25] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Connection closed)
[05:41:20] <sfackler> acrichto: aww, ices blocking iteratorext removal :( https://gist.github.com/sfackler/5aff7c57cf8d896e2c6f
[05:41:21] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Connection closed)
[05:43:56] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Connection closed)
[05:45:48] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[05:52:17] *** Quits: jdm (jdm@moz-6sq.tjp.175.184.IP) (Quit: )
[06:04:47] <eddyb> sfackler: what do you mean "removal"?
[06:05:22] <sfackler> eddyb: inlining into Iterator
[06:05:31] <eddyb> where Self: Sized?
[06:05:34] <sfackler> ya
[06:05:37] <eddyb> cool!
[06:05:45] <sfackler> death to Ext!
[06:06:07] <eddyb> impl char { fn is_alpha(self) -> bool {...} }
[06:06:11] <eddyb> :P
[06:06:54] <eddyb> sfackler: those ICEs look like might be caused by a single unimplemented feature in middle::traits, but I can't tell more from the error messages
[06:07:19] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[06:07:30] <eddyb> sfackler: do you have `where Self: Clone` on some method?
[06:07:48] <sfackler> there is one on Cycle, yeah
[06:08:01] <sfackler> which is where that span points
[06:08:14] <sfackler> er, cycle the method not cycle the struct
[06:08:29] <eddyb> hmm
[06:08:57] <sfackler> i'm rerunning with rust_backtrace right now
[06:09:25] <eddyb> sfackler: it kinda looks like trans is trying to get the impl for `Self: Clone` but middle::traits doesn't support extented where clauses entirely
[06:10:00] <eddyb> typeck succeeded, so maybe some information is just missing later on. or there's a normalization that has to be done
[06:10:23] <sfackler> the clone bound was always there, all that I added was the sized bound interestingly
[06:10:36] <eddyb> sfackler: uh oh
[06:10:43] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[06:11:06] <eddyb> sfackler: is it Clone+Sized now?
[06:11:12] <sfackler> yep
[06:11:23] <eddyb> try Self: Clone, Self: Sized
[06:11:34] <sfackler> eddyb: https://github.com/rust-lang/rust/pull/23300/files#diff-ced4ae040c5c8672d936a581401ef9ceR960
[06:11:41] <sfackler> will do
[06:12:29] <eddyb> I mean, at this point, trans's treatment of Self: Clone shouldn't be affected by Self: Sized, unless they end up mangled together
[06:12:48] <sfackler> here's a backtrace: https://gist.github.com/sfackler/83a9ff84340f54e6cb77
[06:13:05] <eddyb> sfackler: that's pretty much what I expected
[06:13:35] <eddyb> since you have a span, the backtrace is largely useless (you can't tell where the error originates)
[06:14:55] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[06:15:01] <eddyb> sfackler: there's two occurrences of ty::BoundSized => Err(Unimplemented)
[06:15:06] <eddyb> and... I know why
[06:15:24] <eddyb> sfackler: or I think I do. there's no impl for Sized :P
[06:15:49] <sfackler> ha
[06:16:29] <eddyb> wait
[06:16:45] <eddyb> sfackler: I'm very confused about what Unimplemented means and I recall doing this before
[06:17:04] <eddyb> it means the trait is not implemented *sigh*
[06:17:58] <eddyb> sfackler: why is trans not printing the type that caused the error?
[06:18:45] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Ping timeout: 121 seconds)
[06:19:08] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Ping timeout: 121 seconds)
[06:34:16] *** Quits: njn (chatzilla@moz-i76q70.iinet.net.au) (Quit: ChatZilla 0.9.91.1 [Firefox 39.0a1/20150309142159])
[06:36:37] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[06:40:57] <sfackler> no dice on splitting Sized+Clone out
[06:41:21] <eddyb> sfackler: make trans to also print the type it gave to middle::traits, in those errors
[06:41:36] <eddyb> sfackler: I don't have other ideas, sorry
[06:44:30] <huon> [17:06:07] <eddyb> impl char {
[06:44:39] <huon> japaric has a patching implementing that
[06:45:12] *** Joins: eerie_ (eerie@moz-nbbdu3.red.bezeqint.net)
[06:45:12] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Connection closed)
[06:46:02] <japaric> eddyb: huon http://japaric.github.io/inherent/unicode/primitive.char.html
[06:46:19] *** Joins: guewen (guewen@moz-ftf7u4.cust.swisscom.ch)
[06:46:29] <huon> so cool :)
[06:48:32] *** Joins: larhat1 (Adium@moz-eou.8og.232.213.IP)
[06:49:35] *** Quits: larhat (Adium@moz-9vj.vcf.204.37.IP) (Connection closed)
[06:50:41] *** nrc is now known as nrc|afk
[06:54:27] <eddyb> wait what?
[06:54:40] <eddyb> huon: without #[lang="char"] enum char {}?
[06:54:57] <eddyb> japaric: we need to sync workload :D
[06:55:04] <huon> eddyb: the author themselves is here
[06:55:11] <huon> (i.e. ask them :) )
[06:55:17] <japaric> eddyb: with #[lang = "char"] impl char { .. }
[06:55:26] *** Joins: bjz (bjz@moz-4l6.mjm.52.113.IP)
[06:56:13] <eddyb> japaric: I have started on associated consts, which are required to remove the "associated modules" for number primitives in std::num
[06:56:22] *** Quits: bjz (bjz@moz-4l6.mjm.52.113.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[06:56:30] <eddyb> japaric: technically, they could also be inherent impls, but there's already a couple of good traits to use
[06:56:33] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[06:57:01] <japaric> eddyb: oh nice, we can throw the constants in the inherent impls
[06:57:16] <eddyb> japaric: except we have Integer/Float
[06:57:22] <japaric> Int and Float are going to be removed or moved out of crate
[06:57:30] <eddyb> that's... rough :|
[06:57:35] *** Joins: bjz (bjz@moz-4l6.mjm.52.113.IP)
[06:57:37] <japaric> (or at least that's what aturon has in mind)
[06:57:42] <eddyb> japaric: but yeah, that can work
[06:57:57] <eddyb> japaric: also, are you doing the same inherent impl thing for str? in that case, there's a few free functions that could be static methods
[06:58:16] <eddyb> playbot: str::as_slice("foo")
[06:58:18] -playbot- "foo"
[06:58:32] <eddyb> japaric: no need to manually import std::str then :D
[06:58:51] <huon> i thought someone else was working on associated constants
[06:58:55] <japaric> eddyb: there are impls for [T], str, char, {i,u}{8,16,32,64,size}, *const T, and *mut T
[06:59:24] <eddyb> huon: if they are, they didn't make it public, AFAIK
[06:59:59] <eddyb> I have repeatedly bugged aturon and acrichto about amending the RFC to explicitely say const, and I've stated I'm working on that feature
[07:00:14] <eddyb> huon: also, if they are, all their code will break due to my prereq refactoring
[07:00:22] <huon> someone submitted an RFC for s/static/const/
[07:00:25] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[07:00:28] <eddyb> either that or they did similar refactoring themselves
[07:00:31] <eddyb> huon: uhm...
[07:00:32] <huon> but it's literally jsut that naive replacement
[07:00:54] <huon> there's not really that much value in it
[07:00:56] * huon shrugs
[07:01:27] <eddyb> huon: I'm not seeing it
[07:02:01] <huon> I believe the person working on assoc consts is the author of https://github.com/rust-lang/rfcs/pull/884
[07:02:22] <huon> https://github.com/rust-lang/rfcs/pull/865
[07:02:23] <eddyb> ugh
[07:02:51] <eddyb> I had no way to see that
[07:03:19] <huon> ah, yes: [08:27:54] <quantheory> I'm trying to implement associated constants, and I have a question.
[07:03:36] <eddyb> huon: when was that?
[07:04:45] <eddyb> hmm
[07:04:46] <huon> don't know
[07:04:49] <eddyb> there's no way they got far with it
[07:04:51] <huon> check botbot
[07:05:03] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[07:05:07] <huon> because only eddyb is good enough to implement it?
[07:05:18] <eddyb> I only have a clue because I messed with nmatsakis' code
[07:05:27] *** Quits: bjz (bjz@moz-4l6.mjm.52.113.IP) (Ping timeout: 121 seconds)
[07:05:31] <eddyb> but I'm not even sure I can do it without rewriting a lot of typeck code
[07:05:46] <eddyb> huon: no, because the compiler is not ready for it
[07:06:56] <huon> maybe they're making the compiler ready?
[07:07:53] <eddyb> huon: I wouldn't mind being impressed - I should've said "most likely they didn't get far with it"
[07:09:19] <eddyb> huon: thing is, neither of aturon and acrichto knew about that s/static/const RFC, AFAICT
[07:09:44] <huon> we discussed it in triage, as I remember
[07:09:47] <eddyb> and pnkfelix didn't know it's a 1.0 blocker
[07:09:51] <eddyb> huon: uh oh
[07:09:55] <eddyb> then... they didn't remember?
[07:10:06] <huon> the intention is s/static/const/
[07:10:09] <huon> we are humans, not machines
[07:10:14] <huon> we understand that the RFC is meaning const
[07:10:22] <eddyb> oops, I got the s/// wrong
[07:10:26] <huon> but we do not go over all old RFCs to update them
[07:10:39] <huon> for language changes
[07:10:41] <eddyb> huon: are those triage meetings recorded?
[07:10:57] <huon> we're not going to not implement associated constants just because the RFC only says `static`.
[07:11:06] <huon> they're not
[07:11:28] <huon> any closing comments generally contain a summary of what was said
[07:11:39] <eddyb> right, but I had no way of knowing the RFC even existed
[07:12:18] <huon> so?
[07:12:54] <huon> it'd be great to have summary pages like "recently opened RFCs" etc.
[07:12:59] <huon> but still...
[07:14:58] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[07:15:21] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[07:15:31] <eddyb> I'm not mad at anyone, fwiw, just wishing there chance of this happening was lower
[07:16:41] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[07:19:26] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Ping timeout: 121 seconds)
[07:24:12] *** Quits: eerie_ (eerie@moz-nbbdu3.red.bezeqint.net) (Connection closed)
[07:24:31] *** Quits: untitaker (untitaker@moz-0kb2h3.highway.telekom.at) (Ping timeout: 121 seconds)
[07:24:33] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[07:26:45] <simukis> sigh, Deref trait output type requires reference -.-
[07:28:19] <eddyb> huon: does this look condescending in any way? https://github.com/rust-lang/rfcs/pull/865#issuecomment-78434781
[07:28:27] *** Joins: mw (mw@moz-f1s7jp.vie.surfer.at)
[07:28:32] *** Quits: Gankro (uid71432@moz-sc2bd6.charlton.irccloud.com) (Quit: Connection closed for inactivity)
[07:28:36] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Ping timeout: 121 seconds)
[07:29:58] *** Joins: untitaker (untitaker@moz-n9v0fd.highway.telekom.at)
[07:32:19] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[07:34:53] *** Joins: dudel (dud@moz-55rvi2.dclient.hispeed.ch)
[07:36:48] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[07:37:55] *** Quits: lfairy (lfairy@moz-l99gu1.vf.net.nz) (Connection closed)
[07:38:56] *** Joins: bjz (bjz@moz-puppgq.tpgi.com.au)
[07:39:42] *** Joins: TheHydroImpulse (TheHydroImp@moz-r25mqk.ed.shawcable.net)
[07:42:22] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[07:44:32] *** Joins: James (quassel@moz-t5os7p.range86-163.btcentralplus.com)
[07:46:39] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Ping timeout: 121 seconds)
[07:46:58] *** Quits: larhat1 (Adium@moz-eou.8og.232.213.IP) (Quit: Leaving.)
[07:48:42] *** Quits: japaric (japaric@moz-663.3tp.232.190.IP) (Quit: WeeChat 1.1.1)
[07:50:28] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[07:51:02] *** Quits: mw (mw@moz-f1s7jp.vie.surfer.at) (Client exited)
[07:52:21] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Connection closed)
[07:52:42] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[07:55:33] *** Quits: James (quassel@moz-t5os7p.range86-163.btcentralplus.com) (Ping timeout: 121 seconds)
[07:55:57] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[07:56:44] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Ping timeout: 121 seconds)
[07:57:45] *** Quits: eddyb (eddyb@moz-mmq.pug.25.188.IP) (Quit: Konversation terminated!)
[07:57:48] *** Joins: eddyb_ (eddyb@moz-mmq.pug.25.188.IP)
[08:02:13] *** Quits: eddyb_ (eddyb@moz-mmq.pug.25.188.IP) (Ping timeout: 121 seconds)
[08:02:41] *** Joins: Tobba|Laptop (Tobba@moz-1hh.7ki.21.217.IP)
[08:10:53] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[08:11:45] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[08:13:57] *** Quits: bjz (bjz@moz-puppgq.tpgi.com.au) (Connection closed)
[08:15:41] *** Joins: Sindriava (textual@moz-5h093g.fit.cvut.cz)
[08:15:45] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[08:16:09] *** Quits: Sindriava (textual@moz-5h093g.fit.cvut.cz) (Connection closed)
[08:17:22] *** Joins: bjz (bjz@moz-puppgq.tpgi.com.au)
[08:18:02] *** Joins: imperio (Mibbit@moz-psdrik.rev.sfr.net)
[08:18:23] <imperio> bors has worked on the first shot. That's a first for me :')
[08:19:48] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Ping timeout: 121 seconds)
[08:25:35] *** Joins: Diggsey (diggsey@moz-u3erf7.dsl.pipex.com)
[08:26:28] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[08:26:44] *** Quits: kushal (kdas@moz-uootr6.redhat.com) (Quit: Leaving)
[08:30:39] *** Joins: reem (reem@moz-1i55fb.coob.q2h1.0009.2601.IP)
[08:30:59] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[08:34:35] *** Joins: zmack (zmack@moz-b26i0b.home.aster.pl)
[08:38:25] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[08:39:59] *** Joins: simukis (nagisa@moz-pol184.mif.vu.lt)
[08:43:06] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[08:45:06] *** Quits: reem (reem@moz-1i55fb.coob.q2h1.0009.2601.IP) (Connection closed)
[08:45:11] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[08:47:28] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Ping timeout: 121 seconds)
[08:51:02] *** Joins: killercup (killercup@moz-lar.9pk.10.91.IP)
[09:00:51] *** Joins: Nekit1234007 (nekit@moz-vfr.64q.51.84.IP)
[09:06:14] *** Joins: munksgaard (munksgaard@moz-bcl.hq0.225.130.IP)
[09:06:18] *** Quits: cyndis (cyndis@moz-bmdn13.kapsi.fi) (Ping timeout: 121 seconds)
[09:07:09] *** Joins: ptalbot (ptalbot@moz-1gn7gb.eu0n.jcdj.0660.2001.IP)
[09:16:06] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[09:20:09] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Ping timeout: 121 seconds)
[09:20:35] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[09:20:50] *** Joins: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net)
[09:20:51] *** ChanServ sets mode: +o pnkfelix
[09:23:23] *** Joins: laumann (laumann@moz-bcl.hq0.225.130.IP)
[09:23:52] *** Quits: laumann (laumann@moz-bcl.hq0.225.130.IP) (Quit: leaving)
[09:25:06] *** Joins: Guest63 (textual@moz-qfs.570.70.83.IP)
[09:25:09] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[09:25:09] *** Quits: nrc|afk (nrc@moz-4bhi2i.xtra.co.nz) (Ping timeout: 121 seconds)
[09:25:23] *** Joins: arrrrrrrrr (arrrrrrrrs@moz-6p13k2.dynamic.qsc.de)
[09:26:20] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Connection closed)
[09:27:37] *** Joins: reem (reem@moz-pus16t.coob.q2h1.0009.2601.IP)
[09:33:35] *** Joins: cyndis (cyndis@moz-bmdn13.kapsi.fi)
[09:36:40] *** Joins: laumann (thomas@moz-bcl.hq0.225.130.IP)
[09:39:18] *** Quits: simukis (nagisa@moz-pol184.mif.vu.lt) (Client exited)
[09:41:48] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[09:48:26] <munksgaard> In expr_use_visitor, is there a good way to see what caused a callback to consume? Say I have `let x = foo(y)`, I'm getting a callback that y is consumed, but is there any way to know that it was caused by a call to foo?
[09:49:22] <munksgaard> The ConsumeMode only says what kind of consume it was, and it doesn't look like the cmt contains any useful information in that regard, but perhaps I can find the "parent" of the nodeId?
[09:49:36] <huon> I think the ast map offers that
[09:49:44] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[09:50:18] <huon> the map field of a tcx
[09:51:21] <huon> looks like `tcx.map.get_parent(id)` should work
[09:51:32] <munksgaard> huon: Ah yes, I'll take a look at that. Thanks
[09:56:58] *** Joins: simukis (nagisa@moz-pol184.mif.vu.lt)
[10:01:50] *** Quits: Guest63 (textual@moz-qfs.570.70.83.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[10:01:51] *** Joins: Guest63 (textual@moz-qfs.570.70.83.IP)
[10:01:52] *** Quits: Guest63 (textual@moz-qfs.570.70.83.IP) (Connection closed)
[10:03:38] <munksgaard> huon: Hm, it looks like that's the id of the parent function(/item perhaps?). As in the .get_parent() of the x in `foo(x)` in `fn bar(x) { foo(x); }` refers to the function bar, and not to foo
[10:03:49] <huon> munksgaard: oh
[10:03:52] <huon> sorry for misleading you
[10:04:02] <munksgaard> huon: No worries :)
[10:04:07] <huon> I don't know the real answer to your question in that case :)
[10:06:45] *** Joins: eibwen (eibwen@moz-i37.e5n.231.217.IP)
[10:09:12] *** Quits: Tobba|Laptop (Tobba@moz-1hh.7ki.21.217.IP) (Ping timeout: 121 seconds)
[10:14:45] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[10:16:27] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[10:17:51] *** Joins: larhat (Adium@moz-8v4.af0.232.213.IP)
[10:19:17] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[10:20:32] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Ping timeout: 121 seconds)
[10:26:14] *** Joins: Tobba|Laptop (Tobba@moz-1hh.7ki.21.217.IP)
[10:27:35] *** Quits: reem (reem@moz-pus16t.coob.q2h1.0009.2601.IP) (Connection closed)
[10:28:11] *** Quits: ctennis (ctennis@moz-vcpg3c.in.comcast.net) (Quit: Linkinus - http://linkinus.com)
[10:29:20] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[10:33:26] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Ping timeout: 121 seconds)
[10:42:03] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[10:43:03] *** Joins: Guest63 (textual@moz-qfs.570.70.83.IP)
[10:45:41] <simukis> error: use of unmarked library feature ðŸ˜’
[10:47:11] *** Quits: killercup (killercup@moz-lar.9pk.10.91.IP) (Connection closed)
[10:47:38] *** Joins: killercup (killercup@moz-lar.9pk.10.91.IP)
[10:57:25] *** Joins: ctennis (ctennis@moz-vcpg3c.in.comcast.net)
[10:58:01] *** Joins: kmcguire (kmcguire@moz-pg1gb9.biz.rr.com)
[10:58:15] *** Joins: eddyb_ (eddyb@moz-6g5.iqr.166.109.IP)
[11:07:09] <simukis> we still have no other solution other than unsafe_destructor for generic Drop impls?
[11:08:54] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[11:10:56] *** Joins: ^BR (br@moz-egk.dm6.194.78.IP)
[11:12:12] <eddyb_> simukis: just put the attribute on, it only silences the compiler
[11:12:42] <eddyb_> (and be prepared to maybe adjust the impl when it will be removed)
[11:13:26] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[11:16:51] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[11:19:23] *** Quits: eddyb_ (eddyb@moz-6g5.iqr.166.109.IP) (Ping timeout: 121 seconds)
[11:20:58] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Ping timeout: 121 seconds)
[11:23:53] <Manishearth> munksgaard: what do you want to do?
[11:24:33] <Manishearth> if you want to ignore certain methods of consumption, might want to do that at the consumption site (or add another mode)
[11:27:18] *** Quits: Tobba|Laptop (Tobba@moz-1hh.7ki.21.217.IP) (Ping timeout: 121 seconds)
[11:27:20] *** Quits: barosl (barosl@moz-7vg.qma.67.220.IP) (Connection closed)
[11:29:43] *** Quits: killercup (killercup@moz-lar.9pk.10.91.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[11:32:20] <simukis> hmm, do we store `drop` or more precisely any trait method into vtable?
[11:32:36] <huon> what do you mean?
[11:33:00] *** Joins: barosl (barosl@moz-7vg.qma.67.220.IP)
[11:33:18] <simukis> ok, let me rephrase. Do we store any methods (impled via trait or not) into object vtable at all, or rely on static dispatch all the time?
[11:38:16] <huon> trait objects rely on vtables
[11:38:29] <huon> http://doc.rust-lang.org/nightly/book/static-and-dynamic-dispatch.html#dynamic-dispatch
[11:38:37] <simukis> ok
[11:38:48] <arrrrrrrrr> how large are the vtables in rustc?
[11:38:48] *** Quits: simukis (nagisa@moz-pol184.mif.vu.lt) (Connection closed)
[11:38:54] *** Joins: simukis (nagisa@moz-pol184.mif.vu.lt)
[11:38:59] <Manishearth> huon: hey, that's copypasta from your post :P
[11:39:04] <simukis> thanks!
[11:43:12] *** Quits: simukis (nagisa@moz-pol184.mif.vu.lt) (Ping timeout: 121 seconds)
[11:44:04] <kimundi> arrrrrrrrr: Do you mean, what is their memory layout?
[11:44:23] <arrrrrrrrr> how large are they in the binary
[11:45:34] <huon> in the actual compiler?
[11:45:47] <arrrrrrrrr> assuming static linking
[11:45:59] <kimundi> N + 1 pointer large for each type-trait instance that provides N methods
[11:46:09] <huon> why do you want to know the size of the vtables used in the compiler?
[11:46:29] <arrrrrrrrr> to see the impact of vtables on binary size
[11:46:51] <huon> doesn't seem like a very useful measure
[11:47:25] <arrrrrrrrr> if the compiler is 1M and 500k of that are vtables then that seems like very useful info
[11:47:28] <huon> it's not like one can just outright remove them
[11:47:31] <Manishearth> huon: are they stored as a vtable per trait that is objected, or a vtable per trait combination
[11:47:32] <huon> and get the same functionality
[11:47:34] <Manishearth> ?
[11:47:55] <Manishearth> eg, if I use a Box<Foo> and Box<Bar>, will a Box<Foo+Bar> create a new vtable?
[11:47:56] <kimundi> Manishearth: one vtable per trait and type implementing the trait
[11:47:59] <huon> AFAIK, they're lazily generated as needed
[11:48:12] <kimundi> Manishearth: Box<Foo+Bar> is not actually valid
[11:48:17] <huon> Box<Foo+Bar> isn't possible with non-trivial traits
[11:48:21] <Manishearth> kimundi: really?
[11:48:24] <Manishearth> But we use that
[11:48:28] <Manishearth> nontrivial = ?
[11:48:32] <huon> has methods
[11:48:35] <Manishearth> ah
[11:48:36] <kimundi> Manishearth: We use it for Send and Sync
[11:48:36] <Manishearth> lol
[11:48:40] <Manishearth> yeah we do too
[11:48:45] <arrrrrrrrr> huon: how does upcasting traits work? does every vtable contain pointers to super-vtables?
[11:48:50] <huon> Send, Sync etc. don't have method, so the interesting content of the vtables are empty
[11:48:53] <huon> arrrrrrrrr: can't
[11:48:59] <kimundi> Manishearth: However, if you have a trait that inherits from both Foo and Bar, it will create a fresh vtable containing all of ther methods
[11:49:00] *** Joins: killercup (killercup@moz-lar.9pk.10.91.IP)
[11:49:10] <kimundi> arrrrrrrrr: It doesn'T work
[11:49:11] <Manishearth> kimundi: ah
[11:49:19] <kimundi> arrrrrrrrr: Not possible right now
[11:49:21] <arrrrrrrrr> huon: &T as &Trait1 as &Trait2 doesn't work even if T: Trait1: Trait2?
[11:49:27] <kimundi> arrrrrrrrr: yes
[11:49:29] <huon> arrrrrrrrr: yes, it doesn't work
[11:49:47] <kimundi> I want that to work though :P
[11:49:58] <huon> in any case, if we were to remove the dynamic dispatch from rustc, we would be replacing it with static dispatch
[11:50:08] *** Joins: theme (theme@moz-i3mhhb.asianet.co.th)
[11:50:17] <huon> which often results in larger binary sizes
[11:50:19] *** Quits: killercup (killercup@moz-lar.9pk.10.91.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[11:50:30] <theme> After inspecting the source code of the stdlib sort(), I suspect a bug
[11:50:35] <huon> there have been accidental huge regressions because of it
[11:50:38] <theme> can anybody test this on a 32-bit machine for me?
[11:50:39] <huon> theme: code?
[11:51:11] *** Joins: mib_to4amp (Mibbit@moz-juv.9o3.252.72.IP)
[11:51:19] <theme> just sort an array/vec with length larger than 2^31
[11:51:27] <huon> can't have an array that large
[11:51:31] <kimundi> heh
[11:51:46] <theme> huon, I thought the limit is 2^32
[11:51:59] <huon> that's the absolute upper limit, yes
[11:52:04] <huon> but e.g. the OS steals a pile
[11:52:14] <huon> and also Rust defines the maximum object size to be isize::MAX
[11:52:20] <kimundi> theme: For all matters and purposes, anything above 2^31 on 32 bit and 2^63 will a) not work correctly, and b) impossible to create in practice
[11:52:20] <theme> wtf O_o
[11:52:36] <huon> what's the bug you were suspecting?
[11:52:49] <kimundi> Heck, for 64 bit only 48 bit address are valid today
[11:52:51] <theme> cast from usize to isize in the sort
[11:53:00] <theme> SliceExt::sort()
[11:53:36] <huon> theme: you mean libcollections::slice::merge_sort?
[11:53:40] <theme> yes
[11:53:43] *** Quits: ctennis (ctennis@moz-vcpg3c.in.comcast.net) (Quit: Leaving...)
[11:54:03] <huon> but yeah, that'd break j > size the comparison, I guess
[11:54:08] <huon> *the j > size
[11:54:51] <kmcguire> kimundi, :p 64-bit are valid, only pathway to ram is limited :p
[11:54:52] * theme looks for more overflows
[11:55:04] <kmcguire> lest i hope
[11:55:28] *** Quits: mib_to4amp (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[11:55:31] <kimundi> kmcguire: i guess, yeah
[11:58:09] <imperio> btw, has someone added the under/overflow in std::num (I'm thinking about the pow function) ?
[12:00:32] <theme> btw I didn't expect the stdlib to use mergesort
[12:00:44] <theme> and I didn't expect that mergesort to be non-recursive
[12:00:47] <huon> what did you expect?
[12:00:55] <theme> huon, some quicksort variant
[12:01:15] <huon> merge sort has the benefits of stability and guaranteed O(n log n) behaviour, no edge cases
[12:01:23] <huon> (that's why it was chosen anyway)
[12:01:47] <huon> it probably makes sense to have a "unstable_sort" or something that can be faster/not allocate
[12:01:50] <imperio> and it's really simple to implement. However, not recursive ? I have to see the code ! A link please ?
[12:02:57] <huon> https://github.com/rust-lang/rust/blob/master/src/libcollections/slice.rs#L1349
[12:02:57] *** Quits: Guest63 (textual@moz-qfs.570.70.83.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[12:03:02] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[12:03:30] *** Joins: ctennis (ctennis@moz-su6.e72.137.99.IP)
[12:04:27] <imperio> huon: why not using a recursive approach on this sort ?
[12:04:51] <huon> non-recursive is more controlled
[12:04:57] *** Joins: dinfuehr (dinfuehr@moz-t870pb.highway.telekom.at)
[12:05:05] <theme> O_o
[12:05:05] *** Quits: dinfuehr (dinfuehr@moz-t870pb.highway.telekom.at) (Connection closed)
[12:05:16] <huon> specifically, fixed stack usage
[12:05:20] <theme> I guess it's more efficient
[12:05:27] <theme> but it's just hard to read
[12:05:28] <huon> not necessarily
[12:05:30] <imperio> hum... For the stack I can understand
[12:05:39] <theme> and do we really have to use unsafe?
[12:05:41] <huon> I didn't actually do a comparison, though
[12:05:46] <huon> yes, it's faster
[12:06:09] <huon> I was careful write a relatively detailed safety proof
[12:06:13] <imperio> it's almost always faster in the iterative way
[12:07:00] <huon> and write a rigorous panic safety test "src/test/run-pass/vector-sort-panic-safe.rs"
[12:07:36] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[12:08:22] <theme> huon, does that work with, say, a comparison function that returns randomly?
[12:08:59] <huon> I don't think it would cause unsafety
[12:09:09] <huon> but yes, that's not covered by the proof very well
[12:10:20] <huon> that is, I believe all the indexing is always in bounds, no matter what the comparison function is doing
[12:10:33] <huon> but the proof does not explicitly mention this case
[12:10:53] <theme> huon, can you think of any algorithms that can speed up by assuming sane comparisons?
[12:11:07] <theme> huon, https://github.com/rust-lang/rfcs/pull/956#issuecomment-78267980
[12:11:13] <theme> the reason I asked ^
[12:11:32] <arrrrrrrrr> does VecDeque has a method to create one contiguous slice?
[12:11:33] <huon> I don't know of a concrete implementation that is faster with the assumptions, off the top of my head
[12:12:38] <theme> huon, quicksort that goes out-of-bounds with crazy comparisons?
[12:12:43] <theme> like, x != x
[12:12:49] <huon> possibly
[12:13:00] <huon> I just don't know of an actual implementation demonstrating it
[12:13:13] <huon> me saying yes would just be "I guess it might be possible"
[12:13:26] <huon> which isn't so useful.
[12:13:29] <kimundi> Hm, do vtables actually contain size and alignment now?
[12:13:37] <huon> yes
[12:13:53] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[12:14:11] <theme> huon, the implementations with two indices running from left to right and right to left?
[12:14:23] <theme> could that run off the array?
[12:16:04] * theme gets back to his work
[12:16:10] <kimundi> playbot: trait Foo { fn bar(&self) {} } impl Foo for (u16, u16) {} let x = &(0u16, 0u16) as &Foo; let (&y, _): (&(usize, usize, usize, usize), usize) = unsafe { std::mem::transmute(x) }; y
[12:16:11] -playbot- (0, 0, 0, 0)
[12:16:31] <huon> kimundi: e.g. the -O0 [asm] of http://is.gd/RYoekt
[12:16:36] <huon> has vtable4: and vtable41:
[12:16:37] <kimundi> playbot: trait Foo { fn bar(&self) {} } impl Foo for (u16, u16) {} let x = &(0u16, 0u16) as &Foo; let (&y, _): (&(usize, usize, usize, usize), usize) = unsafe { std::mem::transmute(x) }; (y, x.bar())
[12:16:38] -playbot- ((0, 0, 0, 0), ())
[12:16:56] <huon> the vtable is the second agument
[12:17:01] <kimundi> playbot: trait Foo { fn bar(&self) {} } impl Foo for (u16, u16) {} let x = &(0u16, 0u16) as &Foo; let (_, &y): (&(usize, usize, usize, usize), usize) = unsafe { std::mem::transmute(x) }; (y, x.bar())
[12:17:02] -playbot- output truncated; full output at: http://bit.ly/1Mu3VKL
[12:17:09] <kimundi> huon: Arg, I always mix that up :P
[12:17:14] <huon> playbot: trait Foo { fn bar(&self) {} } impl Foo for (u16, u16) {} let x = &(0u16, 0u16) as &Foo; let (_, &y): (usize, &(usize, usize, usize, usize),) = unsafe { std::mem::transmute(x) }; (y, x.bar())
[12:17:15] -playbot- ((140424545379232, 4, 2, 140424545379248), ())
[12:17:16] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[12:17:37] <kimundi> Okay, interesting
[12:18:18] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Ping timeout: 121 seconds)
[12:19:20] *** Quits: Levans (levans@moz-usvfnf.safaradeg.net) (Quit: Server reboot.)
[12:20:34] <theme> playbot: trait Foo { fn bar(&self) {} } impl Foo for (u16, u16) {} let x = &(0u16, 0u16) as &Foo; let (y, _): (usize, &(usize, usize, usize, usize),) = unsafe { std::mem::transmute(x) }; (y, x.bar())
[12:20:36] -playbot- (140233145061184, ())
[12:20:58] <theme> playbot: trait Foo { fn bar(&self) {} } impl Foo for (u16, u16) {} let x = &(0u16, 0u16) as &Foo; let y: (usize, &(usize, usize, usize, usize),) = unsafe { std::mem::transmute(x) }; (y, x.bar())
[12:20:59] -playbot- ((139868148749440, (139868148528432, 4, 2, 139868148528448)), ())
[12:21:18] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Ping timeout: 121 seconds)
[12:21:20] * theme got a psudo-random number generator
[12:24:46] *** Quits: theme (theme@moz-i3mhhb.asianet.co.th) (Quit: Leaving)
[12:25:57] *** Joins: Levans (levans@moz-usvfnf.safaradeg.net)
[12:41:22] *** Joins: Sindriava (textual@moz-ca79jq.broadband10.iol.cz)
[12:50:10] *** Quits: Skyler (Skyler@moz-e93b35.sd.cox.net) (Connection closed)
[12:52:31] *** Joins: eddyb_ (eddyb@moz-mmq.pug.25.188.IP)
[12:55:05] *** Joins: larhat1 (Adium@moz-8v4.af0.232.213.IP)
[12:57:12] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[12:57:57] *** Quits: larhat (Adium@moz-8v4.af0.232.213.IP) (Ping timeout: 121 seconds)
[13:00:54] *** Joins: nagisa_mibbit (Mibbit@moz-7gm.nmh.219.193.IP)
[13:00:59] <nagisa_mibbit> huon: ping
[13:01:44] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[13:02:05] *** Joins: Guest63 (textual@moz-qfs.570.70.83.IP)
[13:08:25] *** Joins: ytain (ytain@moz-lt66g9.dsl.teksavvy.com)
[13:09:06] *** Joins: mw (mw@moz-f1s7jp.vie.surfer.at)
[13:15:42] *** Joins: dinfuehr (dinfuehr@moz-t870pb.highway.telekom.at)
[13:16:47] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[13:16:49] <nagisa_mibbit> huon: unping
[13:17:36] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[13:19:45] *** Quits: dinfuehr (dinfuehr@moz-t870pb.highway.telekom.at) (Ping timeout: 121 seconds)
[13:21:43] *** Quits: Kxepal (Miranda@moz-i6vigq.pppoe.mtu-net.ru) (Ping timeout: 121 seconds)
[13:21:43] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Ping timeout: 121 seconds)
[13:27:45] *** Joins: kushal (kdas@moz-9s6.akp.200.118.IP)
[13:27:48] *** Joins: Kxepal (Miranda@moz-i6vigq.pppoe.mtu-net.ru)
[13:28:17] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[13:32:25] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Ping timeout: 121 seconds)
[13:38:30] *** Joins: jdm (jdm@moz-mu9.06r.98.75.IP)
[13:43:13] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[13:45:43] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Connection closed)
[13:46:35] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[13:51:23] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[13:55:55] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[13:56:04] *** Quits: kushal (kdas@moz-9s6.akp.200.118.IP) (Ping timeout: 121 seconds)
[13:56:19] *** Joins: kushal (kdas@moz-9s6.akp.200.118.IP)
[14:06:06] *** Quits: dudel (dud@moz-55rvi2.dclient.hispeed.ch) (Ping timeout: 121 seconds)
[14:06:57] <barosl> lol that unping
[14:10:27] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[14:14:15] <^BR> Not strictly rust internals, but there seem to be a current documentation webserver misconfiguration that leads to failed server authentication
[14:23:35] <nagisa_mibbit> http://is.gd/0YvfTv very annoying this doesnâ€™t work
[14:36:36] <arrrrrrrrr> nmatsakis: ping
[14:36:38] *** eddyb_ is now known as eddyb
[14:37:00] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[14:37:54] *** Quits: ptalbot (ptalbot@moz-1gn7gb.eu0n.jcdj.0660.2001.IP) (Ping timeout: 121 seconds)
[14:38:27] *** Joins: killercup (killercup@moz-lar.9pk.10.91.IP)
[14:40:46] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Quit: Leaving)
[14:41:51] <imperio> nagisa_mibbit: https://play.rust-lang.org/?code=use%20std%3A%3Aio%3A%3A%7Bself%2C%20ReadExt%7D%3B%0A%0Afn%20main()%20%7B%0A%20%20%20%20for%20char%20in%20io%3A%3Astdin().lock().bytes()%20%7B%20%0A%20%20%20%20%20%20%20%20println!(%22%7B%3A%3F%7D%22%20%2C%20char.unwrap())%3B%20%0A%20%20%20%20%7D%0A%7D
[14:41:58] <arrrrrrrrr> imperio: there is a share link
[14:42:00] <arrrrrrrrr> *button
[14:42:00] <imperio> sorry, bad link
[14:42:11] <imperio> http://is.gd/E9slaW
[14:42:28] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Connection closed)
[14:42:28] <imperio> arrrrrrrrr: I thought I clicked on it...
[14:42:45] <arrrrrrrrr> imperio: but the link appears at the bottom not in your url bar, or does it?
[14:42:49] <arrrrrrrrr> at least in chrome
[14:43:10] <imperio> arrrrrrrrr: at first I did copy the url then I so the share button
[14:43:30] <imperio> but I think I didn't click well on it so not the good link
[14:43:45] <arrrrrrrrr> share copies to your clipboard?
[14:44:03] <arrrrrrrrr> not on linux
[14:44:03] <doener> XMPPwocky: I just noticed that the jemalloc related changes you made to llvm didn't actually handle the "noalias" part for je_mallocx. Trying to fix that now
[14:45:05] *** Joins: scialex (scialex@moz-j5mi8i.cs.brown.edu)
[14:45:09] <nagisa_mibbit> imperio: thatâ€™s also annoying
[14:45:15] <arrrrrrrrr> when are the nightlies compiled?
[14:45:20] <nagisa_mibbit> at night
[14:45:27] <arrrrrrrrr> makes sense
[14:45:30] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[14:45:37] *** Joins: Guest63_ (textual@moz-6gq.t8s.78.166.IP)
[14:46:05] <arrrrrrrrr> >rustc 1.0.0-nightly (2fc8b1e7c 2015-03-07) (built 2015-03-08
[14:46:10] <arrrrrrrrr> ugh, no time
[14:46:20] <imperio> nagisa_mibbit: Yep but that's not like we have the choice for the moment...
[14:47:30] *** Joins: summerlight_ (summerlight@moz-99k.2mj.130.121.IP)
[14:48:08] <nagisa_mibbit> imperio: Iâ€™m complaining because itâ€™s not like weâ€™ll ever have any choice ever, if somebody doesnâ€™t complain with motivating examples.
[14:48:26] *** Quits: Guest63 (textual@moz-qfs.570.70.83.IP) (Ping timeout: 121 seconds)
[14:48:40] <nagisa_mibbit> s/somebody doesnâ€™t/nobody does/
[14:48:44] <nagisa_mibbit> sigh english
[14:49:11] <imperio> If you're motivated enough, then do a PR
[14:49:21] <imperio> You'll have my support =D
[14:50:02] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[14:50:35] <nagisa_mibbit> imperio: this touches upon variable lifetimes, is generally a hairy topic and also an integral part of the rust language therefore would require a long RFC with all kinds of sweet words in it.
[14:51:08] <SimonSapin> Getting "error: constant evaluation error: can't cast this type" when rust-upgrading code like ValueType::STRING as u32 , where ValueType is an enum. Is there a replacement for this?
[14:51:23] <nagisa_mibbit> hmm, maybe we could make lock take `self` by valueâ€¦?
[14:52:13] <imperio> instead of reference ? Why not
[14:52:38] *** Joins: killercu_ (killercup@moz-lar.9pk.10.91.IP)
[14:54:08] *** Quits: Sindriava (textual@moz-ca79jq.broadband10.iol.cz) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[14:55:47] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[14:56:11] *** Quits: killercup (killercup@moz-lar.9pk.10.91.IP) (Ping timeout: 121 seconds)
[14:59:09] <arrrrrrrrr> how do you get elements out of a Box<[T]>?
[15:00:52] <WindowsBunny> oh hey, the queue is empty
[15:01:29] <arrrrrrrrr> so the last merge was eight hours ago
[15:01:35] <arrrrrrrrr> was the nightly built before or after that?
[15:02:58] <nagisa_mibbit> imperio: nope, we canâ€™t do that, sadly
[15:03:47] <imperio> nagisa_mibbit: however, do you know why lock() and StdinLock have appeared ?
[15:06:08] <arrrrrrrrr> nope, before
[15:06:08] *** Quits: killercu_ (killercup@moz-lar.9pk.10.91.IP) (Connection closed)
[15:06:18] <nagisa_mibbit> imperio: sure, they reduce hazard of interleaved writes from multiple threads to the stdout/err and reads from stdin to zero.
[15:06:35] *** Joins: killercup (killercup@moz-lar.9pk.10.91.IP)
[15:06:52] *** Joins: japaric (japaric@moz-663.3tp.232.190.IP)
[15:07:08] <imperio> ok
[15:07:20] <imperio> I can't wait to have a fully work print! stuff
[15:07:37] <imperio> the flush function is missing :'(
[15:08:12] * nagisa_mibbit notes, that this is something that would be easily solved by keeping an &own inside a lock.
[15:08:20] <nagisa_mibbit> imperio: flush on what, stdin?
[15:08:26] <nagisa_mibbit> that makes no sense.
[15:08:33] <imperio> no
[15:08:36] <imperio> on print!
[15:08:52] <imperio> for example I was doing print!("> ") to have a prompt
[15:09:02] <imperio> but it didn't print until I write a "\n"
[15:09:03] <nagisa_mibbit> just flush std::io::stdout() or std::old_io::stdout()
[15:09:10] <nagisa_mibbit> oh wait.
[15:09:25] <imperio> I had to do my stuff with stdio::write
[15:09:25] *** Quits: jdm (jdm@moz-mu9.06r.98.75.IP) (Quit: )
[15:09:29] <imperio> very annoying
[15:09:43] <nagisa_mibbit> yeah, previous impl of print{,ln}! is broken
[15:09:55] <imperio> write(format!("my stuff {}", stuff).as_bytes())
[15:09:57] <imperio> that's horrible
[15:13:13] <munksgaard> Is there an easy way to make tests like those in test/compile-fail for my own library?
[15:13:40] <steveklabnik> nope :(
[15:13:44] <steveklabnik> we'd like to ship a thing
[15:13:47] <steveklabnik> but not yet
[15:14:07] <munksgaard> :(
[15:14:22] <munksgaard> I guess it does a lot of parsing of the input files and the output at the moment?
[15:14:30] <nmatsakis> arrrrrrrrr: you pinged me?
[15:14:41] <munksgaard> steveklabnik: ^
[15:14:52] <steveklabnik> i don't remember the details
[15:14:57] <nagisa_mibbit> imperio: thereâ€™s write!(stdout(), "{} fmt string", args, args, etc);
[15:15:15] <imperio> nagisa_mibbit: I didn't know that, erf...
[15:15:30] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[15:15:51] <arrrrrrrrr> nmatsakis: would you like to shepherd my owned references RFC?
[15:16:02] <arrrrrrrrr> tl;dr: references you can move out of
[15:17:51] <nagisa_mibbit> arrrrrrrrr: by the way I mostly managed to implement owned references in a library, except for unsized objects. apparently &<Unsized> and Box<Unsized> are treated specially in the compielr
[15:17:56] <nagisa_mibbit> compiler*
[15:18:15] <arrrrrrrrr> nagisa_mibbit: show me the code
[15:19:54] <arrrrrrrrr> https://github.com/rust-lang/rfcs/pull/965#issuecomment-78488539
[15:20:05] <arrrrrrrrr> ^ definitive motivation and requirements for owned references
[15:20:05] <nagisa_mibbit> arrrrrrrrr: uhh, I think I lost it to the edits trying to make it work on unsized objects
[15:20:55] <arrrrrrrrr> nagisa_mibbit: was it able to create an owned reference to the content of a Box?
[15:20:58] <arrrrrrrrr> sized
[15:21:26] <nmatsakis> arrrrrrrrr: let me read it over; though I am rather wary of adding more kinds of refs and types right now
[15:21:40] <arrrrrrrrr> nmatsakis: if you read anything read the post I linked above
[15:23:48] <munksgaard> What can realistically be in the lhs of an ExprAssign? surely not ExprIfs, ExprCalls and such?
[15:25:03] <WindowsBunny> acrichto aturon: When considering the effects of symbolic links on various operations, refer to this page for a good overview https://msdn.microsoft.com/en-us/library/windows/desktop/aa365682%28v=vs.85%29.aspx
[15:26:50] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[15:27:33] *** Quits: zmack (zmack@moz-b26i0b.home.aster.pl) (Connection closed)
[15:27:43] <nagisa_mibbit> arrrrrrrrr: https://gist.github.com/nagisa/6e98742dfe0e07dd0533 is some iteration I could undo to and which works somewhat OK.
[15:27:55] *** Joins: zmack (zmack@moz-b26i0b.home.aster.pl)
[15:28:37] <arrrrrrrrr> nagisa_mibbit: it move the object. that's not possible
[15:28:59] <arrrrrrrrr> if you only have it for sized and you move it, then it gives us nothing new
[15:29:06] <arrrrrrrrr> you can already move sized objects by value
[15:29:19] <nagisa_mibbit> arrrrrrrrr: exactly.
[15:29:27] <arrrrrrrrr> nagisa_mibbit: then read the post I linked above
[15:29:36] <arrrrrrrrr> it exlpains why that's not good enough
[15:29:41] <nagisa_mibbit> like I said, I couldnâ€™t make it work for unsized, because it literally is treated specially inside the compiler
[15:30:47] <nagisa_mibbit> so it is basically either another data point why your RFC should be implemented or why we should cough up a way to not treat unsized objects specially.
[15:31:50] *** Quits: Kxepal (Miranda@moz-i6vigq.pppoe.mtu-net.ru) (Ping timeout: 121 seconds)
[15:32:11] *** Joins: jdm (jdm@moz-j1lnh9.ckpj.s0pt.0450.2001.IP)
[15:33:24] *** Joins: Kxepal (Miranda@moz-2lokhb.pppoe.mtu-net.ru)
[15:34:44] *** Joins: huseby (huseby@moz-3oh5i4.linuxprogrammer.org)
[15:34:57] <arrrrrrrrr> Box<[T]> seems to be missing an IntoIterator implementation
[15:35:07] *** Quits: huseby (huseby@moz-3oh5i4.linuxprogrammer.org) (Client exited)
[15:35:50] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[15:36:18] *** Joins: huseby (huseby@moz-3oh5i4.linuxprogrammer.org)
[15:39:42] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[15:39:51] <SimonSapin> arrrrrrrrr: try .into_vec?
[15:39:56] <SimonSapin> .into_vec()
[15:40:23] <arrrrrrrrr> not a fan
[15:42:18] <XMPPwocky> would be nicer with &move
[15:42:42] <arrrrrrrrr> XMPPwocky: the name we're going with is &own now
[15:42:48] <arrrrrrrrr> because it owns the thing it's referencing
[15:43:00] <arrrrrrrrr> XMPPwocky: Box<T> is an owning pointer, &own T is an owning reference
[15:43:21] <arrrrrrrrr> well for ~T that would have been called owning pointer
[15:43:24] <arrrrrrrrr> now it's just Box
[15:44:12] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[15:44:17] <Manishearth> arrrrrrrrr: owning pointer vs owning reference -- in lover level terms, what's the difference?
[15:44:47] <arrrrrrrrr> Manishearth: Box<T> owns the memory T is stored in. &own T only owns the T. You can construct an &own T from a Box<T> or a stack allocated T.
[15:45:03] <Manishearth> ah
[15:45:09] <kimundi> So basically, for a &own you still have a lifetime?
[15:45:26] <Manishearth> something like a sum type of T and Box T?
[15:45:33] <arrrrrrrrr> kimundi: yes. it's the lifetime of the memory where the T is stored. since you only own the T but not the memory
[15:45:35] <Manishearth> which is just a pointer
[15:45:37] <Manishearth> hm
[15:46:19] <kimundi> Manishearth: Basically a &mut T that you can move out of, and that has additional machnery to make sure that the memory location it points at can handle being moved-from
[15:46:36] <Manishearth> arrrrrrrrr: I feel that placement new might be able to provide enough tools to make such an abstraction
[15:46:39] <Manishearth> maybe
[15:46:43] <arrrrrrrrr> https://gist.github.com/anonymous/f1fef1861c958363ac89
[15:46:48] <kimundi> Manishearth: Different direction :P
[15:46:55] <arrrrrrrrr> this turns the [T] contained in a Vec<T> into an owned slice
[15:47:09] <Manishearth> kimundi: ?
[15:47:10] <arrrrrrrrr> quite similar to .drain(..) but you don't lose the slice structure
[15:47:38] <kimundi> Manishearth: placement deals with moving in, &own deals with moving out
[15:48:16] <Manishearth> kimundi: yeah, but the machinery in the proposal might create support for both
[15:48:22] <kimundi> maybe
[15:48:26] *** Joins: Gankro (uid71432@moz-sc2bd6.charlton.irccloud.com)
[15:48:41] <Manishearth> kimundi: technically we could create a version of Box (if it wasn't baked into the language) with a lifetime
[15:49:02] <Manishearth> and that might get us closer to &own
[15:49:22] <kimundi> Box still owns its memory allocation though
[15:49:37] <Manishearth> kimundi: adt version of box, perhaps
[15:49:45] <Manishearth> or something
[15:50:05] <Manishearth> But, like nmatsakis, I'm wary of adding new reference types
[15:59:36] <XMPPwocky> please can we not have "own" a keyword
[16:01:06] *** Joins: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net)
[16:04:44] <nagisa_mibbit> XMPPwocky: I believe it doesnâ€™t require a keyword, but it would make error messages confusing for `&own` then
[16:05:28] <arrrrrrrrr> XMPPwocky: *sigh*. we've gone through &move, &out, &own. maybe &owned?
[16:05:34] <aturon> eddyb: huon: I think I wasn't at that the triage meeting regarding the s/static/const RFC
[16:05:46] <XMPPwocky> ~T is a thing
[16:06:15] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Ping timeout: 121 seconds)
[16:06:26] <aturon> eddyb: and yes, it's frustrating how hard it can be to ensure people don't repeat work -- it would be nice to have some centralized way to track, but I'm not sure what it would be
[16:06:38] <eddyb> aturon: that explains half of it, thanks. and yeah, that's my biggest concern
[16:06:50] <eddyb> aturon: we used to have an etherpad for this... but it was dead in less than a month :(
[16:07:22] <aturon> eddyb: in principle, this could be done on the tracking issue for associated items, which i think still has a checkbox for this,
[16:07:28] <aturon> but more generally it's hard to even know where to look
[16:07:39] <aturon> (sorry, i meant checkbox for assoc consts)
[16:08:37] *** Quits: imperio (Mibbit@moz-psdrik.rev.sfr.net) (Quit: http://www.mibbit.com ajax IRC Client)
[16:09:49] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[16:09:51] *** Quits: nagisa_mibbit (Mibbit@moz-7gm.nmh.219.193.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[16:10:00] *** Quits: kushal (kdas@moz-9s6.akp.200.118.IP) (Ping timeout: 121 seconds)
[16:10:13] *** Joins: kushal (kdas@moz-9s6.akp.200.118.IP)
[16:14:37] *** Joins: brson (brson@moz-cfhap5.mtv2.mozilla.com)
[16:14:37] *** ChanServ sets mode: +o brson
[16:17:08] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[16:18:14] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[16:18:35] <eddyb> aturon: we need dashboards
[16:19:07] <eddyb> github's filtering is too weak to be able to support anything interesting for most of us :(
[16:19:33] <aturon> eddyb: if we could break it down by area -- per module of std, lang features, compiler internals, tooling, docs, etc -- it might work
[16:19:49] <eddyb> hmm, we do have labels
[16:19:49] <aturon> eddyb: i would love to see something like that
[16:19:50] *** Quits: munksgaard (munksgaard@moz-bcl.hq0.225.130.IP) (Ping timeout: 121 seconds)
[16:19:54] <eddyb> let me try something
[16:19:59] *** Joins: blaenk_ (blaenkdenum@moz-em283u.res.rr.com)
[16:20:14] <Manishearth> eddyb: http://benjamin.smedbergs.us/weekly-updates.fcgi/
[16:20:16] <Manishearth> -ish
[16:20:21] <Manishearth> not so good for your use case
[16:20:25] <aturon> eddyb: part of the problem with github is that not just anyone can be an assignee for an issue
[16:20:29] <aturon> due to the permissions model
[16:20:44] <aturon> so it's hard to actually do this sort of "who's working on what" tracking
[16:20:54] <Manishearth> arrrrrrrrr: C-assigned
[16:20:56] <Manishearth> * aturon 
[16:21:07] <Manishearth> we  have a label on Servo, C-assigned, which we use for that
[16:21:38] <aturon> Manishearth: hm, so that just tracks that *someone* is working on the issue?
[16:21:45] <Manishearth> yeah
[16:21:46] <aturon> i guess part of the problem is we have way more issues than people working on them
[16:22:03] <aturon> but i guess you could filter by C-assigned, hm
[16:22:50] <WindowsBunny> I DID IT
[16:22:57] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Ping timeout: 121 seconds)
[16:22:58] <WindowsBunny> aturon: I got information about a symbolic link!
[16:22:59] <WindowsBunny> :D
[16:23:07] <aturon> !!!
[16:23:09] <aturon> :)
[16:23:13] <Manishearth> on windoze?
[16:23:17] <WindowsBunny> A single layer
[16:23:17] * Manishearth pats
[16:23:25] <aturon> WindowsBunny: i was thinking about the issue brson raised:
[16:23:28] <WindowsBunny> Not resolving all the way
[16:23:45] <Manishearth> sufficiently advanced technical work on windows is indistinguishable from magic
[16:23:52] <aturon> it's clearly a problem to normalize away .. in all paths, because then you lose the ability to even represent paths that take into account symlinks
[16:23:53] <eddyb> aturon: https://github.com/issues?q=is%3Aopen+is%3Aissue+label%3AB-RFC-approved+sort%3Aupdated-desc+user%3Arust-lang
[16:24:14] <aturon> WindowsBunny: but i'm not sure that's an argument that relative_from should be so conservative
[16:24:44] <aturon> WindowsBunny: in particular, i worry as brson said that in its current form, it's not useful, so people will end up just writing their own version that introduces ..
[16:24:57] *** Joins: O01eg (o01eg@moz-8t10nc.ojtg.3egh.2698.2a02.IP)
[16:25:05] <aturon> WindowsBunny: so we might instead consider providing a similar semantics to the old version, with a big warning that this doesn't respect symlinks
[16:25:18] <WindowsBunny> aturon: I like big warnings
[16:25:19] <aturon> (the current version is a one-liner over the components iterator, as are almost all other path fns :)
[16:25:59] <aturon> eddyb: huh, interesting!
[16:26:08] <WindowsBunny> Manishearth: What's fun about this API is that the struct I need isn't actually exposed in the user mode headers
[16:26:08] <aturon> eddyb: does updated-desc cover only the top-level description?
[16:26:16] <WindowsBunny> you can only find it in the kernel mode driver headers
[16:26:35] <WindowsBunny> Manishearth: Isn't winapi wonderful? :D
[16:27:07] <Manishearth> haha
[16:30:10] <eddyb> aturon: I thought the "most recently updated" thing included comments
[16:30:24] <arrrrrrrrr> it does
[16:30:38] <aturon> eddyb: ok, i wasn't sure since it said "updated-desc"
[16:30:56] <aturon> but yeah, this seems like a zero-effort way to get some idea of active, big-ticket implementation stuff
[16:31:21] <steveklabnik> desc means 'descending' not 'description'
[16:31:28] <aturon> steveklabnik: ha! thanks 
[16:31:34] <WindowsBunny> Next step is porting this code to Rust
[16:31:54] <aturon> acrichto: i'm curious what you think about the relative_from suggestion above
[16:32:20] <arrrrrrrrr> what the representation of X([T])?
[16:32:48] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Connection closed)
[16:33:01] <arrrrrrrrr> huh, X(T, [T]) works to
[16:33:07] <arrrrrrrrr> how would that be represented in memory?
[16:33:09] <acrichto> aturon: the idea of doing basically what the old relative_from did? aka, returning PathBuf instead of &Path?
[16:33:10] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[16:33:27] *** Quits: zmack (zmack@moz-b26i0b.home.aster.pl) (Connection closed)
[16:34:09] <eddyb> arrrrrrrrr: anything with leading fields is broken
[16:34:19] <eddyb> X([T]) is represented as [T]
[16:34:27] <arrrrrrrrr> that's good
[16:34:34] <arrrrrrrrr> So a Box with custom allocator
[16:34:48] <eddyb> you don't put the allocator in the allocation
[16:35:02] <arrrrrrrrr> eddyb: but X(T) knows how it allocated the memory for T
[16:35:17] <arrrrrrrrr> so it can deallocate properly when it's dropped
[16:35:39] <eddyb> struct Box<T, A=DefaultAllocator> { data: NonZero<*mut T>, alloc: A }
[16:35:40] <aturon> acrichto: right, and therefore not respecting symlinks *for that function*
[16:35:54] <arrrrrrrrr> eddyb: yeah, that doesn't work yet, does it?
[16:36:06] <aturon> acrichto: that is, i wonder if the worries about symlinks got taken a bit too far in the API
[16:36:19] <eddyb> arrrrrrrrr: which part?
[16:36:24] <arrrrrrrrr> eddyb: custom allocators
[16:36:25] <aturon> acrichto: it's clear that you shouldn't normalize away .. because then you can't even talk about paths in a symlink-respecting way
[16:36:36] <arrrrrrrrr> eddyb: for the Box in the stdlib I mean
[16:36:38] <eddyb> arrrrrrrrr: we don't have them yet, but that structure definition is fine
[16:36:42] <aturon> acrichto: but these other convenience functions don't necessarily have to respect symlinks
[16:37:00] <aturon> acrichto: and if the current version is simply not useful... that seems like a good argument for providing the old semantics with a warning
[16:37:07] <eddyb> arrrrrrrrr: you seemed to suggest struct Box<T, A=DefaultAllocator> { data: NonZero<*mut (A, T)> }
[16:37:10] <acrichto> aturon: what's an example of the return value of relative_from not respecting a symlink?
[16:37:12] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Ping timeout: 121 seconds)
[16:37:49] *** Quits: mw (mw@moz-f1s7jp.vie.surfer.at) (Connection closed)
[16:37:51] <arrrrrrrrr> eddyb: sure, that would be more general. I was specifically thinking of a X<T>(T) that uses one fixed allocator. making it generic over the allocator is the next logical step
[16:38:02] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[16:38:06] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[16:38:08] <aturon> acrichto: asking for `baz` relative from `foo/../bar` will give you `../baz` in the old API
[16:38:08] <WindowsBunny> acrichto: Oh, there's another kind of reparse point we might want to handle, and that's mount points
[16:38:23] <aturon> acrichto: but what if `foo` is a link?
[16:38:25] <arrrrrrrrr> eddyb: well, I didn't mean to put the allocator in the allocation, no. that is encoded in the type system
[16:38:58] <acrichto> aturon: I fear I may be too far removed from what's going on here to render judgement either way
[16:39:31] <acrichto> aturon: as in I have no idea what it means to get `baz` relative from `foo/../bar`
[16:39:42] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[16:39:44] <acrichto> other than appending `../baz` at the end...
[16:40:31] <aturon> acrichto: well, that's the point. the new API returns None in this case,
[16:40:40] <aturon> acrichto: which is conservative wrt symlinks but maybe not useful
[16:40:57] <acrichto> how does foo/../bar/../baz not respect symlinks?
[16:41:05] <eddyb> arrrrrrrrr: and it's a value
[16:41:14] *** Joins: mw (mw@moz-f1s7jp.vie.surfer.at)
[16:41:25] <arrrrrrrrr> eddyb: let's not interpret to much into a throwaway irc comment
[16:41:27] <arrrrrrrrr> ;)
[16:41:55] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[16:42:57] <aturon> acrichto: if `foo` is a symlink, then you can't necessarily get to `baz` that way
[16:43:19] <aturon> (because foo has taken you somewhere else entirely
[16:43:39] <acrichto> I think I may just have to trust you on this one...
[16:43:56] <aturon> hm, i mean, this is precisely the same reason that we aren't normalizing away ..
[16:44:12] <acrichto> that part I don't understand though
[16:44:21] <acrichto> foo/../bar/../baz is not normalized at all
[16:44:29] <acrichto> why is it incorrect though?
[16:45:13] *** Joins: pcwalton (pcwalton@moz-u92.384.6.71.IP)
[16:45:13] *** ChanServ sets mode: +o pcwalton
[16:45:23] *** Joins: zmack (zmack@moz-b26i0b.home.aster.pl)
[16:46:07] <aturon> acrichto: it's not about normalization, i'm saying that we changed normalization for the same reason
[16:46:19] *** Quits: Guest63_ (textual@moz-6gq.t8s.78.166.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[16:46:27] <acrichto> hm ok I'm getting more confused then :P
[16:46:31] <aturon> so, in this case, `foo/../bar` may not be the same as `bar`
[16:46:35] <aturon> on the actual file system
[16:46:39] <acrichto> right, but what does that have to do with relative_from?
[16:46:42] <aturon> but the return value of `../baz` is pretending they are
[16:47:03] <acrichto> well right, the return value of the old api isn't so correct for this reason
[16:47:10] <acrichto> but why wouldn't a new api return foo/../bar/..baz ?
[16:47:12] <arrrrrrrrr> relative_from("foo", "bar") = ????
[16:47:14] <arrrrrrrrr> nothing
[16:47:18] <aturon> i guess it does actually involve normalization, since producing `../baz` as the result is implicitly normalizing
[16:47:22] <arrrrrrrrr> you can't calculate this without lots of syscalls
[16:47:29] <arrrrrrrrr> "foo" could be an invalid symlink
[16:47:38] <aturon> arrrrrrrrr: so, the old path API would have said "../bar"
[16:47:38] <arrrrrrrrr> and then there is NO WAY to go anywhere from "foo"
[16:47:43] <aturon> arrrrrrrrr: the new path API says None
[16:48:01] <arrrrrrrrr> aturon: the new path API should not even have that function
[16:48:12] <aturon> arrrrrrrrr: that's part of what we've been debating
[16:48:13] <WindowsBunny> arrrrrrrrr: what if foo is symlinked to bar? :D
[16:48:22] <WindowsBunny> or vice versa
[16:48:25] <arrrrrrrrr> you probably have to do a syscall on every part of the path to get the correct result
[16:49:20] <WindowsBunny> a full relative_from implementation that does lots of syscalls...
[16:49:37] <WindowsBunny> yeah no, even I'm not that crazy
[16:50:02] <arrrrrrrrr> maybe you can get an absolute path with one syscall and then just do the right thing
[16:50:09] <aturon> acrichto: i can just leave it unstable for now
[16:50:09] <arrrrrrrrr> realpath
[16:50:12] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[16:50:20] <acrichto> aturon: hm that's probably fine
[16:50:38] <aturon> acrichto: i do want to convey what the problem is, but we can discuss more later
[16:50:40] <WindowsBunny> arrrrrrrrr: On windows we can only get an absolute path with one syscall for paths shorter than MAX_PATH
[16:50:51] <arrrrrrrrr> WindowsBunny: probably the same on linux
[16:50:53] <WindowsBunny> arrrrrrrrr: for paths longer than that we have to do a long series of syscalls :D
[16:50:55] <aturon> acrichto: but TL;DR is the current API is probably not very useful, because it's so conservative
[16:51:14] <arrrrrrrrr> WindowsBunny: that's how glibc implements realpath I think. < MAX_PATH is a single syscall
[16:52:10] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[16:53:06] <WindowsBunny> acrichto: Oh yeah, and symbolic links can be relative
[16:53:16] <WindowsBunny> So that's gonna be fun to deal with :D
[16:53:52] *** Joins: Guest63 (textual@moz-qfs.570.70.83.IP)
[16:55:30] <acrichto> WindowsBunny: thanks for that link about symlink behavior with all the syscalls, definitely quite helpful!
[16:55:47] *** Quits: Guest63 (textual@moz-qfs.570.70.83.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[16:58:14] <arrrrrrrrr> pnkfelix: I don't think there is any room for interpretation. The formulation of that paragraph might be suboptimal but what is meant is: "If the value can be represented in the new type it is unchanged. Otherwise a panic occurs or the resulting value is calculated as described in issue #????? (wrapping)
[16:58:36] <arrrrrrrrr> I already mentioned that the formulation was weak in the RFC but apparently it wasn't changed.
[16:59:03] <arrrrrrrrr> The C standard defines this via abstract non-machine dependent calculations.
[16:59:21] <pnkfelix> arrrrrrrrr: so I take it then that you are a propoenent of StrictRange ?
[16:59:44] <arrrrrrrrr> pnkfelix: I haven't read beyond this paragraph yet: "The goal of this post is to describe those three interpretations ..."
[17:01:13] <pnkfelix> arrrrrrrrr: i think you were also the one claiming that the text claims that `-1_i64 as i8` is allowed to panic, yes?
[17:01:21] <arrrrrrrrr> yes
[17:01:31] <arrrrrrrrr> pnkfelix: my formulation does not
[17:01:34] <arrrrrrrrr> the one in the RFC does
[17:01:43] <arrrrrrrrr> but I think what was meant is my formulation
[17:01:50] <pnkfelix> arrrrrrrrr: my claim is that the RFC does not have a clear formulation
[17:01:50] <arrrrrrrrr> "if the value can be represented"
[17:02:02] <arrrrrrrrr> not something with machine dependent representations of values
[17:02:16] <pnkfelix> arrrrrrrrr: yes, that is part of the definitions I used in my post
[17:02:30] <pnkfelix> arrrrrrrrr: i.e. to base it (at least in part) on the mathematical meaning of the values
[17:03:20] <pnkfelix> arrrrrrrrr: I invite you to compare your formulation to the three I described, and try to identifty whether you are proposing a fourth option, or if you are an advocate for the one of the three I wrote.
[17:03:57] <pnkfelix> arrrrrrrrr: in any case, my belief is that the RFC did not intend to make `-1_i64 as i8` illegal
[17:04:07] <pnkfelix> sorry, I mean "the RFC author did not intend"
[17:04:26] *** Quits: laumann (thomas@moz-bcl.hq0.225.130.IP) (Ping timeout: 121 seconds)
[17:04:39] <pnkfelix> arrrrrrrrr: (but intent is of course not the important thing right now, but rather to pin down the actual semantics)
[17:06:21] <arrrrrrrrr> pnkfelix: https://github.com/rust-lang/rust/issues/16963#issuecomment-54591952
[17:06:27] *** Joins: edwardw (edwardw@moz-7il.36k.82.23.IP)
[17:06:29] <arrrrrrrrr> non-machine dependent definition of wrapping
[17:08:10] <arrrrrrrrr> pnkfelix: now with panics you would add at the top 0. If the value can be represented in the new type it is unchanged. Otherwise a panic might occur.
[17:08:24] <WindowsBunny> damnit, I need cmake to build cargo, but if I install cmake it installs the wrong curl
[17:08:32] *** Quits: barosl (barosl@moz-7vg.qma.67.220.IP) (Connection closed)
[17:08:33] <WindowsBunny> which prevents me from downloading the cargo snapshot to begin with!
[17:08:38] <arrrrrrrrr> WindowsBunny: why don't you build cargo with cargo?
[17:08:45] <arrrrrrrrr> oh, dependencies?
[17:08:52] <WindowsBunny> arrrrrrrrr: one of the dependencies needs cmake
[17:08:56] *** Joins: barosl (barosl@moz-7vg.qma.67.220.IP)
[17:09:11] <WindowsBunny> but cmake depends on a broken curl which prevents the snapshot from downloading
[17:09:25] <arrrrrrrrr> WindowsBunny: you can just download the snapshot directly from the website?
[17:09:27] <WindowsBunny> damnit msys2, I hate you I hate you I hate you
[17:09:42] <pnkfelix> arrrrrrrrr: I believe I describe something equivalent to what you just described in the post, and called it "Strict Range."  I also provide an argument for why one might prefer alternative less-strict panic conditions.
[17:09:55] <arrrrrrrrr> I'll read it.
[17:10:38] *** Quits: barosl (barosl@moz-7vg.qma.67.220.IP) (Connection closed)
[17:11:33] *** sunfish-away is now known as sunfish
[17:14:15] *** Joins: Guest63 (textual@moz-qfs.570.70.83.IP)
[17:15:52] *** Quits: zmack (zmack@moz-b26i0b.home.aster.pl) (Connection closed)
[17:16:34] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Ping timeout: 121 seconds)
[17:17:52] *** Joins: sternmull (kringel@moz-d91.khu.240.79.IP)
[17:20:39] *** Joins: zmack (zmack@moz-b26i0b.home.aster.pl)
[17:22:41] *** Parts: mw (mw@moz-f1s7jp.vie.surfer.at) ("")
[17:24:41] *** Quits: zmack (zmack@moz-b26i0b.home.aster.pl) (Ping timeout: 121 seconds)
[17:26:28] *** Joins: dudel (dud@moz-55rvi2.dclient.hispeed.ch)
[17:27:55] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[17:29:06] *** Joins: barosl (barosl@moz-7vg.qma.67.220.IP)
[17:33:34] *** Quits: Guest63 (textual@moz-qfs.570.70.83.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[17:34:23] *** Quits: pcwalton (pcwalton@moz-u92.384.6.71.IP) (Client exited)
[17:36:06] *** Joins: imperio (Mibbit@moz-8otf3a.fbx.proxad.net)
[17:36:08] <eddyb> aturon: why are you not in #rustc :(?
[17:36:25] <eddyb> aturon, japaric: hopefully this tiny comment doesn't get lost https://github.com/rust-lang/rust/pull/23104#issuecomment-78537850
[17:36:26] <aturon> eddyb: oops! soooo many IRC channels....
[17:39:26] <japaric> eddyb: that approach seems like restricting my implementation to only allow inherent impls in libcore
[17:39:43] <japaric> eddyb: one question I have is the 'enum char' will remain private in libcore?
[17:40:14] <japaric> eddyb: if yes, then I think the 'impl char' will not show up in the docs
[17:40:15] <eddyb> japaric: no, it would be the only way to get to char
[17:40:26] <eddyb> i.e. no more keyword-like primitives
[17:41:09] <eddyb> japaric: is that not clear enough in the linked post? then I probably need to expand on it further (which... I might have done? I forget where I've reposted that to)
[17:41:36] <eddyb> japaric: it solves like 3 problems at once
[17:41:40] <japaric> eddyb: ok, in my experience, that leads to some name clashes i.e. modules can't be named as 'char'
[17:42:05] <eddyb> japaric: only if char is in scope, and yes, we consider the fact that you can use the type char and a module char in the same scope a bug
[17:42:51] <eddyb> at least now you can't define anything in the type namespace with a primitive name, but modules are still there
[17:43:53] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[17:45:50] <japaric> if we "define" all the primitives in libcore, we can remove core::SliceExt and core::StrExt, but not collections::SliceExt / unicode::StrExt (we can remove some methods from them though), these would still show up in the prelude
[17:46:19] <eddyb> japaric: how are you doing that in this PR?
[17:46:35] <eddyb> avoiding that issue seems impossible while preserving language semantics
[17:46:41] <aturon> japaric: eddyb: right, i think a key benefit of this PR for newcomers is that all operations on primitive types show up directly as inherent
[17:47:31] <japaric> eddyb: e.g. 'impl char' is in libunicode, there can't be any more 'impl char's anywhere, you can get access the char inherent methods if you link to libunicode
[17:47:52] <japaric> eddyb: core::CharExt remains, but unicode::CharExt and its std re-export are removed
[17:48:11] <eddyb> aturon: we don't need special pages for primitive types if they're defined in a library, and surely we can display trait impls just fine
[17:48:37] <eddyb> japaric: that feels hacky as hell
[17:48:56] <aturon> eddyb: the problem i'm worrying about here is the need for traits to be involved at all for basic methods on primitives
[17:49:02] *** Quits: barosl (barosl@moz-7vg.qma.67.220.IP) (Ping timeout: 121 seconds)
[17:49:13] <aturon> eddyb: my thoughts are here: https://github.com/rust-lang/rust/pull/23104#issuecomment-78539940
[17:49:16] <eddyb> aturon: as long as you have multiple crates, *they have to be*
[17:49:33] *** Joins: barosl (barosl@moz-7vg.qma.67.220.IP)
[17:49:39] <aturon> eddyb: not in the approach japaric is taking
[17:50:03] <japaric> eddyb: see https://github.com/rust-lang/rust/pull/23104#issuecomment-78538419 for an overview of the implementation
[17:50:04] <aturon> nmatsakis: would be curious to get your thoughts here as well
[17:50:29] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[17:52:02] <eddyb> aturon: well, japaric admitted above that `core::CharExt` is kept alive
[17:52:27] <eddyb> and you have to either duplicate/proxy the functionality in the inherent impl or re-export core::CharExt in the prelude
[17:52:36] <eddyb> *or* remove it from core
[17:52:43] <aturon> eddyb: right, proxy it
[17:52:55] <aturon> we already have a CharExt facade trait
[17:53:07] <aturon> this is similar, but makes the methods inherent
[17:53:27] <eddyb> that seems like a ridiculous move just to remove extension traits
[17:53:33] <aturon> so that people looking at std directly -- not aware of the facade -- get a relatively simple story for the primitive types
[17:53:43] <aturon> why is it ridiculous?
[17:54:10] *** Joins: barosl_ (barosl@moz-7vg.qma.67.220.IP)
[17:54:10] <aturon> especially given that we already have exactly the same setup, with traits?
[17:54:48] <eddyb> because if libcollections wants to add methods to iterators, it has to introduce a trait. in this case, that requirement is side-stepped for primitive types
[17:55:08] <eddyb> s/if/if, for example,/
[17:56:01] <eddyb> aturon: obeying strict coherence and definition sites is the only sustainable solution IMHO
[17:56:17] * eddyb goes back to writing his view on the Pod/Copy split
[17:56:57] <aturon> eddyb: i understand where you're coming from (and acrichto agrees, i believe) but i still value making the primitive types approachable for newcomers who have no idea that the facade even exists
[17:57:31] *** Quits: barosl_ (barosl@moz-7vg.qma.67.220.IP) (Quit: Leaving)
[17:57:37] <eddyb> aturon: then make rustdoc special-case impls of traits that are in the prelude
[17:58:12] <eddyb> make the heading lighter, and add a prelude badge that goes "in scope by default" on hover
[17:58:30] <eddyb> let's not mix documentation concerns with semantics
[17:59:27] <aturon> eddyb: do you agree that we should provide some means of inherent methods for primitives?
[18:00:10] <eddyb> aturon: yes, but not in different crates from the lowest ones in the hierarchy where they can appear
[18:00:35] <aturon> eddyb: ok, that's what i figured
[18:00:36] * eddyb wonders if he can break this model
[18:01:02] <aturon> eddyb: from my perspective, i feel like the facade -- which we're trying to keep hidden and unstable for now -- is a leaky abstraction here
[18:01:13] <aturon> but probably the long-term analysis --
[18:01:14] <eddyb> since nothing is expecting that breach of coherence, it might trip something
[18:01:35] <aturon> what you meant by "sustainable"? -- is to incorporate general language features that would allow you to avoid such leakage
[18:01:41] <eddyb> aturon: I don't mind removing *most* of that, but I do mind bending the rules to do it for everything
[18:02:01] <aturon> eddyb: so, for example, if we get inherent traits at some point,
[18:02:12] *** Quits: scialex (scialex@moz-j5mi8i.cs.brown.edu) (Quit: Leaving)
[18:02:12] <aturon> we could potentially replace these lang items with that
[18:02:18] <eddyb> inherent traits? what would they do?
[18:02:36] <eddyb> inherent impls you can import?
[18:03:38] * japaric -> lunch
[18:06:27] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Connection closed)
[18:07:03] *** Quits: larhat1 (Adium@moz-8v4.af0.232.213.IP) (Quit: Leaving.)
[18:08:37] <aturon> eddyb: something like that -- sfackler had some preliminary ideas, but the details escape me at the moment
[18:10:10] <sfackler> eddyb: the idea's that you'd tag a trait implementation as "inherent" or whatever and those methods would always be in scope for the type it's implemented for
[18:10:17] <sfackler> even if you didn't import the trait
[18:10:48] <sfackler> the idea's that if we have e.g. a Map trait, HashMap is totally useless without the methods defined on Map, so they should always be in scope when you're messing with a HashMap
[18:10:51] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[18:12:36] *** Joins: James (quassel@moz-t5os7p.range86-163.btcentralplus.com)
[18:16:59] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[18:17:49] <eddyb> hmm
[18:18:34] <eddyb> sfackler: I think we already do something similar for bounded generics
[18:19:45] <eddyb> sfackler: so you basically want to impl<K, V, H> HashMap<K, V, H> { use <HashMap<K, V, H> as Map>::*; }
[18:20:10] <eddyb> that would still need to be done in the crate defining the type
[18:20:44] <SimonSapin> How can I get a NodeId from an ast::Path?
[18:21:00] <eddyb> SimonSapin: you don't really - what is the id supposed to be?
[18:21:14] *** Joins: kmcguire_ (kmcguire@moz-pg1gb9.biz.rr.com)
[18:21:43] <pnkfelix> (reading over PR 23104) hmm, is the long term plan to actually remove the `Int` trait outright?
[18:21:46] <SimonSapin> eddyb: cx.tcx.def_map.borrow().get(&ty_id) error: mismatched types: expected `&u32`, found `&syntax::ast::Path`
[18:21:56] <eddyb> if it's what you're going to look up the path in the def_map or somewhere else - then you need the NodeId from the containing item
[18:21:58] *** Joins: zmack (zmack@moz-b26i0b.home.aster.pl)
[18:21:58] <aturon> pnkfelix: yes
[18:22:18] <eddyb> SimonSapin: well, yeah, ty_id in that case happens to be a Path. are you rebasing some old code?
[18:22:22] <pnkfelix> aturon: how do I then write code that is generic over any choice of concrete integer type ?
[18:22:23] <aturon> pnkfelix: basically, generic programming over numeric types would move out to crates.io
[18:22:29] <eddyb> SimonSapin: i.e. where does ty_id come from?
[18:22:37] <pnkfelix> aturon: ah, okay, so it just wouldn't be part of the stdlib
[18:22:41] <aturon> pnkfelix: the traits that are there currently are not very well-designed for generic programming
[18:22:48] <aturon> pnkfelix: right. basically, we want more time for them to bake
[18:22:59] <aturon> the current traits are mostly geared toward providing basic functionality for the primitive types
[18:23:01] <SimonSapin> eddyb: if let ast::TyPath(_, ty_id) = f.node.ty.node
[18:23:18] <eddyb> SimonSapin: f.node.ty.id is what you want
[18:23:22] <aturon> pnkfelix: but "proper" generic types probably want to work well with bignums, and maybe a numeric tower
[18:23:34] <SimonSapin> eddyb: Iâ€™ll try that, thanks
[18:23:53] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[18:24:00] <eddyb> SimonSapin: it changed to TyPath(Path) at some point and then I added QSelf to that, so it happens to match the number of fields before
[18:24:08] *** Quits: kmcguire (kmcguire@moz-pg1gb9.biz.rr.com) (Ping timeout: 121 seconds)
[18:24:31] <SimonSapin> I see
[18:24:32] <eddyb> (this is why it's easier to rustup often, at least on smaller projects)
[18:24:45] <SimonSapin> eddyb: Servo :)
[18:24:54] <eddyb> yeah, I figured
[18:25:03] <SimonSapin> but yeah, I agree
[18:25:54] <pnkfelix> aturon: okay, i follow.  (nonetheless, I did find the current traits quite useful for something I was working on today)
[18:26:00] *** Quits: zmack (zmack@moz-b26i0b.home.aster.pl) (Ping timeout: 121 seconds)
[18:26:03] <SimonSapin> eddyb: Should I keep the `if let ast::TyPath(..) = f.node.ty.node` condition?
[18:26:17] <aturon> pnkfelix: yeah, if/when they are removed we will plop them into a preliminary external crate
[18:26:19] <eddyb> SimonSapin: only if you don't want it to do anything for non-paths
[18:26:28] <pnkfelix> aturon: (namely working through the interactions of arith-overflow and cast-operations)
[18:26:42] <aturon> pnkfelix: we could also keep them for internal use in the compiler
[18:26:50] <eddyb> SimonSapin: if you already have a degree of certainty that it's a path, you can remove it *shrug*
[18:27:17] <eddyb> aturon: IMO we should start at least using git submodules for rust-lang/* crates
[18:27:24] <SimonSapin> Iâ€™m not sure what this code does, sounds safer to leave it
[18:27:31] *** Quits: enaqx (enaqx@moz-asgdqm.infomir.com.ua) (Ping timeout: 121 seconds)
[18:27:35] <eddyb> makes lock-step development a bit harder, I guess
[18:27:48] <aturon> eddyb: yeah, we definitely need some overall plan for those crates, which are accumulating
[18:27:55] <aturon> still, plenty enough to do for the beta release already
[18:28:57] *** Joins: enaqx (enaqx@moz-asgdqm.infomir.com.ua)
[18:33:49] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[18:34:02] *** Quits: enaqx (enaqx@moz-asgdqm.infomir.com.ua) (Ping timeout: 121 seconds)
[18:34:20] *** Quits: scott (uid25790@moz-e5ok1n.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[18:34:28] *** Quits: edwardw (edwardw@moz-7il.36k.82.23.IP) (Ping timeout: 121 seconds)
[18:35:12] *** Joins: enaqx (enaqx@moz-asgdqm.infomir.com.ua)
[18:35:36] *** Joins: arielb1 (Ariel@moz-qfu7pm.red.bezeqint.net)
[18:41:47] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[18:41:47] *** ChanServ sets mode: +o pcwalton
[18:44:54] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[18:47:49] <arrrrrrrrr> does github markdown support footnotes?
[18:48:21] *** Joins: c0170 (c0170@moz-4stj9o.cable.virginm.net)
[18:48:39] <simukis> arrrrrrrrr: no, AFAIK
[18:49:08] <simukis> well, more general answer is that I couldnâ€™t find a syntax that produces footnotes
[18:49:54] *** Joins: nrc|afk (nrc@moz-4bhi2i.xtra.co.nz)
[18:49:54] *** ChanServ sets mode: +o nrc|afk
[18:50:03] *** Quits: Murarth (Murarth@moz-c6ubhh.phnx.qwest.net) (Client exited)
[18:50:42] *** Joins: jculpon (peri@moz-nlc4ha.ca.comcast.net)
[18:53:48] *** Joins: eerie_ (eerie@moz-nbbdu3.red.bezeqint.net)
[18:55:12] *** Joins: Murarth (Murarth@moz-c6ubhh.phnx.qwest.net)
[18:55:27] *** Joins: srh (User@moz-tvc5sp.sntcca.sbcglobal.net)
[18:56:35] <eddyb> aww github, you don't have a nice style for the 4th level of bullet points https://github.com/rust-lang/rfcs/pull/936#issuecomment-78567965
[18:56:55] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Ping timeout: 121 seconds)
[18:57:10] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[18:57:37] <Manishearth> eddyb: I believe that's the browser?
[18:57:47] <Manishearth> that seems to be the default progression for li
[18:57:58] <eddyb> Manishearth: yay for webscale UI uniformity
[18:59:47] *** Quits: enaqx (enaqx@moz-asgdqm.infomir.com.ua) (Ping timeout: 121 seconds)
[19:01:39] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[19:01:50] <japaric> nmatsakis: RFC: rename libstd to libatom, and libcore to libquark
[19:02:10] <eddyb> japaric: r+
[19:02:21] <eddyb> [breaking-change]
[19:02:43] <eddyb> japaric: the release should be gamma
[19:02:50] <eddyb> iykwim
[19:03:24] <eddyb> what if we just kept using greek letters for the entirety of 1.x?
[19:03:28] <japaric> rust won't follow point releases, instead each release will be name after the greek alphabet
[19:04:28] * eddyb tries to recover his key mappings
[19:04:56] <WindowsBunny> Is there a non-copying conversion of OsString to PathBuf?
[19:05:25] <jculpon> WindowsBunny: +1 on that question. Been having "issues" with tools because of it
[19:05:40] <arrrrrrrrr> WindowsBunny: isn't OsString utf16 on windows?
[19:05:47] *** Joins: mib_a1dxyu (Mibbit@moz-g6k.oht.161.46.IP)
[19:05:50] <WindowsBunny> OsString is wtf-8
[19:05:52] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[19:05:55] <WindowsBunny> PathBuf is wtf-8
[19:05:56] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[19:06:01] <arrrrrrrrr> makes sense
[19:06:27] <WindowsBunny> I see no reason why we don't provide such a cheap conversion
[19:06:31] <aturon> WindowsBunny: i don't think there is right now, just an oversight
[19:06:34] <japaric> WindowsBunny: arrrrrrrrr https://github.com/rust-lang/rust/issues/22751
[19:08:47] <eddyb> nmatsakis: I'm not sure what your view is on https://github.com/rust-lang/rust/pull/23104#issuecomment-78537850 combined with the currently existing inherent impl rules for user types
[19:09:15] <killercup> japaric: we already have the science names from the oxide part of 'rust'. why not libquark and libyogurt?
[19:09:33] <eddyb> uhm... quark yogurt
[19:09:40] * eddyb registers trademark
[19:09:48] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[19:09:51] <japaric> eddyb: does you lang enum char approach involves removing sty::ty_char? Is the goal converting the primitives into library types that allow literals? perhaps something like gh19612
[19:09:51] <[o__o]> [WIP] `str` is dead, long live `str([u8])`!: https://github.com/rust-lang/rust/pull/19612
[19:10:23] <nmatsakis> eddyb: I have no especial problem with using lang items to declare the primitive types; but it doesn't seem to play super well with the need for some primitive methods we want on [T] to access things that require allocation etc
[19:10:32] <nmatsakis> that is, it doesn't address that problem
[19:10:49] <eddyb> true, I haven't given that much thought
[19:11:21] *** Quits: jculpon (peri@moz-nlc4ha.ca.comcast.net) (Quit: zoi)
[19:11:26] <eddyb> nmatsakis: I guess they are almost orthogonal (the problem I was solving was resolve's special-casing of primitive type names) albeit related
[19:12:11] <eddyb> japaric: well, str can be replaced with a type like that, yes. #[repr(u1)] enum bool { false = 0, true = 1 } has been mentioned in the past, doener even had some of it implemented IIRC
[19:12:19] <eddyb> (or was that aatch?)
[19:12:23] *** Joins: scialex (scialex@moz-j5mi8i.cs.brown.edu)
[19:13:56] <doener> that was my eddyb_hack branch
[19:14:30] <eddyb> japaric: ty_char doesn't have to be removed immediately, we can handle it like we do ty_uniq and/or intern the appropriate ty_enum and keep it available in tcx.types.char
[19:14:46] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[19:14:52] *** Joins: enaqx (enaqx@moz-asgdqm.infomir.com.ua)
[19:15:01] <eddyb> japaric: it's kinda interesting that we could have support for ranged values
[19:15:50] <eddyb> and then you could describe more of the type in the library (and have arbitrary ranges, complete with enum packing optimizations and whatnot)
[19:15:58] <eddyb> japaric: but that's not *necessary* for now
[19:16:21] <eddyb> I guess char could be a struct wrapping u32
[19:16:30] *** Joins: Guest63 (textual@moz-6gq.t8s.78.166.IP)
[19:17:49] <WindowsBunny> acrichto: http://puu.sh/gxtzN/5536044105.png
[19:17:50] <WindowsBunny> :D
[19:17:54] <eddyb> japaric: the main goal is to "root" these names somewhere in a lib, from where they would go through regular resolution - so they will have to be part the prelude to keep (most) code working
[19:17:59] <WindowsBunny> note that 2.txt is itself a symlink
[19:18:27] <WindowsBunny> acrichto: the first path returned is the actual path you should use, while the second is a display path suitable for showing to the user
[19:18:33] *** Parts: JustAPerson (JustAPerson@moz-un628q.moe) ("WeeChat 1.2-dev")
[19:19:43] <japaric> eddyb: ok, I see - that does lead to the name clashes seen in the PR I mention (not that it's inherently a bad thing, but it does break today code)
[19:20:04] <eddyb> japaric: we need to make everything type-associated before we can attempt it, though
[19:20:56] <WindowsBunny> acrichto aturon: Here's the lovely code to do it :D https://github.com/retep998/wio-rs/blob/master/src/reparse.rs
[19:21:13] *** Quits: mib_a1dxyu (Mibbit@moz-g6k.oht.161.46.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[19:21:42] <eddyb> std::i32 would become an alias for the type i32, and we can hopefully mark it as deprecated
[19:22:47] <acrichto> WindowsBunny: nice!
[19:23:35] *** Quits: eerie_ (eerie@moz-nbbdu3.red.bezeqint.net) (Connection closed)
[19:23:45] <WindowsBunny> acrichto: So now whenever you have the time to bikeshed about an API for this and any cleanup suggestions so I can eventually make a PR to rust
[19:23:50] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[19:23:57] <WindowsBunny> but for now it's out there so people can experiment with it
[19:24:02] <acrichto> cool, thanks!
[19:24:25] *** Joins: Ericson2314 (user@moz-j5mi8i.cs.brown.edu)
[19:25:55] <aturon> WindowsBunny: awesome
[19:27:40] <simukis> oh hey
[19:27:43] *** Quits: mystor (mystor@moz-ldavpp.home3.cgocable.net) (Connection closed)
[19:27:55] <simukis> you came online just in time, acrichto, aturon
[19:28:11] <aturon> simukis: haha, what's up?
[19:28:34] <simukis> https://gist.github.com/nagisa/8fd54468916305669b55 been using std::io::stdio trying to do something useful
[19:28:40] <simukis> these numbers are terrible
[19:28:55] <simukis> and noticed that ReadExt::bytes API is terrible, but already stable
[19:29:17] <simukis> (terrible in terms of efficiency)
[19:29:45] <simukis> sigh, gists always get misordered, the first file should go last
[19:30:04] <simukis> (ah, by the way this is for ~450MiB file
[19:31:03] <aturon> simukis: hm, so this seems not too surprising to me,
[19:31:07] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Connection closed)
[19:31:15] <aturon> in that the version that uses a fixed buffer to read and then write is much faster
[19:31:26] <aturon> than either doing a byte at a time, or pulling the whole thing into memory
[19:31:29] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[19:31:36] <aturon> is the concern that you expected the bytes iterator to optimize in some way?
[19:32:42] <simukis> aturon: the thing is that thereâ€™s no convenient API to do reading. Also yes, Iâ€™d at least expect the read-only bytes iterator to not take up 5 seconds
[19:33:19] <simukis> alas it is not really avoidable because the iterator returns Result for each byte
[19:34:08] *** Joins: mystor (mystor@moz-ldavpp.home3.cgocable.net)
[19:34:45] <aturon> simukis: did you have a different API in mind that is more convenient than read and more performant than bytes?
[19:34:47] <arrrrrrrrr> quick question: why doesn't internals.rust-lang.org show my github avatar?
[19:35:37] <WindowsBunny> arrrrrrrrr: I believe it uses gravatar
[19:35:47] <arrrrrrrrr> hmm
[19:36:00] <arrrrrrrrr> I logged in with github so you'd think it would copy the avatar from github
[19:36:35] <simukis> aturon: bytes that return just `u8`s and None on first error, I guess
[19:37:08] <arrrrrrrrr> without having read any part of this discussion. simukis: how can something return u8 and None?
[19:37:32] <simukis> arrrrrrrrr: bytes is an iterator, which returns Option<Result<u8>>
[19:37:44] <arrrrrrrrr> ugh
[19:37:46] <arrrrrrrrr> I hate that api
[19:37:56] <simukis> so do I
[19:37:59] <arrrrrrrrr> totally degrades the power of for loops because you still have to check the inner type
[19:38:37] <arrrrrrrrr> anyway, now I have to come up with a funny internals avatar
[19:39:26] <aturon> simukis: so that's one possibility which would speed up the iterator (though i suspect it would still be slower than the version copying into a buffer), but it has the obvious downside that there's no way to tell that something has gone wrong
[19:40:01] <arrrrrrrrr> always remember: convenience functions are used for convenience. not for precise error reporting
[19:40:06] <aturon> (i.e. all errors look like EOF, basically)
[19:40:09] <arrrrrrrrr> remember: most people don't even care about error reporting
[19:40:18] <arrrrrrrrr> they'll just stop the loop either way
[19:40:18] *** Joins: Guest63_ (textual@moz-56c.qli.61.176.IP)
[19:40:37] <aturon> arrrrrrrrr: but the proposed API gives you no way to even tell that there was an error
[19:41:10] <arrrrrrrrr> aturon: but it's more convenient. maybe add a "error_occured" function somewhere to check after the loop
[19:41:31] <aturon> hm, i suppose the iterator itself could store the error
[19:41:41] <arrrrrrrrr> maybe even something like for x in ...bytes(&error) { .. where &error is an Option<Error>
[19:41:48] <arrrrrrrrr> &mut error
[19:42:11] <arrrrrrrrr> Option<&mut Option<Error>>
[19:42:13] <aturon> interesting
[19:42:14] *** Quits: Guest63 (textual@moz-6gq.t8s.78.166.IP) (Ping timeout: 121 seconds)
[19:42:20] <doener> arrrrrrrrr: +1
[19:42:21] <arrrrrrrrr> if you don't care about the error just pass None
[19:42:53] <aturon> definitely worth experimenting
[19:43:09] *** nrc|afk is now known as nrc
[19:44:05] *** Joins: srh_ (User@moz-tvc5sp.sntcca.sbcglobal.net)
[19:44:27] <aturon> the same would go for `lines`, `chars`, etc
[19:46:03] <aturon> acrichto: when you're back around, curious to get your thoughts on ^
[19:46:36] <arrrrrrrrr> pretty much like you'd do it in C with errno just that you pass an explicit pointer to the errno location
[19:46:56] <aturon> right
[19:47:08] *** Quits: enaqx (enaqx@moz-asgdqm.infomir.com.ua) (Ping timeout: 121 seconds)
[19:47:18] <aturon> in general Result has benefits, but it's always awkward when embedded in iterators
[19:47:24] *** Quits: TheHydroImpulse (TheHydroImp@moz-r25mqk.ed.shawcable.net) (Client exited)
[19:47:27] *** Quits: srh (User@moz-tvc5sp.sntcca.sbcglobal.net) (Ping timeout: 121 seconds)
[19:47:58] <acrichto> aturon: I don't quite follow so far (are there 3 proposals?), what's the thinking right now?
[19:48:48] <aturon> acrichto: the basic point is that Iterator<Item=Result<T,E>> may be better off by dealing with the error case "out of band"
[19:49:06] <aturon> that is, halt the iterator on the first error, and then provide some way of testing whether an error occurred afterwards
[19:49:14] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Connection closed)
[19:49:14] <acrichto> aturon: hm possibly, I'd be worried that you're no longer forced to deal with the error though
[19:49:22] <aturon> right, that's one downside for sure
[19:49:47] <aturon> in particular, there's a footgun that you interpret all errors as EOF, basically
[19:49:55] <acrichto> yeah
[19:50:10] <aturon> but if it took an explicit out-param, as arrrrrrrrr is suggesting,
[19:50:20] <aturon> that's a pretty good signal that there's a chance of error you should check for
[19:50:46] *** Joins: curmet (Mibbit@moz-juv.9o3.252.72.IP)
[19:51:05] <acrichto> perhaps yeah
[19:51:11] <aturon> (it also allows you to separate your error handling code from the loop itself)
[19:51:31] <aturon> simukis: would you be interested in prototyping this and seeing the impact on both perf and API usage?
[19:52:00] <aturon> simukis: it should be easy to just start from the current `bytes` implementation
[19:52:04] *** Quits: jdm (jdm@moz-j1lnh9.ckpj.s0pt.0450.2001.IP) (Quit: )
[19:52:31] <simukis> aturon: yeah, Iâ€™m already doing something in that direction.
[19:52:36] <simukis> yet another related question
[19:52:37] <aturon> simukis: great, thanks!
[19:52:48] <aturon> simukis: direct it to acrichto, i'm running to lunch now :)
[19:53:38] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[19:53:38] <simukis> ah, whatever, actually
[19:53:53] <sfackler> the error out param thing is a cool idea
[19:54:43] <sfackler> might want to make it a &mut Result<(), ErrType> instead so you can just do a let mut err = Ok(()); for thing in foo.iter(&mut err) { ... } try!(error);
[19:55:37] <simukis> Iâ€™m thinking more in direction of `errout: Option<&mut IoError>`
[19:55:58] <simukis> eh, that doesnâ€™t work
[19:56:20] <Ericson2314> This is one of the situations where it would be nice if iterator returned result
[19:56:37] <Ericson2314> (instead of option)
[19:56:45] *** Joins: burntsushi (burntsushi@moz-t92kn9.ma.charter.com)
[19:58:05] <arrrrrrrrr> why would it improve perf?
[19:58:06] <simukis> oh well, lets see if this thing works at all before debating the colour of this particular shed.
[19:58:13] <arrrrrrrrr> I thought this was just about convenience
[19:58:38] <brson> i just launched 1995 builds in parallel!
[19:58:39] <simukis> arrrrrrrrr: at least one less branch in every iteration
[19:58:53] <arrrrrrrrr> simukis: how does the iterator know to stop the iteration?
[19:59:17] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Connection closed)
[20:00:08] <arrrrrrrrr> wait, maybe I don't know how bytes() is implemented
[20:00:10] <arrrrrrrrr> let me check
[20:00:30] <arrrrrrrrr> ReadExt::bytes?
[20:01:03] <simukis> yes.
[20:01:25] <arrrrrrrrr> https://gist.github.com/anonymous/3ef5a7412b26c2b83bd2
[20:01:29] <arrrrrrrrr> you're right
[20:01:35] <arrrrrrrrr> it already has all the branches it needs
[20:01:39] <arrrrrrrrr> so it would be more efficient
[20:02:11] <simukis> I'd also like to have a specialised version for buffered readers, because it would allow getting rid of bazillion calls to `read`
[20:02:13] <arrrrrrrrr> no that iterating over anything byteswise can ever be efficient
[20:02:20] *** Joins: enaqx (enaqx@moz-asgdqm.infomir.com.ua)
[20:02:23] <arrrrrrrrr> yeah
[20:02:25] <arrrrrrrrr> lol
[20:04:00] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[20:04:06] <aturon> brson: woo!
[20:05:41] *** Joins: japaric_ (japaric@moz-cck.bii.230.201.IP)
[20:07:57] *** Quits: japaric (japaric@moz-663.3tp.232.190.IP) (Ping timeout: 121 seconds)
[20:08:34] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[20:11:46] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Connection closed)
[20:12:07] *** Quits: erickt (erickt@moz-4hh.6p3.217.74.IP) (Quit: leaving)
[20:12:20] *** Joins: TheHydroImpulse (TheHydroImp@moz-r25mqk.ed.shawcable.net)
[20:12:26] *** Joins: eerie (eerie@moz-nbbdu3.red.bezeqint.net)
[20:13:45] <arrrrrrrrr> http://a.pomf.se/qxspzm.png
[20:13:48] <arrrrrrrrr> jesus christ
[20:13:59] <arrrrrrrrr> how can anyone use this?
[20:15:36] <WindowsBunny> arrrrrrrrr: lol, they forgot to account for when the toolbar wraps? :P
[20:15:46] <arrrrrrrrr> solid engineering
[20:16:28] *** Quits: eerie (eerie@moz-nbbdu3.red.bezeqint.net) (Ping timeout: 121 seconds)
[20:17:06] <XMPPwocky> I call it, "unresponsive design"
[20:17:12] *** Joins: japaric (japaric@moz-8lt.95g.230.201.IP)
[20:19:43] *** Quits: japaric_ (japaric@moz-cck.bii.230.201.IP) (Ping timeout: 121 seconds)
[20:20:04] <eddyb> oh, that
[20:20:19] <eddyb> arrrrrrrrr: I never have my browser wide enough for that to *not* happen
[20:20:23] <eddyb> it's very annoying
[20:20:44] *** Quits: ctennis (ctennis@moz-su6.e72.137.99.IP) (Quit: Leaving...)
[20:23:27] *** Joins: japaric_ (japaric@moz-c96.htn.121.200.IP)
[20:24:55] *** Quits: summerlight_ (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[20:25:50] *** Quits: kushal (kdas@moz-9s6.akp.200.118.IP) (Ping timeout: 121 seconds)
[20:26:07] <acrichto> nmatsakis: ping
[20:26:16] *** Quits: japaric (japaric@moz-8lt.95g.230.201.IP) (Ping timeout: 121 seconds)
[20:26:36] <acrichto> nmatsakis: (question about removing subtyping during method dispatch)
[20:26:38] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[20:26:38] *** ChanServ sets mode: +o pcwalton
[20:27:14] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[20:27:36] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[20:27:36] *** ChanServ sets mode: +o pcwalton
[20:27:39] *** Joins: ctennis (ctennis@moz-su6.e72.137.99.IP)
[20:28:40] *** Joins: japaric (japaric@moz-hpu.6fl.64.181.IP)
[20:29:14] *** Quits: TheHydroImpulse (TheHydroImp@moz-r25mqk.ed.shawcable.net) (Client exited)
[20:29:51] *** Quits: ctennis (ctennis@moz-su6.e72.137.99.IP) (Quit: Leaving...)
[20:31:29] *** Quits: japaric_ (japaric@moz-c96.htn.121.200.IP) (Ping timeout: 121 seconds)
[20:32:55] <acrichto> nmatsakis: ah just went ahead and commented: https://github.com/rust-lang/rust/issues/18737#issuecomment-78603591
[20:37:00] <cmr> src/reader/mod.rs:92:24: 92:24 help: add #![feature(path)] to the crate attributes to silence this warning
[20:37:07] *** Joins: petrochenkov (Mibbit@moz-4val3f.broadband.corbina.ru)
[20:37:11] <cmr> and then I add #![feature(path)] and it complains it doesn't know what the path feature is!
[20:39:50] *** Joins: ctennis (ctennis@moz-vcpg3c.in.comcast.net)
[20:40:36] *** Joins: TheHydroImpulse (TheHydroImp@moz-r25mqk.ed.shawcable.net)
[20:41:16] <petrochenkov> Hi. Do I understand correctly that currently (after #22980 maybe) rustc by default compiles with all debug!("...") messages removed?
[20:41:45] <nrc> yes :-(
[20:43:31] <nrc> (I should note that I am :-) about this change in general, but :-( about the default when building rustc itself, but it is pretty much my oven fault for not implementing the develop/release options for rustc configure)
[20:43:40] <nrc> s/oven/own
[20:44:07] <acrichto> Gankro: ping
[20:44:12] *** Joins: srh__ (User@moz-tvc5sp.sntcca.sbcglobal.net)
[20:44:31] <simukis> arrrrrrrrr: aturon: acrichto: https://gist.github.com/nagisa/eb64b7fc00f5da64c8ba.
[20:44:42] <petrochenkov> That's sad. I remember the github wiki contained a recipe how to pass -C debug-assertions to the rust buildsystem. But the Wiki is gone too :(
[20:44:59] <nrc> RUSTFLAGS="-Cdebug-assertions"
[20:45:02] *** Quits: semarie (semarie@moz-slkb3c.torproxy-readme-arachnide-fr-35.fr) (A TLS packet with unexpected length was received.)
[20:45:11] <Luqman> nrc: --enable-debug works
[20:45:56] <acrichto> simukis: interesting, I wonder why the perf is only slightly different
[20:45:58] <petrochenkov> I'll try, thanks!
[20:46:21] <simukis> that said, can we just make all those iterators, except, maybe, lines, unstable?
[20:46:29] <nrc> petrochenkov: also the wiki is here now if you need anything: https://github.com/rust-lang/rust-wiki-backu
[20:46:36] <nrc> p
[20:46:45] <simukis> acrichto: because most of the overhead is in read and write calls
[20:47:33] *** Quits: srh_ (User@moz-tvc5sp.sntcca.sbcglobal.net) (Ping timeout: 121 seconds)
[20:47:34] <acrichto> simukis: sure, I would have expected though the perf to be roughly the same
[20:47:45] <acrichto> I wasn't actually expecting this to improve bytes() itself in general
[20:48:36] <simukis> acrichto: well, since this impl of bytes is in the same file, I bet LLVM finds some inter-module optimisations
[20:49:10] <bstrie> eddyb: I did not read the whole thing, all I saw was the mention in my highlights about putting typarams and params in the same list :P
[20:49:20] <bstrie> eddyb: even if it's not serious, I'd still be willing to read a proposal
[20:49:27] <acrichto> simukis: hm true, although -Clto would do that for the first case as well
[20:50:13] *** cmr changes topic to '<= 19 days to 1.0.0-beta1: http://blog.rust-lang.org/2015/02/13/Final-1.0-timeline.html | http://internals.rust-lang.org/ | https://botbot.me/mozilla/rust-internals | https://buildbot.rust-lang.org/homu/queue/rust | see also #rustc and #rust-libs'
[20:50:54] <cmr> aturon: has the march 9th deadline slipped?
[20:51:14] <simukis> so yeah, the improvement looking at it is only marginal, not sure whether it is worth pursuing, given this API is already stable
[20:51:26] <aturon> cmr: https://github.com/rust-lang/rust/issues/22500
[20:51:35] <cmr> thanks
[20:51:51] <aturon> we're slightly behind, but still expect to have all the relevant stabilization PRs at least in the queue this week
[20:52:20] <cmr> I mostly ask because I'm porting a bunch of gamedev crates to new-io etc, and was surprised to still see the feature gate.
[20:52:36] <cmr> new-io is great, btw.
[20:52:55] <aturon> cmr: just a few more days and you should be able to drop. we'll make an announcement
[20:52:59] <eddyb> cmr: I used .take in hematite_server
[20:52:59] <cmr> ok
[20:52:59] <aturon> cmr: and, very glad to hear that!
[20:53:07] <eddyb> aturon: new-io is goodstuff
[20:53:30] <cmr> I'm very pleased with how OsStr* and the new Path turned out as well.
[20:53:36] <cmr> it all feels very polished
[20:53:49] <eddyb> cmr: we had mistakes to learn from :D
[20:53:56] <Gankro> acrichto: pong
[20:54:13] * eddyb is feeling good about large parts of libstd
[20:55:32] <acrichto> Gankro: I forget, do you remember if the entry api for maps was intended to be stable for 1.0?
[20:56:43] <eddyb> acrichto: kinda sad HashMap still didn't get moved to libcollections. need to talk to nmatsakis and see about implementing defaults in inference
[20:56:48] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[20:57:09] <aturon> cmr: eddyb: yay! great to hear this!
[20:57:49] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[20:57:53] <acrichto> eddyb: yeah :(
[20:58:12] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[20:59:34] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[21:00:42] *** Quits: blaenk_ (blaenkdenum@moz-em283u.res.rr.com) (Ping timeout: 121 seconds)
[21:00:55] *** Quits: TheHydroImpulse (TheHydroImp@moz-r25mqk.ed.shawcable.net) (Client exited)
[21:02:09] <Gankro> acrichto: It is stable
[21:02:15] <Gankro> Just the v2/v3 stuff won't be
[21:02:41] <acrichto> Gankro: it is? http://doc.rust-lang.org/std/collections/hash_map/enum.Entry.html has all the methods as unsable
[21:02:42] *** Quits: Rym_ (y@moz-232.ad4.144.109.IP) (Ping timeout: 121 seconds)
[21:02:44] <acrichto> unstable*
[21:02:53] <acrichto> (or is that just an error?)
[21:02:53] <Gankro> Oh right, we rolled that back
[21:03:01] <acrichto> ah ok
[21:03:07] <Gankro> Uh
[21:03:25] <Gankro> Whether or not it should be stabilized is I guess a matter of preference?
[21:03:31] <bstrie> how is the performance of newio? I thought I heard someone saying it was anomalously slow last week
[21:04:05] <acrichto> Gankro: I don't really have a preference either way, just wondering if I should migrate all my crates away from it for now
[21:04:10] <acrichto> (temporarily ofc)
[21:04:30] <Gankro> acrichto: Nah I think it could be stabilized (the core, that is)
[21:04:34] <acrichto> bstrie: in general std::io wasn't really rewritten for performance, mostly for an API overhaul
[21:04:36] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Ping timeout: 121 seconds)
[21:04:57] <bstrie> acrichto: right, but I'd still like to know that it's not slow :)
[21:05:08] <acrichto> Gankro: ah ok cool, I'll ty to re-review it and see what's up
[21:05:12] <bstrie> especially that it's not slow for some fundamental reason that we won't be able to change
[21:05:23] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Connection closed)
[21:05:32] <acrichto> bstrie: hehe true, I don't think I've seen that just yet :)
[21:05:40] <Gankro> acrichto: the de-stabilization was a reaction to having trouble with by-value vs by-ref
[21:05:44] <WindowsBunny> bstrie: the goal of newio was to be as thin of a wrapper on the OS primitives as possible
[21:06:01] <Gankro> aturon: seems to believe that HKT allows the API to unify with by-value eventually
[21:06:21] <bstrie> eventually == Rust3k
[21:06:35] <aturon> Gankro: acrichto: ah yes, I think we're good to re-stabilize this
[21:06:36] <acrichto> Gankro: ah yeah I remember that
[21:06:39] *** Quits: dudel (dud@moz-55rvi2.dclient.hispeed.ch) (Connection closed)
[21:06:43] *** Parts: sternmull (kringel@moz-d91.khu.240.79.IP) ()
[21:07:53] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[21:09:48] <eddyb> Gankro: can't you encode the specific kind of HKT you need with associated types?
[21:09:54] <eddyb> Gankro: or is it rather arbitrary
[21:10:30] <aturon> bstrie: i think for the most part, changes in new-io should increase performance if anything
[21:10:39] <aturon> bstrie: in that all changes make it slimmer/lower-level
[21:10:44] <aturon> (to a first approximation)
[21:11:24] *** Quits: Diggsey (diggsey@moz-u3erf7.dsl.pipex.com) (Quit: Nettalk6 - www.ntalk.de)
[21:14:45] <Gankro> eddyb: It's too out-of-cache for me to remember
[21:15:00] <Gankro> eddyb: Honestly iirc we could basically just accept IntoCow
[21:15:13] <eddyb> Gankro: speaking of cache... https://github.com/rust-lang/rfcs/pull/936#issuecomment-78567965
[21:15:48] <Gankro> eddyb: iirc Rng is also an example of this problem?
[21:16:10] <eddyb> Gankro: I didn't think of cache lines until I was writing that comment, it might be an useful metric for problematic copies
[21:16:21] <eddyb> Gankro: Rng being copied instead of mutated?
[21:16:32] <Gankro> eddyb: Yeah
[21:16:34] *** Joins: njn (chatzilla@moz-02nu63.iinet.net.au)
[21:16:45] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[21:16:46] <eddyb> I've heard that some Rng implementations are quite large
[21:16:54] <Gankro> I don't think that's the concern
[21:17:02] <eddyb> right, but I wasn't sure what you meant
[21:17:47] <Gankro> I'd never heard of the BigStruct problem before
[21:17:57] <Gankro> Seems like people just being silly to not impl Copy for it
[21:18:06] <eddyb> Gankro: please comment then :)
[21:19:14] <eddyb> Gankro: if you see japaric's last comment, he still is holding onto that argument
[21:19:50] *** Quits: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net) (Ping timeout: 121 seconds)
[21:23:43] *** Joins: TheHydroImpulse (TheHydroImp@moz-4vd.6hg.148.68.IP)
[21:26:15] <arrrrrrrrr> reem: pnig
[21:26:17] <arrrrrrrrr> ping
[21:26:22] *** Joins: erickt (erickt@moz-4hh.6p3.217.74.IP)
[21:26:34] <reem> arrrrrrrrr: pong
[21:26:39] <arrrrrrrrr> https://gist.github.com/mahkoh/9ef4887649e662493e1a
[21:26:46] *** Joins: blaenk_ (blaenkdenum@moz-em283u.res.rr.com)
[21:26:55] <arrrrrrrrr> is this a correct interpretation of your post in the PartialOrd issue?
[21:27:05] *** Joins: violaceae (violaceae@moz-7uq2fc.u4is.n1v0.0007.2601.IP)
[21:27:09] *** Joins: tjakubo_ (tom@moz-sgi5qj.biz.rr.com)
[21:28:30] <reem> Close
[21:29:15] <reem> The conclusion is the same
[21:29:36] <reem> I would just modify to add a note the safe code shouldn't cause unsafety without further unsafe
[21:29:57] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Ping timeout: 121 seconds)
[21:30:32] <arrrrrrrrr> reem: it implies that [T].as_ptr() has to become an unsafe function
[21:30:34] <reem> the guideline in my mind is, "could a user, without typing unsafe, use this library with std and cause memory unsafety"
[21:31:04] <reem> arrrrrrrrr: .as_ptr() requires a further unsafe block to dereference the returned pointer, which is actually the error
[21:31:18] <reem> arrrrrrrrr: Ah, I see what you're saying though, that unsafe code relies on as_ptr returning a valid pointer
[21:31:37] <reem> fwiw I have always found it weird that you can construct nonsense *{mut, const} T values without unsafe
[21:31:39] <arrrrrrrrr> reem: as_ptr() and len() are safe functions. if unsafe code cannot rely on safe functions, then it cannot assume that the first len() entries are valid or that the pointer is even that long
[21:32:14] <arrrrrrrrr> or that ptr() is not a null pointer
[21:32:27] <reem> arrrrrrrrr: Remember that this could be just a guideline - you can always annotate code with guarantees
[21:32:32] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[21:32:40] <arrrrrrrrr> reem: like PartialOrd? ;)
[21:32:47] *** Quits: enaqx (enaqx@moz-asgdqm.infomir.com.ua) (Ping timeout: 121 seconds)
[21:33:09] <reem> arrrrrrrrr: I see that case as different since it's a generic method, so it could do anything
[21:33:14] <reem> as_ptr can't be changed by downstream code to do something else
[21:33:34] <eddyb> japaric: did you ask me if I meant "char would be usable only in libunicode and downstream crates"? because I didn't think of that until now
[21:33:39] <arrrrrrrrr> maybe
[21:34:04] <imperio> how do you declare a const slice ? I can't figure it out...
[21:34:12] <arrrrrrrrr> let x: &[T] = ...
[21:34:17] <bstrie> kmc: are you still accepting edits for the servo experience report? I found another typo, plus I think you can add another ref to the saraswat memory safety paper
[21:34:19] <eddyb> "const"?
[21:34:32] <arrrrrrrrr> we call that immutable around these parts
[21:34:39] <imperio> eddyb: const tt : [i32] = [0, 1] for example
[21:34:42] *** Joins: Rym_ (y@moz-232.ad4.144.109.IP)
[21:34:51] <arrrrrrrrr> an array?
[21:34:55] <arrrrrrrrr> imperio: you mean fixed size?
[21:35:00] <eddyb> imperio: you can use &'static [i32]
[21:35:03] <imperio> arrrrrrrrr: yes
[21:35:03] <reem> const X: [i32; 2] = [0, 1]
[21:35:06] <arrrrrrrrr> ^
[21:35:09] <reem> that's fixed size
[21:35:15] <reem> if you want a static slice
[21:35:36] <reem> you can do const X: &'static [i32] = &[0, 1] // I don't know if this actually requires static instead of const
[21:35:53] <arrrrrrrrr> rusti: const X: &'static [i32] = [];
[21:35:54] -playbot- <anon>:14:35: 14:37 error: mismatched types:
[21:35:54] -playbot-  expected `&'static [i32]`,
[21:35:54] -playbot- output truncated; full output at: http://bit.ly/1MwFwWX
[21:35:58] <arrrrrrrrr> rusti: const X: &'static [i32] = &[];
[21:35:59] -playbot- ()
[21:36:18] <arrrrrrrrr> rusti: const X: &'static [i32] = &[1, 2][1..];
[21:36:19] -playbot- <anon>:14:36: 14:47 error: user-defined operators are not allowed in constants [E0011]
[21:36:20] -playbot- <anon>:14         const X: &'static [i32] = &[1, 2][1..];
[21:36:20] -playbot- output truncated; full output at: http://bit.ly/1Ca0Puu
[21:36:23] <arrrrrrrrr> aw
[21:36:23] <imperio> reem: it doesn't work for me
[21:37:10] <imperio> oh wait, it was a ';' and not a ','
[21:37:14] <imperio> that's weird
[21:37:21] <arrrrrrrrr> ^^^^^^^^^^^^
[21:37:25] <reem> arrrrrrrrr: Indexing is allowed, fwiw
[21:37:28] <arrrrrrrrr> told you [T; N] was a mistake
[21:37:38] <reem> Takes half a second to learn
[21:37:41] *** Quits: guewen (guewen@moz-ftf7u4.cust.swisscom.ch) (Quit: Leaving...)
[21:37:42] <arrrrrrrrr> [T, ..N] those were the days
[21:38:10] <arrrrrrrrr> I guess it's ok.
[21:38:11] <reem> I actually found [0, ...128] pretty confusing, since it looks like I'm creating a range from 0 -> 128 not 128 zeroes
[21:38:24] <arrrrrrrrr> maybe
[21:39:02] *** Quits: blaenk_ (blaenkdenum@moz-em283u.res.rr.com) (Connection closed)
[21:39:19] <imperio> arrrrrrrrr:  const t : [i32; 10] = <(...] is actually working
[21:39:35] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[21:41:27] *** Joins: Skyler (Skyler@moz-e93b35.sd.cox.net)
[21:41:28] <imperio> I'm getting confusef with all these different writings...
[21:42:36] *** Joins: zmack (zmack@moz-4b0.o8l.26.188.IP)
[21:42:42] *** Quits: petrochenkov (Mibbit@moz-4val3f.broadband.corbina.ru) (Quit: http://www.mibbit.com ajax IRC Client)
[21:43:42] <arrrrrrrrr> rusti: enum X { A = X::A }
[21:43:43] -playbot- <anon>:14:22: 14:26 error: mismatched types:
[21:43:43] -playbot-  expected `isize`,
[21:43:43] -playbot- output truncated; full output at: http://bit.ly/1MwGcvt
[21:44:07] <arrrrrrrrr> ^ stack overflow
[21:44:16] *** Joins: srh_ (User@moz-tvc5sp.sntcca.sbcglobal.net)
[21:44:48] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Connection closed)
[21:45:36] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[21:46:39] *** Quits: zmack (zmack@moz-4b0.o8l.26.188.IP) (Ping timeout: 121 seconds)
[21:47:42] *** Joins: enaqx (enaqx@moz-asgdqm.infomir.com.ua)
[21:48:01] *** Joins: pnkfelix (pnkfelix@moz-eljppb.fbx.proxad.net)
[21:48:02] *** ChanServ sets mode: +o pnkfelix
[21:48:03] *** Quits: srh__ (User@moz-tvc5sp.sntcca.sbcglobal.net) (Ping timeout: 121 seconds)
[21:50:52] <arrrrrrrrr> eddyb: ping
[21:51:09] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Connection closed)
[21:52:00] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[21:52:41] <huon> arrrrrrrrr: already filed https://github.com/rust-lang/rust/issues/23302
[21:52:45] <arrrrrrrrr> just saw it
[21:54:05] <arrrrrrrrr> it's fascinating that you can't chain `as` in different enum variants
[21:54:13] <arrrrrrrrr> I can't even imagine how that must be implemented
[21:54:20] <arrrrrrrrr> https://github.com/rust-lang/rust/issues/23304#issuecomment-78639165
[21:54:32] *** Joins: hoverbear (hoverbear@moz-1opgd3.wireless.uvic.ca)
[21:54:46] *** Quits: killercup (killercup@moz-lar.9pk.10.91.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[21:56:36] *** Joins: jdm (jdm@moz-4vu.06r.98.75.IP)
[21:58:51] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Connection closed)
[21:59:08] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[21:59:23] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Connection closed)
[21:59:33] *** Quits: Guest63_ (textual@moz-56c.qli.61.176.IP) (Connection closed)
[22:00:06] <arrrrrrrrr> is Jai the new language Rust is being compared to? I guess Go isn't hip enough anymore
[22:00:46] *** Quits: kmcguire_ (kmcguire@moz-pg1gb9.biz.rr.com) (Ping timeout: 121 seconds)
[22:01:13] <eddyb> arrrrrrrrr: pong
[22:01:26] <arrrrrrrrr> eddyb: sorry, I've forgotten what it was about
[22:01:33] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[22:02:05] *** Quits: curmet (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:02:57] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Connection closed)
[22:03:51] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[22:04:05] <acrichto> brson: is there a cross-platform way of getting the md5 or sha1 of a string in a shell?
[22:04:40] *** Quits: tjakubo_ (tom@moz-sgi5qj.biz.rr.com) (Quit: WeeChat 1.1)
[22:04:42] <WindowsBunny> acrichto: a string in a shell?
[22:04:52] <acrichto> e.g. `echo foo | md5sum`
[22:04:54] <WindowsBunny> oh, like some sort of command we can rely on
[22:04:58] <acrichto> yeah
[22:05:03] <arielb1> I found more coherence problems
[22:05:08] <arielb1> short url: http://is.gd/OLkl0u
[22:05:12] <arielb1> nmatsakis
[22:05:40] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Ping timeout: 121 seconds)
[22:05:41] <arielb1> I don't have a trans ambiguity, but a "cannot resolve `Bar : Bar`"
[22:05:45] <WindowsBunny> acrichto: There is the File Checksum Integrity Verifier on windows
[22:05:53] <acrichto> WindowsBunny: wut
[22:06:08] <WindowsBunny> hmmm
[22:06:09] <brson> acrichto: multirust uses 'shasum', which is part of perl
[22:06:22] <acrichto> brson: do you know if that'd work on windows
[22:06:36] <brson> acrichto: it works on mingw yes
[22:06:38] <acrichto> the motivation for this is changing the 4e7c5e5c metadata automatically for each release
[22:07:10] <brson> acrichto: oh, hm shasum may not work on windows. chksum definitely  exists everywhere
[22:07:20] <brson> but it is not a wonderful algorithm
[22:07:47] <acrichto> eh that's fine, just needs to to to a short few characters
[22:08:00] <brson> i suspect shasum doesn't work on windows or i would have used it in rust-buildbot, where i used chksum
[22:08:14] <brson> cksum
[22:08:18] *** Joins: scott (uid25790@moz-e5ok1n.brockwell.irccloud.com)
[22:09:00] <WindowsBunny> I have shasum on msys2
[22:09:08] <WindowsBunny> I have md5sum as well
[22:09:22] <WindowsBunny> no chksum though
[22:09:42] <WindowsBunny> oh, I do have cksum
[22:09:57] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[22:10:22] <doener> brson: oh, btw, is there a reason why multirust doesn't use "exec" to launch the final executable? makes it a bit harder run it in gdb (or maybe I just don't know how to correctly use gdb...)
[22:10:51] <brson> doener: because you haven't submitted the patch yet!
[22:11:39] <doener> brson: ah, will do so then
[22:11:53] <brson> i'll shell into one of the windows bots and see what checksum progs they have
[22:12:55] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Connection closed)
[22:13:25] <brson> acrichto WindowsBunny: our windows bots have both shasum and md5sum too
[22:13:42] <brson> i'm curious now why i couldn't use them in rust-buildbot
[22:14:02] <brson> i definitely spent an afternoon just going through different hashes to find one that worked everywhere...
[22:14:08] <WindowsBunny> the mystery deepens
[22:15:10] <brson> hm, it may be that the output format was inconsistent
[22:15:33] <acrichto> ah ok, I will dabble
[22:15:33] <brson> shasum on mingw outputs different stuff than shasum on linux
[22:15:56] <brson> at the time i needed the exact output to be identical
[22:17:29] *** Quits: srh_ (User@moz-tvc5sp.sntcca.sbcglobal.net) (Quit: Leaving)
[22:19:52] *** Quits: hoverbear (hoverbear@moz-1opgd3.wireless.uvic.ca) (Quit: Time to hibernate.... ZzZz...)
[22:21:06] *** Joins: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net)
[22:21:21] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[22:22:00] <kmc> bstrie: sure, open a PR on larsberg's repo :)
[22:23:11] *** Quits: blaenk (blaenkdenum@moz-em283u.res.rr.com) (Connection closed)
[22:23:37] *** Joins: blaenk (blaenkdenum@moz-em283u.res.rr.com)
[22:24:16] *** Joins: adu (ajr@moz-m9p.pdt.243.69.IP)
[22:27:01] *** Quits: Astrum|Lap (Astrum|Lap@moz-7enfbr.co.comcast.net) (Client exited)
[22:28:42] *** Quits: tjakubow (tom@moz-ag87jj.fios.verizon.net) (Quit: WeeChat 1.1.1)
[22:28:47] *** Joins: tjakubow (tom@moz-ag87jj.fios.verizon.net)
[22:28:57] *** Quits: bjz (bjz@moz-puppgq.tpgi.com.au) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[22:29:12] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[22:30:27] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[22:31:09] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[22:33:25] *** nrc is now known as nrc|afk
[22:35:59] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[22:38:55] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Connection closed)
[22:40:37] <arrrrrrrrr> how can I get notified on internals when someone posted in a thread I've posted in?
[22:40:43] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[22:43:33] <pnkfelix> arrrrrrrrr: you mean other than separately marking the thread at "watching" ?
[22:43:42] <arrrrrrrrr> github does that automatically
[22:44:05] <pnkfelix> arrrrrrrrr: yeah, that's why many of us do the "cc me" pattern on github
[22:44:16] <arrrrrrrrr> there is a subscribe button
[22:44:33] <arrrrrrrrr> the only reason to post cc me is to tell others that you are subscribed
[22:44:39] <huon> no
[22:44:45] <huon> Github tags emails differently
[22:44:49] <huon> for custom filters
[22:44:52] <arrrrrrrrr> haven't noticed
[22:45:15] <arrrrrrrrr> anyway: what about internals?
[22:45:16] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[22:45:20] <huon> "X-GitHub-Reason: mention"
[22:45:30] <huon> look in preferences
[22:45:35] <huon> there's various options
[22:45:46] <arrrrrrrrr> I don't see one to auto-watch if I've posted
[22:46:45] <huon> what does auto-watch mean?
[22:46:56] <arrrrrrrrr> it's set to "watching" when I've posted
[22:46:58] <arrrrrrrrr> like github
[22:47:07] <arrrrrrrrr> it's called "subscribe" on github
[22:47:14] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Connection closed)
[22:47:32] <huon> maybe there's no configuration for that
[22:47:50] <arrrrrrrrr> I want to get emails for new posts in threads I've posted in
[22:51:00] *** Quits: violaceae (violaceae@moz-7uq2fc.u4is.n1v0.0007.2601.IP) (Quit: Leaving)
[22:52:25] <pnkfelix> acrichto: brson: can one of you take action on whatever eddyb is referring to in https://github.com/rust-lang/rfcs/pull/865#issuecomment-78434781 ?  ("action" here may just mean "reopen that RFC", I don't know and cannot act on it in near future)
[22:52:59] <aturon> pnkfelix: fwiw, i'm confused about the decision to postpone that RFC
[22:53:38] *** Quits: evanfarrar (evanfarrar@moz-lftg5l.east.verizon.net) (Connection closed)
[22:54:11] <pnkfelix> aturon: I believe the decision was based on a discussion where a crucial assumption was that associated constants were not on 1.0 timeline
[22:54:55] <pnkfelix> aturon: the relevant mtg was on February 26th (I just was delayed on actually writing up the note and closing it)
[22:55:12] <aturon> pnkfelix: right (i think i wasn't there) -- the comment made that pretty clear, but the rationale didn't make sense to me because this is just updating the text of the old RFC to reflect language changes
[22:55:17] <aturon> i don't think it's a big deal either way
[22:55:54] <pnkfelix> aturon: it was mostly to not to force anyone to spend time thinking about that RFC text in the short term
[22:55:55] *** Joins: reem (reem@moz-e8666c.coob.q2h1.0009.2601.IP)
[22:56:06] <pnkfelix> aturon: at this point it seems clear that this decision was a net loss in productiveity
[22:56:09] <aturon> hahaha
[22:56:11] <pnkfelix> aturon: :(
[22:56:15] <aturon> no worries
[22:56:46] <pnkfelix> aturon: feel free to reopen and get it merged
[22:56:49] <aturon> the bigger picture is that there are people working to implement this feature, and we shouldn't stand in their way :)
[22:56:53] <aturon> ok, i will reopen, thanks pnkfelix 
[22:58:23] *** Quits: reem (reem@moz-e8666c.coob.q2h1.0009.2601.IP) (Connection closed)
[22:58:37] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[23:00:57] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[23:07:19] *** Quits: steveklabnik (steveklabni@moz-kkp.qlp.131.104.IP) (Ping timeout: 121 seconds)
[23:07:23] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Connection closed)
[23:07:26] *** Quits: imperio (Mibbit@moz-8otf3a.fbx.proxad.net) (Quit: http://www.mibbit.com ajax IRC Client)
[23:09:30] *** Joins: reem (reem@moz-bglv24.coob.q2h1.0009.2601.IP)
[23:10:17] *** Quits: tjakubow (tom@moz-ag87jj.fios.verizon.net) (Quit: WeeChat 1.1.1)
[23:10:25] *** Joins: mib_a60wl0 (Mibbit@moz-juv.9o3.252.72.IP)
[23:10:32] <arrrrrrrrr> how do I mark notifications as "read" in internals?
[23:10:46] *** Quits: reem (reem@moz-bglv24.coob.q2h1.0009.2601.IP) (Connection closed)
[23:13:12] <arrrrrrrrr> http://a.pomf.se/pqmctx.gif
[23:13:14] <arrrrrrrrr> wat
[23:14:15] *** Quits: mib_a60wl0 (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[23:16:18] *** Joins: steveklabnik (root@moz-fft.uo8.55.45.IP)
[23:16:18] *** ChanServ sets mode: +o steveklabnik
[23:21:15] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[23:22:18] *** Joins: swgillespie (swgillespie@moz-upj.3un.220.167.IP)
[23:23:20] *** Quits: arielb1 (Ariel@moz-qfu7pm.red.bezeqint.net) (Connection closed)
[23:24:26] *** Joins: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net)
[23:25:24] *** Quits: reem (reem@moz-2icmmi.ca.comcast.net) (Connection closed)
[23:28:16] *** Joins: pcwalton (pcwalton@moz-l8ebtf.sfo1.mozilla.com)
[23:28:16] *** ChanServ sets mode: +o pcwalton
[23:29:57] *** Joins: reem (reem@moz-2icmmi.ca.comcast.net)
[23:33:47] <pnkfelix> nmatsakis: ping
[23:36:47] <pnkfelix> acrichto: FYI play.rust-lang.org is failing again for me, so I guess your earlier change didn't actually fix the issue.  :(
[23:53:00] <Gankro> nrc|afk: your triage link seems down :(
[23:53:35] *** Joins: arrrrrrr1 (arrrrrrrrs@moz-q3f546.dynamic.qsc.de)
[23:55:47] *** Quits: Nekit1234007 (nekit@moz-vfr.64q.51.84.IP) (Quit: leaving)
[23:56:09] *** Quits: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net) (Ping timeout: 121 seconds)
[23:56:23] *** Quits: arrrrrrrrr (arrrrrrrrs@moz-6p13k2.dynamic.qsc.de) (Ping timeout: 121 seconds)
[23:56:30] *** Joins: hoverbear (hoverbear@moz-csaicn.gv.shawcable.net)
