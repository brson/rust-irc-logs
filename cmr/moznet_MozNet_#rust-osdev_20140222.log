[00:13:58] *** Quits: Tobba (Tobba@moz-462B7F7F.ias.bredband.telia.com) (Ping timeout)
[00:24:24] *** kimundi is now known as zz_kimundi
[00:32:09] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[00:51:46] *** Quits: sunfish (chatzilla@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Ping timeout)
[00:53:06] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[00:53:14] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[01:47:49] *** Quits: ChickeNES (ChickeNES@D4AF7317.14AD393B.5B85F5ED.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[02:06:24] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[02:06:27] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[02:07:47] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[03:18:24] *** Joins: cmr (moznet@moz-EC676DFE.members.linode.com)
[03:20:21] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[03:23:11] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[03:36:30] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[03:47:07] *** Quits: sbalmos (quassel@CA5677B6.576D0C1.ED2EFC1B.IP) (Client exited)
[03:47:13] *** Quits: zz_kimundi (kimundi@moz-3202B743.dip0.t-ipconnect.de) (Ping timeout)
[03:50:58] *** Joins: zz_kimundi (kimundi@moz-77A292B3.dip0.t-ipconnect.de)
[03:50:59] *** zz_kimundi is now known as kimundi
[04:30:05] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[04:30:23] *** Joins: brson (brson@E02A6CDD.75598729.B6A3AE99.IP)
[04:31:07] *** Quits: geoffhill (geoffhill@moz-95FF7399.members.linode.com) (Ping timeout)
[04:40:54] *** Quits: brson (brson@E02A6CDD.75598729.B6A3AE99.IP) (Ping timeout)
[04:44:21] *** Joins: brson (brson@E02A6CDD.75598729.B6A3AE99.IP)
[05:40:49] *** Joins: ecl3ctic (ecl3ctic@578C64B6.F0F44EFA.76AE55C1.IP)
[05:59:48] *** Joins: ChickeNES (ChickeNES@moz-CE6BEDE4.swwn1.iit.edu)
[06:18:58] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[06:30:42] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[07:53:58] *** Joins: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro)
[08:14:47] *** Quits: mawuli (mawuli@moz-36C70B7D.com.gh) (Ping timeout)
[08:25:56] *** Joins: devbug_ (quassel@23AC5F12.9D950176.3655BBF5.IP)
[08:25:58] *** Quits: devbug_ (quassel@23AC5F12.9D950176.3655BBF5.IP) (Client exited)
[08:26:04] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:26:07] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:26:25] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:29:06] *** Quits: bjz_ (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[08:34:37] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[08:41:47] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:42:56] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:42:59] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:53:14] *** Joins: pczarn (Mibbit@moz-69A55FA.izacom.pl)
[09:08:58] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[09:10:43] *** Joins: bjz_ (bjz@B398BE78.F804C29E.D35A31DF.IP)
[09:11:03] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (No route to host)
[09:35:26] <eddyb> pcmattman: wha, have you achieved lock-free recovery?
[09:36:25] * eddyb wonders why m_RecoveryLock is still there
[09:36:25] <pcmattman> yes, but not proven to be correct aside from running it.
[09:36:32] <eddyb> hehe
[09:36:35] <pcmattman> because I forgot to remove it :)
[09:36:54] <eddyb> so what are you doing, stealing the free list?
[09:37:09] <pcmattman> yes, essentially
[09:37:47] *** Joins: Tobba (Tobba@moz-462B7F7F.ias.bredband.telia.com)
[09:37:50] <pcmattman> so there's a possibility that during recovery, it'll allocate a slab where it would have otherwise used a freed object
[09:38:22] <eddyb> right, yeah. but I wish we had a real benchmark for this, it's interesting
[09:39:11] <pcmattman> it's also really very trivial to do recovery where object == slab (rather than slab contains objects)
[09:40:09] <eddyb> pcmattman: I wish we had some way of being notified if recovery should yield
[09:40:36] <pcmattman> yield?
[09:40:57] <eddyb> could put back the free list and there would be no risk of new slabs being allocated
[09:40:59] <eddyb> pcmattman: reschedule
[09:41:31] <pcmattman> ah
[09:41:51] <pcmattman> well, realistically it's not likely to waste more than a slab or two, and then they'll most likely get recovered soon anyway
[09:41:59] <eddyb> hmm, okay
[09:42:25] <pcmattman> (eg, the code that caused that frees some memory, recovery runs, the slab is freed)
[09:43:03] <pcmattman> but yeah, should be doable in Rust
[09:43:28] <eddyb> I should polish the rust implementation, make it use mmap/munmap and bench it against glibc malloc
[09:43:58] <eddyb> allocate a few million Rc<int>'s :P
[09:44:23] <eddyb> (or the equivalent space, std doesn't have allocators yet)
[09:44:50] <pcmattman> probably worth also benchmarking it against jemalloc and tcmalloc and such
[09:46:17] <eddyb> recovery of highly fragmented AST nodes would be another interesting test (the always increasing memory usage in rustc is a bunch of spikes under massif)
[09:47:40] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[09:51:19] <pcmattman> hmm
[09:52:33] <pcmattman> to be honest, for recovery it'd almost be better to use something like madvise rather than munmap
[09:53:04] <eddyb> so the kernel is free to do something smarter?
[09:53:07] <pcmattman> although I suppose either way you'll end up with a fault & page
[09:54:37] *** Quits: ecl3ctic (ecl3ctic@578C64B6.F0F44EFA.76AE55C1.IP) (Quit: Leaving)
[09:54:47] <pcmattman> right, but either way your worst-case is going to require a page to be brought in
[09:57:22] <pcmattman> just something to consider with a lot of allocations/frees that fragment :)
[10:03:20] <strcat> pcmattman: vrange would be best ;)
[10:03:34] <strcat> but it hasn't landed yet
[10:03:42] * pcmattman braves lkml
[10:04:00] <pcmattman> yes, vrange would be much better than madvise
[10:05:01] *** Joins: mib_sepmcm (Mibbit@moz-BB56F7AF.rezometz.org)
[10:06:11] <eddyb> http://lwn.net/Articles/542504/ o_O those numbers
[10:06:20] <Leo`> hey
[10:07:41] <pcmattman> eddyb: those numbers aren't very helpful without 'before' numbers... :/
[10:08:42] <eddyb> pcmattman: isn't vanilla "before" and vrange "after"?
[10:08:51] <pcmattman> sigh
[10:08:52] <pcmattman> reading
[10:09:03] <pcmattman> yes :)
[10:09:11] <Leo`> eddyb: i'm trying to compile my crate as a bin to see if it makes a difference
[10:11:35] <strcat> pcmattman: mmap zeroes the memory so that's one of the issues with it
[10:11:55] <strcat> with vrange you don't ever have to be giving up memory
[10:12:01] <strcat> so it doesn't have to keep zeroing
[10:12:52] <pcmattman> right
[10:12:54] <Leo`> "require start lang item" huh ?
[10:13:57] <eddyb> hmpf
[10:14:09] <eddyb> how did we do this in rustic?
[10:16:03] <Leo`> mh
[10:16:08] <Leo`> #[start] apparently
[10:18:54] <Leo`> mh
[10:19:05] <Leo`> compiling the crate as a bin doesn't change anything
[10:21:44] <pcmattman> eddyb: so that lock-free recovery... it doesn't quite work ;)
[10:22:01] <eddyb> heh
[10:22:07] <eddyb> Leo`: odd
[10:22:21] <eddyb> Leo`: does it remove the crate map nonsense?
[10:23:25] <Leo`> dunno
[10:23:47] <Leo`> apparently no
[10:24:04] <eddyb> how does it even get created?
[10:24:10] <eddyb> do you use __log_level()?
[10:24:17] <Leo`> oh
[10:24:37] <Leo`> oh no
[10:24:40] <Leo`> forget what I said
[10:24:42] <Leo`> stupid me
[10:25:33] <Leo`> mh
[10:25:41] <Leo`> there is still a _rust_crate_map_toplevel that shows up in readelf
[10:25:51] <Leo`> and a _crate_map_child_vectors
[10:26:27] <Leo`> mhh
[10:26:28] <eddyb> do you use __log_level() in your source?
[10:26:31] <Leo`> but the bug is still there
[10:26:35] <Leo`> no
[10:26:42] <eddyb> any macros?
[10:26:48] <Leo`> i'm testing with a minimal example
[10:26:58] <Leo`> mh
[10:27:03] <eddyb> do you have #[no_std];?
[10:27:04] <Leo`> macros are enabled but not used
[10:27:07] <Leo`> yes
[10:27:14] * eddyb is confused
[10:27:29] <Leo`> well wait
[10:27:37] <Leo`> I will try to create the binary with LLVM instead of Rustc
[10:27:41] <Leo`> from the LLVM bytecode
[10:27:42] <eddyb> Leo`: do you run rustc with --opt-level=3 or opt with -O3?
[10:27:50] <Leo`> just -O
[10:28:00] <strcat> set target-cpu ;p
[10:28:08] <eddyb> strcat: inb4 SSE instructions
[10:28:30] <eddyb> 4.2, even
[10:28:56] <Leo`> [1]    21812 segmentation fault  opt entryn.bc -o entryn_opt.bc
[10:29:00] <Leo`> mmhhhhhhhhhh
[10:29:20] <eddyb> and you're not running opt with -O3
[10:29:24] *** Joins: bluz (blaz@moz-B63C229A.torservers.net)
[10:29:26] <eddyb> not that it's compatible :P
[10:29:29] <strcat> eddyb: AVX*
[10:29:55] <Leo`> llc segfaults too
[10:29:57] <Leo`> .___.
[10:30:01] <eddyb> gg
[10:30:21] <eddyb> perk #21 of building rustc yourself
[10:30:23] <Leo`> what the fuck have I done
[10:30:42] <eddyb> Leo`: your system LLVM is obviously too ancient for rustc bytecode
[10:30:49] <Leo`> ha...
[10:31:08] <eddyb> and appears to have asserts disabled, thus crashing
[10:31:27] <Leo`> Built Dec 18 2013 (10:38:32)
[10:31:37] <Leo`> is this too ancient ?
[10:31:56] <eddyb> that's an year ago!
[10:32:12] <Leo`> hum
[10:32:15] <Leo`> rather 2 months
[10:47:06] *** Quits: devbug (quassel@23AC5F12.9D950176.3655BBF5.IP) (Connection reset by peer)
[11:00:50] <pcmattman> eddyb: never mind, the lock-free recovery isn't broken, just the recovery :)
[11:06:48] *** Quits: mib_sepmcm (Mibbit@moz-BB56F7AF.rezometz.org) (Quit: http://www.mibbit.com ajax IRC Client)
[11:25:20] *** Quits: brson (brson@E02A6CDD.75598729.B6A3AE99.IP) (Ping timeout)
[11:26:46] *** Quits: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro) (Ping timeout)
[11:56:38] *** Quits: bluz (blaz@moz-B63C229A.torservers.net) (Input/output error)
[12:06:41] *** Quits: ChickeNES (ChickeNES@moz-CE6BEDE4.swwn1.iit.edu) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[12:16:54] *** Joins: mawuli (mawuli@moz-36C70B7D.com.gh)
[13:05:07] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[13:50:50] *** Joins: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP)
[13:51:02] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[13:53:44] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[14:14:48] *** Joins: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro)
[14:21:15] <Leo`> eddyb: do you think I can open a bugreport for this ?
[14:21:31] <Leo`> I don't even know what the problem is exactly
[14:23:18] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[14:23:26] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[14:23:55] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[14:24:45] *** Joins: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com)
[14:25:39] <eddyb> Leo`: I have no idea :/
[14:26:03] <eddyb> since you can't easily optimize away other things to simplify the testcase...
[14:30:52] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[14:38:50] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[15:23:26] *** Joins: ChickeNES (ChickeNES@moz-CE6BEDE4.swwn1.iit.edu)
[15:59:24] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[16:04:00] *** Quits: ChickeNES (ChickeNES@moz-CE6BEDE4.swwn1.iit.edu) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[16:15:21] *** Quits: kimundi (kimundi@moz-77A292B3.dip0.t-ipconnect.de) (Ping timeout)
[16:18:45] *** Joins: kimundi (kimundi@moz-AE597961.dip0.t-ipconnect.de)
[16:23:11] *** kimundi is now known as zz_kimundi
[16:25:29] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[16:33:26] *** zz_kimundi is now known as kimundi
[16:57:10] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[17:06:19] *** Quits: arrdem (arrdem@moz-2E1DB1F9.ece.utexas.edu) (Quit: leaving)
[17:07:53] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[17:16:13] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[17:22:20] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[17:23:38] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[17:39:13] *** Quits: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[17:45:55] *** Quits: mawuli (mawuli@moz-36C70B7D.com.gh) (Quit: Leaving)
[17:46:20] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[17:46:28] *** Quits: bjz_ (bjz@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[18:02:40] *** Joins: frogmella (Mibbit@moz-20B2F02E.dyn.iinet.net.au)
[18:03:22] *** Quits: frogmella (Mibbit@moz-20B2F02E.dyn.iinet.net.au) (Quit: http://www.mibbit.com ajax IRC Client)
[18:12:15] <Leo`> pfff
[18:12:37] <Leo`> it's so sad that compiling large Rust programs can't exploit multicore ... :(
[18:16:12] *** Quits: rsaarelm (rsaarelm@moz-84E87CA5.kapsi.fi) (Ping timeout)
[18:16:48] *** Quits: Dnyarri (dnyarri@moz-84E87CA5.kapsi.fi) (Ping timeout)
[18:19:38] *** Joins: Dnyarri (dnyarri@moz-84E87CA5.kapsi.fi)
[18:21:58] *** Joins: rsaarelm (rsaarelm@moz-84E87CA5.kapsi.fi)
[18:33:53] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[18:40:49] *** Quits: utkarsh (utkarsh@moz-CA9C0A97.members.linode.com) (Quit: ZNC - http://znc.in)
[18:41:04] *** Joins: utkarsh (utkarsh@moz-CA9C0A97.members.linode.com)
[18:52:37] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[19:04:06] *** Quits: pczarn (Mibbit@moz-69A55FA.izacom.pl) (Quit: http://www.mibbit.com ajax IRC Client)
[19:33:48] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[19:40:06] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[19:50:49] <Yurume> Leo`, go multi-crate and do make -j :)
[19:53:58] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[20:03:30] *** Joins: mawuli (mawuli@moz-36C70B7D.com.gh)
[20:30:00] *** Joins: GeorgeH (George@moz-FB5F2302.hsd1.nj.comcast.net)
[20:42:10] *** Quits: rsaarelm (rsaarelm@moz-84E87CA5.kapsi.fi) (Ping timeout)
[20:42:24] *** Quits: Dnyarri (dnyarri@moz-84E87CA5.kapsi.fi) (Ping timeout)
[20:42:59] *** Joins: Dnyarri (dnyarri@moz-84E87CA5.kapsi.fi)
[20:47:11] *** Joins: rsaarelm (rsaarelm@moz-84E87CA5.kapsi.fi)
[20:49:16] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[20:51:09] *** Quits: rsaarelm (rsaarelm@moz-84E87CA5.kapsi.fi) (Ping timeout)
[20:51:40] *** Quits: Dnyarri (dnyarri@moz-84E87CA5.kapsi.fi) (Ping timeout)
[20:54:15] *** Joins: Dnyarri (dnyarri@moz-84E87CA5.kapsi.fi)
[20:57:11] *** Joins: rsaarelm (rsaarelm@moz-84E87CA5.kapsi.fi)
[21:01:19] *** Joins: ChickeNES (ChickeNES@moz-CE6BEDE4.swwn1.iit.edu)
[21:04:05] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[21:05:32] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[21:12:24] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[21:13:26] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[21:21:27] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[21:24:05] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[21:26:12] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[21:29:27] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[21:39:05] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[21:47:26] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[21:51:45] *** Quits: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro) (Ping timeout)
[21:53:44] *** Joins: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net)
[22:02:47] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[22:22:27] *** Quits: whitglint (uid15486@moz-31ABA2C0.irccloud.com) (Quit: Connection closed for inactivity)
[23:23:36] *** Quits: mawuli (mawuli@moz-36C70B7D.com.gh) (Client exited)
[23:49:56] *** Joins: devbug (quassel@23AC5F12.9D950176.3655BBF5.IP)
[23:50:34] *** Quits: devbug (quassel@23AC5F12.9D950176.3655BBF5.IP) (Quit: http://quassel-irc.org - Chat comfortably. Anywhere.)
[23:50:34] *** Joins: devbug (quassel@23AC5F12.9D950176.3655BBF5.IP)
[23:59:03] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[23:59:50] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
