[00:04:23] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[00:05:23] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[00:07:17] *** Quits: tiffany (kawaii@moz-FC0DB29D.dhcp.embarqhsd.net) (Ping timeout)
[00:07:33] *** Joins: tiffany (kawaii@moz-FC0DB29D.dhcp.embarqhsd.net)
[00:21:37] *** Quits: Tobba (Tobba@moz-462B7F7F.ias.bredband.telia.com) (Ping timeout)
[00:22:26] *** Quits: leonvv (leonvv@moz-7D83A5F1.ip.telfort.nl) (Quit: Leaving)
[00:58:03] *** Joins: erickt (Adium@moz-BDF423C7.hfc.comcastbusiness.net)
[01:36:49] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[02:12:58] *** Quits: sunfish (chatzilla@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[02:56:01] *** Joins: mawuli (mawuli@moz-36C70B7D.com.gh)
[03:01:29] *** Quits: zxcdw (r-a@5F0EDB29.B543C4DE.3933CC16.IP) (Ping timeout)
[03:04:10] *** Joins: zxcdw (r-a@5F0EDB29.B543C4DE.3933CC16.IP)
[03:06:05] *** Joins: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net)
[03:16:00] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[03:18:14] *** Quits: erickt (Adium@moz-BDF423C7.hfc.comcastbusiness.net) (Quit: Leaving.)
[03:27:34] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[03:48:34] *** Quits: zz_kimundi (kimundi@moz-767272DB.dip0.t-ipconnect.de) (Ping timeout)
[03:52:14] *** Joins: zz_kimundi (kimundi@moz-3202B743.dip0.t-ipconnect.de)
[03:52:16] *** zz_kimundi is now known as kimundi
[03:55:08] *** Quits: trecer (trecer@moz-36BEFC79.hsd1.pa.comcast.net) (Quit: Computer has gone to sleep.)
[04:11:52] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[04:14:09] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[04:21:14] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[04:37:22] *** Quits: sbalmos (quassel@CA5677B6.576D0C1.ED2EFC1B.IP) (Client exited)
[04:42:17] *** Joins: brson_ (brson@E02A6CDD.75598729.B6A3AE99.IP)
[04:42:18] *** Quits: brson_ (brson@E02A6CDD.75598729.B6A3AE99.IP) (Quit: brson_)
[04:42:26] *** Joins: brson_ (brson@E02A6CDD.75598729.B6A3AE99.IP)
[04:42:47] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[04:42:48] *** Quits: brson_ (brson@E02A6CDD.75598729.B6A3AE99.IP) (Quit: leaving)
[04:42:53] *** Joins: brson (brson@E02A6CDD.75598729.B6A3AE99.IP)
[04:43:31] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[04:46:12] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[05:20:28] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:30:57] *** Quits: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net) (Ping timeout)
[06:30:51] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[06:49:20] *** Quits: brson (brson@E02A6CDD.75598729.B6A3AE99.IP) (Ping timeout)
[06:57:42] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[07:11:17] *** Joins: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro)
[07:23:59] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[08:15:57] *** Joins: huon (Thunderbir@moz-826BD85A.lns20.syd6.internode.on.net)
[08:23:59] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[08:48:07] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[09:17:23] *** Joins: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP)
[09:18:00] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[09:40:57] *** Quits: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro) (Ping timeout)
[10:00:16] *** Joins: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro)
[10:04:27] *** Quits: geomyidae (quassel@DD6F7E3A.21468E9A.30200F38.IP) (Connection reset by peer)
[10:05:40] *** Joins: geomyidae__ (quassel@DD6F7E3A.21468E9A.30200F38.IP)
[10:11:26] *** Joins: bjz_ (bjz@B398BE78.F804C29E.D35A31DF.IP)
[10:11:49] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[10:14:28] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[10:14:34] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[10:21:04] *** Quits: devbug (quassel@23AC5F12.9D950176.3655BBF5.IP) (Connection reset by peer)
[10:45:34] *** Joins: erickt (Adium@moz-BDF423C7.hfc.comcastbusiness.net)
[11:14:52] *** Quits: erickt (Adium@moz-BDF423C7.hfc.comcastbusiness.net) (Quit: Leaving.)
[12:22:25] *** Quits: mawuli (mawuli@moz-36C70B7D.com.gh) (Ping timeout)
[12:38:02] *** Joins: mawuli (mawuli@moz-36C70B7D.com.gh)
[12:58:57] *** Joins: bluz (blaz@7B1927FB.2BD9B503.3F457047.IP)
[13:26:16] *** Joins: Tobba (Tobba@moz-462B7F7F.ias.bredband.telia.com)
[13:35:26] *** Joins: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net)
[13:45:33] *** Quits: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[14:03:52] <Leo`> wow
[14:04:01] <Leo`> very weird bug in Rustc...
[14:04:17] <Leo`> when using a fairly recent Rustc (0.10-pre)
[14:04:31] <Leo`> my code is loaded in memory 8 bytes higher than where it should be
[14:04:50] <Leo`> an objdump shoes correct adresses, but the binary is not loaded correctly
[14:04:57] <Leo`> it works fine with Rustc 0.8...
[14:05:22] <Leo`> it's annoying, when my ASM bootloader jumps to the main function written in Rust
[14:05:36] <Leo`> it encounters the return code of the function that is located just below main
[14:05:44] <Leo`> and thus terminates...
[14:05:49] <Leo`> ping eddyb 
[14:06:21] * eddyb shrugs
[14:06:47] <eddyb> maybe you're making one assumption too many?
[14:06:58] <eddyb> like the order of the functions
[14:07:10] <Leo`> mh ?
[14:07:37] <Leo`> no i'm not relaying on the order of the functions
[14:07:40] <Leo`> I mean
[14:07:48] <Leo`> in the binary, with an objdump, I see: 
[14:07:56] <Leo`> ffffffff8010c000 <main>:
[14:07:58] <Leo`> ffffffff8010c000:       64 48 3b 24 25 70 00    cmp    %fs:0x70,%rsp
[14:08:03] <Leo`> or something like that
[14:08:17] <Leo`> when I run qemu and type something like x/32hb 0xffffffff8010c000
[14:08:20] <Leo`> it shoes zeroes
[14:08:33] <Leo`> and the actual code of main (64 48 3b 24 25 70 00)
[14:08:39] <Leo`> is in fact at 0xffffffff8010c008
[14:08:56] <Leo`> and my virtual memory mappings are ok
[14:09:11] <Leo`> the problem is the same when I dump physical memory
[14:09:16] <eddyb> there's nothing obvious that changed in Rust
[14:09:27] <strcat> LLVM upgraded many times
[14:09:39] <Leo`> it may be a bug in LLVM as well :/
[14:10:01] <Leo`> but I fail to understand how the address can be correct in the binary, and wrong upon loading
[14:10:14] <eddyb> do you have r2?
[14:10:17] <Leo`> r2 ?
[14:10:31] <eddyb> radare2, reverse engineering tools
[14:10:40] <Leo`> nope
[14:10:40] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[14:11:04] <eddyb> though you could also use readelf to get more information
[14:11:41] <strcat> Leo`: evil relocation stuff? dunno
[14:11:54] <Leo`> this is also weird since Rustc isn't actually generating the binary
[14:12:06] <Leo`> I call id with --emit obj (or -c for the older version)
[14:12:25] <Leo`> and link with ld and a linker script
[14:13:03] <Leo`> script that works perfectly fine when using the older Rustc, or when using C instead of Rust, for example ...
[14:13:29] <Leo`> the only case in which I have this 8-bytes shift is when using Rustc pre-0.10
[14:13:46] <Leo`> without changing nothing to the linker script or the way the binary is loaded
[14:15:56] <strcat> Leo`: use --emit-llvm and compile with llvm
[14:16:08] <strcat> Leo`: rustc includes segmented stack preludes
[14:16:10] * strcat shrugs
[14:16:33] <Leo`> mh
[14:16:47] <Leo`> never used LLVM tools directly
[14:16:49] <Leo`> but i'll try
[14:16:51] <Leo`> I*
[14:16:58] *** Quits: tiffany (kawaii@moz-FC0DB29D.dhcp.embarqhsd.net) (Input/output error)
[14:17:22] <strcat> Leo`: well you can use clang to compile .bc/.ll files too
[14:17:31] <strcat> that's what I usually do
[14:17:39] <strcat> rustc --emit-llvm foo.rs -> clang foo.bc
[14:17:40] <eddyb> need a recent clang though
[14:17:43] <strcat> yeah
[14:18:02] <strcat> can also use llc, from rust's build dir
[14:18:21] <strcat> but llc is a bit weird and runs slightly different optimization passes
[14:18:32] <strcat> rustc/clang do the same thing except clang has more flags and doesn't use segmented stacks
[14:24:41] <Leo`> I don't understand much to readelf output
[14:25:57] <eddyb> Leo`: gist it?
[14:26:12] <Leo`> which readelf options are interesting btw ?
[14:26:22] <Leo`> program headers ? section headers ? dunno
[14:26:48] <Leo`> readelf -a is a bit verbose...
[14:27:02] <Leo`> mh
[14:27:18] <Leo`> not so verbose in fact
[14:27:34] <eddyb> Leo`: can you produce binaries for both the old version and current rust?
[14:27:43] <eddyb> then dump all headers and diff
[14:27:45] <Leo`> yep
[14:28:08] <Leo`> but should I readelf the binaries or just the obj file ?
[14:28:20] <Leo`> if the bug is indeed in Rustc, the .o should be enough
[14:30:00] <eddyb> I guess
[14:31:02] <Leo`> http://paste.placeholder.fr/show/513/
[14:32:32] <eddyb> Leo`: can you diff between old and new?
[14:32:45] <Leo`> http://paste.placeholder.fr/show/514/
[14:32:50] <Leo`> http://paste.placeholder.fr/show/514/
[14:32:52] <Leo`> fu
[14:32:56] <Leo`> eddyb: just a minute
[14:32:59] <Leo`> i'm lagging right now xD
[14:33:06] <Leo`> those are binaries btw
[14:33:58] <eddyb> 8 -> 10 section headers
[14:34:15] <eddyb> .note.rustc
[14:34:45] <Leo`> http://paste.placeholder.fr/show/515/
[14:34:47] <Leo`> diff
[14:34:49] <Leo`> for the bianries
[14:35:07] <eddyb> bah, I'll just download them and use kdiff3
[14:35:43] <Leo`> do you want the binaries as well ? xD
[14:35:52] <eddyb> hmm, maybe this works: kdiff3 http://paste.placeholder.fr/raw/514/ http://paste.placeholder.fr/raw/513/
[14:36:10] <eddyb> <3 kio I should use this more often
[14:36:26] <Leo`> :D
[14:37:41] <Leo`> http://paste.placeholder.fr/show/517/ http://paste.placeholder.fr/show/519/
[14:37:50] <Leo`> those are object files
[14:37:52] <Leo`> just in case...
[14:38:13] <eddyb> Leo`: can you remove .note.rustc from the older .o with strip -k?
[14:38:23] <Leo`> think so
[14:38:27] <eddyb> check strip --help, I don't know the options by hand
[14:38:45] <Leo`> -K maybe ?
[14:38:56] <Leo`> -K symbolname
[14:39:11] <eddyb> no, section
[14:39:29] <Leo`> oh
[14:39:38] <Leo`> -R then
[14:39:58] <eddyb> nevermind, I've found it
[14:40:23] <eddyb> strcat was right, looks like relocation shenanigans
[14:40:39] <Leo`> wut ?
[14:40:42] * strcat is always right
[14:40:47] <Leo`> :)
[14:40:51] <strcat> even when I'm wrong
[14:42:18] <eddyb> Leo`: can you get .bc from rustc and optimize/compile with LLVM/clang, as strcat has suggested?
[14:42:34] <eddyb> among other things, there's the crate and mod maps
[14:42:43] *** Joins: pczarn (Mibbit@moz-69A55FA.izacom.pl)
[14:43:04] <Leo`> mh
[14:43:07] <Leo`> yes
[14:43:17] <Leo`> for both versions of Rustc ?
[14:43:42] <eddyb> the new one
[14:44:22] <Leo`> so
[14:44:28] <Leo`> how do I optimize with llvm ?
[14:44:36] <eddyb> opt
[14:44:41] <Leo`> merf
[14:44:47] <Leo`> don't have the llvm package installed
[14:44:52] <Leo`> fresh Debian install
[14:44:57] <Leo`> and on a 3G connection
[14:44:59] <Leo`> damn
[14:45:03] <strcat> Leo`: do you have the rust build dir around?
[14:45:07] <strcat> it puts the llvm tools in a dir
[14:45:09] <Leo`> nop
[14:45:18] <Leo`> installed from nightly builds
[14:46:29] <Leo`> I can upload the .bc file if you want
[14:46:49] <Leo`> otherwise you will have to wait until my phone is done downloading clang and llvm packages xD
[14:50:23] *** Joins: sbalmos (quassel@CA5677B6.576D0C1.ED2EFC1B.IP)
[14:50:35] <Leo`> so
[14:50:41] <Leo`> opt file.bc ?
[14:52:02] <Leo`> and then ?
[14:52:04] <Leo`> llc ?
[14:52:14] <eddyb> you want opt -O3 file.bc
[14:53:17] <Leo`> and then ?
[14:54:13] <eddyb> llc with a flag to output an object file instead of an asm one
[14:56:28] <Leo`> got it
[14:57:32] <Leo`> http://paste.placeholder.fr/show/520/ eddyb 
[14:59:03] <eddyb> Leo`: what's the crate type?
[14:59:46] <Leo`> lib
[15:00:10] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[15:01:04] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.3)
[15:01:34] <Leo`> brb
[15:01:54] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[15:03:43] <eddyb> Leo`: lib is bad because it keeps all the internal cruft
[15:10:31] <Leo`> mhhh
[15:16:25] <Leo`> do you think the bug comes from the lib crate type ? oO
[15:16:45] <eddyb> it will be simpler to debug without it
[15:17:51] <Leo`> without it Rustc complains that main is unsafe
[15:18:07] <eddyb> heh
[15:18:16] <eddyb> I would name it something else
[15:18:17] <eddyb> like kmain
[15:18:36] <Leo`> then it would complain that there is no main
[15:20:02] <eddyb> are you even compiling with #[no_std];?
[15:20:12] <Leo`> yep
[15:20:39] * eddyb shrugs
[15:20:42] <eddyb> rustc can be dumb like that
[15:21:45] *** Quits: bluz (blaz@7B1927FB.2BD9B503.3F457047.IP) (Input/output error)
[15:30:06] *** Quits: lexs (uid12437@moz-5F4AA75A.irccloud.com) (Quit: Connection closed for inactivity)
[15:30:50] <Leo`> eddyb: ?
[15:40:31] <eddyb> Leo`: I don't know how to help, sorry :(
[16:03:11] *** Quits: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro) (Ping timeout)
[16:51:51] *** Quits: mawuli (mawuli@moz-36C70B7D.com.gh) (Ping timeout)
[16:52:54] *** Joins: mawuli (mawuli@moz-36C70B7D.com.gh)
[17:25:00] *** Quits: sunfish (chatzilla@moz-8DE7F965.dsl.dynamic.sonic.net) (Ping timeout)
[18:12:28] *** Quits: mawuli (mawuli@moz-36C70B7D.com.gh) (Ping timeout)
[18:16:18] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[19:29:21] *** Joins: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro)
[19:39:38] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[19:43:54] *** Quits: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca) (Quit: canhtak)
[20:03:45] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[20:05:09] *** Joins: geoffhill (geoffhill@moz-95FF7399.members.linode.com)
[20:11:27] *** Quits: rustilite (rustilite@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[20:11:32] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[20:17:14] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[20:26:51] *** Quits: Leo` (Leo@moz-83832FE2.placeholder.fr) (Ping timeout)
[20:32:17] *** Joins: ChickeNES (ChickeNES@D4AF7317.14AD393B.5B85F5ED.IP)
[20:38:18] *** Joins: Leo` (Leo@moz-83832FE2.placeholder.fr)
[20:43:45] *** Quits: pczarn (Mibbit@moz-69A55FA.izacom.pl) (Quit: http://www.mibbit.com ajax IRC Client)
[20:43:57] *** Quits: ChickeNES (ChickeNES@D4AF7317.14AD393B.5B85F5ED.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[20:46:11] *** Joins: ChickeNES (ChickeNES@D4AF7317.14AD393B.5B85F5ED.IP)
[20:55:05] *** Joins: canhtak (canhtak@moz-8C86DA1D.wl.t.ulaval.ca)
[21:00:56] *** Quits: ChickeNES (ChickeNES@D4AF7317.14AD393B.5B85F5ED.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[21:05:03] *** Joins: ChickeNES (ChickeNES@D4AF7317.14AD393B.5B85F5ED.IP)
[21:34:39] *** Joins: devbug (quassel@23AC5F12.9D950176.3655BBF5.IP)
[21:38:10] *** kimundi is now known as zz_kimundi
[21:53:58] *** zz_kimundi is now known as kimundi
[22:11:36] *** Joins: sunfish (chatzilla@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[22:30:59] *** Quits: eddyb (eddy@moz-41DB10DA.residential.rdsnet.ro) (Ping timeout)
[22:38:40] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[22:47:52] *** Quits: ChickeNES (ChickeNES@D4AF7317.14AD393B.5B85F5ED.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[23:04:00] *** Joins: ChickeNES (ChickeNES@D4AF7317.14AD393B.5B85F5ED.IP)
[23:22:34] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[23:22:42] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[23:23:12] *** Joins: tiffany (kawaii@moz-FC0DB29D.dhcp.embarqhsd.net)
[23:56:35] *** Joins: cmr (moznet@moz-EC676DFE.members.linode.com)
[23:57:13] *** Joins: c74d (c74d@moz-E2EAC718.oc.oc.cox.net)
