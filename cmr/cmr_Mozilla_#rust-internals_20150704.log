[00:06:57] *** Joins: rustbot (havvy@moz-tb54ql.airspeedinternet.net)
[00:21:03] *** Joins: ebfull (ebfull@moz-8vb.66e.34.73.IP)
[00:24:05] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[00:26:54] *** Quits: eibwen (eibwen@moz-vkoevc.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[00:27:44] *** Quits: rkruppe (chatzilla@moz-go38pe.diu2.0rth.0908.2a02.IP) (Ping timeout: 121 seconds)
[00:28:43] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[00:34:20] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[00:34:34] *** Quits: dprien (dprien@moz-15s7c4.udtd.gaqb.04f8.2a01.IP) (Ping timeout: 121 seconds)
[00:36:19] *** Joins: dprien (dprien@moz-15s7c4.udtd.gaqb.04f8.2a01.IP)
[00:40:32] *** Quits: yjv (yjv@moz-ll38tk.pa.comcast.net) (Connection closed)
[00:45:27] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[00:49:15] *** Quits: arielb1 (Ariel@moz-fvk.j5m.66.109.IP) (Connection closed)
[01:01:05] *** Quits: ytain (ytain@moz-upqesl.dsl.teksavvy.com) (Quit: Textual IRC Client: www.textualapp.com)
[01:06:44] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[01:07:11] *** Quits: Kingsquee (kingsley@moz-33q6f3.bchsia.telus.net) (Ping timeout: 121 seconds)
[01:13:07] *** Joins: Kingsquee (kingsley@moz-33q6f3.bchsia.telus.net)
[01:23:46] *** Joins: amyers (amyers@moz-osiar4.md.comcast.net)
[01:24:20] *** Quits: acharles (acharles@moz-ulbdcn.ca.comcast.net) (Ping timeout: 121 seconds)
[01:25:04] *** Joins: acharles (acharles@moz-ulbdcn.ca.comcast.net)
[01:32:22] *** Quits: skeuomorf (skeuomorf@moz-q3f.21q.32.197.IP) (Ping timeout: 121 seconds)
[01:43:50] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[01:56:56] *** Quits: phynx (chatzilla@moz-qfih9v.dsl.scarlet.be) (Ping timeout: 121 seconds)
[02:01:41] *** Quits: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au) (Ping timeout: 121 seconds)
[02:26:06] *** Quits: rustbot (havvy@moz-tb54ql.airspeedinternet.net) (Ping timeout: 121 seconds)
[02:31:16] *** Joins: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP)
[02:32:06] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[02:32:06] *** ChanServ sets mode: +ao erickt erickt
[02:35:13] *** eddyb_ is now known as eddyn
[02:35:17] *** eddyn is now known as eddyb
[02:39:05] *** Joins: waffles (Wafflespean@moz-ood.948.23.1.IP)
[02:39:55] *** Joins: rustbot (havvy@moz-tb54ql.airspeedinternet.net)
[02:40:11] *** Quits: amyers (amyers@moz-osiar4.md.comcast.net) (Ping timeout: 121 seconds)
[02:40:58] <eddyb> arggg
[02:41:15] <eddyb> github commit comments lost :(
[02:41:27] <Elaine> yeah, I hate that.
[02:41:46] <Elaine> I'd like some external feedback on the privacy policy in https://github.com/cmr/this-week-in-rust/pull/66
[02:41:50] <eddyb> I fixed an issue but it wasn't referenced from anywhere other than arielb1's comments on one of my commits
[02:41:56] <Elaine> (see also its commit comments0
[02:42:37] <eddyb> https://github.com/rust-lang/rust/issues/26339 thankfully the search functionality worked in this case
[02:43:03] *** Quits: waffles (Wafflespean@moz-ood.948.23.1.IP) (Quit: C'yall later :))
[02:43:46] *** Joins: waffles (Wafflespean@moz-ood.948.23.1.IP)
[02:45:32] *** Joins: Feyn (aram@moz-5vj.68e.115.42.IP)
[02:53:12] *** Quits: kimundi (kimundi@moz-7qf02q.u2oo.e3ub.57bc.2002.IP) (Ping timeout: 121 seconds)
[02:58:13] *** Joins: kimundi (kimundi@moz-lav8m7.nhp5.i6et.57bc.2002.IP)
[03:16:41] *** Joins: semarie (semarie@moz-fvbb0a.bpv6.bg1u.41d0.2001.IP)
[03:27:02] *** Joins: p1start (p1start@moz-nftjhe.org)
[03:28:11] *** Joins: meteredsection (meteredsect@moz-k1pkr3.wa.comcast.net)
[03:30:27] *** Joins: summerlight (summerlight@moz-lb3.6do.193.175.IP)
[03:31:19] *** Joins: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au)
[03:37:54] *** Quits: meteredsection (meteredsect@moz-k1pkr3.wa.comcast.net) (Ping timeout: 121 seconds)
[03:53:35] *** Joins: phynx (chatzilla@moz-liep7t.dsl.scarlet.be)
[03:56:17] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[04:07:39] *** Joins: rkruppe (chatzilla@moz-hqu6fk.diu2.0rth.0908.2a02.IP)
[04:11:46] *** Quits: rkruppe (chatzilla@moz-hqu6fk.diu2.0rth.0908.2a02.IP) (Ping timeout: 121 seconds)
[04:15:23] *** Joins: O01eg (o01eg@moz-2vt.sv4.165.5.IP)
[04:21:17] *** Quits: woboats (tatterdemal@moz-c1pqg7.ca.charter.com) (Ping timeout: 121 seconds)
[04:27:27] *** Quits: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au) (Ping timeout: 121 seconds)
[04:30:35] *** Quits: jethrogb (jethrob@moz-p2iedd.scintilla.utwente.nl) (Ping timeout: 121 seconds)
[04:48:24] *** Joins: pczarn (piotr@moz-9un7t9.izacom.pl)
[04:53:20] *** Quits: RC9 (RCIX@moz-vnmep7.ph.cox.net) (Ping timeout: 121 seconds)
[04:58:05] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[04:58:33] <Gankro> Elaine: I don't understand why twir has a PP
[05:04:29] <aatch> Gankro, looking at it, it's for the newsletter.
[05:04:45] <Gankro> You're saying words, and they don't make sense
[05:05:40] <aatch> Gankro, as in, the privacy policy is related to the collection of email addresses for the purpose of sending a newsletter.
[05:05:59] <Gankro> Surely there are services for this
[05:06:30] <aatch> Gankro, for what specifically?
[05:06:40] <Gankro> news letter mailing lists?
[05:06:49] <aatch> Gankro, as far as I can tell, the actual mailing is being done by mailchimp.
[05:07:11] <Gankro> Then I shall recurse on my original statement
[05:07:15] <aatch> Gankro, but pretty much any time you ask for potentially-identifying information, privacy laws come into play.
[05:08:39] <Gankro> Why are *we* collecting that info?
[05:11:16] *** Joins: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au)
[05:13:52] <eddyb> Gankro: the way I see it, being a proxy for private information doesn't excuse not having a PP
[05:14:07] <eddyb> even if all you do is redirect to some 3rd party processor
[05:14:19] <eddyb> if your code touches it, you have the responsability of a PP
[05:14:32] <eddyb> even if it's client-side JS
[05:15:17] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[05:15:21] <Gankro> I'm saying we should literally just link to a third part site and say "register with them"
[05:15:41] <eddyb> ah
[05:20:35] *** Joins: bombless (_@moz-j3l.99o.23.14.IP)
[05:21:11] <bombless> https://github.com/rust-lang/rust/issues/26484 what do you folks use now, without --enable-optimize or without --enable-debug?
[05:23:34] <sfackler> I just roll with stock ./configure
[05:25:28] <Gankro> I turn on ccache and turn off optimization on tests, but that's it
[05:25:35] <Gankro> I've never even seen those flags
[05:26:03] <eddyb> RUSTFLAGS="-g" if I need debug info
[05:26:17] <eddyb> -C debug-assertions for logging
[05:26:31] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[05:26:40] <eddyb> the cost of re-configure is really not worth it
[05:26:41] <bombless> Thanks sfackler, Gankro. Thanks for the tip, eddyb
[05:41:02] <Elaine> Gankro: mailchimp requires having a privacy policy.
[05:41:11] <Elaine> Gankro: and the server logs probably count under some obscure EU law too
[05:42:03] <Elaine> You're probably right in that we could offload.
[05:43:21] <Elaine> Do you have a service in mind, though?
[05:45:28] *** Joins: munksgaard (munksgaard@moz-urnkl5.u.parknet.dk)
[05:57:24] *** Quits: pczarn (piotr@moz-9un7t9.izacom.pl) (Ping timeout: 121 seconds)
[06:01:50] <Gankro> Elaine: Sorry, no.
[06:03:24] *** Joins: dcb (textual@moz-j72nfe.ca.comcast.net)
[06:03:32] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Connection closed)
[06:11:25] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[06:15:27] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Ping timeout: 121 seconds)
[06:15:57] *** Quits: dcb (textual@moz-j72nfe.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[06:17:58] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[06:18:32] *** Joins: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net)
[06:18:32] *** ChanServ sets mode: +o pcwalton
[06:18:40] *** Quits: pcwalton (pcwalton@moz-6kjabm.ca.comcast.net) (Client exited)
[06:19:33] *** Joins: eerie (eerie@moz-vagt2f.red.bezeqint.net)
[06:21:02] *** Quits: bdero (bran@moz-g8fbau.lhkq.vq5r.018d.2601.IP) (Ping timeout: 121 seconds)
[06:23:09] *** Quits: munksgaard (munksgaard@moz-urnkl5.u.parknet.dk) (Connection closed)
[06:24:10] *** Quits: eerie (eerie@moz-vagt2f.red.bezeqint.net) (Ping timeout: 121 seconds)
[06:25:27] *** Joins: p1start (p1start@moz-nftjhe.org)
[06:30:09] *** Joins: eerie (eerie@moz-vagt2f.red.bezeqint.net)
[06:35:45] *** Joins: RC9 (RCIX@moz-vnmep7.ph.cox.net)
[06:49:37] *** Joins: eerie_ (eerie@moz-vagt2f.red.bezeqint.net)
[06:49:37] *** Quits: eerie (eerie@moz-vagt2f.red.bezeqint.net) (NickServ (RECOVER command used by eerie_))
[06:49:37] *** eerie_ is now known as eerie
[07:04:45] *** Joins: eerie_ (eerie@moz-qbn2t0.red.bezeqint.net)
[07:04:45] *** Quits: eerie (eerie@moz-vagt2f.red.bezeqint.net) (NickServ (RECOVER command used by eerie_))
[07:04:45] *** eerie_ is now known as eerie
[07:08:46] *** Quits: Skyler (Skyler@moz-7ds39s.sd.cox.net) (Client exited)
[07:10:19] *** Joins: Skyler (Skyler@moz-7ds39s.sd.cox.net)
[07:15:19] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[07:24:43] *** Quits: waffles (Wafflespean@moz-ood.948.23.1.IP) (Ping timeout: 121 seconds)
[07:27:05] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[07:28:47] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[07:30:28] *** Joins: summerlight_ (summerlight@moz-lb3.6do.193.175.IP)
[07:34:01] *** Joins: filsmick (filsmick@moz-8qcdgt.abo.wanadoo.fr)
[07:34:09] *** Quits: summerlight (summerlight@moz-lb3.6do.193.175.IP) (Ping timeout: 121 seconds)
[07:34:55] *** Joins: eerie_ (eerie@moz-qbn2t0.red.bezeqint.net)
[07:34:55] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (NickServ (RECOVER command used by eerie_))
[07:34:55] *** eerie_ is now known as eerie
[07:36:13] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (Connection closed)
[07:40:02] *** Quits: filsmick (filsmick@moz-8qcdgt.abo.wanadoo.fr) (Connection closed)
[07:40:23] *** Joins: filsmick (filsmick@moz-8qcdgt.abo.wanadoo.fr)
[07:44:07] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[07:44:34] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[07:45:09] *** Joins: eerie (eerie@moz-qbn2t0.red.bezeqint.net)
[07:46:44] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Quit: Leaving)
[07:47:08] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[07:47:13] *** Joins: waffles (Wafflespean@moz-q7c.9u1.23.1.IP)
[07:47:19] *** Quits: filsmick (filsmick@moz-8qcdgt.abo.wanadoo.fr) (Connection closed)
[07:47:20] *** Joins: filsmick (filsmick@moz-8qcdgt.abo.wanadoo.fr)
[07:47:45] *** Joins: eljay (eljay@moz-fmte10.skybroadband.com)
[07:50:42] *** Joins: ptalbot (ptalbot@moz-r7j7a6.dyn.as47377.net)
[07:51:15] *** Joins: eibwen (eibwen@moz-1qll7b.dip0.t-ipconnect.de)
[07:57:26] *** Quits: ptalbot (ptalbot@moz-r7j7a6.dyn.as47377.net) (Ping timeout: 121 seconds)
[08:00:01] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (Connection closed)
[08:01:05] *** Joins: munksgaard (munksgaard@moz-urnkl5.u.parknet.dk)
[08:03:02] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[08:07:00] *** Joins: pczarn (piotr@moz-9un7t9.izacom.pl)
[08:09:51] <kimundi> steveklabnik: (seems like you pinged me fro the wrong kind of pattern ;))
[08:10:47] <doener> where does Vec get its impl for PartialEq?!
[08:12:45] <doener> ah, via a macro from core
[08:17:53] <filsmick> where do tests for code which should compile go?
[08:18:08] <doener> run-pass usually
[08:18:24] <filsmick> and if it must compile but panic, run-fail?
[08:18:36] <kimundi> filsmick: run-pass if the question is about compiling and working corretctly, coretest if its just about testing functionality
[08:18:58] <eddyb> kimundi: coretest is for libcore tests
[08:19:04] <kimundi> filsmick: run-fail or regular tests with a #[should_panic] attribute
[08:19:10] <eddyb> other libs have inline tests
[08:19:22] <filsmick> alright, and is there a way to assert the output of the test is equal to something?
[08:19:25] <kimundi> filsmick: ah, I read "core" instead of of "code" in your inital question
[08:19:33] <kimundi> filsmick: Sorry :)
[08:19:38] * filsmick forgives kimundi
[08:19:48] <eddyb> filsmick: what kind of test?
[08:20:15] <kimundi> filsmick: stuff like stdout output is done with asserts, stuff like compiler error messages can use special comments with which you annotate the source
[08:20:15] <filsmick> eddyb: test if a piece of code compiles, and if its output is the expected one
[08:20:18] <eddyb> compile-fail tests must have comments describing the errors they produce
[08:20:26] <eddyb> filsmick: use assert
[08:20:38] <eddyb> the test fails if it panicks
[08:20:47] <filsmick> I want to assert its output *when* panicking
[08:21:06] <filsmick> let me give you a concrete example
[08:21:31] <filsmick> I'm working on custom panic handlers
[08:21:48] <filsmick> which can, among other things, change what is output to stderr when a thread panics
[08:21:54] <kimundi> filsmick: does it have to be stdout output?
[08:22:00] <filsmick> stderr actually
[08:22:07] <kimundi> okay, tricky
[08:22:09] <filsmick> uh, but you're right it *could* be stdout
[08:22:28] <eddyb> there is a way to capture panic output
[08:22:29] <kimundi> Don't we have methods for redirecting the stderr and stdout in a thread?
[08:23:11] <eddyb> see src/librustc_driver/lib.rs's monitor function
[08:23:13] <kimundi> filsmick: I meant the question in a kind of "could you just set a flag or send a message" kind of way.
[08:23:42] <filsmick> kimundi: oh, well setting a flag / sending a message would work, too, for custom handlers
[08:24:17] <filsmick> do you think it is necessary to test whether the default handler stays as it is, specifically?
[08:24:25] <filsmick> or do the hundreds of other tests already account for that?
[08:25:08] <kimundi> That they do for sure :)
[08:25:14] <filsmick> (sorry for the myriad of questions, this is the first time I'm working on libstd code :))
[08:25:18] <kimundi> Though a proper test would still be useful
[08:27:38] <filsmick> kimundi: the error-pattern in run-fail accounts for the formatting of the message
[08:27:45] <filsmick> so that'll do
[08:28:35] *** Quits: munksgaard (munksgaard@moz-urnkl5.u.parknet.dk) (Ping timeout: 121 seconds)
[08:31:31] *** Joins: eerie (eerie@moz-qbn2t0.red.bezeqint.net)
[08:34:43] <filsmick> is there a way to print the concrete type of an Any trait object?
[08:35:24] <eddyb> nope
[08:35:40] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (Ping timeout: 121 seconds)
[08:35:52] <filsmick> ew. I think I figured it out anyway though (&Any makes it *so* easy to pass in the wrong type)
[08:35:55] <kimundi> filsmick: Nope, you'd have to define a new trait that inherits from Any that also hardcodes the typename in its vtable
[08:36:04] <eddyb> you could trick the compiler into recording all TypeId's it ever generated
[08:36:24] *** Joins: RCIX (RCIX@moz-vnmep7.ph.cox.net)
[08:36:29] <eddyb> and create PHF maps
[08:36:38] <kimundi> Now thats an idea. type_id to type name, alignment, size mappings
[08:36:48] <kimundi> could be an intrinsic even
[08:36:59] <eddyb> the latter two exist in any vtable
[08:37:39] <kimundi> sure, but you don't neccessarily have an actual vtable. but yeah, this is a soultion in need of a problem
[08:38:16] <eddyb> reflection? yes, I have to agree :P
[08:38:29] *** Quits: RC9 (RCIX@moz-vnmep7.ph.cox.net) (Ping timeout: 121 seconds)
[08:38:44] <eddyb> I have the problem, but it's way more specific than that
[08:39:23] <filsmick> "This is a solution in need of a problem" - kimundi
[08:39:28] <filsmick> I'm submitting this to QOTW
[08:40:59] <kimundi> Bah, thats not original content, but feel free to do so :)
[08:41:28] <filsmick> ew, I thought I had a good quote for once
[08:41:40] * filsmick gives up and gets back to libstd
[08:55:05] <filsmick> is it possible to re-export a `rt` struct in a stable module (here, `thread`)?
[08:55:37] <filsmick> I tried and it requires the use of #[feature(...)] when trying to use the reexported struct
[08:59:29] *** Quits: RCIX (RCIX@moz-vnmep7.ph.cox.net) (Ping timeout: 121 seconds)
[08:59:39] *** Joins: rkruppe (chatzilla@moz-ap3jnd.diu2.0rth.0908.2a02.IP)
[09:00:08] *** Quits: eibwen (eibwen@moz-1qll7b.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[09:06:49] <filsmick> kimundi: ping
[09:09:03] <kimundi> filsmick: pong
[09:09:10] <filsmick> ^
[09:09:21] <filsmick> I didn't mention your name when asking so I did afterward
[09:09:50] <kimundi> Hm, I'm not completely sure how features are correctly used in the std lib, but its definitly possible to use them
[09:10:00] <kimundi> And have the result be callable from stable
[09:10:27] <filsmick> can you give an example of such a stable reuse?
[09:10:46] <kimundi> Whats the issue exactly?
[09:10:50] *** Quits: pczarn (piotr@moz-9un7t9.izacom.pl) (Connection closed)
[09:10:53] <kimundi> is the struct feature gated?
[09:11:03] <filsmick> the struct lives in rt
[09:11:10] <filsmick> rt::unwind, specifically
[09:11:38] <filsmick> if I just re-export it from thread, user code has to use #[feature(rt)] to make use of the re-exported struct
[09:11:42] <kimundi> is the issue that accessing elements from the rt module is feature gated, or...?
[09:11:52] <filsmick> yes, it's that they are feature gated
[09:12:01] <filsmick> https://gist.github.com/anonymous/0356a5127ca7359e8bf4
[09:12:25] <kimundi> filsmick: Interesting
[09:12:27] <filsmick> here, PanicData has been `use`d not from `rt::unwind`, but from std::thread:
[09:12:47] <kimundi> filsmick: I'd call that a bug of the feature gating lint
[09:13:03] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[09:14:11] *** Joins: eerie (eerie@moz-qbn2t0.red.bezeqint.net)
[09:14:13] <filsmick> I'm not sure it's appropriate to call it a bug, it makes sense to deny `use` of unstable elements in a stable module by default
[09:14:56] <kimundi> filsmick: well then I'm still unsure what thje situation is like
[09:15:13] <kimundi> filsmick: I understood it as "stable struct in a unstable module exported at a stable location"
[09:15:40] <filsmick> I'll try marking the struct as stable
[09:15:50] <filsmick> the desired behavior is to have the struct feature-gated
[09:15:54] <filsmick> but NOT behind rt
[09:16:02] <filsmick> behind a feature named panic_handlers
[09:16:06] <kimundi> yeah
[09:31:39] *** Quits: summerlight_ (summerlight@moz-lb3.6do.193.175.IP) (Ping timeout: 121 seconds)
[09:43:48] *** Quits: filsmick (filsmick@moz-8qcdgt.abo.wanadoo.fr) (Quit: )
[09:44:10] *** Joins: jethrogb (jethrob@moz-p2iedd.scintilla.utwente.nl)
[09:44:29] *** Joins: eerie_ (eerie@moz-qbn2t0.red.bezeqint.net)
[09:44:29] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (NickServ (RECOVER command used by eerie_))
[09:44:29] *** eerie_ is now known as eerie
[09:46:15] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[09:55:08] *** Quits: waffles (Wafflespean@moz-q7c.9u1.23.1.IP) (Ping timeout: 121 seconds)
[09:55:33] *** Joins: waffles (Wafflespean@moz-q7c.9u1.23.1.IP)
[10:13:34] *** Joins: pczarn (piotr@moz-9un7t9.izacom.pl)
[10:26:05] *** Joins: skeuomorf (skeuomorf@moz-q3f.21q.32.197.IP)
[10:30:35] *** Joins: arielb1 (Ariel@moz-s1k.6iv.65.109.IP)
[10:38:43] *** Joins: ptalbot (ptalbot@moz-gsk3jh.dyn.as47377.net)
[10:42:47] *** Joins: acharles_ (acharles@moz-ulbdcn.ca.comcast.net)
[10:42:50] *** Quits: ptalbot (ptalbot@moz-gsk3jh.dyn.as47377.net) (Ping timeout: 121 seconds)
[10:43:34] *** Quits: acharles (acharles@moz-ulbdcn.ca.comcast.net) (Ping timeout: 121 seconds)
[10:43:34] *** acharles_ is now known as acharles
[10:44:07] *** Quits: doener (doener@moz-fnh.n4j.147.5.IP) (Quit: leaving)
[10:45:56] *** Joins: imperio (Mibbit@moz-8otf3a.fbx.proxad.net)
[10:48:02] *** Joins: acharles_ (acharles@moz-ulbdcn.ca.comcast.net)
[10:50:37] *** Quits: acharles (acharles@moz-ulbdcn.ca.comcast.net) (Ping timeout: 121 seconds)
[10:51:43] *** Quits: mitaa (mitaa@moz-6m2jqa.dyn.drei.com) (Ping timeout: 121 seconds)
[10:52:53] *** Quits: acharles_ (acharles@moz-ulbdcn.ca.comcast.net) (Ping timeout: 121 seconds)
[10:57:08] *** Joins: ptalbot (ptalbot@moz-gsk3jh.dyn.as47377.net)
[10:59:53] *** Joins: mitaa (mitaa@moz-7q99b5.dyn.drei.com)
[11:02:36] *** Joins: James (quassel@moz-dkk1ha.range86-163.btcentralplus.com)
[11:03:16] *** Joins: filsmick (filsmick@moz-8qcdgt.abo.wanadoo.fr)
[11:04:18] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[11:14:54] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[11:16:29] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (Connection closed)
[11:19:27] *** Quits: waffles (Wafflespean@moz-q7c.9u1.23.1.IP) (Ping timeout: 121 seconds)
[11:26:19] <imperio> arielb1: I don't get your comment : "Aren't these error-codes borrowck's business?". What did you mean ?
[11:26:32] <arielb1> imperio: I don't think they are useful
[11:26:49] <imperio> and so ?
[11:27:02] <arielb1> the errors should probably be removed
[11:27:24] <imperio> well, that's not something I'm on
[11:27:35] <imperio> the error does exist
[11:27:48] <imperio> it can't be trigger, so it should be explained
[11:27:59] <arielb1> it can be triggered
[11:27:59] <imperio> then, if it's removed, I'll remove it
[11:28:12] <imperio> yes sorry, that's what I wanted to say
[11:28:13] <arielb1> imperio: the code you presented is a borrowck error
[11:28:24] <eddyb> arielb1: o/
[11:28:43] <imperio> arielb1: yep, it is
[11:28:50] <eddyb> arielb1: sorry for the delays, had my exams this week. but then I went crazy with https://github.com/rust-lang/rust/pull/26694
[11:28:54] <imperio> I should try with a Vec to see what happens
[11:29:11] <eddyb> imperio: what errors?
[11:30:06] <imperio> eddyb: gh26742
[11:30:06] <arielb1> eddyb: "can't mutate a string"
[11:30:06] <[o__o]> Add E0128, E0130, E0134, E0135 and E0159 error explanation: https://github.com/rust-lang/rust/pull/26742
[11:30:11] <imperio> E0134 and E0135
[11:30:17] <imperio> that's weird there is a special case str
[11:30:22] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[11:30:22] <arielb1> these are probably detritus from the old days
[11:30:37] <eddyb> oh
[11:30:40] <imperio> with vec, it does say the "correct" error
[11:31:01] <arielb1> imperio: you can have "functional" code that has these errors
[11:31:09] <arielb1> if you create a Box<str> (that is nontrivial)
[11:31:22] <imperio> arielb1: with a Box, it does fail too
[11:31:45] <eddyb> I would say remove the errors
[11:31:46] <arielb1> it isn't that consistent, however
[11:31:55] <arielb1> you can get an &mut str from a Box<str>
[11:31:56] <eddyb> they're really silly
[11:32:16] <eddyb> I would say even impl DerefMut on String
[11:32:19] <arielb1> I think &mut str is just a useless type
[11:32:32] <imperio> arielb1: and about removing an error, I had a conversation with someone recently (don't remember who...) who said that errors code should be kept, even if they're not triggerable in order to keep a conduct line for people who might have this error wih old rust version
[11:32:42] <arielb1> imperio: I know
[11:32:44] <eddyb> there are some algorithms which always use the same amount of memory (or less)
[11:32:50] <arielb1> old error codes should be commented out
[11:32:53] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[11:32:56] <eddyb> so it's not entirely pointless
[11:32:57] <arielb1> eddyb: you can't change the length with &mut str
[11:33:01] <imperio> arielb1: oh my bad, I thought you didn't ^^'
[11:33:08] <eddyb> arielb1: you can shorten the slice
[11:33:19] <imperio> eddyb: you can ? O.o How ?
[11:33:30] <arielb1> imperio: by reborrowing
[11:33:32] <eddyb> like you can take a subslice of any slice
[11:33:51] <imperio> playbot: let s = "hello"; let s = s[0..2]; s
[11:33:52] -playbot- <anon>:9:30: 9:31 error: the trait `core::marker::Sized` is not implemented for the type `str` [E0277]
[11:33:52] -playbot- <anon>:9         let s = "hello"; let s = s[0..2]; s
[11:33:52] -playbot- output truncated; full output at: http://bit.ly/1JEBPA8
[11:34:00] <imperio> playbot: let s = "hello"; let s = &s[0..2]; s
[11:34:01] -playbot- "he"
[11:34:08] <imperio> this ?
[11:34:15] <eddyb> &s[..2] also works. and yes, that
[11:34:24] <imperio> that's shadowing
[11:34:33] <imperio> or maybe I missed something ?
[11:34:47] <eddyb> playbot: let mut s = "hello"; s = &s[0..2]; s
[11:34:48] -playbot- "he"
[11:34:51] <eddyb> you can also do that
[11:35:00] <imperio> oh !
[11:35:04] <imperio> I totally ignored it
[11:35:09] <imperio> so nice
[11:35:11] <eddyb> you can shorten a slice in a loop
[11:35:25] <eddyb> useful for stuff consuming part of a byte slice and returning the number of bytes used
[11:36:01] <imperio> nice
[11:36:14] <imperio> I should add this in my tutorial
[11:37:25] <eddyb> it's not really idiomatic, but it's possible
[11:38:04] <bluss> some of the std::io stuff will shorten the slices for you if you use the Read/Write impls on slices
[11:38:06] <eddyb> you could remove a whole character or grapheme from &mut str, move everything after it to the left, and pad the hole at the end with \0 or something
[11:39:10] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[11:39:18] <bluss> yep Read for &[u8] does this slice shortening
[11:40:56] <kimundi> Its way to hot in germany for doing something productive right now. So naturally I started work on some kind of very limited cpp FFI :P
[11:41:03] <imperio> I really like this chan, I always learn new stuff :)
[11:41:23] <kimundi> (Basically just integrating the build.rs + gcc_rs route into the compiler with a cpp! {} macro)
[11:42:10] <kimundi> eddyb: Lol, thats sound like a hack that's so hackish it might actually work :P
[11:43:11] <eddyb> you can also do CoW operations
[11:43:20] <eddyb> well, not CoW, but CoG
[11:43:22] <eddyb> copy-on-grow
[11:44:58] <eddyb> in the common case of same-size (case conversions, even complicated unicode ones, can still be performed in-place most of the time) you just use the space you have
[11:45:06] <eddyb> if you need to grow, you create a new String
[11:45:17] <eddyb> &mut str -> Cow<str>
[11:45:55] <bluss> sounds good
[11:48:23] *** Quits: ebfull (ebfull@moz-8vb.66e.34.73.IP) (Ping timeout: 121 seconds)
[11:50:20] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[11:55:17] <arielb1> eddyb: we don't even have tests for these errors
[11:57:21] <eddyb> arielb1: btw, in gh26694 I ended up fixing the same-trait-different-type-param supertrait vtable index issue
[11:57:22] <[o__o]> rustc: remove ty::MethodOrigin and replace its uses with equivalent logic.: https://github.com/rust-lang/rust/pull/26694
[11:57:33] <arielb1> nice
[12:06:43] <kimundi> Hm, does every item have an name? What would one recommend if I wanted to add an anonymous item that corresponds to a syntax extension?
[12:07:05] <kimundi> I guess I could just make it expand to an inner attribute, but thats weird as well...
[12:07:48] <eddyb> kimundi: an item for what?
[12:08:02] <eddyb> you could use gensym so it doesn't match anything, but gensym is an ugly hack
[12:08:30] *** Joins: eerie (eerie@moz-qbn2t0.red.bezeqint.net)
[12:09:07] <kimundi> eddyb: See above for summary. baiscally I just want to add a cpp! { #include <foo> vod bar() { ... } }, save that a s a string in the AST, kick off a parallel c++ compiler invocatioen and then link the result with the rust code at the end
[12:09:33] *** Joins: Mr_Alert (mr_alert@moz-23ovql.res.rr.com)
[12:09:35] <kimundi> And then start integrating it more from there
[12:09:54] <eddyb> so what's the item?
[12:10:03] <kimundi> the cpp! macro
[12:10:13] <eddyb> you can have it expand to nothing
[12:11:03] <kimundi> I need to keep _something_ around though
[12:11:13] <kimundi> to remember it in trans
[12:11:20] <eddyb> ah
[12:11:29] <eddyb> kimundi: an extern {} block :P
[12:11:35] <eddyb> ItemForeignMod IIRC
[12:11:41] <kimundi> Right now I added a ItemCpp, and then noticed that all seem to have a name :D
[12:11:55] <eddyb> please use extern "C++" {...}
[12:12:04] <kimundi> eddyb: Heh
[12:12:06] <eddyb> with maybe an attribute
[12:12:11] <eddyb> (I am serious)
[12:12:39] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (Ping timeout: 121 seconds)
[12:12:59] <kimundi> eddyb: So, have the macro expand to an empty extern "C++" with an attached attribute for metadata?
[12:13:39] <kimundi> Hm, htis begs the question what kind of names extern blocks get...
[12:13:50] <eddyb> just don't add a new item, ok :P?
[12:14:06] <eddyb> especially since you might want to put, you know, function definitions in that extern block
[12:14:17] <eddyb> kimundi: invalid fwiw
[12:14:22] <kimundi> eddyb: This is all temporary hack anyway to see if I can make it works. I don't care to refactor it in the end, I just want the fastest way :)
[12:14:36] <eddyb> not adding a new variant is the fastest way
[12:14:46] <kimundi> I'll buy that.
[12:14:59] <eddyb> it took me like a week of refactoring to make it possible to add associated constants to the AST
[12:15:03] <kimundi> heh
[12:15:04] <kimundi> okay
[12:15:16] <kimundi> so, how to add a extern block...
[12:15:27] <eddyb> and then quantheory came along with an implementation so I ended up doing nothing more
[12:15:39] <eddyb> kimundi: ItemForeignMod. look in the parser
[12:16:56] <kimundi> eddyb: Ah, "invalid" is a special ident :P
[12:17:21] <kimundi> eddyb: Your answer was kinda extremely ambiguous there ;D
[12:18:08] *** Quits: James (quassel@moz-dkk1ha.range86-163.btcentralplus.com) (Ping timeout: 121 seconds)
[12:20:19] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[12:27:30] <kimundi> eddyb: Is it a bad hack to add a Cpp(metadata...) Abi variant? :D
[12:27:59] <eddyb> oh dear
[12:28:08] <eddyb> just use attributes
[12:28:10] <eddyb> seriously
[12:28:23] <kimundi> Yeah, this is a bad solution, even temporary
[12:28:34] <kimundi> eddyb: With attributes I'm back at the beginning though
[12:28:41] <eddyb> what do you mean?
[12:28:43] <kimundi> eddyb: I need a place to actually _store_ the data
[12:28:52] <eddyb> attributes can hold strings
[12:28:58] <eddyb> what's the type of your metadata?
[12:29:11] <kimundi> Yeah, but I was more thinking about a future for the kicked-off cc build
[12:29:21] *** Quits: ptalbot (ptalbot@moz-gsk3jh.dyn.as47377.net) (Ping timeout: 121 seconds)
[12:29:29] <kimundi> granted, I can store the source as a string for now and only kick that off later
[12:29:29] <eddyb> oh
[12:29:36] *** Joins: summerlight_ (summerlight@moz-lb3.6do.193.175.IP)
[12:29:38] <eddyb> kimundi: I wouldn't kick off anything before trans
[12:29:57] <eddyb> you might want to instantiate C++ code during monomorphization
[12:30:10] *** Joins: ytain (ytain@moz-upqesl.dsl.teksavvy.com)
[12:30:20] *** Joins: larsberg (sid89@moz-1a60qu.0j4i.jtu0.0101.2620.IP)
[12:31:01] * kimundi adds an attribute
[12:32:06] *** Joins: eerie (eerie@moz-qbn2t0.red.bezeqint.net)
[12:32:15] <eddyb> having more kinds of compiler plugins without intrusive APIs should be great
[12:34:34] <kimundi> eddyb: Hm, how does the ast-syntax for constructing something like #[flags = "-g", source = "..."] look like?
[12:35:29] <kimundi> Well, I guess it would have to be #[cpp_ffi(flags = "...", source = "...")] or so...
[12:35:42] * kimundi doe snot understand the metaitem stuff
[12:36:15] <kimundi> meta_list(meta_name_value, meta_name_value) ?
[12:37:10] <eddyb> probably
[12:38:53] *** Quits: Kingsquee (kingsley@moz-33q6f3.bchsia.telus.net) (Quit: Konversation terminated!)
[12:39:25] <kimundi> Related, but unrelated: Would be nice to get Rusts tokenizer into a pass-through mode, so that you could actually write c++ code in the macro
[12:39:41] <kimundi> right now libsyntax barfs on cpp! { #include <foo> }
[12:39:42] <eddyb> what's missing?
[12:39:45] <eddyb> oh, really?
[12:40:02] <eddyb> but everything in there should be valid tokens
[12:40:04] <kimundi> playbot: macro_rules! cpp { ($($t:tt)*) => () }  cpp! { #include <rust> }
[12:40:05] -playbot- <anon>:1:1: 1:1 error: unexpected token: `<eof>`
[12:40:05] -playbot- <anon>:1 #![allow(dead_code, unused_variables)]
[12:40:05] -playbot- output truncated; full output at: http://bit.ly/1TbM0xQ
[12:40:09] *** Joins: ptalbot (ptalbot@moz-gsk3jh.dyn.as47377.net)
[12:40:27] <eddyb> kimundi: that's not an error
[12:40:35] <eddyb> playbot: macro_rules! cpp { ($($t:tt)*) => (()) }  cpp! { #include <rust> }
[12:40:36] -playbot- ()
[12:40:46] <eddyb> kimundi: *a token error
[12:40:46] <kimundi> do'h!
[12:40:54] <eddyb> it's an expression parse error
[12:41:01] <eddyb> (it would be nice if it had some context, I guess)
[12:41:08] <kimundi> okay, in _that_ case... I can make the UI nicer from the get go :P
[12:41:27] <kimundi> I assume I can just extract the raw string from the macro span?
[12:42:07] <eddyb> yes
[12:42:19] <eddyb> if you don't want to parse the tokens yourself
[12:42:40] <kimundi> god beware
[12:42:49] <kimundi> might be nice longterm
[12:42:55] <eddyb> you mean "god forbid" :P?
[12:43:04] <kimundi> Ah, indeed
[12:43:21] <kimundi> We have the same idiom in germany, I translated it verbatim :P
[12:43:42] <kimundi> no, actually I just translated murk
[12:43:51] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[12:44:07] <kimundi> darn have to go now.
[12:44:14] <kimundi> BUt thanks for the info so far
[12:51:23] <Mr_Alert> Hmm...thread::local::tests::dtors_in_dtors_in_dtors seems to deadlock in XP for some reason...
[12:52:58] *** Quits: yuriks (quassel@moz-hnlou0.yuriks.net) (Ping timeout: 121 seconds)
[12:54:22] *** Joins: yuriks (quassel@moz-hnlou0.yuriks.net)
[12:54:45] <Mr_Alert> Oh. Guess dtors aren't being run on thread local variables when a thread closes...
[12:55:02] <Mr_Alert> Or something.
[13:03:16] *** Joins: waffles (Wafflespean@moz-aeh.673.193.113.IP)
[13:06:49] *** Joins: ptalbot_ (ptalbot@moz-9uj729.dyn.as47377.net)
[13:07:34] *** Quits: ptalbot (ptalbot@moz-gsk3jh.dyn.as47377.net) (Ping timeout: 121 seconds)
[13:10:32] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Connection closed)
[13:17:44] <arielb1> eddyb: need re-r+ gh26770
[13:17:44] <[o__o]> Remove outdated errors for mutating strings: https://github.com/rust-lang/rust/pull/26770
[13:18:00] <arielb1> fixed ~^ERROR/^~ERROR
[13:18:34] <arielb1> eddyb: anyway, gh26694 lgtm
[13:18:34] <[o__o]> rustc: remove ty::MethodOrigin and replace its uses with equivalent logic.: https://github.com/rust-lang/rust/pull/26694
[13:18:40] <eddyb> :D
[13:18:41] *** Quits: O01eg (o01eg@moz-2vt.sv4.165.5.IP) (Client exited)
[13:18:45] <arielb1> should I r+
[13:18:51] <eddyb> feel free to
[13:18:58] <eddyb> everything seems to work locally
[13:19:06] <eddyb> arielb1: thanks a lot for the review!
[13:27:21] <arielb1> eddyb: was there a particular reason you moved the vtable-indexing to select?
[13:27:32] <eddyb> arielb1: to fix that bug
[13:27:43] <arielb1> why can't it be in trans?
[13:27:50] <eddyb> only select knows where the picked trait is
[13:27:58] <eddyb> because, well, it picked the trait
[13:28:11] <eddyb> I guess it could be a "supertrait index" but this way it's more efficient
[13:28:28] <eddyb> because the traits::Vtable value gets cached
[13:28:37] *** Quits: Skyler (Skyler@moz-7ds39s.sd.cox.net) (Client exited)
[13:28:49] <arielb1> I was just thinking we may want to layout vtables in a different way
[13:29:14] <eddyb> oh, sure, and we'll change it then
[13:29:17] <arielb1> using stuff that may need the specific trait type
[13:29:18] <arielb1> I guess we refactor it to use a supertrait index then
[13:29:22] <arielb1> not now
[13:30:50] <arielb1> trans::meth/trans::callee could use some cleanup
[13:30:56] <arielb1> that's another PR I guess
[13:31:21] <eddyb> those two files are a mess, I agree
[13:31:55] <eddyb> arielb1: last time I wanted to clean trans up, I started from there and the patch ended up too big to finish and get merged before it got really rotten
[13:31:59] <arielb1> the "lazy self" confused me for a moment
[13:32:09] <arielb1> *more than a moment
[13:32:28] <arielb1> eddyb: the patch, or trans
[13:32:32] <eddyb> the patch
[13:34:17] <eddyb> I was also not quite sure about the cost of storing Datum instead of ValueRef and also computing function types everywhere
[13:35:11] <eddyb> arielb1: this was my second attempt https://github.com/eddyb/rust/commit/1bcbec0d58c1e2c9d8b03bcbba9d6a7d86f1194c
[13:35:24] <eddyb> and I don't think I even pushed a lot of it
[13:36:18] <arielb1> the changerate has slowed down since these days
[13:36:57] *** Joins: O01eg (o01eg@moz-v6j7mj.otiq.4n8f.2698.2a02.IP)
[13:37:30] *** Quits: pczarn (piotr@moz-9un7t9.izacom.pl) (Ping timeout: 121 seconds)
[13:37:49] <eddyb> if I do anything like that again, I have to start with the scaffolding, and then do dumb refactors on top
[13:38:11] <eddyb> there's mass-scale dumb changes in there mixed with minor clever cleanups and that doesn't scale
[13:41:06] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[13:46:54] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Ping timeout: 121 seconds)
[13:56:51] *** Quits: rkruppe (chatzilla@moz-ap3jnd.diu2.0rth.0908.2a02.IP) (Quit: ChatZilla 0.9.91.1 [Firefox 38.0.5/20150525141253])
[13:59:08] *** Quits: Mr_Alert (mr_alert@moz-23ovql.res.rr.com) (Connection closed)
[14:01:29] *** Joins: chronode (chronode@moz-oddj4e.ga.comcast.net)
[14:01:51] *** Quits: chronode (chronode@moz-oddj4e.ga.comcast.net) (Quit: Textual IRC Client: www.textualapp.com)
[14:01:55] *** Joins: chronode (chronode@moz-oddj4e.ga.comcast.net)
[14:04:27] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[14:08:51] *** Quits: rustbot (havvy@moz-tb54ql.airspeedinternet.net) (Ping timeout: 121 seconds)
[14:21:43] *** Quits: eternaleye (eternaleye@moz-7ps.ehi.245.50.IP) (Ping timeout: 121 seconds)
[14:27:42] *** Quits: chronode (chronode@moz-oddj4e.ga.comcast.net) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[14:29:16] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (Connection closed)
[14:33:17] *** Joins: eerie (eerie@moz-qbn2t0.red.bezeqint.net)
[14:33:20] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (Quit: )
[14:33:33] *** Joins: eerie (eerie@moz-qbn2t0.red.bezeqint.net)
[14:35:54] *** Quits: Feyn (aram@moz-5vj.68e.115.42.IP) (Quit: Leaving)
[14:37:06] *** Joins: dgrunwald (Daniel@moz-vq6vkn.hsi4.kabel-badenwuerttemberg.de)
[14:37:22] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[14:47:22] <eddyb> http://buildbot.rust-lang.org/builders/auto-linux-64-nopt-t/builds/5554/steps/test/logs/stdio
[14:47:24] <eddyb> wtf
[14:48:28] <eddyb>  // pretty-expanded FIXME #23616
[14:48:45] <eddyb> I thought that was there to disable the pretty tests
[14:54:59] *** Joins: bdero (bran@moz-g8fbau.lhkq.vq5r.018d.2601.IP)
[14:58:09] *** Quits: ptalbot_ (ptalbot@moz-9uj729.dyn.as47377.net) (Ping timeout: 121 seconds)
[15:00:05] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[15:00:19] *** Joins: amyers (amyers@moz-f09gkc.east.verizon.net)
[15:07:50] *** Joins: munksgaard (munksgaard@moz-urnkl5.u.parknet.dk)
[15:12:46] *** Quits: waffles (Wafflespean@moz-aeh.673.193.113.IP) (Quit: C'yall later :))
[15:16:05] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[15:16:17] *** Quits: amyers (amyers@moz-f09gkc.east.verizon.net) (Ping timeout: 121 seconds)
[15:26:48] *** Joins: ELD (textual@moz-tbcsac.co.comcast.net)
[15:28:04] *** Joins: ptalbot_ (ptalbot@moz-9uj729.dyn.as47377.net)
[15:28:35] *** Joins: avikpal (avikpal@moz-rg8.mde.194.117.IP)
[15:29:36] *** Joins: summerlight__ (summerlight@moz-lb3.6do.193.175.IP)
[15:30:00] *** Quits: ELD (textual@moz-tbcsac.co.comcast.net) (Quit: Textual IRC Client: www.textualapp.com)
[15:32:47] *** Joins: avikpal_ (avikpal@moz-mbh.ep4.194.117.IP)
[15:33:11] *** Quits: summerlight_ (summerlight@moz-lb3.6do.193.175.IP) (Ping timeout: 121 seconds)
[15:33:38] *** Quits: avikpal (avikpal@moz-rg8.mde.194.117.IP) (Ping timeout: 121 seconds)
[15:38:13] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Connection closed)
[15:42:16] *** Quits: avikpal_ (avikpal@moz-mbh.ep4.194.117.IP) (Connection closed)
[15:43:17] *** Joins: avikpal (avikpal@moz-tpv.36b.194.117.IP)
[15:45:07] *** Joins: eternaleye (eternaleye@moz-7ps.ehi.245.50.IP)
[15:46:35] *** Quits: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP) (Ping timeout: 121 seconds)
[15:50:54] *** Joins: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP)
[15:53:41] *** Quits: eddyb (eddyb@moz-h7s.q07.26.188.IP) (Quit: Konversation terminated!)
[15:53:48] *** Joins: eddyb (eddyb@moz-h7s.q07.26.188.IP)
[16:02:20] *** Joins: Quxxy_ (chatzilla@moz-0nv.jkp.167.59.IP)
[16:04:21] *** Quits: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP) (Ping timeout: 121 seconds)
[16:06:19] *** Joins: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP)
[16:06:52] *** Quits: Quxxy_ (chatzilla@moz-0nv.jkp.167.59.IP) (Ping timeout: 121 seconds)
[16:08:15] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[16:17:51] <steveklabnik> kimundi: oh? heh :(
[16:19:39] *** Quits: filsmick (filsmick@moz-8qcdgt.abo.wanadoo.fr) (Connection closed)
[16:20:20] *** Joins: filsmick (filsmick@moz-8qcdgt.abo.wanadoo.fr)
[16:22:40] *** Quits: filsmick (filsmick@moz-8qcdgt.abo.wanadoo.fr) (Connection closed)
[16:22:44] *** Joins: filsmick (filsmick@moz-8qcdgt.abo.wanadoo.fr)
[16:22:46] *** Quits: filsmick (filsmick@moz-8qcdgt.abo.wanadoo.fr) (Connection closed)
[16:28:56] <imperio> arielb1: erf, you *really* did comment them out ?
[16:29:08] <arielb1> imperio: yes
[16:29:12] <imperio> my error explanation remains valid but I don't know what to do...
[16:29:25] <arielb1> remains valid?
[16:29:26] <imperio> I add it and then I comment it ?
[16:29:31] <arielb1> don't add it
[16:29:52] <imperio> well, the targetted error will always remain the same
[16:30:14] <arielb1> imperio: ?
[16:30:25] <arielb1> these error messages now won't occur
[16:30:32] <imperio> yep
[16:30:41] <imperio> I should comment out 136 then
[16:30:41] <arielb1> no point in documenting them
[16:31:05] <arielb1> 136?
[16:31:11] <imperio> multiple main functions
[16:31:22] <arielb1> it does occur
[16:31:23] <imperio> I never succeeded in raising it
[16:31:28] <imperio> how ? O.o
[16:31:37] <arielb1> there's a span_err
[16:32:11] <imperio> well, yes...
[16:32:20] <imperio> I guess I'll just write a little message for it
[16:32:47] <arielb1> maybe turn it into a span_bug
[16:33:04] <imperio> as you prefer ?
[16:34:03] <imperio> I do write an error explanation for E0136 or not ?
[16:34:32] <arielb1> imperio: don't write
[16:34:40] <arielb1> span_bug and comment it out
[16:35:08] <arielb1> actually, maybe ask someone
[16:35:21] <arielb1> acrichto: cc
[16:36:06] *** Quits: bombless (_@moz-j3l.99o.23.14.IP) (Ping timeout: 121 seconds)
[16:36:21] <arielb1> nagisa: cc
[16:36:23] <imperio> ok, I removed the E0134 and E0135 explanations
[16:36:40] <arielb1> if you already have an explanation for E0136
[16:36:43] <arielb1> you can leave it in
[16:37:12] <arielb1> we will comment it out if we remove the error
[16:37:22] <imperio> I change to span_bug ?
[16:37:26] *** Joins: waffles (Wafflespean@moz-aeh.673.193.113.IP)
[16:37:40] <imperio> and i didn't pushed the E0136 error explanation
[16:37:41] <arielb1> imperio: I would prefer someone who understands resolve to do so
[16:37:43] <arielb1> (cc nagisa)
[16:37:54] <imperio> ok, then I'll wait
[16:38:20] <imperio> I r? you on my PR
[16:38:27] <arielb1> also, E0128 isn't only for self-deps
[16:38:38] <arielb1> actually, until I fixed it it wasn't for self-deps
[16:39:10] <imperio> I used the test to see how it worked
[16:39:19] <imperio> so, what's this error about ?
[16:39:31] <arielb1> its for all forward declarations
[16:39:46] <arielb1> Foo<T=U, U=()> too
[16:40:05] <arielb1> defaults can only use parameters that occur before them
[16:40:25] <arielb1> i.e. <T=(), U=T>
[16:40:35] <arielb1> as they are evaluated in-order
[16:41:06] <arielb1> imperio: if you don't have a cycle, you can fix it by reordering the parameters
[16:41:15] <arielb1> otherwise, what were you trying to do
[16:41:16] <arielb1> ?
[16:43:26] <arielb1> I also don't think E0159 is needed
[16:43:33] <arielb1> it's a duplicate of E0071
[16:43:41] <arielb1> you can lookup_item_type on a trait-def
[16:44:16] <arielb1> actually you can't
[16:44:30] <arielb1> so its fine
[16:45:43] <nagisa> somebody called me?
[16:45:52] <nagisa> s/called/summoned?
[16:46:01] * nagisa gets to reading the backlog
[16:46:56] * nagisa checks logs for more backlog
[16:49:02] <nagisa> Sorry guys, I still donâ€™t get the context of what youâ€™re talking about other than that its about error codes (0136/5/4), but nothing more ðŸ˜Š
[16:49:09] <arielb1> nagisa: E0136
[16:49:14] <arielb1> is it possible to reach it
[16:49:18] <arielb1> multiple main functions
[16:49:37] <arielb1> on another note, is it intentional to be able to create structs from a type-alias?
[16:50:00] <arielb1> rusti: #[derive(debug)] struct S { v: u32 }; type T=S; T { v: 42 }
[16:50:00] -playbot- <anon>:9:18: 9:23 error: `#[derive]` for custom traits is not stable enough for use and is subject to change
[16:50:01] -playbot- <anon>:9         #[derive(debug)] struct S { v: u32 }; type T=S; T { v: 42 }
[16:50:01] -playbot- output truncated; full output at: http://bit.ly/1LKyfnA
[16:50:05] <arielb1> rusti: #[derive(Debug)] struct S { v: u32 }; type T=S; T { v: 42 }
[16:50:06] -playbot- S { v: 42 }
[16:50:32] <arielb1> I guess it's now an undocumented feature
[16:50:43] <nagisa> I remember being able to reach it before, so unless something has changed, it is still possible
[16:50:57] <nagisa> let me see if I can produce some code to do that
[16:51:14] *** Joins: brson (brson@moz-dv7ilb.tmodns.net)
[16:51:14] *** ChanServ sets mode: +o brson
[16:51:58] <nagisa> rusti: #[derive(Debug)] struct S; type T=S; T
[16:51:59] -playbot- <anon>:9:46: 9:47 error: unresolved name `T`
[16:51:59] -playbot- <anon>:9         #[derive(Debug)] struct S; type T=S; T
[16:51:59] -playbot- output truncated; full output at: http://bit.ly/1dEAzhT
[16:52:16] <nagisa> not sure, honestly ðŸ˜ƒ
[16:52:16] <arielb1> nagisa: that's not a dictionary-struct
[16:52:24] <nagisa> yeah, just wanted to try that out
[16:52:39] <arielb1> that's a regular "function call"
[16:52:47] <arielb1> it is handled like a function call
[16:52:50] <eddyb> or value
[16:52:56] <eddyb> like a constant
[16:53:07] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[16:53:34] <eddyb> never seen the T { v: 42 } thing before, that looks bad
[16:53:49] *** Quits: avikpal (avikpal@moz-tpv.36b.194.117.IP) (Connection closed)
[16:53:58] <arielb1> eddyb: even works with type parameters
[16:54:01] <imperio> arielb1: I'll keep E0159 and update E0128. Thanks for your explanation
[16:54:13] *** Quits: brson (brson@moz-dv7ilb.tmodns.net) (Connection closed)
[16:55:21] <arielb1> rusti: #[derive(Debug)] struct S<T> { v: T }; type Alias<T>=S<Vec<T>>; Alias { v: vec![0].iter().collect() }
[16:55:23] -playbot- S { v: [0] }
[16:56:15] *** Joins: Quxxy_ (chatzilla@moz-0nv.jkp.167.59.IP)
[16:56:18] <arielb1> I think we can call this "just a bug" through
[16:56:34] <arielb1> the problem is that it may require global changes
[16:56:56] <arielb1> if somebody exposed a type-alias but not the actual struct
[16:58:02] *** Quits: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP) (Ping timeout: 121 seconds)
[16:58:04] *** Quxxy_ is now known as Quxxy
[16:58:19] <eddyb> arielb1: open an issue and make sure @brson sees it and does a crater run
[16:58:28] <eddyb> we could at least warn about it
[17:00:58] <imperio> arielb1: I updated E0128 error explanation, does it seem good to you ?
[17:03:24] *** Joins: avikpal (avikpal@moz-tpv.36b.194.117.IP)
[17:03:26] <arielb1> imperio: why the asterisk?
[17:03:32] <arielb1> Type parameter defaults can only use parameters that occur before them.*
[17:04:00] <imperio> oh snap !
[17:04:27] <imperio> I also left "````"
[17:05:02] <arielb1> also, wording on "name-clash"
[17:05:11] <imperio> wording ?
[17:05:26] <arielb1> it suggests that reordering caused the name-clash
[17:05:44] <arielb1> also, I prefer "you may be able to fix" to "you can fix"
[17:05:53] <arielb1> if you have a cycle that can't be fixed by reordering
[17:05:56] <imperio> I update then
[17:06:01] <arielb1> and reordering is a breaking change
[17:07:13] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (Connection closed)
[17:07:28] *** Quits: avikpal (avikpal@moz-tpv.36b.194.117.IP) (Ping timeout: 121 seconds)
[17:07:33] *** Joins: avikpal_ (avikpal@moz-tpv.36b.194.117.IP)
[17:08:19] <imperio> ok ! I think we're good
[17:08:29] *** Quits: ptalbot_ (ptalbot@moz-9uj729.dyn.as47377.net) (Ping timeout: 121 seconds)
[17:09:56] <arielb1> imperio: r+-ed
[17:10:12] <arielb1> eddyb: gh26773
[17:10:12] <[o__o]> Structs can be created via type-aliases: https://github.com/rust-lang/rust/issues/26773
[17:10:15] <imperio> arielb1: thanks ! (I wrote it on the wrong chan ><)
[17:12:48] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[17:21:28] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[17:22:33] *** Parts: mib_op4ca7 (Mibbit@moz-g6k.oht.161.46.IP) ()
[17:22:55] *** Joins: eerie (eerie@moz-qbn2t0.red.bezeqint.net)
[17:23:27] <bluss> arielb1: a feature report? (opposite of bug report? :)
[17:39:04] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (Connection closed)
[17:43:46] *** Joins: dcb (textual@moz-j72nfe.ca.comcast.net)
[17:59:22] <nagisa> re E0136, ok, I doubt it is possible to trigger that anymore. It might have been possible before glob shadowing got fixed, but I canâ€™t think of a way to trigger that either
[17:59:41] <nagisa> cc imperio arielb1 â†‘
[18:04:25] *** Joins: Peach (Peach@moz-05nvva.fios.verizon.net)
[18:05:10] <Peach> I'm trying to build a C source code exporter for Rust - It'll handle a subset of the Rust language,
[18:05:13] <Peach> For example, I want to do-      let x = Default::default(); f32::sqrt(x)    converts to C:    int x = 0; sqrt(x);
[18:05:34] <Peach> Any idea on how to make a "resolve type of an expression"?
[18:06:19] <steveklabnik> you'd have to re-implment our inference
[18:07:44] <eddyb> not really
[18:07:49] <barosl> Isn't it able to utilize librustc_* or libsyntax for that purpose? I thought Racer does so
[18:07:55] <eddyb> you'd want to use typed code
[18:09:01] <eddyb> Peach: you could replace https://github.com/rust-lang/rust/blob/master/src/librustc_driver/pretty.rs#L316-L317 with try!(pp::word(&mut s.s, ":"));
[18:09:12] <eddyb> I did this once but it didn't get merged
[18:09:52] <eddyb> Peach: then run rustc --pretty=typed and it would produce source code with types in it
[18:10:09] <eddyb> Peach: also, f32 is float not int
[18:10:37] <Peach> oops, what's a fixed 32bit int type then?
[18:10:45] <eddyb> i32
[18:10:48] <Peach> AH
[18:10:51] <nagisa> Oh, type ascription, wherefore art thou, type ascription!?
[18:12:12] <eddyb> in an unrebased PR of mine
[18:12:47] <eddyb> Peach: even then... it might be easier to just drive the compiler...
[18:13:04] <eddyb> I'm not sure though
[18:13:31] <eddyb> Peach: not to disappoint you, but there's a huge amount of code required to generate LLVM IR from Rust code
[18:13:44] <eddyb> and generating C code will need a lot of it
[18:15:01] <eddyb> C barely has a type system, you'd still need to handle monomorphization
[18:18:41] *** Joins: eerie (eerie@moz-qbn2t0.red.bezeqint.net)
[18:22:50] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (Ping timeout: 121 seconds)
[18:22:58] <Peach> What language was the Rust compiler first written in?
[18:23:10] <whipsch> ocaml
[18:23:15] <whipsch> well, one of them
[18:23:19] <whipsch> not sure if it was the first
[18:23:40] *** Quits: bdero (bran@moz-g8fbau.lhkq.vq5r.018d.2601.IP) (Quit: Leaving.)
[18:24:00] *** Joins: bdero (bran@moz-g8fbau.lhkq.vq5r.018d.2601.IP)
[18:24:24] <steveklabnik> yeah, it was ocaml
[18:26:41] <Peach> wow
[18:27:03] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[18:27:34] <Peach> out of curiosity - does any of the rust community devs know ocaml, and was rust itself influenced by ocaml?
[18:27:43] <steveklabnik> yes and yes
[18:27:47] <Peach> I can't find any "History of Rust" blog posts :P
[18:27:58] <steveklabnik> i did a talk on it, but the conferences' video failed :(
[18:28:38] <Peach> :'(
[18:28:43] <eddyb> steveklabnik: it's a conspiracy
[18:28:53] <eddyb> the world must not know the nitty gritty past of Rust
[18:29:10] <eddyb> @T was a lie
[18:29:13] *** Quits: summerlight__ (summerlight@moz-lb3.6do.193.175.IP) (Ping timeout: 121 seconds)
[18:29:20] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[18:34:29] <Ericson2314> @mut T was a biger lie
[18:35:13] *** Quits: Quxxy (chatzilla@moz-0nv.jkp.167.59.IP) (Ping timeout: 121 seconds)
[18:39:48] *** Joins: Jesin (Jesin@moz-fa9lmm.fios.verizon.net)
[18:42:48] <imperio> what was @ for ?
[18:42:57] <imperio> I know ~str but @T
[18:43:19] <steveklabnik> @ was for a type called Gc<T> that doesn't exist anymore
[18:44:18] <imperio> Gc ?
[18:44:24] <imperio> what was it for ? ^^
[18:44:32] <Ericson2314> :D
[18:45:25] <kimundi> imperio: Think wanna-be tracing garbage collected pointer that was actually implemented as a kind of build in reference counted one
[18:46:15] <imperio> Well, I thought it was for garbage collection handling, I wasn't so far ^^
[18:46:59] <Ericson2314> was @mut just a blatant race condition?
[18:48:20] <huon> @mut wasn't usable concurrently
[18:49:05] <kimundi> nah, at the beginning it complicated and restricted the borrow checker extremely to catch all bad kinds of aliasing, later it got turned into something that uses a build-in kind of RefCell
[18:50:31] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[18:54:31] *** Joins: pczarn (piotr@moz-9un7t9.izacom.pl)
[18:55:40] *** Quits: Jesin (Jesin@moz-fa9lmm.fios.verizon.net) (Quit: Leaving)
[18:57:04] <kmc> @mut T is most similar to today's Rc<RefCell<T>>
[18:57:14] <kmc> but with implicit runtime costs and borrow failure goodness!
[18:57:57] <kmc> rustboot did actually have a tracing GC, but rustc never did
[18:59:06] <huon> the one redeeming feature of @mut is it tracked where borrows happened, meaning a borrow failure would point to the place where the first borrow occurred
[18:59:18] <kmc> Peach: the original Rust compiler (rustboot) was written in ocaml
[18:59:47] <kmc> among Rust devs and the Rust community you will find a lot of people with functional programming experience
[19:00:59] <kmc> Rust is in many respects a member of the ML family of languages
[19:05:55] <Ericson2314> ah interesting
[19:06:01] <Ericson2314> thanks for the history
[19:08:55] *** Quits: dcb (textual@moz-j72nfe.ca.comcast.net) (Quit: Textual IRC Client: www.textualapp.com)
[19:10:15] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[19:10:15] *** ChanServ sets mode: +ao erickt erickt
[19:12:31] *** Quits: pczarn (piotr@moz-9un7t9.izacom.pl) (Ping timeout: 121 seconds)
[19:19:41] *** Joins: eerie (eerie@moz-qbn2t0.red.bezeqint.net)
[19:21:09] *** Quits: Amaranth (travis@moz-1raqsl.cpe.cableone.net) (Ping timeout: 121 seconds)
[19:24:03] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (Ping timeout: 121 seconds)
[19:24:40] *** Quits: ytain (ytain@moz-upqesl.dsl.teksavvy.com) (Quit: Textual IRC Client: www.textualapp.com)
[19:28:01] <kmc> 11:51 <@huon> @mut wasn't usable concurrently
[19:28:14] <kmc> Servo used to break this rule in spectacular fashion
[19:28:23] <kmc> not coincidentally, Servo used to segfault all the time
[19:29:12] <Elaine> Yeah, Servo's use of @mut was horrifying.
[19:29:17] <Elaine> Incredibly, it Mostly Just Worked.
[19:29:56] <kmc> kinda...
[19:30:07] <kmc> we basically assumed that a given @mut would only be active on one thread *at a time*
[19:30:26] <benh> wow
[19:31:31] <kmc> comparable to using `transmute` to send an Rc<T> and just hoping the refcount is 1
[19:31:34] <kmc> lol
[19:31:43] <kmc> except it was worse because the Rust runtime had thread-local cleanup for @-boxes
[19:31:58] <kmc> and everything would go down in flames if the boxes weren't sent back to the original thread that created them
[19:32:01] <kmc> lol
[19:32:37] <benh> this is rather shocking to me
[19:32:45] <kmc> DOM memory management is hard
[19:33:10] <kmc> any JS object can hold references to any DOM object, and DOM objects refer to each other in a tangled mess
[19:33:16] <benh> I had the impression the point of rust was that you'd have a decent type system to make concurrency safer than in C++, and to make the gc thread-local to lessen its impact
[19:33:19] <benh> and then y'all go and...
[19:33:44] <kmc> the solution in Servo today is to put the JS GC in charge of native-code DOM objects
[19:33:50] <kmc> which is cleaner than what any existing engine does
[19:34:15] <kmc> benh: that was the idea, yes, but Rust and Servo were under heavy development at this time (2013)
[19:34:40] <kmc> Rust was not mature enough yet to support the JS GC integration
[19:34:50] <kmc> I actually implemented lint plugins for rustc as part of that work
[19:35:30] <kmc> within a few years Rust may have first class support for integrating with external GCs
[19:35:33] <kmc> that would be awesome
[19:36:12] <eddyb> Oilpan in Chromium/Blink attempts to interface with the v8 GC, doesn't it?
[19:36:22] <kmc> yeah
[19:36:30] <eddyb> but it's not like C++ allows it to get very far
[19:36:38] *** Quits: untitaker (untitaker@moz-ad5vjl.highway.telekom.at) (Ping timeout: 121 seconds)
[19:36:40] <kmc> yeah, it requires a ton of hand-written annotations
[19:36:44] <kmc> much like Gecko's cycle collector
[19:36:54] <kmc> Gecko also has clang lint plugins :)
[19:37:12] <eddyb> I was going to ask, did they consider pinning a single compiler and writing plugins for it :P?
[19:37:26] *** Joins: RCIX (RCIX@moz-vnmep7.ph.cox.net)
[19:37:52] <kmc> all you need is a single compiler version that supports MSVC WinXP, OS X, Solaris, Linux, Android, and has lint plugins
[19:37:55] <kmc> :P
[19:37:55] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[19:38:17] <kmc> gecko is old enough that its C++ headers contain a large number of workarounds for buggy C++ compilers
[19:38:26] <eddyb> well... clang gets pretty close to that, except I don't know anything about Solaris
[19:38:52] <kmc> clang doesn't support MSVC debug info does it?
[19:38:53] <kmc> :(
[19:38:54] <eddyb> and XP support might be deprecated already
[19:39:10] <kmc> anyway I generally approve of having at least one platform where you run the lints, if you can't get them all
[19:39:12] <eddyb> kmc: you can always do what WindowsBunny does and convert it
[19:39:16] <kmc> huh
[19:39:20] <kmc> how hard is that?
[19:40:11] <eddyb> kmc: https://github.com/rainers/cv2pdb
[19:40:39] *** Joins: untitaker (untitaker@moz-atabag.highway.telekom.at)
[19:43:57] <Ericson2314> eddyb: Have time to talk about drop_value(self) in real time?
[19:44:09] <eddyb> Ericson2314: more or less, yeah
[19:44:29] *** Joins: skeuomor1 (skeuomorf@moz-j60.sa8.32.197.IP)
[19:44:43] <Ericson2314> right now, if you have struct Foo(Box<Bar>, Box<Baz>);
[19:44:54] *** Joins: rkruppe (chatzilla@moz-ghggti.diu2.0rth.0908.2a02.IP)
[19:44:58] <eddyb> I personally see no way for by-value self drop to work without it being hacky and unexpected
[19:45:00] <Ericson2314> and you do a partial move out, when does the box get freed?
[19:45:14] <Ericson2314> Foo does not impl Drop
[19:45:17] <eddyb> Ericson2314: partial move out of which?
[19:45:42] <eddyb> you have foo.0, foo.1, *foo.0, *foo.1 etc.
[19:45:53] <Ericson2314> oh just pulling the box out of the foo
[19:46:00] <eddyb> one of them?
[19:46:04] <Ericson2314> either
[19:46:06] <eddyb> and leaving the other one in?
[19:46:08] <Ericson2314> yes
[19:46:32] <eddyb> the other one will continue to live for the whole lifetime of foo
[19:46:47] <eddyb> be it an lvalue or rvalue scope
[19:47:16] *** Quits: skeuomorf (skeuomorf@moz-q3f.21q.32.197.IP) (Ping timeout: 121 seconds)
[19:47:21] <Ericson2314> ok
[19:48:57] <Ericson2314> well it would seem simpler to me if the box was dropped when the other was moved out
[19:49:07] <Ericson2314> as foo: Foo is consumed
[19:49:23] <eddyb> Ericson2314: you can't change that now
[19:49:25] <Ericson2314> but i don't think having that "zombie" state where foo is borrowed but unusable is a problem
[19:49:34] <eddyb> it would be a backwards incompatible change
[19:49:42] <Ericson2314> yeah
[19:49:43] <eddyb> no, foo is not consumed
[19:49:44] <Dabo> Ericson2314, afaik it isn't entirely consumed, as you can totally then move out of the other one, right?
[19:49:49] <eddyb> Dabo: correct
[19:50:02] <eddyb> not only that, but it might be possible to move back in the first box, in the future
[19:50:15] <eddyb> and even pass foo by value afterwards
[19:50:39] <Dabo> playbot, struct Foo(Box<u8>, Box<u8>); let foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; let b2 = foo.1;
[19:50:40] -playbot- ()
[19:50:41] <Ericson2314> does this requires mutation capability?
[19:50:49] <Dabo> playbot, struct Foo(Box<u8>, Box<u8>); let foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; println!(foo);
[19:50:50] -playbot- <anon>:9:105: 9:108 error: expected a literal
[19:50:50] -playbot- <anon>:9         struct Foo(Box<u8>, Box<u8>); let foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; println!(foo);
[19:50:50] -playbot- output truncated; full output at: http://bit.ly/1JNvAqU
[19:51:18] <Dabo> playbot, struct Foo(Box<u8>, Box<u8>); fn do_thing(foo: Foo) {} let foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; do_thing(foo) // not allowed, but using foo.1 still is
[19:51:18] -playbot- output truncated; full output at: http://bit.ly/1ChIJZG
[19:51:21] <Ericson2314> wait of course it does
[19:51:30] <Dabo> Ericson2314, it requires ownership
[19:51:39] <eddyb> Ericson2314: possibly, yeah
[19:51:50] <Ericson2314> ok fair points on the uses of that
[19:51:52] <Dabo> it does require that there aren't any references to the struct, but it doesn't require that you declare it as `mut`
[19:51:56] <eddyb> playbot: struct Foo(Box<u8>, Box<u8>); fn do_thing(foo: Foo) {} let foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; foo.0 = b1;
[19:51:57] -playbot- <anon>:9:121: 9:131 error: cannot assign to immutable anonymous field `foo.0`
[19:51:57] -playbot- <anon>:9         struct Foo(Box<u8>, Box<u8>); fn do_thing(foo: Foo) {} let foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; foo.0 = b1;
[19:51:57] -playbot- output truncated; full output at: http://bit.ly/1JNvP5t
[19:52:02] <eddyb> playbot: struct Foo(Box<u8>, Box<u8>); fn do_thing(foo: Foo) {} let mut foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; foo.0 = b1;
[19:52:03] -playbot- ()
[19:52:05] <eddyb> tadaa
[19:52:19] <eddyb> you can already move back in, I guess it's just that it doesn't mark "foo" as reusable
[19:52:22] <eddyb> playbot: struct Foo(Box<u8>, Box<u8>); fn do_thing(foo: Foo) {} let mut foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; foo.0 = b1; foo;
[19:52:23] -playbot- <anon>:9:137: 9:141 warning: path statement with no effect, #[warn(path_statements)] on by default
[19:52:24] -playbot- <anon>:9         struct Foo(Box<u8>, Box<u8>); fn do_thing(foo: Foo) {} let mut foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; foo.0 = b1; foo;
[19:52:24] -playbot- output truncated; full output at: http://bit.ly/1ChINbQ
[19:52:30] <eddyb> playbot: struct Foo(Box<u8>, Box<u8>); fn do_thing(foo: Foo) {} let mut foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; foo.0 = b1; drop(foo);
[19:52:31] -playbot- ()
[19:52:34] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Connection closed)
[19:52:38] <Dabo> playbot, struct Foo(Box<u8>, Box<u8>); fn do_thing(foo: Foo) {} let mut foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; foo.0 = b1; do_thing(foo)
[19:52:39] -playbot- ()
[19:52:40] <eddyb> wait, it... does
[19:52:57] <Dabo> eddyb, I think it's only a complete move-out that you can't move back into
[19:52:59] <Dabo> like
[19:53:06] <eddyb> Dabo: this is amazing
[19:53:10] <eddyb> how did I not know about this
[19:53:31] <eddyb> Ericson2314: does this change things :P?
[19:53:31] <Dabo> or wait, is this new?
[19:53:44] <eddyb> Dabo: I haven't heard any news, beats me
[19:53:56] <Ericson2314> wait, what is going on here?
[19:54:04] <Ericson2314> that you two just discovered?
[19:54:10] <Dabo> eddyb, ah, it might be because we are using the same values .-.
[19:54:16] <Dabo> playbot, playbot, struct Foo(Box<u8>, Box<u8>); fn do_thing(foo: Foo) {} let mut foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; foo.0 = Box::new(3); do_thing(foo)
[19:54:16] -playbot- output truncated; full output at: http://bit.ly/1JNwcwJ
[19:54:20] <eddyb> wat
[19:54:22] <Dabo> oh
[19:54:26] <Dabo> nevermind
[19:54:38] <eddyb> playbot, struct Foo(Box<u8>, Box<u8>); fn do_thing(foo: Foo) {} let mut foo = Foo(Box::new(1), Box::new(2)); let b1 = foo.0; foo.0 = Box::new(3); do_thing(foo)
[19:54:39] -playbot- ()
[19:54:51] <Dabo> eddyb, nevermind, that works too
[19:54:53] <Dabo> this is strange
[19:54:57] <eddyb> this is feature
[19:55:05] <eddyb> Dr. Strange Feature
[19:55:07] <Dabo> Ericson2314, I just never knew you could re-instantiate it like that
[19:55:43] *** Joins: pczarn (piotr@moz-9un7t9.izacom.pl)
[19:55:53] <eddyb> playbot, struct Foo(Box<u8>, Box<u8>); fn do_thing(foo: Foo) {} let mut foo = Foo(Box::new(1), Box::new(2)); let b0 = foo.0; let b1 = foo.1; foo.0 = b1; foo.1 = b0; do_thing(foo)
[19:55:54] -playbot- ()
[19:55:56] <eddyb> amazing
[19:56:05] <Dabo> Ericson2314, this is like new: https://play.rust-lang.org/?gist=e375f0184e306f8dbaf7&version=stable
[19:56:29] <eddyb> Dabo: I guess the part that isn't implemented is moving out and back into &mut T
[19:56:39] <eddyb> which would allow us to write mem::swap in safe code
[19:56:58] <Ericson2314> well that is quite a change to sneak under the radar
[19:57:03] <eddyb> I don't think it's new
[19:57:14] *** Joins: ELD (textual@moz-tbcsac.co.comcast.net)
[19:57:19] <eddyb> but I don't know how to test it with an old compiler
[19:57:52] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[19:57:53] <eddyb> Ericson2314: keep in mind that is running on 1.1
[19:58:03] <Ericson2314> and what are we on now?
[19:58:06] <eddyb> and the 1.1 changelog didn't mentio anything like this. so I bet it works on 1.0
[19:58:11] <Ericson2314> ok
[19:58:21] <Ericson2314> well anyways, drop w/ self
[19:58:21] <eddyb> and maybe even a pre-release
[19:59:00] <Ericson2314> so 1) can destructure with T: DropValue
[19:59:17] <Ericson2314> which will prevent running of custom destructure and fall back on normal one
[19:59:27] <eddyb> implicitely forgetting the destructor is a nono for me
[19:59:43] <eddyb> too easy to screw up unsafe invariants from safe code in the same module
[19:59:57] <benh> just add an intrinsic that takes a thing and returns a tuple of all its fields imo
[20:00:03] <Ericson2314> enums
[20:00:05] <eddyb> benh: that's Interior<T>
[20:00:22] <Ericson2314> I think ahead to linear types
[20:00:39] <Ericson2314> (and we will need linear types for custom allocators, unless we can't massive overhead)
[20:00:45] <eddyb> behaves structurally identical to T but is a different type so it doesn't have a drop impl of any kind
[20:01:00] <eddyb> Ericson2314: wait, what?
[20:01:13] <Ericson2314> if you have a non-global allocator
[20:01:36] <Ericson2314> i.e. not custom zero-sized type with an impl that accesses globals
[20:01:48] <Ericson2314> you need to store pointer to allocator somewhere
[20:01:52] <eddyb> why is linear typing a must?
[20:01:54] <Ericson2314> but it is annoying to do that in EVERY box
[20:01:55] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[20:01:55] *** Joins: goyox86 (textual@moz-6gq.t8s.78.166.IP)
[20:02:10] <Ericson2314> ideally store pointer once per container
[20:02:27] <Ericson2314> but then cannot drop box, must call free with allocator
[20:02:31] <eddyb> what does "container" mean here?
[20:02:36] *** Quits: waffles (Wafflespean@moz-aeh.673.193.113.IP) (Ping timeout: 121 seconds)
[20:02:45] <Ericson2314> just thinking about libcontainers with custom allocators
[20:02:51] <Ericson2314> nothing technical
[20:02:52] *** Joins: waffles (Wafflespean@moz-aeh.673.193.113.IP)
[20:03:04] <eddyb> are you thinking of e.g. a binary tree using Box?
[20:03:20] <Ericson2314> sure, any data structure where all allocations use same allocator
[20:03:35] *** Quits: semarie (semarie@moz-fvbb0a.bpv6.bg1u.41d0.2001.IP) (Ping timeout: 121 seconds)
[20:04:34] <eddyb> okay, so: Box<T, A> -> (A, Box<T, ExoAlloc<A>>) and (A, Box<T, ExoAlloc<A>>) -> Box<T, A>
[20:04:59] <eddyb> and you want ExoAlloc to be linear so it doesn't drop by accident (because you have no way of freeing the allocation)
[20:05:31] <Ericson2314> ExoAlloc?
[20:05:38] <eddyb> just a phantom type
[20:05:41] <Ericson2314> kk
[20:06:10] <eddyb> you can still handle unwinding if those values are owned by something like the tree I just mentioned (our BTree might actually be using Box)
[20:06:39] <eddyb> you only have an issue if you left one of them "out in the open"
[20:07:18] <Ericson2314> ahh so DTor of container can free the boxes
[20:07:20] <eddyb> it could even be a compile-time error to generate a landing pad for such a type
[20:07:24] <Ericson2314> just screwed if they are on the stack
[20:07:33] <Ericson2314> ^ great idea w/ landing pads
[20:07:41] <eddyb> yeah, it's a pretty-good tradeoff for linear types + exceptions
[20:07:56] <eddyb> (if I'm not missing anything, which I might be)
[20:08:28] <Ericson2314> is this equivalent: Box<T, A> == (A, LinearBoxWithPhantom<T, A>)
[20:08:44] <Ericson2314> just to make sure we are on same page?
[20:09:10] <eddyb> a DropValue impl would presumably cancel the linear property (I believe this is why apcully wanted a by-value drop in the first place)
[20:09:12] <eddyb> Ericson2314: almost
[20:09:43] *** Quits: pczarn (piotr@moz-9un7t9.izacom.pl) (Ping timeout: 121 seconds)
[20:09:52] <eddyb> Ericson2314: you need a wrapper around the two values that implements DropValue and calls the linear consume-to-drop-T-value-and-call-A-free
[20:09:57] *** Joins: eerie (eerie@moz-qbn2t0.red.bezeqint.net)
[20:10:12] <Ericson2314> yeah
[20:11:21] <eddyb> Interior<Wrapper<T, A>> in that case be isomorphic to Interior<(A, LinearBoxWithPhantom<T, A>)>
[20:11:34] <eddyb> which would be a linear type that you can destructure
[20:11:44] <Ericson2314> Well sweet, we came up with the killer app for linear types, and how to make it work with unwinding!
[20:13:28] <zwarich> if you want to make that modular then you have to expose it in the type of the function
[20:13:35] <zwarich> checked exceptions!
[20:13:49] <eddyb> or just make it very very restricted
[20:13:57] <Ericson2314> expose what?
[20:14:05] <Ericson2314> unwinding?
[20:14:08] <eddyb> Ericson2314: whether a function unwinds or not
[20:14:19] <Ericson2314> ah ok
[20:14:38] <zwarich> otherwise you could update to a new version of a crate that unwinds when it didn't before
[20:14:44] <eddyb> zwarich: in this case, you would carry a Box<T, A> around except for inserting it into the tree, when it is briefly Box<T, ExoAlloc<A>>
[20:15:37] <Ericson2314> IMO we should asap get unstable allocator api with this in alloc, and ideally only intruce global allocator in std
[20:15:51] <Ericson2314> So collections is forced to be allocator generic :)
[20:17:16] <eddyb> zwarich: we can also expose it in the type!
[20:17:26] <eddyb> a function cannot unwind if it processes owned linear types
[20:17:38] <eddyb> and type parameters cannot be linear by default
[20:17:51] <zwarich> what about trait objects?
[20:17:56] <eddyb> looking forward to T: ?Sized + ?Linear
[20:17:59] <eddyb> zwarich: same
[20:18:10] <eddyb> Trait+?Linear
[20:18:15] <Ericson2314> mm not ?linear
[20:18:22] <eddyb> Ericson2314: oh, right
[20:18:28] <eddyb> it's inverted
[20:18:29] <Ericson2314> ?Affine i guess
[20:18:42] <eddyb> Rust 1.x will get fun
[20:19:05] <zwarich> I for one can't wait for this to be unsound and not actually be linear again :P
[20:19:32] *** Quits: goyox86 (textual@moz-6gq.t8s.78.166.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[20:19:40] <Ericson2314> well we can argue it's like memory leaks -- don't count on it
[20:19:45] *** Joins: goyox86 (textual@moz-rvv.00r.255.109.IP)
[20:19:53] <Elaine> then what's the point.
[20:20:01] <zwarich> linearity that isn't linearity is pointless
[20:20:07] <zwarich> and will be extra confusing
[20:20:42] *** Quits: goyox86 (textual@moz-rvv.00r.255.109.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[20:20:43] *** Quits: dgrunwald (Daniel@moz-vq6vkn.hsi4.kabel-badenwuerttemberg.de) (Connection closed)
[20:20:54] <Ericson2314> rust that doesn't have exceptions
[20:20:59] *** Quits: avikpal_ (avikpal@moz-tpv.36b.194.117.IP) (Connection closed)
[20:21:11] <Ericson2314> much better space usage on allocator-agnostic data structures
[20:21:22] <Ericson2314> which leaks when unwinding
[20:21:42] <Ericson2314> Like I think the landing pad thing is great
[20:22:14] <Ericson2314> but if that fails I don't want to just give up
[20:22:30] <Ericson2314> anyways, consider a partial move with a linear value
[20:22:38] <Ericson2314> where other fields are non-linear
[20:22:54] <Ericson2314> (no custom destructors)
[20:22:58] <Ericson2314> now the thing can be dropped
[20:23:39] *** Parts: imperio (Mibbit@moz-8otf3a.fbx.proxad.net) ()
[20:26:42] <eddyb> Ericson2314: right, I know what you mean
[20:27:10] <Ericson2314> So already without my self thing, we have a future where parial moves change the dropping semantics
[20:27:18] <eddyb> Ericson2314: for the marker-based linear types I thought that moving all linear fields would be necessary to "consume" the structure
[20:27:29] <Ericson2314> yeah
[20:27:49] <eddyb> consume as in not produce an error (because the structure is linear)
[20:27:50] <Ericson2314> sorry, assuming that the other fields that weren't moved were affine in my example
[20:28:23] <eddyb> if you do a move out of a field (instead of destructuring and dropping the other fields immediately), the other fields will continue to live on for a while
[20:28:28] <eddyb> just like they do today
[20:28:36] <Ericson2314> Yeah
[20:28:52] <eddyb> the difference is that the variable is no longer linear because all linear components are missing
[20:29:02] <eddyb> huon: ping
[20:29:21] <eddyb> Ericson2314: so I'm not seeing what semantics would change
[20:29:40] <Ericson2314> Well just that you couldn't drop it before, and now you can
[20:29:56] <Ericson2314> granted, is not as extreme as different things happening
[20:30:43] <Ericson2314> But does narrow the gap between that and being able to bypass DropMut with destructuring
[20:32:13] <eddyb> Ericson2314: what do you mean by "can drop"?
[20:32:49] <Ericson2314> the variable is no longer linear
[20:32:56] <eddyb> the partially-moved-out-was-linear-but-is-no-longer variable would have the same semantics as a partially moved out variable today
[20:33:04] <Ericson2314> Yeah
[20:33:15] <eddyb> it's not going to allow moving it or anything like that
[20:33:25] <Ericson2314> absolutely
[20:34:08] <Ericson2314> basically the point you raise about accidentally breaking invariants in the module with privacy based destructuring is good
[20:34:28] <Ericson2314> But to me that is the only problem with the drop_value(self) route
[20:34:36] <Ericson2314> Diggsey's hacks are not needed
[20:35:32] <eddyb> that is a relief :)
[20:36:05] <eddyb> Ericson2314: `match Interior::of(x) {...}` feels like `match move x {...}` but less hacky and more composable
[20:36:36] <eddyb> Ericson2314: also keep in mind you don't have privacy for enums
[20:37:22] <eddyb> s/hacky/ad-hoc (to be fair)
[20:39:26] <eddyb> I agree that "just destructure it" seems convenient, but it does something different depending on the types of the fields. and I don't like to encourage mem::forget usage either
[20:39:27] <Ericson2314> hmm, I'm trying to think of an example of an enum with Drop (just for inspiration, the fact that one can be written means a hazard either way)
[20:40:47] <eddyb> Ericson2314: there is a way to check across the codebase
[20:42:17] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[20:42:51] <eddyb> git grep '\benum \b' src/librustc* | sed 's/^.*enum //;s/\W.*$//' | grep '[A-Z][a-z]' | sort -u
[20:42:53] <eddyb> this is a nice list
[20:43:07] <Ericson2314> ok
[20:44:22] <eddyb> git grep -E '\bDrop for ('(git grep '\benum \b' src/librustc* | sed 's/^.*enum //;s/\W.*$//' | grep '[A-Z][a-z]' | sort -u | tr -t '\n' '|' | head -c -1)')' src/librustc*
[20:44:30] <eddyb> src/librustc_llvm/archive_ro.rs:impl Drop for ArchiveRO {
[20:44:48] <eddyb> Ericson2314: so maybe one enum in the whole compiler
[20:45:02] <eddyb> aaand it's not an enum
[20:45:03] <Ericson2314> and none in libstd?
[20:45:15] <Ericson2314> so none at all?
[20:45:46] <eddyb> Ericson2314: in all the libraries, there's src/libcollections/btree/node.rs:impl<K, V> Drop for Node<K, V> {
[20:46:02] <eddyb> but that's probably matching a Node from another module or even crate
[20:46:02] <Ericson2314> hmm
[20:46:15] <eddyb> are Drop impls even allowed on enums?
[20:46:27] <Ericson2314> I would assume they are
[20:46:44] <eddyb> the thing is, if Interior doesn't support enum pattern matching, it's even easier
[20:47:06] <eddyb> just pretend Interior<T> is T when grabbing fields and whatnot
[20:48:20] <Ericson2314> mm i think you would need pattern matching
[20:49:01] <Ericson2314> let's say you are doing something low-level with a bunch of *mut T in boxes
[20:49:34] *** Joins: goyox86 (textual@moz-6gq.t8s.78.166.IP)
[20:49:51] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[20:50:17] <Ericson2314> *Mut T in each variant
[20:52:01] <eddyb> keep in mind that because it's an enum, raw pointers can be modified from anywhere
[20:52:02] *** Joins: Jesin (Jesin@moz-fa9lmm.fios.verizon.net)
[20:52:05] <eddyb> which is terrible :D
[20:52:41] *** Quits: eerie (eerie@moz-qbn2t0.red.bezeqint.net) (Connection closed)
[20:53:38] *** Quits: goyox86 (textual@moz-6gq.t8s.78.166.IP) (Ping timeout: 121 seconds)
[20:54:21] <Ericson2314> private variants?
[20:54:26] <Dabo> Ericson2314, not possible :/
[20:54:45] <Dabo> Ericson2314, If you need the contents of an enum variant to be private, wrap it in an opaque struct :/
[20:54:47] <Ericson2314> oh that's not a thing? Private fields in public variants?
[20:55:13] *** Joins: goyox86 (textual@moz-rvv.00r.255.109.IP)
[20:56:00] <Dabo> Ericson2314, I don't believe so, nope
[20:56:05] <eddyb> Ericson2314: nope, that's why I was saying the thing about matching enums
[20:56:07] <Dabo> enums are kind of public all or nothing
[20:56:40] <Ericson2314> oh this was a simplification for 1.0?
[20:56:47] <eddyb> long before
[20:57:20] <bluss> eddyb: r? gh26776
[20:57:20] <[o__o]> Add missing #[inline] to min_value/max_value on integers: https://github.com/rust-lang/rust/pull/26776
[20:58:45] *** Quits: rkruppe (chatzilla@moz-ghggti.diu2.0rth.0908.2a02.IP) (Ping timeout: 121 seconds)
[20:59:14] *** Joins: doener (doener@moz-fnh.n4j.147.5.IP)
[20:59:23] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[20:59:25] *** Quits: goyox86 (textual@moz-rvv.00r.255.109.IP) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[21:00:02] *** Quits: waffles (Wafflespean@moz-aeh.673.193.113.IP) (Quit: C'yall later :))
[21:05:30] *** Quits: capella-s32 (capella-s3@moz-vcqob4.res.rr.com) (Quit: Talk atcha later)
[21:11:47] *** Joins: Skyler (Skyler@moz-7ds39s.sd.cox.net)
[21:30:54] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[21:30:54] <Ericson2314> eddyb: what if we lint when dropping after a partial move and the type implements DropValue?
[21:31:26] <Ericson2314> i.e. if you pull out just one field, might be by mistake
[21:31:40] <Ericson2314> but if you pull out all fields, it is probably intensional
[21:32:43] *** Joins: summerlight__ (summerlight@moz-lb3.6do.193.175.IP)
[21:33:06] *** Quits: Skyler (Skyler@moz-7ds39s.sd.cox.net) (Client exited)
[21:34:06] <eddyb> it might still be by mistake
[21:34:21] <eddyb> the only way to make sure is to use types
[21:37:07] <Ericson2314> what is your current stance on the unsafety of the T <=> Interior<T> conversion functions?
[21:37:50] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[21:39:34] <eddyb> unsafe from T to Interior<T>
[21:39:52] <eddyb> because it can invalidate existing invariants
[21:40:32] <Ericson2314> ok, and safe the other way
[21:40:36] <eddyb> the other way can be safe (though it shouldn't be easy IMO, it can get misused) because the only safe way to get Interior<T> is from DropValue and the worst you can do is recurse
[21:43:20] <Ericson2314> Interior<T> does not change types of fields where T is recursive, right?
[21:51:11] <arielb1> eddyb: what's the advantage of Interior<T> over destructuring again?
[21:51:47] <arielb1> I don't buy the Copy thing
[21:52:06] <arielb1> currently Copy always implies !Drop - otherwise a value may get dropped once, twice, or any other # of times
[21:52:09] <arielb1> which is unacceptable
[21:53:28] <arielb1> through we need a keyword to get rid of "relevance" types if we ever get them
[21:53:36] <arielb1> no intrinsic can do that
[21:53:56] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Connection closed)
[21:59:28] *** Joins: Rym (uid91135@moz-n2i7qm.charlton.irccloud.com)
[22:00:16] *** Quits: summerlight__ (summerlight@moz-lb3.6do.193.175.IP) (Ping timeout: 121 seconds)
[22:00:20] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[22:03:04] <doener> bluss: regarding the zip benchmarks, I think the black_box confuses LLVM too much
[22:03:29] <doener> bluss: in your unchecked counted loop, it's reloading the base pointer over and over again
[22:05:42] *** Joins: umbridge (Mibbit@moz-hu6.nja.252.72.IP)
[22:06:05] <bluss> doener: aha. thanks for looking at it! benchmarking correctly is very hard..
[22:07:51] *** Quits: umbridge (Mibbit@moz-hu6.nja.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:08:05] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Connection closed)
[22:08:13] *** Joins: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca)
[22:10:20] <doener> bluss: https://gist.github.com/dotdash/d416bbf2011b1957f3e9 -- that's with the black boxing moved before the benchmark and black boxing the whole vector instead of a pointer to it
[22:11:59] <doener> meh... midnight and still 31Â° centigrade outside...
[22:16:06] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[22:16:47] <bluss> doener: ok that's nice, I can reproduce that
[22:17:03] <bluss> doener: but now none of the purported solutions bench as well as the unchecked counted loop
[22:18:32] <zwarich> 9 out of 10 CPUs agree: loops are the superior choice
[22:21:35] *** Joins: rkruppe (chatzilla@moz-5i0kmu.diu2.0rth.0908.2a02.IP)
[22:22:39] *** Quits: arielb1 (Ariel@moz-s1k.6iv.65.109.IP) (Quit: Ex-Chat)
[22:23:42] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[22:23:57] <Elaine> acrichto: r? https://github.com/rust-lang/bitflags/pull/15
[22:25:29] *** Joins: Barca (Mibbit@moz-j9a.ns7.133.129.IP)
[22:26:34] *** Quits: eljay (eljay@moz-fmte10.skybroadband.com) (Quit: Leaving)
[22:31:11] *** Quits: munksgaard (munksgaard@moz-urnkl5.u.parknet.dk) (Connection closed)
[22:36:11] *** Quits: harrisonclarke (harrisoncla@moz-uur7pt.eastlink.ca) (Connection closed)
[22:36:18] <bluss> rewriting ZipSlices to instead of mimicing slice::Iter's pointer walk, just using an index and get_unchecked.. then it maches the manually written loop
[22:40:51] *** Joins: X67r (user@moz-manmml.mullvad.net)
[22:42:22] <huon> eddyb: pong
[22:42:46] *** Joins: p1start (p1start@moz-nftjhe.org)
[22:43:00] *** Joins: ytain (ytain@moz-upqesl.dsl.teksavvy.com)
[22:43:18] <doener> hm, get_unchecked seems wrong for zero sized types
[22:43:54] <bluss> doener: oh lol, I was just thinking that now I don't have to care about ZST myself anymore
[22:44:13] <doener> ah no, offset does the right thing in this case
[22:44:20] <Rym> Is there a changelog available for the current beta?
[22:44:32] <doener> too much heat and beer ;-)
[22:45:33] *** Quits: Barca (Mibbit@moz-j9a.ns7.133.129.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[22:46:27] *** Quits: X67r (user@moz-manmml.mullvad.net) (Quit: Changing server)
[22:47:46] *** Joins: rustbot (havvy@moz-tb54ql.airspeedinternet.net)
[22:48:00] *** Joins: iu (iu@moz-6263qv.cc.cmu.edu)
[22:48:22] <WindowsBunny> (3:39:13 PM) eddyb: kmc: you can always do what WindowsBunny does and convert it
[22:48:28] <WindowsBunny> eddyb: The converted info does kinda suck though
[22:52:02] *** Joins: X67r (user@moz-manmml.mullvad.net)
[22:53:18] <Elaine> Rym: https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-120-august-2015
[22:53:21] <Elaine> Rym: effectively, no.
[22:55:40] *** Quits: RCIX (RCIX@moz-vnmep7.ph.cox.net) (Connection closed)
[22:56:37] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[22:57:40] <Rym> Elaine: Ok, thanks anyway. 
[22:57:53] *** Quits: phaylon (phaylon@moz-t987n8.scsys.co.uk) (Ping timeout: 121 seconds)
[22:57:54] *** Joins: phaylon (phaylon@moz-t987n8.scsys.co.uk)
[23:13:34] *** Joins: nagisa (nagisa@moz-8t068g.static.zebra.lt)
[23:13:50] *** Joins: Skyler (Skyler@moz-dgl2bi.fios.verizon.net)
[23:28:43] <doener> bluss: hm, I'm sad that the checked one I did doesn't have the bounds checks eliminated
[23:28:55] <doener> bluss: would have expected LLVM to see through the min thing
[23:30:31] *** Joins: Amaranth (travis@moz-1raqsl.cpe.cableone.net)
[23:33:39] <doener> bluss: hm, it does in C++, so our fault
[23:35:13] <bluss> doener: what kind of bounds check do you compare with in C++?
[23:36:04] <doener> bluss: https://gist.github.com/dotdash/8b62f2afb2e1798579db
[23:36:25] <doener> bluss: the calls to bar() get eliminated
[23:36:55] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[23:37:14] <bluss> ok
[23:37:49] <bluss> if I replace let len = cmp::min(xs.len(), ys.len()) with just  let len = ys.len();, it benches the same as the unchecked loop. ys happens to be the shorter of the two
[23:37:58] *** Quits: bjz (bjz@moz-pl4g2k.tpgi.com.au) (Quit: My Mac has gone to sleep. ZZZzzzâ€¦)
[23:38:44] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[23:39:58] <doener> maybe 16 from "Other things to consider" applies? http://llvm.org/docs/Frontend/PerformanceTips.html
[23:40:17] <doener> I don't feel comfortable messing with the pass order though...
[23:41:13] <aatch> doener, I wanted to have Rust use it's own set of passes, I even made it do that, but it got changed to what we have now.
[23:41:17] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[23:41:35] <doener> aatch: I remember that
[23:41:45] <doener> aatch: btw, happy belated birthday :-)
[23:41:50] <aatch> doener, thank you.
[23:49:37] <bluss> doener: well if you can't mess with it, who can? It sounds logical that we need more passes to cut through our layers of abstraction
[23:51:34] *** Joins: elif (chatzilla@moz-ev8m1p.res.rr.com)
[23:52:47] <doener> I'd trust aatch to handle that, but we would likely need to get a test suite for the codegen results, IIRC one reason we switched back to the default pass setup was the we were trying a lot of setups, and often just got better on one benchmark and worse at another
[23:53:32] <doener> (correct me if I'm wrong there)
[23:53:54] *** Quits: nagisa (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[23:55:03] <aatch> If I had the time, I'd experiment with doing what some other project (Haskell I think) did and set up a genetic algorithm to try and find a good set of passes for Rust code.
[23:58:19] <aatch> The fitness function is nice and easy, median weighted time for a set of benchmarks.
