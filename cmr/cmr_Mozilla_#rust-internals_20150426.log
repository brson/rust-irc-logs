[00:01:45] *** Quits: amir (amir@moz-qbf4gg.fiber7.init7.net) (Ping timeout: 121 seconds)
[00:09:44] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[00:11:01] *** Joins: aldeka (quassel@moz-qqf.of6.243.162.IP)
[00:17:30] *** Joins: hyunsik (hyunsik@moz-3qgjl9.ca.comcast.net)
[00:17:38] *** Joins: quantheory (quantheory@moz-uiqd7j.co.comcast.net)
[00:18:25] *** Joins: cacaca (Mibbit@moz-aua.g0i.51.193.IP)
[00:18:36] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[00:19:28] *** Joins: brson (brson@moz-a8s.c9m.56.172.IP)
[00:19:28] *** ChanServ sets mode: +o brson
[00:20:01] *** Joins: bombless (_@moz-h37.piv.41.59.IP)
[00:21:13] *** Quits: sigma (sigma@moz-ohog4c.range86-135.btcentralplus.com) (Ping timeout: 121 seconds)
[00:21:42] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Connection closed)
[00:26:50] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[00:28:58] *** Quits: willem (willem@moz-facs2s.dynamic.upc.nl) (Quit: leaving)
[00:29:39] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[00:32:42] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[00:33:25] *** Quits: arielb1 (Ariel@moz-augomq.red.bezeqint.net) (Quit: Ex-Chat)
[00:36:47] *** Joins: amir (amir@moz-jnohkj.3bcq.01f6.0168.2a02.IP)
[00:36:48] <larsberg> BTW, for anybody who likes looking into ICEs, we believe that https://github.com/rust-lang/rust/issues/24687 is currently blocking the servo update to this morning's Rust...
[00:41:55] *** Joins: tcurdt (tcurdt@moz-n9dsvp.dip0.t-ipconnect.de)
[00:44:43] <aatch> larsberg, do you mind doing the compile with `RUST_LOG=syntax::codemap`? That should print out some information about the location lookup just before the assert is triggered.
[00:45:43] <larsberg> SimonSapin: ^ (I will also reproduce on the newest build, but it'll take 15 minutes to rebuild to that point and Simon might have it handy...)
[00:46:22] <reem> aturon: ping about Reflect
[00:46:39] <SimonSapin> trying now
[00:47:27] <aatch> larsberg, SimonSapin, would the total code size for the crate that's failing be greater than 4GB?
[00:47:48] <SimonSapin> aatch: size of the generated rlib?
[00:47:54] <larsberg> aatch: It's ~120k lines of rust
[00:47:58] <aatch> No, the source.
[00:48:18] <SimonSapin> no, definitely under 4GB
[00:48:26] <SimonSapin> Servo is big, but not that big :)
[00:48:53] <aatch> SimonSapin, didn't think so, but it doesn't hurt to eliminate something like overflowing the byte position.
[00:49:24] <aatch> Since we use a u32, the idea being that 4GB of code is a ridiculous amount to be compiling in a single crate.
[00:49:26] <SimonSapin> aatch: no extra output with RUST_LOG=syntax::codemap …
[00:49:49] *** Quits: srh (User@moz-fmnn73.unps.r1c6.fb90.2607.IP) (Ping timeout: 121 seconds)
[00:50:15] *** Quits: Skyler (Skyler@moz-rv949t.sd.cox.net) (Client exited)
[00:50:33] <aatch> SimonSapin, ugh, I guess that debug prints are being removed.
[00:50:56] <SimonSapin> larsberg: our Rust build is release, right?
[00:51:01] *** Joins: casey (casey@moz-v0ns05.tpgi.com.au)
[00:51:09] <larsberg> SimonSapin: yes
[00:51:43] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[00:53:06] <aatch> Hmm, shot in the dark, but you wouldn't happen to have any zero-width unicode characters hanging around, would you?
[00:53:12] <bstrie> hm, would it make sense to forbid RefCell on Copy types, to force them to use Cell instead?
[00:54:24] <reem> bstrie: Sometimes you actually do want an &mut T where T: Copy vs. T by-value.
[00:54:39] <reem> also generics
[00:55:08] <reem> it’s almost always a bad idea to add/remove bounds as a “lint” since then you can’t use that type in certain generic contexts
[00:56:00] *** Quits: quantheory (quantheory@moz-uiqd7j.co.comcast.net) (Quit: Leaving)
[00:57:42] *** Quits: johnz133 (johnz133@moz-tqd.4t0.72.208.IP) (Connection closed)
[00:58:18] <SimonSapin> aatch: no result for `git grep -P '\xe2\x80\x8b' components/`  (UTF-8 for the ZERO WIDTH SPACE code point)
[00:58:28] *** Quits: hyunsik (hyunsik@moz-3qgjl9.ca.comcast.net) (Ping timeout: 121 seconds)
[00:59:01] <aatch> SimonSapin, I just tested (and then looked more carefully at the code), it's not the cause either.
[00:59:29] <larsberg> SimonSapin: that won't look at the ~100kb of generated files
[00:59:48] <larsberg> s/kb/kloc
[01:00:08] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[01:00:32] <SimonSapin> larsberg: Good point. But that’s enough for me today :)
[01:00:52] <larsberg> SimonSapin: oh, 2AM, yeah :-) Thanks for pushing on the rustup for so long!
[01:01:48] <larsberg> owait, that's London; 3AM in Paris - ouch.
[01:02:09] <larsberg> aatch: should I build a custom build of rustc to get some more info?
[01:02:10] <aatch> larsberg, well you have some multibyte characters *somewhere*
[01:02:45] <aatch> larsberg, it'd help, at least the ability to narrow down where to look in the source.
[01:02:59] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[01:04:15] <aatch> Are you sure it's the same assertion, before you run off and build rustc, what's the file/line the assertion prints
[01:04:17] <aatch> ?
[01:04:33] *** Quits: brson (brson@moz-a8s.c9m.56.172.IP) (Quit: leaving)
[01:05:19] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[01:05:46] *** Joins: ferminter (Mibbit@moz-juv.9o3.252.72.IP)
[01:05:50] <larsberg> First, we do have some non-ascii characters:
[01:05:53] <larsberg> https://irccloud.mozilla.com/pastebin/PwVST7SU
[01:06:16] <larsberg> I'll try removing those, as they're not in generated files :-)
[01:06:34] * larsberg is still building the script crate; it takes ~4 minutes to get to the error...
[01:07:03] <larsberg> aatch: full error:
[01:07:07] <larsberg> https://irccloud.mozilla.com/pastebin/vA5wOaCo
[01:07:51] <aatch> Slightly different location, but my rustc is probably out-of-date.
[01:08:21] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[01:09:11] <larsberg> Our hash is 0d8309ec0b13ebad02bbc76f93eff39edf4af2d0 
[01:09:57] <aatch> larsberg, just updated my source, everything matches now.
[01:10:49] <larsberg> aatch: Identical error with the unicode characters removed
[01:14:15] <aatch> larsberg, well you have to have atleast 1 multibyte character *somewhere*, since that assertion is in a loop over the multibyte characters we've seen.
[01:15:36] <larsberg> hrm, find . -name '*.rs' | xargs ggrep --color='auto' -P -n "[\x80-\xFF]" comes back with nothing in the script directory. 
[01:17:45] <larsberg> aatch: but thanks for looking into it! It's not as late in my time zone as it is in simon's, but I still also need to call it. Sorry for randomizing you with this :-)
[01:18:17] <aatch> larsberg, fair enough. I probably won't look into this much more though
[01:18:53] <larsberg> aatch: That's fine! I'll make a big fuss Monday morning :-) Thanks again for poking at it; I appreciate at least knowing it isn't something trivial to hack around.
[01:19:35] <aatch> larsberg, I'm stumped, chances are it's only triggered on large projects too.
[01:20:11] <larsberg> aatch: I'll fire off a debug rustc build tonight so that I can at least paste the debugging info you requested when it finishes in the morning
[01:20:36] *** Joins: tamird_ (textual@moz-eia.t9o.141.50.IP)
[01:21:17] *** Quits: casey (casey@moz-v0ns05.tpgi.com.au) (Connection closed)
[01:21:39] *** Joins: casey (casey@moz-v0ns05.tpgi.com.au)
[01:23:24] *** Quits: tamird (textual@moz-ga7.n0o.141.50.IP) (Ping timeout: 121 seconds)
[01:25:41] *** Quits: casey (casey@moz-v0ns05.tpgi.com.au) (Ping timeout: 121 seconds)
[01:26:54] *** Quits: chc4 (chc4@moz-pdo0at.ma.comcast.net) (A TLS packet with unexpected length was received.)
[01:28:37] *** Joins: GBGamer (npm@moz-92sbjt.wa.comcast.net)
[01:28:46] *** Joins: srh (User@moz-tvc5sp.sntcca.sbcglobal.net)
[01:32:54] *** Quits: ferminter (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[01:33:07] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[01:36:39] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[01:38:12] *** Quits: cacaca (Mibbit@moz-aua.g0i.51.193.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[01:38:50] *** Quits: cdidd__ (cdidd@moz-442hfv.broadband.corbina.ru) (Ping timeout: 121 seconds)
[01:42:41] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[01:43:58] *** Quits: Rym (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[01:44:09] <proc> is it even to run a multi-command with Command::new ?
[01:44:30] <proc> so a cmd + |& tr for example
[01:44:36] <proc> with arguments
[01:44:45] <aatch> proc, nope, since that's actually shell syntax.
[01:44:57] <proc> aatch: is there any way to run shell syntax ?!
[01:45:13] <aatch> proc, run "sh" with the appropriate arguments?
[01:45:18] *** Joins: chc4 (chc4@moz-pdo0at.ma.comcast.net)
[01:45:37] <proc> aatch: so a /bin/sh call where the whole cmd is the argument? 
[01:45:39] <proc> sounds funny
[01:45:42] <aatch> specifically, "sh -c "what I want to run""
[01:45:58] <proc> aatch: ty, saved me now after 3h
[01:50:06] *** Quits: proc (proc@moz-tnbie4.dip0.t-ipconnect.de) (Quit: Gotta eat my pizza)
[01:52:47] *** Joins: mib_7vcwa9 (Mibbit@moz-juv.9o3.252.72.IP)
[01:53:44] *** Joins: cdidd__ (cdidd@moz-5107eh.broadband.corbina.ru)
[01:58:32] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[02:00:54] *** Quits: mib_7vcwa9 (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[02:03:21] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[02:03:38] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[02:05:10] <GBGamer> anyone know where the lang-item definitions are held in the compiler?
[02:10:48] *** Joins: hyunsik (hyunsik@moz-3qgjl9.ca.comcast.net)
[02:12:50] *** Quits: kimundi (kimundi@moz-dunnue.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[02:14:09] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[02:14:19] *** Joins: kimundi (kimundi@moz-jta.503.188.87.IP)
[02:18:11] *** Quits: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se) (Ping timeout: 121 seconds)
[02:18:18] *** kimundi is now known as zz_kimundi
[02:25:13] *** zz_kimundi is now known as kimundi
[02:28:35] *** Joins: summerlight_ (summerlight@moz-99k.2mj.130.121.IP)
[02:28:41] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[02:40:37] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[02:40:44] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[02:44:28] *** Joins: p1start (p1start@moz-nftjhe.org)
[02:56:55] *** Joins: tamird (textual@moz-puo.n0o.141.50.IP)
[02:58:51] *** Quits: tcurdt (tcurdt@moz-n9dsvp.dip0.t-ipconnect.de) (Quit: Textual IRC Client: www.textualapp.com)
[03:00:03] *** Quits: tamird_ (textual@moz-eia.t9o.141.50.IP) (Ping timeout: 121 seconds)
[03:00:07] *** Quits: srh (User@moz-tvc5sp.sntcca.sbcglobal.net) (Quit: Leaving)
[03:05:10] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Connection closed)
[03:16:34] *** Joins: skeuomorf (skeuomorf@moz-pl7.u9l.32.197.IP)
[03:16:34] *** Quits: tamird (textual@moz-puo.n0o.141.50.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[03:16:36] *** Joins: jgallagher (john@moz-6ge.dhn.131.24.IP)
[03:22:01] <bombless> GBGamer: https://github.com/rust-lang/rust/blob/master/src/librustc/middle/lang_items.rs here?
[03:25:05] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[03:27:35] *** Joins: semarie (semarie@moz-vo7ult.telostor.ca)
[03:28:27] *** Quits: skeuomorf (skeuomorf@moz-pl7.u9l.32.197.IP) (Quit: WeeChat 1.1.1)
[03:33:58] *** Quits: bombless (_@moz-h37.piv.41.59.IP) (Quit: Leaving)
[03:35:38] *** Joins: mib_nrd7yp (Mibbit@moz-juv.9o3.252.72.IP)
[03:38:39] *** Quits: mib_nrd7yp (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[03:46:05] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[03:46:10] *** Quits: gsingh93 (gulshan@moz-qnbukr.mi.comcast.net) (Ping timeout: 121 seconds)
[03:46:32] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[03:48:08] *** Joins: Thorn (Thorn@moz-gfo.20c.107.217.IP)
[04:09:11] *** Joins: mib_1rl8s8 (Mibbit@moz-juv.9o3.252.72.IP)
[04:09:34] *** Quits: mib_1rl8s8 (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[04:14:48] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[04:15:49] *** Quits: Diggsey (diggsey@moz-o8tmhf.dsl.pipex.com) (Ping timeout: 121 seconds)
[04:19:20] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[04:24:09] *** Quits: ytain (ytain@moz-ge9fgi.dsl.teksavvy.com) (Quit: Textual IRC Client: www.textualapp.com)
[04:24:43] *** Quits: Rusky (russell@moz-pob0l8.slkc.qwest.net) (Ping timeout: 121 seconds)
[04:32:38] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[04:32:52] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[04:33:02] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Quit: Leaving)
[04:33:11] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[04:33:59] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Quit: Leaving)
[04:38:50] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[04:39:33] *** Joins: Rusky (russell@moz-pob0l8.slkc.qwest.net)
[04:53:28] *** Quits: chc4 (chc4@moz-pdo0at.ma.comcast.net) (Quit: AHHHHH BEES)
[04:54:44] *** Joins: tamird (textual@moz-oii9i6.ca.comcast.net)
[04:56:53] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[05:03:17] <carllerche> Gankro: should OccupiedEntry implement Deref / DerefMut?
[05:03:38] <Gankro> carllerche: This was discussed and ultimately rejected
[05:03:46] <Gankro> I can't remember the details
[05:03:57] <Gankro> Generally we're very conservative about Deref
[05:04:01] <carllerche> i wonder why... calling get / get_mut is annoying :P
[05:04:10] <carllerche> seems fine though
[05:04:15] <blaenk> yeah that'd be pretty cool
[05:04:54] <Gankro> It has other methods, though
[05:05:01] <Gankro> which is janky with Deref
[05:05:50] <carllerche> Gankro: how is it janky?
[05:06:43] *** Quits: tamird (textual@moz-oii9i6.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[05:08:32] *** Joins: mib_rxfmqb (Mibbit@moz-juv.9o3.252.72.IP)
[05:08:55] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[05:08:57] <Gankro> carllerche: smaht methods beat Deref methods
[05:09:23] <carllerche> Gankro: what do you mean?
[05:09:35] *** Quits: mib_rxfmqb (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[05:09:43] <sfackler> carllerche: https://github.com/rust-lang/rust/issues/13126
[05:09:52] <carllerche> thanks
[05:10:14] <Gankro> So you can potentially get weird stuff. Like Map<K, Vec<Vec<T>>, entry.insert(vec![])
[05:10:27] <Gankro> Might have intended insert on the derefee
[05:10:35] <Gankro> but you inserted into the entry
[05:10:57] <Gankro> Ah no wait that's a different signature
[05:11:13] <Gankro> also it makes adding methods a back-compat hazard
[05:12:06] <carllerche> So, when is implementing Deref a good idea?
[05:12:25] <sfackler> if you have a smart pointer
[05:12:55] <Gankro> carllerche: Smaht ptrs is basically it.
[05:12:57] <sfackler> or more uncommonly if you have a Vec/[T] situation where you control the dereffer and derefee
[05:13:29] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[05:15:16] <Gankro> carllerche: The thing is Entry isn't quite just a pointer to an element. It's a more complex handle to the logical "space" that a key matches. get/get_mut is one of many things that can be done with it.
[05:15:52] <Manishearth> o/ Gankro 
[05:15:59] <Manishearth> I just read through the BTree post today
[05:16:01] <Gankro> carllerche: 99% of the time the get_or_insert methods (or whatever they ended up being called) are what you want anyway
[05:16:40] <Manishearth> Gankro: in BTree you mention that `cap` isn't needed -- why not use a cap-less `Vec` instead (which allocates only as much as it needs) to reduce size?
[05:17:12] <Gankro> Manishearth: Every push would be a realloc?
[05:18:09] <Manishearth> oh, so `cap` is needed
[05:18:26] <Gankro> Manishearth: The thing is that `cap` is a per-tree constant
[05:18:31] <Manishearth> ah okay
[05:18:36] <Gankro> So storing it in the nodes is super-redundant
[05:19:02] <Gankro> I had a PR that just settled on like B=7 as a hard-coded constant. Ended up closing it due to bitrot/future work
[05:19:05] <Manishearth> Gankro: so use a GankroVec that has no `cap` field, and the `cap` is taken from the root?
[05:19:08] <Manishearth> ah
[05:19:27] <Manishearth> I assume the Vec isn't exposed
[05:19:28] <Gankro> No perf impact, unfortunately
[05:19:31] <Manishearth> ah
[05:19:54] <Gankro> Manishearth: part of it is unwind-safety
[05:20:03] <Gankro> Node needs to know how to clean itself up in the face of a panic
[05:20:37] <Manishearth> ah
[05:21:00] <Gankro> Otherwise it's a sort of encapsulation thing
[05:21:06] <Gankro> Where the node doesn't trust the tree
[05:21:21] <Gankro> I'm not sure if I agree with that philosophy as much anymore
[05:21:32] <Gankro> But it's a thing we do in that module a fair amount
[05:21:47] <Gankro> a lot of bending-over-backwards to make type-safe unchecked accesses
[05:22:38] <Gankro> At some point the code just becomes harder to grok. Which isn't what you want.
[05:24:58] <carllerche> Gankro: is there a way to iterate & remove from a collection? sort of like java's iterators?
[05:26:53] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[05:26:54] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[05:29:45] <reem> carllerche: the drain iterators, but it’s not stable
[05:29:57] <blaenk> yeah just found that out msyelf :(
[05:30:20] <carllerche> reem: I don't want to remove all elems :P
[05:30:31] <carllerche> I guess you could filter
[05:30:32] <blaenk> yeah that's what drain is for
[05:30:39] <reem> carllerche: drain_range is also planned, to let you remove only some areas
[05:30:45] <blaenk> o yeah
[05:30:56] <carllerche> well, i want to iterate, for each elem, check it, and maybe remove it
[05:30:57] <reem> but that’s had some problems because of the drop stuff
[05:31:03] <carllerche> I guess if filter works, then ok
[05:31:10] <reem> hmm, it sounds like you want an iterator of entries or something
[05:31:17] <reem> which does not really exist
[05:31:21] <Gankro> carllerche: I think it would be easiest to roll your own on top of Vec's unsafe API
[05:31:23] <Manishearth> Gankro: is there any collections API that could do with some microoptimizations?
[05:31:32] <Gankro> Manishearth: All of them
[05:31:35] <reem> drain().filter() will still remove everything, it’ll just only yield you some elements
[05:31:40] <carllerche> Gankro: unfortunately, i'm working w/ maps & sets
[05:31:49] <Gankro> carllerche: Ah
[05:31:51] <Manishearth> Gankro: :p
[05:32:06] <Gankro> carllerche: Streaming iterators are necessary for "iterator of entries" type things
[05:32:07] <Manishearth> Gankro: one that a relativelyt inexperienced person like me can have a shot at
[05:32:16] <carllerche> what I am doing right now is iterating, building a vec of keys to remove, and then removing those
[05:32:24] <carllerche> but that requires creating a vec of keys 
[05:32:26] <carllerche> which is annoying
[05:32:30] <Gankro> carllerche: Yeah
[05:32:47] <Gankro> carllerche: open problem to solve, I'm afraid
[05:33:06] <reem> Gankro: Why is streaming iterator required for an iterator of entries sort of deal?
[05:33:17] <Gankro> reem: Can't have two entries exist at once
[05:33:30] <Gankro> Calling remove on one will invalidate the other almost surely
[05:33:48] <Gankro> Unless you have a very particular kind of map (e.g. Binary tree with parent ptrs)
[05:34:02] <reem> Ya, intuitively I was thinking that it was similar to iter_mut iterators, but it really isn’t.
[05:34:13] <carllerche> Gankro: is there an open RFC for this?
[05:34:27] <carllerche> or is this not planned for the close future
[05:34:28] <Gankro> carllerche: Which?
[05:34:36] <carllerche> streaming iterators i guess
[05:34:43] <reem> requires HKT to do properly
[05:34:48] <Gankro> carllerche: reem is the guy to ask about that
[05:34:57] <carllerche> basically everything requires HKT :P
[05:35:12] <Gankro> reem: hackable on top of some kind of higher ranked something?
[05:35:30] <reem> ya, there is actually a way to use HRTB to accomplish it, but it gets extremely messy
[05:35:38] <reem> and there are places where rustc is just not reading to handle it
[05:36:02] <reem> e.g. if you have S: for<‘a> Streaming<‘a> what do you say for <S as ??>::Output
[05:36:14] <sfackler> you can define them sort of: http://sfackler.github.io/rust-postgres/doc/postgres/trait.StreamIterator.html
[05:36:38] <sfackler> but only for specific cases I think
[05:36:41] <reem> if you’re willing to require the output to be either &’a T or &’a mut T etc. then you get it to work
[05:36:52] *** Quits: andrewseidl (andrewseidl@moz-7e86q0.aas.io) (Ping timeout: 121 seconds)
[05:37:08] <reem> it’s being generic over the borrow-type that requires HKT, since you need to say that the associated Output type *takes* a lifetime param, then fill it in in the signature of next.
[05:37:13] <carllerche> much cloning & allocating it is then
[05:37:25] <Gankro> carllerche: Yeah sorry :/
[05:37:37] <carllerche> eh, it's all good :P
[05:37:40] <blaenk> man whenever I see you carl I try so hard to not nag about pooled futures
[05:37:51] <carllerche> ha, there was an open PR no?
[05:37:55] <carllerche> i need to go back and finish it
[05:37:55] <blaenk> yup
[05:38:02] <blaenk> someone was attempting it but I think they gave up
[05:38:13] <blaenk> they were new to rust and I think it was their first use of it, or so I understood
[05:38:33] <carllerche> blaenk: that's what you wanted right? https://github.com/carllerche/eventual/blob/defer-todo/src/run.rs#L12
[05:38:46] <carllerche> i should remove the printlns :P
[05:38:55] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[05:39:27] <carllerche> i'll see if i can finish it up tomorrow or monday
[05:42:22] <blaenk> yeah I'm gonna play around with this. I guess I need to read about it some more. cause I envision something like a vec of tasks (futures?) and pump them into a threadpool, then collect the results. I don't know if that even makes sense or is the correct way to go about it
[05:42:42] <blaenk> so it would block until all of the results came back I guess
[05:43:02] <blaenk> so that I could end up with a vec of results
[05:43:58] <blaenk> yeah so I'd await the results
[05:44:26] <carllerche> it should be possible to use the various primitives
[05:44:40] <carllerche> i gotta take off for now, but i will try to update your issue w/ an example
[05:44:45] <carllerche> and finish up this PR
[05:44:48] <blaenk> that would be amazing!
[05:44:50] <blaenk> take care
[05:45:03] <reem> blaenk: it sounds like you want join + Future::spawn but running on a thread pool instead of standalone threads
[05:45:24] <blaenk> yeah that was my original concern, cause I was afraid of say creating 100 futures and that creating in the worst case 100 simultaneous threads
[05:45:29] <blaenk> I wanted to bound it within an existing pool
[05:47:34] <reem> blaenk: you can write a trait like this, maybe a bit more general, https://github.com/reem/transfer/blob/master/src/rt/mod.rs#L21-L37. Specifically you want the invoke implementation, then if you have a bunch of tasks just run them all using invoke and collect all the futures into a Vec and join them
[05:47:53] <reem> (you can implement Executor or whatever you call it for a thread pool type)
[05:47:55] <blaenk> thanks reem I'll take a look at this
[05:48:10] <blaenk> I think it's called just Run, unless I'm thinking of something else
[05:48:24] <reem> ya, syncbox has one called Run but it no longer has invoke
[05:48:36] <reem> since eventual and syncbox split
[05:48:38] <blaenk> ohh
[05:48:43] <reem> so I rolled my own for the invoke method
[05:48:51] <reem> but really it’s just a convenience
[05:50:52] <blaenk> hey if you have a T that impls Deref<Target=[X]>, is there a way to leverage that deref to leverage IntoIterator?
[05:51:08] <blaenk> so that you could do something _like_ for i in the_t
[05:51:21] <blaenk> hmm maybe in *the_t, will try
[05:51:58] <reem> just call into_iterator - there is no DerefOnce, so you can’t do what you want with Deref
[05:52:05] <reem> into_iter*
[05:52:13] <blaenk> oh my mistake on the example, I meant say for i in &the_t, or for i in &mut the_t
[05:52:39] <blaenk> i.e. iter() or iter_mut() but by way of IntoIterator to avoid typing iter() (just a curiosity, I don't mind typing it)
[05:52:42] <reem> &* or &mut* should work if just plain & or &mut doesn’t
[05:52:55] <reem> not sure if deref coercions will trigger here
[05:53:17] <blaenk> yeah cause it's seeming like it won't. it keeps just showing up as my T instead of the deref target
[05:53:25] <blaenk> maybe if i create a bind (or if we had type ascription)
[05:53:39] <reem> I love how we just banished as_slice from the language, it was such a nuisance.
[05:53:48] <blaenk> yeah lol
[05:53:54] <reem> type ascription would let you do what you want here, but would probably be longer than just &* anyway
[05:54:07] <ebfull> what's with the weird build failures bors gets sometimes
[05:54:09] <blaenk> yeah definitely. like I said it was just a curiosity
[05:54:16] <ebfull> non-determinism on the test platforms? or is it under heavy development
[05:54:35] <blaenk> yeah that's what it is reem, would need type ascription. a bind also works
[05:54:43] <blaenk> I guess the coercions just don't trigger there like you say
[05:54:48] <reem> ebfull: run enough tests enough times and you get random io failures and stuff - disclaimer: not an expert at the rust build system
[05:55:08] <blaenk> actually it kind of sucks cause like if you have &&&T that also won't work unless it's exactly &T. shouldn't autoderef work there?
[05:55:17] <blaenk> or at least, I tested with &&mut
[05:55:22] <blaenk> idk about &&
[05:55:38] <reem> you might have to type &** or &***** etc. in really crazy cases, but they happen almost never
[05:56:19] <blaenk> yeah, but I was mainly wondering why it doesn't handle it automatically. it would entail autoderef no?
[05:56:24] <Manishearth> & &mut is strange IIRC
[05:56:29] <Manishearth> it doesn't behave as expected
[05:56:46] <blaenk> yeah in that case it's better to just do &* imo
[05:56:55] <blaenk> but was curious about for example && or something
[05:58:52] <reem> Manishearth: I’m pretty sure it just behaves like &&
[05:59:03] <blaenk> dude reem how'd you manage to get github.com/iron. nobody had it before? or did you appeal for it?
[05:59:18] <reem> had to appeal, some guy was squatting on it
[05:59:25] <blaenk> yeah I was wondering, cause I might try the same thing
[05:59:37] <reem> I’ve done it several times (got reem that way too), github is really good about it
[05:59:39] <blaenk> but I'm gonna wait until I start finishing up my project so it looks like I have something reasonable that would use it
[05:59:51] <blaenk> oh yeah? do you really have to make your case? do you think I should wait like I'm saying?
[06:00:05] <reem> if you find a name and they have no contributions that you can see, you basically just go to the contact form and request access to the name
[06:00:19] <blaenk> yeah, it has like no activity at all and one forked repo and nothing lol
[06:00:23] <reem> then they get back to you pretty soon and either say they freed it up and you should grab it or they have private contributions you can’t see
[06:00:28] <blaenk> ahh okay
[06:00:34] <blaenk> but you didn't have to make your case or anything then?
[06:00:38] <blaenk> about what you'd use it for etc
[06:00:49] <reem> not really, just say you want the name for a project and it looks abandoned
[06:00:56] <blaenk> niiice, thanks I'm gonna have to try that
[06:00:58] <reem> (their contact form rewards you for brevity)
[06:01:07] <blaenk> hope they dont have private stuff, but if they do oh well at least I tried
[06:01:10] <blaenk> ahh okay
[06:01:18] <reem> there are no negative consequences to trying, so you definitely should
[06:01:25] <blaenk> sweet
[06:02:09] <reem> I still mourn for github.com/hyper
[06:02:29] <blaenk> oh hahaha, hyperium sounds pretty cool though. it didn't cross my mind that it was a response to an existing one
[06:02:45] <reem> yea, seanmonstar chose it, it’s pretty good
[06:03:04] *** Joins: sagg (sigg@moz-55rvi2.dclient.hispeed.ch)
[06:03:05] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[06:05:19] <Manishearth> reem: yeag
[06:05:23] <Manishearth> *yeah
[06:06:11] <blaenk> does this warning make sense? https://gist.github.com/blaenk/473fb002e5900252eb59
[06:06:46] *** Quits: meteredsection (meteredsect@moz-ersuj2.wa.comcast.net) (Ping timeout: 121 seconds)
[06:06:46] <blaenk> hmm formatting of warning got messed up
[06:07:13] <blaenk> does it mean to say that the initial value I give it of false is overwritten anyways? not sure
[06:07:23] <blaenk> cause I mean line 22 is reading is_match
[06:07:37] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[06:09:02] <blaenk> yeah I think that's what that warning means
[06:09:05] <blaenk> if this is anything to go by https://github.com/rust-lang/rust/blob/dd077d5decbc3e462a9fe2feb1a0af0486897acb/src/test/compile-fail/liveness-dead.rs#L19
[06:09:17] <blaenk> I guess it means that there's no point in setting that value because it's always overwritten
[06:09:49] <blaenk> but that doesn't seem entirely obvious to me? is_match is only overwritten on lines 9 and 18, and that's not guaranteed to occur afaik
[06:10:01] <blaenk> ohhh
[06:10:09] <blaenk> the continue
[06:10:26] <blaenk> so it's definitely overwritten otherwise it'd just continue, duhh. the whole flag is pointless
[06:10:32] <blaenk> thanks rust bro
[06:10:49] <blaenk> I'm so proud of rust
[06:11:21] <blaenk> to think it will only get better
[06:19:33] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[06:22:25] *** Quits: GBGamer (npm@moz-92sbjt.wa.comcast.net) (Quit: Lost terminal)
[06:32:39] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[06:37:57] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[06:40:21] *** Joins: genbattle (genbattle@moz-n5c2kc.xtra.co.nz)
[06:42:40] *** Joins: c0170 (c0170@moz-4stj9o.cable.virginm.net)
[06:47:21] *** Quits: annodomini (lambda@moz-qgii5v.ma.comcast.net) (Client exited)
[06:48:39] *** Quits: sagg (sigg@moz-55rvi2.dclient.hispeed.ch) (Ping timeout: 121 seconds)
[06:51:08] *** Joins: johnz133 (johnz133@moz-tqd.4t0.72.208.IP)
[06:57:15] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[06:58:28] *** Quits: genbattle (genbattle@moz-n5c2kc.xtra.co.nz) (Ping timeout: 121 seconds)
[07:00:01] *** Joins: mr_sticky (Mibbit@moz-1e9.8ln.234.180.IP)
[07:01:03] *** Quits: mr_sticky (Mibbit@moz-1e9.8ln.234.180.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[07:01:48] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[07:01:58] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[07:02:23] *** Joins: avikpal (avikpal@moz-01s.imq.194.117.IP)
[07:18:12] *** Quits: avikpal (avikpal@moz-01s.imq.194.117.IP) (Ping timeout: 121 seconds)
[07:27:04] *** Joins: avikpal (avikpal@moz-bf3.3e4.194.117.IP)
[07:30:40] *** Joins: erz (erz@moz-n2p94l.broadband.corbina.ru)
[07:37:44] *** Quits: blaenk (blaenkdenum@moz-kaffj9.n2pv.fsko.e000.2605.IP) (Ping timeout: 121 seconds)
[07:41:05] *** Quits: johnz133 (johnz133@moz-tqd.4t0.72.208.IP) (Connection closed)
[07:43:24] *** Joins: avikpal_ (avikpal@moz-uki.cen.194.117.IP)
[07:43:33] *** Joins: sagg (sigg@moz-55rvi2.dclient.hispeed.ch)
[07:44:10] *** Quits: avikpal (avikpal@moz-bf3.3e4.194.117.IP) (Ping timeout: 121 seconds)
[07:48:23] *** Quits: avikpal_ (avikpal@moz-uki.cen.194.117.IP) (Ping timeout: 121 seconds)
[07:50:20] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[07:51:25] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[07:55:19] *** Joins: munksgaa1d (munksgaard@moz-urnkl5.u.parknet.dk)
[07:55:37] *** Quits: Kxepal832 (Miranda@moz-gg4j29.pppoe.mtu-net.ru) (Ping timeout: 121 seconds)
[07:55:43] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[07:55:57] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[07:57:39] *** Joins: Kxepal (Miranda@moz-pq39sj.pppoe.mtu-net.ru)
[08:06:34] *** Joins: Skyler (Skyler@moz-o6s2i2.fios.verizon.net)
[08:06:44] *** Joins: sugg (sigg@moz-55rvi2.dclient.hispeed.ch)
[08:06:58] *** Joins: genbattle (genbattle@moz-n5c2kc.xtra.co.nz)
[08:10:16] *** Quits: sagg (sigg@moz-55rvi2.dclient.hispeed.ch) (Ping timeout: 121 seconds)
[08:29:09] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[08:32:48] *** Joins: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP)
[08:33:31] <Manishearth> seanmonstar: reem http://stackoverflow.com/questions/29874844/trouble-building-rusts-hyper-crate
[08:33:58] *** Joins: johnz133 (johnz133@moz-tqd.4t0.72.208.IP)
[08:34:40] <reem> cargo update + old rust/cargo most likely
[08:36:26] *** Quits: SiegeLord (sl@moz-9jtaei.ca.comcast.net) (Quit: It's a joke, it's all a joke.)
[08:44:09] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[08:45:33] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[08:45:48] *** Joins: p1start (p1start@moz-nftjhe.org)
[08:50:06] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[08:51:57] *** Joins: larhat (Adium@moz-tb1ulb.cable.virginm.net)
[08:54:12] *** Joins: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net)
[08:56:19] *** Quits: genbattle (genbattle@moz-n5c2kc.xtra.co.nz) (Ping timeout: 121 seconds)
[09:01:41] *** Joins: genbattle (genbattle@moz-n5c2kc.xtra.co.nz)
[09:14:16] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[09:15:17] *** Joins: avikpal (avikpal@moz-ngd.ep4.194.117.IP)
[09:22:34] *** Quits: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com) (Ping timeout: 121 seconds)
[09:25:31] *** Joins: bluss (bluss@moz-ec5o68.cust.bredbandsbolaget.se)
[09:32:11] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[09:35:50] *** Quits: sugg (sigg@moz-55rvi2.dclient.hispeed.ch) (Ping timeout: 121 seconds)
[09:42:28] *** Quits: munksgaa1d (munksgaard@moz-urnkl5.u.parknet.dk) (Ping timeout: 121 seconds)
[09:44:22] *** Quits: avikpal (avikpal@moz-ngd.ep4.194.117.IP) (Ping timeout: 121 seconds)
[09:46:37] *** Joins: avikpal (avikpal@moz-3gg.9l2.194.117.IP)
[09:47:58] *** Quits: johnz133 (johnz133@moz-tqd.4t0.72.208.IP) (Quit: )
[09:49:52] *** Quits: larhat (Adium@moz-tb1ulb.cable.virginm.net) (Quit: Leaving.)
[09:52:41] *** Quits: avikpal (avikpal@moz-3gg.9l2.194.117.IP) (Ping timeout: 121 seconds)
[09:54:26] *** Joins: killercup (killercup@moz-edmf2j.dip0.t-ipconnect.de)
[10:05:59] *** Joins: avikpal (avikpal@moz-0i8.p8t.194.117.IP)
[10:06:41] *** Quits: genbattle (genbattle@moz-n5c2kc.xtra.co.nz) (Quit: Leaving)
[10:07:10] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[10:08:12] *** Joins: p1start (p1start@moz-nftjhe.org)
[10:10:50] *** Quits: avikpal (avikpal@moz-0i8.p8t.194.117.IP) (Ping timeout: 121 seconds)
[10:13:08] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[10:14:07] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[10:15:10] *** Joins: p1start (p1start@moz-nftjhe.org)
[10:20:47] *** Joins: munksgaard (munksgaard@moz-478pev.u.parknet.dk)
[10:26:14] *** Quits: Kingsquee (kingsley@moz-qq7ns6.bchsia.telus.net) (Quit: Konversation terminated!)
[10:29:59] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[10:30:02] *** Quits: aatch (james@moz-is4j4r.cable.telstraclear.net) (Ping timeout: 121 seconds)
[10:34:31] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[10:39:31] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[10:41:35] *** Joins: mdup (mdup@moz-53eisu.abo.wanadoo.fr)
[10:44:03] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[10:45:40] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[10:47:38] *** Quits: mdup (mdup@moz-53eisu.abo.wanadoo.fr) (Ping timeout: 121 seconds)
[10:56:42] *** Joins: avikpal (avikpal@moz-0cc.26a.227.117.IP)
[11:07:57] *** Joins: aepsil0n (eduard@moz-6491ha.mv2h.pepi.8071.2a02.IP)
[11:10:06] *** Joins: rkruppe_ (chatzilla@moz-3nj.rnu.131.95.IP)
[11:11:04] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[11:11:15] *** rkruppe_ is now known as rkruppe
[11:12:31] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[11:13:17] *** Joins: kushal (kdas@moz-brdadn.103.sitibroadband.in)
[11:15:49] *** Quits: kushal (kdas@moz-brdadn.103.sitibroadband.in) (Quit: Leaving)
[11:16:53] *** Joins: kushal (kdas@moz-brdadn.103.sitibroadband.in)
[11:20:15] *** Quits: killercup (killercup@moz-edmf2j.dip0.t-ipconnect.de) (Quit: My Mac has gone to sleep. ZZZzzz…)
[11:22:21] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[11:22:56] *** Quits: untitaker (untitaker@moz-no7a2d.highway.telekom.at) (Ping timeout: 121 seconds)
[11:23:56] *** Joins: untitaker (untitaker@moz-ajtar1.highway.telekom.at)
[11:24:33] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[11:25:05] *** Quits: avikpal (avikpal@moz-0cc.26a.227.117.IP) (Connection closed)
[11:26:11] *** Joins: tcurdt (tcurdt@moz-n9dsvp.dip0.t-ipconnect.de)
[11:29:09] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[11:32:36] *** Joins: rkruppe_ (chatzilla@moz-3nj.rnu.131.95.IP)
[11:33:03] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[11:33:14] *** rkruppe_ is now known as rkruppe
[11:37:28] *** Joins: casey (casey@moz-v0ns05.tpgi.com.au)
[11:37:31] *** Joins: avikpal (avikpal@moz-hk7.t39.233.117.IP)
[11:41:54] *** Quits: tcurdt (tcurdt@moz-n9dsvp.dip0.t-ipconnect.de) (Connection closed)
[11:43:23] *** Joins: tcurdt (tcurdt@moz-n9dsvp.dip0.t-ipconnect.de)
[11:43:25] *** Quits: tcurdt (tcurdt@moz-n9dsvp.dip0.t-ipconnect.de) (Quit: Textual IRC Client: www.textualapp.com)
[11:43:38] *** Joins: killercup (killercup@moz-edmf2j.dip0.t-ipconnect.de)
[11:43:46] *** Quits: killercup (killercup@moz-edmf2j.dip0.t-ipconnect.de) (Quit: My Mac has gone to sleep. ZZZzzz…)
[11:45:10] *** Joins: larhat (Adium@moz-tb1ulb.cable.virginm.net)
[11:45:59] *** Joins: ytain (ytain@moz-ge9fgi.dsl.teksavvy.com)
[11:47:58] *** Joins: killercup (killercup@moz-edmf2j.dip0.t-ipconnect.de)
[11:48:36] *** Joins: munksgaa1d (munksgaard@moz-urnkl5.u.parknet.dk)
[11:50:30] *** Quits: avikpal (avikpal@moz-hk7.t39.233.117.IP) (Connection closed)
[11:51:01] *** Joins: avikpal (avikpal@moz-hk7.t39.233.117.IP)
[11:51:16] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[11:51:34] *** Quits: munksgaard (munksgaard@moz-478pev.u.parknet.dk) (Ping timeout: 121 seconds)
[11:53:30] *** Quits: casey (casey@moz-v0ns05.tpgi.com.au) (Ping timeout: 121 seconds)
[11:53:52] *** Joins: casey (casey@moz-8t3.37l.160.167.IP)
[11:55:32] *** Joins: casey_ (casey@moz-v0ns05.tpgi.com.au)
[11:57:03] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[11:57:07] *** Joins: rkruppe_ (chatzilla@moz-3nj.rnu.131.95.IP)
[11:57:09] *** rkruppe_ is now known as rkruppe
[11:57:14] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[11:57:40] *** Quits: p1start (p1start@moz-nftjhe.org) (Ping timeout: 121 seconds)
[11:58:54] *** Quits: casey (casey@moz-8t3.37l.160.167.IP) (Ping timeout: 121 seconds)
[12:12:53] *** Joins: squiddy (squiddy@moz-lidofh.dyn.telefonica.de)
[12:15:21] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[12:23:43] *** Quits: avikpal (avikpal@moz-hk7.t39.233.117.IP) (Connection closed)
[12:23:59] *** Joins: avikpal (avikpal@moz-hk7.t39.233.117.IP)
[12:24:43] *** Quits: larhat (Adium@moz-tb1ulb.cable.virginm.net) (Quit: Leaving.)
[12:30:33] *** Joins: eibwen (eibwen@moz-8528ue.dip0.t-ipconnect.de)
[12:31:21] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[12:35:45] *** casey_ is now known as casey
[12:37:18] *** Joins: imperio (Mibbit@moz-8otf3a.fbx.proxad.net)
[12:38:21] *** Joins: cengizIO (textual@moz-jju.ckp.250.151.IP)
[12:39:01] *** Parts: cengizIO (textual@moz-jju.ckp.250.151.IP) ("Textual IRC Client: www.textualapp.com")
[12:40:50] *** Joins: rkruppe_ (chatzilla@moz-3nj.rnu.131.95.IP)
[12:42:03] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[12:42:15] *** rkruppe_ is now known as rkruppe
[12:45:18] *** Joins: O01eg (o01eg@moz-i0qbdp.2u5i.3egh.2698.2a02.IP)
[12:47:05] *** Quits: avikpal (avikpal@moz-hk7.t39.233.117.IP) (Connection closed)
[12:48:35] *** Quits: hyunsik (hyunsik@moz-3qgjl9.ca.comcast.net) (Ping timeout: 121 seconds)
[12:49:50] *** Quits: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net) (Ping timeout: 121 seconds)
[12:50:37] *** Quits: casey (casey@moz-v0ns05.tpgi.com.au) (Connection closed)
[12:50:59] *** Joins: casey (casey@moz-v0ns05.tpgi.com.au)
[12:55:01] *** Quits: casey (casey@moz-v0ns05.tpgi.com.au) (Ping timeout: 121 seconds)
[12:58:35] *** Joins: avikpal (avikpal@moz-i0g.ghv.233.117.IP)
[13:03:13] *** Joins: rkruppe_ (chatzilla@moz-3nj.rnu.131.95.IP)
[13:04:17] *** Quits: Skyler (Skyler@moz-o6s2i2.fios.verizon.net) (Client exited)
[13:04:25] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[13:04:37] *** rkruppe_ is now known as rkruppe
[13:11:55] <SimonSapin> Is rustc built with --enable-debug (but not --disable-optimize !) supposed to be orders of magnitude slower?
[13:16:36] *** Joins: annodomini (lambda@moz-qgii5v.ma.comcast.net)
[13:17:22] <huon> SimonSapin: I recall there was a bug that made enable-debug imply disable-optimise
[13:17:35] <SimonSapin> ah, that would explain it
[13:17:38] <huon> I think pnkfelix had a patch fixing it recently
[13:18:15] <Manishearth> Anyone around who understands librustc_trans?
[13:18:26] <huon> what part? (I have 5 minutes)
[13:20:00] <huon> Manishearth: ^
[13:20:45] <Manishearth> huon: drop_glue
[13:20:52] <Manishearth> it seems to be called even when drops aren't needed
[13:21:03] <huon> that's whta zeroing/filling does
[13:21:31] <Manishearth> huon: 
[13:21:33] <Manishearth> https://gist.github.com/Manishearth/d979a33024a22173c241
[13:22:07] <Manishearth> huon: refresh that
[13:22:42] <Manishearth> huon: I want to hack linear types into Rust, any way to hook into the part where a call to drop() actually gets inserted?
[13:23:14] <huon> the drop glue is wrapped in an implicit `if flag != FILLING_BYTE { ... }`
[13:23:45] <huon> and a move will fill the variable with FILLING_BYTE
[13:23:50] <Manishearth> bah humbug
[13:24:02] <Manishearth> so it actually happens at runtime?
[13:24:15] <Manishearth> that's a bummer
[13:24:32] <Manishearth> huon: I assume a better solution would be to hook into librustc_borrowck somewhere?
[13:24:50] * Manishearth wonders when the drop flag and other magic will go away
[13:24:58] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[13:24:58] <huon> the whole zeroing -> filling change was intended as future proofing so we can move to actually using the static analysis properly
[13:25:05] <Manishearth> kay
[13:25:06] <huon> cf. the dynamic drop RFC(s) too
[13:25:31] <huon> and yes, you'll presumably want the semantic analysis, which happens before trans
[13:25:36] <Manishearth> yeah, have seen those
[13:25:47] <huon> (not sure if it's borrowck or somewhere else)
[13:25:47] <Manishearth> huon: any idea where I should look? borrowck is huge and confusing
[13:25:57] <huon> anyway gtg, hope that helped slightly :)
[13:26:14] <Manishearth> I have https://github.com/Manishearth/humpty_dumpty, but that's basically an approximate solution
[13:26:17] <Manishearth> thanks
[13:28:29] *** Joins: chc4 (chc4@moz-pdo0at.ma.comcast.net)
[13:45:12] *** Quits: ytain (ytain@moz-ge9fgi.dsl.teksavvy.com) (Quit: Textual IRC Client: www.textualapp.com)
[13:46:30] *** Joins: ytain (ytain@moz-ge9fgi.dsl.teksavvy.com)
[13:51:14] *** Joins: casey (casey@moz-v0ns05.tpgi.com.au)
[13:54:34] *** Joins: Diggsey (diggsey@moz-o8tmhf.dsl.pipex.com)
[13:55:17] *** Quits: casey (casey@moz-v0ns05.tpgi.com.au) (Ping timeout: 121 seconds)
[13:55:41] *** Joins: ptalbot (ptalbot@moz-g2mokk.ircam.fr)
[14:01:13] *** Quits: semarie (semarie@moz-vo7ult.telostor.ca) (Quit: WeeChat 1.1)
[14:01:38] <simukis> by the way, I saw we got another subpackage
[14:01:41] *** Joins: willem (willem@moz-facs2s.dynamic.upc.nl)
[14:01:43] <simukis> rustc_data_structures
[14:01:58] <simukis> in haskell we usually name these `*_types`. More concise.
[14:02:24] <simukis> oh wait
[14:02:24] <simukis> no
[14:03:31] * simukis scrubs last 5 messages with sandpaper
[14:03:31] *** Joins: avikpal_ (avikpal@moz-t0f.4af.194.117.IP)
[14:04:26] *** Quits: avikpal (avikpal@moz-i0g.ghv.233.117.IP) (Ping timeout: 121 seconds)
[14:06:43] *** Joins: semarie (semarie@moz-829.vnk.70.166.IP)
[14:06:48] *** Quits: semarie (semarie@moz-829.vnk.70.166.IP) (Quit: WeeChat 1.1)
[14:08:19] *** Joins: avikpal (avikpal@moz-s9h.ep4.194.117.IP)
[14:08:28] *** Quits: avikpal_ (avikpal@moz-t0f.4af.194.117.IP) (Ping timeout: 121 seconds)
[14:15:46] *** Joins: semarie (semarie@moz-829.vnk.70.166.IP)
[14:19:59] *** Quits: mceier (mceier@moz-fm89sb.dynamic.chello.pl) (Quit: leaving)
[14:20:16] *** Quits: avikpal (avikpal@moz-s9h.ep4.194.117.IP) (Ping timeout: 121 seconds)
[14:21:34] *** Joins: avikpal (avikpal@moz-opm.mpm.194.117.IP)
[14:27:29] *** Joins: avikpal_ (avikpal@moz-u4s.cra.194.117.IP)
[14:28:29] *** Quits: avikpal (avikpal@moz-opm.mpm.194.117.IP) (Ping timeout: 121 seconds)
[14:32:10] *** Quits: willem (willem@moz-facs2s.dynamic.upc.nl) (Quit: leaving)
[14:33:46] *** Joins: michalt (uid82910@moz-7jrol4.charlton.irccloud.com)
[14:35:28] *** Joins: avikpal (avikpal@moz-7kj.0pm.194.117.IP)
[14:36:35] *** Quits: avikpal_ (avikpal@moz-u4s.cra.194.117.IP) (Ping timeout: 121 seconds)
[14:36:38] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[14:37:50] *** Joins: jdm (jdm@moz-ilbt2e.cable.teksavvy.com)
[14:39:27] *** Quits: marsel (user@moz-rrv.pek.234.188.IP) (Ping timeout: 121 seconds)
[14:40:18] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[14:40:57] *** Joins: avikpal_ (avikpal@moz-8lj.hfh.194.117.IP)
[14:41:25] *** Quits: avikpal (avikpal@moz-7kj.0pm.194.117.IP) (Ping timeout: 121 seconds)
[14:42:02] <steveklabnik> acrichto: ping
[14:44:59] *** Quits: avikpal_ (avikpal@moz-8lj.hfh.194.117.IP) (Ping timeout: 121 seconds)
[14:45:38] *** Joins: avikpal (avikpal@moz-1k5.6lo.194.117.IP)
[14:46:59] *** Joins: tamird (textual@moz-40e.n0o.141.50.IP)
[14:52:35] *** Quits: avikpal (avikpal@moz-1k5.6lo.194.117.IP) (Ping timeout: 121 seconds)
[14:55:38] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[15:03:52] *** Joins: avikpal (avikpal@moz-u6s.0pm.194.117.IP)
[15:04:25] *** Quits: tamird (textual@moz-40e.n0o.141.50.IP) (Quit: My Mac has gone to sleep. ZZZzzz…)
[15:09:46] *** Joins: larhat (Adium@moz-tb1ulb.cable.virginm.net)
[15:12:10] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[15:12:26] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[15:12:36] <filsmick> am I forced to use String as a key in a HashMap if the keys are only known after the map is created?
[15:12:45] <filsmick> (instead of &str)
[15:14:14] *** Quits: avikpal (avikpal@moz-u6s.0pm.194.117.IP) (Connection closed)
[15:14:35] *** Joins: mceier (mceier@moz-fm89sb.dynamic.chello.pl)
[15:16:14] <simukis> Pretty much yes. &str would need to have lifetime greater than hashmap itself, so you could have HashMap+'hashmap which is keyed by &'a str where 'a: 'hashmap
[15:16:27] <simukis> but that’s a very unreasonable thing to do
[15:16:47] <filsmick> mmh, I see, thanks!
[15:17:03] <filsmick> by the way, sorry for posting in the wrong channel, I thought I was on #rust
[15:18:55] <simukis> filsmick: you could use Cow string
[15:19:19] <filsmick> simukis: to avoid the extra alloc in case I *do* know what the string is before the map is created?
[15:19:27] <simukis> yes
[15:21:25] *** Joins: willem (willem@moz-facs2s.dynamic.upc.nl)
[15:29:00] *** Joins: simias (simias@moz-hesd72.svkt.org)
[15:36:23] *** Joins: avikpal (avikpal@moz-i0g.ghv.233.117.IP)
[15:38:41] *** Quits: rovar (rovar@moz-96effg.dyn.optonline.net) (Ping timeout: 121 seconds)
[15:39:09] *** Joins: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com)
[15:42:00] <simias> is there a way to specify soft-float in the target.json?
[15:45:17] *** Quits: bdero (bran@moz-216hqv.oo5r.e4su.0006.2601.IP) (Ping timeout: 121 seconds)
[15:46:02] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[15:46:26] *** Joins: bdero (bran@moz-216hqv.oo5r.e4su.0006.2601.IP)
[15:47:34] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[15:47:44] *** Joins: sigma (sigma@moz-ohog4c.range86-135.btcentralplus.com)
[15:48:09] *** Quits: Thorn (Thorn@moz-gfo.20c.107.217.IP) (Quit: Quit)
[15:50:50] *** Joins: rovar (rovar@moz-96effg.dyn.optonline.net)
[15:52:29] *** Quits: bdero (bran@moz-216hqv.oo5r.e4su.0006.2601.IP) (Ping timeout: 121 seconds)
[15:53:28] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Quit: )
[15:55:03] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[16:04:28] *** Joins: bdero (bran@moz-qlq.gl9.56.172.IP)
[16:08:52] <steveklabnik> erickt: ping
[16:09:03] <erickt> steveklabnik: pong
[16:09:17] <steveklabnik> mind releasing a serde to crates.io? since it's broken for nightly
[16:09:20] <steveklabnik> you merged a fix two days ago
[16:14:37] *** Joins: tamird (textual@moz-oii9i6.ca.comcast.net)
[16:17:39] <erickt> steveklabnik: I'm working on it right now :)
[16:17:43] <steveklabnik> woot
[16:17:46] <steveklabnik> thanks :)
[16:17:51] *** Joins: Thorn (Thorn@moz-gfo.20c.107.217.IP)
[16:17:57] <steveklabnik> i'm about to go away for a few hours, so no rush :)
[16:18:04] <steveklabnik> first time trying it out, i'm pumped
[16:21:31] *** Quits: bdero (bran@moz-qlq.gl9.56.172.IP) (Ping timeout: 121 seconds)
[16:24:14] *** Quits: tamird (textual@moz-oii9i6.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[16:24:30] *** Joins: tamird (textual@moz-oii9i6.ca.comcast.net)
[16:25:09] <erickt> steveklabnik: woohoo!
[16:25:32] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[16:26:22] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[16:27:05] <erickt> steveklabnik: it's been released
[16:28:53] *** Joins: frogmella (Mibbit@moz-juv.9o3.252.72.IP)
[16:40:59] *** Quits: avikpal (avikpal@moz-i0g.ghv.233.117.IP) (Connection closed)
[16:41:29] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Quit: )
[16:56:43] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[17:02:51] <acrichto> steveklabnik: pong
[17:02:56] *** Quits: burntsushi (burntsushi@moz-t92kn9.ma.charter.com) (Quit: Konversation terminated!)
[17:04:29] *** Joins: burntsushi (burntsushi@moz-t92kn9.ma.charter.com)
[17:09:46] <bluss> erickt: do you know if it's possible to put both serde and serde_macros under an optional feature flag called "serde" using cargo?
[17:09:58] <bluss> because that's the natural feature name
[17:10:45] <Manishearth> acrichto: around?
[17:10:55] <acrichto> Manishearth: yes!
[17:10:58] <Manishearth> do rvalues get moved in memory?
[17:11:15] <Manishearth> eg if foo() returns non-Copy Foo
[17:11:19] <erickt> bluss: hm
[17:11:20] <acrichto> not sure I know enough about rvalues to answer that
[17:11:29] <Manishearth> and I do bar(foo()), will the rvalue get moved around?
[17:11:43] <Manishearth> same for let x = foo()
[17:11:51] <acrichto> that'd probably involve diving into trans
[17:11:57] <Manishearth> aw
[17:12:04] <erickt> bluss: I think so? I think https://github.com/sfackler/rust-postgres/blob/master/Cargo.toml is doing that somehow
[17:12:05] <simukis> I can check it :)
[17:12:05] <Manishearth> is there someone who would know the answer? :<
[17:12:15] <simukis> if you give me some code which you suspect would be moving
[17:12:19] <Manishearth> I'm not fond of diving into trans, I understand very little of it :p
[17:12:28] <acrichto> Manishearth: someone who works closely in trans would probably know
[17:12:33] <Manishearth> simukis: how about bar(foo())
[17:12:58] <Manishearth> foo() is some function returning Foo. Is there a possibility of an in-memory move?
[17:13:01] <bluss> erickt: doesn't seem to mention serde_macros
[17:13:44] <sfackler> bluss: you can't do that unfortunately
[17:13:59] <sfackler> I have a semi-abandoned pr sitting on the Cargo repo that would let ou do that
[17:14:10] <sfackler> but haven't figured out how to get it in without breaking the world
[17:14:17] <acrichto> Manishearth: bar(foo()) does not copy
[17:14:21] <acrichto> Manishearth: (taking a look at the IR)
[17:14:23] <Manishearth> acrichto: woohoo
[17:14:48] <bluss> sfackler: aha
[17:15:14] <simukis> I see no moves either
[17:16:08] <simukis> Manishearth: at least for NonCopy(u64, u64) it returns the value via out pointer
[17:16:13] <simukis> which is why there’s no move
[17:17:27] <Manishearth> simukis: coolio
[17:18:10] <simukis> I wouldn’t dare guarantee this happens for all possible types, though
[17:20:38] *** Quits: jdm (jdm@moz-ilbt2e.cable.teksavvy.com) (Connection closed)
[17:20:50] *** Joins: jdm (jdm@moz-ilbt2e.cable.teksavvy.com)
[17:21:14] <sfackler> acrichto: is "rust1" still the feature to use for things to stabilize for 1.1.0?
[17:21:42] *** Quits: summerlight_ (summerlight@moz-99k.2mj.130.121.IP) (Ping timeout: 121 seconds)
[17:21:42] <Manishearth> simukis: aw
[17:21:51] <Manishearth> simukis: what sort of situation would this be dubious?
[17:22:00] <Manishearth> I don't particularly care about trait objects here
[17:23:49] <simukis> Manishearth: it will move for NonCopy(u64) and other trivial types
[17:24:15] *** Quits: Rusky (russell@moz-pob0l8.slkc.qwest.net) (Ping timeout: 121 seconds)
[17:25:41] <acrichto> sfackler: nah everything should get a new feature name now
[17:26:12] <acrichto> sfackler: there's also a lint check to ensure that a feature is only stable since one version number
[17:26:37] <sfackler> oh okay
[17:27:01] <sfackler> so basically just change #[unstable(feature="foo", reason = "bar")] to #[stable(feature="foo", since="1.1.0")]?
[17:31:34] <acrichto> sfackler: yeah
[17:33:19] *** Quits: sigma (sigma@moz-ohog4c.range86-135.btcentralplus.com) (Ping timeout: 121 seconds)
[17:35:55] *** Joins: GBGamer (npm@moz-92sbjt.wa.comcast.net)
[17:36:26] *** Quits: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com) (Ping timeout: 121 seconds)
[17:38:19] *** Joins: avikpal (avikpal@moz-i46.i7f.227.117.IP)
[17:42:47] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[17:44:37] *** Joins: Rusky (russell@moz-pob0l8.slkc.qwest.net)
[17:46:59] *** Joins: brson (brson@moz-jsd.7vl.56.172.IP)
[17:46:59] *** ChanServ sets mode: +o brson
[17:50:42] *** Quits: rcxdude (rcxdude@moz-b5a5f3.cable.virginm.net) (Quit: Konversation terminated!)
[17:51:29] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[17:57:30] <SimonSapin> Can I move something out of a Box?
[17:58:28] <SimonSapin> https://www.reddit.com/r/rust/comments/33tk1a/crossreferences/cqp1cb4
[17:58:52] *** Quits: squiddy (squiddy@moz-lidofh.dyn.telefonica.de) (Quit: Leaving)
[17:58:52] <SimonSapin> Does Box have a magic impl for a DerefMove trait that doesn’t exist yet?
[17:59:06] <sfackler> i believe it does yeah
[17:59:20] <simukis> Box is a lang item
[17:59:38] <simukis> so it is special in many ways
[18:02:18] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[18:02:21] <Manishearth> SimonSapin: Box is ty_uniq and magical
[18:06:32] *** Joins: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com)
[18:06:32] *** ChanServ sets mode: +o acrichto
[18:06:58] *** Quits: tamird (textual@moz-oii9i6.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[18:10:02] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Quit: )
[18:10:03] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[18:10:15] <GBGamer> why is pattern matching a part of core?
[18:11:32] <simukis> GBGamer: what do you mean by “core”?
[18:11:40] <GBGamer> simukis: libcore
[18:11:54] <simukis> it is a language feature.
[18:11:55] <GBGamer> just curious
[18:12:10] <sfackler> do you mean pattern matching with box or slices?
[18:12:16] <klutzy> maybe you're hitting both features `core` and `slicing_patterns`
[18:12:23] <GBGamer> Oh, sorry, str patting matching
[18:12:37] <GBGamer> str/pattern.rs
[18:12:44] <simukis> sigh -.-
[18:12:48] <GBGamer> the string Pattern API
[18:12:49] *** Quits: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com) (Ping timeout: 121 seconds)
[18:13:19] <GBGamer> sorry for the unclarity ::
[18:13:21] <sfackler> that's in core because it can be
[18:13:28] <sfackler> doesn't require allocation etc
[18:13:40] <GBGamer> ah, okay
[18:13:48] <GBGamer> I guess I'll just rip it out then
[18:13:58] <sfackler> why?
[18:14:11] <GBGamer> because it's not required for me
[18:14:28] <GBGamer> And I'm already making libcore nopanic, so why leave it in?
[18:14:40] <GBGamer> if I need it later, I can always get it
[18:15:33] <GBGamer> right now, tho, it just adds to compilation time
[18:16:03] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[18:16:07] *** Joins: SiegeLord (sl@moz-9jtaei.ca.comcast.net)
[18:16:24] <GBGamer> ah wait, no, ugh, I gotta keep it in :/
[18:16:41] <GBGamer> because Lines has a thing on it
[18:16:44] *** Quits: annodomini (lambda@moz-qgii5v.ma.comcast.net) (Client exited)
[18:20:56] *** Joins: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP)
[18:23:14] *** Quits: aepsil0n (eduard@moz-6491ha.mv2h.pepi.8071.2a02.IP) (Ping timeout: 121 seconds)
[18:23:26] <GBGamer> I'll just rip out Searcher
[18:25:24] <simias> this is silly: if I give a relative path to a target.json in --target=... then rustc will complain if the relative paths are not the same
[18:25:38] <simias> even if both paths actually point to the same file
[18:26:12] <cMR> yes, there's an issue open about this.
[18:26:14] *** Joins: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com)
[18:26:14] *** ChanServ sets mode: +o acrichto
[18:26:19] <cMR> although I thought I had fixed it...
[18:26:34] <cMR> the solution is to just not care about the targets and let them mismatch.
[18:26:43] *** Joins: tamird (textual@moz-oii9i6.ca.comcast.net)
[18:27:00] <cMR> at least as far as I'm concerned; if you're using target specs you deserve what you get if you change them :)
[18:27:11] <brson> r? https://github.com/rust-lang/rust-www/pull/116
[18:27:29] <simias> cMR: agreed
[18:27:54] *** Joins: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP)
[18:27:56] <cMR> brson: (I assume bors doesn't actually watch that repo)
[18:28:25] <brson> cMR: no
[18:28:31] <doener> does changing intrinsics require an RFC?
[18:29:08] <doener> specifically, exposing the "zero is undefined" flags for cttz and ctlz (count trailing/leading zeros)
[18:29:25] <brson> doener: possibly not. they're gated
[18:29:47] <brson> you might start with a pr since it's easy and hope nobody asks for an rfc
[18:29:57] <GBGamer> KallDrexx: from(s)
[18:29:58] *** Joins: aepsil0n (eduard@moz-6491ha.mv2h.pepi.8071.2a02.IP)
[18:30:19] <GBGamer> Sorry, I'm on two things at once and I screwed up
[18:30:29] *** Quits: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com) (Ping timeout: 121 seconds)
[18:32:37] <simias> cMR: although I suppose that the better way would be to store a hash of the relevant target setting and match against it?
[18:32:51] *** Joins: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com)
[18:32:51] *** ChanServ sets mode: +o acrichto
[18:33:14] <frewsxcv> is there a changelog for beta 3 somewhere?
[18:34:20] <cMR> simias: I don't think it's worthwhile.
[18:35:16] *** Quits: swgillespie (swgillespie@moz-rn1.vmq.232.104.IP) (Quit: My MacBook Pro has gone to sleep. ZZZzzz…)
[18:37:49] <brson> frewsxcv: no
[18:39:08] *** Quits: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com) (Ping timeout: 121 seconds)
[18:39:14] <simias> cMR: fair enough
[18:41:09] <brson> frewsxcv: this PR has most of the changes https://github.com/rust-lang/rust/pull/24708
[18:41:22] <frewsxcv> ah, thanks brson 
[18:41:59] * frewsxcv opened an issue about a missing git tag https://github.com/rust-lang/rust/issues/24845
[18:43:47] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Ping timeout: 121 seconds)
[18:44:10] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Connection closed)
[18:44:20] <brson> we're not going to tag incremental betas. that would add up to a tag every week. perhaps people want to tag the 1.0 betas
[18:44:37] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[18:44:50] <brson> betas aren't releases
[18:44:50] <frewsxcv> ah okay, ill close then
[18:45:46] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Connection closed)
[18:45:47] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[18:46:54] *** Joins: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com)
[18:46:54] *** ChanServ sets mode: +o acrichto
[18:50:27] <doener> kimundi: gh24846
[18:50:28] <[o__o]> Work around poor codegen for cttz8 with defined results for zero: https://github.com/rust-lang/rust/pull/24846
[18:50:35] <doener> kimundi: thanks for the benchmark!
[18:51:09] *** Quits: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com) (Ping timeout: 121 seconds)
[18:51:19] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[18:51:43] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[18:52:33] *** Joins: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com)
[18:52:33] *** ChanServ sets mode: +o acrichto
[18:57:01] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Connection closed)
[18:57:18] <simukis> is it really something worth fixing in rust instead of LLVM?
[18:57:23] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[18:57:44] *** Quits: aepsil0n (eduard@moz-6491ha.mv2h.pepi.8071.2a02.IP) (Connection closed)
[18:58:35] <cMR> simukis: what do you mean "fix"? llvm already exposes the flag..
[18:59:15] <simukis> llvm emits 2 branches where 1 would suffice
[18:59:36] <simukis> that is, we suddenly get better results by reimplementing an intrinsic which does the same thing ourselves
[18:59:59] <cMR> oh I see
[19:00:27] <bluss> brson: the beta.3 docs doesn't have the Deref section for String, Vec etc
[19:00:44] *** Quits: brson (brson@moz-jsd.7vl.56.172.IP) (Ping timeout: 121 seconds)
[19:02:25] *** Quits: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net) (Client exited)
[19:03:06] <simukis> I’m completely fine with landing the part where intrinsics are made more universal by adding a flag
[19:03:11] <simukis> …, though
[19:04:11] <doener> simukis: should be fixed upstream, but until then, I think having the workaround is fine
[19:04:32] <simukis> doener: should totally include a FIXME comment then 😉
[19:04:46] <doener> oh, did I forget that? I intended to have that
[19:05:58] *** Quits: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com) (Ping timeout: 121 seconds)
[19:06:27] <doener> simukis: FIXME added, thanks!
[19:06:34] *** Joins: acrichto (acrichto@moz-u3dg2t.sfo1.mozilla.com)
[19:06:34] *** ChanServ sets mode: +o acrichto
[19:07:11] <simukis> while we’re at that, I want to share with a related comic I found to be funnily accurate when I read it: http://www.commitstrip.com/en/page/13/
[19:08:34] <doener> heh
[19:12:18] *** Quits: avikpal (avikpal@moz-i46.i7f.227.117.IP) (Ping timeout: 121 seconds)
[19:13:34] <kimundi> doener: Wow, thanks! That fix really seems to do a difference for those benchmarks.
[19:14:29] *** Joins: laumann (thomas@moz-n9e72h.0.fullrate.dk)
[19:17:42] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Connection closed)
[19:17:43] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[19:19:59] *** Joins: avikpal (avikpal@moz-ud2.taa.249.117.IP)
[19:22:06] <kimundi> doener: Btw, I think I tested whether performance difference also happens if calling the u32 instead of the u8 version of those intrisics
[19:22:33] <kimundi> doener: So it might be a general problem with the trailing zeroes instrinsics, not just the one for u8
[19:23:39] *** Joins: Astrum|Lap (Astrum|Lap@moz-skcefh.co.comcast.net)
[19:25:09] *** Joins: brson (brson@moz-jsd.7vl.56.172.IP)
[19:25:09] *** ChanServ sets mode: +o brson
[19:25:31] <doener> kimundi: how did you check?
[19:25:56] <kimundi> doener: I changed my benchmarks to cast the u8 to a u32 before calling trailing/leading zero
[19:26:08] *** Quits: jdm (jdm@moz-ilbt2e.cable.teksavvy.com) (Quit: )
[19:26:22] <doener> kimundi: so it's never actually called with 0?
[19:26:53] <kimundi> doener: Not in the algorithm, but in one of the testcases
[19:28:27] <kimundi> doener: To be exact, I changed the code to cast from u8 to u32, adjusted the calculations to work with 32 instead of 8, and added an explicit n == 0 guard before the actual call
[19:30:42] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Connection closed)
[19:30:48] <doener> kimundi: I'd assume that part of the speed up is due to better branch prediction then. On top of having reduced the number of checks and dependencies between the instructions
[19:31:19] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[19:31:22] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Connection closed)
[19:31:22] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[19:32:08] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Connection closed)
[19:32:49] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[19:35:06] *** Joins: simukis1 (nagisa@moz-8t068g.static.zebra.lt)
[19:35:34] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[19:36:29] <doener> kimundi: using "if a == b { 8 } else { ... }" takes 6911490 with u8 and only 5711759 with the u16/u32. 
[19:38:03] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[19:38:40] *** Joins: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP)
[19:38:59] *** Quits: kushal (kdas@moz-brdadn.103.sitibroadband.in) (Ping timeout: 121 seconds)
[19:39:23] <kimundi> doener: u32 is faster for me as well, but the difference is still at least 20%, compared to the 3% your benchmark results show after your fix
[19:40:21] <kimundi> I get 10656286 / 14478395 / 12966724 for C++ / Rust naive / Rust unsafe with calling the u32 functions
[19:41:20] <doener> kimundi: because they still have a conditional move, which should, AFAUI, be better in the average case, but is worse in this specific benchmark, because it's always non-zero so branch prediction is easy
[19:42:33] <doener> kimundi: this benchmark really wants the intrinsic that is undefined for zero. But trailing_zeros is safe for zero so there is some overhead.
[19:42:42] <kimundi> Hm, thats black magic for me. :) So, is emitting a conditional move right or wrong for these specific functions in general?
[19:43:12] <doener> AIUI cmov is the better choice for the general purpose function on modern CPUs
[19:44:47] <kimundi> hm, so emitting a manual branch there would not really be a general fix, but just be something that imrpoves this benchamrk but might make others worse?
[19:45:02] *** Quits: semarie (semarie@moz-829.vnk.70.166.IP) (A TLS packet with unexpected length was received.)
[19:45:13] *** Joins: rkruppe_ (chatzilla@moz-3nj.rnu.131.95.IP)
[19:45:17] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[19:45:22] *** rkruppe_ is now known as rkruppe
[19:45:42] *** Quits: ptalbot (ptalbot@moz-g2mokk.ircam.fr) (Ping timeout: 121 seconds)
[19:46:20] <doener> the PR effectively replaces two dependent conditional moves with a single branch, that should be better on average. But ideally, LLVM gets improved to emit only a single conditional move there
[19:47:05] <kimundi> doener: Ah okay, so there is a bug, the fix is just not the best possible one?
[19:47:15] *** Joins: rkruppe_ (chatzilla@moz-3nj.rnu.131.95.IP)
[19:48:42] <doener> kimundi: yep. And your benchmark likes that fix a lot, but ideally you would have access to the cttz that just treats zero as undefined, without any further checks.
[19:49:49] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[19:49:55] *** rkruppe_ is now known as rkruppe
[19:51:56] *** Quits: avikpal (avikpal@moz-ud2.taa.249.117.IP) (Ping timeout: 121 seconds)
[19:58:12] *** Joins: avikpal (avikpal@moz-ffu.1he.251.117.IP)
[20:01:50] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[20:02:50] *** Joins: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP)
[20:04:20] *** Joins: gamma123 (Mibbit@moz-5c6ngk.cable.virginm.net)
[20:07:41] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[20:07:49] <gamma123> heya, can anyone mention which path "cargo build" downloads a projects dependencies to in windows please.
[20:10:08] *** Quits: brson (brson@moz-jsd.7vl.56.172.IP) (Quit: leaving)
[20:10:44] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Connection closed)
[20:10:45] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[20:12:44] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Connection closed)
[20:13:15] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[20:15:25] *** Quits: laumann (thomas@moz-n9e72h.0.fullrate.dk) (Quit: leaving)
[20:15:28] *** Quits: avikpal (avikpal@moz-ffu.1he.251.117.IP) (Quit: )
[20:15:32] <reem> gamma123: maybe better luck in #cargo?
[20:16:50] <GBGamer> anybody know where division is defined to panic in the code?
[20:17:00] <GBGamer> I'd like to make it UB in my own code
[20:17:19] <GBGamer> (which, of course, I'll define myself)
[20:19:00] <reem> looks like there’s some weirdness, since Div is implemented as self / other for primitives, which would normally be circular
[20:20:04] <GBGamer> reem: yeah...
[20:20:19] <GBGamer> urgh, Rust doesn't make it very easy to write kernels
[20:20:47] <GBGamer> but once I get past this, it should be much better than C
[20:20:59] <reem> rust doesn’t make it very easy to rip out the entirety of the std + core libraries :P
[20:21:07] <GBGamer> no it really doesn't
[20:21:08] *** Joins: untitaker_ (untitaker@moz-d47ul3.highway.telekom.at)
[20:21:10] <reem> but at least you *can* do it
[20:21:17] <GBGamer> yeah you can
[20:21:23] <GBGamer> I'm very thankful for it :)
[20:21:31] <reem> I also suspect this is an area which will see some attention in the future, and will be a lot easier to do down the line.
[20:21:34] *** Joins: avikpal (avikpal@moz-ffu.1he.251.117.IP)
[20:21:35] <geofft> GBGamer: maybe this is a tangent, but I'm curious why you're doing this instead of turning panic!() into kernel oops/panic? 
[20:21:53] <GBGamer> geofft: because I don't want core to panic
[20:22:00] <reem> GBGamer: Causing UB seems worse
[20:22:25] <geofft> I mean... even in normal userspace non-weird-stuff Rust code, you're supposed to write code that never panics 
[20:22:27] <GBGamer> I want to get that error in the kernel, and then decide whether or not to panic
[20:22:42] <geofft> and use checked arithmetic, not call unwrap, etc. 
[20:22:49] *** Quits: untitaker (untitaker@moz-ajtar1.highway.telekom.at) (Ping timeout: 121 seconds)
[20:22:58] <richo> http://internals.rust-lang.org/t/stabilising-formatter-flags/1927/3 never really went anywhere, but I have some time off work and I was planning to work on it. Does anyone have feelings? If not, I've had some time to think, so I'll imlpement something reasonable looking and PR
[20:23:01] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[20:23:14] *** Quits: kmcguire (kmcguire@moz-c955nf.res.rr.com) (Connection closed)
[20:23:15] <GBGamer> reem: I may just cut out integer division based on compiler intrinsics entirely then
[20:23:43] <geofft> there's also always the approach of "wrapping" integer division 
[20:23:56] *** Joins: Kingsquee (kingsley@moz-qq7ns6.bchsia.telus.net)
[20:24:04] <geofft> i.e., UINT_MIN / -1 is well-defined to something, even if it's semantically not what you want 
[20:24:08] <GBGamer> how would I do that so it never panics
[20:24:20] *** Joins: kmcguire (kmcguire@moz-c955nf.res.rr.com)
[20:24:38] <geofft> GBGamer: https://doc.rust-lang.org/std/primitive.i64.html#method.wrapping_div 
[20:24:40] <GBGamer> (and simply returns, say, None)
[20:25:06] <geofft> which is what Wrapping<i64>'s division operator does, I believe 
[20:25:09] <sfackler> richo: I'd just add methods directly to Formatter, personally: Formatter::is_alternate() etc since stuff like precision and alignment is already there
[20:25:22] <geofft> GBGamer: alternatively, https://doc.rust-lang.org/std/primitive.i64.html#method.checked_div 
[20:26:01] <geofft> hm, is there no Checked<T> trait? 
[20:26:20] <sfackler> richo: and it's somewhat of an implementation detail that there's this seprate flags field instead of a bunch of bools or whatever
[20:27:15] <GBGamer> geofft: oh hey, crap, I just got what I was doing wrong
[20:27:43] <sfackler> *separate
[20:27:54] <richo> sfackler: Sure. I completely agree that underlying storage should be totally opaque to consumers outside of libcore
[20:28:02] <GBGamer> I was doing match x { 0 => 0, _ => a / x }
[20:28:11] <GBGamer> which meant the compiler didn't know that x != 0
[20:28:12] *** Quits: mtsr (mtsr@moz-hphuar.yourbnc.co.uk) (A TLS packet with unexpected length was received.)
[20:29:14] <GBGamer> nope
[20:29:18] <GBGamer> that didn't work
[20:29:38] <GBGamer> The problem is that I can't use division :/
[20:29:49] <GBGamer> (i.e., the `/` operator)
[20:29:56] <reem> GBGamer: You have to use the compiler intrinsics directly
[20:30:07] <reem> then mark the 0 path as unreachable
[20:30:18] <reem> then LLVM will optimize as if 1 / 0 cannot occur
[20:30:24] <reem> X / 0*
[20:31:18] <GBGamer> It doesn't look like division is an intrinsic?
[20:31:22] <reem> weird, there are no iX_div_with_overflow intrinsics, just add, mul and sub 
[20:31:34] <reem> I have no idea what to do then
[20:32:01] * GBGamer cries with frustration
[20:33:38] *** Joins: annodomini (lambda@moz-qgii5v.ma.comcast.net)
[20:33:42] <GBGamer> I'm thinking about just doing this with inline asm
[20:34:05] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[20:35:11] <GBGamer> yep, I'm gonna do it with inline asm
[20:37:13] *** Quits: willem (willem@moz-facs2s.dynamic.upc.nl) (Quit: leaving)
[20:38:35] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[20:41:06] *** Joins: arielb1 (Ariel@moz-9t8c2j.red.bezeqint.net)
[20:41:17] *** Quits: killercup (killercup@moz-edmf2j.dip0.t-ipconnect.de) (Quit: Bye)
[20:42:08] *** Quits: avikpal (avikpal@moz-ffu.1he.251.117.IP) (Connection closed)
[20:42:49] *** Joins: mtsr (mtsr@moz-hphuar.yourbnc.co.uk)
[20:58:31] *** Quits: frogmella (Mibbit@moz-juv.9o3.252.72.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[20:58:55] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[21:03:08] *** Quits: eibwen (eibwen@moz-8528ue.dip0.t-ipconnect.de) (Ping timeout: 121 seconds)
[21:04:30] <GBGamer> Why does rust call itself when you divide a u64 by a u64 in i686 mode?
[21:04:54] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Connection closed)
[21:05:03] <GBGamer> (i.e. push ebx; sub 0x18, esp; call (next line); pop ebx)
[21:05:11] <GBGamer> (this is in optimized mode
[21:05:28] <cMR> in general you can use that pattern to get eip
[21:05:35] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[21:05:47] <GBGamer> get eip?
[21:05:51] <cMR> I'm don't know why llvm would be emitting that without more context.
[21:05:54] <GBGamer> Sorry, I don't do a lot of asm programming
[21:06:00] <cMR> the eip register, it contains the instruction pointer
[21:06:07] <cMR> you can't read from it because x86
[21:06:12] <GBGamer> ah, yeah, right
[21:06:15] <GBGamer> okay
[21:06:35] <GBGamer> The function literally just takes a u64, divides it by three, then returns it
[21:06:47] <cMR> blame llvm, rust doesn't do codegen.
[21:06:53] <GBGamer> I wanted to see how to divide u64s in x86 mode
[21:07:10] <GBGamer> so that I could implement it myself without panics
[21:08:21] <GBGamer> (unless you know of a better way to do it)
[21:08:24] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[21:12:34] *** Joins: Binero (jeroen@moz-91joat.69vi.s4ge.1810.2a02.IP)
[21:13:26] <cMR> You *need* the branch to check for zero unless the way you want to handle it is an interrupt handler.
[21:13:50] <GBGamer> Yeah, I know
[21:13:53] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Connection closed)
[21:13:54] *** Joins: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr)
[21:13:54] <GBGamer> I was planning on it
[21:14:24] <GBGamer> but the issue is, I can't implement one that branches on zero and returns Some or None without using the panicking division
[21:14:37] <GBGamer> I need something that gives me UB in case of divide by 0
[21:14:49] <GBGamer> So I can implement a safe, DB interface on top of it
[21:15:20] <cMR> If it's not going to be 0, why not just use the panicking division, since... it can't panic if you do the check.
[21:15:36] <GBGamer> that would require the `panic` lang item
[21:15:52] <arielb1> GBGamer: did you use objdump -R?
[21:15:55] <GBGamer> I'm attempting to create a libcore that doesn't ever panic
[21:16:01] *** Joins: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net)
[21:16:22] <GBGamer> arielb1: yes, but I don't want to implement u64 division on x86 in case I screw up
[21:16:22] <arielb1> I think there's an LLVM intrinsic for UB-ing division
[21:16:40] <GBGamer> how do I access llvm intrinsics?
[21:16:45] *** Quits: etw (john@moz-2lpgmu.fios.verizon.net) (Client exited)
[21:17:13] <GBGamer> I know I need udiv/sdiv
[21:17:38] <arielb1> GBGamer: core::intrinsics
[21:17:56] <GBGamer> those are rustc intrinsics, not llvm intrinsics
[21:18:03] <GBGamer> (i.e. no division)
[21:18:09] <GBGamer> that's where I looked first :P
[21:19:56] *** Quits: larhat (Adium@moz-tb1ulb.cable.virginm.net) (Quit: Leaving.)
[21:19:57] <geofft> GBGamer: I'm still curious, what do you actually do if you divide by zero (or divide UINT_MIN by -1)? 
[21:20:05] <GBGamer> return None
[21:20:24] <geofft> if you're writing your own libcore / libstd, you can fix up the panic infrastructure to support recursive panics, I think 
[21:20:30] <geofft> er, recursive catches on panics 
[21:20:38] <arielb1> I thought we added intrinsics when we did integer overflow
[21:20:45] <geofft> i.e., I think there's no fundamental reason why official libstd doesn't support this, other than complexity 
[21:20:45] <arielb1> I mean, UB-ing intrinsics for all operations
[21:20:52] <arielb1> apparently we didn't
[21:20:54] <GBGamer> only for add, sub, mul
[21:20:56] <geofft> so you could just wrap each function inside a panic-guard 
[21:21:09] <geofft> and return Option<its actual return type> 
[21:21:10] <GBGamer> geofft: like, threads?
[21:21:19] <geofft> except without actually creating a new thread 
[21:21:23] <GBGamer> what is a panic guard?
[21:22:01] <geofft> not sure if that's the right name for it, but see the call to unwind::try in libstd/rt/mod.rs 
[21:22:14] <geofft> inside the start lang-item, wrapping main() 
[21:23:00] <geofft> and see the docs of std::rt::unwind::try 
[21:23:16] <geofft> I don't know for sure, but I have a suspicion that that's a stdlib restriction, not a fundamental language restriction 
[21:23:29] <geofft> so you could, say, wrap each system call with unwind::try 
[21:23:38] <GBGamer> geofftt: hrm
[21:23:53] <geofft> and kill the invoking user process if it causes a system call to panic! 
[21:24:08] <geofft> (which is basically how Linux handles hardware exceptions like divide-by-zero) 
[21:26:54] *** Quits: GBGamer (npm@moz-92sbjt.wa.comcast.net) (Connection closed)
[21:26:56] *** Quits: erickt (erickt@moz-njt.vqi.14.76.IP) (Ping timeout: 121 seconds)
[21:27:21] *** Joins: npm (npm@moz-92sbjt.wa.comcast.net)
[21:27:27] <npm> my computer seems to have crashed
[21:27:31] *** npm is now known as GBGamer
[21:28:18] <GBGamer> anyways, the real issue is that there is a panic syscall at all
[21:28:27] <GBGamer> s/syscall/lang-item/
[21:28:34] <GBGamer> I want to go without that
[21:30:15] *** Quits: Binero (jeroen@moz-91joat.69vi.s4ge.1810.2a02.IP) (Connection closed)
[21:30:32] *** Joins: Binero_ (jeroen@moz-91joat.69vi.s4ge.1810.2a02.IP)
[21:30:34] *** Binero_ is now known as Binero
[21:31:40] <geofft> sure. I mean, I'm curious to see how your approach pans out because it sounds very cool 
[21:31:57] <geofft> but you're probably going to have to handle hardware exceptions at some point 
[21:32:18] <GBGamer> probably, but I can deal with taht
[21:32:20] <GBGamer> *that
[21:32:37] <GBGamer> I just want panics to not be allowed in my kernel :P
[21:32:41] <geofft> so if you don't _intend_ to panic, you could potentially handle it just like how you don't _intend_ to GPF in kernelspace 
[21:33:07] <GBGamer> But I want to statically guarantee to myself that it will never happen
[21:33:38] <GBGamer> if I screw up and do something dumb, it should be impossible for me to create panic conditions inside libcore
[21:33:43] *** Quits: munksgaa1d (munksgaard@moz-urnkl5.u.parknet.dk) (Quit: Lost terminal)
[21:35:00] *** Quits: GBGamer (npm@moz-92sbjt.wa.comcast.net) (Quit: leaving)
[21:35:33] *** Joins: James (quassel@moz-9kp9p2.range86-148.btcentralplus.com)
[21:35:50] *** Joins: GBGamer (npm@moz-92sbjt.wa.comcast.net)
[21:35:57] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Connection closed)
[21:37:58] *** Quits: c0170 (c0170@moz-4stj9o.cable.virginm.net) (Ping timeout: 121 seconds)
[21:38:30] *** Joins: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua)
[21:42:58] *** Quits: filsmick (filsmick@moz-ekfnpo.abo.wanadoo.fr) (Quit: )
[21:50:09] *** Quits: simukis1 (nagisa@moz-8t068g.static.zebra.lt) (Quit: Leaving.)
[21:51:59] *** Quits: arielb1 (Ariel@moz-9t8c2j.red.bezeqint.net) (Ping timeout: 121 seconds)
[21:52:14] *** Quits: erz (erz@moz-n2p94l.broadband.corbina.ru) (Quit: My Mac has gone to sleep. ZZZzzz…)
[21:52:45] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[21:53:17] *** Quits: imperio (Mibbit@moz-8otf3a.fbx.proxad.net) (Quit: http://www.mibbit.com ajax IRC Client)
[21:58:05] *** Quits: gamma123 (Mibbit@moz-5c6ngk.cable.virginm.net) (Quit: http://www.mibbit.com ajax IRC Client)
[21:58:45] <GBGamer> would it be possible to implement something like llvm!(), in normal rust code
[21:58:48] <GBGamer> ?
[21:58:51] *** Quits: simukis (nagisa@moz-8t068g.static.zebra.lt) (Ping timeout: 121 seconds)
[21:59:07] <GBGamer> Where you could access llvm intrinsics
[21:59:10] <GBGamer> like asm!
[21:59:12] <GBGamer> ?
[21:59:34] *** Quits: rkruppe (chatzilla@moz-3nj.rnu.131.95.IP) (Ping timeout: 121 seconds)
[22:02:37] <GBGamer> I want to access udiv
[22:02:56] <GBGamer> and sdiv
[22:03:13] <richo> that would be neat
[22:03:26] <GBGamer> also, why does rust use udiv to divide i64s?
[22:03:44] <GBGamer> that makes very little sense to me...
[22:04:02] <GBGamer> oh wait no nvm
[22:05:22] <GBGamer> wait, what?
[22:05:52] <GBGamer> Why does rust make u64s as i64s in llvm?
[22:06:08] <cMR> llvm doesn't have unsigned types.
[22:06:17] <cMR> don't need 'em.
[22:06:19] <GBGamer> ah, thanks
[22:06:22] <GBGamer> makes sense
[22:06:49] <GBGamer> but yeah, do you know if it'd be possible?
[22:06:56] <GBGamer> (to make llvm!)?
[22:07:20] <cMR> an llvm!() macro? yes, it's technically feasible but it won't be accepted.
[22:07:33] <cMR> we've rejected patches to do it in the past. it ties rustc to llvm too closely.
[22:07:42] <GBGamer> got it, makes sense
[22:07:54] <GBGamer> although it would be very very useful
[22:07:55] *** Quits: johnsoft (johnsoft@moz-69mrig.res.rr.com) (Ping timeout: 121 seconds)
[22:08:10] *** Joins: willem (willem@moz-facs2s.dynamic.upc.nl)
[22:08:13] <GBGamer> what about a non-panicking rust intrinsic for division
[22:08:13] *** Joins: johnsoft (johnsoft@moz-69mrig.res.rr.com)
[22:08:29] <cMR> that, I'd love to have :)
[22:09:26] <GBGamer> well, I'll submit an RFC
[22:10:02] <GBGamer> would you mind helping me with that process?
[22:10:04] <c74d> GBGamer: This is for a kernel? You could have a llvm! macro, and have LLVM-rustc be the only supported implementation for your kernel.
[22:10:24] <GBGamer> c74d: but I don't want to be tied to llvm any more than rust wants to be
[22:10:36] <GBGamer> All I want to be tied to is rust
[22:10:40] <c74d> oh, 'k.
[22:10:53] <GBGamer> thanks tho :)
[22:11:49] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[22:14:42] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[22:18:03] <GBGamer> https://github.com/rust-lang/rfcs/issues/1091
[22:18:19] *** Joins: simukis (nagisa@moz-8t068g.static.zebra.lt)
[22:18:48] *** Joins: erickt (erickt@moz-njt.vqi.14.76.IP)
[22:21:31] *** Joins: aatch (james@moz-is4j4r.cable.telstraclear.net)
[22:23:00] <GBGamer> anybody know where the compiler intrinsics are kept?
[22:23:03] <GBGamer> librustc?
[22:24:40] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Ping timeout: 121 seconds)
[22:26:16] <GBGamer> librustc_back?
[22:26:40] <GBGamer> no, gotta be librustc_trans...
[22:28:16] *** Joins: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com)
[22:31:29] <bluss> buuug
[22:31:33] <bluss> playbot: (127..-1i8).size_hint()
[22:31:35] -playbot- (0, Some(0))
[22:31:39] <bluss> that's all.
[22:32:44] <reem> playbot: (127..-1i8).collect::<Vec<_>>().len()
[22:32:45] -playbot- 0
[22:33:31] <bluss> thanks :)
[22:33:36] <bluss> playbot: (-1i8..127).size_hint()
[22:33:37] -playbot- (18446744073709551488, Some(18446744073709551488))
[22:33:41] <bluss> buuuug
[22:33:56] <reem> yes :)
[22:34:05] <GBGamer> playbot: (-1i8..127).collect::<Vec<_>>().len()
[22:34:06] -playbot- playpen: application terminated abnormally with signal 4 (Illegal instruction)
[22:34:27] <GBGamer> buuuug
[22:34:35] <GBGamer> :P
[22:34:51] <reem> well, it probably tried to allocate 18446744073709551488 bytes, so…
[22:35:10] <GBGamer> yeah, dang
[22:35:21] <bluss> quickcheck found this
[22:35:35] <GBGamer> Well, we really really need to fix this
[22:35:45] <bluss> I'm sure we will :)
[22:36:27] <GBGamer> I wonder what causes this?
[22:36:53] <GBGamer> playbot: (-1i8..126).size_hint()
[22:36:54] -playbot- (127, Some(127))
[22:37:09] <bluss> GBGamer: the code is just Some(((*end - *start) / *by) as usize)
[22:37:27] <bluss> see src/libcore/iter.rs +2423
[22:37:49] <GBGamer> well, I guess I'll fix it then
[22:38:12] <GBGamer> actually, wait, you found the bug, you should fix it :P
[22:38:12] <bluss> I think  Some(((*end - *start) as usize) / (*by as usize))  should be correct
[22:38:13] <GBGamer> sorry
[22:38:25] <bluss> but there is no docs on the by value but by context it should be > 0
[22:38:25] *** Quits: Binero (jeroen@moz-91joat.69vi.s4ge.1810.2a02.IP) (Client exited)
[22:38:58] <bluss> GBGamer: well I found it and I'm writing a fix, but you can fix it if you want
[22:39:05] <bluss> GBGamer: go ahead if you want to
[22:39:24] <aatch> quickcheck found the bug, so burntsushi should fix it :P
[22:39:29] <GBGamer> bluss: it should be (*end as usize) - (*start as usize) / (*by as usize)
[22:39:40] <GBGamer> I think
[22:39:52] <GBGamer> or wait... hrm
[22:40:01] <GBGamer> I don't know, up to ou
[22:40:04] <GBGamer> *you
[22:40:05] <aatch> The safest way would be to divide both by `by` first.
[22:40:27] <bluss> no solution mentioned so far actually works though
[22:40:29] <bluss> hehe
[22:40:46] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[22:41:04] <GBGamer> Well, I think...
[22:41:31] <GBGamer> You might use isize?
[22:42:21] *** Quits: madmalik (uid13697@moz-lfin5p.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[22:42:28] *** Quits: chc4 (chc4@moz-pdo0at.ma.comcast.net) (Ping timeout: 121 seconds)
[22:42:47] <GBGamer> oh, well that's easy
[22:43:03] <GBGamer> All the intrinsics are in librustc_trans/trans/intrinsic.rs
[22:43:26] *** Joins: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de)
[22:43:55] <aatch> GBGamer, I feel compiled to apologise for the handling of atomic intrinsics every time somebody looks at the file.
[22:44:01] <aatch> compelled*
[22:44:24] <GBGamer> aatch: no prob :P
[22:45:02] <GBGamer> oh god this needs some work :/
[22:45:03] *** Joins: panitaliemom (Mibbit@moz-juv.9o3.252.72.IP)
[22:45:34] <GBGamer> a lot of jank
[22:45:50] <aatch> GBGamer, most of the compiler is like that.
[22:46:10] <aatch> GBGamer, remember, Rust has been self-hosting for **years**
[22:46:31] <GBGamer> so is that the thing we're working at
[22:46:36] <GBGamer> after 1.0?
[22:46:42] <aatch> GBGamer, one of them.
[22:46:53] <GBGamer> I can see why rustc is slow :P
[22:47:13] <aatch> GBGamer, actually, most of the time is spent in LLVM, though that is still partially our fault.
[22:47:41] <WindowsBunny> Our llvm IR is rather.... verbose
[22:47:47] <GBGamer> Yeah, exactly, with this much jank, I can't imagine that the output llvm is nice
[22:48:07] <GBGamer> :P
[22:48:19] <Luqman> GBGamer: trans::intrinsic is kinda sad yea :(
[22:48:34] <GBGamer> it ain't no thang
[22:48:43] <GBGamer> At least it's easy to understand
[22:49:29] <GBGamer> just... long
[22:49:38] *** Joins: gsingh93 (gulshan@moz-qnbukr.mi.comcast.net)
[22:49:53] <GBGamer> probably would be better with macros
[22:49:54] <aatch> At least we're not generating functions for the intrinsics and relying on inlining.
[22:50:07] <GBGamer> isn't that what C does?
[22:50:27] <aatch> GBGamer, don't think so. It's what we used to do though.
[22:50:53] <Luqman> aatch: yea, i changed that a while back. though might need to undo a bit to fix that on issue..
[22:51:20] <Luqman> gh15694
[22:51:20] <[o__o]> ICE: Intrinsics cannot be used as bare functions: https://github.com/rust-lang/rust/issues/15694
[22:51:24] <aatch> In clang, C intrinsics tend to map to LLVM intrinsics, which *are* function calls, but they're special.
[22:51:38] <GBGamer> Ah, okay
[22:52:07] <GBGamer> what do y'all think I should call my UB division operators
[22:52:15] <GBGamer> s/operators/intrinsics/
[22:53:43] <reem> GBGamer: I think it makes more sense for them to be like the overflow intrinsics, it shouldn’t be UB it should just return a flag. That said, I know almost nothing about assembly so it’s entirely possible that requires a much less efficient implementation compared to the overflow intrinsics.
[22:54:10] <Luqman> GBGamer: there's already the checked_div method
[22:54:28] <GBGamer> Luqman: but that's implemented with the panicking div
[22:54:30] <aatch> Luqman, hmm... Interesting. I guess if we see a reference to an intrinsic as a bare function, we need to generate a function as a wrapper.
[22:54:59] <aatch> GBGamer is on a mission to make a Rust that can't panic.
[22:55:16] <GBGamer> yup
[22:55:28] <Luqman> aatch: yea, basically what we do with enum constructors now. if you do `let foo = Some(..)` then it's inplace but `let z = Some;` generates a function
[22:56:22] <aatch> Luqman, doesn't sound too hard. I'll make a mental note of the issue and keep it in mind if I want to tinker with the compiler some time.
[22:57:31] <WindowsBunny> reem: division by zero causes an interrupt on x86, while overflow doesn't
[22:57:52] <aatch> GBGamer, how about "unchecked_div"?
[22:58:00] <GBGamer> aatch: nice, thanks
[22:58:21] <Luqman> aatch: yea, easiest way i can think of is some code duplication but i'd love to unify both paths at least somewhat
[22:58:22] <aatch> GBGamer, though, operator*s*? Why do you have more than one?
[22:58:40] <GBGamer> aatch: accidentally said operator when I meant intrinsic
[22:58:49] *** Joins: ChrisMorgan (ChrisMorgan@moz-g6osuq.tpgi.com.au)
[22:59:13] <WindowsBunny> reem: On Windows we'd at least be able to use SEH to handle that interrupt as an exception
[22:59:20] <reem> WindowsBunny: Is there a way to catch that interrupt? (I really have no idea what I’m talking about)
[22:59:35] <cMR> yes, but no
[22:59:37] <WindowsBunny> On Windows, yes, anything else, no idea
[22:59:43] <GBGamer> clang does
[22:59:49] <GBGamer> It doesn't do anything
[22:59:58] <GBGamer> but the whole point is it's undefined behavior
[23:00:22] <aatch> Luqman, personally, I'd love to rip out most/all of trans and replace it with something better.
[23:00:33] <reem> The really flexible thing to do would be to return a flag, then if you want to make it undefined behavior just mark some value of that flag as unreachable
[23:00:47] <aatch> Luqman, that's... not really going to happen though.
[23:01:06] <Luqman> aatch: in time :P weren't your working on a mir of some kind
[23:01:27] <aatch> Luqman, yeah, but I got bogged down in representation issues and then got bored.
[23:01:28] <WindowsBunny> reem: What would rust do if it caught division by zero interrupts though?
[23:01:40] <aatch> Luqman, plus real job stuff.
[23:01:53] <aatch> Damn job that I love, paying my bills.
[23:02:11] <reem> WindowsBunny: Set the flag value. This probably sounds like nonsense, which I would accept as indicating using a flag is a bad idea.
[23:02:20] *** Joins: p1start (p1start@moz-nftjhe.org)
[23:02:27] <reem> because it’s not supported as a zero-cost thing on the hardware level
[23:02:50] <Luqman> aatch: haha yea, i've preoccupied lately too but i'd be down for working towards a better trans
[23:04:09] <WindowsBunny> reem: At the very least we could use the interrupt to cause the panic, instead of checking for zero before the division
[23:04:37] <aatch> WindowsBunny, what would unwinding from inside an interrupt handler do?
[23:04:46] <aatch> WindowsBunny, that sounds... dangerous.
[23:04:59] <cMR> Windows lets userspace register interrupt handlers?
[23:05:10] <vadimcn> ... AFAIK, rust codegen injects zero checks before every division, so it can panic rather than having the process killed by a signal.
[23:05:20] <aatch> vadimcn, correct.
[23:05:32] *** Quits: ptalbot (ptalbot@moz-j4gnuh.fbx.proxad.net) (Ping timeout: 121 seconds)
[23:05:43] <WindowsBunny> SEH exception handlers
[23:05:54] <cMR> Ah, good
[23:05:58] <WindowsBunny> the interrupt fires and the OS calls our exception handler if we have one
[23:06:00] <WindowsBunny> https://msdn.microsoft.com/en-us/library/windows/desktop/ms681409%28v=vs.85%29.aspx
[23:06:22] <reem> I’ve wanted to help on modernizing the compiler internals for a while but every time I slam into the build times and stop.
[23:06:30] <reem> It’s a pretty unfortunate situation :/
[23:06:33] <WindowsBunny> The trick is just figuring out how to deal with SEH at the llvm level
[23:07:17] <Luqman> reem: trick is to have something else to do in between
[23:07:19] <GBGamer> So turns out that C, if you divide by zero, give a Floating point exception (core dumped)
[23:07:25] <GBGamer> If anyone was wondering
[23:07:30] <reem> Luqman: True, but context switches are expensive :P
[23:09:03] <WindowsBunny> context switches are cheap in comparison to rust build times
[23:09:32] <aatch> Anyway, a big thing that we could for the compiler internals is move as much as we can to running off of a control-flow graph, rather than off of the AST.
[23:10:25] *** Joins: blaenk (blaenkdenum@moz-fsm6fc.n2pv.fsko.e000.2605.IP)
[23:10:54] *** Joins: chc4 (chc4@moz-pdo0at.ma.comcast.net)
[23:11:09] <blaenk> if using Unique and wanting to be stable, which do you guys think is preferable: 1. using raw pointers or 2. just copying the code for the existing Unique impl, since it's not that long/complex
[23:11:28] <blaenk> I'm indifferent, but I had heard to go with option #2
[23:11:29] <aatch> blaenk, probably just copy the impl for now
[23:11:55] <blaenk> alright. cause one of my projects (bindings to a c library) got a PR that replaces Unique with raw pointers
[23:12:02] <blaenk> so I was wondering what I should do. guess I'll let him know
[23:12:13] <aatch> blaenk, since if Unique becomes stable, you can just switch over to it, and if it doesn't, you have a nice abstraction already in place.
[23:12:19] <blaenk> yeah
[23:13:35] <reem> Gankro: I think we should bring back collect-rs.
[23:13:40] <reem> or at least we should consider it
[23:13:51] <aatch> Post-typechecking, most of what the compiler does can be done (or is already) off of a CFG, which has the advantage of being a better representation of a program than the AST is.
[23:15:00] <geofft> GBGamer: https://github.com/torvalds/linux/blob/master/arch/x86/kernel/traps.c#L311 
[23:15:08] *** Quits: gleb (gleb@moz-3u1drv.rusanovka-net.kiev.ua) (Ping timeout: 121 seconds)
[23:15:41] <geofft> Linux reports x86 #DE as SIGFPE, with the FPE_INTDIV signal code if you're using sigaction / siginfo_t 
[23:15:46] *** Joins: Rym (y@moz-rmaga4.range86-187.btcentralplus.com)
[23:16:02] <aatch> Though using a CFG to drive code-generation is something I've struggled to figure out though.
[23:16:32] *** Quits: Rym_ (y@moz-rmaga4.range86-187.btcentralplus.com) (Connection closed)
[23:17:14] <aatch> Ideally though, we should have this sequence: Front-end AST -> Internal AST -> Typed AST -> CFG -> Rust IR -> LLVM IR -> Machine Code
[23:17:48] <aatch> The reason for the first two is that the Front-end AST can be the stable interface for things like syntax extensions.
[23:17:53] <GBGamer> Interesting
[23:18:04] <aatch> While the internal AST is closer to what we have now.
[23:18:15] <GBGamer> I do want that signal code tho, not for rust to panic
[23:18:43] <GBGamer> (or attempt to panic)
[23:19:11] *** Quits: mgottschlag (quassel@moz-8uvcc8.hsi15.kabel-badenwuerttemberg.de) (Ping timeout: 121 seconds)
[23:19:50] <steveklabnik> erickt: thanks <3
[23:20:11] <aatch> The Typed AST is fully typed and also has things like operator overloads and coercions expanded.
[23:20:27] <blaenk> hmmm, actually just copying the Unique impl seems like it's pretty big
[23:20:34] <blaenk> you have to copy in NonZeroable and that means you need Zeroable
[23:20:43] <blaenk> Nonzero
[23:20:58] <blaenk> might just gonna go with raw pointers for now
[23:20:59] <aatch> blaenk, is NonZero not stable?
[23:21:07] <blaenk> yeah it's not :(
[23:21:10] <blaenk> http://doc.rust-lang.org/core/nonzero/struct.NonZero.html
[23:21:29] <blaenk> it's not a problem, using raw pointers in my case isn't much worse
[23:21:38] <Luqman> don't think you can copy NonZero anyways since it's a langitem
[23:21:40] <reem> blaenk: just don’t bring in NonZero/Zeroable
[23:21:47] <blaenk> Luqman: oh really? great point I didn't know that
[23:21:49] <reem> blaenk: they’re not necessary to the main use of Unique
[23:21:57] <reem> which is to avoid writing your own unsafe Send/Sync impls
[23:22:06] <blaenk> reem: but the current impl of Unique is based on NonZero, so I'd change that impl to use a raw pointer like before?
[23:22:19] <blaenk> someone should just make a unique crate for now lol, like with the other stuff
[23:22:28] <reem> oh interesting, that has changed since I last looked at it
[23:22:35] <reem> it used to just be a newtype on *mut T
[23:22:38] <blaenk> yeah
[23:22:40] <blaenk> it changed a lot
[23:22:46] <blaenk> it's fine no problem! I'll go with raw pointesr for now
[23:22:49] <Luqman> blaenk: NonZero just lets you opt-in to an optimization for certain enums
[23:23:01] <blaenk> I think the last time I heard that suggestion (to just copy the impl) was indeed when it was just a newtype
[23:23:05] <reem> blaenk: You can use it without the NonZero bit, it’s strictly an optimization.
[23:23:06] <blaenk> so it makes sense if that no longer applies
[23:23:18] <blaenk> hmm yeah that's what I was wondering
[23:24:07] <aatch> Specifically, if you have a two-variant enum where one of the enums is zero-sized and the other contains a non-zeroable value (searched for recursively)
[23:24:18] <aatch> one of the variants*
[23:24:50] <aatch> So Option<T> is probably the same size as T for most relatively complex types nowadays.
[23:25:28] <aatch> Since anything containing a Vec has a valid non-zero value
[23:25:51] <bluss> true. One thing that comes to mind is that the slice iterator is probably missing that optimization
[23:26:01] <Luqman> aatch: relatedly, why not an Option here? https://github.com/Aatch/ril/blob/master/src/ty.rs#L238
[23:26:38] <Luqman> bluss: but how often do you have an Option of an Iterator? :P
[23:27:29] <aatch> Luqman, I'm not sure if I knew about NonZero at that point.
[23:28:10] <Luqman> aatch: Option<Box<_>> has worked for a long while afaik
[23:29:35] <aatch> Luqman, yes, but I'm not use Box, since the types are interned.
[23:29:42] <bluss> Luqman: maybe not so often, but's the first nonnullable pointer I could think of
[23:30:03] <Luqman> aatch: ah, right
[23:30:39] <aatch> Luqman, Wrapping the pointer in TyRef would do it though.
[23:30:54] <GBGamer> Did we used to have uppercase functions?
[23:31:16] <GBGamer> was that a thing at some point?
[23:31:19] <aatch> GBGamer, what do you mean?
[23:31:33] <GBGamer> in librustc_trans/trans/build.rs
[23:31:40] *** Joins: jdm (jdm@moz-ilbt2e.cable.teksavvy.com)
[23:31:52] <GBGamer> All those functions
[23:32:00] <GBGamer> Unless it's attempting to be enum like?
[23:32:11] <aatch> GBGamer, ah, they're mirroring the LLVM interface.
[23:32:19] <GBGamer> oh got it
[23:32:24] <cMR> Also, constructors used to be normal functions named the same as the type.
[23:32:25] <GBGamer> Just weirded me out
[23:32:48] <GBGamer> I'm so glad that rust has evolved past that
[23:33:19] <aatch> cMR, still are in one specific case.
[23:33:49] <GBGamer> aatch: P
[23:33:49] <GBGamer> ?
[23:33:54] <GBGamer> in libsyntax
[23:34:46] <aatch> GBGamer, no, I mean that for `struct Foo(int, int)`, `Foo` is a function `fn(int, int) -> Foo`
[23:35:01] <GBGamer> ah, yeah, that too
[23:35:14] <GBGamer> Aren't enums also functions?
[23:35:16] <cMR> It's not writen as a function though, rustc does that for you.
[23:35:27] *** Quits: tamird (textual@moz-oii9i6.ca.comcast.net) (Quit: My Mac has gone to sleep. ZZZzzz…)
[23:35:45] <GBGamer> like Some(i64) is a function that returns an Option<i64>?
[23:36:06] <aatch> GBGamer, that too
[23:36:51] <GBGamer> there are three things, I guess
[23:36:53] <Luqman> GBGamer: yes. but if you write `let s = Some(10);` then we don't generate a function but just construct it in place. but if you do something like `let foo = Some::<i64>;` then we do emit a function
[23:37:25] <GBGamer> Luqman: well yeah, it's more like an #[inline] function
[23:38:04] *** Joins: tamird (textual@moz-oii9i6.ca.comcast.net)
[23:38:28] <aatch> GBGamer, well we don't ever emit a call if you have Some(foo)
[23:38:43] <aatch> GBGamer, and we only emit the function if it's used as a function
[23:39:35] <Luqman> aatch: afaik there was only one place in the whole code base where it was used a function when i checked a couple months ago
[23:39:49] <GBGamer> It's like an early CTFE, I geuss
[23:39:50] <GBGamer> *guess
[23:47:11] <GBGamer> steveklabnik:
[23:48:01] <GBGamer> haha nevermind :D
[23:49:03] *** Joins: A205B064 (A205B064@moz-9s9nhk.nap.wideopenwest.com)
[23:49:07] <steveklabnik> ok
[23:49:08] <steveklabnik> :)
[23:51:00] <GBGamer> How does LLVM know which mul to use?
[23:51:07] <GBGamer> there's only one LLVMBuildMul
[23:51:14] <GBGamer> but you have both umul and smul
[23:51:50] <GBGamer> Whereas with div, there's LLVMBuildUDiv and LLVMBuildSDiv
[23:53:03] *** Quits: James (quassel@moz-9kp9p2.range86-148.btcentralplus.com) (Ping timeout: 121 seconds)
[23:58:14] <GBGamer> ping anyone who knows llvm?
[23:58:40] *** Joins: blaenk_ (blaenkdenum@moz-12e081.res.rr.com)
[23:58:53] *** Quits: yuriks (quassel@moz-hnlou0.yuriks.net) (Ping timeout: 121 seconds)
[23:59:22] *** Joins: yuriks (quassel@moz-hnlou0.yuriks.net)
