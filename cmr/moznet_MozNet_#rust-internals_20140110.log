[00:00:01] <acrichto> strcat: llvm looks at all .o files, and it actually looks at the file header to see whether it's an object or llvm .bc in disguise
[00:00:14] <acrichto> ecr: --save-temps will dump it during LTO
[00:00:31] <strcat> acrichto: well, I know it can distinguish between them
[00:00:43] <strcat> I've just never actually been aware of it being used cross-library
[00:00:52] <acrichto> strcat: the general problem of "link a bunch of objects that could be objects or bytecode" is much harder than "optimize all known IR for rust"
[00:01:04] <acrichto> so for us all rlibs contain foo.o and foo.bc
[00:01:13] <acrichto> we just load foo.bc and "llvm link" it into the current LLVMMOdule
[00:01:23] <acrichto> and we then run the standard LTO passes
[00:01:27] <strcat> so if you wanted to support linking against native libraries with LTO, it'd need to actually use the linker plugin?
[00:01:28] <acrichto> (same as the llvm lto engine)
[00:01:31] <jack> any idea what could be causing: failed at 'assertion failed: self.live_allocs.is_null()', /home/jack/src/servo/src/compiler/rust/src/libstd/rt/local_heap.rs:135
[00:01:33] <acrichto> yeah
[00:01:52] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[00:01:52] <strcat> acrichto: could we just output a .o with bytecode ?
[00:01:59] <strcat> and then call clang to link it
[00:02:11] <acrichto> jack: gc objects creating during gc annihilation that outlived annihilation
[00:02:33] <acrichto> strcat: we could in theory, but you could also just use the bytecode output directly and pass it to clang
[00:02:41] <strcat> jack: ummm, are you putting @ inside something like Rc by any chance?
[00:02:52] <jack> There's RefCell in an Rc.
[00:03:00] <jack> i don't think we have an @ in there
[00:03:00] <strcat> well RefCell in Rc should be fine
[00:03:02] <acrichto> strcat: as in we don't favor object or bytecode output in rlibs, so it'd be a shame to favor one or the other at the end
[00:03:09] <strcat> jack: @ inside Rc will break
[00:03:16] <acrichto> strcat: but we could have --crate-type="lto-bc" or something like that
[00:03:19] <jack> backtrace: https://gist.github.com/metajack/8344489
[00:06:20] *** Quits: pnkfelix (pnkfelix@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Ping timeout)
[00:06:22] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[00:06:22] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/iWL_ng
[00:06:22] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[00:11:18] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[00:11:18] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/gvUFUw
[00:11:18] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[00:11:19] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[00:11:19] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/NpFrRA
[00:11:19] <ghrust> 13rust/06auto 14e127115 15Patrick Walton: librustc: Implement placement `box` for GC and unique pointers.
[00:11:19] <ghrust> 13rust/06auto 14ff3d5d4 15bors: auto merge of #11055 : pcwalton/rust/placement-box, r=pcwalton...
[00:11:20] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[00:11:50] *** Joins: canhtak (canhtak@moz-DB18D73D.wl.t.ulaval.ca)
[00:14:30] *** Joins: erickt (etryzelaar@moz-4A9FF4B2.public.wayport.net)
[00:16:17] <jack> acrichto, strcat: Window's destructor is getting triggered on this line: https://github.com/metajack/servo/blob/rustup-20131219/src/components/script/dom/window.rs#L171
[00:16:29] <jack> it's a little bizarre
[00:18:00] <jack> or i assume after that line, which is the end of the proc
[00:23:42] *** Quits: erickt (etryzelaar@moz-4A9FF4B2.public.wayport.net) (Ping timeout)
[00:27:42] *** Quits: ecr (chatzilla@moz-8B5E7056.dhcp4.washington.edu) (Ping timeout)
[00:31:47] *** Joins: ChristopherBurg (Christophe@moz-2C03E71B.hfc.comcastbusiness.net)
[00:33:47] *** Quits: tupshin_ (quassel@moz-E7B03838.c3-0.nyr-ubr1.nyr.ny.cable.rcn.com) (Client exited)
[00:43:43] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[00:50:04] *** Joins: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com)
[00:50:04] *** Quits: jpoirier_ (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com) (Connection reset by peer)
[00:51:04] *** Joins: jpoirier_ (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com)
[00:51:04] *** Quits: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com) (Connection reset by peer)
[00:52:27] *** Joins: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com)
[00:52:27] *** Quits: jpoirier_ (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com) (Connection reset by peer)
[00:58:28] <nmatsakis> bjz: I actually don't know who controls the ML; brson I guess, not me :)
[01:12:26] <vadimcn> Hey, so whipped up guide for using Rust on Windows: http://github.com/mozilla/rust/wiki/Using-Rust-on-Windows
[01:12:45] <klutzy> vadimcn: \o/
[01:13:04] <vadimcn> klutzy: wanna test the steps?
[01:13:18] <klutzy> vadimcn: hmm, is there some reason to recommend threads=posix for mingw-w64?
[01:13:48] <vadimcn> klutzy: just 'cause it's the default.  I don't think it matters.
[01:14:12] <vadimcn> can change it to "windows" if you prefer
[01:15:09] <klutzy> I always use threads=win32, but I'm ok either way if it simplifies install :)
[01:15:52] <vadimcn> strcat: ^
[01:16:07] <SiegeLord> Is that x32 THE x32?
[01:16:51] <SiegeLord> Or is that poorly named i686?
[01:17:09] <klutzy> it's i686
[01:18:13] <brson> where is our libc dep encoded?
[01:19:07] <brson> or the libgcc for that matter
[01:19:18] <vadimcn> brson: in std crate
[01:19:32] <vadimcn> and rustrt I guess
[01:19:44] <brson> i don't see it in rtdeps.rs
[01:20:26] <vadimcn> brson: it's implicit to avoid having to deal with different lingcc names on different platforms
[01:20:42] <vadimcn> gcc always throws it in, unless you tell it not to
[01:20:55] <larsberg> acrichto: what makes this Servo bug particularly insidious to debug is that we're also hitting a SIGILL in begin_unwind simultaneously
[01:20:58] <larsberg> https://gist.github.com/metajack/8344489 is a bt, along with a disas to the instruction where it's ILL'in.
[01:21:17] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[01:21:17] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/NpFrRA
[01:21:17] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[01:21:31] <cmr> brson: rustc::back::link?
[01:24:33] *** Quits: Diamond (dick@moz-80556682.ks.ks.cox.net) (Quit: Leaving.)
[01:25:55] <jack> acrichto: where is the select! macro?
[01:26:04] <jack> i am getting 'macro undefined" trying to use it.
[01:26:16] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[01:26:16] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/ZOeKZA
[01:26:16] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[01:26:17] <klutzy> vadimcn: maybe we need "how to configure and run msys" lines
[01:26:19] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[01:26:20] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/rst7eA
[01:26:20] <ghrust> 13rust/06auto 14b36a948 15Daniel Micay: stop treating `Rc` cycles as unsafe
[01:26:20] <ghrust> 13rust/06auto 1477cc1c5 15Daniel Micay: add a strong/weak reference counted pointer type
[01:26:20] <ghrust> 13rust/06auto 14c5bcb22 15Daniel Micay: rename Strong -> Rc, replacing `rc` with `weak`
[01:26:22] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[01:27:20] <klutzy> vadimcn: i.e. where msys.bat is and how to config via /postinstall/pi.sh
[01:27:20] <dbaupp> jack: it's private to std::select (or std::comm) or something
[01:27:41] <dbaupp> jack: you may need to copy it out (if it's actually useable at this point...)
[01:27:41] <jack> the docs recommend i use it.
[01:27:50] <vadimcn> klutzy: the shortcut is in the start menu
[01:27:51] <jack> maybe that should be deleted?
[01:27:58] <jack> i guess i should use the port set thing?
[01:29:21] *** Quits: dbaupp (Thunderbir@moz-BB237A70.lns20.syd6.internode.on.net) (Ping timeout)
[01:29:38] <klutzy> vadimcn: ah I completely forgot it touches start menu :p
[01:29:43] *** Joins: dbaupp (Thunderbir@moz-BB237A70.lns20.syd6.internode.on.net)
[01:30:15] *** Joins: Diamond (dick@moz-80556682.ks.ks.cox.net)
[01:30:46] <klutzy> ugh I found it's old one and not what I've just installed
[01:31:10] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[01:31:10] *** ChanServ sets mode: +ao pcwalton pcwalton
[01:32:22] <cmr> r? https://github.com/mozilla/rust/pull/11431
[01:33:09] <dbaupp> "some changes"
[01:33:10] <dbaupp> :/
[01:33:17] <cmr> sorry
[01:33:22] <cmr> I just pulled it out of a larger branch
[01:33:24] <vadimcn> klutzy: so mingw-get no longer installs the shortcut? 
[01:33:25] <cmr> so it wouldn't rot
[01:33:25] <dbaupp> does rusti actually work with libnative?
[01:33:36] <cmr> dunno
[01:33:53] <klutzy> vadimcn: I guess installer saw old one and skipped
[01:34:09] <klutzy> vadimcn: isn't it true that user should run postinstall/pi.sh manually? fresh one needs it
[01:34:12] <cmr> don't r+
[01:34:17] <cmr> I didn't add a test for 2243
[01:34:33] <vadimcn> klutzy: I never did it and I am still alive :P
[01:35:25] <acrichto> jack: I'd recommend using the macro, but for now just copy it out of libstd
[01:35:35] <acrichto> jack: it *should* work, but it's not as exhaustively tested as channels are
[01:35:51] <klutzy> vadimcn: afaik old installer (4.6~4.7?) did it automatically, but when mingw switched to new installer the magic was lost
[01:36:11] <jack> acrichto: so using the macro means copying it out of libstd? :)
[01:36:14] <vadimcn> klutzy: the shortcut or the postinstall?
[01:36:14] <jack> that seems odd
[01:36:26] <dbaupp> no exporting of macros yet
[01:36:29] <cmr> jack: at the moment yes.
[01:36:33] <cmr> there's a PR open that fixes it!
[01:36:33] <klutzy> vadimcn: postinstall, but I'm not sure if shorcut is also gone
[01:36:36] * cmr loves being able to say that
[01:36:39] <cmr> <3 sfackler
[01:37:02] <dbaupp> cmr: only syntax extensions
[01:37:06] <cmr> dbaupp: no?
[01:37:10] <acrichto> jack: it's not an official macro yet, I'm not sure if we even want to keep that syntax
[01:37:11] <dbaupp> cmr: no macros_rule!'s macros
[01:37:16] <acrichto> jack: it's super duper experimental
[01:37:19] <dbaupp> *macro_rules!
[01:37:43] *** Joins: dev14 (devarshdes@C8A1BC8D.6DB843DD.3FBA778E.IP)
[01:38:03] <cmr> dbaupp: https://github.com/sfackler/rust/commit/01b29fa85a3d352b2157b9ae8e1ee19b03cb6d8b ?
[01:39:22] <dbaupp> cmr: oh! awesome
[01:39:26] <dbaupp> I must've missed that
[01:41:20] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[01:41:20] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1465216a3 to 14ff3d5d4: 02http://git.io/N3iJvQ
[01:41:20] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[01:41:21] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[01:41:21] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/_8vxrQ
[01:41:21] <ghrust> 13rust/06auto 14b36a948 15Daniel Micay: stop treating `Rc` cycles as unsafe
[01:41:21] <ghrust> 13rust/06auto 1477cc1c5 15Daniel Micay: add a strong/weak reference counted pointer type
[01:41:21] <ghrust> 13rust/06auto 14c5bcb22 15Daniel Micay: rename Strong -> Rc, replacing `rc` with `weak`
[01:41:23] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[01:43:10] <vadimcn> klutzy: just did a from-scratch install, and it did not create a shortcut
[01:43:19] <brson> why are non_camel_case_types and other stylistic lints set to allow by default?
[01:43:25] <brson> i don't think they used to be
[01:43:44] <cmr> iirc because the compiler shouldn't be enforcing style.
[01:43:45] <klutzy> vadimcn: ugh mingw :'(
[01:44:05] <vadimcn> klutzy: ok, I'll mention msys.bat then
[01:44:08] <Eridius> cmr: style warnings by default is a great way to have consistent style across disparate open source projects
[01:44:22] <brson> i think we should be strongly enforcing style and formatting
[01:44:23] <Eridius> cmr: Go has been extremely successful enforcing consistent style by pushing gofmt on everybody
[01:44:26] <strcat> brson: +1
[01:44:35] <cmr> I agree
[01:44:36] <dbaupp> brson++
[01:44:44] <cmr> I didn't used to, but I do now.
[01:44:46] <strcat> can always be turned off if you don't like it
[01:44:47] <Eridius> I think we should follow suit and turn on stylistic lints by default
[01:44:53] <cmr> exactly.
[01:44:54] <brson> i'll file an issue
[01:45:01] <SiegeLord> As long as the formatting is restricted to what is enforced by rustc, it's ok :P
[01:45:13] <jack> stupid doc js won't search with two letters
[01:45:33] <cmr> jack: yeah I don't know what's up with that
[01:45:33] <SiegeLord> But you can take my tabs and brace alignment from my cold, dead hands ;)
[01:45:44] <dbaupp> (and it crash on some specific inputs... it's really weird)
[01:45:49] <dbaupp> *crashes
[01:45:56] <jack> how am i supposed to find Eq?
[01:46:11] <dbaupp> std::cmp::Eq
[01:46:30] <vadimcn> klutzy: better?
[01:46:32] <strcat> dbaupp: he means via search
[01:46:35] <dbaupp> (#rust is the best doc search :P )
[01:46:55] <dbaupp> strcat: right. I was answering his question if he actually wanted to know where it was right now.
[01:47:03] <dbaupp> fixing the bug can happen later
[01:47:04] * strcat hopes rustc starts working in playpen again soon...
[01:47:04] <klutzy> vadimcn: yeah
[01:47:17] <cmr> strcat: https://github.com/mozilla/rust/pull/11431 hopefully
[01:47:20] <cmr> maybe
[01:47:37] <strcat> cmr: did you test it?
[01:47:38] <klutzy> vadimcn: your fresh msys knows where gcc is? my one doesn't until some postinstall
[01:47:40] <cmr> nope
[01:47:44] <klutzy> (or manual /etc/fstab edit)
[01:48:49] <dbaupp> maybe we could have a run-make test that downloads rust-playpen and runs rusti in it. (downloading a virtual machine & the appopriate arch linux version if either is not available.)
[01:49:52] <vadimcn> klutzy: hmm, I guess I added it into the global PATH
[01:50:48] <kimundi> nmatsakis: Earlier you said something to bstrie about a str/5 type -what was that about?
[01:51:11] <klutzy> vadimcn: ah, then it works (if there's only one installation) and may be simpler
[01:53:03] <dbaupp> kimundi: equivalent to [T, .. n] but for strings
[01:53:08] <nmatsakis> what dbaupp said
[01:53:31] * nmatsakis hates strings
[01:53:37] <cmr> me too
[01:53:40] <nmatsakis> I'd rather if we can just make them newtyped vectors somehow, but I guess it has to be nice
[01:53:45] <dbaupp> kimundi: like &[T] is basically an existential type `&(exists n such that [T, .. n])` &str would be `&(exists n such that str/n)`
[01:54:17] <jack> ok serious
[01:54:21] <jack> Select is private
[01:54:25] <jack> WHY DO YOU HATE ME!
[01:54:28] <dbaupp> acrichto: ^
[01:54:31] <kimundi> Yeah, I get what the syntax is supposed to express, I'm wondering in what context this type is neccessary?
[01:54:34] <acrichto> jack: std::comm::Select
[01:54:35] <nmatsakis> kimundi: incidentally, under this DST proposal, I think we handle the case you've oft been interested in, albeit somewhat less elegantly than you might like (iirc, you were interested in the idea of a struct with an interior array at the end)
[01:54:39] <acrichto> not std::comm::select::Select
[01:55:03] <jack> docs steering me wrong :)
[01:55:04] <dbaupp> kimundi: to make strings fully jive with DST
[01:55:07] <jack> i think i saw a bug about that
[01:55:17] <kimundi> nmatsakis: Right, as I can see it DST5 would allow str to just be a userdefined library type for a newtyped [u8]
[01:55:34] <cmr> acrichto: gahhh, sorry I wiped all your comments
[01:55:36] <nmatsakis> kimundi: basically to create a RC<[T]>, you start with a RC<[T, ..N]>, same thing would possibly apply to strings.
[01:55:37] <cmr> I hate github sometimes :(
[01:55:46] <cmr> acrichto: I added a test; the other comment should be in your email.
[01:55:49] <cmr> Testing rusti now.
[01:56:03] <strcat> nmatsakis: we would have fixed-size strings? ;\
[01:56:21] <cmr> I can't think of a single situation I would want fixed-size strings.
[01:56:25] <jack> acrichto: why does the port you give to select have to be mutable?
[01:56:30] <acrichto> cmr: awesome, thanks!
[01:56:31] <cmr> but having them be DST would be useful for impl's
[01:56:36] <acrichto> jack: prevents you from adding the same port twice
[01:57:05] <nmatsakis> strcat: I don't know, tbh I haven't thought about strings very much, I'm just saying that'd be the obvious approach to incorporate them, presuming that they stay builtin
[01:57:16] <acrichto> jack: but again, super experimental
[01:57:33] *** Quits: dev14 (devarshdes@C8A1BC8D.6DB843DD.3FBA778E.IP) (Quit: dev14)
[01:57:53] <jack> acrichto: ok. trying to fix this bad drop with a correct timer canceling thing
[01:58:15] <acrichto> jack: I fixed it for real in channels as part of https://github.com/mozilla/rust/pull/11413
[01:58:33] <acrichto> (although it's not landed yet)
[01:58:37] <acrichto> so not too helpful
[01:58:56] <jack> whee. it compiles ;)
[01:59:16] <jack> illegal instructions for everyone still
[01:59:26] <strcat> acrichto: when did rust switch to putting stuff in 'rustlib'?
[01:59:33] <strcat> afaict 0.9 doesn't do it
[01:59:36] <strcat> but master does?
[01:59:40] * strcat confused
[01:59:58] <acrichto> 0.9 should do it
[01:59:59] <klutzy> strcat: 0.9 does
[02:00:05] <acrichto> it was a recent patch before 0.9 was released
[02:00:13] <strcat> uhhh, it didn't though...
[02:00:31] <kimundi> nmatsakis: Hm, I think fixed sized strings would just fall out of integers in the type system/assoziated constants: struct FixedSizedStr<N> { priv x: [u8, ..N] }
[02:00:32] <acrichto> stage0 doesn't
[02:00:37] <acrichto> unless that snapshot landed...
[02:01:04] <strcat> well, all I can tell you is that I built 0.9 and it didn't do that
[02:01:19] <acrichto> kimundi: isn't it a problem that typeof(FixedSizeStr<1>) != typeof(FixedSizeStr<2>) ?
[02:01:36] <strcat> lets try again
[02:01:41] <kimundi> acrichto: ... Isn't that exactly the idea behind that
[02:01:48] <strcat> acrichto: uhh
[02:01:58] <acrichto> kimundi: oh I just figured that if a library wanted to take a fIxedSizeStr it doesn't want to specify the size
[02:02:03] <strcat> the version of 0.9 the site gave me has a different hash than the one it gave me just now
[02:02:05] <strcat> :(
[02:02:11] <strcat> I think I got a cached release candidate
[02:02:13] <strcat> stupid s3
[02:02:20] <acrichto> kimundi: in the sense that a DST Str would be usable everywhere, but a hardcoded fixed size one might now
[02:02:22] <acrichto> not*
[02:03:18] <kimundi> acrichto: A DST str would be struct str { priv x: [u8] }, and Is something I'd like to get in the library in replacement of the build-in str if DST lands
[02:03:20] <nmatsakis> kimundi: you're presuming we add templatization over integers, which I would love to do, but it's kind of disjoint from DST
[02:03:55] <kimundi> acrichto: That fixed sizes str was just an example how you could have a fixed sized string without needing special syntax for it, provided we get a feature we want in other places
[02:04:12] <acrichto> ah I suppose so
[02:04:16] <nmatsakis> kimundi: but basically that def'n you gave is what I meant by str/n or something
[02:04:22] <kimundi> nmatsakis: Right, it was just an example, maybe misplaced here, sorry
[02:04:33] <nmatsakis> np
[02:04:39] <nmatsakis> giving rust talk soon
[02:04:50] <nmatsakis> actually, I wonder if it's available live, might be
[02:05:09] <dbaupp> oooohh, link if it is?
[02:05:09] <nmatsakis> http://linux.conf.au/schedule/30170/view_talk?day=friday
[02:05:35] <nmatsakis> gotta run
[02:05:42] <acrichto> nmatsakis: good luck!
[02:06:05] <dbaupp> you're in perth? must be pretty warm
[02:06:51] <vadimcn> brson: https://github.com/mozilla/rust/wiki/Using-Rust-on-Windows, do you want to stick a link next to the installer?
[02:07:05] <strcat> stupid s3
[02:07:07] * strcat sighs
[02:07:14] <strcat> I wonder what this 0.9 thing it gave me is
[02:08:33] *** Quits: a_m0d|home (a_m0d@moz-322A4DE4.acanac.net) (Quit: Leaving.)
[02:10:51] <brson> vadimcn: where?
[02:11:07] <brson> does anybody have any ideas about how to create some kind of error code registry in rustc?
[02:11:27] <brson> I'd like to be able to, in the code, name errors like ERR_FOO
[02:11:38] <vadimcn> brson: somewhere people are likely to find it :)
[02:11:39] <brson> but they also need to be associated with like a number
[02:11:52] <brson> and an error pattern and a long-form error explanation
[02:12:15] <brson> vadimcn: in the tutorial?
[02:12:21] <brson> or somewhere else on the wiki?
[02:12:37] <brson> vadimcn: does this supercede the content here: https://github.com/mozilla/rust/wiki/Note-getting-started-developing-Rust?
[02:13:01] <strcat> http://buildbot.rust-lang.org/builders/auto-linux-64-nopt-t/builds/2585/steps/test/logs/stdio great! ;p
[02:13:12] <strcat> warning: got 
[02:13:14] <strcat> wat?
[02:13:21] <brson> what i want is some kind of register_error! macro that both creates a static error variable and registers it in an index
[02:13:38] <vadimcn> brson: that's for developing, you don't need most of that to merely use rustc
[02:13:48] * strcat doesn't get why that failed...
[02:13:58] <acrichto> brson: how about a error!() macro that takes a session, a format string, and a list of args, and uses the hash of the format string as the error code
[02:14:20] <brson> acrichto: it's not a stable error code
[02:14:24] <SiegeLord> Having an error registry would be awesome... if the error messages ever get localized
[02:14:24] <brson> they need to be stable forever
[02:14:28] <brson> even if the error changes
[02:14:32] <vadimcn> brson: I'd put it either next to the installer.exe  link, or, if that's too cramped, move installer link to a separate page and put it there
[02:14:32] <brson> *error string
[02:14:38] <acrichto> ah good point
[02:16:16] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[02:16:17] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14fe3680b to 14ff3d5d4: 02http://git.io/N3iJvQ
[02:16:17] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[02:16:19] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[02:16:20] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/k51rtw
[02:16:20] <ghrust> 13rust/06auto 14b36a948 15Daniel Micay: stop treating `Rc` cycles as unsafe
[02:16:20] <ghrust> 13rust/06auto 1477cc1c5 15Daniel Micay: add a strong/weak reference counted pointer type
[02:16:20] <ghrust> 13rust/06auto 14c5bcb22 15Daniel Micay: rename Strong -> Rc, replacing `rc` with `weak`
[02:16:22] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[02:16:36] <strcat> we have a lot of weird phantom failures
[02:16:51] <brson> vadimcn: not a lot of room on the homepage. I can make the .exe link go to the wiki and put a link to the installer on your wiki page
[02:17:37] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[02:17:41] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[02:19:55] <vadimcn> brson: that'll do too.   A bit dangerous though, since anyone can edit a wiki page and re-point installer link to some malware.
[02:20:45] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[02:20:56] * strcat doesn't really like wikis
[02:21:08] <strcat> as one of the admins of a wiki that's probably a bad thing to think ;p
[02:21:39] <strcat> it's really a pain to keep them from degrading from all of the cooks stirring the same pot
[02:24:48] <brson> vadimcn: i think i'll take the risk. people can edit the wiki to tell people to do all sort of dangerous things besides downloading a fake installer
[02:26:03] <strcat> brson: could we just have installation guides in the official docs? and for now the 0.9 ones could point to the master ones
[02:26:27] <strcat> hm
[02:27:22] <brson> we could. the tutorial does also cover installation
[02:28:03] <brson> vadimcn: website points to your wiki page now
[02:28:30] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Quit: Leaving...)
[02:28:55] <vadimcn> brson: thanks
[02:29:24] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[02:31:08] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[02:31:43] <strcat> acrichto: yep, there we go... it was just because s3 gave me some ancient cached thing :)
[02:31:45] <strcat> the rc, I guess...
[02:32:07] <strcat> brson: in the future it would probably be a good idea to use a different url for the release candidate, because s3 lags behind
[02:32:16] * strcat packaged the wrong thing :(
[02:32:30] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[02:32:43] <strcat> weird eventual consistency distributed nonsense! ;p
[02:33:17] <brson> strcat: i've thought about it. just requires yet more automation complexity
[02:34:14] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[02:39:31] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[02:39:36] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[02:39:37] *** ChanServ sets mode: +qo brson brson
[02:39:41] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: brson)
[02:39:46] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[02:39:46] *** ChanServ sets mode: +qo brson brson
[02:40:53] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[02:40:57] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[02:40:58] *** ChanServ sets mode: +qo brson brson
[02:45:28] *** kimundi is now known as zz_kimundi
[02:46:01] <cmr> strcat: so will make DESTDIR=playpen_root install should work?
[02:48:00] <strcat> cmr: it's in the arch repos
[02:48:14] <strcat> but yes
[02:48:59] * strcat wonders what cmr is plotting
[02:51:34] <cmr> I'm testing the libnative change.
[02:51:39] <cmr> to see if it fixes rusti
[02:52:09] <strcat> yeah but just wondering why you need to install it to a DESTDIR ;p
[02:52:19] *** Joins: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP)
[02:52:38] <cmr> oh just into the playpen without rebuilding a package.
[02:53:00] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[02:53:24] <strcat> cmr: oh, to install rust there, yeah
[02:53:32] <strcat> I interpreted it as installing *playpen* to some root
[02:53:39] <cmr> oh, no.
[02:54:18] * strcat still needs to build a 3.12.6 kernel with CLONE_NEWUSER support...
[02:55:44] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[02:57:09] <strcat> nooo...
[02:58:08] <strcat> I didn't let it run past the extra benchmarks :(
[03:01:34] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[03:01:34] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/9k-yuQ
[03:01:34] <ghrust> 13rust/06auto 14b36a948 15Daniel Micay: stop treating `Rc` cycles as unsafe
[03:01:34] <ghrust> 13rust/06auto 1477cc1c5 15Daniel Micay: add a strong/weak reference counted pointer type
[03:01:34] <ghrust> 13rust/06auto 14c5bcb22 15Daniel Micay: rename Strong -> Rc, replacing `rc` with `weak`
[03:01:36] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[03:04:58] <jack> strcat: if i have an @ inside a RefCell what can I do about that?
[03:05:34] <strcat> jack: @ inside a RefCell is fine, but @ inside Rc (including inside a RefCell) won't work
[03:05:50] <strcat> jack: have to make the inner one Rc too, or the outer one @
[03:06:01] <strcat> just hasn't ever worked
[03:06:36] <strcat> fixable but... @ will be gone soon enough
[03:08:27] <cmr> <3 being back at school
[03:08:34] <cmr> nothing like having a mirror on the gigabit LAN
[03:09:02] <strcat> an arch mirror?
[03:09:04] <cmr> yep
[03:09:18] <strcat> still going to take a long time to install rust-git ;p
[03:09:21] <cmr> yup
[03:09:21] <jack> is there a way to hook into the destructor of a task to know if it's the one that's generating this error?
[03:09:33] <cmr> I'm probably going to start mirroring it too.
[03:09:52] <cmr> speaking of
[03:09:52] <strcat> or I could push for having a [nightly] repo ;p
[03:10:14] <strcat> would need to figure out signing though
[03:10:17] <cmr> brson: I have a rack full of sparc hardware I could setup as a build slave if we ever get to that point.
[03:10:26] <strcat> brynhild could just have a key and sign stuff...
[03:12:15] *** Joins: a_m0d|home (a_m0d@moz-322A4DE4.acanac.net)
[03:13:21] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[03:13:21] *** ChanServ sets mode: +ao dherman dherman
[03:17:32] <jack> strcat: so that asssert (live_allocs.is_null) means that some @ data is still around that sholdn't be?
[03:17:41] <jack> or does it mean that it's not around and it should be?
[03:18:01] <strcat> jack: Rc uses ~ to allocate but doesn't account for headers added to ~ from @
[03:18:10] <strcat> because... originally it had a Send bound iirc
[03:18:15] <jack> strcat: there is no Rc here that i can tell.
[03:18:22] <strcat> jack: oh, then I'm at a loss ;p
[03:18:33] <strcat> perhaps a bug in a vector function
[03:18:36] <jack> i'm just trying to understand why this assert would trigger.
[03:18:44] <jack> what does that assert check for?
[03:18:58] <strcat> that the linked list is empty I guess
[03:19:04] <strcat> so, no live allocs
[03:19:19] <jack> a live alloc is a @ with non-zero ref count?
[03:19:35] <strcat> jack: well they have an intrusive linked list running through them and I guess that's checking that the list is empty
[03:19:42] <strcat> a task-local list
[03:20:21] <jack> so do you get something off of that list?
[03:20:47] <jack> s/so/how/
[03:20:50] <strcat> jack: at the end of the task, it walks the list to free cycles, look in std::cleanup
[03:21:04] <jack> and after it walks the list it checks that the list is empty?
[03:21:26] <strcat> jack: if you create @ cycles in dtors maybe it could go wrong... not sure
[03:21:45] <cmr> strcat: feh I'm getting `playpen: splice: Invalid argument` again :(
[03:21:57] *** Joins: ecr (chatzilla@7C463196.5BB0586B.11F8506F.IP)
[03:22:01] <jack> well, this code isi around LayoutData which is a RefCell<*()> on one side
[03:22:02] <strcat> cmr: hm, that's odd
[03:22:12] <jack> and a RefCell<Option<~LayoutData>> on the other
[03:22:27] <jack> i assume this Layoutdata has a @ buried in it somewhere.
[03:22:41] <jack> it's an @ that is owned by another task.
[03:22:41] <cmr> strcat: https://gist.github.com/cmr/11dde0b5498862d67ed3 from strace
[03:23:05] * strcat doesn't know why that'd happen
[03:23:09] <jack> because it's probably a DOM node from the script task
[03:23:14] <cmr> is playpen -s ./whitelist_all root-master /irc.sh incorrect in some way?
[03:23:28] *** Quits: zz_kimundi (kimundi@moz-9888D3CE.dip0.t-ipconnect.de) (Ping timeout)
[03:23:46] <jack> i guess i'm wondering how do i get that @ ptr off the layout task's list of live allocations.
[03:23:58] <strcat> cmr: need to specify that urandom is allowed too, and set a username
[03:24:17] <strcat> well maybe root works
[03:24:22] <strcat> I forget if I disallowed that ;p
[03:24:31] <cmr> hm, same with sudo :(
[03:24:53] * cmr copies args from web.py
[03:24:56] <strcat> jack: hm, I dunno
[03:25:46] <cmr> oh I get closer this time.
[03:26:52] <cmr> [22:26:33]~/hacking/rust-playpen> sudo playpen --user=rust --timeout=5 --devices=c:1:9 --syscalls-file=whitelist_all root-master -- irc.sh "foo"
[03:26:53] *** Joins: zz_kimundi (kimundi@moz-1273C77B.dip0.t-ipconnect.de)
[03:26:53] <cmr> <anon>:9:9: 9:12 error: unresolved name `foo`.
[03:26:54] *** zz_kimundi is now known as kimundi
[03:26:55] <cmr> <anon>:9         foo
[03:26:57] <cmr>                  ^~~
[03:26:59] <cmr> \o/
[03:27:12] <cmr> and with the normal whitelist
[03:27:15] <cmr> acrichto: ^ confirmation :)
[03:27:31] <acrichto> cmr: nice!
[03:27:45] <acrichto> cmr: would it take forever to build without libnative?
[03:27:54] <acrichto> I'm curious if it's still a problem
[03:28:00] <acrichto> the cause was never found if I remember right
[03:28:04] <cmr> actually wait.
[03:28:24] <strcat> cmr: pretty sure it can print warnings but still freeze
[03:28:31] <strcat> it happens during task exit or something
[03:28:42] <cmr> oh damn you're right
[03:29:02] <cmr> I really wonder what is wrong with this now.
[03:29:03] <acrichto> if you can get like bactraces or dtraces or something I could help take a look
[03:29:26] <cmr> I haven't found a good way to debug what runs inside the container
[03:29:39] <strcat> cmr: you can run a shell
[03:29:43] <strcat> I think
[03:30:03] <acrichto> what's the problem? like how does it manifest itself
[03:30:36] <acrichto> brson: how do you feel about removing print/println from the prelude?
[03:30:37] <cmr> sudo playpen --user=rust --timeout=5 --devices=c:1:9 --syscalls-file=whitelist root-master -- irc.sh 'println("foo");'
[03:30:38] <cmr> times out.
[03:30:44] <cmr> acrichto: I am not in favor.
[03:30:50] <acrichto> cmr: how come?
[03:30:51] <cmr> makes hello world that much longer :(
[03:30:56] <cmr> it's bad marketing!
[03:30:58] <acrichto> println! ?
[03:31:02] * cmr channels his inner bstrie
[03:31:07] <cmr> hm yeah that's probably fine
[03:31:08] <acrichto> but we still have print!
[03:31:10] <acrichto> and println!
[03:31:12] <cmr> yeah
[03:31:28] <acrichto> can you sudo dtrace playpen?
[03:31:34] <acrichto> or maybe strace on linux
[03:31:38] <cmr> is that just a syscall logger?
[03:31:40] <cmr> yeha I'm doing that now
[03:31:41] <acrichto> yeah
[03:31:45] <acrichto> just wondering where it's hanging
[03:31:49] <cmr> I've not been able to get anything discernable out of it
[03:31:50] <strcat> linux has dtrace but maybe it's not the same as OS X dtrace ;p
[03:31:50] <cmr> will paste
[03:31:58] <brson> acrichto: i feel ok about it since the macros are how everybody uses them
[03:32:04] <cmr> it seems it's actually getting a SIGSYS...
[03:32:12] <acrichto> brson: cool, I will r+ that then
[03:32:18] <acrichto> we have 3 yays
[03:32:18] <cmr> strcat: the whitelist is missing a syscall.
[03:32:42] <cmr> [pid 26974] close(3)                    = 0
[03:32:43] <cmr> [pid 26974] +++ killed by SIGSYS +++
[03:32:45] <cmr> wat
[03:32:58] <acrichto> close isn't whitelisted?
[03:33:01] <cmr> it is
[03:33:14] <cmr> it'd return -1 or sth if it failed, or wouldn't complete, or something.
[03:33:17] <acrichto> is strace following children?
[03:33:19] <brson> acrichto: is there any way to do a format! equivalent without doing the compile-time parsing. I need to do such a thing and don't have a string constant
[03:33:20] <cmr> yes
[03:33:22] <cmr> one sec.
[03:33:24] <cmr> pasting
[03:33:31] <acrichto> brson: yes, you can use fmt::Parse directly
[03:33:33] <strcat> close is whitelisted...
[03:33:37] <strcat> it's in the whitelist
[03:33:42] <acrichto> brson: sry std::fmt::parse
[03:33:46] <acrichto> parse::Parser
[03:33:51] <cmr> https://gist.github.com/8346576
[03:33:55] <strcat> cmr: possible rust needs more syscalls now but that's not the issue :]
[03:34:11] <acrichto> that's a lot of kills
[03:34:12] <brson> acrichto: thanks
[03:34:18] <cmr> strcat: well with whitelist_all it works.
[03:34:24] <acrichto> I don't see sigsys?
[03:34:27] <brson> acrichto: do you have any examples i can cryb from?
[03:34:33] <acrichto> argh case sensitive search
[03:34:39] <acrichto> brson: hmm... sadly no
[03:34:51] <acrichto> brson: although you create a parser, and then it implements an iterator
[03:35:01] <acrichto> brson: the parser just takes a &str I think, and it yields some parser enum
[03:36:43] <cmr> acrichto: strcat: https://gist.github.com/cmr/8346585 is a successful run with the expanded whitelist
[03:36:57] <acrichto> "This file has been truncated"
[03:36:58] <acrichto> lol
[03:37:02] <acrichto> that's a lot of syscalls
[03:37:06] <acrichto> Error: blob is too big
[03:37:07] <acrichto> wut
[03:37:15] <cmr> most of them probably futexes or something
[03:37:19] <acrichto> maybe a different pastebin service?
[03:37:19] <cmr> wut indeed
[03:37:21] <strcat> cmr: as in this works?
[03:37:22] <cmr> it didn't used to do this
[03:37:23] <cmr> yeah I will
[03:37:25] <cmr> strcat: yes.
[03:37:35] <dbaupp> cmr: printing and everything?
[03:37:40] <acrichto> cmr: I'd just be curious about the syscalls round the time of the old SIGSYS
[03:37:50] <cmr> acrichto: I have no diea how to filter that down.
[03:38:08] <acrichto> cmr: neither do I :P, although I could probably help more if I saw the file lol
[03:38:08] <dbaupp> cmr: 'grep -C 100 SIGSYS'?
[03:38:11] <acrichto> yay github!
[03:38:23] <cmr> dbaupp: no in the succesful run without a sigsys
[03:38:36] <dbaupp> oh
[03:39:06] <cmr> warning: this file is 46M
[03:39:12] <cmr> http://octayn.net/benches/foo
[03:39:21] <dbaupp> zip it?
[03:39:22] <acrichto> gzipp'd?
[03:39:27] <acrichto> too late, downloading!
[03:39:32] <acrichto> well, for the next 60s
[03:39:41] <cmr> gzip'd now
[03:39:45] <strcat> cmr: but... paste.xinu.at! ;p
[03:39:48] <cmr> your download will likely die :)
[03:39:58] <jack> there is apparently no @ and @mut in layout. how else does something get on this live_alloc list?
[03:40:08] <acrichto> wow gzip was fast
[03:40:27] <cmr> compressed to 536K
[03:40:30] <strcat> jack: just @ afaik...
[03:40:50] <jack> hm. seems there are some @s, but i'm not sure why they would ever escape
[03:40:51] <cmr> just hundreds of lines of mprotect for all the pages.
[03:41:02] <strcat> cmr: dynamic linkers.
[03:41:08] <cmr> gotta love 'em
[03:41:45] <bjz> what are we going to do about float errors?
[03:41:53] <cmr> half a billion lseeks and writes
[03:41:56] <strcat> bjz: hm?
[03:42:01] <cmr> bjz: on arm?
[03:42:05] <acrichto> cmr: the syscalls line up perfectly
[03:42:08] <bjz> as in
[03:42:19] <strcat> cmr: so does it work now? with libnative
[03:42:20] <strcat> what happens?
[03:42:22] <bjz> C has a global flag I think
[03:42:29] <acrichto> cmr: as in the first syscall which isn't present in the failing one is mkdir
[03:42:35] <strcat> bjz: hm?
[03:42:40] <cmr> strcat: it works with libnative with whitelist_all
[03:42:43] <cmr> acrichto: testing
[03:42:45] <strcat> cmr: ah
[03:42:49] <acrichto> is mkdir not whitelisted?!
[03:43:02] <cmr> doesn't work with mkdir whitelisted
[03:43:03] <bjz> like in the glibc implementation of fdim there is: __set_errno (ERANGE)
[03:43:11] <brson> can a macro invocation (besides macro_rules) create new macros?
[03:43:23] <acrichto> cmr: strace, what line does SIGSYS appear at?
[03:43:40] <dbaupp> brson: in theory, but there are bugs, aiui
[03:44:01] <strcat> bjz: so...
[03:44:02] <cmr> acrichto: 14349
[03:44:02] <bjz> strcat: float exceptions! that's it
[03:44:05] <strcat> bjz: this is the problem
[03:44:08] <cmr> 47, sorry.
[03:44:14] <acrichto> cmr: unlink?
[03:44:17] <strcat> bjz: the modern way to handle it is floating point exceptions, not errno
[03:44:21] <acrichto> or rmdir
[03:44:28] <dbaupp> brson: (e.g. `macro_rules! foo ( () => { macro_rules! bar ( ($x:expr) => { $x } ) )` will attempt to substitute the $x's when expanding `foo!()` and this fails)
[03:44:31] <strcat> bjz: LLVM *does not* support floating point exceptions or floating point rounding mode
[03:44:42] <strcat> bjz: and it doesn't really support errno for float errors either
[03:44:47] <cmr> mkdir+rmdir it was
[03:44:49] <bjz> strcat: should we fail!?
[03:44:49] <strcat> glibc uses it, but musl and the OS X libc don't
[03:44:53] <strcat> bjz: can't check
[03:44:53] <cmr> what is it using those for?
[03:44:55] <acrichto> cmr: it works now?
[03:44:57] <acrichto> tmpdirs
[03:44:57] <cmr> acrichto: yup!
[03:44:59] <cmr> ahhh
[03:45:00] <acrichto> that's hilarious
[03:45:03] <strcat> bjz: not portable to use errno
[03:45:04] <cmr> with libnative
[03:45:09] <acrichto> we haven't had rusti for months b/c of rmdir/mkdir?
[03:45:12] <strcat> acrichto: no
[03:45:13] <acrichto> cmr: this would work with libgreen
[03:45:21] <acrichto> libuv calls rmdir/mkdir
[03:45:24] <bjz> strcat: so there is no way with the llvm intrinsics?
[03:45:24] <strcat> acrichto: I never tried with libnative/libgreen
[03:45:30] <cmr> it still doesn't work with libgreen
[03:45:35] <acrichto> cmr: you sure?
[03:45:36] <bjz> strcat: is that what you're saying?
[03:45:37] <cmr> 100%
[03:45:41] <cmr> I just checked
[03:45:43] <strcat> acrichto: I had all the syscalls necessary whitelisted
[03:45:48] <acrichto> cmr: could you do the same thing? whitelist eerything?
[03:45:52] <jack> hmm. the boxes never escape.
[03:45:57] <dbaupp> brson: https://github.com/mozilla/rust/issues/9323 https://github.com/mozilla/rust/issues/6795
[03:45:58] <strcat> acrichto: you can just grep for SIGSYS
[03:45:58] <cmr> acrichto: nope
[03:46:02] <strcat> and if it's not there it's not the issue
[03:46:14] <acrichto> so libgreen still hangs?
[03:46:16] <cmr> yes
[03:46:22] <acrichto> do you know where in the strace?
[03:46:27] <dbaupp> brson: oh! I misinterpreted what you said.
[03:46:42] <strcat> it used to be a deadlock
[03:46:45] <strcat> iirc
[03:46:54] <acrichto> the runtime tends to change over the course of 3 moths
[03:47:05] <strcat> it's not the runtime's fault though
[03:47:10] <strcat> I am pretty sure it is a libuv bug
[03:47:16] <cmr> [pid 30837] epoll_wait(9,  <unfinished ...>
[03:47:18] <cmr> [pid 30836] epoll_wait(5,  <unfinished ...>
[03:47:20] <cmr> looks like.
[03:47:37] <acrichto> after that it times out?
[03:47:37] <strcat> acrichto: it doesn't like something about stdin, etc. as pipes
[03:47:40] <cmr> yes.
[03:47:50] <acrichto> hmm..
[03:48:15] <strcat> I'll just build rustc with libnative
[03:48:43] <cmr> well I think the PR should land anyway, if we're going to switch to libnative anyway might as well do it now for rustc?
[03:50:05] <brson> dbaupp: so can a macro define another macro?
[03:50:17] <cmr> brson: besides macro_rules not afaik
[03:50:25] <cmr> although maybe a macro could invoke macro_rules for some madness?
[03:50:39] <acrichto> cmr: where's your PR?
[03:50:51] <dbaupp> brson: I think you *can* write a macro taht expands to macro_rules! if you're careful to avoid the bugs
[03:50:51] <cmr> acrichto: sec changing the eisdir comment
[03:51:07] <acrichto> cmr: r=me, I want rusti back
[03:51:09] <dbaupp> brson: but no built-in macro beside macro_rules! can define new macros
[03:55:04] <cmr> p=1? https://github.com/mozilla/rust/pull/11431
[03:55:48] <acrichto> cmr: did you say you were updating the comment?
[03:56:19] <cmr> acrichto: and I did
[03:56:26] <acrichto> "libuv maps this to EISDIR"
[03:56:30] <cmr> ... or apparently I didn't
[03:56:36] <cmr> whoops forgot the -f on push
[03:57:52] <cmr> acrichto: r?
[03:58:22] <acrichto> r+
[03:58:26] <acrichto> cmr: thanks
[03:58:39] <dbaupp> acrichto: thanks
[03:58:51] <bstrie> agh, did anyone make sure that the rust-lang.org example works with 0.9?
[03:59:05] <dbaupp> bstrie: does it?
[03:59:19] <bstrie> I don't know!
[03:59:21] <dbaupp> looks like it does to me, although I'm not a compiler
[03:59:26] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[03:59:26] <bstrie> I'm not on a computer with rust right now :P
[03:59:31] <cmr> dbaupp: blasphemy!
[03:59:31] <acrichto> it works
[03:59:39] <cmr> it does
[03:59:44] <bstrie> ok good
[03:59:55] <cmr> brson even asked if anyone wanted to change it!
[04:00:01] * acrichto breathes a sigh of relief
[04:00:10] <cmr> acrichto: did you not check? :p
[04:00:17] <acrichto> oh I did
[04:00:26] <acrichto> not before though
[04:00:29] <cmr> heh
[04:00:31] <acrichto> as in before 0.9
[04:00:35] <cmr> ah
[04:00:48] <cmr> it's really hard to come up with a good small example of rust :(
[04:00:57] * dbaupp wonders what the traffic spike to rust-lang.org looks like
[04:01:10] <cmr> oh that reminds me I need to write the state of rust 0.9
[04:01:27] <cmr> poo I meant to have that done before the release
[04:01:49] <cmr> TWiR readership is definitely trending up though
[04:02:12] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[04:02:12] *** ChanServ sets mode: +ao dherman dherman
[04:03:00] *** Quits: a_m0d|home (a_m0d@moz-322A4DE4.acanac.net) (Quit: Leaving.)
[04:03:24] <cmr> acrichto: is there anything tricky our buildsystem does? afaict most of the madness stems from bootstrapping and cross-compiling. $(1) etc
[04:03:27] <dbaupp> cmr: what sort of traffic do you see?
[04:03:42] <cmr> dbaupp: about 1.5k unique hits on each twir post the past few weeks.
[04:03:50] <acrichto> cmr: tricky in what respect? it's all mostly tricky for self-hosting
[04:04:05] <cmr> acrichto: in that it's something that'd be hard to port to another build system
[04:04:11] <cmr> and do we have any idea what build system we want to use?
[04:04:36] <acrichto> I'm a little unclear on whether rustc can ever use a rust-generated buildsystem (or something like that)
[04:04:42] <acrichto> but it sould be a good run for its money at least
[04:04:52] <cmr> dbaupp: ok that number was uverzealous, 
[04:04:58] <cmr> I feel like we should be able to?
[04:05:10] <acrichto> cmr: it's been talkeda bout in the past to generate ninja files from crates
[04:05:15] <cmr> fetch the snapshot + build the build system (lol) in a shell script.
[04:05:23] <acrichto> which I assume would magically include all dependencies
[04:05:26] <cmr> hrm
[04:05:40] <cmr> I'm not sure that'd be too useful for anything except rustc where all deps are already there.
[04:06:17] <acrichto> well crates in general need dependency management
[04:06:26] <acrichto> like you need to understand when to build upstream crates and such
[04:06:40] <cmr> maybe rustc --crate-deps ?
[04:06:52] <cmr> print the names of the crates it depends on
[04:07:01] <acrichto> that wouldn't suffice though
[04:07:08] <acrichto> it may work
[04:07:16] <acrichto> but you need to warn about msising ones
[04:07:22] <acrichto> error on outdated binaries without source
[04:07:25] <acrichto> and rebulid those with source
[04:07:27] <acrichto> (in theory)
[04:07:35] <acrichto> this is all too handwavy
[04:07:41] <cmr> agree :)
[04:07:54] <cmr> want me to post to the mailing list asking for ideas?
[04:08:22] <acrichto> I suppose we're not really in a state of "we have a good idea of what to do next" so perhaps a round of bikeshedding is in order
[04:08:41] <acrichto> it's unclear how much the buildsystem will do though
[04:09:18] <cmr> dbaupp: http://i.imgur.com/mFb6Gbg.png
[04:10:33] <dbaupp> cmr: awesome
[04:12:57] <acrichto> brson: do you want to go ahead and add llvm/gyp/libuv to rust-lang?
[04:13:00] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[04:14:56] <dbaupp> acrichto: are we moving to github.com/rust-lang?
[04:15:13] <acrichto> dbaupp: I think brson reserved it, but we're not moving there completely just yet
[04:15:22] <acrichto> it just seems weird to have those repos floating around
[04:16:16] <dbaupp> it gives us more of that small-town homely feel, core repos stored in "random" people's houses :P
[04:16:23] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[04:16:23] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/9k-yuQ
[04:16:23] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[04:16:24] <acrichto> lol
[04:17:05] <cmr> I was quite surprised when I saw llvm went to luqmana/llvm.git :p
[04:17:23] <cmr> yay Weak landed
[04:17:27] <Luqman> cmr: it's jumped around a lot :P
[04:17:51] <acrichto> Luqman has the honor of having the "most recent LLVM updater badge"
[04:18:32] <brson> acrichto: I made you an owner of rust-lang
[04:18:38] * acrichto goes to work
[04:18:46] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[04:19:22] <acrichto> now I just want to rewrite all of rust's history to always point to llvm :D
[04:19:25] <acrichto> rust-lang*
[04:20:31] <acrichto> Luqman: rust-lang/llvm will forever have been originally forked from you
[04:20:46] <Luqman> haha amazing
[04:21:19] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[04:21:19] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/5uJsuw
[04:21:19] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[04:21:22] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[04:21:22] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/IPh6dw
[04:21:22] <ghrust> 13rust/06auto 1465ce505 15Huon Wilson: std::rt: require known stack bounds for all tasks....
[04:21:22] <ghrust> 13rust/06auto 14f78293c 15bors: auto merge of #11360 : huonw/rust/stack_bounds, r=alexcrichton...
[04:21:22] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[04:21:22] <Luqman> so llvm.org/git -> chapuni -> brson -> luqmana -> rust-lang
[04:21:30] <acrichto> lol
[04:21:32] <dbaupp> as far as the history will tell, Luqman wrote the entirely of Rust's LLVM.
[04:22:01] * dbaupp conveniently ignores the actual commit history
[04:22:59] <acrichto> "
[04:22:59] <acrichto> Temporary fork of LLVM for Rust
[04:23:00] <acrichto> "
[04:23:06] <Luqman> we're only down to 4 patches now though!
[04:23:07] <acrichto> "Temporary"
[04:23:18] <Luqman> 3 of which i think we don't even really need anymore
[04:23:40] <acrichto> I'm counting 6?
[04:23:42] <acrichto> https://github.com/rust-lang/llvm/commits/rust-llvm-2013-12-27
[04:23:49] <acrichto> I guess the workaround shouldn't be there
[04:23:50] <Luqman> oh, oops. was looking at master
[04:23:59] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[04:24:18] <Luqman> well, 5 of which we don't really need since we dropped segmented stacks
[04:24:36] <acrichto> we kept __morestack though
[04:24:40] <acrichto> and they're all support for __morestack
[04:25:03] <cmr> I really want to kill them.
[04:25:18] <cmr> Is there any way to add a custom prologue to a function?
[04:25:22] <cmr> (to touch the stack)
[04:25:23] <acrichto> pcwalton and I were talking about this the other day
[04:25:30] <acrichto> we *think* that we can remove them altogether
[04:25:35] <dbaupp> we could emit a custom prelude, right?
[04:25:37] <acrichto> and have unwinding on stack overflow
[04:25:51] <acrichto> it would involve llvm modifictions still though
[04:25:53] <acrichto> which is unfortunate
[04:25:58] <klutzy> https://github.com/klutzy/rust/compare/something
[04:26:02] <cmr> we need a way to get a function's stack size out of llvm
[04:26:05] <klutzy> I'm not sure I'm not breaking anything :-/
[04:26:05] <acrichto> our history of upstreaming llvm patches is... interesting
[04:26:18] <cmr> or an intrinsic that does so.
[04:26:21] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[04:26:24] <klutzy> lots of tests fail, but it's same for vanilla one..
[04:26:31] <acrichto> cmr: I'm not sure that there's much useful you can do with that though
[04:26:42] <acrichto> nothing can optimize for it b/ca all passes run before lowering (I think)
[04:26:53] <cmr> acrichto: what do you mean?
[04:27:05] <acrichto> so the aboslute optimal thing
[04:27:11] <acrichto> load page_size + %esp
[04:27:15] <cmr> yes
[04:27:22] <acrichto> how do you express that in LLVM IR?
[04:27:27] <cmr> well, you can't.
[04:27:32] <acrichto> yeah :(
[04:27:38] <dbaupp> inline asm!
[04:27:42] <acrichto> I'd think that the prelude for functions would be modified
[04:27:47] <acrichto> like with __morestack
[04:27:50] <dbaupp> (ick for optimisation though)
[04:27:57] <acrichto> if you have N pages of stack you do N loads
[04:28:05] <cmr> we should really copy the exact behavior of MSVC IMO
[04:28:08] <acrichto> or we tell LLVM we have M guard pages and you do N/M loads
[04:28:20] <acrichto> if we wnt unwinding, we have to be really careful
[04:28:28] <acrichto> and we very much want unwinding (we don't have it right now)
[04:28:44] <acrichto> the chkstk approach won't work for us
[04:28:52] <acrichto> b/c it only runs on functions of > 1page stack
[04:28:53] <cmr> we need to unwind *before* we run out of stack.
[04:28:56] <acrichto> and we need it to run on all functions
[04:29:15] <acrichto> we may be able to get it to unwind on a fault
[04:29:27] <acrichto> llvm has a donothing intrinsic which you can invoke (and generates a landing pad)
[04:29:38] <acrichto> although last I tried I couldn't get libcxxabi to enter the landing pad
[04:29:47] <acrichto> I didn't try too hard though
[04:30:06] <cmr> I've thought about that and it sounds really really really nasty. We'd need a signal handler to check the ip and whether it was in a stack check handler, which task it was in, etc, wouldn't we?
[04:30:30] <acrichto> well no I don't think we can have a stack check function
[04:30:39] <acrichto> it works on msvc b/c they only run it on huge functions
[04:30:42] <acrichto> we need to run it on all functions
[04:30:49] <acrichto> which is unreasonable for small functions
[04:31:15] <acrichto> you're right though, sigals are terrible and I'm not 100% sure we can actually modify the execution context from a signal handler on all platforms
[04:31:20] <acrichto> and this also only works with an MMU
[04:31:46] <cmr> (by stack check handler I mean whatever we emit that probes the stack, not necessarily a function; it just needs to be a known IP for us to not be overzealous about what we handle)
[04:32:02] <acrichto> not necessarily, we just need to know about the faulting address
[04:32:05] <acrichto> the IP doesn't matter too much
[04:32:20] <acrichto> I think we could safely assume that faults in the red zone are stack checks
[04:32:32] <acrichto> at last safe rust shouldn't dereference out of bounds memory
[04:32:37] <cmr> I'm not sure about that. If we call a C function and it overflows after calling a C++ function, we're going to miss destructors.
[04:32:37] <acrichto> at least*
[04:32:37] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[04:32:46] <cmr> Although it's still unsafe, it's a concern we should care about.
[04:33:01] <cmr> Because if we still leak on unwinding, I don't think it's a valid strategy.
[04:33:03] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[04:33:13] <acrichto> I'm not sure we shoudl focus on recoving C/C++ on stack overflow
[04:33:34] <acrichto> we don't guarantee that we recover C/C++ on normal failure
[04:33:42] <cmr> yeah that's true.
[04:33:48] <acrichto> although faulting in C is a good point
[04:33:49] <cmr> if C++ calls a rust fn that unwinds, it's screwed.
[04:33:51] <acrichto> I hadn't thought much about that
[04:34:07] <acrichto> oh nvmd this would still work
[04:34:14] <acrichto> so our idea was this
[04:34:34] <acrichto> 1) modify llvm to emit minimal prologues that trigger aborts, we generate a landing pad in IR (hence we clean up our arguments)
[04:35:01] <acrichto> 2) the signal handler maps in the guard zone, puts a new guard page at the very end, and arranges for you to start in a function that is essentially "fail!()"
[04:35:14] <acrichto> 3) you resume from the signal handler, immediately fail!(), and then unwind
[04:35:30] <acrichto> this cleans up everything on the stack, and then stack overflow again is a process abort (like double failure is a proces abort)
[04:36:02] <cmr> I'm unsure if we can implement this without races.
[04:36:10] <acrichto> that we can all implement without races
[04:36:19] <acrichto> I think segfault handlers run on the thread receiving the fault
[04:36:24] <acrichto> there's no global stat
[04:36:26] <acrichto> state*
[04:36:38] <cmr> do thread-locals work in signals?
[04:36:46] <acrichto> we wouldn't use thread locals?
[04:36:54] <cmr> how else do we avoid global state?
[04:36:57] <cmr> wait
[04:37:00] <acrichto> you don't need state
[04:37:19] <acrichto> you take the incoming context, and then arrange for it to go back and invoke fail!()
[04:37:20] <cmr> yeah we don't
[04:37:49] <acrichto> this is all super tricky code though
[04:37:50] <sfackler> did something change with resolve recently?
[04:37:55] <acrichto> and I'm unsure of whether this is the best approach
[04:38:05] <sfackler> I have an impl<S: Stream> Reader for SslStream<S>
[04:38:06] *** Quits: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP) (Connection reset by peer)
[04:38:07] <cmr> hrm
[04:38:09] <acrichto> sfackler: yes
[04:38:15] <sfackler> and I have a thing of type S that apparently can't find read or eof
[04:38:22] <acrichto> sfackler: traits imported by a parent module were leaking into the child module
[04:38:28] *** Joins: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP)
[04:38:29] <acrichto> I also removed eof() from the reader trait
[04:39:07] <sfackler> oh, cool, I just misread the error message
[04:39:24] <cmr> acrichto: that code is going to be so utterly nasty.
[04:39:27] <acrichto> cmr: a primary motivation of getting away from __morestack is to not have literally all rust code forever depend on a __morestack symbol
[04:39:28] <cmr> but I think it can work, yeah.
[04:39:45] <acrichto> in theory our stack safety strategy shold have 0 depednencies
[04:39:50] <cmr> I agree.
[04:39:54] <acrichto> and only if the infrastructure is in place does it all get active
[04:40:03] <acrichto> and ideall it's on by dfeault and impossible to turn off
[04:40:35] <cmr> well I'm not sure about *that*. isn't there someone right now trying to use rust without an mmu?
[04:41:05] <acrichto> well this would work without an mmu in the sense that it would compile, it would not work in the sense that you could use it for stack safety
[04:41:12] <acrichto> stack safety without an mmu requires __morestack I think
[04:41:43] <acrichto> it would be nice to use upstream llvm though...
[04:44:21] <cmr> I still think a unsafe-no-stack-check is going to be necessary, if only for that last few % of performance in embedded.
[04:44:26] <sfackler> acrichto: would you be okay with adding eof to MemReader and BufReader?
[04:44:45] <acrichto> sfackler: I'd be ok with that
[04:44:52] <acrichto> sfackler: how come?
[04:46:04] <sfackler> I load a frame into a MemReader, parse it and then make sure I've read it all
[04:46:08] <sfackler> as a sanity check
[04:46:46] <acrichto> I did that somewhere
[04:47:06] <acrichto> rdr.tell() == rdr.get_ref().len()
[04:47:33] <sfackler> you also need a cast in there too
[04:47:59] <acrichto> it's not impossible today
[04:48:08] <acrichto> but it could be more convenient yeah
[04:49:05] <cmr> acrichto: is anyone planning on implementing that crazy stack stuff or is someone going to write it down for post-1.0?
[04:49:21] <acrichto> cmr: it's not a high priority right now, post-1.0
[04:49:31] <acrichto> (not to say we wouldn't take patches of course!)
[04:49:52] <cmr> not saying I'm going to make patches! just curious if it was a priority.
[04:50:01] <strcat> cmr: it's an LLVM issue anyway
[04:50:02] <strcat> gcc supports it
[04:50:19] <acrichto> we can't "just use __chkstk"
[04:50:33] <cmr> strcat: not what was described above
[04:52:53] *** Joins: mudpit (Mibbit@moz-DC71C200.kanagawa.ocn.ne.jp)
[04:54:56] <cmr> nrc: dxr in the compiler is exciting :)
[04:55:19] *** Quits: mudpit (Mibbit@moz-DC71C200.kanagawa.ocn.ne.jp) (Quit: http://www.mibbit.com ajax IRC Client)
[04:55:22] <nrc> cmr: cool :-)
[04:55:27] <nrc> it's getting there
[04:55:36] <cmr> rustfind was super cool but it was an external tool
[04:55:44] *** Quits: aatch (James@moz-B437F499.pocketrent.com) (Client exited)
[04:56:40] <nrc> not sure how I'm going to persuade anyone to let me land my changes into rustc, might have to turn it into something more generic
[04:56:59] <cmr> hey I'll buy it.
[04:57:16] * nrc keeps that r=cmr for later...
[04:57:21] <cmr> :P
[04:57:38] <cmr> although this might be an argument for being able to plug in passes at runtime
[04:57:55] <cmr> so we could keep it in-tree and building, but not have it hardcoded into the compiler.
[04:59:03] <cmr> nrc: will it also have a jump-to-definition or type annotations?
[04:59:27] <nrc> I don't think that should be hard if the things we want to plug in are in the tree. It would be cool to do that with dynamically loaded stuff, but that is harder
[04:59:31] <nrc> cmr: already does
[04:59:36] <cmr> awesomesaucem
[04:59:40] <cmr> I couldn't tell by looking at the commits
[05:00:12] <nrc> yeah, I just committed when I felt like it and used the last thing I did as the commit  message, a lot of them have a lot more in
[05:01:54] <nrc> the big things left to do are methods - looking up callers/callees/jump to def, etc. - and working with multiple crates
[05:02:06] *** Quits: Kxepal (Miranda@moz-81616591.pppoe.mtu-net.ru) (Quit: Kxepal)
[05:02:19] <cmr> methods aren't easy, and multiple crates is painful.
[05:02:23] *** Joins: Kxepal (Miranda@moz-81616591.pppoe.mtu-net.ru)
[05:02:31] <nrc> theres a bunch of other things, but mostly small or easy and a whole bunch of refactoring/code clean up
[05:02:35] <cmr> metadata isn't fun :(
[05:02:39] <nrc> yeah
[05:03:06] <nrc> method stuff shouldn't be too bad, we already do ti for C++, so Rust should be easier :-)
[05:03:14] <nrc> multiple crates will be interesting....
[05:03:34] <cmr> well it's convincing the compiler to give you the method that's not as easy.
[05:03:38] <nrc> oh and macros, that'll be interesting too...
[05:03:40] <cmr> iirc they have their own maps etc.
[05:04:00] <cmr> (not just the defmap)
[05:04:17] <nrc> that didn't look too bad, but I should not say that until I've actually done it...
[05:04:23] <sfackler> acrichto: https://github.com/mozilla/rust/pull/11437
[05:04:33] <cmr> it isn't, really. just not as nice as, say, locals.
[05:09:08] <dbaupp> nrc: fwiw, it seems reasonable for a mozilla tool (rustc) to have built-in support for another mozilla tool (dxr). (At least initially, so you don't have to keep forward porting it if/while you make it more generic.)
[05:10:44] <cmr> I think it sets a bad precedent, but it's fairly easily fixable, and me wanting dxr support overrides any concern about it :)
[05:12:46] <nrc> yeah, I agree with the precedent
[05:13:26] <cmr> I want to integrate it with rustage
[05:13:27] <nrc> once we get to 1.0 it should be easy enough to keep it outside the tree and just plug it in
[05:13:39] <cmr> (and yes I'm totally adopting that name)
[05:13:42] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[05:13:54] *** Quits: gwty (gwtypc@D1719613.914FDA14.F44414AF.IP) (Ping timeout)
[05:14:04] <nrc> what is rustage?
[05:14:06] <dbaupp> nrc: and once we get compiler plug-ins :)
[05:14:21] *** Joins: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP)
[05:14:43] <nrc> dbaupp: should be easy enough, at least for compiled in plugins
[05:14:54] <nrc> and if we are obliged to maintain an API for evermore
[05:14:55] <dbaupp> cmr: maybe we should rename rustc to grc and write Learn You A Rust too :P
[05:15:26] <dbaupp> I think the API one will be the hardest/most annoying part
[05:15:48] <nrc> given how long DXR indexing takes, rebuilding Rust before hand is no big deal
[05:15:57] <brson> how do you generate a unique Ident in the compiler?
[05:16:33] <eddyb> brson: see ast_util and the SyntaxContext madness, I think
[05:16:57] <dbaupp> brson: interner.gensym("arbitrary_string"), iirc
[05:17:07] <eddyb> I know there's code in there somewhere which does hygienic renaming
[05:17:11] <dbaupp> brson: (which gives you a Name that you can wrap into an Ident)
[05:17:24] <dbaupp> (there may be a nicer way)
[05:17:44] <dbaupp> nrc: how long does it take on the rust tree?
[05:18:00] <cmr> nrc: rustage is my hypothetical "hackage for rust" -- a central package repository.
[05:18:06] <nrc> dbaupp: don't know about that - it is no way ready
[05:18:22] <nrc> dbaupp: it takes about four hours to do Firefox on a very fast machine
[05:18:26] <eddyb> dbaupp: interesting, but wouldn't that be picked up by resolve and conflict with any "arbitrary_string" in scope?
[05:18:33] <dbaupp> nrc: oh, ok :)
[05:18:34] <dbaupp> eddyb: no
[05:18:38] <cmr> eddyb: no, gensym adds a nonce to it
[05:18:47] <cmr> the arbitrary_string is just for debugging/documentation
[05:19:01] <cmr> it turns into 13460598arbitrary_string
[05:19:16] <eddyb> lol, what a hack
[05:19:23] <cmr> not really, it's pretty damn useful :)
[05:19:23] <dbaupp> nrc: well, rustc/src is ~300k lines iirc, which is much smaller than firefox, right?
[05:19:36] <eddyb> cmr: Idents can already be unique even if they have the same Name
[05:19:39] <dbaupp> cmr, eddyb: I thought it just avoiding going through the interning hashmap?
[05:19:45] <nrc> dbaupp: yeah much
[05:19:49] <cmr> dbaupp: not iirc?
[05:19:56] <dbaupp> to the source!
[05:19:59] <cmr> I remember asking jclements about it when I went to rewrite the interner.
[05:20:11] <nrc> dbaupp: but we would be indexing it along with multiple Firefox trees, probably
[05:20:50] <dbaupp> cmr, eddyb: https://github.com/mozilla/rust/blob/master/src/libsyntax/util/interner.rs#L122-L128
[05:21:03] <eddyb> cmr: at least locals in a function, I know you can have multiple with the same Name and they won't conflict (hygiene for macros)
[05:21:32] <brson> eddyb: dbaupp: thanks
[05:21:36] <eddyb> brson: where would you use this Ident?
[05:23:21] <dbaupp> brson: ah, theres also a free standing `syntax::parse::token::gensym(&str)` to save you having to retrieve the interner yourself
[05:23:56] <dbaupp> cmr: maybe you were thinking of fresh_name?
[05:24:07] <cmr> ahh that sounds about right
[05:24:14] <dbaupp> https://github.com/mozilla/rust/blob/master/src/libsyntax/parse/token.rs#L576-L577
[05:24:33] <dbaupp> (fun fact: that is a very expensive implementation; should be using task_rng() not rng().)
[05:24:37] <brson> eddyb: i'm creating an extension that only has side effects so i'm just going to spit out a dummy mod as the result
[05:32:10] *** Quits: ChristopherBurg (Christophe@moz-2C03E71B.hfc.comcastbusiness.net) (Quit: NO CARRIER)
[05:32:12] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[05:32:12] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/IPh6dw
[05:32:12] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[05:35:35] <brson> how do you parse a TokenTree to an Expr?
[05:36:30] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[05:36:30] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/pgCb7g
[05:36:30] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[05:36:34] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[05:36:35] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/1Bqc3w
[05:36:35] <ghrust> 13rust/06auto 14b92174d 15Patrick Walton: libsyntax: Make managed box `@` patterns obsolete
[05:36:35] <ghrust> 13rust/06auto 14e4357be 15Patrick Walton: librustc: Remove `@` pointer patterns from the language
[05:36:35] <ghrust> 13rust/06auto 141186823 15bors: auto merge of #11305 : pcwalton/rust/at-patterns, r=cmr...
[05:36:36] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[05:36:47] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[05:37:03] <brson> nvm
[05:37:04] <cmr> You know considering how much we change the language, I really don't see many changes to compiletest.
[05:37:15] <cmr> Which is pretty cool :)
[05:37:24] <cmr> (I didn't know it existed for a while after I started contributing)
[05:38:08] <dbaupp> cmr: as in, the language is stable enough for that to just sit there mostly unmaintained?
[05:38:29] <cmr> dbaupp: that, or that it's written in a mostly-unchanging subset.
[05:38:32] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[05:39:42] <cmr> it seems to be a bit of both
[05:47:09] *** Quits: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP) (Ping timeout)
[05:48:46] * bjz is wondering whether a subset of http://hackage.haskell.org/package/numeric-prelude might be a good idea for libnum
[05:50:14] *** Joins: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP)
[05:52:03] * cmr -> bed
[05:54:13] <dbaupp> bjz: can we call it liblesspain?
[05:54:21] <bjz> heh
[05:56:24] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[05:56:24] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 141186823 to 14f78293c: 02http://git.io/N3iJvQ
[05:56:24] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[05:56:26] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[05:56:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/JrGbZw
[05:56:26] <ghrust> 13rust/06auto 14f2a86a2 15Alex Crichton: Register new snapshots
[05:56:26] <ghrust> 13rust/06auto 14c72f984 15bors: auto merge of #11418 : alexcrichton/rust/snapshots, r=cmr
[05:56:26] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[05:57:36] <jld> Did we break `make check-stage1-rpass` at some point?
[05:57:48] <eddyb> jld: acrichto is saying it needs a snapshot
[05:57:49] *** Quits: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[05:58:17] <eddyb> jld: had to compile stage3 rustc to test rustpkg :(
[05:59:27] *** Joins: bjz (bjz@B398BE78.F804C29E.D35A31DF.IP)
[05:59:37] <acrichto> snapshots are going through as we speak
[05:59:39] <acrichto> (hopefully)
[06:00:09] <jld> And then, once this build finished and (hopefully) breaks the test I added, I'll do it again to test the one-line fix.
[06:00:40] <jld> (Specifically, deleting a bad assertion I added and didn't catch at any point including the last two(?) times someone tripped over other instances of it.)
[06:01:28] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[06:01:28] *** ChanServ sets mode: +ao dherman dherman
[06:08:55] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[06:31:04] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[06:32:37] *** Quits: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net) (Connection reset by peer)
[06:33:52] *** Quits: canhtak (canhtak@moz-DB18D73D.wl.t.ulaval.ca) (Quit: canhtak)
[06:52:16] *** Quits: ecr (chatzilla@7C463196.5BB0586B.11F8506F.IP) (Quit: ChatZilla 0.9.90.1 [Firefox 26.0/20131205075310])
[07:01:08] *** Joins: dev14 (devarshdes@moz-4EB22C7B.san.res.rr.com)
[07:04:37] <dbaupp> acrichto, cmr: https://github.com/mozilla/rust/issues/11443
[07:04:48] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Ping timeout)
[07:05:41] <eddyb> http://static.rust-lang.org/doc/master/rustc/index.html *jaw dropped*
[07:05:44] <dbaupp> geeez, http://static.rust-lang.org/doc/master/rustc/middle/ty/index.html
[07:06:17] <eddyb> dbaupp: I remember some huge chunks of documentation. maybe typeck::infer?
[07:06:45] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[07:06:45] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/JrGbZw
[07:06:45] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[07:07:28] <eddyb> http://static.rust-lang.org/doc/master/rustc/middle/typeck/infer/index.html doc module is missing :(
[07:07:45] <dbaupp> eddyb: see #11443
[07:08:14] <eddyb> oh, right, I see what you mean now
[07:08:52] <eddyb> dbaupp: so beautiful now <3 http://static.rust-lang.org/doc/master/syntax/ast/index.html
[07:09:35] <dbaupp> eddyb: https://botbot.me/mozilla/rust/msg/9597635/
[07:11:04] <eddyb> for some reason, the Matcher type doesn't get documented http://static.rust-lang.org/doc/master/src/syntax/home/rustbuild/src/rust-buildbot/slave/doc/build/src/libsyntax/ast.rs.html#701
[07:11:29] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[07:11:29] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/xKue4g
[07:11:29] <ghrust> 13rust/06auto 14580db13 15Corey Richardson: syntax: add better error message for unexpected inner attrs...
[07:11:29] <ghrust> 13rust/06auto 14980dd1d 15Corey Richardson: driver: use libnative
[07:11:30] <ghrust> 13rust/06auto 1429ac507 15bors: auto merge of #11431 : cmr/rust/upstream, r=alexcrichton...
[07:11:32] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[07:13:41] <eddyb> is that fixing rusti :D?
[07:13:46] <strcat> yes
[07:21:46] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[07:22:39] <acrichto> cmr: hm, we may be spawning a native thread with too large a stack
[07:23:48] <jld> task 'rustc' has overflowed its stack
[07:23:50] <jld> Sigh.
[07:24:19] *** Joins: ecr (chatzilla@7C463196.5BB0586B.11F8506F.IP)
[07:24:25] <acrichto> but at least you know what happened!
[07:24:32] <jld> I just tried to unstructify nullable pointers, to deal with #11040/#11303.
[07:26:21] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[07:26:21] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1429ac507 to 14c72f984: 02http://git.io/N3iJvQ
[07:26:21] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[07:26:28] <jld> Oh, I see.  Infinite recursion.
[07:26:35] <jld> ...which none of the existing tests caught.
[07:27:11] *** Quits: ecr (chatzilla@7C463196.5BB0586B.11F8506F.IP) (Quit: ChatZilla 0.9.90.1 [Firefox 27.0/20140106141415])
[07:27:15] <jld> I mean, none of the run-pass tests.  Maybe.
[07:28:44] <jld> enum UniqueList { ULNil, ULCons(~UniqueList) }
[07:31:41] <jld> Making that not be a struct *and* not be an unrepresentable infinite type is, um.
[07:31:44] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[07:31:44] *** ChanServ sets mode: +ao pcwalton pcwalton
[07:32:23] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[07:32:57] <dbaupp> eddyb: https://github.com/mozilla/rust/issues/5016 btw
[07:33:18] <eddyb> dbaupp: GAAH. I spent 5 minutes looking for a similar issue
[07:33:36] <dbaupp> eddyb: you've still got the "Avoid placing immutable lvalues in allocas" part
[07:34:01] <eddyb> dbaupp: hmm, yeah
[07:34:25] <dbaupp> (also, fwiw, I didn't suggest the moving out thing; I saw pcwalton or nmatsakis say it somewhere.)
[07:35:39] <jld> Maybe brson is right and people should stop using optional pointers in FFI.
[07:35:55] *** Quits: summerlight_ (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[07:36:00] <dbaupp> jld: just use *T?
[07:36:22] <dbaupp> (what about nullable function pointers?)
[07:36:29] <jld> dbaupp: https://github.com/mozilla/rust/issues/11303#issuecomment-31809083
[07:36:41] <jld> Nullable function pointers are what got us into this.
[07:38:09] <jld> I wonder how awful it would be to have a repr flag that applies only to newtypes or option-ish enums that removes the struct layer.
[07:38:12] <benh> Maybe we ought to have &'static fn() and *fn() and one of them is nullable?
[07:38:27] <benh> instead of plain fn()
[07:39:09] <jld> Thing is.. the only reason why Option<whatever> isn't what those programs want is because the i386 ABI treats it differently in return types.
[07:39:32] <jld> Which seems like a silly reason to change lots of code to use something that's arguably less intuitive.
[07:39:55] <eddyb> jld: where does the ABI get it wrong?
[07:40:03] <eddyb> s/wrong/different
[07:40:23] <jld> eddyb: Structs are returned in memory, even if they're <= 32 bits; primitives are returned in %eax.
[07:40:56] <eddyb> jld: ouch. that's a nasty thorn
[07:41:24] <jld> eddyb: We already ran into it for C-like enums, and I fixed them.  But they don't have the recursive-type problem.
[07:41:30] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[07:43:16] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[07:44:10] <benh> And generally pretending that structs <= 32bits are really primitives won't work? :D
[07:44:26] <jld> I assume we want to not break compatibility with C structs.
[07:45:06] <benh> Do rust enums, with fields, really want to be compatible with C structs?
[07:45:21] <eddyb> dbaupp: I didn't come across this kind of IR bloat with my small tests, but it's bad in library code. imagine trans generating *only* "ret { i64, i64, [0 x i8] }* %1" for that function :D
[07:46:23] <jld> ...maybe.  There is, and I really need to document this one of these days, a simple translation of any FFI-safe enum into a combination of C struct/union/enum.
[07:46:45] <jld> For values of "FFI-safe" that also aren't written down.
[07:51:50] *** flaper87|afk is now known as flaper87
[07:54:16] <eddyb> I am tempted to try to get a review on https://github.com/mozilla/rust/pull/11252 - without the ByValue part
[08:05:11] <acrichto> bjz: ping
[08:08:22] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[08:11:12] *** Quits: dev14 (devarshdes@moz-4EB22C7B.san.res.rr.com) (Quit: dev14)
[08:27:55] <bjz> acrichto: pong
[08:28:25] <dbaupp> eddyb: that PR needs a rebase
[08:28:33] <eddyb> dbaupp: almost done ;)
[08:28:47] <dbaupp> eddyb: what does clang generate for the equivalent function? (for the IR bloat)
[08:29:15] <eddyb> dbaupp: I wish C++ had tuples :(
[08:32:13] <eddyb> dbaupp: oh, it's hard to do... I need to implement a structure with a dtor and a move ctor/operator. and the semantics aren't identical
[08:33:34] <dbaupp> eddyb: ok, doesn't really matter for now :)
[08:33:43] <dbaupp> (get back to that rebase! :P )
[08:36:37] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[08:36:38] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/fByT2Q
[08:36:38] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[08:41:23] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[08:41:23] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/J8zZRQ
[08:41:23] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[08:41:26] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[08:41:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/rUPxNA
[08:41:26] <ghrust> 13rust/06auto 141ea3052 15Alex Crichton: Update submodules to point to rust-lang repos
[08:41:26] <ghrust> 13rust/06auto 14587d0f5 15bors: auto merge of #11436 : alexcrichton/rust/update-forks, r=huonw...
[08:41:26] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[08:49:20] <eddyb> dbaupp: I like strcat's proposal in #5016, I didn't think of that myself because it's a complication (but not a big one)
[08:50:42] <eddyb> if I get this PR through, it will have (commented out) code to pass arguments by value (without allocas), will make testing a fix easy
[08:50:54] <dbaupp> commented out?
[08:51:04] <dbaupp> rather than... just not there?
[08:52:38] <eddyb> actually, I'll have it in if false. because it uses an argument that would look unused otherwise
[08:53:01] <eddyb> dbaupp: it factors a few things in - debuginfo and mutability
[08:53:02] <dbaupp> fun fact, `if false { ... } something();` used to crash LLVM
[08:53:14] * dbaupp fixed that as his first trans patch
[09:00:02] <eddyb> what's the easiest way to get a string slice with the name of an argument?
[09:00:18] <eddyb> (why does a PatIdent contain a Path an not an Ident?
[09:00:22] <eddyb> )
[09:01:31] <jpoirier> I  posted on HN (st2p https://news.ycombinator.com/item?id=7033720) about possibly contributing, dbaupp pointed me to vadimcn and klutzy - when's the best time to catch them?
[09:03:33] <klutzy> now?
[09:03:37] <klutzy> :p
[09:03:45] <jpoirier> hey
[09:04:04] <klutzy> hello :)
[09:05:21] <jpoirier> I guess the two areas would be packaging and porting
[09:05:37] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[09:08:22] <jpoirier> Windows porting and packing that is. Is there a list of what's missing for the two?
[09:08:48] <klutzy> jpoirier: there's a large room on 64-bit porting
[09:09:53] <klutzy> when I tested it: rustc.exe segfaulted if it is built with optimization flag
[09:10:24] <jpoirier> what compiler?
[09:10:25] <klutzy> and unwinding doesn't work
[09:10:56] <klutzy> built from 32-bit rustc.exe and mingw-w64 linker
[09:11:32] <jpoirier> rust uses a thrid party backend correct
[09:11:40] <eddyb> dbaupp: at least I'm naming the alloca slot properly now :)
[09:11:59] <jpoirier> klutzy: roger that
[09:13:17] <klutzy> jpoirier: you can create cross-built binaries with: `rustc something.rs --target=<target> --linker=<cross-linker>`
[09:14:12] <klutzy> so on windows `rustc.exe --target=x86_64-w64-mingw32 --linker=<mingw-w64-gcc.exe>` would work
[09:16:55] <jpoirier> klutzy: ok, tahnks. Has anyone experimented with using the TDM GCC (http://tdm-gcc.tdragon.net) distro?
[09:18:20] <klutzy> jpoirier: nothing I've heard of.
[09:19:49] <jpoirier> klutzy: someone mentioned MSVC integration for version 1.0. is that official or will alternatives be considered, e.g. llvm?
[09:21:39] <klutzy> jpoirier: I think msvc is not officially considered now: https://github.com/mozilla/rust/issues/1768
[09:21:58] <bjz> jpoirier: That might be contingent on the progress that the LLVM guys are making, but I could be wrong.
[09:22:23] *** Joins: limeburst (me@247D1419.D73964AC.27A8748.IP)
[09:22:39] <bjz> jpoirier: They are working hard to get clang working in in it, so that might help us.
[09:23:18] <bjz> jpoirier: see http://llvm.org/devmtg/2013-11/ "Bringing clang and LLVM to Visual C++ users"
[09:23:31] <bjz> jpoirier: google wants it for chrome I think
[09:23:45] <jpoirier> klutzy: sorry, I guess I really need to RTFM and browse through the forum posts, documents, and code instead of asking stupid question; I just started looking at rust yesterday
[09:24:00] <bjz> jpoirier: keep asking away!
[09:24:06] <klutzy> jpoirier: I'm ok, feel free to ask! ;)
[09:24:26] <bjz> jpoirier: we are most happy to answer even basic questions
[09:24:37] <jpoirier> bjz & klutzy: thanks
[09:24:42] <bjz> ^_^
[09:25:17] <eddyb> dbaupp: lol, I thought an unneeded import was wrong - but I was importing from the wrong module (the name was already imported from another module with an existing glob) - I was expecting that to tell me I'm importing something that's not there
[09:25:26] *** Quits: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP) (Ping timeout)
[09:30:52] <jpoirier> klutzy & bjz: I'm going to go and browse around all things Rust for a bit...I'm sure I'll be back with _many_ questions!
[09:31:01] <bjz> \o/
[09:31:04] <bjz> :)
[09:34:31] <eddyb> dbaupp: running rpass... aaaand it doesn't crash \o/
[09:37:45] <eddyb> r? https://github.com/mozilla/rust/pull/11252
[09:38:48] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[09:41:36] <eddyb> I have to assume nmatsakis has been busy with the cleanup/rvalue work :S
[09:44:59] <eddyb> haha
[09:45:27] <eddyb> dbaupp: I was *randomly* looking at some trans code and it doesn't put a noalias attribute on ~str, just ~T and ~[T]
[09:49:45] <eddyb> but I doubt it matters that much. TBAA is more interesting
[09:51:11] <eddyb> (&mut T/&mut [T]/&mut str could also be noalias. that might be more significant than ~str)
[09:51:24] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[09:51:24] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/rUPxNA
[09:51:24] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[09:51:56] <eddyb> dbaupp: looks like 15s less in "llvm module passes"
[09:52:14] <eddyb> (building rustc-stage2 with my changes in #11252)
[09:55:05] <eddyb> dbaupp: 18s less in the "LLVM passes" total
[09:56:21] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[09:56:21] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/-CggtA
[09:56:21] <ghrust> 13rust/06auto 1452e06c6 15Steven Fackler: Add eof to MemReader and BufReader...
[09:56:21] <ghrust> 13rust/06auto 1472a5252 15bors: auto merge of #11437 : sfackler/rust/mem-eof, r=alexcrichton...
[09:56:21] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[09:56:24] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[09:56:24] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Jrmwdw
[09:56:24] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[09:56:57] <eddyb> dbaupp: and 3s less in linking
[09:58:55] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[10:40:45] *** Joins: gwty (gwtypc@B8F3004.2F30E97E.27560D6E.IP)
[11:06:54] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[11:06:54] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/-CggtA
[11:06:54] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[11:11:22] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[11:11:22] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/9mHdqA
[11:11:22] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[11:28:40] <dbaupp> eddyb: holy shit!
[11:28:43] <dbaupp> eddyb: that's amazing
[11:29:01] <dbaupp> eddyb: is it correct, though?
[11:29:21] <dbaupp> oh, I see you said it passes rpass
[11:29:57] <dbaupp> hi jpoirier, nice to see you followed up :)
[11:30:06] <eddyb> dbaupp: there's an "if true {true} else {...}"
[11:30:10] <eddyb> with proper comments
[11:30:38] <eddyb> right now I'm looking at a freq counter which is just red zeroes :(
[11:40:05] <eddyb> dbaupp: I'm not going to get a review until monday, am I?
[11:40:14] <dbaupp> eddyb: fwiw, the `if true {true} ...` is kinda hidden
[11:40:31] <dbaupp> breaking the {true} out across 2 lines would be better
[11:40:54] <dbaupp> eddyb: I'm not going to r+, so unless you can get niko to review before then, I guess not
[11:41:43] <kimundi> Bah, I think I really need HKT for this library improvement I'm trying to write...
[11:41:59] <eddyb> kimundi: do share. I know a couple tricks in the general area
[11:42:46] <kimundi> eddyb: Well, basically I want Iterable, except for a custom set of trait and types - it's about making string matching functions generic
[11:43:27] <kimundi> For example: A char matcher, that is constructed with a char, and allows you iterate over all macthes of that char in a string
[11:43:33] <eddyb> strcat: hmm, are you qualified to review #11252? (it's not as dramatic as I was hoping for, anyway)
[11:43:51] <eddyb> kimundi: so what's the part where you need HKT?
[11:44:33] <dbaupp> eddyb: btw, it's pretty weird to have giving self the right type and general clean up (remove obsoleted items) in the same commit
[11:44:41] <dbaupp> eddyb: is it feasible to split them up?
[11:45:19] <dbaupp> eddyb: also, you say 20s less... what's that as a percentage?
[11:45:27] <eddyb> dbaupp: the said obsoleted item was an opaque type used only for self
[11:45:30] <dbaupp> (or, what's the total compile time)
[11:45:32] <dbaupp> eddyb: ah
[11:45:37] <dbaupp> eddyb: makes sense
[11:45:56] <kimundi> eddyb: Well, char needs to implement a trait with a function that allows construction of a entirely different type that implements a common, but different trait
[11:46:44] <eddyb> kimundi: do you have sketched it up anywhere?
[11:47:12] <eddyb> or just write an approximate definition of that function
[11:47:54] <eddyb> dbaupp: ~550s. I have the timings, do you want me to add them up?
[11:47:56] <kimundi> eddyb: Well, seeing how what I want is not expressible in the langauge its hard to really sketch something up for me - I'm trying to work around it, but the latest attempt resulted in this ICE: https://github.com/mozilla/rust/issues/11446
[11:48:09] <dbaupp> eddyb: ah, so that last commit changes fn foo(&self) to use the first argument properly, but leaves fn foo(self) passing self indirectly?
[11:48:25] <dbaupp> eddyb: is that before or after your change?
[11:48:25] <kimundi> eddyb: Let me try to write some psydocode
[11:48:57] <dbaupp> eddyb: also, you need some tests to be able to say fixes #10615 ;)
[11:49:26] <eddyb> kimundi: you need lifetimes? I've had a similar problem when I tried to make Visitor produce &'a T instead of &T
[11:49:59] <eddyb> dbaupp: foo(self) isn't indirect - the allocas indirection thing is inside the function (it's required for cleanup)
[11:50:09] <dbaupp> eddyb: oh, awesome
[11:50:14] <kimundi> eddyb: The lifetimes are mainly there because it deals with a &'a str - that part is actually not the problem, I think
[11:51:21] <eddyb> kimundi: so you have a matchable which produces a matcher, when coupled with a string
[11:51:31] <eddyb> a parametrized iterator over the string
[11:51:52] <kimundi> yes, I think
[11:52:18] <eddyb> kimundi: so you want Matchable to be generic over Matcher?
[11:53:03] <kimundi> No, a specific impl of Matchable should use a specific impl of a Matcher
[11:53:16] <eddyb> trait Matchable<'a, Matcher> {fn match(self, st: &'a str) -> Matcher;}
[11:53:37] <eddyb> then impl<'a> Matchable<'a, MatchA<'a>> for A
[11:54:10] <eddyb> that's the trick I was thinking of
[11:54:25] <eddyb> maybe trait Matchable<'a, M: Matcher<'a>>
[11:55:11] <dbaupp> kimundi: https://github.com/mozilla/rust/search?q=Cannot+relate+bound+region&ref=cmdform&type=Issues
[11:55:51] <kimundi> dbaupp: But those other issues are closed
[11:56:02] <dbaupp> kimundi: as dupes
[11:56:09] <kimundi> Maybe I should have reopend one? Dunno what the procedure for that is
[11:56:35] <eddyb> kimundi: so is there a problem with the way I put it?
[11:57:14] <kimundi> eddyb: No, that is one of the attempts I was trying - let me test it again
[11:57:32] <dbaupp> you can't use lifetimes other than 'static in generic bounds, so any code that requires that is dead in the water.
[11:58:07] <eddyb> kimundi: do you really need 'a in the trait?
[11:58:50] <eddyb> oh, but then you can't parametrize the impl properly
[11:58:54] <kimundi> eddyb: I think the 'a is irrelevant, 
[11:59:01] *** Joins: a_m0d|home (a_m0d@moz-322A4DE4.acanac.net)
[11:59:05] <kimundi> As either all involved things use it or none
[11:59:11] <eddyb> kimundi: okay, replace it with 'static for testing
[11:59:16] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[12:00:51] <eddyb> Iterator<(&'a str, uint)> could be the Matcher trait
[12:03:27] <kimundi> eddyb: So, this compiles: https://gist.github.com/Kimundi/8350824
[12:04:29] <eddyb> kimundi: looks just about right :D
[12:04:51] <kimundi> Now, the type that implements matcher needs to contain a &'a str
[12:05:54] <eddyb> that's tricky
[12:06:13] <kimundi> eddyb: Hm - this compiles: https://gist.github.com/Kimundi/8350824
[12:06:30] <kimundi> Ah, generic still uses 'static
[12:07:17] <eddyb> kimundi: you need &'a str in fn matcher, and you can't parametrize the fn because M needs to contain 'a here https://gist.github.com/Kimundi/8350824#file-matchable-rs-L14
[12:08:54] <kimundi> eddyb: If I add a 'a parameter to Matchable, I get the cannot infer bounds ICE
[12:09:17] <eddyb> kimundi: yes. that's fixable and unrelated to HKT. you might have to wait for nmatsakis
[12:10:14] <kimundi> eddyb: Okay, so I assumed that that failure is just an indicator that I'm trying something that wouldn't work anyway :P
[12:10:41] <kimundi> eddyb: But if it works, yay. The problem is that the signature of generic() gets really unwieldy...
[12:11:08] <eddyb> oh, I should've explained that the first time. just unimplemented stuff
[12:21:48] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[12:21:48] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/800bBw
[12:21:48] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[12:26:15] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[12:26:15] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/WXIvKA
[12:26:15] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[12:26:17] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[12:26:17] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/2AoLAw
[12:26:17] <ghrust> 13rust/06auto 1456e75d3 15Brian Anderson: Bump version to 0.10-pre
[12:26:17] <ghrust> 13rust/06auto 146c71e49 15bors: auto merge of #11442 : brson/rust/0.10-pre, r=alexcrichton
[12:26:17] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[12:32:35] *** Joins: canhtak (canhtak@moz-DB18D73D.wl.t.ulaval.ca)
[12:44:27] *** Quits: a_m0d|home (a_m0d@moz-322A4DE4.acanac.net) (Quit: Leaving.)
[12:48:08] *** Quits: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com) (Quit: Bye!)
[12:48:14] *** Joins: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com)
[12:51:09] *** Quits: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com) (Quit: Bye!)
[12:51:54] *** Joins: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com)
[12:53:15] *** Quits: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com) (Quit: Bye!)
[12:53:21] *** Joins: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com)
[12:56:37] *** Quits: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com) (Quit: Bye!)
[12:57:33] *** Joins: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com)
[12:57:50] *** Quits: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com) (Quit: Bye!)
[13:00:40] *** Joins: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com)
[13:02:04] *** Quits: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com) (Quit: Bye!)
[13:02:16] *** Joins: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com)
[13:05:04] <bjz> is r=me a thing?
[13:05:13] <bjz> https://github.com/mozilla/rust/pull/11416#issuecomment-32000093
[13:05:32] *** Quits: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com) (Quit: Bye!)
[13:05:39] *** Joins: jpoirier (jpoirier@moz-150F5176.dhcp.ftwo.tx.charter.com)
[13:05:43] * bjz is not really good with the whole r stuff
[13:06:00] <bjz> is `r` documented anywhere?
[13:07:38] <dbaupp> bjz: https://en.wikipedia.org/wiki/R
[13:07:52] * bjz thinks acrichto meant just to wait for his r
[13:07:56] <bjz> heh
[13:08:08] <bjz> hmm - found https://github.com/mozilla/rust/wiki/Note-bors-usage
[13:08:31] <dbaupp> nah, it just means another reviewer can r+ for acrichto when you've finished whatever the conditions are
[13:09:06] <dbaupp> bjz: https://github.com/bjz/rust/commit/0c9effe98877c9e85effee0591601714f33222a4#diff-194a0ba23aaaad6cd9f72ad63a20b322R273
[13:09:12] <dbaupp> why .to_str() and {}?
[13:09:35] <bjz> yikes!
[13:09:37] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[13:09:52] <bjz> lemme fix those ._x
[13:11:58] <dbaupp> bjz: ping me when you're done
[13:12:25] <bjz> dbaupp: is that the only thing?
[13:13:05] <eddyb> dbaupp: is 'static || a valid *expression*?
[13:13:10] <dbaupp> there were a few instances of that in the pointer guide, but other than that it seemed fine
[13:13:15] <dbaupp> eddyb: no idea, check the parser
[13:13:26] <eddyb> nevermind, it's a type thing
[13:13:49] <eddyb> dbaupp: I can't find what assigns a type to an ExprFnBlock
[13:16:40] <bjz> dbaupp: ping - done
[13:16:49] <eddyb> let fn_ty = astconv::ty_of_closure // ah, lol, typeck calls into astconv for expressions, I thought astconv had that function only for types
[13:20:54] <dbaupp> bjz: r+
[13:26:04] <eddyb> dbaupp: maybe we should add Send here https://github.com/mozilla/rust/blob/master/src/librustc/middle/typeck/check/regionck.rs#L493-L495
[13:26:26] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[13:26:27] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 146c71e49 to 14423dd84: 02http://git.io/N3iJvQ
[13:26:27] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[13:26:27] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[13:26:27] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Y7ELUA
[13:26:27] <ghrust> 13rust/06auto 142fac75d 15Brendan Zabarauskas: Remove re-exports of std::io::stdio::{print, println} in the prelude....
[13:26:27] <ghrust> 13rust/06auto 14f353bad 15bors: auto merge of #11416 : bjz/rust/remove-print-fns, r=huonw...
[13:26:28] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[13:26:39] <bjz> \o/
[13:26:54] <dbaupp> eddyb: dunno
[13:28:47] <eddyb> yay another wasted day :-<
[13:29:22] <bjz> eddyb: ?
[13:31:08] <eddyb> bjz: haven't done anything... I have a few PRs waiting on someone to review and/or discuss, and I can't focus on anything new :/
[13:31:18] <bjz> oh
[13:31:59] <dbaupp> eddyb: do something completely different? (e.g., some work on rustic?)
[13:35:36] <eddyb> dbaupp: last thing I worked on in rustic is that VBE thing. nmatsakis' rvalue thing might allow it to compile without requiring ~2.2GB of RAM
[13:36:11] <eddyb> it doesn't surprise me now, knowing about the allocas
[13:42:59] *** Joins: rca (rcatolino@6A636113.7FFEF089.2CE09D78.IP)
[13:45:37] <eddyb> https://github.com/mozilla/rust/issues/10615 OOOPS
[13:46:16] <jdm> showoff
[13:51:52] <eddyb> jdm: I wish
[14:02:32] <eddyb> dbaupp: added test for #10615
[14:05:37] *** Joins: ChristopherBurg (Christophe@moz-2C03E71B.hfc.comcastbusiness.net)
[14:31:35] <cmr> Does anyone know what happened with http://buildbot.rust-lang.org/builders/auto-mac-64-nopt-c/builds/2583/steps/compile/logs/stdio ?
[14:32:00] <cmr> ah acrichto commented.
[14:35:03] <bjz> weird, I got an error in https://github.com/mozilla/rust/commit/2fac75dfbfd3e0fc20eca0b213b19b38b2919084#diff-82
[14:35:10] <bjz> http://buildbot.rust-lang.org/builders/auto-linux-64-nopt-t/builds/2597/steps/test/logs/stdio
[14:35:35] <cmr> O_o
[14:35:35] <bjz> warning: got 1 RUST_LOG specs but only matched
[14:35:35] <bjz> 0 of them. You may have mistyped a RUST_LOG spec. 
[14:35:35] <bjz> Use RUST_LOG=::help to see the list of crates and modules.
[14:35:35] <bjz> x86_64-unknown-linux-gnu/test/debug-info/function-arg-initialization.debugger.script:34: Error in sourced command file:
[14:35:35] <bjz> No symbol "x" in current context.
[14:35:50] <bjz> I only change the print thingy!
[14:35:55] <bjz> *changed
[14:36:14] <bjz> :[
[14:42:04] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[14:42:04] *** ChanServ sets mode: +ao dherman dherman
[14:45:20] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[14:54:00] <bjz> acrichto: beep
[14:55:29] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Quit: Lost terminal)
[15:06:34] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[15:06:34] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14f353bad to 14423dd84: 02http://git.io/N3iJvQ
[15:06:34] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[15:06:36] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[15:06:36] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/TfJTlQ
[15:06:36] <ghrust> 13rust/06auto 14aca705c 15kud1ing: "As long an iterator" => "As long as an iterator"
[15:06:36] <ghrust> 13rust/06auto 147fe8692 15bors: auto merge of #11451 : kud1ing/rust/patch-1, r=cmr
[15:06:37] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[15:08:13] *** Quits: carter (carter@moz-3589B90B.c.ircrelay.com) (Ping timeout)
[15:08:41] *** Joins: carter (carter@moz-3589B90B.c.ircrelay.com)
[15:09:19] *** Quits: rca (rcatolino@6A636113.7FFEF089.2CE09D78.IP) (Quit: leaving)
[15:25:34] *** Quits: dbussink (dbussink@moz-E0A5568C.bussink.me) (Quit: bye)
[15:25:59] *** Joins: dbussink (dbussink@moz-E0A5568C.bussink.me)
[15:25:59] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[15:27:12] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[15:27:12] *** ChanServ sets mode: +ao dherman dherman
[15:31:11] *** Joins: dev14 (devarshdes@E5E7B410.3BA5A963.4A7DC8C.IP)
[15:35:31] *** Joins: rca (rcatolino@6A636113.7FFEF089.2CE09D78.IP)
[15:41:31] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[15:46:43] <cmr> bstrie: did anything interesting happen on the HN thread?
[15:46:51] <cmr> I'm policing the phoronix thread.
[15:47:09] <bstrie> cmr: nobody mentioned go! that's very interested
[15:47:12] <bstrie> ting
[15:47:20] <bstrie> which phoronix thread
[15:47:29] <cmr> http://phoronix.com/forums/showthread.php?93905-Mozilla-Updates-To-Rust-0-9-Programming-Language
[15:47:52] <bstrie> the discussion on hn seems quite civil
[15:48:01] <cmr> that's a nice change
[15:48:08] <cmr> (from its norm)
[15:48:37] <dbaupp> "D is designed to replace System-Level C code (Kernels, Drivers that aren't written in ASM, etc)" it seems Rust is more suited to that?
[15:48:45] <cmr> read down
[15:48:57] <bstrie> the phoronix page sort of silently stopped loading at first
[15:49:09] <bstrie> so for a second I thought the entire thread consisted of a single comment that said only "I really like this initiative. If we could"
[15:49:20] <cmr> heh
[15:49:50] <dbaupp> cmr: oh, there's someone called "cmr~" talking about this
[15:49:55] <dbaupp> what a coincidence
[15:49:55] <cmr> :P
[15:50:34] <bstrie> clearly this "cmr~" hasn't updated his version of rust since "fn~" was valid syntax
[15:50:40] <bstrie> he's probably just spreading disinformation
[15:50:50] <cmr> cmr was taken and I hadn't become a fan of cmrx64 yet.
[15:50:55] * cmr -> class
[15:51:35] <dbaupp> bstrie: they may just be a rustacean whose native language is rtl
[15:51:46] <dbaupp> and so they're boxing cmr
[15:52:14] *** Quits: Kxepal (Miranda@moz-81616591.pppoe.mtu-net.ru) (Ping timeout)
[15:52:59] *** Quits: dev14 (devarshdes@E5E7B410.3BA5A963.4A7DC8C.IP) (Quit: dev14)
[15:55:34] *** Joins: jdm (jdm@13F2CEC5.7672369.D8E68FF6.IP)
[15:55:37] *** Joins: Kxepal (Miranda@moz-D214BAA1.pppoe.mtu-net.ru)
[15:58:50] <bstrie> acrichto: were you the one proposing to remove `println` from the prelude?
[15:59:05] *** flaper87 is now known as flaper87|afk
[16:00:11] <bstrie> because my objection is that it's a bit silly to have to do `println!("{}", foo)` to print a string (assuming foo is a string)
[16:00:19] <bstrie> but who knows maybe other people don't care
[16:03:43] <SiegeLord> println!(foo) could be replaced with that instead
[16:04:18] <SiegeLord> Would also help the poor folks who (would) like to do println!(5);
[16:09:16] *** Quits: canhtak (canhtak@moz-DB18D73D.wl.t.ulaval.ca) (Quit: canhtak)
[16:10:20] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[16:10:33] *** Joins: canhtak (canhtak@moz-DB18D73D.wl.t.ulaval.ca)
[16:19:10] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[16:21:34] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[16:21:34] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/TfJTlQ
[16:21:34] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[16:26:27] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[16:26:27] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/LDyz5g
[16:26:27] <ghrust> 13rust/06auto 146f875c9 15Derek Chiang: Fix #11421
[16:26:27] <ghrust> 13rust/06auto 14ff7ecca 15bors: auto merge of #11452 : derekchiang/rust/fix-11421, r=cmr...
[16:26:27] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[16:26:29] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[16:26:30] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/ChoYNw
[16:26:30] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[16:35:00] *** Joins: SiegeLord (sl@DA150354.2815CC0B.9BCC850D.IP)
[16:38:44] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[16:43:28] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[16:52:12] <jack> how do i force rust to run with one thread only ?
[16:52:50] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[16:52:50] *** ChanServ sets mode: +ao dherman dherman
[17:05:56] *** jdm is now known as jdm|f00ding
[17:08:54] <acrichto> jack: RUST_THREADS=1 ./foo
[17:09:19] <acrichto> bstrie: well bjz was the one who wrote it, I was just the one who r+'d it :)
[17:09:40] <jack> acrichto: does TRACK_ALLOCATIONS not work anymore?
[17:09:57] <jack> i'm not exactly sure what it's supposed to do, but it appears to do nothing
[17:10:10] <jack> (i have compiled everything with --cfg rtdebug i think)
[17:10:28] <bjz> acrichto: I hit a test that I'm not sure why it failed
[17:10:30] <acrichto> jack: dunno, no one has use that in forever I think so I'd doubt that working
[17:11:04] <bjz> acrichto: ie. it did it in bors but not locally... I don't think
[17:11:10] <acrichto> logs?
[17:11:38] <bstrie> bjz: are we ok with `let foo = "asdf"; println!("{}", foo);` being the shortest way to print a string?
[17:12:28] <benh> :(
[17:12:49] <bstrie> or rather, any string that is not a string literal
[17:13:19] <bjz> bstrie: hmm. Ideally everything should go through the macro.
[17:13:49] <jack> acrichto: can you figure out if the task that printed "layout freeze" is the same one that ran the drop logic here: https://gist.github.com/metajack/8358352
[17:13:55] <bjz> bstrie: but the question is, how do we make println!(a_str) work
[17:13:56] <jack> the other stuff is coming from rtdebug
[17:14:15] <acrichto> jack: sadly no, I never use rtdebug
[17:14:30] <acrichto> bjz: bstrie: we could make println!(foo) work
[17:14:37] <acrichto> it could expand to ::std::io::println
[17:14:41] <acrichto> hence it's typechecked
[17:14:50] <bstrie> but what if I do println!(1)
[17:14:53] <acrichto> it's just "magical" though
[17:14:58] <bstrie> do we want to call .to_str() on the argument?
[17:14:59] <acrichto> it's not what the rest of the macro does
[17:15:20] <acrichto> fn fmt::println<T: fmt::Default>(t: &T)
[17:15:24] <acrichto> these things can be done
[17:15:30] *** Joins: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net)
[17:15:38] <acrichto> I don't think that langauges normally conflate them with formatting though
[17:15:47] <jack> acrichto: larsberg has found there is one thing left on teh local heap. is there some way for us to get the type of that data?
[17:16:26] <larsberg> I can print out the address, but it's unfortunately not stable between runs, so I can't just put a memory breakpoint on that addr to get the stack
[17:16:29] <jack> also dbaupp suggested the SIGILL might just be how rust aborts on the assert!. is that true?
[17:16:42] <acrichto> yes
[17:16:53] <acrichto> llvm's intrinsics::abort() execues 'ud2' on x86 processors
[17:16:58] <acrichto> which is an illegal instruction
[17:17:13] <jack> and assert in non-task is abort?
[17:17:14] <acrichto> I'm not sure how you'd poke around the object
[17:17:30] <acrichto> the normal fail!() can abort if there is no local task available
[17:18:18] *** Joins: dev14 (devarshdes@A0749843.44436F6C.3FBA778E.IP)
[17:18:21] <jack> th eonly thing i still don't get is why the SIGILL comes before rust_fail
[17:18:34] <acrichto> that could be a rtabort()
[17:18:38] *** Quits: dev14 (devarshdes@A0749843.44436F6C.3FBA778E.IP) (Quit: dev14)
[17:18:39] <acrichto> or an rtassert
[17:19:31] <bjz> bstrie: don't you have to do printf("%s", s) in C too? I mean, not to say we have to follow C...
[17:19:44] <acrichto> haha, you can do printf(s) but it's super unsafe
[17:19:53] <bstrie> bjz: exactly, let's not use c as an example here :P
[17:20:01] <bjz> heh
[17:20:06] <benh> C has puts(), too
[17:20:18] <bstrie> I'd really like for `println!(1)" to just be shorthand for `println!("{}", 1)`
[17:20:21] <acrichto> bjz: looks like a debuginfo test failed, I'm not sure how well they work with macros
[17:20:26] <bstrie> it really helps with my noobish println-debugging
[17:20:33] <acrichto> bjz: if that test is failing you may want to switch to the freestanding functions
[17:20:39] <bjz> acrichto
[17:20:42] <benh> bstrie: maybe that'd be less contentious if it didn't have the same name as the full formatting function
[17:20:43] <bjz> acrichto: ok
[17:20:45] <acrichto> bstrie: but then why doesn't println!(1, 2) work?
[17:21:22] <acrichto> from what I know, languages with printf/print distictions allow any numbers of anything to print and only format strings to printf
[17:21:42] <bstrie> acrichto: eh, I personally don't think println!(1, 2) is something to be feared
[17:21:46] <acrichto> we don't have 'print' at all (it's too special cased for "just strings")
[17:21:48] <benh> say(1), say((1, 2))
[17:22:34] <bstrie> acrichto: I don't see why it couldn't just fail with `error: multiple arguments to println! must be preceded with a format string"
[17:22:43] <bjz> print!, printf!, println!, printfln!
[17:22:49] <bstrie> let's not bring those back
[17:22:52] <bjz> :P
[17:23:01] <acrichto> bstrie: well sure, we could do that, but the question is still "why don't you allow this"
[17:23:15] <acrichto> you're striving for the python-like print(a, b, c) and you can do part of it in rust but not all of it
[17:23:23] <bstrie> because the single-argument form is sugar for ("{}", foo)
[17:23:24] <acrichto> well, python/ruby/go/etc.
[17:23:45] <acrichto> why isn't the multi argument form sugar for "{} {} {} {}", foo, barz, baz, whee
[17:23:49] <bstrie> acrichto: I'm *not* striving for `print(a, b, c)`
[17:24:00] <bstrie> in personal use, I either print a single value, or I use a format string
[17:24:02] <bjz> bstrie: it's short, but its also conceptually mor complex to have that special case
[17:24:05] <acrichto> I fear that it's the first complaint after it's implemented though
[17:24:07] <bstrie> so this lines up perfectly with my expectations :)
[17:24:11] <cmr> Wait we have single-arg sugar?
[17:24:14] * cmr thought it was gone.
[17:24:16] <bstrie> not yet
[17:24:18] <bstrie> I want it
[17:24:21] <acrichto> cmr: not right, no
[17:24:23] <acrichto> all hypothetical
[17:24:28] <cmr> ah ok
[17:24:31] * cmr reads up
[17:24:38] <bstrie> we already do wacky things with fail!() and friends
[17:24:50] <bstrie> I don't see how this is any more wacky
[17:24:50] <bjz> cmr: I was just removing print and println from the prelude
[17:25:10] <acrichto> hm, that's a good point
[17:25:55] <cmr> bjz: right and I agree with that
[17:26:17] <cmr> I would be in favor of println!(a, b, c) => println!("{} {} {}", a, b, c)
[17:26:25] <bstrie> cmr: the original concern is that it's now impossible to print a string that isn't a string literal with just a single argument
[17:26:26] <cmr> at the very least the singla-argument form is great.
[17:26:35] <bstrie> at least without importing std::io::println
[17:26:49] <bjz> cmr: println!("hi", b, c) ?
[17:27:16] <bstrie> but, I'm not gonna complain about it that much
[17:27:20] <bstrie> at least until I hit it somewhere
[17:27:21] <cmr> bjz: that's different since the first arg is a string literal
[17:27:37] <cmr> I meant literally a, b, c as in variables or non-string literals.
[17:27:54] <bjz> cmr: but now you special case string literals
[17:28:02] <cmr> bjz: they're already special cased :)
[17:28:44] <bstrie> the special treatment of string literals is definitely the most surprising feature of println!(), by far
[17:28:54] <bstrie> not that there's not a good technical reason, but it's still surprising
[17:29:22] <bjz> as in, to do the print!(1, x, "hi"), and also println!("{} {} {}", a, b, c), the string literal at the beginning is now the special case
[17:29:57] <bjz> which is why I'm thinking maybe the simplest thing would be to have print!, printf!, println!, printfln!
[17:30:09] <bjz> rather than shoehorning one in
[17:30:19] <bjz> but
[17:30:33] *** Quits: dcrewi (david@moz-AB8667CE.gyrae.net) (Ping timeout)
[17:30:35] *** Joins: vfetwnuncszu (david@moz-AB8667CE.gyrae.net)
[17:30:40] <bjz> then print! wouldn't have to be a macro anymore
[17:30:46] <bjz> -_-
[17:30:48] *** Joins: madmoose (Hat@moz-E1973371.nerp.net)
[17:30:50] *** vfetwnuncszu is now known as dcrewi
[17:31:39] <bjz> so then it would look different to the other printy things, which is also ugly
[17:32:52] <bjz> and should we have the same sugar for write!, fail!, log! etc?
[17:33:25] <bjz> write!(w, 1)
[17:36:36] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[17:36:36] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/LDyz5g
[17:36:36] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[17:44:21] <bjz> acrichto: rebased again
[17:44:37] <bjz> acrichto: but I'm not sure if we want to do it now...
[17:45:27] <acrichto> I think we still want to remove it regardless
[17:45:32] <acrichto> println!() with one argument is orthogonal
[17:46:15] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[17:46:16] *** ChanServ sets mode: +qo brson brson
[17:46:21] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[17:46:21] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/RFqrWA
[17:46:21] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[17:46:22] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[17:46:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/lr8r4g
[17:46:23] <ghrust> 13rust/06auto 14620e72d 15Raphael Catolino: Improve invalid operator assignment handling.
[17:46:23] <ghrust> 13rust/06auto 14e64b30a 15bors: auto merge of #11449 : rcatolino/rust/assign-binop-handling, r=alexcrichton...
[17:46:23] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[17:48:00] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[17:50:20] *** jdm|f00ding is now known as jdm
[18:01:45] *** Joins: sebcrozet (sebcrozet@moz-A855F6C0.w82-127.abo.wanadoo.fr)
[18:02:09] *** Parts: sebcrozet (sebcrozet@moz-A855F6C0.w82-127.abo.wanadoo.fr) (Gone)
[18:02:30] *** Joins: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net)
[18:02:30] *** ChanServ sets mode: +ao pcwalton pcwalton
[18:05:45] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[18:09:07] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:09:07] *** ChanServ sets mode: +qo brson brson
[18:10:09] *** Joins: dev14 (devarshdes@A0749843.44436F6C.3FBA778E.IP)
[18:14:13] *** Quits: SiegeLord (sl@DA150354.2815CC0B.9BCC850D.IP) (Quit: Leaving)
[18:21:26] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[18:21:26] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/o378fg
[18:21:26] <ghrust> 13rust/06auto 14a8b2106 15Brendan Zabarauskas: Remove re-exports of std::io::stdio::{print, println} in the prelude....
[18:21:26] <ghrust> 13rust/06auto 1472ed5c3 15bors: auto merge of #11416 : bjz/rust/remove-print-fns, r=alexcrichton...
[18:21:26] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[18:30:40] *** Quits: pcwalton (pcwalton@moz-DA87EE4.hsd1.ca.comcast.net) (Quit: pcwalton)
[18:37:09] *** Joins: pnkfelix (pnkfelix@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[18:38:49] *** Joins: rca_ (rcatolino@moz-F434D9F9.adsl.proxad.net)
[18:39:31] *** Quits: rca (rcatolino@6A636113.7FFEF089.2CE09D78.IP) (Ping timeout)
[18:42:00] *** Quits: gwty (gwtypc@B8F3004.2F30E97E.27560D6E.IP) (Ping timeout)
[18:44:59] *** Quits: dev14 (devarshdes@A0749843.44436F6C.3FBA778E.IP) (Quit: dev14)
[18:46:21] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[18:46:21] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1472ed5c3 to 14ff7ecca: 02http://git.io/N3iJvQ
[18:46:21] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[18:52:16] *** rca_ is now known as rca
[19:00:39] *** Joins: dev14 (devarshdes@A0749843.44436F6C.3FBA778E.IP)
[19:05:28] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[19:05:32] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[19:05:32] *** ChanServ sets mode: +qo brson brson
[19:17:28] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[19:17:28] *** ChanServ sets mode: +ao pcwalton pcwalton
[19:18:32] *** Joins: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP)
[19:19:46] *** Quits: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP) (Ping timeout)
[19:19:58] *** Quits: dev14 (devarshdes@A0749843.44436F6C.3FBA778E.IP) (Quit: dev14)
[19:28:44] *** Joins: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP)
[19:32:19] *** Joins: dev14 (devarshdes@A0749843.44436F6C.3FBA778E.IP)
[19:33:15] *** Quits: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP) (Ping timeout)
[19:35:34] *** Joins: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP)
[19:41:19] *** Quits: ChristopherBurg (Christophe@moz-2C03E71B.hfc.comcastbusiness.net) (Ping timeout)
[19:42:12] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Ping timeout)
[19:42:51] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[19:42:51] *** ChanServ sets mode: +ao dherman dherman
[19:49:55] *** Quits: dev14 (devarshdes@A0749843.44436F6C.3FBA778E.IP) (Quit: dev14)
[19:51:18] *** Quits: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP) (Ping timeout)
[19:51:22] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[19:51:22] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14e7de0ac to 14ff7ecca: 02http://git.io/N3iJvQ
[19:51:22] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[19:51:23] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[19:51:23] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/EYxD0g
[19:51:23] <ghrust> 13rust/06auto 1402d8621 15Raphael Catolino: Improve invalid operator assignment handling.
[19:51:23] <ghrust> 13rust/06auto 1433e8663 15bors: auto merge of #11449 : rcatolino/rust/assign-binop-handling, r=alexcrichton...
[19:51:25] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[19:51:28] <acrichto> brson: ping
[19:54:17] *** jld is now known as jld|lunch
[20:00:09] <brson> acrichto: pong
[20:12:48] *** Joins: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP)
[20:17:38] *** Quits: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP) (Ping timeout)
[20:20:15] <bjz> r? https://github.com/mozilla/rust/pull/11416
[20:28:11] <bstrie> before procs, did closing over an owned type implicitly clone its value?
[20:28:28] <cmr> bstrie: no, it just wasn't possible.
[20:28:39] <cmr> you could only reference it.
[20:29:16] <bstrie> still not sure what new things that procs let us do
[20:29:47] <cmr> fn foo() { let x = File::open(...); do spawn { let f = x; /* look ma, it's owned! */ f.close(); } }
[20:30:09] <cmr> Every time you had seen or used a Cell to and .take(), you now do not have to.
[20:30:20] <bstrie> ah ok
[20:33:56] <bstrie> does a proc's environment get freed immediately after it runs?
[20:34:02] *** Joins: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP)
[20:34:34] <cmr> I think so
[20:34:37] <cmr> not 100% positive.
[20:34:44] <cmr> pcwalton: ^ ?
[20:35:25] <bstrie> I know that, conceptually, calling a proc is equivalent to relinquishing ownership
[20:35:36] <bstrie> but I'm not exactly sure what it's relinquishing ownership to :)
[20:35:57] <bstrie> if it's something like `let _ = foo;` where foo is an owned type, I'm not even sure when that gets freed
[20:36:16] *** Quits: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP) (Ping timeout)
[20:36:32] <cmr> neither am I
[20:36:37] <cmr> there's an issue open for that exact case.
[20:36:46] <cmr> I think it gets freed like a normal variable? or will be in the future?
[20:41:07] <bstrie> looks like it does get freed immediately after it runs
[20:41:47] <bstrie> cmr: but `let _ = foo;` doesn't get dropped until the scope ends
[20:42:08] *** Joins: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP)
[20:43:16] <bstrie> cmr: https://gist.github.com/bstrie/8362191
[20:43:39] <cmr> bstrie: ok, that's what I expected of let _ = foo, I think.
[20:43:55] <cmr> I can't find the issue
[20:48:50] *** Joins: lkuper (lkuper@802AC8C7.A0D37E9B.51B6877.IP)
[20:50:30] <cmr> pnkfelix: nmatsakis: pcwalton: have you seen http://llvm.org/docs/StackMaps.html ?
[20:50:54] *** Quits: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP) (Ping timeout)
[20:52:01] <bstrie> nmatsakis: saw something on twitter about a rust presentation, what was the occasion?
[20:58:48] *** jdm is now known as jdm|away
[20:59:51] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[21:01:35] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[21:01:35] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/EYxD0g
[21:01:35] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[21:06:42] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[21:06:43] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/c0nikQ
[21:06:43] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[21:06:44] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[21:06:44] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/iAK2Cw
[21:06:44] <ghrust> 13rust/06auto 1482876bd 15Brendan Zabarauskas: Remove re-exports of std::io::stdio::{print, println} in the prelude....
[21:06:44] <ghrust> 13rust/06auto 1478a5026 15bors: auto merge of #11416 : bjz/rust/remove-print-fns, r=cmr...
[21:06:45] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[21:16:26] *** Quits: rca (rcatolino@moz-F434D9F9.adsl.proxad.net) (Quit: Lost terminal)
[21:16:32] *** Joins: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP)
[21:21:22] *** Quits: dcrewi (david@moz-AB8667CE.gyrae.net) (Ping timeout)
[21:22:10] *** Joins: vfetwnuncszu (david@moz-AB8667CE.gyrae.net)
[21:22:10] *** vfetwnuncszu is now known as dcrewi
[21:31:33] *** Quits: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net) (Ping timeout)
[21:31:54] *** Joins: tedh (tedh@moz-F3B34318.hsd1.il.comcast.net)
[21:37:17] *** Joins: ktt3ja (ktt3ja@moz-54586A12.washdc.fios.verizon.net)
[21:40:59] *** jld|lunch is now known as jld
[21:41:08] *** jdm|away is now known as jdm
[21:45:36] <acrichto> brson: re-ping (sry left for lunch)
[21:54:39] *** Quits: limeburst (me@247D1419.D73964AC.27A8748.IP) (Connection reset by peer)
[21:54:45] *** Joins: limeburst (me@247D1419.D73964AC.27A8748.IP)
[21:56:07] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[21:57:16] <cmr> bstrie: the phoronix thread is being civil too!
[21:57:19] <cmr> I'm truly shocked.
[21:57:45] <cmr> HN *and* phoronix seem to have nothing bad to say about this release :)
[21:58:20] <brson> neat, i didn't realize phoronix followed us
[21:58:22] <brson> acrichto: pong
[21:58:24] <brson> linky?
[21:58:30] <cmr> michael posts every release.
[21:58:48] <cmr> http://phoronix.com/forums/showthread.php?93905-Mozilla-Updates-To-Rust-0-9-Programming-Language
[21:59:01] <acrichto> brson: mutexes, static version can't implement Drop, but we still need to call unstable::mutex::Mutex::destroy for the normal use case, meaning it needs a destructor
[21:59:05] <acrichto> brson: StaticMutex vs Mutex ?
[22:00:47] <brson> acrichto: sad, but I don't have any better ideas
[22:00:56] <brson> StaticMutex just leaks?
[22:00:59] <acrichto> yeah
[22:01:06] <acrichto> it'll have an 'unsafe fn destroy'
[22:01:11] <acrichto> if you want to call it manually
[22:01:18] <acrichto> so this technically doesn't matter for linux/osx
[22:01:23] <acrichto> because they don't allocate in their mutexes
[22:01:38] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[22:01:38] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/SiDYAQ
[22:01:38] <ghrust> 13rust/06auto 14326e631 15Carl-Anton Ingmarsson: std::io: Add tests and benchmarks for u64_from_be_bytes()
[22:01:38] <ghrust> 13rust/06auto 140b3311c 15Carl-Anton Ingmarsson: std::io: Optimize u64_from_be_bytes()...
[22:01:38] <ghrust> 13rust/06auto 14f411b94 15bors: auto merge of #11448 : c-a/rust/u64_from_be_bytes, r=alexcrichton...
[22:01:40] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[22:02:18] <brson> did we recently remove no_std from our crates possibly?
[22:02:34] <acrichto> we shouldn't have no_std on anything but libstd
[22:02:39] <brson> upgrading the version numbers makes the stage0 compiler not able to compile libextra
[22:02:46] <brson> since std injection injects a version
[22:02:57] <acrichto> it should have built a libstd with that version?
[22:03:25] <brson> but the stage0 rustc injects something like `extern mod std = "std#0.9"`
[22:03:37] <brson> though i don't know how we did the 0.9-pre -> 0.9 upgrade if this is the case
[22:03:40] <acrichto> oh hm that's annoying
[22:03:48] <acrichto> I don't think it was injecting versions correctly
[22:03:49] <cmr> yeah, that's... confusing.
[22:04:01] *** Joins: dev14 (devarshdes@B4276BCF.C06AD1DD.3FBA778E.IP)
[22:04:03] <acrichto> maybe we shouldn't inject the version?
[22:04:36] <brson> i remember there used to be a problem with not, but we try much harder now to clean our workspace, and we basically have no hope atm of having multiple coexisting stds
[22:04:43] <brson> so maybe we don't need to inject the version
[22:04:48] <brson> still, that doesn't help me now
[22:05:03] <acrichto> you can't #[cfg] attributes :(
[22:05:35] <acrichto> brson: you could leave libstd at 0.9 as well as the injected version
[22:05:38] <acrichto> and then wait for a snapshot
[22:05:44] *** Quits: dev14 (devarshdes@B4276BCF.C06AD1DD.3FBA778E.IP) (Quit: dev14)
[22:06:32] <brson> yeah, ok
[22:13:45] <brson> r? https://github.com/mozilla/rust/pull/11442
[22:17:41] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[22:24:40] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[22:24:40] <ghrust> 01[13rust01] 15cmr 04force-pushed 06try from 140f7f896 to 142056091: 02http://git.io/k471pw
[22:24:40] <ghrust> 13rust/06try 14580db13 15Corey Richardson: syntax: add better error message for unexpected inner attrs...
[22:24:40] <ghrust> 13rust/06try 14980dd1d 15Corey Richardson: driver: use libnative
[22:24:40] <ghrust> 13rust/06try 142056091 15Corey Richardson: Align stack size to page size
[22:24:42] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[22:26:54] <eddyb> brson: so only pcwalton and nmatsakis really know trans? that is so sad (especially for my PR now that I've delayed some of the magic in it)
[22:27:32] <pcwalton> that's not really true
[22:27:33] <pcwalton> ild knows it
[22:27:34] <pcwalton> jld*
[22:29:31] <eddyb> pcwalton: this is the PR if you want to take a crack at it https://github.com/mozilla/rust/pull/11252
[22:29:46] <eddyb> dbaupp: ooh, I see you sneaked in a percentage :D
[22:31:28] <pcwalton> eddyb: on it
[22:34:16] <cmr> brson: ping
[22:34:59] <cmr> or, anyone really.
[22:35:07] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[22:35:11] <cmr> is it kosher to straight-port MIT-licensed code for the stdlib?
[22:35:14] <cmr> (looking at lua, here)
[22:35:42] *** Joins: ggherdov_ (sid11402@moz-E77DEB21.irccloud.com)
[22:35:55] *** Quits: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP) (Ping timeout)
[22:41:25] <brson> cmr: yes, and you can then just tack on the ASL2 license afaik
[22:41:46] <brson> well, maybe
[22:41:58] <brson> we may need to preserve the exact license and make it a license exception
[22:42:35] <brson> i don't actually know if a transliteration *must* retain the same license, but that's what we've done with others'
[22:43:30] *** Joins: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP)
[22:45:59] *** Quits: blank_name (blank_name@C5C84EB0.9E887BEB.53C6B850.IP) (Quit: leaving)
[22:46:00] <cmr> acrichto: it's a shame gmail doesn't show me seconds in the email timestamp, I want to know if I beat you or not :)
[22:46:07] <acrichto> lol
[22:46:27] * cmr took forever to find ssbr's name + pyrite)
[22:46:30] <acrichto> Date: Fri, 10 Jan 2014 17:44:58 -0500
[22:46:32] <acrichto> yours
[22:46:42] <acrichto> Date: Fri, 10 Jan 2014 14:44:35 -0800
[22:46:44] <acrichto> mine
[22:46:49] <cmr> darn
[22:46:50] <acrichto> 23 seconds!
[22:46:57] <acrichto> (gmail + show original)
[22:46:59] <cmr> maybe next time!
[22:47:01] <cmr> ah cool
[22:47:01] <acrichto> lol
[22:48:19] <eddyb> pcwalton: thanks :D - dbaupp did a non-trans-sanity review, I addressed his nits, and if I'm not around you might find answers to "why did you do it that way?" in the IRC log
[22:48:31] <pcwalton> cool
[22:48:40] <pcwalton> thanks for this! this should improve trans quite a bit
[22:48:59] <eddyb> eh, a small step. just like the introduction of ast::P
[22:49:28] <acrichto> weird, PTHREAD_MUTEX_INITIALIZER is NULL on freebsd
[22:49:39] <eddyb> I'd like to add methods to the type system (and thus remove some of the method-related tables in ty/typeck)
[22:50:07] <dbaupp> (I didn't do a complete review, fwiw.)
[22:50:47] <eddyb> oh, you're around, good :)
[22:51:11] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[22:51:11] <ghrust> 01[13rust01] 15alexcrichton 04force-pushed 06try from 142056091 to 14d9a05d4: 02http://git.io/k471pw
[22:51:11] <ghrust> 13rust/06try 14f60b837 15Alex Crichton: std: Introduce a standard Mutex type...
[22:51:11] <ghrust> 13rust/06try 14d9a05d4 15Alex Crichton: Remove try_send_deferred plus fallout...
[22:51:12] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[22:51:33] <acrichto> brson: ^ I'm in the cleanup phase (it's working)
[22:53:39] <eddyb> pcwalton: can't just comment out code because then it's not obvious why I need some of the information I bring into the function
[22:53:52] <pcwalton> I guess
[22:54:08] <pcwalton> can you just put an _ in front of those variables?
[22:54:21] <pcwalton> and say in a comment at the function why those will be needed in the future?
[22:54:28] <dbaupp> eddyb: (I just logged in as you mentioned me :P ) and yeah, I did put in a percentage
[22:54:44] <eddyb> and it means it might rot (I want it to be easy to test with, after the cleanup system supports that usecase)
[22:55:30] <pcwalton> yeah, I guess so
[22:55:34] <pcwalton> that's fine, I suppose
[22:55:51] *** Joins: blank_name (blank_name@C5C84EB0.9E887BEB.53C6B850.IP)
[22:57:43] <eddyb> pcwalton: about "add self in trans_fn_ref", I might have worded that better - I meant trans_fn_ref should return a function type with the right type for self - it might require adding methods to the type system proper, as mentioned above
[22:58:23] <eddyb> s/add self/handle self properly/?
[22:58:39] <pcwalton> I think it should say "eventually trans_fn_ref should return a function type with the right type for self"
[22:58:53] <pcwalton> eventually I would like it to return a function that can be called as a first-class function with self as the first argument
[23:00:36] <eddyb> I might try that next, coupled with removing the env parameter from bare fns
[23:02:51] <eddyb> pcwalton: r?
[23:03:10] <pcwalton> r+
[23:04:04] <brson> acrichto: how did you solve the race?
[23:04:12] <acrichto> brson: green threads spin
[23:04:18] <eddyb> pcwalton: thanks \o/ - I can go to sleep now
[23:04:29] <acrichto> brson: when you unlock, you say you're unlocking, and while it says it's unlocked green threads try to grab it
[23:04:36] <pcwalton> cool, and thanks again :)
[23:04:36] <acrichto> brson: distasteful, but I'm running out of ideas :(
[23:05:23] <brson> acrichto: so they don't spin long?
[23:05:35] <acrichto> brson: the theoretical windows is tiny
[23:05:39] <brson> ok
[23:05:45] <acrichto> it's either {pthread_mutex_trylock => set the flag}
[23:05:50] <acrichto> or {pthread_mutex_lock => set the flag}
[23:06:09] <acrichto> I'm a little worried about the mutex_lock => set the flag, but that's a green/native cross which we don't care about that much
[23:06:17] <acrichto> trylock => set the flag should be like 10 instructions
[23:06:42] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[23:06:42] <ghrust> 01[13rust01] 15alexcrichton pushed 1 new commit to 06try: 02http://git.io/QAeUyQ
[23:06:42] <ghrust> 13rust/06try 14c523c53 15Alex Crichton: fixes
[23:06:42] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[23:07:11] <acrichto> brson: https://github.com/alexcrichton/rust/blob/mutex/src/libstd/sync/mutex.rs
[23:07:31] <acrichto> green spinners: https://github.com/alexcrichton/rust/blob/mutex/src/libstd/sync/mutex.rs#L297-L305
[23:08:47] <acrichto> Ill open a PR once I get past try
[23:12:20] *** Quits: eddyb (eddy@EE946B63.921A1753.FCAAE698.IP) (Ping timeout)
[23:23:28] *** Joins: a_m0d|home (a_m0d@moz-322A4DE4.acanac.net)
[23:27:18] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[23:27:19] <ghrust> 01[13rust01] 15cmr created 06upstream (+3 new commits): 02http://git.io/QbhbrQ
[23:27:19] <ghrust> 13rust/06upstream 14580db13 15Corey Richardson: syntax: add better error message for unexpected inner attrs...
[23:27:19] <ghrust> 13rust/06upstream 14980dd1d 15Corey Richardson: driver: use libnative
[23:27:19] <ghrust> 13rust/06upstream 142056091 15Corey Richardson: Align stack size to page size
[23:27:21] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[23:27:36] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[23:27:36] <ghrust> 01[13rust01] 15cmr 04force-pushed 06try from 14c523c53 to 142056091: 02http://git.io/k471pw
[23:27:36] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[23:31:33] <acrichto> cmr: aww you canceled my try build on osx :(
[23:31:42] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[23:31:42] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/SiDYAQ
[23:31:42] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[23:31:46] <acrichto> on oh the others as well lol
[23:35:21] <brson> cmr: was creating 'upstream' an accident?
[23:36:03] <acrichto> brson: I don't think we ever really reached a conclusion on https://github.com/mozilla/rust/pull/11153
[23:36:28] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[23:36:28] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Qgvvyw
[23:36:28] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[23:36:58] <brson> acrichto: i don't think we know of any alternative the #[boot] attribute itself do we? maybe simply not having it
[23:37:12] <brson> if we're thinking of removing *other* entry points istm that can happen later
[23:37:23] <acrichto> well, we seem to be doing pretty well without it right now
[23:37:32] <acrichto> maybe we should just removing everything except #[no_main]
[23:37:57] <acrichto> I couldn't find where we did "interesting things" for windows
[23:38:16] <brson> i wonder why we don't put boot and main into the crate map
[23:38:18] <brson> seems inconsistent
[23:38:24] <acrichto> you only need them once
[23:38:33] <acrichto> you never need them again
[23:38:51] <acrichto> brson: but honestly, we could strip everythign except #[no_main] and #[lang = "start"]
[23:38:58] <acrichto> and just put #[lang = "start"] into libnative
[23:38:59] <brson> and #[boot]?
[23:39:00] <acrichto> or libgreen
[23:39:02] <acrichto> no not even boot
[23:39:05] <acrichto> if you want to override it
[23:39:06] <brson> just require pools
[23:39:16] <brson> oh just define main yourself
[23:39:16] <acrichto> #[no_main] #[no_mangle] fn main() { my_crate::boot() }
[23:39:32] <acrichto> a little wordy
[23:39:56] <acrichto> but this does remove entry points rather than adding others
[23:40:31] <brson> you would have to put argc argv in your main and pass them to boot
[23:40:39] <acrichto> yeah
[23:40:45] <acrichto> that's what everyone's doing with #[start] right now anyway
[23:40:51] <bjz> acrichto: still have that failure: http://buildbot.rust-lang.org/builders/auto-linux-64-nopt-t/builds/2604/steps/test/logs/stdio
[23:41:01] <bjz> https://github.com/mozilla/rust/pull/11416/files#diff-82
[23:41:24] <bjz> acrichto: I was just importing `print` rather than using the macro.
[23:41:25] <acrichto> bjz: you changed the file by offsetting line numbers, did that affect it?
[23:41:32] <bjz> ahh
[23:41:36] <brson> acrichto: I think I'm in favor of just removing everything, yeah. Let's have a test case that proves that the #[no_main] main works on all platforms. I suspect it's different for at least windows (WinMain)
[23:41:42] <brson> which still might be fine
[23:41:58] <acrichto> do you know where the windows specific logic it?
[23:41:59] <acrichto> is*
[23:42:00] <brson> wanting to boot directly into a green task will ultimately probably be rare
[23:42:10] <acrichto> git grep WinMain <- shows up nothing
[23:42:19] <acrichto> yeah it seems so
[23:42:27] <acrichto> but libgreen still will provide a nice entry point
[23:42:30] <acrichto> with just a little glue
[23:43:34] <brson> acrichto: I don't see WinMain either. Maybe 'main' just works on windows as well
[23:43:43] <acrichto> llvm may be doing magic behind the scenes
[23:43:59] <acrichto> do we want to automagically make a symbol called 'main' not the rust abi?
[23:44:09] <acrichto> and also probably not internal
[23:44:36] *** Quits: lkuper (lkuper@802AC8C7.A0D37E9B.51B6877.IP) (Quit: lkuper)
[23:45:33] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[23:47:05] <brson> I don't, no, but maybe we can simplify the native main use case. `#[no_main] #[no_mangle] extern` is pretty wordy. you could maybe do something like `#[native_main] fn` that just puts a light C ABI wrapper around main.
[23:47:15] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[23:47:23] <acrichto> brson: well actually #[start] is pretty not wordy
[23:47:31] <acrichto> like when I stop and think about it what we have now is kinda nice
[23:47:38] <acrichto> #[start] + #[no_main] + fn main
[23:47:46] <acrichto> what more do you really need?
[23:47:48] <brson> maybe start shouldn't include the `main` function
[23:47:51] <bjz> acrichto: hopefully this should work :[ https://github.com/mozilla/rust/pull/11416/files#diff-82
[23:47:59] <bjz> acrichto: sorry about all this
[23:48:01] <acrichto> brson: ?
[23:48:06] <acrichto> bjz: no worries! feel free to r=me
[23:48:09] <brson> acrichto: oh, start doesn't specify main, that's just lang start
[23:48:16] <brson> acrichto: yeah, 'start' is exactly what i said
[23:48:19] <acrichto> bjz: my PR's have a minimum of like 20 bounces, so don't feel bad
[23:48:28] <acrichto> brson: yeah, so maybe I should just polish the libgreen/libnative entry points
[23:48:38] <acrichto> and just live with the fact that libstd doesn't have lang = "start"
[23:48:57] <acrichto> brson: all in all, I don't think we need #[boot] at all
[23:49:06] <brson> acrichto: this does mean that all crates need to link to native
[23:49:32] <bjz> acrichto: so just writ `r=me` at the bottom?
[23:49:33] <acrichto> brson: well right now all crates link to libgreen and libgreen has lang="start", once we switch to libnative that means that libnative will have lang="start"
[23:49:39] <acrichto> bjz: "r=alexcrichton"
[23:49:40] <bjz> acrichto: of the commit
[23:49:45] <bjz> oh ok
[23:49:52] <acrichto> bjz: you're a reviewer, right?
[23:50:02] <bjz> yes :P
[23:50:10] <acrichto> yeah that'll work
[23:50:21] <bjz> I never use my powers though, so I'm very much a noob
[23:50:36] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[23:50:37] <ghrust> 01[13rust01] 15alexcrichton 04force-pushed 06try from 142056091 to 147bcf5e9: 02http://git.io/k471pw
[23:50:37] <ghrust> 13rust/06try 14f60b837 15Alex Crichton: std: Introduce a standard Mutex type...
[23:50:37] <ghrust> 13rust/06try 14d9a05d4 15Alex Crichton: Remove try_send_deferred plus fallout...
[23:50:37] <ghrust> 13rust/06try 147bcf5e9 15Alex Crichton: fixes
[23:50:38] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[23:50:43] <acrichto> cmr: I'm pushing to try as well, just letting you know
[23:50:48] <bjz> https://github.com/bjz/rust/commit/4fc0452acef1355ba566a30c5bd04ccd3b9acef2#commitcomment-5039863
[23:50:55] <brson> acrichto: sounds good
[23:52:24] <acrichto> brson: so the idea behind __tt_map_insert is that adding at runtime is just too hard, right?
[23:55:18] <acrichto> ah nvmd I'll just write comments on all communication media and never stay on one!
[23:55:31] <acrichto> r=me though, this looks like a pretty awesome infrastructure
[23:56:20] <dbaupp> should __tt_map_insert et al. be feature gated?
[23:56:29] <acrichto> not a bad idea
