[00:02:23] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[02:34:00] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Server shutdown)
[02:34:00] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Server shutdown)
[02:34:00] *** Quits: Eridius (kevin@moz-6opvqs.us) (Server shutdown)
[02:36:07] *** Joins: Elaine (Elaine@moz-35s2fm.members.linode.com)
[02:36:07] *** Joins: seancorfield (sid45586@moz-lphn72.highgate.irccloud.com)
[02:36:14] *** Joins: huon (huon@moz-hj272o.8rnv.rggd.6180.2400.IP)
[02:36:28] *** Joins: spastorino (sid27384@moz-i6sgse.brockwell.irccloud.com)
[02:36:39] *** Joins: scott (uid25790@moz-e5ok1n.brockwell.irccloud.com)
[02:36:47] *** Joins: jroesch (sid26078@moz-o13a59.charlton.irccloud.com)
[02:36:58] *** Joins: frewsxcv (sid86219@moz-dneii9.brockwell.irccloud.com)
[02:42:39] *** Joins: aturon (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP)
[02:43:00] *** Joins: nmatsakis (sid381@moz-32a8b5.0j4i.jtu0.0101.2620.IP)
[02:43:01] *** Joins: nrc (sid365@moz-3taf2s.0j4i.jtu0.0101.2620.IP)
[02:44:23] *** Joins: pnkfelix (sid344@moz-nnnecs.0j4i.jtu0.0101.2620.IP)
[03:17:05] *** Quits: scott (uid25790@moz-e5ok1n.brockwell.irccloud.com) (Quit: Connection closed for inactivity)
[03:33:39] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[03:44:45] *** Quits: seancorfield (sid45586@moz-lphn72.highgate.irccloud.com) (Ping timeout: 121 seconds)
[03:44:53] *** Quits: jroesch (sid26078@moz-o13a59.charlton.irccloud.com) (Ping timeout: 121 seconds)
[03:45:11] *** Quits: spastorino (sid27384@moz-i6sgse.brockwell.irccloud.com) (Ping timeout: 121 seconds)
[03:45:11] *** Quits: frewsxcv (sid86219@moz-dneii9.brockwell.irccloud.com) (Connection closed)
[03:49:36] *** Joins: frewsxcv (sid86219@moz-dneii9.brockwell.irccloud.com)
[03:56:17] *** Joins: seancorfield (sid45586@moz-lphn72.highgate.irccloud.com)
[04:07:03] *** Joins: spastorino (sid27384@moz-i6sgse.brockwell.irccloud.com)
[04:26:20] *** Joins: jroesch (sid26078@moz-o13a59.charlton.irccloud.com)
[04:33:11] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[04:34:08] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[08:04:18] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Connection closed)
[08:04:32] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[10:20:08] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
[12:36:12] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[12:55:17] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[12:58:27] *** Quits: barosl (barosl@moz-tmp.qma.67.220.IP) (Quit: Leaving)
[13:00:11] *** Joins: barosl (barosl@moz-tmp.qma.67.220.IP)
[14:30:53] <nmatsakis> pnkfelix: hmm, so in this work I'm doing on closures I encountered a shortcoming of PhantomData/OIBIT interaction I hadn't thoroughly considered
[14:31:45] <pnkfelix> nmatsakis: okay?
[14:31:54] <nmatsakis> sorry, trailed off mid-thought :)
[14:32:06] <nmatsakis> so in particular today if you have PhantomData<T>, then OIBIT considers that to mean that you can reach data of type T
[14:32:12] <nmatsakis> which seems reasonable
[14:32:29] <nmatsakis> but there are cases where you want to be invariant over T, but do not have data of type T
[14:32:41] <nmatsakis> and that seems like a reasonable distinction
[14:32:49] <nmatsakis> for example, T may not be sendable,
[14:32:57] <nmatsakis> but if you have no data of type T, it seems ok to send you
[14:33:11] <nmatsakis> the reason this comes up is that I am looking at how we treat closures in OIBIT
[14:33:23] <nmatsakis> and right now we say that the "reachable components" of a closure are the (fully transformed) types of its upvars
[14:33:35] <nmatsakis> but in fact the closure also carries along the type parameters of its environment (and is invariant w/r/t those)
[14:33:47] <nmatsakis> I can point you at a comment explaining this in the abstract, but let me give a concrete example isntead:
[14:34:03] <nmatsakis> fn foo<T:Default>() { let x = || { let v = T::default(); use(v); }; ... }
[14:34:06] <nmatsakis> should x be sendable here?
[14:34:08] <nmatsakis> it has no upvars
[14:34:09] <nmatsakis> no state
[14:34:17] <nmatsakis> but it is invariant w/r/t T
[14:34:21] <nmatsakis> which is not sendable
[14:34:29] <nmatsakis> if you desugared this, you'd be required to have PhantomData<T> somewhere,
[14:34:33] <nmatsakis> and hence you'd become non-sendable
[14:34:49] <nmatsakis> now x is in fact sendable today
[14:35:18] <nmatsakis> (basically my branch is patching some places where our desugaring wasn't accurate, and I realized this)
[14:35:35] <pnkfelix> My browser has decided to become unresponsive
[14:35:47] <nmatsakis> I have to go soon anyway. But that's the puzzle. I'm not sure of the best answer. :)
[14:36:07] <nmatsakis> though it seems to me that the way closures are being treated is good and we want some way to declare a similar thing in normal structs
[14:36:25] <pnkfelix> But my initial reaction, via phone, is: if you need T to be invariant but it is not owned
[14:37:17] <pnkfelix> Then why are you using PhantomData<T> and not PhantomData<&mut T> ?
[14:37:20] <nmatsakis> well
[14:37:24] <nmatsakis> I really meant
[14:37:27] <nmatsakis> PhantomData<...T...>
[14:37:37] <nmatsakis> but no matter what you put there, it's considered reachable
[14:37:50] <nmatsakis> at least I don't see how you could construct a situation where it is not
[14:38:02] <nmatsakis> so w/r/t Send
[14:38:05] <nmatsakis> you could model this today by doing
[14:38:13] <pnkfelix> Reachable from the viewpoint of OIBIT?
[14:38:17] <nmatsakis> (yes)
[14:38:23] <nmatsakis> so if you wanted to hand-write this closure struct today
[14:38:25] <nmatsakis> you could do it like this:
[14:38:35] <nmatsakis> struct NotReachable<T>(PhantomData<T>)
[14:38:38] <pnkfelix> I guess &mut T is still unhelpful
[14:38:43] <nmatsakis> unsafe impl<T> Send for NotReachable<T>
[14:38:46] <nmatsakis> well probably
[14:38:53] <nmatsakis> struct NotReachable<T>(PhantomData<*const T>)
[14:38:56] <nmatsakis> or whatever
[14:39:03] <nmatsakis> but that would only be considered sendable, then
[14:39:15] <nmatsakis> I guess every other OIBIT trait would have to decide if they want to impl themselves for NotReachable<T>
[14:39:21] <nmatsakis> that is, there is an interesting distinction here
[14:39:29] <nmatsakis> it may be that even being able to NAME the type T is not X-safe
[14:39:35] <nmatsakis> (send-safe, in this case, but...)
[14:39:47] <nmatsakis> I can't think of an example though =)
[14:40:01] <nmatsakis> right now the only stable OIBIT traits are send/sync so we can ponder this out a bit
[14:40:22] <nmatsakis> pnkfelix: which reminds me, we should talk about GC and dtors
[14:43:16] <nmatsakis> pnkfelix: I don't have any deep thoughts or anything, just a nagging feeling that it's an area of the design we've not really thought through
[14:54:12] <pnkfelix> nmatsakis: well, on the plus side
[14:54:36] <pnkfelix> nmatsakis: we could just disallow Gc<T> for any T with a destructor that doesn't have this magic attribute we're adding
[14:54:57] <pnkfelix> (i'm not actually sure that really solves anything, but it would be funny if it did)
[15:04:45] <nmatsakis> pnkfelix: have to think about the generic case tho
[17:44:51] *** Joins: scott (uid25790@moz-e5ok1n.brockwell.irccloud.com)
[18:32:52] *** Quits: aturon (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP) (Quit: )
[18:32:59] *** Joins: aturon (sid379@moz-hhfc8n.0j4i.jtu0.0101.2620.IP)
[20:02:20] <nmatsakis> aturon: huon: pnkfelix: nrc: Rust room?
[20:02:52] <nrc> we're there!
[20:02:59] <pnkfelix> (coming)
[20:03:03] <nrc> except pnkfelix
[20:03:07] <nrc> ah, there he is
[21:11:23] <nmatsakis> nrc: pnkfelix: aturon: huon: to be clear, shall I move this IndexSet RFC to FCP? I do feel conversation has reached a standstill.
[21:11:33] <aturon> nmatsakis: yes please
[21:11:49] <huon> wfm
[21:12:16] <nrc> sure
[21:12:35] <pnkfelix> nmatsakis: and I will now merge the macros-in-type position RFC ?
[21:13:13] <pnkfelix> (well, I guess I'll do it tomorrow; it needs to have a proper identifier attached to the feature name, and I don't want to take the time beyond a button push right now)
[21:21:09] *** Quits: Tobba (Tobba@moz-o13d22.bredband.telia.com) (Ping timeout: 121 seconds)
[21:21:28] *** Joins: Tobba (Tobba@moz-o13d22.bredband.telia.com)
