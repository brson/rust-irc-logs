[00:00:16] <cmr> graydon: can you talk metrics for a few minutes?
[00:00:26] <graydon> cmr: sure
[00:00:36] <graydon> heading out in ~10min tho
[00:00:47] <cmr> Coda Hale's Matrics is pretty nice, I think ripping it off wholesale is a good strategy.
[00:00:58] <graydon> I think parts of it, yeah
[00:01:02] <cmr> I'm wondering if we should have per-task metrics, or a per-program registry.
[00:01:12] <graydon> I mean, it's got java-ish idioms and reports to a lot of java-things we don't need
[00:01:13] <cmr> I feel like per-task metrics is very useful
[00:01:19] <graydon> I think per-task is a good start
[00:01:31] <cmr> Well, I'm mostly looking at its core library, the gagues/counters etc
[00:01:34] <graydon> and we can try to build a per-process thing later that finds them all
[00:01:38] <graydon> yes
[00:01:46] <cmr> Ok, I'll get started on that then.
[00:03:00] <graydon> cmr: a patch landed recently that adds reservoir sampling to extra::stats
[00:03:09] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[00:03:43] <graydon> I would suggest basing your port off a light reading of coda's work and a closer reading of the go ports; they're less-featureful but also a whole lot simpler / lighter structure
[00:03:53] <graydon> a lot of the java-isms in the original metrics library just serve to confuse
[00:04:01] <graydon> from our perspective, they're overengineering
[00:04:18] <cmr> I know almost nothing about statistics, so collecting and basic reporting is my main goal.
[00:04:25] <graydon> (that sounds bad -- I think they're probably appropriate for java, I think java has a sort of tendency to require that type of design to interact with its libs)
[00:04:49] <brson> in go `for i := 0; i < 5; i++ {` how do i make that i a uint?
[00:05:14] *** Quits: bent (chatzilla@moz-932324BF.hsd1.ca.comcast.net) (Quit: ChatZilla 0.9.90.1-rdmsoft [XULRunner 22.0/20130619132145])
[00:06:09] <strcat> brson: uint(0) ?
[00:06:11] <graydon> cmr: I think the most relevant bit is _some_ standard library interface for declaring the existence of a metrics group in a TLS registry and tacking new named metrics on to it, fetching them regularly, and hooking up some kind of pluggable reporter-object to same
[00:06:22] <strcat> brson: I don't remember if there's a short way
[00:06:29] *** Joins: ariel (ariel@moz-AB2390D9.hsd1.fl.comcast.net)
[00:06:35] <brson> strcat: thanks
[00:06:54] <graydon> cmr: a key point is that metrics groups ought to be hierarchical. most reporting / aggregating systems work on hierarchical metrics-paths
[00:07:01] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[00:07:06] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[00:07:34] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[00:07:49] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[00:07:51] <graydon> cmr: much of the machinery for calculating percentiles is already in extra::stats
[00:08:30] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[00:09:17] <strcat> rusti: range(0, 10)
[00:09:21] -rusti- {state: 0, stop: 10, one: 1}
[00:09:32] <strcat> rusti: range(0.0, 2.2)
[00:09:32] -rusti- {state: 0, stop: 2.2, one: 1}
[00:09:34] <strcat> heh
[00:09:36] <graydon> cmr: though the EWMA thing is missing, you'll need to add that. or I will if you like.
[00:09:49] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[00:12:56] *** Quits: vk (chatzilla@F92596F.2DEF7520.EF7679FA.IP) (Ping timeout)
[00:14:06] <graydon> cmr: I think https://github.com/rcrowley/go-metrics is likely the best to work from. counter, gauge, meter, histogram + sample and timer
[00:14:09] *** Quits: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP) (Client exited)
[00:14:14] *** Joins: vk (chatzilla@F92596F.2DEF7520.EF7679FA.IP)
[00:15:05] <graydon> ok, gtg now. turning bors back on, slow rate.
[00:15:09] *** Quits: graydon (Adium@A5087023.2354C43D.D8E68FF6.IP) (Quit: Leaving.)
[00:18:10] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[00:19:19] *** Quits: lmandel (lmandel@moz-57D3C086.dsl.bell.ca) (Ping timeout)
[00:20:24] *** Quits: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[00:23:09] *** Joins: lmandel (lmandel@moz-57D3C086.dsl.bell.ca)
[00:25:26] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[00:29:09] *** Joins: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP)
[00:31:07] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[00:31:12] *** Quits: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP) (Ping timeout)
[00:34:06] *** Quits: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com) (Quit: ecr)
[00:34:41] *** Joins: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net)
[00:42:14] *** Quits: huseby (huseby@moz-4E8C421A.husebyhome.com) (Ping timeout)
[00:44:46] *** Quits: lmandel (lmandel@moz-57D3C086.dsl.bell.ca) (Quit: lmandel)
[00:45:58] *** Joins: lmandel (lmandel@moz-57D3C086.dsl.bell.ca)
[00:46:49] <brson> Thiez: ping
[00:48:01] *** Quits: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[00:48:43] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[00:50:01] *** Quits: vk (chatzilla@F92596F.2DEF7520.EF7679FA.IP) (Quit: ChatZilla 0.9.90.1 [Firefox 24.0/20130815180504])
[00:54:00] *** Joins: dew (Instantbir@moz-D2FA52B6.static.stls.mo.charter.com)
[00:54:41] *** Quits: dew1 (Instantbir@moz-D2FA52B6.static.stls.mo.charter.com) (Ping timeout)
[00:57:11] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[00:57:47] *** Joins: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP)
[00:59:46] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[01:00:04] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[01:00:34] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:01:31] *** Parts: ariel (ariel@moz-AB2390D9.hsd1.fl.comcast.net) (WeeChat 0.4.2-dev)
[01:02:23] *** Quits: ozten (ozten@moz-DD3B00B4.hsd1.wa.comcast.net) (Quit: ozten)
[01:03:30] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[01:03:51] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: zzzzzzzzzz)
[01:06:20] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[01:12:44] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[01:13:12] *** kimundi is now known as zz_kimundi
[01:15:16] *** Joins: z0w0 (zack@moz-7E6DC3A.lnse2.woo.bigpond.net.au)
[01:15:46] <pcwalton> brson: r? https://github.com/mozilla/rust/pull/8567
[01:15:57] *** Quits: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com) (Quit: pcwalton)
[01:16:31] *** Quits: KindOne (KindOne@moz-A5D765F3.dynamic.ip.windstream.net) (Ping timeout)
[01:18:43] <cmr> rusti: std::sys::size_of::<HashMap<u8, u8>>()
[01:18:45] -rusti- pastebinned 8 lines of output: http://ix.io/7lg
[01:19:00] <cmr> rusti: use std::hashmap::HashMap;  std::sys::size_of::<HashMap<u8, u8>>()
[01:19:01] -rusti- 40
[01:19:10] <cmr> rusti: use std::hashmap::HashMap;  std::sys::size_of::<HashMap<u16, u16>>()
[01:19:11] -rusti- 40
[01:19:20] <cmr> rusti: use std::hashmap::HashMap;  std::sys::size_of::<HashMap<u64, u64>>()
[01:19:21] -rusti- 40
[01:19:23] <cmr> ok
[01:20:54] <strcat> ugh
[01:20:55] *** Joins: KindOne (KindOne@moz-C811DC12.dynamic.ip.windstream.net)
[01:24:42] *** Quits: mihneadb (Mihnea@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: Leaving)
[01:26:57] *** Quits: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP) (Ping timeout)
[01:26:59] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Ping timeout)
[01:28:11] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[01:29:34] *** Joins: Ralith (ralith@moz-50F3C77.vc.shawcable.net)
[01:29:37] *** Joins: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP)
[01:30:37] <strcat> does anyone have rust dbus bindings? ;p
[01:31:07] *** Quits: eschweic1 (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[01:31:08] *** Joins: mortisha (Mibbit@C7A93F2D.9C68053F.3582B8E7.IP)
[01:31:20] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[01:31:32] *** Quits: mortisha (Mibbit@C7A93F2D.9C68053F.3582B8E7.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[01:31:41] *** Quits: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP) (Ping timeout)
[01:33:01] *** Joins: jaen (jaen@moz-69DF1685.play-internet.pl)
[01:33:04] <mm> Has anybody implemented QNX-style send-receive-reply messaging? http://www.qenesis.com/support/qnx_messaging.html
[01:33:07] <heftig> strcat: would be nice to have, i guess
[01:33:18] <heftig> strcat: maybe as gdbus, together with glib
[01:33:35] <strcat> I need to deal with systemd's machine API stuff
[01:33:44] <strcat> http://www.freedesktop.org/wiki/Software/systemd/machined/
[01:33:53] <strcat> sooner rather than before all my cgroup stuff breaks :)
[01:34:03] <strcat> s/before/after/
[01:34:06] <heftig> strcat: why are you using rust for that now?
[01:34:41] <strcat> heftig: I'm not actually yet
[01:35:00] <cmr> mm: I doubt it
[01:35:02] *** Joins: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net)
[01:35:27] <heftig> strcat: IMO use python or ruby
[01:35:48] * mm implementing it now
[01:36:06] <mm> it's not quite straightforward .. but it's a nice way to program
[01:36:20] <mm> Trying to port my operating system to Rust, which uses SRR messaging for IPC exclusively
[01:38:41] *** Quits: jaen (jaen@moz-69DF1685.play-internet.pl) (Ping timeout)
[01:38:46] *** Joins: tikue (tkuehn@moz-F4812C6E.hsd1.fl.comcast.net)
[01:46:15] <tikue> rusti: Err(1u)
[01:46:21] -rusti- pastebinned 6 lines of output: http://ix.io/7li
[01:47:33] <strcat> needs a way to infer the result type
[01:47:38] <tikue> yeah i know
[01:47:43] <tikue> i just wanted to see if it still existed
[01:47:48] <tikue> Result, i mean
[01:49:19] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[01:52:07] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[01:54:26] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Ping timeout)
[02:00:06] *** Quits: Earnestly (earnest@B0BDF733.8FDE20A.5411983D.IP) (Ping timeout)
[02:01:27] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[02:01:28] *** ChanServ sets mode: +o tjc
[02:02:22] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[02:02:22] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/aInSxA
[02:02:22] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[02:09:17] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[02:11:26] *** Quits: bytewise (bytewise@moz-4A801D04.unitymediagroup.de) (Quit: Leaving)
[02:12:27] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[02:12:27] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/aBw5Hw
[02:12:27] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[02:12:28] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[02:12:28] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/27wVfA
[02:12:28] <ghrust> 13rust/06auto 1415fca2d 15Brian Anderson: compiletest: Run tests in their own thread to avoid blocking the scheduler...
[02:12:28] <ghrust> 13rust/06auto 143255fba 15bors: auto merge of #8531 : brson/rust/test-waitpid-workaround, r=graydon...
[02:12:28] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[02:13:34] *** Quits: azakai (alon@moz-BBE3ABD.mv.mozilla.com) (Quit: Ex-Chat)
[02:17:53] *** Joins: mark_edward (quassel@21027BAA.520D6B7D.BF46A673.IP)
[02:19:31] *** Quits: mark_edward (quassel@21027BAA.520D6B7D.BF46A673.IP) (Client exited)
[02:20:28] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[02:21:00] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[02:21:28] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[02:23:08] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[02:27:52] *** Quits: zz_kimundi (kimundi@moz-7C028A28.dip0.t-ipconnect.de) (Ping timeout)
[02:28:29] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Quit: Leaving)
[02:30:07] *** Joins: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP)
[02:30:57] *** Joins: zz_kimundi (kimundi@moz-84498CE3.dip0.t-ipconnect.de)
[02:31:16] *** zz_kimundi is now known as kimundi
[02:32:03] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[02:32:12] *** Quits: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP) (Ping timeout)
[02:41:25] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[02:41:51] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[02:43:22] *** Joins: cce_ (cce@moz-C8071335.c3-0.smr-ubr1.sbo-smr.ma.cable.rcn.com)
[02:43:31] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[02:44:38] *** Joins: pauls (pauls@moz-BFEF1F22.ccs.neu.edu)
[02:47:07] *** Quits: boredomist (user@moz-63CF9F31.res-cmts.sesp.ptd.net) (Ping timeout)
[02:48:12] *** Quits: cce_ (cce@moz-C8071335.c3-0.smr-ubr1.sbo-smr.ma.cable.rcn.com) (Ping timeout)
[02:59:40] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[03:00:02] <brson> i think I need to add some sort of #[cfg(opt_level(0)] thing in order to selectively disable sanity checks in the runtime
[03:00:10] <brson> *want
[03:00:23] <toddaaro> the various asserts?
[03:00:30] <toddaaro> I always kinda wondered about those
[03:01:11] <brson> toddaaro: the thing i'm looking at right now is local_ptr::take() which calls pthread_setspecific just to set the local ptr to null
[03:01:19] <toddaaro> it would be nice to toggle them, as then we could pile in more without worrying about it
[03:01:21] <brson> asserts on hot paths are important too
[03:01:28] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[03:01:38] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[03:01:58] <toddaaro> I saw you put up an issue for streams
[03:01:59] <brson> getting rid of pthread_set/getspecific completely is going to be important too, though not fun
[03:02:10] <brson> lots of stuff in the profile is about local*
[03:02:12] <brson> frustrating
[03:02:26] <toddaaro> if we have a good message queue that slots in well for stream in addition to the scheduler messages
[03:02:34] <brson> yeah
[03:03:21] <toddaaro> what is the process on swapping over to better local stuff?
[03:06:13] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[03:06:41] <cmr> "thread-specific data"
[03:06:48] <cmr> why don't they call it thread local storage?
[03:06:55] <cmr> is that a different concept in pthreads?
[03:08:18] <brson> toddaaro: port the (inline) asm fns from src/rt/arch/$x/sp.h to rust for a bazillion platforms; each time the context switches put a pointer to the end of the stack in the TCB (slightly awkward for SchedTask); change local_ptr to put things in an offset from the TCB pointer
[03:10:21] <toddaaro> that sounds like a joy
[03:11:15] <brson> cmr: they mean the same thing
[03:18:14] *** Quits: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net) (Input/output error)
[03:24:08] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Ping timeout)
[03:27:28] *** Joins: holomorph (holomorph@moz-78AFD8BB.hsd1.md.comcast.net)
[03:28:05] *** Quits: Jesin (Jessin_@moz-5654D37.washdc.fios.verizon.net) (Ping timeout)
[03:29:01] *** Joins: Jesin (Jessin_@moz-5654D37.washdc.fios.verizon.net)
[03:30:37] *** Joins: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP)
[03:32:41] *** Quits: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP) (Ping timeout)
[03:33:11] *** Joins: cce_ (cce@moz-C8071335.c3-0.smr-ubr1.sbo-smr.ma.cable.rcn.com)
[03:35:00] *** cce_ is now known as carleastlund
[03:39:56] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[03:43:06] *** Quits: Jesin (Jessin_@moz-5654D37.washdc.fios.verizon.net) (Quit: Leaving)
[03:44:06] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[03:48:17] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[03:56:33] <enix> I've got two open pull requests with a few comments but no reviews yet, both for Digest related stuff. Would it help if I merged them into a single one? I saw the note about the queue length issue
[04:08:26] *** Joins: jaen (jaen@moz-EAC33CEF.play-internet.pl)
[04:08:46] <cmr> tjc: thanks for the rebase notices!
[04:09:39] <strcat> cmr: btw you should probably port your stuff to the new cgroup API
[04:09:46] <strcat> just figured out how to use it correctly
[04:10:15] <cmr> strcat: is it just setup/teardown of cgroups that changed?
[04:10:50] <strcat> cmr: no the whole thing
[04:11:01] <strcat> cmr: /sys/fs/cgroup/ is becoming single-writer
[04:11:05] <strcat> only systemd can use it
[04:11:12] <tjc> cmr: no prob! I had a yearning to shrink the bors queue :-)
[04:11:12] <strcat> it's deprecated basically
[04:11:25] <strcat> cmr: all cgroup stuff has to go through systemd
[04:11:39] <strcat> so for a VM or OS container, you use machined
[04:11:49] <strcat> for an application sandbox or resource usage, you use a transient unit
[04:12:09] <strcat> cmr: http://ix.io/7lu anyway I figured out how to make a transient unit
[04:12:16] <strcat> so that gives you a cgroup
[04:12:32] <strcat> so you also have to set properties through dbus
[04:12:50] <strcat> you might be allowed to read them through the virtual fs
[04:13:20] <strcat> it doesn't feel like much of an improvement yet ;P, other than integration with systemd-cgls, etc...
[04:13:47] <Luqman> that glib Variant call :(
[04:14:14] <strcat> yep it's an unreadable PITA :]
[04:14:22] <strcat> it's the fault of gobject/python though
[04:14:28] <strcat> you could make a sane API
[04:14:37] <strcat> ssa(sv)a(sa(sv))
[04:14:39] <strcat> means...
[04:15:24] <strcat> a: str, b: str, c: [(str, variant)], d: [(string, [(string, variant)])]
[04:15:26] <toddaaro> enix: yea, if you want to combine your PRs that would probably help somewhat
[04:15:32] <strcat> Luqman: believe me, unpacking is worse
[04:15:36] <strcat> Luqman: especially with the low-level C API
[04:15:52] <Luqman> i remember taking a look at it years ago.
[04:15:58] <Luqman> doesn't seem like it's gotten any better
[04:16:39] <strcat> Luqman: http://ix.io/7lk sample unpacking, yay!
[04:16:50] <strcat> from a dbus example
[04:16:52] <strcat> ;p
[04:17:07] <Luqman> obviously you need to use Vala instead :P
[04:17:44] * cmr thinks the need to invent a new programing language to paper over APIs is telling
[04:17:45] <strcat> anyway I need to port playpen to this crap
[04:17:54] <strcat> because all the old cgroup stuff is dead
[04:18:02] <cmr> I might just not update
[04:18:09] <strcat> cmr: well it exists for now
[04:18:16] <strcat> systemd 205 introduced slices/scopes and machined
[04:18:22] <enix> my PRs just got reviews 5 minutes after my last message from cmr. i'm still happy to combine them of course, but I don't want to create more work for anyone.
[04:18:25] <strcat> the kernel is going to make the fs single-writer soon
[04:18:29] <strcat> and that single writer is init.
[04:18:35] <cmr> enix: if you merge them just @mention me
[04:20:13] <strcat> great, invalid arg
[04:20:41] * strcat is like the first person to use this crap :|
[04:20:50] <strcat> docs, what are those?
[04:21:20] <strcat> CreateMachine: Finally, the scope properties are passed as array in the same way as PID1's StartTransientUnit() accepts it.
[04:21:33] <strcat> StartTransientUnit: properties contains properties of the unit, specified like in SetUnitProperties
[04:21:42] <strcat> and finally
[04:21:43] <strcat> SetUnitProperties can be used to modify certain unit properties at runtime. Not all properties may be changed at runtime, but many resource management settings (primarily those in systemd.cgroup(5)) may. The changes are applied instantly, and stored on disk for future boots, unless runtime is true, in which case the settings only apply until the next reboot. name is the name of the unit to modify.
[04:21:45] <strcat> properties are the settings to set.
[04:21:50] <strcat> so what the hell are the property names and arg types?
[04:21:52] <strcat> who knows.
[04:22:01] <strcat> MemoryLimit with a string does not make it happy
[04:22:04] <sp3d> to the source!
[04:22:14] <strcat> the source is unreadable dbus crud
[04:22:25] <strcat> sd_bus is at least 1000x nicer than actual dbus
[04:22:31] <strcat> but it's still unreadable
[04:22:33] <strcat> :D
[04:22:49] <strcat> because... it's dynamic typing in C
[04:22:53] <sp3d> sd_bus?
[04:22:59] <strcat> systemd bus
[04:23:02] <sp3d> ah
[04:23:09] <strcat> they have their own client lib and (afaik) an unused server lib
[04:23:14] <strcat> but they are going to replace the old dbus
[04:23:23] <strcat> wrapping https://github.com/gregkh/kdbus
[04:23:25] * strcat shrugs
[04:25:53] <enix> ok, cool, i'll go ahead and combine them. there isn't any particular reason that bors needs to run through 2 cycles for these.
[04:29:07] <heftig> strcat: do yourself a favor and use the dbus bindings to get proxy objects, not the gio ones. less variant headaches
[04:30:22] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[04:30:35] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[04:30:35] *** ChanServ sets mode: +o tjc
[04:31:07] *** Joins: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP)
[04:31:50] <tjc> it's probably bad if my MacBook kernel panicked and invited me to report a filesystem-related error to Apple upon rebooting
[04:31:58] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[04:32:01] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[04:32:01] *** ChanServ sets mode: +o brson
[04:32:27] <brson> Thiez: ping
[04:32:34] <brson> i want that queue so bad
[04:33:11] *** Quits: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP) (Ping timeout)
[04:33:43] <strcat> heftig: sadly systemd's API is incredibly poorly documented
[04:34:02] <strcat> is it supposed to let you introspect the types an API requires?
[04:34:27] <heftig> strcat: sure
[04:42:17] <olsonjeffery> brson: is that who's working on the Chase-Lev dequeue?
[04:42:20] <strcat> heftig: http://ix.io/7lx does what I want at least
[04:42:36] <strcat> but it really needs to be in a systems language because I'm using seccomp :(
[04:42:45] * strcat sighs
[04:42:53] <darkf> what's the reason for using autoconf/make over cmake in rust/rustc?
[04:43:30] <brson> olsonjeffery: no, he was working on a normal queue
[04:43:42] <olsonjeffery> heh. result #8 for a ddg search for "chase lev queue" is a Mozilla Status Board post
[04:43:43] <brson> the work queues are not the most contested locks
[04:43:49] <brson> the sleeper list is getting hammered
[04:43:50] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[04:43:54] <brson> and it's just a normal queue
[04:43:57] * olsonjeffery nods
[04:44:05] <brson> then the scheduler message queues are probabably next-most contested
[04:44:19] <brson> at least in the tests i'm looking at
[04:44:19] <enix> cmr: I rebased all of my changes into https://github.com/mozilla/rust/pull/8272
[04:44:21] <sfackler> strcat: i'm thinking about rewriting fun_treemap. what do you want it to actually be? purely functional and sendable? partially persistent? fully persistent?
[04:44:24] <brson> well, maybe not actually
[04:44:32] <brson> it may be the work queues next
[04:44:41] <brson> but the sleeper list is definitely a problem
[04:45:03] <strcat> sfackler: it should take the box as a type param
[04:45:15] <strcat> Arc, Rc and @ should implement some common trait
[04:45:52] <olsonjeffery> brson: so if i have methods that take an Option<SomeCallback> as the last arg.. i lose the ability to call them with do syntax, huh.
[04:45:53] <strcat> and yes fully persistent
[04:45:58] <strcat> probably
[04:46:10] <brson> olsonjeffery: yes
[04:46:24] <olsonjeffery> im polishing up the lower-level api in rt::uv::file and i want to be able to differentiate between the async/threadpool and sync versions
[04:46:29] <olsonjeffery> of the underlying libuv calls
[04:46:35] <strcat> sfackler: might want to do a new persistent list first
[04:46:58] <sfackler> do we have one currently? i think someone posted one on /r/rust a couple of days ago
[04:47:02] <strcat> sfackler: extra::list
[04:47:07] <sfackler> ah
[04:47:28] <strcat> needs to be replaced with a modern one with methods + user deciding the box type
[04:47:40] * olsonjeffery resists to urge say "wish we had argument overloading"
[04:48:02] <strcat> traits ;p
[04:48:11] <sfackler> what's the difference between @ and Gc other than @ being built into the compiler? Does @ do cycle detection?
[04:48:20] <sfackler> er, Rc
[04:48:27] <strcat> @ will be gc
[04:48:49] <strcat> a no-op gc is a valid gc, so what it does now (leaking cycles) is still valid
[04:49:00] <strcat> but semantically, Rc doesn't allow cycles in the first place
[04:49:06] <strcat> and @ does
[04:49:21] <strcat> it'd be hard to make a cycle with @ anyway, you'd need to use Cell
[04:49:30] *** Quits: jaen (jaen@moz-EAC33CEF.play-internet.pl) (Ping timeout)
[04:49:31] <strcat> or an embedded @mut (which makes it easy)
[04:50:04] <sfackler> cool
[04:50:15] *** Joins: eatkinson (eatkinson@5AA7EAAB.1CF4A467.6C91C3A5.IP)
[04:52:11] <sfackler> for the persistent map, it looks like a fully functional (i.e. truly immutable trees) ends up with logn overhead per copy, where a non-functional approach gives you constant overhead. the non-functional version will be more of a pain to send across tasks though
[04:54:34] *** Quits: eatkinson (eatkinson@5AA7EAAB.1CF4A467.6C91C3A5.IP) (Quit: eatkinson)
[04:54:48] <sfackler> i assume that the common use case for the map would be sending copies across tasks, since i don't think that people are doing tons of computational geometry in rust right now :P
[04:56:14] <toddaaro> brson: ah sleeperlist, duh
[04:56:34] <toddaaro> brson: I was thinking about that one, I think we can do something more sensible for that case
[04:57:40] <toddaaro> brson: I think we can set that up as a vector of pointers to atomic options, initialized the same way stealing is
[04:58:16] <toddaaro> brson: so then when you want to sleep you swap in your handle to the option, and a scheduler calling wake just checks options at random
[04:58:26] <strcat> it's going to be a real huge pain to support cgroups from rust now :(
[04:58:34] <toddaaro> I think that would be pretty fast, and avoid any normal locking
[04:58:35] <strcat> I guess I should start on rust-dbus...
[04:58:55] <toddaaro> but it could end up pretty bad from doing reads on options and seeing None
[04:59:02] <brson> toddaaro: that sounds plausible but ... yeah
[04:59:11] <brson> you could try really hard to do nothing
[04:59:41] <brson> and this happens on the enqueue_task path that needs to be really fast
[04:59:59] <toddaaro> doing a single random ping might be enough, but I'm not sure
[05:00:25] <toddaaro> if you get a None back, just don't worry about it as a scheduler is active so things will probably work out
[05:02:34] <toddaaro> maybe we just want a concurrent bag
[05:03:00] <toddaaro> I'm not at all knowledgeable about bags, but they should be pretty fast?
[05:03:08] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[05:04:22] <brson> i'm not familiar but am open to experimentation
[05:04:54] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[05:05:06] <brson> toddaaro: just turning off rtassert! seems to improve perf noticably
[05:05:16] *** Quits: jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net) (Quit: zzz)
[05:05:37] <toddaaro> I'm just assuming that if you remove all the restrictions on ordering elements coming out it should go faster, but googling for the topic I find the .NET 4.0 concurrent bag which is really just thread-local linked lists with some sort of stealing
[05:05:41] <toddaaro> so that is kinda useless
[05:06:03] <toddaaro> I'll ask a few IU people about it
[05:06:18] <toddaaro> brson: wow, I figured that would help but not by much
[05:06:25] <toddaaro> does it dodge a lot of TLS?
[05:06:56] <brson> your message passing test goes from ~2.6s to ~2s here
[05:07:05] *** Quits: heftig (heftig@moz-53276FB3.dip0.t-ipconnect.de) (Input/output error)
[05:07:12] *** Joins: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP)
[05:07:37] <sfackler> strcat: i don't think having the box as a type param makes a ton of sense since that'll require the contained types to be Freeze+Send even when you aren't using Arc as the box, right?
[05:07:40] <brson> not sure why
[05:07:47] <brson> there are some asserts that hit tls though
[05:08:40] *** Joins: heftig (heftig@moz-53276FB3.dip0.t-ipconnect.de)
[05:09:57] <brson> oh, with that go is only 5.4x faster than rust
[05:10:03] <brson> we've totally got this
[05:14:49] <toddaaro> wow go is that much faster
[05:15:11] <toddaaro> we need to go to town on datastructures
[05:15:42] <toddaaro> I sent off an e-mail asking about concurrent bags and describing the sleeper list usecase, maybe someone will have a suggestion
[05:15:58] <brson> go is amazingly fast at both message passing and i/o. it's going to take us a lot of work to catch up :-/
[05:16:26] <brson> they have bounded message queues though
[05:16:34] <brson> so our profiles are dominated by malloc and they don't allocate
[05:16:40] <toddaaro> hm, we should hack out something for that
[05:16:48] <toddaaro> the protocol compiler was great for this sort of thing
[05:16:49] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[05:17:03] <toddaaro> so uh, how do you fail if the bounded queue is full?
[05:17:07] <brson> they block
[05:17:08] <toddaaro> that sounds apocalyptic
[05:17:10] <brson> they're deadlocky
[05:17:18] <toddaaro> eew
[05:17:24] <brson> i think we're pretty happy with unbounded queues
[05:17:30] <brson> they just need to be faster
[05:18:07] <brson> of course we can have bounded options, maybe using channel contracts, but I don't think we want them by default
[05:18:30] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[05:18:56] <toddaaro> I'm really skeptical they are the right option
[05:19:16] <toddaaro> either you prove that you need X bytes and reuse them like protocols, or you should be able to grow unbounded
[05:19:36] <toddaaro> overallocating to start could be good in many cases though
[05:19:43] <toddaaro> so you only allocate if the queue gets really big
[05:22:29] <toddaaro> brson: do you have a go install you use to run benchmarks?
[05:22:48] <toddaaro> that is something I should try - installing go and writing the ping-pong benchmark in go
[05:23:02] *** Quits: lmandel (lmandel@moz-57D3C086.dsl.bell.ca) (Quit: lmandel)
[05:23:12] <brson> https://github.com/brson/rust-sched-bench/blob/master/pingpong.go
[05:23:14] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Ping timeout)
[05:23:37] <brson> go is very easy to build
[05:23:43] <brson> their entire test suite runs in 3 minutes
[05:23:48] <brson> go is awesome!
[05:23:48] <toddaaro> whoa
[05:24:16] <brson> in some respects at least
[05:24:25] <olsonjeffery> different priorities
[05:25:36] <ion> With certain modifications, *any* test suite can be made to run in 3 minutes. ;-)
[05:25:43] <brson> yeah I don't actually like the *language* but their engineering is svelt
[05:25:47] <bjz> any idea about this ICE? task <unnamed> failed at 'lookup_item: id not found: 81749', /Users/brendan/dev/rust/rust/src/librustc/metadata/decoder.rs:92
[05:26:26] <brson> i shouldn't have said that. nobody quote me
[05:26:34] *** Quits: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP) (Quit: buildmaster reconfigured: bot disconnecting)
[05:26:43] <olsonjeffery> hee.
[05:26:49] <bjz> brson: xD
[05:27:29] <bjz> brson: https://botbot.me/mozilla/rust/msg/5257064/
[05:27:46] <bjz> [o__o] watches all
[05:28:01] *** Joins: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP)
[05:28:17] <strcat> sfackler: Freeze *or* Send
[05:28:29] <strcat> Freeze is very small constraint
[05:28:48] <ion> bjz: The bad thing about that is that it shows quotes in context.
[05:28:56] <bjz> haha
[05:28:58] <bjz> yes
[05:29:59] <bjz> any idea about that ICE?
[05:30:18] <bjz> oh wait
[05:30:47] <bjz> woops, silly me
[05:30:48] <bjz> dw
[05:31:47] <sfackler> strcat: isn't Arc only implemented for T:Freeze+Send?
[05:31:52] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[05:32:08] <strcat> sfackler: true, I was just thinking about Rc
[05:32:40] <strcat> anyway I'm not sure what else you would do
[05:33:15] <sfackler> there could be a SendableList implemented for Freeze+Send and a normal List that only needs Freeze
[05:33:32] *** Quits: robn (robn@moz-76B0302C.static.internode.on.net) (Ping timeout)
[05:33:36] <sfackler> though if you're not sending, I'm not sure that a persistent data structure is super useful in most cases
[05:34:34] <strcat> starting to feel like the type of thing not belonging in the stdlib because there are so many ways to do it
[05:34:42] *** Quits: KindOne (KindOne@moz-C811DC12.dynamic.ip.windstream.net) (Ping timeout)
[05:34:49] <sfackler> yeah
[05:34:56] *** Quits: tikue (tkuehn@moz-F4812C6E.hsd1.fl.comcast.net) (Quit: tikue)
[05:35:09] <strcat> the implementation is going to be very specific to the use case
[05:35:20] <strcat> and for high-fanout ones refcounting is going to be slow
[05:35:30] <strcat> for lists and binary trees it's fine
[05:35:46] <strcat> so I don't think most persistent data structures will be useful in rust
[05:35:54] *** Joins: robn (robn@moz-76B0302C.static.internode.on.net)
[05:36:23] <strcat> and Arcs might be too slow for the use cases
[05:36:49] <strcat> since a refcount of a node is going to invalidate caches
[05:38:42] <sfackler> agreed
[05:39:50] *** Quits: paulproteus (quassel@rose.makesad.us) (Ping timeout)
[05:41:21] <bjz> brson: should I be using std::rt::io now as opposed to std::io?
[05:41:35] *** Joins: paulproteus (quassel@moz-E86A3B42.makesad.us)
[05:42:05] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[05:42:05] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 143255fba to 14a1674b6: 02http://git.io/N3iJvQ
[05:42:05] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[05:42:07] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[05:42:07] <ghrust> 01[13rust01] 15bors pushed 15 new commits to 06auto: 02http://git.io/X_EUPw
[05:42:07] <ghrust> 13rust/06auto 1447d384c 15Patrick Walton: librustc: Remove `&const` and `*const` from the language....
[05:42:07] <ghrust> 13rust/06auto 14f29c1f8 15Patrick Walton: librustc: Add support for type parameters in the middle of paths....
[05:42:07] <ghrust> 13rust/06auto 14fe37d81 15Patrick Walton: librustc: Ensure that type parameters are in the right positions in paths....
[05:42:09] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[05:42:20] <sfackler> strcat: any objections to killing off fun_treemap then?
[05:42:28] *** Quits: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[05:44:58] <strcat> sfackler: no objections
[05:45:02] <strcat> it's useless as-is :)
[05:49:27] <brson> bjz: well, rt::io doesn't do files yet, so if you want files then use std::io and if you want networking use rt::io :)
[05:49:37] <brson> in general rt::io is a little underbaked yet
[05:49:41] <bjz> ook
[05:49:49] <bjz> yeah I need to write to a file
[05:50:19] <olsonjeffery> soon, soon.
[05:50:54] <sfackler> strcat: r? https://github.com/mozilla/rust/pull/8572
[05:53:05] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[05:58:54] <brson> cfg! is a revelation
[06:05:09] <bjz> ?
[06:05:26] <bjz> brson: cfg!?
[06:06:18] <brson> bjz: yeah, i just wrote this function: `pub fn should_enforce_sanity() -> bool { !cfg!(rtopt) || cfg!(rtdebug) || cfg!(rtassert) }`
[06:06:25] <brson> which should become a compile-time constant
[06:06:33] <bjz> ha
[06:06:42] <bjz> neat
[06:07:10] <brson> #[inline(always)]
[06:22:27] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[06:23:37] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Quit: Konversation terminated!)
[06:24:13] *** Quits: cdidd (cdidd@moz-F392B1B8.broadband.corbina.ru) (Input/output error)
[06:26:02] *** Joins: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net)
[06:26:25] *** Quits: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net) (Client exited)
[06:26:47] *** Joins: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net)
[06:27:03] *** Joins: cdidd (cdidd@moz-6072AF01.broadband.corbina.ru)
[06:27:51] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[06:27:51] *** ChanServ sets mode: +o brson
[06:28:29] *** Quits: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net) (Ping timeout)
[06:33:16] <strcat> brson: can you make that a static instead of a fn? seems like it
[06:33:21] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Connection reset by peer)
[06:33:42] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[06:34:05] <strcat> so my cgroup code went from ~50 lines to ~200 lines :[
[06:41:52] *** Quits: geomyidae (geomyidae@DD6F7E3A.21468E9A.30200F38.IP) (Client exited)
[06:42:04] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[06:42:04] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/5o2Oqw
[06:42:04] <ghrust> 13rust/06auto 1447d384c 15Patrick Walton: librustc: Remove `&const` and `*const` from the language....
[06:42:04] <ghrust> 13rust/06auto 14f29c1f8 15Patrick Walton: librustc: Add support for type parameters in the middle of paths....
[06:42:05] <ghrust> 13rust/06auto 14fe37d81 15Patrick Walton: librustc: Ensure that type parameters are in the right positions in paths....
[06:42:07] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[06:50:08] *** Joins: mrordinaire (Mibbit@1A659656.A607747.FD383126.IP)
[06:51:14] *** Quits: holomorph (holomorph@moz-78AFD8BB.hsd1.md.comcast.net) (Quit: 0.4.1)
[06:53:51] *** Quits: mrordinaire (Mibbit@1A659656.A607747.FD383126.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[07:01:13] *** Quits: tautologico (lymph@8ABDEDA.34CAB63A.7B974E06.IP) (Quit: tautologico)
[07:07:56] *** Quits: carleastlund (cce@moz-C8071335.c3-0.smr-ubr1.sbo-smr.ma.cable.rcn.com) (Quit: carleastlund)
[07:11:03] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[07:11:45] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[07:14:57] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[07:22:07] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[07:22:07] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14cb98d9d to 14a1674b6: 02http://git.io/N3iJvQ
[07:22:07] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[07:22:08] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[07:22:08] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/5g0rdQ
[07:22:08] <ghrust> 13rust/06auto 1415fca2d 15Brian Anderson: compiletest: Run tests in their own thread to avoid blocking the scheduler...
[07:22:08] <ghrust> 13rust/06auto 148ac1773 15bors: auto merge of #8531 : brson/rust/test-waitpid-workaround, r=graydon...
[07:22:09] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[07:23:55] *** Joins: sebcrozet (sebcrozet@moz-7FB6C00B.w193-252.abo.wanadoo.fr)
[07:31:00] *** Joins: FDS (arnaud@moz-CE4D5907.bdx.modulonet.fr)
[07:31:53] *** Joins: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru)
[07:32:23] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[07:33:11] *** Quits: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru) (Quit: dim-an)
[07:37:19] *** Quits: madmoose (Hat@moz-E1973371.nerp.net) (Ping timeout)
[07:38:00] *** Quits: paulproteus (quassel@rose.makesad.us) (Ping timeout)
[07:39:37] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Connection reset by peer)
[07:40:09] *** Joins: paulproteus (quassel@moz-E86A3B42.makesad.us)
[07:42:43] <Thiez> brson: pong
[07:43:01] *** Joins: madmoose (Hat@moz-E1973371.nerp.net)
[07:44:04] <brson> Thiez: you wrote a lock-free queue. can i touch it?
[07:44:19] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[07:45:29] <Thiez> brson: sure, I think it worked pretty well last time I checked (no complaints from valgrind)
[07:46:10] <brson> Thiez: where is it?
[07:46:20] <Thiez> I've been meaning to update it to use ~ instead of malloc now that the headers are gone, but my computer recently got a chance to experience lightning and has been reluctant to boot ever since >:(
[07:47:13] *** Joins: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net)
[07:47:20] *** Quits: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro) (Ping timeout)
[07:47:20] <Thiez> brson: https://github.com/Thiez/rust/tree/ll-message-queue
[07:47:34] *** Joins: Ms2ger (Ms2ger@moz-5D93EAD4.ugent.be)
[07:47:43] <Thiez> but it's been bitrotting for a while now, I hope it still works
[07:48:32] <brson> Thiez: thanks!
[07:51:43] *** Joins: CanhTak (Mibbit@moz-119F06F6.rev.sfr.net)
[07:53:53] *** Quits: CanhTak (Mibbit@moz-119F06F6.rev.sfr.net) (Quit: http://www.mibbit.com ajax IRC Client)
[07:57:32] *** Joins: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru)
[08:02:47] *** Joins: KindOne (KindOne@moz-7F7CBF25.dynamic.ip.windstream.net)
[08:05:10] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[08:19:31] *** Quits: madmoose (Hat@moz-E1973371.nerp.net) (Ping timeout)
[08:19:58] *** Quits: paulproteus (quassel@rose.makesad.us) (Ping timeout)
[08:19:59] *** Joins: madmoose (Hat@moz-E1973371.nerp.net)
[08:20:46] *** Joins: true_droid (true_droid@moz-123FD9B8.beck.volia.net)
[08:22:02] *** Joins: paulproteus (quassel@moz-E86A3B42.makesad.us)
[08:25:42] *** Joins: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro)
[08:26:35] *** Quits: Voomer (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net) (Ping timeout)
[08:31:28] *** Joins: maik (maik___@moz-C3E4E31D.dip0.t-ipconnect.de)
[08:35:34] *** Joins: Voomer (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net)
[08:45:52] *** Quits: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru) (Quit: dim-an)
[08:54:57] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[09:03:38] *** Quits: heftig (heftig@moz-53276FB3.dip0.t-ipconnect.de) (Ping timeout)
[09:05:17] *** Joins: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru)
[09:05:25] *** Quits: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru) (Quit: dim-an)
[09:06:58] *** Joins: heftig (heftig@moz-FBD651D9.dip0.t-ipconnect.de)
[09:11:56] *** Quits: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net) (Quit: eatkinson)
[09:13:53] *** Joins: CanhTak (Mibbit@moz-119F06F6.rev.sfr.net)
[09:16:11] *** Quits: CanhTak (Mibbit@moz-119F06F6.rev.sfr.net) (Quit: http://www.mibbit.com ajax IRC Client)
[09:22:44] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[09:23:17] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[09:26:53] *** Quits: Voomer (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net) (Connection reset by peer)
[09:28:36] *** Joins: Voomer (Voomer@moz-CC05FF5E.hsd1.wa.comcast.net)
[09:34:27] *** Quits: Ms2ger (Ms2ger@moz-5D93EAD4.ugent.be) (Connection reset by peer)
[09:35:25] *** Joins: Ms2ger (Ms2ger@59A8FC80.80FA5708.187A1082.IP)
[09:48:26] <maik> I guess there is no built in method for deleting all incoming messages on a port? http://seld.be/rustdoc/master/std/comm/struct.Port.html
[09:50:05] *** Joins: feduser (feduser@6ADA9854.5167330B.CDBED010.IP)
[10:03:27] *** Joins: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP)
[10:03:27] *** Quits: youknowone (youknowone@A826BD81.8A0DEF81.38747683.IP) (Z:lined (Open Proxy found on your host. Please visit www.blitzed.org/proxy?ip=115.68.131.49 for more information.))
[10:09:55] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Ping timeout)
[10:17:46] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Ping timeout)
[10:18:43] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[10:22:06] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[10:22:06] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/5g0rdQ
[10:22:06] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[10:24:33] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[10:26:02] *** Joins: jaen (jaen@moz-E2BB7BAD.play-internet.pl)
[10:27:11] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[10:27:26] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[10:31:29] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[10:32:06] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[10:32:06] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Be0sAg
[10:32:06] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[10:32:27] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Quit: WeeChat 0.4.2-dev)
[10:33:45] *** Joins: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca)
[10:33:58] *** Joins: mindcat (mindcat@66ED7468.F11C85BB.431667FD.IP)
[10:35:09] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[10:35:41] <mindcat> Ok, I can spawn a subprocess in python, but how can do this with rust?
[10:35:43] *** Joins: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru)
[10:36:00] *** Joins: cyndis (cyndis@moz-C4357EA7.kapsi.fi)
[10:36:25] <myname> mindcat: like in the example on the web site?
[10:37:01] <mindcat> myname: what?
[10:37:32] *** Joins: Earnestly (earnest@B0BDF733.8FDE20A.5411983D.IP)
[10:37:44] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[10:37:48] <myname> mindcat: how did you get here?
[10:38:09] <mindcat> myname: did you mean this channel?
[10:38:10] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[10:38:12] <myname> yes
[10:38:21] <myname> i assume you came from http://www.rust-lang.org/
[10:39:13] <mindcat> myname: I just google rust channel IRC, and I am here
[10:39:32] <mindcat> myname: yes
[10:39:39] <myname> did you searched something like in the example code?
[10:39:50] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[10:40:20] <mindcat> myname: I tried, "rust subprocess", "rust child process".
[10:40:33] <Seldaek> mindcat: rust calls them tasks
[10:40:56] <mindcat> Seldaek: tasks?
[10:41:23] <maik> mindcat, yes tasks
[10:41:51] <Seldaek> mindcat: well I assume you mean threading, which is tasks in rust, because the language runtime manages all your fake-threads into a few real threads
[10:42:04] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[10:42:04] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/Be0sAg
[10:42:04] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[10:42:05] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[10:42:06] <ghrust> 01[13rust01] 15bors pushed 16 new commits to 06auto: 02http://git.io/O1mBuA
[10:42:06] <ghrust> 13rust/06auto 1447d384c 15Patrick Walton: librustc: Remove `&const` and `*const` from the language....
[10:42:06] <ghrust> 13rust/06auto 14f29c1f8 15Patrick Walton: librustc: Add support for type parameters in the middle of paths....
[10:42:06] <ghrust> 13rust/06auto 14fe37d81 15Patrick Walton: librustc: Ensure that type parameters are in the right positions in paths....
[10:42:08] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[10:42:10] <Seldaek> mindcat: if you mean subprocess as in executing an external binary, that's another thing though :)
[10:42:30] <mindcat> Seldaek: No, I mean.. yes
[10:42:31] <maik> do we have a wiki about benchmarks in rust?
[10:43:27] <Seldaek> mindcat: for external processes, it's at http://static.rust-lang.org/doc/0.7/std/run.html but doesn't seem to have nice examples yet
[10:43:34] <doomlord> is there a yield in the tasks at the minute
[10:43:56] <mindcat> Seldaek: Oh, thanks!
[10:44:15] <mindcat> Seldaek: let me see~
[10:44:29] <maik> doomlord, what should yield do?
[10:45:23] <doomlord> yield as far as i've heard the term used = suspend the current task and allow another to run (until the scheduler decides to resume it). manualcontrol of timeslices basically
[10:45:24] <mindcat> Well, I am new for learn rust :D
[10:45:26] *** Quits: doener (doener@moz-A47ED54E.unitymediagroup.de) (Quit: leaving)
[10:45:51] *** Joins: veer (veer@593490FC.68091A0B.A3D1B221.IP)
[10:48:08] <maik> i know there is only a yield in the scheduler that we can use
[10:48:50] <doomlord> i wondered if rust tasks were fine grain enough for game engine actors :) i'd want sleep for that. eg. wake up every actor to process a tick message once a frame... but keep actor state in its locals..
[10:48:57] <veer> hello, is there any example of recursive types , using borrowed pointer '&'  
[10:49:32] <doomlord> prorbably wouldn't be as efficient as manually consturcted game engine actor sytem ... but it would be interesting to see..
[10:50:14] <maik> veer, recursive types need a pointer 
[10:50:29] <maik> veer, http://www.reddit.com/r/rust/comments/1kf3n9/functional_list_in_rust/
[10:51:03] <maik> doomlord, that's what I am currently researching :)
[10:51:24] <doomlord> nice!
[10:51:40] *** Quits: BitPuffin (quassel@moz-7BB00EC9.bredband.comhem.se) (Ping timeout)
[10:51:42] <maik> I am also doing FRP in Rust
[10:51:47] *** Quits: jaen (jaen@moz-E2BB7BAD.play-internet.pl) (Ping timeout)
[10:52:02] <maik> which is task and message based
[10:52:11] <maik> not sure if this makes sense that why I want to benchmark it
[10:52:18] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Connection reset by peer)
[10:52:33] *** Joins: BitPuffin (quassel@moz-7BB00EC9.bredband.comhem.se)
[10:53:02] <doomlord> i wondered if with 'yield' and 'sleep' you could manually controll it completely, perhaps theycould give you a way of spawning a task that isn't automatically sheduled and expects that to be used
[10:55:00] <maik> haven't looked into the scheduler yet, but I think we can create our own scheduler, so it should be possible to have fine grained control. 
[10:56:08] <doomlord> i think fibres work as i describe?
[10:56:16] <doomlord> (as oppoosed to threads)
[10:57:25] <doomlord> i've not looked into 'FRP' ever myself
[10:58:08] <maik> I have used fibers in javascript but I actually don't know how they work internally
[10:58:26] <maik> I also have no idea if FRP :D I just implemented what I think could be FRP 
[10:58:27] <maik> :p
[10:59:15] <maik> rusti: ~":D".repeat(10)
[10:59:16] -rusti- ~~":D:D:D:D:D:D:D:D:D:D"
[11:12:03] *** Quits: Earnestly (earnest@B0BDF733.8FDE20A.5411983D.IP) (Ping timeout)
[11:16:35] <maik> okay it is not even that bad
[11:17:27] <maik> 8% slower than pure function calls
[11:17:36] <cmr> doomlord: so by yield and sleep do you mean like lua coroutines?
[11:17:44] <cmr> they sound like it
[11:17:55] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[11:20:25] <maik> wow task messaging is super efficient
[11:21:02] <cmr> maik: and yet the rt folk continue to make it 10-40% every day :P
[11:21:09] <cmr> 10-40% faster, that is
[11:21:18] <cmr> it's fast, but not nearly as fast as it could be.
[11:22:04] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[11:22:05] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14c146c29 to 148ac1773: 02http://git.io/N3iJvQ
[11:22:05] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[11:22:08] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[11:22:08] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/QE37XQ
[11:22:08] <ghrust> 13rust/06auto 14b4b0759 15Erick Tryzelaar: Deny warnings in stage1+ libsyntax/librustc/librustdoc/librusti/librust
[11:22:08] <ghrust> 13rust/06auto 146268975 15Erick Tryzelaar: Deny warnings in tests
[11:22:08] <ghrust> 13rust/06auto 14e6dfd5b 15bors: auto merge of #8441 : erickt/rust/deny-warnings, r=erickt...
[11:22:09] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[11:23:12] <maik> no that makes no sense, my message passing is now faster than pure function calls
[11:23:15] <maik> sth is wrong
[11:23:46] <cmr> tasks run on multiple threads
[11:24:00] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[11:24:17] <maik> yeah i know
[11:24:18] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[11:24:21] <maik> oh wait
[11:24:33] <maik> 1 task can run on multiple threads?
[11:24:44] <cmr> no
[11:24:45] *** Joins: Earnestly (earnest@B0BDF733.8FDE20A.5411983D.IP)
[11:24:52] <cmr> well, it could be rescheduled onto a different thread
[11:25:03] <cmr> but not running on multiple threads concurrently
[11:25:22] <maik> it's more likke 10000 tasks run on 4threads ( depends on the machine) right?
[11:25:28] *** Quits: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro) (Ping timeout)
[11:25:29] <maik> like*
[11:25:35] <cmr> yes
[11:27:20] <maik> is this how I do a function benchmark? https://gist.github.com/MaikKlein/6256460
[11:27:59] <maik> with "let time = extra::time::precise_time_s() - time;"
[11:28:04] <cmr> Use the built-in benchmark runner.
[11:28:40] <maik> the "let args = if os::getenv("RUST_BENCH").is_some() {" ?
[11:28:43] <cmr> https://github.com/mozilla/rust/wiki/Doc-unit-testing#benchmarking
[11:28:53] <maik> oh
[11:28:56] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[11:29:04] <maik> I was searching for it but I couldn't find it, well it was under testing :(
[11:29:08] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Quit: Leaving)
[11:29:39] <maik> okay nice
[11:37:27] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[11:38:21] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[11:40:01] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[11:41:41] <maik> cmr, there is no --bench anymore :(
[11:42:01] <maik> cmr, it does look like "rustc test.rs --bench" right?
[11:42:08] <cmr> maik: no, rustc --test test.rs
[11:42:12] <cmr> and then ./test --bench
[11:42:37] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[11:42:41] <maik> ah ok
[11:45:32] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[11:49:43] *** Quits: BitPuffin (quassel@moz-7BB00EC9.bredband.comhem.se) (Ping timeout)
[11:51:43] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Connection reset by peer)
[11:52:06] *** Joins: BitPuffin (quassel@moz-7BB00EC9.bredband.comhem.se)
[11:55:43] <maik> oh this is actually pretty nice, I think it is my first useful program in rust :p
[11:56:30] *** Quits: veer (veer@593490FC.68091A0B.A3D1B221.IP) (Ping timeout)
[12:00:21] *** Parts: FDS (arnaud@moz-CE4D5907.bdx.modulonet.fr) ()
[12:07:09] *** flaper87|afk is now known as flaper87
[12:09:32] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[12:12:06] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[12:12:06] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14e6dfd5b to 148ac1773: 02http://git.io/N3iJvQ
[12:12:06] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[12:12:07] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[12:12:07] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02https://github.com/mozilla/rust/compare/8ac17731eba2...1942a7a3fb3e
[12:12:07] <ghrust> 13rust/06auto 14328261a 15Gavin Baker: Add UUID support to libextra...
[12:12:07] <ghrust> 13rust/06auto 141942a7a 15bors: auto merge of #8053 : gavinb/rust/uuid_std, r=alexcrichton...
[12:12:08] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[12:22:26] *** Joins: Florob (Florob@moz-39532932.de)
[12:23:22] *** Joins: obk (Mibbit@moz-B0F26027.red.bezeqint.net)
[12:25:00] <obk> Is it possible to write a macro `fmt_expr!(x)` that would expand to `fmt!("x = %?", x)` ?
[12:25:10] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[12:25:54] *** Joins: nsf (nsf@moz-EEF3238A.convex.ru)
[12:26:15] <cmr> rusti: stringiy!(x)
[12:26:16] -rusti- <anon>:5:9: 5:17 error: macro undefined: 'stringiy'
[12:26:16] -rusti- <anon>:5          stringiy!(x)
[12:26:16] -rusti-                   ^~~~~~~~
[12:26:16] -rusti- application terminated with error code 101
[12:26:19] <cmr> rusti: stringify!(x)
[12:26:20] -rusti- "x"
[12:26:38] <cmr> rusti: let x = 4; fmt!("%s = %?", stringify!(x), x)
[12:26:39] -rusti- ~"x = 4"
[12:26:48] <cmr> obk: you'd do that, more or less.
[12:27:00] <cmr> but yes, it is.
[12:27:15] <obk> Right - there's no automatic concatenation of strings at the macro level, I gather?
[12:27:31] <cmr> no automatic concatentation of strings anywhere
[12:28:11] <obk> Hmmm. I can live without it, but when its useful, its very useful.
[12:28:50] <obk> Just saying ` "foo" "bar" ` being equivalent to ` "foobar" ` is useful at times...
[12:30:11] <cmr> it could be implemented with a macro
[12:30:57] <obk> How so?
[12:32:07] <cmr> take N expressions and concatenate their results
[12:32:08] <obk> You could create a macro that called run-time string concatenation, I guess
[12:32:14] <cmr> right
[12:32:16] <nsf> hi, I'm having trouble understanding rust's module system. One particular cases confuses me. Why it's necessary to write "use std::rand::RngUtil" in order to be able to use the generic implementation of that trait?
[12:32:28] <obk> But this would be a run-time thing. Not a 0-cost compile-time thing.
[12:33:10] <nsf> I don't get it, you "import" trait, and you get the implementation as well. Maybe there is an article about it somewhere?
[12:33:15] <cmr> nsf: A trait needs to be in scope to call the methods it defines, for coherence and simplicity reasons. You'd never be able to have two methods with the same name on the same type otherwise.
[12:33:27] <nsf> cmr: I see
[12:34:10] <nsf> so, in that case I have another question, let's pretend I have a library X which has an implementation of io::Reader
[12:34:26] <nsf> does it mean that in order to use read method on that implementation I'll have to add "use io::Reader;"?
[12:34:38] <nsf> isn't that weird? :)
[12:34:57] <cmr> Reader is in the prelude.
[12:35:01] <nsf> using library X and having to add a use statement from a different library
[12:35:07] <nsf> sure, but not everything is
[12:35:58] <cmr> yes, you need to have the trait in scope to use it, regardless of where the trait is, and regardless of the type that implements it.
[12:36:06] <nsf> k, thanks
[12:36:27] <nsf> but in order to use plain impl methods of a struct, no such thing is required, right?
[12:36:39] <cmr> it's the only way to be able to deterministically decide method resolution with any conbination of libraries
[12:36:41] <cmr> right
[12:37:23] <nsf> wouldn't that lead to method clones? one for impl of a particular trait and one for not having to add "use libx::TraitY;"?
[12:37:51] <nsf> I'm not saying it's bad or wrong or anything.. language design is hard, I know that
[12:37:52] <ChrisMorgan> obk: in Python, sometimes I love AST-level string concatenation and sometimes I hate it. I love it: it's very useful. I hate it: it makes it easy to make mistakes in cases where you meant to have a comma at the end of the line. (This wouldn't matter in Rust most of the time but could in vectors.)
[12:37:53] <nsf> just curious
[12:37:53] <cmr> no, nobody duplicates their methods just so they don't have to import the trait.
[12:37:58] <nsf> k :)
[12:38:18] * ChrisMorgan wants a crate-level prelude
[12:38:39] <nsf> cmr: yet.. :)
[12:38:42] <obk> ChrisMorgan: "When she was good, she was very very good, and when she was bad, she was horrid" :-)
[12:38:47] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[12:39:27] <cmr> nsf: it's not even possible. if you *do* have the trait in scope, you won't be able to call the method at all
[12:39:27] <nsf> cmr: anyways, thanks for clarifying
[12:39:32] <obk> What I'm missing more than concatenation is a proper "here document"
[12:39:41] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[12:39:43] <nsf> right, will lead to ambiguity
[12:39:53] <nsf> that's better then
[12:40:23] <ChrisMorgan> obk: regarding your citation of Longfellow: indeed.
[12:40:24] <cmr> rust's goal is to have any combination of crates always linkable, and that adding a crate to your program doesn't change its behavior at all
[12:40:27] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[12:40:47] <ChrisMorgan> obk: you know "strings can go across
[12:40:47] <ChrisMorgan> multiple lines"?
[12:41:08] <nsf> cmr: that's a good goal
[12:41:22] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[12:41:49] <obk> ChrisMorgan: That's not a "here document" though. It breaks if the text contains `"` for one thing.
[12:42:04] * Ms2ger wonders if servo is supposed to build
[12:42:23] <ChrisMorgan> obk: sure, but it goes a fair way. In the mean time, you can just use \".
[12:42:40] <obk> The place I miss it is if I want to include some chunk of text emitted by a test, instead of having to escape it or to put it in a file of its own.
[12:42:50] <obk> Emitted by a tested function, I mean.
[12:43:27] <obk> I always have balanced whatever, but I still can't do it in a macro, I _think_.
[12:44:10] <Florob> So... splitting strings across lines (e.g. to obey the 100 char limitation) currently always requires runtime concatenation?
[12:44:14] <obk> Unless stringify! is so magic it can take "anything at all" (instead of identifiers, expressions, etc. like any other macro)
[12:44:43] <cmr> it turns any token tree into a string
[12:45:08] <cmr> rusti: stringify!("foo)
[12:45:09] -rusti- <anon>:7:19: 7:20 error: unknown start of token: 63
[12:45:09] -rusti- <anon>:7     println(fmt!("%?", r))
[12:45:09] -rusti-                             ^
[12:45:09] -rusti- application terminated with error code 101
[12:45:13] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[12:45:35] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Ping timeout)
[12:46:34] <cmr> Florob: no, they just use multiline strings.
[12:46:34] <obk> Huh, _almost_. Stringify eliminates any line breaks inside its parameters, so it is useless as a "here document" mechanism.
[12:46:43] <cmr> see libstd/rt/util.rs
[12:47:07] <cmr> :q
[12:47:10] <cmr> sorry
[12:47:28] <obk> cmr: Shy does stringify! eliminate newlines? I don't suppose there's another variant which keeps them?
[12:47:36] <obk> s/Shy/Why/
[12:47:49] <cmr> obk: I don't know, and I didn't know it did
[12:48:24] <obk> It does due to a simple test I just made
[12:50:18] <obk> s/due/according/, of course
[12:52:12] <Florob> cmr, I'm not sure I wanted to see that file oO
[12:52:44] <Florob> cmr, I mean, I approve of the quotes, but rterrln!("%s", "")â€½
[12:53:23] <ChrisMorgan> obk: stringify! works on the token tree, in which whitespace is not significant. This is true of *any* macro: they all work on the token tree, so you can't handle such a thing in Rust at present.
[12:54:55] <Florob> Seriously though. The code println("Hello " + "World") generates compared to println("Hello World") is not even funny anymore.
[12:57:03] <obk> ChrisMorgan: Fair enough. So no here documents for me :-(
[12:57:38] <ChrisMorgan> obk: not with the current AST. It could, however, be added to the AST. I don't know if such a thing has been discussed.
[12:58:26] <obk> Well, it is a bit of an edge case. A useful one though.
[12:58:34] <nsf> uhm, I wonder why this doesn't work: "let r = rand::rng() as &mut Rng; printfln!("%d", r.gen());"
[12:58:37] <ChrisMorgan> You'd need to come up with syntax and semantics people are happy with.
[12:58:39] <nsf> trying to use a trait as an interface
[12:59:06] <cmr> nsf: &rand::rng as &mut Rng, I believe.
[12:59:12] *** Quits: maik (maik___@moz-C3E4E31D.dip0.t-ipconnect.de) (Ping timeout)
[12:59:18] <nsf> hm..
[12:59:33] <nsf> nope, same error
[12:59:40] <obk> The traditional syntax is <<TERMINATOR and then anything up to a line containing just TERMINATOR is the content of the expression.
[12:59:47] <nsf> test.rs:6:17: 6:24 error: failed to find an implementation of trait std::rand::Rng for &mut std::rand::Rng<no-bounds>
[12:59:49] <nsf> that's the error btw
[12:59:56] <obk> But overriding << this way is probably a bad idea.
[13:00:23] <ChrisMorgan> Could potentially be <<<, which is unused.
[13:00:25] <nsf> &Rng is supposed to implement Rng isn't it :)
[13:00:27] <cmr> nsf: huh, I don't know about that
[13:00:33] <nsf> cmr: k
[13:00:35] <cmr> No, trait objects don't implement their respective trait
[13:00:42] <cmr> but you should be able to call the method
[13:00:45] <nsf> oh
[13:00:51] <nsf> but the method is from RngUtil
[13:00:55] <cmr> ah
[13:00:56] <nsf> which is implemented for all of the Rng
[13:01:02] <nsf> I guess that's why it doesn't work
[13:01:03] <cmr> oh right, the Rng method is next()
[13:01:10] <nsf> next() works
[13:01:11] <obk> Using <<< seems pushing it.
[13:01:40] <nsf> cmr: so, I guess on my side it's possible to impl Rng for &Rng?
[13:01:46] <obk> Perhaps just changing stringify! to return the text-exactly-as-it-is would be simplest.
[13:01:56] <obk> It is already magical...
[13:02:03] <nsf> sounds weird though
[13:02:07] <Seldaek> obk: php has <<<TERM, but I think python's """ is a bit more elegant and good enough really
[13:02:19] <obk> Oh yes! Forgot about that.
[13:02:25] <obk> """...many lines..."""
[13:02:40] <cmr> nsf: no, you can only implement a trait from another crate on types you define, also for coherency.
[13:02:45] <cmr> nsf: libstd should implement it fro &rng
[13:02:46] <obk> That seems like a better solution.
[13:02:48] <cmr> *for &Rng
[13:02:51] <nsf> I see
[13:02:54] <cmr> open an issue!
[13:02:58] <nsf> ok
[13:07:21] <nsf> done https://github.com/mozilla/rust/issues/8575
[13:07:31] <nsf> also, can you imagine:
[13:07:33] <nsf> https://github.com/mozilla/rust/issues/8574
[13:07:37] <nsf> very nice typo :)
[13:07:46] <nsf> the funniest part that it still looks like a perlin noise
[13:09:21] *** Joins: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro)
[13:10:16] <Seldaek> nsf: the workflow is just "send a pull request" :)
[13:10:28] <Seldaek> nsf: you can even edit the file on github itself
[13:11:05] <nsf> Seldaek: :) ok, just in my experience it's a bit annoying merging pull requests for one-liners, I'd rather add the change on my own
[13:11:10] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Client exited)
[13:11:39] <Seldaek> nsf: AFAIK nobody adds anything on their own though, it all goes through PRs and the buildbot bors
[13:11:50] <cmr> all changes go through our CI bot who merges PRs after testing them
[13:12:21] <nsf> but someone reviews/sends it to bot anyway
[13:12:30] <nsf> uh.. robots
[13:12:41] *** Quits: Houm (Houm@moz-25669AA8.fbx.proxad.net) (Ping timeout)
[13:12:50] *** Joins: mindcat_ (mindcat@5D9242F8.14B01478.F956842C.IP)
[13:12:51] <nsf> k, k, will do a pull request next time
[13:12:58] <nsf> if it's preferable
[13:13:13] <Seldaek> just do it now and get that warm and fuzzy feeling when it's merged :P
[13:13:56] <bjz> rusti: "    ".repeat(2)
[13:13:56] -rusti- ~"        "
[13:14:04] *** Quits: mindcat (mindcat@66ED7468.F11C85BB.431667FD.IP) (Ping timeout)
[13:14:17] <nsf> Seldaek: hm.. ok, will do
[13:14:21] *** Quits: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro) (Ping timeout)
[13:15:53] *** Joins: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro)
[13:16:37] <Seldaek> nsf: anyway, I agree with you about traits, I kinda like to view them as interfaces too, but it seems it isn't the mainstream view here :)
[13:16:39] *** Joins: bytewise (bytewise@moz-4A801D04.unitymediagroup.de)
[13:16:46] *** Quits: BitPuffin (quassel@moz-7BB00EC9.bredband.comhem.se) (Ping timeout)
[13:17:20] <cmr> they have their usecases, but it's almost always better to use generics when you can
[13:17:45] <nsf> Seldaek: I'm simply kind of afraid that templates overuse will start bloating code eventually, we've seen that in C++ at least some time ago
[13:17:52] *** Joins: Houm (Houm@moz-25669AA8.fbx.proxad.net)
[13:17:55] <nsf> maybe it's not a big deal in practice, I haven't seen it personally, I don't know
[13:18:59] <Seldaek> cmr: not sure how generics replace interfaces though, but maybe I'm missing your point. I surprisingly didn't sleep enough :p
[13:19:35] <cmr> fn foo<T: Rng>(r: T) is the same as fn foo(r: &Rng), minus indirection+vtable
[13:20:04] <Seldaek> ok, but is Rng the trait in the first fn?
[13:20:11] <cmr> yes
[13:20:29] <Ms2ger> Which is the fast one? The former?
[13:20:31] <Seldaek> and in the second it refers to the struct?
[13:20:38] <cmr> Seldaek: no, refers to trait object
[13:20:56] <cmr> Ms2ger: yes, though as nsf said, it *does* generate more code if it can't do lots of inlining and DCE
[13:21:01] *** Joins: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl)
[13:21:29] <Ms2ger> That's always the trade-off, isn't it? :)
[13:21:32] <cmr> yup
[13:21:40] <cmr> best part about rust IMO is you get both seamlessly
[13:21:49] <Seldaek> cmr: mkay, not sure how that relates to using them as interfaces though. Seems like both of these rely on whatever you give that function to implement the trait
[13:22:06] <cmr> Seldaek: trait objects are interfaces
[13:22:14] <cmr> at least from the java POV
[13:22:55] <Seldaek> well I don't know how it works in java exactly, but how is it not an interface with the generics?
[13:23:17] <cmr> with the generics it's all compile-time, interfaces in java are like trait objects, vtables.
[13:23:45] <Seldaek> ok so you're just talking about implementation details and potential runtime overhead
[13:23:53] <Seldaek> but both are conceptually "interfaces"
[13:24:00] <cmr> conceptually yes.
[13:24:40] <Seldaek> ok now I get the confusion
[13:26:58] <doomlord_> ( ^^^ I'd been tempted to  name traits IWhatever often  ... )
[13:27:59] <nsf> https://github.com/mozilla/rust/pull/8577
[13:28:01] <nsf> phew
[13:28:01] <Seldaek> hehe 
[13:28:27] <Seldaek> nsf: trouble? :)
[13:28:28] <nsf> one-byter
[13:28:30] <nsf> no no
[13:28:39] <nsf> this is my first pull request ever
[13:28:43] <nsf> surprise
[13:28:44] <nsf> :D
[13:28:45] <Seldaek> hehe 
[13:28:57] <Seldaek> well that's cool then
[13:28:59] <nsf> I'm not a big fan of fancy html interfaces
[13:29:12] * cmr uses ghi and hub
[13:29:35] <nsf> CLI interface for a fancy html interface? :)
[13:29:38] <Seldaek> nsf: yeah with hub you can go around most of it, but if you don't do PRs on a regular basis it's probably not worth the investment
[13:29:49] <cmr> well github has an API but yes
[13:30:06] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Connection reset by peer)
[13:30:13] <nsf> I prefer to leave issues :)
[13:30:52] *** Joins: Mowah (Mowah@moz-436C35C5.cust.bredbandsbolaget.se)
[13:32:32] <Seldaek> nsf: eh yekaterinburg, cool (sorry for stalking :p), was there last summer it's nice
[13:32:51] <nsf> :D
[13:35:08] *** Joins: happy4crazy (happy4craz@moz-5106FA06.dyn.optonline.net)
[13:40:12] <Yurume> SimonSapin, sorry for late response on issues to rust-encoding, I was on the vacation lately.
[13:40:32] <SimonSapin> Hi Yurume. No problem :)
[13:40:59] <SimonSapin> Iâ€™ll comment in the issues
[13:42:30] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[13:46:23] <Ms2ger> SimonSapin, hey, do you know if servo is supposed to actually build?
[13:46:53] <SimonSapin> Ms2ger: the master branch is supposed to, but there may be bugs
[13:46:56] <SimonSapin> what error do you get?
[13:47:13] <Ms2ger> rust-opengles/gl2.rs:391:11: 391:27 error: type `~str` does not implement any method in scope named `to_c_str`
[13:47:25] <cmr> Ms2ger: are you using a local rust?
[13:47:33] <Ms2ger> I... don't think so?
[13:47:45] <Ms2ger> I built successfully yesterday
[13:48:44] *** Joins: maik (maik___@moz-C3E4E31D.dip0.t-ipconnect.de)
[13:49:21] <SimonSapin> Ms2ger: does "git status" say something about submodules?
[13:50:39] <SimonSapin> Yurume: are you lifthrasiir?
[13:50:47] <Yurume> yes.
[13:51:37] <SimonSapin> btw thank you for publishing rust-encoding, itâ€™ll help a lot
[13:51:57] <Yurume> hope it helps. XD
[13:52:15] <Yurume> I needed it for my personal project anyway
[13:57:34] *** Quits: robn (robn@moz-76B0302C.static.internode.on.net) (Quit: Coyote finally caught me)
[13:57:39] *** Joins: robn (robn@moz-76B0302C.static.internode.on.net)
[13:59:43] *** Quits: maik (maik___@moz-C3E4E31D.dip0.t-ipconnect.de) (Ping timeout)
[14:01:39] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[14:01:41] *** Quits: z0w0 (zack@moz-7E6DC3A.lnse2.woo.bigpond.net.au) (Client exited)
[14:02:00] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[14:03:30] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Ping timeout)
[14:03:42] <SimonSapin> Yurume: How do you feel about moving it to rust master?
[14:04:12] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[14:04:44] <Yurume> I don't have any strong feeling (i.e. I don't care), but even the current, incomplete version weighs almost 4 MB so I was worried about it
[14:05:21] <SimonSapin> what do you mean?
[14:05:44] <SimonSapin> I meant about using rust 0.7 vs. 0.8-pre-something
[14:05:54] <Yurume> ah
[14:06:11] <Yurume> I thought you are talking about moving rust-encoding to libextra or something ;)
[14:06:46] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Connection reset by peer)
[14:06:49] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[14:07:39] <SimonSapin> into libextra, maybe eventually but I have no say in this :)
[14:07:44] <Yurume> haha
[14:07:56] <SimonSapin> and itâ€™s easier to keep it separate as long as itâ€™s being worked on
[14:08:01] <Yurume> which part of rust-encoding is broken with 0.8-pre?
[14:08:02] <cmr> 4MB O_o
[14:08:11] <SimonSapin> cmr: mostly indexes
[14:08:11] <cmr> Is that all the encoding tables?
[14:08:15] <SimonSapin> yes
[14:08:19] <cmr> yikes
[14:08:30] <Yurume> SimonSapin, ugh, that is not true though
[14:08:37] <Yurume> indices weigh half a megabyte
[14:08:43] <SimonSapin> Python loads them dynamically, fwiw
[14:08:46] <Yurume> which is big but not *that* big
[14:09:05] <SimonSapin> the -test binary is 2MB on my system
[14:09:07] <Yurume> I'm not sure why the compiled binary is so large
[14:09:15] <Yurume> uh-oh.
[14:09:29] <SimonSapin> on rust master
[14:09:38] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Connection reset by peer)
[14:09:40] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[14:09:57] <SimonSapin> so, do you need to stay on 0.7?
[14:10:02] <Yurume> for now, yes.
[14:10:46] <SimonSapin> I want to use encoding in cssparser, which is used in Servo, which requires 0.8-pre
[14:11:12] <Yurume> btw on rust 0.7 (x86_64-unknown-linux-gnu) it is 3 MB
[14:11:24] <Yurume> (and I misquoted 3 MB as 4 MB above... anyway)
[14:11:44] <SimonSapin> I can try and maintain two branches in parallel, but itâ€™s kind of pain to deal with merge conflicts
[14:11:47] <Yurume> SimonSapin, are you using x86_64 right?
[14:11:50] <SimonSapin> yes
[14:12:04] <cmr> you could just tag a 0.7-compat and let it rot :p
[14:12:41] <Yurume> yeah, I can live with a separate branch (I had to do it manually for rust-sdl in the past)
[14:12:42] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[14:12:50] <Yurume> while the master targets 0.8-pre
[14:13:08] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[14:13:13] <Yurume> well, then I'll compile my build of 0.8-pre in my machine to do that
[14:13:20] <Yurume> that would make things easy
[14:14:48] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[14:17:32] *** Quits: quasisphere (btw@DC685DC2.94302614.1D0D91FF.IP) (Quit: leaving)
[14:17:49] <Yurume> SimonSapin, what are major changes (wrt rust-encoding) from 0.7 to 0.8-pre?
[14:18:13] <Yurume> I assumed the current code would almost work as is in 0.8-pre...
[14:20:03] *** Quits: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro) (Ping timeout)
[14:20:03] <sebcrozet> Hi. If I have two traits `A` and `B` and both have a method `fn foo(&self)`. How do I select the method comming from `A` when I call `some_var.foo()` (`some_var` implements both `A` and `B`)?
[14:21:23] <cmr> sebcrozet: there's no good way to do it right now, unfortunately
[14:21:32] <Yurume> rusti: trait A { fn f(&self)->int; } trait B { fn f(&self)->int; } struct X; impl A for X { fn f(&self)->int{1} } impl B for X { fn f(&self)->int{2} } (&X as &A).f()
[14:21:33] -rusti- 1
[14:21:36] <Yurume> rusti: trait A { fn f(&self)->int; } trait B { fn f(&self)->int; } struct X; impl A for X { fn f(&self)->int{1} } impl B for X { fn f(&self)->int{2} } (&X as &B).f()
[14:21:37] -rusti- 2
[14:21:38] <SimonSapin> Yurume: my point is, are you ok with me making pull requests on top of the commit porting to 0.8?
[14:22:06] <Yurume> SimonSapin, if you don't merge it with other feature PRs then sure
[14:22:11] <cmr> once we have uniform function calls, it would be A::foo(some_var)
[14:22:33] <SimonSapin> Yurume: on top of, meaning depending on
[14:22:41] <Yurume> cmr, doesn't casting to the generic &-ptr work?
[14:23:08] <sebcrozet> cmr: oh. Is there an issue related touniform function calls?
[14:23:09] <cmr> Yurume: It creates an intermediate trait object, which introduces three indirections, but it does work.
[14:23:21] <Yurume> yeah, not optimal but a possible workaround.
[14:23:23] <cmr> sebcrozet: I'm pretty sure, but I can't find it
[14:23:47] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[14:24:30] <Yurume> SimonSapin, what PRs are you planning for?
[14:24:48] <Yurume> that is why I asked for changes from 0.7 to 0.8-pre
[14:24:50] <sebcrozet> cmr: Ok. Thanks.
[14:25:47] <Yurume> for default methods, I thought `-A default-methods` should be sufficient for both 0.7 and 0.8-pre, but I don't know about others
[14:26:00] <cmr> Yurume: -A default-methods now is a compiler error
[14:26:04] <cmr> since the lint was removed
[14:26:51] <Yurume> cmr, well then make it `configure`d, anyway it is possible to get the same syntax for both 0.7 and 0.8-pre (as I understood)
[14:27:01] *** Joins: vmx (vmx@moz-FCACABCD.pools.arcor-ip.net)
[14:27:45] <SimonSapin> Yurume: this is what I have so far: http://pastebin.mozilla.org/2874261
[14:28:36] <SimonSapin> I also want an API with both feed/flush and error traps
[14:28:53] *** Quits: Diamond (dick@moz-C01E1CD1.ks.ks.cox.net) (Client exited)
[14:29:07] <Yurume> any details on `rust-upgrade++`?
[14:29:27] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[14:30:19] <SimonSapin> https://github.com/SimonSapin/rust-encoding/commit/f2d6db16ace005e6960773af87678c050e171ed3
[14:30:34] <Ms2ger> SimonSapin, (back now) git status lists src/support/glut/ under untracked files
[14:30:50] <Yurume> aargh iterator reform, I missed that
[14:31:04] <SimonSapin> Ms2ger: you can remove it, but it shouldnâ€™t be an issue
[14:32:05] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[14:32:05] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02https://github.com/mozilla/rust/compare/8ac17731eba2...1942a7a3fb3e
[14:32:05] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[14:33:04] <SimonSapin> Ms2ger: do you have a â€¦/servo/build/src/compiler/rust/x86_64-unknown-linux-gnu/stage2/bin/rustc file or similar?
[14:33:40] <Ms2ger> Yes
[14:33:53] <SimonSapin> what does it say when run with --version?
[14:34:02] <SimonSapin> and what servo commit are you on?
[14:34:13] <Ms2ger> src/compiler/rust/x86_64-unknown-linux-gnu/stage2/bin/rustc 0.8-pre (5aa0ca9 2013-07-09 10:22:37 -0700)
[14:34:13] <Ms2ger> host: x86_64-unknown-linux-gnu
[14:34:31] <vmx> bjz: thanks for implementing frexp in the float modules. just what i need and non-existent when i played with rust the last time (only the c_math version was there :)
[14:34:43] <Ms2ger> And c1d6137418f222a30b2a4e28974a56831cb831b6, I think
[14:35:09] <bjz> vmx: no worries, glad I could help!
[14:35:19] <bjz> vmx: and it's all in rust!
[14:36:08] <bjz> vmx: when did you last try rust?
[14:36:51] <vmx> bjz: when i look at the files, last changed may 12
[14:37:13] <vmx> i'll try again to implement a float to rational function
[14:37:44] <bjz> vmx: have you seen the rational type in extra?
[14:37:49] <vmx> yes i have
[14:37:54] <SimonSapin> Ms2ger: this is definitely a too old rust version for this version of servo
[14:38:06] <vmx> bjz: and i want to add a "fromFloat" function to it
[14:38:13] <Ms2ger> Hrm, yes, it does seem to be
[14:38:55] <vmx> bjz: i need frexp for it and last time i tried to make that work nicely with rust (wrapping the c_math part). but as that is now down, i can concentrate on the conversion function
[14:38:59] <SimonSapin> try touch src/compiler/rust-auto-clean-trigger
[14:39:25] <SimonSapin> or just nuking the build directory and starting over
[14:39:36] <Ms2ger> And then just make?
[14:39:48] <SimonSapin> yes
[14:39:50] * Ms2ger would rather try not going nuclear first :)
[14:41:16] <Ms2ger> Ah well, I'll try to get some other work done while it compiles: )
[14:41:51] *** Joins: Ms2ger` (Ms2ger@moz-79E00D8E.ugent.be)
[14:42:02] *** Joins: lenstr_ (lenstr@AF8EB999.6049B16A.85938D85.IP)
[14:42:04] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[14:42:04] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/UWmTkA
[14:42:04] <ghrust> 13rust/06auto 14a37f284 15Palmer Cox: Crypto: Add little-endian versions of existing functions: read_u32v_le and write_u32_le.
[14:42:04] <ghrust> 13rust/06auto 14c707065 15Palmer Cox: MD5: Create an implementation of MD5.
[14:42:05] <ghrust> 13rust/06auto 146386f88 15Palmer Cox: Crypto: update checked addition functions to use CheckedAdd intrinsic....
[14:42:07] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[14:42:17] <Yurume> SimonSapin, s/pub fn/fn/ in impl seems to work also in 0.7 if I understand correctly. other changes can be translated mechanically I think
[14:42:33] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[14:42:56] *** Quits: Ms2ger (Ms2ger@59A8FC80.80FA5708.187A1082.IP) (Ping timeout)
[14:43:06] <Ms2ger`> SimonSapin, thanks anyway :)
[14:43:30] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[14:43:57] <Yurume> SimonSapin, okay, feel free to put PRs, as soon as I build my copy of 0.8-pre I'll test it and if everything went good I'll merge them
[14:44:42] <SimonSapin> Yurume: so, do you still want to maintain a 0.7 branch?
[14:45:02] <Yurume> I *have to*, but I won't make it master
[14:45:12] <Yurume> as most changes are mechanical enough
[14:45:22] *** Joins: ofeldt (ofeldt@moz-6027DE8F.dip0.t-ipconnect.de)
[14:45:33] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[14:45:38] <Yurume> I was concerned with the possibility of major breakage like one from 0.6 to 0.7
[14:45:41] <Yurume> it seems not
[14:46:06] <SimonSapin> actually, if removing pub works on 0.7, thatâ€™s most of the conflict source
[14:46:11] *** Quits: ofeldt- (ofeldt@moz-7358A996.dip0.t-ipconnect.de) (Ping timeout)
[14:46:41] <Yurume> yeah, if you can split the commit into removing pub and everything else that would be appreciated ;)
[14:49:15] <SimonSapin> Yurume: eh, I did the upgrade after feed_into. Can we get that sorted out first?
[14:52:11] <Yurume> SimonSapin, can you get `flush_into` first? then it would be fine
[14:52:50] <Yurume> (I'm still building 0.8-pre. :SSS)
[14:53:28] <Yurume> given you have a bunch of commits based on `feed_into` I guess we for now live with that
[14:53:45] <Yurume> and renaming should be done later
[14:54:27] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[14:58:02] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[15:06:09] *** Quits: Ms2ger` (Ms2ger@moz-79E00D8E.ugent.be) (Connection reset by peer)
[15:06:32] *** Quits: happy4crazy (happy4craz@moz-5106FA06.dyn.optonline.net) (Client exited)
[15:08:49] *** Quits: obk (Mibbit@moz-B0F26027.red.bezeqint.net) (Quit: http://www.mibbit.com ajax IRC Client)
[15:10:42] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[15:15:01] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[15:15:06] *** Joins: sorali (sorali@moz-AE11F11D.osk2.eonet.ne.jp)
[15:16:52] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[15:19:11] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[15:21:39] <SimonSapin> Yurume: I can rebase stuff
[15:21:46] <SimonSapin> what naming do you prefer?
[15:23:27] *** Joins: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com)
[15:24:43] <SimonSapin> Yurume: Iâ€™m rebasing anyway for 0.7
[15:25:18] *** Joins: Ms2ger` (Ms2ger@moz-C62A2438.ugent.be)
[15:25:42] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[15:26:31] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[15:28:29] <SimonSapin> Yurume: how about feed/flush that take &mut output, and test_feed/test_flush with #[cfg(test)] that return it?
[15:28:49] <Yurume> SimonSapin, I think that would work
[15:34:08] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[15:35:21] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[15:35:54] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[15:42:02] *** Joins: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP)
[15:42:14] *** Quits: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru) (Ping timeout)
[15:42:59] *** Quits: lenstr_ (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[15:45:02] *** Joins: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru)
[15:45:10] <SimonSapin> Yurume: what do you want to do about reserve_at_least?
[15:45:31] <Yurume> SimonSapin, moving that into `Encoding.{encode,decode}`?
[15:46:12] <SimonSapin> I think it can still be useful when feed()ing chunks of input
[15:46:17] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[15:46:25] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[15:46:30] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[15:47:10] <Yurume> hmm...
[15:47:26] <Ms2ger`> error: internal compiler error: unexpected failure
[15:47:27] <Ms2ger`> \o/
[15:47:37] <Yurume> well, agreed. we don't have a high level partial en/decoding interface yet.
[15:48:00] <Yurume> SimonSapin, for now I think you can keep that as is
[15:48:15] <SimonSapin> Ms2ger`: in Servo?
[15:48:33] <Ms2ger`> Apparently in Azure
[15:51:25] <Ms2ger`> task <unnamed> failed at 'parse_region: bad input', servo/src/compiler/rust/src/librustc/metadata/tydecode.rs:264
[15:52:18] <SimonSapin> Ms2ger`: I canâ€™t help with that
[15:52:25] <Yurume> SimonSapin, thank you!
[15:52:42] * Ms2ger` looks around for core people, then
[15:52:55] <SimonSapin> oh well, Iâ€™m getting conflicts anyway
[15:53:06] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[15:53:39] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[15:56:22] *** Joins: jensnock_ (jensnocker@moz-8BE55278.customer.t3.se)
[15:56:49] <cmr> Ms2ger`: also #servo
[15:56:56] <cmr> it sounds like your submodules are messed up though
[15:56:59] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Ping timeout)
[15:57:01] <cmr> or inconsistent build state
[15:57:40] <Ms2ger`> All plausible
[15:58:05] *** Quits: feduser (feduser@6ADA9854.5167330B.CDBED010.IP) (Quit: Leaving)
[15:59:06] *** Joins: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro)
[15:59:40] *** Quits: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[16:01:19] <vmx> am i doing something wrong? frexp() leads to internal compiler error (making the vars mutable or not doesn't change anything): https://www.friendpaste.com/7OfijPngh3yQb2gZ20GXY7
[16:01:34] *** Joins: vodik (simon@moz-396533B6.dsl.bell.ca)
[16:03:14] *** Joins: brian (chatzilla@moz-A87574A6.hsd1.pa.comcast.net)
[16:03:40] <vmx> (for those who are scared of long pastes. this is easily runnable 7 lines of code)
[16:04:07] <cmr> vmx: it shouldn't be an ice, but line 6 is invalid
[16:04:15] <cmr> it needs to be `let (...) = ...`
[16:04:47] <cmr> rusti: let a, b; (a, b) = (1, 2); (a, b)
[16:04:49] -rusti- pastebinned 6 lines of output: http://ix.io/7m0
[16:05:00] <cmr> rusti: let a; let b; (a, b) = (1, 2); (a, b)
[16:05:02] -rusti- pastebinned 8 lines of output: http://ix.io/7m1
[16:05:19] <cmr> rusti: let a = 0; let b = 0; (a, b) = (1, 2); (a, b)
[16:05:19] <vmx> cmr: thanks. that's it. though i guess i should get an internal compiler error else wise
[16:05:21] -rusti- line longer than 150 columns, pastebinned 4 lines of output: http://ix.io/7m2
[16:07:09] <vmx> i was already close to pretending it is not mentioned in the tutorial. as i switch back to the browser, i've exactly that section displayed. i'll try harder next time :)
[16:08:21] *** Quits: vodik (simon@moz-396533B6.dsl.bell.ca) (Quit: updates)
[16:09:30] *** Joins: vodik (simon@moz-396533B6.dsl.bell.ca)
[16:13:03] <SimonSapin> rustc master is slower to build rust-encoding than 0.7
[16:13:13] <SimonSapin> ~60s instead of 25s
[16:13:22] <cmr> yikes
[16:17:55] *** Quits: sorali (sorali@moz-AE11F11D.osk2.eonet.ne.jp) (Client exited)
[16:19:05] *** Quits: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro) (Ping timeout)
[16:24:46] <Yurume> SimonSapin, is there any additional encoding that has to be implemented asap?
[16:25:02] <Yurume> I have a few CJK encodings and UTF-16 to implement
[16:25:13] <SimonSapin> Yurume: itâ€™s not really urgent
[16:25:24] <Yurume> yup
[16:26:09] *** Joins: vk (chatzilla@moz-389FEE13.hsd1.ca.comcast.net)
[16:26:47] <SimonSapin> Iâ€™d like two things: 1. A decoder that takes takes "fallback encoding" and looks if there is a BOM (as in the WHATWG spec)
[16:27:01] <SimonSapin> I started make this, but corner cases are annoying
[16:27:12] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[16:27:22] <SimonSapin> (eg. if you pass less than 3 bytes in the first feed() call)
[16:27:40] <vmx> the compiler tells me that "let mut (a, b) =" is wrong. but "let mut a; let mut b; let (a, b) =", nor "let mut a; let mut b; (a ,b)" works. what to use instead (plus points for letting me know how i could have find out the answer myself)
[16:27:55] <SimonSapin> this kinda depends on UTF-16, but the two relevant lines could just be commented in the meantime
[16:28:38] <cmr> vmx: `let (a, b) = ...; let mut a = a; let mut b = b;`
[16:28:47] <cmr> vmx: it's a kludge atm, transitioning between two syntaxes.
[16:28:54] <cmr> eventually it will be `let (mut a, mut b) = ...`
[16:29:04] <SimonSapin> 2. a feed()/flush() API with error traps
[16:29:07] <cmr> and not really documented anywhere either :(
[16:29:20] <vmx> cmr: thanks. so i don't need to feel bad
[16:29:59] <cmr> vmx: nope!
[16:30:17] <SimonSapin> vmx: you know how when you think itâ€™s the compilerâ€™s fault, itâ€™s generally not? Well Rust is not quite there yet unfortunately
[16:31:23] <Yurume> SimonSapin, so if there is a BOM decode with that encoding and otherwise decode with a prescribed fallback encoding?
[16:31:32] <SimonSapin> Yurume: what do you think for renaming whatwg::get_encoding to something like whatwg::encoding_from_label? (And document that it corresponds to the specâ€™s "get an encoding")
[16:31:40] <SimonSapin> Yurume: yes
[16:32:01] <Yurume> I guess that would be a sort of Encoding wrapper
[16:32:19] <SimonSapin> Yurume: http://encoding.spec.whatwg.org/#decode
[16:32:22] <erickt1> ack! does anyone know how to get a stack trace for a rustc ICE? Breaking on upcall_fail isn't working for me anymore
[16:32:44] <erickt1> I'm guessing brson removed it with his new RT
[16:33:03] <vmx> SimonSapin: though that's the fun part of it. isn't it?
[16:33:04] <cmr> erickt1: break on rust_begin_unwind
[16:33:11] <erickt1> cmr: thanks!
[16:33:15] <SimonSapin> Yurume: itâ€™s only for decoding. I was thinking of something that implements Decoder, and takes either a Decoder or an Encoding as a parameter for the fallback
[16:33:17] <Yurume> SimonSapin, aha, I confused "decode" algorithm and "decode()" in TextDecoder
[16:33:39] <SimonSapin> vmx: sure :)
[16:34:03] <Yurume> we then would need `Decoder` wrapper and not `Encoding` wrapper
[16:34:21] <Yurume> (and something like `Encoding.decoder_with_bom` and `Encoding.decode_with_bom`?)
[16:37:05] *** Joins: boredomist (user@moz-63CF9F31.res-cmts.sesp.ptd.net)
[16:38:08] <Yurume> well, we have three use cases: the caller knows the exact encoding, the caller knows a list of the possible encodings but don't know which to apply, the caller don't know the encoding and want to guess the encoding to apply. the last one is actually out of the scope, so we down to first two.
[16:39:24] <Yurume> if the caller knows the exact encoding, but only after the compilation, then the caller would use an enumeration API. if the caller knows the exact encoding at the compile time then it would use the static `all::UTF_8` etc.
[16:39:39] *** Quits: jensnock_ (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[16:41:05] <Yurume> if the caller knows a list of the possible encodings but nothing else, and if the possible encodings include the BOM-branded Unicode encodings, then the caller would use a special BOM-aware decoder and *if it fails* it would continue with remaining choices in some way
[16:42:41] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Connection reset by peer)
[16:42:42] <Yurume> so there are two more subcases with BOM-aware decoder: we just want to know if the buffer contains a recognizable BOM or not (for the former, with also a corresponding `Decoder`); we want to decode with a fallback decoding or Unicode encoding specified by BOM
[16:44:14] <nsf> uhm, is there any good rustpkg-based package which has all the latest neat conventions and stuff
[16:44:22] <Yurume> hmm, a bit delicate.
[16:44:27] <nsf> docs are getting out-dated and I want to learn the latest stuff
[16:44:33] <cmr> nsf: rustdoc_ng
[16:44:38] <nsf> cmr: k, thanks
[16:44:41] <Yurume> ah, is rustdoc_ng going well?
[16:44:51] <cmr> Yurume: http://seld.be/rustdoc/master/index.html
[16:44:58] <cmr> I'll let it speak for itself ;)
[16:45:17] <Yurume> oww it is colorful! :D
[16:45:32] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[16:45:44] <nsf> cmr: and one quick question, it seems that .rc files are gone, I should use lib.rs as a crate file for lib, right?
[16:45:48] *** Joins: maik (maik___@moz-C3E4E31D.dip0.t-ipconnect.de)
[16:45:57] <cmr> nsf: yes.
[16:46:03] <Yurume> cmr, is it able to cross-reference between different crates?
[16:46:07] <cmr> Yurume: yup!
[16:46:13] <nsf> cmr: thanks
[16:46:14] <Yurume> sweet, but how so?
[16:46:38] <cmr> the external crate name and path is in the JSON
[16:46:47] <cmr> the frontend just needs to link to that path in the other crate
[16:46:48] <Yurume> hmm
[16:47:05] <nsf> cmr: also isn't that https://github.com/cmr/rustdoc_ng/blob/master/main.rs#L6 out-dated?
[16:47:06] <Yurume> maybe rustpkg should also have that path
[16:47:18] <nsf> I mean crate type is defined by the name of the file isn't it
[16:47:31] <cmr> yes, it is.
[16:47:36] <nsf> k
[16:47:43] <cmr> as is uuid and name, after a PR which hasn't been made lands
[16:47:55] <nsf> good to know
[16:53:02] *** Joins: wilmoore (wilmoore@moz-71431C3A.hsd1.co.comcast.net)
[16:55:59] *** Quits: maik (maik___@moz-C3E4E31D.dip0.t-ipconnect.de) (Ping timeout)
[16:56:20] *** Quits: sp3d (a@moz-41A29595.dhcp.stls.mo.charter.com) (Client exited)
[16:57:41] <SimonSapin> Yurume: thatâ€™s not how it works
[16:58:37] *** Quits: vodik (simon@moz-396533B6.dsl.bell.ca) (Ping timeout)
[16:58:59] *** kimundi is now known as zz_kimundi
[17:00:06] <SimonSapin> In some cases you want one precise encoding no matter what. Use eg. all::UTF_8
[17:00:25] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[17:01:03] <SimonSapin> for HTML and CSS you have an ordered list of encoding labels, eg from <meta charset>, HTTP Content-Type, etc.
[17:01:29] <SimonSapin> The first in that list that is provided and maps to a supported encoding is the fallback encoding
[17:01:42] <Yurume> yes, but isn't that list constrained?
[17:01:55] <SimonSapin> then look for a BOM. If there is one, use that even if the fallback doesnâ€™t normally have a BOM
[17:02:05] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[17:02:05] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/UWmTkA
[17:02:05] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[17:02:08] <SimonSapin> constrained how?
[17:02:24] *** Quits: StarLight (StarLight@moz-4314FDD5.dynamic.avangarddsl.ru) (Ping timeout)
[17:02:38] <SimonSapin> unless the encoding is completely fixed, the BOM is always the most authoritative
[17:02:52] <Yurume> SimonSapin, hm, I think we have a different notion of "the ordered list of encoding labels"
[17:03:02] <SimonSapin> labels are strings
[17:03:14] <Yurume> alright
[17:03:19] <SimonSapin> I can write <meta charset=not-a-real-encoding>
[17:03:37] <SimonSapin> or @charset in CSS
[17:03:45] <vmx> have i found a bug, or is it intended to break? https://www.friendpaste.com/7OfijPngh3yQb2gZ20OxbN
[17:04:06] <Ms2ger`> Ah, +=
[17:04:13] <SimonSapin> vmx: what output do you get?
[17:04:25] <Ms2ger`> That's not exactly well-supported right now, aiui
[17:05:21] <vmx> SiegeLord: i've updated the pastebin
[17:05:39] <Yurume> SimonSapin, for example, if you have Shift_JIS in HTTP Content-Type and EUC-KR in @charset you have a list of two encoding labels ["Shift_JIS", "EUC-KR"], but that *does not* mean the decoder should concern with both encodings. The decoder would use the first valid fallback encoding in the list *or* Unicode encoding specified by the BOM, and nothing else.
[17:05:52] <vmx> SiegeLord: sorry i meant SimonSapin (damn autocomplete)
[17:06:12] <Yurume> from the perspective of encoding processing library the list of encodings decoder should take care of is indeed constrained.
[17:06:25] <cmr> Ms2ger`: += works fine, just with the primitive types.
[17:06:35] <SimonSapin> Yurume: rust-encoding never knows about such a list
[17:06:55] <Yurume> of course
[17:07:24] <SimonSapin> per http://dev.w3.org/csswg/css-syntax/#the-input-byte-stream, rust-cssparser will call whatwg::get_encoding multiple times and see what returns None
[17:07:40] <SimonSapin> itâ€™s not even quite an uniform list
[17:09:22] <Yurume> yes, the first time it returns Some the parser would take that `Encoding` to the BOM prober (I'm not sure if it bears a `Decoder` interface) and the prober will return a decoder for the fallback encoding or UTF-16 or UTF-8 after some bytes.
[17:09:47] <Yurume> or similar.
[17:11:07] *** Joins: maik (maik___@moz-C3E4E31D.dip0.t-ipconnect.de)
[17:11:17] <Yurume> anyway, I'm only concerned with the design of the decoder or prober where the BOM takes precedence, am I missing something else?
[17:12:07] <SimonSapin> yeah, itâ€™s something like that
[17:12:07] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[17:12:08] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/zQdEaw
[17:12:08] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[17:13:42] <SimonSapin> This is the interface I started http://pastebin.mozilla.org/2874763
[17:14:17] <Yurume> 11s/UTF8Decoder/BOMDecoder/?
[17:15:29] * Yurume should rather avoid vimspeak
[17:16:16] *** Quits: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP) (Client exited)
[17:16:31] <SimonSapin> yeah of course
[17:18:16] <Yurume> SimonSapin, with my "prober" design, I was thinking of: impl ProbingDecoder { pub fn new(prober: Prober, fallback_encoding: ~Encoding) { ... } }
[17:18:26] <Yurume> maybe I went too far
[17:18:56] <SimonSapin> whatâ€™s a Prober?
[17:20:32] <Yurume> SimonSapin, takes an input, modifies its state and may return an `Encoding`.
[17:21:07] <SimonSapin> whatâ€™s an input with state?
[17:21:36] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[17:21:37] <Yurume> uh, no, what the prober takes is what the probing decoder takes (i.e. byte stream)
[17:22:00] <SimonSapin> I like feed() where you "push" data into the decoder rather than an iterator that the decoder "pulls" from
[17:22:11] <SimonSapin> because only one is easy to implement from the other
[17:22:54] <Ms2ger`> An iterator also seems annoying if you're waiting for data to come in from the network
[17:23:52] *** Joins: vosen (vosen@moz-266BA656.icpnet.pl)
[17:24:40] <SimonSapin> Ms2ger`: you can make an iterator that blocks on recv(), but not if you want something async where youâ€™re called when thereâ€™s data available
[17:24:45] <Yurume> SimonSapin, hmm, no, nevermind. that prober idea would need an arbitrary buffer even when the design is set.
[17:25:07] *** Joins: carleastlund (cce@moz-C8071335.c3-0.smr-ubr1.sbo-smr.ma.cable.rcn.com)
[17:25:20] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[17:26:38] <maik> do you think this is too complicated as a first look example? https://github.com/MaikKlein/Wyre#example-code
[17:26:42] *** Joins: StarLight (StarLight@moz-95901BC7.dynamic.avangarddsl.ru)
[17:27:52] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[17:29:31] *** Quits: Benvie_ (brandon@5FD20F9A.53D07D95.EFF8B7BF.IP) (Quit: )
[17:32:00] <SimonSapin> he, I have changes that build fine on 0.8 where 0.7 tells be that &'static does not live long enough
[17:32:22] <SimonSapin> s/tells be/tells me/
[17:32:55] <Yurume> &'eternal? XD
[17:33:19] <SimonSapin> I guess thatâ€™s &Tait objects being broken
[17:33:34] <Yurume> that was quite hard to get right in 0.7
[17:34:08] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[17:34:47] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Client exited)
[17:35:00] *** Quits: robarnold (rob@BD56354E.DB510C09.6E370BFC.IP) (Ping timeout)
[17:35:48] <SimonSapin> this patch changes ~Encoding for &'static Encoding
[17:36:15] <SimonSapin> since there is only a fixed set of encodings
[17:36:49] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[17:36:56] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Ping timeout)
[17:37:11] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[17:38:52] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[17:39:32] *** Quits: vmx (vmx@moz-FCACABCD.pools.arcor-ip.net) (Quit: Leaving)
[17:41:25] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[17:42:07] *** Joins: jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net)
[17:42:28] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Client exited)
[17:42:47] <SimonSapin> Yurume: and itâ€™s only in the TextEncoder/TextDecoder that I want to remove anyway :]
[17:42:52] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[17:43:03] <SimonSapin> (only there that I get errors)
[17:45:19] *** Joins: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro)
[17:46:47] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[17:48:52] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[17:48:53] *** Quits: Ms2ger` (Ms2ger@moz-C62A2438.ugent.be) (Connection reset by peer)
[17:49:10] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[17:49:28] *** Quits: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro) (Ping timeout)
[17:50:45] *** Quits: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru) (Quit: dim-an)
[17:53:49] *** Joins: Ms2ger` (Ms2ger@59A8FC80.80FA5708.187A1082.IP)
[17:54:26] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[17:56:11] *** Ms2ger` is now known as Ms2ger
[17:56:51] <nsf> it seems that in order to export a bunch of symbols from modules I need to write "pub mod x;" in the crate
[17:57:15] <nsf> I guess it's not documented yet properly, are there any generic rules for items visibility?
[17:57:30] <nsf> like they're priv by default or something
[17:59:44] <cmr> everything is priv by default except struct fields
[18:01:05] <nsf> k, I definitely need to find a package that stays up-to-date, because it's nice to use git blame and if author was kind enough, every rust change will be commented right there
[18:01:35] <nsf> oh, perhaps I can use rust itself
[18:01:58] <cmr> http://cmr.github.io/blog/categories/this-week-in-rust/ ?
[18:02:15] *** Joins: lenstr (lenstr@AF8EB999.6049B16A.85938D85.IP)
[18:02:26] <nsf> cmr: git blame is easier to use for searching for things
[18:02:38] <cmr> nsf: only true with good commit messages
[18:02:59] *** Joins: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net)
[18:03:22] <nsf> that's true
[18:04:10] *** Joins: Azdle (patrick@moz-8C723B60.hsd1.mn.comcast.net)
[18:05:21] <nsf> cmr: I'm reading "this week in rust" in reddit btw
[18:05:25] <nsf> but searching it
[18:05:31] <nsf> I'll try git blame first :)
[18:05:48] *** Joins: mib_rta6vx (Mibbit@moz-D3D15A0C.vie.surfer.at)
[18:07:41] *** Joins: obk (Mibbit@moz-B0F26027.red.bezeqint.net)
[18:08:54] *** Joins: robarnold (rob@BD56354E.DB510C09.6E370BFC.IP)
[18:11:51] <mib_rta6vx> Hi! I want to use a Cell to move a value inside the BenchHarness closure. However, I always get an error, that it "attempts to take an empty cell". Is this a bug or am I doing something wrong here? http://pastebin.com/2fQ0sfbF
[18:12:19] <cmr> mib_rta6vx: the bench function can be called multiple times
[18:12:24] <cmr> after the second time, the cell is empty.
[18:12:28] <cmr> *first time
[18:13:15] <mib_rta6vx> Ah, okay. Any pointers on how to solve that? Benchmarking std::vec::append_one, that is.
[18:19:23] *** Joins: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP)
[18:20:47] *** Quits: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP) (Quit: Leaving.)
[18:21:53] *** Joins: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP)
[18:22:42] *** Joins: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP)
[18:24:21] <mib_rta6vx> I guess one way would be to use put_back(val.clone()). I don't want the clone benchmarked though. Hmm.
[18:24:23] *** zz_kimundi is now known as kimundi
[18:30:33] *** Joins: jkes (Mibbit@moz-4A5981D8.pool.mediaways.net)
[18:31:10] <mib_rta6vx> I still have a rather difficult time determining, when copys occur in Rust code. Could anyone tell me, if std::vec::append_one() involves copying?
[18:31:30] *** Parts: jkes (Mibbit@moz-4A5981D8.pool.mediaways.net) ()
[18:34:55] <kimundi> mib_rta6vx: define copy
[18:35:42] <kimundi> if something gets passed by value, thats allways a shallow copy
[18:35:48] <mib_rta6vx> Well, I'm trying to find out the cost difference between using a mutable vector with .push() vs using an immutable one with append_one
[18:36:14] <mib_rta6vx> Looking at the implementation of append_one, I think it takes and returns an owned pointer.
[18:36:25] <mib_rta6vx> Which should be a move, no?
[18:36:41] <SimonSapin> Yurume: Iâ€™m done for today, but would you rather have me make future changes on 0.7-compat or master?
[18:36:55] <Yurume> yeah, I'll do so
[18:37:01] <doomlord> wouldnt it have to copy to move the new item in
[18:37:07] <cmr> mib_rta6vx: yes, and moves are a memcpy
[18:37:13] <cmr> (of the pointer, in this case)
[18:37:21] <Yurume> I also have a working 0.8-pre environment now (I've tested static-0.8 branch with that), so I think I can keep up with that
[18:37:36] <mib_rta6vx> cmr: So it only copies the pointer, not the whole array?
[18:37:54] <cmr> mib_rta6vx: actually, I'm not sure for vectors
[18:37:55] <SimonSapin> Yurume: so master?
[18:37:58] <cmr> ~[] is a bit weird
[18:38:01] <cmr> I'd check the generated code.
[18:38:18] <Yurume> SimonSapin, yes, I'll maintain both branches
[18:38:28] <mib_rta6vx> cmr: How would I go about doing that? (Sorry for the maybe stupid question)
[18:38:31] <doomlord> immutable append one ... isn't taht going to be making a new vector with all the old elements plus another 
[18:38:40] <cmr> doomlord: yeah
[18:38:44] <doomlord> the original would have to be maintained and untouched
[18:38:44] <cmr> mib_rta6vx: rustc --emit-llvm -S
[18:38:51] <cmr> for llvm IR, just rustc -S for asm
[18:39:14] <SimonSapin> Yurume: cool. Thanks again!
[18:39:20] <mib_rta6vx> cmr: Right. Thanks alot for the explanation! 
[18:41:53] <kimundi> mib_rta6vx: append_one is implemented with.push, there really is no difference
[18:42:54] <kimundi> push() works with &mut self, which in the case of a owned vector is &mut ~[T]
[18:43:22] <mib_rta6vx> kimundi: Right, I was unsure about the overhead of getting the vector in and out of append_one
[18:43:59] <kimundi> I'm not really an expert, but afaik any difference there dissapears when llvm optimzed the code
[18:45:29] <mib_rta6vx> kimundi: Alright, thanks. 
[18:45:49] <kimundi> inlining for example would change 'x = append_one(y, z)' to 'x = { let mut v = y; v.push(x); z}'
[18:46:35] <kimundi> which is prtty much the same as 'y.push(z); x = y'
[18:48:08] <mib_rta6vx> Okay, I think I understand. Still trying to get a better eye for those hidden costs.
[18:49:44] *** Quits: maik (maik___@moz-C3E4E31D.dip0.t-ipconnect.de) (Ping timeout)
[18:49:58] <kimundi> mib_rta6vx: Sure
[18:50:49] <kimundi> In general rust tries to make such costs explicit, we generally try to not hide those things :)
[18:52:04] <mib_rta6vx> kimundi: Hehe, they're probably just hidden to my newbie eyes...
[18:52:57] <kimundi> It's allways confusing if you try to understand everything at once, thats normal xD
[18:54:01] <mib_rta6vx> kimundi: While I have a brain to pick available: Would you say that it's idiomatic Rust to mutate internally and provide a safe interface?
[18:54:22] <cmr> Mutate what internally?
[18:54:43] <mib_rta6vx> cmr: Some kind of state. As opposed to threading it in and out of every function.
[18:54:55] <kimundi> providing an safe interface is allways idiomatic, but I'm not sure what you mean with mutatting internally. mutation control is also part of safe rust
[18:55:04] <cmr> mib_rta6vx: you use methods on a struct in that case.
[18:56:06] <kimundi> state is handled by having a struct or enum for holding it, as cmr said
[18:56:53] <mib_rta6vx> And the methods mutate the state. They don't return a new struct, right?
[18:56:54] <kimundi> In general you shouldn't be usinf unsafe {} unless really, really necessarry
[18:57:01] <cmr> Correct.
[18:57:14] <kimundi> mib_rta6vx: that depends hhow you write the methods :)
[18:57:39] <cmr> rusti: struct Foo { x: uint } impl Foo { fn foo(&mut self) { self.x = 42 } } let mut x = Foo { x: 32 }; x.foo(); x.x
[18:57:40] -rusti- 42
[18:57:43] <cmr> rusti: struct Foo { x: uint } impl Foo { fn foo(&mut self) { self.x = 42 } } let x = Foo { x: 32 }; x.foo(); x.x
[18:57:44] -rusti- <anon>:5:102: 5:103 error: cannot borrow immutable local variable as mutable
[18:57:44] -rusti- <anon>:5          struct Foo { x: uint } impl Foo { fn foo(&mut self) { self.x = 42 } } let x = Foo { x: 32 }; x.foo(); x.x
[18:57:44] -rusti-                                                                                                                ^
[18:57:45] -rusti- error: aborting due to previous error
[18:57:46] -rusti- application terminated with error code 101
[18:57:46] <mib_rta6vx> Heh, sure, but I haven't really seen the "return a new struct" in the Rust code I read so far. 
[18:58:39] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[18:59:07] <kimundi> struct Foo { priv data: uint } impl Foo { fn mutate(&mut self) { self.data += 105; }  } ; let x = Foo { data: 45u }; x.mutate(); x
[18:59:14] <kimundi> rusti: struct Foo { priv data: uint } impl Foo { fn mutate(&mut self) { self.data += 105; }  } ; let x = Foo { data: 45u }; x.mutate(); x
[18:59:15] -rusti- <anon>:5:126: 5:127 error: cannot borrow immutable local variable as mutable
[18:59:15] -rusti- <anon>:5          struct Foo { priv data: uint } impl Foo { fn mutate(&mut self) { self.data += 105; }  } ; let x = Foo { data: 45u }; x.mutate(); x
[18:59:15] -rusti-                                                                                                                                        ^
[18:59:15] -rusti- error: aborting due to previous error
[18:59:17] -rusti- application terminated with error code 101
[18:59:22] <kimundi> rusti: struct Foo { priv data: uint } impl Foo { fn mutate(&mut self) { self.data += 105; }  } ; let mut x = Foo { data: 45u }; x.mutate(); x
[18:59:23] -rusti- {data: 150}
[19:00:06] *** Quits: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net) (Quit: eatkinson)
[19:00:16] <mib_rta6vx> kimundi, cmr: Anyway, thanks for taking the time to answering! Appreciate it!
[19:00:59] <kimundi> usually you write you'r types and methods in a way that mutates the type, and implement Clone if you want to fork of a new copy
[19:01:51] *** Quits: obk (Mibbit@moz-B0F26027.red.bezeqint.net) (Quit: http://www.mibbit.com ajax IRC Client)
[19:03:55] <kimundi> Becaus that way works for any type, while 'returning a new copy' only works without probems for simple types
[19:04:40] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[19:05:07] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[19:05:30] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[19:05:30] <mib_rta6vx> Right. I was having some troubles trying to provide borrowed pointers to the interior of a struct with mutable state
[19:05:56] <mib_rta6vx> Unsafe, I know
[19:06:54] <kimundi> yeah, if you borrow part of a struct, the whole struct get's restricted for th lifetime of the borrow
[19:07:39] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Ping timeout)
[19:07:39] <mib_rta6vx> I solved it by transmuting to raw pointers and returning those. The api only allows access via member functions, so I think it is more or less safe.
[19:07:57] <mib_rta6vx> Not safe in the Rust sense, of course
[19:08:01] *** Joins: obk (Mibbit@moz-B0F26027.red.bezeqint.net)
[19:09:24] <strcat> mib_rta6vx: any function actually taking a raw ptr as a param and deref'ing it has to be marked unsafe
[19:09:25] *** Joins: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro)
[19:09:45] <kimundi> hm, mind sharing that usecase on an online paste somewhere? In general you _really_ shouldn't need unsafe
[19:10:20] <obk> &mut self, is a struct with foo: ~[~Foo]. self.foo[0].bar = None - OK. { let mut baz = self.foo[0]; baz.bar = None; } - fails (cannot move out of dereference of & pointer). How come?
[19:10:57] <kimundi> obk: SOrry, can't follow
[19:11:00] <cmr> obk: you're moving out of the vector.
[19:11:14] <mib_rta6vx> kimundi: Second, let me prepare something...
[19:11:31] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[19:12:41] <obk> Ok, saying { let mut baz = &self.foo[0]; baz.bar = None; } is even worse... "cannot assign to immutable field" on the assignment. `baz` is mutable... 
[19:12:53] <cmr> Right, &mut self.foo[0]
[19:13:09] <cmr> The *binding* is mutable, but not the data through the pointer.
[19:13:49] <obk> Ok, given self is mutable, and it owns the vector - how do I burrow a mutable pointer to the vector element?
[19:14:03] <cmr> &mut self.foo[0]
[19:14:14] <obk> Oh. Hmmm.
[19:14:32] <obk> Makes sense I guess...
[19:15:09] <kimundi> that part is a bit unclear, but basically x = foo[0] moves, and x = &foo[0] or x = &mut foo[0] borrows
[19:16:13] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Input/output error)
[19:16:18] <obk> Right. I got thrown of by mut-of-the-bindings (mut on the variable name) and mut-on-the-data (mut after the & of the vector element).
[19:16:22] <mib_rta6vx> kimundi: I am trying to implement a sprite renderer, that uses batches of sprites. I came up with the following design (I took out a lot of stuff, probably messed it up a bit): http://pastebin.com/fG3r7azb
[19:16:39] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[19:17:04] <mib_rta6vx> The unsafe function is "window.add_sprite_batch()"
[19:17:24] <mib_rta6vx> I wanted an api, that provides access to the batches, yet wanted to window to own them.
[19:17:32] <mib_rta6vx> *the window
[19:17:44] <cmr> Line 14 introduces a data race.
[19:17:51] <cmr> And also use-after-free.
[19:18:02] *** Quits: dcrewi (david@moz-AB8667CE.gyrae.net) (Ping timeout)
[19:18:19] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[19:18:31] <cmr> maybe not a data race
[19:18:34] <cmr> but definitely use after free.
[19:19:27] <strcat> you really don't want to use unsafe code to work around a compiler error
[19:19:35] <strcat> the error happens because you're trying to do something unsafe
[19:20:04] <strcat> so the answer likely isn't to force it, unless you *really* are sure it's to overcome an inability to express a safe pattern
[19:20:06] <obk> If I burrow a mutable reference to an element of a vector, I can't push into it. Fair enough. The thing is, this is a vector of ~Foo. I actually want to burrow a mutable reference to the Foo. I should be able to push to the vector then...
[19:20:47] <doomlord> could 'present' take &self instead of &mut self
[19:20:47] <mib_rta6vx> cmr: The idea was, that the batches get free'd together with the window, which only happens at application shutdown
[19:20:50] <obk> So, if I do `let foo = &mut self.foos[0]`, the vector gets locked against push.
[19:21:19] <cmr> obk: pushing to the vector could reallocate it and move it elsewhere, invalidating your pointer.
[19:21:34] <cmr> &mut *self.foo[0] perhaps?
[19:21:45] <obk> Hmmm.
[19:21:55] <doomlord> would you split it into a scene and window graphics context ... present takes immutable scene and just mutates graphics
[19:22:04] <obk> Nope.
[19:22:15] <doomlord> @mib
[19:22:22] <obk> Though you'd expect it to work...
[19:22:26] <strcat> it doesn't reason about borrows at a super high level like that
[19:22:32] <strcat> it doesn't know what push actually *does*
[19:22:36] <strcat> only that it takes &mut self
[19:22:54] <kimundi> obk: The problem is that a push() to the vector can reallocate it, which would invalidate any pointer into the old memory location
[19:23:16] <obk> Right. The problem is I can't "copy" the ~Foo pointer.
[19:23:25] <mib_rta6vx> doomlord: Not sure about .present taking a non-mut, but the core idea was to provide pointers to the sprite_batches to make adding new sprites easy, yet letting the window handle everything else
[19:23:54] <obk> If I could say `let mut foo = self.foos[0]`, meaning "foo is a ~mut Foo".
[19:23:59] <obk> But it doesn't work that way.
[19:24:02] <mib_rta6vx> The only danger would be using a pointer to a sprite_batch that doesn't exist anymore - which should not be possible
[19:24:14] <doomlord> i'd think of this sort of thing with seperated 'udpate' / 'render' .. update would take mutable sprites, render aka present would take immutable sprites
[19:24:34] <doomlord> oh. are the sprite-batches purely a rendering construct
[19:24:42] <obk> Is there some other workaround?
[19:24:48] <obk> (Other than "unsafe" - ugh)
[19:24:59] <doomlord> even then.. its like some rendering state accumulated.. rendering wouldn't change the sprites themselves?
[19:25:02] <mib_rta6vx> doomlord: Yeah, but the interesting part is _adding_ new sprites. Yep, pure rendering code here.
[19:25:27] <doomlord> would present itself have code that generates sprites
[19:25:36] <mib_rta6vx> doomlord: no
[19:25:59] <strcat> obk: clone the ~Foo or use @Foo, or redesign it to work with the borrowing semantics
[19:26:18] <strcat> have borrowed pointers in the vector and copy them out
[19:26:18] <doomlord> for me rendering usually takes an immutable scene and modifies some output .. a bitmap, a graphics api state
[19:26:19] *** Joins: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net)
[19:26:33] <mib_rta6vx> Generating sprites is only done via SpriteBatch.draw(). (Which doesn't actually draw yet, just add it to the window. Drawing is done in window.present())
[19:26:59] <obk> Hmmm. Having burrowed pointers in the vector means I need to deal with deallocating them. And I'm trying to avoid @. Cloning... hmmm.
[19:27:45] <strcat> ~Foo is clonable if Foo is
[19:28:01] <strcat> obk: there's also extra::rc if your reason for avoiding @ is avoiding the runtime
[19:28:34] <mib_rta6vx> kimundi: Any idea if I could avoid the unsafe part, yet still keep the general idea of the api? 
[19:28:41] * obk is starting to think something like #T would make Rust must easier to code to...
[19:28:42] <strcat> compared to ~, the overhead of Rc is a 1 word larger allocation (for the count)
[19:28:59] <strcat> obk: we're moving more stuff out of the language and into the library, not the other way
[19:29:14] <strcat> there's no reason to pick and choose more container/pointer impls and raise them above third party ones
[19:29:17] <obk> Well, something with easier syntax than [a]rc.
[19:29:28] <strcat> it will gain syntactic sugar
[19:29:35] <obk> Right.
[19:29:45] <strcat> Rc really isn't that bad though
[19:29:54] <strcat> rc.borrow() instead of &*rc
[19:30:00] <obk> Currently I feel like I'm playing Sudoku with the type system. I know what I want to do is safe, but convincing the compiler...
[19:30:25] <strcat> if you're writing code with borrows, that's always how it will be
[19:30:35] <strcat> you don't have to write your code with borrows
[19:30:46] <strcat> you can clone or use shared ownership
[19:31:12] <obk> "Shared ownership"?
[19:31:16] <strcat> Rc and @
[19:31:27] <obk> Ah, right. And Arc, of course.
[19:31:44] <strcat> Rc is just ~ with multiple owners
[19:31:46] <mib_rta6vx> strcat: Sorry to interrupt, but are you saying that using Rc instead of ~ to work around some borrow-issues will be acceptable even in performance code?
[19:31:55] <strcat> still has deterministic destruction, still has move semantics
[19:31:59] <strcat> mib_rta6vx: sure, most of the time
[19:32:02] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[19:32:02] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02https://github.com/mozilla/rust/compare/29a67d1dc2a1...7503396070a8
[19:32:02] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[19:32:09] <strcat> the *only* overhead of Rc is a 1-word field in the allocation for the count
[19:32:27] <strcat> when you actually do clone, it will do a refcount += 1, and refcount -= 1 on destruction
[19:32:36] <mib_rta6vx> strcat: Hmm, probably preferable to unsafe hacks, then. Thanks!
[19:32:49] <strcat> Rc is immutable though
[19:33:00] <strcat> RcMut isn't, but like @mut it has to enforce safety dynamically
[19:33:09] <strcat> so it's a bit painful
[19:33:42] <mib_rta6vx> strcat: But Rc could be used to provide pointers into mutable structures, no?
[19:34:02] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Quit: Konversation terminated!)
[19:34:34] <strcat> mib_rta6vx: well Rc owns what's contained in it, and then lets you have any number of references to it
[19:34:36] <obk> BTW, is there such a difference between Arc and Rc? Sure, Arc does xadd while Rc does a normall add, but if there's no contention on the cache line, the overhead should be zero (in theory).
[19:34:54] <strcat> obk: the mutable Arcs have to do locking
[19:35:07] <strcat> and it has higher requirements
[19:35:12] <strcat> Rc requires Send *or* Freeze
[19:35:13] <obk> All you need is do an X86 "XADD" instead of an add, no?
[19:35:16] <strcat> Arc requires Send + Freeze
[19:35:55] <obk> Hmmm. Not sure why the different requirements.
[19:36:21] <strcat> because Arc always requires Freeze
[19:36:26] <strcat> if it's not Freeze, it's not thread-safe
[19:36:41] <strcat> Rc only requires Send or Freeze to statically prevent cycles
[19:36:46] <doomlord> mib_rta6vx maybe you could prepare the sprite batches outside and pass ownership, eg sprites:~[~SpriteBatch] , the code that does 'draw' wouldn't need to be mutating the window ? ...  or would that be too different to what you have in mind
[19:37:29] <strcat> obk: well it has to do it in-place
[19:37:35] <shachaf> hi obk
[19:37:41] <obk> But if Rc allows me to get multiple pointers to the same data, you have a similar problem as well, no? Even w/o send. interleaving access via ptr1 and ptr2 is a problem even if they are held by the same task, no?
[19:37:48] <strcat> so yeah I guess that works
[19:37:57] <doomlord> mib_rta6vx, althought that would be an extra bit of pointer chasing between sprite-batches, it would be the sprites that really mattered perhaps?
[19:38:01] <strcat> obk: no, it's immutable
[19:38:25] <strcat> RcMut prevents having an &mut borrow and another borrow at the same time
[19:38:33] <obk> Right. So it is the "no cycles" issue.
[19:38:42] <obk> But Arc doesn't allow cycles either.
[19:38:51] <strcat> obk: well you can't make cycles with Rc because Rc is non-Send, and it requires Send
[19:39:07] <strcat> if you type is Freeze, it's immutable, and you can't create a cycle because you can't modify it to refer to itself
[19:39:09] <strcat> your type*
[19:39:22] <strcat> so that's why it needs Send or Freeze
[19:39:26] <strcat> no other reason
[19:39:28] <obk> I though Rc only worked for immutable stuff from the get-go.
[19:39:34] <strcat> obk: not necessarily
[19:39:53] <strcat> obk: the thing contained in Rc is in an immutable slot
[19:39:53] <obk> Ah, if Rc is in a mut struct, it becomes mutable?
[19:39:56] <strcat> no
[19:39:59] <obk> So?
[19:40:13] <strcat> non-Freeze means *does not inherit mutability*
[19:40:24] <mib_rta6vx> doomlord: I am trying to provide a nice api, that let's the user do a "let window = Window::new(); let s = window.add_sprite_batch(); s.draw(); s.draw(); window.present();"
[19:40:24] <strcat> like @mut and Cell
[19:40:27] <obk> Ah
[19:40:44] <strcat> (well, technically Freeze means either immutable *or* it inherits mutability from the owner)
[19:40:58] <strcat> most things are Freeze
[19:41:07] <strcat> just not RcMut, @mut, Cell, RWArc
[19:41:13] <mib_rta6vx> I couldn't find another way to do that but to provide pointers into the sprite_batches, which are owned by window
[19:41:21] <strcat> and &mut isn't Freeze
[19:42:04] <doomlord> mib_rta6vx, maybe there are other ways you could structure it too, like using lambdas to generate the sprites..
[19:42:24] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[19:42:24] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/33oZAg
[19:42:24] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[19:43:37] <mib_rta6vx> doomlord: I try to work with the current system a bit and when it blows up in my face, I'll reconsider, hehe. Thanks for working through it, though!
[19:44:18] <erickt1> does anyone know what the long term plan is for std::io and std::rt::io? Will std::rt::io eventually replace std::io?
[19:44:25] <cmr> erickt1: yes
[19:44:40] <doomlord> is libc staying  
[19:45:01] <erickt1> cmr: thanks. I guess I'll stop trying to modernize std::io then :)
[19:45:05] *** Quits: eatkinson (eatkinson@moz-5CF47426.dia.static.qwest.net) (Quit: eatkinson)
[19:45:26] <cmr> doomlord: std::libc? yes
[19:45:27] <obk> Maybe I should just use owned_to_raw :-(
[19:46:07] *** Joins: dcrewi (david@moz-AB8667CE.gyrae.net)
[19:48:49] <kimundi> mib_rta6vx: Hm, just now I actually understood what the code is supposed to do ;) - As others have said, you either want to store the SpriteBatches in some kind of shared ownership box, or construct a SpriteBatch with all planned 'draw' calls beforehand and pass it to the window, or return some kind of handle/index to the SpriteBatch that you can use to access it inside the window 
[19:49:53] <doomlord> rusts' move semantics would handle that fine, wouldn't it.
[19:50:14] <kimundi> doomlord: handle what?
[19:51:08] <doomlord> {  ..  mut ~SpriteBatch ..   /* generate*/ sb.add(mysprite...)      /*pass to the window*/ win.add(sb);  /* any attempt to use 'sb' after this point  will fail telling you its been moved ..*/
[19:51:25] <doomlord> ^^{  ..let sb: mut ~SpriteBatch ..   /* generate*/ sb.add(mysprite...)      /*pass to the window*/ win.add(sb);  /* any attempt to use 'sb' after this point  will fail telling you its been moved ..*/
[19:51:42] <mib_rta6vx> kimundi: Thanks for working through it! Yeah, I guess I shared ownership is the way to do it, if I want to preserve my api
[19:51:51] <kimundi> yeah, 'creating beforehand and then pass to window' is a good example for a move
[19:51:53] <doomlord> i thinnk you can do it without shared ownership
[19:51:59] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[19:52:00] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/33oZAg
[19:52:00] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[19:52:01] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[19:52:01] <ghrust> 01[13rust01] 15bors pushed 11 new commits to 06auto: 02http://git.io/RIT3cQ
[19:52:01] <ghrust> 13rust/06auto 145923cc3 15Brian Anderson: rt: Remove rust_env
[19:52:01] <ghrust> 13rust/06auto 149c71f4f 15Brian Anderson: Remove the annihilate lang item
[19:52:01] <ghrust> 13rust/06auto 141b6292a 15Brian Anderson: rt: Remove rust_signal.h
[19:52:02] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[19:52:06] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[19:53:22] <mib_rta6vx> doomlord: I would have to change the api and make the user do more, though. 
[19:54:07] <doomlord> you could still make the window 'create' a spritebatch for you though i think if you  want it to carry details from the window (clip info?)
[19:55:52] <mib_rta6vx> doomlord: Ah, but there will be _multiple_ sprite-batches. So I would have the user manage the vector and pass that to window (if that is what you mean?)
[19:56:30] <doomlord> actually, could you make a 'sprite-batch-builder' object.   struct SpriteBatchBuilder { win:&Window, sprites:~[Sprite] }   impl Drop for SpriteBatchBuilder { ... pass ownership when the sprite batch builder goes out of scope }
[19:57:02] <doomlord> you'd still make one call, but id' call it "create_sprite_batch" perhas? 
[19:57:38] <doomlord> "multiply sprite batches" , you can still pass them one by one - you will have a vector of vectors of sprites whatever happens
[19:58:01] <doomlord> i dont think passing ownership of each individual *sprite vector* is going to be any different
[19:58:30] <mib_rta6vx> doomlord: Hmm, pass ownership in the destructor sounds interesting. But I'm not sure I follow. Pass ownership to _what_?
[19:58:49] <doomlord> at some point the *sprite batches* gets a realloc or 'push' , and it can take the ptr to the sprite vector at that point
[19:59:00] <doomlord> ^^^ pass ownership back to the *window*
[19:59:13] <doomlord> or rather pass ownership *into* the window
[19:59:29] <doomlord> after constructing it on the stack (its just a pointer being moved, not the actual sprite array)
[19:59:44] *** Quits: Ms2ger (Ms2ger@59A8FC80.80FA5708.187A1082.IP) (Quit: nn)
[20:00:05] <doomlord> hehe taking the &Window, you'd get the window frozen while you're building the sprites, which is exactly what you want :)
[20:00:20] *** Quits: obk (Mibbit@moz-B0F26027.red.bezeqint.net) (Quit: http://www.mibbit.com ajax IRC Client)
[20:00:25] <mib_rta6vx> doomlord: Hmm, I think my Rust-Fu is not quite strong enough to reliably carry these discussions yet. And I don't want to clog up the irc logs with my drivel, hehe.
[20:00:28] <doomlord> (whilst the SpriteBatchBuilder is in scope)
[20:00:46] <mib_rta6vx> doomlord: But thanks a lot for trying to help! 
[20:00:59] <doomlord> i thinnk this is relevant 
[20:01:45] *** Quits: valenting (Thunderbir@moz-7BACEE12.residential.rdsnet.ro) (Ping timeout)
[20:01:51] <doomlord> you have an unsafe block... but i thinkn what you're tring to do can be expressed with freezing, safely. would be good to see if thats true
[20:02:02] <mib_rta6vx> I should have thought about a reasonably reduced example before asking. This sprite-batch business might be a bit too ... convoluted.
[20:02:23] <doomlord> solving the problem is sometimes 'making it un-convoluted' :)
[20:02:40] *** Quits: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl) (Ping timeout)
[20:02:41] <nielsle> I am getting an ICE with rust  build. Is this serious, or am I just doing something wrong?    http://pastebin.com/Wi3PCDXg
[20:03:10] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[20:03:28] <nielsle> (rust build from yesterday)
[20:03:46] <mib_rta6vx> nielsle: I had a problem with latest compile too. Nuking the whole directory and cloning the repo again solved it
[20:04:10] <nielsle> hehe, I will try that
[20:04:10] <mib_rta6vx> (LLVM gets rebuilt, unfortunately)
[20:04:24] *** Joins: glennsl (textual@moz-5D7B804F.getinternet.no)
[20:04:34] <nielsle> Thanks
[20:05:12] <mib_rta6vx> Anyway, thanks for all the help and food for thought, guys. Got to go now.
[20:05:16] * mib_rta6vx waves
[20:05:30] *** Quits: mib_rta6vx (Mibbit@moz-D3D15A0C.vie.surfer.at) (Quit: http://www.mibbit.com ajax IRC Client)
[20:06:11] <doomlord> (mib_rta6vx, maybe the 'sprite-batch-builder' could actually take ownership of the window? maybe a big expression can be setup that returns an updated window after a lot of passsing of the pointer along..? not sure if thats too convoluted though ...)
[20:07:03] <glennsl> hi all. I've been looking into rewriting std::io to use external iterators, but have been getting confused
[20:07:22] <cmr> glennsl: don't bother, std::io is not long for the world.
[20:07:28] <cmr> maybe for std::rt::io though :)
[20:07:33] *** Quits: KindOne (KindOne@moz-7F7CBF25.dynamic.ip.windstream.net) (Ping timeout)
[20:08:00] <glennsl> ah, well that might be just as well then :)
[20:08:41] <glennsl> I'll go have a look at rt::io
[20:08:54] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[20:11:31] *** Joins: KindOne (KindOne@moz-7D9A1838.dynamic.ip.windstream.net)
[20:15:22] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[20:15:56] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[20:16:30] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[20:18:14] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Ping timeout)
[20:19:11] *** Joins: lucian (lucian@moz-22A14C6A.cable.virginmedia.com)
[20:19:56] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[20:22:31] *** Quits: lucian (lucian@moz-22A14C6A.cable.virginmedia.com) (Ping timeout)
[20:30:44] *** Quits: mindcat_ (mindcat@5D9242F8.14B01478.F956842C.IP) (Quit: Lost terminal)
[20:32:43] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[20:33:35] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[20:33:36] *** ChanServ sets mode: +o brson
[20:34:43] *** Quits: nsf (nsf@moz-EEF3238A.convex.ru) (Quit: WeeChat 0.4.1)
[20:35:32] *** Quits: vk (chatzilla@moz-389FEE13.hsd1.ca.comcast.net) (Ping timeout)
[20:36:01] *** Quits: dcrewi (david@moz-AB8667CE.gyrae.net) (Ping timeout)
[20:36:51] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[20:40:00] *** Joins: jamil_1 (quassel@moz-2FB0F793.wateen.net)
[20:44:06] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[20:44:47] *** Quits: jamil_1 (quassel@moz-2FB0F793.wateen.net) (Ping timeout)
[20:45:47] *** Joins: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl)
[20:48:08] *** Joins: jamil_1 (quassel@467FDE5C.C74DB0B7.E86700E.IP)
[20:48:58] *** Quits: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[20:48:59] *** Joins: dcrewi (david@moz-AB8667CE.gyrae.net)
[20:49:48] *** Quits: jamil_1 (quassel@467FDE5C.C74DB0B7.E86700E.IP) (Ping timeout)
[20:50:30] *** Joins: jamil_1 (quassel@467FDE5C.C74DB0B7.E86700E.IP)
[20:52:48] *** Quits: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP) (Quit: buildmaster reconfigured: bot disconnecting)
[20:52:50] *** Joins: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP)
[20:52:58] *** Joins: graydon (graydon@moz-F14EE0DB.cable.teksavvy.com)
[20:52:58] *** ChanServ sets mode: +qo graydon graydon
[20:56:49] *** Quits: victorporof (victorporo@69BF4ADB.B434C58E.9B1E38F4.IP) (Quit: victorporof)
[21:05:22] *** Quits: jamil_1 (quassel@467FDE5C.C74DB0B7.E86700E.IP) (Client exited)
[21:06:49] *** Joins: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru)
[21:10:18] *** Joins: jamil_1 (quassel@467FDE5C.C74DB0B7.E86700E.IP)
[21:10:42] *** Quits: jamil_1 (quassel@467FDE5C.C74DB0B7.E86700E.IP) (Connection reset by peer)
[21:10:45] *** Quits: Ralith (ralith@moz-50F3C77.vc.shawcable.net) (Ping timeout)
[21:13:22] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[21:14:08] <joelteon> I think I'll register doesrusthavecommadaptersyet.com
[21:14:37] <myname> isrust10thereyet.com
[21:14:44] <cmr> joelteon: nobody is working on it
[21:14:52] <joelteon> I will
[21:14:58] <joelteon> time to fork it
[21:15:18] <joelteon> time to learn how to write unsafe code too
[21:16:09] *** Joins: jamil_1 (quassel@467FDE5C.C74DB0B7.E86700E.IP)
[21:17:13] *** Joins: orshem (orshem@C5E06B1E.A5B6B765.E3D28531.IP)
[21:17:43] <flaper87> hey guys, I'm working on a fix for https://github.com/mozilla/rust/issues/8232 The fix should be ready. How can I run tests for std::task::mod only ?
[21:18:11] <flaper87> I'm reading the tests docs but they mustly talk about tests under src/test but I don't see any test for rekillable there
[21:18:13] <cmr> flaper87: make check TESTNAME=std::task
[21:18:22] <cmr> I think that does it..
[21:18:25] <flaper87> cmr: lemme try
[21:18:58] <flaper87> cmr: nope, perhaps something along the lines of check-stage[N]-std ?
[21:19:08] <flaper87> not sure what stage it should be, though
[21:19:16] <cmr> stage 1 is fine
[21:19:41] <kimundi> make check-stage1-std compiles up-to and runs the libstnd tests  fro stage1, which should be enoug for developing
[21:20:06] <kimundi> should run a full make check prior to submitting a PR of course
[21:23:48] *** Quits: jamil_1 (quassel@467FDE5C.C74DB0B7.E86700E.IP) (Ping timeout)
[21:25:13] *** Quits: KindOne (KindOne@moz-7D9A1838.dynamic.ip.windstream.net) (Ping timeout)
[21:25:19] *** Quits: dim-an (ermolovd@moz-FE167E47.nationalcablenetworks.ru) (Ping timeout)
[21:26:04] <flaper87> cool, thanks guys
[21:26:23] *** Joins: jamil_1 (quassel@467FDE5C.C74DB0B7.E86700E.IP)
[21:26:43] *** Joins: vodik (simon@moz-CBE4BB13.cable.teksavvy.com)
[21:27:12] *** Joins: jamil_1_ (quassel@467FDE5C.C74DB0B7.E86700E.IP)
[21:29:00] *** Joins: KindOne (KindOne@moz-9B1B94F.dynamic.ip.windstream.net)
[21:29:56] *** Quits: jamil_1 (quassel@467FDE5C.C74DB0B7.E86700E.IP) (Connection reset by peer)
[21:29:56] *** Quits: jamil_1_ (quassel@467FDE5C.C74DB0B7.E86700E.IP) (Client exited)
[21:30:15] *** Quits: igl (igl@moz-BFCC83D8.adsl.alicedsl.de) (Ping timeout)
[21:31:12] *** Joins: igl (igl@moz-2C89A932.adsl.alicedsl.de)
[21:33:37] *** Joins: pyrac (pyrac@moz-F2B1E85D.w92-162.abo.wanadoo.fr)
[21:33:52] *** Joins: jamil_1 (quassel@467FDE5C.C74DB0B7.E86700E.IP)
[21:34:12] *** Joins: jamil_1_ (quassel@467FDE5C.C74DB0B7.E86700E.IP)
[21:36:23] *** Quits: pyrac (pyrac@moz-F2B1E85D.w92-162.abo.wanadoo.fr) (Quit: pyrac)
[21:38:38] *** Quits: jamil_1 (quassel@467FDE5C.C74DB0B7.E86700E.IP) (Client exited)
[21:38:39] *** Quits: jamil_1_ (quassel@467FDE5C.C74DB0B7.E86700E.IP) (Client exited)
[21:38:46] *** Quits: jaen (jaen@moz-E0979827.copit.pl) (Ping timeout)
[21:40:25] *** Quits: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se) (Ping timeout)
[21:40:30] *** Joins: dim-an (ermolovd@moz-2590E524.yandex.net)
[21:42:30] *** Joins: BitPuffin (quassel@moz-8370D1B9.bredband.comhem.se)
[21:48:00] *** Quits: vodik (simon@moz-CBE4BB13.cable.teksavvy.com) (Quit: WeeChat 0.4.2-dev)
[21:53:10] *** Joins: erickt1 (Adium@49C4075F.3AC15C18.2321E71E.IP)
[21:53:37] *** Quits: true_droid (true_droid@moz-123FD9B8.beck.volia.net) (Client exited)
[21:56:42] *** Quits: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP) (Quit: buildmaster reconfigured: bot disconnecting)
[21:56:42] *** Joins: rust-buildbot (rust-build@505BFA3.C3CCCE8C.D25A875A.IP)
[21:58:54] *** Joins: kevincantu (kevin@moz-244ED9FD.hsd1.ca.comcast.net)
[21:59:37] <kevincantu> hello everyone :)
[22:02:42] *** Quits: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP) (Ping timeout)
[22:03:56] <brson> hey kevincantu 
[22:05:36] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[22:06:05] <strcat> rusti: range(0i8, -1).to_owned_vec()
[22:06:08] -rusti- ~[]
[22:06:18] <strcat> rusti: range(2i8, 1).to_owned_vec()
[22:06:18] -rusti- ~[]
[22:07:10] <orshem> what's the smart way to build a long string? ~[u8]?
[22:07:21] <cmr> orshem: str::with_capacity plus push_str
[22:07:51] <strcat> orshem: strings are represented the same way as [u8] except they're guaranteed to be valid utf8
[22:08:37] <orshem> cmr, thanks
[22:08:58] <orshem> strcat, string are ~[str]?
[22:09:06] <cmr> strings are ~str
[22:09:11] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[22:09:19] <strcat> a ~str has the same representation as ~[u8]
[22:09:19] <orshem> also normalization? iteration over grapheme/codepoints?
[22:09:32] <strcat> the only difference is that str enforces that the contents are utf-8
[22:09:44] <strcat> and implements methods based on that guarantee
[22:10:04] <kevincantu> does ~str still have a slightly different meaning than ~GenericThing?
[22:10:14] <cmr> kevincantu: yeah
[22:11:12] <engla> yesterday I rewrote CharIterator to use pointer arithmetic (basically char_range_at inlined into the iterator in pointer arith), and it's faster of course. Still not sure if it's worth it yet
[22:11:41] <strcat> engla: seems it should be possible without doing it manually
[22:11:52] <engla> strcat: I tried adding a method  unsafe fn next_unchecked(&mut self) -> *T  to VecIterator, the method would just do ++ptr and return it, but it still doesn't perform anywhere near
[22:12:03] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[22:12:11] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[22:12:11] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02https://github.com/mozilla/rust/compare/7503396070a8...cb8a231eb8b7
[22:12:11] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[22:12:23] <engla> I've tested some a couple of variants
[22:12:47] <strcat> before adding unsafe code, we need to look at the IR and confirm that there's no way to have it optimize to what we want with safe code
[22:12:59] <strcat> the trend is towards the whole stdlib becoming unsafe for speed
[22:13:23] <engla> right, notice how there is no PR or suggestion to include this in the stdlib
[22:13:34] <engla> I'm just saying I've tried lots of variants for the CharIterator
[22:14:09] <engla> also it's a bit too early, let veciterator be stable before it's identically implemented anywhere (if needed)
[22:14:32] *** Joins: mihneadb (Mihnea@moz-329F29A3.lightspeed.sntcca.sbcglobal.net)
[22:14:32] <strcat> we need alias analysis
[22:15:00] *** Quits: dim-an (ermolovd@moz-2590E524.yandex.net) (Ping timeout)
[22:18:05] *** Joins: dim-an (ermolovd@moz-2590E524.yandex.net)
[22:21:07] <engla> "".slice() can be optimized by dropping the assertions on the slice boundaries (already checked by is_char_boundary)
[22:22:06] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[22:22:06] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/NmFtCA
[22:22:06] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[22:22:06] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[22:22:06] <ghrust> 01[13rust01] 15bors pushed 13 new commits to 06auto: 02https://github.com/mozilla/rust/compare/cb8a231eb8b7...679102109fd7
[22:22:06] <ghrust> 13rust/06auto 141dec27b 15Michael Woerister: debuginfo: Fixed option-like-enum test case so it does not rely on undefined behavior.
[22:22:06] <ghrust> 13rust/06auto 14907633b 15Michael Woerister: debuginfo: Generate template type parameters for generic functions....
[22:22:07] <ghrust> 13rust/06auto 146c49c2d 15Michael Woerister: debuginfo: Properly handle monomorphization of generic functions.
[22:22:09] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[22:25:45] <engla> strcat: so when alias analysis is available (don't think I can help with that), then we can revisit ways to do the utf-8 decode faster with a vec iterator
[22:31:05] *** Quits: KindOne (KindOne@moz-9B1B94F.dynamic.ip.windstream.net) (Ping timeout)
[22:32:19] *** Quits: bytewise (bytewise@moz-4A801D04.unitymediagroup.de) (Quit: Leaving)
[22:33:27] *** Joins: SingingBoyo (brandon@4DF3381A.51F4D838.4F048BDC.IP)
[22:34:20] *** Joins: huseby (huseby@moz-4E8C421A.husebyhome.com)
[22:34:36] <engla> oh nice, it looks like instead of removing the asserts in a variant of slice_bytes
[22:34:58] *** Quits: vosen (vosen@moz-266BA656.icpnet.pl) (Quit: Leaving)
[22:34:59] <engla> slice_bytes can just use .repr() instead of fn as_imm_buf and it seems to elide the assertion checks
[22:35:19] *** Joins: KindOne (KindOne@moz-9FF38FFD.dynamic.ip.windstream.net)
[22:35:21] *** Quits: spider-mario (spidermari@moz-81131DB6.fbx.proxad.net) (Connection reset by peer)
[22:35:37] <engla> and "".slice() gets the same speedup
[22:36:37] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[22:38:05] * engla looks at as_imm_buf
[22:38:48] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Quit: This computer has gone to sleep)
[22:39:06] *** Quits: kevincantu (kevin@moz-244ED9FD.hsd1.ca.comcast.net) (Quit: kevincantu)
[22:42:58] *** Quits: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP) (Quit: night)
[22:43:13] *** Quits: orshem (orshem@C5E06B1E.A5B6B765.E3D28531.IP) (Quit: Leaving)
[22:45:04] *** Quits: sebcrozet (sebcrozet@moz-7FB6C00B.w193-252.abo.wanadoo.fr) (Ping timeout)
[22:46:03] *** Joins: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP)
[22:48:35] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[22:50:25] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[22:50:27] *** Quits: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP) (Quit: Leaving.)
[22:53:03] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[22:53:13] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.1)
[22:54:21] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[22:54:33] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[22:54:45] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:54:47] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[22:58:40] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[22:58:40] *** ChanServ sets mode: +o dherman
[23:02:21] *** Joins: tiffnya (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[23:02:33] *** Quits: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[23:10:04] *** Quits: tiffnya (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net) (Ping timeout)
[23:11:51] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[23:13:11] <brson> Thiez: is there a paper or book your queue is based off of?
[23:13:20] <brson> i'd like to read it
[23:15:25] *** Joins: dwhyte (dwhyte@1922756A.EDC594B0.7BF4A4B0.IP)
[23:16:45] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[23:17:26] <Thiez> brson: it's a michael/scott lockless queue, I think the first one shown in http://www.research.ibm.com/people/m/michael/podc-1996.pdf, except that since we don't have a double-word cas we suffer from the ABA problem
[23:17:43] <brson> thanks
[23:18:20] <Thiez> the relevant issue mentions this: https://github.com/mozilla/rust/issues/6837 ;)
[23:20:53] <toddaaro> Thiez: is your queue finished?
[23:21:00] <toddaaro> if so we should dump that in everywhere
[23:22:55] *** Joins: mark_edward (quassel@21027BAA.520D6B7D.BF46A673.IP)
[23:23:11] *** Joins: ross (ross@moz-8A84103E.br.br.cox.net)
[23:24:32] <brson> are there lock-free queues that don't allocate for every node?
[23:24:57] <brson> allocation is another place where we're really hurting atm
[23:26:51] *** Joins: tiffany (kawaii@moz-EB8B0C08.dhcp.embarqhsd.net)
[23:26:57] <toddaaro> I'm not sure if there are in the general case
[23:27:05] <toddaaro> but we could pool nodes
[23:27:43] <toddaaro> anything array-backed should escape most allocation, but I think you can only pull that off given constraints
[23:28:47] <Thiez> if you want it unbounded you have to allocate
[23:29:22] <brson> Thiez: but at every push?
[23:29:57] <strcat> brson: allocation will get a lot faster when we turn jemalloc back on
[23:30:00] <strcat> test iterator ... bench: 90 ns/iter (+/- 15)
[23:30:03] <strcat> test iterator ... bench: 26 ns/iter (+/- 2)
[23:30:09] <strcat> glibc vs jemalloc for ~5
[23:30:17] * strcat will try that now
[23:30:22] <brson> strcat: i'm not sure. i tried turning it on and it had no impact on the message passing benchmark i'm running
[23:30:33] <brson> maybe i turned it on wrong
[23:30:33] <strcat> brson: how big are the nodes?
[23:30:40] <brson> strcat: small probably
[23:30:55] <brson> strcat: its bench/rt-messaging-something if you want to try
[23:31:12] <brson> though it really needs toddaaro's idle callback optimazitions since those suck perf
[23:31:18] * brson bad english
[23:31:43] <Thiez> brson: perhaps with another algorithm, or perhaps this one could be tweaked a little
[23:31:46] <strcat> brson: what args should I pass it?
[23:32:20] <Thiez> generally you don't want to be changing the published lockless algorithms too much as it's easy to get wrong
[23:32:44] <brson> strcat: i've been using 1000000 16 i think
[23:33:25] <brson> i compared allocation to the old scheduler and afaict the old scheduler also allocated on send. the big difference is that we're allocating in the main scheduler loop *a lot*, even after toddaaro's patches
[23:33:31] <brson> the old scheduler did not allocate in the sched loop
[23:33:41] <brson> old scheduler was not being punished nearly as much by allocation
[23:34:13] <Thiez> brson: how does the lockless messagequeue compare to the old one, speed-wise?
[23:34:39] <brson> Thiez: i still haven't tested. I'm going to adapt it to the SleeperList first though. that's where I expect the biggest impact
[23:34:49] <brson> so many optimizations I want to try
[23:34:58] <brson> toddaaro: what are you going to attack next/
[23:35:43] <brson> i've been mostly microoptimizing tls for the last day
[23:35:57] * brson also supposed to be working on http
[23:35:59] <toddaaro> I think async callbacks are the next one
[23:36:09] <toddaaro> at the very least we can stop allocating them willynilly
[23:36:47] <toddaaro> I like the idea of a singleton async callback in an atomic option
[23:37:10] <toddaaro> and then to "use" it you just do an atomic take, if you are the winner you get to make the callback, if you are the loser, no worries, someone just made the callback for you
[23:37:14] <brson> toddaaro: do you have a test case that shows the async callbacks having a big impact?
[23:37:28] <brson> it doesn't seem to be a factor in your mesasge passing bench (that i see)
[23:37:42] <toddaaro> brson: I do not, but I assume they are nontrivial, every time we sleep we create one, every homed task builds one, etc.
[23:37:49] <brson> oh, unless that's the allocation happening in run_sched_once
[23:37:52] <brson> yah
[23:37:56] <brson> sleeping creates them
[23:38:30] <toddaaro> I can't think of any other allocation in the sched loop
[23:38:51] <toddaaro> but if it is showing up nontrivial there is probably something, as a message passing bench should be mostly sleep-free
[23:38:56] <toddaaro> and have few async callbacks
[23:39:25] <toddaaro> we could cheat grotesquely and use a 1-size bounded stream for pingpong actually
[23:39:42] *** Quits: huseby (huseby@moz-4E8C421A.husebyhome.com) (Ping timeout)
[23:39:54] <toddaaro> oh actually, streams are mono-directional
[23:40:07] *** Quits: SingingBoyo (brandon@4DF3381A.51F4D838.4F048BDC.IP) (Ping timeout)
[23:40:13] <toddaaro> I hadn't thought of this before, but we can just use chase-levs there too
[23:40:30] <toddaaro> and just not expose the pop operation
[23:40:51] <brson> we could - that is what go is doing - and i think we probably want to experiment with that type, but i also think it's more important to squeeze out the scheduler inefficiency than to create special-case channel types
[23:40:55] *** Joins: SingingBoyo (brandon@4DF3381A.51F4D838.4F048BDC.IP)
[23:41:55] <brson> toddaaro: possibly we could use the deque yeah, though with SharedChan you'd need to put a lock on it
[23:42:20] <brson> not the end of the world - oldsched had locked SharedChans
[23:42:25] <toddaaro> I guess SharedChan would be stuck with the michael/scott
[23:43:12] <toddaaro> another optimization to make is calling run_sched_once multiple times without passing through the event loop
[23:43:23] <brson> In the end it seems like we're going to have a specialized channel type for every scenario
[23:43:32] <brson> no more SharedChan::new(chan)
[23:43:55] <toddaaro> the efficiency gains of specialized implementations are too amazing to ignore
[23:44:56] <toddaaro> automagic implementation selection might be possible though
[23:45:05] *** Quits: samx (sami@moz-48EC0983.dyn.optonline.net) (Ping timeout)
[23:45:14] <brson> toddaaro: with the async optimization could you start by just creating a dedicated async handle for the sleeper list? see if avoiding that continual reallocation buys anything?
[23:45:27] <brson> we really want run_sched_once to never allocate
[23:45:36] <toddaaro> yea, that is an easy start
[23:46:32] <toddaaro> wow, yea that should be really easy
[23:46:41] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[23:46:57] <toddaaro> just a field to the struct with an option, if you receive shutdown destruct it
[23:47:49] *** Joins: samx (sami@moz-48EC0983.dyn.optonline.net)
[23:57:30] *** Quits: Florob (Florob@moz-39532932.de) (Client exited)
[23:59:48] <brson> oh, the sleeper list is multiple-producer, multiple-consumer :-/ the michael scott queue only has a single consumer
