[00:03:03] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[00:03:03] *** ChanServ sets mode: +qo brson brson
[00:05:07] <jack> where is to_ptr() defined?
[00:05:24] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[00:06:19] *** Quits: blank_name (blank_name@8DB1FDC4.16360A46.537E532E.IP) (Ping timeout)
[00:09:15] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[00:09:15] *** ChanServ sets mode: +o tjc
[00:10:54] <dbaupp> jack: for vectors? `std::vec::raw`
[00:11:10] <jack> dbaupp: that doens't exist anymor.
[00:11:16] <dbaupp> ah, yes
[00:11:20] <dbaupp> moved to .as_ptr()
[00:11:26] <jack> I just can't find what trait i need to import to get the method.
[00:11:37] <dbaupp> ImmutableVector
[00:11:39] <jack> and it's not in the docs anywhere.
[00:11:44] <dbaupp> it should be in the prelude
[00:12:03] <jack> sigh.
[00:12:08] <jack> this is a ~[*Foo]
[00:12:14] <jack> probably not defined for that.
[00:12:15] <dbaupp> http://static.rust-lang.org/doc/master/std/vec/trait.ImmutableVector.html#tymethod.as_ptr
[00:12:26] <jack> oh. as_ptr, not to_ptr
[00:12:26] <dbaupp> ~[] coerces to &[] automatically
[00:12:28] <dbaupp> in theory
[00:13:27] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[00:13:27] *** ChanServ sets mode: +qo brson brson
[00:15:56] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[00:23:01] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[00:27:32] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[00:27:34] <jack> we can't turn Chans into SharedChans anymore?
[00:28:43] <cmr> hm, seems not.
[00:29:57] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[00:29:58] *** ChanServ sets mode: +qo brson brson
[00:33:01] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[00:33:09] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[00:33:09] *** ChanServ sets mode: +qo brson brson
[00:34:16] <dbaupp> acrichto: ^
[00:34:51] <acrichto> jack: you can crate a shared chan
[00:36:22] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[00:36:24] *** Joins: brson_ (brson@moz-BBE3ABD.mv.mozilla.com)
[00:36:43] *** Quits: brson_ (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[00:36:47] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[00:36:47] *** ChanServ sets mode: +qo brson brson
[00:37:22] *** Joins: blank_name (blank_name@27AF90E3.AA624E84.6D228269.IP)
[00:37:24] <jack> acrichto: servo's use of sharedchan by the profiler required converting a chan into a shared chan. i fixed that nonsense.
[00:37:42] <acrichto> jack: oh dear, good to hear that it's fixed!
[00:39:02] <jack> sigh. i just blew away my rust. time to biudl it again.
[00:43:23] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[00:44:34] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[00:44:34] *** ChanServ sets mode: +qo brson brson
[00:46:07] <acrichto> klutzy: might be a good time to just rebase together the commits of #11013
[00:48:10] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[00:48:10] <ghrust> 01[13rust01] 15cmr 04force-pushed 06try from 1467758f8 to 149a1b1aa: 02http://git.io/k471pw
[00:48:10] <ghrust> 13rust/06try 149a1b1aa 15Corey Richardson: Rename pkgid to crate_id
[00:48:10] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[00:48:20] <klutzy> acrichto: rebase on master?
[00:48:33] <acrichto> klutzy: oh sry squash is what I meant
[00:50:52] <klutzy> acrichto: squashed to two commits
[00:51:32] <acrichto> klutzy: thanks!
[00:56:52] <dbaupp> acrichto: http://static.rust-lang.org/doc/master/any/index.html still exists
[01:00:33] <acrichto> ok, I'm going to actuall fix this
[01:00:43] <acrichto> as in figure out the equivalent of rsync --delete
[01:03:00] <brson> acrichto: be careful. if you delete all the existing docs by accident we don't have any other copies
[01:03:28] <acrichto> brson: the problem is the local workspace for the doc builder, 'make clean' doesn't do anything to the doc folder
[01:03:29] <brson> i thought i had configured aws delete unused files
[01:03:37] <brson> acrichto: ah
[01:03:39] <acrichto> the entire doc folder is slurped up onto aws
[01:04:26] <cmr> acrichto: just rm -rf it?
[01:04:39] <acrichto> tutorial.md and friends are all in there
[01:04:42] <acrichto> plus some extra lib stuff
[01:04:49] <cmr> why is it doing an in-place build :(
[01:05:02] <acrichto> hm, well it's not in the same place on the bots
[01:05:08] <acrichto> my locally I never do an out-of-place build
[01:05:14] <acrichto> so I wouldn't want it to nuke doc
[01:05:18] <cmr> I always do out of tree builds.
[01:05:27] * cmr thinks it's the only thing any build system should support
[01:05:49] <acrichto> well our in-tree build is just $target mostly
[01:05:52] <acrichto> which makes it a lot better
[01:06:01] <acrichto> I hate c/c++ .o files all over the place
[01:06:11] <acrichto> but with rust you don't really have the same concern
[01:06:15] <cmr> speaking of target.
[01:06:43] <cmr> strcat: could the arch package have --enable-targets for i686 linux and mingw-w64?
[01:06:55] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Ping timeout)
[01:07:00] <strcat> cmr: split maybe
[01:07:00] <cmr> your nighty, that is.
[01:07:12] <cmr> it'd be very convenient.
[01:08:03] <acrichto> brson: how would you feel about a specific rule on the doc builder to blow away 'obj/doc'
[01:08:13] <acrichto> I'm unsure of a good way to do this in general
[01:08:33] <cmr> make clean could also do a git clean -fd ?
[01:08:41] <acrichto> that would destroy llvm
[01:08:47] <cmr> good point
[01:10:35] *** Joins: andrew-d_w (andrew-d_w@3516ADBE.5E15A524.D8D85ABD.IP)
[01:10:37] *** Quits: andrew-d_w (andrew-d_w@3516ADBE.5E15A524.D8D85ABD.IP) (Input/output error)
[01:10:54] <ChrisMorgan> `git clean -fd doc` (or whatever path you  want)?
[01:10:58] *** Joins: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net)
[01:11:04] <acrichto> oh interesting
[01:11:15] <acrichto> look at git being all fancy working on specific sub-paths instead of the whole repo
[01:12:30] <brson> acrichto: why is that needed instead of fixing make clean?
[01:12:48] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[01:13:01] <acrichto> brson: it's difficult to clean out doc/ because there's lots of valid stuff intermingled with invalid stuff, but I think that ChrisMorgan's suggestion of git clean -fd on the doc dir is the way to go
[01:13:42] <brson> acrichto: why is there stuff there that we wouldn't want to clean? are we building directly in the src dir?
[01:13:55] <acrichto> brson: not on the bots, but in other installations we might
[01:14:00] <acrichto> in other trees*
[01:14:07] <brson> gr
[01:14:11] <acrichto> as in locally, my 'make docs' goes into the doc/ dir, but on the bots it goes in obj/doc
[01:14:41] <brson> make clean can't be tied to git because the source isn't always built from a git repo
[01:14:50] <acrichto> oh argh
[01:15:11] <acrichto> perhaps we should just build docs into another folder
[01:17:01] <ChrisMorgan> You also want to absolutely minimise the time that the docs will be unavailableâ€”e.g. build to newdoc, mv doc olddoc, mv newdoc doc, rm -r olddoc
[01:17:16] <acrichto> this isn't a problem with aws though, just locally
[01:17:25] <acrichto> the local doc folder is uploaded in its entirety
[01:17:32] <acrichto> so if there's stale things they're all uploaded
[01:17:33] * ChrisMorgan doesn't know precisely what's going on under the hood with the buildbots and so doesn't know if this is already what happens
[01:17:52] <ChrisMorgan> Yeah, still applies remotely. I presume you can rename directories on S3?
[01:18:07] <acrichto> we sync to s3, deleting all old files and uploading new ones
[01:18:10] <acrichto> it's all done in-place
[01:18:46] <ChrisMorgan> Oh, I get it. Local stale stuff. Right.
[01:18:55] <ChrisMorgan> That makes much more sense.
[01:20:46] <acrichto> huh, I did not realize extra::sync is build on os mutexes
[01:20:48] <acrichto> built*
[01:21:29] <brson> acrichto: i didn't either!
[01:21:32] <strcat> I don't think it is?
[01:21:34] <brson> i thought it was built on channels
[01:21:47] <acrichto> I'm looking at a current deadlock in extratest where something is stuck in pthread_mutex_lock
[01:21:54] <acrichto> so at least some port of it is built on os mutexes
[01:22:01] <acrichto> and it imports Exclusive
[01:22:07] <cmr> I'm pretty sure it uses LittleLock?
[01:22:20] <acrichto> Exclusive uses little lock
[01:22:53] <strcat> acrichto: it uses it to build a queue for the condvar
[01:22:55] <acrichto> brson: noooooooooooooooo a context switch was triggered on a send in an OS mutex
[01:23:00] <acrichto> welp
[01:23:02] <acrichto> that's a dealock
[01:23:16] <strcat> anyway extra::sync is too slow to be useful ;p
[01:23:28] <acrichto> here I am, Mr. "we don't need send_deferred"
[01:24:33] <acrichto> I *really* don't want to have send_deferred
[01:24:57] <brson> acrichto: maybe we can have a special type just for this use case
[01:25:03] <brson> or maybe we can eliminate this use case
[01:25:24] <acrichto> well, the easy elimination tactic is nuking all of extra::sync
[01:25:32] <cmr> heh
[01:25:32] <acrichto> which would include extra::{arc, comm}
[01:26:11] *** Quits: andrew-d_w (andrew-d_w@moz-9A2674DF.dsl.static.sonic.net) (Quit: Leaving...)
[01:26:38] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[01:26:38] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/e1K2yg
[01:26:38] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[01:27:16] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[01:27:34] <acrichto> these look like they were all written by bblum
[01:27:50] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[01:27:50] *** ChanServ sets mode: +qo brson brson
[01:31:45] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[01:31:45] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/fwQFCw
[01:31:45] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[01:31:47] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[01:31:47] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/vGQgkg
[01:31:47] <ghrust> 13rust/06auto 14a7ed042 15Alex Crichton: Adding tests for closed issues...
[01:31:47] <ghrust> 13rust/06auto 14e99335c 15bors: auto merge of #11012 : alexcrichton/rust/needstest, r=alexcrichton...
[01:31:48] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[01:32:50] <brson> acrichto: this is just an epic patchset
[01:33:04] <acrichto> it opens the door to so many things!
[01:33:10] <acrichto> native::io::net is soon after this lands
[01:33:22] <acrichto> plus native::io::process fixup
[01:35:34] <acrichto> brson: there's no way for Exclusive to work without having a whole set of functions which guarantee no switching, even try_recv() in signal() is broken
[01:37:17] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[01:37:19] <brson> acrichto: do you mean somewhing other than Exclusive?
[01:37:39] <brson> Semaphore? Mutex?
[01:37:41] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[01:37:47] <acrichto> that's what we want
[01:37:53] <acrichto> but Mutex/Semaphore are all built on Sem
[01:37:58] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[01:39:43] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[01:41:20] <brson> acrichto: it's just send_deferred and try_send_deferred that they need though, right?
[01:41:34] <acrichto> try_recv would also have to stop yielding
[01:41:50] <acrichto> and not even send_deferred
[01:41:54] <acrichto> just try_send_deferred
[01:42:08] <brson> i don't see a try_recv in extra::sync
[01:42:26] <brson> oh there are recvs
[01:42:29] <acrichto> if you're looking at master you'll see peek()
[01:42:42] <brson> yeah
[01:43:00] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[01:43:08] <acrichto> the alternative is writing a real mutex
[01:43:19] <acrichto> which could just be a spin loop for now
[01:43:35] <cmr> please don't write a crappy custom mutex ;(
[01:43:37] <acrichto> let ticket = xadd(&tickets, 1); while ticket != cur_ticket { yield() }
[01:44:01] <cmr> I haven't been following; why are native locks bad news?
[01:44:10] <acrichto> you can't use a native lock on a green thread
[01:44:11] <brson> we have to have custom mutexes to work with green threads
[01:44:16] <cmr> ah
[01:44:21] <brson> but that *is* what sync::Mutex is
[01:44:54] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[01:46:43] <brson> acrichto: is it only WaitQueue that is infected by this problem?
[01:46:53] <brson> maybe it can be reimplemented differently?
[01:47:11] <acrichto> brson: kinda, it's Sem + WaitQueue, Sem grabs the native lock and WaitQueue does the channel business
[01:47:38] <acrichto> but other things like CondVar also rely on the Exclusive being available
[01:47:50] <acrichto> and also do channel business maybe
[01:48:18] <acrichto> other than that though, we're good!
[01:48:35] <acrichto> except for the fact that everything else is built on those primtivies
[01:49:24] <brson> lol
[01:51:00] <acrichto> brson: I suppose that this brings up the part where I was saddened to realize that we no longer have the assertion that a green task isn't context switching while holding a native mutex
[01:51:47] <brson> acrichto: why did we lose that assertion?
[01:51:52] <brson> because of unkillable?
[01:51:55] <acrichto> std knows nothing about green tasks
[01:52:02] <acrichto> and Exclusive is in std
[01:52:51] <cmr> https://gist.github.com/cmr/ab7778b23f25aa59fdd2
[01:52:53] <cmr> Raaaage
[01:52:55] <cmr> I thought that was fixed
[01:55:01] <brson> cmr: that would be awesome if it was fixed!
[01:55:25] <brson> acrichto: how did Exlusive figure out they were being held through a context switch anyway?
[01:55:39] <acrichto> brson: you mean how did I find the bug right now?
[01:55:47] <acrichto> or how it used to worK?
[01:55:49] <cmr> brson: I'm fixing it first thing tomorrow :|
[01:55:51] <brson> how it used to
[01:55:53] <cmr> this is the worst
[01:56:02] <brson> cmr: it's pretty hard to fix afaik
[01:56:19] <acrichto> brson: there used to be a function std::unstable::sync::atomic() which returned an RAII guard that bumped a count in the local task and the task asserted this count was 0 on a context switch
[01:56:30] <brson> ah
[01:56:40] <acrichto> so we could still have that
[01:56:47] <acrichto> and libgreen would be the only consumer of the count
[01:57:07] *** Quits: bytewise (bytewise@moz-B3FA4F1E.adsl.alicedsl.de) (Quit: Leaving)
[01:57:33] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:58:40] <acrichto> brson: btw I also enjoyed your exclamation at the amount of makefile stuff necessary to build two libraries
[01:58:43] <acrichto> it is a little sad :(
[01:58:59] <acrichto> if you don't look too closely everything makes sense
[01:59:14] <cmr> makefile madness is traditionally why I've shied away from some things.
[01:59:57] <acrichto> it honestly does make sense at a high level
[02:00:03] <acrichto> each step just looks terrifying
[02:00:05] <brson> acrichto: when I saw those two new spats of macros and symbols you added to build libnative/green i thought 'maybe we need to abstract this boilerplate behind *another* macro'
[02:00:08] <brson> *slats
[02:00:12] <brson> *splats
[02:00:16] <acrichto> lol
[02:00:28] <acrichto> but seriuosly
[02:01:08] <acrichto> brson: we honestly could make our own mutexes
[02:01:35] <acrichto> brson: not built on anything but std::sync::atomics and task::deschedule
[02:01:57] <brson> acrichto: to replace extra::sync::Mutex hopefully?
[02:01:59] <acrichto> like sometimes that is actually the right primitive
[02:02:02] <acrichto> not necessarily
[02:02:09] <acrichto> this "tiny mutex" would not block
[02:02:12] <acrichto> sync::MUtex would block
[02:02:26] <brson> what would it do instead?
[02:02:33] <acrichto> while !lock_held { deschedule() }
[02:03:01] <acrichto> these are genuinely small windows for the mutex
[02:03:07] <acrichto> so not descheduling may not be the worse thing
[02:03:15] <cmr> acrichto: when during the build do we know what we're going to call the output file in rustc?
[02:03:17] <acrichto> other contexts really *do* need descheduling
[02:03:30] <acrichto> cmr: phase 6
[02:03:34] <cmr> wee
[02:03:39] <acrichto> cmr: but the logic could be pretty trivially moved forward
[02:03:52] <acrichto> it has no dependencies as far as I know except the crate hash
[02:03:56] <brson> acrichto: so this would be a mutex to replace the Exclusive used by Sem and avoid the deferred sends/recvs?
[02:04:00] <acrichto> which I guess is not totally trivial to mvoe forward
[02:04:07] <acrichto> brson: yes
[02:04:10] <cmr> well crate hash is just pkgid now right?
[02:04:17] <cmr> (well, crate_id on this branch...)
[02:04:19] <acrichto> cmr: yes
[02:04:36] <acrichto> brson: on a 1:1 context this would just be threads spinning in pthread_yield()
[02:05:46] <brson> acrichto: we try not to spin because it makes valgrind runtime very long. i'm not sure how valgrind will feel about this style of spinning.
[02:05:59] <acrichto> hm, I would presume not well
[02:06:11] <acrichto> or maybe not
[02:06:15] <acrichto> depends on how it handles pthread_yield
[02:06:32] <acrichto> if we yield to a green scheduler then it kinda just matters if the owning task is on another scheduler or in the queue
[02:09:17] <acrichto> brson: I suppose I'm a little unsure on how this does in the real world, I was taught that this is the way to do things
[02:09:34] <acrichto> brson: I always figured you have your "non-blocking" mutexes, which you use to build blocking mutexes and cvars and things like that
[02:09:48] <acrichto> but this is all from academic experience, not real-world experience
[02:11:06] <brson> acrichto: can we be smarter than spinning and block the task until the mutex is released?
[02:11:25] <acrichto> we should be able to
[02:11:37] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[02:11:37] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/oiwkjw
[02:11:37] <ghrust> 13rust/06auto 141890290 15klutzy: llvm: Disable pthread on mingw...
[02:11:37] <ghrust> 13rust/06auto 14b0a9937 15klutzy: mklldeps.py: Write to file instead of print...
[02:11:37] <ghrust> 13rust/06auto 14bf2a120 15bors: auto merge of #11013 : klutzy/rust/win-no-pthread, r=alexcrichton...
[02:11:39] <acrichto> It's questionable whether it should use channels though
[02:11:39] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[02:11:47] <acrichto> because allocating a channel is pretty heavyweight right now
[02:11:55] <acrichto> and even allocating at all is pretty heavyweight
[02:12:18] <acrichto> brson: oh hm this is just the mpsc queue problme
[02:12:29] <acrichto> we already have an algorithm for an intrusive mpsc queue
[02:12:35] <acrichto> so we could just use that
[02:12:36] <cmr> Hm. Could the scheduler have a "dependency"/wakeup interface? You tell it that you want to sleep on something, and it will wake you up when that something happens. It would detect deadlock, too.
[02:12:46] <acrichto> we just have that one problem of the inconsistent queue
[02:13:11] <brson> acrichto: so we still have to spin briefly in that one case :)
[02:13:13] <acrichto> cmr: sadly the more magical an interface is the more difficult it is to implement
[02:13:20] <cmr> acrichto: well yeah :p
[02:13:22] <acrichto> brson: but honestly that may be the way to go
[02:13:26] <acrichto> and it would be pretty fast
[02:13:34] <acrichto> and I *think* it would wokr?
[02:13:47] <brson> acrichto: mutex = mpsc_queue *sounds* like a pretty beefy mutex
[02:14:02] <acrichto> brson: well, Mutex right now is super-beefy
[02:14:04] <brson> but yeah maybe that's the right aproach for now at least
[02:14:23] <acrichto> in theory we want sync::Mutex to be "as fast as" pthread_mutex
[02:14:34] <brson> yep
[02:14:43] <acrichto> if we allocate, I think we've already lost
[02:15:02] <brson> :-/ how can we *not* allocate with our memory model? use globals?
[02:15:12] <acrichto> stack allocations
[02:15:13] <brson> i guess we could have fork/join
[02:15:14] <brson> yeah
[02:15:21] <acrichto> you know that you only need it to be valid for the lifetime of the call to lock()
[02:15:22] <brson> block the parent until all the children exit
[02:15:50] <brson> i don't see that. other tasks will have pointers to your stack
[02:16:03] <acrichto> but you're blocked if they do
[02:16:26] <acrichto> lock() == deschedule(|task| { enqueue(task) })
[02:16:30] <acrichto> unlock() == dequeue().wake()
[02:16:42] <acrichto> all those nodes can be stored on the stack
[02:17:19] <acrichto> not convinced this would actually work though
[02:17:33] <acrichto> how do I atomically check if it's unlocked and if not enqueue myself
[02:19:23] <acrichto> brson: ok how about this
[02:19:44] <acrichto> add back try_send_deferred, comment that it's the worst thing in the world to use, and then work on implementing an actual Mutex later
[02:20:16] <acrichto> I believe that there is a promising path forward reimplementing Mutex on top of the deschduling/rescheduling primitives that channels are using
[02:20:38] <brson> acrichto: also add a try_recv that doesn't deschedule?
[02:20:44] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[02:20:51] <acrichto> brson: ah yes, indeed, and I'll have to ignore that test in the scheduler
[02:20:55] <jack> acrichto: is there a replacement for GenericChan or should I just use Chan?
[02:21:02] <acrichto> jack: just Chan
[02:21:10] <brson> acrichto: sounds good. get it working first, yes
[02:21:34] <brson> acrichto: seems like we're going to have to seriously revisit extra::sync anyway because the perf isn't as good as we need
[02:21:57] <acrichto> brson: yeah, although if Mutex ~=~ pthread_mutex then I think we're good to go
[02:22:08] <jack> acrichto: are the traits just gone?
[02:22:11] <acrichto> jack: yep
[02:22:14] <jack> GenericChan and GenericSmartChan
[02:22:52] <brson> i'm going to get some dinner so i can get back before the air mozilla broadcast
[02:22:58] <acrichto> brson: I am 75% sure that I can write blocking mutexes with a concurrent queue
[02:23:04] <acrichto> but yes, I should also go downstairs lol
[02:23:29] <acrichto> brb
[02:24:13] <jack> oh, it's going to be live?
[02:24:53] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[02:25:16] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Ping timeout)
[02:26:34] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[02:26:34] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14bf2a120 to 14ac137f6: 02http://git.io/N3iJvQ
[02:26:34] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[02:26:37] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[02:26:37] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/FpfAog
[02:26:37] <ghrust> 13rust/06auto 141890290 15klutzy: llvm: Disable pthread on mingw...
[02:26:37] <ghrust> 13rust/06auto 14b0a9937 15klutzy: mklldeps.py: Write to file instead of print...
[02:26:38] <ghrust> 13rust/06auto 14429741c 15bors: auto merge of #11013 : klutzy/rust/win-no-pthread, r=alexcrichton...
[02:26:40] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[02:28:22] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[02:28:22] *** ChanServ sets mode: +o tjc
[02:29:10] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[02:29:10] *** ChanServ sets mode: +ao pcwalton pcwalton
[02:31:39] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[02:37:54] <jack> error: instantiating a type parameter with an incompatible type `font::Font`, which does not fulfill `Freeze`
[02:38:24] <jack> I guess Font fit in an RcMut but not in an Rc<RefCell> :(
[02:45:02] <jack> Cell came back??
[02:45:37] <jack> I'm so confused.
[02:51:40] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[02:51:40] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14429741c to 14ac137f6: 02http://git.io/N3iJvQ
[02:51:40] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[02:51:43] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[02:51:43] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/dIzqVA
[02:51:43] <ghrust> 13rust/06auto 14ed5bb52 15Alex Crichton: rustc: Optimize reading metadata by 4x...
[02:51:43] <ghrust> 13rust/06auto 14aba3480 15bors: auto merge of #11017 : alexcrichton/rust/faster-read, r=thestinger...
[02:51:43] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[02:56:08] <dbaupp> jack: a different Cell
[02:56:21] <jack> What does this new one do?
[02:58:01] * dbaupp doesn't know
[03:00:39] <jack> I wish rustc would tell me which field isn't Freeze.
[03:00:44] <aatch> jack, it only accepts Pod
[03:00:59] *** Joins: gwty (gwtypc@83134DDE.4C0956D8.7CD022A3.IP)
[03:01:54] <jack> are raw pointers Freeze?
[03:01:55] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[03:02:19] <aatch> jack, yes.
[03:02:36] <cmr> rusti: fn assert_freeze<T: Freeze>(_x: &T) { } assert_freeze(&5i as *int)
[03:02:39] -rusti- pastebinned 7 lines of output: http://ix.io/9qc
[03:02:40] <jack> Is RefCell freeze?
[03:02:47] <cmr> jack: no
[03:02:59] <jack> Did it used to be? This code compiled with Rust from friday.
[03:03:06] <cmr> RefCell exists to escape inherited mutability, Freeze is opting into inherited mutability.
[03:03:06] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[03:03:07] *** ChanServ sets mode: +o tjc
[03:03:35] <jack> The replacement for RcMut was Rc<RefCell>
[03:03:40] <jack> but Rc<RefCell> can't exist now.
[03:04:03] <cmr> wait why?
[03:04:21] <jack> Rc::from_mut actually takes a RefCell so it must be something inside that isn't Freeze.
[03:05:01] <aatch> jack, there's a specific implementation of Rc for Rc<RefCell<T>>
[03:05:18] <aatch> `impl<T: Freeze> Rc<RefCell<T>>`
[03:05:42] <aatch> You need to call Rc::from_mut()
[03:05:49] <jack> are SharedChan's no longer Freeze?
[03:06:35] <Eridius> isn't Option<fn> the right way to have a nullable function?
[03:07:22] <aatch> Hmm, SharedChan should be Freeze
[03:07:22] <jack> Option<extern fn foo(...) -> ...> yes
[03:07:37] <Eridius> when I try and compile rust-lua on my 32-bit linux machine, declaring a function as returning Option<extern "C" unsafe fn(..) -> c_int> uses struct-returning calling conventions
[03:08:07] <jack> Eridius: extern fns are always unsafe. you shouldn't need that unsafe there.
[03:08:08] <klutzy> acrichto: is the llvm-rebuild-failure problem reported at issue tracker? I'm going to file one if not
[03:08:09] <cmr> Eridius: what is its size_of?
[03:08:42] <Eridius> jack: extern-linked functions, yes. Functions I've implemented in Rust aren't unsafe by virtue of using C calling conventions
[03:08:44] <cmr> jack: that's only fns declared in an extern block I thought?
[03:08:57] <jack> rusti: fn assert_freeze<T: Freeze>(_x: &T) { } let (port, chan) = SharedChan::new(); assert_freeze(chan);
[03:08:59] -rusti- pastebinned 13 lines of output: http://ix.io/9qd
[03:09:14] <Eridius> cmr: what, the Option? I haven't checked. I just discovered via debugging that my crash is because a stack address is being provided as the first argument to the C function, and the real arguments are pushed back by 1
[03:09:30] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[03:09:31] <cmr> Eridius: yeah
[03:09:41] <cmr> it might not be getting the nullptr optimization.
[03:09:59] <jack> rusti: use std::comm::SharedChan; fn assert_freeze<T: Freeze>(_x: &T) { } let (port, chan) = SharedChan::new(); assert_freeze(chan);
[03:10:01] -rusti- pastebinned 13 lines of output: http://ix.io/9qe
[03:10:12] <aatch> Dammit, apparent *mut counts as 'ReachesMutable' which makes is non-freeze
[03:10:30] <jack> I guess rusti doens't have the new rust
[03:10:37] <aatch> jack, it doesn't.
[03:11:03] <aatch> libuv doesn't weird things with stdin/out, causes it to dead-lock
[03:11:07] <aatch> does*
[03:11:59] <Eridius> cmr: given that extern fn is defined as non-nullable and Option<extern fn> as nullable fns, I would have expected Rust to _guarantee_ the null pointer optimization here
[03:12:10] <Eridius> because without it, it's impossible to declare a C function that returns a nullable fn pointer
[03:12:24] <cmr> Eridius: well yes, but there could be a bug.
[03:13:25] <aatch> Eridius, you could just write a wrapper function.
[03:13:33] <Eridius> cmr: mm nope, Option<extern fn> has a size of 4
[03:13:35] <Eridius> just like extern fn
[03:13:58] <Eridius> aatch: and, what, declare the "real" function to return *libc::c_void and cast? That's pretty nasty
[03:14:05] <cmr> Eridius: and it's not immediate? that's no good :(
[03:14:08] <jack> freeze.rs:10:4: 10:17 error: instantiating a type parameter with an incompatible type `std::comm::SharedChan<u64>`, which does not fulfill `Freeze`
[03:14:16] <Eridius> cmr: yeah, I guess it's deciding that it counts a struct anyway
[03:14:19] <jack> oh dear
[03:14:29] <aatch> Eridius, it's not *that* bad. Though it should be returning as an immediate.
[03:15:17] <aatch> jack, yeah, SharedChan isn't Freeze because UnsafeArc isn't Freeze because *mut isn't Freeze (for some reason).
[03:15:29] <aatch> pcwalton, ping
[03:17:08] <jack> aatch: they are all at the meetup
[03:17:14] <aatch> Bah.
[03:17:26] <jack> we can watch them in about 45 minutes :)
[03:17:35] <cmr> of course *mut isn't freeze, it's explicitly a pointer to mutable data!
[03:17:57] *** Joins: lpy (lpy@7360AA58.F09091A8.1348A864.IP)
[03:18:00] <jack> Does this mean that SharedChan is also not Send?
[03:18:20] <jack> I suppose that's fine because the ownership transfers.
[03:18:35] <aatch> jack, it's still Send
[03:19:12] <jack> I suppose I can remove profiling from the font code.
[03:20:03] <aatch> Mutability doesn't change Send, only Managed changes it.
[03:20:14] <dbaupp> and &
[03:20:21] <cmr> and #[no_send]
[03:20:37] <aatch> oh, missed that one, and the no_send is kinda obvious
[03:20:57] <aatch> I'm doing bitwise and by sight here.
[03:21:18] <cmr> oh, of those nasty bit tables?
[03:21:43] <aatch> cmr, the TypeContents one, yeah.
[03:21:53] <jack> turns out it wasn't used anyway.
[03:22:02] <cmr> jack: heh
[03:23:25] <jack> box being a keyword kind of sucks for a browser.
[03:23:38] <cmr> yeah :(
[03:23:38] <aatch> jack, ouch.
[03:23:57] <jack> you would think that would have gotten mentioned at the meeting :)
[03:24:03] <aatch> Though `type` being a keyword sucks for a compiler, so now we hit both major rust projects.
[03:24:03] <jack> like by me perhaps
[03:24:09] <cmr> heh
[03:24:31] <cmr> aatch: all of the keywords being keywords bit me on rustdoc too.
[03:25:53] <jack> cmr: really ouch
[03:25:54] <jack> :)
[03:27:52] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[03:28:32] <jack> Was ChanOne a channel that could only be sent on a single time?
[03:28:47] <aatch> jack, I think so. I also think it's being removed.
[03:28:57] <jack> s/being/has been/
[03:28:58] <cmr> has been
[03:29:05] * aatch is catching up
[03:29:14] <cmr> aatch: it's nice to have you back :)
[03:29:19] <cmr> now oepn some PRs you bum!
[03:29:40] <cmr> you're falling short of your "be in every TWiR" goal.
[03:29:41] <aatch> cmr, lol. I might. I have two weeks off starting next week.
[03:29:51] <aatch> cmr, I know, it wasn't realistic anyway :D
[03:29:55] <aatch> I have bills to pay!
[03:31:21] <Eridius> I've filed this issue as https://github.com/mozilla/rust/issues/11040
[03:32:14] <aatch> Eridius, hmm, definately seems like a bug in the ABI handling.
[03:34:05] <aatch> Eridius, yep, found the problem.
[03:35:42] <aatch> According to the cabi_x86.rs implementation, structs are only passed back as immediates if they are < 8 and only on Windows or Mac
[03:36:02] <cmr> wait what
[03:36:13] <Eridius> aatch: wait it's seriously platform-dependent?
[03:36:17] <cmr> why would pointer-sized things get passed as non-immediates!?
[03:36:36] <cmr> I thought sysv was saner than that
[03:36:36] <aatch> This is in the code: http://www.angelcode.com/dev/callconv/callconv.html
[03:36:42] * aatch is reading it now
[03:37:21] <aatch> Yep, it's gcc/linux behaviour.
[03:37:27] <Eridius> :/
[03:38:16] <aatch> Unfortunately it's not easy to get the actual representation from there, since it just takes the LLVM return type.
[03:38:20] <Eridius> hrm, is there a way to declare an extern C function but have it link to a different name?
[03:38:48] <cmr> Eridius: #[export="foobar"] I think?
[03:38:50] * Eridius is trying to rename to_cfunction() (the fn that started all this) to to_cfunction_(), and would rather not introduce a nested module just to hide it
[03:38:54] <Eridius> cmr: I'll try that
[03:38:57] <cmr> it's something like that...
[03:38:58] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[03:39:01] <cmr> it might be link_name
[03:39:21] <cmr> r? https://github.com/mozilla/rust/pull/11041
[03:39:23] <cmr> jack: ^
[03:39:38] <Eridius> cmr: it's not #[export]
[03:39:39] *** Quits: gwty (gwtypc@83134DDE.4C0956D8.7CD022A3.IP) (Ping timeout)
[03:39:55] <Eridius> cmr: it was #[link_name]
[03:39:57] <Eridius> thanks
[03:40:03] <cmr> woo memory!
[03:40:56] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Quit: leaving)
[03:41:13] *** Joins: brson (brson@981AA104.E81F12CD.76F66111.IP)
[03:41:13] *** ChanServ sets mode: +qo brson brson
[03:42:11] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[03:42:11] *** ChanServ sets mode: +o tjc
[03:42:18] <cmr> brson: https://github.com/mozilla/rust/pull/11041
[03:45:43] <brson> cmr: you're awesome
[03:46:13] <Eridius> how do I declare a #[cfg] attr that means "not macos and not windows"?
[03:46:15] <cmr> sorry it took so long, had to work :p
[03:46:33] <aatch> Hmm, adt.rs could use a pointer type for NullablePointer instead of a Struct
[03:49:08] <aatch> brson, any reason that I don't know of for using a struct for nullable pointers?
[03:49:19] <sanxiyn> After reading the meeting minutes
[03:49:32] <jack> we need to remember to make pkgid illegal post-snapshot too.
[03:49:41] <sanxiyn> Dear Princess Celestia,
[03:49:52] <sanxiyn> Today I learned something amazing! Everycallee everywhere has a special magical connection with her callers, maybe even before she's called by them. If you're feeling you're doing unnecessary duplicate work, just inline. Who knows, maybe you and your caller are all doing the same work and magical LLVM fairy can eliminate them.
[03:50:06] <cmr> jack: I added NOTE: in the approprriate places, I thought
[03:50:07] <dbaupp> hahaha
[03:50:29] <jack> you added a note to remoe pkgid, but that won't make the compiler fail when it sees it.
[03:50:30] <dbaupp> Eridius: #[cfg(not(target_os="macos"), not(windows))]
[03:50:35] <jack> thought at least the lint will yell
[03:50:51] <cmr> wait, *should* it be illegal beyond the lint?
[03:51:15] <brson> aatch: yes. ffi on some platforms treats structs differently from pointers, which is a point against using structs for pointers
[03:51:36] <sanxiyn> cmr: Don't we do something more than "unknown attribute" for, say, #[auto_encode]?
[03:51:45] <sanxiyn> Like pointing out what you should do instead
[03:51:46] *** Quits: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net) (Connection reset by peer)
[03:51:46] <cmr> sanxiyn: I didn't think so
[03:51:57] <cmr> it maybe used to have an obsolete checker.
[03:52:08] <aatch> brson, actually, thats the cause of a bug, https://github.com/mozilla/rust/issues/11040
[03:52:12] <cmr> and, on second thought, I should probably add one.
[03:52:18] <cmr> but, it's sleep time.
[03:52:20] <cmr> http://rustlog.octayn.net/post/70358042088/17-dec-2013-rustdoc-pkgid
[03:52:24] * cmr -> bed
[03:52:44] <brson> aatch: ugh
[03:53:13] <aatch> brson, could be fixed by making the NullablePointer case return, well, a pointer.
[03:54:11] <aatch> I figure that this way is the path of least surprise (compared the current way)
[03:54:38] <brson> aatch: yeah, probably
[03:54:52] *** Joins: kimundij (kimundi@moz-D3B44B8E.dip0.t-ipconnect.de)
[03:55:21] *** kimundij is now known as kimundi
[03:56:20] *** Quits: zz_kimundi (kimundi@moz-9170C40C.dip0.t-ipconnect.de) (Ping timeout)
[03:56:24] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[03:57:57] <aatch> I'm still philisophically opposed to relying on it, but it seems like the better option anyway.
[03:58:05] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[03:58:18] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[03:58:18] *** ChanServ sets mode: +ao pcwalton pcwalton
[03:58:19] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[03:58:19] *** ChanServ sets mode: +o tjc
[03:58:43] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[03:58:57] <jack> we're live: https://air.mozilla.org/rust-meetup-december-2013/
[03:59:08] <jack> well, almost :)
[03:59:53] <Eridius> jack: sweet
[03:59:59] * Eridius wishes he wasn't sick or he would be attending
[04:00:02] *** Parts: sanxiyn (tinuviel@F32F8A59.7DD15B19.A3B1F2EE.IP) (Bye)
[04:00:04] <dbaupp> jack: live!
[04:00:15] * dbaupp feels like he's actually there!
[04:02:48] *** Joins: ktt3ja (ktt3ja@moz-54586A12.washdc.fios.verizon.net)
[04:05:44] <jack> acrichto: peek() is gone, but try_recv will pull something off the port if there is data right?
[04:06:42] * jack is going to have to jump through some hoops here where peek was used :(
[04:09:22] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[04:14:36] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[04:16:07] *** Joins: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net)
[04:18:03] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[04:18:03] *** ChanServ sets mode: +o tjc
[04:19:20] <aatch> Ugh, NullablePointer is just on the wrong side of complexity to make this easy.
[04:20:19] <aatch> Mostly because it handles this case: `enum Foo<T> { A, Bar(~T,uint) }` as well
[04:21:20] <aatch> (uses the `~T` in Bar to distinguish them, which is why it uses struct for the NullablePointer opt)
[04:28:59] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: My MacBook Pro has gone to sleep. ZZZzzzâ€¦)
[04:42:16] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[04:42:16] *** ChanServ sets mode: +o tjc
[04:56:26] *** Quits: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca) (Quit: canhtak)
[05:02:26] *** Joins: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca)
[05:06:32] *** Joins: jdm (jdm@moz-AC9499B2.cable.teksavvy.com)
[05:16:36] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[05:16:36] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14aba3480 to 14ac137f6: 02http://git.io/N3iJvQ
[05:16:36] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[05:16:37] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[05:16:37] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/gpo5SA
[05:16:37] <ghrust> 13rust/06auto 14758f6e6 15Steven Fackler: Fix rustdoc output of enums with private variants...
[05:16:37] <ghrust> 13rust/06auto 149d5c048 15bors: auto merge of #11018 : sfackler/rust/variant-strip, r=alexcrichton...
[05:16:37] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[05:17:37] *** Joins: dalaing (dalaing@moz-5057F137.dyn.iinet.net.au)
[05:18:46] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[05:31:49] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[05:31:49] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/wmvzmg
[05:31:49] <ghrust> 13rust/06auto 14eabf11b 15Alex Crichton: Don't allow impls to force public types...
[05:31:49] <ghrust> 13rust/06auto 1409b8406 15bors: auto merge of #11019 : alexcrichton/rust/issue-10545, r=pcwalton...
[05:31:50] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[05:31:51] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[05:31:51] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 149d5c048 to 14ac137f6: 02http://git.io/N3iJvQ
[05:31:51] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[05:44:51] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[05:46:44] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[05:51:43] *** Joins: gwty (gwtypc@932691B4.AE9BA241.D8537A8F.IP)
[05:54:53] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[05:54:53] *** ChanServ sets mode: +ao dherman dherman
[05:56:52] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[05:57:29] <strcat> acrichto: what does recv do if the channel is empty in the 1:1 case?
[05:58:43] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[06:02:57] *** Quits: brson (brson@981AA104.E81F12CD.76F66111.IP) (Quit: leaving)
[06:12:35] *** Quits: dalaing (dalaing@moz-5057F137.dyn.iinet.net.au) (Quit: Leaving.)
[06:13:07] *** Quits: gwty (gwtypc@932691B4.AE9BA241.D8537A8F.IP) (Ping timeout)
[06:40:49] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Quit: Textual IRC Client: www.textualapp.com)
[06:42:06] *** Quits: aatch (James@moz-B437F499.pocketrent.com) (Quit: Leaving)
[06:55:37] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[06:59:47] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: lkuper)
[07:06:37] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[07:06:37] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/wmvzmg
[07:06:37] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[07:08:35] *** Quits: lpy (lpy@7360AA58.F09091A8.1348A864.IP) (Ping timeout)
[07:11:34] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[07:11:35] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/6Fq-Rw
[07:11:35] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[07:11:37] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[07:11:37] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/LsQ4bA
[07:11:37] <ghrust> 13rust/06auto 1486a10c4 15Huon Wilson: rustc: Allow `return` to return from a closure....
[07:11:37] <ghrust> 13rust/06auto 141d1f26d 15bors: auto merge of #11024 : huonw/rust/return-from-closures, r=alexcrichton...
[07:11:37] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[07:12:08] <acrichto> strcat: it blocks on a cvar
[07:12:59] <strcat> acrichto: so every push signals the cond var?
[07:13:23] <acrichto> only pushes which wake up a task
[07:13:32] <strcat> I mean for 1:1 though
[07:13:34] <acrichto> and it's a cvar per-task, not a cvar per-channel
[07:13:50] <acrichto> if a push doesn't wake up a task there's no cvar to signa
[07:14:16] <strcat> ok so lets say you have 1 thread blocked, and you push to it - what does it do?
[07:14:30] <acrichto> pulls the task out and signals the cvar
[07:15:07] <strcat> and what stops another thread from grabbing it first?
[07:15:21] <acrichto> I'd recommend reading the code for finding races
[07:15:31] <strcat> I don't mean a race though
[07:15:35] <strcat> I mean losing priorities
[07:16:00] <strcat> i.e. the blocked thread may be low priority, and a new thread may be high priority, or the reverse
[07:16:08] <strcat> anyway doesn't matter, ignore me
[07:16:10] <acrichto> what do you mean by grabbing a cvar?
[07:17:05] <strcat> acrichto: grabbing the message
[07:17:18] <acrichto> there's only ever one receiver
[07:17:25] <strcat> oh, right
[07:17:39] <acrichto> we may want to change that one day though
[07:17:53] <strcat> acrichto: so then, change everything I said to apply to SharedChan (it still exists, doesn't it?)
[07:18:05] <acrichto> still only one receiver
[07:18:08] <acrichto> just many senders
[07:18:13] <strcat> hm
[07:18:20] <strcat> so we don't have a multiple consumer channel?
[07:18:22] <acrichto> only one sender will receive the task to wake up
[07:18:24] <acrichto> right now, no
[07:18:33] <strcat> oh so it's not an issue
[07:18:37] <strcat> it makes sense to me now
[07:19:00] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: Leaving)
[07:19:01] <acrichto> I talked to a couple of people tonight who were sad about two things
[07:19:04] <strcat> the windows cond var API really sucks
[07:19:07] <acrichto> 1. No multiple receiver channel
[07:19:11] <acrichto> 2. No blocking send channel
[07:19:51] <strcat> I can't believe how stupid it is http://msdn.microsoft.com/en-us/library/windows/desktop/ms682052(v=vs.85).aspx
[07:19:54] * strcat sighs
[07:19:57] <strcat> so...
[07:20:05] <strcat> the POSIX timedwait takes an absolute time
[07:20:16] <acrichto> what's weird about their api?
[07:20:23] <strcat> so if you get a wakeup and the condition isn't true, you can call timedwait again
[07:20:27] <strcat> with your same absolute time
[07:20:33] <strcat> and you can use CLOCK_MONOTONIC
[07:20:58] <strcat> acrichto: https://github.com/thestinger/rust-core/blob/master/core/concurrent.rs#L76 well, a simple pop_timeout for example
[07:21:00] <acrichto> oh I guess I never looked too closely to the timeout portions of a cvar
[07:21:09] <strcat> if you wake up and the condition isn't true, you need to wait until that time again
[07:21:17] <strcat> anyway the windows API is ridiculous
[07:21:20] <strcat> it takes a RELATIVE time
[07:21:25] <strcat> so if you wake up too early, you are screwed
[07:21:32] <strcat> you don't know how long it waited already
[07:21:48] <strcat> so you can fail (but it might be way too early!) or you can try again for the same length of time
[07:22:05] <strcat> I guess in reality what you have to do is add a bunch of time checking calls
[07:22:29] <strcat> anyway just making me sad
[07:22:33] <strcat> and their time API is making me sad
[07:24:38] <strcat> and I'm sure on OS X it all has to be done differently
[07:26:21] <strcat> http://stackoverflow.com/questions/7827062/is-there-a-windows-equivalent-of-nanosleep ;\
[07:26:54] <strcat> although I don't think that's really the question
[07:27:55] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[07:35:06] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[07:43:58] *** flaper87|afk is now known as flaper87
[07:46:07] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[07:47:54] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[07:51:35] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[07:51:35] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 141d1f26d to 1409b8406: 02http://git.io/N3iJvQ
[07:51:35] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[07:51:39] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[07:51:39] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/LZ5ZdA
[07:51:39] <ghrust> 13rust/06auto 14758f6e6 15Steven Fackler: Fix rustdoc output of enums with private variants...
[07:51:39] <ghrust> 13rust/06auto 141fee5cd 15bors: auto merge of #11018 : sfackler/rust/variant-strip, r=alexcrichton...
[07:51:39] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[07:59:43] <strcat> acrichto: lol, MSVC++ implements this stuff itself for C++11 because the windows API is so bad...
[08:05:18] *** Quits: jdm (jdm@moz-AC9499B2.cable.teksavvy.com) (Ping timeout)
[08:14:33] *** flaper87 is now known as flaper87|afk
[08:16:42] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Client exited)
[08:31:09] *** flaper87|afk is now known as flaper87
[08:31:18] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:31:22] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[08:31:22] <eddyb> cmr: any chance you could rerun the recent builds without -Z lto? irsy is unusable random noise atm
[08:31:44] <eddyb> cmr: though I have a sneaking suspicion that LTO enables a special kind of butterfly effect
[08:31:46] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Ping timeout)
[08:33:30] <eddyb> cmr: you see, I have this pixel format converter function in my PNG decoder. when I had enough match cases (using stack closure helpers), I would get a drop of 2x-3x in performance
[08:33:42] <eddyb> I think there's a critical mass that prevents optimizations
[08:34:38] <eddyb> cmr: thus, small changes in std/extra/syntax can end up *deoptimizing* random parts of stage1 rustc, producing noise when compiling stage2 rustc
[08:35:02] <eddyb> acrichto: you might want to take a look at this too ^^
[08:35:50] <eddyb> strcat would tell me the name of the LLVM pass which causes this, or some crazy insider info, but he's not here :P
[08:37:47] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:40:02] <dbaupp> eddyb: I thought it was already *not* running with lto.
[08:41:16] <eddyb> dbaupp: no, the 1.6GB in the peak at the end is LTO. hmm. no, it can't be just static linking, that's not this expensive
[08:42:53] <eddyb> strcat: you managed to leave during my theory exposure on the trans+LLVM butterfly effect - https://botbot.me/mozilla/rust-internals/msg/8935547/
[08:43:36] <dbaupp> eddyb: we've always had a spike like that, even before LTO landed
[08:43:51] <eddyb> but it's so much worse right now
[08:44:00] <eddyb> are we looking at the same graphs?
[08:44:02] <eddyb> it exploded
[08:44:18] <dbaupp> I think that's the change that split LLVM into several .a files that were statically linked
[08:44:27] <dbaupp> (several == 40 or something.)
[08:44:53] <eddyb> ok, now I feel dumb. though it's the first time I hear about it
[08:47:25] <eddyb> dbaupp: I don't think cmr had time to redo all the builds with ramdisk, which should help filter out IO noise (loading 40 files isn't something you can ignore)
[08:48:22] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[08:56:10] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[08:56:22] <acrichto> eddyb: yeah I don't think that the graphs are showing LTO, as dbaupp mentioned I think it's just all the llvm .a files
[08:57:15] <eddyb> that's just nasty :S
[08:57:37] <eddyb> it's impossible to measure impact of anything right now
[08:59:11] <acrichto> it should probably get built without #[crate_type = "rlib"]
[08:59:16] <acrichto> or with -c
[09:00:11] *** Quits: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca) (Quit: canhtak)
[09:00:40] <eddyb> acrichto: right, that would remove the linker spike that I thought was LTO
[09:19:49] *** Joins: mib_qkkqe6 (Mibbit@moz-B6D2878B.cable.telstraclear.net)
[09:20:04] *** Quits: mib_qkkqe6 (Mibbit@moz-B6D2878B.cable.telstraclear.net) (Quit: http://www.mibbit.com ajax IRC Client)
[09:23:15] *** Quits: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP) (Ping timeout)
[09:27:13] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[09:27:57] *** Quits: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr) (Quit: ZNC - http://znc.sourceforge.net)
[09:28:55] *** Quits: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net) (Ping timeout)
[09:31:50] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[09:31:50] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/LZ5ZdA
[09:31:50] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[09:36:21] *** Joins: fredy (fredy@moz-E7647C0E.vm.okeanos.grnet.gr)
[09:36:36] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[09:36:36] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/2OfaFQ
[09:36:36] <ghrust> 13rust/06auto 1488fc285 15Alex Crichton: Adding tests for closed issues...
[09:36:36] <ghrust> 13rust/06auto 14aa6aba3 15bors: auto merge of #11012 : alexcrichton/rust/needstest, r=alexcrichton...
[09:36:36] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[09:36:38] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[09:36:38] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/aS_SUg
[09:36:38] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[09:46:42] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[09:48:35] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[09:53:35] *** flaper87 is now known as flaper87|afk
[10:07:43] *** flaper87|afk is now known as flaper87
[10:14:31] *** Quits: Kxepal (Miranda@moz-F00F6502.pppoe.mtu-net.ru) (Ping timeout)
[10:16:59] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[10:18:01] *** Joins: Kxepal (Miranda@moz-28D48906.pppoe.mtu-net.ru)
[10:35:37] *** Quits: ktt3ja (ktt3ja@moz-54586A12.washdc.fios.verizon.net) (Quit: Leaving)
[10:36:42] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[10:36:42] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14aa6aba3 to 141fee5cd: 02http://git.io/N3iJvQ
[10:36:42] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[10:36:45] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[10:36:45] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/---mxw
[10:36:45] <ghrust> 13rust/06auto 1466f779c 15Huon Wilson: rustc: Allow `return` to return from a closure....
[10:36:45] <ghrust> 13rust/06auto 14f531210 15bors: auto merge of #11024 : huonw/rust/return-from-closures, r=alexcrichton...
[10:36:46] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[10:42:15] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[10:42:17] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[10:42:22] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: strcat)
[10:42:38] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[10:53:23] *** Joins: lpy (lpy@7360AA58.F09091A8.1348A864.IP)
[11:24:19] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: WeeChat 0.4.2)
[11:27:16] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[11:36:34] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[11:36:34] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14f531210 to 141fee5cd: 02http://git.io/N3iJvQ
[11:36:34] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[11:36:37] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[11:36:37] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/yIMVgA
[11:36:37] <ghrust> 13rust/06auto 144584acd 15Edward Z. Yang: s/Second borrow/Previous borrow/ in error messages....
[11:36:37] <ghrust> 13rust/06auto 14f43402f 15bors: auto merge of #11025 : ezyang/rust/reword-second-borrow, r=cmr...
[11:36:38] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[11:47:40] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[11:49:27] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[12:09:51] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[12:53:19] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[12:53:50] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[12:56:36] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[12:56:36] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/yIMVgA
[12:56:36] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[12:59:44] *** Joins: gwty (gwtypc@20398D5D.3DFBCA6.5785B5AF.IP)
[13:01:49] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[13:01:49] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/MEWHNA
[13:01:49] <ghrust> 13rust/06auto 14e2fa3c3 15Alex Crichton: Forbid multiple imports in use statements...
[13:01:49] <ghrust> 13rust/06auto 14c11f290 15Alex Crichton: Remove workarounds from issue #4404...
[13:01:49] <ghrust> 13rust/06auto 145cea7db 15bors: auto merge of #10915 : alexcrichton/rust/fixes, r=ILyoan...
[13:01:51] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[13:43:13] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[13:43:13] *** ChanServ sets mode: +o tjc
[13:48:41] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[13:50:26] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[13:51:03] *** Quits: lpy (lpy@7360AA58.F09091A8.1348A864.IP) (Ping timeout)
[13:51:03] *** Quits: gwty (gwtypc@20398D5D.3DFBCA6.5785B5AF.IP) (Ping timeout)
[13:54:10] *** Joins: lpy (lpy@7360AA58.F09091A8.1348A864.IP)
[14:02:19] *** Quits: lpy (lpy@7360AA58.F09091A8.1348A864.IP) (Ping timeout)
[14:11:16] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[14:12:38] *** Quits: veddan (viktor@moz-C79BC80B.csbnet.se) (Ping timeout)
[14:13:53] *** Joins: veddan (viktor@moz-C79BC80B.csbnet.se)
[14:20:01] *** Joins: gwty (gwtypc@20398D5D.3DFBCA6.5785B5AF.IP)
[14:21:35] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[14:21:35] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/MEWHNA
[14:21:35] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[14:23:01] *** Joins: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca)
[14:26:34] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[14:26:34] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/IyFVrw
[14:26:34] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[14:26:39] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[14:26:39] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/JIEkbg
[14:26:39] <ghrust> 13rust/06auto 146876916 15Huon Wilson: rustc: Allow `return` to return from a closure....
[14:26:39] <ghrust> 13rust/06auto 14c335734 15bors: auto merge of #11024 : huonw/rust/return-from-closures, r=alexcrichton...
[14:26:39] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[14:29:13] *** Quits: dbaupp (Thunderbir@moz-EB2EFE6F.lns20.syd6.internode.on.net) (Quit: dbaupp)
[14:37:32] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: rcirc on GNU Emacs 24.3.1)
[14:37:48] *** Joins: dbaupp (Thunderbir@moz-EB2EFE6F.lns20.syd6.internode.on.net)
[14:48:33] <cmr> eddyb: why do you think it's impossible to measure the impact of anything?
[14:48:43] <cmr> eddyb: linker memory usage isn't really interesting, just ignore that part of the graph?
[14:49:26] <eddyb> cmr: but it affects the main graph
[14:49:47] <cmr> So?
[14:50:16] <cmr> I'm not against doing it, just haven't gotten around to it, but I don't think it's as dire as you portray it.
[14:50:41] <eddyb> I can still find my 130MB PR... if it were last week, you couldn't tell
[14:51:11] <eddyb> ah, it's not urgent, just annoying
[14:51:14] <cmr> if you can make a list of the commits that you want me to redo that'd be super awesome.
[14:51:24] <cmr> (I'm doing it now)
[14:54:46] *** Quits: gwty (gwtypc@20398D5D.3DFBCA6.5785B5AF.IP) (Ping timeout)
[14:55:52] <cmr> eddyb: so the flags I give rustc are -L x86_64-unknown-linux-gnu/llvm/Release+Asserts/lib -Z time-passes --cfg stage2 -O --target=x86_64-unknown-linux-gnu -o /tmp/rustc.so
[14:55:54] <cmr> no lto
[14:56:17] <cmr> O
[14:56:20] <cmr> *I'll add -c
[14:58:18] <cmr> and I'll rebench everything since aa4455e
[14:58:42] <cmr> actually I'm going to need to rebench everything.
[14:58:52] <cmr> that's sadface.
[14:59:10] <dbaupp> just to drop the linking phase?
[14:59:11] *** Joins: lpy (lpy@12172131.F09091A8.1348A864.IP)
[14:59:37] <cmr> yeah, otherwise neither the timings nor the memory usage are comparable in the main graph.
[14:59:49] <dbaupp> yes
[15:00:09] <dbaupp> I'll need to clean out my end when you do, fwiw.
[15:00:27] <dbaupp> should I stop downloading any new ones for now?
[15:00:41] <eddyb> cmr: I was afk. thanks a lot - it would be a good idea to redo a small part at first to check that it's saner
[15:01:12] <cmr> eddyb: good idea!
[15:01:21] <cmr> I'll do the recent ones first and then redo the rest.
[15:03:36] *** flaper87 is now known as flaper87|afk
[15:06:51] *** Quits: dbaupp (Thunderbir@moz-EB2EFE6F.lns20.syd6.internode.on.net) (Quit: dbaupp)
[15:09:24] *** Joins: dbaupp (Thunderbir@moz-EB2EFE6F.lns20.syd6.internode.on.net)
[15:20:00] *** flaper87|afk is now known as flaper87
[15:29:05] *** Joins: gwty (gwtypc@E411062A.DC97420E.137C914F.IP)
[15:38:59] *** Quits: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca) (Quit: canhtak)
[15:39:55] *** Quits: gwty (gwtypc@E411062A.DC97420E.137C914F.IP) (Connection reset by peer)
[15:40:26] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Ping timeout)
[15:42:22] *** Joins: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca)
[15:43:06] *** Joins: gwty (gwtypc@411B4BD7.266836D.CF29F6CE.IP)
[15:46:36] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[15:46:36] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/JIEkbg
[15:46:36] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[15:49:28] *** Joins: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com)
[15:49:33] *** bjz is now known as mr_freeze
[15:50:34] *** mr_freeze is now known as mr_freeze_has_been_frozen_out_
[15:50:45] *** mr_freeze_has_been_frozen_out_ is now known as bjz
[15:51:22] *** Quits: jensnockert (jensnocker@moz-7DC16A5F.afb.bredband2.com) (Ping timeout)
[15:51:37] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[15:51:38] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/gFnetw
[15:51:38] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[15:54:06] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[15:54:06] *** ChanServ sets mode: +ao dherman dherman
[15:58:05] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[16:01:46] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[16:01:46] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1441025d0 to 14c335734: 02http://git.io/N3iJvQ
[16:01:46] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[16:01:50] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[16:01:50] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/R8Bbug
[16:01:50] <ghrust> 13rust/06auto 144b2c4d2 15Corey Richardson: Add a rustdoc test...
[16:01:50] <ghrust> 13rust/06auto 14132f075 15bors: auto merge of #11032 : cmr/rust/rustdoc_test, r=alexcrichton...
[16:01:50] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[16:05:04] *** Quits: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca) (Quit: canhtak)
[16:06:06] *** Joins: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca)
[16:10:22] *** Quits: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP) (Quit: leaving)
[16:10:59] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[16:21:06] <jack> acrichto: Now I'm having problems with SharedChan possibly not being Send.
[16:23:22] <jack> acrichto: no. it's Send. Something changed in the data structure I guess
[16:25:10] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[16:28:05] <jack> I really wish the compiler would tell me *what* doesn't fulfill send.
[16:30:03] <eddyb> jack: like a chain of "because field x of X .... because field y of Y ... because field z of Z"?
[16:33:48] <cmr> What just happened to https://github.com/mozilla/rust/pull/11032 ?
[16:36:01] <jack> no idea. retry it?
[16:36:10] <jack> eddyb: I'd settle for the first link.
[16:36:15] <cmr> hm, no, one of the linux bots failed.
[16:36:40] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[16:36:40] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14132f075 to 14c335734: 02http://git.io/N3iJvQ
[16:36:40] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[16:36:40] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[16:36:41] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/FXS0qg
[16:36:41] <ghrust> 13rust/06auto 140f98cb4 15Michael Woerister: debuginfo: Properly support by-value self arguments
[16:36:41] <ghrust> 13rust/06auto 1401fae5f 15Michael Woerister: debuginfo: Updated test cases to also test by-value self arguments.
[16:36:41] <ghrust> 13rust/06auto 145ece092 15bors: auto merge of #11033 : michaelwoerister/rust/byvalself, r=pcwalton...
[16:36:42] *** Quits: Axord (xord@moz-C0D5F15A.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[16:36:43] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[16:38:59] <jack> is *mut Send?
[16:39:10] <jack> and if not, did that change recently?
[16:39:45] <cmr> rusti: fn assert_send<T: Send>(_: T) { } let x = 42i; assert_send(&mut x as *mut int);
[16:39:48] -rusti- pastebinned 7 lines of output: http://ix.io/9qY
[16:40:25] <cmr> rusti: fn assert_send<T: Send>(_: T) { } let mut x = 42i; assert_send(&mut x as *mut int);
[16:40:26] -rusti- ()
[16:42:15] <jack> As far as I can tell everything here is Send.
[16:42:56] <jack> SharedChan of this si not Send according to the compiler: https://github.com/mozilla/servo/blob/master/src/components/script/script_task.rs#L57-L78
[16:43:22] <eddyb> wasn't SharedChan going away or something?
[16:43:34] <cmr> eddyb: no, SharedPort went away
[16:43:40] <eddyb> aah, ok
[16:46:24] <eddyb> jack: maybe this?
[16:46:28] <eddyb> err. this: https://github.com/mozilla/servo/blob/master/src/components/script/dom/window.rs#L70-L74
[16:47:12] <jack> eddyb: https://github.com/mozilla-servo/rust-mozjs/blob/master/jsapi.rs#L259-L262
[16:47:53] <eddyb> oh
[16:50:19] <eddyb> rusti: fn assert_send<T: Send>() { } assert_send::<extra::url::Url>();
[16:50:19] -rusti- ()
[16:50:37] <eddyb> rusti: fn assert_send<T: Send>() { } assert_send::<SharedChan<~extra::url::Url>>();
[16:50:56] * eddyb has no idea what he's doing
[16:51:07] -rusti- pastebinned 10 lines of output: http://ix.io/9qZ
[16:51:15] *** Quits: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca) (Ping timeout)
[16:51:26] <eddyb> rusti: version
[16:51:27] -rusti- "rustc 0.9-pre (61f8c05 2013-10-24 13:01:18 -0700)"
[16:51:31] <eddyb> riiight
[16:52:37] *** Joins: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net)
[16:52:37] *** ChanServ sets mode: +ao dherman dherman
[16:55:02] <jack> Did something change with detection of cycles?
[16:55:17] <jack> I notice that this data strcuture is recursive.
[16:55:36] <eddyb> so this is it https://github.com/mozilla/rust/blob/master/src/libstd/rt/mpsc_queue.rs#L69
[16:55:41] <eddyb> jack: huh? how so
[16:55:42] <jack> one of the layout messages can contain a ScriptChan
[16:55:59] <eddyb> oh, how did I miss that...
[16:56:05] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[16:56:11] <jack> Reflow is the structure
[16:56:12] <eddyb> jack: it's behind indirection, though
[16:56:18] <jack> several levels.
[16:56:37] <eddyb> just like a List's Cons contains another List
[16:57:13] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[16:58:50] <jack> This is frustrating.
[16:59:14] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[16:59:50] <eddyb> jack: that's the cause, though?
[16:59:59] <jack> I do not know.
[17:00:05] <jack> trying to write a test case fo rit
[17:00:06] <eddyb> comment it out or something
[17:00:32] <eddyb> (the ScriptChan occurrence, that is)
[17:01:52] <jack> recursive through Option is Send.
[17:02:42] <eddyb> what about *mut Option?
[17:04:25] <jack> *mut is send. Option is send.
[17:05:33] <cmr> jld: ping
[17:07:16] <acrichto> jack: Chan/SharedChan are definitely Send
[17:08:15] <jack> acrichto: I've tested that now.
[17:08:25] <jack> acrichto: Is there anyway to track this down?
[17:08:39] <acrichto> jack: stare at some structures :(
[17:08:55] <eddyb> does this work? type C = SharedChan<C>;
[17:08:59] <jack> acrichto: I've pretty much written simple test cases for every subpiece of that struct.
[17:09:50] <cmr> I think 1. we should have an assert_send etc for the kinds, linted 2. typecontents should say which made it invalid. I can do both today.
[17:10:24] <eddyb> jack: can you make a copy of ScriptMsg and bisect it?
[17:10:34] *** Joins: TimAbraldes (quassel@moz-EE59D6ED.war.clearwire-wmx.net)
[17:10:49] <eddyb> though it's hard if you can't compile at all
[17:12:25] <eddyb> by making test cases you're more likely to miss the problematic part
[17:13:27] <cmr> eddyb: benches are going, btw.
[17:13:50] <eddyb> <3
[17:15:12] <jack> cmr++
[17:15:36] <eddyb> cmr: fwiw, you're doing much better than me. I'm afraid I burned out
[17:15:46] <cmr> eddyb: :(
[17:16:07] <eddyb> the leg was the tip of an iceberg
[17:16:21] <cmr> acrichto: ping
[17:16:32] <acrichto> cmr: pong
[17:16:42] <cmr> acrichto: in make tests, should I be using like $(HBIN2_H_$(CFG_BUILD))/rustdoc$(X_$(CFG_BUILD)) ?
[17:17:02] <acrichto> for depending on the rustdoc binary in rmake?
[17:17:06] <cmr> yeah
[17:17:12] <acrichto> sec
[17:17:46] <acrichto> cmr: we should probably just depend on everything
[17:17:54] <cmr> well I need to call it specifically
[17:17:55] <acrichto> so rmake has rustpkg/rustc/syntax/rustdoc etc
[17:18:01] <cmr> I don't care as much about the deps.
[17:18:05] <cmr> I figured they already had everything
[17:18:07] <acrichto> oh you'll need to update the deps
[17:18:15] <cmr> where>
[17:18:25] <acrichto> line 923 of mk/tests.mk
[17:18:27] <acrichto> change HSREQ
[17:18:28] <acrichto> to 
[17:18:31] <acrichto> $$(CSREQ$(1)_T_$(2)_H_$(3))
[17:18:56] <acrichto> you'll also want to modify the python script
[17:18:59] <acrichto> to export RUSTDOC
[17:19:01] <acrichto> as well as RUSTC
[17:19:41] <cmr> ahhhhn I see how it fits together now.
[17:19:47] <cmr> maketest.py was the missing bit
[17:20:49] <jack> eddyb: LayoutChan is not Send.
[17:21:25] <eddyb> oh. heh. I thought "chans has to be send otherwise they wouldn't work by themselves"
[17:22:32] <eddyb> I guess you just didn't get any errors about LayoutChan because of ScriptMsg
[17:26:21] <jack> both LayoutQuery and Reflow aren't Send.
[17:28:53] <jack> It appears to be AbstractNode<ScriptView> is not Send.
[17:29:21] <jack> *mut Box?
[17:30:32] *** Quits: lpy (lpy@12172131.F09091A8.1348A864.IP) (Client exited)
[17:31:23] <jack> nothing special about box
[17:31:57] <jack> Reflow also has an AbstractNode<ScriptView>
[17:32:46] <jack> Does it matter what a *mut pointer type is? Do all raw mut pointers fulfill Send?
[17:33:57] *** Joins: notmatt (notmatt@moz-9FB2565E.vc.shawcable.net)
[17:34:07] <eddyb> rusti: fn assert_send<T: Send>() { } assert_send::<*mut ::std::rc::Rc<int>>();
[17:34:07] -rusti- ()
[17:34:15] <eddyb> rusti: fn assert_send<T: Send>() { } assert_send::<::std::rc::Rc<int>>();
[17:34:18] -rusti- pastebinned 7 lines of output: http://ix.io/9r6
[17:34:33] <eddyb> quite unsafe
[17:35:55] <jack> Then I am stumped.
[17:36:29] <jack> abstract node is pub struct AbstractNode<View> { priv obj: *mut Box<Node<View>> }
[17:36:30] *** Joins: pnkfelix (pnkfelix@moz-43495417.fbx.proxad.net)
[17:36:31] <acrichto> jack: inference through *mut has changed on master, rusti is very old at this point I think
[17:36:34] <acrichto> rusti: version
[17:36:35] -rusti- "rustc 0.9-pre (61f8c05 2013-10-24 13:01:18 -0700)"
[17:36:57] <jack> acrichto: how so? do you remember the PR?
[17:37:07] <acrichto> somewhere in the last two months!
[17:37:13] <acrichto> it basically bubbles up
[17:37:22] <acrichto> if Box<Node<View>> isn't send then *mut of that isn't
[17:38:01] <jack> That's not good.
[17:38:12] <pnkfelix> jack: acrichto: sorry to interject, but are you referring to https://github.com/mozilla/rust/issues/9509
[17:38:22] <acrichto> ah, indeed!
[17:38:43] <eddyb> acrichto: derp, I didn't think when using rusti
[17:38:57] <eddyb> it's obviously something that was changed, since jack just got this problem
[17:39:41] <pnkfelix> jack: Do note this comment from niko: https://github.com/mozilla/rust/issues/9509#issuecomment-27346843
[17:39:54] <jack> pnkfelix: these pointers are very helpful.
[17:41:47] *** Quits: dherman (dherman@moz-B31C6965.dsl.pltn13.sbcglobal.net) (Quit: dherman)
[17:46:43] <jack> pnkfelix: I wish I could hug you right now. :)
[17:47:41] <jack> code is uglier becuase of *mut () getting transmuted, but at least it compiles.
[17:48:56] *** kimundi is now known as zz_kimundi
[17:56:15] *** flaper87 is now known as flaper87|afk
[17:57:18] <jack> this is a new error for me: https://gist.github.com/metajack/8026841
[17:57:25] <jack> i think i saw someone mention that yesterday
[17:58:34] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[17:59:25] <jack> cmr: was it you? :)
[18:00:03] <cmr> yes
[18:00:13] <pnkfelix> jack: well, just save that hug for next year's performance reviews.  :)
[18:04:09] *** Quits: dcrewi (david@moz-AB8667CE.gyrae.net) (Ping timeout)
[18:04:30] *** Joins: vfetwnuncszu (david@moz-AB8667CE.gyrae.net)
[18:04:40] *** vfetwnuncszu is now known as dcrewi
[18:16:42] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[18:22:26] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[18:22:27] *** ChanServ sets mode: +ao dherman dherman
[18:25:09] *** pnkfelix is now known as pnkfelix|cooking
[18:31:51] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[18:31:51] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/FXS0qg
[18:31:51] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[18:32:42] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:32:42] *** ChanServ sets mode: +qo brson brson
[18:36:54] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[18:36:54] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/MFZs9Q
[18:36:54] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[18:36:55] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[18:36:55] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/_JRFOg
[18:36:55] <ghrust> 13rust/06auto 143e04d2e 15Alex Crichton: Adding tests for closed issues...
[18:36:55] <ghrust> 13rust/06auto 146d2e61b 15bors: auto merge of #11012 : alexcrichton/rust/needstest, r=alexcrichton...
[18:36:55] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[18:37:59] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[18:38:54] *** Quits: TimAbraldes (quassel@moz-EE59D6ED.war.clearwire-wmx.net) (Connection reset by peer)
[18:42:03] <cmr> acrichto: r> https://github.com/mozilla/rust/pull/11032
[18:45:37] *** jld is now known as jld|pto
[18:46:03] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:46:03] *** ChanServ sets mode: +qo brson brson
[18:55:04] <acrichto> brson: ping
[18:56:08] *** Joins: jdm (jdm@FCCEA34F.7672369.D8E68FF6.IP)
[19:02:11] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[19:02:11] *** ChanServ sets mode: +ao pcwalton pcwalton
[19:03:02] <brson> acrichto: pong
[19:03:27] <acrichto> brson: I'm trying to make LocalIo safe, and it basically requires put_io() and take_io() to transfer ownership
[19:03:31] <acrichto> we have one problem though
[19:03:49] <acrichto> TcpWatcher::connect() will have ownership of the local I/O, so it's not in the task
[19:03:57] <acrichto> but if the connect() fails, it will drop the TcpWatcher
[19:04:03] <acrichto> which right now performs a homing operation
[19:04:30] <acrichto> the first part of this homing oepration is to borrow the local I/O and get its id (just a transmuted pointer now), but we dont' have any local I/O b/c it was already taken..
[19:04:47] <acrichto> first idea I have is to put the 'id()' on the Runtime instead of the IoFactory
[19:05:01] <acrichto> but we could also do some local_data fanciness inside of uvio
[19:07:37] <brson> acrichto: can TcpWatcher put LocalIo during drop?
[19:07:56] <acrichto> it doesn't actually have ownership of it, all IoFactory methods still take &mut self
[19:08:08] <acrichto> something up on the stack has ownership of it (and will put on drop)
[19:08:28] <acrichto> I mainly ask b/c I'm trying to avoid an id() method now
[19:08:38] <acrichto> oh hm
[19:08:42] <acrichto> I could borrow the runtime
[19:08:46] <acrichto> and just transmute it to figure out its pointer
[19:10:56] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[19:12:55] <acrichto> brson: also unrelated, mac4 is not showing up as connected, but I can log in just fine, is it ok if I restart it?
[19:13:45] <acrichto> oh nvmd, restarting the buildslave
[19:15:04] <acrichto> ah the stunnel died
[19:15:06] <acrichto> should be good to go now
[19:17:41] *** Quits: blank_name (blank_name@27AF90E3.AA624E84.6D228269.IP) (Ping timeout)
[19:22:22] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
[19:32:09] *** Joins: TimAbraldes (quassel@moz-7FD19BDC.hsd1.or.comcast.net)
[19:36:12] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Connection reset by peer)
[19:36:25] *** Joins: nrc (nrc@7BE24E90.A5032A01.3CFC199D.IP)
[19:37:46] *** Joins: tjc (tjc@moz-6EB4E533.dsl.tsoft.com)
[19:37:46] *** ChanServ sets mode: +o tjc
[19:38:12] <acrichto> brson: hm no this won't work at all, if a task contains ownership of the IoFactory on its stack then the next task to run on the same scheduler won't have a local IoFactory, so when you call into the IoFactory it would have to consume the factory and then right before blocking
[19:38:25] <acrichto> this is getting tricky enough that I think I'm going to open an issue on it and not deal with it this time around
[19:38:47] <brson> acrichto: i think that's a good call
[19:42:43] <brson> acrichto: if you can figure out how to get rid of these 'bootstrap' tasks that would be swell
[19:43:02] <acrichto> brson: I think they're going to have to stay
[19:43:15] <brson> no!
[19:43:15] <acrichto> so shutdown() achieves blocking via Thread::join()
[19:43:22] <acrichto> but I want to change Thread::join() to be a channel receive
[19:43:32] <acrichto> receiving on a channel assumes a local task
[19:43:56] <acrichto> the native ones I may be able to get rid of
[19:44:10] <acrichto> I just wish we could figure out the stack size of the main thread 
[19:44:25] <brson> maybe we can conservatively estimate it's size
[19:44:33] <acrichto> at just 2MB?
[19:45:23] <brson> maybe?
[19:45:39] <acrichto> hmm, osx says it has a initial stack size of 524288
[19:46:01] <acrichto> but I also don't believe that
[19:46:06] <brson> acrichto: it seems a bit incongruous that to join a *Thread* you first have to create a *Task*
[19:46:13] <brson> since thread is the lower level concept
[19:46:36] * brson looks up the definition of 'incongruous'
[19:46:38] <acrichto> but we don't want pool.shutdown() to block the os thread?
[19:47:42] <brson> no
[19:47:54] <acrichto> hm, that will require some dancing
[19:48:23] <acrichto> brson: green tasks use the channel for now in order to know when the main task has exited
[19:48:32] <acrichto> which is why the "bootstrap task" is needed in the green case
[19:49:13] <acrichto> so we want the sequence of events to be
[19:49:21] <acrichto> spawn main; wait_for_everything_to_exit; shutdown()
[19:49:31] <brson> acrichto: so we need one bootstrap task to handle shutdown. right now we have a bootstrap task per scheduler
[19:49:40] <brson> maybe we're talking about different tasks?
[19:50:08] <brson> https://github.com/alexcrichton/rust/blob/0dabcf5d13cfbea19fb817b03c64ca90656cbf19/src/libgreen/lib.rs#L192
[19:50:18] <acrichto> but thereah!
[19:50:20] <acrichto> ah!
[19:50:21] <acrichto> those tasks
[19:50:28] <acrichto> yeah we should get rid of those
[19:50:35] <brson> lol
[19:50:37] <acrichto> oh wait
[19:50:46] <acrichto> man I shouldn't have cut that commit so soon
[19:51:03] <acrichto> https://github.com/alexcrichton/rust/blob/libgreen/src/libgreen/lib.rs#L95
[19:51:08] <acrichto> I thought you were talking about that bootstrap task
[19:51:27] <acrichto> but you haven't gotten there yet
[19:51:30] <acrichto> that was introduced in a later commit
[19:51:38] <acrichto> I will open an issue about removing the scheduler bootstrap tasks though
[19:53:01] <brson> i am worried about the behavior of Thread.join though. I guess for the most part users shouldn't ever be using Thread, but native::spawn, so maybe Thread.join should be the typically expected blocking and we should use message passing for joining the schedulers
[19:53:25] <acrichto> I think that may be the best way to go
[19:53:32] <acrichto> sched.boostrap(); chan.send(());
[19:53:46] <acrichto> we should make it a goal to make 'std::rt' private
[19:54:03] <acrichto> that would be very difficult right now though, and may not be the right idea
[19:54:18] <acrichto> both libgreen and libnative need std::rt::thread
[19:55:07] * brson lunch
[19:55:56] *** Joins: canhtak (canhtak@moz-258236CD.wl.t.ulaval.ca)
[19:58:33] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[19:58:33] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/_JRFOg
[19:58:33] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[20:01:59] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[20:01:59] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/PN7NOA
[20:01:59] <ghrust> 13rust/06auto 141890290 15klutzy: llvm: Disable pthread on mingw...
[20:01:59] <ghrust> 13rust/06auto 14b0a9937 15klutzy: mklldeps.py: Write to file instead of print...
[20:02:00] <ghrust> 13rust/06auto 148ecf7b3 15bors: auto merge of #11013 : klutzy/rust/win-no-pthread, r=alexcrichton...
[20:02:02] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[20:06:09] *** pnkfelix|cooking is now known as pnkfelix|satiated
[20:07:21] <eddyb> pnkfelix|satiated: you remind me of Starbound. which I don't want to start playing again
[20:08:01] * eddyb avoid complaining about lack of productivity this nasty week
[20:08:31] <pnkfelix|satiated> eddyb: you crazy kids with your minebounds and starcrafts
[20:08:49] <eddyb> except starcraft is a thing, hah
[20:09:11] <eddyb> you could've mixed terraria in there without mentioning any real game
[20:09:45] * pnkfelix|satiated 
[20:11:34] *** Quits: tjc (tjc@moz-6EB4E533.dsl.tsoft.com) (Ping timeout)
[20:13:31] <Eridius> I should try Starbound again. I never got very far
[20:13:34] <Eridius> heck, never built the distress beacon
[20:14:11] <eddyb> I did. don't use it until you're really ready, because you only get a handful of deaths before it's wasted
[20:14:27] <Eridius> yeah, I don't know how to tell when I'm ready though
[20:14:53] <Eridius> also, the planet I'm on doesn't have much. I've walked a good ways along the surface; no airship, only structure I found was a wizard shopkeeper who sold me a cosmetic wizard hat
[20:15:14] <Eridius> I haven't gone digging into the ground much, but I'm not optimistic about finding stuff down there either
[20:15:26] *** Quits: gwty (gwtypc@411B4BD7.266836D.CF29F6CE.IP) (Ping timeout)
[20:15:51] <eddyb> Eridius: horizontal branch/strip mining underground works
[20:16:17] <Eridius> works for.. finding metal? I'm talking more about finding chests with cool weapons and whatnot.
[20:16:37] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[20:16:37] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/Lyq0yg
[20:16:37] <ghrust> 13rust/06auto 141890290 15klutzy: llvm: Disable pthread on mingw...
[20:16:38] <ghrust> 13rust/06auto 14b0a9937 15klutzy: mklldeps.py: Write to file instead of print...
[20:16:38] <ghrust> 13rust/06auto 14c87b9d3 15bors: auto merge of #11013 : klutzy/rust/win-no-pthread, r=alexcrichton...
[20:16:39] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[20:16:42] <Eridius> right now all I have is an 11-dps hammer with no special effect, and that makes me sad :(
[20:17:48] <Eridius> or, heck, tech. I've never seen any
[20:19:52] *** Joins: jmbto (jmbto@moz-FE174E29.fbx.proxad.net)
[20:21:20] <cmr> I've been starbounding during builds :p
[20:22:06] <cmr> acrichto: re-r? https://github.com/mozilla/rust/pull/11032
[20:22:12] <cmr> the indentation was indeed wrong.
[20:22:17] <cmr> used two tabs instead of a tab and four spaces.
[20:22:22] <cmr> (!?)
[20:25:03] <Eridius> am I being silly by ignoring community-found coordinates in starbound? It feels to me like that ruins the whole idea of exploration
[20:25:12] <cmr> I've been ignoring them too yeah.
[20:25:23] <cmr> I've found tech on almost every planet I've actually explored.
[20:25:32] <Eridius> oh goodie, future plans for Starbound include being able to scan the planet for things like dungeons
[20:25:35] <Eridius> cmr: even the starting planet?
[20:25:42] <cmr> Eridius: yeah
[20:25:46] * Eridius hasn't quite managed to cross the entire surface of his planet.
[20:25:50] <cmr> usually underground.
[20:25:53] <cmr> heh :)
[20:25:54] <Eridius> I keep dying once I've gone really far :/
[20:26:03] <cmr> make armor!
[20:26:06] <Eridius> how do you typically find interesting underground stuff? Just strip-mining, or do you find them from surface caves?
[20:26:08] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[20:26:15] <Eridius> I'm trying! Not enough copper yet to make a full set
[20:26:17] <cmr> usually I explore surface caves.
[20:26:23] <cmr> but I also dig straight down
[20:26:36] <cmr> and just keep going until magma, usually I find something interesting
[20:26:40] <Eridius> oh?
[20:27:03] <cmr> especially with large sand/gravel pits, it's nice and easy mining
[20:30:59] *** Quits: pnkfelix|satiated (pnkfelix@moz-43495417.fbx.proxad.net) (Input/output error)
[20:32:06] *** jld|pto is now known as jld|mt_tam
[20:32:15] *** Joins: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com)
[20:32:15] *** ChanServ sets mode: +ao dherman dherman
[20:38:08] <cmr> lol, gcc emits an "orq $0 (%rsp)" with -fstack-check and without optimizations.
[20:41:36] *** Quits: dherman (dherman@moz-DFAA4E15.p2p.sfo1.mozilla.com) (Quit: dherman)
[20:49:20] <vadimcn> I am getting a bit lost in LLVM API...   what would be the relevant functions if I want to create an .o file with a particular data section in it?
[20:49:26] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[20:50:09] <acrichto> vadimcn: you'd create an LLVM Module, add a symbol to it tagged with the appropriate section, and then run the codegen passes over the module
[20:51:31] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[20:51:31] <ghrust> 01[13rust01] 15alexcrichton 04force-pushed 06try from 149a1b1aa to 14b83c186: 02http://git.io/k471pw
[20:51:31] <ghrust> 13rust/06try 145e42c87 15Alex Crichton: std: Introduce a Runtime trait...
[20:51:31] <ghrust> 13rust/06try 14e9f8db6 15Alex Crichton: std: Introduce an unstable::stack module...
[20:51:31] <ghrust> 13rust/06try 14cdf3f27 15Alex Crichton: std: Delete rt::test...
[20:51:33] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[20:53:39] <vadimcn> acrichto: thanks, but that's a bit too high-level for me.   Is there a relevant tutorial somewhere?
[20:53:55] <acrichto> vadimcn: haha, I wish
[20:54:00] <vadimcn> e.g. how do I add a data symbol?
[20:54:02] <acrichto> I've never found a lot of good docs on llvm
[20:54:08] <acrichto> LLVMAddGlobalValue or something like that
[20:55:29] <vadimcn> acrichto: no references to LLVMAddGlobalValue in Rust source... doesn't Rust ever need to emit data?
[20:55:55] <acrichto> oh yeah definitely
[20:56:03] <acrichto> I don't remember the exact names off the top of my head
[20:56:56] <vadimcn> acrichto: so what resources you you peruse to figure out how to use LLVM API?
[20:57:02] <Luqman> there's a wrapper for that in trans::base i think
[20:57:13] *** Joins: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro)
[20:57:25] <Luqman> vadimcn: grep the clang source is what i do sometimes :P
[20:58:28] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:58:37] <acrichto> vadimcn: lib/llvm.rs and the llvm-c/Core.h
[20:58:41] <Luqman> vadimcn: also, you want LLVMAddGlobal
[20:58:49] <vadimcn> hmm, ok, looks like LLVMAddGlobal + LLVMSetInitializer is what I need
[20:59:06] <vadimcn> what about codegen passes?  How do I run them?
[20:59:17] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[20:59:18] *** ChanServ sets mode: +qo brson brson
[21:00:17] <acrichto> ah that sounds right
[21:00:25] <acrichto> for codegen take a look at back::link
[21:00:32] <acrichto> there's some relevant code in PassWrapper.cpp as well
[21:00:41] <vadimcn> would it be something like with_codegen() from link.rs ?
[21:01:25] <acrichto> yeah
[21:01:29] <acrichto> that gives you a pass manager
[21:01:32] <acrichto> and then you run the pass manager
[21:01:36] <acrichto> also WriteOutputFile
[21:01:40] <acrichto> those things all kinda glue together
[21:02:57] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[21:04:12] <vadimcn> with_codegen() calls adds optimization passes(?) via LLVMRustAddAnalysisPasses()    If I want to output data only, is that needed?   
[21:05:58] <acrichto> nah
[21:06:09] <acrichto> you can probably just use the code in PassWrapper.cpp
[21:06:14] <acrichto> for taking a module and spitting out an object file
[21:08:17] <vadimcn> LLVMRustWriteOutputFile with empty pass manager?
[21:09:23] *** Joins: bytewise (bytewise@moz-B7439A8C.adsl.alicedsl.de)
[21:11:43] <acrichto> yeah
[21:11:48] <acrichto> or you don't even need the pass manager
[21:13:03] <vadimcn> cool, thanks!
[21:13:27] <vadimcn> another question: now do I enable rtdebug!() tracing?
[21:13:54] *** Quits: eddyb (eddy@moz-68E0B7D0.residential.rdsnet.ro) (Ping timeout)
[21:14:32] <cmr> --cfg rtdebug iirc
[21:14:48] <acrichto> be warned though
[21:14:52] <acrichto> it prints *a lot*
[21:22:00] <vadimcn> thx
[21:24:48] *** zz_kimundi is now known as kimundi
[21:27:00] <jack> anyone seen this before? task 'rustc' failed at 'parse_bounds: bad bounds', /Users/jack/src/servo/src/compiler/rust/src/librustc/metadata/tydecode.rs:600
[21:27:13] <acrichto> whoa, that's new
[21:27:21] <acrichto> you may be using a newer library with an older compiler
[21:31:04] <jack> i'll make clean rust and see fi that helps, but i already blew away all of servo and compiled fresh.
[21:32:06] *** Quits: Jesse (jruderman@moz-9754CB0.hsd1.ca.comcast.net) (Quit: Jesse)
[21:32:53] <acrichto> jack: I only say b/c I think we've added new bounds recently that older compilers wouldn't understand
[21:36:47] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[21:36:47] <ghrust> 01[13rust01] 15alexcrichton 04force-pushed 06try from 14b83c186 to 1454f5a8f: 02http://git.io/k471pw
[21:36:47] <ghrust> 13rust/06try 1454f5a8f 15Alex Crichton: Test fixes and rebase conflicts...
[21:36:47] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[21:40:41] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[21:40:45] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[21:40:46] *** ChanServ sets mode: +ao pcwalton pcwalton
[21:44:41] <acrichto> yay snapshots just got smaller
[21:44:56] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[21:44:58] <acrichto> or at least the windows one did
[21:46:36] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[21:46:36] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Lyq0yg
[21:46:36] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[21:51:39] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[21:51:39] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/yCCXQA
[21:51:39] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[21:51:41] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[21:51:42] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/Abok5A
[21:51:42] <ghrust> 13rust/06auto 1414b56a7 15Alex Crichton: rustc: Optimize reading metadata by 4x...
[21:51:42] <ghrust> 13rust/06auto 146f94c1b 15bors: auto merge of #11017 : alexcrichton/rust/faster-read, r=thestinger...
[21:51:42] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[21:59:22] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[22:08:52] <jack> acrichto: with clean builds of rust and servo, same problem.
[22:09:03] <acrichto> huh, dunno :(
[22:09:07] <acrichto> haven't seen that one before
[22:11:09] <jack> RUST_LOG=rustc::metadata::tydecode wasn't much help
[22:11:33] <jack> any ideas for where to look?
[22:11:41] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[22:11:41] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 146f94c1b to 14c87b9d3: 02http://git.io/N3iJvQ
[22:11:41] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[22:11:42] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[22:11:42] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/WAy1bw
[22:11:42] <ghrust> 13rust/06auto 1414b56a7 15Alex Crichton: rustc: Optimize reading metadata by 4x...
[22:11:42] <ghrust> 13rust/06auto 1476fc2b4 15bors: auto merge of #11017 : alexcrichton/rust/faster-read, r=thestinger...
[22:11:43] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[22:11:57] <jack> also, is 10.9 debugging just messed up or is rust_begin_unwind not the place to break anymore?
[22:12:20] <sfackler> I always just "catch throw"
[22:13:58] *** Joins: aatch (James@moz-B437F499.pocketrent.com)
[22:15:18] <jack> nice. if i RUST_LOG=rustc it fails a different way :0
[22:15:42] <jack> sfackler: that doesn't seem to do anything.
[22:15:50] <acrichto> rust_begin_unwind should still be the right place to catch
[22:15:57] <acrichto> if it's not tripping then you're not hitting the unwinding stuff
[22:16:04] <acrichto> may be dying sooner
[22:16:10] <jack> (gdb) catch throw
[22:16:10] <jack> Function "__cxa_throw" not defined.
[22:16:49] <sfackler> it gives me that error as well, but seems to work anyways
[22:16:52] <sfackler> *shrug*
[22:18:55] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[22:19:16] * jack is struggling to use lldb
[22:19:54] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[22:19:54] *** ChanServ sets mode: +qo brson brson
[22:20:12] <acrichto> jack: 'breakpoint set -F rust_begin_unwind'
[22:20:20] <acrichto> lldb is actually *a lot* nicer than gdb on osx
[22:20:25] <acrichto> it does take a second to get used to though
[22:20:31] <acrichto> I have left gdb in the dust though
[22:21:41] <jack> acrichto: is this useful at all? https://gist.github.com/metajack/8030909
[22:22:09] <acrichto> sadly no :(
[22:22:46] <jack> i wonder if i can break on parse_bounds and see what it's trying to aprse.
[22:23:08] <jack> it would be nice if rustc would fail with some info about the current item it's crashign on
[22:27:33] <cmr> acrichto: r? https://github.com/mozilla/rust/pull/11032
[22:28:36] *** Joins: blank_name (blank_name@12C7A697.7C86004B.6D228269.IP)
[22:29:08] <acrichto> brson: do you have any objections to http://static.rust-lang.org/doc/master/std/vec/index.html ?
[22:33:47] *** Quits: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com) (Quit: pcwalton)
[22:35:16] *** Joins: pcwalton (pcwalton@moz-C07D5168.p2p.sfo1.mozilla.com)
[22:35:16] *** ChanServ sets mode: +ao pcwalton pcwalton
[22:43:53] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[22:43:53] <ghrust> 01[13rust01] 15alexcrichton 04force-pushed 06try from 1454f5a8f to 148791327: 02http://git.io/k471pw
[22:43:53] <ghrust> 13rust/06try 140d48d24 15Alex Crichton: green: Move a scheduler test inside libgreen...
[22:43:53] <ghrust> 13rust/06try 148791327 15Alex Crichton: Test fixes and rebase conflicts...
[22:43:53] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[22:45:17] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[22:45:17] *** ChanServ sets mode: +ao dherman dherman
[22:45:59] <dbaupp> acrichto: that looks like the wrong link?
[22:46:07] <acrichto> lol I can read
[22:46:27] <dbaupp> nice talk yesterday btw :)
[22:46:29] <acrichto> brson: https://github.com/mozilla/rust/pull/11044
[22:46:32] <acrichto> thanks! 
[22:50:41] <brson> acrichto: what does try_recv do on disconnect?
[22:50:53] <acrichto> None
[22:51:13] <acrichto> hm, now I remember realizing that a long time ago
[22:51:23] <acrichto> and how it kinda needs a tri-state return value
[22:51:30] <acrichto> Empty, Disconnected, Data(t)
[22:52:11] <brson> maybe. seems like someone would want try_recv_opt someday
[22:52:14] <brson> otherwise
[22:52:26] <jack> i patched the compiler. the bound that is causing that failure is 'P'
[22:52:49] <jack> 'S' is Send, 'K' is Freeze, so I have no idea what 'P' could be.
[22:53:01] *** Quits: dcrewi (david@moz-AB8667CE.gyrae.net) (Ping timeout)
[22:53:47] <dbaupp> POD
[22:54:01] <dbaupp> jack: recently added by pcwalton 
[22:54:12] <jack> so why can't tydecode read POD?
[22:54:19] <pcwalton> oh crap
[22:54:20] <pcwalton> haha
[22:54:22] <pcwalton> I forgot to add that
[22:54:34] <pcwalton> on it now
[22:54:42] <jack> pcwalton: Please add the missing bound to the fail message :)
[22:55:05] <jack> right now it's kind of annoying because it just says "failed to parse bound" instead of "failed to parse bound {}"
[22:55:08] <pcwalton> yeah
[22:55:12] <pcwalton> on it
[22:56:13] <pcwalton> acrichto: r? https://github.com/mozilla/rust/pull/11058
[22:56:32] <brson> acrichto: i guess i'm feeling a bit yagni about tryrecviterator
[22:56:36] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[22:56:36] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1476fc2b4 to 14c87b9d3: 02http://git.io/N3iJvQ
[22:56:36] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[22:56:40] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[22:56:40] <ghrust> 01[13rust01] 15bors pushed 5 new commits to 06auto: 02http://git.io/1BZ2Ng
[22:56:40] <ghrust> 13rust/06auto 144c79b22 15Huon Wilson: std::vec: remove .as_imm_buf, replaced by .as_ptr & .len....
[22:56:40] <ghrust> 13rust/06auto 14accfd1f 15Huon Wilson: std::vec: remove .as_muf_buf, replaced by .as_mut_ptr & .len.
[22:56:40] <ghrust> 13rust/06auto 1481b3049 15Huon Wilson: std::str: replace .as_imm_buf with .as_ptr.
[22:56:42] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[22:56:44] <brson> acrichto: open coding loops is pretty easy
[22:57:01] <acrichto> brson: that was kinda my thought as well, I only provided iter() for a mild convenience
[22:58:16] <jack> pcwalton: why did no one else find this? :)
[22:58:23] <jack> seems like this would trigger on most everything
[22:58:24] <pcwalton> because it was added in the last 2 days or so
[22:58:24] <pcwalton> sorry
[22:58:27] <pcwalton> yeah, confuses me
[22:58:45] <pcwalton> nmatsakis: just de-@muted Block with Cell. no .borrow() or .mutate() used, so no dynamic borrow failures are possible.
[22:58:47] <pcwalton> yay!
[22:58:59] *** Joins: vfetwnuncszu (david@moz-AB8667CE.gyrae.net)
[22:59:06] *** vfetwnuncszu is now known as dcrewi
[22:59:39] <pcwalton> well, I guess there could technically be a dynamic borrow failure with .clone() but that won't happen
[23:04:37] <pcwalton> brson: r? https://github.com/mozilla/rust/pull/11060
[23:04:38] <pcwalton> jack: ^
[23:05:40] <acrichto> pcwalton: can a test be added for that?
[23:05:50] <pcwalton> acrichto: I don't know where it's really used
[23:05:57] <acrichto> serializing a trait boudn?
[23:06:03] <pcwalton> I guess by writing an external library that uses it?
[23:06:06] <acrichto> fn foo<T: Pod>() ?
[23:06:07] <acrichto> yeah
[23:06:09] <pcwalton> ok
[23:06:12] <acrichto> aux-build
[23:06:14] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[23:06:35] <brson> acrichto: this scheduler pool worked out really nice
[23:06:51] *** Joins: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP)
[23:07:05] <acrichto> brson: yay! I may end up having both spawn and spawn_opts for super covenience, but I also think it's fine for now
[23:07:17] <jack> pcwalton: needs the debugging addition on line 603: https://github.com/pcwalton/rust/commit/91945c6b7896edf1b863bd1c4ae0709812c215d2#diff-fcdbb6413438d3b568fe96fd242d8fc9R603
[23:08:47] <pcwalton> jack: ok
[23:08:57] <brson> acrichto: so librustuv doesn't depend on libgreen, except that it does when --test?
[23:09:14] <acrichto> brson: yeah but that's also only for stage0 
[23:09:35] <brson> acrichto: what's different in stage1?
[23:09:38] <acrichto> brson: it may end up doing that permanently though if we switch to 1:1 by default b/c librustuv really wants green threads...
[23:09:45] <acrichto> brson: the compiler knows to link to libgreen by default
[23:09:56] <acrichto> green/rustuv are injected unless #[no_uv] is present
[23:11:55] *** Quits: summerlight (summerligh@327FC32B.2C956A45.501EFF44.IP) (Ping timeout)
[23:16:23] <pcwalton> brson: re-r? https://github.com/mozilla/rust/pull/11060
[23:16:40] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[23:16:40] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 142357fb8 to 14c87b9d3: 02http://git.io/N3iJvQ
[23:16:40] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[23:16:40] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[23:16:40] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/WVhh3g
[23:16:40] <ghrust> 13rust/06auto 145d45170 15Corey Richardson: Add a rustdoc test...
[23:16:41] <ghrust> 13rust/06auto 1421bec4f 15Corey Richardson: rustdoc: thread through the context for rendering...
[23:16:41] <ghrust> 13rust/06auto 14b6933f8 15bors: auto merge of #11032 : cmr/rust/rustdoc_test, r=alexcrichton...
[23:16:43] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[23:17:51] <brson> is the `fn()` type a 'bare' Rust function now?
[23:18:15] <acrichto> brson: yes
[23:18:18] <acrichto> or at least I hope so
[23:18:21] <acrichto> b/c I was usingit
[23:18:37] <strcat> brson: I'm pretty sure 'extern "Rust" fn' doesn't actually work properly ;p
[23:18:44] <strcat> rusti: extern "Rust" fn() {}
[23:18:46] -rusti- pastebinned 6 lines of output: http://ix.io/9rG
[23:19:04] <strcat> rusti: let x: Option<extern "Rust" fn()> = None;
[23:19:04] -rusti- out.rs:9:12: 9:13 warning: unused variable: `x`, #[warn(unused_variable)] on by default
[23:19:05] -rusti- out.rs:9         let x: Option<extern "Rust" fn()> = None;
[23:19:05] -rusti-                      ^
[23:19:05] -rusti- ()
[23:19:07] <strcat> oh
[23:19:10] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[23:19:10] <ghrust> 01[13rust01] 15huonw 04force-pushed 06try from 148791327 to 14b906a8b: 02http://git.io/k471pw
[23:19:10] <ghrust> 13rust/06try 144c79b22 15Huon Wilson: std::vec: remove .as_imm_buf, replaced by .as_ptr & .len....
[23:19:10] <ghrust> 13rust/06try 149177f7e 15Huon Wilson: std::vec: remove .as_muf_buf, replaced by .as_mut_ptr & .len.
[23:19:11] <ghrust> 13rust/06try 1417ac2aa 15Huon Wilson: std::str: replace .as_imm_buf with .as_ptr.
[23:19:13] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[23:19:40] <dbaupp> rusti: extern "Rust" fn foo() {}
[23:19:42] -rusti- pastebinned 8 lines of output: http://ix.io/9rH
[23:19:59] <dbaupp> strcat: were you thinking of that^ one?
[23:20:02] <strcat> yes
[23:20:11] <strcat> it goes down the foreign ABI path
[23:20:18] <strcat> there are other places it can happen
[23:35:15] *** kimundi is now known as zz_kimundi
[23:37:05] *** Quits: bytewise (bytewise@moz-B7439A8C.adsl.alicedsl.de) (Quit: Leaving)
[23:38:24] *** Quits: jmbto (jmbto@moz-FE174E29.fbx.proxad.net) (Quit: Leaving)
[23:39:15] <brson> acrichto: i'm basically happy with the entire pr, but i'd like to hear your responses to my comments
[23:40:30] <acrichto> brson: cool, I will respond later tonight probably
[23:40:44] <acrichto> I'll also actually be in mtv tomorrow
[23:40:49] <acrichto> forgot I had a doctor's appointment today
[23:42:49] <acrichto> brson: also thanks for looking at all that! I know it wasn't easy
[23:45:27] <brson> acrichto: i recommend valgrinding before landing that, just to be sure
[23:45:36] <acrichto> good point
[23:45:42] <acrichto> it just passed all of try!
[23:45:43] <acrichto> ya
[23:45:44] <acrichto> yay
[23:46:00] <acrichto> I have a boatload of test fixes in a commit right now
[23:46:11] <acrichto> I'll talk with you tomorrow about this, then force push again so you can see them all
[23:46:57] <cmr> https://github.com/mozilla/rust/pull/10460 is updated.
[23:50:03] <acrichto> lol :suirrel:
[23:50:06] <acrichto> squirrel
[23:54:01] <brson> cmr: does your guard page patch eliminate __morestack or is it just for C?
[23:54:25] <cmr> brson: just for C.
[23:54:56] <brson> cmr: what does it take to eliminate __morestack, touching every page of stack in our stack frames?
[23:55:27] <cmr> brson: So, gcc -fstack-check will do different things depending on the size of the functions' stack frame.
[23:55:43] <cmr> it will either probe below the stack by an amount by writing a zero, or it will touch every page.
[23:55:54] <cmr> (up to some limit n I think, the docs aren't very clear)
[23:56:11] <strcat> llvm needs to be taught that
[23:56:24] <strcat> then we can have stack safety for basically free
[23:58:53] <cmr> on windows, they do what we do but call it __chkstk and not __morestack. chkstk will touch every page and NT will grow its stack, if it requires more than a page of stack.
[23:59:19] <cmr> (well, kinda. it doesn't actually check the stack limits)
