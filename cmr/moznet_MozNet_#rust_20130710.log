[00:00:50] *** Quits: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com) (Ping timeout)
[00:02:27] *** Joins: olleharstedt (Thunderbir@moz-80D8890F.ias.bredband.telia.com)
[00:02:45] *** Joins: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com)
[00:03:23] <strcat> graydon: well there are some valgrind features you could turn off
[00:03:31] <strcat> --vgdb=no, if you aren't already
[00:03:48] <strcat> it says it slows it down noticeably and it's not like buildbot is going to attach a gdb
[00:04:38] *** Joins: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP)
[00:05:08] *** Quits: maxli (maxli@B5559308.9C54E60.2FA4EA88.IP) (Quit: Leaving.)
[00:05:28] <nmatsakis> pcwalton: well, it's a good point, there is definitely an interaction, and it's not obvious to me how to address it.
[00:05:37] <pcwalton> nmatsakis: it seems we're drawn inexorably toward having copy constructors in the language, giving up on moving GC into the library, or requiring .clone() for GC pointers.
[00:05:51] <nmatsakis> pcwalton: I don't really get how clone is involved with this
[00:05:51] <pcwalton> I'm leaning toward the third, as much as it worries me
[00:06:08] <pcwalton> if you had .clone() on @ then it could implement the barriers
[00:06:12] <nmatsakis> ?
[00:06:20] <pcwalton> because you can implement the barriers imprecisely without worrying about the referrer
[00:06:28] <nmatsakis> but who is calling clone and why?
[00:06:45] *** Quits: olleharstedt (Thunderbir@moz-80D8890F.ias.bredband.telia.com) (Ping timeout)
[00:06:55] <nmatsakis> pcwalton: I guess I didn't follow what you wrote earlier
[00:07:02] <graydon> oh, it slows things down? huh
[00:07:26] <steven_is_false> To merg all my commits since master into my latest commit I do rebase -i master, and mark the previous commits as what?
[00:07:41] <sfackler> squash
[00:07:43] <pcwalton> nmatsakis: whenever copying an @ pointer the programmer must write .clone()
[00:07:49] <graydon> that's unfortnuate
[00:07:57] <steven_is_false> sfackler: Thanks.
[00:08:02] <strcat> steven_is_false: you want to reapply your commits on top of the latest master?
[00:08:09] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[00:08:30] <pcwalton> nmatsakis: mind you, I'm not sure about this either.
[00:08:38] <steven_is_false> strcat: I have a bunch of stupid commits like "Fixes", "More Fixes" etc.., and I want to make things nicer.
[00:08:41] <engla> steven_is_false: you mark all but the oldest commits squash, the first commit in the rebase sequence should be pick
[00:08:43] <pcwalton> because I don't know whether we can *really* get away with not knowing the color of the referrer
[00:08:46] <pcwalton> color and generation
[00:09:02] <ChrisMorgan> There, finished my comments-without-leaders indent fixes: https://github.com/mozilla/rust/pull/7676
[00:09:03] <steven_is_false> Thanks.
[00:10:04] <nmatsakis> pcwalton: oh, I see. That doesn't sound especially appealing, no.
[00:10:24] <pcwalton> nmatsakis: keep in mind it's the price you pay on Rc too
[00:10:28] <pcwalton> which is kind of unfortunate
[00:10:46] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[00:10:48] <pcwalton> but maybe not, as it encourages you to minimize reference count traffic
[00:10:51] <nmatsakis> pcwalton: it's not completely clear to me that we need inc+generational, but it is sad to rule them out. frustrating how GC interacts so non-orthogonally
[00:10:56] <pcwalton> and likewise, barrier traffic.
[00:12:04] <pcwalton> my biggest worry is that we decide to implement inc+gen later and then get in trouble because now @ becomes non-IC
[00:13:18] <dherman> hey, for those who were either in our meeting this morning or who've read the minutes, I wanted to apologize for getting kinda heated -- I just wanted to make sure we were thinking through the consequences of the issue carefully
[00:13:53] *** Quits: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP) (Ping timeout)
[00:13:54] <dherman> I assure you I'm not angry and I'm just as fully in love with this group as ever ;-)
[00:13:57] <olsonjeffery> you could say that growable stacks have.. ahem.. segmented the community!
[00:14:06] <cmr> olsonjeffery: ... you are a terrible person
[00:14:18] <dherman> olsonjeffery: nah
[00:14:25] <dherman> and thbbthplbth
[00:15:32] *** Joins: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net)
[00:15:33] *** Joins: vcl (chatzilla@741D4FEA.76F9E272.DA40C4B3.IP)
[00:16:06] *** Quits: wilsonk|2 (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[00:17:35] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[00:19:13] *** Quits: bnicholson (bnicholson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[00:20:51] *** Quits: etw (john@moz-B2936CAB.nyc.res.rr.com) (Quit: etw)
[00:21:37] *** Joins: jgilbert_ (jgilbert@2557E599.66715431.D25A875A.IP)
[00:22:19] *** Quits: jgilbert (jgilbert@2557E599.66715431.D25A875A.IP) (Ping timeout)
[00:22:38] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[00:22:50] *** Joins: etw (john@moz-B2936CAB.nyc.res.rr.com)
[00:24:21] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Quit: Leaving.)
[00:26:00] *** Quits: mib_h7fccf (Mibbit@moz-1FEAB537.ucsf.edu) (Quit: http://www.mibbit.com ajax IRC Client)
[00:28:11] *** Quits: brendan (brendaneic@2557E599.66715431.D25A875A.IP) (Quit: brendan)
[00:28:53] *** Joins: olleharstedt (Thunderbir@moz-80D8890F.ias.bredband.telia.com)
[00:29:19] *** Joins: brendan (brendaneic@2557E599.66715431.D25A875A.IP)
[00:29:31] *** Quits: doomlord (doomlod@moz-6651F8D4.range86-145.btcentralplus.com) (Ping timeout)
[00:29:58] <steven_is_false> There's been no work on making rustc parallel yet right?
[00:30:21] <aatch> dherman, (I just read the minutes) it's fine. I can understand the frustration. There's always going to be some tension between various facets of Rust
[00:30:30] <aatch> steven_is_false, no, because currently it's impossible
[00:30:36] <steven_is_false> okay.
[00:30:51] *** Joins: vk (vk@F92596F.2DEF7520.EF7679FA.IP)
[00:30:53] <aatch> unless you count me working to make it less impossible
[00:30:55] <dherman> aatch: I'm not at all opposed to the direction pcwalton was talking about, just wanted to make sure we were clear in laying out the competion constraints, and clear about any changes to the programming model
[00:31:05] <dherman> in the end it sounds like we're converging towards a rather conservative change
[00:31:14] <dherman> that doesn't change the programming model too radically
[00:31:17] <dherman> but we'll see
[00:31:49] <strcat> dherman: the actual check for stack overflow isn't that bad btw, that's just 2-5% overall
[00:32:10] <strcat> it's the allocation thrashing (or even just allocating and reducing cache locality by splitting things up) that really hurts
[00:32:16] <graydon> cmr aatch strcat whoever else was asking: incidentally I have taught bors to segregate exceptions from actual failures
[00:32:19] <graydon> when it posts responses
[00:32:27] <aatch> graydon, yay
[00:32:29] <graydon> if you don't see this in the next few failures, let me know
[00:32:43] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[00:32:44] <aatch> that should make it easier to find which bot failed.
[00:32:48] <graydon> yeah
[00:32:57] <aatch> (especially jumping out of an email... on my phone)
[00:33:00] <dherman> strcat: yeah, that's what pcwalton was explaining to me
[00:33:06] * jensnockert hugs graydon.
[00:33:08] <strcat> dherman: it's pretty common for people to ask about 3-5x perf hits on an upgrade, just because a few instructions got added/removed and there's now thrashing
[00:33:18] <jensnockert> graydon: You're the bestest!
[00:33:45] * strcat just wants to be able to reserve an initial segment size, and default to a big one
[00:33:52] *** Quits: Earnestly (earnest@2AB30F53.FB5005.2BCC804A.IP) (Ping timeout)
[00:34:23] *** Quits: brson (brson@2557E599.66715431.D25A875A.IP) (Quit: Lost terminal)
[00:34:24] <graydon> nah, bors is the bestest, I just change his oilpan and try to keep him running :)
[00:34:27] <strcat> I don't think it matters if it can grow or not, so it might as well always grow
[00:34:30] *** Quits: vk (vk@F92596F.2DEF7520.EF7679FA.IP) (Ping timeout)
[00:37:11] <pcwalton> so I think tentatively I am going to make @ noncopyable and see how much we hate it
[00:37:33] *** Joins: brson (brson@2557E599.66715431.D25A875A.IP)
[00:37:33] *** ChanServ sets mode: +o brson
[00:37:36] <pcwalton> if we hate it then we can decide what to do
[00:37:43] *** Quits: eholk (eholk@moz-511062AD.uconnect.utah.edu) (Quit: eholk)
[00:37:53] *** Quits: etw (john@moz-B2936CAB.nyc.res.rr.com) (Quit: etw)
[00:37:56] <jensnockert> aatch: No idea what was broken, but something in my code made the compiler break, I managed to fix it, so it builds now at least. I probably used some silly Rust somewhere.
[00:38:01] <pcwalton> the options are probably "build @ into the compiler and make its 'take glue' a lang item" or "copy constructors"
[00:38:08] *** Joins: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net)
[00:38:27] <pcwalton> we need to get rid of the @ pattern in this case
[00:38:50] <strcat> pcwalton: we could reuse 'in' for that if we reserve it to do 'for'
[00:39:00] <pcwalton> I mean the other @ pattern
[00:39:06] <pcwalton> match whatever { @Foo { ... } }
[00:39:10] <pcwalton> gotta bump the ref count
[00:39:10] <strcat> oh, right
[00:39:39] <strcat> wait what does an @ pattern actually do?
[00:39:48] <strcat> let ~x = y; moves out of y
[00:39:50] <pcwalton> bumps the ref count and possibly extends the borrow lifetime I believe
[00:39:54] <pcwalton> you can only use ref
[00:39:58] <strcat> ah
[00:40:04] <pcwalton> for the bindings inside
[00:40:08] <pcwalton> unless they're implicitly copyable.
[00:40:11] * strcat forgot about that
[00:41:01] <shachaf> aatch: process_status?
[00:41:12] <shachaf> aatch: Oh, that was schala, not me.
[00:41:24] <shachaf> hion
[00:41:43] <pcwalton> I like the idea of Copy => POD
[00:41:50] <pcwalton> except for * I guess
[00:41:55] <pcwalton> and &
[00:41:58] <pcwalton> well, POD in a sense
[00:42:05] <pcwalton> Copy + 'static is POD except for *
[00:43:20] <aatch> pcwalton, I'm ok with "ignoring" raw pointers in these cases. For the purposes of how they move/copy I tend to think of them as just uints.
[00:45:36] *** Quits: brendan (brendaneic@2557E599.66715431.D25A875A.IP) (Quit: brendan)
[00:46:17] *** Joins: etw (john@moz-B2936CAB.nyc.res.rr.com)
[00:49:11] <strcat> pcwalton: I think private fields have to make something non-POD anyway
[00:49:37] <strcat> for it to be a useful bound
[00:51:42] *** Quits: etw (john@moz-B2936CAB.nyc.res.rr.com) (Quit: etw)
[00:52:05] *** Joins: etw (john@moz-B2936CAB.nyc.res.rr.com)
[00:52:18] *** Joins: vk (vk@F92596F.2DEF7520.EF7679FA.IP)
[00:52:53] <graydon> brson: I'm going to make buildbot run the valgrind hosts with RUST_THREADS=1, is that ok?
[00:53:18] *** Quits: olleharstedt (Thunderbir@moz-80D8890F.ias.bredband.telia.com) (Ping timeout)
[00:53:34] <graydon> I believe that will get aatch's snapshot through, and possibly speed up V cycle time in general
[00:53:41] <aatch> graydon, yay
[00:53:50] * aatch just wants a snapshot
[00:54:10] *** Quits: vk (vk@F92596F.2DEF7520.EF7679FA.IP) (Ping timeout)
[00:54:43] * graydon sets it so for now. brson / anyone else who's wrestling this stuff, if you want to change it back, or need to because something breaks, feel free
[00:55:19] <graydon> aatch: shall I restart your build?
[00:55:34] <aatch> graydon, that would be nice thanks
[00:55:47] <graydon> I've also upgraded valgrind on that machine
[00:55:59] <graydon> hopefully the new one supports a strict superset of the features of the old one!
[00:56:12] <brson> graydon: yes
[00:56:43] <graydon> aatch: restarted http://buildbot.rust-lang.org/builders/snap3-linux/builds/481
[00:56:52] <aatch> graydon, thank you
[00:58:35] <graydon> ok, going out for some chores, back in a while
[00:59:31] *** Joins: Lovot (root@AE31FB56.8153C3BF.F3C9A2D9.IP)
[00:59:42] *** Parts: Lovot (root@AE31FB56.8153C3BF.F3C9A2D9.IP) ()
[01:01:07] <bjz> Luqman: ping
[01:01:58] <strcat> hrm, it doesn't seem to realize the 2 bots reconnected and ran builds
[01:01:59] *** Quits: khyperia (khyperia@moz-AF00B41A.hsd1.in.comcast.net) (Quit: Leaving)
[01:02:13] <strcat> oh one isn't finished
[01:02:15] <strcat> we'll see
[01:02:32] <Luqman> bjz: pong
[01:03:45] <bjz> Luqman: we might need to update rray
[01:03:58] <bjz> Luqman: I reworked lmath a bit
[01:05:50] *** Quits: igl (igl@moz-A7FB5E5F.adsl.alicedsl.de) (Ping timeout)
[01:06:13] <Luqman> bjz: yep
[01:06:28] <bjz> Luqman: ould be interesting to get feedback
[01:06:45] <bjz> Luqman: I'm adding more functionality, but it's behind cfgs
[01:06:50] *** Joins: igl (igl@moz-FDB308E6.adsl.alicedsl.de)
[01:06:50] <strcat> hm
[01:06:54] <Luqman> bjz: to lmath?
[01:07:03] <bjz> Luqman: so the user doesn't need to build everything
[01:07:04] * strcat will fix with_capacity to do 1 allocation
[01:07:19] <bjz> Luqman: yeah, colors, geometry, projection
[01:07:34] <Luqman> bjz: ah, sweet
[01:07:52] <bjz> Luqman: hopefully spatial partitioning in the future, but that's beyond my skills atm
[01:08:35] <bjz> Luqman: might have to rename it *again*
[01:08:53] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[01:09:00] <bjz> Luqman: seeing as it's becoming more general than just linear algebra
[01:09:02] <indutny> hoya
[01:09:13] *** Quits: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP) (Quit: Leaving)
[01:09:15] <bjz> Luqman: maybe to 'cgm' or something
[01:09:25] * bjz waves at indutny
[01:09:26] <strcat> ' If ptr is a null pointer, realloc() behaves like malloc() for the specified size. '
[01:09:27] *** Quits: josh (josh@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: josh)
[01:09:28] <strcat> I forgot about this
[01:09:30] <strcat> that makes my life easy
[01:09:43] <indutny> cmr: we did it! :)
[01:09:46] <indutny> hehe
[01:09:48] <indutny> bjz: ohai
[01:10:06] <bjz> Luqman: I don't want to bloat things, but I think a lib like this would be super useful
[01:10:56] *** Quits: doomlord_ (servitor@moz-6651F8D4.range86-145.btcentralplus.com) (Ping timeout)
[01:11:01] *** dherman is now known as dherman-family
[01:12:06] *** Joins: xLII (xLII@2433BC90.F5F53E8A.2D6DB75E.IP)
[01:15:43] *** Joins: dbaupp (Thunderbir@moz-712A1135.lns20.syd6.internode.on.net)
[01:17:33] *** Quits: smvv_ (sander@moz-BAEA8EB2.dynamic.upc.nl) (Ping timeout)
[01:18:28] *** Quits: posco (oscarboyki@636AC086.5999CED5.71743E61.IP) (Quit: posco)
[01:19:08] *** Joins: smvv_ (sander@moz-BAEA8EB2.dynamic.upc.nl)
[01:20:03] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[01:20:22] *** Joins: ssbr (ssbr@moz-141F89C6.block0.gvtc.com)
[01:22:53] *** Quits: xLII (xLII@2433BC90.F5F53E8A.2D6DB75E.IP) (Ping timeout)
[01:24:04] *** Joins: scanlonman (scanlonman@moz-169BC238.hsd1.wa.comcast.net)
[01:24:36] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[01:25:14] *** Quits: glinscott (garylinsco@789A6618.53EB7C1.FFFE3AA.IP) (Quit: glinscott)
[01:25:27] *** Joins: glinscott (garylinsco@789A6618.53EB7C1.FFFE3AA.IP)
[01:25:51] *** Quits: scanlonman (scanlonman@moz-169BC238.hsd1.wa.comcast.net) (Ping timeout)
[01:25:59] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[01:25:59] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Ol0HRw
[01:25:59] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[01:27:51] *** Joins: scanlonman (scanlonman@moz-169BC238.hsd1.wa.comcast.net)
[01:28:47] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[01:28:47] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/pdXT9Q
[01:28:47] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[01:28:49] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[01:28:49] <ghrust> 01[13rust01] 15bors pushed 129 new commits to 06auto: 02http://git.io/Xn-t2A
[01:28:49] <ghrust> 13rust/06auto 1429d8300 15Brian Anderson: core::rt: Move uv idle tests to idle mod
[01:28:49] <ghrust> 13rust/06auto 148072690 15Brian Anderson: core::rt: Add bindings for async uv handles
[01:28:50] <ghrust> 13rust/06auto 146d8d73c 15James Miller: Add AtomicUint newtype
[01:28:51] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[01:29:43] <bjz> Luqman: I also have to figure out perlin/simplex noise :)
[01:30:37] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[01:30:43] <aatch> bjz, I once actually found the general formula for simplex noise over n-dimensions.
[01:30:55] <bjz> ooh
[01:31:06] <aatch> since everywhere uses simplified versions for that specific dimension
[01:31:20] <aatch> the annoying thing is that I have no idea what it is, or where I found it...
[01:31:43] <bjz> if you're interested: https://github.com/bjz/lmath-rs/tree/master/src/noise
[01:31:50] <bjz> aatch: dang
[01:32:26] <dbaupp> I believe there's a perlin noise implementation in test/bench/<something>
[01:32:51] <bjz> aatch: I'm thinking I'll just have {Perlin,Simplex}{1,2,3}
[01:33:08] <bjz> dbaupp: yup, I saw :)
[01:33:36] <tjc> graydon: r? https://github.com/mozilla/rust/pull/7681
[01:33:41] <bjz> dbaupp: still trying to figure it out :P
[01:33:51] * bjz is stupid
[01:34:08] <bjz> x)
[01:34:20] <aatch> bjz, you may have already seen this, but: http://webstaff.itn.liu.se/~stegu/simplexnoise/simplexnoise.pdf
[01:34:43] <bjz> ahh, cheers
[01:35:27] <bjz> aatch: as you know, I need some noise for my project that I'm meant to be doing
[01:35:41] * bjz finds himself writing libs as usual
[01:35:43] <aatch> I read it a while back and the explanation is pretty good, though their implementation sucks (researchers...)
[01:36:21] <bjz> aatch: yeah, I probably really need to work on the performance of lmath
[01:36:36] <bjz> aatch: probably lots of copies going on
[01:36:49] *** Joins: fabiand_ (fabiand@moz-C17D01C9.adsl.alicedsl.de)
[01:36:56] <dbaupp> aatch: (also, their use of a proportional font for source code :'( )
[01:37:05] <aatch> dbaupp, I know...
[01:37:25] <aatch> And in Java
[01:37:38] *** Quits: fabiand (fabiand@moz-EE35EF02.adsl.alicedsl.de) (Ping timeout)
[01:38:44] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[01:38:54] *** Quits: tjc (tjc@2557E599.66715431.D25A875A.IP) (Quit: Places to go, people to annoy)
[01:39:46] <sully> strcat: you file it?
[01:39:52] <strcat> sully: yeah
[01:40:01] <strcat> sully: https://github.com/mozilla/rust/issues/7675
[01:40:13] <bjz> aatch: there are also implementations in glm, but they are a tad impenetrable
[01:40:38] <aatch> bjz, true
[01:42:48] <aatch> Aha, found it. (It's the skew factor to align the simplex grid to a cube grid)
[01:43:13] <aatch> (sqrt(n) - 1) / n
[01:44:18] <aatch> Oh, (sqrt(n+1) - 1) / n sorry. It's scaling along a vector, with the vector being {1,1,1...} and the factor as 1/sqrt(n+1)
[01:45:16] <aatch> Thats the unskew actually, the skew factor is just 1/unskew
[01:45:36] <aatch> (I think)
[01:49:40] *** Quits: brson (brson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[01:58:49] *** Quits: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP) (Quit: carllerche)
[02:02:28] *** Joins: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP)
[02:02:37] *** Quits: azakai (alon@2557E599.66715431.D25A875A.IP) (Ping timeout)
[02:03:09] *** Joins: brendan (brendaneic@moz-34901463.public.wayport.net)
[02:05:54] *** Quits: brendan (brendaneic@moz-34901463.public.wayport.net) (Quit: brendan)
[02:06:59] *** Quits: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Ping timeout)
[02:08:09] *** Quits: zz_kimundi (kimundi@moz-2F11D3AF.dip0.t-ipconnect.de) (Ping timeout)
[02:08:51] *** Joins: erickt1 (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[02:10:32] *** Quits: erickt1 (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[02:11:50] *** Quits: donri (dag@moz-9BB61102.tbcn.telia.com) (Client exited)
[02:12:12] *** Joins: zz_kimundi (kimundi@moz-90EBCCBC.dip0.t-ipconnect.de)
[02:12:29] *** zz_kimundi is now known as kimundi
[02:12:31] *** Quits: dherman-family (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman-family)
[02:13:23] *** Joins: josh (josh@moz-BE33DA21.fw1.sfo1.mozilla.net)
[02:13:38] *** Joins: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP)
[02:13:46] *** Quits: etw (john@moz-B2936CAB.nyc.res.rr.com) (Quit: etw)
[02:13:55] *** Joins: doomlord_ (servitor@moz-13E69BC8.range86-180.btcentralplus.com)
[02:14:44] *** Quits: Jesin (Jessin_@moz-48B48C95.eecs.lehigh.edu) (Quit: Leaving)
[02:15:18] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[02:18:07] <bjz> fn opposite(theta: f64) -> f64 { (theta + 180.0) % 360.0 } (opposite(180.0), opposite(45.0), opposite(30.0), opposite(0.0))
[02:18:12] <bjz> rusti: fn opposite(theta: f64) -> f64 { (theta + 180.0) % 360.0 } (opposite(180.0), opposite(45.0), opposite(30.0), opposite(0.0))
[02:18:13] -rusti- (0, 225, 210, 180)
[02:19:39] <bjz> fn opposite(theta: f64) -> f64 { (theta + 180.0) % 360.0 } (opposite(180.0), opposite(45.0), opposite(30.0), opposite(0.0), opposite(720.0))
[02:19:47] <bjz> rusti: fn opposite(theta: f64) -> f64 { (theta + 180.0) % 360.0 } (opposite(180.0), opposite(45.0), opposite(30.0), opposite(0.0), opposite(720.0))
[02:19:48] -rusti- (0, 225, 210, 180, 180)
[02:19:51] *** Joins: jfbk (user@moz-EEA9CFB3.nyc.res.rr.com)
[02:19:51] <Jeaye> bjz: pong
[02:19:58] <bjz> dbaupp: does that look right?
[02:20:16] <bjz> Jeaye: have you looked at the osx issue again?
[02:20:32] <Jeaye> The mouse issue?
[02:20:36] <bjz> Jeaye: I've noticed activity on the glfw repo that seems to be related
[02:20:56] <bjz> Jeaye: ya
[02:21:19] <steven_is_false> So I have a hang on testing when more than one thread is used so I can't use the RUST_THREAD=1 trick. How can I debug this hang?
[02:21:21] <Jeaye> I'm updating Rust and my submodules as we speak, so we'll see. :)
[02:22:14] <Jeaye> steven_is_false: If worst comes to worst, debug! or println the shit out of everything. :(
[02:22:14] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[02:22:48] <Jeaye> Speaking of which, we still don't have debug-info right?
[02:22:58] <Jeaye> But should by the end of the summer?
[02:23:05] *** Quits: josh (josh@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: josh)
[02:23:17] <steven_is_false> Jeaye: We have -Z debug-info working at a basic level only.
[02:23:43] *** Joins: ilyoan (ilyoan@B4104EBB.3CC170B1.1E14B209.IP)
[02:24:26] <steven_is_false> :( :( :( :( :( :( :( :( 
[02:25:31] <dbaupp> bjz: yeah (except for using degrees rather than radians ;P )
[02:25:47] <bjz> dbaupp: it's for HSV
[02:25:55] <dbaupp> steven_is_false: do you know which test it is?
[02:26:08] <dbaupp> bjz: don't care... always radians :P
[02:26:14] <strcat> dbaupp: https://github.com/mozilla/rust/pull/7682 r?
[02:26:17] * dbaupp is joking
[02:26:27] <bjz> dbaupp: It's going to be FloatChannel::invert_degrees(&self) -> Self
[02:26:34] <dbaupp> strcat: yay, finally!
[02:26:46] * bjz wishes we had units of measure
[02:26:54] * bjz will shut up now
[02:26:54] <dbaupp> strcat: r+
[02:27:25] <steven_is_false> dbaupp: Not sure but it's probable one of the ones dealing with rwarc values.
[02:27:50] <bjz> Jeaye: if you inver a HSVA, would you invert the alpha channel as well?
[02:28:02] <dbaupp> steven_is_false: you can filter the tests with TESTNAME=foo (if you're using make) or ./testrunner foo (if you're compiling the crate directly)
[02:28:23] <dbaupp> steven_is_false: and it does a substring match, so `make check TESTNAME=rwarc` might help
[02:28:26] <steven_is_false> dbaupp: I'll look into that
[02:28:43] <Jeaye> bjz: HSVA?
[02:28:47] <pcwalton> removed "copy" from the language and it seems to be bootstrapping
[02:28:48] <bjz> Jeaye: same with clamp
[02:28:57] <bjz> Jeaye: HSVA/RGBA
[02:28:59] <strcat> dbaupp: yeah it will make from_elem about 2x faster too
[02:29:11] <strcat> this was the main cost
[02:29:28] <Jeaye> bjz: I'd imagine so, yes.
[02:29:31] <dbaupp> strcat: yeah it seemed stupid... malloc(0) then malloc(capacity)
[02:29:37] <dbaupp> s/seemed/was/
[02:29:39] <strcat> dbaupp: well not malloc(0)
[02:29:49] <dbaupp> strcat: "close to 0" ;P
[02:29:54] <Jeaye> pcwalton: kickass
[02:30:13] <strcat> malloc(size_of::<VecRepr>() + 4 * sizeof::<T>())
[02:30:33] <strcat> and VecRepr is 5 words, because it has the 4 word useless box header
[02:30:45] <strcat> err 6 words*
[02:30:48] <strcat> fill + alloc + header
[02:31:00] * strcat will remove that after the next snap
[02:31:07] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[02:31:55] *** Quits: RMF (RMF@moz-4C4EB011.dsl.telepac.pt) (Quit: Textual IRC Client: www.textualapp.com)
[02:32:04] <strcat> dbaupp: https://github.com/mozilla/rust/issues/7136 ;p
[02:32:09] <strcat> let me make some new numbers for it...
[02:33:16] *** Quits: pcwalton (pcwalton@43CB6079.66715431.D25A875A.IP) (Quit: .)
[02:33:24] <strcat> dbaupp: https://github.com/mozilla/rust/issues/7136#issuecomment-20718261
[02:34:00] <strcat> I could make a POD concept and teach it to use calloc too
[02:34:16] <strcat> then it will use lazy allocation for large zeroed vectors
[02:34:50] <strcat> because mmap hands you zeroed pages, so calloc can use lazy allocation of zeroed things.
[02:35:09] <dbaupp> strcat: nice
[02:35:42] <dbaupp> strcat: (why are the other 2 also faster?)
[02:36:12] <Luqman> dbaupp: they get optimized to a memset afaik
[02:36:38] <dbaupp> Luqman: I mean, they are faster in the after compared to the before
[02:36:55] <strcat> dbaupp: from_elem uses with_capacity
[02:37:11] <strcat> the last one is just faster because the benchmarking is imperfect and doesn't clear the cached allocations afaict
[02:37:21] *** Joins: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net)
[02:37:22] *** ChanServ sets mode: +o dherman
[02:37:24] * strcat shrugs
[02:38:53] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[02:39:11] *** Joins: brson (brson@5F06B402.AD1E507F.3688B332.IP)
[02:39:11] *** ChanServ sets mode: +o brson
[02:39:39] <dbaupp> strcat: oh, right, set_memory also uses with_capacity
[02:41:45] *** Quits: dwhyte (dwhyte@ED9190FB.B72E355F.7BF4A4B0.IP) (Ping timeout)
[02:42:05] <strcat> dbaupp: inching closer to "perfect" vectors ;p
[02:42:33] <strcat> non-managed unique pointers are as good as they'll get now
[02:42:37] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[02:43:42] <Jeaye> bjz: Still busted on OS X.
[02:44:07] <Jeaye> Nilium knows about it, too.
[02:44:50] *** Joins: uvtc (john@moz-DA4AEF0A.dyn.optonline.net)
[02:45:03] <bjz> :(
[02:46:59] <uvtc> Hi #rust. I was just taking another peek at this short wiki page: <https://github.com/mozilla/rust/wiki/Doc-packaging-terminology>. Just curious: has anything changed much regarding that terminology since 0.7?
[02:47:42] *** Joins: dwhyte (dwhyte@ED9190FB.B72E355F.7BF4A4B0.IP)
[02:48:24] <SiegeLord> uvtc: I think it's still accurate
[02:48:34] <jensnockert> Woho, now I have new syntax for SIMD, and it even pretty prints \o/
[02:48:39] <strcat> jensnockert: nice
[02:48:45] <uvtc> Thanks, SiegeLord .
[02:48:58] <jensnockert> strcat: Now I just need to make it a proper type, not a bastardized struct.
[02:49:21] <bjz> jensnockert: woooo
[02:49:34] *** Quits: smvv_ (sander@moz-BAEA8EB2.dynamic.upc.nl) (Ping timeout)
[02:49:42] <bjz> jensnockert: do you reckon we could get SIMD into lmath?
[02:49:59] <jensnockert> bjz: As in, SIMD-accelerating it?
[02:50:00] * bjz doesn't have much experience with it
[02:50:03] *** Joins: xLII (xLII@2433BC90.F5F53E8A.2D6DB75E.IP)
[02:50:04] <bjz> jensnockert: aye
[02:50:06] <jensnockert> bjz: Yes, I think so.
[02:50:09] <uvtc> SiegeLord, do you happen to know if any major-ish changes are on the way for how libs/crates/packages/etc. are handled in Rust?
[02:50:38] <SiegeLord> uvtc: None that I'm aware of
[02:50:59] <jensnockert> bjz: My idea is that it should just be to define a simd-type with `simd!(f32x4: f32 * 4)` and then run with it.
[02:51:04] <uvtc> Ok, thanks a bunch, SiegeLord.
[02:51:33] <dbaupp> jensnockert: isn't the current implementation essentially that?
[02:51:50] <bjz> #[simd] ?
[02:51:57] <jensnockert> dbaupp: Except that the current implementation doesn't allow you to actually do anything with a SIMD type.
[02:52:02] <strcat> dbaupp: I wonder what other low-hanging optimization stuff there is...
[02:52:09] <jensnockert> dbaupp: It is just a struct without members.
[02:52:30] <dbaupp> jensnockert: yeah, I thought the #[simd] could go on any struct?
[02:52:52] <dbaupp> rusti: #[simd] struct f64x2 { a: f64, b: f64 }
[02:52:53] -rusti- ()
[02:53:01] <bjz> jensnockert: it would be nice if you could apply simd to an arbritrary type
[02:53:08] <dbaupp> rusti: #[simd] enum Foo { A, B }
[02:53:09] -rusti- ()
[02:53:20] <bjz> jensnockert: with te correct size, obviously
[02:53:24] * dbaupp doesn't think that was a good test
[02:53:36] <strcat> bjz: LLVM's slp vectorizer should be production ready by llvm 3.4 btw
[02:53:46] <strcat> it vectorizes series of scalar ops
[02:53:47] <jensnockert> rusti: #[simd] struct f64x2 { a: f64, b: u64 }
[02:53:48] -rusti- <anon>:7:17: 7:48 error: SIMD vector should be homogeneous
[02:53:48] -rusti- <anon>:7          #[simd] struct f64x2 { a: f64, b: u64 }
[02:53:48] -rusti-                           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[02:53:48] -rusti- error: aborting due to previous error
[02:53:48] -rusti- application terminated with error code 101
[02:53:51] <strcat> instead of just loops
[02:54:05] <bjz> strcat: ooh
[02:54:07] <dbaupp> oh, maybe simd is just ignored on enums
[02:54:16] <jensnockert> dbaupp: Yeah, is only checked on structs.
[02:54:20] <dbaupp> strcat: don't know... I imagine there is a lot in str
[02:54:29] <dbaupp> strcat: str::raw (and vec::raw)
[02:54:56] <jensnockert> dbaupp, strcat, bjz: But SIMD is kind of useless without hardware, so any type that isn't bool, integer or float would be pointless.
[02:55:11] <bjz> rusti: #[simd] struct(f64,f64,f64,f64)
[02:55:12] -rusti- <anon>:7:23: 7:24 error: expected ident, found `(`
[02:55:12] -rusti- <anon>:7          #[simd] struct(f64,f64,f64,f64)
[02:55:12] -rusti-                                 ^
[02:55:12] -rusti- application terminated with error code 101
[02:55:13] <dbaupp> jensnockert: (yeah, I agree)
[02:55:15] <steven_is_false> rusti: #[simd] struct Color<T> { r: T, g: T, b: T, a: T }
[02:55:16] -rusti- <anon>:7:17: 7:59 error: SIMD vector cannot be generic
[02:55:16] -rusti- <anon>:7          #[simd] struct Color<T> { r: T, g: T, b: T, a: T }
[02:55:16] -rusti-                           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[02:55:16] -rusti- error: aborting due to previous error
[02:55:16] *** concrete.mozilla.org sets mode: +M 
[02:55:18] -rusti- application terminated with error code 101
[02:55:22] <bjz> rusti: #[simd] struct A (f64,f64,f64,f64)
[02:55:23] -rusti- <anon>:8:4: 8:5 error: expected `;` but found `}`
[02:55:23] -rusti- <anon>:8     };
[02:55:23] -rusti-              ^
[02:55:25] -rusti- application terminated with error code 101
[02:55:27] <bjz> rusti: #[simd] struct A (f64,f64,f64,f64);
[02:55:28] -rusti- ()
[02:55:31] <bjz> rusti: #[simd] struct A (f64,f64,f64);
[02:55:32] -rusti- ()
[02:55:38] <bjz> :/
[02:55:58] <bjz> jensnockert: of course
[02:55:58] <strcat> bjz: they actually have instructions for doing things like dot products
[02:56:16] <strcat> but they aren't always faster than building it up with lower level ops
[02:56:27] <strcat> because they implement a lot in cpu microcode anyway
[02:57:37] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[02:57:48] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Ping timeout)
[02:57:54] <strcat> SSE4.1 adds double-precision (for 2 elements; DPPD) and single-precision dot prod-
[02:57:56] <strcat> ucts (for up to 4 elements; DPPS).
[02:57:58] <strcat> These dot-product instructions include source select and destination broadcast which
[02:57:59] *** Parts: uvtc (john@moz-DA4AEF0A.dyn.optonline.net) ()
[02:58:00] <strcat> generally improves the usability. For exampl
[02:58:02] <strcat> e, a single DPPS instruction can be used
[02:58:04] <strcat> for a 2, 3, or 4 element dot product.
[02:58:06] <strcat> heh pdfs do not like copy-paste
[02:58:21] <strcat> anyway it'd be nice if LLVM could hurry up and finish the slp vectorizer
[02:58:33] <strcat> it's the only major thing they're still behind on compared to gcc
[02:58:59] <strcat> it's new anyway
[02:59:01] <jensnockert> OpenMP support etc.
[02:59:24] <strcat> jensnockert: openmp is essentially language frontend stuff though
[02:59:35] <strcat> won't help rust ;p
[02:59:51] <jensnockert> strcat: Would help Rust if we added support for it to Rust ;)
[03:00:01] <strcat> jensnockert: rust can do better than it
[03:00:17] <jensnockert> strcat: Not with Tasks.
[03:00:19] *** concrete.mozilla.org sets mode: -M 
[03:00:23] <strcat> jensnockert: sure, not with tasks
[03:00:30] <strcat> but data parallelism is going to take a lot of work anyway
[03:00:36] <strcat> &mut aliases @mut and &const
[03:00:46] <strcat> otherwise, you could use &mut for data parallelism
[03:00:48] <steven_is_false> So what's the difference between #[simd] struct foo(f32);, and f32?
[03:00:59] <jensnockert> steven_is_false: You can add f32.
[03:01:24] <dbaupp> steven_is_false: (#[simd] does nothing yet.)
[03:01:31] <steven_is_false> dbaupp: Oh, okay then.
[03:01:41] <jensnockert> steven_is_false: It just tells LLVM to put it inside of a vector.
[03:02:35] <steven_is_false> okay
[03:02:44] *** Joins: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP)
[03:04:06] <bjz> Jeaye: thanks for following it up with the glfw guys - as I've said, I'll need it in the future
[03:05:08] *** Quits: jfbk (user@moz-EEA9CFB3.nyc.res.rr.com) (Ping timeout)
[03:06:49] *** Quits: dherman (dherman@moz-6CA476B1.hsd1.ca.comcast.net) (Quit: dherman)
[03:09:25] *** Joins: erickt1 (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[03:09:36] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[03:11:08] *** Quits: erickt1 (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[03:12:33] *** Joins: sankha93 (Instantbir@A7679ECF.199B3CEE.EFB84E89.IP)
[03:12:36] <jensnockert> steven_is_false: In the future, I hope you should be able to do awesome feats of magic on SIMD vectors. Like let r = a.even; or let r = a.lo + a.hi; and similar feats of swizzling around.
[03:12:45] <jensnockert> steven_is_false: And all the normal numeric operations.
[03:12:54] *** Quits: xLII (xLII@2433BC90.F5F53E8A.2D6DB75E.IP) (Ping timeout)
[03:12:55] <steven_is_false> That's good.
[03:14:06] *** Quits: aatch (aatch@moz-B437F499.pocketrent.com) (Client exited)
[03:14:16] <steven_is_false> I'm a bit worried that the simd stuff is going to be too magical.
[03:14:30] <bjz> why?
[03:14:49] <steven_is_false> bjz: I don't like magic.
[03:14:59] <dbaupp> steven_is_false: (this is inspired by the opencl api, I believe.)
[03:15:04] <bjz> neither
[03:15:13] <bjz> but what is magical about it?
[03:15:23] <steven_is_false> dbaupp: I have plenty of experience with GLSL so I know what is being attempted.
[03:15:31] <dbaupp> steven_is_false: oh, ok :)
[03:15:46] *** Quits: carllerche (carllerche@6B070D22.7E6A0813.1428D117.IP) (Quit: carllerche)
[03:16:00] * jensnockert hugs steven_is_false.
[03:16:07] <steven_is_false> okay
[03:16:08] <jensnockert> But yes, more like OpenCL than GLSL.
[03:16:24] <jensnockert> GLSL has a slightly more convoluted syntax sometimes.
[03:16:26] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Ping timeout)
[03:16:44] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[03:17:10] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[03:20:14] <steven_is_false> okay
[03:20:20] *** Quits: jgilbert_ (jgilbert@2557E599.66715431.D25A875A.IP) (Ping timeout)
[03:20:39] <steven_is_false> I have a function which I can't figure out how to rework for the latest compiler changes.
[03:22:02] <steven_is_false> It's at https://github.com/sstewartgallus/rust/blob/78ba651c155c10af4cf9f50cc3f22eb7dbb6840a/src/libextra/sync/shared_mut/rwarc.rs#L206
[03:22:19] <steven_is_false> I can't move out of the self value.
[03:22:36] <steven_is_false> Shouldn't I be able to?
[03:22:49] <dbaupp> steven_is_false: what's the complaint?
[03:23:18] <steven_is_false> I don't know how to get my function working again.
[03:25:38] *** Joins: lmandel (lmandel@moz-76CE9D51.cable.teksavvy.com)
[03:27:49] *** Quits: Jesse_ (jruderman@2557E599.66715431.D25A875A.IP) (Quit: Jesse_)
[03:28:27] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[03:28:27] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/Xn-t2A
[03:28:27] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[03:29:08] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[03:30:37] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[03:31:30] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[03:31:30] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/lAZyow
[03:31:30] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[03:32:03] *** Quits: bytewise (bytewise@moz-649C630D.unitymediagroup.de) (Quit: Leaving)
[03:32:42] *** Joins: MaikKlein (maik@moz-292B05D.dip0.t-ipconnect.de)
[03:34:28] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[03:34:28] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/lAZyow
[03:34:28] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[03:34:29] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[03:34:29] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/mWoszg
[03:34:29] <ghrust> 13rust/06auto 1447b9294 15James Miller: Revert "De-share ast::Ty"...
[03:34:29] <ghrust> 13rust/06auto 146e2af3c 15bors: auto merge of #7678 : brson/rust/deshareastty, r=brson...
[03:34:29] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[03:35:08] *** Joins: Jesin (Jessin_@moz-3AD6F09F.res.lehigh.edu)
[03:35:17] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[03:37:29] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[03:37:49] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[03:38:41] <brson> my branch merged
[03:38:43] * brson retires
[03:38:43] <strcat> \o/
[03:39:12] <strcat> dbaupp: it'd be nice to start migrating more things to collect, to take advantage of the size hints
[03:39:35] <dbaupp> brson: yay! how close is it to being on my default?
[03:39:42] <dbaupp> strcat: like HashSet etc?
[03:39:49] <strcat> yeah
[03:39:56] <strcat> dbaupp: but I mostly mean code pushing to vectors manually
[03:40:07] <dbaupp> strcat: oh, right
[03:40:31] <dbaupp> strcat: (the type hints are fairly annoying.)
[03:40:52] <strcat> well I'd like to be able to just do .collect::<~[_]>()
[03:40:59] <dbaupp> yes, same
[03:41:06] * dbaupp wants higher kinded types
[03:41:13] <strcat> I would rather fix the language than add to_vec for 1 case
[03:41:19] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[03:41:22] <strcat> also should to_vec use ~[] or @[]? ;p
[03:41:29] <strcat> so yeah.
[03:41:38] <dbaupp> clearly not @[]
[03:41:41] <strcat> well, @mut []
[03:41:43] <brson> dbaupp: it's getting close. the two big features left are linked failure and split stacks, both of which we can sacrifice somewhat temporarily. then there are a few minor runtime features left to port, primarily relating to extra::sync/arc and extra::net (which needs to be either ported or removed). because I'm traveling a lot this month though I expect it will be a few weeks still
[03:41:55] <strcat> dbaupp: I mean it'd really have to be to_uniq_vec() and to_managed_vec()
[03:42:15] <dbaupp> brson: oh, have fun :) (looking forward to it whenever it happens.)
[03:42:54] <dbaupp> strcat: not really, ~[] is far more common than @[]
[03:43:13] <strcat> dbaupp: but small vectors might even be more common
[03:43:16] <strcat> once we have them
[03:44:01] <strcat> you pay for a branch on nearly every op, and in exchange store ones up to ~23 bytes on the stack
[03:44:13] <strcat> without any other overhead
[03:44:33] <dbaupp> 23 bytes?
[03:44:36] <strcat> and branch prediction will kill the overhead from the branches since they're always the same branch after it expands
[03:44:41] <dbaupp> why 3 words on the stack?
[03:44:48] *** Joins: eagen (eagen@moz-92A457CB.hsd1.mn.comcast.net)
[03:44:53] <strcat> dbaupp: len, capacity, ptr, tag bit in the ptr
[03:45:01] <strcat> because it's the most you get for free
[03:45:14] <dbaupp> strcat: oh, it'd be different to ~[] on purpose
[03:45:20] <strcat> yeah
[03:52:06] *** Joins: posco (oscarboyki@636AC086.5999CED5.71743E61.IP)
[03:55:57] <Jeaye> bjz: glfw cursor modes need to be set only after the focus event has arrived. So I set a callback for the focus event and set things up there; things are working on OS X now.
[03:55:59] *** Joins: vk (vk@F92596F.2DEF7520.EF7679FA.IP)
[03:56:24] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[03:56:57] <MaikKlein> *offtopic* does anyone know nanomsg?
[03:58:19] <bjz> Jeaye: ahh nice
[03:59:17] *** Quits: posco (oscarboyki@636AC086.5999CED5.71743E61.IP) (Quit: posco)
[03:59:26] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[03:59:31] <Jeaye> bjz: I honestly wonder if glfw-rs should assert (or at least error!) if the window isn't focused and that function is called.
[03:59:31] *** Joins: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com)
[03:59:40] <Jeaye> Gar, 'e left.
[04:00:33] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[04:01:31] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[04:02:35] *** Joins: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au)
[04:04:10] *** Joins: xLII (xLII@2433BC90.F5F53E8A.2D6DB75E.IP)
[04:04:43] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[04:05:24] <Jeaye> bjz: ping
[04:05:42] <bjz> yoha
[04:05:42] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[04:05:45] <Jeaye> bjz: I honestly wonder if glfw-rs should assert (or at least error!) if the window isn't focused and that function is called.
[04:06:00] <bjz> Jeaye: yeah?
[04:06:16] <Jeaye> Nilium says "it's documented", but it feels like too easy of a hole to fall into.
[04:06:21] <bjz> Jeaye: that's probably a good idea
[04:06:34] * Jeaye has been in it for a while. -_-
[04:06:41] <bjz> Jeaye: it's weird though, because it takes a window as a parameter
[04:06:46] <bjz> :/
[04:06:53] <Jeaye> heh
[04:07:37] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[04:08:23] * bjz comes to Jeaye's side
[04:08:39] <Jeaye> \o/
[04:09:10] *** Quits: MaikKlein (maik@moz-292B05D.dip0.t-ipconnect.de) (Ping timeout)
[04:09:59] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[04:11:44] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[04:13:05] *** Quits: Nisstyre (wes@moz-FD86289.netflash.net) (Quit: Leaving)
[04:14:15] *** Quits: lmandel (lmandel@moz-76CE9D51.cable.teksavvy.com) (Quit: lmandel)
[04:14:16] *** Quits: steven_is_false (user@moz-144077DE.bchsia.telus.net) (Client exited)
[04:14:28] <bjz> Jeaye: I could do a log
[04:15:14] <Jeaye> Yeah, anything would help in this case.
[04:17:15] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Quit: jmgrosen)
[04:20:55] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[04:21:40] *** Quits: brson (brson@5F06B402.AD1E507F.3688B332.IP) (Quit: leaving)
[04:22:02] <jensnockert> Jeaye: Endless youtube loop maybe? Usually works for me.
[04:22:45] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Quit: jmgrosen)
[04:23:05] *** Quits: krdln (Mibbit@moz-6F8A8560.dynamic.chello.pl) (Quit: http://www.mibbit.com ajax IRC Client)
[04:23:06] <Jeaye> jensnockert: Eh?
[04:23:56] <jensnockert> Go to http://endlessvideo.com/ and put on a video on loop, then attack the problem again.
[04:24:01] *** Joins: lmandel (lmandel@moz-76CE9D51.cable.teksavvy.com)
[04:24:20] <jensnockert> I am slightly partial to the Tales of Symphonia intro, http://endlessvideo.com/watch?v=vuSwt3GWNrQ
[04:25:04] *** Quits: eatkinson (eatkinson@2557E599.66715431.D25A875A.IP) (Quit: eatkinson)
[04:25:35] <Jeaye> I'm not attacking any problem. :P
[04:25:41] <Jeaye> My problems are solved.
[04:26:11] * Jeaye is problem free, thanks to https://www.youtube.com/watch?v=-O6KI2uWOqs
[04:30:59] <jensnockert> \o/
[04:31:53] *** Quits: sankha93 (Instantbir@A7679ECF.199B3CEE.EFB84E89.IP) (Ping timeout)
[04:32:54] *** Quits: geomyidae (geomyidae@DD6F7E3A.21468E9A.30200F38.IP) (Quit: Konversation terminated!)
[04:33:15] *** Quits: vk (vk@F92596F.2DEF7520.EF7679FA.IP) (Quit: vk)
[04:34:32] <strcat> bjz: http://llvm.org/docs/doxygen/html/LoopIdiomRecognize_8cpp_source.html ;p
[04:34:37] <strcat> 00039 // This could recognize common matrix multiplies and dot product idioms and
[04:34:38] <strcat> 00040 // replace them with calls to BLAS (if linked in??).
[04:34:54] <strcat> but it doesn't even do memcmp
[04:34:56] <strcat> ;[
[04:35:28] <strcat> anyway that's just the fast thing to do at -O1
[04:35:37] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[04:35:38] <strcat> doesn't matter much if actual loop-vectorize is run...
[04:38:16] *** Joins: vk (vk@F92596F.2DEF7520.EF7679FA.IP)
[04:38:20] <dbaupp> rusti: #[cfg(target_word_size=64)] fn foo() -> int { 64 } #[cfg(not(target_word_size=64))] fn foo() -> int { 32 } foo()
[04:38:21] -rusti- 32
[04:38:33] <dbaupp> rusti: #[cfg(target_word_size="64")] fn foo() -> int { 64 } #[cfg(not(target_word_size="64"))] fn foo() -> int { 32 } foo()
[04:38:34] -rusti- 64
[04:38:40] <dbaupp> whyyyyy? :'(
[04:38:47] *** Joins: ross (ross@moz-8A84103E.br.br.cox.net)
[04:38:51] <strcat> huh?
[04:39:21] * strcat shrugs
[04:39:36] *** Quits: vk (vk@F92596F.2DEF7520.EF7679FA.IP) (Quit: vk)
[04:39:45] *** Quits: lmandel (lmandel@moz-76CE9D51.cable.teksavvy.com) (Quit: lmandel)
[04:39:56] <strcat> rusti: include!("/proc/version")
[04:39:57] -rusti- <anon>:7:9: 8:5 error: unresolved name `Linux`.
[04:39:57] -rusti- <anon>:7          include!("/proc/version")
[04:39:57] -rusti- <anon>:8     };
[04:39:57] -rusti- error: aborting due to previous error
[04:39:57] -rusti- application terminated with error code 101
[04:40:00] <strcat> heh
[04:40:04] <strcat> rusti: include_str!("/proc/version")
[04:40:04] -rusti- "Linux version 3.10.0-1-ARCH (tobias@T-POWA-LX) (gcc version 4.8.1 (GCC) ) #1 SMP PREEMPT Mon Jul 1 20:40:13 CEST 2013\n"
[04:40:11] <dbaupp> strcat: it's just target_word_size is an string cfg
[04:40:15] <strcat> ah
[04:40:21] * dbaupp is fixing it
[04:40:27] <joelteon> haaaaaa, arch linux
[04:40:57] <strcat> joelteon: ofc :)
[04:43:36] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[04:44:29] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[04:44:43] <bjz> strcat: sorry, don't really follow you
[04:45:46] *** Joins: sankha93 (Instantbir@A7679ECF.199B3CEE.EFB84E89.IP)
[04:47:47] <jensnockert> strcat: BLAS cannot replace a matrix multiply
[04:47:57] <jensnockert> strcat: The result is different.
[04:48:29] <strcat> jensnockert: but they have -ffast-math as a switch and you can tune the accuracy it's allowed to lose
[04:48:50] <jensnockert> strcat: Sure, with -ffast-math you could.
[04:49:06] <jensnockert> strcat: But with -ffast-math, you could do much more agressive optimizations anyhow.
[04:53:17] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Quit: jmgrosen)
[04:53:36] *** Quits: eagen (eagen@moz-92A457CB.hsd1.mn.comcast.net) (Ping timeout)
[04:54:45] <jensnockert> strcat: -ffast-math is evil though.
[04:54:50] <strcat> ofc ;]
[04:55:04] <jensnockert> Makes NaN == NaN and other scary stuff.
[04:55:07] <strcat> jensnockert: you can output instructions with specific accuracy they're allowed to use instead
[04:55:13] <strcat> to lose*
[04:55:27] <strcat> if you really care
[04:55:29] <strcat> ;p
[04:55:53] <jensnockert> strcat: If I really cared, I would just call CBLAS gemm myself ;)
[04:56:12] <strcat> until the day when LLVM is almost always smarter
[04:56:47] <jensnockert> LLVM doesn't optimize per processor model, so until thenâ€¦
[04:57:56] <jensnockert> LLVM doesn't care about stuff like cache hierarchy (at least not yet).
[04:58:13] *** Joins: tehgeekmeister (tehgeekmei@906DFEDB.860C3797.1A968954.IP)
[04:58:45] <strcat> jensnockert: it really doesn't optimize per cpu model yet? gcc does
[04:58:50] <strcat> gcc's march=native sets cache sizes, etc.
[04:59:29] <jensnockert> strcat: Not really, it just sets CPU family.
[04:59:30] *** Quits: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net) (Quit: zzz)
[05:00:09] *** Quits: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com) (Quit: Konversation terminated!)
[05:00:52] *** Quits: arete (arete@moz-CE1DC602.xen.prgmr.com) (Ping timeout)
[05:01:25] *** Quits: fairfieldt (fairfieldt@moz-D8998E1C.xen.prgmr.com) (Ping timeout)
[05:01:25] *** Quits: btipling (btipling@moz-D51E0AEB.xen.prgmr.com) (Ping timeout)
[05:01:31] *** Quits: eakuefner (eakuefner@moz-9EDCAF3.com) (Ping timeout)
[05:01:32] <strcat> /usr/lib/gcc/x86_64-unknown-linux-gnu/4.8.1/cc1 -quiet - -march=corei7-avx -mcx16 -msahf -mno-movbe -maes -mpclmul -mpopcnt -mno-abm -mno-lwp -mno-fma -mno-fma4 -mno-xop -mno-bmi -mno-bmi2 -mno-tbm -mavx -mno-avx2 -msse4.2 -msse4.1 -mno-lzcnt -mno-rtm -mno-hle -mrdrnd -mf16c -mfsgsbase -mno-rdseed -mno-prfchw -mno-adx -mfxsr -mxsave -mxsaveopt --param l1-cache-size=0 --param l1-cache-line-size=0
[05:01:33] <strcat> --param l2-cache-size=256 -mtune=generic -quiet -dumpbase - -auxbase-strip
[05:01:38] <strcat> that's what gcc -march=native does for me
[05:02:03] * strcat shrugs
[05:02:10] <strcat> seems bogus
[05:02:14] <jensnockert> Yeah, but it ignores L1 and L3, and L2 is wrong?
[05:02:15] <strcat> maybe I need to tell it to optimize
[05:02:33] <tehgeekmeister> I figured out how to do what I was after yesterday, but I've got a new question
[05:03:02] <tehgeekmeister> what's the right way to approach having both an immutable and mutable version of this trait here, and have the method dispatch still work right.
[05:03:03] <tehgeekmeister> https://github.com/tehgeekmeister/datastructures.rs/blob/master/stack.rs
[05:03:24] <tehgeekmeister> right now it works if i comment either of the impls
[05:03:47] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[05:03:50] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[05:04:00] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[05:04:02] <strcat> jensnockert: well I could pass those myself but -march=native is supposed to do it :(
[05:04:05] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[05:04:57] <tehgeekmeister> oh, also my mutable stack is just wrong. oops.
[05:05:00] *** Joins: eakuefner (eakuefner@moz-9EDCAF3.com)
[05:05:01] *** Joins: fairfieldt (fairfieldt@moz-D8998E1C.xen.prgmr.com)
[05:05:12] *** Joins: arete (arete@moz-CE1DC602.xen.prgmr.com)
[05:05:16] *** Joins: btipling (btipling@moz-D51E0AEB.xen.prgmr.com)
[05:05:27] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[05:06:48] *** Joins: eatkinson (eatkinson@moz-AD233F1B.dia.static.qwest.net)
[05:06:50] <strcat> jensnockert: -funsafe-math-optimizations 
[05:06:52] <strcat> ;D
[05:07:02] <strcat> oh that's just part of -ffast-math anyway
[05:07:07] <jensnockert> strcat: Yeah.
[05:07:17] * strcat wonders what -funsafe-loop-optimizations does
[05:07:19] <strcat> that can't be good
[05:07:49] <strcat>     This option tells the loop optimizer to assume that loop indices do not overflow, and that loops with nontrivial exit condition are not infinite. 
[05:08:02] <strcat> so it just assumes only simple loops are infinite? o_O
[05:08:11] * strcat doesn't see the point
[05:08:17] <jensnockert> strcat: I have a feeling that the cache line sizes are mostly for deciding if inlining functions is worth it.
[05:08:32] <strcat> jensnockert: well it cares about cache alignment too
[05:08:43] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[05:08:53] <strcat> maybe they keep that stuff in their own db and it's not updated for ivy bridge yet :|
[05:08:57] <strcat> but... it's gcc 4.8
[05:09:14] <jensnockert> strcat: Functions are usually aligned too? Or maybe they stopped doing that..?
[05:09:28] <steven_is_false> I think I have a use case for #[unsafe_no_drop]. Can someone clarify what it does for me?
[05:09:35] <jensnockert> I know it was important for gentoo ricers at some point.
[05:09:44] <strcat>   -malign-functions=            0
[05:09:46] <strcat>   -malign-jumps=                0
[05:09:48] <strcat>   -malign-loops=                0
[05:09:57] <strcat> jensnockert: sandy/ivy bridge access unaligned memory as fast as aligned memory anyway
[05:10:06] <strcat> and haswell ofc
[05:10:17] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[05:10:33] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[05:10:39] <strcat> steven_is_false: #[unsafe_no_drop_flag], omits the drop flag byte and just calls the destructor an unspecified # of times
[05:10:42] <strcat> instead of once
[05:10:51] <jensnockert> strcat: Unless they cross cache-lines.
[05:11:18] <strcat> jensnockert: right
[05:11:24] <steven_is_false> strcat: So one has to manually do the test inside the drop like if self.my_drop_flag { etc... ? (Unless the op is idempotent?)
[05:11:30] <strcat> jensnockert: gcc stuff uses x87 math by default too...
[05:11:40] <jensnockert> strcat: Depends on OS.
[05:11:41] <strcat> steven_is_false: yes
[05:11:53] <jensnockert> strcat: On OS X it should use SSE2 by default?
[05:12:03] <strcat> jensnockert: doubt it
[05:12:05] <strcat> maybe apple patched it
[05:12:15] <steven_is_false> strcat: Okay, so #[unsafe_no_drop_flag] is not good for my purpose but is an interesting thing to keep in mind.
[05:12:16] <strcat> jensnockert: on x86_64 clang uses sse2 by default (on any OS)
[05:12:27] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[05:12:31] <strcat> gcc just doesn't, dunno why
[05:12:53] <jensnockert> strcat: Weird, I remember Cocoa trashing x87 by using MMX.
[05:13:36] <strcat> jensnockert: it doesn't seem to actually detect my cpu :[
[05:13:42] <strcat> like, they seem to lack the model
[05:13:51] <dbaupp> strcat: I'd guess that "that loops with nontrivial exit condition are not infinite." means that it normally assumes that they are possibly infinite (since it can already prove that loops with trivial exit conditions are finite).
[05:13:54] <strcat> so I guess it's just going by partial data from /proc/cpuinfo
[05:14:09] *** Joins: pyrac (pyrac@moz-8862B13A.w92-162.abo.wanadoo.fr)
[05:14:23] <strcat> dbaupp: yeah but what's the use in a pass that will so easily make incorrect code? ;p
[05:14:32] <dbaupp> strcat: because you might know it doesn't
[05:14:41] <dbaupp> strcat: it's clearly labelled
[05:15:42] <dbaupp> cmr: ping
[05:15:54] *** Quits: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com) (Client exited)
[05:16:14] <strcat> jensnockert: ah it looks like old gcc used to mix x87 and sse
[05:16:19] <strcat> and then they switched to just x87
[05:16:24] <strcat> by default
[05:16:28] *** Quits: steven_is_false (user@moz-144077DE.bchsia.telus.net) (Client exited)
[05:16:54] <strcat> weird stuff
[05:17:01] <jensnockert> strcat: Since Apple GCC is from 2007, I don't really think we can extrapolate anything from there.
[05:18:27] <jensnockert> strcat: Apple docs says that SSE2 and -mfpmath=sse is the default on OS X though.
[05:18:37] <strcat> jensnockert: with their gcc ;p
[05:18:56] <jensnockert> strcat: Of course, but GNU GCC on OS X is kind of painful.
[05:19:21] <tehgeekmeister> can self be made mutable?
[05:19:37] <jensnockert> I have to modify every other make file because they think that OS X == Apple GCC.
[05:19:54] <jensnockert> strcat: And pass silly universal-binary commands to it.
[05:20:02] <strcat> tehgeekmeister: take &mut self instead of &self
[05:20:04] <Luqman> jensnockert: isn't apple gcc llvm-gcc?
[05:20:06] <strcat> or move out of by-value self
[05:20:21] <jensnockert> Luqman: Now it is, but it was 'real' GCC at some point.
[05:20:34] <jensnockert> Luqman: Well, technically llvm-gcc is depricated I think.
[05:20:36] *** Quits: Boreeas (Boreeas@moz-F35C832D.boreeas.net) (Quit: ZNC - http://znc.in)
[05:20:48] <jensnockert> Luqman: They really want you to use Clang.
[05:21:04] <Luqman> yea, llvm-gcc is terrible
[05:21:23] <Luqman> hence why i just installed gcc 4.6/8 :P
[05:22:35] <jensnockert> Luqman: Me too, but I need to remove it from PATH every time I want to install a Ruby gem or any Python stuff.
[05:23:35] <Luqman> i think i have default gcc first in my path, so i just use CC=gcc-4.8 whenever i need it
[05:23:41] <Luqman> or just use clang
[05:23:47] <tehgeekmeister> strcat: thanks
[05:23:56] * strcat would not be happy with ubuntu or osx
[05:24:08] <strcat> I'm far too lazy to manage any deps or install new software myself
[05:24:52] <Luqman> haha, it's not that bad
[05:24:56] <strcat> I have a debian server but host things from my laptop because I can't stand the pain of dealing with debian
[05:25:06] *** Joins: aatch (aatch@moz-2BB0AC01.cable.telstraclear.net)
[05:25:26] *** Quits: eatkinson (eatkinson@moz-AD233F1B.dia.static.qwest.net) (Quit: eatkinson)
[05:25:26] <strcat> install new python + new python libs + whatever they depend on, no ;p
[05:25:26] <Luqman> really the annoying thing about debian is how old packages can be
[05:25:40] <strcat> Luqman: well considering I'm used to the repos providing the latest stable of everything
[05:25:55] <jensnockert> strcat: What distro are you using?
[05:25:57] <aatch> strcat, yay arch
[05:26:00] <strcat> ^
[05:26:17] <jensnockert> I really like "Oh, I am lazy, so I run Arch"
[05:26:41] <strcat> jensnockert: I really do less work than you, I'm sure ;p
[05:26:50] <Luqman> for instance, i compile rust on 1 machine but it gets installed on a nfs exported filesystem. if i try to run it on a debian wheezy box it complains version `GLIBC_2.14' not found :|
[05:27:28] <jensnockert> strcat: Sure, but I wrote my own package manager, so I cannot really complain that it was a lot of work.
[05:28:01] <strcat> arch is as stable as the software you use, since you're just using their release cycles
[05:28:08] <strcat> I don't use gnome/kde so I don't suffer any of that pain
[05:28:09] *** Joins: tikue (tkuehn@moz-A7CDB794.dia.static.qwest.net)
[05:28:40] <jensnockert> I ran Gentoo for a while, but it stopped being fun.
[05:28:47] <strcat> I couldn't deal with gentoo
[05:28:55] <strcat> I'm very lazy/impatient ;p
[05:28:56] <jensnockert> I prefer it to Arch.
[05:29:15] * strcat shrugs
[05:29:21] <jensnockert> At least now, compiles are fast.
[05:29:23] <strcat> if I used a source-based distro, I'd use exherbo
[05:29:42] <jensnockert> On my old Athlon XP compiles took ages.
[05:30:44] <strcat> jensnockert: firefox/chromium still take ages
[05:30:58] <strcat> especially if you do PGO ;p
[05:31:05] <ChrisMorgan> Well, it looks to me like a direct implementation of an HTTP *library* is impossible in Rust at present, on account of the socket not satisfying Send. This, in spite of the fact that the socket never actually needs to be sent between tasks. :-(
[05:31:05] <jensnockert> strcat: Yeah, but not as many ages as it did then.
[05:31:48] <strcat> I used to build my own kernels for the sake of it and firefox binaries
[05:32:16] <strcat> but it's pretty pointless
[05:32:27] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[05:32:38] <ChrisMorgan> That would leave using a port/channel solution as the next solution, I guess.
[05:32:50] <jensnockert> I should try to rebuild my OS X kernel some day, would be educational I gues.s
[05:33:30] <ChrisMorgan> Does that sound correct/reasonable?
[05:34:00] <strcat> ChrisMorgan: there's no point of looking at the current I/O stuff
[05:34:02] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[05:34:05] <strcat> it's all going to be thrown out soon
[05:34:21] <strcat> brson has the new scheduler stuff in-tree
[05:34:44] *** Joins: seth (seth@moz-2C443A35.hsd1.co.comcast.net)
[05:34:53] * jensnockert hugs strcat good night.
[05:34:54] <strcat> look at libstd/rt/
[05:34:56] <strcat> jensnockert: \o
[05:35:05] * jensnockert hugs everyone else too.
[05:35:42] <ChrisMorgan> strcat: libstd/rt/mod.rs doesn't include the `net` module
[05:36:04] <strcat> ChrisMorgan: it's not done, it's just a sketch
[05:36:43] <ChrisMorgan> Hang on... that could explain why.
[05:36:55] <ChrisMorgan> std::rt::io::net, not std::rt::net :-/
[05:37:26] *** Quits: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au) (Quit: gavinb)
[05:37:27] <ChrisMorgan> That didn't boost my self-esteem ;-)
[05:38:16] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Input/output error)
[05:39:20] *** Joins: vk (vk@moz-389FEE13.hsd1.ca.comcast.net)
[05:39:52] *** Quits: vk (vk@moz-389FEE13.hsd1.ca.comcast.net) (Quit: vk)
[05:40:08] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[05:40:59] *** Joins: vk (vk@moz-389FEE13.hsd1.ca.comcast.net)
[05:41:44] *** Quits: vk (vk@moz-389FEE13.hsd1.ca.comcast.net) (Quit: vk)
[06:01:29] * ChrisMorgan is not sure of this Ipv4(u8, u8, u8, u8, u16) businessâ€”including the port number in with the IP address?
[06:02:34] <strcat> ChrisMorgan: that's what the underlying structs do on the OS and in libuv
[06:02:48] <ChrisMorgan> Weird.
[06:03:12] <ChrisMorgan> Sure, you will almost always be dealing with them together, but the port number isn't semantically part of the IP address, surely?
[06:03:22] <ChrisMorgan> Pragmatism at work, I guess :-)
[06:03:25] <strcat> it's part of a socket address
[06:03:52] <kemurphy> strcat: how goes the exchange heap header removal stuff?
[06:03:58] <strcat> kemurphy: done ;]
[06:04:00] <strcat> landed
[06:04:08] <kemurphy> strcat: awesome! nice work
[06:04:40] <kemurphy> i read into it for a few days after you mentioned it a couple weeks ago and i turned to stone
[06:04:43] <strcat> rusti: let x = ~5; unsafe { let y: *int = cast::transmute(x); println(x.to_str()); std::libc::free(y) }
[06:04:44] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/Ocde
[06:04:53] <strcat> rusti: let x = ~5; unsafe { let y: *int = std::cast::transmute(x); println(x.to_str()); std::libc::free(y) }
[06:04:54] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/eZiH
[06:05:07] <strcat> rusti: let x = ~5; unsafe { let y: *int = std::cast::transmute(x); println((*y).to_str()); std::libc::free(y) }
[06:05:08] -rusti- line longer than 150 columns, pastebinned: http://sprunge.us/AeWF
[06:05:14] * strcat sighs
[06:05:21] <strcat> rusti: let x = ~5; unsafe { let y: *int = std::cast::transmute(x); println((*y).to_str()); std::libc::free(y as *std::libc::c_void) }
[06:05:22] -rusti- 5
[06:05:22] -rusti- ()
[06:05:31] *** Joins: vk (vk@moz-389FEE13.hsd1.ca.comcast.net)
[06:05:43] *** Quits: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca) (Connection reset by peer)
[06:05:47] <strcat> kemurphy: anyway all ~T pointers (not ~fn and ~[]) without contained managed ptrs are just malloc/free with no header
[06:06:08] <kemurphy> woo \o/
[06:06:19] <strcat> I'm going to remove them from non-managed ~[] next
[06:06:53] <kemurphy> i was spending a lot of time with tvec, but couldn't figure out a good way to make it more sane
[06:06:56] <strcat> kemurphy: https://github.com/mozilla/rust/pull/7605 the actual PR that landed
[06:07:06] <strcat> well and the 2 leading up to it ;p
[06:07:08] <kemurphy> admittedly my lack of llvm knowledge got in the way
[06:07:43] <kemurphy> strcat: awesome, i'll read through it :)
[06:09:42] <strcat> kemurphy: it was a long journey of LLVM asserts, valgrind and vimdiff of IR output from before/after ;p
[06:10:01] <strcat> not much coding
[06:10:41] *** Quits: vk (vk@moz-389FEE13.hsd1.ca.comcast.net) (Quit: vk)
[06:11:10] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[06:13:00] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[06:13:55] *** Joins: vk (vk@moz-389FEE13.hsd1.ca.comcast.net)
[06:16:01] *** Quits: pyrac (pyrac@moz-8862B13A.w92-162.abo.wanadoo.fr) (Quit: pyrac)
[06:16:05] <kemurphy> any plans/desire for something like extern "bare" fns?
[06:16:23] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[06:16:23] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 146e2af3c to 1441dcec2: 02http://git.io/N3iJvQ
[06:16:23] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[06:16:25] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[06:16:25] <dbaupp> kemurphy: how would that be different to extern "C" fns?
[06:16:25] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/qYNFBg
[06:16:25] <ghrust> 13rust/06auto 14f74250e 15Daniel Micay: vec::with_capacity: do one alloc for non-managed
[06:16:25] <ghrust> 13rust/06auto 146f5be90 15Daniel Micay: ptr: optimize {swap,replace,read}_ptr
[06:16:26] <ghrust> 13rust/06auto 140b18057 15bors: auto merge of #7682 : thestinger/rust/vec, r=pcwalton...
[06:16:28] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[06:17:47] <kemurphy> dbaupp: wow, i guess my brain isn't working tonight, extern "C" is what i want
[06:17:59] <dbaupp> :)
[06:18:21] *** Joins: jaen (jaen@moz-4A98EEE0.neoplus.adsl.tpnet.pl)
[06:18:28] <strcat> kemurphy: well we do have that
[06:19:28] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[06:19:28] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 140b18057 to 1441dcec2: 02http://git.io/N3iJvQ
[06:19:28] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[06:19:28] *** Joins: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP)
[06:19:29] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/rUgiiA
[06:19:29] <ghrust> 13rust/06auto 1447b9294 15James Miller: Revert "De-share ast::Ty"...
[06:19:29] <ghrust> 13rust/06auto 14df760c0 15bors: auto merge of #7678 : brson/rust/deshareastty, r=brson...
[06:19:29] *** Parts: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP) ()
[06:19:46] <aatch> Work this time goddamnit!
[06:19:50] <strcat> wtf bors
[06:19:52] <strcat> why
[06:19:58] <strcat> aatch: it's broken
[06:20:00] <strcat> ;[
[06:20:25] *** Quits: igl (igl@moz-FDB308E6.adsl.alicedsl.de) (Quit: Leaving.)
[06:20:42] *** Quits: hjr3 (hradtke@moz-E87BDF1F.socal.res.rr.com) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[06:21:01] <aatch> strcat, actually, brson re-did it, notice the branch
[06:21:04] <dbaupp> yay 2 pull requests?
[06:21:15] <strcat> aatch: I mean bors pushed a PR, then pushed another
[06:21:20] <strcat> the first one isn't over
[06:21:31] <aatch> strcat, oh, right...
[06:21:35] <aatch> yeah. that's bad
[06:21:38] <strcat> http://buildbot.rust-lang.org/console?branch=auto&refresh=15 just let the first finish
[06:21:48] <strcat> we can merge them manually when tests pass and bors can be one ahead
[06:21:50] <strcat> ;p
[06:21:57] <kemurphy> man, i wish i could use a .rs file as a header in a .S file
[06:22:11] <strcat> kemurphy: there's inline asm
[06:22:23] <kemurphy> yeah, but... eh
[06:22:34] <kemurphy> what i'm doing would be too unwieldy for inline asm
[06:22:55] <kemurphy> (multiboot header stuff)
[06:24:54] *** Quits: ross (ross@moz-8A84103E.br.br.cox.net) (Quit: )
[06:25:38] <dbaupp> "s = s + str::from_char(c)" yay speed
[06:27:32] <strcat> heh
[06:27:38] <strcat> where was that awful snippet from?
[06:27:49] <dbaupp> std::rand gen_str
[06:27:55] *** Quits: seth (seth@moz-2C443A35.hsd1.co.comcast.net) (Input/output error)
[06:28:45] <dbaupp> (it also includes 2 useless allocations, other than that.)
[06:29:11] <kemurphy> hm, it appears i can't write 'unsafe extern "C" fn'
[06:29:12] *** Quits: tehgeekmeister (tehgeekmei@906DFEDB.860C3797.1A968954.IP) (Client exited)
[06:29:18] <kemurphy> nor 'extern "C" unsafe fn'
[06:30:04] <dbaupp> rusti: unsafe extern fn foo() {}
[06:30:05] -rusti- <anon>:7:16: 7:22 error: expected `fn`, found `extern`
[06:30:05] -rusti- <anon>:7          unsafe extern fn foo() {}
[06:30:05] -rusti-                          ^~~~~~
[06:30:05] -rusti- application terminated with error code 101
[06:30:11] <dbaupp> rusti: extern unsafe fn foo() {}
[06:30:11] -rusti- <anon>:7:16: 7:22 error: expected `{` or `mod` but found `unsafe`
[06:30:12] -rusti- <anon>:7          extern unsafe fn foo() {}
[06:30:12] -rusti-                          ^~~~~~
[06:30:12] -rusti- application terminated with error code 101
[06:30:23] <dbaupp> rusti: extern fn foo() {} foo()
[06:30:23] -rusti- <anon>:7:28: 8:5 error: expected function but found `*u8`
[06:30:23] -rusti- <anon>:7          extern fn foo() {} foo()
[06:30:23] -rusti- <anon>:8     };
[06:30:24] -rusti- error: aborting due to previous error
[06:30:24] -rusti- application terminated with error code 101
[06:30:54] <dbaupp> well that's fun.
[06:31:17] *** Quits: vk (vk@moz-389FEE13.hsd1.ca.comcast.net) (Quit: vk)
[06:33:12] *** Joins: vk (vk@moz-389FEE13.hsd1.ca.comcast.net)
[06:33:32] *** Quits: vk (vk@moz-389FEE13.hsd1.ca.comcast.net) (Quit: vk)
[06:36:36] <aatch> New computer ordered!
[06:36:51] <aatch> turns out I had more savings than I thought
[06:37:17] <kemurphy> how do i prevent rustc from emitting a call to __morestack or _ZN3lol17__rust_stack_shim
[06:37:36] <kemurphy> dbaupp: i think this is what i meant by extern "bare" ^
[06:37:41] <aatch> kemurphy, you don't...
[06:37:51] <aatch> it's because of segmented stacks
[06:37:59] <strcat> also because of stack safety
[06:38:06] <strcat> it would have to emit something like that without segmented stacks
[06:38:58] <kemurphy> er, okay
[06:39:08] *** Quits: tikue (tkuehn@moz-A7CDB794.dia.static.qwest.net) (Quit: tikue)
[06:40:26] <kemurphy> so i guess i have to maintain a separate asm file for what i'm trying to do then
[06:41:01] <strcat> although we could use stack smashing protection instead
[06:41:19] <strcat> make a guard page, add checks on any allocations bigger than the guard page
[06:41:26] <strcat> like gcc/clang with -fstack-protector=all
[06:41:44] <strcat> like gcc/clang with -fstack-protector-all *
[06:41:47] <kemurphy> i mean, i just want to be able to use some stuff defined in a rust module in some inline asm that runs on the c stack
[06:42:03] <kemurphy> zero.rs is involved here, fwiw
[06:53:53] *** Joins: Axord (xord@moz-C3CCF156.lsanca.dsl-w.verizon.net)
[06:55:18] *** Joins: jviereck (Adium@moz-2D5D7F91.ethz.ch)
[06:56:13] <aatch> goddamn I hate that period when I order new equipment then have to go back to using the old stuff while I wait for it to arrive
[06:59:18] <aatch> Also, I can finally push a snapshot!
[07:02:34] <kemurphy> aatch: what did you get?
[07:02:44] <aatch> kemurphy, new computer.
[07:02:53] <ChrisMorgan> std::rt::io::net::tcp::TcpListener::bind is fn(addr: IpAddr) -> Option<TcpListener>. Yet on the returned Option<TcpListener>, .accept() works. How is that?
[07:02:54] <aatch> my current one is ~6 years old
[07:03:06] <kemurphy> aatch: whee, yeah sounds like time for an upgrade
[07:03:22] <aatch> kemurphy, it's done well, had a few upgrades over the years to be fair
[07:03:44] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[07:03:46] <aatch> but getting a new computer at work made me realise how slow this actually was
[07:04:21] <kemurphy> ah, fair. yeah, that's how it usually goes; it's fine until you use something faster somewhere else :P
[07:04:42] *** Joins: pyrac (pyrac@moz-C9A2635A.infra.univ-bordeaux.fr)
[07:05:18] *** Joins: sdh_ (sdh@8557E3E0.AAC4A127.9105FBCF.IP)
[07:06:16] *** Quits: sdh_ (sdh@8557E3E0.AAC4A127.9105FBCF.IP) (Quit: Konversation terminated!)
[07:06:26] *** Joins: sdh_ (sdh@8557E3E0.AAC4A127.9105FBCF.IP)
[07:06:43] <aatch> kemurphy, being able to compile rust in half the time was a major one
[07:07:17] *** Quits: jviereck (Adium@moz-2D5D7F91.ethz.ch) (Quit: Leaving.)
[07:07:21] <aatch> not sure what I'll do with this machine though.
[07:08:00] <ChrisMorgan> The other aspect of the question is then why I can't do it in the normal match way.
[07:08:00] <ChrisMorgan> let mut optlistener = TcpListener::bind(...); match optlistener { None => return; Some(listener) => { let mut stream = listener.accept(); }
[07:08:00] <ChrisMorgan> Error at the "listener" part of "listener.accept()": `cannot borrow immutable captured outer variable as mutable`
[07:08:33] <ChrisMorgan> (The definition of accept being `accept(&mut self) -> Option<TcpStream>`.)
[07:08:47] <aatch> ChrisMorgan, you want Some(ref mut listener)
[07:09:01] <strcat> aatch: failed on windows again anyway
[07:09:06] <aatch> strcat, I know
[07:09:09] <dbaupp> aatch: set it up as a bencher
[07:09:14] <aatch> I've no idea what it could be though
[07:09:33] <kemurphy> does auto-deref apply to 1-ary enum variants?
[07:09:37] <ChrisMorgan> aatch: ah... I tried ref listener and mut listener and the latter wouldn't compile, so I never actually tried ref mut listener, though that had been what I had thought it would need to be
[07:09:52] <aatch> dbaupp, that is tempting. Especially since I can just appropriate the work cmr's already done
[07:11:42] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[07:12:09] <aatch> ChrisMorgan, the lack of just `mut` is a bug, but isn't often needed.
[07:12:11] *** Quits: sdh_ (sdh@8557E3E0.AAC4A127.9105FBCF.IP) (Quit: Konversation terminated!)
[07:12:19] <ChrisMorgan> Ah!
[07:12:20] <acrichto> kemurphy: https://github.com/mozilla/rust/issues/6246
[07:12:24] *** Joins: sdh_ (sdh_@8557E3E0.AAC4A127.9105FBCF.IP)
[07:12:30] <acrichto> kemurphy: so maybe, but it may not last long
[07:12:34] *** Quits: sdh_ (sdh_@8557E3E0.AAC4A127.9105FBCF.IP) (Quit: Konversation terminated!)
[07:13:07] *** Joins: jviereck (Adium@moz-2D5D7F91.ethz.ch)
[07:13:40] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[07:14:53] <dbaupp> aatch: it'd be cool :)
[07:16:12] *** Quits: robarnold (rob@BD56354E.DB510C09.6E370BFC.IP) (Ping timeout)
[07:16:17] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Ping timeout)
[07:16:23] *** Joins: robarnold (rob@BD56354E.DB510C09.6E370BFC.IP)
[07:16:26] *** Quits: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net) (Ping timeout)
[07:16:26] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Ping timeout)
[07:16:28] *** Quits: huhlig-home (huhlig@moz-C8339267.hfc.comcastbusiness.net) (Ping timeout)
[07:16:39] *** Joins: huhlig-home (huhlig@moz-C8339267.hfc.comcastbusiness.net)
[07:16:46] *** Joins: bnicholson (bnicholson@moz-E98974C1.hsd1.ca.comcast.net)
[07:18:37] <kemurphy> acrichto: ah okay, so it is a bug. i found it surprising anyway.
[07:19:16] <dbaupp> I wish you could provide default method implementations conditional on some trait, but not require that trait always.
[07:20:45] *** Quits: graydon (graydon@moz-A8112A5D.cable.teksavvy.com) (Ping timeout)
[07:23:56] *** Joins: Voomer__ (Voomer@moz-E97E8EB7.br.br.cox.net)
[07:23:57] *** Quits: Voomer_ (Voomer@moz-E97E8EB7.br.br.cox.net) (Connection reset by peer)
[07:26:37] *** Joins: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP)
[07:28:38] *** Joins: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP)
[07:29:11] <dbaupp> rusti: 10u.mod_floor(&3)
[07:29:11] -rusti- 3
[07:29:35] <dbaupp> that is wrong, isn't it?
[07:29:56] * dbaupp looks at the source
[07:30:03] <strcat> yes
[07:30:04] <dbaupp> fn mod_floor(&self, other: &$T) -> $T { *self / *other }
[07:30:07] <dbaupp> yes
[07:30:08] <strcat> very wrong
[07:30:12] <dbaupp> definitely wrong
[07:30:17] <strcat> it should be 1
[07:31:03] <dbaupp> rusti: 10i.mod_floor(&3)
[07:31:04] -rusti- 1
[07:31:29] <strcat> need more tests
[07:31:31] <strcat> ;[
[07:31:48] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[07:34:27] *** Quits: paulproteus (quassel@rose.makesad.us) (Ping timeout)
[07:38:06] <kemurphy> what's with the $ in $T?
[07:38:10] <kemurphy> new syntax?
[07:38:16] *** Quits: Jesin (Jessin_@moz-3AD6F09F.res.lehigh.edu) (Ping timeout)
[07:38:55] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[07:39:03] <strcat> no, just a macro
[07:39:25] <kemurphy> oh, right
[07:39:30] * kemurphy should read up on those at some point
[07:40:39] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[07:41:48] *** Joins: paulproteus (quassel@moz-E86A3B42.makesad.us)
[07:49:01] *** Joins: smvv_ (sander@moz-BAEA8EB2.dynamic.upc.nl)
[07:50:40] *** Joins: SimonSapin (simon@88F51059.F3BBB17D.144F44FA.IP)
[07:53:11] *** Joins: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP)
[07:55:07] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[07:56:21] *** Joins: vilonis (jared@moz-EE5D17ED.ph.ph.cox.net)
[08:00:13] <mark_edward> macros are an illusion
[08:00:22] <mark_edward> the only truth is the source
[08:00:41] <mark_edward> kemurphy:  look at the source, my young coder
[08:01:04] <aatch> ARGH. I get LLVM assertion trying to make this snapshot.
[08:01:18] <aatch> And I don't want to snapshot the memory regression.
[08:02:07] <mark_edward> aatch: look to the source, then you will find the truth of the assertion
[08:02:48] <dbaupp> aatch: how? did it go through bors?
[08:03:05] *** Joins: vk (vk@moz-389FEE13.hsd1.ca.comcast.net)
[08:03:12] <aatch> dbaupp, I think it's because the snapshot itself is too old
[08:03:33] <dbaupp> aatch: oh, this is the one that was made weeks ago?
[08:03:43] <aatch> dbaupp, no, about 4 days
[08:03:51] <dbaupp> oh
[08:03:54] <aatch> but strcat has made a lot of lower-level changes in that time
[08:03:59] <aatch> yay weekends?
[08:04:17] *** Joins: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com)
[08:05:21] <strcat> http://buildbot.rust-lang.org/builders/doc/builds/254/steps/compile/logs/stdio stupid doc bot
[08:06:09] <strcat> and bors is stuck again
[08:06:39] *** Joins: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP)
[08:06:39] <ghrust> 01[13rust01] 15thestinger pushed 3 new commits to 06master: 02http://git.io/lV8XQw
[08:06:39] <ghrust> 13rust/06master 14f74250e 15Daniel Micay: vec::with_capacity: do one alloc for non-managed
[08:06:39] <ghrust> 13rust/06master 146f5be90 15Daniel Micay: ptr: optimize {swap,replace,read}_ptr
[08:06:39] <ghrust> 13rust/06master 14b5e9194 15Daniel Micay: Merge pull request #7682 from thestinger/vec...
[08:06:41] *** Parts: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP) ()
[08:07:06] <strcat> do something bors ;p
[08:07:09] <aatch> Ok, I'm calling it a day. My to-be-replaced machine is frustrating me and this snapshot isn't helping.
[08:07:28] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[08:07:28] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14df760c0 to 14b5e9194: 02http://git.io/N3iJvQ
[08:07:28] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[08:07:30] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[08:07:30] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/FDQL6g
[08:07:30] <ghrust> 13rust/06auto 1447b9294 15James Miller: Revert "De-share ast::Ty"...
[08:07:30] <ghrust> 13rust/06auto 14469713f 15bors: auto merge of #7678 : brson/rust/deshareastty, r=brson...
[08:07:32] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[08:07:39] <aatch> What, why?
[08:07:52] <strcat> aatch: hrm?
[08:07:55] <aatch> bors, I hate you
[08:07:56] <strcat> aatch: I closed it
[08:07:58] <strcat> it's broken
[08:08:06] <aatch> tp[hjsaerihojeruioghsuoerh utah43986t 2q3496yhtq946ht34urhtg 
[08:08:07] <strcat> needs a new PR
[08:08:38] <strcat> aatch: possibly buildbot's fault
[08:08:42] <aatch> strcat, but why is bors doing it again, it already failed.
[08:08:45] <strcat> it's not doing anything
[08:08:52] <strcat> aatch: buildbot could be lying to bors
[08:08:53] <strcat> dunno
[08:08:59] <strcat> aatch: http://buildbot.rust-lang.org/console?branch=auto&refresh=15 it's messed up
[08:09:09] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[08:10:31] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[08:10:31] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 14469713f to 14b5e9194: 02http://git.io/N3iJvQ
[08:10:31] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[08:10:35] *** Joins: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP)
[08:10:35] <ghrust> 01[13rust01] 15bors pushed 4 new commits to 06auto: 02http://git.io/kZM4JA
[08:10:35] <ghrust> 13rust/06auto 14033ac54 15Felix S. Klock II: Fix #3225: Check for old Rust libraries when building and installing....
[08:10:35] <ghrust> 13rust/06auto 1425f51ee 15Felix S. Klock II: Fix #3225: Incorporate feedback from Graydon....
[08:10:35] <ghrust> 13rust/06auto 14ace4944 15Felix S. Klock II: Fix #3225: Incorporate feedback from Graydon....
[08:10:37] *** Parts: ghrust (ghrust@F6EE6DE3.6A2AE50.F3114085.IP) ()
[08:10:38] <vilonis> I just came across this strange warning
[08:10:53] <strcat> aatch: I think bors went insane again
[08:10:55] <strcat> :(
[08:11:01] <aatch> strcat, yes.
[08:11:01] <strcat> oh nvm
[08:11:03] <strcat> it's fixed
[08:11:16] <strcat> aatch: closing the revert PR fixed it
[08:11:17] <strcat> ;\
[08:11:26] <vilonis> rusti: let mut x = None; x = Some(7); match x { Some(i) => println(fmt!("%i", i)), _ => {} };
[08:11:26] -rusti- <anon>:7:17: 7:18 warning: value assigned to `x` is never read [-W dead-assignment (default)]
[08:11:27] -rusti- <anon>:7          let mut x = None; x = Some(7); match x { Some(i) => println(fmt!("%i", i)), _ => {} };
[08:11:27] -rusti-                           ^
[08:11:27] -rusti- 7
[08:11:27] -rusti- ()
[08:11:33] <strcat> or not
[08:11:35] * strcat sighs
[08:11:50] <aatch> vilonis, huh, interesting.
[08:12:17] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[08:12:44] <strcat> aatch: it's correct though
[08:12:48] <kemurphy> vilonis: what about that is strange?
[08:12:54] <strcat> it's unhappy that there's a path where None is assigned and never read
[08:12:59] <strcat> only a path*
[08:13:08] <strcat> rusti: let mut x = 5; x = 6; x
[08:13:08] <aatch> strcat, oh right.
[08:13:08] -rusti- <anon>:7:17: 7:18 warning: value assigned to `x` is never read [-W dead-assignment (default)]
[08:13:08] -rusti- <anon>:7          let mut x = 5; x = 6; x
[08:13:09] -rusti-                           ^
[08:13:09] -rusti- 6
[08:13:11] <vilonis> Oh, that makes sense
[08:13:25] <strcat> rusti: let mut x; x = 6; x
[08:13:27] -rusti- 6
[08:13:27] <strcat> it wants that
[08:13:47] <strcat> it has reasonably clever control flow reasoning for verifying moves
[08:13:55] <strcat> so I guess that lint reuses it
[08:14:08] <vilonis> that is far more clever than I thought it would be
[08:14:13] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[08:14:17] <vilonis> this language impresses me more and more everyday
[08:14:31] <strcat> vilonis: well it has to know if something is initialized or moved from in all possible paths of flow
[08:14:31] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[08:14:33] *** Joins: relistan (relistan@A7E4EF66.4C1F25E9.4BA0249.IP)
[08:14:40] <strcat> or it'd be much more restrictive
[08:14:40] <vilonis> thanks for the explanation
[08:14:49] <aatch> strcat, well actually that lint is _part_ of moves
[08:15:01] <aatch> (as in the moves module in the compiler)
[08:15:02] <dbaupp> strcat: (fwiw, I think the info is actually recorded as the moves are calculated, and lint just goes an checks for it)
[08:15:07] <strcat> rusti: let x; loop { x = 6 }
[08:15:08] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/FOTM
[08:15:09] <dbaupp> *and
[08:15:10] <strcat> dbaupp: ah
[08:15:23] <strcat> rusti: let x; loop { x = 6; break }
[08:15:24] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/NFAH
[08:16:48] *** Quits: aatch (aatch@moz-2BB0AC01.cable.telstraclear.net) (Client exited)
[08:18:27] *** Joins: z0w0 (zack@moz-37A98529.lnse2.woo.bigpond.net.au)
[08:19:09] <strcat> dbaupp: I can think of hundreds of ideas for lints ;p
[08:19:13] <strcat> just too lazy to implement them
[08:21:01] *** Quits: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[08:21:01] *** Quits: scanlonman (scanlonman@moz-169BC238.hsd1.wa.comcast.net) (Quit: My MacBook has gone to sleep. ZZZzzzâ€¦)
[08:21:30] *** Quits: vk (vk@moz-389FEE13.hsd1.ca.comcast.net) (Quit: vk)
[08:21:49] *** Quits: xLII (xLII@2433BC90.F5F53E8A.2D6DB75E.IP) (Ping timeout)
[08:22:13] *** Quits: Voomer__ (Voomer@moz-E97E8EB7.br.br.cox.net) (Connection reset by peer)
[08:22:41] <dbaupp> strcat: yeah, I'm the same
[08:27:46] *** Quits: smvv_ (sander@moz-BAEA8EB2.dynamic.upc.nl) (Quit: leaving)
[08:28:43] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[08:30:37] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[08:30:46] *** Quits: flowsnake (flowsnake@moz-1918C33E.aztw.cable.virginmedia.com) (Ping timeout)
[08:30:57] *** Quits: CraigE (craige@moz-DF25A0FC.wi.res.rr.com) (Connection reset by peer)
[08:34:11] *** Joins: flowsnake (flowsnake@moz-1918C33E.aztw.cable.virginmedia.com)
[08:34:18] *** Quits: fabiand_ (fabiand@moz-C17D01C9.adsl.alicedsl.de) (Quit: Verlassend)
[08:34:30] *** Joins: fabiand (fabiand@moz-C17D01C9.adsl.alicedsl.de)
[08:35:12] *** Quits: fabiand (fabiand@moz-C17D01C9.adsl.alicedsl.de) (Quit: Verlassend)
[08:35:24] *** Joins: fabiand (fabiand@moz-C17D01C9.adsl.alicedsl.de)
[08:43:26] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[08:45:11] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Ping timeout)
[08:46:09] *** Joins: CarpNet (ac@moz-FD24B77.sohonet.co.uk)
[08:50:08] *** Joins: xLII (xLII@2433BC90.F5F53E8A.2D6DB75E.IP)
[09:01:35] *** Joins: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net)
[09:02:08] *** Quits: pyrac (pyrac@moz-C9A2635A.infra.univ-bordeaux.fr) (Quit: pyrac)
[09:02:23] *** Joins: olleharstedt (Thunderbir@moz-80D8890F.ias.bredband.telia.com)
[09:02:49] *** Joins: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk)
[09:03:27] *** Quits: xLII (xLII@2433BC90.F5F53E8A.2D6DB75E.IP) (Ping timeout)
[09:03:38] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[09:05:41] *** Joins: pyrac (pyrac@F9CC429.73C89388.AD05C589.IP)
[09:06:13] *** Joins: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP)
[09:06:39] *** Joins: Ms2ger (Ms2ger@moz-E9883900.access.telenet.be)
[09:06:49] *** Joins: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net)
[09:06:54] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[09:07:45] *** Quits: jviereck (Adium@moz-2D5D7F91.ethz.ch) (Quit: Leaving.)
[09:10:19] <vilonis> I'm having some trouble using the std::rand library, using the same code as the tests
[09:11:24] <vilonis> I am getting the error "std::rand::IssacRng" does not implement any method in scope named `blank`
[09:12:05] <vilonis> where blank is next, or gen_int_range, or choose, etc
[09:12:48] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[09:12:54] <vilonis> looking through the source code, it looks like the impl's of the trait RngUtil do not have 'pub' qualifiers, could that be the issue or am I doing something wrong?
[09:14:41] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[09:20:37] <doener> vilonis: you have to have the trait in scope to use the methods (as the error message says). Maybe you're missing "use std::rng::RngUtil"?
[09:20:49] <doener> err, "use std::rang::RngUtil"
[09:21:08] * doener gives up
[09:21:16] <doener> use std::rand::RngUtil
[09:21:44] <klutzy> rusti: let mut r = rand::rng(); (&mut r as &mut rand::RngUtil).gen_int_range(10,20)
[09:21:45] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/UCTi
[09:22:01] <klutzy> rusti: use std::rand; let mut r = rand::rng(); (&mut r as &mut rand::RngUtil).gen_int_range(10,20)
[09:22:02] -rusti- 13
[09:22:43] <klutzy> vilonis: it's because IssacRng does not have gen_int_range directly
[09:23:55] *** Joins: jviereck (Adium@moz-2D5D7F91.ethz.ch)
[09:24:41] <vilonis> klutzy: okay I see, is there a reason the test code at the bottom of rand.rs does not need to do the cast?
[09:26:42] <doener> rusti: use std::rand::RngUtil: let mut r = rand::rng(); r.gen_int_range(10, 20)
[09:26:43] -rusti- <anon>:7:31: 7:32 error: expected `;` but found `:`
[09:26:43] -rusti- <anon>:7          use std::rand::RngUtil: let mut r = rand::rng(); r.gen_int_range(10, 20)
[09:26:43] -rusti-                                         ^
[09:26:43] -rusti- application terminated with error code 101
[09:26:49] <doener> rusti: use std::rand::RngUtil; let mut r = rand::rng(); r.gen_int_range(10, 20)
[09:26:51] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/MRVg
[09:27:03] <doener> rusti: use std::rand::RngUtil; let mut r = std::rand::rng(); r.gen_int_range(10, 20)
[09:27:04] -rusti- 12
[09:27:12] *** Quits: heftig (heftig@moz-9748F6D5.dip0.t-ipconnect.de) (Ping timeout)
[09:27:16] <doener> there, as I said
[09:29:22] <vilonis> doener: okay, so just using the type is not enough, the trait has to be `use`d as well
[09:30:23] <doener> vilonis: exactly. Otherwise you'd get into trouble if you try to implement two traits for the same type that have methods with equal names.
[09:30:51] <doener> vilonis: by only resolving methods of traits that are in scope, conflicts can be avoided
[09:32:41] <vilonis> doener: that makes a lot of sense, thanks for the solution and a helpful explanation
[09:43:49] <cmr> dbaupp: pong
[09:45:19] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[09:45:34] *** Quits: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com) (Ping timeout)
[09:47:42] *** Joins: Excureo (c@moz-EB93D257.static.knwc.wa.charter.com)
[09:52:46] <vilonis> doener: that makes a lot of sense, thanks for the solution and a helpful explanation
[09:52:48] <vilonis> damn it
[09:53:20] <vilonis> I knew, sooner or later, I was going to up-arrow -> enter and it wouldn't rerun a source file...
[09:53:44] <cmr> heh
[09:56:21] *** Joins: cubic (cubic@moz-FE5AD6C7.mc.videotron.ca)
[10:04:58] *** Joins: Earnestly (earnest@2AB30F53.FB5005.2BCC804A.IP)
[10:07:45] *** Joins: sigma (sigma@51C589B3.EF2694B5.DFAC6AA7.IP)
[10:11:52] *** Joins: vosen (vosen@moz-3B059DC4.sta.asta-net.com.pl)
[10:12:17] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[10:13:23] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[10:13:38] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[10:15:11] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[10:15:40] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Ping timeout)
[10:17:08] *** Quits: vilonis (jared@moz-EE5D17ED.ph.ph.cox.net) (Quit: WeeChat 0.3.8)
[10:18:38] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[10:19:30] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[10:19:30] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/kZM4JA
[10:19:30] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[10:19:36] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[10:20:22] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[10:22:26] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[10:22:26] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/sI0Ohw
[10:22:26] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[10:23:11] *** Quits: sankha93 (Instantbir@A7679ECF.199B3CEE.EFB84E89.IP) (Quit: Instantbird 1.4 -- http://www.instantbird.com)
[10:25:04] <mark_edward> cmr: my PR failed to merge, but it had said that it marged cleanly. what do i need to do? https://github.com/mozilla/rust/pull/7631
[10:25:29] *** Joins: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP)
[10:25:29] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/sI0Ohw
[10:25:29] *** Parts: ghrust (ghrust@614D05BD.6A2AE50.F3114085.IP) ()
[10:25:30] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[10:25:30] <ghrust> 01[13rust01] 15bors pushed 3 new commits to 06auto: 02http://git.io/90b5Wg
[10:25:30] <ghrust> 13rust/06auto 14eaaf3f6 15John Barker: Always eat up mut when parsing general args, fixes #7483
[10:25:30] <ghrust> 13rust/06auto 1456d1987 15John Barker: Don't use static default method...
[10:25:31] <ghrust> 13rust/06auto 148fa0973 15bors: auto merge of #7658 : excepttheweasel/rust/mut_default_param_list_issue_7483, r=pcwalton
[10:25:33] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[10:26:08] *** Quits: ion (ion@heh.fi) (Ping timeout)
[10:28:38] <cmr> mark_edward: where does it say it merged cleanly?
[10:28:51] <cmr> mark_edward: anyway you just need to rebase it
[10:28:54] <mark_edward> cmr: it had said that it *would*
[10:29:00] <cmr> bors sometimes lies
[10:29:19] <SimonSapin> is it bad practice to use task::try + fail!() for flow control?
[10:29:25] <cmr> `git fetch mozilla; git checkout ptr_arithmetic; git rebase -i mozilla/master;`
[10:29:59] <mark_edward> cool
[10:33:22] *** Joins: ion (ion@heh.fi)
[10:35:44] <kimundi> SimonSapin: well if you don,t mind slow performance...
[10:36:09] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[10:36:16] <cmr> pnkfelix: what does snagging for review mean? (I had just given it an r+)
[10:36:57] <pnkfelix> cmr: oh sorry
[10:37:50] <pnkfelix> cmr: (I did not see your comment.  The "snagging for review" was just me trying to acquire a lock.)
[10:37:57] <cmr> ah
[10:38:16] <cmr> r? https://github.com/mozilla/rust/pull/7687
[10:38:50] *** Quits: huhlig-home (huhlig@moz-C8339267.hfc.comcastbusiness.net) (Connection reset by peer)
[10:39:23] *** Joins: q66 (q66@6EE9DE40.46454B5D.33AABD5F.IP)
[10:42:22] *** Joins: eagen (eagen@moz-92A457CB.hsd1.mn.comcast.net)
[10:47:32] <mark_edward> cmr: i rebased
[10:50:07] *** Joins: vosen_ (vosen@moz-3B059DC4.sta.asta-net.com.pl)
[10:50:43] *** Quits: vosen (vosen@moz-3B059DC4.sta.asta-net.com.pl) (Ping timeout)
[10:51:54] *** Joins: true_droid (Adium@moz-123FD9B8.beck.volia.net)
[10:52:48] *** Quits: pyrac (pyrac@F9CC429.73C89388.AD05C589.IP) (Quit: pyrac)
[10:54:41] *** Quits: jviereck (Adium@moz-2D5D7F91.ethz.ch) (Quit: Leaving.)
[10:55:39] *** Joins: etw (john@moz-B2936CAB.nyc.res.rr.com)
[11:09:11] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[11:09:12] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[11:09:53] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[11:13:56] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[11:14:38] <cmr> dbaupp: ping
[11:15:13] *** Joins: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au)
[11:15:42] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[11:16:06] *** Quits: eagen (eagen@moz-92A457CB.hsd1.mn.comcast.net) (Quit: Leaving)
[11:23:22] <dbaupp> cmr: pong
[11:23:51] <dbaupp> cmr: (my ping was saying that is seems that tip-of-master commits are ending up in last_auto.txt?)
[11:23:56] <cmr> dbaupp: I figured out a fix, but for deriving(Clone) I got `clean.rs:63:11: 63:16 error: mismatched types: expected `syntax::ast::prim_ty` but found `&syntax::ast::prim_ty` (expected enum syntax::ast::prim_ty but found &-ptr)
[11:23:57] <cmr> `
[11:24:31] <cmr> dbaupp: yes, I'm rewinding the time machine to master on every new pull, on the assumption that filling in newer data is better than filling in older data, and that the skip will do the right thing
[11:24:32] <dbaupp> cmr: yeah, auto-deref breaks deriving on borrowed pointers :/
[11:24:43] <dbaupp> cmr: oh I see
[11:25:11] <dbaupp> cmr: (I would've thought that no commits to master are missed, so it doesn't make a particular difference, but whatever, it's safer this way :) )
[11:25:40] <cmr> It does miss commits, if there was more than 1 PR merged while it was doing a force/time machine bench
[11:25:41] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[11:25:46] *** Joins: heftig (heftig@moz-CC716F18.dip0.t-ipconnect.de)
[11:26:09] <dbaupp> oh, it's that slow, is it?
[11:26:26] <cmr> it was for the older ones where LLVM needed to be rebuilt
[11:27:22] *** Joins: mye (mye@moz-ACE53E5D.dip0.t-ipconnect.de)
[11:27:24] <dbaupp> yeah, makes sense
[11:28:08] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[11:28:15] <dbaupp> cmr: also, for your bench rearrangement, could you put a summary in the pr text, it's sorta hard to interpret github's display of the moved files.
[11:28:22] <cmr> sure
[11:29:47] <dbaupp> cmr: wait, doesn't matter, I just looked at the file tree itself.
[11:29:57] <cmr> as I finish ;\
[11:30:25] * dbaupp is sorry
[11:31:12] <engla> if I add a Deque trait for dlist and deque, where would it go? extra::container? (we have some other examples of std and extra modules with the same name)
[11:33:46] <engla> what's the big merge? new runtime?
[11:34:00] <cmr> yep
[11:37:46] <engla> :cake:
[11:37:48] <engla> nice
[11:38:40] *** Joins: jviereck (Adium@moz-2D5D7F91.ethz.ch)
[11:40:42] *** Joins: pyrac (pyrac@F9CC429.73C89388.AD05C589.IP)
[11:44:15] *** Quits: bytbox (s@moz-DC83764A.washdc.fios.verizon.net) (Ping timeout)
[11:46:32] <cmr> \o/ working type resolution
[11:46:35] <cmr> Seldaek: ping
[11:49:42] *** Joins: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net)
[11:50:12] <Seldaek> cmr: ?
[11:50:45] <cmr> Seldaek: I have rustdoc_ng working-enough that I can give you JSON if you want to play around with a frontend
[11:53:00] <Seldaek> cmr: ok, is there a rust template language of some sort yet or how is this typically done? Otherwise I'd tend to prototype this with php or JS
[11:54:52] <cmr> Seldaek: php/js is fine, rust has nothing of the sort yet
[11:56:58] <cmr> https://gist.github.com/cmr/7fd3ba4f64ef4cdd14f8
[11:57:49] <Seldaek> cmr: could you run it on something real or is it not ready for that yet?
[11:58:34] <Seldaek> just because when building lists and stuff, if you only have 2 items it doesn't feel right and it's hard to layout things with dummy data IMO
[11:58:55] <cmr> Seldaek: not quite ready (and it only does structs atm), it should be working-enough to run on libstd soonish
[12:00:30] <Seldaek> ok cool
[12:00:48] <Seldaek> I'll get started with that json then, whenever I have time which may not be for a while anyway :/
[12:00:59] <cmr> that's fine
[12:01:15] <Seldaek> when's 0.8 planned?
[12:01:24] <cmr> 3 months from last week
[12:01:34] <Seldaek> ok I wasn't sure if there was a fixed schedule
[12:02:27] *** Joins: bytbox (s@moz-DC83764A.washdc.fios.verizon.net)
[12:04:01] <Seldaek> I'll have a lot more free time in august, so I hope we can push that forward enough to be ready by 0.8 then
[12:04:06] *** Quits: mye (mye@moz-ACE53E5D.dip0.t-ipconnect.de) (Quit: mye)
[12:04:58] <cmr> there are others who expressed interest in helping with the doc ui, and I can whip up basic/ugly/hackish ones
[12:05:18] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Quit: Computer has gone to sleep.)
[12:05:26] <Seldaek> and if our designer is idle at some point I might also be able to throw him on that for a bit for added shininess 
[12:06:18] <cmr> Cool!
[12:09:59] <bjz> cmr do you need help?
[12:10:14] <cmr> bjz: re: rustdoc interface? yes
[12:11:06] <bjz> cmr: have you been working on it lately?
[12:11:15] <cmr> bjz: I'm rewriting rustdoc
[12:11:28] <bjz> cmr: I've just noticed changes
[12:11:34] <cmr> that was SiegeLord
[12:11:45] *** Joins: Mowah (Mowah@moz-7A6BF5A3.cust.bredbandsbolaget.se)
[12:11:51] <bjz> cmr: are you going from the ground up?
[12:11:54] <cmr> bjz: yes
[12:11:59] <bjz> awesome
[12:12:53] <engla> to add a a new file to libextra (container.rs) and then use it from another module (use container::Deque) it has to go through a snapshot?
[12:14:32] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[12:15:08] <engla> oh duh I have to add it to extra.rs
[12:16:22] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[12:17:07] *** Joins: sk (sk@61A494B3.BA40E8A.AAC02D62.IP)
[12:18:21] *** Quits: doomlord_ (servitor@moz-13E69BC8.range86-180.btcentralplus.com) (Ping timeout)
[12:18:30] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[12:19:24] *** Joins: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP)
[12:19:25] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/90b5Wg
[12:19:25] *** Parts: ghrust (ghrust@E7A4CCE2.6A2AE50.F3114085.IP) ()
[12:22:17] *** Joins: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de)
[12:22:27] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[12:22:28] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/XDY7TA
[12:22:28] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[12:22:29] *** Joins: ghrust (ghrust@C621748.6A2AE50.F3114085.IP)
[12:22:29] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/4BmJ8A
[12:22:29] <ghrust> 13rust/06auto 146330d1c 15Niko Matsakis: Add an identifier to TypeParameterDefs and use it to pretty print type parameters
[12:22:29] <ghrust> 13rust/06auto 141beab8a 15bors: auto merge of #7280 : nikomatsakis/rust/type-parameter-names, r=cmr...
[12:22:29] *** Parts: ghrust (ghrust@C621748.6A2AE50.F3114085.IP) ()
[12:22:48] <nmatsakis> is aatch still doing regular snapshots?
[12:23:02] <cmr> he's trying
[12:23:07] <cmr> buildbot problems recently
[12:23:23] <nmatsakis> ok
[12:23:44] <cmr> he has a snapshot ready and waiting, but the snap-bots decide they don't want to run to completion
[12:26:05] *** Quits: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com) (Client exited)
[12:28:55] *** Quits: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de) (Ping timeout)
[12:30:13] *** Quits: noj (jon@moz-D51AE9DE.swym.se) (Ping timeout)
[12:30:48] *** Joins: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de)
[12:31:19] *** Quits: pyrac (pyrac@F9CC429.73C89388.AD05C589.IP) (Quit: pyrac)
[12:31:20] *** Quits: etw (john@moz-B2936CAB.nyc.res.rr.com) (Quit: etw)
[12:31:53] *** Joins: lmandel (lmandel@moz-76CE9D51.cable.teksavvy.com)
[12:34:09] <dbaupp> nmatsakism, cmr: he actually got one to go through, but then (apparently) enough has changed in the 4 days since then that it is meeting LLVM assertions.
[12:35:39] *** Joins: pyrac (pyrac@F9CC429.73C89388.AD05C589.IP)
[12:35:57] <nmatsakis> dbaupp: eh? that's... strange. doesn't that imply the snapshot commit was buggy?
[12:36:23] <dbaupp> nmatsakis: I have no idea, that explanation is the one he gave me (he wasn't sure either though)
[12:37:09] *** Quits: jviereck (Adium@moz-2D5D7F91.ethz.ch) (Quit: Leaving.)
[12:37:14] *** Joins: Sergio965 (sergiobz@moz-BB21156B.dynamic.csail.mit.edu)
[12:37:38] *** Joins: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[12:38:41] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[12:41:17] *** Quits: lmandel (lmandel@moz-76CE9D51.cable.teksavvy.com) (Quit: lmandel)
[12:48:50] *** Joins: smvv_ (sander@moz-BAEA8EB2.dynamic.upc.nl)
[12:49:54] <MaikKlein> are enums sendable by default?
[12:50:37] <nmatsakis> MaikKlein: if they contain sendable things
[12:51:53] <MaikKlein> nmatsakis, is empty a sendable thing? :)
[12:52:00] *** Joins: noj (jon@moz-D51AE9DE.swym.se)
[12:52:11] <MaikKlein> just enum Message { Start,Stop}
[12:52:22] <nmatsakis> MaikKlein: should be
[12:52:34] <MaikKlein> thanks
[12:53:23] <dbaupp> rusti: fn test_send<S: Send>(_: S) {} enum Message { Start, Stop } test_send(Start) // MaikKlein 
[12:53:23] -rusti- ()
[12:54:44] <MaikKlein> thanks :)
[12:55:08] <smvv_> Using rust 0.8pre, i've a two errors related to mutability (mutable more than once, mutable borrow also immutable). https://gist.github.com/smvv/5966010 The problem has to do with the swap() operation. I'm shifting all nodes after `pos' one position to the right to make room for the to-be-inserted value. How should I approach this?
[12:56:35] *** Quits: victorporof (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP) (Quit: victorporof)
[12:56:41] *** Quits: santiago (santiago@moz-8ADE82B4.socal.res.rr.com) (Quit: Computer has gone to sleep.)
[12:57:17] *** Joins: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP)
[12:57:18] <cmr> nmatsakis: I'm having some troubles with rustdoc_ng. It seems to fail to resolve imports in external crates... https://github.com/cmr/rustdoc_ng/blob/wip/main.rs#L34 is the code (it matches all the steps rustc does until typeck), the log it generates is https://gist.github.com/cmr/0685e881a9dafa6a5093. Am I missing something in the session options?
[12:57:51] <cmr> https://gist.github.com/cmr/0685e881a9dafa6a5093/raw/e3f0efbc12ee85ecf47591c2897a6487233d8491/gistfile1.txt for the full file, sorry.
[12:59:15] *** Joins: jdm (jdm@92FB48CA.8B5E9DF.9A8C35B4.IP)
[12:59:57] *** Quits: eevee (eevee@moz-58058235.evrt.wa.frontiernet.net) (Ping timeout)
[13:01:06] *** Joins: saml (sam@moz-14C16814.cst.lightpath.net)
[13:02:08] <pnkfelix> smvv_: line 38, you're &mut- borrowing two elements from the same vector.  I do not think you can do that.  (In this case one could prove that the two memory cells do not alias, but in general one could not assume that, and so I think the borrow checker rejects the form as a general rule.)
[13:03:13] <smvv_> pnkfelix: how would you perform the swap operation? note: tree.nodes is a fixed-length vec
[13:03:35] <MaikKlein> does a port.recv() block the task until it received a message?
[13:04:02] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[13:04:10] <pnkfelix> smvv_: I don't know what the best approach is, but I'd probably copy into a local temporary, and handle each index separately.
[13:04:19] <pnkfelix> smvv_: (ugly, I know)
[13:04:20] <cmr> MaikKlein: afaik yes, it yields to the scheduler and the scheduler won't reschedule the task until there's something for it to read
[13:04:43] <smvv_> pnkfelix: ok i'll try that and mark it as 'TODO: ugly' indeed :)
[13:05:51] * pnkfelix wonders if the vec library has a helper for swapping imperatively
[13:06:06] *** Quits: StarLight (StarLight@moz-754F462F.dynamic.avangarddsl.ru) (Ping timeout)
[13:06:35] <pnkfelix> smvv_: Yeah, there is a `swap` method on the MutableVector trait
[13:06:46] <pnkfelix> smvv_: So maybe you can just do tree.nodes.swap(i+1, i) ?
[13:07:14] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[13:07:18] *** Joins: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au)
[13:07:29] <dbaupp> smvv_, pnkfelix: the vector tree.nodes vector is still borrowed, so while better, it still probably won't work :(
[13:07:29] <MaikKlein> then I have no idea how I would build an actor library :( 
[13:07:32] *** Joins: untothebreach (paul@15A17709.47300931.30F15291.IP)
[13:07:34] <pnkfelix> smvv_: (and if you look at the library source, you can see that they ran into the exact same problem there, and get around it with an unsafe block.)
[13:08:00] <cmr> MaikKlein: isn't there a try_recv?
[13:08:08] <dbaupp> cmr: different thing
[13:08:18] <dbaupp> cmr: that returns None if the channels is closed
[13:08:23] <pnkfelix> smvv_: Well, I think that problem may get in the way of you even adopting the "local temp" solution ...
[13:08:28] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[13:08:33] <cmr> oh
[13:09:44] *** Joins: bytewise (bytewise@moz-649C630D.unitymediagroup.de)
[13:10:34] <MaikKlein> there is a peek
[13:10:48] <MaikKlein> which tells me if a message is available
[13:11:08] *** Joins: StarLight (StarLight@moz-B9BF4242.dynamic.avangarddsl.ru)
[13:11:37] *** Joins: BitPuffin (quassel@moz-49828767.cust.tele2.se)
[13:11:55] <MaikKlein> the only way to talk to another tasks is via chan/port right?
[13:12:52] <dbaupp> MaikKlein: and `static mut` globals, but I didn't tell you that :P
[13:13:03] <MaikKlein> this doesn't make any sense to me atm :(
[13:13:07] <MaikKlein> haha
[13:13:24] <dbaupp> (oh, and the various things in extra::arc)
[13:13:30] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[13:13:36] <MaikKlein> oh I haven't looked at arc yet
[13:13:55] <cmr> for a remote actor you just want a Chan/Port though
[13:14:38] <MaikKlein> cmr, but that's not really possible if I understood it correct
[13:14:46] <cmr> MaikKlein: why?
[13:14:54] *** Joins: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com)
[13:15:02] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[13:15:08] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[13:16:00] <MaikKlein> if I have a struct Actor, I can't really let it spawn itself in a new task because I can't put the port in a task without destroying the object itself, then I thought of a "controller" that manages my actors like spawning and controlling
[13:16:27] <MaikKlein> but I can't really control a task when it is spawned because the tasks can only listen to one message at a time
[13:16:48] <cmr> talk to brson or someone about it
[13:16:53] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[13:17:02] <cmr> bblum and toddaaro are the rt interns  I think
[13:17:43] <MaikKlein> I could probably check from time to time if a message is available, but this would be super weird. An eventbased mechanism would be much better. And sth that doesn't block
[13:17:44] <pnkfelix> smvv_: it seems with some restructuring you might be able to move that while loop out of the scope of the borrow of the `ref k` and `ref mut v`. (Maybe.)  I'd look into that.
[13:17:50] <MaikKlein> cmr, y I probably do that
[13:18:24] <dbaupp> MaikKlein: are there PortSet or ChanSet types?
[13:19:07] <MaikKlein> dbaupp, yes 
[13:19:29] <dbaupp> MaikKlein: doesn't that allow you to listen to multiple messages at once?
[13:19:31] <Seldaek> MaikKlein: what I did in go was using a timer which is also a task sending messages, so you could listen for an event on either your task or the timer, and if you receive from the timer you can do something like kill the task for a timeout
[13:19:43] <Seldaek> I'd imagine something similar is possible here
[13:19:47] <Seldaek> though I haven't done it yet
[13:20:16] <dbaupp> Seldaek: (I'm not sure there's even a per-task sleep fn in Rust yet :( )
[13:20:55] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[13:21:02] <MaikKlein> dbaupp, Chanset acts like a vector filled with chans, which I am using. But I haven'T figured out what a PortSet is for because you can't clone a port
[13:21:46] <dbaupp> MaikKlein: why do you need to clone a port?
[13:22:27] <MaikKlein> dbaupp, ah I think I know what you mean
[13:22:44] * MaikKlein checking the API again
[13:22:54] <dbaupp> MaikKlein: it looks like PortSet is used like: let ps = PortSet::new(); let c1 = ps.chan(); let c2 = ps.chan(); <transfer c1/c2 to other tasks>; let some_value = ps.recv()
[13:24:47] * roo thinks that macro_rules! foo (( $(x) ) => ( $(x) )) should represent 'possibly one' occurrence
[13:25:34] <dbaupp> roo: I think someone implemented `$(x)?`, I don't know if they actually merged it though
[13:25:43] * roo tests it out
[13:26:18] <roo> not yet
[13:26:48] <dbaupp> hm, this was months ago, so presumably there was some issue/they forgot about it
[13:27:56] *** Quits: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Connection reset by peer)
[13:28:26] *** Joins: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[13:29:44] <MaikKlein> dbaupp, yes okay but then ps.recv would still block my whole task and I wouldn't have one anything :(. Let's say an actor is running in it's own task. It does some calculation over and over again. But then I want to stop it. Now the actor can't really listen to my message and do calculations at the same time.
[13:30:10] <MaikKlein> I could however check from time to time if a message is available via peek
[13:30:21] <MaikKlein> but that doesn't sound right :(
[13:30:36] <dbaupp> it's not that bad
[13:30:46] <dbaupp> (at least, it's the best you'll get at the moment.)
[13:30:58] *** Joins: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP)
[13:31:30] *** Quits: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net) (Input/output error)
[13:31:37] *** Joins: tiffany (kawaii@moz-1E0FE6E8.dhcp.embarqhsd.net)
[13:31:59] *** Joins: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com)
[13:32:12] *** Joins: sankha93 (Instantbir@6B172289.35354309.EFB84E89.IP)
[13:32:33] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Quit: jorendorff)
[13:33:28] <cmr> MaikKlein: Actors aren't supposed to be concurrent like that? If you want to be doing calculations while listening to a message, you'd spawn another task I'd think
[13:34:19] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[13:34:50] <MaikKlein> cmr, I need a way to control the actor somehow, so spawning another task would give me any benefits.
[13:34:59] <MaikKlein> but I think I could do that with globals
[13:35:01] <MaikKlein> :p
[13:35:10] <cmr> MaikKlein: I see "actors" as just a way to seamlessly have remote tasks
[13:35:52] <MaikKlein> cmr, for me an actor is sth like a monster in a video game. it moves around and communicates to other monsters
[13:36:02] <MaikKlein> thats what I want to build
[13:36:12] <cmr> That's a different concept of actor than the concurrency one I think
[13:36:20] * cmr not sure
[13:36:28] <MaikKlein> possibly
[13:36:53] <MaikKlein> I think the task is meant for one time things 
[13:37:04] <MaikKlein> like do this calculation and then send the the result
[13:37:06] <MaikKlein> done
[13:37:18] <cmr> that's not what servo uses them for
[13:38:34] <MaikKlein> I haven't seen to many task examples, I could totally miss sth really important
[13:38:59] <MaikKlein> are static mut globals module based?
[13:39:13] <MaikKlein> so they are only global in one module?
[13:39:36] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[13:39:55] <dbaupp> MaikKlein: I think they're just like normal `static`s
[13:40:10] <dbaupp> (but you should *really* avoiding using them if at all possible.)
[13:40:16] <MaikKlein> :(
[13:40:42] <dbaupp> heh, https://github.com/mozilla/rust/pull/7659#issuecomment-20740592
[13:40:51] * dbaupp isn't very surprised.
[13:41:39] *** Quits: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com) (Quit: jeff)
[13:41:43] <doener> heh
[13:42:20] *** Joins: bent (chatzilla@F2D29657.F60B0462.67AC9B1.IP)
[13:42:27] <dbaupp> at least we know that the valgrind bots are working correctly.
[13:42:52] *** Joins: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net)
[13:42:55] <MaikKlein> I think I build my own Port that is cloneable, like struct Actor { port: Port}; so that I can clone the port and move it into a new task without destroying my actor. then I can listen to messages without blocking everything
[13:44:11] *** Joins: lmandel (lmandel@F2D29657.F60B0462.67AC9B1.IP)
[13:44:31] <MaikKlein> hm
[13:44:38] <MaikKlein> I don't even think that is possible
[13:44:39] <dbaupp> MaikKlein: it doesn't make sense to clone a port, unless you have "multilisteners", where the first task to read it gets the value, but the others miss it
[13:44:47] *** Quits: jorendorff (jorendorff@moz-2F32ACA3.hsd1.tn.comcast.net) (Ping timeout)
[13:44:49] <dbaupp> (or something else...)
[13:45:44] <dbaupp> (does osx have /dev/(u)random, or do they use something else?)
[13:46:07] <cmr> dbaupp: they do
[13:46:22] <dbaupp> cmr: ok, thanks.
[13:46:53] <MaikKlein> when I have an Actor { port : Port} and I do sth like do spawn { self.port.recv} now the port has moved into a new task which means my actor itself is destroyed. Is it possible to recover my actor somehow?
[13:47:02] *** Quits: lerc (quassel@moz-598ED764.telstraclear.net) (Quit: No Ping reply in 180 seconds.)
[13:47:21] <dbaupp> MaikKlein: yes, move the port back out of the task.
[13:47:38] *** Joins: lerc (quassel@moz-598ED764.telstraclear.net)
[13:48:24] <MaikKlein> ok I probably do sth like let p = self.port; self.port = do spawn { port.recv(); port } ?
[13:48:37] <dbaupp> nope
[13:48:38] <MaikKlein> ups
[13:48:57] <MaikKlein> let p = self.port; self.port = do spawn { p.recv(); p } ?
[13:48:58] <dbaupp> you might have to use Cells and ARCs or something
[13:49:04] <MaikKlein> hm ok
[13:49:28] <MaikKlein> let cell = Cell::new(self.port) ?
[13:50:43] <MaikKlein> hm
[13:51:44] <dbaupp> cmr: the memory benchmarks seem to be less consistent now?
[13:51:52] <dbaupp> (has something changed?)
[13:51:58] <cmr> nothing has changed
[13:52:07] *** Quits: gavinb (gavinb@moz-9EC182F0.lowrp3.vic.optusnet.com.au) (Ping timeout)
[13:52:19] <MaikKlein> I don't even think I can recover. I don't know how long the task is running. So I don't know when I can move the port back to recover the actor. ahh what ever I need to do some brainstorming
[13:53:12] <cmr> dbaupp: seems to just be linker perturbations
[13:53:18] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[13:53:22] <Seldaek> MaikKlein: what are you trying to achieve actually?
[13:53:28] <cmr> I have no idea how deterministic gcc/ld are
[13:54:04] <dbaupp> cmr: yeah, I should just implement that mean thing, or take the 95th percentile or something.
[13:55:41] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[13:56:07] <MaikKlein> Seldaek, well think of like 10 monsters moving around and doing stuff independently. Now one monster found a flour and it broadcast a message to all other monsters. The other monsters now stop their current work and start cheering because one monster found a flour.
[13:56:25] <MaikKlein> that's essentially what I am trying to do
[13:57:05] <MaikKlein> where each monster is in it's own task ofc
[13:57:34] <dbaupp> MaikKlein: (flour = stuff used to make bread; flower = blossom, thing on a plant. just btw :) )
[13:58:49] <MaikKlein> dbaupp, haha my brains works sometimes mysterious ways :D
[13:59:13] <MaikKlein> I should probably read sometimes what I am trying to write :x
[13:59:51] <bjz> stupid english
[13:59:56] <bjz> x)
[14:01:02] <nmatsakis> MaikKlein: you just have to poll periodically; we don't have another way to preempt those tasks
[14:01:20] <nmatsakis> MaikKlein: if it makes it feel better, most likely if we DID add some form of pre-emption, it would just be polling too
[14:01:28] <darkf> can you implement ToStr on ~-ptr values? (how?) since I get "failed to find an implementation of trait std::to_str::ToStr for ~mytype"
[14:01:34] <ChrisMorgan> How do I show the log output from libstd? RUST_LOG=::help doesn't show anything from it.
[14:01:47] <cmr> ChrisMorgan: RUST_LOG=std=4 ?
[14:02:17] <MaikKlein> it would be so cool tho achieve this, because I could write concurrent game code super easily, controlling the monsters would be simple because you can think of them as independent creatures that send messages and I could even abstract that the monster can exist in a network, so writing networking code is basically for free
[14:02:38] <MaikKlein> nmatsakis, hm yeah that seems like the only way to achieve this
[14:03:16] <dbaupp> rusti: struct A; impl ToStr for ~A { fn to_str(&self) -> ~str { ~"foo" } } A.to_str()
[14:03:16] -rusti- <anon>:7:77: 8:5 error: type `main::A` does not implement any method in scope named `to_str`
[14:03:16] -rusti- <anon>:7          struct A; impl ToStr for ~A { fn to_str(&self) -> ~str { ~"foo" } } A.to_str()
[14:03:17] -rusti- <anon>:8     };
[14:03:17] -rusti- error: aborting due to previous error
[14:03:17] -rusti- application terminated with error code 101
[14:03:23] <MaikKlein> nmatsakis, but an event based system would be so much better :(
[14:03:27] <ChrisMorgan> cmr: doesn't seem to be showing anything for something I *believe* to be logging. But it might be doing its aborting badly before it gets to a debug! in std.
[14:03:43] <dbaupp> darkf: auto-deref is defeating it, I guess
[14:03:58] <dbaupp> darkf: do you need it to be on ~A rather than just plain A?
[14:04:05] <dbaupp> rusti: struct A; impl ToStr for A { fn to_str(&self) -> ~str { ~"foo" } } A.to_str()
[14:04:06] -rusti- ~"foo"
[14:04:14] <cmr> ChrisMorgan: if a call is inlined you need to enable logging for where it was inlined to
[14:04:19] <cmr> hashmap is notorious for this
[14:04:22] <dbaupp> rusti: struct A; impl ToStr for ~A { fn to_str(&self) -> ~str { ~"foo" } } (~A).to_str()
[14:04:23] -rusti- ~"foo"
[14:04:35] <darkf> dbaupp: I do, given that I'm trying to print a ~[~T] where T is an enum value
[14:04:42] <darkf> or enum type, rather.
[14:04:42] <dbaupp> darkf: actually, I just typoed. ^
[14:05:17] <engla> shouldn't ToStr have a generic implementation for ~T to just use &T?
[14:05:19] <dbaupp> rusti: struct A; impl ToStr for A { fn to_str(&self) -> ~str { ~"foo" } } (~[~A]).to_str()
[14:05:19] -rusti- <anon>:7:76: 8:5 error: failed to find an implementation of trait std::to_str::ToStr for ~main::A
[14:05:19] <nmatsakis> MaikKlein: I don't...really get why. It's easy enough to implement yourself if you want.
[14:05:19] -rusti- <anon>:7          struct A; impl ToStr for A { fn to_str(&self) -> ~str { ~"foo" } } (~[~A]).to_str()
[14:05:19] -rusti- <anon>:8     };
[14:05:20] -rusti- application terminated with error code 101
[14:05:47] <nmatsakis> MaikKlein: just have an actor with an outer loop that uses the method for selecting from multiple ports?
[14:06:07] <dbaupp> MaikKlein: you could/should write the abstraction you want above the port[set]/chan[set] APIs
[14:06:17] <ChrisMorgan> Bah... I try rustc -Z debug-info and it crashes.
[14:06:48] <dbaupp> MaikKlein: and then the code you write with the monsters will look event-based.
[14:06:52] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[14:06:57] <ChrisMorgan> error: internal compiler error: create_function: unexpected sort of node
[14:06:57] <ChrisMorgan> leaked memory in rust main loop (1 objects)
[14:06:57] <ChrisMorgan> rustc: /home/chris/vc/rust/src/rt/memory_region.cpp:192: memory_region::~memory_region(): Assertion `false' failed.
[14:06:57] <ChrisMorgan> [1]    6550 abort (core dumped)  rustc -Z debug-info ws2.rs
[14:07:31] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[14:08:06] <dbaupp> ChrisMorgan: output of `git diff` (assuming you've modified something)?
[14:08:09] <ChrisMorgan> That suggests that I can't even debug the crash properly at present :-/
[14:08:16] <ChrisMorgan> dbaupp: I haven't modified anything.
[14:08:35] <dbaupp> ChrisMorgan: oh :(
[14:08:54] <darkf> dbaupp: hrm, it's not possible to implement it for ~T then?
[14:09:05] <MaikKlein> dbaupp, but I would have to build this "event based" system with polling? like loop { if port.peek{ callsth();}}
[14:09:23] <dbaupp> darkf: no it is, one of the things I threw at rusti worked with ~A
[14:09:32] <dbaupp> MaikKlein: presumably
[14:09:52] <dbaupp> MaikKlein: how do "real" event-based systems implement it under the hood?
[14:09:53] <darkf> oh my bad I missed that one
[14:10:06] *** Quits: jaen (jaen@moz-4A98EEE0.neoplus.adsl.tpnet.pl) (Ping timeout)
[14:10:15] <MaikKlein> dbaupp, I thought event based systems are just functions calls?
[14:10:49] <dbaupp> MaikKlein: function calls for the user of the api, or the actual underlying implementation?
[14:10:51] <MaikKlein> dbaupp, like A subscribes to B. If B changes sth it let's A know by calling B.notify() or sth
[14:10:51] <ChrisMorgan> dbaupp: http://sprunge.us/bELQ
[14:11:07] <dbaupp> MaikKlein: (I actually have no idea about this, btw. just asking questions :P )
[14:11:23] <MaikKlein> dbaupp, me neither :D that's actually what I think it is
[14:12:01] <MaikKlein> dbaupp, so you don't have to poll for updates because B can just tell A " Hey I just updated something"
[14:13:00] <dbaupp> MaikKlein: right, that's at the user level
[14:13:28] <dbaupp> MaikKlein: but that API might be created by an event loop that performs polling under the hood.
[14:13:53] <ChrisMorgan> My code is hitting SIGABRT in `std::rt::io::net::tcp::TcpListener::bind`, but that doesn't upset me too drastically, though I'd like to figure out why. But the compiler refusing to give me my debug symbols because it's crashing itself is very muchly not nice.
[14:13:53] <MaikKlein> dbaupp, hm? okay maybe I am stupid let me write a simple example
[14:15:04] <untothebreach> hey, I am trying to figure out the best way to deserialize JSON objects using extra::json...I am consuming an API that may send different JSON objects depending on success or failure of a specific operation, and am having trouble deserializing the objects. Here is an example that compiles, but fails at runtime with "Invalid variant": http://codepad.org/XCYMPaRC
[14:15:12] <darkf> dbaupp: what would be an easy way to share the code between to_str() implementations without significant code duplication?
[14:15:25] <dbaupp> darkf: macros or an external function/method
[14:15:26] *** Joins: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com)
[14:15:37] *** Quits: geomyidae__ (uid214@moz-A42E5B7B.irccloud.com) (Ping timeout)
[14:15:37] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[14:15:38] *** Joins: charmander (Mibbit@BBE7C46A.B4F11D08.8612FA94.IP)
[14:15:40] <darkf> of course I didn't think of that, heh
[14:15:42] <dbaupp> darkf: or, if it's the same, (**self).to_str() in the impl for ~A
[14:15:51] <ChrisMorgan> dbaupp: what do you think I should I do next?
[14:15:56] <darkf> ah, great.
[14:16:19] <dbaupp> ChrisMorgan: no idea :S
[14:16:33] *** Quits: ggherdov_ (uid11402@moz-A42E5B7B.irccloud.com) (Ping timeout)
[14:16:40] <dbaupp> ChrisMorgan: look at the source of bind
[14:16:55] <dbaupp> (would be a start... I have a feeling it may just be calling fail!())
[14:16:56] <ChrisMorgan> Well, I was actually meaning the -Z debug-info crash :-)
[14:17:03] <dbaupp> ChrisMorgan: yeah, right, no idea.
[14:17:22] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[14:17:29] <ChrisMorgan> rustc -Z debug-info doesn't crash on a trivial `fn main(){}` input file...
[14:17:40] *** Joins: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com)
[14:18:10] <dbaupp> MaikKlein: I'm meaning, imagine you had a hypothetical 'event_based' crate, and wrote `extern mod event_based; fn main() { monster1.subscribe(monster2.flower_event()) }` or whatever
[14:18:44] <dbaupp> MaikKlein: there's no particular reason why the `event_based` crate can't be using polling to make .subscribe work as you'd expect.
[14:19:01] <dbaupp> (well, there might be, as I said before, I have no idea about this)
[14:19:36] <dbaupp> MaikKlein: and so what you should do is write that `event_based` crate so the rest of your code doesn't have to worry about doing the polling itself
[14:19:42] <dbaupp> (of course, this might not work.)
[14:20:08] <cmr> MaikKlein: http://en.wikipedia.org/wiki/Reactor_pattern ?
[14:20:58] <dbaupp> untothebreach: the default Encodable/Decodable instance for enums includes the variant in it
[14:21:52] <dbaupp> untothebreach: i.e. (I think) enum Foo { Bar(int, float) }, Bar(1,2.0) => ["Bar", 1, 2.0] or something
[14:22:04] <dbaupp> untothebreach: and it can only read this format.
[14:22:18] <dbaupp> (with the default Encodable/Decodable instances.)
[14:22:52] <untothebreach> ah
[14:23:26] <untothebreach> so I need to implement my own Encodable/Decodable stuff for my specific enums/structs?
[14:23:30] <dbaupp> right
[14:23:42] <MaikKlein> cmr, dbaupp only pseudo code but you get the idea https://gist.github.com/MaikKlein/5966718
[14:23:53] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[14:23:54] <ChrisMorgan> dbaupp: as for the bind call, the stack trace (http://sprunge.us/BjPd) suggests it's `std::rt::local::Local::unsafe_borrow::<IoFactoryObject>();` which is aborting.
[14:24:06] *** Quits: Cromulent (Cromulent@moz-983B638D.cable.virginmedia.com) (Quit: KVIrc 4.2.0 Equilibrium http://www.kvirc.net/)
[14:24:06] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Connection reset by peer)
[14:24:08] <dbaupp> ChrisMorgan: platform?
[14:24:16] <ChrisMorgan> Ubuntu 13.04, 64-bit
[14:24:45] <dbaupp> how recent is your rustc?
[14:24:49] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[14:24:53] <ChrisMorgan> Built this morning.
[14:24:54] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[14:25:07] <dbaupp> because a pile of the new io stuff landed sometime recently, so that may've improved it
[14:25:12] <MaikKlein> dbaupp, cmr don't know if this is called event based or reactor 
[14:25:22] <dbaupp> ChrisMorgan: (australian morning, right?)
[14:25:28] <ChrisMorgan> Yep.
[14:25:37] <MaikKlein> I always though of this as event based 
[14:25:42] <dbaupp> ChrisMorgan: and not the morning that started 20 minutes ago? :P
[14:25:53] * dbaupp should be going to sleep soon
[14:25:55] <ChrisMorgan> Nnnoooo... ;-)
[14:26:51] <dbaupp> ChrisMorgan: but, yeah, I have literally no idea about the stability of the io stuff in std::rt, but I do know that it's not stable yet
[14:27:05] *** Joins: jorendorff (jorendorff@moz-1747FB68.hsd1.tn.comcast.net)
[14:27:12] <ChrisMorgan> 0.7's rustc -Z debug-info ws2.rs, and running of a 0.7-built ws2 are both failing in the same way
[14:27:19] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[14:27:48] <dbaupp> MaikKlein: right, but presumably there'd be cross-task stuff happening in notify
[14:28:34] *** Quits: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com) (Quit: jeff)
[14:28:42] <Seldaek> MaikKlein: I think if you[C[C[C[C[C[C[C[Cr monsters cheer when they find flowers you got a core game logic issue though, they should smash the flower :p
[14:28:59] <Seldaek> wut. sorry about the weird control chars
[14:29:06] <dbaupp> MaikKlein: so, you may need to implement "cooperative events", where you call `.check_subscriptions()` every so often
[14:29:17] <dbaupp> MaikKlein: or, just have it calling that constantly.
[14:29:24] * dbaupp doesn't really know
[14:29:39] <dbaupp> Seldaek: the flower is made of acid, or something :P
[14:29:48] <MaikKlein> haha
[14:30:07] <ChrisMorgan> How do I get debug-info for libstd et al.?
[14:30:32] <dbaupp> ChrisMorgan: there's possibly an option to ./configure
[14:30:40] <cmr> ChrisMorgan: configure ----enable-debug
[14:31:00] *** Joins: geomyidae__ (uid214@moz-E77DEB21.irccloud.com)
[14:31:32] *** Joins: pnathan1 (Adium@moz-BDC3EE62.tukw.qwest.net)
[14:31:41] <MaikKlein> dbaupp, it would be cool if we could share some memory between tasks, or even cooler if you could have somehow an abstract reference to the task like let my_actor_reference = Actor::spawn();
[14:31:57] <jensnockert> MaikKlein: You can.
[14:32:03] <cmr> MaikKlein: Sharing memory between tasks is the exact opposite of what they are intended for.
[14:32:17] <dbaupp> MaikKlein: you can, you just need to write the data structure that contains the info you need in your abstract reference
[14:32:26] *** Joins: mye (mye@moz-ACE53E5D.dip0.t-ipconnect.de)
[14:32:28] <MaikKlein> hm
[14:32:39] <ChrisMorgan> cmr: Whoa, quadruple MINUS-HYPHEN?
[14:32:45] <dbaupp> MaikKlein: (e.g. the ports/chans and monster types, or something)
[14:32:50] <cmr> ChrisMorgan: heh, whoops
[14:32:52] <dbaupp> ChrisMorgan: (it's meant to be --)
[14:33:41] <ChrisMorgan> Naturally. Got it in, now I'll rebuild rust. Sounds like a good time to escape and go to bed before it captures me again...
[14:34:10] <SimonSapin> rusti: "".slice_from(0)
[14:34:11] -rusti- ""
[14:34:12] *** Joins: wilsonk|2 (kvirc@moz-39EFBFC2.cg.shawcable.net)
[14:34:25] *** Quits: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[14:34:31] <MaikKlein> cmr, well sharing memory isn't bad if it would be read only
[14:34:50] *** Joins: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com)
[14:34:55] <cmr> MaikKlein: you'd need &'static'
[14:35:06] <cmr> (for it to be safe)
[14:35:18] <Seldaek> MaikKlein: you can use ARC though for sharing readonly stuff
[14:35:21] <SimonSapin> rusti: "123".slice_from(2)
[14:35:22] -rusti- "3"
[14:35:25] <SimonSapin> rusti: "123".slice_from(3)
[14:35:26] -rusti- ""
[14:35:47] <dbaupp> SimonSapin: (do you have a bug, or just testing?)
[14:36:04] <SimonSapin> dbaupp: Iâ€™m getting this: task failed at 'index out of bounds: the len is 145 but the index is 145', /home/simon/projects/servo/src/compiler/rust/src/libstd/str.rs:1561
[14:36:07] <MaikKlein> yeah I need to do some research, but I really should learn for my math exam that I write tomorrow  :D
[14:36:23] <SimonSapin> which is inside is_char_boundary(), which is called by slice()
[14:36:28] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Ping timeout)
[14:36:28] <dbaupp> rusti: "123".slice_from(4)
[14:36:29] -rusti- rust: task failed at 'index out of bounds: the len is 4 but the index is 4', /build/rust-git/src/rust/src/libstd/str.rs:1664
[14:36:29] -rusti- rust: domain main @0xe6a1b0 root task failed
[14:36:29] -rusti- application terminated with error code 101
[14:36:41] *** Joins: orshem (orshem@81F00A95.B9DE554A.EB50AD2C.IP)
[14:36:55] <SimonSapin> but that case should be guarded by the previous line: if index == self.len() { return true; }
[14:36:57] <Seldaek> MaikKlein: most certainly "but my monsters are cheering!" is no valid excuse for a turning in a crappy exam 
[14:37:02] *** Joins: ggherdov_ (uid11402@moz-E77DEB21.irccloud.com)
[14:37:14] <dbaupp> SimonSapin: assuming you're slicing self with index, yes
[14:37:22] <MaikKlein> :)
[14:37:52] <dbaupp> SimonSapin: (printf-debugging? :P )
[14:38:05] *** Joins: hjr3 (hradtke@1A0AE795.28A5F6C3.A2D40ED2.IP)
[14:38:18] <engla> SimonSapin: are you slicing the middle of an utf-8 encoded character?
[14:38:28] <SimonSapin> dbaupp: no, view-source debugguessing :)
[14:38:41] <dbaupp> SimonSapin: heh
[14:38:56] <SimonSapin> but gdb confirms
[14:39:06] <dbaupp> rusti: "Ã¥".slice_from(1)
[14:39:06] -rusti- rust: task failed at 'assertion failed: self.is_char_boundary(begin)', /build/rust-git/src/rust/src/libstd/str.rs:1428
[14:39:07] -rusti- rust: domain main @0xdc21b0 root task failed
[14:39:07] -rusti- application terminated with error code 101
[14:39:15] <dbaupp> engla: different error message ^
[14:39:36] <engla> it's inside the same method SimonSapin mentioned
[14:39:46] *** Quits: ChrisMorgan (chris@moz-6AC741CA.static.tpgi.com.au) (Ping timeout)
[14:39:55] <dbaupp> right, but the error message is an index out of bounds one
[14:40:06] *** Joins: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com)
[14:40:07] <engla> hm ok
[14:40:09] <dbaupp> (i.e. it's running of the end of the string in the slicing.)
[14:41:02] <MaikKlein> cmr, you might be interested in seeing a programming exam at my university http://www.scribd.com/doc/152928309/Exam
[14:41:04] <engla> it's something utf-8-y at least
[14:41:19] <engla> std::str is full of traps related to byte indices
[14:41:50] <dbaupp> (well, actually, it's testing if the byte-after-end is a char boundary, and that's the oob fail!-ure)
[14:41:57] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[14:41:57] <dbaupp> engla: yeah, I know
[14:42:09] * dbaupp has touched almost all 3000 lines of str
[14:42:24] <SimonSapin> oh wait, the message is wrong
[14:42:57] *** Quits: pauls_ (paul@moz-9B39917C.c3-0.smr-ubr2.sbo-smr.ma.cable.rcn.com) (Ping timeout)
[14:43:02] <SimonSapin> mystring.len() is 144, not 145
[14:43:02] <SimonSapin> so I am indeed going beyond the end
[14:43:17] <SimonSapin> rusti: "1"[1]
[14:43:18] -rusti- rust: task failed at 'index out of bounds: the len is 1 but the index is 1', <anon>:7
[14:43:18] -rusti- rust: domain main @0x1a671b0 root task failed
[14:43:18] -rusti- application terminated with error code 101
[14:43:59] <SimonSapin> no, wait
[14:44:10] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[14:44:19] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[14:44:43] *** Joins: victorporof (victorporo@8A0C716A.6BD22D89.79933D60.IP)
[14:45:20] <SimonSapin> Iâ€™m confused
[14:46:30] *** Joins: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com)
[14:49:42] <SimonSapin> ok, that was my fault
[14:54:53] *** Quits: jorendorff (jorendorff@moz-1747FB68.hsd1.tn.comcast.net) (Ping timeout)
[14:56:16] *** Quits: roo (jesse@moz-D32719F.dynamic.ip.windstream.net) (Client exited)
[14:56:37] *** Joins: roo (jesse@moz-D32719F.dynamic.ip.windstream.net)
[14:57:56] *** Parts: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP) ()
[15:00:17] *** Quits: BitPuffin (quassel@moz-49828767.cust.tele2.se) (Ping timeout)
[15:00:53] <jensnockert> Urghâ€¦ trans, why do you want to pass vectors as <16 x i8>* instead of <16 x i8>â€¦
[15:01:22] *** Quits: dbaupp (Thunderbir@moz-712A1135.lns20.syd6.internode.on.net) (Ping timeout)
[15:03:25] *** Joins: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP)
[15:04:41] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[15:07:49] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[15:09:39] *** Quits: smvv_ (sander@moz-BAEA8EB2.dynamic.upc.nl) (Ping timeout)
[15:10:01] *** Quits: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com) (Client exited)
[15:12:08] <cmr> didn't sanxiyn fix that?
[15:13:16] *** Joins: erickt (Adium@8C9ECD8F.3A598286.F12515B4.IP)
[15:15:43] *** Joins: pnathan2 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[15:16:11] *** Joins: erickt1 (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[15:17:19] <jensnockert> cmr: No, the #[simd] vectors are passed as <16 x i8>* as well
[15:17:51] *** Quits: erickt1 (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Ping timeout)
[15:18:12] *** Quits: pyrac (pyrac@F9CC429.73C89388.AD05C589.IP) (Quit: pyrac)
[15:18:15] *** Quits: pnathan2 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[15:18:33] *** Joins: ksev (DrunkenPan@745B767B.989A61DC.CA5B6332.IP)
[15:20:39] <jensnockert> Hurray, now my vectors are passed as <16 x i8> at least, and returned not via pointer \o/
[15:22:01] *** Joins: RMF (RMF@moz-4C4EB011.dsl.telepac.pt)
[15:22:04] *** Joins: smvv_ (sander@moz-BAEA8EB2.dynamic.upc.nl)
[15:24:14] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[15:24:27] *** Quits: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de) (Ping timeout)
[15:24:38] *** kimundi is now known as zz_kimundi
[15:25:23] *** zz_kimundi is now known as kimundi
[15:30:20] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[15:31:04] *** Quits: infynyxx (infynyxx@moz-E95B370B.nyc.res.rr.com) (Client exited)
[15:36:53] *** Joins: eholk (eholk@moz-1733E9A.uconnect.utah.edu)
[15:38:19] <jdm> hmm, I thought fail_unless! was a thing
[15:38:21] <jdm> I guess not
[15:38:28] <cmr> jdm: it's called assert! now
[15:38:37] <jdm> thanks
[15:39:39] <engla> can asserts be removed when building?
[15:40:30] <cmr> engla: no, and they are necessary.
[15:40:43] <cmr> they're used to verify invariants everywhere
[15:41:24] <cmr> (it'd be quite easy to actually implement that feature though, just inject a different core-macros)
[15:41:26] *** Joins: erickt1 (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[15:41:56] <engla> sure ok. maybe it's just in C where asserts are commonly removed
[15:42:01] *** Quits: pnathan1 (Adium@moz-BDC3EE62.tukw.qwest.net) (Quit: Leaving.)
[15:42:40] <engla> python also has this feature but I'm sure it's never used
[15:42:40] <SiegeLord> There's no debug_assert or something?
[15:42:48] <cmr> SiegeLord: not yet, no
[15:42:53] <cmr> it'd be useful
[15:52:08] *** Joins: Jeaye (Jeaye@moz-FD505E54.hsd1.ca.comcast.net)
[15:54:38] <engla> strcat:  you wrote the Containers wiki page; my PR now adapts both the deque and linked list to the deque trait as described there.. however there are those naming troubles
[15:55:02] <engla> deque::Deque can't have the same name as the trait Deque. it'd be impractical.
[15:55:13] <engla> yet ArrayDeque as concrete type is a bit ugly
[15:56:19] <strcat> RingBuf? ;p
[15:56:25] *** Quits: dolphinling (andrew@moz-80A1E448.uvm.edu) (Ping timeout)
[15:56:26] * strcat shrugs
[15:56:32] <bstrie> engla: call it Dq
[15:56:32] *** Joins: dolphinling (andrew@moz-80A1E448.uvm.edu)
[15:57:11] *** Quits: smvv_ (sander@moz-BAEA8EB2.dynamic.upc.nl) (Quit: leaving)
[15:57:21] *** Quits: erickt (Adium@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[15:57:24] <engla> the trait could be DoubleEndedSequence
[15:57:26] <doomlord> #[simd] sounds interesting
[15:57:46] <engla> Deseq.
[15:57:47] *** Joins: graydon (graydon@moz-A8112A5D.cable.teksavvy.com)
[15:57:47] *** ChanServ sets mode: +qo graydon graydon
[15:58:09] *** Quits: erickt1 (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[15:59:39] *** Joins: adu (ajr@moz-68CC2A5E.washdc.fios.verizon.net)
[16:00:26] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[16:00:30] <cmr> graydon: would it be possible for you to format the bug triage list with markdown using github's task list extension? I find myself loading my huge list into gist, and it becomes unweildy
[16:00:45] <cmr> task list item is just an empty ascii checkbox, [ ]
[16:00:59] <cmr> https://github.com/blog/1375-task-lists-in-gfm-issues-pulls-comments
[16:01:45] *** Joins: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net)
[16:02:17] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[16:03:03] <graydon> cmr: oh, huh. sure. can you email me to remind me?
[16:03:07] <graydon> I have a zillion to-dos
[16:03:08] <cmr> sure
[16:03:12] <cmr> I can imagine :)
[16:03:25] *** Quits: glinscott (garylinsco@789A6618.53EB7C1.FFFE3AA.IP) (Quit: glinscott)
[16:03:38] *** Joins: glinscott (garylinsco@789A6618.53EB7C1.FFFE3AA.IP)
[16:04:08] <doomlord> re: __restrict in c++ ..  rust's aliasing assumptions should mean you dont need that , if i've undesrstood correctly;
[16:04:14] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[16:04:30] <doomlord> does that mean you mmight sometimes need the opposite modifier for some pointers in unsafe blocks
[16:04:52] *** Joins: erickt1 (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[16:04:52] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Connection reset by peer)
[16:04:54] <steven_is_false> Where can I find documentation that is tested? For example, I get x86_64-unknown-linux-gnu/test/doc-tutorial-tasks/basics_16.rs:15:4: 15:19 error: failed to resolve import `extra::arc::ARC` but isn't that file auto-generated from the documentation?
[16:04:57] <cmr> doomlord: unsafe pointers (*T/*mut T) have no aliasing constraints
[16:05:24] <cmr> steven_is_false: it's generated from tutorial-tasks.md
[16:05:26] *** Quits: fabiand (fabiand@moz-C17D01C9.adsl.alicedsl.de) (Ping timeout)
[16:05:32] <steven_is_false> cmr: Thanks!
[16:05:39] <doomlord> ah so it is unable to cache values from those in registers as much then
[16:05:43] <cmr> steven_is_false: it's the 16th code example from the section marked `# Basics`
[16:06:03] <doomlord> so you might still need a '__restrict' for some *'s in unsafe blocks perhaps?
[16:06:42] *** Quits: jdm (jdm@92FB48CA.8B5E9DF.9A8C35B4.IP) (Ping timeout)
[16:06:55] <cmr> doomlord: might be. also note that we don't currently do any aliasing optimizations..
[16:08:25] *** Quits: orshem (orshem@81F00A95.B9DE554A.EB50AD2C.IP) (Quit: Leaving)
[16:08:28] *** Joins: fabiand (fabiand@moz-C17D01C9.adsl.alicedsl.de)
[16:10:15] *** Quits: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com) (Quit: jeff)
[16:11:02] <strcat> doomlord: if they follow the borrowed pointer rules you can use a borrowed pointer
[16:11:35] <cmr> kimundi: ping
[16:12:12] <strcat> if they don't follow the borrowed pointer rules I don't think they're going to ever qualify for something like restrict
[16:12:25] *** Quits: azita (Azita@moz-C1FB2A8.hsd1.ca.comcast.net) (Quit: azita)
[16:13:05] *** Quits: relistan (relistan@A7E4EF66.4C1F25E9.4BA0249.IP) (Quit: relistan)
[16:13:06] *** Quits: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com) (Quit: webber46)
[16:14:36] <kmc> that makes me wonder if one might also need 'volatile' for unsafe pointers
[16:14:39] <doomlord> the 'borrowed pointer rules' .. only one pointer to something mutable i suppose( you'd use restrict when you know you're not overwriting sources..)
[16:15:22] <strcat> doomlord: I don't see what useful information restrict could convey in rust
[16:15:37] <strcat> &T to T: Freeze is immutable memory, it's noalias
[16:16:13] <strcat> &mut alias &const and @mut but those are rare anyway
[16:16:16] <strcat> aliases*
[16:16:19] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[16:16:29] <strcat> and alias analysis is queried for pairs of pointers
[16:17:04] <doomlord> well i'm assuming most  of the time .. one would be writing safe code, and the 'borrow rules' would mean you get __restrict style benefits whilst being less error prone..
[16:17:05] *** Joins: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP)
[16:17:17] <strcat> well not 'less' error prone, it's memory safe
[16:17:33] <doomlord> zero error prone then
[16:17:38] <strcat> and all pointers in fast rust code (~, &mut, &) can't alias each other
[16:17:39] <doomlord> 'not' error prone
[16:17:56] <strcat> aliasing in alias analysis terms has to do with memory dependency
[16:18:03] <strcat> whether the pointers are to the same memory is irrelevant
[16:18:19] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[16:18:23] <doomlord> you can have multiple borrowed pointeers to somethiing *immutable*? .. but thats not a problem for caching things in registers?
[16:18:39] <strcat> doomlord: if the data is immutable the pointers don't alias
[16:18:50] <strcat> two & pointers to the same memory are non-aliasing, in AA terms
[16:18:59] <strcat> if the memory is not mutated through *either* pointer
[16:19:04] <doomlord> ok but they may have been passed from different sources
[16:19:04] <strcat> in a way that can be observed from the other
[16:19:10] <strcat> doesn't matter
[16:19:15] <doomlord> or would that even be prevented
[16:19:27] <strcat> two pointers do not alias unless one can alter memory in a way observable through the other
[16:19:43] <strcat> and a TBAA pass is queried with pointer pairs
[16:19:47] <doomlord> keyword *alter* ?
[16:19:58] <strcat> mutate, alter, change, whatever
[16:20:09] <strcat> TBAA pass you can implement in rust:
[16:20:11] <strcat> @ and ~ don't alias
[16:20:15] <strcat> ~ and ~ don't alias
[16:20:19] <strcat> &mut and &mut don't alias
[16:20:21] *** Joins: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com)
[16:20:21] <strcat> &mut and & don't alias
[16:20:30] <strcat> & and & don't alias for T: Freeze (almost everything)
[16:20:33] *** Quits: charmander (Mibbit@BBE7C46A.B4F11D08.8612FA94.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[16:20:41] <strcat> there's not much else you can gain
[16:20:51] <strcat> that's essentially perfect knowledge for the compiler already
[16:21:15] <strcat> but it's not implemented and existing rust code breaks the borrowed pointers rules
[16:21:26] <strcat> with unsafe {}
[16:21:39] <strcat> code doing that is wrong, but it means you can't just flip TBAA on everywhere
[16:21:40] <doomlord> ok my starting point was 'rusts greater knowledge of pointers means *less* need for something like restrict', and you seem to be saying its all the way.. *no* need for restrict;
[16:21:51] <strcat> no need for restrict. just use & or &mut
[16:22:03] <strcat> they don't alias with anything relevant to high performance code
[16:22:05] <doomlord> i just wondered r.e. unsafes' ability to represent *everything* you could possibly do in C (hazards included)
[16:22:21] <doomlord> of course i am assuming most of the time i'll be writing safe not unsafe
[16:22:22] <kimundi> cmr: err, pong?
[16:22:24] <strcat> restrict isn't in standard C++, just C99/C11
[16:22:46] <doomlord> i didn't realise that but it was essential in our uses cases in consoles...
[16:22:59] <cmr> kimundi: re: https://github.com/mozilla/rust/issues/6221, how do you feel about `assertion failed: `(left == right) && (right == \ left)` (left: %?, right: %?)`
[16:23:00] <doomlord> ... they went to great lengths to explain how it worked and why it was needed
[16:23:25] *** Quits: jpf (jan@moz-A8C26A15.org) (Quit: leaving)
[16:23:26] <steven_is_false> strcat: Don't rvalue references give somewhat similar guarantees with respect to the concept of ownership?
[16:23:29] <doomlord> the cpu's we were using had horrible problems with LHS .. it was really critical to get locals cached in registers
[16:23:47] <doomlord> we had to use __restrict and examine asm output to ensure it was working well
[16:24:16] <strcat> steven_is_false: not really in a useful way
[16:24:20] *** Joins: jpf (jan@moz-A8C26A15.org)
[16:24:44] <strcat> doomlord: okay, but rust doesn't need it
[16:24:57] <doomlord> so if i've understood your claim is , in an unsafe block ... * is a regular aliasable c pointer, and & will behave like a __restrict pointer
[16:24:58] <jclements> anyone know if backtraces are broken? I can't seem to get one for an ICE, and this matches issue #6823
[16:25:11] <cmr> jclements: on what platform?
[16:25:17] <jclements> cmr: OS X
[16:25:20] <doomlord> yes better aliasing assumptions is a big reason for me to be interested in rust
[16:25:21] <cmr> jclements: yes, they are
[16:25:27] <steven_is_false> Here's owned, and borrowed pointers implemented using rvalue references http://pastebin.mozilla.org/2608460 (some of the unrelated code at the bottom is broken.)
[16:25:32] <jclements> cmr: feh: what about linux?
[16:25:32] <strcat> doomlord: rust doesn't have any TBAA pass though
[16:25:43] <kimundi> cmr: Might work? I'm not really one to judge it, though.
[16:25:48] <doomlord> TBAA = ?
[16:25:50] <cmr> jclements: does work on linux. gdb works on OS X though? you can break in rust_upcall_fail
[16:25:53] <kmc> how do you communicate alias information to LLVM?
[16:25:56] <cmr> doomlord: type based alias analysis
[16:26:07] <strcat> steven_is_false: you can still use memory after a move in C++, it's well-defined
[16:26:13] <strcat> only the state of the object is unspecified
[16:26:14] <jclements> cmr: perfect. that was my next question. many thanks!
[16:26:20] <strcat> rvalue references aren't useful for TBAA
[16:26:23] *** Joins: pyrac (pyrac@moz-8862B13A.w92-162.abo.wanadoo.fr)
[16:26:31] <steven_is_false> Okay
[16:26:59] <kimundi> rusti: assert_eq!(true, false);
[16:27:00] -rusti- rust: task failed at 'left: true does not equal right: false', <anon>:7
[16:27:00] -rusti- rust: domain main @0x216b1b0 root task failed
[16:27:00] -rusti- application terminated with error code 101
[16:27:05] <doomlord> So __restrict style benefits are something the language design makes more convinient, ,but the implementation is "coming soon"
[16:27:13] <strcat> doomlord: not soon
[16:27:23] <strcat> it's really too hard to fix all the existing codebase for little gain
[16:27:37] <cmr> I could see it being -Z tbaa
[16:27:39] <strcat> there are much lower hanging fruit
[16:27:53] <strcat> cmr: yeah, if someone wastes their time completely redoing trans to output tbaa info
[16:27:56] <strcat> it's a huge project
[16:28:01] <doomlord> ok "comming soon" is poor choice of words
[16:28:03] <strcat> it basically means rewriting most of trnas
[16:28:05] <strcat> trans*
[16:28:11] <cmr> needs doing anyway, right? :P
[16:28:18] <strcat> it doesn't even keep track of ~ vs ~[] atm
[16:28:23] <kimundi> cmr: I think yor message is better than the current one at least.
[16:28:28] <cmr> kimundi: ok
[16:28:38] <strcat> really, really hard to do and impossible to test
[16:28:47] <doomlord> i certainly apreciate every refinement can't go in early
[16:28:54] <strcat> we need IR tests, we need a much cleaned up trans, we need all the cases of 'unsafe {}' abuse fixed
[16:29:02] <strcat> before trying to touch TBAA
[16:29:11] <strcat> (and it's still a huge project)
[16:29:18] <bstrie> where does the compiler need to resort to unsafe? is it just workarounds for old bugs?
[16:29:31] *** Joins: Blei (philipp@moz-650B9C6A.cust.bluewin.ch)
[16:29:41] <strcat> bstrie: it doesn't *need* to resort to unsafe to break the borrow/mutability rules, ever
[16:29:48] <strcat> there's no one case where it needs to, but it does
[16:29:49] <doomlord> for me it is certainly an *essential feature* , but i can wait
[16:30:01] <bstrie> strcat: right, I'm asking *why* it does, historically
[16:30:03] <strcat> doomlord: well it's going to be at least a year before someone thinks about it seriously
[16:30:17] <strcat> bstrie: because people were lazy and didn't consider that it would be a big barrier to improving the language
[16:30:24] <strcat> and they didn't use raw pointers when they should have
[16:30:33] <kimundi> ... three hours late a mysterios PR appears
[16:30:45] <strcat> there wasn't an actual reason to do it
[16:30:48] <strcat> it just happened
[16:30:52] <doomlord> ok i have the fallback of 'optiimizing in C' in the meantime :)
[16:31:48] <kimundi> doomlord: the question is wether the opimised C code outweights the FFI overhead ;)
[16:32:07] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[16:33:55] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[16:34:06] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (No route to host)
[16:36:35] *** Quits: mye (mye@moz-ACE53E5D.dip0.t-ipconnect.de) (Quit: mye)
[16:37:37] *** Quits: wilsonk|2 (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[16:40:24] <Seldaek> cmr: what's the plan regarding the rustdoc json, will it be one massive json contaiing all the symbols or rather work file per file?
[16:40:55] <cmr> Seldaek: massive, with file+line/column
[16:40:59] <Yurume> hmm, what is the best strategy to distribute the workload, where the workload is primarly an unsafe FFI call (which returns a raw pointer)?
[16:41:43] <jensnockert> strcat: Is there any list of stuff that needs to be done in trans?
[16:41:46] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[16:41:48] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Quit: Leaving.)
[16:42:08] <strcat> jensnockert: well there are 1300 bugs, and maybe 1/3 of them involve trans work
[16:42:10] <strcat> ;p
[16:42:24] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[16:42:27] <jensnockert> strcat: Yeah, but that is a bit much to be helpful ;)
[16:42:39] <strcat> jensnockert: it needs to be cleaned up and rewritten
[16:42:47] <strcat> to generate correct, clean IR with defined behaviour
[16:42:50] <strcat> it doesn't right now
[16:42:59] <jensnockert> strcat: Yeah, I don't think putting out fires is the right way to deal with trans.
[16:43:02] <strcat> it generates 100x as much as clang for the same samples and fills it with undef behaviour
[16:43:30] <jensnockert> strcat: Making it slightly object oriented would be niceâ€¦
[16:43:39] <strcat> jensnockert: using LLVM's real API would be instead
[16:43:44] <strcat> would be nice*
[16:43:51] <jensnockert> That too.
[16:43:55] <strcat> instead of the crappy C one they don't care about...
[16:44:00] <strcat> it's so much more weakly typed
[16:44:11] <jensnockert> But how would we call C++ from Rust?
[16:44:40] <Seldaek> cmr: ok sounds good, though it'll probably take a crapton of memory to  build then but that's alright
[16:44:55] <strcat> jensnockert: using libclang to implement the C++ ABI
[16:45:07] *** Quits: CarpNet (ac@moz-FD24B77.sohonet.co.uk) (Quit: Leaving)
[16:45:19] <cmr> Seldaek: yes, but there's no alternative
[16:45:25] <jensnockert> strcat: I think I'll leave that project to some masochist.
[16:45:36] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[16:45:45] <Seldaek> cmr: I guess not, and frankly I prefer it that way as well
[16:47:25] <strcat> jensnockert: the problem is that means no one will do it ;p
[16:47:29] * strcat realized that with ~ headers
[16:47:45] <jensnockert> strcat: I know, but parsing C++ and the C++ ABI is too much work.
[16:47:53] <strcat> jensnockert: libclang can do it all
[16:47:57] <strcat> don't need to implement any of it
[16:47:59] <olsonjeffery> yeah. c++ is a bridge too far and everyone knows it.
[16:48:05] <strcat> it's not really
[16:48:13] <jensnockert> strcat: Not convinced that it wouldn't eat your soul ;)
[16:48:24] <strcat> libclang can parse C and C++ headers and tell us what types the symbols expect
[16:48:25] <jensnockert> strcat: Refactoring libsyntax seems like a good idea too.
[16:48:30] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[16:48:46] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[16:48:46] <cmr> refactoring libsyntax is a smaller win overall
[16:48:49] <strcat> rust could just support 'extern "C" lib_name' and automatically parse the header
[16:48:55] <strcat> it wouldn't really be hard for C
[16:48:56] <jensnockert> cmr: Yeah, but a lot less work.
[16:48:59] <cmr> the ast needs to be rewritten
[16:49:01] <strcat> for lots of C++ it wouldn't be hard either
[16:49:16] <strcat> statically dispatched methods would be trivial
[16:49:37] <cmr> which means pretty much *everything* needs to be rewritten ;\
[16:49:53] <graydon> we have discussed this before, would very much like to use libclang to pull in extern bindings
[16:49:59] <graydon> but it's going to be a lot of work
[16:50:04] <graydon> and it doesn't handle one of the important cases
[16:50:29] <graydon> which is developing against a headerless library -- shipping rust bindings w/o shipping the accopmanying C/C++ headers
[16:50:37] <strcat> graydon: but bindgen exists and seems to mostly work, so it seems like that could just be done by rustc itself
[16:50:42] <graydon> bindgen does that niche
[16:50:44] <strcat> are there really headerless libraries?
[16:50:52] *** Joins: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com)
[16:51:05] <strcat> it seems like you need definitions just to compile
[16:51:10] <graydon> there are times when you might well want to develop against a library without having its headers installed
[16:51:18] <graydon> I don't mean the library has no headers. I mean "you didn't install the -dev package"
[16:51:19] <SiegeLord> I do that with D and OpenCL
[16:51:26] <graydon> or, say, you're on a machine without a good package manager
[16:51:36] <SiegeLord> I don't need the C headers, only the binaries
[16:51:41] <graydon> rust libraries are self describing
[16:51:43] <graydon> C libraries, not so much
[16:51:44] <strcat> graydon: well, I use an OS without split -dev packages so I don't suffer from that ;p
[16:51:48] <graydon> nice for you
[16:51:51] <strcat> graydon: I think they are if they have debug symbols
[16:52:00] <strcat> but they never do
[16:52:13] <olsonjeffery> solution: everyone switch to arch!
[16:52:16] <graydon> indeed
[16:52:29] <jensnockert> Is there a way to compare two ty:t ?
[16:52:31] <strcat> olsonjeffery: sure, and you get daily builds of rust from git too ;p
[16:52:54] <olsonjeffery> i suppose i could get arch working on my mbp
[16:52:55] <graydon> (rust metadata was, originally, encoded in dwarf. we gave up. at this point I'm not sure we should have. dwarf at least retains the "you can seek in it without reading the whole thing" property. we never should have lost that.)
[16:53:00] <olsonjeffery> but the urge to tinker has passed from me, sadly.
[16:53:06] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[16:53:11] <olsonjeffery> so i use ubuntu. bleh.
[16:53:11] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[16:53:12] *** ChanServ sets mode: +o dherman
[16:53:13] <olsonjeffery> anywho.
[16:53:23] *** Quits: victorporof (victorporo@8A0C716A.6BD22D89.79933D60.IP) (Ping timeout)
[16:53:24] <strcat> olsonjeffery: I find I do a lot less work on Arch than I did when I tried other distros
[16:53:37] <cmr> so do I tbh, but not really the place or the time
[16:53:39] <graydon> (if someone wants to improve the cycle time of the 'make check' part, the biggest win is fixing the metadata read-everything issues)
[16:53:42] <strcat> having the latest stable version of everything without patches rejected upstream -> no manually dealing with anything
[16:54:04] <strcat> they only actually fixed ivy bridge power saving in 3.10 ;p
[16:54:13] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[16:54:17] <jensnockert> graydon: Would bridgesupport-like files fix that?
[16:54:39] <graydon> fix what?
[16:54:49] <jensnockert> graydon: Seeking?
[16:54:50] <cmr> What is bridgesupport?
[16:54:57] *** Joins: jdm (jdm@F2D29657.F60B0462.67AC9B1.IP)
[16:55:19] <strcat> graydon: btw do you know if we ever plan on having cases where code is mutable? as in executable stack/heap (I guess a JIT would...)
[16:55:24] <jensnockert> cmr: It is essentially a XML file version of headers for a C / ObjC library, OS X uses it for Ruby / Python / X. https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man5/BridgeSupport.5.html
[16:55:39] <strcat> graydon: it'd be really nice to mark function ptrs as invariant but maybe we can't do that.
[16:55:41] <jensnockert> cmr: You use clang to autogenerate them.
[16:55:51] *** Joins: posco (oscarboyki@636AC086.5999CED5.71743E61.IP)
[16:55:54] * strcat wants to fix https://github.com/mozilla/rust/issues/7136
[16:55:56] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[16:55:57] *** ChanServ sets mode: +o dherman
[16:56:02] <graydon> jensnockert: no, this has to do with how we serialize stuff in crates. we store our own metadata in crates but we do it in a way (and read it back in a way) that requires deserializing the whole crate metadata every time.
[16:56:03] <Seldaek> cmr: gotta run but it's a start ;) http://d.pr/i/Ve6B
[16:56:15] <graydon> so for example when you compile a very small testcase, you deserialize all of libstd's metadata
[16:56:20] <graydon> which is why compiling "hello world" is slow
[16:56:27] <graydon> (or any of the run-pass tests)
[16:56:32] <strcat> rusti: "fast metadata please"
[16:56:33] -rusti- "fast metadata please"
[16:56:35] <strcat> ;p
[16:56:38] <graydon> this is a mistake. it should only deserialize the part you use.
[16:56:54] <jensnockert> graydon: Makes sense.
[16:57:05] <sp3d> graydon: is that also why rusti (program) is so slow?
[16:57:05] <cmr> it's mostly only a problem because ebml is *not cheap*, at all
[16:57:34] <graydon> there's that, but honestly any format will not be fast at this problem
[16:57:43] <cmr> right
[16:57:50] <cmr> ebml is just probably the worst format to be using
[16:57:54] <graydon> even the latency of decompressing the whole metadata section is too high
[16:58:12] <graydon> what we should do is compress each item's worth of metadata independently (also its AST independent of _that_)
[16:58:20] <graydon> and then pull out, decompress and deserialize separately
[16:58:35] <graydon> but this requires changing access patterns. patrick's done some of the preliminary work to fix it. but it's not fixed yet.
[16:58:39] <strcat> graydon: maybe it shouldn't be compressed with a generic algorithm at all
[16:58:52] <strcat> it seems like we could just come up with our own clever format and factor out duplicate parts
[16:58:56] <graydon> strcat: possibly not. we've fiddled with other approaches, yeah.
[16:59:02] <graydon> but the most important part is splitting per-item
[16:59:08] <graydon> after that, format and compression fiddling is just gravy
[16:59:18] <graydon> it's worth doing, but there's no way you'll get a factor-of-100 speedup
[16:59:21] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[16:59:25] <graydon> whereas if you read 1 meta item vs. 100, you will
[16:59:27] <jensnockert> Since my question got kind of lost, if I have two ty:t ? Can I somehow compare them?
[16:59:42] <strcat> jensnockert: well they're integers, maybe you can just rely on that? ;p
[16:59:45] * strcat shrugs
[17:00:03] <strcat> don't know if you can
[17:00:05] <cmr> I thought I had an issue open about a metadata rework
[17:00:16] <cmr> github's search is quite awful :(
[17:01:19] <graydon> https://github.com/mozilla/rust/issues/4572
[17:01:44] <strcat> graydon: it'd be nice to not compress it and just mmap it
[17:01:53] <jensnockert> strcat: Well, to be honest, in reality I just care if they are of the same size, so I could just check that instead.
[17:01:53] <strcat> I wouldn't be surprised if it was 5x faster
[17:02:00] <graydon> I believe each_path might be gone by now, I think maybe patrick fixed that
[17:02:08] <graydon> strcat: I know, I would like that too.
[17:02:10] <cmr> I'd like to use Cap'n Proto, too, which would obviate deserializing
[17:02:36] *** Joins: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com)
[17:02:37] <graydon> strcat: we get the thing from LLVM's object file reader though. I'm not sure if it's mmap'ed. I expect so.
[17:02:43] *** Quits: SimonSapin (simon@88F51059.F3BBB17D.144F44FA.IP) (Quit: Leaving.)
[17:02:47] <graydon> strcat: the bootstrap compiler did all this with mmap() and reading dwarf
[17:02:56] <graydon> and compile times were ... very good, for small files :)
[17:03:25] <graydon> (I wrote an object and dwarf parser for that. two, actually -- runtime needed a bit of one too. turns out it's not that bad.)
[17:04:10] *** Joins: SimonSapin (simon@88F51059.F3BBB17D.144F44FA.IP)
[17:04:25] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[17:04:30] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[17:04:56] * strcat is tempted to rip everything about vectors out of the compiler and use lang items
[17:05:15] <strcat> trans is too hard to understand
[17:05:36] <strcat> it might make unoptimized code worse though because it has to branch on whether things are managed
[17:05:39] <graydon> I think most of that would be appreciated
[17:06:14] <graydon> lang items didn't exist at first. most of the compiler was written to the assumption that it should be doing more work, libraries less, when it comes to unsafe / fundamental abstractions.
[17:06:14] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Ping timeout)
[17:06:30] <graydon> we didn't have & back then and it seemed like the low level operations that had to go fast were going to require compiler-specific knowledge
[17:06:33] *** Joins: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net)
[17:06:34] <graydon> this was, in retrospect, a mistake
[17:07:02] *** Quits: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP) (Input/output error)
[17:07:20] *** Joins: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP)
[17:07:44] *** Joins: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de)
[17:08:19] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[17:09:16] <doomlord> (heh, re restrict, the question is which will happen first - the "TBAA" pass in rust .. or module system in c++ an someone convincing the c++ comittee to add something like 'impl' ..
[17:09:36] <strcat> modules in C++ happened ;p
[17:09:49] <strcat> just not standard C++
[17:10:07] <cmr> I think C++17 "Concepts" are similar to typeclasses?
[17:10:11] * cmr not really sure
[17:10:23] <strcat> cmr: are they calling them C++17 concepts now?
[17:10:30] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Quit: jmgrosen)
[17:10:32] *** Joins: seth (seth@moz-AEED5C00.hsd1.co.comcast.net)
[17:10:33] <strcat> they were calling them C++11 concepts, and then C++14 concepts
[17:10:37] <cmr> heh
[17:10:56] <cmr> definitely not c++14, afaik that wg is targeting c++17
[17:10:59] <cmr> r? https://github.com/mozilla/rust/pull/7695
[17:11:02] <doomlord> i dont think they wiill do exactly what struct/trait/impl do
[17:11:03] <graydon> 17 eh?
[17:11:10] <graydon> time keeps ticking
[17:11:18] <cmr> actually nevermind on that r?
[17:11:22] <cmr> I forgot some tick marks
[17:11:23] <strcat> graydon: well technically C++14 is probably still C++1y anyway ;p
[17:11:46] <strcat> http://clang.llvm.org/cxx_status.html
[17:11:50] <doomlord> if i could write c++ without headers and it had something like extention methods i'd willingly stick with it
[17:11:56] *** Quits: heftig (heftig@moz-CC716F18.dip0.t-ipconnect.de) (Quit: Quitting)
[17:12:12] <doomlord> i wont hold my breath
[17:12:20] <strcat> it won't have extension methods, that's for sure
[17:12:27] <strcat> they are anti-method
[17:12:47] <strcat> .begin() and .end() became free functions ;p
[17:12:49] <cmr> ok, r? https://github.com/mozilla/rust/pull/7695
[17:12:55] *** Joins: azakai (alon@moz-BBE3ABD.mv.mozilla.com)
[17:13:17] *** Joins: heftig (heftig@moz-CC716F18.dip0.t-ipconnect.de)
[17:13:21] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[17:13:21] *** ChanServ sets mode: +o dherman
[17:13:56] *** Joins: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net)
[17:14:51] <graydon> strcat: why? better overloading on args than on self?
[17:14:55] <doomlord> the bit i object to is having to change calling syntax between the two cases.. makes refactoring harder
[17:15:09] <strcat> graydon: they have a weird view of privacy, where it's bad to use your own object's private state
[17:15:13] <doomlord> calling syntax shouldn't be confalated with the modules/acess rights
[17:15:30] <strcat> graydon: so pretty much all of the influential C++ people encourage using free functions whenever possible
[17:15:36] <strcat> just to reduce coupling
[17:15:43] <strcat> it's kind of weird.
[17:15:53] <strcat> also yeah, weird overloading stuff
[17:15:55] <graydon> bad to use your own object's private state?
[17:15:58] <strcat> graydon: yep
[17:16:00] <strcat> ;p
[17:16:01] <graydon> ?
[17:16:05] <doomlord> free functions are encouraged and here on  irc i meet people who insist theats not OOP :)
[17:16:21] *** qmx is now known as whocares
[17:16:28] *** whocares is now known as qmx
[17:16:33] <doomlord> the language syntax and java-poisoned culture herds people to methods
[17:16:42] <strcat> graydon: they want you to define a small interface with methods and write the rest with functions leveraging them
[17:16:55] <strcat> it makes sense, but it's just weird to be protecting yourself from yourself *in C++*
[17:17:05] <strcat> and it's not really something I'd ever do...
[17:17:15] <strcat> just make smaller modules? ;p
[17:17:43] <MaikKlein> hm
[17:17:45] *** Joins: eevee (eevee@moz-58058235.evrt.wa.frontiernet.net)
[17:17:57] <steven_is_false> I actually like the idea of making a very tiny interface.
[17:17:59] <MaikKlein> rusti: use extra::arc::ARC;
[17:18:00] -rusti- <anon>:7:13: 7:28 warning: unused import [-W unused-imports (default)]
[17:18:00] -rusti- <anon>:7          use extra::arc::ARC;
[17:18:00] -rusti-                       ^~~~~~~~~~~~~~~
[17:18:00] -rusti- ()
[17:18:12] <strcat> graydon: rust doesn't really need it because you can just make stuff 'unsafe'
[17:18:14] <graydon> strcat: oh, I can kinda see where they're coming from
[17:18:16] *** Quits: posco (oscarboyki@636AC086.5999CED5.71743E61.IP) (Quit: posco)
[17:18:45] <strcat> well
[17:18:48] <strcat> to some extent you can
[17:19:23] <strcat> graydon: for example if I was writing an Option implementation in C++, the <, >, ==, != and std::hash implementations can use the public poor man's pattern matching interface
[17:19:33] <strcat> and having it all as free functions enforces that
[17:19:51] *** Quits: heftig (heftig@moz-CC716F18.dip0.t-ipconnect.de) (Quit: Quitting)
[17:20:00] *** Joins: heftig (heftig@moz-CC716F18.dip0.t-ipconnect.de)
[17:20:18] <strcat> and then you have to worry less about those functions getting something wrong
[17:20:35] <pnkfelix> strcat: "public poor man's pattern matching interface" ?
[17:21:01] <MaikKlein> what does ARC do? if I have a var in task1 and I create a task2. If I now share the var from task1 into task2 via ARC it freezes the var in task1 until task2 is finished?
[17:21:04] <strcat> pnkfelix: https://github.com/thestinger/util/blob/master/either.hh#L68 ;p
[17:21:31] <strcat> and you can see it being used further down
[17:21:32] *** Joins: posco (oscarboyki@636AC086.5999CED5.71743E61.IP)
[17:21:45] <strcat> it's not that bad, if C++ lambdas weren't so verbose
[17:21:54] *** Quits: SimonSapin (simon@88F51059.F3BBB17D.144F44FA.IP) (Ping timeout)
[17:21:59] <strcat> not that it's actually pattern matching
[17:22:04] <strcat> but it's a special case of it
[17:22:29] <steven_is_false> MaikKlein: An ARC is for shared immutable state.
[17:22:44] *** Quits: heftig (heftig@moz-CC716F18.dip0.t-ipconnect.de) (Quit: Quitting)
[17:22:54] *** Joins: heftig (heftig@moz-CC716F18.dip0.t-ipconnect.de)
[17:23:02] <pnkfelix> wow i really have not been paying attention to what's been going on in C++
[17:23:08] *** Quits: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com) (Quit: webber46)
[17:23:21] <pnkfelix> (i had not been aware of the repurposing of `auto`)
[17:23:46] <strcat> pnkfelix: it has 2 uses now, type inference from the RHS and using a trailing return
[17:23:55] <strcat> and atm a trailing return just lets you use decltype (a standard typeof)
[17:24:03] <strcat> in C++14 it will infer return types.
[17:24:21] <doomlord> #define fn auto and #define let auto :)
[17:25:12] <strcat> pnkfelix: rust isn't that far from being a safe C++11 with much saner syntax + language features instead of metaprogramming hacks
[17:25:13] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[17:25:14] <doomlord> the trailing returns supposedly improve ability to specify scope aswell
[17:25:36] *** Joins: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net)
[17:25:58] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[17:26:52] <doomlord> i wonder how much could theoretically be handled by a source to source translator, but i'm not volunteering to try and write one
[17:26:55] <strcat> type traits + static_assert is sort of like a really crappy manual version of traits
[17:27:21] <strcat> you can stick static_asserts in a lot of weird places. I have them in the struct body there
[17:27:53] *** Quits: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com) (Quit: jeff)
[17:29:07] <Eridius> hmm, the ICE for not remembering to recompile linked crates when updating rust is no longer an ICE. Now it just says it can't find the crate 'std'
[17:29:15] <Eridius> which is, I must say, just as obscure as the ICE
[17:29:40] <cmr> Well that's because make deletes the old ones now, doesn't it?
[17:29:48] <doomlord> (re restrict again,of course there is the workaround of caching values in locals , if you are sure the locals will tend to stay in registers)
[17:30:10] <Eridius> cmr: I'm recompiling my project, but I forgot to clean and recompile a library within it
[17:30:30] <Eridius> I mean sure, maybe it's trying to link against the same std that library used, but it's still a very confusing message
[17:30:43] <doomlord> (is that handled LLVM  side.. llvm starts with locals in an infinite register file and spills what doesn't fit?)
[17:31:16] <cmr> doomlord: http://llvm.org/docs/CodeGenerator.html#register-allocator
[17:32:22] *** Quits: robertknight (robertknig@moz-54528EE0.wby.mendeley.com) (Quit: Computer has gone to sleep.)
[17:32:27] <cmr> and http://blog.llvm.org/2011/09/greedy-register-allocation-in-llvm-30.html for more details
[17:32:54] <erickt1> strcat: I replied to you on https://github.com/mozilla/rust/issues/7694
[17:33:03] <Eridius> huh I thought the new base64 decoding was supposed to be smarter, but it still breaks on hard-wrapped base64
[17:33:50] <pnkfelix> Eridius: I'm confused; are you seeing linkage issues because you were running rustc out of your local build tree rather than doing a `make install` first before using it on your other project?
[17:34:08] *** Joins: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com)
[17:34:16] <Eridius> pnkfelix: no. I think saying "linking against std" is actually wrong, I think this was during compile, but I already threw away the error message
[17:34:20] <pnkfelix> Eridius: (I mostly want to ensure I didn't break an important use case with my makefile revisions)
[17:34:28] <Eridius> pnkfelix: basically, I was doing what used to trigger an ICE, and now just triggers a confusing error message
[17:35:38] *** Joins: tjc (tjc@moz-BE33DA21.fw1.sfo1.mozilla.net)
[17:35:38] *** ChanServ sets mode: +o tjc
[17:36:13] <pnkfelix> Eridius: hmm.  Okay.  I assume you'll continue to hit this same problem in the future, but if you could give me an isolated way to reproduce it, I can try to think about it.  (Or maybe it will end up being something better handled by rustpkg in the future.)
[17:37:08] <Eridius> pnkfelix: I have a project, which uses a library that's typically compiled alongside the project (and lives in a subdir). If I update rustc, and recompile my project, the library doesn't recompile normally (because the Makefile doesn't know it should)
[17:37:21] <Eridius> so compiling with the new rustc but trying to use my already-compiled library that used an older rustc, it doesn't work
[17:37:37] <Eridius> actually, maybe the ICE wasn't fixed, the library probably wanted libstd-0.7 and I'm on 0.8-pre now
[17:37:42] *** Joins: krdln (Mibbit@moz-6F8A8560.dynamic.chello.pl)
[17:37:42] <cmr> I'm having some troubles with rustdoc_ng. It seems to fail to resolve imports in external crates... https://github.com/cmr/rustdoc_ng/blob/wip/main.rs#L34 is the code (it matches all the steps rustc does until typeck), the log it generates is https://gist.github.com/cmr/0685e881a9dafa6a5093/raw/e3f0efbc12ee85ecf47591c2897a6487233d8491/gistfile1.txt. Am I missing something in the session options?
[17:37:57] *** Quits: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de) (Ping timeout)
[17:39:01] <cmr> tjc: ^
[17:39:28] *** Joins: Kettle (Mibbit@F43ED3F1.5CFEFE7D.51B98CA5.IP)
[17:40:26] *** Quits: Kettle (Mibbit@F43ED3F1.5CFEFE7D.51B98CA5.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[17:40:48] <tjc> cmr: you might want to add a debug statement to print out the sysroot you're using
[17:40:53] <tjc> just to be totally sure that it's right
[17:41:09] *** Joins: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com)
[17:41:09] *** ChanServ sets mode: +o pcwalton
[17:41:18] *** Quits: jmgrosen (jmgrosen@moz-848F6087.sb.sd.cox.net) (Quit: jmgrosen)
[17:41:32] <strcat> allocators are weird
[17:41:47] <strcat> the weird with_capacity pattern we used before is 2x as in C too
[17:42:01] *** Joins: vilonis (jared@moz-EE5D17ED.ph.ph.cox.net)
[17:42:06] <strcat> I guess they really don't like a small alloc turning into a big alloc
[17:42:19] <strcat> 2x as slow in C*
[17:42:41] <cmr> tjc: `rust: ~"sysroot: Some(@{is_absolute: true, components: ~[~\"home\", ~\"cmr\", ~\".local\"]})"` is correct
[17:43:58] <pnkfelix> Eridius: your description, while interesting, is not what I meant by an isolated way to reproduce the problem.  (I meant something more like a shell script that sets up the scenario, or a transcript of you doing so.)  Anyway, it sounds like you have some things you want to double-check first.
[17:44:12] *** Quits: cr (anonymous@moz-819DC186.dip0.t-ipconnect.de) (Ping timeout)
[17:45:24] *** Joins: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl)
[17:45:36] <tjc> cmr: you might also want to pretty-print the crate after maybe_inject_libstd_ref to make sure that the prelude reference got injected properly
[17:46:04] *** Quits: Guest (textual@34641662.FB4DE631.66C78B76.IP) (Quit: Textual IRC Client: www.textualapp.com)
[17:46:41] <cmr> tjc: syntax::print::print_crate ?
[17:46:59] <tjc> cmr: yeah, that should work
[17:47:00] <cmr> or, print::pprust::print_crate, that is
[17:48:17] *** Joins: cr (anonymous@moz-76DBFB4D.dip0.t-ipconnect.de)
[17:48:41] *** Joins: fylux (Mibbit@moz-AC51E628.red-83-37-43.dynamicip.rima-tde.net)
[17:49:02] *** Quits: dwhyte (dwhyte@ED9190FB.B72E355F.7BF4A4B0.IP) (Ping timeout)
[17:49:05] <fylux> Hi, I have just seen that Rust doesn't have an article in spanish wikipedia.
[17:49:20] <fylux> I'll make it.
[17:49:25] <erickt1> fylux: awesome!
[17:49:28] <erickt1> thanks!
[17:49:30] *** erickt1 is now known as erickt
[17:49:56] *** Joins: dwhyte (dwhyte@ED9190FB.B72E355F.7BF4A4B0.IP)
[17:50:06] <fylux> You're welcome, it's weird that a project like this doesn't have an article in spanish.
[17:50:32] <pcwalton> heads up: I have a bootstrapping compiler with no support for "copy"
[17:50:37] <pcwalton> so it is not long for this earth
[17:50:58] <cmr> pcwalton: I hope you added Clone impls to everything?
[17:51:02] <jensnockert> pcwalton: Isn't that a good thing?
[17:51:04] <pcwalton> everything I had to
[17:51:08] <pcwalton> jensnockert: yes:)
[17:51:08] <cmr> ok
[17:51:26] <pcwalton> I'll be removing the Copy bound later today too
[17:51:32] <jensnockert> pcwalton: It seemed like a good thing.
[17:51:39] <strcat> pcwalton: I guess that means we'll be able to remove the copying implementations from trans too? once it's snapshotted
[17:51:42] <Eridius> pnkfelix: the ICE has been around for a while. It's not something new. And if my latest speculation is correct, the error message isn't new either, it's just a side-effect of the version changing from 0.7 to 0.8-pre
[17:51:42] <jclements> jensnockert: â€¦but it could mean a lot of work for those of us with big branches.
[17:51:49] <pcwalton> strcat: doesn't need to be snapshotted
[17:51:49] *** Joins: jorendorff (jorendorff@moz-1747FB68.hsd1.tn.comcast.net)
[17:51:51] <pcwalton> we can just do it
[17:51:55] <strcat> ah right
[17:52:05] <pcwalton> we still need ref count bumps for @
[17:52:07] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[17:52:08] <jensnockert> jclements: Well, true. *hugs jclements*
[17:52:10] <pnkfelix> Eridius: okay
[17:52:17] <pcwalton> until graydon's GC lands
[17:52:44] <strcat> pcwalton: well I mostly just want to remove the non-managed ~T and ~[] mess
[17:52:58] <pcwalton> you mean the copying implementations for those?
[17:53:01] <strcat> yeah
[17:53:01] *** Quits: fylux (Mibbit@moz-AC51E628.red-83-37-43.dynamicip.rima-tde.net) (Quit: http://www.mibbit.com ajax IRC Client)
[17:53:03] <pcwalton> me too
[17:53:11] <pcwalton> they're undefined IR, right?
[17:53:19] <strcat> pcwalton: well I tried to fix it a bit
[17:53:25] <strcat> dunno how bad it is atm
[17:53:34] <pcwalton> they should be unused in my branch of the compiler
[17:53:51] <pcwalton> drop and free glue are still undefined behavior, right?
[17:53:59] <strcat> pcwalton: I think they often are
[17:54:06] <pcwalton> bleh
[17:54:07] <strcat> pcwalton: the transmute intrinsic needs work
[17:54:18] <strcat> LLVM refuses to inline it sometimes because of a bitcast it doesn't like
[17:54:22] <pcwalton> oh, hmm
[17:55:44] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[17:55:44] *** ChanServ sets mode: +o brson
[17:56:25] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[17:56:41] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[17:57:50] <erickt> strcat: ping
[17:58:36] <strcat> erickt: \o
[17:58:47] <erickt> hey there
[17:59:36] <erickt> I figure it'll be easier to talk here instead of through bug comments :)
[17:59:49] <strcat> erickt: likely :)
[18:00:43] <erickt> so the whole reason why I filed #7694 was because I had written `unsafe { c_function("foo".to_c_str().as_ptr()) }` in a couple places, which ends up passing a dangling pointer to the c function
[18:01:01] <erickt> It's so easy to do, and yet such the wrong thing to do :)
[18:01:15] <strcat> ah because it frees the rvalue?
[18:01:21] <erickt> yeah
[18:01:26] <cmr> tjc: https://gist.github.com/cmr/dc04a69a48789ec49d94
[18:01:30] <cmr> tjc: that looks right to me?
[18:02:13] <erickt> strcat: this is part of my patch series to remove trailing nulls from ~strs. .to_c_str() mallocs a `*libc::c_char` that is properly null terminated, and there's a destructor to make sure that string gets cleaned up
[18:02:25] <strcat> erickt: well, I'm starting to think we should just use & everywhere we know pointers are non-null/dangling
[18:03:38] *** Quits: jorendorff (jorendorff@moz-1747FB68.hsd1.tn.comcast.net) (Ping timeout)
[18:03:49] <tjc> cmr: looks ok to me. unfortunately I don't have anything more to suggest except digging in and doing more debugging-by-printf to see why it can't resolve std::prelude :-(
[18:04:11] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[18:04:12] <erickt> strcat: I agree we should do that, but that won't completely solve my problem. It's just so easy to write `fn c_function(*libc::c_char)` that I feel we're going to be causing a lot of bugs if we don't make harder to do the dangerous thing
[18:04:49] *** Joins: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de)
[18:05:08] *** Joins: jorendorff (jorendorff@moz-1747FB68.hsd1.tn.comcast.net)
[18:05:09] <erickt> I don't want `unsafe { }`, I want `less_safe { }` :)
[18:05:09] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[18:05:45] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[18:06:06] <strcat> erickt: and you can technically pass ~T to and from C now
[18:06:14] <strcat> not sure if it actually knows how to pass it directly
[18:06:17] * strcat hasn't tried
[18:06:46] <strcat> as long as the C library uses the same allocator as rust, and it does whether we use the system one or link in jemalloc
[18:07:26] <strcat> except I don't think that would work in MSVC with jemalloc, at least right now - it only supports replacing the malloc/free allocator with mingw on windows
[18:07:31] <strcat> so I dunno if it's a good idea to depend on that.
[18:07:54] *** Quits: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de) (Ping timeout)
[18:07:58] <strcat> although we could just not use jemalloc in MSVC until it gains support for that.
[18:08:09] <cmr> which is likely never
[18:08:32] <strcat> well I find ~T being interoperable with C to be a compelling feature
[18:08:43] <strcat> C libraries often hand you malloc'ed things
[18:08:51] <strcat> especially when they use opaque types
[18:09:33] <strcat> you can write your own type to wrap it but then you don't get interoperability with the rust stdlib
[18:09:47] *** Quits: davbo (dave@moz-3FFA637C.oucs.ox.ac.uk) (Client exited)
[18:11:21] <jensnockert> strcat: Can we even build with MSVC?
[18:11:32] <erickt> strcat: passing a ~T to C suggests transferring the ownership to C, which is semantically nice to have.
[18:11:33] <strcat> not atm but there's a bug open about it
[18:11:41] <jensnockert> strcat: *link with MSVC.
[18:11:55] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[18:12:18] <strcat> erickt: and especially receiving them from a C lib that way
[18:12:45] <strcat> ~Foo instead of a wrapper with a destructor + a getter for Foo
[18:12:52] <erickt> strcat: but you're right, it'll be tricky to say who gets to delete it when you can't guarantee we're using the same allocator as C
[18:13:21] <strcat> erickt: when you link in jemalloc on most platforms, it replaces the allocator used by C libs you link against too
[18:13:30] <cmr> Portable libraries don't make you free the memory they pass you with the system allocator, fwiw
[18:13:31] <strcat> it's just some that are problems (like MSVC)
[18:13:43] <strcat> I don't know if it's a fundamental problem or lack of support from jemalloc due to lacl of interest
[18:13:58] <strcat> cmr: plenty do
[18:14:08] <olsonjeffery> are there libraries that malloc then let the caller free w/o corresponding library API?
[18:14:11] <cmr> strcat: then they aren't portable, not to windows at least
[18:14:11] <strcat> some let you choose an allocator but... not all
[18:14:21] <strcat> cmr: they're "portable" to windows
[18:14:22] <olsonjeffery> eg libuv allocates the uv_loop_t, but they also have a call to release it
[18:14:30] <strcat> cmr: they might not do what all windows developers want in all cases
[18:14:46] <strcat> olsonjeffery: lots
[18:14:50] *** Quits: pyrac (pyrac@moz-8862B13A.w92-162.abo.wanadoo.fr) (Quit: pyrac)
[18:15:01] <strcat> olsonjeffery: for example glib lets you pick the allocator used by g_malloc and g_free at runtime
[18:15:13] <olsonjeffery> strcat: well in that case you can control both ends
[18:15:26] <olsonjeffery> im saying a case where the library controls the impl of the alloc operation but no the free
[18:15:53] <tjc> graydon: I don't suppose you might have a chance to look at https://github.com/mozilla/rust/pull/7681 ?
[18:15:54] <cmr> None come to mind
[18:16:26] <graydon> looks reasonable!
[18:16:27] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[18:16:31] <strcat> and sqlite lets you pick an allocator
[18:16:41] <cmr> as does libpng
[18:16:42] *** Joins: jviereck (Adium@moz-90ED83B.dclient.hispeed.ch)
[18:16:58] <erickt> strcat: it'd be nice if we could write a user-space equivalent to ~T, where we could wrap a *libc::c_char as a ~CStr, but you don't have to malloc an extra box to hold the pointer
[18:17:15] <strcat> erickt: a userspace one can't contain @ though
[18:17:20] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[18:17:28] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[18:17:36] <strcat> and we don't have a real way to forbid it atm (you can use Send, but that's too restrictive)
[18:18:30] <erickt> strcat: that's fine for my semantics :) I would just want to be able to provide a custom destructor to deallocate the pointer instead of using the standard ~T destructor/deallocator
[18:18:46] <strcat> erickt: the C++ equivalent to ~ actually lets you pass a destructor when you make it, like what you made
[18:19:29] <strcat> although it becomes part of the type
[18:19:37] <strcat> kind of
[18:19:38] *** Joins: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de)
[18:22:17] *** Joins: Azdle (Azdle@moz-B334B496.hfc.comcastbusiness.net)
[18:22:35] <erickt> strcat: `struct CStr(*libc::c_char)` has no runtime overhead, right? What if we made all of the libc functions take a CStr instead of *libc::c_char?
[18:23:10] <strcat> erickt: should be no overhead, if trans is correct
[18:23:21] <strcat> at the very least it's the same size
[18:23:26] <erickt> strcat: Where you write `fn c_func(CStr)` to transfer ownership, and `fn other_func(&Cstr)` when you don't
[18:23:40] <strcat> erickt: if it has a Drop impl it will be twice as big though
[18:23:44] <erickt> strcat: oh, but shucks, &CStr would have an extra pointer
[18:23:51] *** Quits: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com) (Quit: webber46)
[18:23:52] <strcat> with #[unsafe_no_drop_flag]
[18:23:54] <strcat> without*
[18:24:14] <strcat> and that wouldn't work because it would zero the fn ptr
[18:24:53] *** Joins: SimonSapin (simon@88F51059.F3BBB17D.144F44FA.IP)
[18:25:16] <strcat> erickt: you can make the destructor a type instead
[18:25:34] <erickt> how so?
[18:25:34] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[18:26:01] <strcat> erickt: struct Free; impl Destroy for Free { fn destroy(&self) { ... } }
[18:26:07] <strcat> err
[18:26:10] <strcat> fn destroy() { }
[18:26:12] <strcat> doesn't need self
[18:26:48] <MaikKlein> where do I find freeze?
[18:26:50] *** Quits: jorendorff (jorendorff@moz-1747FB68.hsd1.tn.comcast.net) (Ping timeout)
[18:26:51] <strcat> that's actually how you usually do closures in C++, the lambda syntax there makes a closure with a unique type and you usually use it *as* a type so it's "free"
[18:27:13] * strcat wishes we did something like that
[18:27:16] <strcat> Callable trait
[18:27:18] <strcat> dunno
[18:27:43] *** Joins: cp (cp@moz-993078EE.plus.com)
[18:27:46] <strcat> we don't have variadic things though... so wouldn't work
[18:28:57] *** Quits: graydon (graydon@moz-A8112A5D.cable.teksavvy.com) (Quit: Leaving.)
[18:29:06] <doomlord> Drop renamed Destroy?
[18:29:18] <pnkfelix> Is bors wedged?  I'm trying to figure out why it hasn't flagged #7280 as having failed (due to an unrelated intermittent issue, AFAICT)
[18:29:29] <erickt> strcat: I'm not sure then if this will help my specific case. Having a region on a *T pointer seems like it'd work for me
[18:29:51] <nmatsakis> strcat: we could do it, I think the Thunk/stack-closure proposal goes in this direction, I'd like to do that first before we try to go whole hog
[18:30:56] <strcat> the nice thing about the C++ ones is that you have an option to specialize anything taking a closure for each closure, instead of using std::function
[18:31:16] <strcat> so small ones are better off using a generic param
[18:31:30] <strcat> they don't have an equivalent to &fn though
[18:31:35] <strcat> only ~fn
[18:31:46] <erickt> strcat: would `fn destroy()` get passed in the value to destruct? As in `fn destroy(value: &T) {}`? so you don't need to store the destructor fn pointer along side the value?
[18:31:56] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[18:32:03] <strcat> erickt: yeah
[18:32:05] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[18:32:06] *** ChanServ sets mode: +o dherman
[18:32:10] <strcat> erickt: and you'd used Free as a type parameter
[18:32:14] <strcat> anyway it might be too painful
[18:32:15] *** Quits: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com) (Quit: pcwalton)
[18:32:21] <strcat> but it's just the C++ way of doing it, for comparison
[18:32:25] <doomlord> +
[18:32:35] <doomlord> oops
[18:32:43] <kmc> strcat: well you can take a reference to something callable, right?
[18:32:47] *** Joins: victorporof (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP)
[18:32:55] <strcat> kmc: &fn has an env ptr and a fn ptr though
[18:33:04] <strcat> C++ closures don't have even a function pointer for overhead
[18:33:13] <strcat> unless you opt-in to it
[18:33:24] <strcat> they're statically dispatched stack closures
[18:33:25] *** Joins: echristo (echristo@D423593A.D6CCE4AE.77834EAA.IP)
[18:33:49] <kmc> but if you upcast to std::function then there must be a virtual method involved right?
[18:33:54] <strcat> kmc: yes
[18:34:04] <strcat> kmc: but you can use templates for lambda params
[18:34:13] <kmc> that's the opt-in you refer to?
[18:34:15] <strcat> yeah
[18:34:22] *** Quits: tjc (tjc@moz-BE33DA21.fw1.sfo1.mozilla.net) (Quit: zzzzzzzzzz)
[18:34:23] <strcat> if you use them as their unique type, it's all static dispatch
[18:34:49] <strcat> &fn in rust is always a virtual call
[18:34:55] <strcat> it can devirtualize in some cases
[18:34:56] *** Joins: jorendorff (jorendorff@moz-1747FB68.hsd1.tn.comcast.net)
[18:34:58] <strcat> it often fails
[18:35:03] *** Joins: tjc (tjc@moz-BE33DA21.fw1.sfo1.mozilla.net)
[18:35:03] *** ChanServ sets mode: +o tjc
[18:35:05] *** Quits: tjc (tjc@moz-BE33DA21.fw1.sfo1.mozilla.net) (Client exited)
[18:35:13] <kmc> that's a LLVM optimization?
[18:35:14] <doomlord> i was going to say is this an optimization for later
[18:35:24] <strcat> kmc: yeah, LLVM can devirtualize to some extent
[18:35:24] <doomlord> to match c++
[18:35:31] *** Joins: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com)
[18:35:34] <strcat> kmc: the environment pointer adds more confusion for it to deal with too
[18:36:01] <strcat> if we had TBAA + llvm.invariant on function pointers it might not be as bad
[18:36:08] *** Quits: lkuper (lkuper@moz-C0CD33ED.hsd1.in.comcast.net) (Quit: Leaving)
[18:36:37] *** Quits: cp (cp@moz-993078EE.plus.com) (Ping timeout)
[18:37:01] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[18:37:01] *** ChanServ sets mode: +o brson
[18:37:34] *** Quits: jviereck (Adium@moz-90ED83B.dclient.hispeed.ch) (Quit: Leaving.)
[18:37:44] <strcat> pnkfelix: closing it will fix it
[18:38:18] <strcat> pnkfelix: but it has to be re-opened or bors gets confused ;\
[18:38:20] <pnkfelix> strcat: closing the PR?  Then what, reopen and do a @bors: retry ?
[18:38:21] *** Quits: wilsonk-laptop (kvirc@moz-39EFBFC2.cg.shawcable.net) (Ping timeout)
[18:38:26] <strcat> pnkfelix: err, I mean re-opened as a new PR
[18:38:34] <pnkfelix> strcat: ah, new PR, mm.
[18:38:41] <strcat> I think graydon changed bors a bit and this is an issue now
[18:38:43] <pnkfelix> nmatsakis: ^
[18:38:56] <strcat> pnkfelix: last night I re-opened one after closing to unblock it and it went into a bit of a panic mode
[18:39:01] <strcat> started building 2 at the same time
[18:39:06] <strcat> closing it permanently fixed it
[18:39:19] * strcat shrugs
[18:39:26] <strcat> malevolent AIs
[18:39:37] <nmatsakis> pnkfelix: huh?
[18:39:58] <strcat> nmatsakis: can you reopen https://github.com/mozilla/rust/pull/7280 ?
[18:40:01] <strcat> bors is being weird
[18:40:04] <strcat> (I mean as another PR)
[18:40:06] <pnkfelix> strcat: you may want to include that explanation when you close these PR's
[18:40:07] <tikue> hey guys, is there a difference between: (1) for vec.iter().advance |&foo| { use foo } and (2) for vec.iter().advance |foo_ptr| { let foo = *foo_ptr; use foo }
[18:40:22] <strcat> pnkfelix: I did before but I'd rather just bug graydon about it when he's back
[18:40:29] <strcat> he can probably fix it easily
[18:40:36] <strcat> it's a new bug
[18:40:38] <pnkfelix> strcat: I just meant that people might get annoyed
[18:40:43] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[18:40:43] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 141beab8a to 148fa0973: 02http://git.io/N3iJvQ
[18:40:43] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[18:40:44] <pnkfelix> strcat: that their pull requests are getting closed
[18:40:45] *** Joins: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP)
[18:40:45] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/vNVwyg
[18:40:45] <ghrust> 13rust/06auto 14294999c 15=Mark Sinclair: Added overloaded Add and Sub traits for pointer arithmetic...
[18:40:45] <ghrust> 13rust/06auto 1441bb374 15bors: auto merge of #7631 : MarkJr94/rust/ptr_arithmetic, r=thestinger...
[18:40:45] *** Parts: ghrust (ghrust@CFE85B59.6A2AE50.F3114085.IP) ()
[18:40:47] <strcat> there it goes
[18:40:49] <strcat> pnkfelix: ah, yeah
[18:41:09] <pnkfelix> strcat: don't want them blaming you instead of bors.  :)
[18:41:23] <strcat> we could try just re-opening but I'm 90% sure it will force-push it over top of that one and end up stuck in a worse situation ;p
[18:41:42] * strcat might as well just to confirm it's a bug
[18:41:47] <nmatsakis> strcat: like, literally just hit re-open?
[18:41:55] <strcat> nmatsakis: well I did, lets see what happens
[18:42:02] <nmatsakis> strcat: I tried opening as nother PR and github redirects me back to the original link
[18:42:05] <bblum> brson: https://github.com/brson/rust/commit/062bfd3#commitcomment-3606143
[18:42:07] <nmatsakis> strcat: I guess I could rebase ...
[18:42:18] <strcat> nmatsakis: or just 'git commit --amend' to touch the date and change the hash
[18:42:29] <strcat> although I guess that's a rebase.
[18:43:08] <strcat> it could be buildbot's fault
[18:43:15] <strcat> it's being weird and not starting builds right away
[18:43:52] *** Quits: ksev (DrunkenPan@745B767B.989A61DC.CA5B6332.IP) (Ping timeout)
[18:43:53] *** Joins: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP)
[18:43:53] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1441bb374 to 148fa0973: 02http://git.io/N3iJvQ
[18:43:53] *** Parts: ghrust (ghrust@AC22872E.6A2AE50.F3114085.IP) ()
[18:43:55] *** Joins: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP)
[18:43:55] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/tvDDQw
[18:43:55] <ghrust> 13rust/06auto 146330d1c 15Niko Matsakis: Add an identifier to TypeParameterDefs and use it to pretty print type parameters
[18:43:55] <ghrust> 13rust/06auto 1493d91d9 15bors: auto merge of #7280 : nikomatsakis/rust/type-parameter-names, r=cmr...
[18:43:56] *** Parts: ghrust (ghrust@5FEF1C87.6A2AE50.F3114085.IP) ()
[18:43:57] <strcat> see? ;p
[18:44:08] <nmatsakis> strcat: ok, I dunno, let me know if I should take some other action :)
[18:44:18] <strcat> nmatsakis: yeah can you rebase it just to change the hash?
[18:44:21] <strcat> and force push
[18:44:25] *** Joins: victorporof_ (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP)
[18:44:28] <nmatsakis> tikue: no, not really
[18:44:34] <nmatsakis> strcat: I just did that
[18:44:39] <strcat> nmatsakis: ah
[18:44:41] <strcat> nmatsakis: hrmm
[18:44:44] <nmatsakis> strcat: should I close the PR first and re-open it?
[18:44:51] *** Joins: josh (josh@29B7FDBE.CF5FEE20.2A2F4638.IP)
[18:44:51] <strcat> nmatsakis: maybe you should rename the branch
[18:44:55] <strcat> and make a new PR
[18:45:02] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Quit: Leaving.)
[18:45:06] <pnkfelix> nmatsakis: yeah I was super confused by that 
[18:45:18] <strcat> http://buildbot.rust-lang.org/bors/bors.html see it thinks two are pending
[18:45:26] *** Quits: victorporof (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP) (Ping timeout)
[18:45:30] <strcat> and started 2 sets of builds
[18:45:37] * strcat knows how to make it recover though
[18:45:43] <strcat> just have to wait for the first to finish and manually merge
[18:45:49] <pnkfelix> nmatsakis: (by the sudden introduction of a new commit, unrelated to the earlier tested commit, to the same PR)
[18:45:53] * nmatsakis confused
[18:45:57] <strcat> bors always seems to go insane when I'm the only one around so I learned how to fix it
[18:46:08] <nmatsakis> strcat: ok, just tell me precisely what steps you want me to take when you want me to take them :)
[18:46:25] <strcat> nmatsakis: git checkout -b new_branch_name and push it, and make a PR from there
[18:46:35] <nmatsakis> strcat: should I close old PR first, is what I mean?
[18:46:41] <strcat> nmatsakis: yeah
[18:46:43] <nmatsakis> ok
[18:46:43] <strcat> I closed it already though
[18:46:43] *** Joins: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP)
[18:46:44] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1493d91d9 to 148fa0973: 02http://git.io/N3iJvQ
[18:46:44] *** Parts: ghrust (ghrust@DE823A67.6A2AE50.F3114085.IP) ()
[18:46:47] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[18:46:47] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/0V8SpQ
[18:46:47] <ghrust> 13rust/06auto 14294999c 15=Mark Sinclair: Added overloaded Add and Sub traits for pointer arithmetic...
[18:46:47] <ghrust> 13rust/06auto 1490db862 15bors: auto merge of #7631 : MarkJr94/rust/ptr_arithmetic, r=thestinger...
[18:46:47] <tikue> nmatsakis: thanks
[18:46:48] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[18:46:49] <nmatsakis> ok, I'll make a new branch.
[18:47:07] <strcat> bors is back to sanity now
[18:47:13] <strcat> just have to cancel those builds it made I think...
[18:47:18] *** Quits: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com) (Quit: webber46)
[18:47:38] * strcat is a bot whisperer
[18:47:59] <nmatsakis> strcat: https://github.com/mozilla/rust/pull/7698
[18:48:09] <engla> strcat: your suggestion RingBuf or RingBuffer for deque doesn't sound so bad anyway
[18:48:16] <strcat> nmatsakis: ok I think it should be fine now
[18:48:31] <nmatsakis> strcat: do you know of anyone working on any persistent collections, btw?
[18:48:41] <strcat> I really don't understand why it does that but... it seems to have started since graydon made it only report actual failures instead of interrupts too
[18:48:46] <strcat> nmatsakis: dunno, don't think so
[18:48:56] <strcat> erickt might have been working on a persistent treemap
[18:49:46] <strcat> http://buildbot.rust-lang.org/builders/auto-linux-all-opt/builds/362/steps/git/logs/stdio that makes me suspect buildbot did something awful
[18:49:56] <strcat> like starting two builds in the same buildslave...
[18:50:09] * strcat shrugs
[18:51:09] <strcat> nmatsakis: hrm wait you opened two
[18:51:31] <strcat> I guess you didn't need to rename the branch though, it doesn't seem to care
[18:51:34] <brendanc> you'd get that error if auto moved between the time the build was triggered and the checkout was attempted
[18:51:42] <nmatsakis> strcat: oh, maybe I was wrong about github taking me back to the same PR,
[18:51:54] *** Quits: azita (Azita@moz-BBE3ABD.mv.mozilla.com) (Quit: azita)
[18:52:02] <strcat> well at least we narrowed down the bug more
[18:52:03] <nmatsakis> strcat: I think I was just confused by the persistence of the comments on the commit
[18:52:09] <strcat> nmatsakis: ah
[18:52:17] <strcat> nmatsakis: yeah because they're attached to your repo
[18:52:19] *** Joins: ksev (DrunkenPan@745B767B.989A61DC.CA5B6332.IP)
[18:52:22] <strcat> nmatsakis: it's really weird
[18:52:29] <nmatsakis> it makes sense, sort of.
[18:52:33] <strcat> people can edit comments others make on their PR commits because you can edit comments in your repo
[18:52:34] <nmatsakis> well I closed one PR
[18:52:38] <nmatsakis> I left the one with the better name anyhow
[18:52:59] <Sergio965> strcat! =^..^= 
[18:53:10] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[18:54:36] <strcat> nmatsakis: must be a bug in bors though, for 2 PRs to be considered pending
[18:56:02] *** Quits: Blei (philipp@moz-650B9C6A.cust.bluewin.ch) (Quit: WeeChat 0.4.1)
[18:56:16] <strcat> it better not happen on every failure... ;p
[18:58:38] *** Joins: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com)
[18:58:41] *** Parts: jeff (jeff@moz-F81F6C4E.nyc.biz.rr.com) ()
[18:58:50] <nmatsakis> strcat: why is that a bug? if there are 2 PRs?
[18:58:57] *** Quits: pnkfelix (pnkfelix@87C1F78E.1DE10CA8.D8E68FF6.IP) (Quit: Leaving.)
[18:58:59] <strcat> nmatsakis: well pending means currently testing
[18:59:04] <strcat> and it force pushes to auto when it does that
[18:59:12] <strcat> and when tests pass, it merges auto to master
[18:59:14] <strcat> so it wouldn't work
[18:59:25] <strcat> I don't know what it would actually do if we let tests pass, it might merge the wrong one
[18:59:56] <nmatsakis> strcat: I am confused. If there are 2 PRs, with same commit, I should think it would start by merging auto, which is a no-op as the commit is already present in the tree
[19:00:07] <strcat> nmatsakis: oh I mean 2 pending as in your PR was pending along with another
[19:00:11] <strcat> it's fine to have 2 with the same commit
[19:00:14] *** Joins: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com)
[19:00:19] <nmatsakis> strcat: oh, I see, 
[19:00:23] <nmatsakis> strcat: yes that sounds like a bug
[19:00:25] <strcat> the original one (before you reopened any)
[19:00:32] <nmatsakis> supposed to be a serial process
[19:00:34] <strcat> it merged one, then merged yours on top of it
[19:00:40] <strcat> and started 3 sets of builds
[19:00:42] <strcat> ;p
[19:01:01] <strcat> although I think it would have started only 2 sets if I hadn't closed/reopened
[19:01:45] *** Quits: BizarreCake (BizarreCak@moz-361FE9B2.dynamic.barak-online.net) (Ping timeout)
[19:02:08] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[19:02:25] <MaikKlein> how do I wait for 5 sec in a loop again? loop { dosth(); wait();}
[19:02:36] <strcat> extra::timer ?
[19:02:48] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Connection reset by peer)
[19:03:19] *** Quits: ksev (DrunkenPan@745B767B.989A61DC.CA5B6332.IP) (Ping timeout)
[19:03:34] <Eridius> MaikKlein: use FFI to call sleep()?
[19:03:39] *** Joins: infynyxx_ (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[19:03:43] <Eridius> I don't think there's a great solution for sleeping a task at the moment
[19:03:46] <strcat> Eridius: that sleeps the whole thread though
[19:03:50] <strcat> afaik extra::timer works fine
[19:04:02] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[19:04:02] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Ping timeout)
[19:04:05] <strcat> I tried using it before and it did work but it doesn't let you interrupt the timer early so it wasn't good enough for what I wanted
[19:04:19] <Eridius> I seem to recall there being some reason I didn't use extra::timer when I needed to be able to sleep, but I don't remember what it was
[19:04:26] <Eridius> (in my case sleeping the whole thread was fine, since I only had one task)
[19:04:41] <MaikKlein> how do I use sleep?
[19:04:41] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[19:04:47] <MaikKlein> what is the first argument?
[19:05:09] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[19:05:11] <Eridius> MaikKlein: sleep as in the ffi C call? extern { fn sleep(n: libc::c_uint) -> libc::c_uint; }
[19:05:22] <Eridius> but it'll sleep the whole thread, which may not be what you want since the scheduler won't know about this
[19:05:35] <strcat> MaikKlein: http://static.rust-lang.org/doc/extra/timer.html#function-sleep there's this
[19:05:54] <strcat> you get the IoTask for extra::uv_global_loop::get()
[19:05:58] <strcat> from*
[19:06:04] <MaikKlein> ah
[19:06:08] <MaikKlein> thanks
[19:06:38] *** Quits: fabiand (fabiand@moz-C17D01C9.adsl.alicedsl.de) (Quit: Verlassend)
[19:10:49] *** Joins: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com)
[19:11:18] *** Quits: Azdle (Azdle@moz-B334B496.hfc.comcastbusiness.net) (Quit: Leaving)
[19:14:25] <mark_edward> bors is a beast. i dig that guy
[19:15:22] *** Quits: Sergio965 (sergiobz@moz-BB21156B.dynamic.csail.mit.edu) (Ping timeout)
[19:17:27] *** Quits: dwhyte (dwhyte@ED9190FB.B72E355F.7BF4A4B0.IP) (Client exited)
[19:20:07] *** Quits: josh (josh@29B7FDBE.CF5FEE20.2A2F4638.IP) (Quit: josh)
[19:20:12] *** Joins: dwhyte (dwhyte@ED9190FB.B72E355F.7BF4A4B0.IP)
[19:23:01] *** Quits: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com) (Quit: webber46)
[19:23:27] *** Joins: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca)
[19:23:46] *** Quits: vilonis (jared@moz-EE5D17ED.ph.ph.cox.net) (Ping timeout)
[19:24:41] <jedestep> rustpkg issue: in my src folder i have two folders, one and two, each with lib.rs. two depends on one. when i rustpkg build two, it compiles one but then can't find the library file it creates. why is this?
[19:26:51] *** Quits: kornholi (kornholi@moz-185F17B0.net) (Quit: leaving)
[19:28:27] *** Quits: infynyxx_ (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[19:28:42] *** Joins: mye (mye@moz-ACE53E5D.dip0.t-ipconnect.de)
[19:28:53] *** Joins: pyrac (pyrac@moz-8862B13A.w92-162.abo.wanadoo.fr)
[19:29:49] *** Joins: relistan (relistan@moz-2DE8112B.cable.virginmedia.com)
[19:29:50] *** Joins: vilonis (jared@moz-EE5D17ED.ph.ph.cox.net)
[19:31:30] *** Quits: sankha93 (Instantbir@6B172289.35354309.EFB84E89.IP) (Quit: Instantbird 1.4 -- http://www.instantbird.com)
[19:31:51] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[19:33:04] *** Joins: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com)
[19:33:50] <cmr> Luqman: ping
[19:33:55] <Luqman> cmr: pong
[19:34:06] <cmr> Luqman: what happened with https://github.com/mozilla/rust/issues/6875 ?
[19:34:16] <cmr> Erm, https://github.com/mozilla/rust/issues/4643 rather
[19:35:21] <Luqman> cmr: ah right, i actually recently rebased it
[19:35:43] <Luqman> problem was though, due to the way i guess metadata is written it wouldn't always work cross-crate
[19:36:12] <cmr> Does it continue to only handle function use?
[19:36:22] *** Joins: josh (josh@29B7FDBE.CF5FEE20.2A2F4638.IP)
[19:37:49] *** Quits: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com) (Client exited)
[19:37:55] *** Joins: rusti (rusti@moz-54F7FD49.cpe.net.cable.rogers.com)
[19:38:12] <Luqman> cmr: yes
[19:39:42] *** Quits: snadon (chatzilla@moz-3BC727E8.mc.videotron.ca) (Ping timeout)
[19:39:44] *** Quits: doener (doener@moz-121949B3.unitymediagroup.de) (Quit: leaving)
[19:39:52] <cmr> Does function include method?
[19:41:24] <Luqman> no, they're handled differently
[19:41:29] <cmr> alright
[19:41:33] <glinscott> did the rustic error color just change?  it's very difficult to read on default mac terminals now
[19:41:42] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[19:42:07] <cmr> glinscott: yes, the messages are now printed in bright white. Change your term to xterm-256color to get normal colors.
[19:42:11] <cmr> TERM, that is
[19:42:35] <mark_edward> i think bors is awesome
[19:43:59] <glinscott> cmr: hm..  it seems my terminal is xterm-256color
[19:44:18] <cmr> glinscott: hm, that's problematic then. screenshot?
[19:44:35] <strcat> all of the ansi colors should be readable on the background color
[19:44:41] <strcat> or the terminal's colorscheme is terrible
[19:45:19] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[19:47:12] *** Quits: paulproteus (quassel@rose.makesad.us) (Ping timeout)
[19:47:32] *** Quits: vilonis (jared@moz-EE5D17ED.ph.ph.cox.net) (Ping timeout)
[19:48:15] *** Joins: paulproteus (quassel@moz-E86A3B42.makesad.us)
[19:48:47] <Eridius> cmr: bright white? really? that's not going to work well on a white background, which is what Terminal.app's default is
[19:49:11] <cmr> what an awful choice of background color
[19:49:45] <cmr> the PR author said it was what clang does... what does clang do on OS X?
[19:50:30] <Eridius> looks like bold black to me
[19:50:42] <Eridius> oh it's bold "default"
[19:50:43] <Eridius> not bold white
[19:50:45] <Eridius> just plain bold
[19:50:45] <engla> what is the normal color?
[19:50:53] *** Joins: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net)
[19:51:12] <Eridius> if my foreground color is red, I get bold red. if it's white, I get bold white. etc
[19:51:23] *** Quits: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP) (Ping timeout)
[19:53:30] *** Quits: Axord (xord@moz-C3CCF156.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[19:57:16] *** Quits: mye (mye@moz-ACE53E5D.dip0.t-ipconnect.de) (Quit: mye)
[19:58:12] *** Quits: glinscott (garylinsco@789A6618.53EB7C1.FFFE3AA.IP) (Ping timeout)
[19:58:14] <Eridius> cmr: I think I need to add a .bold() method to term, and then update the errors to use that instead :/
[19:58:29] <Eridius> gonna have to update .reset() to use sgr0 instead of op, which was my eventual plan anyway
[19:58:35] <cmr> yeah
[19:59:02] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[19:59:09] *** Quits: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de) (Client exited)
[19:59:11] <Eridius> cmr: didn't you grab statistics on terminfos to see what they support? Are there any that support color and op, but not bold and sgr0? I would be extremely surprised if this was the case, but it'd be good to know
[19:59:17] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Connection reset by peer)
[19:59:19] <Eridius> (because if so, reset would want to fall back to op, but I suspect that's not necessary)
[19:59:28] <cmr> I did not.
[19:59:31] <Eridius> or I guess any that support color and/or bold, but not sgr0
[19:59:35] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[19:59:51] <strcat> Eridius: kernelspace linux console has no bold/italic
[20:00:00] <Eridius> oh I thought you told me a while ago that you looked at a bunch of terminfos to see what the support for something is
[20:00:01] <strcat> it just has 24 colors
[20:00:05] <Eridius> strcat: o_O is there a terminfo for this?
[20:00:09] <strcat> 'linux'
[20:00:14] *** Joins: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de)
[20:00:17] <cmr> well I did, but I didn't grab stats
[20:00:22] <cmr> I just looked through infocmp
[20:00:29] <strcat> Eridius: the modern replacement is kmscon
[20:00:31] *** Quits: PeterSP (peter@moz-4DAF5777.bstnma.fios.verizon.net) (Ping timeout)
[20:00:38] <jensnockert> Hurray, now I can cast `0.1f32 as f32x4` \o/
[20:00:40] <bblum> tikue: https://github.com/mozilla/rust/wiki/Doc-under-construction-FAQ#noncopyable-stack-closures
[20:00:42] <strcat> hardware accelerated userspace VT
[20:01:04] <strcat> but... I'm sure people still use the good ol' nearly deprecated in-kernel one
[20:01:32] <Eridius> strcat: Ubuntu 12.04 has no terminfo for kmscon, and the terminfo for 'linux' claims it supports bold
[20:01:48] <strcat> Eridius: kmscon uses 'xterm-new' or something
[20:01:51] <MaikKlein> what happens if I spawn a task with an infinite loop and I lose the chan to this task. will this task run forever?
[20:01:52] <strcat> and it ships it itself, like urxvt
[20:01:59] <Eridius> ah
[20:02:00] <strcat> Eridius: all terminals with correct terminfo ship it themselves ;p
[20:02:03] <strcat> ncurses is all wrong
[20:02:05] <Eridius> heh
[20:02:10] <strcat> doesn't even have fsl/tsl for xterm
[20:03:04] <thiez> there is this discussion on the issue-list about naming conventions for functions that convert between types
[20:03:21] <thiez> is there any reason this could't be done with some traits?
[20:03:22] *** Quits: int3_ (int3_@moz-ABE52D50.hsd1.ca.comcast.net) (Client exited)
[20:04:49] *** Joins: mzabaluev (mzabaluev@moz-91FFD755.dhcp.inet.fi)
[20:04:58] <Eridius> strcat: do you happen to have a terminfo on your computer that supports color but not bold? can you give me the `infocmp` output for this?
[20:05:34] <cmr> What's the cap for bold?
[20:05:39] <Eridius> 'bold' ;)
[20:05:52] <strcat> Eridius: it treats bold as bright
[20:05:53] <cmr> heh
[20:05:54] *** Joins: PeterSP (peter@moz-4DAF5777.bstnma.fios.verizon.net)
[20:05:54] <strcat> the linux console
[20:05:58] <strcat> it does support it... I guess
[20:05:59] <thiez> e.g. trait MoveConvert<T> { fn be(self)->T }, trait RefConvert<T> { fn as(&self)->&T }, trait CopyConvert<T> { fn to(&self)->T } ?
[20:06:07] <Eridius> strcat: ooh. ok, bright is a common interpretation of bold
[20:06:30] <Eridius> in fact, the 'bold' cap is defined as "turn on bold (extra bright) mode"
[20:06:58] <Eridius> Terminal.app has checkboxes in the prefs to determine if 'bold' should turn on bright, turn on bold fonts, or both
[20:07:38] <Eridius> cmr: I think I want to make the term functions return a boolean indicating whether the terminal supports the requested operation
[20:07:58] <Eridius> would be nice to be able to query ahead of time for a given operation too, but I'm not sure the right way to handle that
[20:08:22] <strcat> vte finally supports bold italic properly
[20:08:22] *** Quits: relistan (relistan@moz-2DE8112B.cable.virginmedia.com) (Quit: relistan)
[20:08:41] <cmr> Eridius: IMO the ideal interface is a simple DSL, and it does best-effort to represent accurately for the current terminal
[20:08:59] <Eridius> cmr: what do you mean?
[20:09:29] <cmr> extra::term::write("%{bold, red}foo%{end}")
[20:09:34] <cmr> or something
[20:09:38] <Eridius> oh you want to do string parsing? :/
[20:09:39] *** Quits: olleharstedt (Thunderbir@moz-80D8890F.ias.bredband.telia.com) (Ping timeout)
[20:09:46] <strcat> noooooo
[20:09:51] <cmr> I said the ideal interface, not what I want :p
[20:09:54] <Eridius> hah
[20:10:07] <strcat> stringly typed interfaces suck
[20:10:12] <Eridius> we could define an AST-ish data structure to represent spans of text with given attributes
[20:10:22] <Eridius> but this is probably overkill for 95% of use cases
[20:10:35] <strcat> just keep in mind it'd mean building up strings manually in many cases
[20:10:41] <cmr> yup
[20:10:49] *** Joins: paupau (textual@moz-D6583788.hsd1.ca.comcast.net)
[20:10:58] <cmr> a state machine consisting of chained method calls would be equivalent
[20:10:59] <strcat> slow and easy to get wrong
[20:11:04] <strcat> but not slow
[20:11:12] <Eridius> cmr: but in the end, the ability to query for attribute support ahead of time is still useful
[20:11:21] <Eridius> if you need to change your mind about how to represent something based on the attribute support
[20:11:22] <strcat> it can write output the escape immediately
[20:11:31] *** Quits: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[20:11:39] <cmr> t.red().bold().str("foo").reset().green("bar")
[20:11:43] <strcat> building up a string is dynamic allocation + a second layer of buffering
[20:11:49] <cmr> erm, not what I meant
[20:11:52] <strcat> not going to turn out great for an actual terminal application
[20:11:56] *** Joins: graydon (Adium@A5087023.2354C43D.D8E68FF6.IP)
[20:11:56] *** ChanServ sets mode: +qo graydon graydon
[20:12:04] <cmr> Eridius: yes
[20:12:10] <strcat> graydon: btw bors has a weird new issue
[20:12:18] <strcat> graydon: sometimes, when something fails a test, it gets stuck
[20:12:21] <graydon> strcat: not posting results, eh?
[20:12:22] <graydon> yeah
[20:12:26] <strcat> graydon: closing the PR unblocks it
[20:12:28] <graydon> I "fixed" the reporting results stuff
[20:12:32] <strcat> graydon: but then it ends up with 2 pending
[20:12:33] <graydon> but apparently  not right
[20:12:36] <graydon> :(((((((
[20:12:38] <strcat> well
[20:12:39] <graydon> gimme a minute
[20:12:46] <strcat> if you re-open it, it ends up with 2 pending
[20:13:00] <strcat> the only way to fix it is permanently closing a PR it gets stuck on
[20:13:02] <strcat> and making a new one
[20:13:15] <strcat> it doesn't like re-opens
[20:13:19] <strcat> maybe a separate issue.
[20:13:28] <cmr> Also github marks some bors merges as "closed" rather than "merged", but that's a papercut
[20:13:57] <graydon> there was a typo in my change
[20:13:59] <graydon> and it's python so
[20:14:01] <graydon> y'knokw
[20:14:03] <graydon> know
[20:14:04] <bstrie> warning: variable does not need to be mutable
[20:14:05] <bstrie> let mut is_mutbl = ...
[20:14:10] <bstrie> irony
[20:14:12] <bblum> c.c
[20:14:21] <cmr> I saw that earlier too, gave me a chuckle
[20:14:57] <graydon> typo fixed
[20:15:00] <graydon> bors should behave better now
[20:15:30] <graydon> how do I get github to report a merge as "merged" vs "closed"?
[20:15:38] <cmr> no idea
[20:16:02] *** Quits: Ms2ger (Ms2ger@moz-E9883900.access.telenet.be) (Quit: nn)
[20:16:19] <cmr> Maybe bors could use the "Merge Button" API?
[20:16:24] <cmr> `PUT /repos/:owner/:repo/pulls/:number/merge`
[20:16:41] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Ping timeout)
[20:17:43] <Eridius> cmr: I'm wondering if instead of .bold(), term should have .attr() with another set of attributes like BOLD, ITALIC, BLINK, etc
[20:17:46] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[20:17:55] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[20:18:02] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Max SendQ exceeded)
[20:18:14] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[20:18:25] <graydon> cmr: it is using the API for that
[20:18:38] <graydon> oh, on the _merge_? no
[20:18:39] <graydon> er
[20:18:42] <graydon> on the pull
[20:18:44] <graydon> we don't act on the PR
[20:18:48] <graydon> because PRs are not precise
[20:18:53] *** Quits: lucian (lucian@6B2B4644.4304AE1E.CE5E78F6.IP) (Input/output error)
[20:18:56] <strcat> yeah the PR can be updated
[20:18:58] <strcat> at any time
[20:19:08] <cmr> ah, right
[20:19:08] <graydon> bors uses the API to form a merge in-memory on github
[20:19:10] <strcat> it's just the branch ref
[20:19:16] <graydon> but it's a merge of the head sha, not the PR
[20:20:00] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Ping timeout)
[20:20:20] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[20:20:39] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Max SendQ exceeded)
[20:21:36] <cmr> I guess it's just a weird bug in github
[20:21:55] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[20:21:56] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[20:22:18] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Connection reset by peer)
[20:22:22] <strcat> cmr: the commits end up different because of fast-forwards
[20:22:26] <strcat> maybe it's just not great at tracking that
[20:22:44] *** Quits: reyre (reyre@86C3727C.33EE9F8A.1139E686.IP) (Client exited)
[20:22:56] <strcat> well because of merges*
[20:23:23] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[20:24:11] <thiez> is it possible to force the issue to show up as 'merged' through the api?
[20:24:39] <cmr> not that I can see
[20:25:20] <thiez> that is disappointing, would have been the easiest fix
[20:26:38] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[20:27:18] *** Joins: glinscott (garylinsco@789A6618.53EB7C1.FFFE3AA.IP)
[20:28:15] *** Joins: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP)
[20:29:11] <erickt> nmatsakis / strcat: I got an old bitrotted rewrite of the fun_treemap in a branch somewhere
[20:29:46] *** Joins: Sergio965 (sergiobz@moz-BB21156B.dynamic.csail.mit.edu)
[20:29:50] <MaikKlein> can I kill tasks?
[20:29:59] <bblum> you can with linked failure
[20:30:13] <bblum> you can't do it by way of a "handle" to an arbitrary task
[20:30:36] <MaikKlein> my handle is a chan which is sending a message
[20:30:46] <jedestep> rustpkg issue: in my src folder i have two folders, one and two, each with lib.rs. two depends on one. when i rustpkg build two, it compiles one but then can't find the library file it creates. why is this?
[20:30:51] <MaikKlein> so I just call a function like fail!?
[20:30:59] <nmatsakis> graydon: I am reading this thesis you sent along, but I feel like I'm missing something obvious
[20:31:08] <graydon> nmatsakis: ok
[20:31:10] <bblum> MaikKlein: you can add a case to the possible messages you can send, and on the receiver end, match against it and fail!()
[20:31:19] <nmatsakis> graydon: how can mostly copying rewrite pointers, if it doesn't have any knowledge of the types of things?
[20:31:22] <graydon> nmatsakis: very likely. I am not an expert at gc.
[20:31:24] <nmatsakis> graydon: or does it know the types of each allocation?
[20:31:29] <nmatsakis> graydon: but not the contents of the stack
[20:31:36] <graydon> it knows the type of everything in the heap
[20:31:39] <graydon> just not the contents of the stack
[20:31:45] <Eridius> cmr: btw, just for the record, I'm going to implement attribute support in term and fix the error messages to use bold instead of bright_white, so I don't want you trying to do the same thing
[20:31:46] <MaikKlein> bblum, ok thanks, I wasn't sure if fail was the right thing :)
[20:31:48] <graydon> the stack pins anything it points to
[20:31:51] <nmatsakis> graydon: ok, I thought the thesis was "no compiler cooperation", but I guess that's not quite right
[20:31:59] <cmr> Eridius: ok :p
[20:32:30] <cmr> Eridius: honestly I only did the original terminfo work because I selfishly wanted colors
[20:32:36] <graydon> oh huh, yeah, that's a good point; I think that thesis is "no compiler cooperation"
[20:32:38] <graydon> now I am confused too!
[20:32:50] <Eridius> cmr: that's the best motivation for changes :)
[20:32:57] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[20:33:05] <nmatsakis> graydon: regardless, we DO have precise heap info available,
[20:33:10] <nmatsakis> graydon: so I can see how we could use such a technique
[20:33:22] <graydon> yeah but now I feel foolish for pointing to that thesis
[20:33:29] <graydon> because I obviously only skimmed it :)
[20:33:48] *** Quits: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[20:33:52] <graydon> I have read like 7 different papers trying to explain how mostly-copying "easily generalizes" to incremental-generational
[20:34:05] <graydon> by making the pages carry generation-numbers
[20:34:10] <nmatsakis> graydon: not at all, it's a good read so far... I guess I'll save it for reading later
[20:34:24] <paupau> curious, where is this paper?
[20:35:10] <graydon> oh, never mind
[20:35:12] <graydon> it's obvious :(
[20:35:15] <graydon> sorry, yeah
[20:35:42] <graydon> nmatsakis: this paper uses the hack wherein you have to annotate every class you want to be GC'able with a "tell me which of your fields are pointers" function
[20:35:47] *** Quits: donri (dag@moz-9BB61102.tbcn.telia.com) (Client exited)
[20:35:57] <graydon> same as (eg) the XPCOM cycle collector :(
[20:36:15] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[20:36:15] <nmatsakis> graydon: yeah I kind of figured this is what they would do
[20:36:21] <graydon> "no support from the compiler" is a stretch. "user has to do everything right and do a lot of extra manual labour" is more like it
[20:36:34] <nmatsakis> well, it doesn't require compiler support,
[20:36:35] <nmatsakis> just user suppor t:)
[20:36:45] <nmatsakis> but I kind of feel like that's true in C++ no matter what unless you are PURELY conservative
[20:36:51] <nmatsakis> and even then...
[20:37:00] <graydon> yes. pure-conservative generally doesn't work with moving.
[20:37:02] <strcat> nmatsakis: C++11 adds gc hooks
[20:37:07] <strcat> dunno how useful they are
[20:37:14] <strcat> but they made lots of guarantees about the memory model
[20:37:36] <strcat> like indexing past an array bound being undef behaviour even if you allocated more than enough memory
[20:37:49] * strcat notices there's a case of foo[0] instead foo[] in the rust C++ sources
[20:38:03] <strcat> gcc recognizes that as undef now ;p
[20:38:15] <MaikKlein> what happens if I do "do spawn{loop{}};" isn't this like a memory leak?
[20:38:26] <nmatsakis> graydon: but basically the thesis uses MMU for write guards.
[20:38:37] <nmatsakis> graydon: (which makes total sense)
[20:38:37] <graydon> it does,  yes. but I don't think you _have_ to
[20:38:44] *** Joins: robertknight (robertknig@moz-54528EE0.wby.mendeley.com)
[20:38:46] <graydon> that's just to avoid touching the compiler
[20:38:52] *** Joins: pnathan1 (Adium@B9840254.2CD8A5F8.477B877D.IP)
[20:39:01] <nmatsakis> well, if you don't, you have to be able to identify when you are writing to data that may be managed,
[20:39:10] <nmatsakis> or else add potential overhead to *every* write
[20:39:18] <nmatsakis> which is basically what pcwalton is getting at
[20:39:41] <nmatsakis> that's hard to do in the presence of Cell and RcMut
[20:39:53] <graydon> I guess I don't understand why
[20:40:11] <nmatsakis> well, imagine that we have @Cell<T>,
[20:40:12] <graydon> he jumped to a conclusion ("the only thing I can think of") without explaining why it was foregone, so I'm pretty much lost in that thread
[20:40:22] <nmatsakis> yeah, actually,
[20:40:24] <nmatsakis> let me write this up as an e-mail
[20:40:27] <nmatsakis> so it's on record :)
[20:41:12] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Ping timeout)
[20:41:15] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[20:41:47] *** Joins: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch)
[20:42:46] <strcat> nmatsakis: I don't think NonManaged would be a big restricted on RcMut
[20:42:52] <strcat> restriction*
[20:44:05] <strcat> I don't think you'd ever use @mut or RcMut to make a generic data structure
[20:44:11] <strcat> just @/Rc for persistent ones
[20:46:15] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[20:46:15] *** ChanServ sets mode: +o dherman
[20:46:24] *** Quits: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de) (Ping timeout)
[20:46:49] *** Quits: heftig (heftig@moz-CC716F18.dip0.t-ipconnect.de) (Ping timeout)
[20:47:21] <nmatsakis> strcat: I more-or-less agree.
[20:47:23] *** Quits: jedestep (jedestep@34641662.FB4DE631.66C78B76.IP) (Ping timeout)
[20:47:27] <nmatsakis> graydon: ok, see my most recent msg
[20:47:47] <nmatsakis> graydon: https://mail.mozilla.org/pipermail/rust-dev/2013-July/004767.html
[20:48:09] <graydon> ok
[20:48:16] <graydon> do you want me to review the CFG thing you pushed?
[20:48:25] *** Quits: josh (josh@29B7FDBE.CF5FEE20.2A2F4638.IP) (Quit: josh)
[20:48:26] <nmatsakis> sure
[20:48:57] *** Quits: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP) (Ping timeout)
[20:49:09] <strcat> nmatsakis: could types like Cell/RcMut actually just implement the barriers for @mut? or is that not possible
[20:49:17] <strcat> I already added a contains_managed intrinsic
[20:49:58] *** Joins: eschweic (Adium@moz-BBE3ABD.mv.mozilla.com)
[20:50:16] *** Quits: dwhyte (dwhyte@ED9190FB.B72E355F.7BF4A4B0.IP) (Quit: Leaving.)
[20:52:02] *** Joins: pcwalton (pcwalton@moz-BBE3ABD.mv.mozilla.com)
[20:52:02] *** ChanServ sets mode: +o pcwalton
[20:52:46] *** Joins: jaen (jaen@moz-E0979827.copit.pl)
[20:54:03] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Connection reset by peer)
[20:54:16] *** Joins: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com)
[20:54:37] *** Joins: carllerche (carllerche@moz-BF6CB667.hsd1.ca.comcast.net)
[20:55:37] <bblum> ugh, i'm in separation-of-labour hell
[20:55:50] <bblum> this operation that should really just be one function is instead scattered across three files
[20:56:28] *** Quits: Earnestly (earnest@2AB30F53.FB5005.2BCC804A.IP) (Ping timeout)
[20:56:52] <nmatsakis> strcat: yeah, good point, see https://mail.mozilla.org/pipermail/rust-dev/2013-July/004769.html
[20:57:31] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[20:58:06] <strcat> first attempt at removing ~[] headers failed with a nice SIGILL ;]
[20:58:23] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[20:58:51] *** Joins: reyre (reyre@287A2BE7.F1F65310.47C41102.IP)
[20:59:18] <jensnockert> Does anyone happen to know how one can cast a [4 x f32]* or similar to a <4 x f32> load->bitcast doesn't work, apparently.
[20:59:42] <cmr> pcwalton: can you lend me a hand? https://botbot.me/mozilla/rust/msg/4397886/ really confusing, can't figure out why it's doing this :\
[20:59:54] *** Quits: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[21:00:23] <pcwalton> cmr: I'd need a stack trace
[21:00:54] <jensnockert> Oh wait, I can just bitcast->load instead.
[21:01:05] <cmr> pcwalton: from where?
[21:01:20] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[21:01:20] *** ChanServ sets mode: +o dherman
[21:01:29] <pcwalton> cmr: the failure
[21:01:35] <cmr> oh, right
[21:02:00] * strcat wonders if making vectors a bit smaller will do anything for rustc
[21:02:04] <strcat> doubtful I guess
[21:02:24] <cmr> pcwalton: https://gist.github.com/cmr/3d05431e4ba5e093451e that what you looking for?
[21:02:46] <pcwalton> cmr: hmm, you got an error
[21:02:51] <pcwalton> and it couldn't span_err it
[21:03:01] <pcwalton> I don't actually know off the top of my head how the codemap works. brson may know
[21:03:24] *** Quits: saml (sam@moz-14C16814.cst.lightpath.net) (Quit: Leaving)
[21:04:07] <cmr> Hm, I wonder if *any* spans work...
[21:04:11] *** Quits: msingle (Thunderbir@moz-930E5D97.hr.hr.cox.net) (Ping timeout)
[21:04:41] *** Joins: doomlord_ (servitor@moz-13E69BC8.range86-180.btcentralplus.com)
[21:05:08] *** Joins: dwhyte (dwhyte@ED9190FB.B72E355F.7BF4A4B0.IP)
[21:06:03] *** Quits: carllerche (carllerche@moz-BF6CB667.hsd1.ca.comcast.net) (Quit: carllerche)
[21:06:04] *** Joins: carllerche (carllerche@moz-BF6CB667.hsd1.ca.comcast.net)
[21:06:17] *** Quits: jviereck (Adium@moz-A034D4DA.dclient.hispeed.ch) (Quit: Leaving.)
[21:06:43] *** Quits: reyre (reyre@287A2BE7.F1F65310.47C41102.IP) (Client exited)
[21:06:55] <cmr> parse failures properly span, so I don't think I'm missing anything there
[21:07:19] *** Quits: lmandel (lmandel@F2D29657.F60B0462.67AC9B1.IP) (Quit: lmandel)
[21:07:31] *** Quits: jorendorff (jorendorff@moz-1747FB68.hsd1.tn.comcast.net) (Quit: jorendorff)
[21:07:59] *** Quits: victorporof_ (victorporo@74A9C5E8.1745F5FA.9B1E38F4.IP) (Quit: victorporof_)
[21:08:21] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[21:08:45] <strcat> heh, no idea what to name in-place iterator adaptors
[21:09:05] <Eridius> strcat: what are those?
[21:09:07] <strcat> prefix them all with "i" maybe
[21:09:17] <strcat> Eridius: reverse/sort on random access ones, for example
[21:09:26] <strcat> well maybe reverse just needs bidirectional
[21:09:30] <Eridius> strcat: since when do we have random-access iterators?
[21:09:42] <strcat> Eridius: we don't yet
[21:10:03] <Eridius> hmm, what terminfo possibly supports italic?
[21:10:22] <strcat> Eridius: well vte supports it, but the ncurses ones likely don't expose it
[21:10:25] <cmr> who would /want/ italic?
[21:10:36] <Eridius> cmr: I don't know. the wikipedia page says it's often treated as invert
[21:10:48] <cmr> Eridius: I think the joke went right over you..
[21:10:52] <Eridius> but I'm not seeing the sitm cap in any terminfo I look at
[21:10:56] <Eridius> cmr: :P
[21:11:06] <Eridius> _underline_ is so much better
[21:11:12] <strcat> Eridius: https://paste.xinu.at/ZDg/
[21:11:20] *** Quits: paupau (textual@moz-D6583788.hsd1.ca.comcast.net) (Quit: Textual IRC Client: www.textualapp.com)
[21:11:33] <Eridius> strcat: what term?
[21:11:37] <cmr> indeed
[21:11:39] <strcat> termite, it's just vte
[21:12:41] <jensnockert> Hurray, my casts work, without -O the IR is braindead, but it cannot be helped.
[21:12:50] <jensnockert> \o/ *dances &c.*
[21:12:51] *** Quits: james4k (james@moz-E7990244.consolidated.net) (Ping timeout)
[21:12:57] <Eridius> strcat: what's the first line of `infocmp` say?
[21:13:07] <strcat> xterm-termite|VTE-based terminal,
[21:13:11] *** Joins: james4k (james@moz-E7990244.consolidated.net)
[21:13:13] <strcat> ##imawizard Reconstructed via infocmp from file: /usr/share/terminfo/x/xterm-termite
[21:13:21] <strcat> Eridius: it just installs it itself
[21:13:22] <Eridius> ah must have shipped with termite
[21:13:25] <strcat> the default vte one was broken
[21:13:37] <strcat> Eridius: https://github.com/thestinger/termite/blob/master/termite.terminfo ;p
[21:13:54] <Eridius> thanks
[21:13:59] *** Quits: jdm (jdm@F2D29657.F60B0462.67AC9B1.IP) (Ping timeout)
[21:14:10] <strcat> I started from xterm-256color and fixed a few annoyances
[21:14:15] <strcat> it's not really 100% correct ;\
[21:14:18] <strcat> just more correct
[21:14:26] <Eridius> heh
[21:14:51] <strcat> and TERM is xterm-termite so silly xterm* matches pick it up
[21:16:14] <graydon> nmatsakis: ping
[21:16:19] <nmatsakis> graydon: pong
[21:16:23] <graydon> concerning the graph module
[21:16:34] <graydon> why indices rather than & values?
[21:16:46] *** Joins: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com)
[21:16:51] <nmatsakis> you can resize the array,
[21:16:52] <nmatsakis> for one thing.
[21:17:12] <graydon> but if all the & pointees are allocated from an arena, say ..
[21:17:24] <nmatsakis> sure, that'd be an option too
[21:17:27] <graydon> I'm just curious because this is the sort of use-case people yelled at me about until I added cyclic @
[21:17:40] <graydon> and then & was going to handle those cases more efficiently when they were owned as a group
[21:17:45] <graydon> (via arenas)
[21:17:49] <graydon> you think it'd work here?
[21:17:52] *** Joins: relistan (relistan@moz-2DE8112B.cable.virginmedia.com)
[21:17:53] <nmatsakis> well,
[21:17:54] *** Joins: reyre_ (reyre@moz-9002CDDA.cpe.net.cable.rogers.com)
[21:18:01] <nmatsakis> I'd still prefer the current design because of  mutability
[21:18:05] <graydon> I realize it's probably harder to debug (and map to bitset indices and possibly other things)
[21:18:14] <graydon> yeah, ok
[21:18:21] <nmatsakis> I guess if we used Cell 
[21:18:28] <pnathan1> Unexciting newbie question: anyone have an example of reading a utf8-encoded file into a str? (a typical "slurp" routine)
[21:18:33] <nmatsakis> it's actually a nice use case for moving  the write guard stuff into Cell...
[21:18:55] <nmatsakis> graydon: that way you could allocate &Cell<Node> or whatever from the arena,
[21:19:01] *** Quits: reyre (reyre@moz-9002CDDA.cpe.net.cable.rogers.com) (Ping timeout)
[21:19:01] *** Quits: krdln (Mibbit@moz-6F8A8560.dynamic.chello.pl) (Quit: http://www.mibbit.com ajax IRC Client)
[21:19:32] <nmatsakis> graydon: since if you chose &T, you get full immutability, too strong if we are mutating nodes to build graph,
[21:19:36] *** Joins: ecr (Thunderbir@moz-BBE3ABD.mv.mozilla.com)
[21:19:37] <nmatsakis> graydon: but &mut T is unaliasable.
[21:19:43] <graydon> mhm
[21:19:50] *** Quits: FrozenCow (FrozenCow@moz-B2DF4929.chello.nl) (Quit: Leaving)
[21:20:01] <nmatsakis> given that nodes never go out of scope, I thought indices into an array was a great fit,
[21:20:01] <bblum> brson: can we rename UnsafeAtomicRcBox to UnsafeARC
[21:20:10] <nmatsakis> graydon: since it lets you freeze the graph all at once and so forth
[21:20:14] <mcpherrin> pnathan1: I was going to link you to http://mcpherrin.ca/tmp/UVj but I haven't used it in a while (not since before 0.7) so who knows if it still works ;)
[21:21:00] <graydon> yeah, ok
[21:21:15] <tikue> sully: fn map<T>(it: Iterable<T>, f: &fn(t: T)) -> Iterable<T>
[21:21:52] <brson> bblum: UnsafeArc, sure, but not ARC. ARC is the odd one out here and needs to be renamed to Arc
[21:22:05] <brson> cmr: the ParsSess and the Session need to contain the same CodeMap
[21:22:18] <tikue> sully: fn map<T>(it: Iterable<T>, f: &fn(t: T) -> U) -> Iterable<U>
[21:22:22] <brson> cmr: your new_parse_sess creats one, and build_session creates another
[21:22:32] <bblum> brson: yeah, that works for me
[21:22:37] <bblum> i'm just sick of typing UnsafeAtomicRcbox
[21:22:45] *** Joins: vilonis (jared@moz-EE5D17ED.ph.ph.cox.net)
[21:22:50] <jclements> cmr: brson: nurrggh! This duplication is a bad idea. I tried to get rid of it at one point and failed.  I think that TLS has some big advantages here.
[21:22:51] <bblum> I always miss hitting the shift key on one of the middle letters, as exhibited above,
[21:22:56] <bblum> and have to go back and type it again
[21:22:56] <brson> bblum: there's an issue open on renaming it to UnsafeAtomicRc, but UnsafeArc is fine too
[21:23:32] *** Quits: huseby (huseby@moz-4E8C421A.husebyhome.com) (Quit: Leaving)
[21:24:07] <pnathan1> mcpherrin: After adding use std::{io, result, path}; at the top, it works,  For some reason I confused myself and thought I had to do an allocation of the length of the file to read the whole thing
[21:25:22] <thiez> when we get the rust GC, would there be a way for a task to disable it temporarily (for itself)?
[21:25:57] <steven_is_false> So I'm trying to use gdb to debug the test file for libextra (rustc -Z debug-info --test extra.rs; gdb ./extra) but now I'm getting assertions. Can anyone explain this?
[21:26:12] *** Joins: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP)
[21:26:13] <nmatsakis> thiez: don't allocate any managed boxes.
[21:26:22] <nmatsakis> thiez: since I think we will only ever trigger the GC on allocation.
[21:26:40] <nmatsakis> though maybe we don't want to make that guarantee, I don't know :)
[21:26:40] *** Joins: huseby (huseby@moz-4E8C421A.husebyhome.com)
[21:26:48] <thiez> okay, thanks :)
[21:27:22] *** Joins: Earnestly (earnest@2AB30F53.FB5005.2BCC804A.IP)
[21:28:10] *** Quits: adu (ajr@moz-68CC2A5E.washdc.fios.verizon.net) (Quit: adu)
[21:28:11] *** Quits: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP) (Ping timeout)
[21:28:46] *** Joins: jorendorff (jorendorff@moz-B860E258.hsd1.tn.comcast.net)
[21:29:38] <thiez> I was thinking, about the whole stack switching challenge, would it be possible for a task to detect that it's thrashing on a stack boundary (e.g. by counting how often it had to allocate a new stack segment from that particular segment) and allocate a larger segment (say twice as large) and copy the entire contents of the current segment into that new segment?
[21:30:11] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[21:30:17] <thiez> if you don't trigger the GC it might not notice :D
[21:30:21] <nmatsakis> thiez: I was thinking similar things
[21:30:27] *** Quits: z0w0 (zack@moz-37A98529.lnse2.woo.bigpond.net.au) (Ping timeout)
[21:30:59] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[21:31:06] <nmatsakis> the other thing that capriccio did was to statically analyze the call graph to the extent possible and try to pick sizes that accounted not only for the fn itself but for its likely callees, but this is tricky with native fns
[21:31:44] <thiez> one could use both at the same time
[21:31:57] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[21:32:08] <nmatsakis> certainly
[21:32:12] <thiez> such static analysis may well avoid the majority of stack thrashing
[21:32:40] <nmatsakis> (they also removed stack checks altogether for callees that are guaranteed to be safe due to their caller)
[21:32:44] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[21:33:03] <pcwalton> you can't copy stacks in rust
[21:33:06] <pcwalton> due to interior pointers
[21:33:49] <thiez> ah, that makes sense
[21:34:38] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[21:34:38] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/0V8SpQ
[21:34:38] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[21:34:38] *** Joins: jdm (jdm@CC0122E6.8F96AEA7.2D179A7D.IP)
[21:34:42] <thiez> I don't suppose you can copy the stack, then free the original, then request a larger one at the exact same place in memory and copy the contents back?
[21:35:03] <thiez> like a guaranteed-to-work realloc...
[21:35:24] <steven_is_false> To update all the files in an SVN repo I use svn up right?
[21:35:29] <sully> https://github.com/mozilla/rust/issues/7675 sigh.
[21:35:45] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[21:36:00] *** Quits: webber46 (webber46@moz-98D2F3C5.cust.bredband2.com) (Quit: webber46)
[21:36:47] <strcat> thiez: no you can't move data
[21:37:02] *** Quits: relistan (relistan@moz-2DE8112B.cable.virginmedia.com) (Quit: relistan)
[21:37:03] * strcat shrugs
[21:37:09] <strcat> you aren't guaranteed to get space there
[21:37:31] <strcat> and you only have 4GiB of address space on 32-bit so you can't really leave space for yourself
[21:37:41] *** Joins: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP)
[21:37:41] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/7yqXhQ
[21:37:41] *** Parts: ghrust (ghrust@C8693FCB.6A2AE50.F3114085.IP) ()
[21:37:43] *** Joins: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP)
[21:37:43] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/EktdNw
[21:37:43] <ghrust> 13rust/06auto 144412df2 15Niko Matsakis: Add an identifier to TypeParameterDefs and use it to pretty print type parameters
[21:37:43] <ghrust> 13rust/06auto 14e7040e8 15bors: auto merge of #7698 : nikomatsakis/rust/issue-2951-type-parameter-names, r=cmr...
[21:37:44] *** Parts: ghrust (ghrust@AD60B2E3.6A2AE50.F3114085.IP) ()
[21:37:54] <thiez> strcat: I think it could be done by the OS with magic and pages, but that would defeat the purpose of using small stack segments in the first place :p
[21:38:28] <strcat> thiez: well the OS already manages to split contiguous virtual memory
[21:38:38] <strcat> and the OS will lazily allocate your pages
[21:39:02] * brendanc still thinks the mremap trick might be useful
[21:39:12] *** Joins: heftig (heftig@moz-28BD63AF.dip0.t-ipconnect.de)
[21:39:20] *** Quits: heftig (heftig@moz-28BD63AF.dip0.t-ipconnect.de) (Quit: Quitting)
[21:39:27] <strcat> brendanc: on 64-bit maybe ;p
[21:39:36] <kmc> strcat: only 3GB on most OSes
[21:39:43] <brendanc> on 32 :) the whole point is not to burn address space
[21:39:44] <thiez> on 64-bit we don't need the segmented stacks :p
[21:39:58] <strcat> brendanc: but your gaps are burned address space
[21:40:05] <strcat> unless you can still use them
[21:40:13] <brendanc> you can, that's the idea
[21:40:23] <strcat> but you don't know which stacks are going to need to grow
[21:40:36] <pcwalton> off topic: anyone want to port rust to the arduino? ;)
[21:40:40] <pcwalton> there is an LLVM backend
[21:40:43] <brendanc> no. but if there happens to be remove below your current stack you can grow it cheaply
[21:40:44] <pcwalton> that was our lunchtime discussion topic
[21:40:47] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[21:40:54] <pcwalton> it should work with zero.rs
[21:41:05] <strcat> brendanc: yeah, it might be cheaper in some cases
[21:41:06] <brendanc> it seems cheaper than the current approach, and degrades to it when it has to
[21:41:07] <strcat> but not predictably
[21:41:23] <thiez> pcwalton: would be fun, but I haven't even managed to get it to crosscompile for ARM yet
[21:41:24] <strcat> we have >100% perf hit in some cases, so that needs to be fixed on x86 too
[21:41:25] <kmc> is it easy to build a cross-compiling rustc today?
[21:41:26] <brendanc> yes, not predictably, but no worse than current and often better
[21:41:31] <cmr> kmc: yup!
[21:41:34] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[21:41:37] <strcat> segmented stacks can't really be the default if they cause a hit that bad
[21:41:57] <strcat> in many cases, it's not like it's rare
[21:42:00] <brendanc> don't disagree. but, if for some reason you wanted them, it's a way to make them less painful
[21:42:22] <thiez> btw, who is 'D' in the rust meeting logs?
[21:42:26] <pcwalton> dherman
[21:42:29] <strcat> brendanc: well I think if you know you want them, you're willing to pay a high perf cost for small space usage
[21:42:44] <brendanc> but wouldn't it be nice if it were cheaper?
[21:42:44] <strcat> or you know an approximate initial guess
[21:42:48] <strcat> brendanc: sure ;]
[21:42:49] *** Quits: echristo (echristo@D423593A.D6CCE4AE.77834EAA.IP) (Quit: echristo)
[21:43:14] <thiez> ah, dherman's not very chatty on irc :)
[21:43:27] <cmr> dherman: hear that? love us more!
[21:43:48] *** Joins: Boreeas (Boreeas@moz-F35C832D.boreeas.net)
[21:43:56] <pcwalton> he's very busy, mostly in JS stuff (he's on the ecmascript committee), but was involved very early in rust's design
[21:44:03] <pcwalton> earlier than I was by about a week
[21:44:03] <thiez> especially cmr, he needs more vowels.
[21:44:20] *** Quits: vilonis (jared@moz-EE5D17ED.ph.ph.cox.net) (Ping timeout)
[21:44:25] <thiez> ah, cool :)
[21:45:06] *** Joins: azita (Azita@moz-BBE3ABD.mv.mozilla.com)
[21:45:40] <cmr> I have all the vowels I need
[21:46:14] *** Quits: Sergio965 (sergiobz@moz-BB21156B.dynamic.csail.mit.edu) (Ping timeout)
[21:47:23] <brendanc> graydon: any opinion on this mremap idea for segmented stacks? in a nutshell, grab new stacks far apart from each other in stack address space, then when they need to grow, attempt to mremap them in place, falling back to the current scheme if mremap fails
[21:49:00] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[21:49:24] <graydon> brendanc: I don't understand
[21:49:39] *** Joins: heftig (heftig@moz-6010B075.dip0.t-ipconnect.de)
[21:49:41] <graydon> brendanc: what if the heap has a pointer into the stack?
[21:49:52] <graydon> (this is permitted in rust, weirdly)
[21:50:01] <brendanc> there's no moving
[21:50:05] *** Joins: donri (dag@moz-9BB61102.tbcn.telia.com)
[21:50:12] <graydon> mremap does what?
[21:50:37] <brendanc> maps in more space
[21:50:50] <brendanc> it doesn't move the base address unless you pass an extra flag
[21:50:57] <brendanc> just fails if the extra space isn't available
[21:51:20] <steven_is_false> brendanc: So it's like realloc but doesn't move?
[21:51:29] <brendanc> yes
[21:51:31] <strcat> you can ask it to move
[21:51:32] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[21:51:36] <strcat> if necessary
[21:51:42] <brendanc> you could ask it to, but that wouldn't work for rust
[21:51:47] <strcat> yeah
[21:52:07] <brendanc> however, if the adjacent space were free, it'd be close to as cheap is if you'd allocated a bigger stack in the first place
[21:52:18] <graydon> isn't this the same as lazy commit?
[21:52:25] *** Quits: vosen_ (vosen@moz-3B059DC4.sta.asta-net.com.pl) (Quit: Leaving)
[21:52:32] <brendanc> no, because the adjacent pages are available for other stacks until you try to mremap
[21:52:35] <cmr> graydon: the address space isn't actually used though
[21:52:37] <cmr> right
[21:52:51] <graydon> no, I don't get it at all
[21:53:04] <graydon> you put stack A at one point, stack B at another
[21:53:15] <graydon> you have to decide how far apart in address space you put them
[21:53:27] <graydon> if you put them 2mb apart, you don't go putting a stack C 1mb between them
[21:53:36] <cmr> Yes, but with overcommit you can't alloc the space in between, with mremap you can
[21:53:38] <graydon> that's violating the assumption, the whole point of making them far apart in the first palce
[21:53:53] <graydon> can't alloc in what sense?
[21:53:53] <jclements> clean build with hygiene for let-bound idents. yahoo!
[21:53:55] <brendanc> you make them far apart so that the odds of mremap succeeding are high
[21:54:06] <brendanc> but if there's something in between, mremap fails and you fall back to linking
[21:54:07] <graydon> jclements: !!!!!
[21:54:11] <graydon> ship it
[21:54:27] <jclements> There's this one *TEENY TINY* performance problem :).
[21:54:27] *** Quits: mzabaluev (mzabaluev@moz-91FFD755.dhcp.inet.fi) (Quit: Ð£Ñ…Ð¾Ð¶Ñƒ Ñ Ð¾Ñ‚ Ð²Ð°Ñ)
[21:54:29] *** Joins: jgilbert (jgilbert@moz-BBE3ABD.mv.mozilla.com)
[21:54:33] <cmr> as in, it's marked-as-used, mmap won't give you those pages
[21:54:36] <brendanc> so when you run out of room to put them 2mb apart, you jump in between
[21:54:57] <jclements> graydon: by which I mean: must be fixed before shipping. Hope it's something simple.
[21:54:57] <dherman> cmr: I couldn't love you more. you all have my <3 ;-)
[21:54:58] <brendanc> then the stack above has to link when it gets to 1mb, but that's not nearly as terrible as now
[21:55:05] *** Quits: jorendorff (jorendorff@moz-B860E258.hsd1.tn.comcast.net) (Quit: jorendorff)
[21:55:10] <graydon> ok wait, um
[21:55:20] <graydon> you're talking about _keeping_ the morestack / linking thing
[21:55:28] <brendanc> yes, but as a fallback
[21:55:37] <graydon> just as a fallback for "before we run into another stack"
[21:55:38] <brendanc> usually (hopefully) not triggered
[21:55:40] <brendanc> right
[21:55:46] <graydon> I see
[21:56:01] <cmr> but without wasting the address space if the stack never expands
[21:56:35] <graydon> aren't these pages the same ones malloc is picking up?
[21:56:47] <graydon> seems likely malloc will grab something in front of a stack pretty often
[21:56:54] <strcat> if we have large initial segment sizes as the default on all platforms, it won't matter if segmented stacks are a bit perf hit
[21:57:01] <strcat> since you'd only use them with I/O
[21:57:27] <brendanc> heap grows up, stack grows down? but I'm a bit handwavy on this part
[21:57:32] <graydon> otherwise it certainly seems plausible
[21:57:37] <thiez> brendanc: not when you malloc it :p
[21:57:49] <strcat> stack grows down but it might not start at the end of the address space
[21:57:53] <strcat> I don't know
[21:57:59] <pnathan1> Whatever happened to the split_str function? I can't find it anymore. :-/
[21:58:01] <doomlord> i wondered if there were cases when any overhead for stack growing could be avoided in a similar way to the concept of leaf functions on mips with thier cheaper (no) stack use
[21:58:06] <strcat> pnathan1: not functions anymore
[21:58:07] <thiez> I imagine it will be in the same place in the heap where the rest of your mallocs are taking place.
[21:58:08] <strcat> they're methods
[21:58:37] <brendanc> I was thinking morestack wouldn't malloc
[21:58:42] <graydon> I don't know. I feel like we've got bigger fish to fry, perf-wise. I'd be fine turning it to big-stacks-by-default for now and providing library calls for small-stack tasks or whatever.
[21:58:46] <brendanc> you'd deliberately mmap
[21:58:57] <strcat> rusti: let xs = "foo bar baz"; let tokens: ~[&str] = xs.split_iter(' ').collect(); fmt!("%?", tokens)
[21:58:59] -rusti- ~"~[\"foo\", \"bar\", \"baz\"]"
[21:59:01] <brendanc> oh sure. it's orthogonal to that contenious stuff
[21:59:04] <brendanc> contentious
[21:59:06] <strcat> rusti: let xs = "foo bar baz"; let tokens: ~[&str] = xs.split_iter(' ').collect(); print(fmt!("%?", tokens))
[21:59:07] -rusti- ~["foo", "bar", "baz"]()
[21:59:10] <strcat> heh
[21:59:17] *** Joins: mschifer1 (Adium@moz-BBE3ABD.mv.mozilla.com)
[21:59:20] <graydon> I mean, it's a neat technique but I don't even know why it's contentious. just defaults, knob-settings.
[21:59:26] *** Quits: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com) (Connection reset by peer)
[21:59:34] *** Quits: mschifer1 (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[21:59:35] <cmr> pcwalton: brson was right, they needed to share a codemap, but now I get https://gist.github.com/cmr/7b8b2ee8d9b9375a9cdf, which isn't... exactly enlightening
[21:59:38] <strcat> rusti: let xs = "foo bar baz foobar"; let tokens: ~[&str] = xs.split_iter(' ').skip(2).collect();
[21:59:38] -rusti- <anon>:7:44: 7:50 warning: unused variable: `tokens` [-W unused-variable (default)]
[21:59:39] -rusti- <anon>:7          let xs = "foo bar baz foobar"; let tokens: ~[&str] = xs.split_iter(' ').skip(2).collect();
[21:59:39] -rusti-                                                      ^~~~~~
[21:59:39] -rusti- ()
[21:59:39] *** Joins: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com)
[21:59:45] <graydon> try one way, try another. surely some scenarios will want a mixture of both.
[21:59:47] <cmr> In what cases would the prelude fail to resolve "\
[21:59:55] <strcat> rusti: let xs = "foo bar baz foobar"; let tokens: ~[&str] = xs.split_iter(' ').skip(2).collect(); println(fmt!("%?", tokens))
[21:59:56] -rusti- ~["baz", "foobar"]
[21:59:57] -rusti- ()
[22:00:02] <pnathan1> strcat: oy, that's not simpler.  Thanks for the info. Wasn't piecing things together in my head on how to use split_iter
[22:00:15] <strcat> pnathan1: well split_iter splits lazily
[22:00:18] <strcat> it doesn't allocate
[22:00:37] <strcat> for s.split_iter(' ') |token| { } will work when the new for loop lands
[22:00:54] *** Joins: olleharstedt (Thunderbir@moz-80D8890F.ias.bredband.telia.com)
[22:00:59] <strcat> for now you'd need a .advance at the end
[22:02:22] *** Joins: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP)
[22:02:37] <Eridius> rusti: let xs = "foo bar baz foobar"; xs.split_iter(' ').skip(2).transform(|x|x.to_owned()).collect::<~[~str]>()
[22:02:37] -rusti- ~[~"baz", ~"foobar"]
[22:04:39] <pnathan1> Hum. I still stand by my comment about split_str(src, split_char) being simpler (though more allocatory)
[22:04:49] *** Quits: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP) (Ping timeout)
[22:04:58] <strcat> simpler for a specific use case
[22:05:18] <strcat> and it seems odd to need to copy out tokens from a str
[22:05:23] <strcat> why not use slices?
[22:05:40] <strcat> if you do need to copy them out, you might want them as either ~str or @str or @mut str
[22:05:49] <strcat> or another string type (small string, rope)
[22:06:56] *** Quits: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com) (Quit: eatkinson)
[22:08:22] *** Joins: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP)
[22:09:52] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Computer has gone to sleep.)
[22:10:19] <pnathan1> strcat: I have a string, it needs splitting for importation from a file. I'm going to be reading a data file; the strings are all going to go out of scope shortly after being read anyway. They could all be GC'd for all I care; the interesting things are going to happen elsewhere.
[22:10:35] <strcat> so why not use slices?
[22:10:52] <strcat> they don't have to be ~str
[22:11:09] <strcat> for foo.split_iter(' ')  { }
[22:11:14] <strcat> except with .advance atm
[22:11:19] <pnathan1> when you say "slices", I think "fixed width window into a string", ala Python's slices.
[22:11:24] <pnathan1> Am I thinking correctly?
[22:11:27] <strcat> yes
[22:11:34] <strcat> that's what split_iter yields
[22:12:03] <pnathan1> I just wanted to check: that's not what I'm looking for.   The data rows are variable width. (To be precise, it's a carefully controlled CSV file).
[22:12:13] <jclements> sully: tried to use find_or_insert_with on the memoization of a recursive function, but this doesn't work, right?
[22:12:19] <strcat> pnathan1: it's fine if they're variable width
[22:12:34] <strcat> slices are just views (mutable or immutable) into a string
[22:12:35] <jclements> sully: that question is kind of a trap, sorry.
[22:12:36] <strcat> they aren't a copy
[22:12:41] <pnathan1> my head now hurts. I thought they were fixed width windows. 
[22:12:45] <thiez> the width of any particular slice is fixed
[22:12:47] <strcat> they are fixed-width
[22:13:05] <thiez> but the widths of two different slices need not be the same
[22:13:16] <sully> jclements: I'm not sure.
[22:13:23] <pnathan1> gotcha
[22:13:27] <jclements> sully: kthx
[22:13:41] <strcat> making ~str is a slow heap allocation so the algorithms yield &str views now
[22:15:25] *** Joins: jorendorff (jorendorff@moz-B860E258.hsd1.tn.comcast.net)
[22:16:26] *** Quits: kemurphy (kemurphy@moz-7332FD74.hsd1.pa.comcast.net) (Ping timeout)
[22:16:41] *** Quits: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP) (Ping timeout)
[22:17:01] *** Joins: kemurphy (kemurphy@moz-7332FD74.hsd1.pa.comcast.net)
[22:19:10] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[22:20:45] <jdm> when I have an ident in a macro, do I need to do anything special to concatenate a prefix to it?
[22:20:51] <jdm> ie some::path::$ident
[22:21:31] <jdm> some with appending a suffix to it
[22:22:12] *** Joins: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net)
[22:23:16] *** Quits: Blub\w (wry@7E3BB9D.71150E1A.237AE2BA.IP) (Quit: night)
[22:23:17] <bjz_> on a related note, type parameter lists are really difficult
[22:23:54] <bjz_> would be nice to have a macro AST thingy for it
[22:24:03] <bjz_> jdm: for paths no
[22:24:06] *** Quits: devinus (devinus@moz-B4AF84BC.ptr.us.xo.net) (Quit: Textual IRC Client: www.textualapp.com)
[22:24:12] <strcat> Eridius: we could have a bunch of in-place algorithms though
[22:24:21] <bjz_> jdm: for idents, you need concat_idents!
[22:24:22] <strcat> just doesn't seem very useful for a forward iterator
[22:24:27] <strcat> not much you can do
[22:24:34] <bjz_> jdm: but that's probably still broken
[22:24:35] *** reyre_ is now known as reyre
[22:24:38] <tikue> does anyone else dislike using for syntax with option?
[22:24:43] <jdm> bjz_: what about appending a suffix to $ident?
[22:24:56] <tikue> for the case of "do something with some or nothing with none"
[22:25:34] <strcat> tikue: they're only really an Iterable implementation for composability with other iterators
[22:25:37] <bjz_> jdm: you need concat idents, which is broken :(
[22:25:42] <jdm> ;_;
[22:25:43] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[22:25:43] <strcat> well, only will be an Iterable implementation* ;p
[22:25:43] *** ChanServ sets mode: +o brson
[22:25:47] *** Quits: kemurphy (kemurphy@moz-7332FD74.hsd1.pa.comcast.net) (Ping timeout)
[22:25:52] <strcat> they have an iterator already though
[22:25:55] <bjz_> tikue: you can use map and chain
[22:26:06] <tikue> bjz_: map returns a value though
[22:26:25] <bjz_> tikue: do opt.map |_| {...};
[22:26:35] <bjz_> tikue: end with a `;`
[22:26:38] *** Joins: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP)
[22:27:14] <tikue> bjz_: I know, but I don't like it :\ it seems like there should be method that's functionally equivalent to for
[22:27:15] <strcat> rusti: let x = Some(5); let ys = [1, 2, 3]; let z = None; x.iter().chain_(ys.iter()).chain_(z.iter()).fold(0, |a, &b| a + b);
[22:27:17] -rusti- more than 5 lines of output, pastebinned: http://sprunge.us/IdOP
[22:27:20] <jack> doesn't it still allocate a return value though?
[22:27:34] <tikue> jack: that could be optimized away, but it's still ugly imo
[22:27:36] <strcat> type inference is not very good atm
[22:27:47] <bjz_> jack: would just be a ()
[22:28:10] <bjz_> tikue: I agree it's somewhat of a wart
[22:28:19] <tikue> bjz_: how about, do option.call_me_maybe | maybe | { wee };
[22:28:26] <bjz_> x)
[22:28:30] <bjz_> perfect name
[22:28:37] <strcat> tikue: 'for opt |x| { }' doesn't seem that bad
[22:28:39] <tikue> do option.call_me_maybe | here_my_number | { }
[22:29:14] <bjz_> strcat: yeah, that's not too bad
[22:29:32] *** Joins: kemurphy (kemurphy@moz-7332FD74.hsd1.pa.comcast.net)
[22:29:45] <tikue> strcat: I agree, I think it's the best option currently, and it's what I use. But it would be nice if there were something a bit more idiomatic. for syntax witho ptions seems at the very least hard to understand if you haven't seen it before
[22:29:48] <bjz_> strcat: but it's weird, because you associate different semantics wih for than with do
[22:29:52] <strcat> tikue: well it's uglier atm
[22:30:01] <strcat> bjz_: Option is a container of 0 or 1 element
[22:30:17] <strcat> it's the semantics I associate with option types in C-like languages
[22:30:23] <tikue> strcat: hmm, good point. if it were "for some in Option: { do something with some} " that'd be great
[22:30:27] <strcat> there aren't functors or monads so the common thing they fall under is a container
[22:30:49] <strcat> container/iterable
[22:30:50] *** Quits: LimeBurst (me@247D1419.D73964AC.27A8748.IP) (Ping timeout)
[22:31:05] *** Joins: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de)
[22:31:28] <strcat> tikue: it could be that, with a new for loop
[22:31:28] *** Joins: eatkinson (eatkinson@moz-BBE3ABD.mv.mozilla.com)
[22:31:39] <strcat> for pattern in iterable { }
[22:31:59] <tikue> strcat: I'd loveee that personally
[22:32:01] <strcat> so if you had... Option<(a, b)> and you wanted a
[22:32:07] <strcat> for (a, _) in opt { }
[22:32:32] <strcat> although at first you'd need .iter() until we work out Iterable
[22:32:54] <tikue> strcat: does * work with tuples? let (*, last) = (long, list, of, things, and, only, care, about, THIS);
[22:33:05] <strcat> tikue: it could
[22:33:07] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[22:33:16] <strcat> I have a bug open about */_ being terribly inconsistent
[22:33:28] <tikue> ah ok
[22:33:38] * strcat doesn't think it works
[22:33:45] <strcat> don't really remember where it works and where it doesn't...
[22:33:52] <jensnockert> rusti: let (*, last) = (long, list, of, things, and, only, care, about, THIS); last
[22:33:53] -rusti- <anon>:7:14: 7:15 error: unexpected token: `*`
[22:33:53] -rusti- <anon>:7          let (*, last) = (long, list, of, things, and, only, care, about, THIS); last
[22:33:53] -rusti-                        ^
[22:33:53] -rusti- application terminated with error code 101
[22:33:55] *** Quits: bent (chatzilla@F2D29657.F60B0462.67AC9B1.IP) (Ping timeout)
[22:34:02] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[22:34:05] <jensnockert> I think we can conclude that it does not work.
[22:34:34] <jensnockert> :(
[22:34:41] <strcat> rusti: struct Foo { x: int, y: int, z: int } let a = Foo { x : 1, y : 2, z: 3 }; let Foo { x, * } = a; x
[22:34:42] -rusti- <anon>:7:96: 7:97 error: expected ident, found `*`
[22:34:42] -rusti- <anon>:7          struct Foo { x: int, y: int, z: int } let a = Foo { x : 1, y : 2, z: 3 }; let Foo { x, * } = a; x
[22:34:42] -rusti-                                                                                                          ^
[22:34:42] -rusti- application terminated with error code 101
[22:34:49] <strcat> it works *somewhere*
[22:34:53] <strcat> tuple structs?
[22:35:02] <jensnockert> strcat: Destructuring enums?
[22:35:15] <brson> is it possible to r
[22:35:19] <brson> er...
[22:35:20] <strcat> enums essentially have unit structs, tuple structs and structs as variants
[22:35:30] <brson> is it possible to r- a pr after it's been r+'d?
[22:35:36] *** Quits: maxli (maxli@F2D29657.F60B0462.67AC9B1.IP) (Quit: Leaving.)
[22:35:38] <strcat> brson: you can delete the r+ comment
[22:35:45] <strcat> but if you didn't make the comment I don't think so
[22:35:50] <strcat> unless it's on your PR
[22:36:01] <strcat> bors will forget about it if you delete it
[22:36:13] <brson> cmr: can you address my comment here real quick https://github.com/mozilla/rust/pull/7687
[22:36:46] *** Quits: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP) (Quit: Leaving.)
[22:38:27] *** Quits: MrFahrenheit (RageOfThou@3FEF494C.29C984D5.783DEDCA.IP) (Ping timeout)
[22:40:17] *** Quits: vk (chatzilla@3E9D68F2.B1163E0C.2A6693DD.IP) (Ping timeout)
[22:43:24] *** Quits: jensnockert (jensnocker@moz-C5F27039.cust.bredband2.com) (Connection reset by peer)
[22:43:53] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[22:44:10] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[22:45:02] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[22:45:02] *** ChanServ sets mode: +o brson
[22:47:00] *** Quits: jorendorff (jorendorff@moz-B860E258.hsd1.tn.comcast.net) (Quit: jorendorff)
[22:49:28] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[22:49:50] *** Quits: steven_is_false (user@moz-144077DE.bchsia.telus.net) (Connection reset by peer)
[22:50:07] <xenocons> wait, do you need gcc libs installed for 0.7 to work?
[22:50:19] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[22:50:20] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[22:50:21] *** Joins: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP)
[22:50:27] *** Quits: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com) (Quit: tikue)
[22:50:34] *** Joins: tikue (tkuehn@moz-BBE3ABD.mv.mozilla.com)
[22:50:36] *** Joins: XgF (quassel@moz-58044BA0.ldn1.uk.e43.eu)
[22:51:33] <xenocons> (tried install on a default windows install)
[22:52:48] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[22:53:29] <xenocons> ah right it does too
[22:53:40] <xenocons> (specified on the rust getting started page)
[22:53:41] *** Joins: Jesin (Jessin_@moz-1B1307FF.eecs.lehigh.edu)
[22:54:29] *** Joins: vk (vk@F92596F.2DEF7520.EF7679FA.IP)
[22:54:36] *** Joins: testjack (jack@moz-F1B36F9F.hsd1.nm.comcast.net)
[22:54:43] <pnathan1> Getting an issue: failed to find an implementation of trait std::iterator::Iterator<<V230>> for ~[~[&str]].   I'm calling result.skip(1) where result is ~[~[&str]].  I know some stuff isn't implemented yet with iterators - is this one?
[22:55:02] *** Quits: nattofriends (tsutsumi@moz-4CEEC7AA.warosu.org) (Quit: ã•ã‚ˆãªã‚‰)
[22:55:22] *** Parts: testjack (jack@moz-F1B36F9F.hsd1.nm.comcast.net) ()
[22:55:33] <engla> pnathan1: you need to call .iter() on result
[22:55:43] <engla> pnathan1: result.iter().skip(1)
[22:55:59] <pnathan1> OK
[22:56:12] <pnathan1> I presume iter transforms the vector into an iterable?
[22:56:50] <tikue> does anyone else like the for-else and while-else patterns? i.e. if a break doesn't occur in a while or for loop, then execute the else block
[22:56:50] *** Joins: nattofriends (tsutsumi@moz-4CEEC7AA.warosu.org)
[22:56:55] *** Joins: n00b6502 (kwr5y54@moz-13E69BC8.range86-180.btcentralplus.com)
[22:57:21] <tikue> (patterns the wrong word, I just mean that syntax)
[22:57:22] <engla> pnathan1: it constructs an iterator object
[22:57:32] <engla> or value implementing Iterator
[22:57:47] *** Joins: huhlig-home (huhlig@moz-C8339267.hfc.comcastbusiness.net)
[23:00:05] *** Quits: bytewise (bytewise@moz-649C630D.unitymediagroup.de) (Quit: Leaving)
[23:00:20] <MaikKlein> are Chans or SharedChans sendable?
[23:01:06] <tikue> yes
[23:01:30] <MaikKlein> nice thanks
[23:01:40] *** Joins: bytewise (bytewise@moz-649C630D.unitymediagroup.de)
[23:02:06] *** Joins: jorendorff (jorendorff@moz-30F4FB9E.hfc.comcastbusiness.net)
[23:02:16] <tikue> MaikKlein: they're both sendable :)
[23:04:53] *** Quits: ion (ion@heh.fi) (Ping timeout)
[23:05:42] <graydon> brson: ping
[23:07:02] <brson> graydon: pong
[23:07:15] <thiez> tikue: that seems silly, just put the else block under the break and you will get the exact same behaviour?
[23:07:42] <tikue> thiez: well this would be in the case that you wanted to execute a block exactly once after a loop finishes
[23:07:45] <graydon> brson: is one of the macs available for some quiet perf testing yet, or am I forgetting that you already told me you'd tell me when it's ready? :)
[23:07:55] <tikue> thiez: but only in the case that the block wasn't broken out of early
[23:08:22] <brson> graydon: if you want to use mac5 (10.250.5.63) that's fine. mac6 hasn't arrived yet
[23:08:30] <brson> tikue: what's the while-else pattern?
[23:08:39] <thiez> tikue: I doubt that happens very often, and you could have that behaviour by putting that block above the break, right?
[23:09:06] <tikue> thiez: I've used that pattern fairly frequently in languages that have it, and if you put the block above the break it'd execute in every loop no?
[23:09:42] <tikue> a concrete example from code I've written in servo:
[23:09:45] <thiez> tikue: I imagine you would break only on some condition, say: if (someCondition) break; in that case you could just do if (someCondition) {contents of else block; break; }
[23:09:48] *** Joins: ion (ion@heh.fi)
[23:09:54] <Eridius> tikue: if you remove the for sugar, you can actually get this functionality, because the internal iterator returns a bool indicating if it broke or not
[23:09:59] <tikue> thiez: yeah, but it's annoying to check every time
[23:10:19] <tikue> Eridius: for while loops too?
[23:10:47] <thiez> you have to check every time you might want to break anyway, right?
[23:10:53] <Eridius> tikue: I was talking just about `for`
[23:11:00] <tikue> brson: while something() { do stuff; if some_condition: break } else { do stuff if break never called }
[23:11:21] <thiez> oh, I have it the wrong way round in my head
[23:11:24] <Eridius> tikue: `else` seems like a really weird keyword there
[23:11:39] *** Joins: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP)
[23:11:45] <tikue> Eridius: it could be anything, I'm just interested in if there's interst for that pattern
[23:11:47] <Eridius> seems like it would be while something() { dostuff(); if foo { break } } andthen { doMoreStuff() }
[23:11:57] <tikue> Eridius:  that'd be nice
[23:12:01] <Eridius> but I'm not convinced it's common enough to be worth adding such an unusual language feature
[23:12:06] *** Joins: aatch (aatch@moz-B437F499.pocketrent.com)
[23:12:11] <tikue> Eridius: one sec I'll show you a concrete example
[23:12:18] <thiez> so 'let nobreak = true; while something() { do stuff, if some_condition: { nobreak = false; break } if nobreak { do stuff } ? :)
[23:12:33] <thiez> eh, there should be one more } in that line
[23:12:40] <thiez> before the 'if nobreak'
[23:12:58] <Eridius> clearly we just need goto
[23:13:12] <XgF> I've seen languages with while {} else {}, but in those cases the else case was for when the while condition *never* passed
[23:13:12] <XgF> I've seen languages with while {} else {}, but in those cases the else case was for when the while condition *never* passed
[23:13:24] <Eridius> while something() { doStuff(); if some_condition { goto later } } doMoreStuff(); later: ..
[23:13:24] <tikue> XgF: yes, if it never broke
[23:13:30] <tikue> XgF: oh nvm, I see what you mean
[23:13:37] <tikue> for those interested in this: https://gist.github.com/tkuehn/9978e5e20f73df7334a5
[23:13:40] *** Joins: erickt (erickt@8C9ECD8F.3A598286.F12515B4.IP)
[23:13:44] <tikue> only one example that comes to mind
[23:15:10] <Eridius> I dunno. having this sort of syntax puts an artificial divide between the while condition and break
[23:15:22] <Eridius> when today the while condition is equivalent to just putting the test at the top of the loop
[23:15:24] <tikue> Eridius: I'm not sure I follow
[23:15:35] <Eridius> while doSomething() { ... } <=> loop { if !doSomething() { break } ... }
[23:15:37] <tikue> Eridius: oh. yes. break would be syntactically different
[23:15:41] <Eridius> but this proposed `else` would change that
[23:15:44] <tikue> true
[23:16:00] <tikue> what benefit is gained from having those be functionally equivalent?
[23:16:14] <Eridius> semantic simplicity?
[23:17:08] <tikue> Eridius: I, for one, would welcome this change at the minor expense of the semantic simplicity :)
[23:17:27] <tikue> anyway, I was just curious if anyone else would find this useful
[23:17:53] *** Quits: pyrac (pyrac@moz-8862B13A.w92-162.abo.wanadoo.fr) (Quit: pyrac)
[23:19:54] *** Joins: mrbill (Mibbit@moz-91B5094F.hsd1.wa.comcast.net)
[23:21:03] *** Quits: doomlord (doomlod@moz-13E69BC8.range86-180.btcentralplus.com) (Ping timeout)
[23:21:12] <mrbill> greetings
[23:21:22] <tikue> hi mrbill 
[23:23:09] <mrbill> I wanted to offer my completely unsolicited thoughts on segmented stacks
[23:23:34] <thiez> tikue: perhaps it could be made into a macro? whileElse!(condition,whileBody,elseBody) ?
[23:23:53] <thiez> I can't do macros but there are some people around who do magic with that stuff
[23:24:07] *** Quits: SimonSapin (simon@88F51059.F3BBB17D.144F44FA.IP) (Ping timeout)
[23:25:11] <tikue> thiez: interesting idea. there's got to be a way to do that, but like you, I don't have the macro touch
[23:25:55] <Eridius> I don't think a macro can rewrite break
[23:26:29] <mrbill> Even on 64-bit systems with gobs of memory, it's not unusual to see memory overcommit turned off in order to get deterministic failure in OOM scenarios.
[23:26:52] <kmc> i do it
[23:26:57] <kmc> but then a bunch of stuff breaks (e.g. any Java program)
[23:26:57] <strcat> mrbill: they aren't deterministic
[23:27:00] <strcat> mrbill: that's not true.
[23:27:08] *** Quits: jclements (jclements@2557E599.66715431.D25A875A.IP) (Quit: jclements)
[23:27:11] <strcat> mrbill: multi-tasking OS makes non-overcommit pretty pointless
[23:27:24] <mrbill> Well, deterministic isn't quite the right word.
[23:27:24] <kmc> with copy-on-write fork, you need to be *really* conservative to avoid overcommitting
[23:27:30] <jensnockert> ^
[23:27:32] <thiez> Eridius: it doesn't need to, it could just rewrite to while condition {} if !condition {}
[23:27:53] <Eridius> thiez: that wouldn't work right in all cases
[23:27:56] <kmc> (and other COW mappings, e.g. your exe and all shared libraries)
[23:28:04] <Eridius> let mut i = 0; while i != 1 { i += 1; break; }
[23:28:11] <Eridius> oops now the macro would think it didn't break but it did
[23:28:21] <strcat> mrbill: if random process suddenly eats the remaining 4GiB of memory and your mission critical one asks for 8 bytes more, that will fail without overcommit
[23:28:35] *** Quits: jdm (jdm@CC0122E6.8F96AEA7.2D179A7D.IP) (Ping timeout)
[23:28:41] <Eridius> actually since you're relying on the macro to build the while body, you could insert a `nonbreak = false` at the beginning and `nonbreak = true` at the end
[23:28:48] <strcat> truly reliable software does allocations in advance and places upper bounds on allocation
[23:28:54] <strcat> but you can also partition the memory by cgroup
[23:28:58] <mrbill> Imagine a multi-threaded network server.
[23:29:25] <strcat> mrbill: so a user who is logged into the server accidentally consumes all the memory with a broken script
[23:29:31] <thiez> Eridius: yes, I was thinking the same thing :)
[23:29:32] <strcat> mrbill: your server starts dropping requests, or it exits
[23:29:43] <thiez> would be annoying if that name clashed though.
[23:29:45] <mrbill> If malloc() fails and you have to bail out of a thread, you might end up dropping a connection
[23:30:03] <strcat> mrbill: processes don't live alone
[23:30:10] <mrbill> Or returning an error to a request
[23:30:17] <Eridius> thiez: wtb hygenic macros pls
[23:30:20] *** Joins: steven_is_false (user@moz-144077DE.bchsia.telus.net)
[23:30:26] *** Quits: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[23:30:47] <jensnockert> mrbill: You cannot really do anything if malloc fails.
[23:30:48] <MaikKlein> how do I solve this?
[23:30:48] <MaikKlein> /home/maik/hello.rs:103:8: 103:9 error: cannot borrow immutable captured outer variable in a heap closure as mutable
[23:30:48] <MaikKlein> /home/maik/hello.rs:103         b.start();
[23:30:51] <mrbill> But the process can stay up.
[23:31:00] <strcat> mrbill: and block
[23:31:08] <Eridius> MaikKlein: sounds like the var isn't mutable
[23:31:14] <strcat> mrbill: and it can't do anything about it doesn't know about the system as a whole
[23:31:19] *** Joins: santiago (santiago@moz-F2B734D2.c3-0.sbo-ubr1.sbo.ma.cable.rcn.com)
[23:31:20] <jensnockert> mrbill: But what good is a process that cannot actually do anything?
[23:31:21] *** Joins: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com)
[23:31:22] <strcat> the only way to reasonably partition memory is to use cgroups
[23:31:29] <tikue> Eridius: they're being worked on right?
[23:31:42] <MaikKlein> Eridius, well doesn't this force mutability? let mut b = b;
[23:31:45] *** Joins: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP)
[23:31:45] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/EktdNw
[23:31:45] *** Parts: ghrust (ghrust@FD7BC443.6A2AE50.F3114085.IP) ()
[23:31:48] <strcat> mrbill: the process can choose to not allocate more than a certain about of VM
[23:31:58] <strcat> amount*
[23:32:05] <strcat> and you can enforce that on process groups
[23:32:09] <Eridius> MaikKlein: that makes the slot mutable. What is b?
[23:32:18] <thiez> Eridius: perhaps we should reimplement commonlisp poorly as our macro system
[23:32:19] <Eridius> tikue: no idea
[23:32:29] <aatch> thiez, we already are.
[23:32:29] <strcat> 3GiB cap for the web server, exclude sshd from the OOM killer
[23:32:33] <Eridius> let's make Template Rust
[23:32:37] <bblum> brson: ping
[23:32:40] <MaikKlein> Eridius, well "b" is a custom struct
[23:32:55] *** Quits: km (quassel@FDBAF0A0.DBF71E41.29C67456.IP) (Ping timeout)
[23:33:00] <strcat> the web server can spawn processes and they're accounted for in that 3GiB
[23:33:02] * strcat shrugs
[23:33:04] <Eridius> MaikKlein: where did you say this? If you said it inside the closure, then it's referencing a captured immutable outer variable
[23:33:16] <strcat> it's really more complex than just trying to do *something* if malloc fails
[23:33:24] <Eridius> `let mut b = b` only works if b is a stack or owned value
[23:33:28] <strcat> for reliability you need upper bounds on fragmentation and memory usage
[23:33:48] <MaikKlein> Eridius, ah yeah b is a stack value
[23:33:51] <Eridius> well I mean it'll always do something, but probably not what you wanted if b ends up being a mutable slot holding &T
[23:33:54] *** Quits: olleharstedt (Thunderbir@moz-80D8890F.ias.bredband.telia.com) (Ping timeout)
[23:33:55] <tikue> bblum: https://gist.github.com/tkuehn/9978e5e20f73df7334a5
[23:33:56] *** Joins: enix (enix@moz-A50569DD.c3-0.slvr-ubr1.lnh-slvr.md.cable.rcn.com)
[23:34:02] <Eridius> MaikKlein: closures can't move out of their environment
[23:34:07] <mrbill> If you allocate memory up front for a connection, for example, you may be able to continue servicing some requests on it, but new connections may fail.
[23:34:10] <Eridius> (a once function would be able to, if that ever gets implemented)
[23:34:33] *** Joins: Sorella (queen@78575561.924F2739.95C8B7C6.IP)
[23:34:47] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[23:34:47] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/x-2z-g
[23:34:47] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[23:34:48] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[23:34:48] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/8j7cDw
[23:34:48] <ghrust> 13rust/06auto 143ea3a56 15Tim Chevalier: rustpkg: Handle local git repositories...
[23:34:48] <ghrust> 13rust/06auto 1448d8bf3 15bors: auto merge of #7681 : catamorphism/rust/rustpkg-local-repos, r=graydon...
[23:34:48] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[23:34:48] <mrbill> If you overcommit on thread stacks and a page fault can't be serviced and your process is killed, you can't even manage to exit cleanly
[23:35:04] <mrbill> Much less recover when memory pressure goes down.
[23:35:07] <jensnockert> mrbill: Just do it erlang-style and let the OOM killer deal with it.
[23:35:15] <strcat> mrbill: memory pressure isn't going to go down
[23:35:19] <MaikKlein> I also get 2 errors and for me this is a contradiction, or am I wrong?
[23:35:20] <MaikKlein> /home/maik/hello.rs:103:8: 103:9 error: cannot borrow immutable captured outer variable in a heap closure as mutable
[23:35:20] <MaikKlein> /home/maik/hello.rs:103         b.start();
[23:35:20] <MaikKlein>                                 ^
[23:35:20] <MaikKlein> /home/maik/hello.rs:103:8: 103:9 error: mutable variables cannot be implicitly captured
[23:35:21] <MaikKlein> /home/maik/hello.rs:103         b.start();
[23:35:26] <strcat> mrbill: you have no control over the system as a whole
[23:35:33] <strcat> you have no control over other processes or other users
[23:35:38] *** Parts: BluePeppers (user@moz-3799699A.range81-151.btcentralplus.com) (ERC Version 5.3 (IRC client for Emacs))
[23:35:41] <aatch> MaikKlein, ouch. Is `b` owned
[23:35:50] <mrbill> Uh, yeah I do.
[23:35:55] <MaikKlein> aatch, it is on the stack
[23:36:02] <MaikKlein> how do I explicitly caputer mutable vars?
[23:36:06] <MaikKlein> capture*
[23:36:06] <strcat> mrbill: so no problem then, you won't run out of memory
[23:36:16] <strcat> mrbill: since you claim to have an upper bound per user/process already
[23:36:18] <strcat> so what's the issue:
[23:36:18] <Eridius> MaikKlein: make them mutable before you capture them?
[23:36:32] <Eridius> oh durr didn't see your new error sorry
[23:36:34] *** Joins: Kruppe (user@moz-E150F49F.cpe.net.cable.rogers.com)
[23:36:45] <aatch> MaikKlein, yeah, but is it an owned variable? as in, does it satify `Send`?
[23:36:46] <Eridius> MaikKlein: maybe borrow it into a &mut and capture that?
[23:37:00] <strcat> mrbill: enforce the limit per-user and per-service-cgroup
[23:37:01] <mrbill> If the upper bound is hit, the process should not crash.
[23:37:07] <aatch> Eridius, can't capture borrowed pointers
[23:37:09] <Eridius> bah
[23:37:25] <MaikKlein> aatch, ah no it doesn't satisfy send
[23:37:29] <aatch> Eridius, at least, not yet.
[23:37:33] <MaikKlein> Eridius, ok I try that
[23:37:35] *** Joins: dherman (dherman@moz-BBE3ABD.mv.mozilla.com)
[23:37:35] *** ChanServ sets mode: +o dherman
[23:37:39] <MaikKlein> oh
[23:37:41] <jensnockert> mrbill: But you cannot do much without memory, like doing syscalls.
[23:37:44] *** Joins: jclements (jclements@moz-BBE3ABD.mv.mozilla.com)
[23:37:52] <strcat> mrbill: the process already has to handle unclean exits, it has to use transactional db operations
[23:37:53] <jensnockert> mrbill: Or calling the C libraryâ€¦ orâ€¦
[23:38:12] <strcat> firefox cleanly handles an unclean shutdown or kill
[23:38:15] <strcat> it doesn't lose any data
[23:38:23] <strcat> it does everything in sqlite transactions
[23:38:25] <strcat> it's a non-issue
[23:38:33] <MaikKlein> aatch, well it might be owned, all types in the struct are sendable, so the struct itself should be too.
[23:38:35] <bblum> brson: two of the places in comm.rs where a task gets woken up use Local::borrow::<Scheduler> and sched.schedule_task(), but the third one uses sched.enqueue_task(); why is this?
[23:38:44] <steven_is_false> My refactoring of extra::arc, and extra::sync is almost done but I still need a bit of help, and so far I've had none. I'm almost considering submitting a pull request with things as they are in a broken state.
[23:38:46] <aatch> Eridius, right now, there is no way to specify a lifetime bound on a closure (or trait object)
[23:39:05] <aatch> (That's not quite true, you can specify 'static)
[23:39:20] <Eridius> aatch: ah
[23:39:50] <strcat> mrbill: if you have segmented stacks you can't handle OOM
[23:39:55] <strcat> mrbill: whether or not there is overcommit
[23:39:57] <mrbill> Look, I can tell you that many high-end NAS appliances run with memory overcommit turned off, and thus virtual memory is not free.  Will Rust be able to handle this scenario?
[23:40:04] <strcat> mrbill: not if it has segmented stacks
[23:40:06] *** Quits: barosl (barosl@E287D94F.C81E10FB.7544CABF.IP) (Quit: ëžœë¤ì€ ì‡ í‡´í–ˆìŠµë‹ˆë‹¤.)
[23:40:12] <strcat> mrbill: any function call can allocate if it does
[23:40:22] <brson> bblum: the enqueue_task call is from scheduler context, in a cleanup_job. calling schedule_task there and context switching back to the task causes infinite recursion because of all the little cleanup closures stacking up
[23:40:30] <brson> i'll be up in a sec
[23:40:35] <aatch> Eridius, eventually you'll be able to do `fn foo<'r>(a: &'r Foo) -> @fn:'r()`
[23:40:36] <mrbill> And potentially fail the current task, right?
[23:40:42] <strcat> mrbill: you can't unwind if you're OOM
[23:40:47] <bblum> brson: is there some reason the other sites can't use enqueue_task?
[23:40:49] <mrbill> That's different from the process just dying
[23:40:49] <strcat> destructors can and do use memory
[23:40:56] <strcat> mrbill: the process dies
[23:41:00] <strcat> mrbill: you can't end a task without memory
[23:41:09] <strcat> segmented stacks -> any call can allocate, no way to write code without allocations
[23:41:11] <aatch> mrbill, no, fails the process, since failing inside __morestack isn't recoverable.
[23:41:22] <mrbill> I saw talk about fixing that, though
[23:41:26] <strcat> you can't write a failure recovery path without allocations in rust with segmented stacks
[23:41:38] *** Quits: jclements (jclements@moz-BBE3ABD.mv.mozilla.com) (Quit: jclements)
[23:41:57] <strcat> mrbill: sure, removing segmented stacks and then applications not doing allocations in destructors can cleanly handle it
[23:42:04] <strcat> but fail!() allocates
[23:42:08] <strcat> so you can't fail
[23:42:17] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[23:42:22] <strcat> print allocates
[23:42:25] <strcat> fmt! allocates
[23:42:29] <strcat> can't use any of that in your failure path
[23:42:35] <jensnockert> (Just like their C counterparts)
[23:43:08] <mrbill> Hmm.  You can write C and C++ code that handles malloc/new failure just fine.
[23:43:11] *** Quits: mschifer (Adium@moz-BBE3ABD.mv.mozilla.com) (Quit: Leaving.)
[23:43:18] <strcat> mrbill: by making destructors never allocate
[23:43:23] <strcat> and your failure paths never allocate
[23:43:25] <mrbill> Right
[23:43:29] <strcat> and because C and C++ don't use segmented stacks
[23:43:36] <strcat> so you can write foo() without it maybe allocating
[23:44:02] <strcat> fn foo() { } 
[23:44:08] *** Parts: steven_is_false (user@moz-144077DE.bchsia.telus.net) (ERC Version 5.3 (IRC client for Emacs))
[23:44:09] *** Quits: eholk (eholk@moz-1733E9A.uconnect.utah.edu) (Quit: eholk)
[23:44:10] <strcat> can allocate
[23:44:19] *** Joins: vilonis (jared@moz-EE5D17ED.ph.ph.cox.net)
[23:44:42] <engla> print and fmt should be changed to not allocate
[23:44:53] <strcat> fmt! has to allocate, it makes a string
[23:44:59] <jensnockert> engla: How would you do that?
[23:44:59] <strcat> print allocates kernel resources no matter what
[23:45:31] <aatch> I mean, they shouldn't work the way they currently do, but that's neither here nor there.
[23:45:32] *** Joins: echristo (echristo@moz-1892C634.hsd1.ca.comcast.net)
[23:45:45] <strcat> engla: you can't write code without allocations in rust
[23:45:48] <strcat> it's not currently possible.
[23:45:50] *** Quits: MaikKlein (maik@moz-13DDABF2.dip0.t-ipconnect.de) (Ping timeout)
[23:45:52] <engla> it should be possible
[23:46:02] <strcat> fn foo(a: int, b: int) -> int { a + b }
[23:46:04] <strcat> that can allocate
[23:46:09] <engla> jensnockert: I heard a discussion about rewriting fmt to work with Writer
[23:46:14] <strcat> engla: then no stack growth
[23:46:25] <strcat> handling OOM and stack growth are mutually exclusive
[23:46:51] <aatch> engla, that doesn't mean no allocation.
[23:47:10] <strcat> the scheduler probably requires some allocation
[23:47:12] <aatch> Just because you don't see ~ or @ doesn't mean there isn't any allocation.
[23:47:22] <strcat> libuv does write buffers in userspace buffers/threads
[23:47:35] <strcat> so no async I/O in your fail path
[23:47:52] <engla> you could use syscalls
[23:48:00] <aatch> even then, doing a syscall allocates kernel resources.
[23:48:00] <jensnockert> There's an easy way to resolve OOM though, just have swap, like a boss.
[23:48:19] <aatch> engla, and that means no useful logging anyway.
[23:48:21] <strcat> jensnockert: then you just hit I/O pressure and it all grinds to a halt ;p
[23:48:35] <jensnockert> strcat: The issue was crashing, not terrible performance.
[23:48:39] <tikue> rusti: "a" == ~"a"
[23:48:41] -rusti- <anon>:7:16: 7:20 warning: unnecessary allocation, the sigil can be removed [-W unnecessary-allocation (default)]
[23:48:41] -rusti- <anon>:7          "a" == ~"a"
[23:48:41] -rusti-                          ^~~~
[23:48:41] -rusti- true
[23:48:50] <strcat> jensnockert: but it's so terrible that a web server would start dropping reqs
[23:49:00] <strcat> maybe not with a high-end SSD
[23:49:02] <jensnockert> strcat: Unlike OOM?
[23:49:16] <strcat> jensnockert: not unlike OOM
[23:49:25] <strcat> but your sshd process can be excluded from OOM killing
[23:49:26] <mrbill> At any rate, my point is that there are actual products out there running on 64-bit systems with memory overcommit turned off, so if you want Rust to work in those scenarios with tasks being freely usable as intended, segmented stacks are a must to avoid overconsuming virtual address space.
[23:49:27] <strcat> you can login and fix it
[23:49:34] <strcat> if it starts thrashing on I/O you might not be able to
[23:49:46] <strcat> mrbill: you can't handle OOM with segmented stacks ;\
[23:49:48] <mrbill> Just a data point I thought you might find useful
[23:50:03] <strcat> reliable applications do allocation up front
[23:50:10] <strcat> they make the threads they need, they make the object pools they need
[23:50:55] <strcat> if you have segmented stacks... really anything is an allocation
[23:51:02] <mrbill> So if you want to write a system that spawns off tasks to handle an incoming request or connection, and you fail to allocate memory, your server is toast?
[23:51:03] <strcat> your wrapper around free() might allocate
[23:51:04] <xenocons> hrmm `&'static [signature<'static>]` does not implement any method in scope named `each`
[23:51:17] <strcat> mrbill: if you have segmented stacks and you go OOM, rust calls abort()
[23:51:24] <strcat> there's nothing else it can do
[23:51:30] <strcat> calling functions requires stack
[23:51:34] <aatch> xenocons, that's because there's no `.each`
[23:51:35] <strcat> if it can't grab a stack segment it's toast
[23:52:04] <xenocons> aatch: oh that was removed in 0.7?
[23:52:14] <aatch> xenocons, yes. A while ago actually
[23:52:14] <xenocons> whoops
[23:52:28] <xenocons> (i havent written any rust for ~1 month)
[23:52:30] <aatch> for now, it's `.iter().advance`
[23:52:38] <aatch> this is temporary
[23:52:44] <xenocons> alright
[23:52:53] <aatch> until we get language support for iterators in the language
[23:53:03] <aatch> (redundant statement is redundant)
[23:53:07] <xenocons> heh
[23:53:14] <sp3d> strcat: would it be possible to write a "fail!" and corresponding path in the scheduler for OOM that wouldn't allocate (until the scheduler runs the next live task)?
[23:53:26] <xenocons> are the capture semantics of this advance the same as each()
[23:53:28] <strcat> sp3d: no, because it unwinds the stack and calls destructors
[23:53:34] <strcat> destructors are arbitrary code
[23:53:34] <aatch> xenocons, yes
[23:53:38] <sp3d> oh, right, destructors
[23:53:41] <mrbill> Yes, I understand that, though it seems like you ought to be able to reserve a few pages of stack space per kernel thread to use to unwind tasks in OOM conditions.
[23:53:57] <mrbill> As long as your destructors are simple, recovery may be possible
[23:54:01] <strcat> sp3d: fail!() itself will also need to allocate if we want to send something to the parent indicating why there was a failure
[23:54:17] <engla> is it silly to try? the user might be able to not use ridiculous destructors
[23:54:28] <xenocons> hrmm
[23:54:44] <aatch> xenocons, the change to external iterators will change that though
[23:54:58] <aatch> as `for` loops will no longer be closure-based
[23:55:01] <sp3d> my thought was a separate case which doesn't carry such a message but can be identified as OOM by entering the scheduler a different way or such--but in the presence of destructors maybe allocating, I think it's a foregone conclusion
[23:55:06] <sully> strcat: tracked down the bug you filed
[23:55:09] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[23:55:09] *** ChanServ sets mode: +o brson
[23:55:10] <strcat> sully: nice
[23:55:11] <aatch> thus, the borrow checker can reason about them properly.
[23:55:30] <strcat> sp3d: fail itself also allocates
[23:55:38] <xenocons> oo i got new errors in rust 0.7 interesting
[23:55:39] <strcat> sp3d: and it will have to keep doing that if it's going to report errors to the parent
[23:55:40] <aatch> (right now, inside a for loop, break; and loop; are "suggestions")
[23:55:49] <mrbill> I'm quite aware of how difficult it is to design something that can actually recover from OOM.  The important thing is to be able to use tasks to write concurrent code naturally without chewing through virtual address space without reservation
[23:56:01] <sigma> it would be cool if you could have the compiler conservatively assert that a function won't allocate more than X amount of memory, then reserve at least X amount of memory to handle failures, then if the destructor met the requirement it could be run, else it just dies
[23:56:11] <xenocons> seems i can no longer let bytes : ~[u8] = ...; for x.iter().advance |pat| { ... operationOnBytes(&bytes); }
[23:56:12] *** Quits: dherman (dherman@moz-BBE3ABD.mv.mozilla.com) (Quit: dherman)
[23:56:26] <xenocons> (could i ever)
[23:56:30] <mrbill> My point is, don't throw out segmented stacks completely.  There are potential use cases for them even on 64-bit systems.
[23:56:38] <strcat> sigma: so no linked lists or trees allowed?
[23:56:45] <strcat> the destructor needs to walk it
[23:56:51] <jensnockert> mrbill: No use cases that cannot be solved with smaller stacks.
[23:56:57] * strcat shrugs
[23:56:58] <sully> I... am super unconvinced that type_use is right
[23:57:02] *** Quits: infynyxx (infynyxx@DB780A29.749BA1D.DCC373F0.IP) (Client exited)
[23:57:07] <sigma> that's why I added the word conservatively
[23:57:07] <aatch> sully, probably
[23:57:09] <mrbill> Define "smaller"
[23:57:10] <strcat> sully: I think it's wrong for destructors
[23:57:20] <strcat> mrbill: they won't be thrown out completely
[23:57:25] <strcat> but 5x slower than C is ridiculous
[23:57:28] <sully> I'm pretty unconvinced it is right for method calls
[23:57:29] <jensnockert> mrbill: Depends on the application.
[23:57:30] <sigma> if it can't guarantee it, it just fails, not sure how much code you'd be able to write under those restrictions though
[23:57:32] <strcat> there's no niche for rust if it's commonly that much slower
[23:57:32] <xenocons> rusti: let x = ~[1u8]
[23:57:32] -rusti- <anon>:8:4: 8:5 error: expected `;` but found `}`
[23:57:32] -rusti- <anon>:8     };
[23:57:33] -rusti-              ^
[23:57:33] -rusti- application terminated with error code 101
[23:57:36] <xenocons> rusti: let x = ~[1u8];
[23:57:37] -rusti- <anon>:7:13: 7:14 warning: unused variable: `x` [-W unused-variable (default)]
[23:57:37] -rusti- <anon>:7          let x = ~[1u8];
[23:57:37] -rusti-                       ^
[23:57:37] *** concrete.mozilla.org sets mode: +M 
[23:57:37] -rusti- ()
[23:57:57] <strcat> it can be within 10% of C without these huge sacrifices for edge cases
[23:58:14] <strcat> but I'm really not surprised when something like TreeMap runs 5x slower than the same code in C++
[23:58:58] <strcat> no FFI, no function calls, no recursion - that's how you can write rust that's near C (even though the C can be doing all of that)
