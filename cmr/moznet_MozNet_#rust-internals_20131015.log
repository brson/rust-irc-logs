[00:01:03] *** Quits: dbaupp (Thunderbir@BEECE994.D5A1DCF.37681C44.IP) (Ping timeout)
[00:11:08] *** Joins: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP)
[00:32:41] *** pnkfelix|taqueria is now known as pnkfelix
[01:05:01] *** Quits: erickt (Adium@49C4075F.3AC15C18.2321E71E.IP) (Quit: Leaving.)
[01:10:10] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[01:12:27] *** Joins: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com)
[01:15:45] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[01:16:09] *** Quits: geoffhill (geoffhill@moz-244CF33A.amazon.com) (Quit: geoffhill)
[01:30:40] *** Joins: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP)
[01:30:40] <ghrust> 01[13rust01] 15catamorphism 04force-pushed 06try from 141ab2d51 to 140983ebe: 02http://git.io/k471pw
[01:30:40] <ghrust> 13rust/06try 140983ebe 15Tim Chevalier: rustpkg: Support arbitrary dependencies in the install API...
[01:30:40] *** Parts: ghrust (ghrust@1E8607E8.6A2AE50.F3114085.IP) ()
[01:40:18] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[01:40:57] *** Quits: Jesse (jruderman@moz-BBE3ABD.mv.mozilla.com) (Quit: Jesse)
[01:41:26] *** Quits: brson (brson@moz-BBE3ABD.mv.mozilla.com) (Ping timeout)
[02:16:35] *** Joins: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP)
[02:16:35] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/kOmiKQ
[02:16:35] *** Parts: ghrust (ghrust@9C8B94D4.6A2AE50.F3114085.IP) ()
[02:16:39] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[02:16:39] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/e5vWFA
[02:16:39] <ghrust> 13rust/06auto 14b6b07af 15Daniel Micay: add an `abort` intrinsic...
[02:16:39] <ghrust> 13rust/06auto 141e98264 15bors: auto merge of #9860 : thestinger/rust/abort, r=Aatch...
[02:16:39] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[02:26:26] *** Quits: zz_kimundi (kimundi@moz-2FF9FB9A.dip0.t-ipconnect.de) (Ping timeout)
[02:30:35] *** Joins: zz_kimundi (kimundi@moz-E2582413.dip0.t-ipconnect.de)
[02:30:37] *** zz_kimundi is now known as kimundi
[02:51:35] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[02:51:35] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 141e98264 to 14a7e8957: 02http://git.io/N3iJvQ
[02:51:35] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[02:51:36] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[02:51:36] <ghrust> 01[13rust01] 15bors pushed 2 new commits to 06auto: 02http://git.io/fsBBBA
[02:51:36] <ghrust> 13rust/06auto 1445e2cf3 15Daniel Micay: add an `abort` intrinsic...
[02:51:36] <ghrust> 13rust/06auto 141252ad4 15bors: auto merge of #9860 : thestinger/rust/abort, r=Aatch...
[02:51:36] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[03:03:40] <strcat> acrichto: could you just make the __morestack thing abort for now? I'm worried that most of the unsafe blocks we have now aren't prepared for unwinding
[03:03:58] <strcat> and we can't even do pointer arithmetic without function calls
[03:04:57] <acrichto> strcat: how would landing __morestack expedite that?
[03:05:07] <strcat> because it means any function call can unwind
[03:05:49] <acrichto> but morestack is only used for stack overflow?
[03:06:00] <strcat> any function call can cause a stack overflow
[03:06:25] <acrichto> hm, well I'm trying to find the segfault
[03:06:27] <strcat> I think we would also need to patch LLVM to teach it to assume all calls can unwind
[03:06:32] <acrichto> it's completely unrealted to the __morestack changes from what I can tell so far
[03:06:41] <strcat> because right now it marks stuff as nounwind and doesn't output landing pads, etc.
[03:07:03] <acrichto> I feel like we needed that for code size, right?
[03:07:37] <strcat> I don't think it really helps due to what a mess things are atm performance-wise
[03:07:58] <acrichto> well we don't really want to make it worse...
[03:08:00] <strcat> but it would be unsafe to unwind from a function it marked nounwind
[03:08:22] <strcat> I don't think it would really be that bad to abort
[03:10:29] <strcat> acrichto: http://ix.io/8tX example, becomes http://ix.io/8tY
[03:18:10] <acrichto> strcat: what's the problem with that?
[03:18:24] <strcat> acrichto: bar is marked nounwind
[03:18:35] <strcat> so if __morestack unwinds, it's undefined behaviour
[03:18:46] <acrichto> I don't really understand why though
[03:19:00] <strcat> because that's what nounwind does - it turns unwinding into undefined behaviour
[03:19:18] <acrichto> how does llvm determine whether it can flag a function as nounwind or not?
[03:19:27] <strcat> bubbles it up bottom-up
[03:20:05] <strcat> readonly/readnone/noreturn work the same way
[03:20:13] <strcat> it just starts at the leaf node calls and bubbles up
[03:20:42] <acrichto> hm interesting
[03:21:19] <strcat> this is why I call what we do with #[inline(never)] + #[fixed_stack_segment] "making it a black box'
[03:21:40] <strcat> because it prevents this kind of interprocedural optimization (there are others like dead store elimination, and soon escape analysis)
[03:26:55] <acrichto> strcat: interesting mail (haven't read fully) (40AGqL1b]Y\5jMTQ8M)li
[03:26:58] <acrichto> http://lists.cs.uiuc.edu/pipermail/llvmdev/2008-March/013058.html
[03:27:50] <strcat> it
[03:28:05] <strcat> it's not going to be useful if it just terminates* ;p
[03:28:13] <strcat> and the alternative will be leaking
[03:28:50] <strcat> not calling destructors seems unsafe, because it means not poisoning arcs that may have shared mutable memory
[03:29:15] * strcat is convinced not calling destructors + unwinding could blow up the annihilator too
[03:32:02] <strcat> acrichto: http://lists.cs.uiuc.edu/pipermail/llvmdev/2008-March/013076.html the follow-up says it's undefined behaviour now
[03:32:36] <strcat> now to change slices to use element-size... fun
[03:33:57] *** Joins: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se)
[03:37:13] *** Joins: ecr (Mibbit@E940BDD3.FBC7597F.11F8506F.IP)
[03:51:33] <strcat> thankfully with strings length == count ;p
[03:52:47] *** Joins: dbaupp (Thunderbir@BEECE994.D5A1DCF.37681C44.IP)
[03:53:42] <dbaupp> strcat: there is at least one instance of &[x] -> &[y] transmute that's relying on byte-sizes, btw.
[03:53:52] <strcat> yay
[03:54:31] <dbaupp> just add cast::transmute_slice or some such
[03:54:43] <strcat> a cast like that would be undefined behaviour in C
[03:54:46] <strcat> due to TBAA
[03:54:48] <dbaupp> (the one I'm thinking of is in std::rand::Rng.fill_bytes)
[03:54:56] <dbaupp> it's readonly, so it should be fine?
[03:54:58] <dbaupp> hm
[03:55:08] <dbaupp> that's actually not true. that instance is &mut[]
[03:55:34] <strcat> yeah I'll fix them.
[03:56:12] <strcat> anything with a test at least ;p
[03:56:36] *** Joins: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP)
[03:56:36] <ghrust> 01[13rust01] 15bors merged 06auto into 06master: 02http://git.io/fsBBBA
[03:56:36] *** Parts: ghrust (ghrust@24260B07.6A2AE50.F3114085.IP) ()
[03:56:42] <strcat> performance-wise this is a case of codegen having to get worse before it gets better
[03:56:59] <strcat> I doubt I'll do it all in one go
[03:57:13] <dbaupp> would just going straight to (start ptr, end ptr) be better?
[03:57:26] <dbaupp> (rather than (start ptr, length))
[03:57:29] <strcat> maybe but that's too much work
[03:57:49] <dbaupp> it's make the current transmutes still work :P
[03:57:53] <dbaupp> *it'd
[03:58:00] <strcat> I just want bounds checks to not involve a multiplication
[03:58:20] <dbaupp> yeah, that's ugly
[03:58:24] <strcat> dbaupp: well they can still work if they go through the work of converting the length
[03:58:42] <dbaupp> yup, but transmute doesn't do that
[03:58:46] * dbaupp loves transmute :P
[03:58:56] <strcat> https://github.com/thestinger/rust-core/blob/master/core/vec.rs
[03:59:25] <strcat> slices are the next low-hanging fruit now that I have a slimmer abort
[03:59:53] <strcat> (well, if my benchmark involved *any* indexing, that would have been the most important ;p)
[04:00:46] <strcat> xs[3]
[04:00:48] <strcat> expands to
[04:01:01] <strcat> loading the length, and comparing to 3 * sizeof::<T>()
[04:01:14] <strcat> branching on it, doing a division on the length, and calling fail_bounds_check
[04:01:58] <strcat> fail_bounds_check isn't inlined to indexing is an opaque operation
[04:02:05] <strcat> (for the failure case)
[04:02:16] <strcat> not that it really matters
[04:02:22] <strcat> just need a #[cold] attribute
[04:06:44] *** Quits: dbaupp (Thunderbir@BEECE994.D5A1DCF.37681C44.IP) (Ping timeout)
[04:07:44] *** Joins: eddyb (eddy@3C6E2DBB.FFB4E060.A5830293.IP)
[04:41:32] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[04:41:32] <ghrust> 01[13rust01] 15bors pushed 0 new commits to 06auto: 02http://git.io/gd_nWQ
[04:41:32] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[04:41:36] *** Joins: ghrust (ghrust@79968228.6A2AE50.F3114085.IP)
[04:41:36] <ghrust> 01[13rust01] 15bors pushed 1 new commit to 06auto: 02http://git.io/snVMsw
[04:41:36] <ghrust> 13rust/06auto 1435199e5 15bors: auto merge of #9654 : catamorphism/rust/rustpkg-c-dependencies, r=brson...
[04:41:36] *** Parts: ghrust (ghrust@79968228.6A2AE50.F3114085.IP) ()
[05:02:22] *** Quits: pnkfelix (pnkfelix@moz-813314A4.hsd1.ma.comcast.net) (Quit: Leaving.)
[05:05:22] *** Joins: jeffb (jeff@moz-D13B6004.hsd1.ca.comcast.net)
[05:08:28] *** jeffb is now known as jeffdb
[05:10:10] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[05:22:00] *** Quits: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com) (Quit: sleep)
[05:27:54] *** Quits: ecr (Mibbit@E940BDD3.FBC7597F.11F8506F.IP) (Quit: http://www.mibbit.com ajax IRC Client)
[05:40:08] *** kimundi is now known as zz_kimundi
[05:41:32] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[05:41:32] <ghrust> 01[13rust01] 15bors 04force-pushed 06auto from 1435199e5 to 141252ad4: 02http://git.io/N3iJvQ
[05:41:32] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[05:41:35] *** Joins: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP)
[05:41:35] <ghrust> 01[13rust01] 15bors pushed 1 new commit to 06auto: 02http://git.io/vudvTg
[05:41:35] <ghrust> 13rust/06auto 1438cc6b9 15bors: auto merge of #9654 : catamorphism/rust/rustpkg-c-dependencies, r=brson...
[05:41:35] *** Parts: ghrust (ghrust@2EE61FCC.6A2AE50.F3114085.IP) ()
[06:25:42] *** Quits: Kxepal (Miranda@moz-ABE04B8C.pppoe.mtu-net.ru) (Ping timeout)
[06:28:25] *** Joins: Kxepal (Miranda@moz-10B83CD2.pppoe.mtu-net.ru)
[06:29:06] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[06:54:13] *** Joins: dbaupp (Thunderbir@moz-54ADD9F4.lns20.syd6.internode.on.net)
[06:55:16] *** Quits: dbaupp (Thunderbir@moz-54ADD9F4.lns20.syd6.internode.on.net) (Quit: dbaupp)
[06:58:13] *** Joins: dbaupp (Thunderbir@moz-54ADD9F4.lns20.syd6.internode.on.net)
[06:59:51] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[07:14:54] *** Quits: tikue_ (tikue_star@18C1ABA5.D038900B.689607DE.IP) (Ping timeout)
[07:24:35] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Input/output error)
[07:26:19] *** Quits: jeffdb (jeff@moz-D13B6004.hsd1.ca.comcast.net) (Quit: jeffdb)
[07:32:17] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[07:45:24] *** flaper87|afk is now known as flaper87
[07:54:08] *** zz_kimundi is now known as kimundi
[09:31:25] *** Quits: acrichto (acrichto@moz-69F2E428.ugrad.cs.cmu.edu) (Ping timeout)
[09:42:49] *** Joins: acrichto (acrichto@moz-69F2E428.ugrad.cs.cmu.edu)
[09:59:14] *** Joins: jdm (jdm@moz-300427AD.cable.virginmedia.com)
[10:10:48] *** flaper87 is now known as flaper87|afk
[10:12:13] *** Quits: StarLight (StarLight@moz-F2756DD7.pppoe.avangarddsl.ru) (Ping timeout)
[10:16:34] *** Joins: StarLight (StarLight@moz-983417BD.dynamic.avangarddsl.ru)
[10:21:37] *** Joins: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se)
[10:43:51] *** Quits: jdm (jdm@moz-300427AD.cable.virginmedia.com) (Quit: Lost terminal)
[10:50:11] *** Quits: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Quit: Leaving...)
[11:05:38] *** Quits: jensnockert (jensnocker@moz-C4B24C3.customers.ownit.se) (Input/output error)
[11:07:59] *** Joins: pnkfelix (pnkfelix@moz-813314A4.hsd1.ma.comcast.net)
[11:07:59] *** ChanServ sets mode: +o pnkfelix
[11:17:59] *** kimundi is now known as zz_kimundi
[11:29:32] *** zz_kimundi is now known as kimundi
[11:49:45] *** flaper87|afk is now known as flaper87
[12:07:12] *** kimundi is now known as zz_kimundi
[12:10:19] *** Joins: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[12:11:33] *** flaper87 is now known as flaper87|afk
[12:22:59] *** flaper87|afk is now known as flaper87
[12:24:13] *** Joins: jdm (jdm@514D186.F3BBB17D.144F44FA.IP)
[12:50:27] *** zz_kimundi is now known as kimundi
[12:52:07] *** Quits: engla (engla@moz-DBD1D96E.cust.bredbandsbolaget.se) (Ping timeout)
[13:48:27] *** Joins: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net)
[13:55:48] *** kimundi is now known as zz_kimundi
[14:04:28] *** Joins: saneyuki (Mibbit@moz-A3FEAA56.ap219.ftth.ucom.ne.jp)
[14:04:42] *** Quits: saneyuki (Mibbit@moz-A3FEAA56.ap219.ftth.ucom.ne.jp) (Quit: http://www.mibbit.com ajax IRC Client)
[14:29:43] *** Joins: strcat (strcat@moz-54F7FD49.cpe.net.cable.rogers.com)
[14:59:06] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[15:53:57] *** Quits: pnkfelix (pnkfelix@moz-813314A4.hsd1.ma.comcast.net) (Quit: Leaving.)
[15:55:43] *** zz_kimundi is now known as kimundi
[15:56:34] *** Quits: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net) (Quit: It's a joke, it's all a joke.)
[16:18:50] *** Joins: jeffdb (jeff@moz-D13B6004.hsd1.ca.comcast.net)
[16:19:49] *** kimundi is now known as zz_kimundi
[16:38:38] *** Quits: jeffdb (jeff@moz-D13B6004.hsd1.ca.comcast.net) (Quit: jeffdb)
[16:53:11] *** Joins: brson (brson@moz-BBE3ABD.mv.mozilla.com)
[16:53:11] *** ChanServ sets mode: +qo brson brson
[17:01:19] *** Joins: tjc (tjc@moz-BBE3ABD.mv.mozilla.com)
[17:01:19] *** ChanServ sets mode: +o tjc
[17:02:07] *** Joins: pnkfelix (pnkfelix@moz-B65AF445.hfc.comcastbusiness.net)
[17:02:07] *** ChanServ sets mode: +o pnkfelix
[17:04:20] <pnkfelix> (can someone jot me the ehterpad link?)
[17:04:41] <pnkfelix> nm
[17:05:01] <strcat> pnkfelix: hm?
[17:06:22] <pnkfelix> never mind
[17:07:39] *** zz_kimundi is now known as kimundi
[17:09:45] *** flaper87 is now known as flaper87|afk
[17:38:39] *** Quits: jdm (jdm@514D186.F3BBB17D.144F44FA.IP) (Ping timeout)
[17:39:35] *** Joins: jdm (jdm@88F51059.F3BBB17D.144F44FA.IP)
[17:44:14] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[17:47:30] *** Joins: tikue_ (tikue_star@2772A85E.EB08480C.689607DE.IP)
[18:01:59] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[18:04:35] <nmatsakis> tjc: I tend to like idea that package == crate end of story
[18:04:59] <nmatsakis> though it'd be nice to be able to stick multiple packages in a single repo
[18:05:54] <tjc> nmatsakis: I like it too, but I'm biased since I like it because it's simpler for me :-)
[18:05:58] <nmatsakis> maybe just give path as "github.com/foo/bar path/within/repo"
[18:06:13] <nmatsakis> and if no path is supplied, we default to "src" or something (whatever we do now?)
[18:06:14] <tjc> nmatsakis: that might even "Just Work" right now, but I'll test it
[18:07:22] *** Joins: erickt (etryzelaar@8C9ECD8F.3A598286.F12515B4.IP)
[18:07:51] *** Quits: Axord (xord@moz-1B228827.lsanca.dsl-w.verizon.net) (Quit: I'm sure it's perfectly safe)
[18:09:51] <strcat> aha
[18:10:07] <strcat> _match.rs deals with the slice length too
[18:10:25] <strcat> debugging-by-grep
[18:11:15] <strcat> and debuginfo is going to break...
[18:15:11] <strcat> jdm: do you know if the size_in_bytes metadata name for debuginfo is arbitrarily chosen? or does it have a special meaning?
[18:15:19] <strcat> changing the slice representation and I need to fix this
[18:15:29] <jdm> strcat: link?
[18:15:57] <strcat> jdm: https://github.com/mozilla/rust/blob/master/src/librustc/middle/trans/debuginfo.rs#L1844
[18:16:12] <jdm> strcat: arbitrary
[18:16:20] <strcat> ah so I'll just rename it to length and fix the tests
[18:17:13] <strcat> hrm
[18:19:58] <eddyb> pffft, the mut's I have to use all over this unsafe code
[18:20:13] <strcat> this is surprisingly easy so far
[18:20:27] <strcat> time consuming to keep tracking down the issues but so far they have all been obvious...
[18:20:37] <strcat> libstd tests still don't pass :(
[18:25:31] <strcat> at least vector pattern matching works again...
[18:28:50] <eddyb> error: cannot move out of dereference of & pointer :(
[18:31:55] *** Quits: Yurume (yurume@AC58A8CE.8A059B47.E313B915.IP) (Ping timeout)
[18:33:01] <tjc> nmatsakis: can any progress be made on https://github.com/mozilla/rust/issues/8124 ? or is it a wontfix?
[18:33:04] <tjc> (bug triage)
[18:33:45] <strcat> I really hope a run-pass test fails
[18:33:52] <strcat> I'm never going to figure out this failure in the middle of rustc...
[18:34:00] <nmatsakis> tjc: won't fix
[18:34:27] <tjc> nmatsakis: cool
[18:34:42] <nmatsakis> tjc: sorry, let me re-read comments a bit :)
[18:34:50] <tjc> nmatsakis: oh, I was hoping to close it :-)
[18:35:03] <nmatsakis> tjc: yeah, I think you can close it
[18:35:32] <tjc> great
[18:35:47] <strcat> woooo a test failure
[18:37:10] <strcat> constants >.<
[18:39:39] *** Joins: geoffhill (geoffhill@moz-244CF33A.amazon.com)
[18:40:02] <Luqman> strcat: forgot the trans::const code path?
[18:40:09] <strcat> I got most of them
[18:40:11] <strcat> :s
[18:40:17] <strcat> there's a single test failure in run-pass
[18:40:20] <strcat> issue-5688.rs
[18:41:52] *** Quits: olsonjeffery (pf@B8927AE1.CFEFA148.239A1A9E.IP) (Ping timeout)
[18:45:36] <strcat> Luqman: alright I can see where it goes wrong
[18:47:37] <eddyb> ooops, I see now that my last two messages were in the wrong channel
[18:49:02] <strcat> Luqman: might not actually be the constants that are the issue
[18:49:07] <strcat> might be something else
[18:51:29] <strcat> Luqman: aha, I think what I really broke is repr.
[18:51:51] <strcat> maybe...
[18:54:01] <strcat> yep
[18:54:11] <strcat> what a terrible thing repr is.
[18:54:33] <strcat>             p = align(unsafe { ptr::offset(p, sz as int) as uint }, al) as *u8;
[18:54:36] <strcat> wtf
[18:55:43] <strcat> this has undefined behaviour for zero-size types
[18:55:56] * strcat shrugs
[18:56:03] <acrichto> tjc: ping
[18:56:31] <tjc> acrichto: pong
[18:58:16] <acrichto> tjc: for #7240, I was wondering what the purpose of the 'src' directory was still
[18:58:30] <acrichto> I thought the idea was to have multiple crates in src?
[18:58:41] <acrichto> although I may just be remembering wrong as well
[18:59:04] <tjc> acrichto: I was confused about this myself at first, but...
[18:59:17] <tjc> the src directory is a workspace, so the user creates it on their local machine, or rustpkg init creates it
[18:59:22] <tjc> then you check out sources into workspaces
[18:59:34] <tjc> So, a git repo shouldn't really be structured as src/...
[18:59:41] <tjc> because your git repo will be a subdirectory of src/
[18:59:45] <tjc> This needs to be documented better
[18:59:46] <acrichto> tjc: oh!
[18:59:51] <tjc> possibly I need to document it better :-)
[18:59:59] <acrichto> I think that the hello-world rustpkg repo has a src directory
[19:00:04] <acrichto> and that's why I was copying it as well
[19:00:14] <acrichto> but could I just have a top-level lib.rs or something like that?
[19:00:38] <tjc> acrichto: Yes
[19:00:41] <tjc> well
[19:00:43] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[19:00:44] <tjc> never mind, yes
[19:00:52] <acrichto> oh awesome
[19:00:55] <tjc> you do want to have a top-level lib.rs ; you can also have subdirectories with more sources in them if you want
[19:01:17] <acrichto> so a *workspace* has multiple crates, but a package is probably 1-1 repo-crate
[19:01:42] <tjc> nmatsakis: is this also a wontfix? https://github.com/mozilla/rust/issues/6655
[19:01:44] <tjc> acrichto: Exactly
[19:01:53] <acrichto> tjc: awesome
[19:02:05] <tjc> acrichto: So here's the thought behind that: if I don't care about disk space, I can make 1 workspace per package...
[19:02:16] <tjc> acrichto: and that will mean rustpkg makes multiple copies of some deps to put them in different workspaces
[19:02:28] <tjc> Otherwise, I can put several packages in the same workspace so they can share dependencies
[19:02:34] <acrichto> oh interesting
[19:02:48] * acrichto reorganizes rs-slpay
[19:04:19] <sfackler> tjc: and then rustpkg gets the library name from the repository name?
[19:04:25] <tjc> sfackler: Yes
[19:05:09] <sfackler> but it doesn't really matter what that is because people should be including it via "extern mod foo = github.com/sfa/sdf" or whatever
[19:05:54] <sfackler> right?
[19:07:11] <acrichto> oh man "extern mod splay = "github.com/alexcrichton/rs-splay"" work snow!
[19:07:30] <nmatsakis> tjc: yes, closed.
[19:08:32] <nmatsakis> tjc: I was reading backscroll, it seems to me that many people will want to put a `src` directory in their github repo
[19:08:58] <tjc> nmatsakis: I think there's no problem if they do, it's just not required
[19:09:12] <nmatsakis> ok. I guess I really need to educate myself better on what rustpkg does now
[19:09:29] <acrichto> nmatsakis: I feel the same way
[19:09:34] <acrichto> it's come so far!
[19:10:49] <tjc> well, the documentation needs to be improved too
[19:10:56] <tjc> it's not really your fault for not knowing :-)
[19:11:08] <acrichto> but all the code is there! :)
[19:11:25] <tjc> yes, all the code is thereâ€¦ that's why I understand the entire Linux kernel perfectly :-)
[19:11:36] <acrichto> haha
[19:12:17] <strcat> I still have to port my rust libraries to rustpkg
[19:12:20] <sfackler> tjc: so would github.com/alexcrichton/rs-splay end up in src/github.com/alexcrichton/rs-splay?
[19:12:24] <strcat> I did it for the very early version with pkg.rs
[19:12:31] <strcat> and then gave up any attempts at following along ;p
[19:12:52] <tjc> sfackler: Depends how you fetched it --
[19:12:56] <jack> did someone change how the linker lines work recently?
[19:13:05] * sfackler still can't get rustpkg install to work :(
[19:13:19] <tjc> sfackler: If you just wrote `extern mod = "github.com/alexcrichton/rs-splay";` in your code, then yes
[19:13:21] <jack> maybe xcode updated all the tools to complain when there are -L paths taht don't exist now
[19:13:27] <tjc> You could also `git clone` it into whatever destination you want
[19:13:51] <tjc> sfackler: what's happening with `rustpkg install`? I know someone reported a problem with remote repos again, but install should work
[19:14:10] <sfackler> tjc: same nonexistent package condition
[19:14:15] <acrichto> it just worked for me (creating a dummy workspace and doing rustpkg build)
[19:14:17] *** Quits: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net) (Quit: Jesse)
[19:14:29] <sfackler> http://sprunge.us/IXJN
[19:14:36] <acrichto> sfackler: I just updated it to have a top-level lib.rs instead of src/splay/lib.rs inside the repo
[19:14:42] <acrichto> so maybe it's an outdated version?
[19:14:47] <sfackler> i just tried
[19:14:50] <acrichto> I used to get that condition before I updated it
[19:14:53] <acrichto> oh,nvmd
[19:15:04] *** Joins: Jesse (jruderman@moz-537BCF9.hsd1.ca.comcast.net)
[19:15:04] <tjc> sfackler: what does `rustpkg --version` output?
[19:15:17] <sfackler> rustpkg 0.9-pre (c8e77d5 2013-10-14 07:26:47 -0700)
[19:15:30] <tjc> hmm
[19:16:36] <tjc> sfackler: can you do: RUST_LOG=rustpkg rustpkg install github.com/... and paste the output?
[19:16:36] <tjc> thanks
[19:17:37] <sfackler> http://sprunge.us/CeZO
[19:18:54] <sfackler> someone mentioned that it could be an issue with moving directories across filesystems, but I only have one partition
[19:19:24] <tjc> sfackler: and your'e on Linux?
[19:19:47] <sfackler> yeah
[19:19:48] <sfackler> Arch
[19:19:51] <tjc> ok
[19:20:04] <tjc> I'm thinking of that rename issue, because...
[19:20:16] <tjc> it seems to be failing after git cloning into a temporary directory
[19:20:18] <tjc> or trying to
[19:20:19] <strcat> rusti: 222222
[19:20:19] -rusti- 222222
[19:20:26] <tjc> but without a Linux machine to play with, it's hard for me to say more...
[19:20:40] <tjc> I also wonder if this is why some of the tests fail on one particular one of our Linux bots, but not the others
[19:21:46] <tjc> sfackler: So, here's a random idea. Try setting your TMPDIR environment variable to something under $HOME, and see what happens
[19:21:52] <tjc> I know you said you only had one partition, but just to humor me
[19:23:07] <sfackler> that worked!
[19:23:20] <tjc> huh
[19:23:29] <tjc> great! Now, the question (for me) isâ€¦ *why*?
[19:23:35] <strcat> sfackler: is your /tmp full?
[19:24:06] <sfackler> nope, it's only 7.4M
[19:24:11] <benh> Maybe /tmp isn't a real partition at all and just an in-memory filesystem?
[19:24:18] <sfackler> ah, it is a tmpfs
[19:24:19] <sfackler> yeah
[19:24:45] <sfackler> but that isn't set up in my /etc/fstab :/
[19:24:54] <strcat> that's now the standard way of doing things
[19:25:00] <strcat> systemd mounts API filesystems, including /tmp
[19:25:04] <sfackler> ah
[19:25:08] <strcat> you don't need an /etc/fstab
[19:25:33] <strcat> the root fs is mounted by the initramfs, and since it does a fsck before mounting it can be mounted as rw immediately
[19:25:41] <strcat> anyway, off-topic tangent ;p
[19:25:42] <benh> I'm gonna need to install systemd at some point, amn't I :(
[19:28:03] <strcat> sfackler: if you look at the `findmnt` output you'll see all of them
[19:28:08] <strcat> lots of API filesystems ;p
[19:31:36] <sfackler> tjc: what's the right way to link to the library in a test.rs? Will it find the working copy if I do "extern mod foo = "github.com/asdf/asdf;""?
[19:32:12] <tjc> sfackler: In the case where you're writing a test.rs for your own library? or a test.rs that refers to a separate library?
[19:32:17] <tjc> (separate = in a different package, I mean)
[19:33:00] <sfackler> a separate package. I guess the question I should really be asking is what's the right way to set stuff up for rustpkg test
[19:33:19] <tjc> sfackler: in that case, yes, the `extern mod foo = "github.com/asdf/asdf;"' directive should just work
[19:33:41] <acrichto> tjc: oh you have to write a self-referential url?
[19:34:03] <sfackler> will my working copy have to be in "src/github.com/asdf/asdf" then?
[19:34:45] *** Joins: zokier` (zokier@moz-C4357EA7.kapsi.fi)
[19:34:57] <tjc> acrichto: in this case it's not self-referential, since it's a test.rs referring to a different package
[19:35:15] <tjc> sfackler: it depends --
[19:35:39] <tjc> sfackler: if you have a copy of asdf under src/, rustpkg will "see" that first. if you have no copies of the source in your RUST_PATH, then rustpkg will fetch it and put the sources in a hidden directory
[19:35:46] <tjc> (so that you don't accidentally edit them and lose the changes later)
[19:36:10] <acrichto> tjc: although this is for a test.rs for an adjacent lib.rs file?
[19:36:34] <tjc> acrichto: well, sfackler said above that it was a test.rs that was using a different package (other than the one that the test.rs is in)
[19:36:45] <acrichto> ah , nevermind then :)
[19:37:27] <sfackler> oh, sorry tjc, this is for a test.rs sitting next to the lib.rs for the library it's testing
[19:38:46] <sfackler> I think thewonderidiot has the right idea of why rustpkg install fails in some cases: https://github.com/mozilla/rust/issues/9482
[19:40:05] <strcat> I think I finally got this slice thing working
[19:40:08] <strcat> it successfully self-hosted
[19:40:13] <strcat> now lets see if it passes the tests...
[19:40:20] * strcat still needs to optimize the codegen a bit
[19:40:29] <strcat> could do that separately
[19:42:50] <tjc> sfackler: Oh, that's a different case, then...
[19:43:24] <tjc> sfackler: I had to re-read the minutes ( https://github.com/mozilla/rust/wiki/Meeting-weekly-2013-10-08 ) to remember what we decided to do about that, but then I remembered we decided last week to (eventually) remove test.rs files completely
[19:43:30] <tjc> though that hasn't been implemented yet
[19:43:49] <tjc> And, have people just put #[test]s in the lib and/or main crate, and have `rustpkg test` build those tests
[19:44:09] <tjc> As it is now, what you basically have to do to use a test.rs is to copy/paste all the same `mod` directives from the lib.rs file
[19:44:55] <sfackler> cool, thanks
[19:45:30] <benh> does something like #[cfg(test)] mod tests; in the main crate work?
[19:45:52] <tjc> benh: Sort of, but not exactly -- right now, if you want to do `rustpkg test`, it will only look for test.rs crates
[19:46:02] <tjc> So, if you wanted to do that, you'd have to build, and then run your main executable manually with --test
[19:46:03] <tjc> which is ok
[19:46:11] <tjc> but I want `rustpkg test` to do the right thing :-)
[19:46:13] <benh> right :)
[19:46:33] *** Parts: zokier` (zokier@moz-C4357EA7.kapsi.fi) ()
[19:46:39] <tjc> well, a little bit more than that, because you'd have to pass in `--cfg test` to `rustpkg build`
[19:46:45] *** Quits: eddyb (eddy@3C6E2DBB.FFB4E060.A5830293.IP) (Quit: Konversation terminated!)
[19:46:53] *** Joins: eddyb (eddy@3C6E2DBB.FFB4E060.A5830293.IP)
[19:47:14] <sfackler> i'm manually building tests anyways on travis since rustpkg test always returns 0 :P
[19:47:21] <tjc> hmm
[19:47:42] <benh> (sorry, i spend most of my rust-time complaining about tiny testcases and/or breaking something in libsyntax, I don't think I've written my own multi-file crates at all )
[19:48:17] <tjc> benh: no need to apologize, test cases are important :-)
[19:48:54] *** Quits: eddyb (eddy@3C6E2DBB.FFB4E060.A5830293.IP) (Ping timeout)
[19:48:57] <tjc> sfackler: ah, I see https://github.com/mozilla/rust/issues/9761 . yes
[19:54:16] *** Joins: SiegeLord (sl@moz-CAF07B4C.hsd1.ma.comcast.net)
[19:57:29] *** Joins: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu)
[20:15:53] <jack> what did Option::map_move turn into?
[20:16:37] <strcat> map
[20:17:00] <strcat> jack: map, map_default, and_then, etc. are all by-value now
[20:17:12] <strcat> and you compose as_ref/as_mut with them if you really want by-ref
[20:17:24] <strcat> just a nice way of cutting down the API complexity a lot
[20:18:05] <jack> strcat: did we forget to do this for Result?
[20:19:30] <strcat> I just did it for Option
[20:19:33] <strcat> one thing at a time ;p
[20:19:37] <strcat> error: error pattern 'index out of bounds: the len is 2 but the index is -1' not found!
[20:19:38] <strcat> ha
[20:19:43] <strcat> we actually have a test checking for this awful mistake
[20:20:17] <strcat> it printed indices as int instead of uint >.<
[20:21:47] <Luqman> strcat: ah repr, what a fun can of worms eh? :P
[20:21:55] <jack> strcat: so for by ref, do you do as_ref().map?
[20:22:05] <strcat> jack: yes
[20:22:10] <strcat> should rarely be needed though
[20:22:25] <strcat> I found that nearly every usage of map in the compiler was really just dereferencing the ref immediately
[20:42:04] *** Joins: olsonjeffery (pf@B8927AE1.CFEFA148.239A1A9E.IP)
[20:51:48] <sfackler> tjc: if I have a "extern mod A = "github.com/foo/B";", does A have to be equal to B?
[20:53:16] <tjc>  sfackler: No, A can be any identifier
[20:53:28] <tjc> it's just an alias that you refer to within the scope of the `extern mod` directive
[20:55:23] <sfackler> hmm, I'm getting a "cannot find crate" error after it's pulled down and successfully built the dependency
[20:58:29] <tjc> sfackler: can you paste the error message?
[20:59:05] <strcat> my slice thing passed tests
[20:59:11] <strcat> now to fix the silly trans codegen :)
[20:59:25] <strcat> atm it generates a multiplication to get the length in the old style and then a division to reverse it
[20:59:29] <strcat> optimizes out but... ugh
[20:59:52] <sfackler> tjc: http://sprunge.us/XVhB
[20:59:52] <Luqman> ugh, why?
[21:00:15] <strcat> Luqman: because it's ugly :)
[21:00:38] <sfackler> oh, wait, that's not right
[21:01:17] <sfackler> 1 sec
[21:01:27] <Luqman> strcat: sure, but why do the division instead of getting rid of the multiplication?
[21:01:41] <Luqman> or is that not possible. i'm not exactly sure what you were changing
[21:01:56] <strcat> Luqman: I changed the slice representation from (ptr, byte_size) to (ptr, len)
[21:02:15] <strcat> so fetching the length is now a load, and bounds checking is a comparison against that loaded value
[21:02:35] <strcat> anyway to preserve the functionality of the get_vec_base_and_len function I added a Mul to it
[21:02:46] <strcat> and a division to the bounds check in an earlier commit fixing this
[21:02:50] <tjc> sfackler: I think it might be the same problem as before, actually -- it looks like when you ran that it was still using /tmp ?
[21:02:57] <tjc> see what happens if you set TMPDIR to something else
[21:03:01] <strcat> rusti: use std::uint::max_value; let xs = [1, 2, 3]; xs[max_value / 3 + 1]
[21:03:03] -rusti- task '<unnamed>' failed at 'index out of bounds: the len is 3 but the index is 6148914691236517206', <anon>:9
[21:03:03] -rusti- application terminated with error code 101
[21:03:06] <strcat> rusti: use std::uint::max_value; let xs = [1, 2, 3]; xs[max_value / 8 + 1]
[21:03:07] -rusti- 1
[21:03:09] <strcat> rusti: use std::uint::max_value; let xs = [1, 2, 3]; xs[max_value / 8 + 2]
[21:03:10] -rusti- 2
[21:03:11] <strcat> rusti: use std::uint::max_value; let xs = [1, 2, 3]; xs[max_value / 8 + 3]
[21:03:12] -rusti- 3
[21:03:13] <strcat> rusti: use std::uint::max_value; let xs = [1, 2, 3]; xs[max_value / 8 + 4]
[21:03:14] -rusti- task '<unnamed>' failed at 'index out of bounds: the len is 3 but the index is 2305843009213693955', <anon>:9
[21:03:14] -rusti- application terminated with error code 101
[21:04:43] <sfackler> tjc: yeah, oops. here's the real error http://sprunge.us/SEja
[21:04:47] <Luqman> strcat: i guess it would be more annoying to find all the users of get_vec_base_and_len and change them
[21:06:04] <tjc> sfackler: okay, that makes more sense. Give me a minute
[21:08:58] *** Quits: jensnockert (jensnocker@moz-8BE55278.customer.t3.se) (Input/output error)
[21:09:17] *** Joins: bjz_ (brendanzab@B398BE78.F804C29E.D35A31DF.IP)
[21:09:17] *** Quits: bjz (brendanzab@B398BE78.F804C29E.D35A31DF.IP) (Connection reset by peer)
[21:25:26] *** Quits: pnkfelix (pnkfelix@moz-B65AF445.hfc.comcastbusiness.net) (Quit: Leaving.)
[21:25:36] *** Joins: pnkfelix (pnkfelix@moz-B65AF445.hfc.comcastbusiness.net)
[21:25:36] *** ChanServ sets mode: +o pnkfelix
[21:34:34] *** Quits: jdm (jdm@88F51059.F3BBB17D.144F44FA.IP) (Quit: Lost terminal)
[21:36:31] *** Quits: vadimcn (chatzilla@FB06B64.76F9E272.DA40C4B3.IP) (Input/output error)
[22:06:02] *** Quits: pnkfelix (pnkfelix@moz-B65AF445.hfc.comcastbusiness.net) (Quit: Leaving.)
[22:11:59] <bstrie> brson: +1 on #^ for inner attributes, +100 for removing braces
[22:12:21] <bstrie> and +1 on removing the foo="bar" form, if it comes to that
[22:12:43] <bstrie> foo(bar) just looks better, and doesn't pretend that we're actually assigning anything persistent
[22:15:42] <nmatsakis> I think i've come to terms with #^ and /*^ ... */ etc as well
[22:15:56] <nmatsakis> but not #^[foo]
[22:25:51] <brson> bstrie nmatsakis: awesome. let's do it
[22:32:46] <tjc> sfackler: ping
[22:32:58] <sfackler> tjc: pong
[22:33:06] <tjc> sfackler: Got a chance to look at your log, sorry for the wait
[22:33:08] <sfackler> np
[22:33:12] <tjc> can you tell me the contents of /home/sfackler/test/.rust/lib/x86_64-unknown-linux-gnu/ ?
[22:33:48] <strcat> ugh this is a weird error
[22:34:00] <sfackler> tjc: just librust-postgres-0a763a7cbe49d4-0.1.so
[22:34:06] <strcat> the *compiler* dies while compiling certain run-pass tests that I tried to fix
[22:34:13] <strcat> but only the stage2 compiler
[22:34:16] <strcat> not the stage1 compiler
[22:34:23] * strcat sighs
[22:34:25] <Luqman> the worst kind of bugs
[22:34:33] <strcat> this is the strangest bug I've seen in rustc
[22:34:38] <strcat> (and I caused it! yay)
[22:34:59] <tjc> sfackler: Hmm ok. One of the log messages made me think it was naming the library file librust-postgres-0.1.so (without the hash), which would be wrong. But I guess not
[22:35:00] <tjc> still thinking
[22:35:19] <dbaupp> brson: I'm interested to know how the contracting would work for https://github.com/mozilla/rust/issues/9874, presumably the contractor would need to be an experienced Rust user?
[22:35:33] <tjc> dbaupp: We have a specific person in mind who is experienced. I'm not sure if I'm allowed to say who it is yet.
[22:35:41] <dbaupp> tjc: oh, there we go :)
[22:36:39] <sfackler> tjc: might it be incorrectly parsing the library name since there's a '-' in it?
[22:37:04] <tjc> sfackler: That was indeed a bug at one point, but I fixed it and there should be a regression test for it, so I don't think that's it
[22:37:47] <tjc> sfackler: Okay, I'm out of other ideas -- can you repeat the process with RUST_LOG=rustpkg,rustc::metadata::filesearch,rustc::metadata::loader and re-paste?
[22:37:48] <tjc> thanks!
[22:37:58] *** Quits: tikue_ (tikue_star@2772A85E.EB08480C.689607DE.IP) (Ping timeout)
[22:38:55] <sfackler> will do
[22:39:22] <strcat> leaked memory in rust main loop (24 objects)
[22:39:24] <strcat> rustc: /home/strcat/projects/rust/src/rt/memory_region.cpp:184: memory_region::~memory_region(): Assertion `false' failed.
[22:39:25] <strcat> :s
[22:39:56] <sfackler> tjc: oh, weird: skipping /home/sfackler/test/.rust/lib/x86_64-unknown-linux-gnu/librust-postgres-0a763a7cbe49d4-0.1.so, metadata doesn't match
[22:39:57] *** Joins: tikue_ (tikue_star@2772A85E.EB08480C.689607DE.IP)
[22:40:16] <tjc> sfackler: that's kind of what I was afraid of. on the other hand, it's not a bad thing, since it's easy to narrow down from there...
[22:40:22] <tjc> strcat: I haven't seen *that* message in a while! Brings me back :-)
[22:40:54] <sfackler> full log: http://sprunge.us/HYbY
[22:41:02] <strcat> tjc: it's a wonderfully obscure error
[22:41:20] <strcat> tjc: I broke match_.rs, managed to fix it (stage1 compiler compiles + runs the 3 tests that I broke)
[22:41:28] <strcat> but.... the stage2 compiler leaks memory on them
[22:41:30] <strcat> so weird.
[22:41:36] <tjc> strcat: heh, I've run into at least one bug like that before
[22:41:44] <tjc> actually, a lot of bugs when I was doing the ill-fates match refactoring
[22:42:08] <strcat> I wonder if they are just phantom bugs from before that I'm uncovering
[22:42:46] <tjc> sfackler: I'll see if I can reproduce this on my machine. Stay tuned
[22:42:51] <tjc> strcat: entirely possible
[22:46:27] <tjc> sfackler: Yippee, I reproduced it, now to see what's really going on :-)
[22:46:54] <sfackler> :D
[22:53:58] <tjc> sfackler: Oh, I think I know what the problem is
[22:54:15] <tjc> if I comment out the link attributes (name and vers) in your lib.rs, it works
[22:54:59] <tjc> sfackler: See https://github.com/mozilla/rust/issues/8523 -- when we implement this, rustdoc_ng will have to call into rustpkg instead to get the attributes
[23:01:37] <brson> is there an issue on restoring compound assignment overloading?
[23:02:25] <dbaupp> brson: https://github.com/mozilla/rust/issues/5992
[23:04:16] <brson> thanks
[23:05:01] *** kimundi is now known as zz_kimundi
[23:15:18] *** Joins: jensnockert (jensnocker@moz-8BE55278.customer.t3.se)
[23:15:18] <sfackler> tjc: ah, cool. are there parameters I can set the link attributes to so it'll work in rustdoc and rustpkg in the short term?
[23:15:31] <tjc> sfackler: Good question. Let me check...
[23:16:31] <tjc> sfackler: Answer is no, but that's because of silly code that I wrote
[23:16:43] <tjc> Basically, rustpkg checks if there's link metadata and if there already is any, it doesn't inject any new metadata
[23:16:51] <tjc> Your name and version are actually the same as what they should be, I think, but...
[23:16:54] <tjc> rustpkg also adds a package_id item
[23:17:05] <tjc> So it's not adding that because you already had metadata, Which is just wrong and I should fix it
[23:17:15] <tjc> That said, you could *try* adding a third attribute
[23:17:30] <tjc> package_id = "github.com/sfackler/rust-postgres"
[23:17:39] <tjc> I don't want to make people do that, of course, but as a temporary hack, maybe that will do it
[23:20:24] <sfackler> tjc: that seems to have done it, thanks!
[23:20:33] <tjc> sfackler: Great! Sorry for the trouble
[23:50:22] *** Quits: tjc (tjc@moz-BBE3ABD.mv.mozilla.com) (Quit: Places to go, people to annoy)
[23:56:33] *** Quits: lkuper (lkuper@moz-D862222C.dhcp-bl.indiana.edu) (Ping timeout)
